(function(){
var hola_ldr_require;(function(){if(!navigator||!navigator.userAgent||/ MSIE [1-8]\./.test(navigator.userAgent)){return}var E={};hola_ldr_require=E;E.zdot=function(name){var zdot;if((zdot=window.spark_loader&&window.spark_loader.zdot)&&name in zdot)return zdot[name];if(1)

return {
json: undefined,
customer: "ard_de",
agents: [],
all_agents: {},
version: "1.164.316",
qs_ver: 'ver=1.164.316',
disabled: !!+undefined,
host: 'player.h-cdn.com',
zlxc: +'0',
videojs: '/svc/cdn/pub/video-js.swf?md5=18467-517c596c',
videojs_osmf: '/svc/cdn/pub/videojs-osmf.swf?md5=186245-ec749577',
videojs_flashls: '/svc/cdn/pub/videojs-flashls.swf?md5=74609-97e11010',
videojs5_osmf: '/svc/cdn/pub/videojs5-osmf.swf?md5=189643-2d3bd98a',
videojs5: '/svc/cdn/pub/videojs-5/video-js.swf?md5=92486-46aeeea9',
videojs5_10: '/svc/cdn/pub/videojs_swf_sv.swf?md5=92547-f789b0cf',
thumbnails: '/svc/cdn/pub/css/videojs.thumbnails.css?md5=874-39aa2ea2',
tpl: "/svc/cdn/pub/loader.js?minify=true&snapshot=&host=player.h-cdn.com&percent=undefined&no_conf=1",
languages: undefined,
stats_css: '/css/stats.css?md5=24994-40fa0bc7',
cdngraph_js: '/svc/cdn/pub/cdngraph.js?md5=70587-065dd6d8',
hls_js: '/svc/cdn/pub/hls.js?md5=523418-00e00a91',
flow_hls_engine: '/svc/cdn/pub/flowplayer_hls_engine.js?md5=46884-c1150199',
flow_dash_engine: '/svc/cdn/pub/flowplayer_dash_engine.js?md5=20155-6413735a',
vjs_hls_provider: '/svc/cdn/pub/vjs_hls_provider.js?md5=12415-3bb37e3a',
vstat: '/svc/cdn/pub/vstat.js?md5=29859-35440a7a',
watch_later_css: '/svc/cdn/pub/css/watch_later.css?md5=31387-a074625c',
video_panel_css: '/svc/cdn/pub/css/video_panel.css?md5=1298-0dd2ff97',
widget_css: '/svc/cdn/pub/css/widget.css?md5=14051-2ca47f0e',
player_shortcuts_css: '//player2.h-cdn.com/svc/cdn/pub/css/player_shortcuts.css?md5=2469-7f4f386d',
seek_zones_css: '//player2.h-cdn.com/svc/cdn/pub/css/seek_zones.css?md5=2289-e85f9bee',
spark_logo_svg: '/svc/cdn/pub/img/spark_logo.svg?md5=2785-1ff6ddab',
watch_later_add_svg: '/svc/cdn/pub/img/watch_later_add.svg?md5=574-1f2c2604',
watch_later_wait_gif: '/svc/cdn/pub/img/watch_later_wait.gif?md5=29931-34fa5045',
watch_later_done_svg: '/svc/cdn/pub/img/watch_later_done.svg?md5=704-007c5b96',
watch_later_add_black_svg: '/svc/cdn/pub/img/watch_later_add_black.svg?md5=619-7fcdfa92',
watch_later_add_blue_svg: '/svc/cdn/pub/img/watch_later_add_blue.svg?md5=624-5cf7f91d',
watch_later_done_round_svg: '/svc/cdn/pub/img/watch_later_done_round.svg?md5=336-2ea5ca92',
watch_later_heart_add_svg: '/svc/cdn/pub/img/watch_later_heart_add.svg?md5=1355-1c5b9bb3',
watch_later_heart_add_hover_svg: '/svc/cdn/pub/img/watch_later_heart_add_hover.svg?md5=1348-c48aaf93',
watch_later_heart_wait_gif: '/svc/cdn/pub/img/watch_later_heart_wait.gif?md5=6772-844b3b57',
watch_later_heart_done_svg: '/svc/cdn/pub/img/watch_later_heart_done.svg?md5=953-5ea95b82',
playlist_css: '/svc/cdn/pub/css/playlist.css?md5=25204-04f9a1eb',
video_search_css: '/svc/cdn/pub/css/video_search.css?md5=15795-6a54f434',
share_css: '/svc/cdn/pub/css/share.css?md5=10538-b1000841',
share_dark_css: '/svc/cdn/pub/css/share_dark.css?md5=13704-6452ca88',
autoclick_css: '/svc/cdn/pub/css/autoclick.css?md5=887-4c3638ee',
casting_css: '/svc/cdn/pub/css/casting.css?md5=2632-4e80e829',
previews_widget_css: '//player2.h-cdn.com/svc/cdn/pub/css/previews_widget.css?md5=7303-bb7b5da4',
previews_widget_html: '//player.h-cdn.com/svc/cdn/pub/inc/previews_widget.html?md5=1811-08d2e5c2',
font_roboto_css: '//player2.h-cdn.com/svc/cdn/pub/css/font_roboto.css?md5=2351-c405d498',
}[name];
return{}[name]};var console=window.console;function ie9_console(){if(console)return;console={log:function(){},error:function(){}}}ie9_console();function escape_qs(param,opt){opt=opt||{};var qs=opt.qs||"";var sep=qs||opt.amp?"&":"";if(!param)return qs;var uri_comp=encodeURIComponent;var uri_comp_val=uri_comp;for(var i in param){var val=param[i];if(val===undefined)continue;var key=uri_comp(i);qs+=sep;if(val===null)qs+=key;else if(Array.isArray(val)){if(!val.length)continue;qs+=val.map(function(_val){return key+"="+uri_comp_val(_val)}).join("&")}else qs+=key+"="+uri_comp_val(val);sep="&"}return qs}function send_beacon(url,data){if(navigator&&navigator.sendBeacon){if(navigator.sendBeacon(url,to_form_data(data)))return}var is_xdr=window.XDomainRequest!==undefined;var xhr=is_xdr?new XDomainRequest:new XMLHttpRequest;xhr.open("POST",url);if(window.FormData&&!is_xdr)data=to_form_data(data);else{data=escape_qs(data);if(!is_xdr){xhr.setRequestHeader("Accept","*/*");xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}else{return}}xhr.send(data)}function to_form_data(o){var data=new FormData;for(var k in o)data.append(k,o[k]);return data}function perr_raw(opt){var data={},qs={},zone,ver,hola_mode;if(window.hola_cdn){zone=window.hola_cdn.zone;ver=window.hola_cdn.ver;hola_mode=window.hola_cdn.mode}var root_top_url;try{root_top_url=window.top.location.href}catch(e){}qs.browser=window.chrome?"chrome":"other";qs.id=opt.id;qs.ver=ver;data.build="platform: "+navigator.platform+"\n"+"user_agent: "+navigator.userAgent;data.is_json=1;data.info=opt.info||{};data.info.customer=customer;data.info.zone=zone;data.info.hola_mode=hola_mode;data.info.location_url=location.href;data.info.page_url=root_top_url||location.href;data.info.referrer=document.referrer;data.info.injected=window.hola_dbg_conf&&window.hola_dbg_conf.loader&&window.hola_dbg_conf.loader.injected;data.info=JSON.stringify(data.info);data.bt=opt.bt;var protocol=window&&window.location&&window.location.protocol;protocol=!protocol||!protocol.startsWith("http")?"http:":protocol;var url=protocol+"//perr.h-cdn.com/be_client_cgi/perr?"+escape_qs(qs);send_beacon(url,data)}function array_reduce(callback){if(this===null){throw new TypeError("Array.prototype.reduce called on null or"+" undefined")}if(typeof callback!=="function")throw new TypeError(callback+" is not a function");var t=Object(this),len=t.length>>>0,k=0,value;if(arguments.length==2)value=arguments[1];else{while(k<len&&!(k in t))k++;if(k>=len)throw new TypeError("Reduce of empty array with no initial value");value=t[k++]}for(;k<len;k++){if(k in t)value=callback(value,t[k],k,t)}return value}function fix_obj_props(obj,prop,test,fix){if(!obj[prop]||!test()){if(!fix)return;obj[prop]=fix}Object.defineProperty(obj,prop,{writable:false})}var site_errors,hola_errors,js_errors,ldr_errors,is_loader;var customer=E.zdot("customer"),tpl=E.zdot("tpl");is_loader=/^\/svc\/cdn\/pub\/loader.js/.test(tpl);if(is_loader){window.addEventListener("error",function(e){try{var send_perr;js_errors=(js_errors||0)+1;if(e.error){if(/\.h-cdn.com/.test(e.filename)){hola_errors=(hola_errors||0)+1;send_perr=hola_errors==1}else site_errors=(site_errors||0)+1}if(send_perr){perr_raw({id:"www_cdn_db_hola_js_error",bt:(e.error||{}).stack,info:{filename:e.filename,err:""+e.error,hola_errors:hola_errors,js_errors:js_errors,site_errors:site_errors,ldr_errors:ldr_errors}})}}catch(err){console.error("ldr_require error handler error",err);ldr_errors=(ldr_errors||0)+1}})}fix_obj_props(Array.prototype,"reduce",function(){return[].reduce(String,1)==1},array_reduce);if(window.Prototype){delete Object.prototype.toJSON;delete Array.prototype.toJSON;delete String.prototype.toJSON;delete Number.prototype.toJSON;for(var p in[])Object.defineProperty(Array.prototype,p,{enumerable:false})}E.module_registry={};E.aliases={};E.config=function(config){if(config.map!==undefined)E.aliases=config.map};function init_module(module,req){if(module.inited==true)return module.init;var args=get_args(module);if(module.inited==true)return module.init;module.init=typeof module.init!=="function"?module.init:module.init.apply(null,args);if(module.init instanceof Object){for(var prop in module.exports){if(module.exports.hasOwnProperty(prop))module.init[prop]=module.exports[prop]}}else if(!module.init){console.error("empty module: "+req);ldr_errors=(ldr_errors||0)+1}else module.init=module.exports;module.inited=true;return module.init}function get_args(requirments){var args=[];var reqs=Array.isArray(requirments)?requirments:requirments.reqs;for(var i=0,len=reqs.length;i<len;i++){var req=reqs[i];switch(req){case"exports":if(!requirments.exports)throw new Error("ldr_require: invalid dependence!");args.push(requirments.exports);break;default:var module=E.module_registry[req]||(E.aliases[req]?E.module_registry[E.aliases[req]]:undefined);if(!module)throw new Error("ldr_require: missing module: "+req);args.push(init_module(module,req));break}}return args}E.define=function(name,requirements,init){if(typeof name!="string")throw new Error("ldr_require: module name is needed");if(init===undefined&&!Array.isArray(requirements)){init=requirements;requirements=[]}E.module_registry[name]={init:init,reqs:requirements,inited:false,exports:{}}};E.specified=function(name){return!!E.module_registry[name]};E.require=function(requirements,fn){fn.apply(null,get_args(requirements))};if(is_loader)window.hola_cdn_require=E.require})();function define(name,deps,init){if(hola_ldr_require)return hola_ldr_require.define(name,deps,init)}define.amd=true;var waiting_conf=hola_ldr_require&&!hola_ldr_require.zdot("json")&&[];if(waiting_conf){window.addEventListener("spark_config_loaded",function(){var funcs=waiting_conf;waiting_conf=false;funcs.forEach(function(f){f()})},false)}function require(reqs,fn){if(!hola_ldr_require)return;if(waiting_conf)return void waiting_conf.push(require.bind(null,reqs,fn));hola_ldr_require.require(reqs,fn)}require.config=function(){return require};require.specified=function(name){return hola_ldr_require.specified(name)};require.zdot=function(name){return hola_ldr_require.zdot(name)};define("/svc/cdn/pub/ldr_require.js",function(){});
define("/svc/cdn/pub/typedarray_shim.js",{__stub:1});
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=function(setup){module.exports=setup()};define("/util/es6_shim.js",[],function(){var E={t:{}};function add_prop(obj,prop,fn){if(obj[prop])return;Object.defineProperty(obj,prop,{enumerable:false,writable:true,configurable:true,value:fn})}E.t.object_assign=function(obj){for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source){if(source.hasOwnProperty(prop))obj[prop]=source[prop]}}return obj};add_prop(Object,"assign",E.t.object_assign);E.t.object_values=function(obj){if(obj==null)throw new TypeError("Cannot convert undefined or null to object");var res=[];for(var prop in obj){if(obj.hasOwnProperty(prop))res.push(obj[prop])}return res};add_prop(Object,"values",E.t.object_values);E.t.object_entries=function(obj){if(obj==null)throw new TypeError("Cannot convert undefined or null to object");var res=[];for(var prop in obj){if(obj.hasOwnProperty(prop))res.push([prop,obj[prop]])}return res};add_prop(Object,"entries",E.t.object_entries);var can_set_proto={__proto__:[]}instanceof Array;E.t.object_setPrototypeOf=function(obj,proto){if(can_set_proto)obj.__proto__=proto;else{for(var prop in proto)obj[prop]=proto[prop]}return true};add_prop(Object,"setPrototypeOf",E.t.object_setPrototypeOf);E.t.string_startsWith=function(head){head=""+head;return!head||this.slice(0,head.length)===head};add_prop(String.prototype,"startsWith",E.t.string_startsWith);E.t.string_endsWith=function(tail){tail=""+tail;return!tail||this.slice(-tail.length)==tail};add_prop(String.prototype,"endsWith",E.t.string_endsWith);E.t.string_includes=function(search,index){return this.indexOf(search,index)>=0};add_prop(String.prototype,"includes",E.t.string_includes);E.t.string_repeat=function(n){var s="";for(var i=0;i<n;i++)s+=this;return s};add_prop(String.prototype,"repeat",E.t.string_repeat);E.t.string_trimLeft=function(){return this.replace(/^\s+/,"")};add_prop(String.prototype,"trimLeft",E.t.string_trimLeft);E.t.string_trimRight=function(){return this.replace(/\s+$/,"")};add_prop(String.prototype,"trimRight",E.t.string_trimRight);E.t.string_padStart=function(len,val){val=val||" ";var l=len-this.length;return l<=0?this:val.repeat(Math.ceil(l/val.length)).slice(0,l)+this};add_prop(String.prototype,"padStart",E.t.string_padStart);E.t.string_padEnd=function(len,val){val=val||" ";var l=len-this.length;return l<=0?this:this+val.repeat(Math.ceil(l/val.length)).slice(0,l)};add_prop(String.prototype,"padEnd",E.t.string_padEnd);E.t.array_includes=function(search,index){return this.indexOf(search,index)>=0};add_prop(Array.prototype,"includes",E.t.array_includes);E.t.array_find=function(fn,this_arg){var a=this,value;for(var i=0;i<a.length;i++){value=a[i];if(i in a&&fn.call(this_arg,value,i,a))return value}};add_prop(Array.prototype,"find",E.t.array_find);E.t.array_findIndex=function(fn,this_arg){var a=this,value;for(var i=0;i<a.length;i++){value=a[i];if(i in a&&fn.call(this_arg,value,i,a))return i}return-1};add_prop(Array.prototype,"findIndex",E.t.array_findIndex);E.t.array_of=function(){return Array.prototype.slice.call(arguments)};add_prop(Array,"of",E.t.array_of);E.t.array_from=function(a,fn,_this){a=Array.prototype.slice.call(a);return!fn?a:a.map(fn,_this)};add_prop(Array,"from",E.t.array_from);E.t.arraybuffer_slice=function(begin,end){begin=begin|0;end=(end==null?this.byteLength:end)|0;if(begin<0)begin+=this.byteLength;if(end<0)end+=this.byteLength;begin=Math.min(Math.max(0,begin),this.byteLength);end=Math.min(Math.max(0,end),this.byteLength);if(end-begin<=0)return new ArrayBuffer(0);var result=new ArrayBuffer(end-begin);var resultBytes=new Uint8Array(result);var sourceBytes=new Uint8Array(this,begin,end-begin);resultBytes.set(sourceBytes);return result};if(typeof ArrayBuffer!="undefined")add_prop(ArrayBuffer.prototype,"slice",E.t.arraybuffer_slice);add_prop(Number,"EPSILON",Math.pow(2,-52));E.t.number_isFinite=function(x){return typeof x=="number"&&isFinite(x)};add_prop(Number,"isFinite",E.t.number_isFinite);E.t.math_sign=function(x){x=+x;return x!==x?NaN:!x?x:x<0?-1:1};add_prop(Math,"sign",E.t.math_sign);E.t.math_trunc=function(x){x=+x;return x!==x?NaN:x<0?Math.ceil(x):Math.floor(x)};add_prop(Math,"trunc",E.t.math_trunc);E.t.math_imul=function(x,y){var hix=x>>>16&65535;var lox=x&65535;var hiy=y>>>16&65535;var loy=y&65535;return lox*loy+(hix*loy+lox*hiy<<16>>>0)|0};add_prop(Math,"imul",E.t.math_imul);function ie9_console(){if(typeof window!="object")return;if(window.console){if(!window.console.debug)window.console.debug=window.console.info;return}var console=window.console={};["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profiles","profileEnd","show","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"].forEach(function(p){console[p]=function(){}});["memory"].forEach(function(p){console[p]={}})}ie9_console();function ie9_location_origin(){if(typeof window!="object"||!window.location||"origin"in window.location){return}var location=window.location;var default_ports={"http:":80,"https:":443};var port=location.port;if(default_ports[location.protocol]==port)port=null;location.origin=location.protocol+"//"+location.hostname+(port?":"+port:"")}ie9_location_origin();function element_matches(){if(typeof Element!="object"&&typeof Element!="function"||Element.prototype.matches){return}Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;if(Element.prototype.matches)return;Element.prototype.matches=function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s);var i=matches.length;while(--i>=0&&matches.item(i)!==this);return i>-1}}element_matches();function ie_edge_closest(){if(typeof Element!="object"&&typeof Element!="function"||Element.prototype.closest){return}Element.prototype.closest=function(selector){var el=this;while(el){if(el.matches(selector))return el;el=el.parentElement}return null}}ie_edge_closest();E.t.function_name=function(){var n=this.toString().match(/^function\s+([^\s(]+)/);return n&&n[1]||""};function ie_function_name(){if(ie_function_name.name=="ie_function_name")return;Object.defineProperty(Function.prototype,"name",{enumerable:false,configurable:false,get:E.t.function_name})}ie_function_name();function android18_animFrame(){if(typeof window!="object"||window.requestAnimationFrame)return;var start=Date.now();window.requestAnimationFrame=function(cb){setTimeout(function(){cb(Date.now()-start)},16)}}android18_animFrame();return E})})();
if(typeof hola_ldr_require!="undefined")hola_ldr_require.config({map:{events:"/util/events.js"}});define("/svc/cdn/pub/config.js",[],function(){return{}});require(["/util/es6_shim.js","/svc/cdn/pub/typedarray_shim.js"],function(){});
define("mp4box",{__stub:1});




define("muxjs",{__stub:1});



(function(){var __hola_stub_define,node_util;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(is_rn)define=require("./require_node.js").define(module,"../");else if(!is_node)define=define||self.define;else{node_util=require("util");define=require("./require_node.js").define(module,"../")}define("/util/util.js",[],function(){var E={};E._is_mocha=undefined;E.is_mocha=function(){if(E._is_mocha!==undefined)return E._is_mocha;if(typeof process!="undefined"&&typeof process.env!="undefined")return E._is_mocha=process.env.IS_MOCHA||false;return E._is_mocha=false};E.is_lxc=function(){return is_node&&+process.env.LXC};E.f_mset=function(flags,mask,bits){return flags&~mask|bits};E.f_lset=function(flags,bits,logic){return E.f_mset(flags,bits,logic?bits:0)};E.f_meq=function(flags,mask,bits){return(flags&mask)==bits};E.f_eq=function(flags,bits){return(flags&bits)==bits};E.f_cmp=function(f1,f2,mask){return(f1&mask)==(f2&mask)};E.xor=function(a,b){return!a!=!b};E.div_ceil=function(a,b){return Math.floor((a+b-1)/b)};E.ceil_mul=function(a,b){return E.div_ceil(a,b)*b};E.floor_mul=function(a,b){return Math.floor(a/b)*b};E.range=function(x,a,b){return x>=a&&x<=b};E.range.ii=function(x,a,b){return x>=a&&x<=b};E.range.ie=function(x,a,b){return x>=a&&x<b};E.range.ei=function(x,a,b){return x>a&&x<=b};E.range.ee=function(x,a,b){return x>a&&x<b};E.clamp=function(lower_bound,value,upper_bound){if(value<lower_bound)return lower_bound;if(value<upper_bound)return value;return upper_bound};E.revcmp=function(a,b){return a>b?-1:a<b?1:0};E.union_with=function(fn){var res={},args;if(arguments.length==2&&typeof arguments[1]=="object")args=arguments[1];else args=Array.prototype.slice.call(arguments,1);for(var i=0;i<args.length;++i){for(var key in args[i]){var arg=args[i];res[key]=res.hasOwnProperty(key)?fn(res[key],arg[key]):arg[key]}}return res};function _clone_deep(obj){var i,n,ret;if(obj instanceof Array){ret=new Array(obj.length);n=obj.length;for(i=0;i<n;i++)ret[i]=obj[i]instanceof Object?_clone_deep(obj[i]):obj[i];return ret}else if(obj instanceof Date)return new Date(obj);else if(obj instanceof RegExp)return new RegExp(obj);else if(obj instanceof Function)return obj;ret={};for(i in obj)ret[i]=obj[i]instanceof Object?_clone_deep(obj[i]):obj[i];return ret}E.clone_deep=function(obj){if(!(obj instanceof Object))return obj;return _clone_deep(obj)};E.extend=function(obj){for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source)obj[prop]=source[prop]}return obj};function is_object(obj){return obj&&obj.constructor==Object}E.extend_deep=function(obj){if(!is_object(obj))return obj;for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source){if(is_object(source[prop])&&is_object(obj[prop]))E.extend_deep(obj[prop],source[prop]);else obj[prop]=source[prop]}}return obj};E.extend_deep_del_null=function(obj){for(var i=1;i<arguments.length;i++){var source=arguments[i];if(!source)continue;for(var prop in source){if(is_object(source[prop])){if(!is_object(obj[prop]))obj[prop]={};E.extend_deep_del_null(obj[prop],source[prop])}else if(source[prop]==null)delete obj[prop];else obj[prop]=source[prop]}}return obj};E.defaults=function(obj){if(!obj)obj={};for(var i=1;i<arguments.length;i++){var source=arguments[i];if(obj===undefined)continue;for(var prop in source){if(obj[prop]===undefined)obj[prop]=source[prop]}}return obj};E.defaults_deep=function(obj){if(obj!==undefined&&!is_object(obj))return obj;for(var i=1;i<arguments.length;i++){var source=arguments[i];if(obj===undefined)obj=E.clone_deep(source);else if(is_object(source)){for(var prop in source){var s=source[prop],d=obj[prop];if(d===undefined)obj[prop]=E.clone_deep(s);else E.defaults_deep(d,s)}}}return obj};E.clone=function(obj){if(!(obj instanceof Object))return obj;if(obj instanceof Array){var a=new Array(obj.length);for(var i=0;i<obj.length;i++)a[i]=obj[i];return a}return E.extend({},obj)};E.freeze_deep=function(obj){if(typeof obj=="object"){for(var prop in obj){if(obj.hasOwnProperty(prop))E.freeze_deep(obj[prop])}}return Object.freeze(obj)};E.equal_deep=function(a,b){var i;if(a===b)return true;if(!a||!b||a.constructor!==b.constructor)return false;if(a instanceof Function||a instanceof RegExp)return a.toString()==b.toString();if(a instanceof Date)return+a==+b;if(Array.isArray(a)){if(a.length!=b.length)return false;for(i=0;i<a.length;i++){if(!E.equal_deep(a[i],b[i]))return false}return true}if(is_object(a)){var a_keys=Object.keys(a),b_keys=Object.keys(b);if(a_keys.length!=b_keys.length)return false;for(i=0;i<a_keys.length;i++){var key=a_keys[i];if(!E.equal_deep(a[key],b[key]))return false}return true}return false};E.map_obj=function(obj,fn){var ret={};for(var i in obj)ret[i]=fn(obj[i],i,obj);return ret};E.sort_obj=function(obj,fn){if(obj instanceof Array||!(obj instanceof Object))return obj;var ret={},keys=Object.keys(obj).sort(fn);for(var i=0;i<keys.length;i++)ret[keys[i]]=E.sort_obj(obj[keys[i]],fn);return ret};E.forEach=function(obj,fn,_this){for(var i in obj)fn.call(_this,obj[i],i,obj)};E.find=function(obj,fn,_this){for(var i in obj){if(fn.call(_this,obj[i],i,obj))return obj[i]}};E.find_prop=function(obj,prop,val){return E.find(obj,function(o){return o[prop]===val})};E.isspace=function(c){return/\s/.test(c)};E.isdigit=function(c){return c>="0"&&c<="9"};E.isalpha=function(c){return c>="a"&&c<="z"||c>="A"&&c<="Z"};E.isalnum=function(c){return E.isdigit(c)||E.isalpha(c)};E.obj_pluck=function(obj,prop){var val=obj[prop];delete obj[prop];return val};E.proto_keys=function(proto){var keys=[];for(var i in proto)keys.push(i);return keys};E.values=function(obj){var values=[];for(var i in obj)values.push(obj[i]);return values};E.path=function(path){if(Array.isArray(path))return path;path=""+path;if(!path)return[];return path.split(".")};E.get=function(o,path,def){path=E.path(path);for(var i=0;i<path.length;i++){if(!o||typeof o!="object"&&typeof o!="function"||!(path[i]in o))return def;o=o[path[i]]}return o};E.set=function(o,path,value){var orig=o;path=E.path(path);for(var i=0;i<path.length-1;i++){var p=path[i];o=o[p]||(o[p]={})}o[path[path.length-1]]=value;return orig};E.unset=function(o,path){path=E.path(path);for(var i=0;i<path.length-1;i++){var p=path[i];if(!o[p])return;o=o[p]}delete o[path[path.length-1]]};var has_unique={};E.has=function(o,path){return E.get(o,path,has_unique)!==has_unique};E.own=function(o,prop){return Object.prototype.hasOwnProperty.call(o,prop)};E.bool_lookup=function(a,split){var ret={},i;if(typeof a=="string")a=a.split(split||/\s/);for(i=0;i<a.length;i++)ret[a[i]]=true;return ret};E.clone_inplace=function(dst,src){if(dst===src)return dst;if(Array.isArray(dst)){for(var i=0;i<src.length;i++)dst[i]=src[i];dst.splice(src.length)}else if(typeof dst=="object"){var k;for(k in src)dst[k]=src[k];for(k in dst){if(!src.hasOwnProperty(k))delete dst[k]}}return dst};if(node_util&&node_util.inherits)E.inherits=node_util.inherits;else{E.inherits=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}E.inherit_init=function(obj,ctor,params){var orig_proto=Object.getPrototypeOf(obj);var ctor_proto=Object.assign({},ctor.prototype);Object.setPrototypeOf(ctor_proto,orig_proto);Object.setPrototypeOf(obj,ctor_proto);return ctor.apply(obj,params)};E.pick=function(obj){var i,o={};for(i=1;i<arguments.length;i++){if(E.own(obj,arguments[i]))o[arguments[i]]=obj[arguments[i]]}return o};E.omit=function(obj,omit){var i,o={};obj=Object(obj);for(i in obj){if(!omit.includes(i))o[i]=obj[i]}return o};E.if_set=function(val,o,name){if(val!==undefined)o[name]=val};E.escape_dotted_keys=function(obj,repl){if(!Array.isArray(obj)&&!is_object(obj))return obj;repl=repl||"_";for(var prop in obj){if(E.own(obj,prop)){var new_prop=prop.replace(/\./g,repl);if(prop!=new_prop){obj[new_prop]=obj[prop];delete obj[prop]}if(Array.isArray(obj[new_prop])){obj[new_prop].forEach(function(e){E.escape_dotted_keys(e,repl)})}else if(is_object(obj[new_prop]))E.escape_dotted_keys(obj[new_prop],repl)}}};E.ensure_array=function(v,split){if(v==null||Array.isArray(v))return v||[];if(split&&typeof v=="string")return v.split(split==true?/[ ,]+/:split).filter(Boolean);return[v]};return E})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";var qs;if(is_rn)define=require("./require_node.js").define(module,"../");else if(!is_node)define=define||self.define;else{define=require("./require_node.js").define(module,"../");var _require=require;qs=_require("querystring")}define("/util/url.js",["/util/util.js"],function(zutil){var assign=Object.assign;var E={};function replace_slashes(url){return url.replace(/\\/gi,"/")}E.add_proto=function(url){if(!url.match(/^([a-z0-9]+:)?\/\//i))url="http://"+url;return url};E.rel_proto_to_abs=function(url){var proto=is_node?"http:":location.protocol;return url.replace(/^\/\//,proto+"//")};E.get_top_level_domain=function(host){var n=host.match(/\.([^.]+)$/);return n?n[1]:""};E.get_host=function(url){var n=replace_slashes(url).match(/^(https?:)?\/\/([^\/]+)\/.*$/);return n?n[2]:""};E.get_host_without_tld=function(host){return host.replace(/^([^.]+)\.[^.]{2,3}(\.[^.]{2,3})?$/,"$1")};var generic_2ld={com:1,biz:1,net:1,org:1,xxx:1,edu:1,gov:1,ac:1,co:1,or:1,ne:1,kr:1,jp:1,jpn:1,cn:1};E.get_root_domain=function(domain){if(E.is_ip(domain))return domain;var s=domain.split("."),root=s,len=s.length;if(len>2){var hd=0;if(s[len-1]=="hola"){hd=2;if(s[len-2].match(/^\d+$/))hd=3}if(generic_2ld[s[len-2-hd]])root=s.slice(-3-hd,len-hd);else root=s.slice(-2-hd,len-hd)}return root.join(".")};E.get_domain_email=function(email){var match=email.toLowerCase().match(/^[a-z0-9_.\-+]+@(.*)$/);return match&&match[1]};E.get_root_domain_email=function(email){var domain=E.get_domain_email(email);return domain&&E.get_root_domain(domain)};E.get_path=function(url){var n=url.match(/^https?:\/\/[^\/]+(\/.*$)/);return n?n[1]:""};E.get_proto=function(url){var n=url.match(/^([a-z0-9]+):\/\//);return n?n[1]:""};E.get_host_gently=function(url){var n=replace_slashes(url).match(/^(?:(?:[a-z0-9]+?:)?\/\/)?([^\/]+)/);return n?n[1]:""};E.is_ip=function(host){var m=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(host);if(!m)return false;for(var i=1;i<=4;i++){if(+m[i]>255)return false}return true};E.is_ip_mask=function(host){var m=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(host);if(!m)return false;if(E.ip2num(host)==0)return false;var final=false;var check_num_mask=function(num){var arr=(num>>>0).toString(2).split(""),final=false;for(var i=0;i<arr.length;i++){if(final&&arr[i]=="1")return false;if(!final&&arr[i]=="0")final=true}return true};for(var i=1;i<=4;i++){if(+m[i]>255)return false;if(final&&+m[i]>0)return false;if(!final&&+m[i]<255){if(!check_num_mask(+m[i]))return false;final=true}}return!!final};E.ip2num=function(ip){var num=0;ip.split(".").forEach(function(octet){num<<=8;num+=+octet});return num>>>0};E.num2ip=function(num){return(num>>>24)+"."+(num>>16&255)+"."+(num>>8&255)+"."+(num&255)};E.is_ip_subnet=function(host){var m=/(.+?)\/(\d+)$/.exec(host);return m&&E.is_ip(m[1])&&+m[2]<=32};E.is_ip_netmask=function(host){if(!host||typeof host.split!=="function")return false;var ips=host.split("/");if(ips.length!=2||!E.is_ip(ips[0])||!E.is_ip_mask(ips[1]))return false;return true};E.is_ip_range=function(host){if(typeof host.split!=="function")return false;var ips=host.split("-");if(ips.length!=2||!E.is_ip(ips[0])||!E.is_ip(ips[1]))return false;return E.ip2num(ips[0])<E.ip2num(ips[1])};E.is_ip_port=function(host){var m=/(.+?)(?::(\d{1,5}))?$/.exec(host);return m&&E.is_ip(m[1])&&!(+m[2]>65535)};E.is_valid_url=function(url){return/^(https?:\/\/)?([a-z0-9-]+\.)+[a-z0-9-]+(\/.*)?$/i.test(url)};E.is_valid_domain=function(domain){return/^([a-z0-9]([a-z0-9-_]*[a-z0-9])?\.)+[a-z]{2,63}$/.test(domain)};E.is_hola_domain=function(domain){return E.is_valid_domain(domain)&&domain.search(/^(.*\.)?(hola\.org|holacdn\.com|h-cdn\.com)$/)!=-1};E.is_spark_domain=function(domain){return E.is_valid_domain(domain)&&domain.search(/^(.*\.)?(holaspark.com)/)!=-1};E.is_valid_email=function(email){var re=/^[a-z0-9_\-+]+(?:\.[a-z0-9_\-+]+)*@(.*)$/;var n=email.toLowerCase().match(re);return!!(n&&E.is_valid_domain(n[1]))};E.is_alias_email=function(email){if(!E.is_valid_email(email))return false;var n=email.toLowerCase().match(/^([a-z0-9_.\-+]+)@.*$/);return!!(n&&/.+\+.+/.test(n[1]))};E.get_main_email=function(email){if(!E.is_valid_email(email))return;if(E.is_alias_email(email))return email.replace(/\+.+@/,"@");return email};E.is_ip_in_range=function(ips_range,ip){if(!E.is_ip_range(ips_range)||!E.is_ip(ip))return false;var ips=ips_range.split("-");var min_ip=E.ip2num(ips[0]),max_ip=E.ip2num(ips[1]);var num_ip=E.ip2num(ip);return num_ip>=min_ip&&num_ip<=max_ip};E.is_ip_local=function(ip){return E.is_ip_in_range("10.0.0.0-10.255.255.255",ip)||E.is_ip_in_range("172.16.0.0-172.31.255.255",ip)||E.is_ip_in_range("192.168.0.0-192.168.255.255",ip)||E.is_ip_in_range("169.254.0.0-169.254.255.255",ip)};E.host_lookup=function(lookup,host){var pos;while(1){if(host in lookup)return lookup[host];if((pos=host.indexOf("."))<0)return;host=host.slice(pos+1)}};E.uri_obj_href=function(uri){return(uri.protocol||"")+(uri.slashes?"//":"")+(uri.host?(uri.auth?uri.auth+"@":"")+uri.host:"")+uri.path+(uri.hash||"")};var protocol_re=/^((?:about|http|https|file|ftp|ws|wss):)?(\/\/)?/i;var host_section_re=/^(.*?)(?:[\/?#]|$)/;var host_re=/^(?:(([^:@]*):?([^:@]*))?@)?([a-zA-Z0-9._+-]*)(?::(\d*))?/;var path_section_re=/^([^?#]*)(\?[^#]*)?(#.*)?$/;var path_re_loose=/^(\/(?:.(?![^\/]*\.[^\/.]+$))*\/?)?([^\/]*?(?:\.([^.]+))?)$/;var path_re_strict=/^(\/(?:.(?![^\/]*(?:\.[^\/.]+)?$))*\/?)?([^\/]*?(?:\.([^.]+))?)$/;E.parse=function(url,strict){function re(expr,str){var m;try{m=expr.exec(str)}catch(e){m=null}if(!m)return m;for(var i=0;i<m.length;i++)m[i]=m[i]===undefined?null:m[i];return m}url=url||location.href;var uri={orig:url};url=replace_slashes(url);var m,remaining=url;if(!(m=re(protocol_re,remaining)))return{};uri.protocol=m[1];if(uri.protocol!==null)uri.protocol=uri.protocol.toLowerCase();uri.slashes=!!m[2];if(!uri.protocol&&!uri.slashes){uri.protocol="http:";uri.slashes=true}remaining=remaining.slice(m[0].length);if(!(m=re(host_section_re,remaining)))return{};uri.authority=m[1];remaining=remaining.slice(m[1].length);if(!(m=re(host_re,uri.authority)))return{};uri.auth=m[1];uri.user=m[2];uri.password=m[3];uri.hostname=m[4];uri.port=m[5];if(uri.hostname!==null){uri.hostname=uri.hostname.toLowerCase();uri.host=uri.hostname+(uri.port?":"+uri.port:"")}if(!(m=re(path_section_re,remaining)))return{};uri.relative=m[0];uri.pathname=m[1];uri.search=m[2];uri.query=uri.search?uri.search.substring(1):null;uri.hash=m[3];if(!(m=re(strict?path_re_strict:path_re_loose,uri.pathname)))return{};uri.directory=m[1];uri.file=m[2];uri.ext=m[3];if(uri.file=="."+uri.ext)uri.ext=null;if(!uri.pathname)uri.pathname="/";uri.path=uri.pathname+(uri.search||"");uri.href=E.uri_obj_href(uri);return uri};E.qs_parse=function(q,bin,safe){var obj={};q=q.length?q.split("&"):[];var len=q.length;var unescape_val=bin?function(val){return qs.unescapeBuffer(val,true).toString("binary")}:safe?function(val){try{return decodeURIComponent(val.replace(/\+/g," "))}catch(e){return val}}:function(val){return decodeURIComponent(val.replace(/\+/g," "))};for(var i=0;i<len;++i){var x=q[i];var idx=x.indexOf("=");var kstr=idx>=0?x.substr(0,idx):x;var vstr=idx>=0?x.substr(idx+1):"";var k=unescape_val(kstr);var v=unescape_val(vstr);if(obj[k]===undefined)obj[k]=v;else if(Array.isArray(obj[k]))obj[k].push(v);else obj[k]=[obj[k],v]}return obj};function token_regex(s,end){return end?"^"+s+"$":s}E.http_glob_host=function(host,end){var port="";var parts=host.split(":");host=parts[0];if(parts.length>1)port=":"+parts[1].replace("*","[0-9]+");var n=host.match(/^(|.*[^*])(\*+)$/);if(n){host=E.http_glob_host(n[1])+(n[2].length==1?"[^./]+":"[^/]"+(n[1]?"*":"+"));return token_regex(host+port,end)}host=host.replace(/\*\*\./,"**").replace(/\*\./,"*").replace(/\./g,"\\.").replace(/\*\*/g,"(([^./]+\\.)+)?").replace(/\*/g,"[^./]+\\.");return token_regex(host+port,end)};E.http_glob_path=function(path,end){if(path[0]=="*")return E.http_glob_path("/"+path,end);var n=path.match(/^(|.*[^*])(\*+)([^*^\/]*)$/);if(n){path=E.http_glob_path(n[1])+(n[2].length==1?"[^/]+":".*")+E.http_glob_path(n[3]);return token_regex(path,end)}path=path.replace(/\*\*\//,"**").replace(/\*\//,"*").replace(/\//g,"\\/").replace(/\./g,"\\.").replace(/\*\*/g,"(([^/]+\\/)+)?").replace(/\*/g,"[^/]+\\/");return token_regex(path,end)};E.http_glob_url=function(url,end){var n=url.match(/^((.*):\/\/)?([^\/]+)(\/.*)?$/);if(!n)return null;var prot=n[1]?n[2]:"*";var host=n[3];var path=n[4]||"**";if(prot=="*")prot="https?";host=E.http_glob_host(host);path=E.http_glob_path(path);return token_regex(prot+":\\/\\/"+host+path,end)};E.root_url_cmp=function(a,b){var a_s=a.match(/^[*.]*([^*]+)$/);var b_s=b.match(/^[*.]*([^*]+)$/);if(!a_s&&!b_s)return false;var re,s;if(a_s&&b_s&&a_s[1].length>b_s[1].length||a_s&&!b_s){s=a_s[1];re=b}else{s=b_s[1];re=a}s=E.add_proto(s)+"/";if(!(re=E.http_glob_url(re,1)))return false;try{re=new RegExp(re)}catch(e){return false}return re.test(s)};E.qs_strip=function(url){return/^[^?#]*/.exec(url)[0]};E.qs_str=function(qs){var q=[];for(var k in qs){(Array.isArray(qs[k])?qs[k]:[qs[k]]).forEach(function(v){q.push(encodeURIComponent(k)+"="+encodeURIComponent(v))})}return q.join("&")};E.qs_add=function(url,qs){var u=E.parse(url),q=assign(u.query?E.qs_parse(u.query):{},qs);u.path=u.pathname+"?"+E.qs_str(q);return E.uri_obj_href(u)};E.qs_parse_url=function(url){return E.qs_parse(url.replace(/(^.*\?)|(^[^\?]*$)/,""))};E.safe_redir=function(url,default_hostname){if(!url)return;var u=E.parse(url,true);var hostname=u.hostname||default_hostname;if(!/^https?:$/.test(u.protocol)||!hostname)return;if(E.is_hola_domain(hostname)||E.is_spark_domain(hostname)||zutil.is_mocha()&&hostname=="localhost"){return"https://"+hostname+encodeURI(u.path)}};return E})})();
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/escape.js",[],function(){var E={};E.un={};var html_escape_table={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};E.html=function(html){return html.replace(/[&<>"']/g,function(m){return html_escape_table[m[0]]})};E.sh=function(s_or_a){function single(s){s=""+s;if(!s)return'""';if(/^[a-z0-9_\-.\/:]+$/i.test(s))return s;return'"'+s.replace(/([\\"`$])/g,"\\$1")+'"'}if(arguments.length==1&&!Array.isArray(s_or_a))return single(s_or_a);var s="",a=Array.isArray(s_or_a)?s_or_a:arguments;for(var i=0;i<a.length;i++)s+=(i?" ":"")+single(a[i]);return s};E.un_sh=function(s,keep_esc){var state={PARSE_STATE_INIT:0,PARSE_STATE_NORMAL_ARG:1,PARSE_STATE_QUOTE_ARG:2},cur_state=state.PARSE_STATE_INIT;var i,quote=0,argv=[],a="";for(i=0;i<s.length;i++){var esc=0;a+=s[i];if(s[i]=="\\"&&s[1]){if(!keep_esc)a=a.slice(0,-1);esc=1;i++;a+=s[i]}switch(cur_state){case state.PARSE_STATE_INIT:switch(s[i]){case"\r":case"\n":case" ":case"	":if(!esc){a="";break}case'"':case"'":if(!esc){cur_state=state.PARSE_STATE_QUOTE_ARG;if(!keep_esc)a=a.slice(0,-1);quote=s[i];break}default:cur_state=state.PARSE_STATE_NORMAL_ARG}break;case state.PARSE_STATE_NORMAL_ARG:switch(s[i]){case"\r":case"\n":case" ":case"	":if(!esc){cur_state=state.PARSE_STATE_INIT;a=a.slice(0,-1);argv.push(a);a=""}break;case'"':case"'":if(!esc){cur_state=state.PARSE_STATE_QUOTE_ARG;quote=s[i];if(!keep_esc)a=a.slice(0,-1)}break}break;case state.PARSE_STATE_QUOTE_ARG:if(s[i]==quote&&!esc){cur_state=state.PARSE_STATE_NORMAL_ARG;if(!keep_esc)a=a.slice(0,-1)}break}}if(cur_state==state.PARSE_STATE_NORMAL_ARG){cur_state=state.PARSE_STATE_INIT;argv.push(a)}if(cur_state!=state.PARSE_STATE_INIT)throw"error parsing shell";return argv};E.regex=function(s){return s.replace(/[[\]{}()*+?.\\^$|\/]/g,"\\$&")};E.uri_comp=function(s){return encodeURIComponent(s).replace(/%20/g,"+")};var http_escape_chars=[];(function(){var i;for(i=0;i<256;i++){var c=String.fromCharCode(i);http_escape_chars[i]=/^[a-zA-Z0-9_.~,\-]$/.test(c)?c:"%"+("0"+i.toString(16)).slice(-2)}})();E.encodeURIComponent_bin=function(s_or_b){var s=typeof Buffer!="undefined"&&s_or_b instanceof Buffer?s_or_b.toString("binary"):""+s_or_b;var esc="";for(var i=0;i<s.length;i++)esc+=http_escape_chars[s.charCodeAt(i)]||encodeURIComponent(s[i]);return esc};E.qs=function(param,opt){opt=opt||{};var qs=opt.qs||"";var sep=qs||opt.amp?"&":"";if(!param)return qs;var uri_comp=opt.space_plus===undefined||opt.space_plus?E.uri_comp:encodeURIComponent;var uri_comp_val=opt.bin?E.encodeURIComponent_bin:uri_comp;for(var i in param){var val=param[i];if(val===undefined)continue;var key=uri_comp(i);qs+=sep;if(val===null)qs+=key;else if(Array.isArray(val)){if(!val.length)continue;qs+=val.map(function(val){return key+"="+uri_comp_val(val)}).join("&")}else qs+=key+"="+uri_comp_val(val);sep="&"}return qs};E.uri=function(uri,qs,hash){var opt;if(typeof uri=="string")opt={uri:uri,_qs:qs,hash:hash};else{opt=Object.assign({},uri);opt._qs=opt.qs;opt.qs=undefined}uri=opt.uri;qs=typeof opt._qs=="string"?opt._qs:E.qs(opt._qs,opt);hash=typeof opt.hash=="string"?opt.hash:E.qs(opt.hash,opt);if(qs){if(!uri.includes("?"))uri+="?";else if(uri[uri.length-1]!="?"&&uri[uri.length-1]!="&")uri+="&"}else qs="";if(hash)hash="#"+hash;else hash="";return uri+qs+hash};E.mailto_url=function(mail){return"mailto:"+(mail.to||"")+"?"+E.qs({cc:mail.cc,bcc:mail.bcc,subject:mail.subject,body:mail.body},{space_plus:false})};E.parse={};E.parse.eat_token=function(s_obj,re){var match;if(!(match=re.exec(s_obj.s)))return match;s_obj.s=s_obj.s.substr(match.index+match[0].length);return match};E.parse.http_words=function(val){var res=[],o={s:val},eat_token=E.parse.eat_token,match;while(o.s){if(match=eat_token(o,/^\s*(=*[^\s=;,]+)/)){var v=match[1];if(match=eat_token(o,/^\s*=\s*\"([^\"\\]*(?:\\.[^\"\\]*)*)\"/))res.push([v,match[1].replace(/\\(.)/,"$1")]);else if(match=eat_token(o,/^\s*=\s*([^;,\s]*)/))res.push([v,match[1].replace(/\s+$/,"")]);else res.push([v,null])}else if(match=eat_token(o,/^\s*,/));else if((match=eat_token(o,/^\s*;/))||(match=eat_token(o,/^\s+/)));else throw new Error("This should not happen: "+o.s)}return res};return E})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node)define=define||self.define;else define=function(setup){module.exports=setup()};define("/util/user_agent.js",[],function(){var E={};var win_versions={"10.0":"10.0",6.3:"8.1",6.2:"8",6.1:"7","6.0":"vista",5.2:"2003",5.1:"xp","5.0":"2000"};var arch_mapping={x86_64:"64",i686:"32",arm:"arm"};var check_hola=/\bhola_android\b/i;var check_android_cdn=/Android.* CDNService\/([0-9\.]+)$/;var check_ios_cdn=/ CDNService\/([0-9\.]+)$/;var check_hola_player_app=/ (Spark|Hola)Player/;var check_opera=/\bOPR\b\/(\d+)/i;var check_edge=/\bEdge\b\/(\d+)/i;var check_xbox=/\bxbox\b/i;var check_ucbrowser=/\bUCBrowser\b\/(\d+)/i;var check_webview=/ Version\/(\d+)(\.\d)/;var is_browser=!is_node&&typeof window!="undefined";function ios_ua(ua,safari_ver){var res;if(res=/(?:iPhone|iPad|iPod|iPod touch);.*?OS ([\d._]+)/.exec(ua)){var ios_ver=res[1];var is_chrome=/CriOS/.test(ua);var is_firefox=/FxiOS/.test(ua);var is_hola_ios=is_browser&&(window.hola_cdn_sdk||window.spark_ios_sdk)||check_ios_cdn.test(ua);var ucbrowser_ver=(check_ucbrowser.exec(ua)||[])[1];var is_ucbrowser=!!ucbrowser_ver;return{browser:"safari",version:safari_ver||ios_ver,ios:ios_ver,hola_ios:is_hola_ios,chrome:is_chrome,firefox:is_firefox,ucbrowser:is_ucbrowser,ucbrowser_version:ucbrowser_ver,webview:/Twitter/.test(ua)?"twitter":/GSA\/\d+/.test(ua)?"googlesearch":/FBAV\/\d+/.test(ua)?"facebook":!safari_ver&&!is_chrome&&!is_firefox&&!is_ucbrowser&&!is_hola_ios}}if(/HolaCDN iOS/.exec(ua))return{browser:"safari",hola_ios:true}}function check_chromium(ua){if(check_webview.test(ua)||/Android/.test(ua)||/ Mobile /.test(ua)||check_opera.test(ua)){return false}var group="(?: (\\w*)\\/)?",ver="\\/[\\d\\.]+";var res=new RegExp("AppleWebKit"+ver+"(?: \\(.*\\))?"+group+".* Chrome"+ver+group+".* Safari"+ver+group).exec(ua);return res&&(res[1]||res[2]||res[3])}E.guess_browser=function(ua){var res;ua=ua||(is_browser?window.navigator&&navigator.userAgent:"");if(res=/\bOpera Mini\/(\d+)/.exec(ua))return{browser:"opera_mini",version:res[1]};var ucbrowser=check_ucbrowser.exec(ua);if(res=/[( ]MSIE ([6789]|10).\d[);]/.exec(ua))return{browser:"ie",version:res[1],xbox:check_xbox.test(ua)};if(res=/[( ]Trident\/\d+(\.\d)+.*rv:(\d\d)(\.\d)+[);]/.exec(ua))return{browser:"ie",version:res[2],xbox:check_xbox.test(ua)};if(res=/ Chrome\/(\d+)(\.\d+)+.* Safari\/\d+(\.\d+)+/.exec(ua)){var opera=check_opera.exec(ua);var edge;if(edge=check_edge.exec(ua))return{browser:"edge",version:edge[1]};var chromium_based=check_chromium(ua);return{browser:"chrome",version:res[1],android:ua.match(/Android/),webview:ua.match(check_webview),hola_android:check_hola.test(ua),hola_browser:chromium_based=="Hola",hola_app:check_android_cdn.test(ua),hola_player_app:check_hola_player_app.test(ua),chromium_based:chromium_based,opera:opera&&!!opera[1],opera_version:opera?opera[1]:undefined,ucbrowser:ucbrowser&&!!ucbrowser[1],ucbrowser_version:ucbrowser?ucbrowser[1]:undefined,webos_app:/Web0S/.test(ua),samsung_browser:/SamsungBrowser/.test(ua)}}if(res=/ QupZilla\/(\d+\.\d+\.\d+).* Safari\/\d+.\d+/.exec(ua))return{browser:"qupzilla",version:res[1]};if(res=/\(PlayStation (\d+) (\d+\.\d+)\).* AppleWebKit\/\d+.\d+/.exec(ua)){return{browser:"playstation"+res[1],version:res[2]}}if(res=/\(SMART-TV; Linux; Tizen ([0-9.]+)\) AppleWebkit\//.exec(ua))return{browser:"samsung_tizen",version:res[1]};if(res=/ Version\/(\d+)(\.\d)+.* Safari\/\d+.\d+/.exec(ua)){if(!ua.match(/Android/))return ios_ua(ua,res[1])||{browser:"safari",version:res[1]};return{browser:"chrome",version:res[1],android:true,webview:true,hola_android:check_hola.test(ua),hola_app:check_android_cdn.test(ua),hola_player_app:check_hola_player_app.test(ua),ucbrowser:ucbrowser&&!!ucbrowser[1],ucbrowser_version:ucbrowser?ucbrowser[1]:undefined,samsung_browser:/SamsungBrowser/.test(ua)}}if(res=/ (Firefox|PaleMoon)\/(\d+).\d/.exec(ua)){return{browser:"firefox",version:res[2],palemoon:res[1]=="PaleMoon"}}if(/Hola\/\d+\.\d+.*?(?:iPhone|iPad|iPod)/.exec(ua))return{browser:"safari",version:"Hola"};if(res=ios_ua(ua))return res;return{}};E.browser_to_string=function(browser){if(typeof browser!="object"||!browser.browser)return"unknown";var s=browser.browser=="ie"&&browser.version>11?"edge":browser.browser;if(browser.version)s+=" "+browser.version;if(browser.chrome)s+=" chrome";if(browser.firefox)s+=" firefox";if(browser.xbox)s+=" xbox";if(browser.android)s+=" android";if(browser.webview){s+=" webview";if(typeof browser.webview=="string")s+="-"+browser.webview}if(browser.chromium_based)s+=" chromium_based";if(browser.samsung_browser)s+=" samsung";if(browser.opera){s+=" opera";if(browser.opera_version)s+="-"+browser.opera_version}if(browser.hola_android)s+=" hola_android";if(browser.hola_app)s+=" hola_app";if(browser.hola_player_app)s+=" hola_player_app";if(browser.ucbrowser){s+=" ucbrowser";if(browser.ucbrowser_version)s+="-"+browser.ucbrowser_version}if(browser.palemoon)s+=" palemoon";if(browser.ios)s+=" ios";if(browser.webos_app)s+=" webos_app";return s?s:"unknown"};E.guess=function(ua,platform){var res;ua=ua||(is_browser?navigator.userAgent:"");platform=platform||(is_browser?navigator.platform:"");if(check_xbox.exec(ua))return{os:"xbox",mobile:false};if(res=/Windows(?: NT(?: (.*?))?)?[);]/.exec(ua)){return{os:"windows",version:win_versions[res[1]],release_version:res[1],arch:ua.match(/WOW64|Win64|x64/)?"64":"32",mobile:false}}if(/Windows Phone/.exec(ua))return{os:"winphone",mobile:true};if(/Macintosh/.exec(ua)){if(is_browser&&navigator.maxTouchPoints>1)return{os:"ios",mobile:true};if(res=/Macintosh.*; (?:Intel|PPC) Mac OS X (\d+[._]\d+)/.exec(ua)){return{os:"macos",version:res[1].replace("_","."),mobile:false}}return{os:"macos",mobile:false}}if(/Web0S.*SmartTV/.exec(ua)){return{os:"webos",version:/Chrome/.test(ua)?"3":"2",mobile:false,tv:true}}if(res=/(Android|Andr0id)(?: (\d+\.\d+))?/.exec(ua))return{os:"android",version:res[2],mobile:true};if(res=/(Linux|CrOS|OpenBSD|FreeBSD)(?: (x86_64|i686|arm))?/.exec(ua)){if(check_opera.test(ua)&&res[1]=="Linux"&&res[2]=="x86_64"&&/^Linux arm/.test(platform)){return{os:"android",mobile:true}}return{os:res[1].toLowerCase(),arch:arch_mapping[res[2]],nix:true,mobile:false}}if(res=/(?:iPhone|iPad|iPod|iPod touch);.*?OS (\d+[._]\d+)/.exec(ua))return{os:"ios",version:res[1].replace("_","."),mobile:true};if(/iPhone|iPad|iPod|HolaCDN iOS/.exec(ua))return{os:"ios",mobile:true};if(/PLAYSTATION/.exec(ua))return{os:"ps",mobile:false};if(/HitLeap Viewer/.exec(ua))return{os:"windows",mobile:false};return{}};E.guess_device=function(ua){var res;ua=ua||(is_browser?navigator.userAgent:"");if(res=/(iPhone|iPad|iPod)/.exec(ua))return{device:res[1].toLowerCase()};return{}};E.support_fullscreen=function(){return!!(is_browser&&typeof document!="undefined"&&(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))};E.support_hover=function(){if(!is_browser)return false;if(window.matchMedia&&window.matchMedia("(hover: hover)").matches)return true;return!E.guess().mobile};return E})})();
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(!is_node&&!is_rn)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/events.js",[],function(){function EventEmitter(){this._events={}}EventEmitter.prototype.listeners=function listeners(name){var events=this._events&&this._events[name]||[];var length=events.length,listeners=[],event;for(var i=0;i<length;event=events[++i])listeners.push(events[i].fn);return listeners};EventEmitter.prototype.emit=function emit(name,a1,a2,a3,a4,a5){if(!this._events||!this._events[name])return false;var listeners=this._events[name],length=listeners.length;var len=arguments.length,event=listeners[0],args,i;if(length===1){switch(len){case 1:event.fn.call(event.context||this);break;case 2:event.fn.call(event.context||this,a1);break;case 3:event.fn.call(event.context||this,a1,a2);break;case 4:event.fn.call(event.context||this,a1,a2,a3);break;case 5:event.fn.call(event.context||this,a1,a2,a3,a4);break;case 6:event.fn.call(event.context||this,a1,a2,a3,a4,a5);break;default:for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];event.fn.apply(event.context||this,args)}if(event.once)remove_listener.apply(this,[name,event])}else{for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];for(i=0;i<length;event=listeners[++i]){event.fn.apply(event.context||this,args);if(event.once)remove_listener.apply(this,[name,event])}}return true};function add_listener(name,fn,opt){opt=opt||{};if(!this._events)this._events={};if(!this._events[name])this._events[name]=[];var event={fn:fn};if(opt.context)event.context=opt.context;if(opt.once)event.once=opt.once;if(opt.prepend)this._events[name].unshift(event);else this._events[name].push(event);return this}function remove_listener(name,listener){if(!this._events||!this._events[name])return this;var listeners=this._events[name],events=[];var is_fn=typeof listener=="function";for(var i=0,length=listeners.length;i<length;i++){if(!listener)continue;if(is_fn&&listeners[i].fn!==listener||!is_fn&&listeners[i]!==listener){events.push(listeners[i])}}if(events.length)this._events[name]=events;else this._events[name]=null;return this}EventEmitter.prototype.on=function on(name,fn,context){return add_listener.apply(this,[name,fn,{context:context}])};EventEmitter.prototype.once=function once(name,fn,context){return add_listener.apply(this,[name,fn,{context:context,once:true}])};EventEmitter.prototype.prependListener=function prependListener(name,fn,context){return add_listener.apply(this,[name,fn,{context:context,prepend:true}])};EventEmitter.prototype.prependOnceListener=function prependOnceListener(name,fn,context){return this.prependListener(name,fn,{context:context,prepend:true,once:true})};EventEmitter.prototype.removeListener=function removeListener(name,fn){return remove_listener.apply(this,[name,fn])};EventEmitter.prototype.removeAllListeners=function removeAllListeners(name){if(!this._events)return this;if(name)this._events[name]=null;else this._events={};return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.setMaxListeners=function setMaxListeners(){return this};EventEmitter.prototype.eventNames=function eventNames(){var _this=this;return Object.keys(this._events).filter(function(e){return _this._events[e]!==null})};EventEmitter.EventEmitter=EventEmitter;EventEmitter.EventEmitter2=EventEmitter;EventEmitter.EventEmitter3=EventEmitter;return EventEmitter})})();
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else{var define_node=require("../../../util/require_node.js").define(module,"../");define=function(name,deps,fn){return define_node(name,["/util/url.js","/util/escape.js","/util/user_agent.js","/util/util.js","/util/events.js"],fn)}}define("/svc/cdn/pub/util.js",["/util/url.js","/util/escape.js","/util/user_agent.js","/util/util.js","/util/events.js"],function(zurl,zescape,user_agent,zutil,events){var E={conf:{}};var assign=Object.assign;var ms_sec=1e3,ms_min=60*ms_sec;E.is_enabled=function(module){return!!module&&!module.__stub};if(is_node){E.uri_opts_list=[]}else{E.geoip={};E.player_url="https://player.h-cdn.com";E.jtest={};E.uri_opts_list=["tech"];var protocol=typeof window!="undefined"&&window.location&&window.location.protocol;E.protocol=!protocol||!protocol.startsWith("http")?"http:":protocol;E.is_spark_site=typeof window!="undefined"&&!!window.document.referrer.match(/https?:\/\/holaspark\.com\/$/);E.is_top=typeof window!="undefined"&&window.top==window||E.is_spark_site;var top_url;try{top_url=!!window.top.location.href}catch(e){top_url=false}E.is_friendly_iframe=!E.is_top&&top_url;E.is_unfriendly_iframe=!E.is_top&&!top_url;E.mvp_marker=null;E.log={crit:function(){},debug:function(){},err:function(){},info:function(){},notice:function(){},set_module:function(){},warn:function(){}};E.ERR={failed:-1,ranges_unsupported:-2,aborted:-3,head_unsupported:-4,disconnected:-5,unicode_bom:-6,busy:-7};E.ERR_str={"-1":"failed","-2":"ranges_unsupported","-3":"aborted","-4":"head_unsupported","-5":"disconnected","-6":"unicode_bom","-7":"busy"};E.BEFOREUNLOAD=typeof navigator!="undefined"&&navigator.userAgent.match(/iPad|iPhone|iPod/)?"pagehide":"beforeunload";E.has_beacon=typeof navigator!="undefined"&&navigator.sendBeacon;E.browser_init=function(ua,platform){var browser=E.browser=user_agent.guess_browser(ua);var guess=E.guess=user_agent.guess(ua,platform);E.browser_support_fullscreen=user_agent.support_fullscreen();E.browser_string=user_agent.browser_to_string(E.browser);E.is_chrome=browser.browser=="chrome"&&!browser.opera;E.is_firefox=browser.browser=="firefox";E.is_edge=browser.browser=="edge";E.is_ie=browser.browser=="ie";E.is_opera=browser.opera;E.is_samsung=browser.samsung_browser;E.is_ucbrowser=browser.ucbrowser;E.is_safari=browser.browser=="safari";E.is_webview=!!browser.webview;E.is_windows=guess.os=="windows";E.is_android=guess.os=="android";E.is_winphone=guess.os=="winphone";E.is_mac=guess.os=="macos";E.is_ios=guess.os=="ios";E.is_linux=guess.os=="linux";E.is_webos=guess.os=="webos";E.is_mobile=guess.mobile;E.is_arch_32=guess.arch=="32";E.is_tv=guess.tv;E.is_ios_sdk=browser.hola_ios;E.is_android_sdk=browser.hola_app;E.is_app=browser.hola_player_app;E.browser_rule_s=E.browser.opera?"opera":E.browser.hola_app?"android_app":E.browser.hola_ios?"ios_app":E.browser.webos_app?"webos_app":E.browser.chromium_based?"chromium_based":E.browser.browser};E.browser_init();E.fix_url=function(url){return url.startsWith("//")?E.protocol+url:url};function dom_query_fn(method){return function(selector){var method_exists_on=function(root){return root&&root[method]};var query=function(root){return root&&root[method]?root[method](selector):null};if(method_exists_on(document))return query(document);if(method_exists_on(document.body)||method_exists_on(document.head)){return query(document.body)||query(document.head)}return query(document.createElement("div"))}}E.dom_query=dom_query_fn("querySelector");E.dom_query_all=dom_query_fn("querySelectorAll");E.dom_query_foreach=function(selector,cb){var nodes=E.dom_query_all(selector);for(var i=0;i<nodes.length;i++)cb(nodes[i])};E.new_event=function(name,init){if(typeof Event=="function")return new Event(name,init);var evt=document.createEvent("Event");evt.initEvent(name,true,true);return evt};E.clone_event=function(evt){return E.new_event(evt.type,evt)};E.is_numeric=function(n){return!isNaN(n)&&n!=null&&n!=Infinity};E.valid_ranges=function(ranges){return ranges&&(!ranges.length||ranges.every(function(r){return E.is_numeric(r.from)&&E.is_numeric(r.to)}))};E.remove_from_qs=function(qs,remove){var pairs=qs.split("&"),params={};pairs.forEach(function(p){var split=p.split("=");params[split[0]]=split[1]});Object.keys(params).forEach(function(param){if(remove.includes(decodeURIComponent(param)))delete params[param]});qs="";for(var p in params){qs+=(qs.length?"&":"")+p+(params[p]!==undefined?"="+params[p]:"")}return qs};E.get_platform_conf=function(conf){var pconf;conf=conf||{};if(E.is_app&&conf.app){pconf=conf.app.use_desktop_conf?assign({},conf.desktop,{disable:conf.app.disable}):conf.app}else if((E.is_mobile||E.is_app)&&conf.mobile){pconf=conf.mobile.use_desktop_conf?assign({},conf.desktop,{disable:conf.mobile.disable,use_desktop_conf:true}):conf.mobile}if(!E.is_mobile&&!E.is_app&&conf.desktop)pconf=conf.desktop;if(pconf){conf=assign({},zutil.omit(conf,["desktop","mobile","app"]),pconf)}return conf};E.get_feature_conf=function(conf,default_conf){var pconf=E.get_platform_conf(conf);conf=zutil.defaults_deep({},pconf,default_conf);var fn;if(!(fn=conf.custom_conf_fn||conf.custom_options_func))return conf;try{if(typeof fn=="string")fn=new Function(fn);conf=zutil.defaults_deep(fn(),conf);delete conf.custom_conf_fn;delete conf.custom_options_func}catch(e){E.log.err("invalid custom_conf_fn function: "+(e&&e.toString()))}return conf};E.get_tooltip_position=function(player_conf){if(E.is_mobile)return"hidden";var pos=player_conf.tooltip_position||"auto";if(pos=="auto")return player_conf.position.includes("l")?"right":"left";return player_conf.tooltip_position};E.conv_playlist_for_widget=function(list){return list.map(function(obj){obj.video_info=obj.video_info||{};return{description:obj.video_info.description||"",dur:obj.video_info.dur||0,page_url:obj.location||"",poster:obj.video_info.poster||"",video_poster:obj.video_info.video_poster||"",video_url:obj.video_info.url||"",title:obj.video_info.title||"",total:obj.video_info.total||0,ts:obj.video_info.ts||0}})};E.init=function(conf){if(E.inited)return;E.inited=true;E.mvp_marker=null;E.conf=zutil.extend_deep({},conf);E.has_ext=E.conf.loader&&E.conf.loader.injected;E.ver=E.conf.ver;E._events=new E.events;if(typeof window!="undefined")window.addEventListener(E.BEFOREUNLOAD,on_beforeunload);if(typeof document!="undefined"&&document.visibilityState){E.is_hidden=document.visibilityState!="visible";document.addEventListener("visibilitychange",on_visibilitychange)}};function on_beforeunload(){E.is_beforeunload=true;E._events.emit("beforeunload");E._events.emit("zbeforeunload",{type:"beforeunload"})}function on_visibilitychange(){if(document.visibilityState=="visible"){E.is_hidden=false;E._events.emit("visible_state");if(E.is_mobile)E._events.emit("visibility_start")}else if(document.visibilityState=="hidden"){E.is_hidden=true;E._events.emit("hidden_state");if(E.is_mobile){E._events.emit("visibility_end");E._events.emit("zbeforeunload",{type:"visibility_end"})}}}E.is_mode_stats=function(zone){return zone.CG("mode")=="stats"};E.is_mode_cdn=function(zone){return zone.CG("mode")=="cdn"};E.is_mode_bwsaver=function(zone){return zone.CG("mode")=="bwsaver"};E.is_mode_cdn_or_bwsaver=function(zone){return E.is_mode_cdn(zone)||E.is_mode_bwsaver(zone)};E.uninit=function(){if(!E.inited)return;if(typeof window!="undefined")window.removeEventListener(E.BEFOREUNLOAD,on_beforeunload);if(typeof document!="undefined"&&document.visibilityState)document.removeEventListener("visibilitychange",on_visibilitychange);E._events.emit("uninit");E.inited=false;E.conf={}};E.get_connection_type=function(){var connection=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection);return connection&&connection.type};E.is_mobile_wifi_con=function(){return E.is_mobile&&E.get_connection_type()=="wifi"};E.is_mobile_cellular_con=function(){return E.is_mobile&&E.get_connection_type()=="cellular"}}E.gconf_set=function(path,val){return E.conf_set(E.conf,path,val)};E.conf_set=function(conf,path,val){zutil.set(conf,path,val)};E.gconf_get=function(path,def){return E.conf_get(E.conf,path,def)};E.conf_get=function(conf,path,def){return zutil.get(conf,path,def)};E.CG=E.gconf_get;E.CS=E.gconf_set;E.parse_function=function(f){var m=/^function\s*([\w$]+)?\s*\(\n?([\s\w$,]*?)(\s*\/\*`*\*\/)?\)\s*\{\n?([\s\S]*?)\n?\}$/.exec(f);return{name:m[1]||null,args:m[2]?m[2].split(/\s*,\s*/):[],body:m[4]}};E.gconf_apply=function(path,args,def,_this,throw_ex){return E.conf_apply(E.conf,path,args,def,_this,throw_ex)};E.conf_apply=function(conf,path,args,def,_this,throw_ex){var func=E.conf_get(conf,path,def),ret;if(!func||typeof func!="function"&&!func.__Function__)return func||def;if(func.__Function__){if(!args.length)args=func.args;var info=E.parse_function(func.__Function__);func=new Function(info.args.join(","),info.body)}try{ret=func.apply(_this,args)}catch(e){E.log.info("conf_apply of path "+path+" failed with err "+e);if(throw_ex)throw e;ret=def}return ret};E.fullsize_from_xhr=function(xhr){return E.fullsize_from_hdrs(E.get_resp_hdrs(xhr),xhr.status==206)};E.fullsize_from_hdrs=function(hdrs,is_range){if(!hdrs)return;var fs,v;if(v=hdrs["x-hola-fullsize"])fs=+v;else if(v=hdrs["content-range"])fs=+v.split("/")[1];else if((v=hdrs["content-length"])&&!is_range)fs=+v;return fs};E.guess_link_type=function(url){var type=E.get_video_type(url);switch(type){case"mp4":return"video/mp4";case"hls":return"application/x-mpegurl";case"hds":return"application/adobe-f4m";case"dash":return"application/dash+xml";case"flv":return"video/flv";case"webm":return"video/webm";default:E.log.debug('could not guess link type: "'+url+'" assuming mp4');return"video/mp4"}};E.mime_to_type=function(mime){switch(mime){case"video/mp4":return"mp4";case"application/vnd.apple.mpegurl":case"application/x-mpegurl":return"hls";case"application/adobe-f4m":return"hds";case"application/dash+xml":return"dash";case"video/flv":return"flv";case"video/webm":return"webm"}};E.events=function(){this.events=new events;return this};E.events.prototype.on=function on(event,fn,context){this.events.on(event,fn,context)};E.events.prototype.once=function once(event,fn,context){this.events.once(event,fn,context)};E.events.prototype.one=E.events.prototype.once;E.events.prototype.off=function off(event,fn){this.events.off(event,fn)};E.events.prototype.multi_on=function multi_on(handlers,context){Object.keys(handlers).forEach(function(e){this.events.on(e,handlers[e],context)},this)};E.events.prototype.multi_off=function multi_off(handlers,context){Object.keys(handlers).forEach(function(e){this.events.off(e,handlers[e],context)},this)};E.events.prototype.emit=function emit(event,a1,a2,a3,a4,a5){this.events.emit("pre-"+event,a1,a2,a3,a4,a5);this.events.emit(event,a1,a2,a3,a4,a5);this.events.emit("post-"+event,a1,a2,a3,a4,a5)};E.on=function(event,fn,ctx){E._events.on(event,fn,ctx)};E.off=function(event,fn){E._events.off(event,fn)};var web_sockets={};E.ws=function(host,opt){opt=opt||{};var ws_c=opt.ws_c||typeof WebSocket!="undefined"&&WebSocket;if(typeof ws_c!="function"||!host)return;if(!(this instanceof E.ws))return new E.ws(host,opt);var path,customer,zone;if(typeof opt=="string")path=opt;else if(typeof opt=="object"){path=opt.path;customer=opt.customer;zone=opt.zone}var _protocol=opt.protocol||(E.protocol=="https:"?"wss":"ws");this.url=_protocol+"://"+host+"/"+path;this.url=zescape.uri(this.url,{customer:customer,zone:zone});if(web_sockets[this.url])return web_sockets[this.url];this.id=0;this.minor=!!opt.minor;this.pending=[];try{this.ws=new ws_c(this.url)}catch(e){return}this.ws.binaryType="arraybuffer";this.ws.onopen=this.onopen.bind(this);this.ws.onclose=this.onclose.bind(this);this.ws.onerror=this.onerror.bind(this);this.ws.onmessage=this.onmessage.bind(this);this.log=opt.log||E.log;this.timer=undefined;this.timedout=false;if(opt.timeout){this.timer=setTimeout(this.ontimedout.bind(this),opt.timeout==true?5e3:opt.timeout)}web_sockets[this.url]=this;return this};zutil.inherits(E.ws,events.EventEmitter);E.ws.prototype.close=function(){if(this.ws&&this.ws.readyState<this.ws.CLOSING)this.ws.close();web_sockets[this.url]=undefined};E.ws.prototype.is_ready=function(){return this.ws&&this.ws.readyState==this.ws.OPEN};E.ws.prototype.send=function(cmd,route,data,onmessage){if(!this.ws||this.ws.readyState>=this.ws.CLOSING)return;if(this.ws.readyState<this.ws.OPEN){this.pending.push({cmd:cmd,route:route,data:data,onmessage:onmessage});return}if(typeof data=="string")data=JSON.parse(data);if(Array.isArray(data))data={data:data};var msg={__id:this.id++,cmd:cmd,route:route,data:data||{}};if(onmessage)this.once(msg.__id,onmessage);msg=JSON.stringify(msg);try{this.ws.send(msg)}catch(e){this.log.info("error in websocket send: state "+this.ws.readyState+" "+" msg "+e.message+" url "+this.url)}return msg.length};E.ws.prototype.onopen=function(){var _this=this;if(this.timer){clearTimeout(this.timer);this.timer=undefined}this.pending.forEach(function(item){_this.send(item.cmd,item.route,item.data,item.onmessage)});this.pending=[];this.emit("open")};E.ws.prototype.onclose=function(){if(!this.ws)return;if(this.timer){clearTimeout(this.timer);this.timer=undefined}this.ws=undefined;this.log.info("closed websocket "+this.url);this.emit("close")};E.ws.prototype.onerror=function(e){this.log.info("error websocket "+this.url+" "+e.type);if(this.minor){this.log.info("Note: WebSockets only transmit auxilliary information "+"between clients and servers. WebSocket errors do not impact "+"HolaCDN functionality in any way.")}this.emit("error",e);this.close()};function dv2str(dv,start){var len=dv.getUint32(start);var str="",end=start+len+4;for(var i=start+4;i<end;i+=2)str+=String.fromCharCode(dv.getUint16(i));return str}function bin2json(msg){if(typeof msg=="string")return JSON.parse(msg);if(!msg.byteLength||msg.byteLength<9)throw new Error("bad message");var ctrl=new DataView(msg);var ver=ctrl.getUint8(0);if(ver!=2)throw new Error("unsupported version");var str_part=dv2str(ctrl,4);var obj=JSON.parse(str_part);var offset=str_part.length*2+8;while(offset<msg.byteLength){var id_str=dv2str(ctrl,offset);offset+=id_str.length*2+4;var bin_len=ctrl.getUint32(offset);var bin_data=new Uint8Array(msg,offset+4,bin_len);offset+=bin_len+4;zutil.set(obj,id_str,bin_data)}return obj}E.ws.prototype.onmessage=function(ev){if(typeof ev.data.byteLength=="number"){if(ev.data.byteLength<9)return this.emit("message",{err:"bad message"});var ctrl=new DataView(ev.data,0,8);var ver=ctrl.getUint8(0);if(ver!=1&&ver!=2)return this.emit("message",{err:"unsupported version"});if(ver==1){var bid=ctrl.getUint32(4);var data=new Uint8Array(ev.data,8);return this.emit(bid,{body:data})}}var json;try{json=bin2json(ev.data)}catch(e){json={err:e}}this.emit(json.__id===undefined?"message":json.__id,json.res||json)};E.ws.prototype.ontimedout=function(){if(this.timer){clearTimeout(this.timer);this.timer=undefined}if(!this.ws)return;this.timedout=true;this.close()};E.ms_since=function(since){return Math.round(E.date_monotonic()-(since||0))};E.origin_is_allowed=function(origin,origins){return E._origin_is_allowed(origins||E.gconf_get("agent.origins"),origin)};E.origin_is_allowed_url=function(url,origins){var o=zurl.parse(url);if(!o||!o.hostname)return;return E.origin_is_allowed(o.hostname,origins)};E.get_api=function(){var g=typeof window!="undefined"?window:typeof global!="undefined"?global:self;return(g.hola_cdn||(g.hola_cdn={api:{}})).api};var mp4_suffix=/\.(mp4|m4p|m4v|mov)\/?$/i;var hls_suffix=/\.m3u8\/?$/;var hds_suffix=/\.f4m\/?$/;var dash_suffix=/\.mpd\/?$/;var flv_suffix=/\.flv\/?$/;var webm_suffix=/\.webm\/?$/;function is_rx_link(v,rx){return!!v&&rx.test(zurl.parse(v).pathname.split(";")[0])}E.is_mp4_link=function(v){return is_rx_link(v,mp4_suffix)};E.is_hls_link=function(v){return is_rx_link(v,hls_suffix)};E.is_hds_link=function(v){return is_rx_link(v,hds_suffix)};E.is_dash_link=function(v){return is_rx_link(v,dash_suffix)};E.is_flv_link=function(v){return is_rx_link(v,flv_suffix)};E.is_webm_link=function(v){return is_rx_link(v,webm_suffix)};E.is_youtube_link=function(v){return v&&/^(.*\.)?youtube.com$/.test(zurl.get_host(v))};E.get_video_type=function(v){if(E.is_youtube_link(v))return"yt";if(E.is_mp4_link(v))return"mp4";if(E.is_flv_link(v))return"flv";if(E.is_webm_link(v))return"webm";if(E.is_hls_link(v))return"hls";if(E.is_hds_link(v))return"hds";if(E.is_dash_link(v))return"dash";return null};E.is_adaptive=function(type){return["hls","hds","dash"].indexOf(type)>-1};E.is_progressive=function(type){return["mp4","flv","webm"].indexOf(type)>-1};E.get_method_type=function(type){if(E.is_progressive(type))return"progressive";if(E.is_adaptive(type))return type;return"unknown"};E.get_adaptive_by_type=function(type){if(E.is_adaptive(type)||type=="yt")return type;return null};E.get_adaptive_type=function(v){var type=E.get_video_type(v);return E.get_adaptive_by_type(type)};E.is_blob_url=function(u){return!!(u&&(u.startsWith("blob:")||u.startsWith("mediasource:")))};E.is_proxy_url=function(u){var o=zurl.parse(u);return o.hostname==require.zdot("host")};E.is_ad_url=function(u){var ad_sources=E.gconf_get("ad_sources",[]);return ad_sources.length&&E.check_url(u,{include:ad_sources})};E.get_proxy_url=function(customer,zone,src){return"//"+require.zdot("host")+"/api/zagent_get?customer="+customer+"&zone="+zone+"&url="+encodeURIComponent(src)};E.proxy2origin=function(src){return decodeURIComponent(src.replace(/.*?&url=(.*)$/,"$1"))};function check_re(lst,s){if(!lst)return false;for(var i=0;i<lst.length;i++){var re=lst[i];if(re===s||re instanceof RegExp&&re.test(s))return true}return false}E._origin_is_allowed=function(origins,origin){return origins=="*"||check_re(origins,origin)};E.video_filtered_out=function(video_url,filter_out_js){if(!filter_out_js)return;var u=E.get_location_urls();var filter_opt={url:u.frame_url||u.top_url,video_url:video_url};try{var filter_fn=new Function("opt",filter_out_js);if(filter_fn(filter_opt))return true}catch(e){E.log.err(e.stack||""+e)}};E.video_format_is_enabled=function(video_url,media_filter_in){if(!media_filter_in)return true;for(var i=0;i<media_filter_in.length;i++){var test_func=E["is_"+media_filter_in[i]+"_link"];if(test_func&&test_func(video_url))return true}return false};E.match_url=function(url,rule){if(!rule)return false;try{return new RegExp("^"+zurl.http_glob_url(rule)).test(url)}catch(e){return void E.log.err(e.stack||""+e)}};E.check_url=function(url,filter){if(!filter)return true;var include=filter.include||[];var exclude=filter.exclude||[];var match=E.match_url.bind(null,url);if(exclude.find(match))return false;if(!include.length||include.find(match))return true;return false};E.get_perr_link_msg=function(customer,bugid){return"report sent id "+bugid+"\nbug location url "+"http://holaspark.com/cp/admin/debug/err_problem_report?"+zescape.qs({cust:customer,filter:"info.bugid=="+bugid})};E.get_resp_hdrs=function(xhr){if(!xhr||!xhr.getAllResponseHeaders)return{};var hdrs=xhr.getAllResponseHeaders();if(!hdrs)return{};hdrs=hdrs.split("\n");var ret={},count=1;hdrs.forEach(function(h){if(!h.length||h=="\r")return;var args=h.split(/:(.+)/);var key=args[0].trim().toLowerCase();if(ret[key])key+="_dup"+count++;ret[key]=args[1]&&args[1].trim()});return ret};E.close_to_end=function(cur,dur){return Math.floor(dur)-Math.round(cur)<=0};E.try_wrapper_silent=function(func){return function(){try{return func.apply(this,arguments)}catch(e){}}};E.inject_hook=function(object,prop,opt){function get_property_descriptor_data(o,p){while(o&&!o.hasOwnProperty(p))o=Object.getPrototypeOf(o);return{obj:o,pd:o&&Object.getOwnPropertyDescriptor(o,p)}}function can_install(o,p){var pd=Object.getOwnPropertyDescriptor(o,p);return!pd||pd.configurable}function throw_wrapper(error){if(opt.exit_on_failure)return;throw new Error(error)}if(!object)return throw_wrapper("injecting hook, but no object");if(!can_install(object,prop))return throw_wrapper("injecting hook on unconfigurable property");if(typeof opt=="function")opt={exec:opt};var setup={func_hook:{get_hook:function(){return typeof object[prop]=="function"&&object[prop].hook},install:function(hook){var _hook=function(){return hook("exec",this,arguments)};_hook.hook=hook;hook._orig_handler=object[prop];hook._orig_handler_inherited=!object.hasOwnProperty(prop);Object.defineProperty(object,prop,{configurable:true,writable:true,enumerable:true,value:_hook});if(typeof hook._orig_handler!="function")return{exec:function(){}};return{exec:hook._orig_handler}},uninstall:function(hook){if(hook._orig_handler_inherited||!hook._orig_handler)delete object[prop];else object[prop]=hook._orig_handler}},value_hook:{get_hook:function(){var data=get_property_descriptor_data(object,prop);return data.pd&&(data.pd.get||data.pd.set||{}).hook},install:function(hook){var data=hook._orig_desc_data=get_property_descriptor_data(object,prop);var pd=data.pd;if(!pd||!pd.set&&!pd.get){var v=pd?pd.value:undefined;pd={get:function(){return v},set:function(_v){v=_v}}}var _hook=function(type){var h=function(){return hook(type,this,arguments)};h.hook=hook;return h};Object.defineProperty(object,prop,{configurable:true,enumerable:true,set:pd.set&&_hook("set"),get:pd.get&&_hook("get")});return{get:pd.get,set:pd.set}},uninstall:function(hook){var pd=hook._orig_desc_data.pd||{configurable:true,writable:true,enumarable:true};if(pd.writable)pd.value=object[prop];var target=hook._orig_desc_data.obj||object;if(target!=object)delete object[prop];Object.defineProperty(target,prop,pd)}}};var oh,hook,is_exec=opt.exec||opt.post_exec;var hook_method=is_exec?setup.func_hook:setup.value_hook;if(!(hook=hook_method.get_hook())){hook=function(origin,owner,args){var e={set_handled:function(){e._handled=true},is_intercepted:function(){return!!e._handled}};var iterate_listeners=function(is_post){var ret,listener,_origin=is_post?"post_"+origin:origin;for(var i=0;i<hook.listeners.length;i++){listener=hook.listeners[i];if(!listener[_origin])continue;ret=listener[_origin].call(owner,e,args);if(!is_post&&e.is_intercepted())return ret}};e.retval=iterate_listeners();if(!e.is_intercepted()&&hook.original_handlers[origin])e.retval=hook.original_handlers[origin].apply(owner,args);iterate_listeners(true);return e.retval};hook.listeners=[];hook.original_handlers=hook_method.install(hook);hook.uninstall=function(){if(hook_method.get_hook()!=hook)return;hook_method.uninstall(hook)}}hook.listeners.push(opt);oh=hook.original_handlers;return{count:function(){return hook.listeners.length},remove:function(){var index=hook.listeners.indexOf(opt);if(index<0)return;hook.listeners.splice(index,1);if(!hook.listeners.length)hook.uninstall()},original_handlers:{exec:is_exec&&oh.exec&&oh.exec.bind(object),get:!is_exec&&oh.get&&oh.get.bind(object),set:!is_exec&&oh.set&&oh.set.bind(object)}}};E.absolute_uri=function(s,unwrap_empty){if(!s&&!unwrap_empty)return s;var el=document.createElement("source");el.src=s||"";return el.src};E.set_url_param=function(name,value,delim){return E.set_param(name,value&&encodeURIComponent(value),delim)};E.set_param=function(name,value,delim){if([false,undefined].includes(value))return"";delim=delim||"&";return delim+name+([null,true].includes(value)?"":"="+value)};E.parse={};E.parse.cache_control=function(s){var cc=zescape.parse.http_words(s),ret={};for(var i=0;i<cc.length;i++)ret[cc[i][0]]=cc[i][1]||true;return ret};E.get_spark_uri=function(location,key,def_val){var loc=typeof window!="undefined"&&window.location;if(typeof location!="object"){def_val=key;key=location;location=loc}else if(!location)location=loc;if(!key||!loc)return def_val;var o_url=zurl.parse(window.top===window?location.href:document.referrer);var o_qs=zurl.qs_parse((o_url.search||"").substr(1));var o_hash=zurl.qs_parse((o_url.hash||"").substr(1));return o_qs[key]||o_hash[key]||def_val};E.get_uri_conf=function(){var conf={};E.uri_opts_list.forEach(function(key){var value=E.get_spark_uri("hola_"+key);if(value!==undefined)conf[key]=value});return conf};E.load_script=function(url,onload,attrs){var script=document.createElement("script");script.src=E.fix_url(url);script.onload=onload;if(attrs)Object.assign(script,attrs);if(document.getElementsByTagName("head").length)document.getElementsByTagName("head")[0].appendChild(script);else if(document.getElementsByTagName("body").length)document.getElementsByTagName("body")[0].appendChild(script);else if(document.head)document.head.appendChild(script)};E.script_exists=function(url){return!!E.dom_query('script[src="'+E.fix_url(url)+'"]')};E.fnv1a=function(chunk){var hash=2166136261,arr=new Uint8Array(chunk);for(var i=0;i<arr.length;i++){hash^=arr[i];hash=hash+(hash<<1)+(hash<<4)+(hash<<7)+(hash<<8)+(hash<<24)>>>0}return hash};E.create_fake_xhr=function(opt){var fake_xhr={setup:{},req_headers:[]};opt.log=opt.log.set_module("util");fake_xhr.open=function(verb,url){fake_xhr.verb=verb;fake_xhr.url=url};fake_xhr.setRequestHeader=function(header,value){fake_xhr.req_headers.push([header,value])};fake_xhr.getAllResponseHeaders=function(){return""};fake_xhr.send=function(){fake_xhr.sent=true;opt.onsend()};fake_xhr.abort=function(){if(!fake_xhr.req||fake_xhr.req.error===E.ERR.aborted||fake_xhr.req.info.rate){return}fake_xhr.req.abort();if(opt.onabort)opt.onabort();opt.log.notice("req aborted",fake_xhr.req.name);if(fake_xhr.onabort)fake_xhr.onabort();if(fake_xhr.onloadend)fake_xhr.onloadend()};return fake_xhr};E.update_fake_xhr=function(req){var fake_xhr=req.info.segment.fake_xhr,err=req.error;fake_xhr.response=err?null:req.res.data;fake_xhr.status=err?404:200;fake_xhr.responseURL=fake_xhr.url;fake_xhr.resp_hdrs=(req.resp||{}).hdrs;if(!err){var ev={loaded:req.res.size,total:req.res.size,target:fake_xhr,lengthComputable:true};if(fake_xhr.onload)fake_xhr.onload(ev)}if(fake_xhr.onloadend)fake_xhr.onloadend();return fake_xhr};E.parse_range_header=function(hdr){var r=hdr.split("=").pop().split("-");return{from:+r[0],to:+r[1]}};E.module_fn=function(module,target){var name=typeof target=="function"?target.name:target;function get_orig(){var s=module.Player.super_,proto_fn=s&&s.prototype[name];return typeof target=="string"&&proto_fn?proto_fn:target}module.Player.prototype[name]=function(a1,a2,a3){var len=arguments.length,mod_fn=this.module&&this.module[name];var fn=mod_fn||get_orig(),fn_this=mod_fn?this.module:this;if(typeof fn!="function")return;switch(len){case 0:return fn.call(fn_this);case 1:return fn.call(fn_this,a1);case 2:return fn.call(fn_this,a1,a2);case 3:return fn.call(fn_this,a1,a2,a3);default:var args=new Array(len);for(var i=0;i<len;i++)args[i]=arguments[i];return fn.apply(fn_this,args)}};module.Player.prototype[name].orig=get_orig};E.call_super=function(module,pl,name){var in_len=arguments.length,s,fn,out_len=in_len-3;if(!(s=module.Player?module.Player.super_:module.super_))return;var a=new Array(out_len>0?out_len:0);for(var i=3;i<in_len;i++)a[i-3]=arguments[i];return name?(fn=s.prototype[name])&&fn.apply(pl,a):s.apply(pl,a)};E.create_forwarding_emit=function(player){var events=(player.module||{}).event_list,_events,in_call=false;if(!events)return;function forward_fn(e){return function(o1,o2){if(in_call)return;in_call=true;try{player.old_emit(e,o1,o2)}finally{in_call=false}}}player.old_emit=player.old_emit||player.emit;player.emit=function(e,o1,o2){return!events.includes(e)&&player.old_emit(e,o1,o2)};_events=events.map(function(e){return{name:e,cb:forward_fn(e)}});_events.forEach(function(e){player.module.on(e.name,e.cb)});return function(){delete player.old_emit;delete player.emit;_events.forEach(function(e){player.module.off(e.name,e.cb)})}};E.resolve_url=function(base_url,path){var m=path.match(/^([^:\/?#]+:)?(?:\/\/(?:([^:@\/?#]*)(?::([^:@\/?#]*))?@)?((?:[^:\/?#]*)(?::(?:\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);var _protocol=m[1]||"";var user=m[2]||"";var password=m[3]||"";var host=m[4]||"";var pathname=m[5]||"";var search=m[6]||"";var hash=m[7]||"";if(!/(\w+:)?\/\//.test(base_url))base_url=E.resolve_url(location.href,base_url);var base=zurl.parse(base_url);var is_full=!!_protocol||!!host||!!user;if(!is_full&&!pathname&&!search)search=base.search||"";if(!is_full&&pathname.charAt(0)!="/"){pathname=pathname?((base.host||base.user)&&!base.pathname?"/":"")+base.pathname.slice(0,base.pathname.lastIndexOf("/")+1)+pathname:base.pathname}var output=[];pathname.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(p){if(p=="/..")output.pop();else output.push(p)});pathname=output.join("").replace(/^\//,pathname.charAt(0)=="/"?"/":"");if(!is_full){host=base.host;password=base.password;user=base.user}if(!_protocol)_protocol=base.protocol;return _protocol+"//"+(user?user+(password?":"+password:"")+"@":"")+host+pathname+search+hash};E.is_enabled=function(module){return!!module&&!module.__stub};E.assert_enabled=function(module,message){if(!E.is_enabled(module))throw new Error(message||"module is disabled")};E.is_hola_hls_js=function(hls){return!!zutil.get(hls,"streamController.onFragChunkLoaded")};E.is_hola_hls_js_constructor=function(Hls){if(Hls.is_hola_hls===undefined){var test=new Hls;Hls.is_hola_hls=E.is_hola_hls_js(test);test.destroy()}return Hls.is_hola_hls};E.get_hls_sc=function(hls){return hls.streamController||hls.mediaController};E.def_hola_hls_config=function(conf_get){var ret={fragLoadingLoopThreshold:1e3,manifestLoadingTimeOut:20*ms_sec,manifestLoadingMaxRetry:4,levelLoadingTimeOut:20*ms_sec,levelLoadingMaxRetry:4};conf_get=conf_get||E.gconf_get;assign(ret,conf_get("loader.dailymotion.config")||{});return ret};E.get_size_name=function(width,height){if(!isFinite(width)||!isFinite(height))return"unknown";return Math.round(width/100)*100+"x"+Math.round(height/100)*100};E.get_width_name=function(width){return!isFinite(width)||width<=0?"width_unknown":width<300?"width_300":width<600?"width_600":width<900?"width_900":width<1200?"width_1200":"width_over_1200"};E.get_height_name=function(height){return!isFinite(height)||height<=0?"height_unknown":height<300?"height_300":height<600?"height_600":height<900?"height_900":height<1200?"height_1200":"height_over_1200"};E.get_top_name=function(){if(typeof window=="undefined")return;var ret={name:window.name};if(window.top!=window)try{ret.root_name=window.top.name}catch(e){}ret.name=ret.root_name||ret.name;return ret.name};E.get_top_url=function(loaded_in_debug){return E.get_location_urls(loaded_in_debug).top_url};E.get_location_urls=function(loaded_in_debug){if(typeof window=="undefined")return{};var ret={top_url:loaded_in_debug||location.href};if(window.top!=window){ret.referrer=document.referrer;ret.frame_url=location.href;try{ret.root_top_url=window.top.location.href}catch(e){}}ret.top_url=ret.root_top_url||ret.referrer||ret.top_url;return ret};E.referrer_type=function(url,ref,regex){if(!ref)return"none";var url_host=zurl.get_host(url),ref_host=zurl.get_host(ref);if(!url_host||!ref_host)return"invalid";return(regex?regex.test(ref_host):url_host==ref_host)?"internal":"external"};E.data_snapshot=function(data,fields){var past=zutil.clone_deep(data);fields=fields||Object.keys(data);return{diff:function(now){var res=zutil.clone_deep(now);fields.forEach(function(path){var val_past=zutil.get(past,path);var val_now=zutil.get(now,path);var val_res=typeof val_past=="number"&&typeof val_now=="number"?val_now-val_past:val_now;zutil.set(res,path,val_res)});return res}}};E.def_url2cache=function(_url){return _url.replace(/([^?#]+).*/,"$1")};E.clean_top_url=function(url){var fn=E.CG("transform.clean_top_url");if(typeof fn!="function")return url;return fn(url)};E.page2cache=function(url,zone){url=url.replace(/\/\/www\./,"//");if((!zone||!zone.is_agent)&&E.CG("transform.page2cache")){url=E.gconf_apply("transform.page2cache",[url,{mobile:E.is_mobile}],E.def_url2cache(url))}else if(zone)url=E.def_url2cache(url);return url.replace(/^((?:http|https):)?(\/\/)?/i,"http://")};E.def_page2domain=function(url){return url&&(zurl.parse(url).hostname||"").replace(/^www\./,"");
};E.page2domain=function(url){return E.gconf_apply("transform.page2domain",[url],E.def_page2domain(url))};E.page2link=function(url){return E.gconf_apply("transform.page2link",[url],url)};E.url2videotype=function(url){return E.gconf_apply("transform.url2videotype",[url])};E.player2offset=function(player){return E.gconf_apply("transform.player2offset",[player],0)};E.url2category=function(url){return E.gconf_apply("transform.url2category",[url])};E.show_url2category=function(url){return E.gconf_apply("transform.show_url2category",[url])||E.url2category(url)};E.url2lang=function(url){return E.gconf_apply("transform.url2lang",[url])};E.video2cache=function(url,zone){if((!zone||!zone.is_agent)&&E.CG("transform.url2cache")){url=E.gconf_apply("transform.url2cache",[url],E.def_url2cache(url))}else url=E.def_url2cache(url);return E.strip_hostname(url)};E.segment2cache=function(url){return E.strip_hostname(E.gconf_apply("transform.segment2cache",[url],E.def_url2cache(url)))};E.video2type=function(url){return E.gconf_apply("transform.video2type",[url],url)};E.game_title=function(url){return E.gconf_apply("transform.game_title",[url],function(u){return u.replace(/ -.*$/,"")})};E.url2sparkorigin=function(url){return E.gconf_apply("transform.url2sparkorigin",[url])};E.strip_hostname=function(url){return url.replace(/^(https?:)?\/\/([^\/]+)/,"")};E.err_ex=function(err,opt){var e=new Error(err);assign(e,opt);return e};E.parse_segment_url=function(s,opt){var url=zurl.parse(s);if(!opt.proxy)return url;var proxy_path_re=new RegExp(url.hostname+"/"+E.conf.customer+"/"+opt.zone+"/");var hola_param_re=/[?&]hola.*$/;var hola_playlist_re=/.*[?&]hola.*playlist=([^&]*).*/;var hola_manifest_re=/.*[?&]hola.*manifest=([^&]*)$/;url=zurl.parse(s.replace(proxy_path_re,"").replace(hola_param_re,""));var force=url.force_params={};if(hola_playlist_re.test(s))force.playlist=decodeURIComponent(s.replace(hola_playlist_re,"$1"));if(hola_manifest_re.test(s))force.manifest=decodeURIComponent(s.replace(hola_manifest_re,"$1"));return url};E.get_stylesheet=function(styles){var res=[];for(var selector in styles){var keys=Object.keys(styles[selector]).filter(function(key){return!!styles[selector][key]});var css=keys.map(function(key){return"    "+key+": "+styles[selector][key]+";\n"});if(css.length)res.push(selector+" {\n"+css.join("")+"}")}return res.join("\n")};E.stack_to_pprint=function(str){return str&&str.replace(/^Error/,"")};E.debounce=function(func,wait){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;func.apply(context,args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}};E.throttle=function(func,wait){var ctx,args,rtn,timeout;var last=0;var call=function(){timeout=null;last=new Date;rtn=func.apply(ctx,args);ctx=null;args=null};return function(){ctx=this;args=arguments;var delta=new Date-last;if(!timeout){if(delta>=wait)call();else timeout=setTimeout(call,wait-delta)}return rtn}};E.wrap_onclick=function(el,cb,opt){opt=opt||{};function get_touch_pos(e,coord){return e.changedTouches?e.changedTouches[0][coord]:e[coord]}function is_same_coord(c1,c2){return Math.abs(c1-c2)<10}function on_touchstart(e){ctx.starts=E.date_monotonic();ctx.startx=get_touch_pos(e,"pageX");ctx.starty=get_touch_pos(e,"pageY")}function on_touchend(e){var dur=E.ms_since(ctx.starts);var click_ival=opt.click_ival||{from:0,to:700};if(is_same_coord(ctx.startx,get_touch_pos(e,"pageX"))&&is_same_coord(ctx.starty,get_touch_pos(e,"pageY"))&&dur>click_ival.from&&dur<click_ival.to){cb(e)}}var ctx={};el.on("touchstart",on_touchstart);el.on("touchend",on_touchend);return function(){el.off("touchstart",on_touchstart);el.off("touchend",on_touchend)}};var script_timing={};E.get_script_timing=function(all){var timing_key=all?"all":"signle";if(script_timing[timing_key])return script_timing[timing_key];if(!window||!window.performance)return;var timing={};if(window.performance.timing){var t=window.performance.timing;timing.nav_start=t.navigationStart;timing.page_load_ms=t.domContentLoadedEventEnd-t.navigationStart;timing.win_load_ms=t.loadEventEnd-t.navigationStart}if(window.performance.now)timing.script_load_ms=window.performance.now();if(window.performance.getEntries){var host="//player[^.]*\\.h-cdn\\.com/";var scripts={small:"(loader_[^/]+\\.js|loader\\.js\\?.*customer=)",full:"loader\\.js\\?customer=[^&]+\\&no_conf=true\\&md5=",config:"config\\.js\\?customer=[^&]+\\&md5="};Object.keys(scripts).forEach(function(k){scripts[k]=new RegExp(host+scripts[k])});var results={};var entries=window.performance.getEntries();var get_result=function(e){var ret={};var check_set=function(key,value){if(value>=0&&value<2*ms_min)ret[key+"_ms"]=value};check_set("connect",e.connectEnd-e.connectStart);check_set("dns",e.domainLookupEnd-e.domainLookupStart);check_set("duration",e.duration);check_set("redirect",e.redirectEnd-e.redirectStart);check_set("response",e.responseEnd-e.responseStart);ret.response_end_ms=e.responseEnd;if(timing.script_load_ms&&ret.response_end_ms)ret.init_ms=timing.script_load_ms-ret.response_end_ms;if(!isFinite(ret.response_ms)||!isFinite(ret.duration_ms)||ret.response_ms>ret.duration_ms){return}if(ret.response_ms==0){Object.keys(ret).forEach(function(key){ret["cached_"+key]=ret[key];delete ret[key]})}return ret};for(var i=0;i<entries.length;i++){var e=entries[i];var name=scripts.full.test(e.name)&&!results.full?"full":scripts.config.test(e.name)&&!results.config?"config":scripts.small.test(e.name)&&!results.small?"small":null;if(!name)continue;results[name]=get_result(e);if(Object.keys(results).length==Object.keys(scripts).length)break}if(!results.full&&results.small){results.full=results.small;delete results.small}assign(timing,results.full);if(all){for(var r in results){for(var k in results[r])timing[r+"_"+k]=results[r][k]}}}return script_timing[timing_key]=timing};E.custom_fn=function(fn,args){if(typeof fn=="string"){try{fn=args?new Function(args,fn):new Function(fn)}catch(e){E.log.err("Invalid custom_fn: "+(e&&e.toString()))}}if(typeof fn!="function")return function(){};return function(){try{return fn.apply(null,arguments)}catch(e){E.log.err("Invalid custom_fn: "+(e&&e.toString()))}}};E.get_json=function(url,cb){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.onreadystatechange=function(){if(xhr.readyState!=xhr.DONE)return;if(xhr.status!=200)return cb({});var data;try{data=JSON.parse(xhr.responseText)}catch(e){cb({})}cb(data)};xhr.send()};E.is_item_allowed=function(rules,item){if(!rules||!item)return true;var include=rules.include||[];var exclude=rules.exclude||[];if(exclude.includes(item))return false;if(!include.length||include.includes(item))return true;return false};E.is_poster_allowed=function(url){return url&&!/^data:image|^blob:|^file:|\.h-cdn\.com\//i.test(url)&&!/[^a-z]logo[^a-z]|\.svg$|\.webp$/i.test(url)&&/\./.test(url)};E.date_monotonic=function(){var adjust=0,last=0;if(typeof window=="object"&&window.performance&&window.performance.now){adjust=Date.now()-window.performance.now();return function(){return window.performance.now()+adjust}}return function(){var now=Date.now()+adjust;if(now>=last)return last=now;adjust+=last-now;return last}}();function pad(num,size){return("000"+num).slice(-size)}E.date_ms_to_dur=function(_ms){var s="",sec=Math.floor(_ms/1e3);if(sec<0){s+="-";sec=-sec}var days=Math.floor(sec/(60*60*24));sec-=days*60*60*24;var hours=Math.floor(sec/(60*60));sec-=hours*60*60;var mins=Math.floor(sec/60);sec-=mins*60;if(days)s+=days+" "+(days>1?"Days":"Day")+" ";return s+pad(hours,2)+":"+pad(mins,2)+":"+pad(sec,2)};E.date_to_sql_ms=function(d){d=d===undefined?new Date:new Date(d);if(isNaN(d))return"0000-00-00 00:00:00.000";return pad(d.getUTCFullYear(),4)+"-"+pad(d.getUTCMonth()+1,2)+"-"+pad(d.getUTCDate(),2)+" "+pad(d.getUTCHours(),2)+":"+pad(d.getUTCMinutes(),2)+":"+pad(d.getUTCSeconds(),2)+"."+pad(d.getUTCMilliseconds(),3)};E.jdate_now=function(){var d=new Date;var months_short=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return(pad(d.getUTCDate(),2)+"-"+months_short[d.getUTCMonth()]+"-"+pad(d.getUTCFullYear()%100,2)+" "+pad(d.getUTCHours(),2)+":"+pad(d.getUTCMinutes(),2)+":"+pad(d.getUTCSeconds(),2)).replace(/( 00:00)?:00$/,"")};E.array_unique=function(a){var _a=[];for(var i=0;i<a.length;i++){if(!_a.includes(a[i]))_a.push(a[i])}return _a};E.array_rm_elm=function(a,elm){var i=a.indexOf(elm);if(i<0)return;a.splice(i,1);return elm};E.cmp_version=function(v1,v2){if(!v1||!v2)return+!!v1-+!!v2;var _v1=(""+v1).split("."),_v2=(""+v2).split("."),i;for(i=0;i<_v1.length&&i<_v2.length&&+_v1[i]==+_v2[i];i++);if(_v1.length==i||_v2.length==i)return _v1.length-_v2.length;return+_v1[i]-+_v2[i]};function fmt_per(per){if(!per)return"";switch(per){case"s":case"ms":return per;case"%":case"%%":return"%";default:return"/"+per[0]}}var _scale_vals={1e3:[{s:"",n:1},{s:"K",n:1e3},{s:"M",n:1e6},{s:"G",n:1e9},{s:"T",n:1e12},{s:"P",n:1e15}],1024:[{s:"",n:1},{s:"K",n:1024},{s:"M",n:Math.pow(1024,2)},{s:"G",n:Math.pow(1024,3)},{s:"T",n:Math.pow(1024,4)},{s:"P",n:Math.pow(1024,5)}]};E.scaled_number=function(num,opt){opt=opt||{};var sign="",per=opt.per,scale=opt.scale;var base=opt.base==1024?1024:1e3,ratio=opt.ratio||1;var units=opt.units===undefined||opt.units;function _per(){return per?fmt_per(per):""}if(num<0){sign="-";num=-num}if(num===undefined)return"";if(isNaN(num))return opt.nan||"x";if(num==Infinity)return sign+"";var scale_vals=_scale_vals[base],i=0;if(scale==null)for(;i<scale_vals.length-1&&num>=scale_vals[i+1].n*ratio;i++);else i=scale_vals.findIndex(function(_scale){return _scale.s==scale});if(per=="ms"&&i){per="s";i--;num=num/1e3}scale=scale_vals[i];if(opt.is_scale)return scale.n;num/=scale.n;if(num<.001)return"0"+_per();if(num>=base-1)num=Math.trunc(num);var str=num.toFixed(num<1?3:num<10?2:num<100?1:0);return sign+str.replace(/((\.\d*[1-9])|\.)0*$/,"$2")+(units?(opt.space?" ":"")+scale.s:"")+_per()};E.conv_str2bin=function(s,offset){var len;if(!s||!(len=s.length))return;offset=offset||0;var arr=new Uint8Array(len-offset);for(var i=offset,j=0;i<len;i++,j++)arr[j]=s.charCodeAt(i);return arr};E.str_longest=function(){var i,s;for(i=0;i<arguments.length;i++)s=(arguments[i]||"").length>(s||"").length?arguments[i]:s;return s};E.str_trunc=function(s,len){if(s.length<=len)return s;return s.slice(0,len)+"..."};function err_has_stack(err){return err instanceof Error&&err.stack}E.zerr_e2s=function(err){if(!is_node&&err_has_stack(err)){var e_str=""+err,e_stack=""+err.stack;return e_stack.startsWith(e_str)?e_stack:e_str+" "+e_stack}return err_has_stack(err)?""+err.stack:""+err};E.zerr_json=function(o,replacer,space){try{return JSON.stringify(o,replacer,space)||""}catch(e){return"[circular]"}};E.clone=zutil.clone;E.clone_deep=zutil.clone_deep;E.defaults=zutil.defaults;E.defaults_deep=zutil.defaults_deep;E.equal_deep=zutil.equal_deep;E.extend_deep=zutil.extend_deep;E.floor_mul=zutil.floor_mul;E.forEach=zutil.forEach;E.get=zutil.get;E.inherits=zutil.inherits;E.is_mocha=zutil.is_mocha;E.map_obj=zutil.map_obj;E.path=zutil.path;E.pick=zutil.pick;E.set=zutil.set;E.unset=zutil.unset;E.t={bin2json:bin2json,ws_onmessage:E.ws.prototype.onmessage};return E})})();
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else define=require("../../../util/require_node.js").define(module,"../");define("/svc/cdn/pub/log.js",["/util/util.js"],function(zutil){var E=log_cdn;E.type="cdn";var assign=Object.assign;var log_levels={no:0,crit:1,err:2,warn:3,notice:4,info:5,debug:6};function date_to_sql_ms(d){var _pad=function(num,size){return("000"+num).slice(-size)};d=d===undefined?new Date:new Date(d);if(isNaN(d))return"0000-00-00 00:00:00.000";return _pad(d.getUTCFullYear(),4)+"-"+_pad(d.getUTCMonth()+1,2)+"-"+_pad(d.getUTCDate(),2)+" "+_pad(d.getUTCHours(),2)+":"+_pad(d.getUTCMinutes(),2)+":"+_pad(d.getUTCSeconds(),2)+"."+_pad(d.getUTCMilliseconds(),3)}function level_to_console(level){switch(level){case"crit":return"error";case"err":return"error";case"warn":return"warn";case"notice":return"log";case"info":return"info";case"debug":return zutil.is_mocha()?"info":"debug";default:console.error("invalid level",level);return"error"}}function log(type,s,opt){opt=opt||{};var logs=opt.logs||E.get_logs(true);var msg=type+(opt.module&&opt.module!=opt.type?"/"+opt.module:"")+": "+s;var slevel=opt.level||"debug";var level=log_levels[slevel];var set_level=log_levels[E.settings.log_level||"notice"];var print=false;if(opt.console_log&&set_level>0)print=true;else if(level<=set_level){var mods=E.settings.log_modules;if(!opt.module||!mods)print=true;else if(mods&&(mods.includes(opt.module)||mods.includes("*")))print=true}var d=zutil.is_mocha()?E.zmocha_date||new Date:new Date;var _msg=date_to_sql_ms(d)+pad(logs.length,3)+" ["+(opt.id||0)+"] "+msg;if(print){var l=level_to_console(slevel);if(zutil.is_mocha()&&E.zmocha_test_log){E.zmocha_console=E.zmocha_console||[];E.zmocha_console.push(l+" "+_msg)}else console[l](_msg)}_msg={type:type,module:opt.module,msg:_msg,level:level};E.full_history.push(_msg);if(level<=Math.max(log_levels.info,set_level))logs.push(_msg);var max_full=E.settings.max_full_history_size||8192;var max_size=E.settings.max_size||2048;if(!E.debug_mode&&E.full_history.length>max_full)E.full_history.splice(0,max_full/2);if(!E.debug_mode&&logs.length>max_size)logs.splice(0,max_size/2)}function log_cdn(){var s;var opt={};try{var args=[].slice.call(arguments);if(typeof args[args.length-1]=="object")opt=args.pop();s=args[0];log(opt.type||E.type,s,opt)}catch(e){console.error("error in log_cdn",opt.type||E.type,s,e)}}function log_is(level){return log_levels[E.settings.log_level]>=log_levels[level]}function log_level_handler(opt,level){var level_opt=level=="console"?{console_log:true,level:"info"}:{level:level};return extend_opt.bind(E,assign({},opt,level_opt))}function extend_opt(def_opt){if(def_opt.muted)return;var args=[].slice.call(arguments,1);var opt={};if(typeof args[args.length-1]=="object")opt=assign({},args.pop());log_cdn.apply(this,args.concat(assign(opt,def_opt)))}function pad(num,size){return E.zmocha_pad||("000"+num).slice(-size)}function set(opt){E.settings=assign({},settings_def(),zutil.clone_deep(opt))}function settings_def(){return{log_level:"notice",max_size:2048,max_full_history_size:8192}}function Journal(opt){opt=opt||{logs:[]};opt.type=opt.type||E.type;assign(this,{crit:log_level_handler(opt,"crit"),err:log_level_handler(opt,"err"),warn:log_level_handler(opt,"warn"),notice:log_level_handler(opt,"notice"),info:log_level_handler(opt,"info"),debug:log_level_handler(opt,"debug"),console:log_level_handler(opt,"console"),set_type:function(type){return new Journal(assign({},opt,{type:type}))},set_module:function(module){return new Journal(assign({},opt,{module:module,type:opt.type}))},reset_module:function(){return this.set_module(null)},mute:function(){return new Journal(assign({},opt,{muted:true}))},unmute:function(){return new Journal(assign({},opt,{muted:false}))},get_logs:function(raw){return raw?opt.logs:opt.logs.map(function(l){return l&&l.msg||l})},reset_logs:function(){opt.logs.splice(0,opt.logs.length)},logs_to_str:function(logs,full_log){return E.logs_to_str(logs||opt.logs)},concat:function(logs,need_sort){return E.concat_logs(opt.logs,logs,need_sort)},fork:function(id){return new Journal(assign({},opt,{id:id,logs:opt.logs.slice()}))},stash:function(){var stash=opt.logs.slice();return function(){zutil.clone_inplace(opt.logs,stash)}},uninit:function(){this.reset_logs()}})}assign(E,new Journal);E.concat_logs=function(logs,logs2,need_sort){var combined_logs=(logs||[]).concat(logs2||[]);if(need_sort){combined_logs.sort(function(a,b){return(a&&a.msg||a).localeCompare(b&&b.msg||b)})}return combined_logs};E.filter_logs=function(logs,types,modules){types=typeof types=="string"?[types]:types&&types.slice();modules=typeof modules=="string"?[modules]:modules;return logs.filter(function(l){if(!l.type)return true;var match_type=types&&types.includes(l.type);var match_module=modules&&modules.includes(l.module);return(!types||match_type)&&(match_type&&!l.module||!modules||match_module)})};E.get_full_history=function(types,modules){return E.filter_logs(E.full_history,types,modules).map(function(l){return l.msg})};E.get_player_logs=function(){var set_level=log_levels[E.settings.log_level||"notice"];return E.filter_logs(E.full_history,"player").filter(function(l){return l.level<=Math.max(log_levels.info,set_level)}).map(function(l){return l.msg})};E.logs_to_str=function(logs,full_log){if(!logs)return"no logs";var size=E.settings.max_size/2;if(!full_log&&logs.length>size)logs=logs.slice(-size);logs=logs.map(function(l){return l&&l.msg||l});return logs.length?logs.join("\n")+"\n":"empty logs"};E.init=function(opt){set(opt)};E.full_history=[];E.settings=settings_def();E.t={level_to_console:level_to_console,log_is:log_is,set:set,settings_def:settings_def};return E})})();
define("/svc/cdn/pub/map.js",["/svc/cdn/pub/util.js","/svc/cdn/pub/log.js"],function(util,_log){var E={};var log=_log.set_module("map");E.Map=function(arg){this.ranges=[];this.sum=0;this.size=-1;this.last_ts=0;if(arg){if(typeof arg=="object"){var add_ranges=util.valid_ranges(arg.ranges)&&(!arg.cache_ranges||typeof arg.cache_ranges!="object"||util.valid_ranges(arg.cache_ranges));this.ranges=add_ranges?arg.ranges:[];this.cache_ranges=add_ranges?arg.cache_ranges:arg.cache_ranges?[]:undefined;this.sum=arg.sum;this.size=arg.size;if(arg.exclude_end)this.exclude_end=arg.exclude_end}else this.size=arg}};E.Map.prototype.reset=function(){this.ranges=[];this.cache_ranges=this.cache_ranges?[]:undefined;this.size=-1};E.Map.prototype.set_size=function(sz,force){if(this.size<0||force)this.size=sz;if(this.size!=sz)log.debug("map err size is "+this.size+" try to set size "+sz)};E.Map.prototype.get_date=function(from,to){var ts=this.date,c;if(c=this.get_cache_range(from,to))ts=c.date;return ts};E.Map.prototype.update=function(from,to,ts,info){if(this.size>=0&&to>=this.size){log.debug("map err update chunk.to "+to+" extends past map size "+this.size)}this.set_cache_range(from,to,ts,info);if(ts&&!this.date||ts>this.date)this.date=ts;this.sum+=to+(this.exclude_end?0:1)-from;this.ranges.push({from:from,to:to});this.last_ts=Date.now();if(!this.cache_ranges)this.info=info;this.compress()};E.Map.prototype.remove=function(from,to){if(this.size>=0&&to>=this.size){log.debug("map err remove chunk.to "+to+" extends past map size "+this.size)}var i,c;if(this.cache_ranges){if(!(c=this.get_cache_range(from,to)))return;util.array_rm_elm(this.cache_ranges,c)}var rm=[],add=[];for(i=0;i<this.ranges.length&&(to<0||this.ranges[i].from<=to);i++){var r=this.ranges[i];if(r.to<from)continue;else if(r.from>=from&&(to<0||r.to<=to))rm.push(r);else if(r.from<from&&r.to>to){add.push({from:to+1,to:r.to});r.to=from-1}else if(r.from<from)r.to=from-1;else if(r.to>=to)r.from=to+1}var _this=this;rm.forEach(function(r){util.array_rm_elm(_this.ranges,r)});add.forEach(function(r){_this.ranges.splice(0,0,r)});this.last_ts=Date.now();this.compress();this.summarize()};E.Map.prototype.get_cache_range=function(from,to){if(!this.cache_ranges)return;for(var i=0;i<this.cache_ranges.length&&(this.cache_ranges[i].from!=from||this.cache_ranges[i].to!=to);i++);return i<this.cache_ranges.length?this.cache_ranges[i]:null};E.Map.prototype.set_cache_range=function(from,to,ts,info){if(!this.cache_ranges)return;var c;if(!(c=this.get_cache_range(from,to)))this.cache_ranges.push({from:from,to:to,date:ts,info:info});else if(!c.date||c.date<ts){c.date=ts;c.info=info}};E.Map.prototype.merge=function(map){var _this=this;map.ranges.forEach(function(r){_this.ranges.push({from:r.from,to:r.to})});if(map.cache_ranges&&this.cache_ranges){map.cache_ranges.forEach(function(r){_this.set_cache_range(r.from,r.to,r.date,r.info)})}if(this.size<0)this.size=map.size;this.last_ts=Math.max(this.last_ts,map.last_ts);this.info=map.info;this.compress()};E.Map.prototype.next_unobtained=function(from,to){if(this.size>=0)to=to>=0?Math.min(to,this.size-1):this.size-1;var i;for(i=0;i<this.ranges.length&&(to<0||from<=to);i++){var c=this.ranges[i];if(c.to+1<from)continue;else if(from<c.from)break;else from=to<0?c.to+1:Math.min(c.to+1,to+1)}return to>=0&&from>to?null:{from:from,to:i==this.ranges.length?to:to<0?this.ranges[i].from-1:Math.min(to,this.ranges[i].from-1)}};E.Map.prototype.next_obtained=function(from,to){for(var i=0;i<this.ranges.length;i++){var c=this.ranges[i];if(c.to<from)continue;if(to>-1&&c.from>to)break;return{from:Math.max(c.from,from),to:to<0?c.to:Math.min(c.to,to),date:this.date,info:this.info}}return null};E.Map.prototype.next_obtained_exact=function(from,to){for(var i=0;i<this.cache_ranges.length;i++){var c=this.cache_ranges[i];if(c.from<from)continue;if(to>-1&&c.from>to)break;return{from:c.from,to:c.to,date:c.date,info:c.info,i:i}}return null};E.Map.prototype.summarize=function(){this.sum=0;this.ranges.forEach(function(r){this.sum+=r.to+(this.exclude_end?0:1)-r.from},this)};E.Map.prototype.compress=function(){this.ranges.sort(function(a,b){return a.from-b.from});if(this.cache_ranges)this.cache_ranges.sort(function(a,b){return a.from-b.from});var changed=1,changed_once=0;while(changed){changed=0;for(var i=this.ranges.length-1;i>=0;i--){if(!i||this.ranges[i-1].to+1<this.ranges[i].from)continue;this.ranges[i-1].to=Math.max(this.ranges[i].to,this.ranges[i-1].to);this.ranges.splice(i,1);changed=changed_once=1}}if(changed_once)this.summarize()};return E});
define("/svc/cdn/pub/storage.js",["/svc/cdn/pub/util.js","/util/events.js"],function(util,events){var E={};var spark,conf;var msg,ms_sec=1e3;var broadcast;function append_actions(from,to){from.forEach(function(a){var idx;if(to.find(function(a2,_idx){idx=_idx;return a2.type=="set"&&a.type=="set"&&util.equal_deep(a2.path,a.path)})){to[idx]=a}else to.push(a)})}function is_storage_active(storage_name){try{if(/bild.de/.test(location.host))return false;var _=window[storage_name];if(_.length)return true;_.setItem("_",0);_.removeItem("_");return true}catch(e){}}var storage_stub={setItem:function(){},getItem:function(){},removeItem:function(){}};var db={_storage:is_storage_active("localStorage")?window.localStorage:storage_stub,on_err:function(){},set:function(key,val){try{return this._storage.setItem(key,val)}catch(e){this.on_err("storage_set",key,e)}},get:function(key){try{return this._storage.getItem(key)}catch(e){this.on_err(e)}},get_int:function(key){return+this.get(key)||0},clr:function(key){try{this._storage.removeItem(key)}catch(e){this.on_err(e)}},set_json:function(key,val){try{return this.set(key,JSON.stringify(val||null))}catch(e){this.on_err(e)}},get_json:function(key){var val=this.get(key);if(!val)return val;try{val=JSON.parse(val)}catch(e){this.on_err(e)}return val}};var session_db={_storage:is_storage_active("sessionStorage")?window.sessionStorage:storage_stub,set:function(key,val){try{return this._storage.setItem(key,val)}catch(e){}},get:function(key){try{return this._storage.getItem(key)}catch(e){}}};function Broadcast(){this._handlers={};this._key="spark_tabs_broadcast";this._init()}Broadcast.prototype._init=function(){var _this=this;window.addEventListener("storage",function(event){if(event.key!=_this._key||!event.newValue)return;var _msg;try{_msg=JSON.parse(event.newValue)}catch(e){return}var handlers;if(!(handlers=_this._handlers[_msg.cmd]))return;for(var i=0;i<handlers.length;i++)handlers[i](_msg)})};Broadcast.prototype.on=function(cmd,cb){this._handlers[cmd]=this._handlers[cmd]||[];this._handlers[cmd].push(cb)};Broadcast.prototype.send=function(cmd,data){var _msg={cmd:cmd,data:data};var json;try{json=JSON.stringify(_msg);if(!json||!window||!window.localStorage)return;window.localStorage.setItem(this._key,json);window.localStorage.removeItem(this._key)}catch(e){}};util.inherits(Storage,events.EventEmitter);function Storage(name,parent,opt){var _this=this;this.name=name;this.opt=opt||{};this.opt.def=this.opt.def||{};this.actions=[];this.allocs=[];this.saved_actions=[];if(parent)return this._init_subsection(parent);if(broadcast){broadcast.on("storage_sync",function(_msg){_this._apply_actions(_msg.data);_this.sync()})}msg.add_top_handler("storage_sync",function(frame_idx,actions){_this._apply_actions(actions);_this.sync()});msg.add_top_handler("storage_get",function(){_this.sync();return db.get_json(_this.name)});if(!util.is_top)spark.on("set_top_url",this._init.bind(this));this._init()}Storage.prototype.alloc=function(path,opt){var s=new Storage(path,this,opt);this.allocs.push(s);return s};Storage.prototype.get=function(path){var o=util.get(this.o,path);return typeof o!="object"?o:this._cleanup(util.clone_deep(o))};Storage.prototype.get_parent=function(path){return this.parent?this.parent.get(path):undefined};Storage.prototype.push=function(path,v){this.actions.push({type:"push",path:(this.parent?util.path(this.name):[]).concat(util.path(path)),v:v});return this._push(path,v)};Storage.prototype.push_and_sync=function(path,v){var ret=this.push(path,v);this.sync();return ret};Storage.prototype.set=function(path,v){this.actions.push({type:"set",path:(this.parent?util.path(this.name):[]).concat(util.path(path)),v:v});return this._set(path,v)};Storage.prototype.set_and_sync=function(path,v){this.set(path,v);this.sync();return v};Storage.prototype.set_leaf_max_stale=function(path,max_stale){return this.set_max_stale(path,max_stale,true)};Storage.prototype.set_max_limit=function(path,max_limit){var o=this._get(path);if(!Array.isArray(o))o=this.set(path,[]);o.___limit=max_limit;this.sync()};Storage.prototype.set_max_stale=function(path,max_stale,leaf){var o=this._get(path);if(!o||o.constructor!=Object)o=this.set(path,{});var now=Date.now();if(leaf){if(o.___leaf_max_stale)return;o.___leaf_max_stale=max_stale;Object.keys(o).forEach(function(l){if(o[l]&&o[l].constructor==Object&&!o[l].___ts)o[l].___ts=now})}else{if(o.___max_stale)return;o.___max_stale=max_stale;o.___ts=now}this.sync()};Storage.prototype.size=function(path){var v=this.get(path);if(v===undefined)return 0;if(v.constructor==Object)return Object.keys(v).length;if(Array.isArray(v)||typeof v=="string")return v.length;if(typeof v=="number")return 1};Storage.prototype.splice=function(path,index,howmany){this.actions.push({type:"splice",path:(this.parent?util.path(this.name):[]).concat(util.path(path)),index:index,howmany:howmany,items:Array.from(arguments).slice(3)});return this._splice.apply(this,Array.from(arguments))};Storage.prototype.sync=function(){if(this.parent){append_actions(this.actions,this.parent.actions);this.actions=[];return this.parent.sync()}if(util.is_unfriendly_iframe){append_actions(this.actions,this.saved_actions);if(this.master_synced){msg.storage_sync(this.saved_actions);this.saved_actions=[]}}var diff,now=Date.now(),limit_arr=[];function scan(o,g,max_stale){var eq=util.equal_deep(o,g);diff=!eq||diff;if(o.___max_stale&&eq&&now-o.___ts>o.___max_stale*ms_sec)return true;if(max_stale&&eq&&o.___ts&&now-o.___ts>max_stale*ms_sec)return true;if(!eq&&(max_stale||o.___max_stale)){o.___ts=now;diff=true}if(o.constructor==Object){Object.keys(o).forEach(function(k){if(Array.isArray(o[k])&&o[k].___limit){if(o[k].length>o[k].___limit){o[k].splice(0,o[k].length-o[k].___limit);diff=true}limit_arr.push(o[k])}if(o[k]===undefined||o[k]==null||o[k].constructor!=Object)return;g[k]=g[k]||{};if(scan(o[k],g[k],o.___leaf_max_stale||max_stale)){o[k]=undefined;diff=true}})}}var o=this.o,orig=this.orig;if(util.is_unfriendly_iframe){o={};orig={}}if(scan(o,orig)){o=util.clone_deep(this.opt.def);diff=true}if(this.actions.length&&broadcast){if(util.is_mocha()&&this.send_broadcast)this.send_broadcast("storage_sync",this.actions);else broadcast.send("storage_sync",this.actions)}this.actions=[];if(diff){limit_arr.forEach(function(a){a.push({___limit:a.___limit})});db.set_json(this.name,o);limit_arr.forEach(function(a){a.splice(-1,1)});this.orig=util.clone_deep(this.o)}};Storage.prototype.unset=function(path){this.actions.push({type:"unset",path:(this.parent?util.path(this.name):[]).concat(util.path(path))});this._unset(path)};Storage.prototype.unset_and_sync=function(path){this.unset(path);this.sync()};Storage.prototype._apply_actions=function(actions){if(!actions)return;for(var i=0;i<actions.length;i++){var a=actions[i];switch(a.type){case"set":this._set(a.path,a.v);break;case"unset":this._unset(a.path);break;case"push":this._push(a.path,a.v);break;case"splice":this._splice.apply(this,[a.path,a.index,a.howmany].concat(a.items||[]));break}this.emit("storage_changed_"+a.path[0])}};Storage.prototype._cleanup=function(o){if(typeof o!="object"||o==null)return o;if(Array.isArray(o)){delete o.___limit;return o}for(var key in o){if(typeof o[key]=="object"){this._cleanup(o[key]);continue}if(key.substr(0,3)=="___")delete o[key]}return o};Storage.prototype._deserialize=function(o){if(typeof o.___ts==="string"&&isFinite(o.___ts))o.___ts=+o.___ts;for(var key in o){if(Array.isArray(o[key])&&o[key].length&&o[key][o[key].length-1]&&o[key][o[key].length-1].constructor==Object&&o[key][o[key].length-1].___limit){o[key].___limit=o[key][o[key].length-1].___limit;o[key].splice(-1,1)}if(o[key]&&o[key].constructor==Object)this._deserialize(o[key])}};Storage.prototype._get=function(path){return util.get(this.o,path)};Storage.prototype._init=function(){if(!this.o){this.o=db.get_json(this.name)||util.clone_deep(this.opt.def);this._deserialize(this.o);this.orig=util.clone_deep(this.o)}if(!util.is_unfriendly_iframe)return;var _this=this;var get_storage=function(){msg.storage_get_cb(function(o){if(!o)return;_this._deserialize(o);_this.master_synced=true;_this.prev=util.clone_deep(_this.o);_this.o=o;if(_this.prev.was_top)_this.o.was_top=_this.prev.was_top;_this.orig=util.clone_deep(_this.o);_this.allocs.forEach(function(s){s._init_subsection(_this);s._apply_actions.call(s.saved_actions)});_this.emit("master_synced")})};if(spark.has_master)return get_storage();msg.once("master_found",get_storage)};Storage.prototype._init_subsection=function(parent){this.parent=parent;if(!(this.o=util.get(this.parent.o,this.name))||typeof this.o!="object"){util.set(this.parent.o,this.name,util.clone_deep(this.opt.def));this.o=util.get(this.parent.o,this.name)}this.orig=util.clone_deep(this.o);this.master_synced=parent.master_synced;var _this=this;this.parent.on("storage_changed_"+this.name,function(){_this.emit("storage_changed")});if(util.is_unfriendly_iframe){this.prev=util.get(this.parent.prev,this.name,{});if(this.master_synced)this.emit("master_synced");else{parent.on("master_synced",function(){_this.master_synced=true;_this.emit("master_synced")})}}};Storage.prototype._push=function(path,v){var o=this._get(path);if(!Array.isArray(o))o=this.set(path,[]);return o.push(v)};Storage.prototype._set=function(path,v){util.set(this.o,path,v);if(v!==undefined&&v.constructor==Object){var p=util.path(path);var o=p.length>1?this._get(p.slice(0,-1)):this.o;if(o.___leaf_max_stale){p.push("___ts");util.set(this.o,p,Date.now())}}return v};Storage.prototype._splice=function(path,index,howmany){var o=this._get(path),args=Array.from(arguments).slice(1);return o.splice.apply(o,args)};Storage.prototype._unset=function(path){return util.unset(this.o,path)};E.db=db;E.session_db=session_db;E.is_stub=function(){return db._storage==storage_stub};E.disable=function(){db._storage=storage_stub;session_db._storage=storage_stub};E.init=function(_spark,_conf){spark=_spark;conf=_conf||{};msg=spark.msg;if(conf.disable)E.disable();else broadcast=new Broadcast;return new Storage("spark_web")};E.t={Broadcast:Broadcast,Storage:Storage};return E});
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else{var define_node=require("../../../util/require_node.js").define(module,"../");define=function(name,deps,fn){return define_node(name,["/util/escape.js"],fn)}}define("/svc/cdn/pub/ajax.js",["/util/escape.js","/svc/cdn/pub/util.js"],function(zescape,util){var assign=Object.assign;var sec_ms=1e3;var E={};var default_opt={method:"GET",url:null,headers:null,data_type:"text",data:null,qs:null,timeout:20*sec_ms,with_credentials:false,return_headers:false};var type_helpers={text:{setup:function(xhr){if(xhr instanceof XMLHttpRequest){xhr.setRequestHeader("Accept","text/*");xhr.responseType="text"}},extract:function(xhr){return xhr.responseText}},json:{setup:function(xhr){if(xhr instanceof XMLHttpRequest){xhr.setRequestHeader("Accept","application/json");xhr.responseType="text"}},extract:function(xhr){return JSON.parse(xhr.responseText)}}};function get_origin(location){if(location.origin)return location.origin;var default_ports={"http:":80,"https:":443};var port=location.port;if(default_ports[location.protocol]==port)port=null;return location.protocol+"//"+location.hostname+(port?":"+port:"")}var probe_link;function get_url_origin(url){probe_link=probe_link||document.createElement("a");probe_link.href=url;probe_link.href=probe_link.href;return get_origin(probe_link)}var can_use_xdr=typeof XDomainRequest=="function"&&!("withCredentials"in XMLHttpRequest.prototype);function is_current_origin(url){return is_node?false:window.location.origin==get_url_origin(url)}E.raw=function(opt,cb,cb_err){cb_err=cb_err||function(){};opt=assign({},default_opt,opt);var type_helper=type_helpers[opt.data_type];if(!type_helper){return cb_err({status:null,status_text:"Unknown data_type "+opt.data_type,response_text:null})}var req=can_use_xdr&&!is_current_origin(opt.url)?new XDomainRequest:new XMLHttpRequest;var timeout;var clean_wrapper=function(_cb){return function(res){req.onload=req.onerror=null;if(timeout)timeout=clearTimeout(timeout);if(_cb)_cb(res)}};cb=clean_wrapper(cb);cb_err=clean_wrapper(cb_err);var url=zescape.uri(opt.url,opt.qs);if(opt.timeout){timeout=setTimeout(function(){req.abort();cb_err({status:null,status_text:"timeout",response_text:null})},opt.timeout)}req.open(opt.method,url,true);type_helper.setup(req);if(opt.headers&&req.setRequestHeader){for(var header in opt.headers)req.setRequestHeader(header,opt.headers[header])}if(opt.with_credentials&&"withCredentials"in req)req.withCredentials=true;req.onload=function(){var status=req.status||200;if(status==1223)status=204;if(status>=200&&status<300){var res=type_helper.extract(req);if(opt.return_headers){return cb({res:res,headers:req.getAllResponseHeaders?req.getAllResponseHeaders():""})}return cb(res)}cb_err({status:status,status_text:req.statusText,response_text:req.responseText})};req.onerror=function(){cb_err({status:req.status,status_text:req.statusText,response_text:req.responseText})};var data=opt.data;if(data!=null){var type=opt.content_type||"application/x-www-form-urlencoded; charset=UTF-8";switch(typeof data){case"object":if(type=="application/json")data=JSON.stringify(data);else data=zescape.qs(data);break;case"string":data=zescape.uri_comp(data);break;default:data=data+""}if(req.setRequestHeader)req.setRequestHeader("Content-Type",type)}req.send(data)};E.json=function(opt,cb,cb_err){opt=assign({},opt,{data_type:"json"});E.raw(opt,cb,cb_err)};function msstream2bin(xhr,opt){var reader=new window.MSStreamReader;function cb(data,to){var ret={progress:opt.served,data:data,last_progress:util.date_monotonic()};opt.progress=opt.served;opt.served=to;opt.onreadystatechange(xhr,ret)}reader.onprogress=reader.onload=function(ev){update_xhr_progress(xhr,ev);var data=ev.target.result;var to=ev.loaded;if(opt.served!=to)cb(data.slice(opt.served,to),to)};reader.readAsArrayBuffer(xhr.response)}function str2bin(xhr,opt){var arr=util.conv_str2bin(xhr.response,opt.served||0);if(!arr)return;var ret={progress:opt.served,data:arr.buffer,last_progress:util.date_monotonic()};opt.progress=opt.served;opt.served=xhr.response.length;return ret}function update_xhr_progress(xhr,ev){if(ev.lengthComputable)xhr.total=ev.total;xhr.loaded=ev.loaded}E.fetch_bin=function(opt,cb){opt.onreadystatechange=opt.onreadystatechange||function(){};opt.onprogress=opt.onprogress||function(){};var url=zescape.uri(util.fix_url(opt.url));var fallback_wrapper=function(f){return opt.fallback_wrapper?opt.fallback_wrapper(f):f};if(opt.streaming)opt.progress=opt.served=0;var xhr=opt.XHR?new opt.XHR(opt.xhr_opt):new XMLHttpRequest;var fetch_info={url:url,opt:opt,xhr:xhr};var _catch=function(e){_finally({err:e})};var _finally=function(res){if(timeout)timeout=clearTimeout(timeout);opt.aborted=true;if(xhr.readyState<xhr.DONE)xhr.abort();cb(res);cb=function(){}};var timeout=setTimeout(function(){_catch("timeout")},opt.timeout||20*sec_ms);var response_handler=function(res){if(!res)return void _catch("failed fetch request");res.hdrs=util.get_resp_hdrs(xhr);if(!res.fullsize){var v;if(v=util.fullsize_from_xhr(xhr))res.fullsize=+v;else if(!opt.hrange&&(!opt.headers||!opt.headers.Range)){res.fullsize=!res.data?0:res.data.byteLength||res.data.length}}res.had_redirect=url!=xhr.responseURL;res.status=xhr.status;_finally(res)};if(opt.withCredentials)xhr.withCredentials=true;xhr.open(opt.method||(opt.data?"POST":"GET"),url,true);xhr.responseType=opt.response_type||"arraybuffer";xhr.onreadystatechange=fallback_wrapper(function(){if(!opt.streaming||xhr.readyState!=xhr.LOADING)opt.onreadystatechange(xhr)});xhr.onprogress=opt.onprogress;var headers=opt.headers||{};if(headers.Range&&util.browser.browser=="safari")headers["Cache-Control"]="no-store";if(opt.data){var type=opt.content_type||"application/json";if(!opt.no_content_type)headers["Content-Type"]=type;if(type=="application/json"&&typeof opt.data=="object")opt.data=JSON.stringify(opt.data)}for(var hdr in headers)xhr.setRequestHeader(hdr,headers[hdr]);function onload(ev){xhr.success=true;var res=xhr.response;if(opt.response_type=="json"&&xhr.responseType!="json")try{res=JSON.parse(res)}catch(e){}if(xhr.responseType=="ms-stream")res=null;response_handler({data:res,size:ev.total})}xhr.onload=fallback_wrapper(onload);xhr.onerror=function(e){_catch(e)};if(opt.streaming){var b=util.browser.browser,v=util.browser.version;if(b=="chrome"&&v>=7||b=="firefox"&&v>=9&&opt.streaming_text){xhr.responseType="text";xhr.overrideMimeType("text/plain; charset=x-user-defined");xhr.onprogress=fallback_wrapper(function(e){update_xhr_progress(xhr,e);opt.onprogress.call(xhr,e,str2bin(xhr,opt))})}else if((b=="edge"||b=="ie"&&v>=10)&&window.MSStreamReader){xhr.responseType="ms-stream";xhr.onreadystatechange=fallback_wrapper(function(){if(xhr.readyState==xhr.LOADING)msstream2bin(xhr,opt);else opt.onreadystatechange(xhr)})}else if(b=="firefox"&&v>=9){xhr.responseType="moz-chunked-arraybuffer";xhr.onprogress=fallback_wrapper(function(ev){var res=xhr.response;if(!res)return;update_xhr_progress(xhr,ev);opt.progress=opt.served;opt.served=opt.progress+res.byteLength;opt.onprogress.call(xhr,ev,{progress:opt.progress,data:res,last_progress:util.date_monotonic()})})}else opt.streaming=false}xhr.streaming=opt.streaming;xhr.send(opt.data);return fetch_info};E.uninit=function(){};return E})})();
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else define=require("../../../util/require_node.js").define(module,"../");define("/svc/cdn/pub/perr.js",["/util/util.js","/util/escape.js","/svc/cdn/pub/ajax.js","/svc/cdn/pub/log.js","/svc/cdn/pub/util.js"],function(zutil,zescape,ajax,_log,util){var assign=Object.assign;var ms_sec=1e3,ms_min=60*ms_sec,ms_hour=60*ms_min;var E=cdn_perr;var perrs=[];var def_perr_url="//perr.h-cdn.com/be_client_cgi/perr";var perr_url=def_perr_url;var perr_sent={};var perr_rl_hash={};var delayed_timer;var log=_log.set_module("perr");function JSON_stringify(obj){var pos_inf={__Infinity__:1};var neg_inf={__Infinity__:-1};function replace_inf(k,v){switch(v){case Infinity:return pos_inf;case-Infinity:return neg_inf;default:return v}}var s;try{s=JSON.stringify(obj,replace_inf)}finally{}return s}function build_info(){var b={platform:typeof navigator!="undefined"&&navigator.platform,user_agent:typeof navigator!="undefined"&&navigator.userAgent};b.ver=util.ver;b.browser=util.browser_string;b.browser_build=typeof window!="undefined"&&window.conf&&window.conf.browser&&window.conf.browser.name;b.guess=JSON.stringify(util.guess);return b}function build(){var info=build_info(),s="";for(var f in info)s+=(s&&"\n")+f+": "+info[f];return s}function to_form_data(o){var data=new FormData;zutil.forEach(o,function(v,k){data.append(k,v)});return data}function send_beacon(url,data){if(typeof navigator!="undefined"&&navigator.sendBeacon){data.send_type="BEACON";if(navigator.sendBeacon(url,to_form_data(data)))return;data.send_type=undefined}data.send_type="POST";ajax.raw({url:util.fix_url(url),data:data,method:"POST"})}function perr_delayed(opt){if(!zutil.get(util.conf,"loader.delayed_perrs_enable")&&!zutil.get(util.conf,"loader.delayed_perrs_filterin",[]).includes(opt.id)){return}perrs.push(opt);if(delayed_timer)return;delayed_timer=setTimeout(send_delayed_perrs,5*ms_sec)}function send_delayed_perrs(){delayed_timer=clearTimeout(delayed_timer);if(!perrs.length)return;if(!util.is_beforeunload&&!util.is_hidden){var can_send=true;var wrappers=zutil.get(util.loader,"wrapper",[]);wrappers.forEach(function(w){if(!can_send||!w.player||!w.player.is_playing())return;var b=w.player.get_current_buffer();if(b.to-b.from>20)return;can_send=false});if(!can_send)delayed_timer=setTimeout(send_delayed_perrs,5*ms_sec)}var max=25,_perrs=perrs.slice(0,max);perrs=perrs.slice(max);cdn_perr({id:"delayed_perrs",delay:false,delayed_perrs:_perrs});if(perrs.length)delayed_timer=setTimeout(send_delayed_perrs,ms_sec)}function perr_raw(opt){if(opt.customer=="bild"||/bild\.de/.test(location.host))return;var data={},qs={},delayed=opt.delay===undefined||!!opt.delay;data.info=opt.info;data.bt=opt.bt;data.filehead=opt.filehead;if(opt.delayed_perrs)data.delayed_perrs=JSON.stringify(opt.delayed_perrs);qs.id=opt.id;qs.browser=opt.browser||(util.browser.opera?"opera":util.browser.ucbrowser?"ucbrowser":util.browser.samsung_browser?"samsung":util.browser.browser);qs.browser_ver=util.browser.version;qs.customer=opt.customer;if(opt.tag){qs.tag_id=opt.tag.id;qs.tag_date=+opt.tag.date}if(opt.zone)qs.zone=opt.zone;data.is_json=1;if(delayed&&!+util.get_spark_uri("hola_no_perr_delay")){assign(data,qs);perr_delayed(data);return}data.ver=util.ver;data.build=build();var url=(opt.perr_url||perr_url)+"?"+zescape.qs(qs);if(opt.use_beacon)return void send_beacon(url,data);data.send_type="POST";ajax.raw({url:util.fix_url(url),data:data,method:"POST"})}function rate_limit(rl,ms,n){var now=Date.now();if(!rl.count||rl.ts+ms<now){rl.count=1;rl.ts=now;return true}rl.count++;return rl.count<=n}function perr_rate_limit(opt){if(opt.rate_limit===false)return true;var _rl=assign({ms:ms_hour,count:10},opt.rate_limit);var id=opt.id,rl=perr_rl_hash[id]=perr_rl_hash[id]||{};var ret=rate_limit(rl,_rl.ms,_rl.count);if(!ret){var key="perr_rate_limit_"+id;if(!perr_sent[key])cdn_perr({id:"perr_rate_limit",info:id,rate_limit:false});perr_sent[key]=1}return ret}function db_perr(opt){opt=opt||{};var id=opt.id;if(opt.throttle&&!opt.force&&(opt.throttle>=1&&(perr_sent[id]||0)>=opt.throttle||opt.throttle<1&&Math.random()>opt.throttle)){return}perr_rate_limit(opt);var data=opt.data||{};data.sent=data.sent||{};var info=typeof opt.info!="object"?{_info:opt.info}:opt.info;var customer,zone=opt.zone||{};if(!info.customer&&(customer=util.conf.customer))info.customer=customer;if(!info.zone&&zone.name)info.zone=zone.name;if(!info.method&&zone.method)info.method=zone.method;info.hola_mode=info.hola_mode||zone.mode;info.skip=zone.skip;info.dashboard=";type="+(zone.stream_type||"unknown")+(zone.player_type?";player="+zone.player_type:"")+(zone.tech?";tech="+zone.tech:"");var url_frame=util.get_location_urls();var url=data.url||opt.url||url_frame.top_url;var match=url?url.match(/^http(s)?:\/\/(www\.)?([a-zA-Z0-9-.]+)\/.*$/):null;info.url=url;info.frame=!!url_frame.frame_url;info.location_url=url_frame.frame_url||url_frame.top_url;if(!info.page_url)info.page_url=url_frame.top_url;info.site=match?match[3]:"unknown";info.referrer=typeof document!="undefined"&&document.referrer;info.referrer_type=util.referrer_type(info.location_url,info.referrer,util.gconf_get("loader.referrer_internal_regex"));assign(info,opt.extra,{file:data.file,link:data.link,err:opt.err||info.err});info.is_embed=typeof window!="undefined"&&window.top&&window.top!==window;info.is_touch=typeof document!="undefined"&&"ontouchstart"in document.documentElement;if(util.mvp_marker!=null)info.mvp_marker=util.mvp_marker;info.support_fullscreen=util.browser_support_fullscreen;var nc;if(typeof navigator!="undefined"&&(nc=navigator.connection))info.connection={type:nc.type,downlink_max:nc.downlinkMax};if(zone.bwsaver)info.bw_saving=zone.bwsaver;if(zone.video_url&&!info.video_url)info.video_url=zone.video_url;if(zone.video_live&&info.video_live===undefined)info.video_live=zone.video_live;if(zone.player_info)info.player_info=zone.player_info;if(util.is_beforeunload)info.before_unload=true;perr_sent[id]=perr_sent[id]+1||1;info.tag=zutil.get(util.loader,"tag");info.injected=util.loader&&util.loader.CG("loader.injected");info.analysis_tag=opt.analysis_tag;var info_str;try{info_str=JSON_stringify(info)}catch(e){info_str="[circular]"}perr_raw({tag:info.tag,id:opt.prefix+id,info:info_str,customer:customer,zone:zone.name,bt:opt.bt,browser:opt.browser,filehead:opt.filehead,use_beacon:opt.use_beacon,perr_url:perr_url,delay:opt.delay,delayed_perrs:opt.delayed_perrs})}var skip_perr=false;function cdn_perr(opt){if(skip_perr)return;opt.filehead=opt.filehead?opt.filehead+"\n\n":"";if(opt.add_log){var logs;if(opt.full)logs=_log.get_full_history();else{var log_types=opt.log_types||"cdn";var log_obj=opt.log_obj||(opt.zone?opt.zone.log:_log);logs=_log.filter_logs(log_obj.get_logs(true),log_types,opt.log_modules);logs=_log.concat_logs(logs,_log.get_player_logs(),true)}if(opt.player_logs)logs=_log.concat_logs(logs,opt.player_logs,true);opt.filehead+=_log.logs_to_str(logs,opt.full||opt.full_log)}else opt.filehead+="no log requested";return db_perr(assign(opt,{prefix:"www_cdn_db_"}))}var inited=false;E.init=function(_perr_url){if(inited)return;inited=true;var proto=zutil.get(util.conf,"loader.https_xhr_only")?"https:":"";perr_url=_perr_url||proto+def_perr_url;perr_sent={};perr_rl_hash={};util._events.on("beforeunload",uninit);util._events.on("visible_state",send_delayed_perrs);util._events.on("hidden_state",send_delayed_perrs);util._events.on("uninit",uninit)};function uninit(){send_delayed_perrs();util._events.off("beforeunload",uninit);util._events.off("visible_state",send_delayed_perrs);util._events.off("hidden_state",send_delayed_perrs);util._events.off("uninit",uninit)}E.try_wrapper=function(opt,func){if(typeof opt=="function"){func=opt;opt={}}var throttle=opt.throttle||5;var prefix=opt.prefix||"perr";return function(){try{return func.apply(this,arguments)}catch(e){console.error("error in perr %o",e);if(opt.silent)return;cdn_perr({id:prefix+"_try_wrapper_err",err:e.message,throttle:throttle,delay:false,bt:e.stack,opt:opt});if(log)log.err(prefix+"_try_wrapper_err "+e+" "+e.stack)}}};E.t={disable:function(){skip_perr=true},enable:function(){skip_perr=false}};return E})})();
define("/svc/cdn/pub/cache.js",{__stub:1});
(function(){var __hola_stub_define;var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/rand.js",[],function(){var E={};var is_jtest=false;var jtest_vals={};var MAX_INT=2147483647;var MIN_INT=-MAX_INT-1;function jtest_pop(s){var elm;if(s===undefined)return null;if((elm=jtest_vals[s])===undefined)return null;return elm.shift()}E.rand=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.random()};E.rand_int32=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(MAX_INT-MIN_INT+1))-MAX_INT};E.rand_range=function(from,to,s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(to-from))+from};E.rand_element=function(a,s){if(a.length)return a[E.rand_range(0,a.length,s)]};E.rand_subset=function(a,size,s){var shuffled=a.slice(0);for(var i=0;i<size;i++){var j=E.rand_range(i,shuffled.length,s);var tmp=shuffled[j];shuffled[j]=shuffled[i];shuffled[i]=tmp}return shuffled.slice(0,size)};E.jtest_push=function(s,arr){if(!jtest_vals[s])jtest_vals[s]=[];if(Array.isArray(arr))jtest_vals[s].push.apply(jtest_vals[s],arr);else jtest_vals[s].push(arr)};E.jtest_init=function(){is_jtest=true;jtest_vals={}};E.jtest_uninit=function(){is_jtest=false};E.basic_u32=function(v){return 1103515245*v+12345>>>0};E.basic_u31=function(v){return 1103515245*v+12345&2147483647};return E})})();
(function(){var __hola_stub_define;var is_node_ff=typeof module=="object"&&module.exports;if(!is_node_ff)define=define||self.define;else define=require("./require_node.js").define(module,"../");define("/util/hash.js",[],function(){var E={};function imul64h(a,b){var ah=a>>>16&65535;var al=a&65535;var bh=b>>>16&65535;var bl=b&65535;return ah*bh+(ah*bl+al*bh)>>16|0}E.hash_int=function(val){var xh=imul64h(val,1103515245);var xl=Math.imul(val,1103515245);return xl-xh>>>0};E.hash_string=function(s){if(!s.length)return 0;var hash=E.hash_int(s.length);for(var i=0;i<s.length;i+=2){hash=E.hash_int(hash+(s.charCodeAt(i)<<16)+(s.charCodeAt(i+1)|0)>>>0)}return hash};E.sum_parse=function(str){var parts=/([0-9a-f]+)\s+([ *]?)(.*)/i.exec(str);if(!parts)return null;return{hash:parts[1],type:parts[2]=="*"?"binary":"text",file:parts[3]}};return E})})();
!function(n){function t(n,t){var r=(65535&n)+(65535&t),e=(n>>16)+(t>>16)+(r>>16);return e<<16|65535&r}function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}function i(n,r){n[r>>5]|=128<<r%32,n[(r+64>>>9<<4)+14]=r;var e,i,a,h,d,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e<n.length;e+=16)i=l,a=g,h=v,d=m,l=o(l,g,v,m,n[e],7,-680876936),m=o(m,l,g,v,n[e+1],12,-389564586),v=o(v,m,l,g,n[e+2],17,606105819),g=o(g,v,m,l,n[e+3],22,-1044525330),l=o(l,g,v,m,n[e+4],7,-176418897),m=o(m,l,g,v,n[e+5],12,1200080426),v=o(v,m,l,g,n[e+6],17,-1473231341),g=o(g,v,m,l,n[e+7],22,-45705983),l=o(l,g,v,m,n[e+8],7,1770035416),m=o(m,l,g,v,n[e+9],12,-1958414417),v=o(v,m,l,g,n[e+10],17,-42063),g=o(g,v,m,l,n[e+11],22,-1990404162),l=o(l,g,v,m,n[e+12],7,1804603682),m=o(m,l,g,v,n[e+13],12,-40341101),v=o(v,m,l,g,n[e+14],17,-1502002290),g=o(g,v,m,l,n[e+15],22,1236535329),l=u(l,g,v,m,n[e+1],5,-165796510),m=u(m,l,g,v,n[e+6],9,-1069501632),v=u(v,m,l,g,n[e+11],14,643717713),g=u(g,v,m,l,n[e],20,-373897302),l=u(l,g,v,m,n[e+5],5,-701558691),m=u(m,l,g,v,n[e+10],9,38016083),v=u(v,m,l,g,n[e+15],14,-660478335),g=u(g,v,m,l,n[e+4],20,-405537848),l=u(l,g,v,m,n[e+9],5,568446438),m=u(m,l,g,v,n[e+14],9,-1019803690),v=u(v,m,l,g,n[e+3],14,-187363961),g=u(g,v,m,l,n[e+8],20,1163531501),l=u(l,g,v,m,n[e+13],5,-1444681467),m=u(m,l,g,v,n[e+2],9,-51403784),v=u(v,m,l,g,n[e+7],14,1735328473),g=u(g,v,m,l,n[e+12],20,-1926607734),l=c(l,g,v,m,n[e+5],4,-378558),m=c(m,l,g,v,n[e+8],11,-2022574463),v=c(v,m,l,g,n[e+11],16,1839030562),g=c(g,v,m,l,n[e+14],23,-35309556),l=c(l,g,v,m,n[e+1],4,-1530992060),m=c(m,l,g,v,n[e+4],11,1272893353),v=c(v,m,l,g,n[e+7],16,-155497632),g=c(g,v,m,l,n[e+10],23,-1094730640),l=c(l,g,v,m,n[e+13],4,681279174),m=c(m,l,g,v,n[e],11,-358537222),v=c(v,m,l,g,n[e+3],16,-722521979),g=c(g,v,m,l,n[e+6],23,76029189),l=c(l,g,v,m,n[e+9],4,-640364487),m=c(m,l,g,v,n[e+12],11,-421815835),v=c(v,m,l,g,n[e+15],16,530742520),g=c(g,v,m,l,n[e+2],23,-995338651),l=f(l,g,v,m,n[e],6,-198630844),m=f(m,l,g,v,n[e+7],10,1126891415),v=f(v,m,l,g,n[e+14],15,-1416354905),g=f(g,v,m,l,n[e+5],21,-57434055),l=f(l,g,v,m,n[e+12],6,1700485571),m=f(m,l,g,v,n[e+3],10,-1894986606),v=f(v,m,l,g,n[e+10],15,-1051523),g=f(g,v,m,l,n[e+1],21,-2054922799),l=f(l,g,v,m,n[e+8],6,1873313359),m=f(m,l,g,v,n[e+15],10,-30611744),v=f(v,m,l,g,n[e+6],15,-1560198380),g=f(g,v,m,l,n[e+13],21,1309151649),l=f(l,g,v,m,n[e+4],6,-145523070),m=f(m,l,g,v,n[e+11],10,-1120210379),v=f(v,m,l,g,n[e+2],15,718787259),g=f(g,v,m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,h),m=t(m,d);return[l,g,v,m]}function a(n){var t,r="";for(t=0;t<32*n.length;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}function h(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;for(t=0;t<8*n.length;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}function d(n){return a(i(h(n),8*n.length))}function l(n,t){var r,e,o=h(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;16>r;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(h(t)),512+8*t.length),a(i(c.concat(e),640))}function g(n){var t,r,e="0123456789abcdef",o="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),o+=e.charAt(t>>>4&15)+e.charAt(15&t);return o}function v(n){return unescape(encodeURIComponent(n))}function m(n){return d(v(n))}function p(n){return g(m(n))}function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}"function"==typeof define&&define.amd?define("md5",[],function(){return A}):"object"==typeof module&&module.exports?module.exports=A:n.md5=A}(this);
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else{var define_node=require("../../../util/require_node.js").define(module,"../");var zutil=require("../../../util/util.js");var md5=zutil.is_mocha()&&"/svc/cdn/pub/md5.min.js";define=function(name,deps,fn){return define_node(name,["/svc/cdn/pub/util.js","/util/rand.js",null,md5],fn)}}define("/svc/cdn/pub/cdn_util.js",["/svc/cdn/pub/util.js","/util/rand.js","/svc/cdn/pub/storage.js","md5"],function(util,rand,storage,md5){var E={};var assign=Object.assign;E.get_random=function(salt){var key="hola_random_"+salt;var force=+util.get_spark_uri(key,false);if(force)return force;if(util.gconf_get("loader.real_random")){var saved=storage.db.get_int(key);if(saved)return saved;var random=rand.rand("random_from_storage");storage.db.set(key,random);return random}E.get_random.salt=E.get_random.salt||{};var ip=util.geoip&&util.geoip.ip;if(E.get_random.salt[salt])return E.get_random.salt[salt];if(!ip){if(!E.get_random.salt[salt])E.get_random.salt[salt]=rand.rand("random_by_ip")}else{E.get_random.salt[salt]=parseInt(md5(ip+salt).slice(-4),16)/Math.pow(2,16)}return E.get_random.salt[salt]};E.set_geoip=function(data){if(!data)return;util.geoip=util.clone(data);util.geoip.ver=util.conf.ver;for(var i in util.geoip){if(typeof util.geoip[i]=="string")util.geoip[i]=util.geoip[i].toLowerCase()}if(data.date)util.geoip.date_skew=new Date(util.jdate_now())-new Date(data.date);util.geoip.update=util.jdate_now();storage.db.set_json("hola_geoip",util.geoip);util._events.emit("set_geoip",util.geoip)};E.log_report=function(opt){var bws=opt.video_ctx&&opt.video_ctx.attached_bws;var stats=opt.video_ctx&&opt.video_ctx.attached_stats;if(!opt.zone&&!bws&&!stats||!opt.id)return;if(!opt.add_unittest&&!opt.add_log&&!opt.load_perf&&!opt.exception)return;var zone=(bws||stats||opt).zone;if(!zone)return;var zperr=zone.perr_get();var o={id:opt.id+"_report",delay:false,info:{only_stats:!bws},extra:assign({},opt.extra,!opt.exception&&stats&&stats.get_stats_all()),use_beacon:true,add_log:opt.add_log,log_types:opt.log_types,log_modules:opt.log_modules,analysis_tag:opt.analysis_tag,log_obj:opt.log_obj,full:opt.full,player_logs:opt.player_logs};if(zone.CG("log.full"))o.full=true;if(opt.add_unittest&&bws)o.filehead="last test:\n"+bws.unittest.gen_test();if(bws&&bws.serve_log_arr.length)o.info.serve_log=bws.serve_log_arr;if(opt.load_perf){o.filehead=(o.filehead?o.filehead+"\n":"")+"Load perf:\n";o.filehead+=opt.load_perf;o.info.load_perf=true}if(opt.exception)o.info.exception=opt.exception;zperr(o)};return E})})();
define("json_stable_stringify",[],function(){var json=JSON;var E=function(obj,opts){if(!opts)opts={};if(typeof opts==="function")opts={cmp:opts};var space=opts.space||"";if(typeof space==="number")space=Array(space+1).join(" ");var cycles=typeof opts.cycles==="boolean"?opts.cycles:false;var replacer=opts.replacer||function(key,value){return value};var cmp=opts.cmp&&function(f){return function(node){return function(a,b){var aobj={key:a,value:node[a]};var bobj={key:b,value:node[b]};return f(aobj,bobj)}}}(opts.cmp);var seen=[];return function stringify(parent,key,node,level){var indent=space?"\n"+new Array(level+1).join(space):"";var colonSeparator=space?": ":":";if(node&&node.toJSON&&typeof node.toJSON==="function"){node=node.toJSON()}node=replacer.call(parent,key,node);if(node===undefined){return}if(typeof node!=="object"||node===null){return json.stringify(node)}if(Array.isArray(node)){var out=[];for(var i=0;i<node.length;i++){var item=stringify(node,i,node[i],level+1)||json.stringify(null);out.push(indent+space+item)}return"["+out.join(",")+indent+"]"}else{if(seen.indexOf(node)!==-1){if(cycles)return json.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}else seen.push(node);var keys=Object.keys(node).sort(cmp&&cmp(node));var out=[];for(var i=0;i<keys.length;i++){var key=keys[i];var value=stringify(node,key,node[key],level+1);if(!value)continue;var keyValue=json.stringify(key)+colonSeparator+value;out.push(indent+space+keyValue)}seen.splice(seen.indexOf(node),1);return"{"+out.join(",")+indent+"}"}}({"":obj},"",obj,0)};return E});
define("/svc/cdn/pub/zone_match.js",{__stub:1});
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else{var define_node=require("../../../util/require_node.js").define(module,"../");define=function(name,deps,fn){return define_node(name,["/util/util.js",null,"/svc/cdn/pub/util.js",null,null,null],fn)}}define("/svc/cdn/pub/zone.js",["/util/util.js","/svc/cdn/pub/zone_match.js","/svc/cdn/pub/util.js","/svc/cdn/pub/log.js","/svc/cdn/pub/perr.js","/svc/cdn/pub/cdn_util.js","/svc/cdn/pub/storage.js"],function(zutil,zone_match,util,_log,perr,cdn_util,storage){var E=Zone,assign=Object.assign;var random;function reset_random(set){random=set||undefined}function select_zone(zones,opt){function storage_zone(){try{return storage.session_db.get("hola_zone")||storage.db.get("hola_zone")}catch(e){}}function is_selected(zone){var match=zone.loader?zone.loader.match:zone.match;if(!match||!Object.keys(match).length||zone.kw.disabled||zone.kw.hidden){return}var geoip=util.geoip||{};var current_date=typeof geoip.date_skew=="number"?new Date(Date.now()-geoip.date_skew):null;rand_percent+=match.rand||0;random=random||cdn_util.get_random("zone");var match_opt=assign({url:opt.top_url,browser:util.browser_rule_s,os:util.guess.os,version:util.guess.version,random:random,rand_percent:rand_percent,date:current_date,video_url:opt.video_url,frame_url:opt.frame_url,no_mse:opt.no_mse,no_h264:opt.no_h264,player_n:opt.player_n,video_check_n:opt.video_check_n,player:opt.player},geoip);var matched=false;if(!match.js){match.zone=zone.zone;match.rules=zone.loader&&zone.loader.rules;match.js=zone_match.make_fn(match)}try{var match_fn=new Function("opt",match.js);matched=match_fn(match_opt)}catch(e){_log.err(e.stack||""+e)}if(matched)return zone}var uri_zone=util.get_spark_uri(opt.location||location,"hola_zone");var rand_percent=0,name;if(uri_zone)return uri_zone;if(name=storage_zone())return name;return(zutil.find(zones,is_selected)||{zone:"gen"}).zone}function check_h264(){var type='video/mp4; codecs="avc1.42E01E"';var ms=window.MediaSource;if(ms&&ms.isTypeSupported)return ms.isTypeSupported(type);if(window.hola_cdn_sdk||window.spark_ios_sdk)return true;var el=document.createElement("video");return el.canPlayType&&(el.canPlayType(type)||el.canPlayType(type+', mp4a.40.2"'))}function get_zone_opt(loader){var jtest_location=loader.jtest&&loader.jtest.location;if(jtest_location)return{location:jtest_location,top_url:jtest_location.href};var loaded_in_debug=util.get_spark_uri("hola_debug");var url_frame=util.get_location_urls(loaded_in_debug);return{top_url:url_frame.top_url,frame_url:url_frame.frame_url,no_mse:!window.MediaSource,no_h264:!check_h264()}}Zone.prototype.log_get=function(){return this.log};Zone.prototype.perr_get=function(){var _this=this;return function(opt){opt.zone=assign({},_this.info);opt.zone.name=_this.name;opt.zone.mode=_this.CG("mode");opt.zone.skip=_this.CG("skip");if(opt.add_log)opt.zone.log=_this.log;perr(opt)}};Zone.prototype.conf_set=function(path,val,opt){util.conf_set(this.conf,path,val);if(opt&&opt.reconf)this.reconf();return val};Zone.prototype.conf_mvp=function(path){var percent;if(!(percent=this.conf_get(path+"_mvp"))||util.mvp_marker!=null)return;random=random||cdn_util.get_random("zone");if(random>percent/100)return util.mvp_marker=0;this.conf_set(path,util.mvp_marker=1)};Zone.prototype.conf_get=function(path,def){return util.conf_get(this.conf,path,def)};Zone.prototype.conf_get_json=function(path,def){var s=this.conf_get(path,def);if(!s||typeof s=="object")return s;try{return JSON.parse(s)}catch(e){}};Zone.prototype.conf_enable=function(path){this.conf_set(path,true)};Zone.prototype.conf_disable=function(path){this.conf_set(path,false)};Zone.prototype.conf_have=function(path){return this.conf_get(path)!==undefined};Zone.prototype.conf_test_disable=function(path){if(!this.conf_get(path))return false;this.conf_disable(path);return true};Zone.prototype.conf_apply=function(path,args,def,_this,throw_ex){return util.conf_apply(this.conf,path,args,def,_this,throw_ex)};var aliases={CG:"conf_get",CGJ:"conf_get_json",CS:"conf_set",CE:"conf_enable",CD:"conf_disable",CH:"conf_have",CTD:"conf_test_disable",CMVP:"conf_mvp"};for(var k in aliases)Zone.prototype[k]=Zone.prototype[aliases[k]];Zone.prototype.init=function(conf){this.conf=zutil.extend_deep(conf||{},this._get_dbg_conf(),util.get_uri_conf())};Zone.prototype._get_dbg_conf=function(){return this.loader&&this.loader.get_dbg_conf&&this.loader.get_dbg_conf()||{}};Zone.prototype.uninit=function(){this.inited=false;this.conf={};this.info={}};Zone.prototype.stash=function(){var _this=this;var stash={conf:zutil.clone_deep(this.conf),info:zutil.clone_deep(this.info),name:this.name};return function(){assign(_this,stash);_this.reconf()}};Zone.prototype.customer_conf_get=function(){var _this=this,zones=this.loader.get_zones();var predicate=function(z){return z.zone==_this.name};return this.name=="gen"?zones.gen:zutil.find(zones.zones,predicate)};Zone.prototype.zone_init=function(opt){if(!util.geoip||!util.geoip.country){if(this.loader&&this.loader.loader_conf&&this.loader.loader_conf.geoip_fallback){cdn_util.set_geoip(this.loader.loader_conf.geoip_fallback)}}var zones=this.loader.get_zones();this.name=opt.force_zone?opt.force_zone:select_zone(zones.zones,assign({},opt,get_zone_opt(this.loader)));this.conf=zutil.extend_deep({zone:this.name},zutil.clone_deep(util.conf),zutil.clone_deep(this.customer_conf_get()),this._get_dbg_conf(),util.get_uri_conf());this.inited=true;this.reconf()};function watch_reconf(watch,zone_conf,is_init){var val={},old_val=watch.value,opt=watch.opt,path=opt.conf;if(typeof path=="string")val=zutil.get(zone_conf,path,opt.defval);else{if(!watch.hasOwnProperty("value"))old_val={};Object.keys(path).forEach(function(name){if(zutil.has(zone_conf,path[name]))val[name]=zutil.get(zone_conf,path[name])});val=assign({},opt.defval,val)}if(watch.opt.ontoggle&&(is_init||val!=old_val))watch.opt.ontoggle(watch.ctx,val);else if(watch.opt.onchange&&(is_init||!zutil.equal_deep(old_val,val)))watch.opt.onchange(watch.ctx,old_val,val);watch.value=val}Zone.prototype.conf_watch=function(watches){var _this=this;if(!(watches instanceof Array))watches=[watches];watches.forEach(function(w){var zw={opt:w,ctx:{}};watch_reconf(zw,_this.conf,true);_this.watches.push(zw)});return{uninit:function(){watches.forEach(function(w){var zw=_this.watches.find(function(zw){return zw.opt==w});if(zw.opt.uninit)zw.opt.uninit(zw.ctx,zw.value);_this.watches.splice(_this.watches.indexOf(zw),1)});watches=[]}}};Zone.prototype.reconf=function(watches){var new_conf=this.conf;this.watches.forEach(function(zw){watch_reconf(zw,new_conf)})};function Zone(_loader,conf,id,opt){if(!(this instanceof Zone))return new Zone(_loader);opt=opt||{};this.loader=_loader;this.info={};this.watches=[];this.id=id||0;this.log=(opt.log||_log).reset_module();this.zperr=this.perr_get();if(conf){conf.customer=conf.customer||_loader&&_loader.customer;this.init(conf)}}Zone.prototype.get_link_type=function(link){var type=util.get_video_type(util.video2type(link,this));return util.get_method_type(type)};E.t={select_zone:select_zone,get_zone_opt:get_zone_opt,check_h264:check_h264,reset_random:reset_random,Zone:Zone};return E})})();
(function(){var __hola_stub_define,is_node=typeof module=="object"&&module.exports;if(!is_node)define=define||self.define;else{var define_node=require("../../../util/require_node.js").define(module,"../");var zutil=require("../../../util/util.js");var md5=zutil.is_mocha()&&"/svc/cdn/pub/md5.min.js";define=function(name,deps,fn){return define_node(name,["/util/util.js","/svc/cdn/pub/util.js",null,"events","/util/escape.js","/util/rand.js","/util/hash.js","/svc/cdn/pub/ajax.js","/svc/cdn/pub/cdn_util.js",md5,null],fn)}}define("/svc/cdn/pub/cdnlist.js",["/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/storage.js","/util/events.js","/util/escape.js","/util/rand.js","/util/hash.js","/svc/cdn/pub/ajax.js","/svc/cdn/pub/cdn_util.js","md5","/svc/cdn/pub/zone.js"],function(zutil,util,storage,events,zescape,rand,hash,ajax,cdn_util,md5,_zone){var E={};var KB=1024,assign=Object.assign;var ms_since=util.ms_since;var ERR=util.ERR;var ms_sec=1e3,ms_min=60*ms_sec,ms_hour=60*ms_min;E.version="5";E.pool=[];E.next_uid=1;E.Cdn=function Cdn(opt){opt=opt||{};if(!(this instanceof E.Cdn))return new E.Cdn(opt);var info=E.all_agents&&E.all_agents.get(opt.host)||{};this.ms_hdrs=this.bpms=this.bytes=this.fail=0;this.success=this.delayed=this.aborted_bytes=0;this.aborted=this.ttfb_n=this.ttfb=this.ranges_supported=0;this.enabled=1;this.cache={hit:{},miss:{}};this.cost=+opt.cost||info.cost;this.req_uid=opt.req_uid||0;this.uid=opt.uid;this.role=opt.role||info.role;this.origin=opt.origin;this.master=opt.master;this.owner=opt.owner||info.owner;this.host=opt.host;this.type=opt.type||info.type;this.country=opt.country||info.country;this.disconnect=this.disconnect_wait=this.disconnect_ts=0;this.busy=this.busy_wait=this.busy_ts=0;this.hostname=opt.hostname||info.hostname||opt.host;this.name=opt.name||opt.hostname||this.host;this.id="cw"+this.uid;this.learning=assign({},opt.learning);this.progress_bw={bw:0,samples:[],max:opt.max_samples||50};this.success_ts=this.fail_ts=0;this.split=this.split||{};if(opt.progress_bw)this.set_progress_bw(opt.progress_bw);E.pool.push(this);this.zone_specific={};return this};zutil.inherits(E.Cdn,events.EventEmitter);E.Cdn.prototype.using=function(zone){var _this=this,zname=zone.CG("zone")||zone.id;var zctx=this.zone_specific[zname]=this.zone_specific[zname]||{};var obfuscate_links=zone.CG("cdn.send_reqs.obfuscate_links",[]);return zctx.api=zctx.api||{is_head_unsupported:function(){return _this.head_unsupported||_this.is_origin()&&(zone.CG("cdn.send_reqs.origin.head_unsupported")||zone.CG("cdn.send_reqs.origin.auto_head_unsupported")||_this.hostname.search("brightcove")>-1)},is_ranges_unsupported:function(){return!_this.ranges_supported&&(_this.ranges_unsupported||_this.is_origin()&&(zone.CG("cdn.send_reqs.origin.ranges_unsupported")||zone.CG("cdn.send_reqs.origin.auto_ranges_unsupported")))},get_ws:function(){return zctx.ws},get_ws_stats:function(){return zctx.ws_stats},add_ws_listener:function(){if(!_this.is_hola()||_this.is_bootstrap()||typeof WebSocket!="function"){return}if(!zctx.ws){zctx.ws_stats={};zctx.ws=open_ws_listener(zone,_this,zctx.ws_stats,location.protocol)}zctx.ws_ref=(zctx.ws_ref||0)+1;return zctx.ws},remove_ws_listener:function(){if(!zctx.ws||--zctx.ws_ref)return;zctx.ws.close();zctx.ws.removeAllListeners();zctx.ws=zctx.ws.ws=zctx.ws_stats=undefined},send:function(cmd,route,data,cb,opt){if(typeof route=="function"){opt=data;cb=route;data=route=undefined}else if(typeof data=="function"){opt=cb;cb=data;data=undefined}opt=opt||{};route=assign(!util.is_zlxc?{ver:util.ver}:{},util.has_ext?{ext:true}:{},util.is_debug?{debug:true}:{},route);if(opt.fetch_blob){return void this.send_xhr(cmd,route,{response_type:"blob"},cb)}if(opt.ws_only||!opt.xhr_only){if(zctx.ws&&zctx.ws.is_ready())return this.send_ws(cmd,route,data,cb);else if(opt.ws_only)return}this.send_xhr("cmd/"+cmd,route,{data:data},cb)},send_ws:function(cmd,route,data,cb){var ts=util.date_monotonic();if(zctx.ws){zctx.ws.send(cmd,route,data,function(res){if(!cb)return;cb({cmd:cmd,data:data||{},res:res&&!res.err&&!res.error?res:null,description:res&&res.description,err:res?res.err||res.error:"fail",cdn:_this,status:res&&res.status,elapsed:util.date_monotonic()-ts})})}else if(cb){cb({cdn:_this,cmd:cmd,data:data||{},err:"no open websocket"})}},send_xhr:function(cmd,route,opt,cb){cb=cb||function(){};var __this=this,ts=util.date_monotonic();var url=route.final_url;if(!url){var qs=assign({customer:zone.CG("customer")||util.conf.customer,zone:zone.CG("zone")},route);if(qs.url&&typeof btoa=="function"&&obfuscate_links.includes(cmd)){qs.url=btoa(qs.url);qs.obf=true}url="/"+cmd+"?"+zescape.qs(qs)}__this.send_xhr_raw(url,opt,function(res){var ret={cmd:cmd,opt:opt.data||{},res:res&&res.res,err:res?res.err:"fail",status:res&&res.status,cdn:zutil.is_mocha()?undefined:_this,elapsed:zutil.is_mocha()?0:util.date_monotonic()-ts,description:res&&res.description};cb(ret)})},send_xhr_raw:function(url,opt,cb){opt=opt||{};var protocol=zone.CG("loader.https_xhr_only")?"https:":util.protocol;var host=protocol=="https:"?_this.hostname:_this.host;var _opt={url:protocol+"//"+host+url,data:opt.data,response_type:opt.response_type||"json",timeout:opt.timeout||6e4,no_content_type:true};var _cb=function(res){var data=res&&res.status==200?{url:url,res:res.data,status:200}:{status:res&&res.status,err:res&&res.err||"empty_response",description:res&&res.description};if(opt.cb)opt.cb(data);cb(data)};ajax.fetch_bin(_opt,_cb)},uninit:function(){this.remove_ws_listener();if(!zctx.ws)_this.zone_specific[zname]=undefined}}};E.Cdn.prototype.get_progress_bw=function(){return this.progress_bw.bw};E.Cdn.prototype.set_progress_bw=function(bw){if(!bw)return;this.progress_bw.samples.push(bw);if(this.progress_bw.samples.length>this.progress_bw.max)this.progress_bw.samples.splice(0,Math.round(this.progress_bw.max/2));var sum=0;this.progress_bw.samples.forEach(function(a){sum+=a});this.progress_bw.bw=Math.round(sum/this.progress_bw.samples.length)};E.Cdn.prototype.is_hola=function(){return this.owner=="hola"};E.Cdn.prototype.is_origin=function(){return this.origin};E.Cdn.prototype.is_master=function(){return this.master};E.Cdn.prototype.is_single=function(){return this.role=="single_copy"};E.Cdn.prototype.is_fast=function(){return this.role=="fast"};E.Cdn.prototype.is_dedicated_fast=function(){return["fast","efast"].includes(this.type)};E.Cdn.prototype.is_efast=function(){return this.type=="efast"};E.Cdn.prototype.is_bootstrap=function(){return this.role=="bootstrap"};E.Cdn.prototype.is_usable=function(){return this.is_enabled()&&!this.is_disconnected()&&!this.is_busy()};E.Cdn.prototype.is_enabled=function(){return this.enabled};E.Cdn.prototype.is_failed=function(){return(!this.success_ts||this.fail_ts>this.success_ts)&&this.fail_ts&&util.date_monotonic()-this.fail_ts<10*ms_min?this.fail:0};E.Cdn.prototype.enable=function(){this.enabled=1};E.Cdn.prototype.disable=function(){this.enabled=0};E.Cdn.prototype.update_from_hdrs=function(hdrs){hdrs=hdrs||[];this.update_cache_type(hdrs["x-cache"]);this.update_hola_resp(hdrs["x-hola-resp"])};E.Cdn.prototype.update_hola_resp=function(s){var resp=zescape.parse.http_words(s);for(var i=0;i<resp.length;i++){if(resp[i][0]=="ttfb")this.ttfb=resp[i][1];else if(resp[i][0]=="cache")this.update_cache_type(resp[i][1]);else if(resp[i][0]=="age")this.age=resp[i][1]}};E.Cdn.prototype.need_bw_info=function(){return!this.ms_hdrs||this.is_bw_from_cache()};E.Cdn.prototype.is_bw_from_cache=function(){return this.cache_flag&&this.cache[this.cache_flag].from_cache};E.Cdn.prototype.update_cache_type=function(cache_flag){cache_flag=cache_flag?cache_flag.toLowerCase():"hit";if(!["hit","miss"].includes(cache_flag)||cache_flag==this.cache_flag)return;var prev=this.cache_flag;this.cache_flag=cache_flag;if(!prev)return;if(!this.bpms||this.cache[this.cache_flag].bpms)this.bpms=this.cache[this.cache_flag].bpms;if(!this.ms_hdrs||this.cache[this.cache_flag].ms_hdrs)this.ms_hdrs=this.cache[this.cache_flag].ms_hdrs};E.Cdn.prototype.rate=function(sz){return Math.round((sz||512*KB)/this.bpms)};E.Cdn.prototype.set_error=function(err){if(err==ERR.head_unsupported)this.head_unsupported=true;else if(err==ERR.ranges_unsupported)this.ranges_unsupported=true};E.Cdn.prototype.can_get=function(sz,sec,opt){opt=opt||{};var ms=sec*ms_sec;return(!this.bpms||opt.by_hdrs)&&this.ms_hdrs&&this.ms_hdrs<=ms*.4?true:this.calc_ttc(sz)+500<=ms};E.Cdn.prototype.calc_ttc=function(sz){return!sz?this.ms_hdrs||Infinity:this.bpms?Math.round(sz/this.bpms):Infinity};E.Cdn.prototype.bps=function(){return ms_sec*this.bpms};E.Cdn.prototype.compare=function(cdn2,opt){var _this=this;function log(s,r){if(opt.log)opt.log.info(s+(r?" ret "+r:""));return r}function logt(s){return log(_this.id+" "+s,-1)}function logo(s){return log(cdn2.id+" "+s,1)}log("compare "+this.id+" to "+(cdn2?cdn2.id:"unknown")+" sz "+opt.sz+" sec "+opt.sec);if(!cdn2)return logt("cdn2 missing ");var can_get=opt.sz&&opt.sec?!opt.fastest||this.bpms?this.can_get(opt.sz,opt.sec):false:true;var can_get2=opt.sz&&opt.sec?!opt.fastest||cdn2.bpms?cdn2.can_get(opt.sz,opt.sec):false:true;var bpms=this.bpms,bpms2=cdn2.bpms,hdrs=this.ms_hdrs;var hdrs2=cdn2.ms_hdrs;if(can_get!=can_get2){return can_get?logt("can get "+bpms+">"+bpms2):logo("can get "+bpms2+">"+bpms)}if(this.bpms&&!this.is_bw_from_cache()&&(cdn2.is_bw_from_cache()||!cdn2.bpms)&&can_get){return logt("bpms "+this.bpms+" cdn2 from cache or no bpms")}if((!this.bpms||this.is_bw_from_cache())&&cdn2.bpms&&!cdn2.is_bw_from_cache()&&can_get2){return logo("bpms "+cdn2.bpms+" "+this.id+" from cache or no bpms")}if(this.host==cdn2.host||!bpms&&!bpms2&&!hdrs&&!hdrs2)return log("identical",0);if(!hdrs||!hdrs2)return!hdrs?logo("hdrs "+hdrs2):logt("hdrs "+hdrs);if(!bpms||!bpms2){return bpms&&can_get?logt("bpms "+bpms+" and can get"):bpms2&&can_get2?logo("bpms "+bpms2+" and can get"):hdrs==hdrs2?bpms?logt("same hdrs and bpms "+bpms):bpms2?logo("same hdrs and bpms "+bpms2):log("hdrs identical",0):log("hdrs "+hdrs+" hdrs2 "+hdrs2,hdrs-hdrs2*(opt.ratio||1))}return Math.round(opt.rate?log("rate comparison "+this.rate(opt.sz)+" "+cdn2.rate(opt.sz),this.rate(opt.sz)-cdn2.rate(opt.sz)*(opt.ratio||1)):opt.bps?log("bps comparison "+this.bps()+" "+cdn2.bps(),cdn2.bps()-this.bps()*(opt.ratio||1)):log("bpms comparison "+bpms+" "+cdn2.bpms,cdn2.bpms-this.bpms))};E.Cdn.prototype.compare_rate=function(cdn2,opt){return this.compare(cdn2,assign(opt||{},{rate:true}))};E.Cdn.prototype.compare_bps=function(cdn2,opt){return this.compare(cdn2,assign(opt||{},{bps:true}))};E.Cdn.prototype.set_busy=function(){this.busy++;this.busy_ts=util.date_monotonic();this.busy_wait=Math.min(this.busy_wait?this.busy_wait*2:2e3,64e3);this.emit("busy")};E.Cdn.prototype.disconnected=function(){this.disconnect++;this.disconnect_ts=util.date_monotonic();this.disconnect_wait=Math.min(this.disconnect_wait?this.disconnect_wait*2:2e3,64e3);this.emit("disconnect")};E.Cdn.prototype.failed=function(err,adaptive){var disable=err==ERR.ranges_unsupported&&!adaptive||this.is_single();if(this.is_failed()||disable)this.enabled=0;this.fail++;this.fail_ts=util.date_monotonic();this.emit("failed")};function open_ws_listener(zone,cdn,ws_stats,protocol){if(!ws_stats.ts){assign(ws_stats,{pending:1,failed:0,connected:0,to_https:0,lag:0,ts:new Date})}var ws=new util.ws(protocol=="https:"?cdn.hostname:cdn.host,{path:"ws_client",customer:zone.CG("customer"),zone:zone.CG("zone"),minor:true,protocol:protocol=="https:"?"wss":"ws",timeout:protocol=="http:",log:zone.log});if(!ws){ws_stats.pending=0;ws_stats.failed=1;return ws}ws.on("message",function(data){cdn.emit("message",data);cdn.emit("message."+data.cmd,data)});ws.on("open",function(){ws_stats.pending=0;ws_stats.connected=1;ws_stats.lag=Date.now()-ws_stats.ts});if(protocol=="http:"){ws.on("error",function(){ws_stats.to_https=1;open_ws_listener(zone,cdn,ws_stats,"https:")})}if(protocol=="https:"){ws.on("error",function(){ws_stats.pending=0;ws_stats.failed=1})}return ws}E.Cdn.prototype.on_too_slow=function(cache_hit){this.learning.too_slow=this.learning.too_slow||0;this.learning.too_slow++;if(!cache_hit)return;var ip=util.geoip.ip;if(ip&&!this.split[ip]){this.learning.split=this.learning.split||{};if(this.learning.split[ip]=="testing")this.split[ip]="failed";else this.learning.split[ip]="testing"}};E.Cdn.prototype.is_busy=function(){return ms_since(this.busy_ts)<=this.busy_wait};E.Cdn.prototype.is_disconnected=function(){return ms_since(this.disconnect_ts)<=this.disconnect_wait};E.Cdn.prototype.ttfb=function(){return this.ttfb/this.ttfb_n};E.Cdn.prototype.set_ttfb=function(ttfb){this.ttfb_n++;this.ttfb+=ttfb};E.Cdn.prototype.update_stats=function(opt){if(!opt.ms_hdrs&&this.ms_hdrs){if(opt.elapsed<this.ms_hdrs)return;opt.ms_hdrs=opt.elapsed}opt.ms=opt.ms||opt.elapsed-opt.ms_hdrs;this.update_stream_stats(opt);if(!opt.final)return;this.update_cache_stats(opt);if(!opt.error||opt.rate&&this.is_origin()){this.success++;this.success_ts=util.date_monotonic()}if(!opt.error&&opt.range)this.ranges_supported++;this.bytes+=opt.sz;if(opt.rate)this.rate_bytes=(this.rate_bytes||0)+opt.sz};E.Cdn.prototype.update_stream_stats=function(opt){var ms_hdrs=opt.ms_hdrs,ms=opt.ms,sz=opt.sz,elapsed=opt.elapsed;if(!ms_hdrs&&(!this.ms_hdrs||elapsed<=this.ms_hdrs))return;var replace=opt.replace||this.ms_hdrs<ms_hdrs/2||this.ms_hdrs>ms_hdrs*2;var overwrite=!this.ms_hdrs||this.is_bw_from_cache()||replace;var new_ms_hdrs=overwrite?ms_hdrs:Math.round((this.ms_hdrs+ms_hdrs)/2);if(opt.final)this.ms_hdrs=new_ms_hdrs;if(opt.final&&!sz)return this.bpms=overwrite?0:this.bpms;if(!sz&&(!this.bpms||!ms_hdrs)||sz<64*KB&&opt.ttc<Infinity&&elapsed<opt.ttc/2){return}this.ms_hdrs=new_ms_hdrs;var bpms=sz/(ms+ms_hdrs);replace=replace||this.bpms<bpms/2||this.bpms>bpms*2;overwrite=!this.bpms||this.is_bw_from_cache()||replace;this.bpms=Math.round(overwrite?bpms:(this.bpms+bpms)/2)};E.Cdn.prototype.update_cache_stats=function(opt){var ms_hdrs=opt.ms_hdrs,ms=opt.ms,sz=opt.sz,elapsed=opt.elapsed;if(!ms_hdrs&&(!this.ms_hdrs||elapsed<=this.ms_hdrs))return;if(opt.rate&&!ms_hdrs||!opt.rate&&(!sz&&(!this.bpms||!ms_hdrs)||sz<64*KB&&elapsed<opt.ttc/2||ms_hdrs==elapsed)){return}var set=this.cache[this.cache_flag||"hit"],bpms=sz/(ms+ms_hdrs);var prev_rate=Math.round(512*KB/set.bpms);var replace=opt.replace||this.ms_hdrs<ms_hdrs/2||this.ms_hdrs>ms_hdrs*2;set.ms_hdrs=!set.ms_hdrs?ms_hdrs:Math.round((set.ms_hdrs*2+ms_hdrs)/3);if(opt.rate)return this.bpms=replace?0:this.bpms;set.from_cache=undefined;var new_rate=Math.round(512*KB/bpms);if(prev_rate<=new_rate*(opt.rate_decrease||.7))this.emit("rate_decrease",this,prev_rate/new_rate);replace=replace||this.bpms<bpms/2||this.bpms>bpms*2;set.bpms=Math.round(!set.bpms||replace?bpms:(set.bpms*2+bpms)/3);set.bytes=(set.bytes||0)+sz};E.Cdn_list=function Cdn_list(opt){if(!(this instanceof E.Cdn_list))return new E.Cdn_list(opt);var _this=this;opt=opt||{};this.arr=[];this.save_to=opt.save_to;this.length=0;this.zone=opt.zone;this.zperr=opt.zone.perr_get();this.log=opt.zone.log_get().set_module("cdnlist");this.on_cdn_message=function(data){var cdn=this;_this.emit("message",cdn,data);_this.emit("message."+data.cmd,cdn,data)};this.add(opt.cdns,opt.role);return this};zutil.inherits(E.Cdn_list,events.EventEmitter);E.Cdn_list.prototype.find=function(func,a){for(var i=0;i<this.arr.length;i++){if(func.call(a,this.arr[i]))return this.arr[i]}};E.Cdn_list.prototype.count=function(cond){var count=0;for(var i=0;i<this.arr.length;i++)count+=!!cond(this.arr[i]);return count};E.Cdn_list.prototype.add_ws_listener=function(){this.arr.forEach(function(cdn){cdn.using(this.zone).add_ws_listener()},this)};E.Cdn_list.prototype.remove_ws_listener=function(){this.arr.forEach(function(cdn){cdn.using(this.zone).remove_ws_listener()},this)};E.Cdn_list.prototype.some=function(func,a){return this.arr.some(func,a)};E.Cdn_list.prototype.every=function(func,a){return this.arr.every(func,a)};E.Cdn_list.prototype.forEach=function(func,a){this.arr.forEach(func,a)};E.Cdn_list.prototype.filter=function(func,a){return this.arr.filter(func,a)};E.Cdn_list.prototype.add_origin=function(cdn){this.add([{host:cdn.host,cost:cdn.cost||this.zone.CG("cdn.send_reqs.origin.cost")||5,origin:true}]);return this.get_by_host(cdn.host)};E.Cdn_list.prototype.send=function(cmd,route,data,cb,opt){opt=opt||{};var timer=0,timers=[],done,resps=0,_this=this;function _cb(res){resps++;if(!res||res.err||done)return;done=true;timers.forEach(function(t){clearTimeout(t)});if(cb)cb(res&&res.timeout?{err:"timeout"}:res)}this.forEach(function(cdn,index){timers.push(setTimeout(function(){if(opt.on_req)opt.on_req(index);cdn.using(_this.zone).send(cmd,route,data,function(res){if(opt.on_res)opt.on_res(index,res);_cb(res)},opt)},timer));timer+=opt.gap_ms===undefined?300:opt.gap_ms});timers.push(setTimeout(_cb.bind(null,{timeout:true}),opt.timeout||5e3))};E.Cdn_list.prototype.send_xhr=function(cmd,route,opt,cb){this.forEach(function(cdn){cdn.using(this.zone).send_xhr(cmd,route,opt,cb)},this)};E.Cdn_list.prototype.has_usable=function(){return this.arr.some(function(cdn){return cdn.is_enabled()})};E.Cdn_list.prototype.has=function(host){return!!this.get_by_host(host)};E.Cdn_list.prototype.can_get_by_hola=function(sz,sec,allow_fast){return this.can_get(sz,sec,function(){return(allow_fast||!this.is_fast())&&this.is_hola()})};E.Cdn_list.prototype.can_get_by_origin=function(sz,sec){return this.can_get(sz,sec,function(){return this.is_origin()})};E.Cdn_list.prototype.can_get=function(sz,sec,filter_fn){return this.arr.some(function(cdn){return!filter_fn||filter_fn.apply(cdn)?cdn.can_get(sz,sec):false})};E.Cdn_list.prototype.stats=function(opt){var stats=[];opt=opt||{};for(var i=0;i<this.arr.length;i++){var cdn=this.arr[i];var reset_snapshot=this.reset_snapshot&&this.reset_snapshot.cdn[i];var cdn_stats={bpms:cdn.bpms,ms_hdrs:cdn.ms_hdrs,bytes:cdn.bytes,fail:cdn.fail,enabled:cdn.enabled,success:cdn.success,cost:cdn.cost,delayed:cdn.delayed,name:cdn.name,owner:cdn.owner,cache_hit:cdn.cache.hit.bytes,cache_miss:cdn.cache.miss.bytes,aborted:cdn.aborted,aborted_bytes:cdn.aborted_bytes,host:cdn.host,bps:cdn.bps(),role:cdn.role,country:cdn.country,age:cdn.age,too_slow:cdn.learning.too_slow};if(!opt.from_start&&reset_snapshot)cdn_stats=reset_snapshot.diff(cdn_stats);stats.push(cdn_stats)}return stats};E.Cdn_list.prototype.ws_stats=function(opt){var ret={connected:0,pending:0,failed:0,lag:0};opt=opt||{};for(var i=0;i<this.arr.length;i++){var ws_stats=this.arr[i].using(this.zone).get_ws_stats();if(!ws_stats)continue;ret.connected+=ws_stats.connected;ret.pending+=ws_stats.pending;ret.failed+=ws_stats.failed;ret.lag+=ws_stats.lag}if(!opt.from_start&&this.reset_snapshot)ret=this.reset_snapshot.ws.diff(ret);return ret};E.Cdn_list.prototype.reset_stats=function(){this.reset_snapshot={cdn:this.stats({from_start:true}).map(function(cdn_stats){return util.data_snapshot(cdn_stats,["bytes","rate_bytes","cache_hit","cache_miss","cache_revalidate","aborted","aborted_bytes","too_slow"])}),ws:util.data_snapshot(this.ws_stats({from_start:true}))}};E.Cdn_list.prototype.add=function(cdns,role){if(!cdns)return;var _this=this;function add_cdn(opt){var host=opt.host.toLowerCase();var c=_this.get_by_host(host);if(c){if(c.is_fast()&&opt.role!="fast"){_this.log.debug("changed cdn cw"+c.uid+" role "+c.role+"->"+opt.role);c.role=opt.role;c.cost=opt.cost}c.alt_fast=c.is_single()&&opt.role=="fast";c.master=c.master||opt.master;return}var cdn=E.pool.find(function(c){return c.host==host});if(!cdn){var uid=opt.uid||E.next_uid;opt.req_uid=opt.req_uid||(cdn?cdn.req_uid:null);assign(opt,{uid:uid,host:host});cdn=new E.Cdn(assign({role:role,log:_this.log},opt));if(!opt.uid||opt.uid==E.next_uid)E.next_uid++}else if(_this.save_to!=cdn.save_to){cdn.role=opt.role||role;cdn.master=cdn.master||opt.master}cdn.on("message",_this.on_cdn_message);cdn.using(_this.zone).add_ws_listener();_this.update_from_cache(cdn);_this.arr.push(cdn);var cdn_str=JSON.stringify(opt,function(k,v){if(k!="ws")return v});_this.log.debug("added cdn "+cdn_str+" bw "+cdn.get_progress_bw()+" uid "+cdn.uid+" cost "+cdn.cost);_this.emit("cdn_added",cdn)}var src=Array.isArray(cdns)?cdns:cdns.arr;for(var i=0;i<src.length;i++)add_cdn(src[i]);this.arr.sort(function(a,b){return a.cost-b.cost});this.length=this.arr.length};E.Cdn_list.prototype.have_best_cdn_candidates=function(){var candidates=0;this.arr.forEach(function(cdn){if(cdn.bpms&&cdn.is_enabled())candidates++},this);return candidates};E.Cdn_list.prototype.get_lowcost_cdn=function(sz,sec,allow_fast,replace){var lowest,usable,pending,disc_cdn,debug,_this=this;if(zutil.is_mocha()&&this.jtest_lowcost_cdn){var cdn=this.get_by_uid(this.jtest_lowcost_cdn);return{lowcost:cdn,lowcost_usable:cdn}}function log(s,r){if(debug){_this.log.info(s+(r?" ret "+(typeof r=="object"?"json":r):""))}return r}this.arr.forEach(function(cdn){log("checking cdn "+cdn.id+" can_get sz "+sz+" sec "+sec+" "+cdn.can_get(sz,sec)+" cost "+cdn.cost+" bpms "+cdn.bpms+" ms_hdrs "+cdn.ms_hdrs);if(this.zone.CG("cdn.send_reqs.origin_only")&&!cdn.is_origin())return;if(!cdn.is_enabled()||!allow_fast&&cdn.is_fast())return log(cdn.id+" not usable");cdn=this.get_replacement(cdn,replace);if((!usable||cdn.cost<usable.cost||cdn.cost==usable.cost&&cdn.compare_rate(usable,{log:debug&&this.log})<0)&&cdn.can_get(sz,sec)){if(cdn.is_usable()){log("chosen "+cdn.id+" type usable");usable=cdn}else if(ms_since(cdn.disconnect_ts)>2e3&&ms_since(cdn.busy_ts)>2e3&&(!disc_cdn||cdn.compare_rate(disc_cdn,{sz:sz,sec:sec,log:debug&&this.log})<0)){log("chosen "+cdn.id+" type disconnected");disc_cdn=cdn}}if((!pending||cdn.cost<pending.cost)&&!cdn.bpms)pending=cdn;if(lowest&&lowest.cost<cdn.cost)return void log("higher cost than lowest "+lowest.id);if(!lowest||cdn.cost<lowest.cost||cdn.compare_rate(lowest,{log:debug&&this.log})<0){log("chosen "+cdn.id+" type lowest");lowest=cdn}},this);return log("choice lowest "+(lowest?lowest.id:"none")+" lowcost_usable "+(usable||disc_cdn?(usable||disc_cdn).id:"none")+" pending "+(pending?pending.id:"none"),{lowcost:lowest?lowest.replaced||lowest:null,lowcost_usable:usable?usable.replaced||usable:disc_cdn?disc_cdn.replaced||disc_cdn:null,pending:pending?pending.replaced||pending:null})};E.Cdn_list.prototype.get_best_cdn_bw=function(opt){var best_cdn=this.get_best_cdn("get_best_cdn_bw",opt);return best_cdn?best_cdn.bps():0};E.Cdn_list.prototype.get_best_cdn_bw_bits=function(opt){return this.get_best_cdn_bw(opt)*8};E.Cdn_list.prototype.is_origin_disconnected=function(opt){return this.every(function(cdn){return!cdn.is_origin()||cdn.is_disconnected()})};E.Cdn_list.prototype.hola_fast_usable=function(opt){return this.hola_usable({fast:true})};E.Cdn_list.prototype.hola_single_usable=function(opt){return this.hola_usable({single:true})};E.Cdn_list.prototype.hola_usable=function(opt){opt=opt||{};var count=0;this.arr.forEach(function(cdn){count+=cdn.is_hola()&&cdn.is_usable()&&(!opt.fast&&(!opt.single||cdn.is_single()))&&(!opt.single&&(!opt.fast||cdn.is_fast()))});return count};E.Cdn_list.prototype.count_single_busy=function(opt){return this.count_busy({single:true})};E.Cdn_list.prototype.count_busy=function(opt){opt=opt||{};var count=0;this.arr.forEach(function(cdn){count+=cdn.is_hola()&&cdn.is_enabled()&&cdn.is_busy()&&(!opt.single||cdn.is_single())});return count};E.Cdn_list.prototype.is_busy=function(opt){return this.every(function(cdn){return!cdn.is_enabled()||!cdn.is_hola()||cdn.is_busy()})};E.Cdn_list.prototype.is_disconnected=function(opt){return this.every(function(cdn){return cdn.is_disconnected()})};E.Cdn_list.prototype.is_disconnected_on_start=function(opt){return this.every(function(cdn){return!cdn.bytes&&cdn.is_disconnected()})};E.Cdn_list.prototype.get_replacement=function(cdn,replace){var r;if(!replace||!(r=replace.find(function(c){return c.id==cdn.id})))return cdn;var _cdn=zutil.clone_deep(cdn);_cdn.bpms=r.bpms;_cdn.ms_hdrs=r.ms_hdrs;_cdn.replaced=cdn;return _cdn};E.Cdn_list.prototype.get_best_cdn=function(caller,opt){var debug,log=debug?this.log.info:function(){};opt=opt||{};log("get_best_cdn caller "+caller+" opt "+JSON.stringify(opt));if(zutil.is_mocha()&&this.jtest_best_cdn){var cdn=this.get_by_uid(this.jtest_best_cdn);log("chose "+cdn.id+" by jtest_best_cdn");return cdn}var best_cdn,disc_cdn;this.arr.forEach(function(cdn){cdn=this.get_replacement(cdn,opt.replace);var no_ranges=cdn.using(this.zone).is_ranges_unsupported();var sz=no_ranges?opt.fs||opt.sz:opt.sz;log("test cdn "+cdn.id+" usable "+cdn.is_enabled()+" hdrs "+cdn.ms_hdrs+" fast "+cdn.is_fast()+" prev_bpms "+cdn.prev_bpms+" bpms "+cdn.bpms+" best "+(best_cdn&&best_cdn.id)+" ttc "+cdn.calc_ttc(sz)+" for sec "+opt.sec+" sz "+sz);if(this.zone.CG("cdn.send_reqs.origin_only")&&!cdn.is_origin())return;if(opt.ranges_supported&&no_ranges)return;if(cdn.ms_hdrs&&cdn.is_enabled()&&(opt.allow_fast||!cdn.is_fast())&&(!opt.no_cache||!cdn.is_bw_from_cache())&&(!best_cdn||best_cdn.is_failed()>cdn.is_failed()||best_cdn.is_failed()==cdn.is_failed()&&cdn.compare_rate(best_cdn,{sz:sz,sec:opt.sec,log:(debug||opt.debug)&&this.log})<0)){log("chose "+cdn.id+" disconnected "+cdn.is_disconnected());if(cdn.is_usable())best_cdn=cdn;else if(ms_since(cdn.disconnect_ts)>2e3&&ms_since(cdn.busy_ts)>2e3&&(!disc_cdn||cdn.compare_rate(disc_cdn,{sz:sz,sec:opt.sec,log:(debug||opt.debug)&&this.log})<0)){disc_cdn=cdn}}},this);best_cdn=best_cdn||disc_cdn;if(this.prev_best_cdn!==best_cdn){this.emit("new_best_cdn",best_cdn);this.log.debug("new best_cdn "+(best_cdn?best_cdn.id:"none")+" bpms "+(best_cdn?best_cdn.bpms:0)+" hdrs "+(best_cdn?best_cdn.ms_hdrs:0)+" rate "+(best_cdn?best_cdn.rate():0)+" caller "+caller)}this.prev_best_cdn=best_cdn;return best_cdn?best_cdn.replaced||best_cdn:null};E.Cdn_list.prototype.get_by_id=function(id){return this.find(function(cdn){return cdn.id==id})};E.Cdn_list.prototype.get_by_host=function(host){return this.find(function(cdn){return cdn.host==host||cdn.redir_host==host||cdn.name==host||cdn.hostname==host})};E.Cdn_list.prototype.get_by_uid=function(uid){return this.find(function(cdn){return cdn.uid==uid})};E.Cdn_list.prototype.get_origin=function(){return this.find(function(cdn){return cdn.origin})};E.Cdn_list.prototype.get_master=function(){return this.find(function(cdn){return cdn.master})};E.Cdn_list.prototype.read_storage=function(){if(!this.save_to)return{cdns:{}};var data=storage.db.get_json(this.save_to);if(!data||data.version!=E.version){this.log.debug("cdn cache "+(!data?"not found":"version mismatch "+data.version+"!="+E.version));return{cdns:{}}}return data};E.Cdn_list.prototype.update_from_cache=function(cdn){if(!this.cache)this.cache=this.read_storage();cdn.cache=this.cache.cdns[cdn.host]||{success_ts:0,hit:{bpms:0,ms_hdrs:0,bytes:0},miss:{bpms:0,ms_hdrs:0,bytes:0},delayed:0,success:0};cdn.cache.hit=cdn.cache.hit||{};cdn.cache.miss=cdn.cache.miss||{};cdn.save_to=this.save_to;if(cdn.success_ts>=cdn.cache.success_ts)return;cdn.cache_flag=cdn.cache.hit.bpms||!cdn.cache.miss.bpms?"hit":"miss";var cache=cdn.cache[cdn.cache_flag];cdn.bpms=cache.bpms||cdn.bpms;cdn.ms_hdrs=cache.ms_hdrs||cdn.ms_hdrs;if(!zutil.is_mocha()||!util.jtest.snapshot)cdn.cache.hit.from_cache=cdn.cache.miss.from_cache=true;cdn.delayed=cdn.cache.delayed||cdn.delayed;cdn.success=cdn.cache.success||cdn.success;cdn.ranges_supported=cdn.cache.ranges_supported||cdn.ranges_supported;cdn.success_ts=cdn.cache.success_ts||cdn.success_ts;if(cdn.cache.progress_bw)cdn.set_progress_bw(cdn.cache.progress_bw)};E.Cdn_list.prototype.to_json=function(){var json={};for(var i=0;i<this.arr.length;i++){var cdn=this.arr[i];json[cdn.host]={fail:cdn.fail,hit:zutil.clone_deep(cdn.cache.hit||{}),miss:zutil.clone_deep(cdn.cache.miss||{}),delayed:cdn.delayed,success:cdn.success,cost:cdn.cost,role:cdn.role,origin:cdn.origin,owner:cdn.owner,success_ts:cdn.success_ts,ttfb_n:cdn.ttfb_n,progress_bw:cdn.get_progress_bw(),fail_ts:cdn.fail_ts,ttfb:cdn.ttfb,ranges_supported:cdn.ranges_supported}}return json};E.Cdn_list.prototype.save=function(opt){if(!this.save_to)return;opt=opt||{};var now=util.date_monotonic(),cdn;if(!opt.close&&now-this.last_save<=5*ms_sec)return;var data=this.read_storage();assign(data.cdns,this.to_json());try{while(JSON.stringify(data)>this.max_size){var oldest;for(cdn in data.cdns){if(!oldest||data[cdn].success_ts<data[oldest].success_ts)oldest=cdn}if(oldest)delete this.data.cdns[cdn]}data.version=E.version;storage.db.set_json(this.save_to,data);this.last_save=now;this.log.debug("saved "+JSON.stringify(data))}catch(e){this.zperr({id:"cdn_cache_err_failed_save",err:e});storage.db.clr(this.save_to)}};E.Cdn_list.prototype.uninit=function(){this.forEach(function(cdn){cdn.off("message",this.on_cdn_message);cdn.using(this.zone).uninit()},this)};E.init=function(bootstraps,loader,all_agents,no_geoip){E.all_agents=typeof all_agents!="object"?{}:all_agents;E.all_agents.get=function(host){var ret,find=function(c){return c.host==host};if(this.single&&(ret=this.single.find(find))||this.fast&&(ret=this.fast.find(find))||this.efast&&(ret=this.efast.find(find))){ret.owner="hola";ret.role=["fast","efast"].includes(ret.type)?"fast":"single_copy"}return ret}.bind(E.all_agents);if(!bootstraps)return;for(var i=0;i<bootstraps.length;i++){bootstraps[i].owner="hola";bootstraps[i].cost=1}var zone=new _zone(loader,{loader:loader.loader_conf},"cdnlist");var bootstrap_cdns=bootstraps?new E.Cdn_list({cdns:bootstraps,zone:zone,role:"bootstrap"}):undefined;if(bootstrap_cdns)util.on("beforeunload",function(){bootstrap_cdns.uninit()});E.bootstraps=bootstrap_cdns;if(E.bootstraps&&!no_geoip&&(!util.geoip||!util.geoip.update||new Date(util.jdate_now())-new Date(util.geoip.update)>=12*ms_hour)){E.update_geoip()}};E.update_geoip=function(opt){var updated;E.bootstraps.add_ws_listener();E.bootstraps.send("get_geoip",function(e){if(e&&e.res&&!updated){cdn_util.set_geoip(e.res);E.bootstraps.emit("geoip_received",e.res);E.bootstraps.remove_ws_listener();updated=true}},opt)};E.uninit=function(){if(E.bootstraps)E.bootstraps.uninit();E.bootstraps=undefined};function geo_get_rad(p){if(!p.latitude&&!p.longitude)return;return{lat:p.latitude*Math.PI/180,"long":p.longitude*Math.PI/180}}function filter_efast(zone,shards){var res=[],efast=zone.CG("agent.efast","").toLowerCase().split(" ");shards=shards||[];if(efast[0]=="all")return shards;for(var i=0;i<shards.length;i++){var agent=shards[i];if(efast.includes(agent.country.toLowerCase()))res.push(agent)}return res}function get_dist(p1,p2){var a=Math.pow(Math.sin((p2.lat-p1.lat)/2),2)+Math.pow(Math.sin((p2.long-p1.long)/2),2)*Math.cos(p1.lat)*Math.cos(p2.lat);var dist=Math.floor(6371*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));return dist}function get_closest(shards,geoip,filter){var res=[];for(var i=0;i<shards.length;i++){var shard=shards[i];if(filter&&!filter(shard)||!shard.geo)continue;res.push(assign({dist:get_dist(shard.geo,geoip)},shard))}return res.sort(function(i,j){return i.dist-j.dist})}function whitelist_filter(zone){var wl=zone.CG("agent.whitelist");if(!wl)return;return function(shard){return wl.includes(shard.host)||wl.includes(shard.name)}}function hrw_rand(v){return 1103515245*(v|0)+12345|0}function hrw_select(shards,url,ntop,filter){var top=[],key_int=E.hrw_get(url);for(var i=0;i<shards.length;i++){var shard=shards[i];if(filter&&!filter(shard))continue;var rank=E.hrw_rank(shard.hrw,key_int);top.push(assign({rank:rank},shard))}return top.sort(function(i,j){return j.rank-i.rank}).slice(0,ntop)}function cache_url(zone,url){return util.video2cache(url,zone)}function page_url(zone,url){return util.page2cache(url,zone)}function read_i32(s){return parseInt(s.slice(0,2),16)|parseInt(s.slice(2,4),16)<<8|parseInt(s.slice(4,6),16)<<16|parseInt(s.slice(6,8),16)<<24}E.get_closest=function(zone,opt,cb){cb=cb||function(){};opt=opt||{};var wait_geoip=function(_cb){if(!E.bootstraps||util.geoip&&util.geoip.ip)return _cb();E.bootstraps.once("geoip_received",_cb)};wait_geoip(function(){var cdns=E.local_url2cdns(zone,E.all_agents,util.geoip,"fake.mp4",{fast_limit:5});opt.ret=cdns&&cdns.fast&&cdns.fast.length?new E.Cdn_list({
cdns:rand.rand_subset(cdns.fast,Math.min(cdns.fast.length,opt.fast_limit||1)),zone:zone,role:"fast"}):null;cb(opt.ret);if(opt.cb)opt.cb(opt.ret)})};E.get_domain_shards=function(zone,agents,domain,opt){var link_shard=zone.CG("agent.pages.link_shard",3);var num_fallbacks=zone.CG("agent.pages.num_fallbacks",2);var filter=whitelist_filter(zone);var shards=agents&&agents.single||[];var hrw_fn=opt.hrw_fn||hrw_select;var domain_shards=[],masters=[],shards_len;if(Array.isArray(shards)){if(filter)shards=shards.filter(filter);shards_len=shards.length}else{var shards_o={};for(var k in shards){var shard=shards[k];if(!filter||filter(shard))shards_o[k]=shard}shards=shards_o;shards_len=Object.keys(shards).length}for(var s=0;masters.length!==link_shard;s++){var d_shards=hrw_fn(shards,domain+":"+s,1+num_fallbacks);var m=d_shards[0],m_name=m&&(m.hostname||m.host||m.name);if(!m_name)break;if(masters.includes(m_name)&&shards_len>=link_shard)continue;domain_shards.push(d_shards);masters.push(m_name)}return domain_shards};E.hrw_get=function(url){var hash=md5(url);return{a:read_i32(hash.slice(0,8))|0,b:read_i32(hash.slice(8,16))|0}};E.hrw_rank=function(shard_md5_int,key_md5_int){var v=hrw_rand(shard_md5_int.a);v=hrw_rand(v+key_md5_int.a);v=hrw_rand(v+shard_md5_int.b);v=hrw_rand(v+key_md5_int.b);return v};E.page_domain=function(zone,url){if(zone.is_agent)return zone.page_domain(url);return util.page2domain(url)};E.page_item_url=function(zone,item,opt){if(zone.is_agent)return zone[item.type=="page"?"page_url":"cache_url"](item.url);if(item.type=="page")return page_url(zone,item.url);return cache_url(zone,item.url)};E.pages2cdns=function(zone,agents,links,opt){opt=opt||{};var domain_shards={},res={};for(var i=0;i<links.length;i++){var link=links[i],url=link.url;var domain=E.page_domain(zone,url);if(!domain)continue;var cache=E.page_item_url(zone,link,opt);var shards=domain_shards[domain]||(domain_shards[domain]=E.get_domain_shards(zone,agents,domain,opt));res[url]=shards[hash.hash_string(cache)%shards.length]}return res};E.local_url2cdns=function(zone,agents,_geoip,_url,opt){opt=opt||{};if(zutil.is_mocha()&&util.jtest&&util.jtest.local_url2cdns){util.jtest.local_url2cdns.extra=util.jtest.extra_singles;return util.jtest.local_url2cdns}if(!agents||(!agents.single||!agents.single.length)&&(!agents.fast||!agents.fast.length)&&(!agents.efast||!agents.efast.length)){return}var res={single:[]};var url=cache_url(zone,_url);var geoip=_geoip&&geo_get_rad(_geoip);var fast_limit=opt.fast_limit||zone.CG("agent.select.fast.limit",2);var filter=whitelist_filter(zone);var s_shards=agents.single||[];var f_shards=[].concat(agents.single||[],agents.fast||[],filter_efast(zone,agents.efast));if(opt.fast_as_single||zone.CG("agent.select.allow_fast_as_single"))s_shards=s_shards.concat(f_shards);var single_limit=opt.single_limit||zone.CG("agent.select.single.limit",5);res.extra=hrw_select(s_shards,url,Math.max(single_limit,opt.extra_limit||zone.CG("agent.select.single.extra_limit",20)),filter);res.single=res.extra.splice(0,single_limit);if(res.single.length){res.single[0]=assign({master:true},res.single[0]);res.master=res.single[0]}if(geoip)res.fast=get_closest(f_shards,geoip,filter).slice(0,fast_limit);return res};E.get_fast_cdns=function(opt){return new E.Cdn_list({cdns:E.pool.filter(function(c){return!opt.dedicated&&c.is_fast()||c.is_dedicated_fast()}),zone:opt.zone})};return E})})();
define("/svc/cdn/pub/load_perf.js",["/svc/cdn/pub/util.js"],function(util){var E={};E.global_events=[];E.zone_events={};E.LOG_THRESHOLD=50;E.init=function(on){E.on=!!on;E.last=util.date_monotonic()};E.enable=function(){E.on=true};E.disable=function(){E.on=false};E.enabled=function(){return E.on};E.clear=function(){E.gloval_events=[];E.zone_events={}};E.push=function(name,zone,report){if(!E.on)return;var now=util.date_monotonic(),diff=now-E.last;var event={name:name,ts:Math.round(now),elapsed:Math.round(diff),report:!!report};E.last=now;if(!zone)return void E.global_events.push(event);E.zone_events[zone.id]=E.zone_events[zone.id]||[];E.zone_events[zone.id].push(event)};E.timeline=function(zone){if(!zone)return E.global_events;var a=E.global_events,b=E.zone_events[zone.id]||[];var al=a.length,bl=b.length,rl=al+bl,res=new Array(rl);for(var i=0,j=0,k=0;k<rl;k++){res[k]=j>=bl||i<al&&a[i].ts<=b[j].ts?a[i++]:b[j++];res[k].elapsed=k>0?res[k].ts-res[k-1].ts:res[k].elapsed}return res};E.timeline_to_str=function(zone,all){var tl=E.timeline(zone),tr=E.LOG_THRESHOLD;function ev2str(e){return e.name+" "+e.ts+"ms +"+e.elapsed+"ms"}tl=all?tl:tl.filter(function(e,i){return e.elapsed>=tr||e.report||i<tl.length-1&&(tl[i+1].elapsed>=tr||tl[i+1].report)});return tl.map(function(e){return ev2str(e)}).join("\n")};return E});
define("/svc/cdn/pub/adaptive.js",{__stub:1});
define("/svc/cdn/pub/progressive.js",{__stub:1});
define("/svc/cdn/pub/unittest.js",{__stub:1});
define("/svc/cdn/pub/req.js",{__stub:1});
define("/svc/cdn/pub/stream.js",{__stub:1});
define("/svc/cdn/pub/aggregator.js",{__stub:1});
define("/svc/cdn/pub/hap_util.js",{__stub:1});
define("/svc/cdn/pub/hola_adaptive.js",{__stub:1});


define("/svc/cdn/pub/mp4.js",{__stub:1});
define("/svc/cdn/pub/webm.js",{__stub:1});
define("/svc/cdn/pub/cdn.js",{__stub:1});

define("/svc/cdn/pub/timeline.js",{__stub:1});
!function(t,e){"function"==typeof define&&define.amd?define("cash",e):"undefined"!=typeof exports?module.exports=e():t.cash=t.$=e()}(this,function(){function t(t,e){e=e||A;var n=q.test(t)?e.getElementsByClassName(t.slice(1)):W.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t);return n}function e(t){if(!w){w=A.implementation.createHTMLDocument("");var e=w.createElement("base");e.href=A.location.href;try{A.domain&&w.domain!==A.domain&&(w.domain=A.domain)}catch(n){}w.head.appendChild(e)}try{var r;if((r=w.body.childNodes)&&r.length)for(var i=0;i<r.length;i++)w.body.removeChild(r[i])}catch(n){}return w.body.innerHTML=t,w.body.childNodes}function n(t){"loading"!==A.readyState?t():A.addEventListener("DOMContentLoaded",t)}function r(r,i){if(!r)return this;if(r.cash&&r!==S)return r;var o,u=r,s=0;if(k(r))u=R.test(r)?A.getElementById(r.slice(1)):D.test(r)?e(r):t(r,i);else if(P(r))return n(r),this;if(!u)return this;if(u.nodeType||u===S)this[0]=u,this.length=1;else for(o=this.length=u.length;s<o;s++)this[s]=u[s];return this}function i(t,e){return new r(t,e)}function o(t,e){for(var n=t.length,r=0;r<n&&e.call(t[r],t[r],r,t)!==!1;r++);}function u(t,e){var n=t&&(t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector);return!!n&&n.call(t,e)}function s(t){return k(t)?u:t.cash?function(e){return t.is(e)}:function(t,e){return t===e}}function c(t){return i(B.call(t).filter(function(t,e,n){return n.indexOf(t)===e}))}function a(t){return t[_]=t[_]||{}}function f(t,e,n){return a(t)[e]=n}function h(t,e){var n=a(t);return void 0===n[e]&&(n[e]=t.dataset?t.dataset[e]:i(t).attr("data-"+e)),n[e]}function l(t,e){var n=a(t);n?delete n[e]:t.dataset?delete t.dataset[e]:i(t).removeAttr("data-"+name)}function d(t){return k(t)&&t.match(j)}function p(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}function v(t,e,n){t.classList?t.classList.add(e):n.indexOf(" "+e+" ")&&(t.className+=" "+e)}function m(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(e,"")}function g(t,e){return parseInt(S.getComputedStyle(t[0],null)[e],10)||0}function y(t,e,n){var r=h(t,"_cashEvents")||f(t,"_cashEvents",{});r[e]=r[e]||[],r[e].push(n),t.addEventListener(e,n)}function b(t,e,n){var r,i=h(t,"_cashEvents"),u=i&&i[e];u&&(n?(t.removeEventListener(e,n),r=u.indexOf(n),r>=0&&u.splice(r,1)):(o(u,function(n){t.removeEventListener(e,n)}),u=[]))}function x(t,e){return"&"+encodeURIComponent(t)+"="+encodeURIComponent(e).replace(/%20/g,"+")}function L(t){var e=[];return o(t.options,function(t){t.selected&&e.push(t.value)}),e.length?e:null}function N(t){var e=t.selectedIndex;return e>=0?t.options[e].value:null}function C(t){var e=t.type;if(!e)return null;switch(e.toLowerCase()){case"select-one":return N(t);case"select-multiple":return L(t);case"radio":return t.checked?t.value:null;case"checkbox":return t.checked?t.value:null;default:return t.value?t.value:null}}function E(t,e,n){if(n){var r=t.childNodes[0];t.insertBefore(e,r)}else t.appendChild(e)}function T(t,e,n){var r=k(e);return!r&&e.length?void o(e,function(e){return T(t,e,n)}):void o(t,r?function(t){return t.insertAdjacentHTML(n?"afterbegin":"beforeend",e)}:function(t,r){return E(t,0===r?e:e.cloneNode(!0),n)})}var w,A=document,S=window,M=Array.prototype,B=M.slice,I=M.filter,H=M.push,O=function(){},P=function(t){return typeof t==typeof O&&t.call},k=function(t){return"string"==typeof t},R=/^#[\w-]*$/,q=/^\.[\w-]*$/,D=/<.+>/,W=/^\w+$/,$=i.fn=i.prototype=r.prototype={cash:!0,length:0,push:H,splice:M.splice,map:M.map,init:r};Object.defineProperty($,"constructor",{value:i}),i.parseHTML=e,i.noop=O,i.isFunction=P,i.isString=k,i.extend=$.extend=function(t){t=t||{};var e=B.call(arguments),n=e.length,r=1;for(1===e.length&&(t=this,r=0);r<n;r++)if(e[r])for(var i in e[r])e[r].hasOwnProperty(i)&&(t[i]=e[r][i]);return t},i.extend({merge:function(t,e){for(var n=+e.length,r=t.length,i=0;i<n;r++,i++)t[r]=e[i];return t.length=r,t},each:o,matches:u,unique:c,isArray:Array.isArray,isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}});var _=i.uid="_cash"+Date.now();$.extend({data:function(t,e){if(k(t))return void 0===e?h(this[0],t):this.each(function(n){return f(n,t,e)});for(var n in t)this.data(n,t[n]);return this},removeData:function(t){return this.each(function(e){return l(e,t)})}});var j=/\S+/g;$.extend({addClass:function(t){var e=d(t);return e?this.each(function(t){var n=" "+t.className+" ";o(e,function(e){v(t,e,n)})}):this},attr:function(t,e){if(t){if(k(t))return void 0===e?this[0]?this[0].getAttribute?this[0].getAttribute(t):this[0][t]:void 0:this.each(function(n){n.setAttribute?n.setAttribute(t,e):n[t]=e});for(var n in t)this.attr(n,t[n]);return this}},hasClass:function(t){var e=!1,n=d(t);return n&&n.length&&this.each(function(t){return e=p(t,n[0]),!e}),e},prop:function(t,e){if(k(t))return void 0===e?this[0][t]:this.each(function(n){n[t]=e});for(var n in t)this.prop(n,t[n]);return this},removeAttr:function(t){return this.each(function(e){e.removeAttribute?e.removeAttribute(t):delete e[t]})},removeClass:function(t){if(!arguments.length)return this.attr("class","");var e=d(t);return e?this.each(function(t){o(e,function(e){m(t,e)})}):this},removeProp:function(t){return this.each(function(e){delete e[t]})},toggleClass:function(t,e){if(void 0!==e)return this[e?"addClass":"removeClass"](t);var n=d(t);return n?this.each(function(t){var e=" "+t.className+" ";o(n,function(n){p(t,n)?m(t,n):v(t,n,e)})}):this}}),$.extend({add:function(t,e){return c(i.merge(this,i(t,e)))},each:function(t){return o(this,t),this},eq:function(t){return i(this.get(t))},filter:function(t){if(!t)return this;var e=P(t)?t:s(t);return i(I.call(this,function(n){return e(n,t)}))},first:function(){return this.eq(0)},get:function(t){return void 0===t?B.call(this):t<0?this[t+this.length]:this[t]},index:function(t){var e=t?i(t)[0]:this[0],n=t?this:i(e).parent().children();return B.call(n).indexOf(e)},last:function(){return this.eq(-1)}});var F=function(){var t=/(?:^\w|[A-Z]|\b\w)/g,e=/[\s-_]+/g;return function(n){return n.replace(t,function(t,e){return t[0===e?"toLowerCase":"toUpperCase"]()}).replace(e,"")}}(),U=function(){var t={},e=document,n=e.createElement("div"),r=n.style;return function(e){if(e=F(e),t[e])return t[e];var n=e.charAt(0).toUpperCase()+e.slice(1),i=["webkit","moz","ms","o"],u=(e+" "+i.join(n+" ")+n).split(" ");return o(u,function(n){if(n in r)return t[n]=e=t[e]=n,!1}),t[e]}}();i.prefixedProp=U,i.camelCase=F,$.extend({css:function(t,e){if(k(t))return t=U(t),arguments.length>1?this.each(function(n){return n.style[t]=e}):S.getComputedStyle(this[0])[t];for(var n in t)this.css(n,t[n]);return this}}),o(["Width","Height"],function(t){var e=t.toLowerCase();$[e]=function(){return this[0].getBoundingClientRect()[e]},$["inner"+t]=function(){return this[0]["client"+t]},$["outer"+t]=function(e){return this[0]["offset"+t]+(e?g(this,"margin"+("Width"===t?"Left":"Top"))+g(this,"margin"+("Width"===t?"Right":"Bottom")):0)}}),$.extend({off:function(t,e){return this.each(function(n){return b(n,t,e)})},on:function(t,e,r,i){var o;if(!k(t)){for(var s in t)this.on(s,e,t[s]);return this}return P(e)&&(r=e,e=null),"ready"===t?(n(r),this):(e&&(o=r,r=function(t){for(var n=t.target;!u(n,e);){if(n===this)return n=!1;n=n.parentNode}n&&o.call(n,t)}),this.each(function(e){var n=r;i&&(n=function(){r.apply(this,arguments),b(e,t,n)}),y(e,t,n)}))},one:function(t,e,n){return this.on(t,e,n,!0)},ready:n,trigger:function(t,e){var n=A.createEvent("HTMLEvents");return n.data=e,n.initEvent(t,!0,!1),this.each(function(t){return t.dispatchEvent(n)})}}),$.extend({serialize:function(){var t="";return o(this[0].elements||this,function(e){if(!e.disabled&&"FIELDSET"!==e.tagName){var n=e.name;switch(e.type.toLowerCase()){case"file":case"reset":case"submit":case"button":break;case"select-multiple":var r=C(e);null!==r&&o(r,function(e){t+=x(n,e)});break;default:var i=C(e);null!==i&&(t+=x(n,i))}}}),t.substr(1)},val:function(t){return void 0===t?C(this[0]):this.each(function(e){return e.value=t})}}),$.extend({after:function(t){return i(t).insertAfter(this),this},append:function(t){return T(this,t),this},appendTo:function(t){return T(i(t),this),this},before:function(t){return i(t).insertBefore(this),this},clone:function(){return i(this.map(function(t){return t.cloneNode(!0)}))},empty:function(){return this.html(""),this},html:function(t){if(void 0===t)return this[0].innerHTML;var e=t.nodeType?t[0].outerHTML:t;return this.each(function(t){return t.innerHTML=e})},insertAfter:function(t){var e=this;return i(t).each(function(t,n){var r=t.parentNode,i=t.nextSibling;e.each(function(t){r.insertBefore(0===n?t:t.cloneNode(!0),i)})}),this},insertBefore:function(t){var e=this;return i(t).each(function(t,n){var r=t.parentNode;e.each(function(e){r.insertBefore(0===n?e:e.cloneNode(!0),t)})}),this},prepend:function(t){return T(this,t,!0),this},prependTo:function(t){return T(i(t),this,!0),this},remove:function(){return this.each(function(t){return t.parentNode.removeChild(t)})},text:function(t){return void 0===t?this[0].textContent:this.each(function(e){return e.textContent=t})}});var z=A.documentElement;$.extend({position:function(){var t=this[0];return{left:t.offsetLeft,top:t.offsetTop}},offset:function(){var t=this[0].getBoundingClientRect();return{top:t.top+S.pageYOffset-z.clientTop,left:t.left+S.pageXOffset-z.clientLeft}},offsetParent:function(){return i(this[0].offsetParent)}}),$.extend({children:function(t){var e=[];return this.each(function(t){H.apply(e,t.children)}),e=c(e),t?e.filter(function(e){return u(e,t)}):e},closest:function(t){return!t||this.length<1?i():this.is(t)?this.filter(t):this.parent().closest(t)},is:function(t){if(!t)return!1;var e=!1,n=s(t);return this.each(function(r){return e=n(r,t),!e}),e},find:function(e){if(!e||e.nodeType)return i(e&&this.has(e).length?e:null);var n=[];return this.each(function(r){H.apply(n,t(e,r))}),c(n)},has:function(e){var n=k(e)?function(n){return 0!==t(e,n).length}:function(t){return t.contains(e)};return this.filter(n)},next:function(){return i(this[0].nextElementSibling)},not:function(t){if(!t)return this;var e=s(t);return this.filter(function(n){return!e(n,t)})},parent:function(){var t=[];return this.each(function(e){e&&e.parentNode&&t.push(e.parentNode)}),c(t)},parents:function(t){var e,n=[];return this.each(function(r){for(e=r;e&&e.parentNode&&e!==A.body.parentNode;)e=e.parentNode,(!t||t&&u(e,t))&&n.push(e)}),c(n)},prev:function(){return i(this[0].previousElementSibling)},siblings:function(){var t=this.parent().children(),e=this[0];return t.filter(function(t){return t!==e})}});var z=A.documentElement;return $.extend({jqPosition:function(){var t=this[0];if(t){var e,n,r,o,u=i(t),s={top:0,left:0};if("fixed"===u.css("position"))r=t.getBoundingClientRect();else{for(r=this.offset(),o=t.ownerDocument,e=t.offsetParent||z,n=i(e);e&&(e===o.body||e===z)&&"static"===n.css("position");)e=e.parentNode;e&&e!==t&&1===e.nodeType&&(s=n.offset(),s.top+=parseInt(n.css("borderTopWidth"),10)||0,s.left+=parseInt(n.css("borderLeftWidth"),10)||0)}return{top:r.top-s.top-(parseInt(u.css("marginTop"),10)||0),left:r.left-s.left-(parseInt(u.css("marginLeft"),10)||0)}}}}),i});
define("/svc/cdn/pub/dom_util.js",["cash"],function($){var E={};E.is_resize_observer_supported=typeof ResizeObserver=="function";function class_re(cls){return new RegExp("(^|\\s)"+cls+"($|\\s)")}E.get_elm_resolution=function(elm){var st=elm&&getComputedStyle(elm);if(!st||isNaN(parseInt(st.width))||isNaN(parseInt(st.height)))return;var full_screen=!(document.fullScreenElement===null||document.msFullscreenElement===null||document.mozFullScreen!==undefined&&!document.mozFullScreen||document.webkitIsFullScreen!==undefined&&!document.webkitIsFullScreen);return{width:parseInt(st.width,10),height:parseInt(st.height,10),full_screen:full_screen}};E.get_full_elm_selector=function(elm,skip_class){if(elm&&elm.nodeType==document.DOCUMENT_FRAGMENT_NODE)return"DOCUMENT_FRAGMENT_NODE";return elm.tagName.toLowerCase()+(elm.id?"#"+elm.id:"")+(skip_class||!elm.className?"":(" "+elm.className).replace(/\s+/g,"."))};E.get_elm_selector_path=function(elm,skip_class){return $(elm).add($(elm).parents()).map(function(el){return E.get_full_elm_selector(el,skip_class)}).reverse().join(">")};E.closest=function(elm,selector){if(elm.closest)return elm.closest(selector);if(elm.matches){if(!document.documentElement.contains(elm))return null;do{if(elm.matches(selector))return elm;elm=elm.parentElement}while(elm)}return null};E.matches=function(elm,selector){var method=["matches","matchesSelector","mozMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector"].find(function(m){return typeof elm[m]=="function"});if(method)return elm[method](selector);var matches=(elm.document||elm.ownerDocument).querySelectorAll(selector);var i=matches.length;while(--i>=0&&matches.item(i)!=elm);return i>-1};E.remove=function(elm){if(elm.parentNode)elm.parentNode.removeChild(elm)};E.has_class=function(elm,cls){if(elm.classList)return elm.classList.contains(cls);return class_re(cls).test(elm.className)};E.is_visible=function(elem){return!!(elem&&(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length))};E.detect_direction=function(el){if(el&&el.length)el=el[0];var dir="ltr",w=window;for(;;){var styles=getComputedStyle(el);if(!styles)break;var d=styles.direction;if(d!=dir){dir=d;break}try{if(!(el=w.frameElement))break;el=el.parentElement;w=w.parent;continue}catch(e){break}}return dir};E.space_occupied=function(container,element){var top=Math.max(container.top,element.top);var right=Math.min(container.right,element.right);var bottom=Math.min(container.bottom,element.bottom);var left=Math.max(container.left,element.left);if(top>=bottom||left>=right)return 0;return(bottom-top)*(right-left)/((element.bottom-element.top)*(element.right-element.left))};E.visual_viewport=function(){var vp;if(vp=window.visualViewport){return{top:vp.offsetTop,bottom:vp.offsetTop+vp.height,left:vp.offsetLeft,right:vp.offsetLeft+vp.width,height:vp.height,width:vp.width}}var root_rect=document.documentElement.getBoundingClientRect();return{top:root_rect.top+window.pageYOffset,bottom:root_rect.top+window.pageYOffset+window.innerHeight,left:root_rect.left+window.pageXOffset,right:root_rect.left+window.pageXOffset+window.innerWidth,height:window.innerHeight,width:window.innerWidth}};E.client_rect2page_rect=function(rect){var root_rect=document.documentElement.getBoundingClientRect();return{top:rect.top-root_rect.top,bottom:rect.bottom-root_rect.bottom,left:rect.left-root_rect.left,right:rect.right-root_rect.right,height:rect.height,width:rect.width}};E.in_front=function(el,rect){rect=rect||$(el)[0].getBoundingClientRect();var w=rect.width||rect.right-rect.left;var h=rect.hight||rect.bottom-rect.top;var p=$(document.elementFromPoint(rect.left+w/2,rect.top+h/2));return p.closest(el).length||$(el).closest(p.parent()).length};E.preload_css=function(url,doc){if(!doc)doc=document;var css=doc.createElement("link");css.rel="stylesheet";css.href=url;doc.head.appendChild(css)};E.is_img_loaded=function(img){return img.width>1&&img.naturalWidth>1||img.tagName!="IMG"&&img.offsetWidth>1||img.tagName=="PICTURE"&&img.getBoundingClientRect().width>1};E.on_img_load=function(img,cb){var off,unwatch;var on_load=function(){off();if(img.style.display!="none")return void cb();unwatch=E.attr_watch(img,{attr:"style",watch_fn:function(){if(img.style.display=="none")return;unwatch();unwatch=null;cb()}})};off=function(){$(img).off("load",on_load)};$(img).on("load",on_load);return function(){off();if(unwatch)unwatch($(img).off("load",on_load))}};E.is_convertible_to_cashjs=function(val){if(typeof val=="string"||Array.isArray(val))return true;if(typeof window=="undefined")return false;return val instanceof window.Node||val instanceof window.NodeList||val instanceof window.HTMLCollection};E.is_passive_supported=function(){var res=false;try{var opt=Object.defineProperty({},"passive",{get:function(){res=true}});window.addEventListener("__spark_test_passive",null,opt)}catch(e){}return res}();E.non_passive_listener=function(el,ev,handler){if(E.is_passive_supported)return el.addEventListener(ev,handler,{passive:false});el.addEventListener(ev,handler,false)};E.get_fullscreen_element=function(doc){doc=doc||document;return doc.fullscreenElement||doc.mozFullScreenElement||doc.webkitFullscreenElement||doc.msFullscreenElement};E.get_mid_rect=function(h_percentage,w_percentage){h_percentage=(h_percentage||100)/100;w_percentage=(w_percentage||100)/100;var vp=E.visual_viewport();var mid_y=vp.top+vp.height/2;var mid_x=vp.left+vp.width/2;var height=vp.height*h_percentage|0;var width=vp.width*w_percentage|0;return{top:mid_y-height/2|0,left:mid_x-width/2|0,bottom:mid_y+height/2|0,right:mid_x+width/2|0,height:height,width:width}};E.in_rect=function(el,container,is_inside){if(is_inside){return el.top>=container.top&&el.bottom<=container.bottom&&el.left>=container.left&&el.right<=container.right}return el.bottom>=container.top&&el.top<=container.bottom&&el.right>=container.left&&el.left<=container.right};E.add_style=function(attr,css,parent){if(!attr)return;parent=parent||document.head||document.querySelector("head");if(!parent)return;if(parent.querySelector("["+attr+"]"))return;var style=document.createElement("style");style.setAttribute(attr,"");style.innerHTML=css;parent.appendChild(style)};E.offset=function(el){var rect=el.getBoundingClientRect();var doc_el=document.documentElement;return{top:rect.top+window.pageYOffset-doc_el.clientTop,left:rect.left+window.pageXOffset-doc_el.clientLeft}};E.width=function(el){return el.getBoundingClientRect().width};E.height=function(el){return el.getBoundingClientRect().height};E.position=function(el){return{left:el.offsetLeft,top:el.offsetTop}};E.style_important=function(el,css){if(!el||!el.style||!el.style.setProperty)return;for(var property in css)el.style.setProperty(property,css[property],"important")};E.remove=function(el){if(el&&el.length)el=el[0];return el&&el.parentNode&&el.parentNode.removeChild(el)};E.is_fullscreen=function(){return document.fullScreenElement||document.msFullscreenElement||document.mozFullScreen||document.webkitIsFullScreen};E.offset_parent=function(el){var res=null,cur_el=$(el).parent(),tr;while(!res&&cur_el[0].tagName!="HTML"){if(["relative","absolute","fixed"].includes(cur_el.css("position"))||(tr=cur_el.css("transform"))&&tr!="none"){res=cur_el.offset()}cur_el=cur_el.parent()}return res};E.get_position=function(el){var parent_offset=E.offset_parent(el);if(!parent_offset)parent_offset={left:0,top:0};var el_offset=$(el).offset();return{left:el_offset.left-parent_offset.left,top:el_offset.top-parent_offset.top}};E.parse_bg_image=function(bg){var res=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/i.exec(bg);return res&&(res[2]||res[3]||res[4])};E.pointer_within=function(el,ev){if(!ev||!/^mouse|^touch/.test(ev.type))return;var r=$(el)[0].getBoundingClientRect();if(r.top<0&&$(el).parents().filter(function(p){return $(p).css("position")=="sticky"}).length){return true}ev=ev.changedTouches&&ev.changedTouches[0]||ev;return ev.clientX<=r.right+3&&ev.clientX>=r.left-3&&ev.clientY<=r.bottom+3&&ev.clientY>=r.top-3};E.is_el_allowed_by_css=function(el,filter){if(!filter)return true;var include=filter.include||[];var exclude=filter.exclude||[];function match(selector){if(!selector||!el)return false;return el.matches(selector)}if(exclude.find(match))return false;if(!include.length||include.find(match))return true;return false};E.is_el_in_page=function(el){return document.documentElement&&document.documentElement.contains(el)};E.get_page_info=function(){var el=document.querySelector('meta[property="og:title"]');var title=el&&el.getAttribute("content")||document.title;el=document.querySelector('meta[property="og:image"]');var poster=el&&el.getAttribute("content");el=document.querySelector('meta[property="og:url"]');var url=el&&el.getAttribute("content")||typeof location!="undefined"&&location.href;return{poster:poster,title:title,url:url}};E.force_redraw=function(el){if(el.length)el=el[0];var display=el.style.display;el.style.display="none";if(el.offsetHeight||true)el.style.display=display};E.dom_listen=function(el,on_dom_change){if(!window.MutationObserver)return function(){};var observer=new window.MutationObserver(on_dom_change);observer.observe(el,{childList:true,subtree:true});E.dom_listen.using_observer=true;return observer.disconnect.bind(observer)};E.attr_watch=function(element,opt){function onchange(from,to){var re;if(re=opt.toggle_pattern){if(re.test(to)==re.test(from))return;from=(from&&from.match(re)||[])[0];to=(to&&to.match(re)||[])[0]}else if(re=opt.change_pattern){from=(from&&from.match(re)||[])[0];to=(to&&to.match(re)||[])[0];if(from==to)return}opt.watch_fn(from,to)}if(window.MutationObserver){var observer=new window.MutationObserver(function(mutations){var first;if(first=mutations.find(function(record){return record.attributeName==opt.attr})){onchange(first.oldValue,element.getAttribute(opt.attr))}});observer.observe(element,{attributes:true,attributeOldValue:true});return observer.disconnect.bind(observer)}};return E});
define("/svc/cdn/pub/stats.js",{__stub:1});

define("/svc/cdn/pub/analysis.js",{__stub:1});
define("/svc/cdn/pub/shaka.js",{__stub:1});
define("/svc/cdn/pub/dash.js",{__stub:1});
define("/svc/cdn/pub/hls.js",{__stub:1});








define("/svc/cdn/pub/dailymotion.js",["/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/log.js","/svc/cdn/pub/hls.js","/svc/cdn/pub/perr.js"],function(zutil,util,log,hls,perr){var E={};var ERR=util.ERR;var CG=util.gconf_get;var assign=Object.assign;E.Module=function(opt){var _this=this;util.events.call(this);this.name="dailymotion";this.event_list=["started","error","quality_level","manifest_parsed","manifest_loaded","level_loaded","detached","seg_stats","buf_stats","level_updated","frag_load_stats","system_seek"];this.levels=undefined;this.bitrate={};this.level_url={};this.log=opt.log.set_module("dailymotion");this.dailymotion=opt.dailymotion;this.player=opt.player;this.vjs=opt.vjs;this.hls=this.dailymotion.constructor;this.state=(this.last_started_url=this.get_url())&&(!opt.state||opt.state=="IDLE")?"PAUSED":opt.state||"IDLE";this.log.notice("using hls.js version "+this.hls.version);if(zutil.get(this.dailymotion,"config.debug.hola_log_attach"))this.dailymotion.config.debug.hola_log_attach(this.log);this.config={dm_conf:CG("loader.player.dailymotion.config"),extended_logs:CG("loader.player.dailymotion.log")};if(this.config.extended_logs){if(!this.dailymotion.holaLog)this.dailymotion.holaLog=E.create_dm_log(this.log)}if(this.config.dm_conf){assign(this.dailymotion.config,this.config.dm_conf)}this.est_bytes=0;function change_state(state){var prev=_this.state;if(prev==state)return;_this.state=state;if(prev=="IDLE"){_this.emit("started",_this.last_started_url=(_this.player||_this).get_url())}}this.dm_handlers={};this.dm_handlers[this.hls.Events.MANIFEST_LOADING]=function(e,d){var prev=_this.state;if(_this.last_started_url!=d.url)change_state("IDLE");change_state(prev=="PLAYING"?prev:"PAUSED")};this.dm_handlers[this.hls.Events.MANIFEST_LOADED]=function(){_this.emit("manifest_loaded");if(_this.state!="PLAYING")change_state("PAUSED")};this.player.on("pre-state",change_state);this.dm_handlers[this.hls.Events.MEDIA_DETACHED]=function(){_this.emit("detached")};this.dm_handlers[this.hls.Events.LEVEL_LOADED]=function(e,lvl){_this.emit("level_loaded",lvl.level)};this.dm_handlers[this.hls.Events.ERROR]=function(e,d){var d_resp=d.response||{},d_err=d.err||{};var type=d.details,ed=_this.hls.ErrorDetails,r;var sys_seeks=[ed.BUFFER_SEEK_OVER_HOLE,ed.BUFFER_NUDGE_ON_STALL];var err={type:d.type,details:type,fatal:d.fatal,url:d.url,frag_url:d.frag&&d.frag.url,reason:d.reason||"",hls_err:d.err&&d.err.stack,status:d_resp.status};_this.log[d.fatal?"err":"info"]("Dailymotion "+(d.fatal?"fatal error":"warn")+" "+d.type+" "+type+(err.frag_url?" "+err.frag_url:"")+(d.reason?" reason "+d.reason:"")+" level "+d.level+" frag "+d.frag+" "+util.zerr_json(d));if(err.hls_err)_this.log[d.fatal?"err":"info"](err.hls_err);if(type==ed.BUFFER_STALLED_ERROR&&_this.config.extended_logs){var media=_this.dailymotion.media;err.stall=d.buffer>.5?"high":"low";_this.log.info(err.stall+" buffer stall, state "+media.readyState+" rate "+media.playbackRate+" buffer "+d.buffer)}if(sys_seeks.includes(type))_this.emit("system_seek");if(d.fatal)perr({id:"player_dm_error",info:{err:err},delay:!d.fatal});if(!d.fatal)return;var map={MANIFEST_LOAD_ERROR:{reason:"manifest_load",url:d.url,status:d_resp.status},MANIFEST_LOAD_TIMEOUT:{reason:"manifest_load",url:d.url},MANIFEST_PARSING_ERROR:{reason:"manifest_parse",url:d.url,message:d.reason},MANIFEST_INCOMPATIBLE_CODECS_ERROR:{reason:"manifest_parse",url:d.url,message:d.reason},LEVEL_LOAD_ERROR:{reason:"manifest_load",url:d.url,status:d_resp.status,level:d.level},LEVEL_LOAD_TIMEOUT:{reason:"manifest_load",url:d.url,level:d.level},LEVEL_SWITCH_ERROR:{reason:"other",level:d.level,message:d.reason},FRAG_LOAD_ERROR:{reason:"media_load",url:err.frag_url},FRAG_LOOP_LOADING_ERROR:{reason:"media_load"},FRAG_LOAD_TIMEOUT:{reason:"media_load"},FRAG_DECRYPT_ERROR:{reason:"media_decode",message:d.reason},FRAG_PARSING_ERROR:{reason:"media_decode",message:d.reason},KEY_LOAD_ERROR:{reason:"manifest_load",url:err.frag_url,status:(d_resp.currentTarget||d_resp).status},KEY_LOAD_TIMEOUT:{reason:"manifest_load",url:err.frag_url},BUFFER_ADD_CODEC_ERROR:{reason:"media_decode",message:d_err.message},BUFFER_APPEND_ERROR:{reason:"media_decode",url:err.frag_url},BUFFER_APPENDING_ERROR:{reason:"media_decode"},BUFFER_STALLED_ERROR:{reason:"other"},BUFFER_FULL_ERROR:{reason:"other"},BUFFER_SEEK_OVER_HOLE:{reason:"other"},unknown:{reason:"other",message:"unknown"}};r=zutil.find(map,function(v,k){return type==ed[k]});_this.emit("error",r?assign({message:type},r):map.unknown)};this.dm_handlers[this.hls.Events.LEVEL_UPDATED]=function(e,lvl){if(!_this.levels)_this.get_levels();else _this.update_levels();_this.emit("level_updated",lvl.level)};this.dm_handlers[this.hls.Events.FRAG_PARSING_DATA]=function(e,data){if(data.endDTS>=data.startDTS&&data.endDTS-data.startDTS<20&&(data.deltaPTS||0)<2){return}var sc=util.get_hls_sc(_this.dailymotion),frag=sc.fragCurrent||{};perr({id:"segment_len_error",info:{sn:frag.sn,level:frag.level,s_dts:data.startDTS,e_dts:data.endDTS,delta:data.deltaPTS||0},add_log:true})};if(this.hls.Events.FRAG_STATISTICS){var prev_st,sent;this.dm_handlers[this.hls.Events.FRAG_STATISTICS]=function(e,d){function fmt(keymap){var res="",obj;["idr","indr","sei"].forEach(function(name){if(!keymap[name]||!keymap[name].length)return;obj=keymap[name].map(function(e){return e.sn});res+=name+"=["+obj.join(",")+"] "});["sps","pps"].forEach(function(name){if(obj=keymap[name]&&keymap[name][0]){try{res+=name+"=["+obj.join(",")+"] "}catch(e){_this.log.info("abnormal object: "+name+" "+Object.prototype.toString.call(obj))}}});return res}if(_this.config.extended_logs){if(d.videoDurStd||d.audioDurStd||d.cttsError){_this.log.info("remux seg "+d.segment+"/"+d.level+" ctts_err="+d.cttsError+", video_dur="+(d.videoDurAvg||0).toFixed(2)+"/"+(d.videoDurStd||0).toFixed(2)+", audio_dur="+(d.audioDurAvg||0).toFixed(2)+"/"+(d.audioDurStd||0).toFixed(2))}if(d.keymap){_this.log.info("remux seg "+d.segment+"/"+d.level+" keymap: "+fmt(d.keymap))}}if(!sent&&prev_st&&prev_st.segment+1==d.segment&&!prev_st.keyFrames&&!d.keyFrames){perr({id:"segment_no_keyframe",info:{sn:d.segment-1,video_source_error:"keyframe not found in continuos "+"segments",level:d.level}});sent=true}prev_st=d;if(d.audioGap){d=zutil.clone(d);d.audioGap={cnt:d.audioGap.length,min:Math.round(Math.min.apply(null,d.audioGap)),max:Math.round(Math.max.apply(null,d.audioGap))}}_this.emit("seg_stats",d)}}if(this.hls.Events.BUF_STATISTICS){this.dm_handlers[this.hls.Events.BUF_STATISTICS]=function(e,d){_this.emit("buf_stats",d)}}if(this.hls.Events.FRAG_BUFFERED){this.dm_handlers[this.hls.Events.FRAG_BUFFERED]=function(e,d){_this.emit("frag_load_stats",d)}}this.dm_handlers[this.hls.Events.FRAG_LOADED]=function(n,info){_this.est_bytes+=info.stats.loaded};var e;if(this.dailymotion.hola_events_cb){for(e in this.hls.Events){this.dailymotion.off(this.hls.Events[e],this.dailymotion.hola_events_cb)}}for(e in this.dm_handlers)this.dailymotion.on(e,this.dm_handlers[e])};zutil.inherits(E.Module,util.events);E.Module.prototype.get_url=function(){return this.dailymotion.url};E.Module.prototype.get_current_fragment=function(){var sc=util.get_hls_sc(this.dailymotion);if(!sc)return;var frag=sc.fragCurrent;return{index:frag.sn,qid:frag.level,url:frag.url,duration:frag.duration}};E.Module.prototype.is_live_stream=function(){var levels=this.dailymotion.levels;if(!levels)return;var loaded_lvl=levels.find(function(lvl){return lvl.details});return loaded_lvl&&!!loaded_lvl.details.live};E.Module.prototype.get_bitrate=function(){var level;try{level=this.dailymotion.currentLevel}catch(e){return 0}if(level<0){var frag=util.get_hls_sc(this.dailymotion).fragPrevious;level=frag?frag.level:this.dailymotion.loadLevel;if(typeof level!="number"||level<0)return 0}return this.dailymotion.levels[level].bitrate};E.Module.prototype.is_bitrate_supported=function(){var levels=this.dailymotion.levels;return levels&&levels.length>1||levels[0]&&levels[0].bitrate!==undefined};E.Module.prototype.get_levels=function(cached){if(cached&&this.levels)return this.levels;var levels=this.dailymotion.levels;var ret={},_this=this;if(!levels||!levels.length)return ret;levels.forEach(function(level,idx){var url=level.url.length&&level.url[0];var fragments=level.details&&level.details.fragments;if(!url||ret[url]||!fragments)return;var _level=ret[url]={url:url,level_idx:idx,segments:[]};var bitrate=_this.bitrate[url]=_level.bitrate=level.bitrate;_this.level_url[idx]=url;fragments.forEach(function(frag){_level.segments.push({playlist_url:url,media_index:frag.sn,duration:frag.duration,url:frag.url,bitrate:bitrate})})});return this.levels=ret};E.Module.prototype.update_levels=function(){var levels=this.dailymotion.levels;if(!levels||!levels.length)return;var _this=this,lvls=this.levels;levels.forEach(function(level,idx){var url=level.url.length&&level.url[0],old_url,_level,_segs;var fragments=level.details&&level.details.fragments;if(!url||!fragments||!(old_url=_this.level_url[idx])||!(_level=lvls[old_url])||!(_segs=_level.segments)){return}if(url!=old_url){lvls[url]=_level;delete lvls[old_url];_level.url=url;_this.level_url[idx]=url}if(_segs.length!=fragments.length)_segs.splice(0);for(var fidx in fragments){var frag=fragments[fidx];_segs[fidx]={playlist_url:url,media_index:frag.sn,duration:frag.duration,url:frag.url,bitrate:level.bitrate}}});return lvls};E.Module.prototype.get_playlists=function(){var levels=this.dailymotion.levels,ret=[],p,_this=this;if(!levels)return;levels.forEach(function(level,idx){if(p=_this.get_playlist(idx,true))ret.push(p)});ret.sort(function(a,b){return Math.sign(a.bitrate-b.bitrate)});return ret.length?ret:undefined};E.Module.prototype.get_playlist=function(idx,with_segments){var levels=this.dailymotion.levels;if(!levels)return;var level=levels[idx];if(!level)return;var url=level.url.length&&level.url[0];var fragments=level.details&&level.details.fragments;if(!url)return;var p={playlist:url,url:url,level_idx:idx,attributes:{bandwidth:level.bitrate,audio:level.audioCodec,video:level.videoCodec}};var attr=p.attributes,bitrate=p.bitrate=attr.bandwidth;attr.live=level.details&&level.details.live;if(level.width!=undefined&&level.height!=undefined)attr.resolution={width:level.width,height:level.height};if(!with_segments||!fragments||!fragments.length)return p;p.segments=[];fragments.forEach(function(frag,i){var o={playlist_url:url,media_index:frag.sn,duration:frag.duration,url:frag.url,bitrate:bitrate,from:frag.byteRangeStartOffset,to:frag.byteRangeEndOffset};p.segments.push(o);p.segments["media_index_"+frag.sn]=o});return p};E.Module.prototype.get_current_playlist=function(with_segments){if(!util.get_hls_sc(this.dailymotion).bufferRange)return;var idx=this.dailymotion.currentLevel;return this.get_playlist(idx,with_segments)};E.Module.prototype.get_segment_info=function(){};E.Module.prototype.get_current_level=function(){if(!util.get_hls_sc(this.dailymotion).bufferRange)return;var level=this.dailymotion.currentLevel;if(level===undefined)return;if(!this.level_url[level])this.get_levels();return this.level_url[level]};E.Module.prototype.get_state=function(){return this.state};E.Module.prototype.is_paused=function(){return this.state=="PAUSED"};E.Module.prototype.is_playing=function(){return this.state=="PLAYING"};E.Module.prototype.is_idle=function(){return this.state=="IDLE"};E.Module.prototype.play=function(){var dm=this.dailymotion,media=dm.media;if(media)media.play()};E.Module.prototype.pause=function(){var dm=this.dailymotion,media=dm.media;if(media)media.pause()};E.Module.prototype.hap_enabled=function(){return zutil.is_mocha()||util.is_hola_hls_js(this.dailymotion)};E.Module.prototype.play_url=function(url,opt){opt=opt||{};var vjs;if(vjs=this.vjs){var force_native=function(vjs,enable){var tech=vjs.techName_=="Html5"&&vjs.tech_&&vjs.tech_.constructor;if(!tech)return;if(enable){tech.__sourceHandlers__=tech.sourceHandlers;tech.sourceHandlers=[tech.nativeSourceHandler]}else{tech.sourceHandlers=tech.__sourceHandlers__;delete tech.__sourceHandlers__}};setTimeout(function(){if(opt.prefer_native)force_native(vjs,true);vjs.src(url);if(opt.pos){vjs.on("canplay",function cb(){vjs.off("canplay",cb);vjs.currentTime(opt.pos)})}if(!opt.is_paused)vjs.play();if(opt.prefer_native)force_native(vjs,false)});return}var dm=this.dailymotion,media=dm.media;if(!media)return;dm.detachMedia();if(opt.prefer_native){if(opt.pos){media.addEventListener("loadedmetadata",function cb(){media.removeEventListener("loadedmetadata",cb);media.currentTime=opt.pos})}media.src=url}else{dm.attachMedia(media);if(opt.pos)media.currentTime=opt.pos;if(!dm.config.autoStartLoad)dm.startLoad(opt.pos?opt.pos:-1)}if(!opt.is_paused)media.play()};E.Module.prototype.get_est_bytes=function(){return{bytes:this.est_bytes,src:this.name}};E.Module.prototype.get_versions=function(){var ver={};ver[util.is_hola_hls_js(this.dailymotion)?"hola_hls":"dm_hls"]=this.hls.version;return ver};E.Module.prototype.enable_data_mode=function(on_sourceopen){};E.Module.prototype.init_adaptive=function(adaptive){var _hls=this.dailymotion,_this=this;var hola_hls=util.is_hola_hls_js(_hls);this.old_floader=_hls.config.fLoader;_hls.config.fLoader=function(){return new Loader({log:_this.log,zone:adaptive.bws.zone,adaptive:adaptive,hola_hls:hola_hls})};adaptive.on("uninit",function(){_this.dailymotion.config.fLoader=_this.old_floader});adaptive.on("seg_complete",function(req){util.update_fake_xhr(req)})};E.Module.prototype.init_ploader=function(ploader){var _hls=this.dailymotion;var config={log:this.log,zone:ploader.bws.zone,hls:_hls,ploader:ploader};_hls.config.pLoader=function(){return new Loader(config)}};E.Module.prototype.uninit_ploader=function(){var dm=this.dailymotion,p_ldr=dm.playlistLoader;if(!dm.config||!dm.config.pLoader)return;delete dm.config.pLoader;if(!p_ldr.loading||!p_ldr.loader)return;p_ldr.loader.abort();p_ldr.loader=null;p_ldr.load(p_ldr.url,p_ldr.id,p_ldr.id2)};E.Module.prototype.uninit=function(){this.events.removeAllListeners();for(var e in this.dm_handlers)this.dailymotion.off(e,this.dm_handlers[e]);this.uninit_ploader();if(this.dailymotion.holaLog)delete this.dailymotion.holaLog;var sc=util.get_hls_sc(this.dailymotion);if(sc.skipCount)perr({id:"dm_skip_cnt",info:{skip:sc.skipCount}})};function Loader(opt){this.log=opt.log;this.zone=opt.zone;this.CG=this.zone.CG.bind(this.zone);this.adaptive=opt.adaptive;this.hls=opt.hls;this.ploader=opt.ploader}Loader.prototype.destroy=function(){this.abort();this.fake_xhr=null};Loader.prototype.abort=function(){clearTimeout(this.timeoutHandle);if(this.ploader)return this.ploader.abort(this.ml_state);if(!this.fake_xhr)return;this.stats.aborted=true;var req=this.fake_xhr.req;if(!req||req.error==ERR.aborted||req.info.rate)return;var other=req.info.overloaded||req.info.clone;req.abort();if(other&&other.error!=ERR.aborted)other.abort();if(this.adaptive)this.adaptive.remove_segment(this.segment)};Loader.prototype.load=function(context,config,callbacks){var args;if(typeof context=="string"){args=Array.prototype.slice.call(arguments);if(typeof config=="string")args.splice(1,0,null)}else{var _on_progress=function(event,stats,context){callbacks.onProgress(stats,context)};var _on_success=function(event,stats,context){callbacks.onSuccess({url:context.url,data:event.currentTarget.response},stats,context)};var _on_error=function(event,context){callbacks.onError(event.currentTarget,context)};var _on_timeout=function(event,stats,context){callbacks.onTimeout(stats,context)};args=[context.url,{frag:context.frag},context.responseType,_on_success,_on_error,_on_timeout,config.timeout,config.maxRetry,config.retryDelay,_on_progress,context.frag,callbacks.onChunk]}if(this.context=args.splice(1,1)[0])this.context.url=args[0];this.stable_load.apply(this,args)};Loader.prototype.stable_load=function(url,responseType,onSuccess,onError,onTimeout,timeout,maxRetry,retryDelay,onProgress,frag,on_chunk){var _this=this;this.log.info("load "+url);this.stats={trequest:window.performance.now(),retry:0};this.url=url;if(!frag){var level_id=this.hls.playlistLoader.id;this.ml_state=this.ploader.load({url:url,is_master:level_id==null,id:level_id!=null?this.hls.levelController.levels[level_id].bitrate:undefined,level:level_id,onprogress:this.loadprogress.bind(this),onsuccess:function(event){onSuccess(event,_this.stats,_this.context)},onerror:function(event){onError(event,_this.context)},ontimeout:function(event){onTimeout(event,_this.stats,_this.context)},timeout:timeout});return}this.responseType=responseType;this.onSuccess=onSuccess;this.onProgress=util.is_hola_hls_js(this.hls)?function(ev,st){onProgress(st)}:onProgress;this.onTimeout=onTimeout;this.onError=onError;this.streaming=!this.CG("cdn.send_reqs.disable_streaming")&&!!(this.on_chunk=on_chunk);this.maxRetry=Math.max(maxRetry,3);this.retryDelay=retryDelay;this.timeout=timeout;this.timeoutHandle=setTimeout(this.loadtimeout.bind(this),timeout);this.load_internal()};Loader.prototype.load_internal=function(){this.fake_xhr={onprogress:this.loadprogress.bind(this),onchunkdata:this.onchunkdata.bind(this)};var segment=this.segment={url:this.url,fake_xhr:this.fake_xhr,playlist_id:"def",streaming:this.streaming};if(this.adaptive)this.adaptive.init_segment(segment);this.stats.tfirst=0;this.stats.loaded=0;this.stats.aborted=undefined};Loader.prototype.loadtimeout=function(event){this.log.info("timeout, req is "+this.fake_xhr.req.name);if(!this.CG("player.dailymotion.no_timeout"))this.onTimeout(event,this.stats,this.context)};Loader.prototype.loadprogress=function(event){var stats=this.stats;if(stats.tfirst===0)stats.tfirst=Math.max(window.performance.now(),stats.trequest);stats.loaded=event.loaded;if(event.lengthComputable)stats.total=event.total;if(this.onProgress)this.onProgress(event,stats,this.context)};Loader.prototype.onchunkdata=function(chunk){var stats=this.stats;if(stats.aborted)return;var req=chunk.req;this.fake_xhr.req=req&&req.info.overloaded&&!req.info.overloaded.error?req.info.overloaded:req;var segment=req.info.segment;if(!chunk.data||req.error){if(stats.retry<this.maxRetry){this.log.info("retry, req is "+req.name);this.destroy();setTimeout(this.load_internal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,64e3);stats.retry++}else{clearTimeout(this.timeoutHandle);this.onError({currentTarget:this.fake_xhr},this.context)}return}this.fake_xhr.status=200;this.fake_xhr.response=chunk.data;this.fake_xhr.responseTime=Date.now();if(req.opt.streaming)this.fake_xhr.type="progress";if(!req.opt.streaming||req.xhr.readyState==req.xhr.DONE||req.xhr.readyState==req.xhr.LOADING&&req.xhr.total&&req.xhr.loaded==req.xhr.total){this.adaptive.indexer[segment.playlist_id].completed=segment.index;clearTimeout(this.timeoutHandle);stats.tload=Math.max(stats.tfirst,window.performance.now());return void this.onSuccess({currentTarget:this.fake_xhr},stats,this.context)}return void this.on_chunk({currentTarget:this.fake_xhr},stats)};E.Module.prototype.ondata_adaptive=function(chunk,adaptive){chunk.req.info.segment.fake_xhr.onchunkdata(chunk,adaptive)};function copy_own_properties(dst,src){Object.getOwnPropertyNames(src).forEach(function(x){if(!["arguments","caller"].includes(x)&&src[x]&&!dst[x])dst[x]=src[x]});return dst}function dm_conf_build(conf,hls_constructor,conf_get){conf=assign({},conf);if(util.is_hola_hls_js_constructor(hls_constructor)){conf=assign(conf,util.def_hola_hls_config(conf_get),hls_constructor.hola_config)}if(!conf.debug){conf.debug=E.create_dm_log()}return conf}E.patch_dm=function(hls_orig,conf_get){if(hls_orig.hola_patched)return;var controller=new util.events;controller.hls_orig=hls_orig;var _hls=controller.hls=function Hls(conf){var instance=new hls_orig(dm_conf_build(conf,hls_orig,conf_get));instance.hola_events=[];instance.hola_events_cb=function(e){instance.hola_events.push({name:e,args:arguments})};for(var event in hls_orig.Events)instance.on(hls_orig.Events[event],instance.hola_events_cb);try{controller.emit("newplayer",instance)}catch(e){}return instance};if(hls_orig.Events)_hls.Events=assign({},hls_orig.Events);if(hls_orig.ErrorTypes)_hls.ErrorTypes=assign({},hls_orig.ErrorTypes);if(hls_orig.ErrorDetails)_hls.ErrorDetails=assign({},hls_orig.ErrorDetails);_hls.hola_patched=true;copy_own_properties(_hls,hls_orig);return controller};E.create_dm_log=function(_log){if(!CG("loader.player.dailymotion.log"))return;var hola_log=(_log||log).set_module("hlsprov");return{debug:function(msg){hola_log.debug(msg)},info:function(msg){hola_log.info(msg)},log:function(msg){hola_log.info(msg)},warn:function(msg){hola_log.warn(msg)},error:function(msg){hola_log.err(msg)},hola_log_attach:function(new_log){hola_log=new_log.set_module("hlsprov")}}};E.patch_dm_with_proxy=function(hls_orig,hls_hola,conf_get){if(hls_orig.hola_patched)return;var Proxy=function Hls(conf){var _this=this;var proxy_ctx=this._proxy={events:[]};var mode2hls=function(mode){return mode=="cdn"?hls_hola:hls_orig};var mode2desc=function(mode){return mode=="cdn"?"hola":"customer"};var swap_hls=function(new_hls,old_hls,listeners,done){var media=old_hls.media,source=old_hls.url;var was_playing=media&&!media.paused;listeners.forEach(function(e){old_hls.off(e.event,e.cb)});old_hls.destroy();if(media){new_hls.attachMedia(media);new_hls.on(Hls.Events.MEDIA_ATTACHED,function cb(e){new_hls.off(e,cb);done()});if(media.paused&&was_playing)media.play()}if(source)new_hls.loadSource(source);listeners.forEach(function(e){new_hls.on(e.event,e.cb)});if(!media)done()};var attach_proxy_conn=function(proxy,conn){var keys=[];var conn_proto=Object.getPrototypeOf(conn);var proxy_proto=Object.getPrototypeOf(proxy);var future_fields=["media","url","hola_adaptive"];var do_proxy_field=function(key){if(proxy.hasOwnProperty(key)||proxy_proto.hasOwnProperty(key)){return}Object.defineProperty(proxy,key,{configurable:true,enumerable:true,set:function(v){conn[key]=v},get:function(v){var res=conn[key];return typeof res=="function"?res.bind(conn):res}});keys.push(key)};Object.getOwnPropertyNames(conn).forEach(do_proxy_field);Object.getOwnPropertyNames(conn_proto).forEach(do_proxy_field);future_fields.forEach(do_proxy_field);return function(){keys.forEach(function(k){delete proxy[k]})}};var hide_swap=function(e){if(proxy_ctx.swap_in_progress)e.stopImmediatePropagation()};var reconf_proxy=function(mode){var _hls,hls_constructor=mode2hls(mode);if(proxy_ctx.hls){if(proxy_ctx.hls.constructor==hls_constructor)return;proxy_ctx.detach()}_hls=new hls_constructor(dm_conf_build(conf,hls_constructor,conf_get));if(proxy_ctx.hls){proxy_ctx.swap_in_progress=true;swap_hls(_hls,proxy_ctx.hls,proxy_ctx.events,function(){proxy_ctx.swap_in_progress=false})}proxy_ctx.hls=_hls;proxy_ctx.detach=attach_proxy_conn(_this,_hls)};reconf_proxy("init");this.on("hlsHolaMode",function(e,mode){reconf_proxy(mode)});this.on(Hls.Events.MEDIA_ATTACHING,function(){_this.media.addEventListener("emptied",hide_swap);_this.media.addEventListener("abort",hide_swap);_this.media.addEventListener("loadstart",hide_swap);_this.media.addEventListener("play",hide_swap)});this.on(Hls.Events.MEDIA_DETACHING,function(){if(!_this.media)return;_this.media.removeEventListener("emptied",hide_swap);_this.media.removeEventListener("abort",hide_swap);_this.media.removeEventListener("loadstart",hide_swap);_this.media.removeEventListener("play",hide_swap)});try{controller.emit("newplayer",this)}catch(e){}};copy_own_properties(Proxy,hls_orig);Proxy.prototype.on=function(event,cb){this._proxy.events.push({event:event,cb:cb});this._proxy.hls.on(event,cb)};Proxy.prototype.off=function(event,cb){this._proxy.events=this._proxy.events.filter(function(e){return e.event!=event&&e.cb!=cb});this._proxy.hls.off(event,cb)};var controller=new util.events;controller.hls=Proxy;controller.hls.hola_patched=true;controller.hls_orig=hls_orig;return controller};E.get_handler=function(Player){return{rels:{html5:"anc"},_resync_on_new_player:function(player){var _this=this,Hls=window.Hls||player.constructor;if(player.media.hola_dm_hls_attached)return;player.media.hola_hls=player;this.ctrl.emit("resync");player.on(Hls.Events.MEDIA_DETACHING,function cb(){player.off(Hls.Events.MEDIA_DETACHING,cb);player.media.hola_hls=undefined;setTimeout(function(){_this.ctrl.emit("resync");_this._on_player(player)})})},_on_player:function(player){var _this=this;if(player.hola_detected)return;player.hola_detected=true;var Hls=window.Hls||player.constructor;if(player.media)return this._resync_on_new_player(player);player.on(Hls.Events.MEDIA_ATTACHING,function cb(){player.off(Hls.Events.MEDIA_ATTACHING,cb);_this._resync_on_new_player(player)})},_config_detect:function(){var detect=CG("loader.autodetect.dailymotion.detect",function(){return window.dm_hls_inst||window.hola_cdn.dm_hls_inst});if(detect){var player;try{player=detect.bind(this)()}catch(e){}if(!player)return;var players=!Array.isArray(player)?[player]:player;players.forEach(function(p){this._on_player(p)},this)}},_on_domupdate:function(){this._config_detect();if(!window.Hls||typeof window.Hls.isSupported=="function"&&!window.Hls.isSupported()||window.Hls.api&&window.Hls.api.autodetect_listen||window.Hls.hola_patched){return}if(window.Hls.api&&window.Hls.api.players)window.Hls.api.players.forEach(this._on_player,this);if(window.Hls.api&&window.Hls.api.players&&CG("loader.autodetect.dailymotion.use_detection_api")){var on_player=this._on_player.bind(this);window.Hls.api.addListener(window.Hls.Events.PLAYER_CREATED,on_player);window.Hls.api.autodetect_listen=true;this.ctrl.once("uninit",function(){window.Hls.api.removeListener(window.Hls.Events.PLAYER_CREATED,on_player);window.Hls.api.autodetect_listen=undefined});return}var dm_ctrl;if(CG("loader.autodetect.dailymotion.use_proxy")||util.get_spark_uri("hola_dm_proxy")){util.assert_enabled(hls,"hls is required but disabled");dm_ctrl=E.patch_dm_with_proxy(window.Hls,hls,CG)}else if(!CG("loader.autodetect.dailymotion.disable_patching"))dm_ctrl=E.patch_dm(window.Hls,CG);if(!dm_ctrl)return;window.Hls=dm_ctrl.hls;dm_ctrl.on("newplayer",this._on_player,this);this.ctrl.once("uninit",function(){window.Hls=dm_ctrl.hls_orig})},init:function(ctrl){var _this=this;this.ctrl=ctrl;if(Array.isArray(window.__hola_hls_instances))window.__hola_hls_instances.forEach(this._on_player,this);ctrl.on("post-domupdate",this._config_detect,this);ctrl.once("uninit",function(){ctrl.off("post-domupdate",_this._config_detect)});this._on_domupdate();var hook=util.inject_hook(window,"Hls",{post_set:function(){_this._on_domupdate()}});ctrl.once("uninit",hook.remove.bind(hook))},get_instances:function(elements){return elements.filter(function(e){return e.hola_hls}).map(function(e){return e.hola_hls})},normalize:function(instance){return new Player({setup:function(){var _this=this,Hls=window.Hls||instance.constructor;(function onready(){if(!_this.is_ready()){var event=Hls.Events[instance.media?"MANIFEST_LOADING":"MEDIA_ATTACHING"];instance.on(event,function waiting_cb(){instance.off(event,waiting_cb);onready()});return}_this.emit("ready")})()},get_element:function(){var get=CG("loader.autodetect.dailymotion.get_element",function(){return instance.media});try{return get(instance)}catch(e){}},is_ready:function(){if(instance.media&&instance.media.className.includes("vjs-tech")){if(!window.hola_player)return true}return!!(instance.media&&instance.url)},get_opt:function(){return{dailymotion:instance}}})}}};return E});
define("/svc/cdn/pub/player_util.js",["cash","/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/log.js"],function($,zutil,util,log){var _log=log.set_type("player");var E={log:function(cdn_log,module){return(cdn_log||_log).set_type("player").set_module(module)}};var assign=Object.assign;E.Player=function(opt){var _this=this;util.call_super(E,this);this.log=this.log||E.log(opt.log,"player_util");var stop_monitor;this.on("wrapper.attach_to_player",function(){if(_this.is_paused()&&!_this.is_ad_active()){_this._early_start=true;_this.once("pre-state",function(){_this._early_start=false})}});this.on("wrapper_attached",function(){stop_monitor=_this._monitor_user_activity()});this.on("wrapper_detached",function(){if(stop_monitor)stop_monitor();stop_monitor=undefined});this.on("reconf",function(){if(!stop_monitor)return;stop_monitor();stop_monitor=_this._monitor_user_activity()});function rm_seek_hook(){if(!_this.seek_hook)return;_this.seek_hook.remove();_this.seek_hook=undefined}this.on("started",rm_seek_hook);this.on("uninit",rm_seek_hook);this.on("missing_idr",function(){if(_this.seek_hook)return;if(util.is_firefox&&+util.browser.version>=51&&_this.html5){_this.seek_hook=util.inject_hook(_this.html5,"currentTime",{set:function(e,args){if(_this.is_buffered(args[0])||args[0]==0)return;_this.log.warn("Due to firefox bug "+"https://bugzilla.mozilla.org/show_bug.cgi?id=1345808"+" of handling seeks in video encodings with missing "+"IDR in random access points, seek is disabled");e.set_handled()}})}});if(zutil.is_mocha()){window.dispatchEvent(assign(util.new_event("zmocha.new_player"),{data:{player:this}}))}};zutil.inherits(E.Player,util.events);E.Player.prototype.emit_external=function(e,data){var container=this.get_ui().container||{};if(container.dispatchEvent)container.dispatchEvent(assign(util.new_event(e),{data:data}))};E.Player.prototype.get_current_buffer=function(pos){var b=this.get_buffered()||[];if(pos===undefined)pos=this.get_pos()||0;for(var i=0;i<b.length;i++){if(pos>=b.start(i)&&pos<=b.end(i))return{from:b.start(i),to:b.end(i)}}return{from:pos,to:pos}};E.Player.prototype.get_buffered_sec=function(){var b=this.get_buffered()||[],sum=0;for(var i=0;i<b.length;i++)sum+=b.end(i)-b.start(i);return sum};E.Player.prototype.is_buffered=function(pos){var b=this.get_buffered()||[];for(var i=0;i<b.length;i++){if(pos>=b.start(i)&&pos<=b.end(i))return true}};E.Player.prototype.get_est_bytes=function(){return null};E.Player.prototype.get_video_type_name=function(url){url=url||this.get_url();return util.get_video_type(util.video2type(url))};E.Player.prototype.get_state=function(){return"IDLE"};E.Player.prototype.is_idle=function(){return true};E.Player.prototype.is_paused=function(){return false};E.Player.prototype.is_playing=function(){return false};E.Player.prototype.get_video_type=function(){return""};E.Player.prototype.get_versions=function(){};E.Player.prototype.get_ad_scheme=function(){};E.Player.prototype.is_native_hls=function(){return false};E.Player.prototype.is_interrupted=function(){return false};E.Player.prototype.captions_supported=function(){return true};E.Player.prototype.check_playback_status=function(status_cb){var _this=this,html5=this.html5;if(!html5||!window.MediaSource)return void status_cb({state:"enabled",based_on:"env"});var enabled_reason=html5.readyState>html5.HAVE_NOTHING?"readystate":!util.is_hidden?"visibility":null;this.log.info("playback test request: "+(enabled_reason?"enabled based on "+enabled_reason:"test in progress"));if(enabled_reason)return status_cb({state:"enabled",based_on:enabled_reason});status_cb({state:"checking"});var ms,v,on_sourceopen,on_loadedmetadata;var cleanup=function(){if(ms)ms.removeEventListener("sourceopen",on_sourceopen);if(html5)html5.removeEventListener("loadedmetadata",on_loadedmetadata);ms=v=html5=null};var done=function(reason){_this.log.info("playback test complete: enabled based on "+reason);status_cb({state:"enabled",based_on:reason});cleanup()};on_sourceopen=function(){done("sourceopen")};on_loadedmetadata=function(){done("testfailure")};html5.addEventListener("loadedmetadata",on_loadedmetadata);ms=new window.MediaSource;ms.addEventListener("sourceopen",on_sourceopen);v=document.createElement("video");v.src=window.URL.createObjectURL(ms);return cleanup};E.Player.prototype.get_caps=function(caps){return assign({save_context:[]},caps)};E.Player.prototype.get_media_type=function(){return"video"};E.Player.prototype.get_media_size=function(){if(this.html5&&this.html5.videoWidth&&this.html5.videoHeight)return{width:this.html5.videoWidth,height:this.html5.videoHeight}};E.Player.prototype.is_bitrate_supported=function(){return true};E.Player.prototype.get_current_error=function(){};E.Player.prototype.enable_context_menu=function(){var c=this.get_ui().container;if(!c)return;c.oncontextmenu=this.saved_oncontextmenu};E.Player.prototype.disable_context_menu=function(){var c=this.get_ui().container;if(!c)return;this.saved_oncontextmenu=c.oncontextmenu;c.oncontextmenu=function(){return false}};E.Player.prototype.check_buffer=function(){};E.Player.prototype.is_any_ad_mode=function(){return this.is_ad_active()||this.is_ad_source()};E.Player.prototype.check_seekable=function(){function between(ver,v1,v2){return util.cmp_version(ver,v1)>=0&&util.cmp_version(ver,v2)<=0}var ver=window.Hls&&window.Hls.version||zutil.get(this,"module.hls.version");var result={res:!ver||!between(ver,"0.6.2","0.6.12")&&!between(ver,"0.7.3","0.7.9")||(this.get_buffered()||[]).length};if(!result.res){result.msg="dailymotion/hls.js upgrade to v0.7.10+ required: "+"v"+ver+" overrides seek-on-start"}return result};E.Player.prototype.is_ad_source=function(url){return util.is_ad_url(url||this.get_url())};E.Player.prototype.is_ad_active=function(){return false};E.Player.prototype.is_ad_loading=function(){return false};E.Player.prototype.get_ad_state=function(){return!this.is_ad_active()?"IDLE":this.is_ad_loading()?"LOADING":"PLAYING"};E.Player.prototype.is_ad_playing=function(){return false};E.Player.prototype.is_ad_paused=function(){return false};E.Player.prototype.ad_play=function(){};E.Player.prototype.ad_pause=function(){};E.Player.prototype.get_captions_track=function(){return-1};E.Player.prototype.set_captions_track=function(track){};E.Player.prototype.has_started=function(){return!this.is_idle()&&!this._early_start};E.Player.prototype.play_src=function(src){};E.Player.prototype.is_seeking=function(){return this.html5&&this.html5.seeking};E.Player.prototype.scrubbing=function(is_scrubbing){if(is_scrubbing===undefined){return this.is_scrubbing||this.custom&&this.custom.is_scrubbing&&this.custom.is_scrubbing()}this.is_scrubbing=is_scrubbing};E.Player.prototype.muted=function(v){if(!this.html5)return;if(v===undefined)return this.html5.muted;this.html5.muted=v};E.Player.prototype.volume=function(v){if(!this.html5)return;if(v===undefined)return this.html5.volume;this.html5.volume=v};E.Player.prototype.fullscreen=function(){};E.Player.prototype.is_controlbar_visible=function(){var cb=this.get_ui().control_bar;return cb?$(cb).css("opacity")=="1"&&$(cb).css("display")!="none":true};E.Player.prototype.set_controlbar_visible=function(is_visible){var cb;if(!(cb=$(this.get_ui().control_bar)[0]))return;if(is_visible)cb.style.setProperty("display","");else cb.style.setProperty("display","none","important")};E.Player.prototype.get_player=function(){return this};E.Player.prototype.get_playlist_url=function(){var url=this.get_url();if(url&&!this.is_ad_source(url))return url;return util.gconf_apply("loader.player.guess_url",[this])};E.Player.prototype._monitor_user_activity=function(){var _this=this,$container=$(this.get_ui().container),last_move;var check_inactive_timeout;function on_mousemove(){if(!last_move){_this.user_active=true;_this.emit("user_active")}last_move=util.date_monotonic()}function on_mouseleave(){last_move=null;_this.user_active=false;_this.emit("user_inactive")}$container.on("mousemove",on_mousemove);$container.on("mouseleave",on_mouseleave);function check_inactive(){if(last_move&&util.date_monotonic()-last_move>3e3)on_mouseleave();check_inactive_timeout=setTimeout(check_inactive,500)}check_inactive();return function(){clearTimeout(check_inactive_timeout);$container.off("mousemove",on_mousemove);$container.off("mouseleave",on_mouseleave)}};E.Player.prototype.is_user_active=function(){return this.user_active};E.Player.prototype.is_ready=function(){return true};E.Player.prototype.set_casting=function(state){this.cast_state=state};E.Player.prototype.is_casting=function(){return!!this.cast_state};E.Player.prototype.set_cdn_mode=function(){};E.Player.prototype.get_title=function(){};E.Player.prototype.get_description=function(){};E.Player.prototype.get_poster=function(){};util.module_fn(E,function hap_enabled(){return false});E.build_flash_api=function(_this){function call_api(name,check){var f,slice=Array.prototype.slice;if(_this.swf&&(f=_this.swf["hola_"+name]))return check?!!f:f.apply(_this.swf,slice.call(arguments,2))}return{_call_api:call_api,set_bandwidth:call_api.bind(null,"setBandwidth",false),version:call_api.bind(null,"version",false),avail_version:call_api.bind(null,"version",true),settings:call_api.bind(null,"settings",false),avail_settings:call_api.bind(null,"settings",true),set_timeout:call_api.bind(null,"setTimeout",false),avail_set_timeout:call_api.bind(null,"setTimeout",true)}};E.build_ui=function(container,selector){function s2node(s){return s instanceof Node?s:container.querySelector(s)}var ui={container:container};if(selector.fullscreen)ui.fullscreen=s2node(selector.fullscreen);if(selector.control_bar)ui.control_bar=s2node(selector.control_bar);if(selector.progress_bar)ui.progress_bar=s2node(selector.progress_bar);if(selector.media)ui.media=s2node(selector.media);return ui};E.select_ad_handler=function(player,handlers,opt){var name=Object.keys(handlers).find(function(n){if(!util.is_enabled(handlers[n]))return;return handlers[n].is_enabled(opt)});return name&&new handlers[name](player)};return E});
define("/svc/cdn/pub/html5.js",["cash","/svc/cdn/pub/util.js","/util/util.js","/svc/cdn/pub/shaka.js","/svc/cdn/pub/dash.js","/svc/cdn/pub/dailymotion.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/perr.js"],function($,util,zutil,shaka,dash,dailymotion,player_util,dom_util,perr){var E={};var CG=util.gconf_get;E.Player=function(opt){var _this=this;util.call_super(E,this,null,opt);this.log=player_util.log(opt.log,"html5");this.html5=this.video=opt.html5;this.name="html5";this.tech="html5";this.media_src_api=window;this.state="IDLE";this.blob2url={};this.position=0;this.custom=opt.custom||{};this.paused=this.custom.is_paused?this.custom.is_paused():this.html5.paused;this.detect_scrubbing=!zutil.is_mocha()&&!this.custom.is_scrubbing&&!this.get_ui().control_bar;this.src=this.get_url();function check_interrupted(){var player=opt.parent_player||_this,new_url=_this.get_url();if(!player.is_idle()&&_this.src!=new_url){_this.src=new_url;_this.emit("interrupted")}}function is_pending_sourceopen(){if(_this.media_src_url!=E.get_hola_video_source(_this.html5))_this.pending_sourceopen=false;return _this.pending_sourceopen}function is_event_on_ended(){return!_this.is_idle()&&_this.position>0&&_this.duration>0&&_this.html5.readyState==_this.html5.HAVE_NOTHING&&util.close_to_end(_this.position,_this.duration)}function html5_src_ext(){var src=_this.get_url();var hola_src=_this.html5.hola_src||_this.blob2url[_this.html5.src]&&_this.html5.src;return hola_src&&hola_src!=src?src+" (hola="+hola_src+")":src}function change_state(state,ext_event,ext_data){if(_this.state=="IDLE"&&!_this.get_url())return;var prev=_this.state;var external_states={IDLE:"IDLE",PLAYING:"PLAYING",PLAYING_SEEKING:"PLAYING",BUFFERING:"PLAYING",PAUSED:"PAUSED"};_this.state=state;var ext_state=external_states[state];if(ext_state==external_states[prev])return;if(ext_state=="PLAYING"||ext_state=="PAUSED")_this.paused=ext_state=="PAUSED";if(prev=="IDLE")_this.emit("started");if(ext_event)_this.emit(ext_event,ext_data);_this.emit("state",_this.state)}function video_completed(){_this.log.info("html5 ended "+_this.state+" "+html5_src_ext());_this.ended=true;if(_this.scr_to)clearTimeout(_this.scr_to);change_state("IDLE","ended")}this.on_html5=function(event,handler){handler=handler.bind(this);this.html5_events=this.html5_events||{};this.html5_events[event]=[].concat(this.html5_events[event]||[],handler);html5_on(this.html5,event,handler)};this.off_html5=function(event){this.html5_events[event].forEach(function(handler){html5_off(this.html5,event,handler)}.bind(this));this.html5_events[event]=[]};if(window.hola_debug_player){var all_html5_video_events=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","play","playing","pause","progress","ratechange","seeking","seeked","stalled","suspend","waiting"];all_html5_video_events.forEach(function(e){_this.on_html5(e,function(o){_this.log.console("html5 "+e+": "+o.timeStamp)})})}this.on_html5("loadedmetadata",function(e){this.log.info("html5 loadedmetadata "+this.state+" "+html5_src_ext());if(this.pending_seek_ms)this.seek(this.pending_seek_ms)});this.on_html5("seeked",function(e){if(this.state=="PLAYING_SEEKING")change_state("PLAYING");var t=e&&(e.target||this.html5),custom=this.custom;var seek_ended=this.state=="IDLE"&&this.ended&&t.currentTime==0;if(!this.config.seek_no_state_change&&!seek_ended&&!this.paused&&t&&t.paused&&(!custom.is_paused||custom.is_paused())&&!this.scrubbing()){this.do_pause()}if(!this.config.seek_no_state_change&&this.paused&&t&&!t.paused&&(!custom.is_playing||custom.is_playing())){this.do_play()}this.emit("seeked")});this.on_html5("abort",function(){if(is_pending_sourceopen())return;this.log.info("html5 abort "+this.state+" "+html5_src_ext());if(is_event_on_ended())return video_completed();if(this.is_continuous_reload)return;check_interrupted();change_state("IDLE")});this.on_html5("emptied",function(){if(is_pending_sourceopen())return;this.log.info("html5 emptied "+this.state+" "+html5_src_ext());if(is_event_on_ended())return video_completed();if(this.is_continuous_reload)return;check_interrupted();change_state("IDLE")});this.on_html5("loadstart",function(e){this.log.notice("html5 loadstart "+this.state+" "+html5_src_ext());var html5_state=this.html5.paused?"PAUSED":"PLAYING";this.src=this.get_url();if(is_pending_sourceopen()){this.log.info("loadstart after src replacement: ignored");if(this.is_idle())change_state(html5_state);return}if(this.is_continuous_reload){this.log.info("loadstart after load() w/out src change: ignored");this.is_continuous_reload=false;return}if(this.src)change_state(html5_state)});this.on_html5("seeking",function(e){if(this.state=="PLAYING")this.state="PLAYING_SEEKING";this.prev_position=this.position;this.position=this.html5.currentTime;this.emit("seeking",this.prev_position,this.position)});this.on_pause=function(){var t=this.html5,custom=this.custom;if(!custom.is_seeking&&t&&t.seeking||custom.is_seeking&&custom.is_seeking()||custom.is_paused&&!custom.is_paused()){if(this.detect_scrubbing)this.scrubbing(true);return}this.do_pause()};this.on_html5("pause",function(e){var t=e&&(e.target||this.html5),custom=this.custom;if(!custom.is_ended&&t&&t.ended||custom.is_ended&&custom.is_ended()){return video_completed()}if(this.detect_scrubbing){if(this.scr_to)clearTimeout(this.scr_to);return void(this.scr_to=setTimeout(this.on_pause.bind(this)))}this.on_pause()});this.on_html5("ended",function(e){video_completed()});this.on_html5("play",function(e){if(this.scr_to)this.scr_to=clearTimeout(this.scr_to);if(this.detect_scrubbing)this.scrubbing(false);var t=e&&(e.target||this.html5);if(t&&(!this.is_idle()&&(!this.custom.is_seeking&&t.seeking||this.custom.is_seeking&&this.custom.is_seeking())||this.custom.name=="delightvr"&&t.networkState==t.NETWORK_NO_SOURCE)){this.log.info("html5 play ignored net_state "+t.networkState+" seeking "+t.seeking);return}this.do_play()});this.on_html5("waiting",function(e){if(this.state=="PLAYING")change_state("BUFFERING");this.emit("waiting")});this.on_html5("loadedmetadata",function(e){var src=E.get_hola_video_source(this.html5);if(src&&!util.is_blob_url(src)&&this.is_idle())change_state(this.html5.paused?"PAUSED":"PLAYING")});this.on_html5("error",function(e){var err;if(err=html5_get_error(this))this.emit("error",err)});this.on_html5("timeupdate",function(e){var t=e&&(e.target||this.html5);if(t&&t.networkState==t.NETWORK_NO_SOURCE)return;var pos=this.html5.currentTime;if(pos>this.position&&!this.html5.paused&&!this.html5.ended)change_state("PLAYING");this.html5_prev_position=this.position;this.position=pos;this.emit("timeupdate",pos)});this.on_html5("durationchange",function(){this.duration=this.get_duration();this.emit("duration_changed")});this.on_html5("volumechange",function(){this.emit("volumechange")});if(this.html5.networkState&&this.html5.networkState!=this.html5.NETWORK_NO_SOURCE){this.state=this.html5.paused?"PAUSED":"PLAYING"}if(this.custom.on){this.custom_events=["ad_suspend","ad_restore","ad_start","ad_play"];this.custom_events.forEach(function(ev){_this["on_custom_"+ev]=function(_opt){_this.emit(ev,_opt)};_this.custom.on(ev,_this["on_custom_"+ev])})}this.reset_state=function(){delete this.pending_seek_ms;this.ended=false;this.position=0;if(this.config.continue_on_reload){if(this.reload_unhook)this.reload_unhook();this.reload_unhook=E.hacks.on_reload_request(this.html5,function(){_this.is_continuous_reload=true})}}.bind(this);this.on("started",this.reset_state);this.do_pause=function(){this.log.notice("html5 pause");change_state("PAUSED");this.emit("pause")};this.do_play=function(){this.play_count=this.play_count||0;this.log.notice("html5 play "+this.state+" "+html5_src_ext());change_state("PLAYING");this.emit("play");var n=this.config.ignore_num_play_events||0;if(this.play_count<n)this.html5.pause();if(this.adjust_pos&&!this.html5.seeking&&this.html5.currentTime)this.html5.currentTime+=.1;this.play_count++};this.config={ignore_other_error:CG("loader.player.ignore_other_error"),ignore_num_play_events:CG("loader.player.ignore_num_play_events"),disable_ended_fallback:CG("loader.player.disable_ended_fallback"),disable_src_change_hiding:CG("loader.player.disable_src_change_hiding"),lock_reload_request:CG("loader.player.html5.lock_reload_request",CG("loader.player."+this.custom.name+".lock_reload_request")),seek_no_state_change:CG("loader.player.html5.seek_no_state_change"),continue_on_reload:CG("loader.player.html5.continue_on_reload",CG("loader.player."+this.custom.name+".continue_on_reload")),ext_control_logs:CG("loader.player.html5.ext_control_logs",util.debug_mode)};if(opt.shaka){util.assert_enabled(shaka,"shaka module is required but disabled");this.module=new shaka.Module({log:this.log,shaka:opt.shaka})}else if(opt.dashjs){util.assert_enabled(dash,"dash module is required but disabled");this.module=new dash.Module({log:this.log,dashjs:opt.dashjs})}else if(opt.dailymotion){util.assert_enabled(dailymotion,"dailymotion module is required but disabled");this.module=new dailymotion.Module({log:this.log,dailymotion:opt.dailymotion,player:this,state:this.state})}this.rm_forwarding_emit=util.create_forwarding_emit(this);if(this.config.ext_control_logs){E.on_ext_control(this,this.html5,function(log){_this.log.info(log+" state "+_this.state+" src "+html5_src_ext()+" stack "+util.stack_to_pprint((new Error).stack))})}if(!this.is_idle())this.reset_state()};zutil.inherits(E.Player,player_util.Player);E.Player.prototype.uninit=function(){if(this.custom_events){this.custom_events.forEach(function(ev){this.custom.off(ev,this["on_custom_"+ev])},this)}this.off("started",this.reset_state);if(this.rm_forwarding_emit)this.rm_forwarding_emit=this.rm_forwarding_emit();if(this.config.ext_control_logs)E.on_ext_control(this,this.html5,false);if(this.src_unlock)this.src_unlock=this.src_unlock();if(this.reload_unhook)this.reload_unhook=this.reload_unhook();if(this.events&&this.events.removeAllListeners)this.events.removeAllListeners();if(this.module&&this.module.uninit)this.module.uninit();for(var event in this.html5_events)this.off_html5(event)};E.Player.prototype._get_custom_url=function(){if(this.custom.get_url)try{return this.custom.get_url()}catch(e){}};E.Player.prototype.get_url=function(){var src;if(!(src=this._get_custom_url())){src=this.module?this.module.get_url():E.get_video_source(this.html5)}if(util.is_blob_url(src)&&this.blob2url[src])src=this.blob2url[src];return src};E.Player.prototype.seek=function(ms){if(this.custom.seek)return this.custom.seek(ms);if(this.html5.readyState<this.html5.HAVE_METADATA)return this.pending_seek_ms=ms;this.html5.currentTime=ms/1e3};E.Player.prototype.get_pos=function(){if(this.custom.get_pos)return this.custom.get_pos();return this.html5.currentTime};util.module_fn(E,function get_state(){return this.state});E.Player.prototype.refresh_buffered=function(){return this.html5.buffered};E.Player.prototype.get_buffered=function(){return this.html5.buffered};E.Player.prototype.get_duration=function(){if(this.custom.get_duration)return this.custom.get_duration();return this.html5.duration};E.Player.prototype.get_resolution=function(){return dom_util.get_elm_resolution(this.html5)};E.Player.prototype.play=function(){return this.custom.play?this.custom.play():this.html5.play()};E.Player.prototype.pause=function(){return this.custom.pause?this.custom.pause():this.html5.pause()};E.Player.prototype.is_seeking=function(){var custom=this.custom;return!custom.is_seeking&&this.html5&&this.html5.seeking||custom.is_seeking&&custom.is_seeking()};E.Player.prototype.muted=function(v){if(this.custom.muted)return this.custom.muted(v);return util.call_super(E,this,"muted",v)};util.module_fn(E,function play_url(url,opt){var _this=this;opt=opt||{};if(opt.pos){html5_on(this.html5,"loadedmetadata",function cb(){html5_off(_this.html5,"loadedmetadata",cb);html5_wait_for_event(_this.html5,"seeking",500,function retry(){_this.html5.currentTime=opt.pos});_this.html5.currentTime=opt.pos})}this.html5.src=url;if(!opt.is_paused)this.html5.play()});util.module_fn(E,function enable_data_mode(on_sourceopen){if(!this.media_src_api.MediaSource)throw new Error("MediaSource API not available");this.media_src=new this.media_src_api.MediaSource;this.pending_sourceopen=true;var played=!this.html5.paused;this.media_src_url=this.media_src_api.URL.createObjectURL(this.media_src);var current_url=E.get_video_source(this.html5);var original_url=this.blob2url[this.media_src_url]=this.blob2url[current_url]||current_url;this.html5.src=this.media_src_url;if(!this.config.disable_src_change_hiding){if(this.src_unlock)this.src_unlock();this.src_unlock=E.hacks.hide_source_change(this.html5,original_url,this.media_src_url)}if(this.config.lock_reload_request)this.load_unlock=E.hacks.lock_reload_request(this.html5,this.log);this.seek_fix_uninit=E.hacks.seek_jump_workaround(this);var _this=this;if(played){var promise=this.html5.play();if(promise&&promise.catch){promise.catch(function(err){if(err&&err.name=="AbortError")setTimeout(function(){_this.html5.play()})})}}if(!this.config.disable_ended_fallback){this.schedule_end_of_stream_check=function(e){var html5=_this.html5,_ct=html5.currentTime;_this.end_of_stream_timer=clearTimeout(_this.end_of_stream_timer);if(!html5.duration||html5.duration-_ct>.25)return;_this.end_of_stream_timer=setTimeout(function(){var ct=html5.currentTime;if(!html5.duration||!ct||html5.ended&&ct!=_ct||html5.duration-ct>.25){return}perr({id:"html5_ended_fallback",add_log:true,info:{seeking:html5.seeking,last_event:e.type}});html5.dispatchEvent(util.new_event(e.type=="stalled"&&html5.seeking?"timeupdate":"ended"))},500)};html5_on(this.html5,"timeupdate",this.schedule_end_of_stream_check);html5_on(this.html5,"stalled",this.schedule_end_of_stream_check)}this.on_sourceopen=function(e){_this.pending_sourceopen=false;return on_sourceopen(this.media_src,e)}.bind(this);this.media_src.addEventListener("sourceopen",this.on_sourceopen);if(this.media_src.readyState=="open")this.on_sourceopen(this.media_src);this.last_pos=this.metadata=this.stalled=undefined;this.nudge_retry=0});E.Player.prototype.disable_data_mode=function(){if(!this.media_src)return;if(this.load_unlock)this.load_unlock();if(this.seek_fix_uninit)this.seek_fix_uninit();this.media_src.removeEventListener("sourceopen",this.on_sourceopen);if(this.schedule_end_of_stream_check){this.end_of_stream_timer=clearTimeout(this.end_of_stream_timer);html5_off(this.html5,"timeupdate",this.schedule_end_of_stream_check);html5_off(this.html5,"stalled",this.schedule_end_of_stream_check)}this.media_src=this.media_src_url=this.pending_sourceopen=this.schedule_end_of_stream_check=this.on_sourceopen=this.load_unlock=undefined};util.module_fn(E,function is_playing(){if(this.is_idle())return false;return!this.html5.paused});util.module_fn(E,function is_paused(){if(this.is_idle())return false;if(zutil.is_mocha())return this.html5.paused;return this.paused});E.Player.prototype.get_decoded_frames=function(){return E.get_decoded_frames(this.html5)};E.Player.prototype.get_dropped_frames=function(){return E.get_dropped_frames(this.html5)};E.Player.prototype.check_buffer=function(opt){E.check_buffer.call(this,this.html5,opt)};util.module_fn(E,function get_captions_track(){for(var i=0;i<this.html5.textTracks.length;i++){if(this.html5.textTracks[i].mode=="showing")return i}return-1});util.module_fn(E,function set_captions_track(track){for(var i=0;i<this.html5.textTracks.length;i++)this.html5.textTracks[i].mode="disabled";if(track>=0)this.html5.textTracks[track].mode="showing"});util.module_fn(E,function is_idle(){return this.state=="IDLE"});util.module_fn(E,function get_ui(){var ui={};if(this.custom.get_ui)ui=this.custom.get_ui();return Object.assign({container:this.html5,fullscreen:this.html5,media:this.html5},ui)});util.module_fn(E,function get_levels(){});util.module_fn(E,function get_playlists(){});util.module_fn(E,function get_current_playlist(){});util.module_fn(E,function get_segment_info(){});util.module_fn(E,function get_bitrate(){return 0});util.module_fn(E,function is_bitrate_supported(){return true});util.module_fn(E,function init_adaptive(){});util.module_fn(E,function is_live_stream(){return Infinity==this.get_duration()});util.module_fn(E,function get_current_level(){});util.module_fn(E,function ondata_adaptive(){});util.module_fn(E,function get_current_fragment(){});util.module_fn(E,function is_autostart(){if(this.custom.is_autostart)return this.custom.is_autostart();return this.html5.autoplay});E.Player.prototype.get_bandwidth=function(){return 0};E.Player.prototype.get_caps=function(){return player_util.Player.prototype.get_caps({save_context:["progressive"]})};E.Player.prototype.get_est_bytes=function(){var res=null;if(this.module)res=this.module.get_est_bytes();if(!res)res=E.est_bytes_from_tag(this.html5);return res};E.Player.prototype.get_current_error=function(){return html5_get_error(this)};E.Player.prototype.play_src=function(src){src=src[0].file||src[0].url;if(this.custom.play_src)return this.custom.play_src(src);this.html5.src=src;this.html5.load();this.html5.play()};E.Player.prototype.is_ad_source=function(url){return this.custom.is_ad_source&&this.custom.is_ad_source(url)||util.call_super(E,this,"is_ad_source",url)};E.Player.prototype.is_ad_active=function(){if(this.custom.is_ad_active)return this.custom.is_ad_active();return util.call_super(E,this,"is_ad_active")};E.Player.prototype.is_ad_paused=function(){if(this.custom.is_ad_paused)return this.custom.is_ad_paused();return util.call_super(E,this,"is_ad_paused")};E.Player.prototype.ad_play=function(){if(this.custom.ad_play)return this.custom.ad_play();return util.call_super(E,this,"ad_play")};E.Player.prototype.ad_pause=function(){if(this.custom.ad_pause)return this.custom.ad_pause();return util.call_super(E,this,"ad_pause")};E.Player.prototype.get_player=function(){return this.html5};E.Player.prototype.get_versions=function(){var versions={};if(this.custom.get_versions)Object.assign(versions,this.custom.get_versions());if(this.module&&this.module.get_versions)Object.assign(versions,this.module.get_versions());return Object.keys(versions).length?versions:null};E.Player.prototype.fullscreen=function(v){function get(obj,list){for(var i in list){if(obj[list[i]]===undefined)continue;return typeof obj[list[i]]=="function"?obj[list[i]].bind(obj):obj[list[i]]}}var current_fs=get(document,["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"]);if(v===undefined)return current_fs;var player_fs=this.get_ui().fullscreen;if(!current_fs){get(player_fs,["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"])()}else{get(document,["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"])()}};E.Player.prototype.scrubbing=function(is_scrubbing){if(is_scrubbing===undefined){return this.is_scrubbing||this.custom&&this.custom.is_scrubbing&&this.custom.is_scrubbing()}this.is_scrubbing=is_scrubbing};function html5_get_error(player){var err_map={1:{message:"download was cancelled",reason:"other"},2:{message:"network error",reason:"media_load"},3:{message:"decode error",reason:"media_decode"},4:{message:"source not supported",reason:"media_support"},5:{message:"encryption error",reason:"media_decode"},unknown:{message:"unknown",reason:"other"}};if(!player.html5.error)return;var code=player.html5.error&&player.html5.error.code;if(!E.get_video_source(player.html5)&&code==4)return;var info=err_map[code]||err_map.unknown;info.message=player.html5.error&&player.html5.error.message||info.message;if(player.config.ignore_other_error&&info.reason=="other"){player.log.err("ignoring other error");return}return{code:code,reason:info.reason,message:info.message}}function html5_wait_for_event(video,event,timeout,on_timeout){var timer;var _finally=function(_timeout){html5_off(video,event,_finally);if(timer)timer=void clearTimeout(timer);if(_timeout)on_timeout()};html5_on(video,event,_finally);timer=setTimeout(function(){_finally(true)},timeout)}function html5_proto(video){return zutil.is_mocha()?video:Object.getPrototypeOf(video)}function html5_on(video,event,cb){html5_proto(video).addEventListener.apply(video,[event,cb])}function html5_off(video,event,cb){html5_proto(video).removeEventListener.apply(video,[event,cb])}E.get_decoded_frames=function(video){if(!video)return;if(video.webkitDecodedFrameCount!==undefined)return video.webkitDecodedFrameCount;if(video.mozDecodedFrames!==undefined)return video.mozDecodedFrames};E.get_dropped_frames=function(video){if(video.webkitDroppedFrameCount!==undefined)return video.webkitDroppedFrameCount};E.get_video_source=function(video){if(!video)return"";var video_url,empty_src_re=/^#?$/;if(video_url=video.src){if(empty_src_re.test(video.getAttribute("src")))video_url=""}else if(video_url=video.currentSrc){var is_src=false;var s=Array.prototype.slice.call(video.querySelectorAll("source"));s.push(video);for(var i=0;i<s.length;i++){if(s[i].src!=video_url)continue;is_src=true;if(empty_src_re.test(s[i].getAttribute("src")))video_url="";break}if(!is_src)video_url=""}return video_url};E.get_hola_video_source=function(video){return video.hola_src||E.get_video_source(video)};E.dump_buffered=function(video){var str="",b=video.buffered,len=b.length;for(var i=0;i<len;i++)str+="["+b.start(i)+","+b.end(i)+"]";return str};E.at_init_position=function(video){return!video.buffered.length||video.currentTime==video.buffered.start(0)};E.est_bytes_from_tag=function(el){if(isFinite(el.webkitAudioDecodedByteCount)&&isFinite(el.webkitVideoDecodedByteCount)&&(el.webkitVideoDecodedByteCount!=0||el.currentTime==0)){return{bytes:el.webkitAudioDecodedByteCount+el.webkitVideoDecodedByteCount,src:"html5"}}return null};E.check_buffer=function(video,opt){if(!video.readyState)return;var ts,spos,_this=this,state=opt.state,pos=video.currentTime;var buf=video.buffered;if(!state.metadata&&buf.length&&buf.start(0)<buf.end(0)){spos=buf.start(0);if(pos==0&&pos!=spos){if(spos<.05&&!video.paused){ts=util.date_monotonic();if(!state.start_stalled){state.start_stalled=ts;return void setTimeout(function(){E.check_buffer.call(_this,video,opt)},100)}else if(ts-state.start_stalled<100)return}this.log.info("position "+pos+" not buffered, seek to "+spos);video.currentTime=spos}state.metadata=true;state.start_stalled=undefined}else if(state.metadata){if(pos!=state.last_pos){state.stalled=undefined;state.nudge_retry=0;state.last_pos=pos}else{if(video.paused||video.ended||!buf.length){state.nudge_retry=0;return state.stalled=undefined}ts=util.date_monotonic();if(!state.stalled)state.stalled=ts;else{var dur=ts-state.stalled,nudge_retry=state.nudge_retry||0;var bsec=opt.bws.sec_in_buffer(pos,true),conf=opt.conf;if(bsec>conf.bsec&&dur>conf.buf_wd*1e3){state.stalled=undefined;state.nudge_retry=++nudge_retry;if(nudge_retry<conf.max_nudge_retry){spos=pos+nudge_retry*conf.offset;this.log.info("adjust position from "+pos+" to "+spos);video.currentTime=spos}else{this.log.info("still stuck at "+pos+" after "+nudge_retry)}}}}}};E.on_ext_control=function(ctx,video,log_fn){if(!log_fn){ctx.ext_seek_hook=ctx.ext_seek_hook&&ctx.ext_seek_hook.remove();ctx.ext_load_hook=ctx.ext_load_hook&&ctx.ext_load_hook.remove();ctx.ext_pause_hook=ctx.ext_pause_hook&&ctx.ext_pause_hook.remove();ctx.ext_play_hook=ctx.ext_play_hook&&ctx.ext_play_hook.remove();ctx.ext_src_change_uninit=ctx.ext_src_change_uninit&&ctx.ext_src_change_uninit();return}ctx.ext_seek_hook=util.inject_hook(video,"currentTime",{set:function(e,args){log_fn("html5 poschange to "+args[0])}});ctx.ext_load_hook=util.inject_hook(video,"load",{exec:function(e,args){log_fn("html5 load")}});ctx.ext_pause_hook=util.inject_hook(video,"pause",{exec:function(e,args){log_fn("html5 pause")}});ctx.ext_play_hook=util.inject_hook(video,"play",{exec:function(e,args){log_fn("html5 play")}});ctx.ext_src_change_uninit=E.hacks.on_source_change(video,function(from,to,stack){log_fn("html5 sourcechange to "+(to||"<empty>"))})};E.hacks={};E.hacks.hide_source_change=function(video,facade_src,surrogate_src){E.polyfill.video_source_access(video);var src_hook_cb=function(e){if(hooks.src.original_handlers.get()!=surrogate_src)return;e.set_handled();return facade_src};var attr_hook_cb=function(e,args){if(args[0]!="src")return;var attr_src=hooks.attr.original_handlers.exec("src");if(util.absolute_uri(attr_src,true)!=surrogate_src)return;e.set_handled();return facade_src};var hola_src_hook_cb=function(e,args){e.set_handled();return hooks.src.original_handlers.get()};var hooks={src:util.inject_hook(video,"src",{get:src_hook_cb}),csrc:util.inject_hook(video,"currentSrc",{get:src_hook_cb}),attr:util.inject_hook(video,"getAttribute",{exec:attr_hook_cb}),hsrc:util.inject_hook(video,"hola_src",{get:hola_src_hook_cb})};E.hacks.lock_no_source_ns(video);return function(){Object.keys(hooks).forEach(function(name){hooks[name].remove()});if(!hooks.hsrc.count())delete video.hola_src}};E.hacks.on_source_change=function(video,cb){E.polyfill.video_source_access(video);var src_hook_cb=function(e,args){cb(E.get_hola_video_source(video),args[0],util.stack_to_pprint((new Error).stack))};var attr_hook_cb=function(e,args){if(args[0]!="src")return;cb(E.get_hola_video_source(video),args[1],util.stack_to_pprint((new Error).stack))};var hooks={src:util.inject_hook(video,"src",{set:src_hook_cb}),attr:util.inject_hook(video,"setAttribute",{exec:attr_hook_cb})};return function(){Object.keys(hooks).forEach(function(name){hooks[name].remove()})}};E.hacks.lock_reload_request=function(video,log){return E.hacks.on_reload_request(video,function(e,args){if(args[0]&&args[0].hola_force)return;e.set_handled();log.info("video.load() call intercepted/ignored, call stack: "+(new Error).stack)})};E.hacks.on_reload_request=function(video,cb){var lock_url=E.get_hola_video_source(video);var hook=util.inject_hook(video,"load",function(e,args){if(E.get_hola_video_source(video)==lock_url)cb(e,args)});return hook.remove.bind(hook)};E.hacks.lock_no_source_ns=function(video){if(CG("loader.html5.disable_ns_lock"))return;var hook=util.inject_hook(video,"networkState",{get:function(e){e.set_handled();var ns=hook.original_handlers.get();return ns==video.NETWORK_NO_SOURCE?video.NETWORK_LOADING:ns}});setTimeout(hook.remove.bind(hook))};E.hacks.seek_jump_workaround=function(player){var video=player.html5,last_seeking_pos,last_fixup_pos;if(!(util.is_safari&&video&&video.hasAttribute("controls"))||CG("loader.html5.disable_seek_jump_fix")){return}function seek_start(){last_seeking_pos=video.currentTime}function seek_complete(){if(last_seeking_pos==last_fixup_pos)return last_seeking_pos=last_fixup_pos=undefined;var pos=player.get_pos();var buf_now=player.get_current_buffer(pos);var buf_seek=player.get_current_buffer(last_seeking_pos);if(buf_now.from==buf_seek.from)return last_seeking_pos=last_fixup_pos=undefined;player.log.info("pos jump detected: "+last_seeking_pos+"["+buf_seek.from+";"+buf_seek.to+"] > "+pos+"["+buf_now.from+";"+buf_now.to+"], reseek now");video.currentTime=last_fixup_pos=buf_seek.from}html5_on(video,"seeking",seek_start);html5_on(video,"seeked",seek_complete);return function(){html5_off(video,"seeking",seek_start);html5_off(video,"seeked",seek_complete)}};E.polyfill={};E.polyfill.video_source_access=function(video){var pd=Object.getOwnPropertyDescriptor(video,"src");if(pd&&!pd.configurable)return false;if(!util.is_safari||util.gconf_get("loader.html5.disable_video_src_polyfill")){return true}var proto=video;while(!proto.hasOwnProperty("src")&&(proto=Object.getPrototypeOf(proto)));if(!proto||!(pd=Object.getOwnPropertyDescriptor(proto,"src"))||pd.get||pd.hasOwnProperty("value")){return true}var orig_set_attr=video.setAttribute,orig_get_attr=video.getAttribute;Object.defineProperty(video,"src",{configurable:true,enumerable:true,set:function(value){orig_set_attr.call(this,"src",value)},get:function(){var src=orig_get_attr.call(this,"src");return src!=null?util.absolute_uri(src,true):""}});perr({id:"html5_source_polyfill"});return true};function get_conf_custom_ops(player_type,instance){var ops_fn;if(!(ops_fn=CG("loader.autodetect."+player_type+".custom_ops")))return;try{if(typeof ops_fn=="string")ops_fn=new Function("instance","$","util",ops_fn);return ops_fn(instance,$,util)}catch(e){}}E.get_handler=function(Player,log,autodetect){return{rels:{shaka:"mod",dashjs:"mod"},ext_handlers:[],get_instances:function(elements){var custom_elements_fn,custom_elements;if(custom_elements_fn=CG("loader.autodetect.custom_video_elements")){custom_elements=custom_elements_fn()}var ext_elements=[];this.ext_handlers.forEach(function(get_instances_fn){ext_elements=ext_elements.concat(get_instances_fn().filter(function(el){return!elements.includes(el)}))});return util.array_unique(elements.filter(function(el){return el.tagName=="VIDEO"}).concat(custom_elements||[]).concat(ext_elements))},validate:function(el){var ignore=CG("loader.autodetect.ignore");var ignore_sel=CG("loader.autodetect.html5.ignore_selector");if(CG("loader.autodetect.theoplayer")){ignore_sel=ignore_sel||"";var theoplayer=autodetect.player_handlers.theoplayer;if(theoplayer)ignore_sel+=", "+theoplayer.sel}return el.src!==undefined&&!(el.src&&el.src.startsWith("data:"))&&(!ignore||!RegExp(ignore).test(el.src))&&(!ignore_sel||!dom_util.matches(el,ignore_sel))&&!el.className.includes("hola_video_preview")&&!el.className.includes("hola_autoplay_muted_overlay")&&!el.className.includes("spark_newsreel_video")},normalize:function(instance){var _this=this;var custom_ops=get_conf_custom_ops("html5",instance);return new Player({setup:function(){if(this.is_ready())return;var __this=this;var cb=function(){if(__this._remove_ready_listeners&&__this.is_ready()){__this._remove_ready_listeners();__this.emit("ready")}};if(custom_ops&&custom_ops.on_ready){this._remove_ready_listeners=custom_ops.on_ready(cb);return}instance.addEventListener("loadstart",cb);instance.addEventListener("play",cb);var off;if(CG("loader.autodetect.html5.attach_no_source")){off=dom_util.dom_listen(instance.parentElement||instance,cb)}this._remove_ready_listeners=function(){instance.removeEventListener("loadstart",cb);instance.removeEventListener("play",cb);if(off)off();delete __this._remove_ready_listeners}},get_element:function(){return instance},is_ready:function(){if(custom_ops&&custom_ops.is_ready)return custom_ops.is_ready();if(instance.className.includes("video-js")||!_this.validate(instance)){return false}if(instance.hola_hls)return true;if(!CG("loader.autodetect.html5.ignore_preload")&&instance.preload=="none"&&!instance.autoplay&&instance.paused){return!!(E.get_video_source(instance)&&(instance.readyState||instance.networkState==2||instance.initNetworkState_==2))}var sel=CG("loader.autodetect.html5.attach_no_source");return!!(E.get_video_source(instance)||sel&&sel(instance,$))},get_opt:function(){var opt={html5:instance};if(custom_ops){opt.custom=get_conf_custom_ops("html5",instance)}return opt},destroy:function(){if(this._remove_ready_listeners)this._remove_ready_listeners()}})}}};return E});
define("/svc/cdn/pub/mode.js",["/svc/cdn/pub/log.js","/svc/cdn/pub/util.js","/svc/cdn/pub/cdn_util.js","/svc/cdn/pub/storage.js"],function(_log,util,cdn_util,storage){var E={};var log=_log.set_module("mode");var formats={mp4:"mp4",m4p:"mp4",m3u8:"hls",mpd:"dash",m4v:"mp4",f4m:"hds",flv:"flv",webm:"webm"};var matrix=function(){var mp4_holavjs_jw={windows:{"*":{chrome:{"*":"*"},opera:{"*":"*"},firefox:function(p){if(p.os_version=="xp")return"";return p.browser_version>=42?"*":"fl"},edge:{"*":"*"},ie:function(p){var bv=p.browser_version;return bv>=11&&p.os_version>=8?"*":bv>=10?"fl":""}}},linux:{"*":{chrome:{"*":"*"},opera:{"*":"fl"},firefox:{"*":"fl"}}},macos:{"*":{chrome:{"*":"*"},opera:{"*":"fl"},firefox:{"*":"fl"},safari:{"*":"*"}}},android:{"*":{chrome:{"*":"h5"}}}};var flv_holavjs_jw=function(p){return p.browser=="ie"&&(p.browser_version==9||p.browser_version==10&&p.os_version==8)?"":"fl"};var h5_if_ms=function(){return window.MediaSource?"h5":""};return{mp4:{hola_vjs:mp4_holavjs_jw,hola_vjs5:mp4_holavjs_jw,vjs6:mp4_holavjs_jw,flowplayer6:mp4_holavjs_jw,flowplayer7:mp4_holavjs_jw,clappr:mp4_holavjs_jw,kaltura:mp4_holavjs_jw,vjs:function(p){return p.browser=="firefox"||p.browser=="ie"||p.os=="linux"&&p.browser=="opera"?"":"h5"},jw:mp4_holavjs_jw,html5:function(p){if(p.browser=="firefox"&&p.os_version=="xp")return"";return h5_if_ms()},byteark:function(p){if(p.browser=="firefox"&&p.os_version=="xp")return"";return h5_if_ms()}},flv:{hola_vjs:flv_holavjs_jw,hola_vjs5:flv_holavjs_jw,jw:flv_holavjs_jw},hds:{hola_vjs:flv_holavjs_jw,hola_vjs5:flv_holavjs_jw},hls:{hola_vjs:function(p){return p.browser=="ie"&&p.browser_version==9?"":"fl"},hola_vjs5:function(p){return p.browser=="ie"&&p.browser_version==9?"":"*"},vjs4:function(p){return p.browser=="ie"&&p.browser_version==9?"":"*"},flowplayer6:function(){return"*"},flowplayer7:function(){return"*"},clappr:function(p){return p.browser=="ie"&&p.browser_version==9?"":"h5"},jw:function(p){return p.browser=="ie"&&p.browser_version==9||p.os=="windows"&&(p.os_version=="8"||p.os_version=="8.1")&&p.browser=="firefox"?"":"*"},dailymotion:function(p){return p.browser=="ie"&&p.browser_version==9?"":"h5"},byteark:function(p){return p.browser=="ie"&&p.browser_version==9?"":"h5"},kaltura:function(p){return p.browser=="ie"&&p.browser_version==9?"":"h5"}},dash:{dashjs:h5_if_ms,shaka:h5_if_ms,hola_vjs5:h5_if_ms,flowplayer6:h5_if_ms,flowplayer7:h5_if_ms},webm:{"*":function(p){return p.browser=="chrome"?"h5":""}}}}();function check_obj_path(obj,path,order){var part=path[order.shift()];if((obj=obj[part]||obj["*"])===undefined)return false;return order.length?typeof obj=="function"?obj(path):check_obj_path(obj,path,order):obj}function get_format(url){var ext=/(?:\.([^.\/?#]+))?([?#].*)?$/.exec(url)[1];return ext?formats[ext]:url}E.get_available_tech_by_env=function(path,order){return check_obj_path(matrix,path,order)};E.get_available_tech=function(url,player){function is_flash_enabled(){try{return!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){var mime="application/x-shockwave-flash";return!!(navigator.mimeTypes&&navigator.mimeTypes[mime]&&navigator.mimeTypes[mime].enabledPlugin)}}var guess=util.guess;var browser=util.browser;var path={format:get_format(url),player:player,os:guess.os,os_version:guess.version,browser:browser.opera?"opera":browser.browser,browser_version:browser.version};var order=["format","player","os","os_version","browser","browser_version"];var tech=E.get_available_tech_by_env(path,order.slice());log.notice("Available tech for ["+order.map(function(o){return path[o]}).join(", ")+"] is "+tech);switch(tech){case"fl":return{flash:is_flash_enabled(),html5:false};case"h5":return{flash:false,html5:true};case"*":return{flash:is_flash_enabled(),html5:true};default:return{flash:false,html5:false}}};E.is_ip_blacklisted=function(opt){var blacklist=opt.CG("loader.ip_blacklist")||[];if(util.geoip&&util.geoip.ip&&blacklist.includes(util.geoip.ip))return true};E.is_browser_supported=function(){var version=util.browser.version;if(!util.is_android&&!util.is_windows&&!util.is_linux&&!util.is_ios&&!util.is_mac&&!util.is_webos){return false}if(util.is_android&&util.guess.version<4.4)return false;if(util.is_webos&&util.cmp_version(version,"38")<0)return false;if(util.is_edge)return true;if(util.is_ie&&version>=(util.is_mobile?11:8))return true;if(util.is_chrome&&version>=(util.is_mobile?30:23))return true;if(util.is_firefox&&version>=(util.is_mobile?68:37))return true;if(util.is_opera&&version>=(util.is_mobile?30:15))return true;if(typeof version=="string")version=version.replace(/_/g,".");if(!util.is_safari)return false;return util.is_ios_sdk||util.cmp_version(version,"10")>=0};E.select_mode=function(opt){function storage_mode(){try{return storage.session_db.get("hola_mode")||storage.db.get("hola_mode")}catch(e){}}function debug_compatible_mode(){var debug_compatible;try{debug_compatible=storage.db.get("hola_debug_compatible_browser")}catch(e){}if(debug_compatible!=undefined)debug_compatible=debug_compatible||"disabled";return debug_compatible}function browser_rule_mode(r){if(r.browser&&r.browser!=util.browser_rule_s||r.os&&r.os!=util.guess.os&&r.os!="*"){return false}var rand=cdn_util.get_random("mode");var p=r.cdn||0;if(rand<p)return"cdn";p+=r.bwsaver||0;if(rand<p)return"bwsaver";p+=r.stats||0;if(rand<p)return"stats";return"disabled random"}function mode_create(mode,reason){mode=mode=="hola_cdn"?"cdn":mode=="origin_cdn"?"stats":mode;return{mode:mode,disabled_reason:mode=="disabled"?reason:null,disabled_help:mode=="disabled"&&reason}}var url=opt.location||location;try{url.toString()}catch(e){url=location}var CG=opt.CG,r_mode,mode;if(mode=util.get_spark_uri(url,"spark_disable"))r_mode=mode_create("disabled","uri");else if(opt.suspended){mode="stats";r_mode=mode_create(mode,"force_stats_on_suspended_account")}else if(opt.method=="hls"&&opt.hap_provider_loaded&&CG("provider.register_percent",100)){mode="stats";r_mode=mode_create(mode,"force_stats_on_hls")}else if(mode=util.get_spark_uri(url,"hola_mode"))r_mode=mode_create(mode,"uri");else if(mode=storage_mode())r_mode=mode_create(mode,"storage");else if(require.zdot("disabled"))r_mode=mode_create("disabled","conf");else if(mode=CG("loader.mode"))r_mode=mode_create(mode,"conf");else if(mode=debug_compatible_mode())r_mode=mode_create(mode,"debug_compatible");else if(!E.is_browser_supported())r_mode=mode_create("disabled","browser_unsupported");else if(E.is_ip_blacklisted(opt))r_mode=mode_create("disabled","ip_blacklist");else{var rl=opt.rules||CG("loader.rules")||[],ret;for(var i=0;i<rl.length&&!(ret=browser_rule_mode(rl[i]));i++);ret=(ret||"disabled no_browser_match").split(" ");r_mode=mode_create(ret[0],ret[1])}if(!["disabled","stats","bwsaver","cdn"].includes(r_mode.mode)){log.err("unknown mode="+r_mode.mode+", forcing disabled");r_mode=mode_create("disabled","mode_unknown")}return r_mode};E.get_avail_tech=function(url,player){if(player.startsWith("jwplayer"))player="jw";if(["hola_vjs5_10","vjs5_10","vjs5_16","vjs5","hola_player","brightcove"].includes(player)){player="hola_vjs5"}return E.get_available_tech(url,player)};return E});
define("/svc/cdn/pub/cdn_svc.js",{__stub:1});
define("/svc/cdn/pub/zjwplayer3.js",["/util/util.js","/svc/cdn/pub/util.js","cash","/svc/cdn/pub/html5.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/perr.js"],function(zutil,util,$,html5,player_util,dom_util,perr){var E={};var assign=Object.assign;var JWCG=function(option){return util.gconf_get("loader.player.jwplayer."+option)};E.Player=function(opt){var _this=this;var dm_events=["quality_level","manifest_parsed","manifest_loaded","detached","error","level_loaded","level_updated","seg_stats","buf_stats","frag_load_stats","system_seek"];util.call_super(E,this,null,opt);this.config={disable_idle_delay:JWCG("disable_idle_delay"),disable_bufev_hack:JWCG("disable_bufev_hack"),midroll_rewind_sec:JWCG("midroll_rewind_sec"),disable_init_state:JWCG("disable_init_state"),use_jw_state:JWCG("use_jw_state"),ad_play_check_state:JWCG("ad_play_check_state"),use_beforecomplete:JWCG("use_beforecomplete")};this.log=player_util.log(opt.log,"zjwplayer3");this.delayed_events=[];this.attach_slave=function(video,hls){var provider;this.hls=hls;this.slave=create_html5_instance(this,{html5:video,dailymotion:hls});dm_events.forEach(function(evt){_this.slave["dm_"+evt]=function(e){_this.emit(evt,e)};_this.slave.on(evt,_this.slave["dm_"+evt])});if(this.provider_name=="hola/hls"&&(provider=this.jwplayer.provider)&&!provider.old_seek){provider.old_seek=provider.seek;provider.seek=function(pos){_this.usr_seek=true;provider.old_seek(pos)}}this.onseeking_h5_cb=function(position,offset){onseeking.call(_this,{low_level:true,offset:offset})};this.slave.on("seeking",this.onseeking_h5_cb);this.slave.on("seeked",this.onseeked_cb)};this.detach_slave=function(){dm_events.forEach(function(evt){_this.slave.off(evt,_this.slave["dm_"+evt]);_this.slave["dm_"+evt]=undefined});this.slave.off("seeking",this.onseeking_h5_cb);this.slave.off("seeked",this.onseeked_cb);if(this.slave.uninit)this.slave.uninit();this.slave=undefined};this.jwplayer=opt.jwplayer;this.jwadapter=E.adapters.get(this.jwplayer);this.jwplayer_ver=this.jwadapter.version;this["is_v"+(E.jw_isV7plus(this.jwplayer_ver)?"7plus":"6")]=true;if(this.is_v6)perr({id:"old_jw_version",info:{ver:this.jwplayer_ver}});if(this.is_v7plus)this.provider_name=this.jwplayer.getProvider().name;if(this.provider_name=="dm/hls")perr({id:"old_jw_hls_provider_error",add_log:true});this.int_events=new util.events;this.container=this.jwadapter.get_container();this.swf=this.jwadapter.get_swf();this.html5=!this.swf&&this.container&&this.container.querySelector("video");var video_type=this.get_video_type_name(this.jwadapter.get_playlist_url());var is_progressive=util.is_progressive(video_type);this.tech=this.jwadapter.get_tech();if(this.html5&&is_progressive)this.html5_inst=create_html5_instance(this);this.name="jwplayer";this.bitrate={};this.is_html5_paused=function(){return this.html5&&this.html5.paused};this.schedule=function(cb){var delayed_events=_this.delayed_events;var tid=setTimeout(function(){delayed_events.splice(delayed_events.indexOf(tid),1);cb()});delayed_events.push(tid)};this.schedule_fn=function(cb){return function(e,o){if(_this.tech=="html5")return cb(e,o);_this.schedule(function(){cb(e,o)})}};this.state=this._get_init_state();this._ad_watch();var duration_update=function(to){if(_this.duration===undefined||_this.duration!=to){_this.duration=to;_this.emit("duration_changed")}};var onquality=function(e){this.emit("quality_level");if(this.html5_inst){this.emit("interrupted");this.html5_inst.once("started",function(){_this.emit("started")})}};var onbuffer_change=function(e){if(!this.swf)return;this.position=e.position||0;duration_update(e.duration>>0==-1?0:e.duration>>0);var buffer=e.bufferPercent||0;var from=this.position;var to=Math.max(from,buffer*this.duration/100);this.last_buffer=!this.duration?{from:0,to:0}:{from:from,to:to};this.refresh_buffered();this.emit("timeupdate",this.position)};var onseeking=function(e){if(this.html5&&(this.ad_attached||this.html5.readyState<this.html5.HAVE_METADATA)){return this.pending_seek=this.pending_seek||zutil.clone(e)}if(this.usr_seek===undefined&&this.provider_name!="hola/hls")this.usr_seek=!e.low_level;if(e.offset==this.seeking_to)return;this.seeking_to=e.offset;this.prev_position=this.position;this.position=e.offset||0;this.emit("seeking",this.prev_position,this.position,!this.usr_seek)};var onseeking_flush=function(e){if(this.pending_seek)onseeking.call(this,this.pending_seek);this.pending_seek=undefined};var onseeked=function(){if(this.seeking_to===undefined)return;if(!this.usr_seek)this.emit("system_seek");this.seeking_to=this.usr_seek=undefined;this.emit("seeked")};var ontimeupdate=function(e){if(this.swf||!this.html5_inst){if(!this.swf&&(e.position<0||e.duration<0)){this.position=this.get_pos();duration_update(this.get_duration())}else{this.position=e.position;var dur=Math.trunc(e.duration);duration_update(dur==-1?0:dur)}}else{this.position=this.html5_inst.get_pos();duration_update(this.get_duration())}if(this.is_live_stream())this.refresh_buffered();this.emit("timeupdate",this.position)};var onended=function(e){this.emit("ended",{full_complete:true})};var oncaptions=function(e){this.emit("captions",e.tracks.length)};var onmediatype=function(e){if(this.media_type==e.mediaType)return;this.media_type=e.mediaType;this.emit("media_type",e.mediaType)};this.ontimeupdate_cb=this.schedule_fn(ontimeupdate.bind(this));this.onbuffer_change_cb=this.schedule_fn(onbuffer_change.bind(this));this.onseeking_cb=this.schedule_fn(onseeking.bind(this));this.onseeking_flush_cb=this.schedule_fn(onseeking_flush.bind(this));this.onseeked_cb=this.schedule_fn(onseeked.bind(this));this.onquality_cb=this.schedule_fn(onquality.bind(this));this.onended_cb=this.schedule_fn(onended.bind(this));this.oncaptions_cb=this.schedule_fn(oncaptions.bind(this));this.onmediatype_cb=this.schedule_fn(onmediatype.bind(this));if(this.is_v7plus&&["hola/hls","hlsjs"].includes(this.provider_name))this.attach_slave(this.html5,this.jwplayer.hls);this._onbeforeplay_cb=function(e){e=e||{};_this.int_events.emit("hola.before_play",e);if(e.hola_ignore)return;var scrubbing=$(_this.jwadapter.get_container()).hasClass("jw-flag-dragging");if(_this.is_idle()){var url=_this.get_url();if(!scrubbing){_this.saved_url=url;_this.state=_this.is_html5_paused()?"PAUSED":"PLAYING";if(_this.html5_inst&&!html5.get_video_source(_this.html5)){_this.html5_inst.once("started",function(){if(_this.get_url()==url)_this.emit("started",url)})}else _this.emit("started",url);_this.emit("state",_this.state)}}if(_this.adjust_pos&&_this.html5&&_this.html5.currentTime)_this.html5.currentTime+=.1};this.onbeforeplay_cb=this.schedule_fn(this._onbeforeplay_cb);this.onstatebuffering_cb=this.schedule_fn(function(e){if(!_this.config.disable_bufev_hack&&_this.get_duration()>=3&&_this.get_pos()>=_this.get_duration()-3&&!_this.is_live_stream()){return}if(_this.is_v6&&_this.is_idle())_this._onbeforeplay_cb(e);_this.emit("waiting");if(_this.is_playing()||_this.is_paused()&&_this.is_html5_paused())return;_this.emit("state",_this.state="PLAYING");_this.emit("play")});this.onstateplaying_cb=this.schedule_fn(function cb(e){if(_this.seeking_to!==undefined){if(_this.has_seeked)return _this.once("seeked",cb.bind(null,e));onseeked()}_this.int_events.emit("hola.onplay",e);if(e&&e.hola_ignore||_this.state=="PLAYING")return;_this.emit("state",_this.state="PLAYING");_this.emit("play")});this.onstatepaused_cb=this.schedule_fn(function(e){_this.int_events.emit("hola.onpause",e);if(e&&e.hola_ignore||_this.state=="PAUSED")return;_this.emit("state",_this.state="PAUSED");_this.emit("pause")});this.onstateidle_cb=this.schedule_fn(function(e){e=e||{};if(_this.state=="IDLE")return;_this.inside_stateidle_cb=true;_this.state="IDLE";if(_this.is_v7plus&&e.reason=="complete"||_this.is_v6&&_this.get_pos()>=_this.get_duration()-3){_this.int_events.emit("hola.before_complete");_this.emit("ended",{full_complete:true});_this.emit("state",_this.state)}else{E.hacks.delay_early_idle(_this,function(){_this.emit("state",_this.state)})}_this.inside_stateidle_cb=false});this.onerror_cb=this.schedule_fn(function(e){function emit(msg,reason,code,ext){_this.emit("error",assign({code:code,message:msg,reason:reason},ext))}var video_err_map={1:{message:"download was cancelled",reason:"other"},2:{message:"network error",reason:"media_load"},3:{message:"decode error",reason:"media_decode"},4:{message:"source not supported",reason:"media_support"},5:{message:"encryption error",reason:"media_decode"}};var info,msg;if(_this.html5&&_this.html5.error&&(info=video_err_map[_this.html5.error.code])){var details;if(!window.MediaSource)details="media source is not supported";else{var type='video/mp4; codecs="avc1.4D401E, mp4a.40.2"';if(!_this.html5.canPlayType(type))details="html5 video does not support necessary codecs";else if(!window.MediaSource.isTypeSupported(type))details="MSE does not support necessary codecs"}if(!details){details=e.type=="error"&&e.message?e.message:"unknown reason of unsupported video"}var _info={src:_this.html5.src,current_src:_this.html5.currentSrc,hola_src:_this.html5.hola_src,network_state:_this.html5.networkState,preload:_this.html5.preload,ready_state:_this.html5.readyState,buffered:html5.dump_buffered(_this.html5),media_source_state:_this.html5_inst&&_this.html5_inst.media_src&&_this.html5_inst.media_src.readyState,details:details};info.message=_this.html5.error&&_this.html5.error.message||info.message;return emit(info.message,info.reason,_this.html5.error.code,{info:_info})}if(!(msg=e.message))return emit("Unknown error","other");var list={"Flash plugin failed to load":"other","Click to run Flash":"other","Not a valid RSS":"other","Playlist load error":"other","Error loading file":"other","Error loading media: File not found":"media_load","Error loading media: File could not be played":"media_decode","no playable source":"manifest_parse","Unsupported media":"media_support","AES decryption not supported in":"media_support","Network Error: http status":"media_load","Bad Request:":"media_load"};var r;if(r=zutil.find(list,function(v,k){return msg.startsWith(k)}))return emit(msg,r);if(msg.startsWith("The play() request was interrupted by a new load")){return emit(msg,"media_load",undefined,{hola_dont_detach:true})}if(!msg.startsWith("Cannot load M3U8: "))return emit(msg,"media_load");var smsg=msg.substr(18),m;var smap={"File is empty":"manifest_load","crossdomain access denied":"manifest_load","404 not found":{reason:"manifest_load",status:404},"uri cannot be null":"manifest_load","data cannot be null":"manifest_load","requestTime cannot be null":"manifest_load","responseTime cannot be null":"manifest_load","unable to parse URI":"manifest_parse","No levels to play":"manifest_parse","No levels in manifest":"manifest_parse","Unsupported byte-range":"manifest_parse","Empty manifest":"manifest_parse","unsupported encryption method SAMPLE-AES":"media_decode","Missing audio track URL":"manifest_parse","Missing subtitles track URL":"manifest_parse"};if(r=zutil.find(smap,function(v,k){return smsg.startsWith(k)})){return typeof r=="string"?emit(msg,r):emit(msg,"",undefined,r)}if(m=smsg.match(/^(\d+) status code/))return emit(msg,"manifest_load",m[1],{status:m[1]});emit(msg,"manifest_load")});this.onvolumechange_cb=this.schedule_fn(function(){_this.emit("volumechange")});this.onaderror_cb=this.schedule_fn(function(e){_this.emit("ad_error",e.message||"Unknown error")});this.onadimpression_cb=this.schedule_fn(function(e){_this.emit("ad_impression",{ad_type:e.adposition})});this.onadpause_cb=this.schedule_fn(function(e){_this.emit("ad_pause",{ad_type:e.adposition})});this.onadplay_cb=this.schedule_fn(function(e){if(e.oldstate!="paused")_this.emit("ad_start",{ad_type:e.adposition});if(!_this.config.ad_play_check_state||e.newstate=="playing")_this.emit("ad_play",{ad_type:e.adposition})});this.onadskipped_cb=this.schedule_fn(function(e){_this.emit("ad_skipped",{ad_type:e.adposition})});this.onadclick_cb=this.schedule_fn(function(e){_this.emit("ad_skipped",{ad_type:e.adposition})});this.onadcomplete_cb=this.schedule_fn(function(e){_this.emit("ad_complete",{ad_type:e.adposition})});this.onadtime_cb=this.schedule_fn(function(e){_this.emit("ad_time",{duration:e.duration,ad_type:e.adposition,position:e.position})});this.onadrequest_cb=this.schedule_fn(function(e){_this.emit("ad_request",{ad_type:e.adposition})});this.onadblock_cb=this.schedule_fn(function(e){_this.emit("ad_block",{ad_type:e.adposition})});if(this.html5)this.html5.addEventListener("seeking",this.onseeking_flush_cb);if(this.html5_inst){var prev=0;this.timeupdate_int=setInterval(function(){var pos;if(!_this.html5_inst||(pos=_this.html5_inst.get_pos())==prev)return;prev=pos;ontimeupdate.call(_this)},500)}if(this.html5&&this.html5.hasAttribute("jw-gesture-required")){this.autoplay_unwatch=dom_util.attr_watch(this.html5,{attr:"autoplay-failed",watch_fn:function(from,to){if(to&&_this.is_playing()&&_this.jwadapter.get_state()=="IDLE"){_this.emit("state",_this.state="PAUSED");_this.log.info("autoplay failed")}}})}this.jwadapter.on("bufferChange",this.onbuffer_change_cb);this.jwadapter.on("time",this.ontimeupdate_cb);this.jwadapter.on("seek",this.onseeking_cb);this.has_seeked=this.is_v7plus&&(!/^7\.1\.[0-9]+/.test(this.jwplayer_ver)||this.tech!="flash");if(this.has_seeked)this.jwadapter.on("seeked",this.onseeked_cb);this.jwadapter.on("levelsChanged",this.onquality_cb);if(this.config.use_beforecomplete)this.jwadapter.on("beforeComplete",this.onended_cb);else this.jwadapter.on("complete",this.onended_cb);if(this.jwplayer._events&&this.jwplayer._events.beforePlay){var old=this.jwplayer._events.beforePlay;this.jwplayer._events.beforePlay=[];this.jwadapter.on("beforePlay",this.onbeforeplay_cb);[].push.apply(this.jwplayer._events.beforePlay,old)}else this.jwadapter.on("beforePlay",this.onbeforeplay_cb);this.jwadapter.on("mute",this.onvolumechange_cb);this.jwadapter.on("volume",this.onvolumechange_cb);this.jwadapter.on("subtitlesTracks",this.oncaptions_cb);this.jwadapter.on("error",this.onerror_cb);this.jwadapter.on("buffer",this.onstatebuffering_cb);this.jwadapter.on("play",this.onstateplaying_cb);this.jwadapter.on("pause",this.onstatepaused_cb);this.jwadapter.on("idle",this.onstateidle_cb);this.jwadapter.on("adError",this.onaderror_cb);this.jwadapter.on("adImpression",this.onadimpression_cb);this.jwadapter.on("adPause",this.onadpause_cb);this.jwadapter.on("adPlay",this.onadplay_cb);this.jwadapter.on("adSkipped",this.onadskipped_cb);this.jwadapter.on("adClick",this.onadclick_cb);this.jwadapter.on("adComplete",this.onadcomplete_cb);this.jwadapter.on("adTime",this.onadtime_cb);this.jwadapter.on("adRequest",this.onadrequest_cb);this.jwadapter.on("adBlock",this.onadblock_cb);this.jwadapter.on("mediaType",this.onmediatype_cb);this.refresh_buffered();this.stash=function(){var hp;if(!this.html5_inst&&is_hls_provider_registered()&&(hp=this.jwplayer.provider)){hp.hls_queued.rw_sec=this.config.midroll_rewind_sec||0;return function(){_this.refresh_buffered()}}return function(){}};this.wrapper_check_skip_video=function(e){var _video_type=_this.get_video_type_name();if(util.is_adaptive(_video_type)&&e.mode=="cdn"){if(!_this.slave||_this.provider_name=="hlsjs")e.skip="cannot enable adaptive: missing dm subplayer"}};this.on("wrapper.check_skip_video",this.wrapper_check_skip_video);this.media_type=this.jwadapter.get_media_type();this.ad_handler=player_util.select_ad_handler(this,E.ad_handlers,{client:this.jwadapter.get_ad_client(),tech:this.swf?"flash":"html5",type:is_progressive?"progressive":"adaptive"})};zutil.inherits(E.Player,player_util.Player);E.Player.prototype._get_init_state=function(){var jw_state=this.jwadapter.get_state();if(this.config.disable_init_state)return this.is_ad_source()?"PAUSED":jw_state;var is_progressive=!!this.html5_inst;if(jw_state=="IDLE"&&util.cmp_version(this.jwplayer_ver,"7.2.4")>=0&&is_progressive&&html5.get_video_source(this.html5)&&!(this.is_autostart()||this.html5.preload=="none")){this.int_events.once("hola.before_play",function(e){e.hola_ignore=true});return"PAUSED"}return jw_state=="IDLE"||jw_state=="PAUSED"?jw_state:"PLAYING"};E.Player.prototype._ad_watch=function(){var _this=this;var container=this.jwadapter.get_container();function suspend(){_this.log.info("ad mode started: "+(_this.is_v7plus?"jw-flag-ads":".jwinstream child")+" detected");_this.ad_active=true;_this.int_events.emit("hola.ad_suspend")}function restore(){_this.log.info("ad mode finished: "+(_this.is_v7plus?"jw-flag-ads":".jwinstream child")+" removed");_this.ad_active=false;_this.int_events.emit("hola.ad_restore")}if(this.is_v7plus){if($(container).hasClass("jw-flag-ads"))suspend();this.ad_unwatch=dom_util.attr_watch(container,{attr:"class",toggle_pattern:/(^|\s)jw-flag-ads(\s|$)/,watch_fn:function(from,to){if(to)return suspend();restore()}});return}var $instream=$(".jwinstream",container);if($instream.length&&!$instream.is(":empty"))suspend();this.ad_unwatch=dom_util.dom_listen(container,function(changes){for(var i in changes){var change=changes[i];if(!$(change.target).hasClass("jwinstream"))continue;if(change.addedNodes.length)suspend();if(change.removedNodes.length)restore()}})};E.Player.prototype._ad_watch_uninit=function(){if(this.ad_unwatch)this.ad_unwatch()};E.Player.prototype.get_pos=function(){var pos=this.ad_attached?this.ad_attached.position:this.xxx_html5?this.html5.currentTime:this.swf?this.position||0:this.seeking_to||this.jwplayer.getPosition();if(pos<0&&this.is_v7plus&&this.provider_name=="hlsjs")pos=this.html5.currentTime;return pos};E.Player.prototype.get_state=function(){if(this.ad_attached)return this.ad_attached.state;if(this.config.use_jw_state&&this.jwplayer.getState)return this.jwplayer.getState()=="playing"?"PLAYING":"PAUSED";return this.state};E.Player.prototype.uninit=function(){this._ad_watch_uninit();if(this.html5)this.html5.removeEventListener("seeking",this.onseeking_flush_cb);this.timeupdate_int=clearInterval(this.timeupdate_int);this.jwadapter.off("bufferChange",this.onbuffer_change_cb);this.jwadapter.off("time",this.ontimeupdate_cb);this.jwadapter.off("seek",this.onseeking_cb);this.jwadapter.off("seeked",this.onseeked_cb);this.jwadapter.off("levelsChanged",this.onquality_cb);if(this.config.use_beforecomplete)this.jwadapter.off("beforeComplete",this.onended_cb);else this.jwadapter.off("complete",this.onended_cb);this.jwadapter.off("beforePlay",this.onbeforeplay_cb);this.jwadapter.off("mute",this.onvolumechange_cb);this.jwadapter.off("volume",this.onvolumechange_cb);this.jwadapter.off("buffer",this.onstatebuffering_cb);this.jwadapter.off("play",this.onstateplaying_cb);this.jwadapter.off("pause",this.onstatepaused_cb);this.jwadapter.off("idle",this.onstateidle_cb);this.jwadapter.off("subtitlesTracks",this.oncaptions_cb);this.jwadapter.off("error",this.onerror_cb);this.jwadapter.off("adError",this.onaderror_cb);this.jwadapter.off("adImpression",this.onadimpression_cb);this.jwadapter.off("adPause",this.onadpause_cb);this.jwadapter.off("adPlay",this.onadplay_cb);this.jwadapter.off("adSkipped",this.onadskipped_cb);this.jwadapter.off("adClick",this.onadclick_cb);this.jwadapter.off("adComplete",this.onadcomplete_cb);this.jwadapter.off("adTime",this.onadtime_cb);this.jwadapter.off("adRequest",this.onadrequest_cb);this.jwadapter.off("adBlock",this.onadblock_cb);this.jwadapter.off("mediaType",this.onmediatype_cb);this.off("wrapper.check_skip_video",this.wrapper_check_skip_video);if(this.ad_handler)this.ad_handler.uninit();if(this.html5_inst)this.html5_inst.uninit();if(this.slave)this.detach_slave();if(this.autoplay_unwatch)this.autoplay_unwatch()};E.Player.prototype.get_video_type_name=function(url){if(0&&!url){var item=this.jwplayer.getPlaylistItem();return item.sources[0].type}var parent=player_util.Player.prototype;return parent.get_video_type_name.call(this,url)};E.Player.prototype.get_ad_scheme=function(){return this.jwadapter.get_ad_client()};E.Player.prototype.is_native_hls=function(){var p;if(this.get_video_type_name()!="hls")return false;if(this.jwplayer.getProvider)return(p=this.jwplayer.getProvider())&&p.name=="html5"};E.Player.prototype.get_url=function(){var s;if(this.ad_attached)return this.ad_attached.url;if(this.html5&&(s=html5.get_video_source(this.html5))&&!util.is_blob_url(s)){return s}return this.get_playlist_url()};E.Player.prototype.get_playlist_url=function(){return this.jwadapter.get_playlist_url(this.log)};E.Player.prototype.check_seekable=function(){var result={res:this.provider_name!="hola/hls"&&(this.provider_name!="hlsjs"||E.jw_isV8(this.jwplayer_ver))||(this.get_buffered()||[]).length};if(!result.res){result.msg="jwplayer upgrade to 8.0.0+ required, "+"v"+this.jwplayer_ver+" overrides seek-on-start"}return result};E.Player.prototype.seek=function(ms,seek_adjust){if(!seek_adjust)return this.jwplayer.seek(ms/1e3);if(this.slave)return void this.slave.seek(ms);if(this.html5_inst){var _this=this;this.html5_inst.on("seeking",function on_seek(){_this.onseeking_cb({offset:ms/1e3});_this.html5_inst.off("seeking",on_seek)});return void this.html5_inst.seek(ms)}};E.Player.prototype.refresh_buffered=function(){if(!this.slave&&!this.html5_inst&&!this.swf)return this.buffered={length:0};if(!this.swf){return this.buffered=this.slave?this.slave.refresh_buffered():this.html5_inst.refresh_buffered()}var from=0,to=0,ret={};if(this.last_buffer&&(!to&&!from||this.last_buffer.to>to)){from=this.last_buffer.from;to=this.last_buffer.to}ret.length=from==to?0:1;ret.start=function(i){return from};ret.end=function(i){return to};return this.buffered=ret};E.Player.prototype.get_buffered=function(){if(this.slave)return this.slave.get_buffered();if(this.swf)return this.buffered||this.refresh_buffered();if(!this.is_ad_active()){var b=this.html5.buffered;var a=[];for(var i=0;i<b.length;i++)a.push({start:b.start(i),end:b.end(i)});this.buffered={length:a.length};this.buffered.start=function(idx){return a[idx].start};this.buffered.end=function(idx){return a[idx].end}}return this.buffered||this.refresh_buffered()};E.Player.prototype.get_duration=function(){var dur=this.ad_attached?this.ad_attached.duration:this.xxx_html5?this.html5.duration:this.swf?this.duration:this.jwplayer.getDuration();return this.html5&&this.is_live_stream()?Infinity:dur!=-1?dur:0};E.Player.prototype.is_autostart=function(){return!!this.jwadapter.get_config().autostart};E.Player.prototype.captions_supported=function(){return this.tech=="html5"&&this.jwplayer.provider&&this.jwplayer.provider.supports_captions?this.jwplayer.provider.supports_captions():true};E.Player.prototype.hap_enabled=function(){return this.slave&&this.slave.hap_enabled&&this.slave.hap_enabled()};E.Player.prototype.is_live_stream=function(){if(this.live_stream!==undefined)return this.live_stream;if(!this.swf){if(this.slave&&this.slave.module)return this.slave.is_live_stream();return this.is_v7plus&&["LIVE","DVR"].includes(this.jwadapter.get_config().streamType)}};E.Player.prototype.play=function(){this.jwadapter.play()};E.Player.prototype.pause=function(){this.jwadapter.pause()};E.Player.prototype.play_url=function(url,opt){opt=opt||{};var jw=this.jwplayer,jwadapter=this.jwadapter;var index=jw.getPlaylistIndex();var playlist=jw.getPlaylist();var autostart=jwadapter.get_config().autostart;var is_start_playing=false;jwadapter.once("play",function(){is_start_playing=true});function skip_ad(){if(!is_start_playing&&jw.skipAd)jw.skipAd()}jwadapter.once("adRequest",call_once(skip_ad));jwadapter.once("adStarted",call_once(skip_ad));jwadapter.once("adMeta",call_once(skip_ad));jwadapter.once("adPlay",call_once(skip_ad));jw.load(playlist);if(opt.pos&&this.get_video_type_name(url)=="hls"){jwadapter.on("levels",function(){setTimeout(function(){jw.seek(opt.pos)})});if(!autostart)jw.playlistItem(index)}else{if(!autostart)jw.playlistItem(index);if(opt.pos){if(this.tech=="flash"||this.is_v7plus)jwadapter.once("meta",function(){jw.seek(opt.pos)});else jw.seek(opt.pos)}}if(opt.is_paused){jwadapter.once("play",function(){setTimeout(function(){jwadapter.pause()},300)})}};E.Player.prototype.enable_data_mode=function(on_sourceopen){if(this.data_mode)return;this.data_mode=true;if(this.html5){E.hacks.no_relative_change(this);this.html5_inst.enable_data_mode(function(media_src){this.media_src=media_src;on_sourceopen(media_src)}.bind(this));E.hacks.preload_none(this);this.load_unlock=E.hacks.lock_reload_request(this)}};E.Player.prototype.disable_data_mode=function(){if(!this.data_mode)return;this.data_mode=false;if(this.html5){if(this.load_unlock)this.load_unlock();this.media_src=this.load_unlock=undefined;return this.html5_inst.disable_data_mode()}};E.Player.prototype.is_playing=function(){return this.get_state()=="PLAYING"};E.Player.prototype.is_paused=function(){return!this.is_idle()&&!this.is_playing()};E.Player.prototype.is_idle=function(){return this.get_state()=="IDLE"};E.Player.prototype.is_interrupted=function(){return this.is_ad_active()&&this.ad_handler&&this.ad_handler.is_interruptive};E.Player.prototype.scrubbing=function(is_scrubbing){if(is_scrubbing===undefined){return this.is_scrubbing||$(this.jwadapter.get_container()).hasClass("jw-flag-dragging")}this.is_scrubbing=is_scrubbing};E.Player.prototype.is_ad_active=function(){if(this.ad_handler&&this.ad_handler.is_ad_active)return this.ad_handler.is_ad_active();return this.ad_active===undefined?this.ad_external:this.ad_active};E.Player.prototype.is_ad_source=function(){return!!this.ad_attached||util.call_super(E,this,"is_ad_source")};E.Player.prototype.is_ad_playing=function(){return this.is_ad_active()&&this.jwplayer.getState()=="playing"};E.Player.prototype.is_ad_paused=function(){return this.is_ad_active()&&this.jwplayer.getState()=="paused"};E.Player.prototype.ad_play=function(){if(this.is_ad_active())this.jwadapter.play()};E.Player.prototype.ad_pause=function(){if(this.is_ad_active())this.jwadapter.pause()};E.Player.prototype.get_ui=function(){if(!this.container)return{};return{container:this.container,control_bar:this.container.querySelector(".jw-controlbar"),progress_bar:this.container.querySelector(".jw-slider-time, "+".jw-controlbar-center-group"),fullscreen:this.container,media:this.html5||this.swf}};E.Player.prototype.get_player=function(){return this.jwplayer};E.Player.prototype.get_levels=function(cached){if(cached&&this.levels)return this.levels;if(this.slave)return this.levels=this.slave.get_levels();return{}};E.Player.prototype.get_playlists=function(){if(this.slave)return this.slave.get_playlists();if(!this.jwplayer.getQualityLevels)return;var levels=this.jwplayer.getQualityLevels();var sources=this.jwplayer.getPlaylist()[0].sources;var is_progressive=sources[0].type=="mp4";if(!levels||!levels.length)return;var ret=[];levels.forEach(function(l,i){var url=is_progressive?sources[i].file:"playlist_"+i;var p={playlist:url,url:url,jw_index:i,label:l.label,bitrate:l.bitrate,attributes:{bandwidth:l.bitrate}};if(l.width>10&&l.height>10)p.attributes.resolution={width:l.width,height:l.height};ret.push(p)});ret.sort(function(a,b){return a.bitrate-b.bitrate});ret.forEach(function(p,i){p.level_idx=i});return ret};E.Player.prototype.get_current_playlist=function(with_segments){if(this.slave)return this.slave.get_current_playlist(with_segments);if(!this.jwplayer.getQualityLevels)return;var levels=this.jwplayer.getQualityLevels();if(!levels||!levels.length)return;if(!this.jwplayer.getVisualQuality)return;var l=(this.jwplayer.getVisualQuality()||{}).level;if(!l)return;var playlists=this.get_playlists();if(!playlists)return;for(var i=0;i<playlists.length;i++){if(playlists[i].jw_index==l.index)return playlists[i]}};E.Player.prototype.get_segment_info=function(url){var res;if(this.levels){for(var idx in this.levels){if(this.levels[idx].segments){if(res=this.levels[idx].segments.find(function(v){return v.url===url})){return res}}}}};E.Player.prototype.get_bitrate=function(){if(!this.swf){var q=this.jwplayer.getVisualQuality&&this.jwplayer.getVisualQuality();return q&&q.level&&q.level.bitrate||0}var level=this.get_current_level();if(this.bitrate[level])return this.bitrate[level];if(this.levels&&this.levels[level])return this.levels[level].bitrate;var levels=this.get_levels();if(!levels)return 0;if(!levels[level])return 0;return this.bitrate[level]=levels[level].bitrate||0};E.Player.prototype.is_bitrate_supported=function(){return this.slave?this.slave.is_bitrate_supported():true};E.Player.prototype.get_current_fragment={};E.Player.prototype.get_current_level=function(){if(this.slave)return this.slave.get_current_level()};E.Player.prototype.get_bandwidth=function(){if(this.slave)return this.slave.get_bandwidth();return 0};E.Player.prototype.init_adaptive=function(adaptive){if(this.slave)return this.slave.init_adaptive(adaptive)};E.Player.prototype.ondata_adaptive=function(chunk,adaptive){if(this.slave)return this.slave.ondata_adaptive(chunk,adaptive)};E.Player.prototype.get_resolution=function(debug_mode){var element=this.html5||this.swf||this.container;var res=dom_util.get_elm_resolution(element);var debug_res=element&&getComputedStyle(element);if(this.hap_debug_no_height&&res&&res.height){perr({id:"hap_debug_resolution_obtained",throttle:1,info:{player_name:this.name,element:!!element,width:res.width,height:res.height,res:debug_res,call_from:debug_mode}})}if(debug_mode=="hap_resolution"&&(!res||!res.height)){perr({id:"hap_debug_resolution_player",throttle:1,info:{player_name:this.name,element:!!element,width:(res||{}).width,height:(res||{}).height,res:debug_res,initial_msg:!this.hap_debug_no_height}});this.hap_debug_no_height=true}return res};E.Player.prototype.get_decoded_frames=function(){return this.html5?html5.get_decoded_frames(this.html5):undefined};E.Player.prototype.get_dropped_frames=function(){return this.html5?html5.get_dropped_frames(this.html5):undefined};E.Player.prototype.get_caps=function(){return player_util.Player.prototype.get_caps({save_context:["progressive","hls","hap_hls"],hap_provider_loaded:!!(window.hola_jwplayer_hls||util.dom_query("script[src*=hola_jwplayer_hls]")),interruptive_ads:!!(this.ad_handler||{}).is_interruptive})};E.Player.prototype.get_est_bytes=function(){if(this.slave)return this.slave.get_est_bytes();var res=null;var el=this.jwadapter.get_video_el();if(el&&el.tagName&&el.tagName.toLowerCase()=="video"){util.assert_enabled(html5,"html5 module is required but disabled");res=html5.est_bytes_from_tag(el)}return res};E.Player.prototype.get_media_type=function(){return this.ad_attached?this.ad_attached.media_type:this.media_type};E.Player.prototype.check_buffer=function(opt){if(this.html5_inst)this.html5_inst.check_buffer(opt)};E.Player.prototype.get_captions_track=function(){return this.jwplayer.getCurrentCaptions()-1};E.Player.prototype.set_captions_track=function(track){this.jwplayer.setCurrentCaptions(track+1)};E.Player.prototype.play_src=function(src){var s=src.map(function(pl){return{file:pl.file||pl.url,image:pl.poster,type:pl.type}});this.jwplayer.load([{sources:s}]);this.jwadapter.play()};E.Player.prototype.muted=function(v){if(v===undefined)return this.jwplayer.getMute();this.jwplayer.setMute(v)};E.Player.prototype.volume=function(v){if(v===undefined)return this.jwplayer.getVolume()/100;this.jwplayer.setVolume(v*100)};E.Player.prototype.fullscreen=function(v){if(v===undefined)return this.jwplayer.getFullscreen();this.jwplayer.setFullscreen(v)};E.Player.prototype.get_versions=function(){var ver={jw:this.jwplayer_ver};if(this.slave&&this.slave.module&&this.slave.module.get_versions)assign(ver,this.slave.module.get_versions());return ver};E.ad_handlers={};E.ad_handlers.Html5VastClient=function(player){this.player=player;this.log=player.log.set_module("vast");this.init()};E.ad_handlers.Html5VastClient.is_enabled=function(opt){return opt.tech=="html5"&&opt.client=="vast"};E.ad_handlers.Html5VastClient.prototype.is_ad_active=function(){return false};E.ad_handlers.Html5VastClient.prototype.init=function(){var _this=this,player=this.player;this.is_before_play=true;function is_playlist_url(){
var src=html5.get_video_source(player.html5);if(util.is_blob_url(src))src=_this.html5_inst.blob2url[src]||src;if(util.is_blob_url(src))return true;try{return util.fix_url(src)==util.fix_url(player.jwadapter.get_playlist_url(player.log))}catch(e){_this.log.err("playlist url check failed");return false}}function ad_in_progress(){return player.ad_attached&&player.ad_attached.state!="IDLE"}function ad_src_check(){if(player.ad_attached)return;if(!html5.get_video_source(player.html5)){_this.pending_play=_this.pending_play||_this.is_before_play;return player.ad_attached={state:"IDLE",empty_init:true}}}function ad_init(){if(ad_in_progress())ad_uninit();if(ad_src_check())return;player.ad_attached={position:0,duration:0,media_type:"video",url:html5.get_video_source(player.html5),state:player.html5.paused?"PAUSED":"PLAYING"};_this.html5_inst.on("waiting",_this.on_html5_waiting);_this.html5_inst.on("error",_this.on_html5_error);if(_this.html5_inst.created_by_vast){if(player.slave){player.detach_slave();_this.reattach_slave=true}player.html5_inst=_this.html5_inst;player.html5_inst.log=player.html5_inst.log.unmute()}}function ad_uninit(opt){opt=opt||{};if(!ad_in_progress())return;_this.html5_inst.off("error",_this.on_html5_error);_this.html5_inst.off("waiting",_this.on_html5_waiting);player.ad_attached.state="IDLE";player.emit(opt.ad_skipped?"state":"ended");if(_this.html5_inst.created_by_vast){player.html5_inst.log=player.html5_inst.log.mute();player.html5_inst=undefined;if(_this.reattach_slave){_this.reattach_slave=false;player.attach_slave(player.html5,player.jwplayer.hls)}}}this.on_html5_started=function(url){if(is_playlist_url()){_this.is_before_play=false;var had_ads=player.ad_attached&&!player.ad_attached.empty_init;if(!had_ads&&!_this.pending_play)return;_this.log.info((had_ads?"ad":"init")+">main switch");player.ad_attached=undefined;_this.pending_play=false;if(player.state=="IDLE")player.state=player._get_init_state()}else{_this.log.info((player.ad_attached?"ad":"main")+">ad switch");ad_init();if(!player.ad_attached.url)return _this.log.info("no ad url - ignored")}player.emit("started");player.emit("state")};this.on_html5_waiting=function(){player.emit("waiting")};this.on_html5_error=function(e){player.emit("error",assign({hola_dont_detach:true},e))};this.on_html5_timeupdate=function(position){this.is_before_play=false;if(!player.ad_attached||player.ad_attached.state=="IDLE")return;player.ad_attached.position=position;if(!player.ad_attached.duration)player.ad_attached.duration=_this.html5_inst.get_duration();player.emit("timeupdate",position)};this.on_html5_interrupted=function(){if(!player.ad_attached){if(!is_playlist_url()){player.emit("interrupted");ad_src_check()}return}ad_uninit({ad_skipped:true})};this.on_html5_ended=function(){if(player.ad_attached)ad_uninit();else{player.emit("ended",{full_complete:true})}};this.on_jwplayer_beforeplay=function(e){_this.is_before_play=true;if(!html5.get_video_source(player.html5))e.hola_ignore=_this.pending_play=true};this.on_jwplayer_ad_state=function(state){if(!ad_in_progress()||player.ad_attached.state==state)return;player.ad_attached.state=state;player.emit(state=="PLAYING"?"play":"pause");player.emit("state")};this.on_jwplayer_ad_play=this.on_jwplayer_ad_state.bind(this,"PLAYING");this.on_jwplayer_ad_pause=this.on_jwplayer_ad_state.bind(this,"PAUSED");this.on_player_complete=function(e){if(!e||!e.full_complete)return;ad_uninit({ad_skipped:true});player.ad_attached=undefined};if(!(this.html5_inst=player.html5_inst)){this.html5_inst=create_html5_instance(player);this.html5_inst.created_by_vast=true;this.html5_inst.log=this.html5_inst.log.mute()}player.on("pre-ended",this.on_player_complete);this.html5_inst.on("started",this.on_html5_started);this.html5_inst.on("interrupted",this.on_html5_interrupted);this.html5_inst.on("ended",this.on_html5_ended);this.html5_inst.on("timeupdate",_this.on_html5_timeupdate);player.int_events.on("hola.before_play",this.on_jwplayer_beforeplay);player.jwadapter.on("adPlay",this.on_jwplayer_ad_play);player.jwadapter.on("adPause",this.on_jwplayer_ad_pause);if(!is_playlist_url())ad_init()};E.ad_handlers.Html5VastClient.prototype.uninit=function(){var player=this.player;player.off("pre-ended",this.on_player_complete);this.html5_inst.off("started",this.on_html5_started);this.html5_inst.off("timeupdate",this.on_html5_timeupdate);this.html5_inst.off("waiting",this.on_html5_waiting);this.html5_inst.off("error",this.on_html5_error);this.html5_inst.off("interrupted",this.on_html5_interrupted);this.html5_inst.off("ended",this.on_html5_ended);if(this.html5_inst.created_by_vast)this.player.html5_inst=this.html5_inst=this.html5_inst.uninit();player.int_events.off("hola.before_play",this.on_jwplayer_beforeplay);player.jwadapter.off("adPlay",this.on_jwplayer_ad_play);player.jwadapter.off("adPause",this.on_jwplayer_ad_pause);player.ad_attached=undefined};E.ad_handlers.Html5GoogimaAdaptiveHandler=function(player){this.player=player;this.log=player.log.set_module("googima");this.init()};E.ad_handlers.Html5GoogimaAdaptiveHandler.is_enabled=function(opt){return opt.tech=="html5"&&opt.client=="googima"&&opt.type=="adaptive"};E.ad_handlers.Html5GoogimaAdaptiveHandler.prototype.init=function(){var _this=this,player=this.player,jw=player.jwplayer;this.ad_depth=0;this.is_interrupted=player.is_ad_active();this.change_state=function(e,opt){var is_interrupted=e=="interrupted";if(_this.is_interrupted==is_interrupted)return;_this.is_interrupted=is_interrupted;player.emit(e,opt)};this.on_ad_started=function(e){_this.log.info("ad_impression depth="+_this.ad_depth+" data="+JSON.stringify(e));if(e&&e.linear=="nonlinear")return _this.log.info("ad banner displayed - not interrupting");if(_this.ad_detection_by_class||_this.ad_depth++)return;_this.change_state("interrupted")};this.on_ad_finished=function(e){_this.log.info("ad_finished depth="+_this.ad_depth+" data="+JSON.stringify(e));if(_this.ad_detection_by_class||!_this.ad_depth||--_this.ad_depth)return;_this.change_state("resumed")};this.on_force_ad_finished=function(e){_this.log.info("ad_check_finished depth="+_this.ad_depth+" data="+JSON.stringify(e));if(!_this.ad_depth)return;_this.ad_depth=0;if(!_this.ad_detection_by_class)_this.change_state("resumed")};this.restore_after_postroll=function(e){if(_this.is_interrupted)_this.change_state("resumed",{beforecomplete:true})};if(player.is_v7plus){this.on_ad_suspend=function(){_this.change_state("interrupted")};this.on_ad_restore=function(){_this.change_state("resumed")};this.ad_detection_by_class=!!player.ad_unwatch;player.int_events.on("hola.ad_suspend",this.on_ad_suspend);player.int_events.on("hola.ad_restore",this.on_ad_restore)}player.int_events.on("hola.before_complete",this.restore_after_postroll);player.jwadapter.on("adImpression",this.on_ad_started);player.jwadapter.on("adSkipped",this.on_ad_finished);player.jwadapter.on("adClick",this.on_ad_finished);player.jwadapter.on("adComplete",this.on_ad_finished);player.jwadapter.on("adError",this.on_force_ad_finished);player.jwadapter.on("playAttempt",this.on_force_ad_finished);if(is_hls_provider_registered()&&jw.provider){this.ad_debug={attach_hook:util.inject_hook(jw.provider,"attachMedia",function(){_this.log.info("hp.attachMedia debug stack: "+util.stack_to_pprint((new Error).stack))}),detach_hook:util.inject_hook(jw.provider,"detachMedia",function(){_this.log.info("hp.detachMedia debug stack: "+util.stack_to_pprint((new Error).stack))})}}};E.ad_handlers.Html5GoogimaAdaptiveHandler.prototype.is_interruptive=true;E.ad_handlers.Html5GoogimaAdaptiveHandler.prototype.uninit=function(){var player=this.player;player.int_events.off("hola.ad_suspend",this.on_ad_suspend);player.int_events.off("hola.ad_restore",this.on_ad_restore);player.int_events.off("hola.before_complete",this.restore_after_postroll);player.jwadapter.off("adImpression",this.on_ad_started);player.jwadapter.off("adSkipped",this.on_ad_finished);player.jwadapter.off("adClick",this.on_ad_finished);player.jwadapter.off("adComplete",this.on_ad_finished);player.jwadapter.off("adError",this.on_force_ad_finished);player.jwadapter.off("playAttempt",this.on_force_ad_finished);if(player.jwplayer.on)player.jwplayer.off("playAttempt",this.on_force_ad_finished);if(this.ad_debug){this.ad_debug.attach_hook.remove();this.ad_debug.detach_hook.remove();this.ad_debug=undefined}};E.ad_handlers.Html5GoogimaProgressiveHandler=function(player){this.player=player;this.init()};E.ad_handlers.Html5GoogimaProgressiveHandler.is_enabled=function(opt){return opt.tech=="html5"&&opt.client=="googima"&&opt.type=="progressive"};E.ad_handlers.Html5GoogimaProgressiveHandler.prototype.init=function(){var player=this.player;var video=player.html5;var src_hook=util.inject_hook(video,"src",{set:function(e,args){if(player.data_mode&&args[0]==video.src+"?"){e.set_handled();var load_hook=util.inject_hook(video,"load",function(ev){ev.set_handled();load_hook.remove()});setTimeout(load_hook.remove.bind(load_hook))}}});this.cancel_protection=src_hook.remove.bind(src_hook);this.fix_jwloaded_attrib=function(e){if(!player.data_mode||!video.hasAttribute("jw-loaded"))return;var e2a={loadedmetadata:"meta",loadeddata:"data"};video.setAttribute("jw-loaded",e2a[e.type])};this.fix_missing_play=function(){if(video.preload!="metadata"||video.readyState!=video.HAVE_METADATA)return;var jw_paused=player.jwadapter.get_state()=="PAUSED";if(player.is_paused()&&!video.paused&&!jw_paused)player.onstatebuffering_cb({})};video.addEventListener("loadedmetadata",this.fix_jwloaded_attrib);video.addEventListener("loadeddata",this.fix_jwloaded_attrib);video.addEventListener("play",this.fix_missing_play);this.default_handler=new E.ad_handlers.DefaultHandler(player)};E.ad_handlers.Html5GoogimaProgressiveHandler.prototype.uninit=function(){var player=this.player;this.default_handler.uninit();player.html5.removeEventListener("loadeddata",this.fix_jwloaded_attrib);player.html5.removeEventListener("loadedmetadata",this.fix_jwloaded_attrib);this.cancel_protection()};E.ad_handlers.DefaultHandler=function(player){this.player=player;this.log=player.log.set_module("ad_handler");this.init()};E.ad_handlers.DefaultHandler.is_enabled=function(opt){return opt.tech=="flash"};E.ad_handlers.DefaultHandler.prototype.init=function(){var player=this.player,pending_play_st1,pending_play_st2;this.jwplayer_play_in_ad_hook=function(e){if(!player.is_ad_active())return void(player.ad_played=false);pending_play_st1=true;e.hola_ignore=true};this.ad_finished=call_once(function(){player.ad_played=true;if(pending_play_st1){pending_play_st1=false;setTimeout(function(){pending_play_st2=true;player.jwadapter.pause()},0)}});this.jwplayer_pause_in_ad_hook=function(e){if(!pending_play_st2)return;pending_play_st2=false;player.jwadapter.play();e.hola_ignore=true};this.content_video_started=function(){player.ad_played=false};this.on_ad_suspend=function(){player.emit("ad_suspend")};this.on_ad_restore=function(){player.emit("ad_restore")};player.int_events.on("hola.onplay",this.jwplayer_play_in_ad_hook);player.int_events.on("hola.onpause",this.jwplayer_pause_in_ad_hook);player.int_events.on("hola.ad_suspend",this.on_ad_suspend);player.int_events.on("hola.ad_restore",this.on_ad_restore);player.jwadapter.on("time",this.content_video_started);player.jwadapter.on("adError",this.ad_finished);player.jwadapter.on("adSkipped",this.ad_finished);player.jwadapter.on("adClick",this.ad_finished);player.jwadapter.on("adComplete",this.ad_finished)};E.ad_handlers.DefaultHandler.prototype.uninit=function(){var player=this.player;player.int_events.off("hola.onplay",this.jwplayer_play_in_ad_hook);player.int_events.off("hola.onpause",this.jwplayer_pause_in_ad_hook);player.int_events.off("hola.ad_suspend",this.on_ad_suspend);player.int_events.off("hola.ad_restore",this.on_ad_restore);player.jwadapter.off("time",this.content_video_started);player.jwadapter.off("adError",this.ad_finished);player.jwadapter.off("adSkipped",this.ad_finished);player.jwadapter.off("adClick",this.ad_finished);player.jwadapter.off("adComplete",this.ad_finished)};E.adapters={};E.adapters.v8=function(jw){return assign(E.adapters.v7(jw),{play:jw.play.bind(jw),pause:jw.pause.bind(jw)})};E.adapters.v7=function(jw){return assign(E.adapters.common(jw),{on:jw.on.bind(jw),once:jw.once.bind(jw),off:jw.off.bind(jw),play:jw.play.bind(jw,true),pause:jw.pause.bind(jw,true),get_config:function(){return jw.getConfig()},get_container:function(){return jw.getContainer()},get_media_type:function(){return $(jw.getContainer()).hasClass("jw-flag-media-audio")?"audio":"video"},get_playlist_item:function(){return jw.getPlaylistItem(jw.getPlaylistIndex())},get_tech:function(){var p=jw.getProvider();var is_flash=p?/^flash/.test(p.name):!jw.getContainer().querySelector("video");return is_flash?"flash":"html5"},is_before_ready:function(){return jw.getProvider()===undefined}})};E.adapters.v6=function(jw){function off_capable(cb,name){cb.listeners=cb.listeners||{};cb.listeners[name]=(cb.listeners[name]||0)+1;cb.off=function(off_name){if(cb.listeners[off_name])cb.listeners[off_name]--};return function(e){return cb.listeners[name]&&cb(e)}}return assign(E.adapters.common(jw),{on:function(event,cb){var method,indirect_map={levels:"onQualityLevels",levelsChanged:"onQualityChange",captionsChanged:"onCaptionsChange",audioTrackChanged:"onAudioTrackChange"};if(!(method=indirect_map[event]))method="on"+event.charAt(0).toUpperCase()+event.slice(1);return jw[method]&&jw[method](off_capable(cb,event))},once:function(event,cb){this.on(event,function once(e){this.off(event,once);cb(e)}.bind(this))},off:function(event,cb){if(cb.off)cb.off(event)},play:jw.play.bind(jw,true),pause:jw.pause.bind(jw,true),get_config:function(){return jw.config},get_container:function(){return jw.container||document.getElementById(jw.id)},get_media_type:function(){return"video"},get_playlist_item:function(){var swf,playlist;if(playlist=jw.getPlaylist())return playlist[jw.getPlaylistIndex()];return(swf=this.get_swf())&&swf.jwGetPlaylist&&swf.jwGetPlaylist()[swf.jwGetPlaylistIndex()]},get_tech:function(){return jw.getRenderingMode()=="flash"||!window.jwplayer.html5?"flash":"html5"},is_before_ready:function(){var swf=this.get_swf();return swf?!swf.jwGetVersion:jw.getRenderingMode()===undefined}})};E.adapters.common=function(jw){return{get_ad_client:function(){return jw.plugins&&["vast","googima"].find(function(n){return jw.plugins[n]})},get_playlist_url:function(log){try{var item;if(!(item=this.get_playlist_item()))return;if(item.sources&&item.sources.length){var quality=jw.getCurrentQuality();if(item.sources[quality])item=item.sources[quality];else{var defaults=item.sources.filter(function(s){return s.default});item=defaults.length?defaults[0]:item.sources[0]}}return util.absolute_uri(item.file)}catch(e){if(log)log.err("get_playlist_url failed "+e)}},get_state:function(){return(jw.getState()||"IDLE").toUpperCase()},get_swf:function(){var el=this.get_video_el();return el&&el.tagName.toLowerCase()=="object"&&el},get_video_el:function(){var el;if(!(el=this.get_container()))return;var tag=el.tagName.toLowerCase();return tag=="video"||tag=="object"?el:el.querySelector("video,object")},is_error:function(){return!!util.dom_query_all(".jw-error").length}}};E.adapters.get=function(jw){if(jw.hola_adapter)return jw.hola_adapter;var ver=jw_get_version(jw)||window.jwplayer&&jw_get_version(window.jwplayer)||"0.0.0";jw.hola_adapter=E.jw_isV8(ver)?E.adapters.v8(jw):E.jw_isV7plus(ver)?E.adapters.v7(jw):E.adapters.v6(jw);jw.hola_adapter.version=ver;return jw.hola_adapter};E.hacks={};E.hacks.lock_reload_request=function(player){var video=player.html5;var lock_url=html5.get_hola_video_source(video);var hook=util.inject_hook(video,"load",function(e){if(html5.get_hola_video_source(video)!=lock_url)return;e.set_handled();if(video.readyState>video.HAVE_METADATA){video.dispatchEvent(util.new_event("loadeddata"));if(!player.is_paused()&&video.paused)video.dispatchEvent(util.new_event("canplay"))}});return hook.remove.bind(hook)};E.hacks.preload_none=function(player){if(player.html5&&player.html5.preload=="none"){player.html5.load({hola_force:true})}};E.hacks.no_relative_change=function(player){var jw=player.jwplayer,video=player.html5;if(util.cmp_version(player.jwplayer_ver,"7.0")<0||util.cmp_version(player.jwplayer_ver,"7.2.4")>0||jw.getProvider().name!="html5"){return}util.inject_hook(video,"src",{set:function(e,args){if(util.absolute_uri(args[0])==video.src)e.set_handled()}})};E.hacks.delay_early_idle=function(player,delay_cb){if(player.tech!="html5")return delay_cb();if(player.html5&&player.html5.error)return;if(player.config.disable_idle_delay)return delay_cb();var tid=setTimeout(function(){cancel();delay_cb()});var cancel=function(){player.off("pre-started",cancel);player.off("pre-error",cancel);tid=clearTimeout(tid)};player.once("pre-started",cancel);player.once("pre-error",cancel)};E.jw_isV7plus=function(jw){return util.cmp_version(jw_get_version(jw),"7.0")>=0};E.jw_isV8=function(jw){return util.cmp_version(jw_get_version(jw),"8.0")>=0};E.jw_getPlayerInstances=function(){if(!window.jwplayer)return[];var i=0,res=[],jw;while((jw=window.jwplayer(i++))&&jw.pause){var c;if(!E.jw_isV7plus(jw)||!(c=E.adapters.get(jw).get_container())||c.tagName.toLowerCase()!="object"){if(E.jw_isV8(jw)&&jw.compatibility)jw=Object.getPrototypeOf(jw);res.push(jw)}}return res};function jw_get_version(jw){var version;if(typeof jw=="string")version=jw;else if(!(version=jw.version)&&typeof jw=="function")version=(jw()||{}).version;if(!(version=/(\d+)(?:\.(\d+))?(?:\.(\d+))?/.exec(version)))return undefined;version.shift();if(version.length!=3)version.length=3;return version.map(function(i){return i||0}).join(".")}function is_hls_provider_registered(){var prov_lst=zutil.get(window.jwplayer,"api.availableProviders");return prov_lst&&prov_lst.some(function(p){return p.name=="hola/hls"})}function call_once(cb){return function wrapper(){if(wrapper.called)return;wrapper.called=true;cb()}}function create_html5_instance(player,opt){util.assert_enabled(html5,"html5 module is required but disabled");var def={html5:player.html5,parent_player:player,log:player.log};return new html5.Player(assign(def,opt))}E.get_handler=function(Player,log){return{rels:{html5:"anc"},get_instances:function(){return E.jw_getPlayerInstances().filter(function(jw){return E.adapters.get(jw).get_video_el()})},normalize:function(jw){var _ready_sent=false;var jwadapter=E.adapters.get(jw);return new Player({setup:function(){var _this=this;function emit_ready(){if(!_ready_sent){_ready_sent=true;_this.emit("ready")}}if(!this.is_ready())jwadapter.once("ready",emit_ready);if(jwadapter.is_error()){log.err("jwplayer loaded with error");perr({id:"loader_error_jwplayer",add_log:true,info:{playlist:util.zerr_json(jw.getPlaylist())}})}this.load_hook=util.inject_hook(jw,"load",function(){_this.emit("dispose")})},get_element:function(){return jwadapter.get_video_el()},get_container:function(){return jwadapter.get_container()},get_footprint:function(){return{player_id:jw.id}},is_ready:function(){return _ready_sent||!jwadapter.is_before_ready()},get_opt:function(){return{jwplayer:jw}},get_caps:function(){return{init_on_master_ready:true}},destroy:function(){this.load_hook.remove()}})}}};return E});
define("/svc/cdn/pub/ad_handlers.js",["/svc/cdn/pub/dom_util.js"],function(dom_util){var E={};function ArtiMedia(player){this.player=player;this.init()}ArtiMedia.is_enabled=function(opt){return!!ArtiMedia.get_ad_instance(opt.player)};ArtiMedia.get_ad_instance=function(player){var instances=window.artimediaInstances;var _el=player.get_ui().container;if(!instances||!_el)return;for(var id in instances){var am=instances[id];var ad_el=ArtiMedia.get_ad_element(am);if(!ad_el)continue;if(_el.contains(ad_el))return am}};ArtiMedia.get_ad_element=function(instance){var ad_frame=instance.adContainer;return ad_frame&&ad_frame.frameElement||instance.vidElement};ArtiMedia.prototype.get_ad_scheme=function(){return"artimedia"};ArtiMedia.prototype.is_ad_source=function(){return false};ArtiMedia.prototype.is_ad_active=function(){var ad=ArtiMedia.get_ad_instance(this.player);return ad&&dom_util.is_visible(ArtiMedia.get_ad_element(ad))};ArtiMedia.prototype.is_ad_loading=function(){return false};ArtiMedia.prototype.is_ad_playing=function(){return this.call_ad_instance("isPlaying")};ArtiMedia.prototype.is_ad_paused=function(){return!this.is_ad_playing()};ArtiMedia.prototype.ad_play=function(){return this.call_ad_instance("resumeAd")};ArtiMedia.prototype.ad_pause=function(){return this.call_ad_instance("pauseAd")};ArtiMedia.prototype.call_ad_instance=function(func){var ad=ArtiMedia.get_ad_instance(this.player);try{return ad&&ad[func]&&ad[func]()}catch(e){}};ArtiMedia.prototype.init=function(){};ArtiMedia.prototype.uninit=function(){};E.ArtiMedia=ArtiMedia;return E});
define("/svc/cdn/pub/vjs.js",["/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/dash.js","/svc/cdn/pub/shaka.js","cash","/svc/cdn/pub/html5.js","/svc/cdn/pub/dailymotion.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/ad_handlers.js","/svc/cdn/pub/perr.js"],function(zutil,util,dash,shaka,$,html5,dailymotion,player_util,dom_util,ad_handlers,perr){var E={};var ERR=util.ERR,CG=util.gconf_get;var vjs_version,assign=Object.assign;function strverscmp(a,b){var _a,_b,diff,skip_digit=0;for(_a=0,_b=0;_a<a.length&&_b<b.length;_a++,_b++){if(a[_a]==b[_b]&&!zutil.isdigit(a[_b]))continue;if(skip_digit)skip_digit--;if(zutil.isdigit(a[_a])&&zutil.isdigit(b[_b])){var ma=a.substr(_a).match(/\d+/)[0];var mb=b.substr(_b).match(/\d+/)[0];if(diff=+ma-+mb)return diff;skip_digit=ma.length}if(diff=a[_a].charCodeAt()-b[_b].charCodeAt())return diff}return a.length-b.length}function clone_class(c){var n=function(){return c.apply(this,arguments)};n.prototype=c.prototype;return assign(n,c)}function is_vjs6(){return util.cmp_version(vjs_version,"6.0")>=0}function is_vjs5(){return util.cmp_version(vjs_version,"5.0")>=0}function is_vjs5_new_hls(){return util.cmp_version(vjs_version,"5.9.2")>=0}E.Player=function(opt){var videojs=window.videojs||opt.html5&&opt.html5.constructor;vjs_version=videojs&&(videojs.VERSION||videojs.CDN_VERSION);util.call_super(E,this,null,opt);var _this=this;var hola_version=/-\d+$/.test(vjs_version)||videojs&&videojs.HOLA_VERSION;this.player_id=opt.player_id||1;this.vjs=this.video=opt.vjs;if(opt.html5)this.html5=opt.html5;this.vjs_adapter=is_vjs6()?E.adapters.v6(this.vjs,this.html5):is_vjs5()?E.adapters.v5(this.vjs,this.html5):E.adapters.v4(this.vjs,this.html5);this.video_url=opt.video_url;this.tech=E.vjs_getTech(opt.vjs)||"html5";this.name=hola_version?"hola":"vjs";this.backward_seek_bug=this.tech=="html5"&&util.is_chrome&&util.browser.version>=55&&vjs_version&&(hola_version?strverscmp(vjs_version,"5.10.2-22")<0:strverscmp(vjs_version,"5.16.0")<0);this.is_vjs5_new_hls=is_vjs5_new_hls();this.is_brightcove=vjs_is_brightcove(this.vjs);this.log=player_util.log(opt.log,"vjs");this.on("wrapper_attached",function(){_this.vjs.trigger("hola.wrapper_attached")});this.on("wrapper_detached",function(){_this.vjs.trigger("hola.wrapper_detached")});this.swf=this.vjs&&this.vjs.osmf&&this.vjs.osmf.el_;this.media_src_api=this.tech=="html5"&&window.MediaSource?window:videojs;this.blob2url={};this.position=0;this.vjs_handlers={};this.vjs_tech_handlers={};this.config={disable_ended_fallback:CG("loader.player.disable_ended_fallback"),disable_src_change_hiding:CG("loader.player.disable_src_change_hiding"),skip_caching:CG("loader.player.vjs.skip_caching"),cache_field:CG("loader.player.vjs.cache_field"),ext_control_logs:CG("loader.player.html5.ext_control_logs",util.debug_mode),tech_events:CG("loader.player.vjs.tech_events"),ima_ad_status:CG("loader.player.vjs.ima_ad_status"),skip_contrib_admode:CG("loader.player.vjs.skip_contrib_admode")};if(this.config.ext_control_logs&&this.html5){html5.on_ext_control(this,this.html5,function(log){_this.log.info(log+" state "+_this.state+" src "+(_this.html5.src||"<empty>")+" stack "+util.stack_to_pprint((new Error).stack))})}var is_shaka=E.vjs_getTechName(this.vjs).toLowerCase()=="shaka";this.module_handlers={shaka:function(){var is_shaka_env=function(){var adaptive=_this.get_video_type_name();return adaptive=="dash"&&is_shaka};if(!is_shaka_env())return;util.assert_enabled(shaka,"shaka module is required but disabled");var vjs_shaka_get=function(vjs){return vjs.tech_.shakaPlayer||vjs.tech_.shakaPlayer_};var shaka_obj=vjs_shaka_get(_this.vjs);_this.module=new shaka.Module({html5:opt.html5||vjs_getElement(_this.vjs),log:_this.log,shaka:shaka_obj});return{changed:function(){return!is_shaka_env()||shaka_obj!=vjs_shaka_get(_this.vjs)},uninit:function(){_this.module.uninit();_this.module=undefined}}},dashjs:function(){var is_dashjs_env=function(){var adaptive=_this.get_video_type_name();return util.is_enabled(dash)&&adaptive=="dash"&&videojs&&videojs.Html5DashJS};if(!is_dashjs_env())return;var vjs_dashjs_get=function(vjs){return vjs.tech_.sourceHandler_.mediaPlayer_};var dash_obj=vjs_dashjs_get(_this.vjs);dash.patch_dashjs(dash_obj);_this.module=new dash.Module({html5:opt.html5||vjs_getElement(_this.vjs),log:_this.log,dashjs:dash_obj,vjs:_this.vjs});_this.module.on("missing_idr",_this.dash_missing_idr=function(e){_this.emit("missing_idr",e)});return{changed:function(){return!is_dashjs_env()||dash_obj!=vjs_dashjs_get(_this.vjs)},uninit:function(){_this.module.off("missing_idr",_this.dash_missing_idr);_this.module.uninit();_this.module=_this.dash_missing_idr=undefined}}},hls_dm:function(){var vjs_hola_dm_get=function(vjs){return vjs.tech_.hls_obj};var vjs_orig_dm_get=function(vjs){return E.vjs_getTechObj(vjs).hls_};var vjs_dm_get=function(vjs){return vjs_hola_dm_get(vjs)||vjs_orig_dm_get(vjs)};var is_hls_dm_env=function(vjs){var adaptive=_this.get_video_type_name();return adaptive=="hls"&&((videojs||{}).HolaProviderHLS&&vjs_hola_dm_get(vjs)||window.Hls&&vjs_orig_dm_get(vjs))};if(!is_hls_dm_env(_this.vjs))return;util.assert_enabled(dailymotion,"dailymotion module is required but disabled");var hls_obj=vjs_dm_get(_this.vjs);_this.module=new dailymotion.Module({html5:opt.html5||vjs_getElement(_this.vjs),log:_this.log,dailymotion:hls_obj,vjs:_this.vjs,player:_this,state:_this.state});_this.rm_forwarding_emit=util.create_forwarding_emit(_this);_this.module.on("manifest_loaded",_this.hls_manifest_loaded=function(){_this.emit("manifest_loaded")});_this.module.on("level_loaded",_this.hls_level_loaded=function(lvl){_this.emit("level_loaded",lvl)});_this.module.on("level_updated",_this.hls_level_updated=function(lvl){_this.emit("level_updated",lvl)});_this.module.on("seg_stats",_this.hls_seg_stats=function(lvl){_this.emit("seg_stats",lvl)});_this.module.on("buf_stats",_this.hls_buf_stats=function(lvl){_this.emit("buf_stats",lvl)});_this.module.on("frag_load_stats",_this.hls_frag_load_stats=function(lvl){_this.emit("frag_load_stats",lvl)});_this.module.on("error",_this.hls_error=function(lvl){_this.emit("error",lvl)});return{changed:function(){return!is_hls_dm_env(_this.vjs)||hls_obj!=vjs_dm_get(_this.vjs)},uninit:function(){if(!_this.module)return;if(_this.rm_forwarding_emit)_this.rm_forwarding_emit=_this.rm_forwarding_emit();_this.module.off("manifest_loaded",_this.hls_manifest_loaded);_this.module.off("level_updated",_this.hls_level_updated);_this.module.off("seg_stats",_this.hls_seg_stats);_this.module.off("buf_stats",_this.hls_buf_stats);_this.module.off("frag_load_stats",_this.hls_frag_load_stats);_this.module.uninit();_this.module=_this.hls_level_loaded=undefined;_this.hls_seg_stats=_this.hls_buf_stats=undefined;_this.hls_frag_load_stats=undefined;_this.hls_manifest_loaded=undefined;_this.hls_level_updated=undefined},is_err_allowed:function(err){return err.code==-2&&hls_obj.streamController&&!hls_obj.streamController.media}}},hls_contrib:function(){var vjs_contrib_hls_get=function(vjs){return vjs.tech_.hls};var is_contrib_hls_env=function(){var adaptive=_this.get_video_type_name();return adaptive=="hls"&&videojs&&!videojs.HolaProviderHLS&&_this.vjs.tech_&&!_this.vjs.tech_.hls_obj&&vjs_contrib_hls_get(_this.vjs)};if(!is_contrib_hls_env())return;var hls_obj=vjs_contrib_hls_get(_this.vjs);return{changed:function(){return false},uninit:function(){},is_err_allowed:function(err){return err.code==-2&&hls_obj.mediaSource&&hls_obj.mediaSource.readyState=="closed"}}},hls_native_no_play:function(){if(!_this.is_native_hls())return;var on_check_skip_video=function(e){if(["bwsaver","cdn"].includes(e.mode))e.skip="native hls is used"};_this.on("wrapper.check_skip_video",on_check_skip_video);return{changed:function(){return!_this.is_native_hls()},uninit:function(){_this.off("wrapper.check_skip_video",on_check_skip_video)}}}};this.on("pre-started",this.module_reconf=function(){if(_this.module_ops){if(!_this.module_ops.changed())return;_this.module_ops.uninit()}Object.keys(_this.module_handlers).find(function(h){return _this.module_ops=_this.module_handlers[h]()})});this.module_reconf();this.change_state=function(state,reason){if(state.detect)state=_this.vjs.paused()?"PAUSED":"PLAYING";if(this.state==state)return;var prev_state=this.state;this.state=state;if(prev_state=="IDLE")this.emit("started");else if(reason=="ended")this.emit(reason);this.emit("state",this.state)};this.align_state=function(){if(this.is_paused()&&!this.vjs.paused())this.change_state("PLAYING");if(this.is_playing()&&this.vjs.paused())this.change_state("PAUSED")};player_set_initial_state(this);this.src_hook=util.inject_hook(this.vjs,"src",{log:this.log,exec:function(e,args){var src=args[0];if(!src)return;if(typeof src!="string")src=Array.isArray(src)?src[0].src:src.src;if(_this.blob2url[src]||src==_this.get_url())return;perr({id:"source_change"});_this.emit("src_change",{from:_this.get_url(),to:src});if(!_this.is_idle()){_this.emit("interrupted");_this.seeking=_this.pending_sourceopen=false;_this.change_state("IDLE")}_this.source_change_in_progress=true;_this.src_hook.original_handlers.exec.apply(this,args);e.set_handled();_this.refresh_buffered();_this.vjs.ready(function(){_this.change_state({detect:true})},true)}});this.on_vjs=function(events,handler){var wrapper=function(e){if(this.ready)handler.call(this,e)}.bind(this);events=typeof events=="string"?[events]:events;events.forEach(function(event){_this.vjs_handlers[event]=[].concat(_this.vjs_handlers[event]||[],wrapper);_this.vjs.on(event,wrapper)})};this.on_vjs_tech=function(event,handler){if(!this.config.tech_events||typeof this.vjs.tech!="function")return;this.vjs.tech().on(event,handler);this.vjs_tech_handlers[event]=(this.vjs_tech_handlers[event]||[]).push(handler)};this.rm_vjs_tech_handlers=function(){if(!this.config.tech_events||typeof this.vjs.tech!="function")return;var handlers,vjs_tech=this.vjs.tech();for(var event in this.vjs_tech_handlers){handlers=this.vjs_tech_handlers[event];for(var i=0;i<handlers.length;i++)vjs_tech.off(event,handlers[i])}this.vjs_tech_handlers={}};this.on_vjs_tech("pause",_this.change_state.bind(this,{detect:true}));this.on_vjs("seeked",function(a){if(Math.abs(this.seek_position-this.vjs.currentTime())>4){this.log.err("detected a bad seek: "+this.prev_position+" -> "+this.seek_position+" current: "+this.vjs.currentTime());var backward_seek_bug=this.backward_seek_bug&&this.prev_position>this.seek_position;if(backward_seek_bug){this.log.notice("correcting bad seek to "+this.seek_position);this.vjs.currentTime(this.seek_position)}else{perr({id:"vjs_bad_seek",add_log:true,throttle:1,info:"previous: "+this.prev_position+" current: "+this.vjs.currentTime()+" seek position: "+this.seek_position})}}this.seeking=false;this.emit("seeked");this.align_state();if(this.schedule_end_of_stream_check)this.schedule_end_of_stream_check()});this.on_vjs("ended",function(a){if(this.is_ad_active())return;this.change_state("IDLE","ended")});this.on_vjs("loadstart",function(){this.source_change_in_progress=false});this.on_vjs("abort",function(){if(this.pending_sourceopen||this.source_change_in_progress){this.align_state();return this.log.info("vjs abort - ignored ("+(this.pending_sourceopen?"mse restart":"source change")+")")}this.log.info("vjs abort");this.change_state("IDLE")});this.on_vjs("seeking",function(a){this.seeking=true;this.prev_position=this.position;this.seek_position=this.position=this.vjs.currentTime();if(this.prev_position==this.position)this.prev_position=this.vjs_prev_position;this.emit("seeking",this.prev_position,this.position);if(this.end_of_stream_timer)this.end_of_stream_timer=clearTimeout(this.end_of_stream_timer)});this.play_during_ad=false;this.on_vjs("pause",function(a){this.log.info("vjs pause state "+this.state+" seeking "+!!this.seeking+" ad_playback "+this.is_ad_active());if(this.seeking)return;if(this.is_idle())return;this.play_during_ad=false;this.change_state("PAUSED");this.emit("pause")});this.on_vjs("play",function(a){this.log.info("vjs play state "+this.state+" seeking "+!!this.seeking);if(this.seeking&&!this.is_idle())return;if(this.play_during_ad=this.is_ad_active())return;if(this.is_idle())this.seeking=false;if(this.adjust_pos&&this.html5&&this.html5.currentTime)this.html5.currentTime+=.1;this.change_state("PLAYING");this.emit("play")});this.on_vjs("waiting",function(a){this.emit("waiting")});this.on_vjs("error",function(a){var err;if(err=vjs_get_error(this,a))this.emit("error",err)});this.on_vjs("timeupdate",function(a){if(this.is_ad_active()){this.emit("ad_time",{duration:this.vjs.duration(),position:this.vjs.currentTime()})}else{this.buffered=E.vjs_getBuffered(this.vjs,this.html5);var pos=this.vjs.currentTime();if(pos>this.position&&!this.vjs.paused()&&!this.is_playing()){this.change_state("PLAYING");perr({id:"vjs_missing_play_event",add_log:true,throttle:1})}this.vjs_prev_position=this.position;this.position=pos;this.emit("timeupdate",pos)}});this.on_vjs("progress",function(){this.buffered=undefined});this.on_vjs("mediachange",function(a){this.emit("quality_level")});this.on_vjs("beforeresolutionchange",function(e){this.emit("beforeresolutionchange")});this.on_vjs("resolutionchange",function(){this.emit("resolutionchange")});this.on_vjs("volumechange",function(){this.emit("volumechange")});this.on_vjs("problem_report",function(e){this.emit("problem_report",e&&e.data?{data:e.data}:undefined)});this.on_vjs("save_logs",function(e){this.emit("save_logs",e&&e.data?{data:e.data}:undefined)});this.on_vjs("durationchange",function(){this.emit("duration_changed")});this.vjs.hola_logs=function(){var bws=window.hola_cdn&&window.hola_cdn.video_ctx_latest&&window.hola_cdn.video_ctx_latest.attached_bws;return bws?bws.get_logs():_this.log.get_logs()};this.on("wrapper.check_skip_video",function(e){if(videojs&&videojs.HolaProviderHLS&&e.method=="hls"&&e.mode!="stats")return e.skip="method hls is not allowed, when hap_hls loaded";var is_adaptive=util.is_adaptive(_this.get_video_type_name());if(is_adaptive&&e.mode=="cdn"&&!_this.module_ops)return e.skip="adaptive video, but no handler can handle"});this.is_enc_key=function(url){this.get_levels(true);return this.enc_keys&&this.enc_keys[url]};this.ad_handler=player_util.select_ad_handler(this,E.ad_handlers,{vjs:_this.vjs})};zutil.inherits(E.Player,player_util.Player);E.Player.prototype.uninit=function(){if(this.module_ops)this.module_ops=this.module_ops.uninit();if(this.ad_handler)this.ad_handler=this.ad_handler.uninit();this.events.removeAllListeners();this.rm_vjs_tech_handlers();for(var event in this.vjs_handlers){for(var i=0;i<this.vjs_handlers[event].length;i++)this.vjs.off(event,this.vjs_handlers[event][i])}if(this.schedule_end_of_stream_check){this.end_of_stream_timer=clearTimeout(this.end_of_stream_timer);this.vjs.off("timeupdate",this.schedule_end_of_stream_check)}if(this.config.ext_control_logs&&this.html5)html5.on_ext_control(this,this.html5,false);if(this.src_hook)this.src_hook.remove();if(this.src_unlock)this.src_unlock=this.src_unlock();delete this.vjs.hola_logs};E.Player.prototype.get_url=function(){if(this.video_url)return this.video_url;var vjs=this.vjs;var src,cache;if(!this.config.skip_caching){cache=vjs.cache_||this.config.cache_field&&vjs[this.config.cache_field]||{};src=this.vjs_adapter.src_from_cache(cache)}src=src||vjs.currentSrc();if((typeof src=="object"||util.is_blob_url(src))&&this.module)src=this.module.get_url();return src&&util.is_blob_url(src)&&this.blob2url[src]||src};E.Player.prototype.get_video_type_name=function(url){var t1=player_util.Player.prototype.get_video_type_name.call(this,url);if(this.wrong_currenttype)return t1;var mime=this.get_video_type();var t2=util.mime_to_type(mime);if(t1&&t1!=t2){this.wrong_currenttype=true;perr({id:"vjs_"+(t2?"wrong":"no")+"_currenttype",info:t1+" "+t2+" mime: "+mime})}return t1||t2};E.Player.prototype.get_video_type=function(){var type;if(is_vjs5())type=this.vjs.currentType();if(!type){var url=this.get_url();var srcs=vjs_getOptions(this.vjs,"sources");var src=srcs&&srcs.find(function(s){return util.absolute_uri(s.src)==url});type=src&&src.type}if(!type){var tech2type={hlsjs:"application/x-mpegurl"};var tech=E.vjs_getTechName(this.vjs)||"";type=tech2type[tech.toLowerCase()]}return type||""};E.Player.prototype.get_ad_scheme=function(){return this.ad_handler&&this.ad_handler.get_ad_scheme()};E.Player.prototype.get_resolution=function(){return dom_util.get_elm_resolution(vjs_getElement(this.vjs))};E.Player.prototype.seek=function(ms){this.vjs_adapter.seek(ms/1e3)};E.Player.prototype.get_pos=function(){if(this.vjs_adapter.is_changing_src())return 0;return this.position||(this.position=this.vjs.currentTime())};E.Player.prototype.get_poster=function(){if(this.vjs&&typeof this.vjs.poster=="function")return this.vjs.poster()};util.module_fn(E,function get_state(){return this.state});E.Player.prototype.refresh_buffered=function(){if(this.vjs_adapter.is_changing_src())return{length:0};this.buffered=E.vjs_getBuffered(this.vjs,this.html5);this.position=this.vjs.currentTime();return this.buffered};E.Player.prototype.get_buffered=function(){if(this.vjs_adapter.is_changing_src())return{length:0};return this.buffered||this.refresh_buffered()};E.Player.prototype.get_duration=function(){if(zutil.is_mocha()||!this.vjs_adapter.ready_state()||this.vjs_adapter.is_changing_src()){return 0}return this.vjs.duration()};util.module_fn(E,function is_live_stream(){return this.vjs.osmf&&this.vjs.osmf.streamType?this.vjs.osmf.streamType()=="live":this.get_duration()===Infinity});E.Player.prototype.play=function(){this.vjs.play()};E.Player.prototype.pause=function(){this.vjs.pause()};util.module_fn(E,function play_url(url,opt){var _this=this;opt=opt||{};setTimeout(function(){var srcs=vjs_getOptions(_this.vjs,"sources");var src_changed=srcs&&srcs.some(function(src){if(util.absolute_uri(src.src)==url){_this.vjs.src(src);return true}});if(!src_changed)_this.vjs.src({src:url,type:opt.video_type});_this.vjs.load();if(!opt.is_paused&&!opt.pos)_this.vjs.play();var hls=get_hls_object(_this.vjs);var emmitter=hls&&hls.playlists||_this.vjs;var event=hls?"loadedmetadata":"canplay";emmitter.on(event,function cb(){emmitter.off(event,cb);if(!opt.is_paused&&_this.vjs.paused())_this.vjs.play();if(!opt.pos)return;if(_this.tech=="flash"){_this.vjs.on("timeupdate",function cb2(){if(_this.vjs.currentTime()==0)return;_this.vjs.off("timeupdate",cb2);_this.vjs.currentTime(opt.pos)})}else _this.vjs.currentTime(opt.pos)})},0)});E.Player.prototype._hide_src_change=function(from,to){if(this.src_unlock)this.src_unlock=this.src_unlock();if(!this.config.disable_src_change_hiding)this.src_unlock=E.hacks.hide_source_change(this.vjs,from,to)};E.Player.prototype.enable_data_mode=function(on_sourceopen){var _this=this,original_url=this.get_url();if(!this.media_src_api||!this.media_src_api.MediaSource){this.log.err("MSE not available, tech = "+this.tech+", window.MediaSource is"+(window.MediaSource?"":" not")+" enabled, used MediaSource API provider is "+(this.media_src_api===window?"window":"vjs"));throw new Error("MediaSource API not available")}this.media_src=new this.media_src_api.MediaSource({mode:"auto"});this.buffered=undefined;this.pending_sourceopen=true;this.vjs_adapter.replace_src(original_url,function(){var media_source_url=_this.media_src_api.URL.createObjectURL(_this.media_src);_this.blob2url[media_source_url]=original_url;_this._hide_src_change(original_url,media_source_url);return media_source_url});if(!this.config.disable_ended_fallback){var prev,vjs=this.vjs;this.schedule_end_of_stream_check=function(){if(prev==vjs.currentTime())return;prev=vjs.currentTime();_this.end_of_stream_timer=clearTimeout(_this.end_of_stream_timer);if(_this.seeking||!util.close_to_end(prev,vjs.duration()))return;_this.end_of_stream_timer=setTimeout(function(){var cur=vjs.currentTime(),dur=vjs.duration();if(!dur||!cur||vjs.ended()||!util.close_to_end(cur,dur)){return}_this.log.notice("schedule_end_of_stream_check fake ended "+"%s %s",cur,dur);perr({id:"vjs_ended_fallback",add_log:true,info:"previous: "+prev+" current: "+cur+" duration: "+dur});vjs.trigger(util.new_event("ended"));vjs.off("timeupdate",_this.schedule_end_of_stream_check)},1e3)};vjs.on("timeupdate",this.schedule_end_of_stream_check)}this.on_sourceopen=function(e){this.pending_sourceopen=false;return on_sourceopen(this.media_src,e)}.bind(this);this.media_src.addEventListener("sourceopen",this.on_sourceopen);if(this.media_src.readyState=="open")on_sourceopen(this.media_src)};E.Player.prototype.disable_data_mode=function(){if(!this.media_src)return;this.media_src.removeEventListener("sourceopen",this.on_sourceopen);if(this.schedule_end_of_stream_check){this.vjs.off("timeupdate",this.schedule_end_of_stream_check);this.end_of_stream_timer=clearTimeout(this.end_of_stream_timer)}this.media_src=this.pending_sourceopen=this.on_sourceopen=this.schedule_end_of_stream_check=undefined};util.module_fn(E,function is_playing(){return this.state=="PLAYING"});util.module_fn(E,function is_paused(){return this.state=="PAUSED"});util.module_fn(E,function is_idle(){return this.state=="IDLE"});E.Player.prototype.is_ad_source=function(){return this.ad_handler&&this.ad_handler.is_ad_source()||util.call_super(E,this,"is_ad_source")};E.Player.prototype.is_ad_active=function(){return this.ad_handler&&this.ad_handler.is_ad_active()};E.Player.prototype.is_ad_loading=function(){return this.ad_handler&&this.ad_handler.is_ad_loading()};E.Player.prototype.is_ad_playing=function(){return this.ad_handler&&this.ad_handler.is_ad_playing()};E.Player.prototype.is_ad_paused=function(){return this.ad_handler&&this.ad_handler.is_ad_paused()};E.Player.prototype.ad_play=function(){return this.ad_handler&&this.ad_handler.ad_play()};E.Player.prototype.ad_pause=function(){return this.ad_handler&&this.ad_handler.ad_pause()};E.Player.prototype.enable_context_menu=function(){if(!this.is_brightcove)return player_util.Player.prototype.enable_context_menu.call(this);var c=this.get_ui().container;if(!c||!this.contextmenu_handler)return;c.removeEventListener("contextmenu",this.contextmenu_handler,{capture:true});delete this.contextmenu_handler};E.Player.prototype.disable_context_menu=function(){if(!this.is_brightcove)return player_util.Player.prototype.disable_context_menu.call(this);var c=this.get_ui().container;if(!c||this.contextmenu_handler)return;this.contextmenu_handler=function(e){e.stopPropagation();e.preventDefault()};c.addEventListener("contextmenu",this.contextmenu_handler,{capture:true})};E.Player.prototype.get_captions_track=function(){for(var i=0;i<this.vjs.textTracks().length;i++){if(this.vjs.textTracks()[i].mode=="showing")return i}return-1};E.Player.prototype.set_captions_track=function(track){for(var i=0;i<this.vjs.textTracks().length;i++)this.vjs.textTracks()[i].mode="disabled";if(track>=0)this.vjs.textTracks()[track].mode="showing"};function process_osmf_levels(levels){var ret={};if(!levels||!levels.length)return ret;for(var i=0;i<levels.length;i++){var p=levels[i],url=p.url;if(ret[url]||!p.fragments)continue;var _p={url:url,segments:[]};ret[url]=_p;var bitrate=_p.bitrate=p.bitrate;for(var j=0;j<p.fragments.length;j++){var frag=p.fragments[j];_p.segments.push({playlist_url:url,media_index:frag.frag_no||j,url:frag.url,bitrate:bitrate,duration:frag.duration})}}return ret}E.Player.prototype.get_ui=function(){var container=this.vjs.el();var media=this.html5||this.swf;var using_custom_controls=!this.vjs_adapter.using_native_controls();if(!container)return{};return{container:container,control_bar:using_custom_controls&&container.querySelector(".vjs-control-bar"),progress_bar:using_custom_controls&&container.querySelector(".vjs-progress-control"),fullscreen:using_custom_controls?container:media,media:media}};E.Player.prototype.get_player=function(){return this.vjs};util.module_fn(E,function get_levels(cached){if(this.vjs.osmf&&this.vjs.osmf.levels)return process_osmf_levels(this.vjs.osmf.levels());if(cached&&this.levels&&!this.levels_stale)return this.levels;var ret;var playlists=this.get_playlists();if(!playlists)return;playlists.forEach(function(p){if(!p.segments)return;ret=ret||{};ret[p.playlist]=p});this.levels_stale=false;return this.levels=ret});util.module_fn(E,function is_autostart(){return this.vjs.autoplay()});util.module_fn(E,function get_playlists(){if(this.vjs.osmf&&this.vjs.osmf.levels)return;var sources=vjs_getOptions(this.vjs,"plugins.settings.quality.sources");if(sources&&sources.length>1&&sources[0].type=="video/mp4")return sources.map(function(s){return s.src});var _this=this;function to_playlist(p){if(!p)return;var bitrate=0;var _p={playlist:p.uri,url:p.uri,attributes:{}};if(p.attributes){for(var a in p.attributes)_p.attributes[a.toLowerCase()]=p.attributes[a];bitrate=_p.bitrate=p.attributes.BANDWIDTH}_p.bitrate=bitrate;if(p.segments&&p.segments.length){_p.segments=[];p.segments.forEach(function(seg,i){var _url=seg.resolvedUri||resolve_url(base_url,p.uri,seg.uri);var _seg={playlist_url:p.uri,url:_url,duration:seg.duration,media_index:i+(p.mediaSequence||0),bitrate:bitrate};if(seg.key){_seg.key=seg.key.resolvedUri||resolve_url(base_url,p.uri,seg.key.uri);_this.enc_keys=_this.enc_keys||{};_this.enc_keys[_seg.key]=true}_p.segments.push(_seg)})}return _p}var base_url=this.get_url(),ret=[],playlists,_playlists;var vjs=this.vjs,hls_obj=get_hls_object(vjs),media,state;if(!hls_obj)return;if(!vjs.currentSrc()||!(playlists=hls_obj.playlists))return;if((state=playlists.state)=="HAVE_NOTHING"||!(media=playlists.media())||!media.segments){return}if(state=="SWITCHING_MEDIA")return;if(!playlists.master||!(_playlists=playlists.master.playlists))return;_playlists.forEach(function(p){ret.push(to_playlist(p))});ret.sort(function(a,b){return Math.sign(a.bitrate-b.bitrate)});return ret});util.module_fn(E,function get_current_playlist(){});util.module_fn(E,function get_segment_info(url){var info,levels;if(levels=this.get_levels(true)){for(var l in levels){if(info=levels[l].segments.find(function(s){return s.url==url})){return info}}}perr({id:"vjs_no_segment_info",info:{url:url},add_log:true})});util.module_fn(E,function is_native_hls(){return this.tech=="html5"&&this.get_video_type_name()=="hls"&&!util.is_blob_url(html5.get_video_source(this.html5))});function get_hls_object(vjs){var hls_obj=vjs.tech_&&vjs.tech_.hls||vjs.hls;if(hls_obj&&!hls_obj.playlists)hls_obj=undefined;return hls_obj}function get_bitrate_byteark(vjs){try{return vjs.getLevelIndex()>0?vjs.getLevels()[vjs.getLevelIndex()-1].bitrate:0}catch(e){return 0}}util.module_fn(E,function get_bitrate(){var hls_obj=get_hls_object(this.vjs);if(!hls_obj){if(this.vjs.getLevels)return get_bitrate_byteark(this.vjs);return 0}var curr=hls_obj.playlists.media();return curr?(curr.attributes||{}).BANDWIDTH||0:0});util.module_fn(E,function get_current_fragment(){});util.module_fn(E,function get_current_level(){if(zutil.is_mocha())return 0;if(this.vjs.osmf&&this.vjs.osmf.currentLevel)return this.vjs.osmf.currentLevel();var hls_obj=get_hls_object(this.vjs);if(!hls_obj)return 0;var curr=hls_obj.playlists.media();return curr&&curr.uri});E.Player.prototype.get_bandwidth=function(){var hls_obj=get_hls_object(this.vjs);return(hls_obj||{}).bandwidth||0};E.Player.prototype.init_adaptive=function(adaptive){var _this=this,tech=E.vjs_getTechObj(this.vjs),hls;if(this.module)return this.module.init_adaptive&&this.module.init_adaptive(adaptive);if(hls=get_hls_object(this.vjs)){hls.playlists.on("loadedmetadata",function(){_this.emit("manifest_loaded")});hls.playlists.on("loadedplaylist",function(){_this.levels_stale=true;_this.emit("manifest_loaded")});if(tech){tech.on("levelloading",function(e,url){if(_this.is_live_stream())_this.emit("live_manifest",{url:url,format:"m3u8"})});tech.on("manifestparsed",function(){_this.emit("manifest_parsed")})}}var videojs=this.vjs.constructor;var xhr_cont=this.is_vjs5_new_hls?hls:videojs.Hls||videojs;var hook=util.inject_hook(xhr_cont,"xhr",adaptive.fallback_wrapper(function(e,args){var opt=args[0],callback=args[1];if(!opt||opt.responseType!="arraybuffer")return;var url=opt.uri||opt.url;if(hook.count()>1&&!_this.get_segment_info(url))return;if(_this.is_enc_key(url))return void _this.log.info("skip key file "+url);e.set_handled();if(typeof callback!="function")callback=function(){};var fake_xhr={abort:function(){if(!this.req||this.req.error===ERR.aborted)return;this.req.abort();adaptive.remove_segment(segment);_this.log.notice("req aborted",this.req)},requestTime:Date.now(),addEventListener:function(){if(!this.req||!this.req.xhr)return _this.log.warn("addEventListener: not exposed xhr");this.req.xhr.addEventListener.apply(this.req.xhr,arguments)},removeEventListener:function(){if(!this.req||!this.req.xhr){return _this.log.warn("removeEventListener: not exposed "+"xhr")}this.req.xhr.removeEventListener.apply(this.req.xhr,arguments)}};var segment={callback:callback,url:url,fake_xhr:fake_xhr,playlist_id:"def",dur:10,streaming:false&&opt.streaming};adaptive.init_segment(segment);return fake_xhr}));adaptive.on("uninit",hook.remove.bind(hook));if(adaptive.adaptive=="hls"){adaptive.on("seg_complete",function(req){if(req.error||!req.opt.streaming||!req.served)return;var segment=req.info.segment,fake_xhr=segment.fake_xhr;fake_xhr.status=200;fake_xhr.response=null;fake_xhr.responseTime=Date.now();fake_xhr.roundTripTime=fake_xhr.responseTime-fake_xhr.requestTime;fake_xhr.bytesReceived=req.res.size;var bw=Math.floor(fake_xhr.bytesReceived/fake_xhr.roundTripTime*8*1e3);if(adaptive.bw_src&&adaptive.bw_src.bw>bw)bw=adaptive.bw_src.bw;fake_xhr.bandwidth=bw;fake_xhr.type="final";segment.callback.call(fake_xhr,undefined,is_vjs5()?fake_xhr:segment.url)})}};E.Player.prototype.ondata_adaptive=function(chunk,adaptive){if(this.module){if(this.module.ondata_adaptive)this.module.ondata_adaptive(chunk,adaptive);return}var segment=chunk.req.info.segment;var callback=segment.callback,url=segment.url;var fake_xhr=segment.fake_xhr;if(!chunk.data||chunk.req.error){return void callback.call(fake_xhr,chunk.req.error||true,is_vjs5()?fake_xhr:url)}adaptive.indexer[segment.playlist_id].completed=segment.index;fake_xhr.status=200;fake_xhr.response=chunk.data;fake_xhr.responseTime=Date.now();fake_xhr.roundTripTime=fake_xhr.responseTime-fake_xhr.requestTime;fake_xhr.bytesReceived=fake_xhr.response.byteLength||fake_xhr.response.length;var bw=Math.floor(fake_xhr.bytesReceived/fake_xhr.roundTripTime*8*1e3);if(adaptive.bw_src&&adaptive.bw_src.bw>bw)bw=adaptive.bw_src.bw;fake_xhr.bandwidth=bw;if(chunk.req.opt.streaming)fake_xhr.type="progress";return callback.call(fake_xhr,false,is_vjs5()?fake_xhr:url)};util.module_fn(E,function get_decoded_frames(){if(this.vjs_adapter.is_changing_src())return 0;var el=vjs_getElement(this.vjs);if(!el)return 0;if(is_video_element(el)){util.assert_enabled(html5,"html5 module is required but disabled");return html5.get_decoded_frames(el)}return el.vjs_getProperty&&el.vjs_getProperty("decodedFrames")});util.module_fn(E,function get_dropped_frames(){if(this.vjs_adapter.is_changing_src())return 0;var el=vjs_getElement(this.vjs);if(!el)return 0;if(is_video_element(el)){util.assert_enabled(html5,"html5 module is required but disabled");return html5.get_dropped_frames(el)}return el.vjs_getProperty&&el.vjs_getProperty("droppedFrames")});E.Player.prototype.get_caps=function(){return player_util.Player.prototype.get_caps({save_context:["progressive","hls","hap_hls"],hap_provider_loaded:this.name=="hola"||!!(window.hola_videojs_hls||util.dom_query("script[src*=hola_videojs_hls]"))})};E.Player.prototype.get_est_bytes=function(){var hls=get_hls_object(this.vjs);if(hls&&hls.stats)return{bytes:hls.stats.mediaBytesTransferred,src:"vjs_hls"};var res=null;var el=vjs_getElement(this.vjs);if(is_video_element(el)){util.assert_enabled(html5,"html5 module is required but disabled");res=html5.est_bytes_from_tag(el)}return res};E.Player.prototype.get_current_error=function(){return vjs_get_error(this)};E.Player.prototype.check_buffer=function(opt){
var el=vjs_getElement(this.vjs);if(is_video_element(el)){util.assert_enabled(html5,"html5 module is required but disabled");html5.check_buffer.call(this,el,opt)}};E.Player.prototype.play_src=function(src,idx){var t,vjs=this.vjs;src=src[idx||0];vjs.reset();if(src.poster)vjs.poster(src.poster);if(vjs.dock&&vjs.mediainfo){if(t=src.title||src.description)vjs.mediainfo.name=t;vjs.mediainfo.description=src.description&&t!=src.description?src.description:""}vjs.src([{type:src.type,src:src.file||src.url}]);vjs.load();vjs.play()};E.Player.prototype.muted=function(v){if(this.is_ad_active()&&this.vjs.ima3&&this.vjs.ima3.adPlayer)return this.vjs.ima3.adPlayer.muted(v);return this.vjs.muted(v)};E.Player.prototype.volume=function(v){if(this.is_ad_active()&&this.vjs.ima3&&this.vjs.ima3.adPlayer)return this.vjs.ima3.adPlayer.volume(v);return this.vjs.volume(v)};E.Player.prototype.fullscreen=function(v){if(v===undefined)return this.vjs.isFullscreen();if(v==true)this.vjs.requestFullscreen();else this.vjs.exitFullscreen()};E.Player.prototype.has_started=function(){return!this.is_idle()&&this.vjs.hasStarted()};E.Player.prototype.scrubbing=function(is_scrubbing){return this.vjs.scrubbing&&this.vjs.scrubbing(is_scrubbing)};E.Player.prototype.get_title=function(){return this.vjs.mediainfo&&this.vjs.mediainfo.name};E.Player.prototype.get_description=function(){return this.vjs.mediainfo&&this.vjs.mediainfo.description};E.Player.prototype.set_controlbar_visible=function(is_visible){is_visible=is_visible===undefined?true:is_visible;if(this._is_controlbar_visible===is_visible||!this.vjs.userActive)return;var cb=$(this.get_ui().control_bar);this._is_controlbar_visible=is_visible;if(this.activity_to)this.activity_to=clearInterval(this.activity_to);if(this.cb_style!==undefined)this.cb_style=void cb.attr("style",this.cb_style);if(is_visible)return;this.activity_to=setInterval(function(){this.vjs.userActive(false)}.bind(this),250);this.cb_style=cb.attr("style")||"";cb[0].style.setProperty("display","none","important");this.vjs.userActive(false)};E.Player.prototype.get_versions=function(){var ver={vjs:vjs_version};if(this.module&&this.module.get_versions)assign(ver,this.module.get_versions());return ver};function map_ad_events(vjs,player,map){Object.keys(map).forEach(function(ad_event){if(typeof map[ad_event]!="function"){var player_event=map[ad_event];map[ad_event]=function(){player.emit(player_event)}}vjs.on(ad_event,map[ad_event])});return function(){Object.keys(map).forEach(function(ad_event){vjs.off(ad_event,map[ad_event])})}}E.ad_handlers={};E.ad_handlers.Contrib=Contrib;E.ad_handlers.VastVpaid=VastVpaid;function Contrib(player){this.ad_flag_re=/(^|\s)vjs-ad-(loading|playing)/;this.player=player;this.is_googima=!!this.get_ad_scheme().match("googima");this.log=player.log.set_module(this.is_googima?"googima":"adother");this.init()}Contrib.is_enabled=function(opt){return opt.vjs.ads};Contrib.prototype.get_ad_class=function(){var m,cls=this.player.get_ui().container.className;return(m=cls.match(this.ad_flag_re))&&m[0].trim()};Contrib.prototype.get_ad_scheme=function(){var vjs=this.player.vjs;return vjs.ima||vjs.ima3||vjs.ads._googleIma?"contrib/googima":"contrib/other"};Contrib.prototype.init=function(){var _this=this,player=this.player,vjs=player.vjs;if(typeof vjs.ads=="function"){this.adinit_hook=util.inject_hook(vjs,"ads",{post_set:function(e,args){_this.adinit_hook=_this.adinit_hook.remove();_this.init()}});return this.log.info("contrib-ads awaiting plugin setup")}this.log.info("contrib-ads init state "+vjs.ads.state+" class "+(this.get_ad_class()||"<not present>"));var ad_info={};var vjs_contrib_ads_map={"contrib/googima":{adstart:function(){ad_info={};player.emit("ad_start");player.emit("ad_play");_this.update_state()},adtimeupdate:"ad_time",adtimeout:"ad_timeout","ads-first-quartile":"ad_time","ads-midpoint":"ad_time","ads-third-quartile":"ad_time","ima3-resumed":"ad_play","ima3-paused":"ad_pause","ima3-skipped":function(){ad_info.skipped=true},adserror:"ad_error",adend:function(){player.emit(ad_info.skipped?"ad_skipped":"ad_complete")}},"contrib/other":{}};this.contrib_ad_map_uninit=map_ad_events(vjs,player,vjs_contrib_ads_map[this.get_ad_scheme()]);this.ad_state=this.calc_state();if(this.is_ad_active())this.ima_fix_state("PAUSED");this.adcls_unwatch=dom_util.attr_watch(player.get_ui().container,{attr:"class",toggle_pattern:this.ad_flag_re,watch_fn:function(from,to){if(to){_this.log.info("ad mode started: "+to.trim()+" detected");_this.update_state()}else{_this.log.info("ad mode finished: "+from.trim()+" removed");_this.update_state()}}});this.adstat_hook=util.inject_hook(vjs.ads,"state",{set:function(e,args){_this.log.info("contrib-ads state changed: "+vjs.ads.state+" >> "+args[0]);_this.adstat_hook.original_handlers.set(args[0]);_this.update_state();e.set_handled()}})};Contrib.prototype.ima_fix_state=function(target_state){var player=this.player;if(player.state==target_state)return;player.log.info("vjs ima_fix_state state "+player.state+">>"+target_state+" ad_state "+player.vjs.ads.state);player.state=target_state;player.emit("state",player.state);player.emit(target_state=="PAUSED"?"pause":"play")};Contrib.prototype.calc_state=function(){var player=this.player,plugin_state=player.vjs.ads.state;if(this.is_ima_ad_playing())return"PLAYING";if(!plugin_state||plugin_state.match(/^content-(playback|resuming)/)||!this.ad_flag_re.test(player.get_ui().container.className)){return"IDLE"}return plugin_state=="ad-playback"?"PLAYING":"LOADING"};Contrib.prototype.update_state=function(){var from=this.ad_state,to=this.ad_state=this.calc_state();if(from==to)return;var player=this.player;if(from=="IDLE"){this.ima_fix_state("PAUSED");player.emit("ad_suspend")}else if(to=="IDLE"){player.emit("ad_restore",{ad_empty:from=="LOADING"});if(player.play_during_ad){player.play_during_ad=false;player.emit("play");player.change_state("PLAYING")}else if(!player.vjs.ended()){this.ima_fix_state("PLAYING")}}};Contrib.prototype.is_ad_source=function(){return false};Contrib.prototype.is_ad_active=function(){var player=this.player,ad_active=false;var ads=player.vjs&&player.vjs.ads;if(!player.skip_contrib_admode&&ads){ad_active=ads.isInAdMode&&ads.isInAdMode()&&ads.inAdBreak&&ads.inAdBreak()}return this.ad_state=="LOADING"||this.ad_state=="PLAYING"||ad_active};Contrib.prototype.is_ad_loading=function(){return this.ad_state=="LOADING"};Contrib.prototype.is_ima_ad_playing=function(){var player=this.player,ima;if(!player.config.ima_ad_status||!(ima=player.vjs.ima)||!ima.controller||!ima.controller.sdkImpl||typeof ima.controller.sdkImpl.isAdPlaying!="function"){return}return ima.controller.sdkImpl.isAdPlaying()};Contrib.prototype.is_ad_playing=function(){if(!this.is_ad_active())return false;var vjs=this.player.vjs;if(vjs.ima3)return vjs.ima3.adPlayer&&!vjs.ima3.adPlayer.paused();var is_ad_playing;if(vjs.ima&&(is_ad_playing=this.is_ima_ad_playing())!==undefined)return is_ad_playing;if(vjs.ima)return vjs.ima.adPlaying;return false};Contrib.prototype.is_ad_paused=function(){if(!this.is_ad_active())return false;var vjs=this.player.vjs;if(vjs.ima3)return vjs.ima3.adPlayer&&vjs.ima3.adPlayer.paused();var is_ad_playing;if(vjs.ima&&(is_ad_playing=this.is_ima_ad_playing())!==undefined)return!is_ad_playing;if(vjs.ima)return!vjs.ima.adPlaying;return false};Contrib.prototype.ad_play=function(){if(!this.is_ad_active())return;var vjs=this.player.vjs;if(vjs.ima3&&vjs.ima3.adPlayer)return void vjs.ima3.adPlayer.play();if(vjs.ima&&vjs.ima.adsManager){vjs.ima.adsManager.resume();vjs.ima.adPlaying=true}};Contrib.prototype.ad_pause=function(){if(!this.is_ad_active())return;var vjs=this.player.vjs;if(vjs.ima3&&vjs.ima3.adPlayer)return void vjs.ima3.adPlayer.pause();if(vjs.ima&&vjs.ima.adsManager){vjs.ima.adsManager.pause();vjs.ima.adPlaying=false}};Contrib.prototype.uninit=function(){if(this.contrib_ad_map_uninit)this.contrib_ad_map_uninit();if(this.adcls_unwatch)this.adcls_unwatch();if(this.adstat_hook)this.adstat_hook.remove();if(this.adinit_hook)this.adinit_hook.remove()};function VastVpaid(player){this.player=player;this.init()}VastVpaid.is_enabled=function(opt){return opt.vjs.vast};VastVpaid.prototype.get_ad_scheme=function(){return"vast"};VastVpaid.prototype.init=function(){var _this=this,player=this.player,vjs=player.vjs;var ad_info=null;this.detect_ad_inplace=function(e){if(vjs.vast.adUnit){_this.ad_attached=vjs.vast.adUnit&&(vjs.vast.adUnit.getSrc()||{}).src==e.to;return}if(vjs.vastTracker){var m=zutil.get(vjs.vastTracker,"creative.mediaFiles",[]);_this.ad_attached=!!m.find(function(_m){return _m.fileURL==e.to});return}_this.ad_attached=false};this.is_vast_active=function(){if(!vjs.vastClient)return false;var ads_label=vjs.controlBar.getChild("AdsLabel");return!!(ads_label&&ads_label.el_&&dom_util.is_el_in_page(ads_label.el_))};this.vast_ad_start=function(){if(ad_info)return ad_info.skipped=false;ad_info={};player.emit("ad_start");player.emit("ad_play")};this.vast_ad_error=function(e){if(!ad_info)return;ad_info=null;player.emit("ad_error",e&&e.error&&e.error.message||"Unknown error")};this.vast_ad_skip=function(){if(ad_info)ad_info.skipped=true};this.vast_ad_complete=function(){player.log.notice("vjs vast.adEnd/vast.adCancel ad_info "+!!ad_info);if(!ad_info)return;player.emit(ad_info.skipped?"ad_skipped":"ad_complete");ad_info=null};this.vast_ad_map_uninit=map_ad_events(vjs,player,{"vast.adStart":this.vast_ad_start,"vast.adSkip":this.vast_ad_skip,"vast.adError":this.vast_ad_error,"vast.adEnd":this.vast_ad_complete,"vast.adsCancel":this.vast_ad_complete,"vpaid.AdImpression":"ad_impression","vpaid.AdSkipped":this.vast_ad_skip,"vpaid.pauseAd":"ad_pause","vpaid.resumeAd":"ad_play","hola.adConfigReqSending":"ad_config","hola.adDownload":"ad_download"});player.on("src_change",this.detect_ad_inplace);this.detect_ad_inplace({to:player.get_url()})};VastVpaid.prototype.is_ad_source=function(){return this.ad_attached};VastVpaid.prototype.is_ad_active=function(){return!this.ad_attached&&this.is_vast_active()};VastVpaid.prototype.is_ad_loading=function(){return false};VastVpaid.prototype.is_ad_playing=function(){return false};VastVpaid.prototype.is_ad_paused=function(){return false};VastVpaid.prototype.ad_play=function(){return false};VastVpaid.prototype.ad_pause=function(){return false};VastVpaid.prototype.uninit=function(){var player=this.player;player.off("src_change",this.detect_ad_inplace);this.vast_ad_map_uninit()};E.ad_handlers.ArtiMedia=clone_class(ad_handlers.ArtiMedia);E.ad_handlers.ArtiMedia.is_enabled=function(opt){return opt.vjs.artimedia};function resolve_url(src_url,playlist_url,segment_url){if(playlist_url==src_url)return util.resolve_url(src_url,segment_url);return util.resolve_url(util.resolve_url(src_url,playlist_url||""),segment_url)}function player_set_initial_state(player){var vjs=player.vjs;player.state="IDLE";player.ready=false;player.is_late_attach=function(){return player.is_playing()||player.is_ad_active()||!vjs_atInitPosition(vjs)};vjs.ready(function ready_cb(){if(!player.get_url()){if(!ready_cb.exec_count)player.log.info("waiting for videojs source setup");ready_cb.exec_count=(ready_cb.exec_count||0)+1;if(player.is_brightcove)setTimeout(ready_cb,100);else if(!vjs_getOptions(vjs,"sources.length")){player.ready=true}return}player.ready=true;player.change_state({detect:true})},true)}function vjs_change_src(vjs,src){var was_playing=!vjs.paused();vjs.src(src);if(was_playing)vjs.ready(vjs.play.bind(vjs))}E.vjs_getTechObj=function(vjs){return vjs.tech_||vjs.tech};E.vjs_getTechName=function(vjs){var t;if(t=vjs.techName||vjs.techName_)return t;var el;if(!(el=vjs_getElement(vjs)))return"";return(t=el.id&&el.id.match(/_([a-zA-Z0-9]+)_api$/))&&t[1]||""};E.vjs_getTech=function(vjs){var t=E.vjs_getTechName(vjs).toLowerCase();if(t=="flash"||t=="html5")return t;var el=vjs_getElement(vjs);var tag=el&&el.tagName&&el.tagName.toLowerCase();return tag=="video"?"html5":tag=="object"?"flash":""};E.vjs_getBuffered=function(vjs,_html5){return _html5&&!vjs_version?_html5.buffered:vjs.buffered()};function vjs_is_brightcove(vjs){return/(^|\s)bc-player/.test(vjs.el().className)}function vjs_get_html5(vjs){var el=vjs_getElement(vjs);return is_video_element(el)?el:undefined}function vjs_get_error(player,a){var err_map={1:{message:"download was cancelled",reason:"other"},2:{message:"network error",reason:"media_load"},3:{message:"decode error",reason:"media_decode"},4:{message:"source not supported",reason:"media_support"},5:{message:"encryption error",reason:"media_decode"},unknown:{message:"unknown",reason:"other"},"-1":{message:"no video was loaded",reason:"other"},"-2":{message:"timeout",reason:"media_load"}};var code,msg;if(player.vjs.error){var ops,error=player.vjs.error();if(!error)return;code=error.code;msg=error.message;if((ops=player.module_ops)&&ops.is_err_allowed&&ops.is_err_allowed(error)){return}}code=code||a.target&&a.target.error&&a.target.error.code||a.code;var info=err_map[code]||err_map.unknown;msg=msg||a.message||info.message;return{code:code,reason:info.reason,message:msg}}function vjs_atInitPosition(vjs){var el;if(!(el=vjs_get_html5(vjs)))return!vjs.currentTime();return html5.at_init_position(el)}E.vjs_getElement=vjs_getElement;function vjs_getElement(vjs){var tech=E.vjs_getTechObj(vjs),el=tech&&(tech.el_||tech.el);if(!el&&typeof vjs.el=="function")el=vjs.el().getElementsByClassName("vjs-tech")[0];return typeof el=="function"&&!(el instanceof Node)?el.call(tech):el}function is_video_element(el){return el&&el.tagName&&el.tagName.toLowerCase()=="video"}function vjs_getOptions(vjs,path){return path?zutil.get(vjs.options(),path):vjs.options()}E.hacks={};E.hacks.hide_source_change=function(vjs,facade_src,surrogate_src){var proxy_fn=function(e,args,based_on){if(args[0]!==undefined)return;var real_src=based_on.original_handlers.exec();if(real_src!=surrogate_src)return;e.set_handled();return facade_src};var hooks={src:util.inject_hook(vjs,"src",function(e,args){return proxy_fn(e,args,hooks.src)}),csrc:util.inject_hook(vjs,"currentSrc",function(e,args){return proxy_fn(e,args,hooks.csrc)})};return function(){Object.keys(hooks).forEach(function(name){hooks[name].remove()})}};E.adapters={};E.adapters.v6=function(vjs,_html5){function register_mw(){var videojs=window.videojs||vjs.constructor;if(!videojs||register_mw.attached)return;videojs.use("video/mp4",function(){return{setSource:function(src,next){if(src.hola_media_src_gen)src.src=src.hola_media_src_gen();next(null,src)}}});register_mw.attached=true}return assign(E.adapters.v5(vjs,_html5),{replace_src:function(src,create_cb){register_mw();vjs_change_src(vjs,{src:src,type:"video/mp4",hola_media_src_gen:create_cb})},src_from_cache:function(cache){return vjs.changingSrc_?cache.source.src:cache.src},is_changing_src:function(){return vjs.changingSrc_}})};E.adapters.v5=function(vjs){return assign(E.adapters.v4(vjs),{seek:function(pos){vjs.currentTime(pos)}})};E.adapters.v4=function(vjs,_html5){return{replace_src:function(src,create_cb){vjs_change_src(vjs,{src:create_cb(),type:"video/mp4"})},src_from_cache:function(cache){return cache.src},is_changing_src:function(){},seek:function(pos){var _this=this;if(_html5&&_html5.readyState<_html5.HAVE_METADATA){return _html5.addEventListener("loadedmetadata",function cb(){_html5.removeEventListener("loadedmetadata",cb);_this.seek(pos)})}vjs.currentTime(pos)},ready_state:function(){if(vjs.readyState)try{return vjs.readyState()}catch(e){}if(_html5)return _html5.readyState;return-1},using_native_controls:function(){if(vjs.usingNativeControls)return vjs.usingNativeControls()}}};return E});
define("/svc/cdn/pub/android.js",{__stub:1});
define("/svc/cdn/pub/youtube.js",{__stub:1});
define("filesaver",{__stub:1});
define("/svc/cdn/pub/flowplayer.js",["cash","/svc/cdn/pub/html5.js","/util/util.js","/svc/cdn/pub/log.js","/svc/cdn/pub/util.js","/svc/cdn/pub/dailymotion.js","/svc/cdn/pub/dash.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/ad_handlers.js","/util/events.js"],function($,html5,zutil,_log,util,dailymotion,dash,player_util,ad_handlers){var E={};var CG=util.gconf_get;var log=player_util.log(null,"flowplayer");E.Player=function(opt){util.call_super(E,this,null,opt);var _this=this;this.log=log=player_util.log(opt.log,"flowplayer");this.opt=opt;this.flowplayer=fp_patch_reload(opt.flowplayer);this.container=E.fp_container_get(this.flowplayer);this.name="flowplayer";this.flowplayer.on("ready.hola_ns",function(){_this.emit("ready")});this.flowplayer.on("load.hola_ns",function(){_this._reconf()});util.inject_hook(this,"media_src",{get:function(e){e.set_handled();return _this.engine&&_this.engine.media_src}});this._reconf();if(opt.reconf_notifier){opt.reconf_notifier.on("update",function(_opt){_this.opt=_opt;if(!_this.is_idle())_this.emit("error",{reason:"unexpected player regroup"})})}};zutil.inherits(E.Player,player_util.Player);util.module_fn(E,function get_url(){var fl=this.flowplayer;var use_url=function(src){return src&&!util.is_blob_url(src)&&src};return use_url(fl.video.url)||use_url(fl.video.src)||(fl.video.index!==undefined?fl.conf.playlist[fl.video.index].sources[0].src:this.engine&&this.engine.get_url())});E.Player.prototype._reconf=function(opt){var _this=this;var was_idle=this.is_idle();opt=opt||{};this.flowplayer.off(".hola_reconf_ns");if(this.rm_forwarding_emit)this.rm_forwarding_emit=this.rm_forwarding_emit();if(this.engine){this.engine_events_uninit();this.engine=this.engine.uninit()}if(this.module)this.module=this.module.uninit();if(this.ad_handler)this.ad_handler=this.ad_handler.uninit();if(!was_idle&&this.is_idle())this.emit("state","IDLE");if(opt.shutdown)return;if(!this._is_ready()){this.flowplayer.one("ready.hola_reconf_ns",function(){_this._reconf()});return}if(this.opt.html5){util.assert_enabled(html5,"html5 module is required but disabled");this.engine=new html5.Player({log:this.log,html5:this.opt.html5});this.engine_events_uninit=this._bind_events_to(this.engine);this.tech="html5";this.html5=this.opt.html5}else{if(this.flowplayer.engine&&this.flowplayer.engine.engineName=="flash")this.tech="flash"}var video_type=this.get_video_type_name();if(this.opt.dailymotion){var flowplayer_on_shutdown2=function(){_this.flowplayer.off("shutdown.hola_hs");_this.flowplayer.off("hola_quality_change.hola_hs")};var flowplayer_quality_change=function(){_this.emit("quality_level")};util.assert_enabled(dailymotion,"dailymotion module is required but disabled");this.module=new dailymotion.Module({dailymotion:this.opt.dailymotion,log:this.log,player:this,state:this.engine&&this.engine.state});this.flowplayer.on("hola_quality_change.hola_hs",flowplayer_quality_change);this.flowplayer.on("shutdown.hola_hs",flowplayer_on_shutdown2)}else if(video_type=="dash"&&this.flowplayer.engine.holaDash){util.assert_enabled(dash,"dash module is required but disabled");var dash_obj=this.flowplayer.engine.holaDash;_this.module=new dash.Module({html5:this.html5,log:this.log,dashjs:dash_obj})}this.ad_handler=player_util.select_ad_handler(this,E.ad_handlers,{player:this});if(!this.is_idle()){this.emit("state",this.get_state());this.emit("started")}this.rm_forwarding_emit=util.create_forwarding_emit(this)};E.Player.prototype.uninit=function(){this.flowplayer.off(".hola_ns");this._reconf({shutdown:true})};E.Player.prototype._bind_events_to=function(engine){var _this=this;var events=["started","state","seeking","seeked","waiting","timeupdate","duration_changed","pause","play","error","interrupted","ended"];var handlers=events.map(function(e){return{event:e,cb:_this.emit.bind(_this,e)}});handlers.forEach(function(h){engine.on(h.event,h.cb)});return function(){handlers.forEach(function(h){engine.off(h.event,h.cb)})}};E.Player.prototype._is_ready=function(){if(CG("loader.player.flowplayer.skip_splash_hola_reloading")&&this.flowplayer.splash){return true}if(!this.flowplayer.hola_reloading&&this.get_url()&&this.flowplayer.engine&&!["flash","dash"].includes(this.flowplayer.engine.engineName)){return true}return this.flowplayer.ready&&!this.flowplayer.hola_reloading};E.Player.prototype.enable_data_mode=function(on_sourceopen){var _this=this,pos=this.get_pos();if(this.flowplayer.video.type=="video/mp4"&&pos>10){this.flowplayer.one("ready",function(){_this.flowplayer.engine.seek(pos)})}if(this.engine){this.engine.enable_data_mode(on_sourceopen);this.flowplayer.ready=false}else if(this.module)this.module.enable_data_mode(on_sourceopen)};E.Player.prototype.get_versions=function(){var versions={flowplayer:window.flowplayer.version};if(this.module&&this.module.get_versions)Object.assign(versions,this.module.get_versions());return versions};E.Player.prototype.get_ad_scheme=function(){return this.ad_handler&&this.ad_handler.get_ad_scheme()};E.Player.prototype.is_ad_source=function(){return this.ad_handler&&this.ad_handler.is_ad_source()||this.engine&&this.engine.is_ad_source()};E.Player.prototype.is_ad_active=function(){return this.ad_handler&&this.ad_handler.is_ad_active()};E.Player.prototype.is_ad_loading=function(){return this.ad_handler&&this.ad_handler.is_ad_loading()};E.Player.prototype.is_ad_playing=function(){return this.ad_handler&&this.ad_handler.is_ad_playing()};E.Player.prototype.is_ad_paused=function(){return this.ad_handler&&this.ad_handler.is_ad_paused()};E.Player.prototype.ad_play=function(){return this.ad_handler&&this.ad_handler.ad_play()};E.Player.prototype.ad_pause=function(){return this.ad_handler&&this.ad_handler.ad_pause()};E.Player.prototype.is_autostart=function(){return!!this.flowplayer.conf.autoplay};E.Player.prototype.is_native_hls=function(){return this.flowplayer.engine&&this.flowplayer.engine.engineName=="html5"&&this.get_video_type_name()=="hls"};var pass_fns=["get_duration","refresh_buffered","get_pos","is_live_stream","is_playing","is_paused","get_current_fragment","get_buffered","get_bitrate","get_levels","get_playlists","get_current_playlist","get_current_level","get_bandwidth","get_segment_info","seek","play_url","get_resolution","one","disable_data_mode","get_est_bytes","init_adaptive","ondata_adaptive","get_decoded_frames","get_dropped_frames",{name:"is_idle",def_handler:function(){return true}},{name:"get_state",def_handler:function(){return"IDLE"}}];pass_fns.forEach(function(opt){opt=typeof opt=="string"?{name:opt}:opt;E.Player.prototype[opt.name]=function(){if(this.module&&this.module[opt.name])return this.module[opt.name].apply(this.module,arguments);else if(this.engine)return this.engine[opt.name].apply(this.engine,arguments);else if(opt.def_handler)return opt.def_handler.apply(this.engine,arguments)}});E.Player.prototype.play=function(){if(this.flowplayer.splash&&!this.flowplayer.ready)this.flowplayer.load();else this.flowplayer.play()};E.Player.prototype.pause=function(){this.flowplayer.pause()};E.Player.prototype.is_ready=function(){return this.flowplayer.ready||this.flowplayer.splash};E.Player.prototype.get_ui=function(){if(!this.container)return{};return{container:this.container,control_bar:this.container.querySelector(".fp-controls"),progress_bar:this.container.querySelector(".fp-timeline"),fullscreen:this.container.querySelector(".fp-player"),media:this.html5||this.container.querySelector(".fp-engine")}};E.Player.prototype.enable_context_menu=function(){var c=this.get_ui().container;if(!c||!this.contextmenu_handler)return;c.removeEventListener("contextmenu",this.contextmenu_handler,{capture:true});delete this.contextmenu_handler};E.Player.prototype.disable_context_menu=function(){var c=this.get_ui().container;if(!c||this.contextmenu_handler)return;this.contextmenu_handler=function(e){e.stopPropagation();e.preventDefault()};c.addEventListener("contextmenu",this.contextmenu_handler,{capture:true})};E.Player.prototype.get_captions_track=function(){var c=this.get_ui().container;return+$(c).find(".fp-subtitle-menu").find("a.fp-selected").attr("data-subtitle-index")};E.Player.prototype.set_captions_track=function(track){if(track<0)return this.flowplayer.disableSubtitles();this.flowplayer.loadSubtitles(track)};E.Player.prototype.muted=function(v){if(v===undefined)return this.flowplayer.muted;this.flowplayer.mute(v)};E.Player.prototype.volume=function(v){if(v===undefined)return this.flowplayer.volumeLevel;this.flowplayer.volume(v)};E.Player.prototype.fullscreen=function(v){if(v===undefined)return this.flowplayer.isFullscreen;this.flowplayer.fullscreen(v)};E.Player.prototype.get_caps=function(){return player_util.Player.prototype.get_caps({hap_provider_loaded:!!(window.hola_flowplayer_hls||util.dom_query("script[src*=hola_flowplayer_hls]"))})};E.Player.prototype.is_seeking=function(){return this.flowplayer.seeking||this.html5&&this.html5.seeking};E.Player.prototype.play_src=function(src,idx){src=src[idx||0];this.flowplayer.load({sources:[{type:src.type,src:src.url}]});this.flowplayer.play()};E.Player.prototype.get_player=function(){return this.flowplayer};E.Player.prototype.get_title=function(){return this.flowplayer.conf.title};E.get_players=function(){if(!window.flowplayer)return[];var players=$("[data-flowplayer-instance-id]").get().map(function(el){var fid=el.getAttribute("data-flowplayer-instance-id");return{container:el,id:fid,fplayer:fid&&window.flowplayer(+fid)}});return players.filter(function(p){return!!p.fplayer})};E.fp_container_get=function(fp){var match=E.get_players().find(function(o){return o.fplayer==fp});return match&&match.container};E.fp_dailymotion_get=function(fp){var dm;if(!fp.engine||!["hlsjs","holaHls"].includes(fp.engine.engineName))return;if(!(dm=window.dm_hls_inst||fp.engine[fp.engine.engineName])){log.err("no dm/hls instance available, update to "+"newer version of flowplayer.hlsjs required")}return dm};function Googima(player){this.player=player;this.init()}Googima.is_enabled=function(opt){return!!zutil.get(opt.player.flowplayer.conf,"ima.ads",[]).length};Googima.prototype.get_ad_scheme=function(){return"googima"};Googima.prototype.is_ad_source=function(){return false};Googima.prototype.is_ad_active=function(){return this.$player.hasClass("is-ad-visible")&&!this.$player.hasClass("is-ad-nonlinear")};Googima.prototype.is_ad_loading=function(){return false};Googima.prototype.is_ad_playing=function(){return this.is_ad_active()&&!this.$ad_container.hasClass("ad-paused")};Googima.prototype.is_ad_paused=function(){return this.is_ad_active()&&this.$ad_container.hasClass("ad-paused")};Googima.prototype.ad_play=function(){if(this.is_ad_paused())this.play_button.click()};Googima.prototype.ad_pause=function(){if(this.is_ad_playing())this.play_button.click()};Googima.prototype.init=function(){this.$player=$(this.player.container);this.$ad_container=$(".fp-ad-container",this.player.container);this.play_button=$(".fp-playbtn, .fp-play",this.$ad_container[0])[0]};Googima.prototype.uninit=function(){};E.ad_handlers={ArtiMedia:ad_handlers.ArtiMedia,Googima:Googima};function fp_patch_reload(fp){if(fp.hola_patched)return fp;fp.hola_patched=true;fp.on("load.hola_permanent_ns",function(){fp.hola_reloading=true});fp.on("ready.hola_permanent_ns",function(){delete fp.hola_reloading});return fp}E.get_handler=function(Player){var reconf_opt="loader.autodetect.flowplayer.reconf_by_wrapper";return{rels:{html5:"anc",dailymotion:"mod"},get_instances:function(){return E.get_players().map(function(group){return group.fplayer})},normalize:function(instance){var group=E.get_players().find(function(g){return g.fplayer==instance});return new Player({get_element:function(){var el=group.container.querySelector(".fp-engine");return el&&["object","embed","video"].includes(el.tagName.toLowerCase())?el:null},get_container:function(){return group.container},get_footprint:function(){return{player_id:group.id}},get_opt:function(){var dm,opt={flowplayer:instance};if(dm=E.fp_dailymotion_get(instance))opt.dailymotion=dm;return opt},get_caps:function(){return{init_on_master_ready:true,reconf_by_wrapper:CG(reconf_opt,true)}}})}}};return E});
define("/svc/cdn/pub/ios.js",["/svc/cdn/pub/util.js","/util/util.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/perr.js"],function(util,zutil,player_util,perr){var E={};var get_proxy=function(){return window.hola_ios_proxy||window.spark_ios_proxy};E.detected=function(){return get_proxy()};E.get_players=function(){var proxy=get_proxy();if(!proxy)return null;if(proxy.wrapper_attached)return proxy;var players=[];for(var id in proxy)players.push(proxy[id]);return players.length?players:null};E.Player=function(opt){util.call_super(E,this,null,opt);var _this=this;this.name="ios";this.tech="native";this.proxy=opt.ios;this.player_id=this.proxy&&this.proxy.proxy_id?this.proxy.proxy_id:opt.player_id||1;this.state=this.proxy.get_state();if(this.proxy.get_app_label)this.app_name=this.proxy.get_app_label();if(this.proxy.is_ad_playing)this.ad_in_progress=this.proxy.is_ad_playing();this.log=player_util.log(opt.log,"ios");this.swf={hola_fetchBin:function(o){return{id:_this.proxy.fetch(o.url,o.jsurlstream_req_id,o.rate)}},hola_fetchBinRemove:function(id){_this.proxy.fetch_remove(id)},hola_onFragmentData:function(){},hola_settings:function(opt){return _this.proxy.settings(opt)}};this.flash_api=player_util.build_flash_api(this);var delegate={id:opt.player_id,on_play:function(){_this.state="PLAYING";_this.emit("play")},on_pause:function(){_this.state="PAUSED";_this.emit("pause")},on_idle:function(){_this.state="IDLE";_this.emit("ended")},on_ad_suspend:function(){_this.ad_in_progress=true;_this.emit("ad_suspend");_this.emit("ad_start");_this.emit("ad_play")},on_ad_restore:function(){_this.ad_in_progress=false;_this.emit("ad_restore")},on_timeupdate:function(pos){if(_this.state=="SEEKED")_this.state="PLAYING";_this.emit("timeupdate",pos)},on_seeking:function(){_this.state="SEEKING";_this.emit("seeking")},on_seeked:function(){_this.state="SEEKED";_this.emit("seeked")},on_ended:function(){_this.state="IDLE";_this.emit("ended")},on_error:function(reason){_this.emit("error",{reason:reason})},perr:function(id,data){perr({id:id,info:data})},req:function(data){var req=data.url;var video_type=_this.get_video_type_name(req);if(!_this.cdn_mode||!data.force&&video_type=="hls")_this.proxy.fetch(req,data.req_id);else{data.id="hola.requestFragment";data.player_id=_this.player_id;window.postMessage(data,"*")}},stream_open:function(data){window.postMessage({id:"holaflash.streamOpen",fb_id:data.req_id,player_id:_this.player_id},"*")},stream_response:function(data){window.postMessage({id:"holaflash.streamHttpStatus",fb_id:data.req_id,status:data.status,ms_hdrs:data.ms,player_id:_this.player_id},"*")},stream_progress:function(data){var req_id=data.req_id;window.postMessage({id:"holaflash.streamProgress",player_id:_this.player_id,fb_id:req_id,bytesTotal:data.total,bytesLoaded:data.loaded},"*")},stream_complete:function(data){var req_id=data.req_id;window.postMessage({id:"holaflash.streamComplete",fb_id:req_id,player_id:_this.player_id},"*")},stream_error:function(data){window.postMessage({id:"holaflash.streamError",fb_id:data.req_id,player_id:_this.player_id},"*")}};this.on("wrapper_attached",this.on_attached=function(){_this.off("wrapper_attached",_this.on_attached);_this.proxy.delegate=delegate;_this.emit("started",_this.get_url());_this.proxy.wrapper_attached()})};zutil.inherits(E.Player,player_util.Player);E.Player.prototype.uninit=function(){this.proxy.uninit();this.proxy.delegate=null};E.Player.prototype.get_url=function(){return this.proxy.get_url()};E.Player.prototype.get_duration=function(){var duration=this.proxy.get_duration();return duration===-1?Infinity:duration||0};E.Player.prototype.get_pos=function(){return this.proxy.get_pos()};E.Player.prototype.refresh_buffered=function(){};E.Player.prototype.is_live_stream=function(){return false};E.Player.prototype.is_ad_playing=function(){return!!this.ad_in_progress};E.Player.prototype.get_state=function(){return this.is_ad_playing()?"PAUSED":this.state};E.Player.prototype.is_playing=function(){return this.get_state()=="PLAYING"};E.Player.prototype.is_paused=function(){return this.get_state()=="PAUSED"};E.Player.prototype.is_idle=function(){return this.get_state()=="IDLE"};E.Player.prototype.is_autostart=function(){return false};E.Player.prototype.get_buffered=function(){var ranges=this.proxy.get_buffered();return{length:ranges.length,start:function(i){return ranges[i].start},end:function(i){return ranges[i].end}}};E.Player.prototype.get_bitrate=function(){return this.proxy.get_bitrate()};E.Player.prototype.get_ui=function(){return{}};E.Player.prototype.get_levels=function(cached){return cached&&this.levels?this.levels:this.levels=this.proxy.get_levels()};E.Player.prototype.get_playlists=function(){};E.Player.prototype.get_current_playlist=function(with_segments){};E.Player.prototype.get_current_level=function(){};E.Player.prototype.get_current_fragment=function(){};E.Player.prototype.get_bandwidth=function(){return this.proxy.get_bandwidth()};E.Player.prototype.get_segment_info=function(url){return this.proxy.get_segment_info(url)};E.Player.prototype.seek=function(ms){};E.Player.prototype.play=function(){};E.Player.prototype.pause=function(){};E.Player.prototype.play_url=function(url,opt){};E.Player.prototype.set_cdn_mode=function(on){this.cdn_mode=!!on};E.Player.prototype.enable_data_mode=function(on_sourceopen){};E.Player.prototype.disable_data_mode=function(){};E.Player.prototype.init_adaptive=function(){};E.Player.prototype.ondata_adaptive=function(){};E.Player.prototype.get_decoded_frames=function(){};E.Player.prototype.get_dropped_frames=function(){};E.Player.prototype.get_resolution=function(){};E.get_handler=function(Player){return{init:function(ctrl){window.hola_cdn.api.ios_ready=function(){ctrl.emit("resync")};ctrl.once("uninit",function(){window.hola_cdn.api.ios_ready=undefined})},get_instances:function(){return E.get_players()},normalize:function(instance){return new Player({get_element:function(){return instance},get_opt:function(){return{ios:instance}}})}}};E.t={mocha_setup:function(opt){perr=opt.perr||perr}};return E});
define("/svc/cdn/pub/hola_vjs.js",["/util/util.js","/svc/cdn/pub/util.js","/svc/cdn/pub/html5.js","/svc/cdn/pub/dailymotion.js","/svc/cdn/pub/dash.js","/svc/cdn/pub/player_util.js","/svc/cdn/pub/dom_util.js","/svc/cdn/pub/vjs.js","/util/events.js","/svc/cdn/pub/perr.js"],function(zutil,util,html5,dailymotion,dash,player_util,dom_util,vjs,events,perr){var E={};var CG=util.gconf_get;var ad_flag_re=/(^|\s)vjs-ad-(playing|loading)/;var ad_loading_flag_re=/(^|\s)vjs-ad-loading/;E.Player=function(opt){util.call_super(E,this,null,opt);var _this=this;this.player_id=opt.player_id||1;this.vjs=this.video=opt.vjs;this.tech=util.is_enabled(vjs)&&vjs.vjs_getTech(opt.vjs)||"html5";this.name="hola";this.is_vjs5_new_hls=true;this.log=player_util.log(opt.log,"hola");if(opt.html5)this.html5=opt.html5;this.media_src_api=this.tech=="html5"&&window.MediaSource?window:window.videojs;this.position=0;this.blob2url={};this.vjs_handlers={};this.custom_buttons=new CustomButtons(this);this.media_type="video";this.on("wrapper_attached",function(){_this.vjs.trigger("hola.wrapper_attached")});this.on("wrapper_detached",function(){_this.vjs.trigger("hola.wrapper_detached")});this.on_vjs=function(events,handler){var wrapper=function(e){if(this.ready)handler.call(this,e)}.bind(this);[].concat(events).forEach(function(event){_this.vjs_handlers[event]=(_this.vjs_handlers[event]||[]).concat(wrapper);_this.vjs.on(event,wrapper)});return wrapper};this.config={disable_ended_fallback:CG("loader.player.disable_ended_fallback"),disable_src_check:CG("loader.player.disable_src_check"),log_all_events:CG("loader.player.log_all_events")};if(this.config.log_all_events){["durationchange","ready","controlsenabled","firstplay","waiting","loadedqualitydata","userinactive","stalled","ads-cuepoints","adsready","readyforpreroll","ads-load","adstart","adskip","ads-impression","ads-ad-started","ads-first-quartile","ads-midpoint","ads-third-quartile","ads-ad-ended","adend","ads-click","ads-ad-skipped","ads-mute","nopreroll"].forEach(function(e){_this.on_vjs(e,function(){_this.log.info('vjs event "'+e+'"')})})}this.module_handlers={dashjs:function(){var is_dashjs_env=function(){var adaptive=_this.get_video_type_name();return adaptive=="dash"&&window.videojs.Html5DashJS};if(!is_dashjs_env())return;util.assert_enabled(dash,"dash module is required but disabled");var vjs_dashjs_get=function(vjs){return vjs.tech_.sourceHandler_.mediaPlayer_};var dash_obj=vjs_dashjs_get(_this.vjs);dash.patch_dashjs(dash_obj);_this.module=new dash.Module({html5:opt.html5||vjs_getElement(_this.vjs),log:_this.log,dashjs:dash_obj,vjs:_this.vjs});return{changed:function(){return!is_dashjs_env()||dash_obj!=vjs_dashjs_get(_this.vjs)},uninit:function(){_this.module.uninit();_this.module=undefined}}},hola_hls:function(){var vjs_hls_get=function(vjs){return vjs.tech_.hls_obj};var is_hola_hls_env=function(){var adaptive=_this.get_video_type_name();return adaptive=="hls"&&window.videojs.HolaProviderHLS&&vjs_hls_get(_this.vjs)};if(!is_hola_hls_env())return;util.assert_enabled(dailymotion,"dailymotion module is required but disabled");var hls_obj=vjs_hls_get(_this.vjs);_this.module=new dailymotion.Module({html5:opt.html5||vjs_getElement(_this.vjs),log:_this.log,dailymotion:hls_obj,vjs:_this.vjs,player:_this,state:_this.state});var get_media_type=function(levels){if(!levels||!levels.length)return"video";var is_video=0;levels.forEach(function(level){var frag=level.details&&level.details.fragments&&level.details.fragments[0];var url=frag&&frag.url;var ext=url&&url.split("?")[0].substr(-3).toLowerCase();is_video+=+!!(level.videoCodec||!level.audioCodec&&(level.bitrate>64e3||level.width||level.height)||!level.bitrate&&ext&&ext!="aac")});return is_video?"video":"audio"};_this.media_type=get_media_type(hls_obj.levels);_this.rm_forwarding_emit=util.create_forwarding_emit(_this);_this.hls_manifest_loaded=function(){_this.media_type=get_media_type(hls_obj.levels);_this.emit("media_type",_this.media_type);_this.emit("manifest_loaded")};_this.module.on("manifest_loaded",_this.hls_manifest_loaded);_this.module.on("level_loaded",_this.hls_level_loaded=function(lvl){_this.media_type=get_media_type(hls_obj.levels);_this.emit("level_loaded",lvl)});_this.module.on("level_updated",_this.hls_level_updated=function(lvl){_this.emit("level_updated",lvl)});_this.module.on("seg_stats",_this.hls_seg_stats=function(lvl){_this.emit("seg_stats",lvl)});_this.module.on("buf_stats",_this.hls_buf_stats=function(lvl){_this.emit("buf_stats",lvl)});_this.module.on("frag_load_stats",_this.hls_frag_load_stats=function(d){_this.emit("frag_load_stats",d)});_this.module.on("error",_this.hls_error=function(lvl){_this.emit("error",lvl)});return{changed:function(){return!is_hola_hls_env()||hls_obj!=vjs_hls_get(_this.vjs)},uninit:function(){if(!_this.module)return;if(_this.rm_forwarding_emit)_this.rm_forwarding_emit=_this.rm_forwarding_emit();_this.module.off("manifest_loaded",_this.hls_manifest_loaded);_this.module.off("level_loaded",_this.hls_level_loaded);_this.module.off("level_updated",_this.hls_level_updated);_this.module.off("seg_stats",_this.hls_seg_stats);_this.module.off("buf_stats",_this.hls_buf_stats);_this.module.off("frag_load_stats",_this.hls_frag_load_stats);_this.module.uninit();_this.module=_this.hls_level_loaded=undefined;_this.hls_seg_stats=_this.hls_buf_stats=undefined;_this.hls_manifest_loaded=undefined;_this.hls_level_updated=undefined;_this.hls_frag_load_stats=undefined}}}};this.on("pre-started",this.module_reconf=function(){if(_this.module_ops){if(!_this.module_ops.changed())return;_this.module_ops.uninit()}Object.keys(_this.module_handlers).find(function(h){return _this.module_ops=_this.module_handlers[h]()})});this.module_reconf();player_set_initial_state(this);this.src_hook=util.inject_hook(this.vjs,"src",{log:this.log,exec:function(e,args){var src=args[0];if(!src)return;if(typeof src!="string")src=Array.isArray(src)?src[0].src:src.src;if(_this.blob2url[src]||src==_this.get_url())return;perr({id:"source_change"});_this.emit("src_change",{from:_this.get_url(),to:src});if(!_this.is_idle()){_this.emit("interrupted");_this.seeking=_this.pending_sourceopen=false;change_state("IDLE")}_this.source_change_in_progress=true;_this.src_hook.original_handlers.exec.apply(this,args);e.set_handled();_this.refresh_buffered();_this.vjs.ready(function(){}