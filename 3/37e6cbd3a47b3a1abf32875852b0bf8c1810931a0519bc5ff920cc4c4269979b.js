/**
 *  ==========================================================================
 * @tencent/aegis-web-sdk@1.37.2 (c) 2022 TencentCloud Real User Monitoring.
 * Author pumpkincai.
 * Last Release Time Thu May 12 2022 20:19:00 GMT+0800 (GMT+08:00).
 * Released under the MIT License.
 * Thanks for supporting RUM & Aegis!
 * ==========================================================================
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Aegis=t()}(this,function(){"use strict";var j,q;function e(e){this.name="__st"+(1e9*Math.random()>>>0)+j+"__",null!=e&&e.forEach(this.add,this),j+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var o=arguments[1],i=0;i<n;){var r=t[i];if(e.call(o,r,i,t))return r;i+=1}}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),window.WeakSet||(j=Date.now()%1e9,e.prototype.add=function(e){var t=this.name;return e[t]||Object.defineProperty(e,t,{value:!0,writable:!0}),this},e.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},e.prototype.has=function(e){return!!e[this.name]},q=e,Object.defineProperty(window,"WeakSet",{value:function(e){return new q(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(o=arguments[n]))for(var o=Object(o),i=Object.keys(Object(o)),r=0,s=i.length;r<s;r++){var a=i[r],c=Object.getOwnPropertyDescriptor(o,a);null!=c&&c.enumerable&&(t[a]=o[a])}return t}});var F=function(e,t){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},E=function(){return(E=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function l(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var o=Array(e),i=0,t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)o[i]=r[s];return o}function D(t){try{return encodeURIComponent(decodeURIComponent(t))}catch(e){return t}}t.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},t.prototype.on=function(e,t,n){var o;if(void 0===n&&(n=0),this)return(o=this.eventsList[e])||(this.eventsList[e]=[],o=this.eventsList[e]),-1===this.indexOf(o,t)&&o.push({name:e,type:n||0,callback:t}),this},t.prototype.one=function(e,t){this.on(e,t,1)},t.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(!n)return null;if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}return null}},t.prototype.clear=function(){this.eventsList={}};var h,M=t,H=function(e){if(!e||0===e.length)return"{}";e=Array.isArray(e)?e:[e];var t=Object.keys(e[0]),n={};return t.forEach(function(t){n[t]=e.map(function(e){return e[t]})}),n.count=e.length,J(n)};function t(){var s=this;this.emit=function(e,t){if(s){var n;if(null!=(o=s.eventsList[e])&&o.length)for(var o=o.slice(),i=0;i<o.length;i++){n=o[i];try{var r=n.callback.apply(s,[t]);if(1===n.type&&s.remove(e,n.callback),!1===r)break}catch(e){throw e}}return s}},this.eventsList={}}(n=h=h||{})[n.number=-1]="number",n.string="";function B(e,t){return"number"==typeof e||"string"==typeof e?e:t?h.string:h.number}function g(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function m(e){return"string"==typeof e&&e.startsWith("//")?"undefined"!=typeof location&&"https:"===location.protocol:/^https/.test(e)}function W(t){return V.some(function(e){return-1!==t.indexOf(e)})}function y(e,t,n){var o,i;try{if("function"==typeof(null==t?void 0:t.retCodeHandler))return{code:void 0===(r=(i=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx)||{}).code)?"unknown":r,isErr:i.isErr};"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null==(o=null==t?void 0:t.ret)?void 0:o.join)&&(X=[].concat(t.ret.map(function(e){return e.toLowerCase()})));var r,s=Object.getOwnPropertyNames(e).filter(function(e){return-1!==X.indexOf(e.toLowerCase())});return s.length?{code:""+(r=Number(e[s[0]])),isErr:0!==r}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}function v(r,s){void 0===s&&(s=3);var i,a,c,u="";return Array.isArray(r)?(u+="[",i=r.length,r.forEach(function(e,t){var n,o;u=(u+="object"==typeof e&&1<s?v(e,s-1):(o="",o+="undefined"==(n=typeof(e=e))||"symbol"==n||"function"==n?"null":"string"==n||"object"==n?'"'+e+'"':e))+(t===i-1?"":",")}),u+="]"):r instanceof Object?(u="{",a=Object.keys(r),c=a.length,a.forEach(function(e,t){var n,o,i;"object"==typeof r[e]&&1<s?u+='"'+e+'":'+v(r[e],s-1):u+=(n=r[e=e],i="","string"==(o=typeof n)||"object"==o?i+='"'+e+'":"'+n+'"':"function"==typeof n?i+='"'+e+'":"function '+n.name+'"':"symbol"==typeof n?i+='"'+e+'":"symbol"':"number"!=typeof n&&"boolean"!=o||(i+='"'+e+'": '+n),i),u+=t===c-1||t<c-1&&void 0===r[a[t+1]]?"":","}),u+="}"):u+=r,u}var R,O,f,V=["application/octet-stream","application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/vnd.apple.mpegurl","application/ogg","text/css","text/javascript","image","audio","video"],X=["ret","retcode","code","errcode"],G=function(){var n=new WeakSet;return function(e,t){if(t instanceof Error)return"Error.message: "+t.message+" \n  Error.stack: "+t.stack;if("object"==typeof t&&null!==t){if(n.has(t))return"[Circular "+(e||"root")+"]";n.add(t)}return t}},S=function(e){if("string"==typeof e)return e;try{return e instanceof Error?(JSON.stringify(e,G(),4)||"undefined").replace(/"/gim,""):JSON.stringify(e,G(),4)||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},J=function(e){if("string"==typeof e)return e;try{return JSON.stringify(e,G())||"undefined"}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}},$=(Y.prototype.sourceURL=function(){return this.data.responseURL},Y.prototype.status=function(){return Number(this.data.status)},Y.prototype.headers=function(){var e=this.data.getAllResponseHeaders().split("\n"),n={};return e.forEach(function(e){var t;e&&(t=(e=e.split(": "))[0],e=e[1].trim(),n[t]=e)}),n},Y),Q=(K.prototype.sourceURL=function(){return this.data.url},K.prototype.status=function(){return Number(this.data.status)},K.prototype.headers=function(){var n={};return this.data.headers.forEach(function(e,t){n[t]=e}),n},K);function K(e,t){this.type="fetch",this.data=e||{},this.data.response=t}function Y(e){this.type="xhr",this.data=e}(n=R=R||{}).INFO_ALL="-1",n.API_RESPONSE="1",n.INFO="2",n.ERROR="4",n.PROMISE_ERROR="8",n.AJAX_ERROR="16",n.SCRIPT_ERROR="32",n.IMAGE_ERROR="64",n.CSS_ERROR="128",n.CONSOLE_ERROR="256",n.MEDIA_ERROR="512",n.RET_ERROR="1024",n.REPORT="2048",n.PV="4096",n.EVENT="8192",n.PAGE_NOT_FOUND_ERROR="16384",n.WEBSOCKET_ERROR="32768",(n=O=O||{}).LOG="log",n.SPEED="speed",n.PERFORMANCE="performance",n.OFFLINE="offline",n.WHITE_LIST="whiteList",n.VITALS="vitals",n.PV="pv",n.CUSTOM_PV="customPV",n.EVENT="event",n.CUSTOM="custom",n.SDK_ERROR="sdkError",n.SET_DATA="setData",(n=f=f||{}).production="production",n.gray="gray",n.pre="pre",n.daily="daily",n.local="local",n.test="test",n.others="others";function z(n,o){var i,r=[],s=n.config;return n.lifeCycle.on("destroy",function(){r.length=0}),function(e,t){if(Array.isArray(e)?r=r.concat(e):r.push(e),o&&r.length>=o||n.sendNow&&0<r.length)return r=ce(r),t(r.splice(0,r.length)),void(i&&clearTimeout(i));i&&clearTimeout(i),i=setTimeout(function(){i=null,0<(r=ce(r)).length&&t(r.splice(0,r.length))},s.delay)}}function Z(e,t){return Array.isArray(e)?t(e.map(function(e){return E(E({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(S).join(" ")})})):t([E(E({},e),{msg:"string"==typeof e.msg?e.msg:S(e.msg)})])}function ee(i){return function(e,t){i.lifeCycle.emit("modifyRequest",e);var n=i.config.modifyRequest;if("function"==typeof n)try{var o=n(e);"object"==typeof o&&"url"in o&&(e=o)}catch(e){console.error(e)}t(e)}}function te(o){return function(e,t){o.lifeCycle.emit("afterRequest",e);var n=o.config.afterRequest;"function"==typeof n&&!1===n(e)||t(e)}}function w(n){if(n&&n.reduce&&n.length)return 1===n.length?function(e,t){n[0](e,t||de)}:n.reduce(function(n,o){return function(e,t){return void 0===t&&(t=de),n(e,function(e){return null==o?void 0:o(e,t)})}});throw new TypeError("createPipeline need at least one function param")}function ne(t,n){Object.getOwnPropertyNames(t).forEach(function(e){"function"==typeof t[e]&&"constructor"!==e&&(n?n[e]="sendPipeline"===e?function(){return function(){}}:function(){}:t[e]=function(){})})}function oe(){return void 0!==window.performance&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function ie(t,n){function o(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(t(e),n&&(removeEventListener("visibilitychange",o,!0),removeEventListener("pagehide",o,!0)))}addEventListener("visibilitychange",o,!0),addEventListener("pagehide",o,!0)}function re(t){var n,o;r.find(function(e){return e.name===t.name})||(r.push(t),ye||!window.XMLHttpRequest)||(ye=!0,n=window.XMLHttpRequest.prototype.send,o=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(){if(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1],this.aegisXhrStartTime=Date.now(),!this.sendByAegis)for(var e=0;e<r.length;e++){var t=r[e];try{"function"==typeof t.open&&t.open(this)}catch(e){}}return o.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<r.length;e++){var t=r[e];try{"function"==typeof t.send&&t.send(this,arguments[0])}catch(e){}}return n.apply(this,arguments)})}function se(t){var e=r.findIndex(function(e){return e.name===t.name});-1!==e&&r.splice(e,1)}var o,ae,ce=function(e){return e.filter(function(n,o){return"static"!==n.type||!e.find(function(e,t){return n.url===e.url&&200===n.status&&o<t})})},ue=function(e){e.level===R.INFO_ALL&&(e.level=R.INFO)},le=function(e){return(Array.isArray(e)?e:[e]).map(function(n){return Object.getOwnPropertyNames(n).reduce(function(e,t){return"ctx"!==t&&(e[t]=n[t]),e},{level:R.INFO,msg:""})})},fe=function(o){return function(e){return o.sendPipeline([function(e,n){return n({url:o.config.url||"",data:H(le(e)),method:"post",contentType:"application/json",type:O.LOG,log:e,requestConfig:{timeout:5e3},success:function(){var t=o.config.onReport;"function"==typeof t&&e.forEach(function(e){t(e)}),"function"==typeof n&&n([])},fail:function(e){"403 forbidden"===e&&o.destroy()}})}],O.LOG)(e)}},de=function(){},n=(Object.defineProperty(b.prototype,"__version__",{get:function(){return console.warn("__version__ has discard, please use version"),"1.37.2"},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"LogType",{get:function(){return console.warn("LogType has discard, please use logType"),R},enumerable:!1,configurable:!0}),b.prototype.init=function(e){this.setConfig(e);for(var t=0;t<b.installedPlugins.length;t++)try{b.installedPlugins[t].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},b.prototype.setConfig=function(e){Object.assign(this.config,e);var e=this.config,t=e.id,n=e.uin,o=e.version,i=e.ext1,r=e.ext2,s=e.ext3,a=e.aid,c=e.env,u=void 0===c?"production":c,c=e.pageUrl,e=this.bean.id!==t||this.bean.uin!==n||this.bean.aid!==a;return this.bean.id=t||"",this.bean.uin=n||"",this.bean.version=o||"1.37.2",this.bean.aid=a||"",this.bean.env=function(){switch(u){case f.production:case f.gray:case f.pre:case f.daily:case f.local:case f.test:case f.others:return 1;default:return}}()?u:f.others,c&&this.extendBean("from",encodeURIComponent(c)),i&&this.extendBean("ext1",encodeURIComponent(i)),r&&this.extendBean("ext2",encodeURIComponent(r)),s&&this.extendBean("ext3",encodeURIComponent(s)),e&&this.lifeCycle.emit("onConfigChange",this.config),this.config},b.use=function(e){-1===b.installedPlugins.indexOf(e)&&e.aegisPlugin&&b.installedPlugins.push(e)},b.unuse=function(e){e=b.installedPlugins.indexOf(e);-1!==e&&b.installedPlugins.splice(e,1)},b.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:R.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0]),{level:R.INFO}),this.normalLogPipeline(n)},b.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:R.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0]),{level:R.INFO_ALL}),this.normalLogPipeline(n)},b.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:R.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0])),this.normalLogPipeline(n)},b.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:R.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0]),{level:R.ERROR}),this.normalLogPipeline(n)},b.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},b.prototype.reportPv=function(n){var o,i=this;n&&(console.warn("reportPv is deprecated, please use reportEvent"),o=""+Object.getOwnPropertyNames(this.bean).filter(function(e){return"id"!==e}).map(function(e){return e+"="+i.bean[e]}).join("&"),this.sendPipeline([function(e,t){t({url:i.config.url+"/"+n+"?"+o,addBean:!1,type:O.CUSTOM_PV,fail:function(e){"403 forbidden"===e&&i.destroy()}})}],O.CUSTOM_PV)(null))},b.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},b.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},b.prototype.reportT=function(e){var t=e.name,n=e.duration,o=e.ext1,o=void 0===o?"":o,i=e.ext2,i=void 0===i?"":i,r=e.ext3,r=void 0===r?"":r,e=e.from;if("string"==typeof t&&"number"==typeof n&&"string"==typeof o&&"string"==typeof i&&"string"==typeof r){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,o,i,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},b.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},b.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},b.prototype.submitCustomTime=function(e,t,n,o,i,r){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:o||this.config.ext2,ext3:i||this.config.ext3,from:r||void 0})},b.prototype.extendBean=function(e,t){this.bean[e]=t},b.prototype.sendPipeline=function(e,t){var n,r,s,a=this;return w(l([function(e,t){if("number"!=typeof n.config.random&&(console.warn("random must in [0, 1], default is 1."),n.config.random=1),!n.isHidden||!n.isGetSample)if(n.isGetSample)n.isHidden||t(e);else{if(n.isGetSample=!0,Math.random()<n.config.random)return n.isHidden=!1,t(e);n.isHidden=!0}},(s=t,function(e,t){var n=Array.isArray(e),o=n?e:[e],i=(r.lifeCycle.emit("beforeRequest",e),r.config.beforeRequest);(o="function"==typeof i?o.map(function(t){try{var e=i({logs:t,logType:s});return(null==e?void 0:e.logType)===s&&null!=e&&e.logs?e.logs:!1!==e&&t}catch(e){return t}}).filter(function(e){return!1!==e}):o).length&&(o=function(e,t){if(!Array.isArray(e)||e.length<=1)return e;var n=[],o=[];return!(o="string"==typeof t?[t]:t)||o.length<=0||(o.forEach(function(t){e.forEach(function(e){null!=e&&e[t]&&n.push(t)})}),0<n.length&&(e=e.map(function(e){var t={};return n.forEach(function(e){t[e]=""}),E(E({},t),e)}))),e}(o,["ext1","ext2","ext3","level","trace","tag","seq"]),t(n?o:o[0]))})],e,[ee(r=n=this),function(o,i){a.request(o,function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];a.failRequestCount=0,i({isErr:!1,result:t,logType:null==o?void 0:o.type,logs:null==o?void 0:o.log}),null!=(e=null==o?void 0:o.success)&&e.call.apply(e,l([o],t))},function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];10<=++a.failRequestCount&&a.destroy(),i({isErr:!0,result:t,logType:null==o?void 0:o.type,logs:null==o?void 0:o.log}),null!=(e=null==o?void 0:o.fail)&&e.call.apply(e,l([o],t))})},te(this)]))},b.prototype.send=function(e,i,r){var t=this;return w([ee(this),function(n,o){t.request(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o({isErr:!1,result:e,logType:n.type,logs:n.log}),null!=i&&i.apply(void 0,e)},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o({isErr:!0,result:e,logType:n.type,logs:n.log}),null!=r&&r.apply(void 0,e)})},te(this)])(e)},b.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},b.prototype.sendSDKError=function(e){var n=this;this.sendPipeline([function(e,t){t({url:n.config.url+"?id=1085&msg[0]="+encodeURIComponent(S(e))+"&level[0]=2&from="+n.config.id+"&count=1&version="+n.config.id+"(1.37.2)",addBean:!1,method:"get",type:O.SDK_ERROR,log:e})}],O.SDK_ERROR)(e)},b.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,o=b.instances.indexOf(this);-1!==o&&b.instances.splice(o,1);for(var i=b.installedPlugins.length-1;0<=i;i--)try{b.installedPlugins[i].unpatch(this)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach(function(e){n[e].writable&&(t[e]=null)}),Object.setPrototypeOf(this,null);else{for(var r=this;r.constructor!==Object&&ne(r,this),r=Object.getPrototypeOf(r););0===b.instances.length&&(o=Object.getPrototypeOf(this).constructor,ne(o),ne(b))}},b.version="1.37.2",b.instances=[],b.logType=R,b.environment=f,b.installedPlugins=[],b),i=(s.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},s.prototype.unpatch=function(e){e=this.instances.indexOf(e);-1!==e&&(this.instances.splice(e,1),0===this.instances.length&&this.uninstall())},s.prototype.countInstance=function(){return this.instances.length},s.prototype.uninstall=function(){var e;null!=(e=null==(e=this.option)?void 0:e.destroy)&&e.apply(this)},s.prototype.walk=function(n){var o=this;this.instances.forEach(function(){}