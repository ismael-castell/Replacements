(this["webpackJsonpcs-chat"]=this["webpackJsonpcs-chat"]||[]).push([[0],{103:function(e,t,n){e.exports={root:"QueueMessage_root__2C4_i",wrapper:"QueueMessage_wrapper__3Ceoh",loading:"QueueMessage_loading__1iIp1",onqueue:"QueueMessage_onqueue__2AaAx",cancel:"QueueMessage_cancel__17jZ8",joiner:"QueueMessage_joiner__lqO_V",joinerbtn:"QueueMessage_joinerbtn__IAZGc"}},113:function(e,t,n){e.exports={root:"QueueErrorMessage_root__RPBuR",inner:"QueueErrorMessage_inner__1fOBW",disabledInner:"QueueErrorMessage_disabledInner__1d8kZ",title:"QueueErrorMessage_title__21g24",option:"QueueErrorMessage_option__1nm0r",icon:"QueueErrorMessage_icon__1Af8A",disabledOption:"QueueErrorMessage_disabledOption__3l1CK"}},1138:function(e,t,n){var a={"./ar.png":559,"./br.png":560,"./cl.png":561,"./co.png":562,"./default.png":563,"./es.png":564,"./fr.png":565,"./id.png":566,"./in.png":567,"./mx.png":568,"./my.png":569,"./ph.png":570,"./pl.png":571,"./sg.png":572,"./th.png":573,"./tw.png":574,"./vn.png":575};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id=1138},1139:function(e,t,n){e.exports=n.p+"static/media/avatar_ar_l.154dfed2.png"},1140:function(e,t,n){e.exports=n.p+"static/media/avatar_ar_s.2f6c0c04.png"},1141:function(e,t,n){e.exports=n.p+"static/media/avatar_bot_l.5656041c.png"},1142:function(e,t,n){e.exports=n.p+"static/media/avatar_bot_s.64a0ed6e.png"},1143:function(e,t,n){e.exports=n.p+"static/media/avatar_br_l.f06d39ce.png"},1144:function(e,t,n){e.exports=n.p+"static/media/avatar_br_s.488fb844.png"},1145:function(e,t,n){e.exports=n.p+"static/media/avatar_cl_l.154dfed2.png"},1146:function(e,t,n){e.exports=n.p+"static/media/avatar_cl_s.2f6c0c04.png"},1147:function(e,t,n){e.exports=n.p+"static/media/avatar_co_l.154dfed2.png"},1148:function(e,t,n){e.exports=n.p+"static/media/avatar_co_s.2f6c0c04.png"},1149:function(e,t,n){e.exports=n.p+"static/media/avatar_default_l.e48502dd.png"},1150:function(e,t,n){e.exports=n.p+"static/media/avatar_es_l.154dfed2.png"},1151:function(e,t,n){e.exports=n.p+"static/media/avatar_es_s.2f6c0c04.png"},1152:function(e,t,n){e.exports=n.p+"static/media/avatar_fr_l.154dfed2.png"},1153:function(e,t,n){e.exports=n.p+"static/media/avatar_fr_s.2f6c0c04.png"},1154:function(e,t,n){e.exports=n.p+"static/media/avatar_id_l.68104cd7.png"},1155:function(e,t,n){e.exports=n.p+"static/media/avatar_id_s.6c434a58.png"},1156:function(e,t,n){e.exports=n.p+"static/media/avatar_in_l.154dfed2.png"},1157:function(e,t,n){e.exports=n.p+"static/media/avatar_in_s.2f6c0c04.png"},1158:function(e,t,n){e.exports=n.p+"static/media/avatar_mx_l.bde58785.png"},1159:function(e,t,n){e.exports=n.p+"static/media/avatar_mx_s.67fde691.png"},1160:function(e,t,n){e.exports=n.p+"static/media/avatar_my_l.df21319b.png"},1161:function(e,t,n){e.exports=n.p+"static/media/avatar_my_s.19f94f06.png"},1162:function(e,t,n){e.exports=n.p+"static/media/avatar_ph_l.a2050532.png"},1163:function(e,t,n){e.exports=n.p+"static/media/avatar_ph_s.d2e3d4fe.png"},1164:function(e,t,n){e.exports=n.p+"static/media/avatar_pl_l.154dfed2.png"},1165:function(e,t,n){e.exports=n.p+"static/media/avatar_pl_s.2f6c0c04.png"},1166:function(e,t,n){e.exports=n.p+"static/media/avatar_sg_l.154dfed2.png"},1167:function(e,t,n){e.exports=n.p+"static/media/avatar_sg_s.2f6c0c04.png"},1168:function(e,t,n){e.exports=n.p+"static/media/avatar_th_l.ba77489e.png"},1169:function(e,t,n){e.exports=n.p+"static/media/avatar_th_s.9d1abed4.png"},1170:function(e,t,n){e.exports=n.p+"static/media/avatar_tw_l.978b7fb0.png"},1171:function(e,t,n){e.exports=n.p+"static/media/avatar_tw_s.d4a65acd.png"},1172:function(e,t,n){e.exports=n.p+"static/media/avatar_vn_l.ba77489e.png"},1173:function(e,t,n){e.exports=n.p+"static/media/avatar_vn_s.9d1abed4.png"},1174:function(e,t,n){e.exports=n.p+"static/media/default.aa959852.png"},1175:function(e,t,n){e.exports=n.p+"static/media/emoji_average.b6e12ac6.png"},1176:function(e,t,n){e.exports=n.p+"static/media/emoji_bad.d0176d1e.png"},1177:function(e,t,n){e.exports=n.p+"static/media/emoji_good.88122ccc.png"},1178:function(e,t,n){e.exports=n.p+"static/media/icon_close_big.f250707e.png"},1179:function(e,t,n){e.exports=n.p+"static/media/icon_drag.e9458a4a.png"},1180:function(e,t,n){e.exports=n.p+"static/media/icon_error.8be33342.png"},1181:function(e,t,n){e.exports=n.p+"static/media/icon_loading_s.365c3786.png"},1182:function(e,t,n){e.exports=n.p+"static/media/img_500.8befbc1e.png"},1183:function(e,t,n){e.exports=n.p+"static/media/img_loading.7f1fff8f.png"},1184:function(e,t,n){e.exports=n.p+"static/media/img_noagnet.f31a7cc0.png"},1185:function(e,t,n){e.exports=n.p+"static/media/loading_l.459a98b5.png"},1186:function(e,t,n){e.exports=n.p+"static/media/loading_ss.b6a09b5e.png"},1187:function(e,t,n){e.exports=n.p+"static/media/avatar_l.70882687.png"},1188:function(e,t,n){e.exports=n.p+"static/media/error_500.4e869fd8.png"},1189:function(e,t,n){e.exports=n.p+"static/media/video.fe1d260f.png"},1249:function(e,t){},125:function(e,t,n){e.exports={root:"LiveAgentMessage_root__-rbXY",inner:"LiveAgentMessage_inner__1chxS",disabledInner:"LiveAgentMessage_disabledInner__1f7kx",option:"LiveAgentMessage_option__3E-mj",agent:"LiveAgentMessage_agent__Fklky",agentIcon:"LiveAgentMessage_agentIcon__23szQ",agentText:"LiveAgentMessage_agentText__VLoNf",disabledOption:"LiveAgentMessage_disabledOption__k5qjX"}},1251:function(e,t){},126:function(e,t,n){e.exports={root:"AgentJoinedMessage_root__1jNC5",placeholder:"AgentJoinedMessage_placeholder__3gXkI",card:"AgentJoinedMessage_card__2PEvq",avatarWrapper:"AgentJoinedMessage_avatarWrapper__3-DJS",avatar:"AgentJoinedMessage_avatar__31NcX",name:"AgentJoinedMessage_name__2itvN",agent:"AgentJoinedMessage_agent__2l-00"}},1261:function(e,t){},1263:function(e,t){},1290:function(e,t){},1291:function(e,t){},1296:function(e,t){},1298:function(e,t){},1322:function(e,t){},1343:function(e,t,n){},1344:function(e,t,n){},1346:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"socket",(function(){return tr})),n.d(a,"produceSocketCmd",(function(){return Jr})),n.d(a,"questionTypeListRequest",(function(){return Yr})),n.d(a,"closeSession",(function(){return Xr})),n.d(a,"sendSocketACK",(function(){return Zr})),n.d(a,"sendMessage",(function(){return eo})),n.d(a,"sendBotMessage",(function(){return to})),n.d(a,"sendSystemErrorMessage",(function(){return no})),n.d(a,"sendImageMessage",(function(){return ao})),n.d(a,"sendImages",(function(){return ro})),n.d(a,"resendMessage",(function(){return oo})),n.d(a,"resendImageMessage",(function(){return io})),n.d(a,"fetchPrevMessage",(function(){return Or})),n.d(a,"updateSession",(function(){return Ir})),n.d(a,"updateAuthInfo",(function(){return wr})),n.d(a,"receiveSocketMessage",(function(){return Lr})),n.d(a,"receiveMessage",(function(){return kr})),n.d(a,"receiveTextMessage",(function(){return Mr})),n.d(a,"receiveOptionsTextMessage",(function(){return jr})),n.d(a,"receiveImageMessage",(function(){return xr})),n.d(a,"receiveServiceOptionsMessage",(function(){return Rr})),n.d(a,"receiveQueuingMessage",(function(){return Nr})),n.d(a,"receiveWelcomeMessage",(function(){return Pr})),n.d(a,"receiveSessionExpireRemindMessage",(function(){return Ur})),n.d(a,"receiveSessionExpiredMessage",(function(){return Dr})),n.d(a,"receivePrevMessage",(function(){return Hr})),n.d(a,"receiveFeedbackMessage",(function(){return Fr})),n.d(a,"initSocket",(function(){return Vr})),n.d(a,"newSocketSession",(function(){return Qr})),n.d(a,"sendSocket",(function(){return qr})),n.d(a,"on",(function(){return Kr})),n.d(a,"error",(function(){return zr}));var r={};n.r(r),n.d(r,"updateLoginStatus",(function(){return po})),n.d(r,"updateLoginUserType",(function(){return fo})),n.d(r,"updateTransferChatStatus",(function(){return go})),n.d(r,"updateAuthInfo",(function(){return ho})),n.d(r,"updateCancelQueueConfirm",(function(){return mo})),n.d(r,"updateEnquiryTypes",(function(){return vo})),n.d(r,"_updateEnquiryTypes",(function(){return _o})),n.d(r,"updateAutoGoEnquiry",(function(){return bo})),n.d(r,"updateExternalSessionId",(function(){return Eo})),n.d(r,"updateLiveAgentEnbale",(function(){return yo})),n.d(r,"updateTocTokenStatus",(function(){return Co})),n.d(r,"setBotAvatar",(function(){return So})),n.d(r,"setLiveAgentAvatar",(function(){return Oo})),n.d(r,"updateUserId",(function(){return Ao})),n.d(r,"updateUserInfo",(function(){return Io})),n.d(r,"updateUserAllEvent",(function(){return wo})),n.d(r,"doneUserEvent",(function(){return Lo})),n.d(r,"init",(function(){return ko})),n.d(r,"getChatAccessToken",(function(){return Mo})),n.d(r,"updateTokenInStore",(function(){return jo})),n.d(r,"updateToken",(function(){return xo})),n.d(r,"updateUserFeatureToggle",(function(){return Ro})),n.d(r,"getUserAllEvents",(function(){return No})),n.d(r,"reportUserEvent",(function(){return Po})),n.d(r,"getAvatars",(function(){return Uo}));var o={};n.r(o),n.d(o,"sendMessage",(function(){return Do})),n.d(o,"resendMessage",(function(){return Bo})),n.d(o,"sendFilesAndImages",(function(){return Wo})),n.d(o,"resendImageMessage",(function(){return Ho})),n.d(o,"endConversation",(function(){return Fo}));var i={};n.r(i),n.d(i,"updateQueuePosition",(function(){return js})),n.d(i,"_addCurrentMessageTotal",(function(){return xs})),n.d(i,"addCurrentMessageTotal",(function(){return Rs})),n.d(i,"updateCurrentMessageTotal",(function(){return Ns})),n.d(i,"setAgentTyping",(function(){return Ps})),n.d(i,"insertMessageList",(function(){return Ds})),n.d(i,"clearMessageList",(function(){return Bs})),n.d(i,"updateShouldShowAgentJoined",(function(){return Ws})),n.d(i,"_setReadedMessageTotal",(function(){return Hs})),n.d(i,"setReadedMessageTotal",(function(){return Fs})),n.d(i,"setAgentJoinText",(function(){return Gs})),n.d(i,"updateMessageSeqId",(function(){return Vs})),n.d(i,"addSocketMessage",(function(){return Qs})),n.d(i,"updateFetchMessageStatus",(function(){return qs})),n.d(i,"setLastReadMessageId",(function(){return Ks})),n.d(i,"updateCurrentLiveAgentMessageId",(function(){return zs})),n.d(i,"updateCurrentEnquiryMessageId",(function(){return Js})),n.d(i,"updateMessageStopIndex",(function(){return Ys})),n.d(i,"updateChatbotMessageContent",(function(){return Xs})),n.d(i,"handleMessage",(function(){return Zs})),n.d(i,"handleConnectionClose",(function(){return $s})),n.d(i,"handleError",(function(){return ec})),n.d(i,"pushSystemMessage",(function(){return tc})),n.d(i,"pushLiveAgentMessage",(function(){return nc})),n.d(i,"pushQueueErrorMessage",(function(){return ac})),n.d(i,"pushCancelQueueMessage",(function(){return rc})),n.d(i,"pushEnquiryTypeMessage",(function(){return oc})),n.d(i,"pushCsatMessage",(function(){return ic})),n.d(i,"getPaginationHistoryMessage",(function(){return lc})),n.d(i,"pushServerErrorMessage",(function(){return Ac})),n.d(i,"pushEmergencyMessage",(function(){return Tc})),n.d(i,"pushRegisterWebformMessage",(function(){return Ic})),n.d(i,"updateMessageStatus",(function(){return xa})),n.d(i,"updateFileMessageProgress",(function(){return Ra})),n.d(i,"updateFileMessageContent",(function(){return Na})),n.d(i,"pushMessageList",(function(){return Pa})),n.d(i,"removeMessageItem",(function(){return Ua})),n.d(i,"updateMessageId",(function(){return Da})),n.d(i,"sendMessageRequest",(function(){return Ba})),n.d(i,"readLastMessage",(function(){return Wa})),n.d(i,"doWorkBeforeSendMessage",(function(){return Ha})),n.d(i,"doWorkAfterSendMessage",(function(){return Fa})),n.d(i,"sendMessage",(function(){return Ga})),n.d(i,"doWorkBeforeSendImageMessage",(function(){return Va})),n.d(i,"doWorkAfterSendImageMessage",(function(){return Qa})),n.d(i,"sendImageMessage",(function(){return qa})),n.d(i,"doWorkBeforeSendFileMessage",(function(){return Ka})),n.d(i,"doWorkAfterSendFileMessage",(function(){return za})),n.d(i,"sendFileMessage",(function(){return Ja})),n.d(i,"doWorkBeforeSendFiles",(function(){return Ya})),n.d(i,"sendFilesAndImages",(function(){return Xa})),n.d(i,"sendMessageStart",(function(){return Za})),n.d(i,"sendMessageCompleteError",(function(){return $a})),n.d(i,"resendMessage",(function(){return rr})),n.d(i,"resendImageMessage",(function(){return or})),n.d(i,"resendFileMessage",(function(){return ir})),n.d(i,"pushRatingMessage",(function(){return sr})),n.d(i,"sendSuccessHandle",(function(){return cr})),n.d(i,"sendFailHandle",(function(){return ur})),n.d(i,"sendImageSuccessHandle",(function(){return lr})),n.d(i,"sendFileSuccessHandle",(function(){return dr})),n.d(i,"sendFile",(function(){return pr})),n.d(i,"addNotSendMessage",(function(){return fr})),n.d(i,"sendOrderMessage",(function(){return gr})),n.d(i,"resendOrderMessage",(function(){return hr})),n.d(i,"doWorkBeforeSendOrderMessage",(function(){return mr})),n.d(i,"doWorkAfterSendOrderMessage",(function(){return vr})),n.d(i,"setPrevMessageTimestamp",(function(){return wc})),n.d(i,"setClientPollTimeout",(function(){return Lc})),n.d(i,"updateMessageDirection",(function(){return kc})),n.d(i,"updateMessageListUUID",(function(){return Mc})),n.d(i,"setRateMessageContent",(function(){return jc})),n.d(i,"setHasFetchedHistoryFlag",(function(){return xc})),n.d(i,"calTimestamp",(function(){return Rc}));var s={};n.r(s),n.d(s,"addFiles",(function(){return Pc})),n.d(s,"updateFiles",(function(){return Uc}));var c={};n.r(c),n.d(c,"updateConflicted",(function(){return vl})),n.d(c,"updateConnection",(function(){return _l})),n.d(c,"updateRestoredConnection",(function(){return bl})),n.d(c,"updateShouldMessageUnreadNumberHandledByHistoryApi",(function(){return El})),n.d(c,"updateConversationStatus",(function(){return yl})),n.d(c,"updateNoValidAgentInfo",(function(){return Cl})),n.d(c,"updateSessionKey",(function(){return Sl})),n.d(c,"updateDisableMinimizeStatus",(function(){return Ol})),n.d(c,"setNeedKeepConversation",(function(){return Al})),n.d(c,"setConversationCanRead",(function(){return Tl})),n.d(c,"setOldestMessageId",(function(){return Il})),n.d(c,"setHeartBeatInterval",(function(){return wl})),n.d(c,"setConnectType",(function(){return Ll})),n.d(c,"updateConnectCount",(function(){return kl})),n.d(c,"updateGetQueueConfigError",(function(){return Ml})),n.d(c,"setTokenIsInvalid",(function(){return jl})),n.d(c,"setOfflineFormUrl",(function(){return xl})),n.d(c,"setWebFormPlatform",(function(){return Rl})),n.d(c,"updateInhouseUserType",(function(){return Nl})),n.d(c,"updateIgnoreCCU",(function(){return Pl})),n.d(c,"updateConnectionConfigInfo",(function(){return Ul})),n.d(c,"updateQueuePositionMax",(function(){return Dl})),n.d(c,"updateAgentName",(function(){return Bl})),n.d(c,"initSocketSession",(function(){return Wl})),n.d(c,"SellerChannel",(function(){return Hl})),n.d(c,"EntryPoint",(function(){return Fl})),n.d(c,"conflictedCheck",(function(){return Ql})),n.d(c,"handleConnectionInit",(function(){return Kl})),n.d(c,"handleConnectionMessage",(function(){return zl})),n.d(c,"handleConnectionClose",(function(){return Jl})),n.d(c,"handleConnectionError",(function(){return Yl})),n.d(c,"initSDK",(function(){return Xl})),n.d(c,"reConnect",(function(){return Zl})),n.d(c,"initChatSdk",(function(){return nd})),n.d(c,"getChannelType",(function(){return ad})),n.d(c,"getEnquiryTypes",(function(){return od})),n.d(c,"handleEmergencyTemplate",(function(){return id})),n.d(c,"initSession",(function(){return sd})),n.d(c,"endConversation",(function(){return cd})),n.d(c,"initFeedBackOption",(function(){return ud})),n.d(c,"checkConflict",(function(){return ld})),n.d(c,"stopHeartBeat",(function(){return dd})),n.d(c,"emitRating",(function(){return pd})),n.d(c,"checkTokenValid",(function(){return fd})),n.d(c,"autoGoEnquiry",(function(){return gd}));var u={};n.r(u),n.d(u,"updateAccessPlatform",(function(){return bd})),n.d(u,"updateIsInputFocus",(function(){return Ed})),n.d(u,"updateIsMobileStyle",(function(){return yd})),n.d(u,"updateNetworkStatus",(function(){return Cd})),n.d(u,"updateChatWindowStatus",(function(){return Sd})),n.d(u,"updateToast",(function(){return Od})),n.d(u,"updateFeedbackOptions",(function(){return Ad})),n.d(u,"updateAccessToken",(function(){return Td})),n.d(u,"updateReportMarker",(function(){return Id})),n.d(u,"setPlatformTokenMethod",(function(){return wd})),n.d(u,"setSupportUnloginChatWithAgent",(function(){return Ld})),n.d(u,"updateShowOrderModal",(function(){return kd})),n.d(u,"updateIsSubmitRegisterWebform",(function(){return Md})),n.d(u,"updateCanClickEntry",(function(){return jd})),n.d(u,"redirectToLogin",(function(){return xd})),n.d(u,"checkAndRecoverSession",(function(){return Rd})),n.d(u,"initData",(function(){return Nd})),n.d(u,"minimizeWindow",(function(){return Pd})),n.d(u,"updateMobileConfirmModalOption",(function(){return Ud})),n.d(u,"wechatLogout",(function(){return Dd})),n.d(u,"getAccessPlatform",(function(){return Bd})),n.d(u,"checkPlatformToken",(function(){return Wd}));var l=n(10),d=n(3),p=n(1),f=n.n(p),g=n(4),h=n(0),m=n.n(h),v=n(30),_=n.n(v),b=n(6),E=n(8),y=n(5),C=n(12),S=n(13),O=n(15),A=n(60),T=n.n(A),I=n(7),w=n.n(I),L=(n(918),n(399)),k=n.n(L),M=(n(151),n(51)),j=n.n(M),x=n(2),R=n(16),N=n.n(R),P=n(112),U=n(647),D=new(n.n(U).a)({name:"csChat"}),B={en:"en","zh-Hant":"zh-Hant","zh-Hans":"zh-Hans","zh-CN":"zh-CN","ms-MY":"ms-my","th-TH":"th","vi-VN":"vi","id-ID":"id","pt-BR":"pt-BR","es-MX":"es-MX","es-CO":"es-CO","es-CL":"es-CL","es-AR":"es-AR",pl:"pl","es-ES":"es-ES",fr:"fr",in:"en"},W=function(){var e=Object(g.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getTranslationByModule(B[t],{name:"csChat",resources:[1330]});case 2:n=e.sent,F(t,n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();P.a.init({lng:"en",fallbackLng:"en",defaultNS:"common",keySeparator:!1,debug:!1,resources:{},interpolation:{prefix:"{",suffix:"}",escapeValue:!1},react:{wait:!1,bindI18n:"languageChanged loaded",bindStore:"added removed",nsMode:"default"}});var H,F=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"common";P.a.addResourceBundle(e,n,t,!0,!0),P.a.changeLanguage(e)},G=P.a,V=n(1353),Q=n(14),q=60001,K=204,z=1003,J=1004,Y=4e4,X=40006,Z=2001,$=1020,ee=1002,te=403,ne=40001,ae=409,re=1004,oe=403,ie=40001;!function(e){e.Text="TEXT",e.Image="IMG",e.File="FILE",e.System="system",e.Rating="rating",e.Csat="csat",e.ServiceOptions="ServiceOptions",e.OptionsText="optionsText",e.NoMore="noMore",e.CHAT_END="CHAT_END",e.Video="VID",e.LiveAgent="liveAgent",e.EnquiryType="EnquiryType",e.Queue="Queue",e.CancelQueue="CancelQueue",e.QueueError="QueueError",e.ServerError="ServerError",e.Emergency="Emergency",e.ScrollTip="ScrollTip",e.Order="ORDER",e.RegisterWebform="RegisterWebform",e.History="history",e.AgentJoined="AgentJoined"}(H||(H={}));var se,ce,ue,le,de,pe,fe;!function(e){e.Positive="Positive",e.Neutral="Neutral",e.Unliked="Unliked"}(se||(se={})),function(e){e.ChatRequestSuccess="ChatRequestSuccess",e.QueueUpdate="QueueUpdate",e.ChatEstablished="ChatEstablished",e.ChatMessage="ChatMessage",e.ChatEnded="ChatEnded",e.ChatRequestFail="ChatRequestFail",e.AgentDisconnect="AgentDisconnect",e.AgentTyping="AgentTyping",e.AgentNotTyping="AgentNotTyping",e.CHAT_TRANSFER="CHAT_TRANSFER"}(ce||(ce={})),function(e){e.CS_JOINED="CS_JOINED",e.QUEUING="QUEUING",e.EVENT="EVENT",e.USER_CLOSE_SESSION="USER_CLOSE_SESSION",e.CS_CLOSE_SESSION="CS_CLOSE_SESSION",e.SESSION_CLOSE_TIMEOUT="SESSION_CLOSE_TIMEOUT",e.ERROR_RESPONSE="ERROR_RESPONSE",e.AGENT_TYPING="AGENT_TYPING",e.AGENT_NOT_TYPING="AGENT_NOT_TYPING",e.CANCEL_QUEUE="CANCEL_QUEUE",e.SESSION_CLOSED="SESSION_CLOSED"}(ue||(ue={})),function(e){e[e.User=1]="User",e[e.Chatbot=2]="Chatbot",e[e.Agent=3]="Agent",e[e.TxBot=4]="TxBot"}(le||(le={})),function(e){e[e.Chatbot=1]="Chatbot",e[e.SellerCenter=2]="SellerCenter",e[e.Seh=3]="Seh",e[e.Gudangku=4]="Gudangku"}(de||(de={})),function(e){e.SellerCenter="sc",e.Seh="seh",e.Gudangku="gudangku"}(pe||(pe={})),function(e){e.Uninitialized="Uninitialized",e.AgentQueue="AgentQueue",e.End="End",e.Chatting="Chatting",e.NoAgent="NoAgent",e.QueueError="QueueError",e.Error="Error",e.ContactingError="ContactingError",e.SystemError="SystemError",e.Transfering="Transfering"}(fe||(fe={}));var ge,he,me,ve,_e,be,Ee,ye,Ce,Se=[fe.QueueError,fe.SystemError,fe.Error,fe.End];!function(e){e[e.inhouse=1]="inhouse",e[e.salesforce=2]="salesforce"}(ge||(ge={})),function(e){e[e.MainAccount=1]="MainAccount",e[e.SubAccount=2]="SubAccount"}(he||(he={})),function(e){e[e.HistoryMessage=1]="HistoryMessage"}(me||(me={})),function(e){e[e.buyer=0]="buyer",e[e.seller=1]="seller"}(ve||(ve={})),function(e){e.Unlogined="cschat_unlogined_greeting_message"}(_e||(_e={})),function(e){e.ContactDetail="cschat_contact_details",e.Name="cschat_name",e.Phone="cschat_number",e.PhoneNumber="cschat_phone_number",e.Email="cschat_email",e.EmailAddress="cschat_email_address",e.StartChat="cschat_start_chat",e.WebformRequired="cschat_webform_required",e.InputValidName="cschat_input_invalid_name_msg",e.InputValidPhone="cschat_input_invalid_phone_msg",e.InputValidEmail="cschat_input_invalid_email_msg",e.ThanksForFillingWebform="cschat_thanks_for_filling_webform",e.UnloginTokenFrequentRequest="cschat_unlogin_frequent_request"}(be||(be={}));var Oe,Ae=["image/png","image/jpeg","image/jpg"],Te=["csv","xlsx","xlsm","xls","pdf","docx","doc","heic"],Ie=["png","jpeg","jpg"],we=["mp4","mov","m4v","3gp","f4v"],Le=we.map((function(e){return".".concat(e)})),ke=["text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel.sheet.macroenabled.12","application/pdf","application/msword","application/vnd","application/vnd.openxmlformats-officedocument.wordprocessingml.document",".doc",".docx",".xls",".xlsm",".csv","image/heic"],Me=/ipad|iphone/.test(navigator.userAgent.toLocaleLowerCase())&&!window.MSStream,je=/android/.test(navigator.userAgent.toLocaleLowerCase()),xe=/android|iphone/.test(navigator.userAgent.toLocaleLowerCase()),Re=Me||je;window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);!function(e){e[e.Default=0]="Default",e[e.SellerCenter=1]="SellerCenter",e[e.EduHub=2]="EduHub",e[e.ShopeeCn=3]="ShopeeCn",e[e.WeChat=4]="WeChat",e[e.Cnsc=5]="Cnsc",e[e.Gudangku=6]="Gudangku",e[e.ShopeeCnEdu=7]="ShopeeCnEdu",e[e.SPX=8]="SPX",e[e.SPXHelp=9]="SPXHelp"}(Oe||(Oe={}));var Ne,Pe,Ue=[Oe.Gudangku],De=["/v1/gray_config","/api/selleraccount/user/redirect4verification/","/v1/nologin_get_access_token"],Be=[Oe.ShopeeCn,Oe.WeChat,Oe.Cnsc,Oe.ShopeeCnEdu];!function(e){e[e.SubAccount=1]="SubAccount"}(Ne||(Ne={})),function(e){e[e.Anonymous=100]="Anonymous",e[e.CBSeller=101]="CBSeller",e[e.WechatSeller=102]="WechatSeller",e[e.LocalSeller=103]="LocalSeller",e[e.WXWorkSeller=105]="WXWorkSeller",e[e.Buyer=104]="Buyer",e[e.Bot=200]="Bot",e[e.CBCS=201]="CBCS",e[e.LocalCS=202]="LocalCS"}(Pe||(Pe={}));var We,He,Fe,Ge,Ve,Qe,qe,Ke={"Shipping & Delivery":"Logistics","Web & App Performance":"General Feedback / Technical Issues","Account & Security":"Account & Fraud",Payments:"Payments","Returns & Refunds":"Return / Refund & Order Cancellation","Product Content & Legal":"Content / Legal","Vouchers & Promotions":"Marketing & BD","General Enquiries":"General Enquiries","Payments & Escrow":"Payments","Campaigns & Seller Related":"Marketing & BD","Campaigns & Seller Relate":"Marketing & BD"},ze=(Ee={},Object(x.a)(Ee,Oe.SellerCenter,"SC"),Object(x.a)(Ee,Oe.EduHub,"SEH"),Object(x.a)(Ee,Oe.ShopeeCn,"SPCN"),Object(x.a)(Ee,Oe.WeChat,"WX"),Object(x.a)(Ee,Oe.Cnsc,"CNSC"),Ee),Je=(ye={},Object(x.a)(ye,Oe.Default,0),Object(x.a)(ye,Oe.SellerCenter,1),Object(x.a)(ye,Oe.EduHub,2),Object(x.a)(ye,Oe.ShopeeCn,3),Object(x.a)(ye,Oe.WeChat,4),Object(x.a)(ye,Oe.Cnsc,5),Object(x.a)(ye,Oe.Gudangku,6),Object(x.a)(ye,Oe.ShopeeCnEdu,7),Object(x.a)(ye,Oe.SPX,8),Object(x.a)(ye,Oe.SPXHelp,9),ye);!function(e){e.ChatAccessToken="chat_access_token",e.UnloginChatAccessToken="unlogin_chat_access_token",e.LastConversationReadMessageId="lastConversationReadMessageId",e.UnloginLastConversationReadMessageId="unloginLastConversationReadMessageId",e.UUID="uuid",e.SessionKey="session_key",e.UnloginSessionKey="unlogin_session_key",e.ShopeeChatKey="shopeeChatKey",e.UnloginShopeeKey="unloginShopeeChatKey",e.Connection="connection",e.UnloginConnection="unloginConnection"}(We||(We={})),function(e){e[e.ALL=0]="ALL",e[e.AppUnpaid=1]="AppUnpaid",e[e.Unpaid=6]="Unpaid",e[e.ToShip=7]="ToShip",e[e.ToReceive=8]="ToReceive",e[e.Complete=9]="Complete",e[e.Cancelled=10]="Cancelled",e[e.Refund=11]="Refund"}(He||(He={})),function(e){e[e.isOk=1]="isOk",e[e.isNotOk=2]="isNotOk"}(Fe||(Fe={})),function(e){e[e.Cnsc=1]="Cnsc"}(Ge||(Ge={})),function(e){e.ID="id",e.SG="sg",e.MY="my",e.VN="vn",e.TH="th",e.BR="br",e.PH="ph",e.TW="tw",e.MX="mx",e.CO="co",e.CL="cl",e.AR="ar",e.PL="pl",e.FR="fr",e.ES="es",e.IN="in"}(Ve||(Ve={})),function(e){e.id="Penjual (Merchant)",e.sg="Seller",e.my="Seller",e.vn="Ng%C6%B0%E1%BB%9Di%20b%C3%A1n",e.th="%E0%B8%9C%E0%B8%B9%E0%B9%89%E0%B8%82%E0%B8%B2%E0%B8%A2",e.br="Vendedor",e.ph="Seller",e.tw="%E8%B3%A3%E5%AE%B6",e.mx="Vendedor",e.co="Vendedor",e.cl="Vendedor",e.pl="Sprzedawca",e.fr="Vendeur",e.es="Vendedor",e.in="Seller",e.ar="Vendedor"}(Qe||(Qe={})),function(e){e.Live="live",e.Test="test",e.Uat="uat",e.Staging="staging"}(qe||(qe={}));var Ye=(Ce={},Object(x.a)(Ce,Oe.SellerCenter,"sellerCenter"),Object(x.a)(Ce,Oe.EduHub,"sellerEducationHub"),Object(x.a)(Ce,Oe.Cnsc,"sellerCenterCN"),Object(x.a)(Ce,Oe.ShopeeCnEdu,"sellerEducationHubCN"),Ce),Xe=n(136);function Ze(){return(Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function $e(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var et=m.a.createElement("path",{d:"M983.8 312.7C873.7 52.1 573.3-69.9 312.8 40.2 123.6 120.4.6 305.8.4 511.2.1 794.1 229.1 1023.7 512 1024c68.5.2 136.3-13.5 199.3-40.3 260.6-110.1 382.6-410.5 272.5-671zM726.6 681.4c12.5 12.6 12.5 32.8 0 45.3-6 6-14.1 9.4-22.6 9.4-8.5 0-16.6-3.4-22.6-9.4L512 557.3 342.6 726.7c-6 6-14.1 9.4-22.6 9.4-8.5 0-16.5-3.4-22.5-9.4-12.5-12.5-12.5-32.8 0-45.3L466.8 512 297.4 342.7c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L512 466.7l169.5-169.4c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3L557.3 512l169.3 169.4z"}),tt=function(e){var t=e.svgRef,n=e.title,a=$e(e,["svgRef","title"]);return m.a.createElement("svg",Ze({fill:"#FF4742 ",viewBox:"0 0 1024 1024",ref:t},a),n?m.a.createElement("title",null,n):null,et)},nt=m.a.forwardRef((function(e,t){return m.a.createElement(tt,Ze({svgRef:t},e))})),at=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).closeTimer=void 0,a.closeTimer=null,a.close=a.close.bind(Object(y.a)(a)),a.clearCloseTimer=a.clearCloseTimer.bind(Object(y.a)(a)),a.startCloseTimer=a.startCloseTimer.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){this.startCloseTimer()}},{key:"componentWillUnmount",value:function(){this.clearCloseTimer()}},{key:"close",value:function(e){e&&e.stopPropagation(),this.clearCloseTimer();var t=this.props.onClose;t&&t()}},{key:"startCloseTimer",value:function(){var e=this;this.props.duration&&(this.closeTimer=setTimeout((function(){e.close()}),1e3*this.props.duration))}},{key:"clearCloseTimer",value:function(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}},{key:"restartCloseTimer",value:function(){this.clearCloseTimer(),this.startCloseTimer()}},{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,a=t.className,r=t.style,o=t.children,i="".concat(n,"-notice"),s=Object.keys(this.props).reduce((function(t,n){return"data-"!==n.substr(0,5)&&"aria-"!==n.substr(0,5)&&"role"!==n||(t[n]=e.props[n]),t}),{});return m.a.createElement("div",Object.assign({className:w()(i,a),style:r,onMouseEnter:this.clearCloseTimer,onMouseLeave:this.startCloseTimer},s),m.a.createElement(nt,null),m.a.createElement("div",{className:"".concat(i,"-content")},o))}}]),n}(h.Component);at.defaultProps={onClose:function(){},duration:3,style:{}};var rt=n(1357),ot=n(1359),it=(n(923),0),st=Date.now();var ct=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).state={notices:[]},a}return Object(E.a)(n,[{key:"add",value:function(e){e.key=e.key||function(){var e=it;return it+=1,"shopeeNotification_".concat(st,"_").concat(e)}();var t=e.key,n=this.props.maxCount,a=void 0===n?2:n;this.setState((function(n){var r=n.notices,o=r.map((function(e){return e.notice.key})).indexOf(t),i=r.concat();return-1!==o?i.splice(o,1,{notice:e}):(a&&r.length>=a&&i.shift(),i.push({notice:e})),{notices:i}}))}},{key:"remove",value:function(e){this.setState((function(t){return{notices:t.notices.filter((function(t){return t.notice.key!==e}))}}))}},{key:"render",value:function(){var e=this,t=this.state.notices,n=this.props,a=n.prefixCls,r=n.className,o=n.style,i=t.map((function(t){var n=t.notice,r=n.key,o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 1===t.length?t[0]:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];for(var r=0;r<t.length;r++)t[r]&&t[r].apply&&t[r].apply(this,n)}}(e.remove.bind(e,n.key),n.onClose),i=Object(d.a)(Object(d.a)(Object(d.a)({prefixCls:a},n),n.props),{},{key:r,onClose:o,onClick:n.onClick,children:n.content});return m.a.createElement(rt.a,{key:r,timeout:200,classNames:"".concat(a,"-fade"),onEnter:function(e){e.style.height=e.scrollHeight+"px"},onExit:function(e){e.parentNode&&e.parentNode.children.length>1&&(e.style.height=0,e.style.marginBottom=0)}},m.a.createElement("div",{className:"".concat(a,"-item")},m.a.createElement(at,i)))}));return m.a.createElement("div",{className:w()(a,r),style:o},m.a.createElement(ot.a,null,i))}}]),n}(h.PureComponent);ct.newInstance=void 0,ct.defaultProps={prefixCls:"cs-chat-shopee-notification",style:{},maxCount:2},ct.newInstance=function(e,t){var n=e||{},a=n.getContainer,r=Object(Xe.a)(n,["getContainer"]),o=document.createElement("div");if(o.classList.add("cs-chat-shopee-notification-root"),a){var i=a();i&&i.appendChild(o)}else document.body.appendChild(o);var s=!1;_.a.render(m.a.createElement(ct,Object.assign({},r,{ref:function(e){s||(s=!0,t({notice:function(t){e.add(t)},removeNotice:function(t){e.remove(t)},component:e,destroy:function(){_.a.unmountComponentAtNode(o),o.parentNode&&o.parentNode.removeChild(o)}}))}})),o)};var ut,lt=ct,dt=null;var pt={open:function(e){var t=e.getContainer;!function(e,t){var n=e.getContainer;dt?t(dt):lt.newInstance({getContainer:n},(function(e){dt=e,t(e)}))}({getContainer:void 0===t?ut:t},(function(t){t.notice({content:m.a.createElement("div",null,e.message)})}))},config:function(e){var t=e.getContainer;void 0!==t&&(ut=t)},destroy:function(){dt=null}},ft=Object(Q.fromJS)({shouldShowWindow:!1,networkStatus:"online",accessPlatform:Oe.Default,isMobileStyle:!1,toast:{msg:""},isInputFocus:!1,isSubmitedRegisterWebform:!1,supportUnloginChatWithAgent:!1,mobileConfirmModalOption:{isOpen:!1,title:"",content:""},feedbackOptions:{},canClickEntry:!1,showOrderModal:!1,token:"",reportMarker:"",getPlatformTokenMethod:null}),gt=n(648),ht=n(39),mt=Object(Q.fromJS)({sessionKey:"",showConflicted:!1,disableMinimize:!1,conversationStatus:fe.Uninitialized,needKeepConversation:!1,conversationCanRead:!1,oldestMessageId:"",heartBeatInterval:8e3,connection:null,restoredConnection:null,connectionConfigInfo:{queuePositionUpdateSwitchOpen:!0},queuePositionMax:0,shouldMessageUnreadNumberHandledByHistoryApi:!0,connectType:"",connectCount:0,getQuenueConfigError:!1,tokenIsInvalid:!1,offlineFormUrl:null,inhouseUserType:0,webFormPlatform:0,ignoreCCU:!0,agentName:"",noValidAgentReason:"",showLeaveMessageBtn:!0}),vt=n(287),_t=n(508),bt=window.localStorage;function Et(e,t){if(bt){var n=bt.getItem("__csChat")||"{}";(n=JSON.parse(n))[e]=t,bt.setItem("__csChat",JSON.stringify(n))}}function yt(e){var t=bt&&bt.getItem("__csChat")||"{}";return(t=JSON.parse(t))[e]}function Ct(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);return n?n[2]:""}function St(e){return window.sessionStorage?window.sessionStorage.getItem("".concat("__csChat","__").concat(e)):null}function Ot(e,t){window.sessionStorage&&window.sessionStorage.setItem("".concat("__csChat","__").concat(e),t)}var At=n(41),Tt=n.n(At);function It(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a={id:"shopee.co.id",my:"shopee.com.my",ph:"shopee.ph",tw:"shopee.tw",th:"shopee.co.th",vn:"shopee.vn",sg:"shopee.sg",cn:n?"shopee.sg":"shopee.cn",br:"shopee.com.br",mx:"shopee.com.mx",cl:"shopee.cl",co:"shopee.com.co",ar:"shopee.com.ar",pl:"shopee.pl",es:"shopee.es",fr:"shopee.fr",in:"shopee.in"};return t&&"live"!==t?t+"."+a[e]:a[e]}function wt(e){var t="shopee.cn";return e&&"live"!==e&&(t=e+"."+t),t}var Lt,kt,Mt,jt,xt,Rt,Nt,Pt=n(1356),Ut=n(205),Dt=n(649),Bt=n(650),Wt=n(28),Ht=n(289),Ft=n.n(Ht);!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(Lt||(Lt={})),function(e){e[e.IM_MSG=1e4]="IM_MSG",e[e.NEW_SESSION=2e4]="NEW_SESSION",e[e.IM_CLIENT_ACK=20001]="IM_CLIENT_ACK",e[e.QUESTION_TYPE_LIST_REQUEST=20002]="QUESTION_TYPE_LIST_REQUEST",e[e.ASSIGN_CS_STAFF_REQUEST=20003]="ASSIGN_CS_STAFF_REQUEST",e[e.IM_MSG_SYNC_REQUEST=20004]="IM_MSG_SYNC_REQUEST",e[e.CLOSE_SESSION=20005]="CLOSE_SESSION",e[e.CS_CHANGE_ONLINE_STATUS=20009]="CS_CHANGE_ONLINE_STATUS",e[e.CS_TRANSFER_SESSION_REQUEST=20010]="CS_TRANSFER_SESSION_REQUEST",e[e.NEW_SESSION_RESPONSE=3e4]="NEW_SESSION_RESPONSE",e[e.IM_MSG_SYNC_RESPONSE=30002]="IM_MSG_SYNC_RESPONSE",e[e.SERVER_CLOSE_SESSION=30005]="SERVER_CLOSE_SESSION",e[e.ERROR_RESPONSE=4e4]="ERROR_RESPONSE"}(kt||(kt={})),function(e){e[e.Normal=0]="Normal",e[e.InvalidMessage=400]="InvalidMessage",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.FrequentlyRequest01=42901]="FrequentlyRequest01",e[e.FrequentlyRequest02=42902]="FrequentlyRequest02",e[e.FrequentlyRequest03=42903]="FrequentlyRequest03",e[e.SessionEnded=410]="SessionEnded",e[e.ServerError=500]="ServerError",e[e.ServerTimeout=504]="ServerTimeout"}(Mt||(Mt={})),function(e){e[e.text=1]="text",e[e.image=2]="image",e[e.video=3]="video",e[e.serviceOptions=4]="serviceOptions",e[e.questionTypeList=5]="questionTypeList",e[e.welcome=6]="welcome",e[e.csQueuing=7]="csQueuing",e[e.csTransferring=8]="csTransferring",e[e.sessionExpireRemind=9]="sessionExpireRemind",e[e.sessionExpired=10]="sessionExpired",e[e.feedback=11]="feedback",e[e.remindSyncCase=12]="remindSyncCase",e[e.clientCloseSession=13]="clientCloseSession",e[e.optionsText=14]="optionsText",e[e.userText=15]="userText"}(jt||(jt={})),function(e){e[e.client2cs=1]="client2cs",e[e.cs2client=2]="cs2client",e[e.client2bot=3]="client2bot",e[e.bot2client=4]="bot2client",e[e.system2cs=5]="system2cs",e[e.system2client=6]="system2client"}(xt||(xt={})),function(e){e[e.Older=1]="Older",e[e.Latest=2]="Latest"}(Rt||(Rt={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.LOADING=1]="LOADING",e[e.NO_MORE=2]="NO_MORE",e[e.ERROR=3]="ERROR"}(Nt||(Nt={}));var Gt,Vt=Object(Q.fromJS)({messageList:[],messageStopIndex:0,agentTyping:!1,queuePosition:1,currentMessageTotal:0,readedMessageTotal:0,prevMessageTimestamp:0,displayQueuePosition:"#1",shouldShowAgentJoined:!1,clientPollTimeout:0,agentJoinText:"",messageDirection:Rt.Older,fetchHistoryStatus:Nt.NORMAL,lastReadMessageId:"",hasFetchedHistory:!1,videoFileMap:{},currentLiveAgentMessageId:"#",currentEnquiryMessageId:"#",messageListUUID:Object(_t.a)()}),Qt=(n(968),[]),qt=!1;function Kt(){if(qt=!1,Qt.length>0){var e=Qt;Qt=[];var t=[],n=[],a=[];e.forEach((function(e){if(e.value)switch(e.type){case"count":t.push(e.value);break;case"time":n.push(e.value);break;case"hyper":a.push(e.value)}}));var r={};if(t.length>0&&(r.count=t),n.length>0&&(r.time_costs=n),a.length>0&&(r.hyper=a),0===Object.keys(r).length)return;!function(e){var t=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),n=t.REACT_APP_SERVER_ENV,a=It(t.REACT_APP_REGION,n,!1);navigator.sendBeacon&&navigator.sendBeacon("https://chatbot.".concat(a,"/report/v1/tr"),JSON.stringify(e))}(r)}}function zt(){qt||(qt=!0,setTimeout(Kt,500))}function Jt(e){Qt.push(e),zt()}!function(e){e.Count="count",e.Time="time"}(Gt||(Gt={}));var Yt=n(651),Xt=n(400),Zt=n.n(Xt),$t=n(684),en=n(72),tn=n(1355),nn=n(1352),an="de2052245a4241cf8c2f12d8822a975c",rn="104",on=["live","staging","uat","test"],sn=null;var cn,un,ln,dn,pn,fn,gn={isSellerCenterOrSellerEdu:function(){return[Oe.SellerCenter,Oe.EduHub].includes($c())},isSellerCenter:function(){return $c()===Oe.SellerCenter},isSellerCenterOrSellerEduEndWithCN:function(){var e=window.location.host.endsWith("cn");return gn.isSellerCenterOrSellerEdu()&&e}},hn=function(e){var t=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),n=(t.REACT_APP_SERVER_ENV,t.REACT_APP_REGION),a=$c(),r=yt("chat_region")||n,o=Hc.getState().getIn(["global","supportUnloginChatWithAgent"]),i=Hc.getState().getIn(["global","token"]),s=Hc.getState().getIn(["user","isLogined"]);!function(e){var t,n=$c();Zc(n)&&/chatbot.([^.]+\.)?shopee.tw/.test(e.baseURL||"")&&(e.baseURL=null===(t=e.baseURL)||void 0===t?void 0:t.replace(/chatbot.([^.]+\.)?shopee.tw/,"chatbot.xiapi.$1shopee.cn"))}(e),yt(_n)&&!o&&(e.headers.common["Session-Key"]=yt(_n)),yt(vn)&&o&&(e.headers.common["Session-Key"]=yt(vn));var c=tu();return Zc(a)&&(e.headers.common["chat-access-token"]=yt(mn)),iu(a)&&(e.headers.common["chat-access-token"]=i),Zc(a)&&s&&(e.headers.common["user-region"]=r),e.headers.common["token-suffix"]=c,e.headers.common["shopee-region"]=n,e},mn=We.ChatAccessToken,vn=We.UnloginSessionKey,_n=We.SessionKey,bn=function(){if(un)return un;tu();var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),t=e.REACT_APP_SERVER_ENV,n=e.REACT_APP_REGION,a=$c(),r=Zc(a)?wt(t):It(n,t),o="https://chatbot.".concat(r,"/");return(un=Tt.a.create({baseURL:o,withCredentials:a!==Oe.Gudangku})).interceptors.request.use((function(e){return e.headers.common["shopee-region"]=n,e.headers.common["chat-access-token"]="",e})),un.interceptors.request.use(hn),un},En=function(){if(cn)return cn;var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),t=e.REACT_APP_SERVER_ENV,n=e.REACT_APP_REGION;tu();var a=$c(),r=yt("chat_region")||n,o=Zc(a)?wt(t):It(r,t),i=vi(),s="".concat("vn"===n?"banhang":"seller",".").concat(o),c=i?s:window.location.host,u=gn.isSellerCenterOrSellerEduEndWithCN()?"https://".concat(c,"/api/cschat/"):"https://chatbot.".concat(o,"/"),l=a!==Oe.Gudangku;return(cn=Tt.a.create({baseURL:u,withCredentials:l})).interceptors.request.use(hn),cn.interceptors.response.use((function(e){return e&&Ql(e),e&&e.data}),(function(e){if(ri("error","network error",e.response),"ECONNABORTED"!==e.code&&403!==(e.response&&e.response.status)){var t=e.config&&e.config.url?"".concat(u).concat(e.config.url):u;sn.withScope((function(n){n.setTags({api:t,type:"API Request Error"}),n.setExtras({ctx_url:window.location.href,api:t,params:e.config&&e.config.params,status:e.response&&e.response.status,errorCode:e.code,errorResponse:e.response,err:e}),sn.captureException(e)}))}return console.debug("\u8bf7\u6c42\u5931\u8d25: ".concat(e.response&&e.response.status)),Promise.reject(e)})),cn};function yn(e){return Cn.apply(this,arguments)}function Cn(){return(Cn=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",En().get("/api/v1/order_list",{params:t}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Sn(e){return On.apply(this,arguments)}function On(){return(On=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",En().get("/api/v1/return_list",{params:t}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function An(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};bn().post("/report/v1/report_log",{msg:t,values:Object(d.a)({level:e,UA:navigator.userAgent,location:window.location.href},n)}).catch((function(e){console.error("Reporter::apiLog",e)}))}!function(e){e.Success="success",e.Fail="fail",e.Sending="sending",e.Typing="typing",e.Uploading="uploading"}(ln||(ln={})),function(e){e.Agent="agent",e.Client="client",e.Bot="bot",e.Chatbot="chatbot"}(dn||(dn={})),function(e){e.Agent="agent",e.Bot="bot",e.User="user",e.System="system"}(pn||(pn={})),function(e){e.Image="IMG",e.File="FILE",e.Video="VID",e.Gallery="Gallery"}(fn||(fn={}));var Tn,In=n(91),wn=function(){if(Tn)return Tn;var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),t=e.REACT_APP_SERVER_ENV,n=e.REACT_APP_REGION,a=$c(),r=yt("chat_region")||n,o=Zc(a)?wt(t):It(r,t),i=vi(),s="".concat("vn"===n?"banhang":"seller",".").concat(o),c=i?s:window.location.host,u=a===Oe.Gudangku||Zc(a)||ou(a)?"https://chatbot.".concat(o,"/chat/v1/"):"https://".concat(c,"/api/cschat/v1"),l=a!==Oe.Gudangku;return(Tn=Tt.a.create({baseURL:u,withCredentials:l})).interceptors.request.use((function(e){var t=tu(),o=We.ChatAccessToken,i=Hc.getState().getIn(["global","accessPlatform"]),s=Hc.getState().getIn(["user","isLogined"]);if(Zc(a)&&(e.headers.common["chat-access-token"]=yt(o),s&&(e.headers.common["user-region"]=r)),e.params&&(e.params=Object(In.snakeCaseKeys)(e.params,{deep:!0})),e.data&&(e.data=Object(In.snakeCaseKeys)(e.data,{deep:!0})),ou(i)||iu(a)){var c=Hc.getState().getIn(["global","token"]);e.headers.common["chat-access-token"]=c}return e.headers.common["token-suffix"]=t,e.headers.common["shopee-region"]=n,e})),Tn.interceptors.response.use((function(e){return e&&e.data&&e.data.data&&(e.data.data=Object(In.camelCaseKeys)(e.data.data,{deep:!0})),e&&e.data}),(function(e){return ri("error","network error",e.response),console.debug("\u8bf7\u6c42\u5931\u8d25: ".concat(e.response&&e.response.status)),Promise.reject(e)})),Tn},Ln=function(){function e(){Object(b.a)(this,e),this.cache=void 0,this.cache=new Map}return Object(E.a)(e,[{key:"get",value:function(e,t){return this.cache.has(e)?this.cache.get(e):t}},{key:"set",value:function(e,t){this.cache.set(e,t)}}]),e}(),kn=new Ln,Mn=new Ln,jn=Tt.a.CancelToken,xn=jn.source();function Rn(e,t){var n=new FormData;return n.append("file",e),xn=jn.source(),Mn.set(t,xn.cancel),wn().post("/upload_file",n,{cancelToken:xn.token,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){return function(e,t){if(t.lengthComputable){var n=Math.round(100*t.loaded/t.total);Hc.dispatch(Ra(e,n))}else Hc.dispatch(Ra(e,100))}(t,e)}})}function Nn(e){return wn().post("/create_multipart_upload",e)}function Pn(e,t){var n=new FormData;return n.append("file",t),wn().post("/upload_part",n,{params:e})}function Un(e){return wn().post("/complete_multipart_upload",e)}var Dn=n(101),Bn=n.n(Dn),Wn=function(e){return new Promise((function(t){var n=window.URL.createObjectURL,a=null,r={duration:0,width:0,height:0,thumbnail:""};setTimeout((function(){t(r)}),2e3);try{a=n(e)}catch(i){return void t(r)}var o=document.createElement("video");o.setAttribute("crossOrigin","anonymous"),o.setAttribute("autoplay","autoplay"),o.setAttribute("webkit-playsinline","webkit-playsinline"),o.setAttribute("playsinline","playsinline"),o.setAttribute("x5-video-player-type","h5"),o.muted=!0,o.src=a,o.addEventListener("loadeddata",(function(){if(o){var e;if(0===o.videoWidth||0===o.videoHeight)return void t(r);var n=document.createElement("canvas"),a=o.videoWidth,i=o.videoHeight;r.width=a,r.height=i,r.duration=o.duration,n.width=a,n.height=i,null===(e=n.getContext("2d"))||void 0===e||e.drawImage(o,0,0,a,i),r.thumbnail=n.toDataURL?n.toDataURL("image/png"):"",r.thumbnail=r.thumbnail.replace(/[\r\n]/g,""),t(r),o.pause(),o.removeAttribute("src"),o.load(),o=null}})),o.addEventListener("error",(function(){t(r)}))}))},Hn=function(e){var t=Math.ceil(e),n=t/3600<10?"0"+Math.floor(t/3600):Math.floor(t/3600),a=t/60%60<10?"0"+Math.floor(t/60%60):Math.floor(t/60%60),r=t%60<10?"0"+t%60:t%60;return t=t>=3600?"".concat(n,":").concat(a,":").concat(r):"".concat(a,":").concat(r)},Fn=function(e,t){var n,a,r=Zo()?201:Hc.getState().getIn(["global","isMobileStyle"])?140:99,o=r*(16/9);return(e=e||r)>(t=t||r)?(a=r,(n=e*(r/t))>o&&(n=o)):(n=r,(a=t*(r/e))>o&&(a=o)),{width:n,height:a}},Gn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:123,n="shopee_vod_"+String(t).padStart(5,"0"),a="1234567887654321",r=Dn.AES.decrypt(e,Dn.enc.Utf8.parse(n),{iv:Dn.enc.Utf8.parse(a),mode:Dn.mode.CBC,padding:Dn.pad.Pkcs7});return r.toString(Dn.enc.Utf8)},Vn=function(){var e=$o();return e!==Ve.CO&&e!==Ve.CL},Qn=function(e){Jt({type:Gt.Count,value:{label:"cs_video_play_error"}}),ri("error","cs_video_play_error",{url:e})};function qn(e){if("string"!==typeof e)return e;return e.replace(/^(https?:)?\/\/(([^?&\/])*\.myqcloud\.com)/,"$1".concat("//vod-s3.mms.shopee.com"))}function Kn(e){return new Promise((function(t){var n=new window.FileReader;n.onload=function(){return t(n.result)},n.readAsDataURL(e)}))}var zn=function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.size<5242880)){e.next=10;break}return Hc.dispatch(xa(n,ln.Uploading)),e.next=4,Rn(t,n);case 4:return a=e.sent,r=a.data.fileUrl,o=r.split("file_key=")[1],Hc.dispatch(Na(n,{fileKey:o})),Hc.dispatch(Na(n,{isMultipartUpload:!1})),e.abrupt("return",a);case 10:return Hc.dispatch(Na(n,{isMultipartUpload:!0})),e.next=13,Jn(t,n);case 13:return i=e.sent,e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function Jn(e,t){return Yn.apply(this,arguments)}function Yn(){return(Yn=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s,c,u,l,d,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(){var e=5242880*o,i=e+5242880>t.size?t.size:e+5242880,s=t.slice(e,i);r.push(Pn({uploadId:c,fileKey:u,partNum:o+1},s)),function(e){var t=setTimeout((function(){Hc.dispatch(Ra(n,e/a*100))}),500*e);l.push(t)}(o),++o<a&&d()},a=Math.ceil(t.size/5242880),r=[],o=0,e.next=6,Nn({fileName:t.name,fileSize:t.size});case 6:if(0===(i=e.sent).code){e.next=9;break}return e.abrupt("return",i);case 9:return s=i.data,c=s.uploadId,u=s.fileKey,Hc.dispatch(xa(n,ln.Uploading)),Hc.dispatch(Na(n,{uploadId:c,fileKey:u})),l=[],d(),e.next=16,Tt.a.all(r).then(function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.data})),e.next=3,Un({uploadId:c,fileKey:u,completedParts:n});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return e})).finally((function(){l.forEach((function(e){return clearTimeout(e)})),Hc.dispatch(Ra(n,100))}));case 16:return p=e.sent,e.abrupt("return",p);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xn(e,t){var n,a=t.isMultipartUpload,r=t.uploadId,o=t.fileKey;a?(n={uploadId:r,fileKey:o},wn().post("/abort_multipart_upload",n)).then((function(e){0===e.code&&Hc.dispatch(Od({msg:G.t("cschat_cancel_upload")}))})):(!function(e){var t=Mn.get(e);"function"===typeof t&&t()}(e),Hc.dispatch(Od({msg:G.t("cschat_cancel_upload")})))}var Zn=function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o,i,s,c,u,l,d,p,g;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],a=Hc.getState().getIn(["file","currentFileLength"]),r=!1,n=t.filter((function(e){if([].concat(Object(Wt.a)(Ie),Object(Wt.a)(Te),Object(Wt.a)(we)).includes(e.name.toLocaleLowerCase().split(".").pop()))return e;r=!0})),r&&Hc.dispatch(Od({msg:G.t("cschat_file_not_supported")})),o=!1,i=!1,s=!1,c=0,u=0,l=0,n=n.filter((function(e){var t=$n(e);if(t){var n=ea(t);if(void 0!==n){if(e.size<n)return e;t===fn.File&&(i=!0),t===fn.Image&&(o=!0),t===fn.Video&&(s=!0,c+=1)}}})),o&&Hc.dispatch(Od({msg:G.t("cschat_image_exceed_size",{size:2})})),i&&Hc.dispatch(Od({msg:G.t("cschat_file_exceed_size",{size:40})})),e.next=16,ta(n);case 16:return n=(n=e.sent).filter((function(e){if(!e)return null;if(e.type===fn.Video){if(e.duration>180)return u+=1,null;if(e.duration<1&&e.duration>0)return l+=1,null}return e})),Hc.getState().getIn(["global","isMobileStyle"])?(d=na({maxSizeLen:c,maxDurationLen:u,minDurationLen:l},t.length>1),p=d.title,g=d.content,p&&g&&Hc.dispatch(Ud({isOpen:!0,title:p,content:g}))):((u>0||l>0)&&(Pi({targetType:"send_failure_duration",operation:"impression"}),Hc.dispatch(Od({msg:G.t("cschat_video_exceed_duration",{max:180,min:1})}))),s&&(Pi({targetType:"send_failure_size",operation:"impression"}),Hc.dispatch(Od({msg:G.t("cschat_video_exceed_size",{size:30})})))),n=n.filter((function(e){return e})),a+n.length>9&&(Hc.dispatch(Od({msg:G.t("cschat_file_max_number",{number:9})})),n=n.splice(0,9-a)),e.abrupt("return",n);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$n=function(e){var t=e.name.toLocaleLowerCase().split(".").pop();return Ie.includes(t)?fn.Image:Te.includes(t)?fn.File:we.includes(t)?fn.Video:void 0},ea=function(e){return e===fn.Image?2097152:e===fn.Video?31457280:e===fn.File?41943040:void 0},ta=function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3,a=[],r=0;case 3:if(!(r<t.length)){e.next=11;break}return e.next=6,Promise.all(t.slice(r,r+n).map(function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=$n(t))){e.next=11;break}if(n!==fn.Video){e.next=7;break}return e.next=5,Wn(t);case 5:return a=e.sent,e.abrupt("return",Object(d.a)({file:t,type:n},a));case 7:return e.next=9,Kn(t);case 9:return r=e.sent,e.abrupt("return",{file:t,type:n,src:r});case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:o=e.sent,a=[].concat(Object(Wt.a)(a),Object(Wt.a)(o));case 8:r+=n,e.next=3;break;case 11:return a=a.filter((function(e){return e})),console.log("file select",a),e.abrupt("return",a);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),na=function(e,t){var n="",a="",r=[];if(e.minDurationLen>0&&r.push("shorter_duration"),e.maxDurationLen>0&&r.push("longer_duration"),e.maxSizeLen>0&&r.push("exceed_size"),r.length>0){var o=G.t("cschat_general_video"),i=G.t("cschat_general_videos"),s=Object(d.a)(Object(d.a)({},e),{},{maxDuration:180,minDuration:1,maxSize:30,maxDurationVideoText:e.maxDurationLen>1?i:o,minDurationVideoText:e.minDurationLen>1?i:o,maxSizeVideoText:e.maxSizeLen>1?i:o}),c=Object.values(e).reduce((function(e,t){return e+t}));n=t?G.t("cschat.partial_video_failed_title",{total:c}):G.t("cschat.all_video_".concat(r[0]||"","_title"),s);var u=t?"partial":"all";t&&1===r.length&&1===c&&(u="all"),a=G.t("cschat.".concat(u,"_video_").concat(r.reduce((function(e,t){return"".concat(e,"_").concat(t)})),"_content"),s)}return{title:n,content:a}},aa=function(e){if(!e)return"";try{return new URL(e).searchParams.get("file_key")||""}catch(t){return""}};function ra(e){return hu().post("/v1/video_upload_report",e)}function oa(e){return hu().get("/v1/video_upload_query",{params:e})}var ia,sa=n(201),ca=n.n(sa);!function(e){e[e.Success=0]="Success",e[e.Fail=1]="Fail",e[e.Waiting=2]="Waiting",e[e.NoRecord=3]="NoRecord"}(ia||(ia={}));var ua=1,la=2,da=3,pa=4,fa=5,ga=function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c={amount:1},hu().post("/v1/video_pre_upload",c);case 2:if(a=e.sent,void 0===(r=null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.code)||0===r){e.next=6;break}throw{code:r};case 6:return o=a.data,i=o.services,s=o.vids,e.abrupt("return",Object(d.a)(Object(d.a)({},t),{},{vid:s[0],services:i}));case 8:case"end":return e.stop()}var c}),e)})));return function(t){return e.apply(this,arguments)}}(),ha=function(e){var t=e.findIndex((function(e){return"txcloud"==e.service_id}));return-1===t?[e[0],0]:[e[t],t]},ma=function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o,i,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.vid,a=t.services,r=ha(a),o=Object(l.a)(r,2),i=o[0],s=o[1],c=new ca.a([{authorization:Gn(i.token),serviceID:i.service_id,uploadDomain:Xo(i.upload_domain),domain:Xo(i.domain),vid:n,sliceSize:i.slice_size,bucket:i.bucket,country:$o().toUpperCase(),env:"live",biz:123,serviceIndex:s}]),e.next=5,c.upload({mediaFile:t.file,mediaType:sa.MediaType.video});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),va=function(){var e=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zo(18e4);case 2:throw ya({message:"fail to query",code:la});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_a=function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ra(t);case 2:if(r=e.sent,void 0===(o=null===r||void 0===r||null===(a=r.data)||void 0===a?void 0:a.code)||0===o){e.next=6;break}throw ya({message:"fail to query",code:la,errorCode:o});case 6:i=null;case 7:if(null!==i&&i!==ia.Waiting){e.next=19;break}if(n()){e.next=10;break}throw Error("invalid message");case 10:return e.next=12,oa({vid:t.vid});case 12:return c=e.sent,i=c.data.code,s=c.data,e.next=17,zo(3e3);case 17:e.next=7;break;case 19:if(i===ia.Success){e.next=21;break}throw ya({message:"fail to query",code:la});case 21:return e.abrupt("return",Object(d.a)(Object(d.a)({},s),{},{vid:t.vid}));case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ba=function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=va(),e.next=3,Promise.race([_a(t,n),a]);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ea=function(){var e=Object(g.a)(f.a.mark((function e(t,n,a,r){var o,i,s,c,u,d,p,g,h,m,v,_,b,E,y,C;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ga(t);case 3:o=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),ya({message:"fail to request token",code:ua,errorCode:null===e.t0||void 0===e.t0?void 0:e.t0.code});case 9:return s=(i=o).vid,c=i.services,u=i.file,e.next=12,ma(o);case 12:return d=e.sent,n(d),p=ha(c),g=Object(l.a)(p,1),h=g[0],m=h.service_id,d.on(sa.UploaderEvents.mediaProgress,(function(e){a(e)})),e.prev=17,e.next=20,d.done();case 20:v=e.sent,e.next=26;break;case 23:throw e.prev=23,e.t1=e.catch(17),ya({message:"fail to upload",code:da});case 26:return _=v.video,b=_.md5,E=_.extendId,y=_.url,C=u.size,e.next=30,ba({vid:s,md5:b,extend_id:E,video_url:y,code:0,service_id:m,file_size:C},r);case 30:return e.abrupt("return",e.sent);case 31:case"end":return e.stop()}}),e,null,[[0,6],[17,23]])})));return function(t,n,a,r){return e.apply(this,arguments)}}(),ya=function(e){return e},Ca=function(e,t){return{type:"UPDATE_VIDEO_MESSAGE_INFO",id:e,payload:t}},Sa=function(e,t){return{type:"UPDATE_VIDEO_FILE_MAP_RECORD",id:e,payload:t}},Oa=function(e,t){return{type:"SET_VIDEO_FILE_MAP_RECORD",id:e,payload:t}},Aa=function(e){return{type:"DELETE_VIDEO_FILE_MAP_RECORD",id:e}},Ta=function(e){return function(t,n){var a=n().getIn(["message","videoFileMap"]).toJS();if(a[e]){var r=a[e].uploader;if(r&&"function"===typeof r.cancel){try{r.cancel()}catch(o){}t(Sa(e,{uploader:null}))}}}},Ia=function(e,t){return function(n,a){var r=Gi(),o=Object(d.a)({is_upload_success:0,is_send_success:0,message_id:"0",upload_duration:0,video_original_duration:0,failure_reason:0},r),i=e.id,s={file:e.content.file},c=a().getIn(["global","supportUnloginChatWithAgent"]),u=function(e){n(Sa(i,{uploader:e}))},l=function(e){var t=e.percent;n(Ca(i,{percent:.95*t*100}))},p=function(){var e=n(wa(i));return!!e&&e.status!==ln.Fail};(function(){var e=Object(g.a)(f.a.mark((function e(){var a,r,d,g,h,m,v,_,b,E,y,C,S,O,A,T,I,w,L,k,M,j,x;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=performance.now(),e.next=3,Ea(s,u,l,p);case 3:return r=e.sent,d=performance.now(),o.upload_duration=d-a,o.is_upload_success=1,g=r.thumbnail_url,h=r.video_url,m=r.duration,v=r.width,_=r.height,b=r.size,E=r.vid,y=m/1e3,o.is_send_success=1,o.video_original_duration=y,C=Xo(h),S=Xo(g),n(Ca(i,{percent:100,video_url:C})),n(xa(i,ln.Sending)),n(Za(i,t,o)),e.prev=16,e.next=19,n(Ba({msg_type:H.Video,msg_id:i,content:{text:C,thumbnail:S,url:C,duration:m,width:v,height:_,size:b,vid:E}}));case 19:if(null==(A=e.sent)){e.next=30;break}if(k=null===A||void 0===A||null===(T=A.data)||void 0===T?void 0:T.code,!(A instanceof Error)){e.next=25;break}throw{code:k};case 25:if(O=(null===A||void 0===A||null===(I=A.data)||void 0===I?void 0:I.message_id)||(null===A||void 0===A||null===(w=A.data)||void 0===w?void 0:w.chatbot_message_id)||(null===A||void 0===A||null===(L=A.data)||void 0===L?void 0:L.msg_id),M=/^[0-9]+$/.test(O),O&&M&&(j=We.LastConversationReadMessageId,x=We.UnloginLastConversationReadMessageId,Et(c?x:j,O)),O){e.next=30;break}throw{code:k};case 30:e.next=35;break;case 32:throw e.prev=32,e.t0=e.catch(16),ya({message:"fail to send",code:pa,errorCode:null===e.t0||void 0===e.t0?void 0:e.t0.code});case 35:o.message_id=O,n(Da(i,O)),n(Ca(O,{thumbnail_url:S,video_url:C,duration:y,width:v,height:_,size:b})),n(xa(O,ln.Success)),n(Aa(i));case 40:case"end":return e.stop()}}),e,null,[[16,32]])})));return function(){return e.apply(this,arguments)}})()().catch((function(e){var t=n(La(i,e));n($a(i,"VID",e)),(null===e||void 0===e?void 0:e.errorCode)&&(o.be_error_code=e.errorCode),o.failure_reason=(null===t||void 0===t?void 0:t.code)||0})).finally((function(){n(Ta(i)),Pi({operation:"action_finish_upload_send",targetType:"video",data:o})})),n(xa(i,ln.Uploading))}},wa=function(e){return function(t,n){return n().getIn(["message","messageList"]).toJS().find((function(t){return t.id===e}))}};function La(e,t){return function(n,a){if(n(wa(e))){var r=t;return a().getIn(["conversation","conversationStatus"])===fe.End&&(r=ya({message:"chat is ended",code:fa})),n(Ca(e,{error:r})),n(ur(e)),"timeout"===(null===t||void 0===t?void 0:t.message)?n(Od({msg:P.a.t("cschat_video_weak_network_error")})):n(Od({msg:P.a.t("cschat_video_send_failed")})),r}}}var ka=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o,i,s;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a().getIn(["conversation","conversationStatus"]),!((o=a().getIn(["user","transferChatStatus"]))&&o!==fe.Chatting||!o&&r!==fe.Chatting)){t.next=4;break}return t.abrupt("return");case 4:n(Ua(e)),(i=a().getIn(["message","videoFileMap"]).toJS())[e]?(s=i[e].videoInfo,n(Xa([s])),n(Aa(e))):n(Xa([{}]));case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Ma=We.LastConversationReadMessageId,ja=We.UnloginLastConversationReadMessageId,xa=function(e,t){return{type:"UPDATE_MESSAGE_STATUS",id:e,status:t}},Ra=function(e,t){return{type:"UPDATE_FILE_MESSAGE_PROGRESS",id:e,progress:t}},Na=function(e,t){return{type:"UPDATE_FILE_MESSAGE_CONTENT",id:e,payload:t}},Pa=function(e){return{type:"PUSH_MESSAGE_LIST",payload:e}},Ua=function(e){return{type:"REMOVE_MESSAGE_ITEM",id:e}},Da=function(e,t){return{type:"UPDATE_MESSAGE_ID",uid:e,msgId:t}};function Ba(e){return function(t,n){return n().getIn(["conversation","connection"]).sendMessage(e)}}var Wa=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(t,n){var a=n().getIn(["message","lastReadMessageId"]),r=n().getIn(["message","messageList"]).last(),o=r&&r.get("sourceType"),i=r&&r.get("id"),s=n().getIn(["global","supportUnloginChatWithAgent"]);(o!==dn.Client&&a!==i||o===dn.Client)&&t(Ks(i));var c=/^[0-9]+$/.test(i),u=n().getIn(["global","shouldShowWindow"]);i&&c&&(u||e)&&Et(s?ja:Ma,i)}},Ha=function(e,t){return function(n){var a=n(Rc()),r={id:t,type:H.Text,status:ln.Sending,sourceType:dn.Client,content:{text:e},timestamp:a};return n(Wa()),n(Pa(Object(Q.fromJS)([r]))),r}},Fa=function(e,t,n){return function(){var a=Object(g.a)(f.a.mark((function a(r,o){var i,s,c,l,d,p,g,h,m,v;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null==t){a.next=5;break}return 429===(t&&t.response&&t.response.status)&&r(u.updateToast({msg:G.t("cschat_send_too_fast")})),r(ur(e)),a.abrupt("return");case 5:n instanceof Error?(v=null===n||void 0===n||null===(h=n.response)||void 0===h||null===(m=h.data)||void 0===m?void 0:m.code,r(ur(e,v))):(l=(null===n||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message_id)||(null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.chatbot_message_id)||(null===n||void 0===n||null===(c=n.data)||void 0===c?void 0:c.msg_id),r(cr(e)),r(Da(e,l)),d=/^[0-9]+$/.test(l),p=o().getIn(["global","shouldShowWindow"]),g=o().getIn(["global","supportUnloginChatWithAgent"]),l&&d&&p&&Et(g?ja:Ma,l));case 6:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()},Ga=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a,r){var o,i,s,c,u;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==e.trim().length){n.next=2;break}return n.abrupt("return");case 2:return o=Object(_t.a)(),i=a(Ha(e,o)),null===(s=r().getIn(["conversation","connection"]))||void 0===s||s.emitMessage({message:i,resend:{id:t}}),n.prev=6,n.next=9,a(Ba({msg_id:o,msg_type:"TEXT",content:{text:e}}));case 9:if(null!=(c=n.sent)){n.next=12;break}return n.abrupt("return");case 12:a(Fa(o,void 0,c)),n.next=19;break;case 15:n.prev=15,n.t0=n.catch(6),u=n.t0,a(Fa(o,u));case 19:case"end":return n.stop()}}),n,null,[[6,15]])})));return function(e,t){return n.apply(this,arguments)}}()},Va=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(){var a=Object(g.a)(f.a.mark((function a(r,o){var i,s,c,l;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return ri("debug","cs_img_upload cs_image_click_send",{}),a.next=3,xu(e);case 3:if(i=a.sent,n.is_upload_success=1,ri("debug","cs_img_upload cs_image_upload_result",{imageResponse:i}),(s=o().getIn(["global","accessPlatform"]))!==Oe.Gudangku&&!Zc(s)&&!ou(s)){a.next=15;break}if(0===i.code){a.next=12;break}return r(ur(t)),r(u.updateToast({msg:G.t("cschat_image_upload_failed")})),a.abrupt("return");case 12:c=au(i.data.image_url),a.next=20;break;case 15:if(i&&(null===(l=i[0])||void 0===l?void 0:l.url)){a.next=19;break}return r(ur(t)),r(u.updateToast({msg:G.t("cschat_image_upload_failed")})),a.abrupt("return");case 19:c=i[0].url;case 20:return a.abrupt("return",c);case 21:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()},Qa=function(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(){var o=Object(g.a)(f.a.mark((function o(i,s){var c,l,d,p,g,h,m,v,_,b;return f.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(null==n){o.next=5;break}return 429===(n&&n.response&&n.response.status)&&i(u.updateToast({msg:G.t("cschat_send_too_fast")})),i(ur(e)),o.abrupt("return");case 5:if(null!=a){o.next=7;break}return o.abrupt("return");case 7:a instanceof Error||null==t?(b=null===(m=a)||void 0===m||null===(v=m.response)||void 0===v||null===(_=v.data)||void 0===_?void 0:_.code,i(ur(e,b))):(p=(null===a||void 0===a||null===(c=a.data)||void 0===c?void 0:c.message_id)||(null===a||void 0===a||null===(l=a.data)||void 0===l?void 0:l.chatbot_message_id)||(null===a||void 0===a||null===(d=a.data)||void 0===d?void 0:d.msg_id),r.is_send_success=1,r.message_id=p,i(dr(e,t)),i(Da(e,p)),g=/^[0-9]+$/.test(p),h=s().getIn(["global","supportUnloginChatWithAgent"]),p&&g&&Et(h?ja:Ma,p));case 8:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}()},qa=function(e,t,n){return function(){var a=Object(g.a)(f.a.mark((function a(r,o){var i,s,c,u,l,p;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e instanceof File){a.next=2;break}return a.abrupt("return");case 2:return i=Gi(),s=Object(d.a)({is_upload_success:0,is_send_success:0,message_id:"0"},i),c=t.id,a.prev=5,a.next=8,r(Va(e,c,s));case 8:if(u=a.sent){a.next=11;break}return a.abrupt("return");case 11:return r(Za(t.id,n,s)),a.next=14,r(Ba({msg_type:"IMG",msg_id:c,content:{url:u,thumbnail:u}}));case 14:l=a.sent,r(Qa(c,u,void 0,l,s)),a.next=23;break;case 18:a.prev=18,a.t0=a.catch(5),p=a.t0,r(Qa(c,void 0,p,void 0,s)),r($a(c,"IMG",p));case 23:return a.prev=23,Pi({operation:"action_finish_upload_send",targetType:"image",data:s}),a.finish(23);case 26:case"end":return a.stop()}}),a,null,[[5,18,23,26]])})));return function(e,t){return a.apply(this,arguments)}}()},Ka=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){var r,o,i,s;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,zn(e,t);case 2:if((r=n.sent)&&0===r.code){n.next=7;break}return a(ur(t)),a(u.updateToast({msg:G.t("cschat_file_upload_failed")})),n.abrupt("return");case 7:return a(xa(t,ln.Sending)),o=r.data,i=o.fileUrl,s={filename:e.name,name:e.name,size:e.size,url:i,fileKey:""},n.abrupt("return",s);case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},za=function(e,t,n,a){return function(){var r=Object(g.a)(f.a.mark((function r(o,i){var s,c,l,d,p,g,h,m,v,_;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null==n){r.next=5;break}return 429===(n&&n.response&&n.response.status)&&o(u.updateToast({msg:G.t("cschat_send_too_fast")})),o(ur(e)),r.abrupt("return");case 5:if(null!=a){r.next=7;break}return r.abrupt("return");case 7:a instanceof Error||null==t?(_=null===(h=a)||void 0===h||null===(m=h.response)||void 0===m||null===(v=m.data)||void 0===v?void 0:v.code,o(ur(e,_))):(d=(null===a||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message_id)||(null===a||void 0===a||null===(c=a.data)||void 0===c?void 0:c.chatbot_message_id)||(null===a||void 0===a||null===(l=a.data)||void 0===l?void 0:l.msg_id),o(dr(e,t)),o(Da(e,d)),p=/^[0-9]+$/.test(d),g=i().getIn(["global","supportUnloginChatWithAgent"]),d&&p&&Et(g?ja:Ma,d));case 8:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()},Ja=function(e,t,n){var a=t.id;return function(){var r=Object(g.a)(f.a.mark((function r(o){var i,s,c;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e instanceof File){r.next=2;break}return r.abrupt("return");case 2:return r.prev=2,r.next=5,o(Ka(e,a));case 5:return i=r.sent,o(Za(t.id,n)),r.next=9,o(Ba({msg_type:"FILE",msg_id:a,content:i}));case 9:s=r.sent,o(za(a,i.url,void 0,s)),r.next=18;break;case 13:r.prev=13,r.t0=r.catch(2),c=r.t0,o(za(a,void 0,c)),o($a(a,"FILE",c));case 18:case"end":return r.stop()}}),r,null,[[2,13]])})));return function(e){return r.apply(this,arguments)}}()},Ya=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.type===H.Video&&n(Oa(e.id,{videoInfo:e.content})),n(Pa(Object(Q.fromJS)([e])));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Xa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(){var n=Object(g.a)(f.a.mark((function n(a,r){var o,i,s,c;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((o=e.map((function(e){return e.file})))[0]){n.next=3;break}return n.abrupt("return");case 3:i=[],s=[],e.forEach((function(e){var t=e.file,n=e.type,r=a(Rc()),o=Object(_t.a)();s.push(o),n===fn.Image?i.push({id:o,type:H.Image,status:ln.Sending,sourceType:dn.Client,content:{url:"",file:t},timestamp:r}):n===fn.File?i.push({id:o,type:H.File,status:ln.Success,sourceType:dn.Client,content:{url:"",name:t.name,size:t.size,progress:0,cancel:null,isMultipartUpload:!1,uploadId:null,fileKey:null,file:t},timestamp:r}):n===fn.Video&&(a(Oa(o,{videoInfo:e})),i.push({id:o,type:H.Video,status:ln.Uploading,sourceType:dn.Client,content:{file:e.file,video_info:{duration:e.duration,width:e.width,height:e.height,thumbnail_url:e.thumbnail,size:e.file.size}},timestamp:r}))})),o.forEach((function(e,n){e instanceof File||(i[n].id=t[n],a(Za(i[n].id,t[n])))})),a(Pa(Object(Q.fromJS)(i))),c=0;case 9:if(!(c<i.length)){n.next=28;break}if(i[c].type!==H.Image){n.next=15;break}return n.next=13,a(qa(o[c],i[c],t[c]));case 13:n.next=23;break;case 15:if(i[c].type!==H.File){n.next=20;break}return n.next=18,a(Ja(o[c],i[c],t[c]));case 18:n.next=23;break;case 20:if(i[c].type!==H.Video){n.next=23;break}return n.next=23,a(Ia(i[c],t[c]));case 23:return n.next=25,zo(500);case 25:c++,n.next=9;break;case 28:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()};function Za(e,t,n){return function(a,r){var o=r().getIn(["conversation","connection"]),i=r().getIn(["message","messageList"]).find((function(t){return t.get("id")===e})).toJS();null===o||void 0===o||o.emitMessage({message:i,resend:{id:t},trackerInfo:n})}}function $a(e,t,n){return function(a,r){var o=r().getIn(["conversation","connection"]);null===o||void 0===o||o.emitMessageComplete({result:{msg_type:t,message_id:e},error:n})}}var er,tr,nr,ar,rr=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a(Ua(e)),a(Ga(t,e));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},or=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a(Ua(e)),a(Xa([{file:t,type:fn.Image,src:""}],[e]));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},ir=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a(Ua(e)),a(Xa([{file:t,type:fn.File,src:""}],[e]));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},sr=function(e,t){return function(n,a){a().getIn(["message","messageList"]).find((function(t){return t.get("type")===H.Csat&&t.get("id")===e}))&&n(Ua(e));var r=n(Rc()),o=Object(_t.a)();n(Pa(Object(Q.fromJS)([{id:o,type:H.Rating,status:"success",content:{type:t},timestamp:r}])))}},cr=function(e){return function(t){t(xa(e,ln.Success))}},ur=function(e,t){return function(n){t!==oe&&t!==ie||(n(c.updateConversationStatus(fe.Error)),n(tc(G.t("cschat_error_message")))),n(xa(e,ln.Fail))}},lr=function(e,t){return function(n){n(function(e,t,n){return{type:"UPDATE_IMAGE_MESSAGE_STATUS",id:e,status:t,url:n}}(e,ln.Success,t))}},dr=function(e,t){return function(n){n(function(e,t,n){return{type:"UPDATE_FILE_MESSAGE_STATUS",id:e,status:t,url:n}}(e,ln.Success,t))}},pr=function(){},fr=function(e){return function(t){var n=t(Rc()),a=Object(_t.a)();t(Wa()),t(Pa(Object(Q.fromJS)([{id:a,type:H.Text,status:ln.Success,sourceType:dn.Client,content:{text:e},timestamp:n}])))}},gr=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a,r){var o,i,s,c,u;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=Object(_t.a)(),i=a(mr(o,e)),null===(s=r().getIn(["conversation","connection"]))||void 0===s||s.emitMessage({message:i,resend:{id:t}}),n.prev=4,n.next=7,a(Ba({msg_type:"ORDER",msg_id:o,content:Object(d.a)({},e)}));case 7:if(null!=(c=n.sent)){n.next=10;break}return n.abrupt("return");case 10:a(vr(o,void 0,c)),n.next=17;break;case 13:n.prev=13,n.t0=n.catch(4),u=n.t0,a(vr(o,u));case 17:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(e,t){return n.apply(this,arguments)}}()},hr=function(e,t){return function(n){n(Ua(e)),n(gr(t,e))}},mr=function(e,t){return function(n){var a=n(Rc()),r={id:e,type:H.Order,status:ln.Sending,sourceType:dn.Client,content:Object(d.a)({},t),timestamp:a};return n(Wa()),n(Pa(Object(Q.fromJS)([r]))),r}},vr=function(e,t,n){return function(){var a=Object(g.a)(f.a.mark((function a(r,o){var i,s,c,l,d,p,g,h,m;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(null==t){a.next=5;break}return 429===(t&&t.response&&t.response.status)&&r(u.updateToast({msg:G.t("cschat_send_too_fast")})),r(ur(e)),a.abrupt("return");case 5:n instanceof Error?(m=null===n||void 0===n||null===(g=n.response)||void 0===g||null===(h=g.data)||void 0===h?void 0:h.code,r(ur(e,m))):(l=(null===n||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message_id)||(null===n||void 0===n||null===(s=n.data)||void 0===s?void 0:s.chatbot_message_id)||(null===n||void 0===n||null===(c=n.data)||void 0===c?void 0:c.msg_id),r(cr(e)),r(Da(e,l)),d=/^[0-9]+$/.test(l),p=o().getIn(["global","supportUnloginChatWithAgent"]),l&&d&&Et(p?ja:Ma,l));case 6:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()},_r=n(654),br=n.n(_r),Er=Object(Q.fromJS)({socketStatus:0,session:"",userType:Pe.Anonymous,token:"",userId:""}),yr=br.a.w3cwebsocket,Cr=function(e){var t=new yr("wss://".concat(e)),n=function(){var e=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){if(t.readyState===Lt.OPEN)return e();t.onopen=function(t){console.log("connect: ",t),r(),e()},setTimeout((function(){var e=Hc.getState().getIn(["conversation","conversationStatus"]),t=Hc.getState().getIn(["global","shouldShowWindow"]);e===fe.Uninitialized&&t&&Hc.dispatch(yl(fe.SystemError))}),3e4),t.onclose=function(){setTimeout((function(){var e=Hc.getState().getIn(["global","networkStatus"]),t=Hc.getState().getIn(["conversation","conversationStatus"]),n=Hc.getState().getIn(["user","transferChatStatus"]);"online"===e&&fe.Chatting===t&&n!==fe.Chatting&&Hc.dispatch(Wl())}),2500)},t.onerror=function(){}}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r=function(){t.onmessage=function(e){Hc.dispatch(a.on(e))}};return{send:function(e){t.send(JSON.stringify(e))},close:function(){t&&t.readyState!==Lt.CLOSED&&(t.onclose=function(){},t.close())},connect:n,socket:t}},Sr=Math.floor(Date.now()/1e3)-1209600,Or=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n().getIn(["message","messageDirection"]),r=n().getIn(["message","messageList"]).toJS(),o=0,r.length&&(i=a===Rt.Older?r[0]:r.pop(),o=i.seqId),s=Jr(kt.IM_MSG_SYNC_REQUEST,{limit:10,seq_id:o,noSession:!0,req_type:a,start_time:Sr}),t(qs(Nt.LOADING)),t(qr(s));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Ar=function(e){return[xt.cs2client,xt.system2client].includes(e)?dn.Agent:xt.bot2client===e?dn.Bot:dn.Client},Tr=function(e){var t=e.messageBody;return{type:e.type,content:e.content,timestamp:Hc.dispatch(Rc(1e3*t.ctime)),id:t.msg_id,status:ln.Success,sourceType:Ar(t.msg_flow)}},Ir=function(e,t){return{type:"UPDATE_SESSION",sessionId:e,userId:t}},wr=function(e){return{type:"UPDATE_USER_AUTHINFO",payload:e}},Lr=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=a().getIn(["user","isLogined"]),t.t0=e.cmd,t.next=t.t0===kt.NEW_SESSION_RESPONSE?4:t.t0===kt.IM_MSG?14:t.t0===kt.SERVER_CLOSE_SESSION?17:t.t0===kt.ERROR_RESPONSE?19:t.t0===kt.IM_MSG_SYNC_RESPONSE?21:23;break;case 4:return Ot("chatbotSessionId",e.session_id),n(Ir(e.session_id,e.user_id)),o=yt("ImmediateChatAfterLogin"),t.next=9,zo(1e3);case 9:return n(yl(fe.Chatting)),o&&r||n(to(G.t("cschat_bot_greeting_text"))),n(xc(!1)),n(Or()),t.abrupt("break",24);case 14:return n(Zr(e.body.msg_id)),n(kr(e.body)),t.abrupt("break",24);case 17:return n(yl(fe.End)),t.abrupt("break",24);case 19:return n(Gr(e.body)),t.abrupt("break",24);case 21:return n(Hr(e.body)),t.abrupt("break",24);case 23:return t.abrupt("break",24);case 24:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},kr=function(e){return function(t,n){var a=n().getIn(["message","messageList"]).toJS().some((function(t){return t.id===e.msg_id})),r=n().getIn(["user","isLogined"]),o=n().getIn(["user","userType"]),i=n().getIn(["user","isLiveAgentEnable"]),s=n().getIn(["user","tocTokenStatus"]),c=n().getIn(["global","accessPlatform"]);if(a)return t(Vs(e.msg_id,e.seq_id)),void t(cr(e.msg_id));switch(t(Rs()),e.msg_type){case jt.text:t(Mr(e));break;case jt.image:t(xr(e));break;case jt.serviceOptions:r?(o===he.MainAccount||o===he.SubAccount&&Be.includes(c))&&i&&s?t(nc()):t(Rr(e)):t(nc());break;case jt.csQueuing:t(Nr(e));break;case jt.welcome:t(Pr(e));break;case jt.sessionExpireRemind:t(Ur(e));break;case jt.sessionExpired:t(Dr(e));break;case jt.feedback:t(Fr(e));break;case jt.optionsText:t(jr(e))}}},Mr=function(e){var t=Tr({messageBody:e,type:H.Text,content:{text:e.content.text}});return function(e){e(Pa(Object(Q.fromJS)([Object(d.a)({},t)])))}},jr=function(e){var t=Tr({messageBody:e,type:H.OptionsText,content:e.content});return function(e){e(Pa(Object(Q.fromJS)([Object(d.a)({},t)])))}},xr=function(e){var t=Tr({messageBody:e,type:H.Image,content:{url:e.content.url}});return function(e){e(Pa(Object(Q.fromJS)([Object(d.a)({},t)])))}},Rr=function(e){return function(t){var n=Tr({messageBody:e,content:e.content,type:H.ServiceOptions});t(Pa(Object(Q.fromJS)([Object(d.a)({},n)])))}},Nr=function(e){var t=e.content.number||0;return function(e){e(js(t)),t&&e(yl(fe.AgentQueue))}},Pr=function(e){return function(t){var n=e.content.cs_name,a=Tr({messageBody:e,type:H.System,content:{text:G.t("cschat_joined_conversation",{name:n})}});t(Pa(Object(Q.fromJS)([Object(d.a)({},a)]))),t(Gs(G.t("cschat_joined_conversation",{name:n}))),t(yl(fe.Chatting))}},Ur=function(e){var t=Tr({messageBody:e,type:H.System,content:{text:G.t("cschat_no_newmessage_close_connect_tips")}});return function(e){e(Pa(Object(Q.fromJS)([Object(d.a)({},t)])))}},Dr=function(e){var t=Tr({messageBody:e,type:H.System,content:{text:G.t("cschat_closed_connect_tips")}});return function(e){e(Pa(Object(Q.fromJS)([Object(d.a)({},t)])))}},Br=(er={},Object(x.a)(er,jt.text,H.Text),Object(x.a)(er,jt.image,H.Image),Object(x.a)(er,jt.welcome,H.System),Object(x.a)(er,jt.optionsText,H.OptionsText),Object(x.a)(er,jt.serviceOptions,H.ServiceOptions),er),Wr=!0,Hr=function(e){return function(t,n){var a=n().getIn(["user","isLogined"]);if(a)t(qs(Nt.NORMAL));else{var r=[],o=e.length<10,i=!1;Wr?(o&&0!==e.length&&(i=!0),Wr=!1):o&&(i=!0),e.forEach((function(e){var t={};Br[e.msg_type]&&(t=e.msg_type===jt.text?{text:e.content.text}:e.msg_type===jt.image?{url:e.content.url}:e.msg_type===jt.welcome?{text:G.t("cschat_joined_conversation",{name:e.content.cs_name})}:e.content,r.push({content:t,id:e.msg_id,seqId:e.seq_id,timestamp:e.ctime,status:ln.Success,type:Br[e.msg_type],sourceType:Ar(e.msg_flow)}))})),t(Qs(r,i)),t(qs(o?a?Nt.NORMAL:Nt.NO_MORE:Nt.NORMAL))}}},Fr=function(e){return function(){console.log("receive FeedbackMessage:",e)}},Gr=function(e){return function(t,n){var a=n().getIn(["conversation","conversationStatus"]);switch(e.code){case Mt.ServerError:a===fe.Uninitialized?t(yl(fe.SystemError)):a===fe.Chatting&&t(no());break;case Mt.Forbidden:t(yl(fe.SystemError));break;case Mt.Unauthorized:console.log("user unauthorized");break;case Mt.FrequentlyRequest01:t(yl(fe.SystemError));break;case Mt.FrequentlyRequest02:case Mt.FrequentlyRequest03:t(u.updateToast({msg:G.t("cschat_send_too_fast")}));break;case Mt.SessionEnded:case Mt.ServerTimeout:}}},Vr=function(e){return Object(g.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,tr&&tr.close(),tr=Cr(e),t.next=5,tr.connect();case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log("open socket err: ",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))},Qr=function(){return function(e,t){var n=t().getIn(["socket","session"]),a=t().getIn(["socket","token"]),r=t().getIn(["socket","userId"]),o=t().getIn(["socket","userType"]),i={cmd:kt.NEW_SESSION,body:{token:a},user_id:r,user_type:o,session_id:n};e(qr(i))}},qr=function(e,t,n){return function(a,r){var o;if(null!=t){var i=r().getIn(["conversation","connection"]);null===i||void 0===i||i.emitMessage({message:Object(d.a)(Object(d.a)({},t),{},{socket:!0}),params:e,resend:{id:n}})}null===(o=tr)||void 0===o||o.send(e)}},Kr=function(e){return function(t,n){var a=JSON.parse(e.data),r=n().getIn(["conversation","connection"]);a.cmd!==kt.NEW_SESSION_RESPONSE&&(null===r||void 0===r||r.emitReceiveMessage(Object(d.a)(Object(d.a)({},a),{},{socket:!0}))),t(Lr(a))}},zr=function(){return function(){console.log("socket error")}},Jr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Hc.getState().getIn(["socket","session"]),a=Hc.getState().getIn(["socket","token"]),r=Hc.getState().getIn(["socket","userId"]),o=Hc.getState().getIn(["socket","userType"]),i=t.noSession,s=Object(Xe.a)(t,["noSession"]),c={},u=Hc.getState().getIn(["user","isLogined"]),l=Hc.getState().getIn(["user","userId"]),p=Hc.getState().getIn(["user","userType"]);if(u){var f=Hc.getState().getIn(["user","externalSessionId"]),g=Hc.getState().getIn(["user","region"]);c={external_session_id:f,region:g,real_user_id:String(l)}}return{cmd:e,body:Object(d.a)(Object(d.a)(Object(d.a)({token:a},s),c),{},{real_user_account_type:p||he.MainAccount}),user_id:r,user_type:o,session_id:i?"":n}},Yr=function(){var e=Jr(kt.QUESTION_TYPE_LIST_REQUEST);return function(t){t(qr(e))}},Xr=function(){var e=Jr(kt.CLOSE_SESSION);return function(t){t(qr(e)),t(yl(fe.End)),tr.close()}},Zr=function(e){var t=Jr(kt.IM_CLIENT_ACK,{msg_id:e});return function(e){e(qr(t))}},$r=function(e){var t=e.messageType,n=e.content,a=e.chatType,r=e.messageId,o=void 0===r?Object(_t.a)():r,i=Math.floor(Date.now()/1e3);return Jr(kt.IM_MSG,{content:n,ctime:i,msg_id:o,msg_type:t,chat_type:a})},eo=function(e,t,n,a){return function(r){if(0!==e.trim().length){var o=r(Rc()),i=null!==a&&void 0!==a&&a,s=$r({messageType:jt.text,chatType:void 0!==t?t:0,content:{text:e,is_enquiry_message:i}}),c={id:s.body.msg_id,type:H.Text,status:ln.Sending,sourceType:dn.Client,content:{text:e,is_enquiry_message:i},timestamp:o};r(Pa(Object(Q.fromJS)([c]))),r(qr(s,c,n))}}},to=function(e){return function(t){t(Rc());t(Pa(Object(Q.fromJS)([{id:Object(_t.a)(),type:H.Text,status:ln.Success,sourceType:dn.Bot,content:{text:e},timestamp:Math.floor(Date.now()/1e3)}])))}},no=function(){return function(e,t){var n=t().getIn(["message","messageList"]).toJS().pop().seqId,a=Ft()(n).add(1).toString();e(Pa(Object(Q.fromJS)([{seqId:a,id:Object(_t.a)(),type:H.System,status:ln.Success,content:{text:G.t("cschat_something_went_wrong_try_again_tips")}}])))}},ao=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){var r,o,i;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,xu(e);case 3:if((r=n.sent)&&r[0]){n.next=6;break}return n.abrupt("return");case 6:o=r[0].url,i=$r({messageId:t,messageType:jt.image,content:{url:o,thumbnail:"".concat(o,"_tn")},chatType:0}),a(lr(t,o)),a(qr(i)),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(0),console.log("upload image error!");case 15:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(e){return n.apply(this,arguments)}}()},ro=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(){var t=Object(g.a)(f.a.mark((function t(n){var a,r,o,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=e.map((function(e){return e.file})))[0]){t.next=3;break}return t.abrupt("return");case 3:r=n(Rc()),o=a.map((function(){return Object(_t.a)()})),a.forEach((function(e,t){n(Pa(Object(Q.fromJS)([{id:o[t],type:H.Image,status:ln.Sending,sourceType:dn.Client,content:{url:"",file:e},timestamp:r}])))})),i=0;case 7:if(!(i<a.length)){t.next=15;break}return t.next=10,n(ao(a[i],o[i]));case 10:return t.next=12,zo(500);case 12:i++,t.next=7;break;case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},oo=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a(Ua(e)),a(eo(t,void 0,e));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},io=function(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a(Ua(e)),a(ro([{file:t}]));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},so=n(66),co=We.UnloginChatAccessToken,uo=We.ChatAccessToken,lo=We.LastConversationReadMessageId,po=function(e){return{type:"UPDATE_LOGIN_STATUS",payload:e}},fo=function(e){return{type:"UPDATE_LOGIN_USER_TYPE",payload:e}},go=function(e){return{type:"UPDATE_TRANSFER_CHAT_STATUS",payload:e}},ho=function(e){return{type:"UPDATE_LOGIN_USER_AUTHINFO",payload:e}},mo=function(e){return{type:"CANCEL_QUEUE_CONFIRM",payload:e}},vo=function(e){return function(t){t(_o(e)),1===(null===e||void 0===e?void 0:e.length)&&t(bo(!0))}},_o=function(e){return{type:"UPDATE_ENQUIRY_TYPES",payload:e}},bo=function(e){return{type:"AUTO_GO_ENQUIRY",payload:e}},Eo=function(e){return{type:"UPDATE_EXTERNAL_SESSION_ID",payload:e}},yo=function(e){return{type:"UPDATE_LIVEAGENT_ENABLE",payload:e}},Co=function(e){return{type:"TOC_TOKEN_STATUS",payload:e}},So=function(e){return{type:"SET_BOT_AVATAR",payload:e}},Oo=function(e){return{type:"SET_LIVE_AGENT_AVATAR",payload:e}},Ao=function(e){return{type:"UPDATE_USERID",payload:e}},To=!1,Io=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o,i,s,u,l,d,p,g;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!To){t.next=2;break}return t.abrupt("return");case 2:if(To=!0,r=a().getIn(["global","accessPlatform"]),!(e||{}).userId||r===Oe.WeChat){t.next=11;break}e.userType===he.SubAccount&&(e.region=Ve.SG),n(ho(e)),n(ko(e)),t.next=28;break;case 11:if(r!==Oe.WeChat){t.next=27;break}return t.prev=12,t.next=15,il.get("/api/user/login_info/",{});case 15:o=t.sent,console.log("getUserInfo",o),i=o.data||{},s=i.username,u=i.userid,l=i.user_type,d=i.region,p=i.tob_userid,u?(g={userType:l,userId:l===he.MainAccount?u:p,userName:s,region:l===he.MainAccount?d:Ve.SG},n(ho(g)),n(ko(g))):n(c.initSession({needCheckConflict:!0,first:!0})),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(12),console.log("\u672a\u767b\u5f55"),n(c.initSession({needCheckConflict:!0,first:!0}));case 25:t.next=28;break;case 27:n(jd(!0));case 28:case"end":return t.stop()}}),t,null,[[12,21]])})));return function(e,n){return t.apply(this,arguments)}}()},wo=function(e){return{type:"SET_USER_ALL_EVENT",payload:e}},Lo=function(e){return{type:"DONE_USER_EVENT",payload:e}},ko=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o,s,l,d,p,g,h,m,v,_,b,E,y,C,S,O,A,T,I;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=(o=e||{}).region,l=o.userId,d=o.token,p=a().getIn(["global","accessPlatform"]),g=a().getIn(["chatbot","enabled"]),Ot("authInfo",JSON.stringify(e)),n(po(!0)),Et("chat_region",(s||"").toLowerCase()),p===Oe.Cnsc){t.next=12;break}return t.next=9,sl();case 9:t.t0=t.sent,t.next=13;break;case 12:t.t0={data:{access_token:d}};case 13:if(h=t.t0,console.log("getAccessToken",h),m=yt("ImmediateChatAfterLogin"),!(null===h||void 0===h||null===(r=h.data)||void 0===r?void 0:r.access_token)){t.next=52;break}return Et("chat_access_token",h.data.access_token),n(Co(!0)),t.next=21,n(c.getEnquiryTypes());case 21:if(p!==Oe.WeChat){t.next=32;break}return t.prev=22,t.next=25,yu({channel:Hl[p],entry_point:Fl[p]});case 25:0===(null===(v=t.sent)||void 0===v?void 0:v.code)&&(_=v.data,b=_.web_form_url,E=_.web_form_platform,n(c.setOfflineFormUrl(b)),n(c.setWebFormPlatform(E))),t.next=32;break;case 29:t.prev=29,t.t1=t.catch(22),console.log(t.t1);case 32:return t.next=34,n(u.checkAndRecoverSession());case 34:return y=t.sent,C=Go.checkMasterIsExist(),y||tr||C||(Et("connection",""),Et(lo,""),n(c.initSession({needCheckConflict:!0,first:!0}))),t.next=39,n(Ro(l));case 39:if(S=t.sent,m&&(S?(n(i.pushEnquiryTypeMessage()),Et("ImmediateChatAfterLogin",!1)):n(to(G.t("cschat_bot_greeting_text")))),!g){t.next=43;break}return t.abrupt("return");case 43:return t.next=45,vu({external_type:1});case 45:O=t.sent,(A=O.data)&&(T=A.session_id,I=A.init_message_id,n(Eo(T)),n(c.setOldestMessageId(I))),n(c.checkConflict()),n(No()),t.next=55;break;case 52:m&&n(to(G.t("cschat_bot_greeting_text"))),n(Co(!1)),n(jd(!0));case 55:case"end":return t.stop()}}),t,null,[[22,29]])})));return function(e,n){return t.apply(this,arguments)}}()},Mo=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n().getIn(["global","accessPlatform"]),o=n().getIn(["global","supportUnloginChatWithAgent"]),r!==Oe.Cnsc){e.next=8;break}return e.next=5,bu({src_type:Ge.Cnsc});case 5:i=e.sent,e.next=17;break;case 8:if(!o){e.next=14;break}return e.next=11,t={max_ttl:3600},hu().post("/v1/refresh_chat_access_token",Object(d.a)({},t));case 11:i=e.sent,e.next=17;break;case 14:return e.next=16,sl();case 16:i=e.sent;case 17:return 10001e3===(null===(a=i)||void 0===a?void 0:a.code)&&(r===Oe.WeChat?(s=Xc(),window.location.href=s):window.csChatLogin&&window.csChatLogin()),e.abrupt("return",i);case 19:case"end":return e.stop()}var t}),e)})));return function(t,n){return e.apply(this,arguments)}}()},jo=function(e){return function(t,n){var a=n().getIn(["global","supportUnloginChatWithAgent"]);e&&(a?(t(u.updateAccessToken(e)),Et(co,e)):Et(uo,e))}},xo=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(Mo());case 2:a=e.sent,(r=null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.access_token)&&t(jo(r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Ro=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n){var a,r,o,i,s,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=St("authInfo"),o=JSON.parse(r||"{}"),(i=o.userType)===he.SubAccount){t.next=8;break}return t.next=5,Qu({source:"CN",user_id:e});case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,_u({biz_type:Ne.SubAccount,gray_id:"".concat(e)});case 10:t.t0=t.sent;case 11:return s=t.t0,c=i===he.MainAccount?s.is_cs_chat_enable:(null===s||void 0===s||null===(a=s.data)||void 0===a?void 0:a.gray_result)===Fe.isOk,n(yo(c)),t.abrupt("return",c);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},No=function(){var e={event_ids:[me.HistoryMessage]};return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null===(r=a().getIn(["user","userEvents"]).toJS())||void 0===r?void 0:r.length)){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,Cu(e);case 6:o=t.sent,(i=o.data)&&n(wo(Object(Q.fromJS)(i))),t.next=13;break;case 11:t.prev=11,t.t0=t.catch(3);case 13:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e,n){return t.apply(this,arguments)}}()},Po=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a={event_id:e},hu().post("v1/report_user_event",a);case 2:n(Lo(e));case 3:case"end":return t.stop()}var a}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Uo=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,hu().get(function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),t=e.REACT_APP_SERVER_ENV,n=e.REACT_APP_REGION,a=$c(),r=yt("chat_region")||n,o=Zc(a)?wt(t):It(r,t),i=vi(),s="".concat("vn"===n?"banhang":"seller",".").concat(o),c=i?s:window.location.host,u="";u=Zc(a)?"https://chatbot.".concat(o,"/chat/v1/query_avatars").replace(/chatbot.([^.]+\.)?shopee.tw/,"chatbot.xiapi.$1shopee.cn"):ou(a)||a===Oe.Gudangku?"https://chatbot.".concat(o,"/api/v1/avatars"):"https://".concat(c,"/api/cschat/v1/query_avatars");return u}());case 3:a=e.sent,(r=a.data)&&(o=Object(so.cdnFile)(r.avatar),i=Object(so.cdnFile)(r.live_chat_avatar),t(So(o)),t(Oo(i))),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},Do=function(e,t,n){return function(r,o){var s=o().getIn(["global","accessPlatform"]),c=o().getIn(["user","transferChatStatus"]);Zc(s)&&c!==fe.Chatting?r(a.sendMessage(e,t,void 0,n)):r(i.sendMessage(e))}},Bo=function(e,t){return function(n,r){var o=r().getIn(["global","accessPlatform"]),s=r().getIn(["user","transferChatStatus"]);Zc(o)&&s!==fe.Chatting?n(a.resendMessage(e,t)):n(i.resendMessage(e,t))}},Wo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t,n){var r=n().getIn(["global","accessPlatform"]),o=n().getIn(["user","transferChatStatus"]);Zc(r)&&o!==fe.Chatting?t(a.sendImages(e)):t(i.sendFilesAndImages(e))}},Ho=function(e,t){return function(n,r){var o=r().getIn(["global","accessPlatform"]),s=r().getIn(["user","transferChatStatus"]);Zc(o)&&s!==fe.Chatting?n(a.resendImageMessage(e,t)):n(i.resendImageMessage(e,t))}},Fo=function(){return function(e,t){var n=t().getIn(["global","accessPlatform"]),r=t().getIn(["user","transferChatStatus"]);Zc(n)&&r!==fe.Chatting?e(a.closeSession()):e(c.endConversation())}},Go=new vt.SharedAgentChat,Vo=We.Connection,Qo=We.UnloginConnection;function qo(){return function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:nr=Go.init({connectionHandlers:t((function(e,t){return{beforeInit:function(t){return e(function(e){return console.log("connection before init\u4e8b\u4ef6",e),function(t,n){var a=n().getIn(["global","accessPlatform"]),r=null===e||void 0===e?void 0:e.enquiry_name;if(r){var o=n().getIn(["user","autoGoEnquiry"]),i=n().getIn(["chatbot","enabled"]);o||((ru(a)||Zc(a))&&t(oc()),ru(a)||Zc(a)&&null==tr?!i&&t(fr(r)):t(Do(r,1,!0)))}ru(a)||Zc(a)?(t(go(fe.Transfering)),t(Js("#"))):((null===e||void 0===e?void 0:e.first)&&t(Js("#")),St("prevEnquiryType")&&t(go(fe.Transfering)));t(yl(fe.Uninitialized)),(null===e||void 0===e?void 0:e.queue_name)&&Ot("prevEnquiryType",null===e||void 0===e?void 0:e.queue_name)}}(t))},init:function(){var n=Object(g.a)(f.a.mark((function n(a){var r,o;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t().getIn(["global","supportUnloginChatWithAgent"]),o=yt(r?Qo:Vo),r&&o.key!==a.key||(e(Ko()),e(Kl(a,!0)));case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),sendMessage:function(n){var a=n.message,r=n.resend.id;if(r){var o,i=t().getIn(["message","messageList"]).toJS(),s=i.find((function(e){return e.id===r})),c=null===s||void 0===s||null===(o=s.content)||void 0===o?void 0:o.file;if(c instanceof File)return void("IMG"===(null===s||void 0===s?void 0:s.type)?e(or(r,c)):"FILE"===(null===s||void 0===s?void 0:s.type)?e(ir(r,c)):e(ka(r)));e(Ua(r))}if(a.socket){var u,l=!0===(null===(u=a.content)||void 0===u?void 0:u.is_enquiry_message);null==tr||l||e(Pa(Object(Q.fromJS)([a])))}else a.type===H.Text?e(Ha(a.content.text,a.id)):a.type===H.Order?e(mr(a.id,a.content)):e(Ya(a))},sendMessageComplete:function(t){return e(function(e){var t=e.error,n=e.result;return function(e){var a,r,o,i,s,c=null===n||void 0===n?void 0:n.msg_id,u=(null===n||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message_id)||(null===n||void 0===n||null===(r=n.data)||void 0===r?void 0:r.msg_id),l=null===n||void 0===n||null===(o=n.content)||void 0===o?void 0:o.url,d=null!==(i=null===n||void 0===n||null===(s=n.extraInfo)||void 0===s?void 0:s.trackerInfo)&&void 0!==i?i:{};switch(n.msg_type){case H.Text:e(Fa(c,t,n));break;case H.Order:e(vr(c,t,n));break;case H.Image:e(Qa(c,l,t,n,d)),Go.isMaster&&Pi({operation:"action_finish_upload_send",targetType:"image",data:d});break;case H.File:e(Ra(c,100)),e(za(c,l,t,n));break;case H.Video:var p,f;if(null!=t)p=e(La(c,t));else if(n instanceof Error||null==c&&null==u){var g;p=e(La(c,ya({message:"fail to send",code:pa,errorCode:null===n||void 0===n||null===(g=n.data)||void 0===g?void 0:g.code})))}else e(Da(c,u)),e(xa(u,ln.Success)),e(Aa(c));if(Go.isMaster)(null===t||void 0===t?void 0:t.errorCode)&&(d.be_error_code=t.errorCode),d.message_id=u,d.failure_reason=(null===(f=p)||void 0===f?void 0:f.code)||0,Pi({operation:"action_finish_upload_send",targetType:"video",data:d})}}}(t))},message:function(t){return e(function(e){return function(t,n){var a=n().getIn(["global","supportUnloginChatWithAgent"]),r=n().getIn(["message","messageList"]);if(null===e||void 0===e?void 0:e.socket){var o,s,c=!0===(null===e||void 0===e||null===(o=e.body)||void 0===o||null===(s=o.content)||void 0===s?void 0:s.is_enquiry_message);null==tr||c||t(Lr(e))}else if(null===e||void 0===e?void 0:e.first)(null===e||void 0===e?void 0:e.queue_position)?t(zl({msg_type:ue.QUEUING,content:{number:null===e||void 0===e?void 0:e.queue_position}},!0)):(null===e||void 0===e?void 0:e.msg_type)===ue.QUEUING?t(zl(e,!0)):(t(lc(!0)),t(zl({msg_type:ue.CS_JOINED},!0)));else{if(a)-1!==(null===r||void 0===r?void 0:r.findIndex((function(e){return e.get("type")===H.RegisterWebform})))&&t(i.clearMessageList());t(zl(e))}}}(t))},close:function(t){return e(Jl(t))},error:function(t){return e(Yl(t,!0))},rating:function(t){var n=t.messageId,a=t.rateType;e(sr(n,a))},updateReadedMessage:function(t){var n=t.readedCount,a=t.totalCount;e(Fs(null!==n&&void 0!==n?n:0,!1)),e(Ns(null!==a&&void 0!==a?a:0))},config:function(t){return e(Ul(t))}}})),fallbackToWorker:function(){t(Ko())},upgradeToMaster:function(){var e=Object(g.a)(f.a.mark((function e(n,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a){e.next=2;break}return e.abrupt("return",t(Zl(n,a)));case 2:return e.abrupt("return",null);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}),t(Ko());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}function Ko(){return function(e){null!=nr&&(nr.default=!0,e(_l(nr)))}}function zo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t=null;return new Promise((function(n){t=setTimeout((function(){n(),clearTimeout(t),t=null}),e)}))}function Jo(e){return new Promise((function(t,n){var a=document.createElement("script");a.type="text/javascript",a.src=e,document.body.appendChild(a),a.onload=function(){t()},a.onerror=function(){n()}}))}function Yo(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!1,a=0;a<t.length;a++)if(e.indexOf(t[a])>0){n=!0;break}return n}var Xo=function(e){return e.startsWith("http:")?e.replace("http:","https:"):e},Zo=function(){return Hc.getState().getIn(["global","accessPlatform"])===Oe.WeChat&&!Re},$o=function(){return yt("chat_region")||"cn"},ei=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=(e=e.toJS?e.toJS():e)&&e.find((function(e){return(null===e||void 0===e?void 0:e.event_id)===t}));return!n||1===(null===n||void 0===n?void 0:n.status)},ti=function(e){var t=e.video_info,n=e.vid,a=e.url,r=e.thumbnail,o=e.duration,i=e.width,s=e.height,c=e.size;return t?Object(d.a)({},e):{text:a,video_info:{thumbnail_url:r,video_url:a,duration:o/1e3,width:i,height:s,size:c,vid:n}}},ni=function(e){switch(e){case 1:return"shopee-cs-chat-sc";default:return"shopee-cs-chat-default"}},ai=(ar={},Object(x.a)(ar,Oe.Cnsc,"CNSC"),Object(x.a)(ar,Oe.ShopeeCn,"ShopeeCn"),Object(x.a)(ar,Oe.ShopeeCnEdu,"ShopeeCnEdu"),Object(x.a)(ar,Oe.WeChat,"WeChat"),ar);function ri(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=$c(),o=[Oe.Cnsc,Oe.ShopeeCn,Oe.ShopeeCnEdu,Oe.WeChat];o.includes(r)&&(a.platform=ai[r]);try{n=JSON.parse(sessionStorage.getItem("__CHATBOT_AGENT_CURRENT_ID"))}catch(s){n=null}var i=null!=n?"[tabId: ".concat(n,"] "):"";An(e,"[PC] ".concat(i).concat(t),a)}function oi(e){return[Oe.SellerCenter,Oe.EduHub,Oe.ShopeeCn,Oe.ShopeeCnEdu,Oe.Cnsc].includes(e)}function ii(){var e=yt("visibleTabCount");return(!Number.isInteger(e)||e<0)&&(e=0),e}function si(){var e=ii();Et("visibleTabCount",++e)}function ci(){"visible"===document.visibilityState?si():function(){var e=ii();Et("visibleTabCount",--e>=0?e:0)}()}function ui(){"visible"===document.visibilityState&&si(),document.addEventListener("visibilitychange",ci)}var li="noTab",di="noVisibleTab",pi="hasVisibleTab";function fi(e){var t,n;oi(e)&&("serviceWorker"in navigator&&(null===(t=(n=window).requestIdleCallback)||void 0===t||t.call(n,(function(){navigator.serviceWorker.register("/cschat-sw.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}),(function(e){console.log("ServiceWorker registration failed: ",e)}))})),navigator.serviceWorker.addEventListener("message",(function(t){var n=Hc.getState().getIn(["global","supportUnloginChatWithAgent"]),a=We.LastConversationReadMessageId,r=We.UnloginLastConversationReadMessageId,o=yt(n?r:a);switch(t.data.msg){case li:break;case di:case pi:hi.emit("displayUnreadMessages",o)}!function(e){var t="";switch(e){case Oe.SellerCenter:case Oe.EduHub:t="seller_center_livechat_push";break;case Oe.ShopeeCn:case Oe.ShopeeCnEdu:t="shopeecn_livechat_push"}Pi({accessPlatform:e,operation:"click",pageType:t,targetType:"push_notification",data:{ctx_url:void 0}})}(e)}))))}function gi(e,t){var n,a,r;oi(e)&&("granted"===(null===(n=window)||void 0===n||null===(a=n.Notification)||void 0===a?void 0:a.permission)&&(ii()>0||Go.isMaster&&(null===(r=navigator)||void 0===r||r.serviceWorker.getRegistration().then((function(e){null===e||void 0===e||e.showNotification(G.t("cschat_pn_title"),{body:t,data:{url:window.location.origin+"#cschat-pn"}})})))))}var hi=new en.EventEmitter;function mi(e){return e.replace(/^(\s|,)+|(\s|,)+$/g,"").replace(/,/g,"|")}function vi(){return["127.0.0.1","localhost","cs.deo.shopeemobile.com"].includes(window.location.hostname)}n(1096);var _i,bi,Ei,yi,Ci,Si,Oi,Ai=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),Ti=Ai.REACT_APP_SERVER_ENV,Ii=Ai.REACT_APP_REGION,wi="https://chatbot.".concat(It(Ii,Ti,!1)),Li=Tt.a.create({withCredentials:!0,timeout:6e4,baseURL:wi});null===Li||void 0===Li||null===(_i=Li.interceptors)||void 0===_i||null===(bi=_i.request)||void 0===bi||bi.use((function(e){return e.headers.common["shopee-region"]=Ii,e})),function(e){e.VIEW="view",e.CLICK="click",e.ACTION_SEAECH="action_search",e.IMPRESSION="impression",e.PERFORMANCE="performance",e.ACTION_HIPO="action_hipo",e.ACTION_START_TYPING="action_start_typing",e.TO_LIVE_AGENT="to_live_agent",e.REDIRECT="redirect",e.EXIT="exit",e.ACTION_FINISH_UPLOAD_SEND="action_finish_upload_send",e.ACTION_FINISH_LOAD_HISTORY="action_finish_loading",e.ACTION_START_LOAD_HISTORY="action_load_history",e.LOST_TRANSIFY_KEYS="lost_transify_keys",e.ACTION_LIVEAGENT_CONNECTED="action_liveagent_connected",e.ACTION_LIVEAGENT_ENTER_QUEUE="action_liveagent_enter_queue"}(Ei||(Ei={})),function(e){e.MAIN_PAGE="shopee_assistant",e.GAME_HIPO_TRACK="game_hipo_track"}(yi||(yi={})),function(e){e.newHotQuestionCat="hot_question",e.hotQuestionCat="hot_question",e.hotQuestion="hot_question",e.shortcut="bottom_question",e.article="",e.articleGroup="",e.button="",e.order="",e.otherOrder="",e.panelOrder="order_panel",e.singleOrderCard="",e.agent="",e.back="",e.shopeePay="shopee_pay",e.shopeePayPanel="shopee_pay_panel",e.shopeePayTransactionCard="shopee_pay",e.shopeePayOtherTransaction="shopee_pay",e.shopeePayDontSeeButton="shopee_pay",e.shopeePayPanelTransactionCard="shopee_pay_panel",e.shopeePayPanelDontSeeButton="shopee_pay_panel",e.typingSuggestion="",e.standardizeButton="standardize_button",e.chatSessionConflict="",e.loadingHistory="",e.reloadImage="",e.reloadArticle="",e.deletedArticle="",e.scrollToBottom="",e.newMsgPopUp="",e.orderSelection="order_selection",e.noMoreMessage="",e.noMoreMessageExceedDuration="",e.image="",e.file="",e.video="",e.plusPanelGallery="plus_panel",e.plusPanelCamera="plus_panel",e.plusPanelFile="plus_panel",e.videoPlayButton="",e.videoResend="",e.scrollDownToViewHistory="",e.announcement="redirect",e.plusPanelOrders="plus_panel",e.myOrderListSubTab="my_order_list",e.myOrderListMainTab="my_order_list",e.myOrderListOrderDetails="my_order_list",e.myOrderListSelectOrder="my_order_list",e.myOrderListOrder="my_order_list",e.resendOrder="",e.orderMessage="",e.lostTransifyKeys="lost_transify_keys",e.userQueueText="user_queue_text",e.userQueueTextImpress="user_queue_text",e.userCancelQueuePopUp="user_cancel_queue_pop_up",e.userEmailQueuePopUp="user_email_us_pop_up"}(Ci||(Ci={})),function(e){e.toLiveAgent="to_live_agent",e.newHotQuestionCat="category_tab",e.hotQuestionCat="question_category",e.hotQuestion="question",e.shortcut="question",e.article="article",e.articleGroup="article_group",e.button="button",e.standardizeButton="button",e.order="order",e.otherOrder="other_order",e.panelOrder="order",e.singleOrderCard="single_order_card",e.agent="chat_with_agent",e.back="back_button",e.shopeePayTransactionCard="transaction_card",e.shopeePayPanelTransactionCard="transaction_card",e.shopeePayDontSeeButton="dont_see_button",e.shopeePayPanelDontSeeButton="dont_see_button",e.shopeePayOtherTransaction="other_transaction",e.typingSuggestion="suggestion",e.chatSessionConflict="chat_session_conflict",e.loadingHistory="loading_history",e.reloadImage="reload_image",e.reloadArticle="reload_article",e.deletedArticle="deleted_article",e.scrollToBottom="scroll_to_down",e.newMsgPopUp="new_message_pop_up",e.noMoreMessage="no_more_message",e.noMoreMessageExceedDuration="no_more_message_exceed_duration",e.image="image",e.file="file",e.plusPanelGallery="gallery",e.plusPanelCamera="camera",e.plusPanelFile="file",e.video="video",e.videoPlayButton="video_play_thumbnail",e.videoResend="resend_video",e.mySupportCaseButton="my_support_case_button",e.scrollDownToViewHistory="scroll_down_to_view_history",e.announcement="announcement",e.plusPanelOrders="orders",e.myOrderListSubTab="sub_tab",e.myOrderListMainTab="main_tab",e.myOrderListOrderDetails="order_details",e.myOrderListSelectOrder="select_order",e.myOrderListOrder="order",e.resendOrder="resend_order",e.orderMessage="order_message",e.userQueueText="button",e.userCancelQueuePopUp="button",e.userEmailQueuePopUp="button"}(Si||(Si={})),function(e){e.toLiveAgent="toLiveAgent",e.NEW_HOT_QUESTION_CAT="newHotQuestionCat",e.HOTQUESTIONCAT="hotQuestionCat",e.HOTQUESTION="hotQuestion",e.SHORTCUT="shortcut",e.ARTICLE="article",e.ARTICLEGROUP="articleGroup",e.BUTTON="button",e.ORDER="order",e.OTHERORDER="otherOrder",e.SINGLE_ORDER_CARD="singleOrderCard",e.PANELORDER="panelOrder",e.AGENT="agent",e.BACK="back",e.SHOPEE_PAY_TRANSACTION_CARD="shopeePayTransactionCard",e.SHOPEE_PAY_PANEL_TRANSACTION_CARD="shopeePayPanelTransactionCard",e.SHOPEE_PAY_DONT_SEE_BUTTON="shopeePayDontSeeButton",e.SHOPEE_PAY_PANEL_DONT_SEE_BUTTON="shopeePayPanelDontSeeButton",e.SHOPEE_PAY_OTHER_TRANSACTION="shopeePayOtherTransaction",e.TYPING_SUGGESTION="typingSuggestion",e.STANDARDIZE_BUTTON="standardizeButton",e.CHAT_SESSION_CONFLICT="chatSessionConflict",e.LOADING_HISTORY="loadingHistory",e.RELOAD_IMAGE="reloadImage",e.RELOAD_ARTICLE="reloadArticle",e.DELETED_ARTICLE="deletedArticle",e.SCROLL_TO_BOTTOM="scrollToBottom",e.NEW_MSG_POP_UP="newMsgPopUp",e.NO_MORE_MESSAGE="noMoreMessage",e.NO_MORE_MESSAGE_EXCEED_DURATION="noMoreMessageExceedDuration",e.IMAGE="image",e.FILE="file",e.VIDEO="video",e.VIDEO_PLAY_BUTTON="videoPlayButton",e.VIDEO_RESEND="videoResend",e.MY_SUPPORT_CASE_BUTTON="mySupportCaseButton",e.SCROLL_DOWN_TO_VIEW_HISTORY="scrollDownToViewHistory",e.ANNOUNCEMENT="announcement",e.MY_ORDER_LIST_SUB_TAB="myOrderListSubTab",e.MY_ORDER_LIST_MAIN_TAB="myOrderListMainTab",e.MY_ORDER_LIST_ORDER_DETAILS="myOrderListOrderDetails",e.MY_ORDER_LIST_SELECT_ORDER="myOrderListSelectOrder",e.MY_ORDER_LIST_ORDER="myOrderListOrder",e.RESEND_ORDER="resendOrder",e.ORDER_MESSAGE="orderMessage",e.USER_QUEUE_TEXT="userQueueText",e.USER_QUEUE_TEXT_IMPRESS="userQueueTextImpress",e.USER_CANCEL_QUEUE_POPUP="userCancelQueuePopUp",e.USER_EMAIL_QUEUE_POPUP="userEmailQueuePopUp"}(Oi||(Oi={}));var ki,Mi=new(function(){function e(){var t=this;Object(b.a)(this,e),this.dataList=[],this.idleCallback=void 0,this.tick=function(){t.idleCallback=window.requestIdleCallback(Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dataList.length>=20?t.request():t.requestByThrottle(),t.tick();case 2:case"end":return e.stop()}}),e)}))))},this.request=Object(g.a)(f.a.mark((function e(){var n,a,r=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>0&&void 0!==r[0]?r[0]:20,t.dataList.length){e.next=3;break}return e.abrupt("return");case 3:return a=t.dataList.splice(0,n),e.next=6,Li.post("/report/v1/trace",{items:a.map((function(e){return Object(d.a)({},e)}))});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),this.requestByThrottle=function(e,t,n){var a=!0,r=!0;if("function"!==typeof e)throw new TypeError("Expected a function");return function(e){var t=typeof e;return null!=e&&("object"===t||"function"===t)}(n)&&(a="leading"in n?!!n.leading:a,r="trailing"in n?!!n.trailing:r),T()(e,t,{leading:a,maxWait:t,trailing:r})}(this.request,3e3,{leading:!1}),this.tick(),window.addEventListener("beforeunload",this.flush.bind(this))}return Object(E.a)(e,[{key:"report",value:function(e){if("action_hipo"!==e.operation){var t=$c(),n=Hc.getState().getIn(["chatbot","userId"]),a=Hc.getState().getIn(["chatbot","sessionInfo"]),r=Hc.getState().getIn(["chatbot","liveAgentSessionId"]),o={user_id:n,is_login:Boolean(n),liveagent_session_id:r,page_type:e.page_type,time:Date.now().toString(),entry_point:Di[t],section:e.page_section,module:e.target_type,event:e.operation,data:JSON.stringify(e.data),session_id:a.sessionId};this.dataList.push(o)}}},{key:"flush",value:function(){navigator.sendBeacon("".concat(wi,"/report/v1/trace"),JSON.stringify({items:this.dataList}))}},{key:"destroy",value:function(){window.cancelIdleCallback(this.idleCallback)}}]),e}()),ji=function(e){switch(e||(e=Hc.getState().getIn(["global","accessPlatform"])),e){case Oe.SellerCenter:return"seller_center_cs_chat";case Oe.ShopeeCn:return"shopee_cn_cs_chat";case Oe.EduHub:return"seller_center_education_hub_v_three_cs_chat";default:return null}};function xi(){var e=Zt.a.get();return e&&e.SPC_F?Zt.a.get:function(){return{SPC_F:Object(_t.a)()}}}function Ri(){return $c()===Oe.ShopeeCn}var Ni=null,Pi=function(e){var t=e.accessPlatform,n=e.operation,a=void 0===n?"click":n,r=e.pageType,o=void 0===r?"":r,i=e.targetType,s=void 0===i?"":i,c=e.data,u=void 0===c?{}:c,l=e.pageSection,d=void 0===l?"":l;if(t||(t=Hc.getState().getIn(["global","accessPlatform"])),t!==Oe.WeChat&&t!==Oe.Gudangku){var p=Object.assign({},{ctx_url:window.location.href},u),f=Hc.getState().getIn(["global","reportMarker"]);Ni({data:{type:"v3",timestamp:+Date.now(),info:{page_type:o||ji(t),page_section:d,target_type:s,operation:a,data:p,accessPlatform:f}}})}},Ui=function(e){var t=e.operation,n=void 0===t?"click":t,a=e.target,r=void 0===a?"":a,o=e.section,i=void 0===o?"":o,s=e.data,c=void 0===s?{}:s,u=Hc.getState().getIn(["chatbot","enabled"]),l=Hc.getState().getIn(["chatbot","sessionInfo"]);if(u&&l.sessionId){var p=Hc.getState().getIn(["global","reportMarker"]);Ni({data:{type:"v3",timestamp:+Date.now(),info:{page_type:"shopee_assistant",page_section:i,target_type:r,operation:n,data:Object(d.a)({ctx_url:window.location.href},c),accessPlatform:p}}}),Mi.report({page_type:yi.MAIN_PAGE,page_section:i,target_type:r,operation:n,data:c})}},Di=(ki={},Object(x.a)(ki,Oe.SellerCenter,"SellerCenter"),Object(x.a)(ki,Oe.EduHub,"EduHub"),ki);function Bi(){var e=$c(),t=Hc.getState().getIn(["chatbot","sessionInfo"]);Ui({section:"session_global",target:"action_session_generated",data:{chat_session_id:t.sessionId,entry_point:Di[e],sub_entry_point:window.location.pathname}})}function Wi(){var e=Hc.getState().getIn(["chatbot","sessionInfo"]);Ui({section:"session_global",target:"minimize_window",data:{chat_session_id:e.sessionId}})}var Hi,Fi,Gi=function(){if(!Ri())return{};var e,t=St("chatbotSessionId"),n=St("prevEnquiryType");try{var a=St("authInfo");e=JSON.parse(a||"{}")}catch(r){e={}}return{current_chat_session_id:t,enquiry_type:n,platform_type:Yo()?"h5":"pc",account_id:e.userId,account_type:e.userId?e.userType===he.MainAccount?"seller":"subaccount":""}},Vi=function(){var e=Object($t.a)({env:"live",locale:"cn".toLowerCase(),source:Yo()?"mobile":"pc",platform:Yo()?"mweb":"pc",appId:Ri()?25:1,ua:navigator?navigator.userAgent||navigator.vendor:"",getCookies:xi(),fetch:window.fetch.bind(window.self),sendEventByInterval:!1,enableAutoTrack:!1});Ni=e.sync.bind(e)},Qi=Object(Q.fromJS)({isLogined:!1,transferChatStatus:"",userId:"",userType:"",token:"",region:"",cancelQueueConfirm:!1,externalSessionId:"",enquiryTypes:[],autoGoEnquiry:!1,isLiveAgentEnable:!0,tocTokenStatus:!0,userEvents:[],botAvatar:"",liveAgentAvatar:""}),qi=function(e){return{type:"UPDATE_SHOW_END_CHAT",payload:e}},Ki=function(e){return{type:"UPDATE_IS_CHATTING",payload:e}},zi=function(e){return{type:"UPDATE_CONNECT_AGENT_SUCCESS",payload:e}},Ji=function(e){return{type:"UPDATE_PREVIEW_MEDIA_INFO",payload:e}},Yi=function(e){return{type:"UPDATE_SHOW_LOGIN_EXPIRED",payload:e}},Xi=function(e){return{type:"UPDATE_SESSION_INFO",payload:e}},Zi=function(e){return{type:"SET_SCROLL_TO_END",payload:e}},$i=function(e){return{type:"UPDATE_SHOW_PULL_HISTORY_BUTTON",payload:e}},es=function(e){return{type:"CANCEL_PULL_HISTORY",payload:e}},ts=function(e){return{type:"UPDATE_USER_ID",payload:e}},ns=function(e){return{type:"UPDATE_LIVE_AGENT_SESSION_ID",payload:e}},as=n(655),rs=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),os=rs.REACT_APP_SERVER_ENV,is=rs.REACT_APP_REGION,ss="https://".concat(It(is,os,!1)),cs="https://chatbot.".concat(wt(os)),us=Tt.a.create({withCredentials:!0});function ls(e,t,n){return ds.apply(this,arguments)}function ds(){return(ds=Object(g.a)(f.a.mark((function e(t,n,a){var r,o,i,s,c,u,l,d,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("cn",r=$c(),o=Zc(r)?{variates:["bot.cncb"]}:{},e.prev=3,!Zc(r)){e.next=15;break}if(!t){e.next=12;break}return e.next=8,us.post("/api/v2/experiment/values",o,{headers:{"chat-access-token":n,"shopee-region":"cn","user-region":a||"cn"}});case 8:return l=e.sent,e.abrupt("return","new_shopee_chatbot"===(null===l||void 0===l||null===(i=l.data)||void 0===i||null===(s=i.variates)||void 0===s||null===(c=s.find)||void 0===c||null===(u=c.call(s,(function(e){return"bot.cncb"===e.variate})))||void 0===u?void 0:u.group));case 12:return e.abrupt("return",!0);case 13:e.next=19;break;case 15:return e.next=17,us.get("/api/v4/deep_platform/ab_test/get_all_layer_configs",{params:o});case 17:return p=e.sent.data,e.abrupt("return","sellerbot"===(null===(d=p.layer_configs.find((function(e){return"bot.sellerbot_pc"===e.name})))||void 0===d?void 0:d.value));case 19:e.next=24;break;case 21:return e.prev=21,e.t0=e.catch(3),e.abrupt("return",!1);case 24:case"end":return e.stop()}}),e,null,[[3,21]])})))).apply(this,arguments)}us.interceptors.request.use((function(e){var t=$c();return e.baseURL=Zc(t)?cs:ss,e})),us.interceptors.response.use((function(e){return e&&e.data}),(function(e){if(ri("error","network error",e.response),"ECONNABORTED"!==e.code&&403!==(e.response&&e.response.status)){var t=e.config&&e.config.url?"".concat(ss).concat(e.config.url):ss;sn.withScope((function(n){n.setTags({api:t,type:"API Request Error"}),n.setExtras({ctx_url:window.location.href,api:t,params:e.config&&e.config.params,status:e.response&&e.response.status,errorCode:e.code,errorResponse:e.response,err:e}),sn.captureException(e)}))}return console.debug("\u8bf7\u6c42\u5931\u8d25: ".concat(e.response&&e.response.status)),Promise.reject(e)})),function(e){e.Init="init",e.Chat="chat",e.Resume="resume",e.End="end",e.Typing="typing",e.ReInit="reInit"}(Hi||(Hi={})),function(e){e.Media="media",e.MultiTerminalConflict="multiTerminalConflict",e.LoginExpired="loginExpired",e.EndChat="endChat",e.Typing="typing",e.GetQueueFailed="getQueueFailed"}(Fi||(Fi={}));var ps,fs=new Proxy(new(function(){function e(){Object(b.a)(this,e),this.status="unInit",this.beenConnectedToAgent=!1,this.sdk=void 0,this.chatbotI18n=void 0,this.formatHistoryMessage=void 0,this.timer=void 0}return Object(E.a)(e,[{key:"create",value:function(){var e=Object(g.a)(f.a.mark((function e(t,n,a,r,o){var i,s,c,u,l,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ss.includes(t)){e.next=29;break}if(s=$c(),u=(c=!!n)?o:"",!Zc(s)){e.next=20;break}if(!c||o){e.next=18;break}return e.next=8,Mo()(Hc.dispatch,Hc.getState);case 8:if(e.t1=l=e.sent,e.t0=null===e.t1,e.t0){e.next=12;break}e.t0=void 0===l;case 12:if(!e.t0){e.next=16;break}e.t2=void 0,e.next=17;break;case 16:e.t2=null===(d=l.data)||void 0===d?void 0:d.access_token;case 17:u=e.t2;case 18:e.next=21;break;case 20:u="";case 21:return e.next=23,ls(c,u,null===r||void 0===r||null===(i=r.toLocaleLowerCase)||void 0===i?void 0:i.call(r));case 23:if(!e.sent){e.next=29;break}if(Hc.dispatch({type:"SET_ENABLED",payload:!0}),Hc.dispatch(ts(null!==n&&void 0!==n?n:null)),null==this.sdk){e.next=28;break}return e.abrupt("return");case 28:this.__create(a,r);case 29:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,o){return e.apply(this,arguments)}}()},{key:"firstInit",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===(n=this.sdk)||void 0===n?void 0:n.shouldInit(t))){e.next=5;break}if("unInit"!==this.status){e.next=5;break}return e.next=4,this.init(!1,t);case 4:Bi();case 5:Jt({type:Gt.Count,value:{label:"cs_chatbot_pv"}});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("inited"!==this.status){e.next=2;break}return e.abrupt("return");case 2:return dd(),this.syncStatus(Hi.Init,t),Cs([Ki(!0)]),r=Hc.getState().getIn(["user","isLogined"]),e.next=8,null===(a=this.sdk)||void 0===a?void 0:a.init(n,r);case 8:o=e.sent,Cs([Xi(o||{}),Il((null===o||void 0===o?void 0:o.initMessageId)||"")]),Et("liveAgentAvatar",null===o||void 0===o?void 0:o.sellerLiveAgentAvatar),_s();case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"reInit",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(n=this.sdk)||void 0===n||n.destroy(),Cs([Bs(),zi(!1)]),this.syncStatus(Hi.ReInit,t),e.next=5,this.init(!0);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stop",value:function(){Cs([Ki(!1),qi(!1)])}},{key:"end",value:function(e){var t;null===(t=this.sdk)||void 0===t||t.end(),this.syncStatus(Hi.End,e),Cs([Ki(!1),qi(!1)])}},{key:"resume",value:function(e,t){var n,a,r,o=Hc.getState().getIn(["conversation","connection"]);if(!t&&e===ps.Cancel){var i=Go.checkMasterIsExist();if(null==o||o.default&&!i)return}(null===(n=this.sdk)||void 0===n||n.resume(e),e===ps.Cancel)&&(null===(a=this.sdk)||void 0===a||null===(r=a.syncChatbotStatus)||void 0===r||r.call(a,{type:Hi.Resume,reason:e},!t));Cs([Ki(!0),qi(!0)])}},{key:"resumeOrInit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ps.Cancel,t=arguments.length>1?arguments[1]:void 0;"end"!==this.status&&("inited"===this.status?this.resume(e):(Cs([Bs(),zi(!1)]),this.init(t)))}},{key:"render",value:function(e){var t;return null===(t=this.sdk)||void 0===t?void 0:t.render(e)}},{key:"pushEnquiryMessage",value:function(){var e;null===(e=this.sdk)||void 0===e||e.appendEnquiryMessage(bs)}},{key:"syncStatus",value:function(e,t){var n,a;e===Hi.End&&(this.status="end"),e===Hi.Init&&(this.status="inited"),null===(n=this.sdk)||void 0===n||null===(a=n.syncChatbotStatus)||void 0===a||a.call(n,{type:e},!t)}},{key:"__create",value:function(e,t){if(Hc.getState().getIn(["chatbot","enabled"])){var n=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),a=n.REACT_APP_SERVER_ENV,r=n.REACT_APP_REGION,o=yt("chat_region"),i=t||o||r,s=Object(as.a)(),c=s.ChatbotSDK,u=s.Provider,l=s.i18n;this.chatbotI18n=l,Hc.dispatch({type:"SET_PROVIDER",payload:u}),this.sdk=new c({root:"cs-chat-main-layout",config:{from:As(),env:a,cid:r,initialization:1,locale:B[e||"en"],fetchInjector:function(e){e.interceptors.request.use((function(e){var t=tu();return e.headers.common["token-suffix"]=t,e}))}},auth:{userRegion:null===i||void 0===i?void 0:i.toLowerCase(),isLogined:Hc.getState().getIn(["user","isLogined"]),redirectToLogin:function(){var e=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xd()(Hc.dispatch,Hc.getState));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getChatAccessToken:function(){var e=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Mo()(Hc.dispatch,Hc.getState));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},agent:{connect:function(e,t){Es(e[0].name,e[0].value,t)},getQueue:ys,getChannelType:function(){var e=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ad()(Hc.dispatch);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}),this.addEventListeners(),this.addSyncMessageListeners(),this.formatHistoryMessage=c.getIsEmptyAndFromForHistory}}},{key:"updateMessageList",value:function(e){var t=[];e.forEach((function(e){var n=Rc()(Hc.dispatch,Hc.getState),a=Hc.getState().getIn(["user","transferChatStatus"]);switch(e.type){case"add":Hc.dispatch(Zi(!0)),t.push({id:e.id,sourceType:dn.Chatbot,from:e.from,isEmpty:e.isEmpty,content:Object(d.a)(Object(d.a)({},e),{},{hashKey:Object(_t.a)()}),timestamp:n});break;case"update":Hc.dispatch(Xs({id:e.id,from:e.from,isEmpty:e.isEmpty,content:Object(d.a)(Object(d.a)({},e),{},{hashKey:Object(_t.a)()})}));break;case"agent":a===fe.Chatting&&Go.isMaster?Ga(e.data.content)(Hc.dispatch,Hc.getState):fr(e.data.content)(Hc.dispatch)}})),t.length>0&&Hc.dispatch(Pa(Object(Q.fromJS)(t)))}},{key:"addEventListeners",value:function(){var e=this;this.sdk.sdkListener.on("messages",(function(t){if("unInit"!==e.status){Os("****** from chatbot message *****");var n=Hc.getState().getIn(["message","messageList"]);if(t.length<=1e4||0===n.size)e.updateMessageList(t);else{e.timer&&clearTimeout(e.timer);var a=t.length;!function n(){if(!(a<=0)){var r=a-5;e.updateMessageList(t.slice(r<0?0:r,a)),a=r,e.timer=setTimeout((function(){n()}),500)}}()}}}));T()((function(e){return Hc.dispatch(Ps(e))}),100);this.sdk.sdkListener.on("show",(function(e){Os("****** from chatbot show *****");var t=e.data;switch(e.type){case Fi.Media:Hc.dispatch(Ji({id:Object(_t.a)(),type:"image"===t.type?fn.Image:fn.Video,url:t.url}));break;case Fi.EndChat:Hc.dispatch(qi(!0));break;case Fi.LoginExpired:Hc.dispatch(Yi(!0));break;case Fi.MultiTerminalConflict:Ot("conflicted","YES"),Hc.dispatch(vl(!0));break;case Fi.Typing:Hc.dispatch(Ps(t.show));break;case Fi.GetQueueFailed:id()(Hc.dispatch,Hc.getState)}})),this.sdk.sdkListener.on("updateSessionInfo",(function(e){Hc.dispatch(Xi(e||{})),Et("liveAgentAvatar",null===e||void 0===e?void 0:e.sellerLiveAgentAvatar),Bi()})),this.sdk.sdkListener.on("updateToken",(function(e){var t=e.chatAccessToken;jo(t)(Hc.dispatch,Hc.getState)}))}},{key:"addSyncMessageListeners",value:function(){var e,t=this,n=(e={},Object(x.a)(e,Hi.Init,(function(){"end"===t.status&&t.reInit(!0),"unInit"===t.status&&t.init(!0)})),Object(x.a)(e,Hi.End,(function(){return t.end(!0)})),Object(x.a)(e,Hi.ReInit,(function(){return t.reInit(!0)})),Object(x.a)(e,Hi.Resume,(function(e){return t.resume(e.reason,!0)})),e);this.sdk.msManager.on("status",(function(e){var t;Os("[status] ****** from chatbot sync status *****"),null===n||void 0===n||null===(t=n[null===e||void 0===e?void 0:e.type])||void 0===t||t.call(n,e)}))}}]),e}()),{get:function(e,t){var n=e[t];return n instanceof Function&&["firstInit","init","reInit","resume","end","render","pushEnquiryMessage","resumeOrInit","formatHistoryMessage"].includes(t)?Hc.getState().getIn(["chatbot","enabled"])?n:function(){}:n}});function gs(e){var t,n,a;return null!==(t=null===fs||void 0===fs||null===(n=fs.chatbotI18n)||void 0===n||null===(a=n.getTrans)||void 0===a?void 0:a.call(n,e))&&void 0!==t?t:""}function hs(e){var t,n=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),a=n.REACT_APP_SERVER_ENV,r=n.REACT_APP_REGION;return null===(t=fs.chatbotI18n)||void 0===t?void 0:t.fetchTranslation({env:a,cid:r,locale:B[e]})}function ms(e){e!==ue.SESSION_CLOSED?Hc.getState().getIn(["user","transferChatStatus"])===fe.Chatting&&fs.end(!0):fs.resumeOrInit(ps.Closed)}function vs(){Hc.getState().getIn(["user","transferChatStatus"])===fe.Chatting?fs.end(!0):fs.resumeOrInit(ps.Error)}function _s(){var e=$c(),t=Hc.getState().getIn(["chatbot","enabled"]),n=Hc.getState().getIn(["user","isLogined"]);if(!Zc(e)||!t||n){var a=Rc()(Hc.dispatch,Hc.getState);Cs([$i(!0),Ds(Object(Q.fromJS)([{id:Object(_t.a)(),sourceType:dn.Chatbot,type:H.History,timestamp:a}]))])}}!function(e){e.NoLiveAgent="noLiveAgent",e.Cancel="cancel",e.Error="error",e.Closed="closed"}(ps||(ps={}));var bs={},Es=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=$c();bs.dialogueId=n.chatbot_dialogue_id,bs.dialogueType=n.chat_entry,Os("live chat"),nd({enquiryType:t,enquiryName:e,extraParams:n})(Hc.dispatch,Hc.getState),Ss.includes(a)&&Cs([go(fe.Transfering),Js("#")]),fs.beenConnectedToAgent||Jt({type:Gt.Count,value:{label:"connect_to_agent"}})},ys=function(){var e=Object(g.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,od()(Hc.dispatch,Hc.getState);case 2:if(t=Hc.getState(),!t.getIn(["conversation","getQuenueConfigError"])){e.next=8;break}return e.next=7,id()(Hc.dispatch,Hc.getState);case 7:throw new Error("get queue failed");case 8:return n=t.getIn(["user","enquiryTypes"]).map((function(e){return{value:e.value,name:e.content}})),e.abrupt("return",{queues:n,content:P.a.t(eu())});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Cs=function(e){return e.forEach((function(e){return Hc.dispatch(e)}))},Ss=[Oe.SellerCenter,Oe.EduHub,Oe.Cnsc,Oe.ShopeeCnEdu];function Os(e){}function As(){var e=Hc.getState().getIn(["global","accessPlatform"]);return Ye[e]}var Ts=We.LastConversationReadMessageId,Is=We.UnloginLastConversationReadMessageId,ws=We.ShopeeChatKey,Ls=We.UnloginShopeeKey,ks=We.Connection,Ms=We.UnloginConnection,js=function(e){return function(t,n){var a=n().getIn(["conversation","queuePositionMax"]);t({type:"UPDATE_QUEUE_POSITION",payload:{position:e,queuePositionMax:a}})}},xs=function(e){return{type:"ADD_CURRENT_MESSAGE_TOTAL",payload:e}},Rs=function(e){return function(t,n){var a=e;null==a&&(a=1);var r=n().getIn(["message","currentMessageTotal"])+a,o=n().getIn(["message","readedMessageTotal"]);if(n().getIn(["global","shouldShowWindow"]))Go.emitReadedMessage({readedCount:r,totalCount:r});else{if(!Go.isMaster)return;Go.emitReadedMessage({readedCount:o,totalCount:r})}t(xs(a))}},Ns=function(e){return{type:"UPDATE_CURRENT_MESSAGE_TOTAL",payload:e}},Ps=function(e){return{type:"SET_AGENT_TYPING",payload:e}},Us=function(e){return{type:"PUSH_MESSAGE_LIST",payload:e}},Ds=function(e){return{type:"INSERT_MESSAGE_LIST",payload:e}},Bs=function(){return{type:"CLEAR_MESSAGE_LIST"}},Ws=function(e){return{type:"UPDATE_SHOULD_AGENT_JOINED",payload:e}},Hs=function(e){return{type:"SET_READED_MESSAGE_TOTAL",payload:e}},Fs=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(n,a){if(t){var r=a().getIn(["message","currentMessageTotal"]);Go.emitReadedMessage({readedCount:r,totalCount:r})}n(Hs(e))}},Gs=function(e){return{type:"AGENT_JOIN_TEXT",payload:e}},Vs=function(e,t){return{type:"UPDATE_MESSAGE_SEQ_ID",id:e,seqId:t}},Qs=function(e,t){return{type:"ADD_SOCKET_MESSAGE",messageList:e,shouldAddNoMore:t}},qs=function(e){return{type:"UPDATE_FETCH_STATUS",payload:e}},Ks=function(e){return{type:"SET_LAST_READ_MESSAGE_ID",payload:e}},zs=function(e){return{type:"UPDATE_CURRENT_LIVEAGENT_MESSAGE_ID",payload:e}},Js=function(e){return{type:"UPDATE_CURRENT_ENQUIRY_MESSAGE_ID",payload:e}},Ys=function(e){return{type:"UPDATE_MESSAGE_STOP_INDEX",payload:e}},Xs=function(e){return{type:"UPDATE_CHATBOT_MESSAGE_CONTENT",payload:e}},Zs=function(e){return function(t,n){var a=n().getIn(["global","accessPlatform"]),o=n().getIn(["message","agentTyping"]),i=n().getIn(["conversation","conversationCanRead"]),s=n().getIn(["user","transferChatStatus"]);o&&t(Ps(!1));var u=[],l=t(Rc()),d=n().getIn(["message","messageList"]),p=n().getIn(["global","supportUnloginChatWithAgent"]),f=function(e){var a=n().getIn(["conversation","restoredConnection"]),r=n().getIn(["conversation","shouldMessageUnreadNumberHandledByHistoryApi"]);a&&r||d.find((function(t){return e===t.get("id")}))||t(Rs())};e.forEach((function(e){var n,o=e.msg_type,d=e.message_id,g=e.chatbot_message_id,h=e.msg_id,m=d||g||h||Object(_t.a)(),v=/^[0-9]+$/.test(m);switch(o){case ue.AGENT_NOT_TYPING:t(Ps(!1));break;case ue.AGENT_TYPING:t(Ps(!0));break;case ue.CS_JOINED:Et("agentName",n=e.content.cs_name),u.push({id:m,type:H.System,status:ln.Success,greeting:!0,content:{text:G.t("cschat_joined_conversation",{name:n}),name:n},timestamp:Math.floor(Date.now()/1e3)}),t(Gs(G.t("cschat_joined_conversation",{name:n}))),t({type:"SET_PREVMESSAGE_TIMESTAMP",payload:Date.now()}),gi(a,G.t("cschat_joined_conversation",{name:n}));break;case ce.ChatRequestFail:case ce.AgentDisconnect:u.push({id:m,type:H.System,content:{text:G.t("cschat_error_message")},timestamp:l});break;case ce.CHAT_TRANSFER:u.push({id:m,type:H.System,content:{text:G.t("cschat_agent_reassign_tips")},timestamp:l});break;case H.Text:s===fe.AgentQueue&&(t(c.updateConnectCount()),t(r.updateTransferChatStatus(fe.Chatting))),u.push({id:m,type:H.Text,content:e.content,sourceType:dn.Agent,timestamp:l}),f(m),i&&(t(Ks(m)),v&&Et(p?Is:Ts,m)),gi(a,"[".concat(yt("agentName"),"]: ").concat(e.content.text));break;case H.File:u.push({id:m,type:H.File,content:e.content,sourceType:dn.Agent,timestamp:l}),f(m),i&&(t(Ks(m)),v&&Et(p?Is:Ts,m)),gi(a,"[".concat(yt("agentName"),"]: [").concat(G.t("cschat_general_file"),"]"));break;case H.Image:u.push({id:m,type:H.Image,content:e.content,sourceType:dn.Agent,timestamp:l}),f(m),i&&(t(Ks(m)),v&&Et(p?Is:Ts,m)),c.stopHeartBeat(),gi(a,"[".concat(yt("agentName"),"]: [").concat(G.t("cschat_general_image"),"]"));break;case H.Video:u.push({id:m,type:H.Video,content:ti(e.content),sourceType:dn.Agent,timestamp:l}),f(m),i&&(t(Ks(m)),v&&Et(p?Is:Ts,m)),gi(a,"[".concat(yt("agentName"),"]: [").concat(G.t("cschat_general_video"),"]"))}})),(u=u.filter((function(e){return!d.find((function(t){return e.id==t.get("id")}))})).sort((function(e,t){return sc(e.id,t.id)}))).length&&t(Us(Object(Q.fromJS)(u)))}},$s=function(e,t,n){return function(a,o){var i,s=[],u=a(Rc()),l=null!==n&&void 0!==n?n:o().getIn(["conversation","conversationStatus"]),d=o().getIn(["user","transferChatStatus"]),p=o().getIn(["global","supportUnloginChatWithAgent"]),f=o().getIn(["chatbot","enabled"]),g=o().getIn(["global","accessPlatform"]);Zc(g)||ru(g)?a(r.updateTransferChatStatus(fe.End)):a(r.updateTransferChatStatus(void 0));var h=f&&d!==fe.Chatting;switch(e){case ue.USER_CLOSE_SESSION:if(l!==fe.Chatting&&!d)return void a(c.updateConversationStatus(fe.Uninitialized));a(Rs()),h||s.push({id:Object(_t.a)(),type:H.System,content:{text:G.t("cschat_client_left_conversation")},timestamp:u}),(d===fe.Chatting||iu(g)&&d!==fe.AgentQueue)&&setTimeout((function(){a(ic(t))}),0);break;case ue.CS_CLOSE_SESSION:i=yt("agentName"),a(Rs()),s.push({id:Object(_t.a)(),type:H.System,content:{text:G.t("cschat_left_conversation",{name:i})},timestamp:u}),Et(p?Ms:ks,""),iu(g)&&a(c.setOldestMessageId("")),setTimeout((function(){a(ic(t))}),0),gi(g,G.t("cschat_left_conversation",{name:i}));break;case ue.SESSION_CLOSE_TIMEOUT:a(Rs()),a(tc(G.t("cschat_session_timeout_end_tips"))),a(ic(t)),Et(p?Ms:ks,""),iu(g)&&a(c.setOldestMessageId("")),gi(g,G.t("cschat_session_timeout_end_tips"));break;case ue.SESSION_CLOSED:a(tc(G.t("cschat_session_end_tips")));break;case ue.CANCEL_QUEUE:d&&(a(r.updateTransferChatStatus(fe.Error)),!f&&a(ac(""))),a(c.updateConversationStatus(fe.Uninitialized));break;default:return void a(c.updateConversationStatus(fe.Uninitialized))}a(c.updateConversationStatus(fe.End)),s.length&&a(Us(Object(Q.fromJS)(s)))}},ec=function(e){return function(t,n){var a=n().getIn(["conversation","conversationStatus"]),r=e&&e.message&&e.message.indexOf("CANCEL_GET_MESSAGE")>-1,o=e&&e.code&&"ECONNABORTED"===e.code&&e.config&&e.config.timeoutErrorMessage&&e.config.timeoutErrorMessage.indexOf("TIMEOUT_ERROT_MESSAGE")>-1;if(a===fe.Uninitialized||a===fe.AgentQueue){if(r)return void t(c.updateConversationStatus(fe.Uninitialized));if(e)return void t(c.updateConversationStatus(fe.SystemError));t(c.updateConversationStatus(fe.QueueError))}else if(o)t(Rs()),t(c.updateConversationStatus(fe.End)),t(tc(G.t("cschat_timeout_tips"))),t(ic()),c.stopHeartBeat();else{if(t(c.updateConversationStatus(fe.Error)),r)return;t(Zs([{type:ce.ChatRequestFail}]))}}},tc=function(e){return function(t){var n=t(Rc()),a={id:Object(_t.a)(),type:H.System,content:{text:e},timestamp:n};t(Us(Object(Q.fromJS)([a])))}},nc=function(){return function(e,t){var n=t().getIn(["conversation","connectCount"]),a=Object(_t.a)(),r=e(Rc()),o={id:a,type:H.LiveAgent,sourceType:dn.Bot,content:{oldConnectCount:n},timestamp:r};e(Us(Object(Q.fromJS)([o]))),e(Ks(a)),e(zs(a))}},ac=function(e){return function(t,n){var a=n().getIn(["conversation","connectCount"]),r=t(Rc()),o=Object(_t.a)(),i={id:o,type:H.QueueError,sourceType:dn.Bot,content:{errorType:e,oldConnectCount:a},timestamp:r};t(Ks(o)),t(Us(Object(Q.fromJS)([i])))}},rc=function(){return function(e){var t=e(Rc()),n={id:Object(_t.a)(),type:H.CancelQueue,sourceType:dn.Agent,content:{},timestamp:t};e(Us(Object(Q.fromJS)([n])))}},oc=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s,u,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n().getIn(["chatbot","enabled"])){e.next=2;break}return e.abrupt("return");case 2:if(a=n().getIn(["message","currentEnquiryMessageId"]),r=n().getIn(["conversation","getQuenueConfigError"]),o=n().getIn(["conversation","tokenIsInvalid"]),i=n().getIn(["user","enquiryTypes"]),!o){e.next=8;break}return e.abrupt("return");case 8:if(!r){e.next=12;break}return e.next=11,t(c.handleEmergencyTemplate());case 11:return e.abrupt("return");case 12:if(!n().getIn(["user","autoGoEnquiry"])){e.next=16;break}return t(c.autoGoEnquiry({enquiryType:i[0].value,enquiryName:i[0].content})),e.abrupt("return");case 16:"#"===a&&(s=Object(_t.a)(),u=t(Rc()),l={id:s,type:H.EnquiryType,sourceType:dn.Bot,content:{},timestamp:u,greeting:!0},t(Us(Object(Q.fromJS)([l]))),t(Ks(s)),t(Js(s)));case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},ic=function(e){return function(t,n){var a,r=n(),o=t(Rc()),i=null!==e&&void 0!==e?e:Object(_t.a)(),s=yt(r.getIn(["global","supportUnloginChatWithAgent"])?Ls:ws),c=r.getIn(["conversation","connectType"]),u={type:H.Csat,id:i,status:ln.Success,shopeeChatKey:s,content:{rateType:"",checkOptions:[],isLoading:!1},timestamp:o};t(Us(Object(Q.fromJS)([u]))),t(Ks(i)),c===ge.inhouse&&(a={tp_session_id:s},hu().post("/v1/report_rating_display",a))}},sc=function(e,t){if("undefined"===typeof e||"undefined"===typeof t)return 0;var n=e.length,a=t.length;if(n!==a)return n-a;for(var r,o=0;o<n;o++)if("undefined"===typeof r&&e[o]!==t[o]){r=parseInt(e[o])-parseInt(t[o]);break}return r};function cc(e){"visible"===document.visibilityState&&"#cschat-pn"===window.location.hash&&setTimeout((function(){var t;null===(t=window.history)||void 0===t||t.replaceState("",document.title,window.location.pathname+window.location.search),hi.emit("displayUnreadMessages",e)}),2e3)}var uc=function(e,t){return function(n,a){var r=[],o=a().getIn(["message","messageList"]),i=a().getIn(["message","lastReadMessageId"]),s=[];e.forEach((function(e){var t,n,a=e.message_id,o=e.send_time,i=e.msg_type,c=e.sender,u=e.content;if(i===ht.HistoryMsgType.TxBot){var l,p,f=null===(l=u)||void 0===l?void 0:l.content;if(f.msg_type===jt.optionsText)f.message_content=null===f||void 0===f||null===(p=f.message_content)||void 0===p?void 0:p.option_msg;var g=f.msg_type,h=f.message_content;u=Object(d.a)(Object(d.a)({},h||{}),{},{msg_type:g})}var m=(u||{}).msg_type,v=(null===(t=u)||void 0===t?void 0:t.content)||{},_=v.text,b=v.url,E=v.thumbnail,y=v.name,C=v.size,S=v.cs_name,O=v.duration,A=Math.floor(o/1e3),T=(n={},Object(x.a)(n,le.User,dn.Client),Object(x.a)(n,le.Agent,dn.Agent),Object(x.a)(n,le.TxBot,dn.Bot),Object(x.a)(n,le.Chatbot,dn.Chatbot),n)[c];if(i===ht.HistoryMsgType.Chatbot){var I=Object.assign({},u,{isHistory:!0,isSendByUser:c===le.User}),w=fs.formatHistoryMessage(I),L=w.from,k=w.isEmpty;r.push({id:a,type:"",from:L,isEmpty:k,content:I,sourceType:dn.Chatbot,timestamp:A})}switch(m){case H.Text:r.push({id:a,type:H.Text,content:{text:_},sourceType:T,timestamp:A}),T!==dn.Client&&s.push(a);break;case H.Image:r.push({id:a,type:H.Image,status:ln.Success,sourceType:T,content:{url:b,isHistory:!0},timestamp:A}),T!==dn.Client&&s.push(a);break;case H.File:r.push({id:a,type:H.File,status:ln.Success,sourceType:T,content:{url:b,name:y,size:C,fileKey:aa(b),progress:100},timestamp:A}),T!==dn.Client&&s.push(a);break;case H.Video:r.push({id:a,type:H.Video,status:ln.Success,sourceType:T,content:{video_info:Object(d.a)(Object(d.a)({},u.content),{},{video_url:qn(b),thumbnail_url:qn(E),duration:O/1e3})},timestamp:A}),T!==dn.Client&&s.push(a);break;case ue.CS_JOINED:r.push({id:a,type:H.System,status:ln.Success,greeting:!0,content:{text:G.t("cschat_joined_conversation",{name:S})},timestamp:A});break;case ue.USER_CLOSE_SESSION:r.push({id:a,type:H.System,content:{text:G.t("cschat_client_left_conversation")},timestamp:A});break;case ue.CS_CLOSE_SESSION:r.push({id:a,type:H.System,content:{text:G.t("cschat_left_conversation",{name:S})},timestamp:A});break;case ue.SESSION_CLOSE_TIMEOUT:r.push({id:a,type:H.System,content:{text:G.t("cschat_session_timeout_end_tips")},timestamp:A});break;case ce.ChatRequestFail:case ce.AgentDisconnect:r.push({id:a,type:H.System,content:{text:G.t("cschat_error_message")},timestamp:A});break;case ce.CHAT_TRANSFER:r.push({id:a,type:H.System,content:{text:G.t("cschat_agent_reassign_tips")},timestamp:A});break;case jt.userText:case jt.text:r.push({id:a,type:H.Text,content:u,sourceType:T,timestamp:A});break;case jt.optionsText:r.push({id:a,type:H.OptionsText,content:u,sourceType:T,timestamp:A});break;case H.Order:r.push({id:a,type:H.Order,status:ln.Success,sourceType:dn.Client,content:Object(d.a)({},u.content),timestamp:A})}}));var u=a().getIn(["conversation","restoredConnection"]),l=a().getIn(["conversation","shouldMessageUnreadNumberHandledByHistoryApi"]),p=a().getIn(["global","supportUnloginChatWithAgent"]),f=u&&l,g=yt(p?Ms:ks),h="#cschat-pn"===window.location.hash&&!g;if(f||h){var m=yt(p?Is:Ts);if(m){var v=s.filter((function(e){return sc(e,m)>0})).sort((function(e,t){return sc(e,t)}));if(n(Rs(v.length)),v.length)if(20===v.length){var _=v[0];n(c.setOldestMessageId(_)),n(lc())}else n(El(!1)),cc(m);else n(El(!1)),cc(m)}else n(El(!1)),cc(m)}if((r=r.filter((function(e){return!o.find((function(t){return e.id==t.get("id")}))})).sort((function(e,t){return sc(e.id,t.id)}))).length){var b=r[0].id;if(n(c.setOldestMessageId(b)),!t){var E=r[r.length-1].id;sc(E,i)>0&&n(Ks(E))}n(Ds(Object(Q.fromJS)(r)))}else{var y=Object(Wt.a)(e);y.sort((function(e,t){return sc(e.message_id,t.message_id)}));var C=y[0].message_id;n(c.setOldestMessageId(C)),n(lc())}}},lc=function(e){return console.log("munual",e),function(){var t=Object(g.a)(f.a.mark((function t(n,a){var o,i,s,c,u,p,g,h,m,v,_,b,E,y,C,S,O,A,T,I,w,L,k,M;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a().getIn(["conversation","oldestMessageId"]),i=a().getIn(["message","fetchHistoryStatus"]),s=a().getIn(["user","userType"]),c=a().getIn(["user","userEvents"]),u=a().getIn(["global","accessPlatform"]),p=a().getIn(["message","messageList"]),g=a().getIn(["chatbot","enabled"]),h=ei(c,me.HistoryMessage),!(s&&s===he.SubAccount&&!Be.includes(u)||(null===p||void 0===p?void 0:p.find((function(e){return e.get("type")===H.RegisterWebform}))))){t.next=10;break}return t.abrupt("return");case 10:if(t.prev=10,m=i===Nt.LOADING,v=i===Nt.NO_MORE,m||v){t.next=25;break}return n(qs(Nt.LOADING)),n($i(!1)),_=Gi(),Pi({targetType:"loading_history",operation:"impression",data:Object(d.a)({},_)}),!h&&e&&(n(r.reportUserEvent(me.HistoryMessage)),Pi({targetType:"loading_history",operation:"action_load_history",data:Object(d.a)({},_)})),g&&Jt({type:Gt.Count,value:{label:"pc_chatbot_load_history"}}),t.next=22,Object(Yt.getChatHistory)(n((function(e,t){var n=t().getIn(["chatbot","enabled"]);if(n)return ht.AppType.ChatbotV2;return ht.AppType.CsChat})),{baseURL:g?En().defaults.baseURL:hu().defaults.baseURL,headers:gu()},{skip_validate_message_id:!0,message_id:o,msg_types:n((function(e,t){var n=$c(),a=t().getIn(["chatbot","enabled"]);if(a)return Zc(n)?[ht.HistoryMsgType.Saleforce,ht.HistoryMsgType.Inhouse,ht.HistoryMsgType.Chatbot,ht.HistoryMsgType.TxBot].join(","):void 0;if(ou(n))return[ht.HistoryMsgType.Saleforce,ht.HistoryMsgType.Inhouse];return[ht.HistoryMsgType.Saleforce,ht.HistoryMsgType.Inhouse,ht.HistoryMsgType.TxBot]})),limit:20},(function(e){e.interceptors.request.use((function(e){var t=gu(e);return Object.entries(t).forEach((function(t){var n=Object(l.a)(t,2),a=n[0],r=n[1];e.headers.common[a]=r})),e}))}));case 22:(b=t.sent)instanceof Error?(g&&(null===(I=b)||void 0===I||null===(w=I.response)||void 0===w||null===(L=w.data)||void 0===L?void 0:L.code)===ee&&n(Yi(!0)),Ql(null===(k=b)||void 0===k?void 0:k.response),n(xc(!0)),n(qs(Nt.NO_MORE)),M={id:Object(_t.a)(),type:H.System,content:{text:G.t("cschat_no_more_data")},isNoMoreMsg:!0},n(Ds(Object(Q.fromJS)([M])))):(g&&Jt({type:Gt.Count,value:{label:"pc_chatbot_load_history_ok"}}),n(xc(!0)),y=(E=b||{}).has_more,C=E.messages,S=void 0===C?[]:C,O=E.no_more_reason,n(qs(y?Nt.NORMAL:Nt.NO_MORE)),S.length&&n(uc(S,o)),y||(A={id:Object(_t.a)(),type:H.System,content:{text:G.t(O?"cschat_data_time_limit":"cschat_no_more_data")}},n(Ds(Object(Q.fromJS)([A]))),T=Gi(),Pi({targetType:O?"no_more_message_exceed_duration":"no_more_message",operation:"impression",data:Object(d.a)({},T)}))),!h&&e&&Pi({targetType:"loading_history",operation:"action_finish_loading",data:Object(d.a)({},_)});case 25:t.next=31;break;case 27:return t.prev=27,t.t0=t.catch(10),n(qs(Nt.ERROR)),t.abrupt("return");case 31:case"end":return t.stop()}}),t,null,[[10,27]])})));return function(e,n){return t.apply(this,arguments)}}()};var dc,pc,fc,gc,hc,mc,vc,_c,bc,Ec,yc,Cc,Sc,Oc,Ac=function(){return function(e,t){var n=Object(_t.a)(),a=e(Rc()),r={id:n,type:H.ServerError,sourceType:dn.Bot,content:{},timestamp:a};e(Us(Object(Q.fromJS)([r]))),e(Ks(n))}},Tc=function(e,t){return function(n,a){var r=a().getIn(["global","accessPlatform"]),o=Object(_t.a)(),i=n(Rc()),s={id:o,type:H.Emergency,sourceType:r!==Oe.Gudangku?dn.Bot:dn.Agent,content:{text:e,showWebButton:t},timestamp:i};n(Us(Object(Q.fromJS)([s]))),n(Ks(o))}},Ic=function(){return function(e,t){var n=Object(_t.a)(),a=e(Rc()),r={id:n,type:H.RegisterWebform,sourceType:dn.Agent,timestamp:a};e(Us(Object(Q.fromJS)([r]))),e(Ks(n))}},wc=function(e){return{type:"SET_PREVMESSAGE_TIMESTAMP",payload:e}},Lc=function(e){return{type:"SET_CLIENT_POLL_TIMEOUT",pollTimeout:1e3*e+5e3}},kc=function(e){return{type:"UPDATE_MESSAGE_DIRECTION",payload:e}},Mc=function(e){return{type:"UPDATE_MESSAGE_LIST_UUID",payload:e}},jc=function(e,t,n){return{type:"SET_RATE_MESSAGE_CONTENT",messageId:e,key:t,value:n}},xc=function(e){return{type:"SET_HAS_FETCHED_HISTORY_FLAG",payload:e}},Rc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return function(t,n){var a,r=n().getIn(["message","prevMessageTimestamp"]);return(!r||e-r>3e5)&&(a=Math.floor(e/1e3),t(wc(e))),a}},Nc=Object(Q.fromJS)({files:[],currentFileLength:0}),Pc=function(e){return{type:"ADD_FILES",payload:e}},Uc=function(e){return{type:"UPDATE_FILES",payload:e}},Dc=Object(Q.fromJS)({enabled:!1,chatting:!1,showEndChat:!1,showLoginExpired:!1,connectAgentSuccess:!1,provider:null,sessionInfo:{},scrollToEnd:!1,showPullHistoryButton:!1,cancelPullHistory:!1,userId:null,liveAgentSessionId:""}),Bc=Object(Bt.combineReducers)({global:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ft,t=arguments.length>1?arguments[1]:void 0,n=e.set("accessPlatform",t.payload),a=e.get("isInputFocus"),r=e.get("feedbackOptions");switch(t.type){case"UPDATE_SHOULD_SHOW_WINDOW":return e.set("shouldShowWindow",t.payload);case"UPDATE_NETWORK_STATUS":return e.set("networkStatus",t.payload);case"UPDATE_ACCESS_PLATFORM":return[Oe.WeChat].includes(t.payload)&&(n=n.set("isMobileStyle",!0)),n;case"UPDATE_TOAST":return t.payload&&t.payload.msg&&window.csChatToastContainer&&pt.open({message:t.payload.msg,getContainer:function(){return window.csChatToastContainer}}),e.set("toast",t.payload);case"UPDATE_IS_INPUT_FOCUS":return a!==t.payload?e.set("isInputFocus",t.payload):e;case"UPDATE_IS_MOBILE_STYLE":return e.set("isMobileStyle",t.payload);case"UPDATE_MOBILE_CONFIRM_MODAL_OPTION":return e.update("mobileConfirmModalOption",(function(e){return Object(Q.fromJS)(Object(d.a)(Object(d.a)({},e.toJS()),t.payload))}));case"UPDATE_FEEDBACK_OPTIONS":return e.set("feedbackOptions",Object(d.a)(Object(d.a)({},r),{},Object(x.a)({},t.payload.type,t.payload.options)));case"UPDATE_SHOW_ORDER_MODAL":return e.set("showOrderModal",t.payload);case"UPDATE_TOKEN":return e.set("token",t.payload);case"UPDATE_REPORT_MARKER":return e.set("reportMarker",t.payload);case"SET_PLATFORM_TOKEN_METHOD":return e.set("getPlatformTokenMethod",t.payload);case"SET_SUPPORT_UNLOGINED_CHAT_WITH_AGENT":return e.set("supportUnloginChatWithAgent",t.payload);case"SET_CAN_CLICK_ENTRY":return e.set("canClickEntry",t.payload);default:return e}},conversation:function(){var e,t,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mt,r=arguments.length>1?arguments[1]:void 0,o=a.get("connectCount");switch(r.type){case"UPDATE_CONVERSATION_STATUS":return a.merge({conversationStatus:r.payload});case"UPDATE_NO_VALID_AGENT_INFO":return a.merge({noValidAgentReason:(null===(e=r.payload)||void 0===e?void 0:e.reason)||"",showLeaveMessageBtn:"boolean"!==typeof(null===(t=r.payload)||void 0===t?void 0:t.hidden_webform_link)||!(null===(n=r.payload)||void 0===n?void 0:n.hidden_webform_link)});case"SETTING_SESSION_KEY":return a.set("sessionKey",r.payload);case"UPDATE_CONFLICTED":return a.set("showConflicted",r.payload);case"UPDATE_DISABLE_MINIMIZE":return a.set("disableMinimize",r.payload);case"SET_NEED_UPDATE_CONVERSATION":return a.set("needKeepConversation",r.payload);case"UPDATE_CONNECTION":return a.set("connection",r.payload);case"UPDATE_RESTORED_CONNECTION":return a.set("restoredConnection",r.payload);case"SKIP_ADDING_UNREAD_NUMBER_AFTER_RESTORE":return a.set("shouldMessageUnreadNumberHandledByHistoryApi",r.payload);case"SET_CONVERSATION_CAN_READ":return a.set("conversationCanRead",r.payload);case"SET_OLDEST_MESSAGE_ID":return a.set("oldestMessageId",r.payload);case"SET_HEART_BEAT_INTERVAL":return a.set("heartBeatInterval",r.payload);case"SET_CURRENT_CONNECT_TYPE":return a.set("connectType",r.payload);case"UPDATE_CONNECT_COUNT":return a.set("connectCount",o+1);case"GET_QUEUE_CONFIG_ERROR":return a.set("getQuenueConfigError",r.payload);case"SET_TOKEN_IS_INVALID":return a.set("tokenIsInvalid",r.payload);case"SET_OFFLINE_FORM_URL":return a.set("offlineFormUrl",r.payload);case"UPDATE_INHOUSE_USERTYPE":return a.set("inhouseUserType",r.payload);case"SET_WEB_FORM_PLATFORM":return a.set("webFormPlatform",r.payload);case"UPDATE_IGNORE_CCU":return a.set("ignoreCCU",r.payload);case"UPDATE_CONNECTION_CONFIG_INFO":return a.set("connectionConfigInfo",r.payload);case"UPDATE_QUEUE_POSITION_MAX":return a.set("queuePositionMax",r.payload);case"UPDATE_AGENT_NAME":return a.set("agentName",r.payload);default:return a}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vt,t=arguments.length>1?arguments[1]:void 0,n=e.get("messageList");switch(t.type){case"UPDATE_QUEUE_POSITION":var a=t.payload,r=a.position,o=a.queuePositionMax,i="#".concat(r||0);return o>0&&r>o&&(i="#".concat(o,"+")),e.merge({queuePosition:r,displayQueuePosition:i});case"ADD_CURRENT_MESSAGE_TOTAL":var s=t.payload;return null==s&&(s=1),e.set("currentMessageTotal",e.get("currentMessageTotal")+s);case"UPDATE_CURRENT_MESSAGE_TOTAL":return e.set("currentMessageTotal",t.payload);case"SET_READED_MESSAGE_TOTAL":return null!=t.payload?e.merge({readedMessageTotal:t.payload}):e.merge({readedMessageTotal:e.get("currentMessageTotal")});case"SET_AGENT_TYPING":return e.merge({agentTyping:t.payload});case"PUSH_MESSAGE_LIST":return e.merge({messageList:n.concat(t.payload)});case"INSERT_MESSAGE_LIST":return e.merge({messageList:t.payload.concat(n)});case"SET_PREVMESSAGE_TIMESTAMP":return e.merge({prevMessageTimestamp:t.payload});case"SET_LAST_READ_MESSAGE_ID":return e.set("lastReadMessageId",t.payload);case"SET_HAS_FETCHED_HISTORY_FLAG":return e.set("hasFetchedHistory",t.payload);case"UPDATE_MESSAGE_STATUS":return e.update("messageList",(function(e){return e.map((function(e){return e.get("id")===t.id?e.set("status",t.status):e}))}));case"UPDATE_MESSAGE_SEQ_ID":return e.update("messageList",(function(e){return e.map((function(e){return e.get("id")===t.id?e.set("seqId",t.seqId):e}))}));case"UPDATE_IMAGE_MESSAGE_STATUS":return e.update("messageList",(function(e){return e.map((function(e){if(e.get("id")===t.id){var n=e.set("status",t.status);return n=n.setIn(["content","url"],t.url)}return e}))}));case"UPDATE_MESSAGE_ID":return e.update("messageList",(function(e){return e.map((function(e){return e.get("id")===t.uid?e.set("id",t.msgId):e}))}));case"REMOVE_MESSAGE_ITEM":return e.update("messageList",(function(e){var n=e.findIndex((function(e){return e.get("id")===t.id}));return-1!==n?e.delete(n):e}));case"CLEAR_MESSAGE_LIST":return e.set("messageList",Object(Q.fromJS)([]));case"UPDATE_SHOULD_AGENT_JOINED":return e.set("shouldShowAgentJoined",t.payload);case"SET_CLIENT_POLL_TIMEOUT":return e.set("clientPollTimeout",t.pollTimeout);case"SET_RATE_MESSAGE_CONTENT":return e.update("messageList",(function(e){return e.map((function(e){return e.get("id")===t.messageId?e.setIn(["content",t.key],Object(Q.fromJS)(t.value)):e}))}));case"AGENT_JOIN_TEXT":return e.set("agentJoinText",t.payload);case"UPDATE_FETCH_STATUS":return e.set("fetchHistoryStatus",t.payload);case"UPDATE_MESSAGE_DIRECTION":return e.set("messageDirection",t.payload);case"ADD_SOCKET_MESSAGE":return e.update("messageList",(function(e){var a,r=e.toJS().map((function(e){return e.id})),o=[];return t.messageList.forEach((function(e){r.includes(e.id)||o.push(e)})),(o=o.filter((function(e,t,n){return n.findIndex((function(t){return t.seqId===e.seqId}))===t}))).sort((function(e,t){return"string"===typeof e.seqId&&"string"===typeof t.seqId?Ft()(e.seqId).subtract(t.seqId):0})),o.forEach((function(e,t){0!==t&&(e.timestamp=0)})),n=(a=n).unshift.apply(a,Object(Wt.a)(Object(Q.fromJS)(o))),Object(Q.fromJS)(n)}));case"UPDATE_FILE_MESSAGE_STATUS":return e.update("messageList",(function(e){return e.map((function(e){if(e.get("id")===t.id){var n=e.set("status",t.status);return n=n.setIn(["content","url"],t.url)}return e}))}));case"UPDATE_FILE_MESSAGE_PROGRESS":return e.update("messageList",(function(e){return e.map((function(e){return e.get("id")===t.id?e.setIn(["content","progress"],t.progress):e}))}));case"UPDATE_FILE_MESSAGE_CONTENT":return e.update("messageList",(function(e){return e.map((function(e){if(e.get("id")===t.id){var n=e;return Object.keys(t.payload).forEach((function(e){n=n.setIn(["content",e],t.payload[e])})),n}return e}))}));case"UPDATE_VIDEO_MESSAGE_INFO":return e.update("messageList",(function(e){return e.map((function(e){if(e.get("id")===t.id){var n=e;return Object.keys(t.payload).forEach((function(e){n=n.setIn(["content","video_info",e],t.payload[e])})),n}return e}))}));case"SET_VIDEO_FILE_MAP_RECORD":return e.update("videoFileMap",(function(e){return e.set(t.id,Object(Q.fromJS)(t.payload))}));case"UPDATE_VIDEO_FILE_MAP_RECORD":return e.update("videoFileMap",(function(e){return e.update(t.id,(function(e){return Object(Q.fromJS)(Object(d.a)(Object(d.a)({},e.toJS()),t.payload))}))}));case"DELETE_VIDEO_FILE_MAP_RECORD":return e.update("videoFileMap",(function(e){return e.delete(t.id)}));case"UPDATE_CURRENT_LIVEAGENT_MESSAGE_ID":return e.set("currentLiveAgentMessageId",t.payload);case"UPDATE_CURRENT_ENQUIRY_MESSAGE_ID":return e.set("currentEnquiryMessageId",t.payload);case"UPDATE_MESSAGE_STOP_INDEX":return e.set("messageStopIndex",t.payload);case"UPDATE_CHATBOT_MESSAGE_CONTENT":return e.update("messageList",(function(e){return e.map((function(e){return e.get("id")===t.payload.id?e.set("content",Object(Q.fromJS)(t.payload.content)):e}))}));case"UPDATE_MESSAGE_LIST_UUID":return e.set("messageListUUID",t.payload);default:return e}},socket:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Er,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_SESSION":return e.set("session",t.sessionId).set("userId",t.userId);case"UPDATE_USER_ID":return e.set("userId",t.payload);case"UPDATE_USER_TYPE":return e.set("userType",t.payload);case"UPDATE_USER_TOKEN":return e.set("token",t.payload);case"UPDATE_USER_AUTHINFO":return e.set("userId",t.payload.userId).set("token",t.payload.token).set("userType",t.payload.userType);default:return e}},file:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Nc,t=arguments.length>1?arguments[1]:void 0,n=e.get("files");switch(t.type){case"UPDATE_FILES":return e.merge({files:Object(Q.fromJS)(t.payload),currentFileLength:t.payload.length});case"ADD_FILES":return e.merge({files:Object(Q.fromJS)(n.concat(t.payload)),currentFileLength:e.get("currentFileLength")+t.payload.length});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qi,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"UPDATE_LOGIN_STATUS":return e.set("isLogined",a);case"UPDATE_TRANSFER_CHAT_STATUS":return e.set("transferChatStatus",a);case"CANCEL_QUEUE_CONFIRM":return e.set("cancelQueueConfirm",a);case"UPDATE_ENQUIRY_TYPES":return e.set("enquiryTypes",a);case"AUTO_GO_ENQUIRY":return e.set("autoGoEnquiry",a);case"UPDATE_LOGIN_USER_AUTHINFO":return e.set("userId",t.payload.userId).set("token",t.payload.token).set("region",t.payload.region).set("userType",t.payload.userType);case"UPDATE_EXTERNAL_SESSION_ID":return e.set("externalSessionId",t.payload);case"UPDATE_LOGIN_USER_TYPE":return e.set("userType",t.payload);case"UPDATE_LIVEAGENT_ENABLE":return e.set("isLiveAgentEnable",t.payload);case"TOC_TOKEN_STATUS":return e.set("tocTokenStatus",t.payload);case"SET_USER_ALL_EVENT":return e.set("userEvents",t.payload);case"DONE_USER_EVENT":return e.update("userEvents",(function(e){return e.map((function(e){return e.get("event_id")===t.payload?e.set("status",1):e}))}));case"SET_BOT_AVATAR":return e.set("botAvatar",t.payload);case"SET_LIVE_AGENT_AVATAR":return e.set("liveAgentAvatar",t.payload);case"UPDATE_USERID":return e.set("userId",t.payload);default:return e}},chatbot:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Dc,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ENABLED":return e.set("enabled",t.payload);case"SET_PROVIDER":return e.set("provider",t.payload);case"UPDATE_SHOW_END_CHAT":return e.set("showEndChat",t.payload);case"UPDATE_IS_CHATTING":return e.set("chatting",t.payload);case"UPDATE_CONNECT_AGENT_SUCCESS":return e.set("connectAgentSuccess",t.payload);case"UPDATE_PREVIEW_MEDIA_INFO":return e.set("mediaInfo",t.payload);case"UPDATE_SHOW_LOGIN_EXPIRED":return e.set("showLoginExpired",t.payload);case"UPDATE_SESSION_INFO":return e.set("sessionInfo",Object(d.a)(Object(d.a)({},e.sessionInfo),t.payload));case"SET_SCROLL_TO_END":return e.set("scrollToEnd",t.payload);case"UPDATE_SHOW_PULL_HISTORY_BUTTON":return e.set("showPullHistoryButton",t.payload);case"CANCEL_PULL_HISTORY":return e.set("cancelPullHistory",t.payload);case"UPDATE_USER_ID":return e.set("userId",t.payload);case"UPDATE_LIVE_AGENT_SESSION_ID":return e.set("liveAgentSessionId",t.payload);default:return e}}}),Wc=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Ut.c,Hc=Object(Ut.d)(Bc,Wc(Object(Ut.a)(Dt.a))),Fc=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),Gc=Fc.REACT_APP_SERVER_ENV,Vc=Fc.REACT_APP_REGION,Qc=We.UUID,qc=We.ShopeeChatKey,Kc=We.UnloginShopeeKey;!function(e){e.userType="userType"}(Sc||(Sc={})),function(e){e[e.chatbot=2]="chatbot"}(Oc||(Oc={}));var zc,Jc=(Cc={},Object(x.a)(Cc,Ve.ID,Object(x.a)({},Oe.SellerCenter,(dc={},Object(x.a)(dc,qe.Test,{url:"https://help.test.shopee.co.id/portal/webform/6bdd0fd4d49742c88754632b7962ac67",fieldIdMap:Object(x.a)({},Sc.userType,"d829ccc80a")}),Object(x.a)(dc,qe.Uat,{url:"https://help.uat.shopee.co.id/portal/webform/d8265e72f81e412dbe49a75b70503178",fieldIdMap:Object(x.a)({},Sc.userType,"e7105a65fe")}),Object(x.a)(dc,qe.Live,{url:"https://help.shopee.co.id/portal/webform/888adc066bf3426a8c70227470281818",fieldIdMap:Object(x.a)({},Sc.userType,"97583cad69")}),dc))),Object(x.a)(Cc,Ve.SG,Object(x.a)({},Oe.SellerCenter,(pc={},Object(x.a)(pc,qe.Test,{url:"https://help.test.shopee.sg/portal/webform/da4f125ef2ae4528a0066a61e59585d9"}),Object(x.a)(pc,qe.Uat,{url:"https://help.uat.shopee.sg/portal/webform/8fe44cc3c64e49559c834bf4f27c5e89"}),Object(x.a)(pc,qe.Live,{url:"https://help.shopee.sg/portal/webform/ee0c1a998ef244c185faad98b8a5c014"}),pc))),Object(x.a)(Cc,Ve.MX,Object(x.a)({},Oe.SellerCenter,(fc={},Object(x.a)(fc,qe.Test,{url:"https://help.test.shopee.com.mx/portal/webform/e8ee4789ebbd4353b0d184ce401e0955",fieldIdMap:Object(x.a)({},Sc.userType,"a17672d5d2")}),Object(x.a)(fc,qe.Uat,{url:"https://help.uat.shopee.com.mx/portal/webform/618a16d19d254102a2f051454a65c02e",fieldIdMap:Object(x.a)({},Sc.userType,"56a38729c8")}),Object(x.a)(fc,qe.Live,{url:"https://help.shopee.com.mx/portal/webform/e58cb9c620f54aec9e18a01632c35c05",fieldIdMap:Object(x.a)({},Sc.userType,"3a92e53322")}),fc))),Object(x.a)(Cc,Ve.BR,Object(x.a)({},Oe.SellerCenter,(gc={},Object(x.a)(gc,qe.Test,{url:"https://help.test.shopee.com.br/portal/webform/46428b658ab741ae95818b80eff97e11",fieldIdMap:Object(x.a)({},Sc.userType,"f6dff572cf")}),Object(x.a)(gc,qe.Uat,{url:"https://help.uat.shopee.com.br/portal/webform/9cf978e76c58400aaffd3da5e03253e0",fieldIdMap:Object(x.a)({},Sc.userType,"69b597aeba")}),Object(x.a)(gc,qe.Live,{url:"https://help.shopee.com.br/portal/webform/d75e2dbb49594bd19d1ea83485339a45",fieldIdMap:Object(x.a)({},Sc.userType,"3a92e53322")}),gc))),Object(x.a)(Cc,Ve.VN,Object(x.a)({},Oe.SellerCenter,(hc={},Object(x.a)(hc,qe.Test,{url:"https://help.test.shopee.vn/portal/webform/3491efa01d424a1495bb0e854f09fd81",fieldIdMap:Object(x.a)({},Sc.userType,"541ee5bb7d")}),Object(x.a)(hc,qe.Uat,{url:"https://help.uat.shopee.vn/portal/webform/bdb1b308a6a04556ba3fa6fa8a446034",fieldIdMap:Object(x.a)({},Sc.userType,"10088eae06")}),Object(x.a)(hc,qe.Live,{url:"https://help.shopee.vn/portal/webform/9e0e87184cf14246aabe6af0d78b2aa9",fieldIdMap:Object(x.a)({},Sc.userType,"31aa7595ea")}),hc))),Object(x.a)(Cc,Ve.TW,Object(x.a)({},Oe.SellerCenter,(mc={},Object(x.a)(mc,qe.Test,{url:"https://help.test.shopee.tw/portal/webform/b535f46013504c6f99d2f79d01135912",fieldIdMap:Object(x.a)({},Sc.userType,"3fa627bb28")}),Object(x.a)(mc,qe.Uat,{url:"https://help.uat.shopee.tw/portal/webform/2ccab23ea9b244658366cb71884270f7",fieldIdMap:Object(x.a)({},Sc.userType,"87c3b1cab8")}),Object(x.a)(mc,qe.Live,{url:"https://help.shopee.tw/portal/webform/1bfa4a9834204eccb62858d0e2d9e083",fieldIdMap:Object(x.a)({},Sc.userType,"cb2a35d098")}),mc))),Object(x.a)(Cc,Ve.MY,Object(x.a)({},Oe.SellerCenter,(vc={},Object(x.a)(vc,qe.Test,{url:"https://help.test.shopee.com.my/portal/webform/dd8b9cd30b574c228a40b9430076d5b2",fieldIdMap:Object(x.a)({},Sc.userType,"8da0299b3d")}),Object(x.a)(vc,qe.Uat,{url:"https://help.uat.shopee.com.my/portal/webform/5df89a77cbe746f9909b4f495ff68173",fieldIdMap:Object(x.a)({},Sc.userType,"9757633996")}),Object(x.a)(vc,qe.Live,{url:"https://help.shopee.com.my/portal/webform/b7a7ff2afd484f1dbddb3a922c7e90e7",fieldIdMap:Object(x.a)({},Sc.userType,"31aa7595ea")}),vc))),Object(x.a)(Cc,Ve.TH,Object(x.a)({},Oe.SellerCenter,(_c={},Object(x.a)(_c,qe.Test,{url:"https://help.test.shopee.co.th/portal/webform/cba6309f3d12499ca3c70ad413f59156",fieldIdMap:Object(x.a)({},Sc.userType,"6f3d5f602d")}),Object(x.a)(_c,qe.Uat,{url:"https://help.uat.shopee.co.th/portal/webform/d05764dca49e4773aba918d9b7fafe3b",fieldIdMap:Object(x.a)({},Sc.userType,"95919c776d")}),Object(x.a)(_c,qe.Live,{url:"https://help.shopee.co.th/portal/webform/38e4b86fd0c04ae3b2c9200c7ea9c89e",fieldIdMap:Object(x.a)({},Sc.userType,"31aa7595ea")}),_c))),Object(x.a)(Cc,Ve.PH,Object(x.a)({},Oe.SellerCenter,(bc={},Object(x.a)(bc,qe.Test,{url:"https://help.test.shopee.ph/portal/webform/50b81eb0366c481da32e139d533e6e6c",fieldIdMap:Object(x.a)({},Sc.userType,"3ffebeaddc")}),Object(x.a)(bc,qe.Uat,{url:"https://help.uat.shopee.ph/portal/webform/40a4b6d211714842bf59a824cb4f28b6",fieldIdMap:Object(x.a)({},Sc.userType,"d487c0c0a3")}),Object(x.a)(bc,qe.Live,{url:"https://help.shopee.ph/portal/webform/bafd4812311d417c981d2690cda870bf",fieldIdMap:Object(x.a)({},Sc.userType,"31aa7595ea")}),bc))),Object(x.a)(Cc,Ve.PL,Object(x.a)({},Oe.SellerCenter,(Ec={},Object(x.a)(Ec,qe.Test,{url:"https://help.test.shopee.pl/portal/webform/a23d309abcee4b4a88fd76e1bd675c6a",fieldIdMap:Object(x.a)({},Sc.userType,"47a14870d6")}),Object(x.a)(Ec,qe.Uat,{url:"https://help.uat.shopee.pl/portal/webform/47cf560dfc4d4edeab86af7c6421bfb3",fieldIdMap:Object(x.a)({},Sc.userType,"d8c3624d28")}),Object(x.a)(Ec,qe.Live,{url:"https://help.shopee.pl/portal/webform/3e8f2872acee4938951fa12e61f5b3f6",fieldIdMap:Object(x.a)({},Sc.userType,"f4c6a0307c")}),Ec))),Object(x.a)(Cc,Ve.ES,Object(x.a)({},Oe.SellerCenter,(yc={},Object(x.a)(yc,qe.Test,{url:"https://help.test.shopee.es/portal/webform/4d1ff11c5c6246b3b71a5900e2ad8826",fieldIdMap:Object(x.a)({},Sc.userType,"94e923a8bb")}),Object(x.a)(yc,qe.Uat,{url:"https://help.uat.shopee.es/portal/webform/83c202893d744e24b9626bd035748ae4",fieldIdMap:Object(x.a)({},Sc.userType,"84708516ab")}),Object(x.a)(yc,qe.Live,{url:"https://help.shopee.es/portal/webform/756295fca7a04f0cb25cf51821ced04f",fieldIdMap:Object(x.a)({},Sc.userType,"f4c6a0307c")}),yc))),Cc)[Vc]||{},Yc=function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o,i,s,u,l,d,p,g,h,m,v,_,b,E,y;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",a=Hc.getState().getIn(["global","supportUnloginChatWithAgent"]),null!==(r=Hc.getState().getIn(["conversation","offlineFormUrl"]))){e.next=14;break}return e.prev=4,e.next=7,yu({channel:Zc(t)?Hl[t]:void 0,entry_point:Fl[t]});case 7:0===(null===(o=e.sent)||void 0===o?void 0:o.code)&&(i=o.data,s=i.web_form_url,u=i.web_form_platform,r=s,Hc.dispatch(c.setOfflineFormUrl(s)),Hc.dispatch(c.setWebFormPlatform(u))),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.log(e.t0);case 14:l=Hc.getState().getIn(["conversation","webFormPlatform"]),d=!0,p="userType",e.t1=t,e.next=e.t1===Oe.ShopeeCn||e.t1===Oe.ShopeeCnEdu||e.t1===Oe.Cnsc||e.t1===Oe.WeChat?20:e.t1===Oe.Gudangku?43:e.t1===Oe.SPX||e.t1===Oe.SPXHelp?45:e.t1===Oe.SellerCenter||e.t1===Oe.EduHub?48:56;break;case 20:if(g=new URLSearchParams({entryPoint:String(Oc.chatbot)}),!r){e.next=26;break}n=r,l===ge.inhouse&&(n+="".concat(n.includes("?")?"&":"?").concat(g)),e.next=42;break;case 26:if(l!==ge.salesforce){e.next=30;break}n=Gc===qe.Live?"https://shopee-help.force.com/sz/s/contactus":"https://fullcopy-shopee-help.cs111.force.com/sz/s/contactus",e.next=42;break;case 30:e.t2=Gc,e.next=e.t2===qe.Live?33:e.t2===qe.Uat?35:e.t2===qe.Test?37:39;break;case 33:return n="https://help.shopee.cn/portal/webform/5c2ecc01114e46789a5b39a9d185d8fd",e.abrupt("break",41);case 35:return n="https://help.uat.shopee.cn/portal/webform/5235ea2c330849cf8d8250c1156a3b0a",e.abrupt("break",41);case 37:case 39:return n="https://help.test.shopee.cn/portal/webform/947aa5edd1a74f6bb196fcd24bd35be1",e.abrupt("break",41);case 41:n+="?".concat(g);case 42:return e.abrupt("break",57);case 43:return a?n=Vc===Ve.ID?Gc===qe.Live?"https://shopee-help.force.com/s/preloginform":"https://fullcopy-shopee-help.cs111.force.com/s/preloginform":Gc===qe.Live?"https://help.shopee.vn/vn/s/preloginform":"https://fullcopy-shopee-help.cs111.force.com/vn/s/preloginform":Vc===Ve.ID?n=Gc===qe.Live?"https://shopee-help.force.com/s/webform":"https://fullcopy-shopee-help.cs111.force.com/s/webform":(h=Gc===qe.Live?"":"".concat(qe.Test,"."),n="https://help.".concat(h,"shopee.vn/vn/s/webform")),e.abrupt("break",57);case 45:return m=Gc===qe.Live?"":Gc===qe.Uat?"".concat(qe.Uat,"."):"".concat(qe.Test,"."),n="https://help.".concat(m,"shopee.vn/vn/s/spxwebform"),e.abrupt("break",57);case 48:return _=null===Jc||void 0===Jc||null===(v=Jc[Oe.SellerCenter])||void 0===v?void 0:v[Gc],r?(n=r,l===ge.inhouse&&(null===_||void 0===_?void 0:_.fieldIdMap)&&(p=_.fieldIdMap[Sc.userType])):Vc===Ve.ID?l===ge.salesforce?n="https://help.".concat(It(Vc,Gc),"/s/contactusform"):(n=_.url,p=_.fieldIdMap[Sc.userType]):Vc===Ve.SG?l===ge.salesforce?n="https://help.".concat(It(Vc,Gc),"/").concat(Vc,"/s/contactusform"):(n=_.url,d=!1):[Ve.VN,Ve.TW,Ve.MY,Ve.TH,Ve.PH].includes(Vc)||Vc===Ve.MX||Vc===Ve.BR?l===ge.salesforce?n="https://help.".concat(It(Vc,Gc),"/").concat(Vc,"/s/contactusform"):(n=_.url,p=_.fieldIdMap[Sc.userType]):[Ve.PL,Ve.ES].includes(Vc)?l===ge.salesforce?n=Gc===qe.Live?"https://shopee-help.force.com/".concat(Vc,"/s/contactusform"):"https://fullcopy-shopee-help.cs111.force.com/".concat(Vc,"/s/contactusform"):(n=_.url,p=_.fieldIdMap[Sc.userType]):n=[Ve.FR,Ve.AR].includes(Vc)?Gc===qe.Live?"https://shopee-help.force.com/".concat(Vc,"/s/contactusform"):"https://fullcopy-shopee-help.cs111.force.com/".concat(Vc,"/s/contactusform"):Vc===Ve.IN?"https://help.shopee.in/portal/webform/19c090e43e014e24be276dc9fbc7dc93":"https://help.".concat(It(Vc,Gc),"/").concat(Vc,"/s/contactusform"),b=yt(a?Kc:qc),E=d?Object(x.a)({},p,Qe[Vc]):{},l===ge.salesforce?E.chatkey=b:E.entryPoint=Oc.chatbot,y=new URLSearchParams(E),n+="".concat(n.includes("?")?"&":"?").concat(y),e.abrupt("break",57);case 56:return e.abrupt("break",57);case 57:window.open(n);case 58:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}(),Xc=function(){var e="https://csp.".concat("live"===Gc?"":"".concat(Gc,"."),"shopee.com/api/v1/wxwork/oauth/authurl");return"https://".concat("live"===Gc?"":"".concat(Gc,"."),"shopee.cn/api/oauth_login/?redirect_url=").concat(e,"&lang=zh-Hans&login_types=").concat(JSON.stringify([1]))},Zc=function(e){return[Oe.Cnsc,Oe.ShopeeCn,Oe.WeChat,Oe.ShopeeCnEdu].includes(e)},$c=function(){return Hc.getState().getIn(["global","accessPlatform"])},eu=function(){var e=$c();return ou(e)?"cschat_enquiry_spx_greeting":ru(e)?"cschat_enquiry_seller_greeting":"cschat_enquiry_message_title"},tu=function(){var e=yt(Qc);return e||($c()===Oe.WeChat?(e=function(e){if(document.cookie.length>0){var t=document.cookie.indexOf(e+"=");if(-1!==t){t=t+e.length+1;var n=document.cookie.indexOf(";",t);return-1===n&&(n=document.cookie.length),unescape(document.cookie.substring(t,n))}}return""}("uuid"))||function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=new Date;a.setDate(a.getDate()+n),document.cookie=e+"="+escape(t)+(null==n?"":";expires="+a.toGMTString())}("uuid",e=Object(_t.a)()):(e=St("uuid"))||(e=Object(_t.a)()),Et(Qc,e),e)},nu={sg:"https://cf.shopee.sg/file/",my:"https://cf.shopee.com.my/file/",ph:"https://cf.shopee.ph/file/",tw:"https://cf.shopee.tw/file/",vn:"https://cf.shopee.vn/file/",th:"https://cf.shopee.co.th/file/",id:"https://cf.shopee.co.id/file/",br:"https://cf.shopee.com.br/file/",mx:"https://cf.shopee.com.mx/file/",co:"https://cf.shopee.com.co/file/",cl:"https://cf.shopee.cl/file/",ar:"https://cf.shopee.com.ar/file/",pl:"https://cf.shopee.pl/file/",fr:"https://cf.shopee.fr/file/",es:"https://cf.shopee.es/file/",in:"https://cf.shopee.in/file/"},au=function(e){var t=yt("chat_region")||Vc;return"".concat(nu[t]).concat(e)},ru=function(e){var t=yt("chat_region")||"cn",n=Hc.getState().getIn(["conversation","connectType"])===ge.inhouse;return[Oe.SellerCenter,Oe.EduHub,Oe.SPX,Oe.SPXHelp,n?Oe.Gudangku:void 0].includes(e)&&Object.values(Ve).includes(t.toLowerCase())},ou=function(e){return[Oe.SPX,Oe.SPXHelp].includes(e)},iu=function(e){return e===Oe.Gudangku},su=function(e){var t=JSON.parse(St("authInfo")||"{}");return[Oe.SellerCenter,Oe.EduHub,Oe.ShopeeCn,Oe.ShopeeCnEdu,Oe.WeChat].includes(e)&&t.userType!==he.SubAccount},cu=function(e){var t,n=(yt("chat_region")||Vc).toUpperCase();try{t=Object(Pt.a)(n,e)}catch(a){t=Object(Pt.a)("SG",e)}return t},uu=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:He.Refund,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=yt("chat_region"),i=o||Vc,s=It(i,Gc),c="";""!==(c=r.includes("seller")?lu(i,e,s,t):a===He.Unpaid||a===He.AppUnpaid?"https://".concat(s,"/user/purchase/checkout/").concat(n):"https://".concat(s,"/user/purchase/order/").concat(t))&&window.open(c)},lu=function(e,t,n,a){var r="seller",o="";if("vn"===e.toLowerCase()&&(r="banhang"),[Oe.SellerCenter,Oe.EduHub].includes(t))o="https://".concat(r,".").concat(n,"/portal/sale/order/").concat(a);else if([Oe.ShopeeCn,Oe.ShopeeCnEdu].includes(t)){var i="";Gc&&"live"!==Gc&&(i=".".concat(Gc)),o="https://seller.".concat(e).concat(i,".shopee.cn/portal/sale/order/").concat(a),"tw"===e.toLowerCase()&&(o="https://seller.xiapi".concat(i,".shopee.cn/portal/sale/order/").concat(a))}return o};var du=We.ChatAccessToken,pu=We.SessionKey,fu=We.UnloginSessionKey,gu=function(e){var t={},n=$c(),a=tu(),r=yt("chat_region")||"cn",o=Hc.getState().getIn(["global","supportUnloginChatWithAgent"]),i=Hc.getState().getIn(["user","isLogined"]);if(yt(pu)&&!o&&(t["Session-Key"]=yt(pu)),yt(fu)&&o&&(t["Session-Key"]=yt(fu)),Zc(n)&&(t["chat-access-token"]=yt(du),i&&(t["user-region"]=r)),ou(n)||iu(n)){var s=Hc.getState().getIn(["global","token"]);t["chat-access-token"]=s}var c=(null===e||void 0===e?void 0:e.url)||"";return De.includes(c)&&delete t["chat-access-token"],t["token-suffix"]=a,t["shopee-region"]="cn",t},hu=function(){if(zc)return zc;var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),t=e.REACT_APP_SERVER_ENV,n=e.REACT_APP_REGION;tu();var a=$c(),r=yt("chat_region")||n,o=Zc(a)?wt(t):It(r,t),i=vi(),s="".concat("vn"===n?"banhang":"seller",".").concat(o),c=i?s:window.location.host,u=iu(a)||Zc(a)||ou(a)?"https://chatbot.".concat(o,"/chat"):"https://".concat(c,"/api/cschat/"),d=a!==Oe.Gudangku;return(zc=Tt.a.create({baseURL:u,withCredentials:d})).interceptors.request.use((function(e){var t=gu(e);return Object.entries(t).forEach((function(t){var n=Object(l.a)(t,2),a=n[0],r=n[1];e.headers.common[a]=r})),e})),zc.interceptors.response.use((function(e){return e&&Ql(e),ou(a)&&Hc.dispatch(fd(e)),e&&e.data}),(function(e){if(ri("error","network error",e.response),"ECONNABORTED"!==e.code&&403!==(e.response&&e.response.status)){var t=e.config&&e.config.url?"".concat(u).concat(e.config.url):u;return sn.withScope((function(n){n.setTags({api:t,type:"API Request Error"}),n.setExtras({ctx_url:window.location.href,api:t,params:e.config&&e.config.params,status:e.response&&e.response.status,errorCode:e.code,errorResponse:e.response,err:e}),sn.captureException(e)})),console.debug("\u8bf7\u6c42\u5931\u8d25: ".concat(e.response&&e.response.status)),Promise.reject(e)}})),zc};function mu(e){return hu().post("/v1/nologin_get_access_token",Object(d.a)({},e))}function vu(e){return hu().get("/v1/init_external_chat_session",{params:e})}function _u(e){return hu().get("/v1/gray_config",{params:e})}function bu(e){return hu().get("/api/selleraccount/user/redirect4verification/",{baseURL:window.location.origin,params:e})}function Eu(e){return hu().get("/v2/enquiry_types_list",{params:e})}function yu(e){return hu().get("v1/emergency/template",{params:e})}function Cu(e){return hu().post("v1/get_user_events",e)}var Su=n(683),Ou=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),Au=Ou.REACT_APP_SERVER_ENV,Tu=Ou.REACT_APP_REGION,Iu=vi(),wu="".concat("vn"===Tu?"banhang":"seller",".").concat(It(Tu,Au)),Lu=Iu?wu:window.location.host,ku="https://".concat(Lu,"/api/v1/images"),Mu=Tt.a.CancelToken,ju=(Mu.source(),new Su.a({uploadImagesUri:ku}));function xu(e){var t=new FormData,n=$c();return n===Oe.Gudangku||Zc(n)||ou(n)?(t.append("file",e),hu().post("/v1/image/upload",t,{headers:{"Content-Type":"multipart/form-data"}})):(t.append("images",e),ju.uploadImages(t))}function Ru(e){return hu().get("/v1/get_feedback_map",{params:Object(d.a)({},e)})}var Nu=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),Pu=Nu.REACT_APP_SERVER_ENV,Uu=Nu.REACT_APP_REGION,Du=vi(),Bu="".concat("vn"===Uu?"banhang":"seller",".").concat(It(Uu,Pu)),Wu=Du?Bu:window.location.host,Hu="https://".concat(Wu,"/api/pilot/v1"),Fu="csp".concat("live"===Pu?"":".".concat(Pu),".shopee.com"),Gu=Tt.a.create({baseURL:Hu,withCredentials:!0});Gu.interceptors.request.use((function(e){return e})),Gu.interceptors.response.use((function(e){return e&&e.data}),(function(e){return ri("error","network error",e.response),403!==(e.response&&e.response.status)&&(null===sn||void 0===sn||sn.withScope((function(t){t.setTags({api:"".concat(e.config.baseURL).concat(e.config.url),type:"API Request Error"}),t.setExtras({ctx_url:window.location.href,api:"".concat(e.config.baseURL).concat(e.config.url),params:e.config&&e.config.params,status:e.response&&e.response.status,errorCode:e.code,errorResponse:e.response,err:e}),sn.captureException(e)}))),Promise.reject(e)}));var Vu=Gu;function Qu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Vu.get("/api/v1/user/is_in_grep",{baseURL:"https://".concat(Fu),params:e,headers:Object(d.a)({},t)})}function qu(e){return Ku.apply(this,arguments)}function Ku(){return(Ku=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Vu.post("/api/v1/wechat/jssdk/config",t,{baseURL:"https://".concat(Fu)}).then((function(e){return Object(In.camelCaseKeys)(e,{otpions:"deep"})})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zu(e){return Ju.apply(this,arguments)}function Ju(){return(Ju=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Vu.post("/api/v1/wxwork/jssdk/config",t,{baseURL:"https://".concat(Fu)}).then((function(e){return Object(In.camelCaseKeys)(e,{otpions:"deep"})})).then((function(e){return Object(d.a)(Object(d.a)({},e),{},{beta:!0})})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yu(e){return Xu.apply(this,arguments)}function Xu(){return(Xu=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Vu.get("/api/v1/wechat/oauth/token",{baseURL:"https://".concat(Fu),params:t}).then((function(e){return Object(In.camelCaseKeys)(e,{otpions:"deep"})})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zu(e){return $u.apply(this,arguments)}function $u(){return($u=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Vu.get("/api/v1/wxwork/oauth/token",{baseURL:"https://".concat(Fu),params:t}).then((function(e){return Object(In.camelCaseKeys)(e,{otpions:"deep"})})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var el="https://".concat("","shopee.cn"),tl=Tt.a.create({baseURL:el,withCredentials:!0});tl.interceptors.request.use((function(e){return $c()!==Oe.WeChat&&(e.headers.common["shopee-region"]=0,e.headers.common["shopee-language"]=0),e})),tl.interceptors.response.use((function(e){return e&&e.data}),(function(e){if(ri("error","network error",e.response),"ECONNABORTED"!==e.code&&403!==(e.response&&e.response.status)){var t=e.config&&e.config.url?"".concat(el).concat(e.config.url):el;sn.withScope((function(n){n.setTags({api:t,type:"API Request Error"}),n.setExtras({ctx_url:window.location.href,api:t,params:e.config&&e.config.params,status:e.response&&e.response.status,errorCode:e.code,errorResponse:e.response,err:e}),sn.captureException(e)}))}return console.debug("\u8bf7\u6c42\u5931\u8d25: ".concat(e.response&&e.response.status)),Promise.reject(e)}));var nl,al,rl,ol,il=tl;function sl(){return il.get("/api/v1/chatbot/get_access_token/",{})}var cl,ul=We.LastConversationReadMessageId,ll=We.UnloginLastConversationReadMessageId,dl=We.ShopeeChatKey,pl=We.UnloginShopeeKey,fl=We.Connection,gl=We.UnloginConnection,hl=We.SessionKey,ml=We.UnloginSessionKey,vl=function(e){return{type:"UPDATE_CONFLICTED",payload:e}},_l=function(e){return{type:"UPDATE_CONNECTION",payload:e}},bl=function(e){return{type:"UPDATE_RESTORED_CONNECTION",payload:e}},El=function(e){return{type:"SKIP_ADDING_UNREAD_NUMBER_AFTER_RESTORE",payload:e}},yl=function(e){return{type:"UPDATE_CONVERSATION_STATUS",payload:e}},Cl=function(e){return{type:"UPDATE_NO_VALID_AGENT_INFO",payload:e}},Sl=function(e){return{type:"SETTING_SESSION_KEY",payload:e}},Ol=function(e){return{type:"UPDATE_DISABLE_MINIMIZE",payload:e}},Al=function(e){return{type:"SET_NEED_UPDATE_CONVERSATION",payload:e}},Tl=function(e){return{type:"SET_CONVERSATION_CAN_READ",payload:e}},Il=function(e){return{type:"SET_OLDEST_MESSAGE_ID",payload:e}},wl=function(e){return{type:"SET_HEART_BEAT_INTERVAL",payload:e}},Ll=function(e){return{type:"SET_CURRENT_CONNECT_TYPE",payload:e}},kl=function(){return{type:"UPDATE_CONNECT_COUNT"}},Ml=function(e){return{type:"GET_QUEUE_CONFIG_ERROR",payload:e}},jl=function(e){return{type:"SET_TOKEN_IS_INVALID",payload:e}},xl=function(e){return{type:"SET_OFFLINE_FORM_URL",payload:e}},Rl=function(e){return{type:"SET_WEB_FORM_PLATFORM",payload:e}},Nl=function(e){return{type:"UPDATE_INHOUSE_USERTYPE",payload:e}},Pl=function(e){return{type:"UPDATE_IGNORE_CCU",payload:e}},Ul=function(e){return{type:"UPDATE_CONNECTION_CONFIG_INFO",payload:e}},Dl=function(e){return{type:"UPDATE_QUEUE_POSITION_MAX",payload:e}},Bl=function(e){return{type:"UPDATE_AGENT_NAME",payload:e}},Wl=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n().getIn(["conversation","conversationStatus"])!==fe.Uninitialized&&t(yl(fe.Uninitialized)),"live",e.next=5,t(a.initSocket("csim.shopee.cn/ws"));case 5:t(a.newSocketSession());case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Hl=(nl={},Object(x.a)(nl,Oe.SellerCenter,2),Object(x.a)(nl,Oe.ShopeeCn,6),Object(x.a)(nl,Oe.ShopeeCnEdu,6),Object(x.a)(nl,Oe.WeChat,6),Object(x.a)(nl,Oe.EduHub,3),Object(x.a)(nl,Oe.Gudangku,4),Object(x.a)(nl,Oe.Cnsc,6),Object(x.a)(nl,Oe.SPX,7),Object(x.a)(nl,Oe.SPXHelp,7),nl),Fl=(al={},Object(x.a)(al,Oe.SellerCenter,5),Object(x.a)(al,Oe.EduHub,6),Object(x.a)(al,Oe.Gudangku,7),Object(x.a)(al,Oe.ShopeeCn,8),Object(x.a)(al,Oe.ShopeeCnEdu,9),Object(x.a)(al,Oe.WeChat,10),Object(x.a)(al,Oe.SPX,11),Object(x.a)(al,Oe.SPXHelp,12),Object(x.a)(al,Oe.Cnsc,15),al),Gl=(rl={},Object(x.a)(rl,Oe.Gudangku,"wms_lite"),Object(x.a)(rl,Oe.ShopeeCn,"cncb"),Object(x.a)(rl,Oe.ShopeeCnEdu,"cncb"),Object(x.a)(rl,Oe.WeChat,"cncb"),Object(x.a)(rl,Oe.Cnsc,"cncb"),Object(x.a)(rl,Oe.SPX,"spx"),Object(x.a)(rl,Oe.SPXHelp,"spx"),rl),Vl=(ol={},Object(x.a)(ol,Oe.ShopeeCn,8),Object(x.a)(ol,Oe.ShopeeCnEdu,9),Object(x.a)(ol,Oe.WeChat,10),Object(x.a)(ol,Oe.SellerCenter,5),Object(x.a)(ol,Oe.EduHub,6),Object(x.a)(ol,Oe.Gudangku,7),Object(x.a)(ol,Oe.SPX,11),Object(x.a)(ol,Oe.SPXHelp,12),Object(x.a)(ol,Oe.Cnsc,15),ol),Ql=function(e){var t,n;(null===(t=e.config.url)||void 0===t?void 0:t.includes("/report/v1/report_log"))||Ot("conflicted",e&&(null===e||void 0===e?void 0:e.data)&&1020===(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.code)?"YES":"NO")},ql=null;function Kl(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(){var n=Object(g.a)(f.a.mark((function n(a,r){var o,s,c,u,l,d;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log("connection init\u4e8b\u4ef6",e),o=r().getIn(["user","transferChatStatus"]),s=r().getIn(["global","shouldShowWindow"]),c=r().getIn(["message","messageList"]).first(),u=r().getIn(["global","supportUnloginChatWithAgent"]),a(Dl(e.queue_position_max||0)),c&&c.get("type")===H.System&&c.get("isNoMoreMsg")&&a(i.removeMessageItem(c.get("id"))),(s||t)&&(u?(Et(ml,e.key),Et(pl,e.shopeeChatKey),Et(gl,JSON.stringify(e))):(Et(hl,e.key),Et(dl,e.shopeeChatKey),Et(fl,JSON.stringify(e))),a(Sl(e.key)),a(ns(null!==(l=null!==(d=e.liveagent_session_id)&&void 0!==d?d:e.id)&&void 0!==l?l:"")),a(i.setClientPollTimeout(e.clientPollTimeout)),o||a(i.clearMessageList()),a(i.setHasFetchedHistoryFlag(!1)),a(i.updateFetchMessageStatus(Nt.NORMAL))),a(ud(e.shopeeChatKey)),a(Pl(!1)),a(ld()),a(vl(!1));case 12:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}function zl(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(){var n=Object(g.a)(f.a.mark((function n(a,o){var s,c,u,l,d;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log("connection message\u4e8b\u4ef6",e),c=e.msg_type,u=e.content,l=o().getIn(["user","transferChatStatus"]),d=o().getIn(["user","currentLiveAgentMessageId"]),n.t0=c,n.next=n.t0===ue.CS_JOINED?8:n.t0===ue.QUEUING?17:21;break;case 8:return l&&l!==fe.End&&(a(kl()),a(r.updateTransferChatStatus(fe.Chatting)),"#"!==d&&a(i.removeMessageItem(d))),a(yl(fe.Chatting)),a(Ol(!1)),a(Bl((null===e||void 0===e||null===(s=e.content)||void 0===s?void 0:s.cs_name)||"")),t||o().getIn(["global","shouldShowWindow"])||(a(Ws(!0)),setTimeout((function(){a(Ws(!1))}),3e3)),a(zi(!0)),a(El(!1)),fs.stop(),n.abrupt("break",22);case 17:return l&&l!==fe.End&&a(r.updateTransferChatStatus(fe.AgentQueue)),a(yl(fe.AgentQueue)),a(js(null===u||void 0===u?void 0:u.number)),n.abrupt("break",22);case 21:return n.abrupt("break",22);case 22:t||a(Zs([e]));case 23:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}function Jl(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var o,i,s,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("connection close\u4e8b\u4ef6",e),o=e.msg,i=e.ratingId,s=e.conversationStatus,ms(e.msg),n(Wa()),n($s(o,i,s)),ql=null,n(_l(null)),c=a().getIn(["global","accessPlatform"]),Zc(c)&&n(Ko()),dd(),n(r.updateCancelQueueConfirm(!1));case 11:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}function Yl(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(){var n=Object(g.a)(f.a.mark((function n(a,o){var s,c,u,l,d,p,g,h,m,v,_,b,E;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("connection error\u4e8b\u4ef6",e,null===e||void 0===e?void 0:e.response),d=null===e||void 0===e||null===(s=e.response)||void 0===s||null===(c=s.data)||void 0===c?void 0:c.code,p=null===e||void 0===e||null===(u=e.response)||void 0===u||null===(l=u.data)||void 0===l?void 0:l.data,vs(),a(Wa(!0)),g=o().getIn(["global","accessPlatform"]),!window.ignoreError||g!==Oe.WeChat){n.next=9;break}return window.ignoreError=!1,n.abrupt("return");case 9:h=o().getIn(["user","transferChatStatus"]),m=o().getIn(["conversation","conversationStatus"]),v=o().getIn(["global","supportUnloginChatWithAgent"]),_=!1,n.t0=d,n.next=n.t0===q?16:n.t0===$||n.t0===ae?19:n.t0===te||n.t0===ne||n.t0===re||n.t0===z||n.t0===J||n.t0===X||n.t0===Z||n.t0===K||n.t0===Y?21:n.t0===ee?24:26;break;case 16:return a(yl(fe.NoAgent)),a(Cl(p)),n.abrupt("break",30);case 19:return a(vl(!0)),n.abrupt("break",30);case 21:return[fe.Uninitialized,fe.AgentQueue].includes(o().getIn(["conversation","conversationStatus"]))?a(yl(fe.QueueError)):(_=!0,a(yl(fe.Error))),dd(),n.abrupt("break",30);case 24:return ou(g)?(m===fe.Chatting&&(_=!0),a(jl(!0)),a(yl(fe.Error)),a(r.updateTransferChatStatus(fe.End)),dd()):(a(yl(fe.Error)),dd(),v?(a(jl(!0)),Et(We.UnloginChatAccessToken,null),a(i.setPrevMessageTimestamp(0)),a(i.pushEmergencyMessage(G.t(_e.Unlogined),!1)),a(i.pushRegisterWebformMessage())):_=!0),n.abrupt("break",30);case 26:return _=!0,a(yl(fe.Error)),dd(),n.abrupt("break",30);case 30:if(ql=null,!t&&a(_l(null)),b=o().getIn(["global","accessPlatform"]),Zc(b)&&a(Ko()),!h||h===fe.End||ou(g)&&d===ee){n.next=48;break}if(E=d===q?fe.NoAgent:fe.Error,a(r.updateTransferChatStatus(E)),E!==fe.NoAgent){n.next=42;break}a(ac(E)),a(Cl(p)),n.next=44;break;case 42:return n.next=44,a(id());case 44:d===ee&&a(r.updateToken()),a(r.updateCancelQueueConfirm(!1)),n.next=51;break;case 48:if((ou(g)||!v)&&d===ee){n.next=51;break}return n.next=51,a(id());case 51:_&&(a(tc(G.t("cschat_session_end_tips"))),t||gi(g,G.t("cschat_session_end_tips")));case 52:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}var Xl=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,o,i,s,c,u,l,d,p,g,h,m,v,_,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(tu(),a=n().getIn(["global","accessPlatform"]),o=n().getIn(["global","supportUnloginChatWithAgent"]),i=n().getIn(["user","userType"]),s=i===he.SubAccount?"cncb_main":Gl[a]||"other",Zc(a)||o){e.next=8;break}return e.next=8,t(r.getUserAllEvents());case 8:if(c=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SERVER_ENV:"live",REACT_APP_REGION:"cn",REACT_APP_VERSION:"0.1.0",country:"cn"}),u=c.REACT_APP_SERVER_ENV,c.REACT_APP_REGION,ql){e.next=22;break}if(l=n().getIn(["global","token"]),d={shopeeEnvironment:u,grayReleaseConfig:{entry_point:s},fetchInjector:function(e){e.interceptors.request.use((function(e){return Zc(a)&&(e.headers.common["chat-access-token"]=yt("chat_access_token")),(ou(a)||iu(a))&&(e.headers.common["chat-access-token"]=n().getIn(["global","token"])),e}))},wsPathInjector:function(e){var t=e,r=e.includes("?")?"&":"?";if(Zc(a)){t="".concat(t).concat(r,"chat_access_token=").concat(yt("chat_access_token"),"&shopee_region=").concat("cn")}if(ou(a)||iu(a)){var o=n().getIn(["global","token"]);t="".concat(t).concat(r,"chat_access_token=").concat(o)}return t}},p=window.location.host,p.includes("cn")&&(Zc(a)?("live",g=yt("chat_region"),h=It(g,"live"),m=wt("live"),v="chatbot.".concat(m),_="chatbot.".concat(h),d.passGateway={http:v,websocket:v,bff:_}):d.passGateway={http:"".concat(p,"/api/cschat/v1"),websocket:"".concat(p,"/api/chatbot")}),o&&!l||(ql=new vt.AgentChat(d)),!ql){e.next=22;break}return e.next=19,ql.getChannelType();case 19:return b=e.sent,e.next=22,t(Ll(b));case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()};function Zl(e,t){return function(){var n=Object(g.a)(f.a.mark((function n(a){var r,o;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=ql){n.next=3;break}return n.next=3,a(Xl());case 3:return n.next=5,ql.restore(Object(d.a)(Object(d.a)({},t),{},{sequence:"queue"===e&&null!==(r=t.queue_position)&&void 0!==r?r:0,queue_position:t.queue_position}),{shouldPullUnreadMsg:!1});case 5:return o=n.sent,a($l(o)),n.abrupt("return",o);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}function $l(e){return function(){var t=Object(g.a)(f.a.mark((function t(n){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e&&(e.on("error",(function(e){return n(Yl(e))})),e.on("init",(function(e){return n(Kl(e))})),e.on("message",(function(e){return n(zl(e))})),e.on("close",(function(e){return n(Jl(e))})),e.on("config",(function(e){n(Ul(e))})),n(_l(e)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function ed(e){var t=e.enquiryType,n=e.accessPlatform,a=e.inhouseUserType;return function(){var e=Object(g.a)(f.a.mark((function e(r){var o,i,s,c,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return setTimeout((function(){ri("error","no userType when uploadChatbotMessage",{inhouseUserType:a,enquiryType:t,sellerText:mi(G.t("cschat_seller_text").toString())})})),e.next=3,Eu({entry_point:Fl[n]});case 3:if((o=e.sent).data){e.next=6;break}return e.abrupt("return");case 6:i=o.data.enquiry_type_infos,c=(null===(s=void 0===i?[]:i)||void 0===s?void 0:s.find((function(e){return e.enquiry_types.some((function(e){return+(null===e||void 0===e?void 0:e.id)===+t}))})))||{},(u=c.user_type)?(r(Nl(u)),setTimeout((function(){ri("debug","get userType by enquiryType success ",{userType:u,enquiryType:t})}))):setTimeout((function(){ri("debug","get userType by enquiryType fail",{userType:u,enquiryType:t,enquiry_type_infos:s})}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}var td,nd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o,i,s,c,u,p,g,h,m,v,_,b,E,y,C,S,O,A,T,I;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(Xl());case 2:if(!Go.checkMasterIsExist()){t.next=4;break}return t.abrupt("return");case 4:if(r=a().getIn(["global","accessPlatform"]),o=a().getIn(["conversation","connection"]),i=a().getIn(["conversation","inhouseUserType"]),s=a().getIn(["global","supportUnloginChatWithAgent"]),c=yt(s?gl:fl),u=St("prevEnquiryType"),p=yt(s?pl:dl),g=Number(St("prevUserType")),!e.restore||!c){t.next=26;break}return console.log("restore \u903b\u8f91",JSON.parse(c)),t.next=16,ql.restore(Object(d.a)(Object(d.a)({},JSON.parse(c)),{},{sequence:0,queue_position:e.queue_position}),{shouldPullUnreadMsg:!1});case 16:(cl=t.sent)&&n(bl(cl)),yt(s?ll:ul)||n(El(!1)),n(ud(p)),n(ld()),n(Pl(!1)),n(vl(!1)),t.next=46;break;case 26:if(console.log("\u521d\u59cb\u5316\u4f1a\u8bdd ".concat(e.enquiryType,", ").concat(e.enquiryName)),n(yl(fe.Uninitialized)),o&&!o.default){t.next=46;break}if(h=a().getIn(["conversation","connectType"]),m=Zc(r)?"CN":$o(),v="",ru(r)&&e.enquiryType?(_=e.enquiryType.toString().match(/\S+ Chat-(Seller|Buyer|Driver)-(.+)/)||[],b=Object(l.a)(_,3),E=b[2],y=void 0===E?e.enquiryType:E,v=Ke[y]||y):ru(r)&&u?(C=u.toString().match(/\S+ Chat-(Seller|Buyer|Driver)-(.+)/)||[],S=Object(l.a)(C,3),O=S[2],v=Ke[A=void 0===O?u:O]||A):v=e.enquiryType||"",T=v||u||0,h!==ht.ChannelType.inhouse||i){t.next=38;break}return t.next=37,n(ed({accessPlatform:r,enquiryType:T,inhouseUserType:i}));case 37:i=a().getIn(["conversation","inhouseUserType"]);case 38:return I=h===ht.ChannelType.inhouse?i:ht.UserType.Seller||g,ou(r)&&h===ht.ChannelType.salesforce&&(I="",T=""),h===ht.ChannelType.inhouse&&(T=Number(T)),t.next=43,ql.connect(Object(d.a)({channel:Hl[r]||2,user_entry_type:ht.UserEntryType.PC,user_type:I,enquiry_type:T,enquiry_name:e.enquiryName,queue_name:e.enquiryType||u,entry_point:Fl[r]||5,user_agent:window.navigator&&window.navigator.userAgent,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height),region:m},e.extraParams));case 43:cl=t.sent,e.enquiryType&&(Ot("prevEnquiryType",e.enquiryType),Ot("prevUserType",i)),ri("debug","livechat connect",Object(d.a)({channel:Hl[r]||2,user_entry_type:ht.UserEntryType.PC,user_type:I,enquiry_type:T,enquiry_name:e.enquiryName,queue_name:e.enquiryType||u,entry_point:Fl[r]||5,user_agent:window.navigator&&window.navigator.userAgent,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height),region:m,connectType:h},e.extraParams));case 46:n($l(cl));case 47:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},ad=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(Xl());case 2:if(!ql){e.next=6;break}return e.next=5,ql.getChannelType();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},rd=!1,od=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,o,s,c,u,l,d,p,g,h,m,v;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!rd){e.next=2;break}return e.abrupt("return");case 2:return rd=!0,a=n().getIn(["global","accessPlatform"]),e.next=6,t(Xl());case 6:if(!ql){e.next=57;break}return e.next=9,ql.getChannelType();case 9:if(o=e.sent,s=[],e.prev=11,ht.ChannelType.inhouse!==o){e.next=34;break}return e.next=15,Eu({entry_point:Fl[a]});case 15:if(!(null===(u=e.sent)||void 0===u?void 0:u.data)){e.next=23;break}return e.next=19,t(Ml(!1));case 19:l=u.data.enquiry_type_infos,s=l.map((function(e){return{value:e.user_type,content:e.user_type_content,child:null===e||void 0===e?void 0:e.enquiry_types.map((function(e){return{value:e.id,content:e.enquiry_type}}))}})),e.next=25;break;case 23:return e.next=25,t(Ml(!0));case 25:return(d=mi(G.t("cschat_seller_text").toString())).length&&(g=new RegExp(d),p=s.find((function(e){var t;return-1!==(null===(t=e.content)||void 0===t?void 0:t.toString().search(g))}))||{}),t(Nl(p.value)),e.next=30,t(r.updateEnquiryTypes(null===(c=p)||void 0===c?void 0:c.child));case 30:t(i.updateMessageListUUID(Object(_t.a)())),ri("debug","updateInhouseUserType",{sellerEnquiryTypes:p}),e.next=51;break;case 34:if(ht.ChannelType.salesforce!==o){e.next=51;break}return e.next=37,f={entry_point:Vl[a]},hu().get("/v1/queue_conf",{params:f});case 37:if(!(null===(h=e.sent)||void 0===h?void 0:h.data)){e.next=45;break}return e.next=41,t(Ml(!1));case 41:m=h.data.displayed_categories,s=m.map((function(e){return{value:e.category_id,content:e.category_name,child:null===e||void 0===e?void 0:e.displayed_options.map((function(e){return{value:e.queue_name,content:e.option_name}}))}})),e.next=47;break;case 45:return e.next=47,t(Ml(!0));case 47:return v=s.find((function(e){return 2===e.value}))||{},e.next=50,t(r.updateEnquiryTypes(v.child));case 50:t(i.updateMessageListUUID(Object(_t.a)()));case 51:e.next=57;break;case 53:return e.prev=53,e.t0=e.catch(11),e.next=57,t(Ml(!0));case 57:case"end":return e.stop()}var f}),e,null,[[11,53]])})));return function(t,n){return e.apply(this,arguments)}}()},id=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s,c,u,l,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n().getIn(["global","accessPlatform"]),e.prev=1,e.next=4,yu({channel:Zc(a)?Hl[a]:void 0,entry_point:Fl[a]});case 4:0===(null===(r=e.sent)||void 0===r?void 0:r.code)?(o=r.data,i=o.emergency_template,s=o.web_form_url,c=o.web_form_platform,t(xl(s)),t(Rl(c)),u=i.content,l=i.show_web_button,d=i.is_online,t(d?Tc(u,l):Ac())):t(Ac()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t(Ac());case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()},sd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var o,i,s,c,u,l,d,p,g,h,m,v,_;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a().getIn(["global","accessPlatform"]),i=a().getIn(["global","token"]),s=a().getIn(["global","supportUnloginChatWithAgent"]),c=St("transferStatus"),u=St("prevEnquiryType"),l=a().getIn(["chatbot","enabled"]),o!==Oe.WeChat||c!==fe.Chatting){t.next=8;break}return t.abrupt("return");case 8:if((u&&!l||(null===e||void 0===e?void 0:e.isForceOnline))&&n(r.updateTransferChatStatus(fe.Transfering)),!s||u||(null===e||void 0===e?void 0:e.isForceOnline)&&i){t.next=11;break}return t.abrupt("return");case 11:if(d=yt(s?gl:fl),p=a().getIn(["conversation","conversationStatus"]),g=!Zc(o)||u&&!(o===Oe.WeChat&&e.first),!l){t.next=17;break}t.next=32;break;case 17:if(!g){t.next=21;break}n(nd(e)),t.next=32;break;case 21:if(d||tr&&tr.socket.readyState!==Lt.CLOSED){t.next=25;break}n(Wl()),t.next=32;break;case 25:if(o===Oe.WeChat||p!==fe.Uninitialized){t.next=32;break}return t.next=28,vu({external_type:1});case 28:h=t.sent,(m=h.data)&&(v=m.session_id,_=m.init_message_id,n(r.updateExternalSessionId(v)),n(Il(_))),n(Wl());case 32:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},cd=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o,s,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=a().getIn(["conversation","connection"]),o=a().getIn(["conversation","conversationStatus"]),s=a().getIn(["global","accessPlatform"]),c=a().getIn(["global","supportUnloginChatWithAgent"]);try{r.close({msg:(null===e||void 0===e?void 0:e.noNeedUpdateStates)?ue.CANCEL_QUEUE:ue.USER_CLOSE_SESSION,conversationStatus:o}),Et(c?gl:fl,""),Ot("status",fe.End),Ot("transferStatus",fe.End),n(yl(fe.End)),n(Ps(!1)),n(i.updateQueuePosition(1)),iu(s)&&n(Il(""))}catch(u){n(yl(fe.End))}case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},ud=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r,o,i,s,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=a().getIn(["global","accessPlatform"]),i=[se.Neutral,se.Unliked],r={},Object(x.a)(r,se.Neutral,1),Object(x.a)(r,se.Unliked,2),s=r,c=Zc(u=o)?{channel:6}:ou(u)?{channel:7}:{},i.forEach(function(){var t=Object(g.a)(f.a.mark((function t(a){var r,o,i,u;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s[a],o=[],t.next=4,Ru(Object(d.a)({feedback_type:r,session_id:e},c));case 4:i=t.sent,(u=i.data)&&(o=Object.keys(u).map((function(e){return{value:e,text:u[e]}}))),n(Ad({type:a,options:o}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}var u}),t)})));return function(e,n){return t.apply(this,arguments)}}()},ld=function e(){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var o,i,s,c,u,l,d,p,g,h,m;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=a().getIn(["global","supportUnloginChatWithAgent"]),t.prev=1,td&&clearTimeout(td),i=a().getIn(["conversation","ignoreCCU"]),t.next=6,f=i,hu().post("/v1/heartbeat",{platform:"pc",ignore_ccu:f});case 6:s=t.sent,c=s.code,u=s.data,0===c?(n(vl(!1)),l=u.heart_beat_switch,d=u.intervals,u.token_expire_remain_time<=600&&o&&n(r.updateToken()),l&&d&&(n(wl(1e3*d)),td=setTimeout((function(){td&&clearTimeout(td),n(e())}),1e3*d))):1002===c?(p=a().getIn(["global","accessPlatform"]),n(vl(!1)),g=a().getIn(["conversation","heartBeatInterval"]),td=setTimeout((function(){td&&clearTimeout(td),n(e())}),g),ou(p)||n(r.updateToken())):(console.log("checkConflict"),n(vl(!0)),h=a().getIn(["conversation","heartBeatInterval"]),td=setTimeout((function(){td&&clearTimeout(td),n(e())}),h)),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(1),td&&clearTimeout(td),m=a().getIn(["conversation","heartBeatInterval"]),td=setTimeout((function(){td&&clearTimeout(td),n(e())}),m);case 17:case"end":return t.stop()}var f}),t,null,[[1,12]])})));return function(e,n){return t.apply(this,arguments)}}()},dd=function(){td&&clearTimeout(td)},pd=function(e,t){Go.emitRating({messageId:e,rateType:t})},fd=function(e){return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(jl((null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.code)===ee));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},gd=function(e){var t=e.enquiryType,n=e.enquiryName;return function(){var e=Object(g.a)(f.a.mark((function e(a,o){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(nd({enquiryType:t,enquiryName:n})),a(r.updateTransferChatStatus(fe.Transfering));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},hd=We.UnloginLastConversationReadMessageId,md=We.LastConversationReadMessageId,vd=We.Connection,_d=We.UnloginConnection,bd=function(e){return{type:"UPDATE_ACCESS_PLATFORM",payload:e}},Ed=function(e){return{type:"UPDATE_IS_INPUT_FOCUS",payload:e}},yd=function(e){return{type:"UPDATE_IS_MOBILE_STYLE",payload:e}},Cd=function(e){return{type:"UPDATE_NETWORK_STATUS",payload:e}},Sd=function(e){return{type:"UPDATE_SHOULD_SHOW_WINDOW",payload:e}},Od=function(e){return{type:"UPDATE_TOAST",payload:e}},Ad=function(e){return{type:"UPDATE_FEEDBACK_OPTIONS",payload:e}},Td=function(e){return{type:"UPDATE_TOKEN",payload:e}},Id=function(e){return{type:"UPDATE_REPORT_MARKER",payload:e}},wd=function(e){return{type:"SET_PLATFORM_TOKEN_METHOD",payload:e}},Ld=function(e){return{type:"SET_SUPPORT_UNLOGINED_CHAT_WITH_AGENT",payload:e}},kd=function(e){return{type:"UPDATE_SHOW_ORDER_MODAL",payload:e}},Md=function(e){return{type:"SET_SUBMIT_REGISTER_WEBFORM",payload:e}},jd=function(e){return{type:"SET_CAN_CLICK_ENTRY",payload:e}},xd=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=n().getIn(["global","accessPlatform"]))===Oe.ShopeeCn||a===Oe.ShopeeCnEdu?window.csChatLogin&&window.csChatLogin():a===Oe.WeChat&&(r=Xc(),window.location.href=r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Rd=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,o,s,u,l,d,p,g,h,m,v,_,b,E,y,C,S,O,A;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n().getIn(["conversation","restoredConnection"]),o=n().getIn(["global","supportUnloginChatWithAgent"]),!a){e.next=5;break}return t(jd(!0)),e.abrupt("return",!1);case 5:if(s=yt(o?_d:vd),u=JSON.parse(s||"{}"),l=u.key,d=n().getIn(["message","messageList"]),!l){e.next=70;break}return e.next=11,t(c.initSDK());case 11:return p=n().getIn(["global","accessPlatform"]),g=Hl[p],e.next=15,Object(gt.getSessionInfo)({from:"pc",channel:g});case 15:if(h=e.sent,t(jd(!0)),h&&!(h instanceof Error)){e.next=20;break}return o&&((null===d||void 0===d?void 0:d.find((function(e){return e.get("type")===H.RegisterWebform})))||(t(i.pushEmergencyMessage(G.t(_e.Unlogined),!1)),t(i.pushRegisterWebformMessage()))),e.abrupt("return",!1);case 20:if(m=h.isExist,v=h.sessionKey,_=h.status,b=h.userSessionExtensionInfo,E=b.queue_position,y=b.agent_name,C=b.queue_position_max,t(c.updateQueuePositionMax(C||0)),S=Go.checkMasterIsExist(),!m||!S){e.next=25;break}return e.abrupt("return",!0);case 25:if(!m||l!==v){e.next=69;break}if(O=n().getIn(["user","isLogined"]),n().getIn(["global","supportUnloginChatWithAgent"])||O){e.next=34;break}return e.next=31,t(r.updateTransferChatStatus(""));case 31:return e.next=33,t(c.updateConversationStatus(fe.Uninitialized));case 33:return e.abrupt("return",!1);case 34:e.t0=_,e.next=e.t0===ht.UserSessionStatus.created?37:e.t0===ht.UserSessionStatus.queuing?42:e.t0===ht.UserSessionStatus.chatting?50:57;break;case 37:return e.next=39,t(r.updateTransferChatStatus(fe.Transfering));case 39:return e.next=41,t(c.updateConversationStatus(fe.AgentQueue));case 41:return e.abrupt("break",58);case 42:return e.next=44,t(r.updateTransferChatStatus(fe.AgentQueue));case 44:return e.next=46,t(c.updateConversationStatus(fe.AgentQueue));case 46:return A=Number(E),e.next=49,t(i.updateQueuePosition("number"!==typeof(f=A)||isNaN(f)?0:A));case 49:return e.abrupt("break",58);case 50:return e.next=52,t(r.updateTransferChatStatus(fe.Chatting));case 52:return e.next=54,t(c.updateConversationStatus(fe.Chatting));case 54:return Et("agentName",y),t(Bl(y)),e.abrupt("break",58);case 57:return e.abrupt("return",!1);case 58:if(_!==ht.UserSessionStatus.queuing){e.next=63;break}return e.next=61,t(c.initChatSdk({restore:!0,queue_position:E}));case 61:e.next=65;break;case 63:return e.next=65,t(c.initChatSdk({restore:!0}));case 65:return _===ht.UserSessionStatus.chatting&&setTimeout((function(){t(lc())}),500),e.abrupt("return",!0);case 69:m&&l!==v&&(o?(Et(_d,""),Et(hd,"")):(Et(vd,""),Et(md,"")));case 70:return t(jd(!0)),o&&((null===d||void 0===d?void 0:d.find((function(e){return e.get("type")===H.RegisterWebform})))||(t(i.setPrevMessageTimestamp(0)),t(i.pushEmergencyMessage(G.t(_e.Unlogined),!1)),t(i.pushRegisterWebformMessage()))),e.abrupt("return",!1);case 73:case"end":return e.stop()}var f}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Nd=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n().getIn(["global","accessPlatform"]),Zc(a)){e.next=8;break}return e.next=4,t(Rd());case 4:e.sent&&t(zi(!0)),e.next=9;break;case 8:a===Oe.WeChat&&t(jd(!0));case 9:Et("isNotNew",!0);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Pd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(){var t=Object(g.a)(f.a.mark((function t(n,a){var o,s,u,l,d,p;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Wi(),o=a().getIn(["conversation","conversationStatus"]),s=a().getIn(["message","messageList"]),u=a().getIn(["chatbot","enabled"]),l=a().getIn(["chatbot","chatting"]),!u||!l){t.next=9;break}return n(Sd(!1)),o===fe.AgentQueue||o===fe.Chatting||(null===s||void 0===s?void 0:s.find((function(e){return e.get("type")===H.RegisterWebform})))||n(c.updateConversationStatus(fe.Uninitialized)),t.abrupt("return");case 9:if(d=a().getIn(["global","accessPlatform"]),p=a().getIn(["user","transferChatStatus"]),n(c.setConversationCanRead(!1)),ru(d)&&(n(i.updateCurrentEnquiryMessageId("#")),o!==fe.Chatting&&n(i.setPrevMessageTimestamp(0))),!e.needKeepConversation||!a().getIn(["conversation","needKeepConversation"])){t.next=17;break}return n(c.updateConversationStatus(fe.Uninitialized)),n(Sd(!1)),t.abrupt("return");case 17:n(i.setReadedMessageTotal()),n(Sd(!1)),o===fe.AgentQueue||o===fe.Chatting||(null===s||void 0===s?void 0:s.find((function(e){return e.get("type")===H.RegisterWebform})))||(u&&o===fe.End||n(c.updateConversationStatus(fe.Uninitialized)),u||(n(i.clearMessageList()),n(c.setOldestMessageId(""))),n(c.updateConflicted(!1))),p!==fe.End||(null===s||void 0===s?void 0:s.find((function(e){return e.get("type")===H.RegisterWebform})))||(Ot("prevEnquiryType",""),Ot("prevUserType",""),u||(n(i.clearMessageList()),n(c.setOldestMessageId(""))),n(r.updateTransferChatStatus("")));case 21:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},Ud=function(e){return{type:"UPDATE_MOBILE_CONFIRM_MODAL_OPTION",payload:e}},Dd=function(){il.get("/api/user/logout/",{})},Bd=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n().getIn(["global","accessPlatform"]),e.abrupt("return",a);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Wd=function(){return function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s,u,l,d,p,g,h;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n().getIn(["global","getPlatformTokenMethod"]),r=n().getIn(["global","accessPlatform"]),o=n().getIn(["global","shouldShowWindow"]),i=n().getIn(["conversation","conversationStatus"]),s=n().getIn(["conversation","showConflicted"]),u=s||"YES"===St("conflicted"),l=n().getIn(["user","transferChatStatus"]),d=n().getIn(["global","supportUnloginChatWithAgent"]),o||i!==fe.Uninitialized||u||l===fe.Chatting||!a||"function"!==typeof a||(f=r,![Oe.SPX,Oe.SPXHelp,Oe.Gudangku].includes(f))){e.next=19;break}if(!d){e.next=13;break}t(c.setTokenIsInvalid(!1)),e.next=19;break;case 13:return e.next=15,a();case 15:p=e.sent,g=p.code,h=p.token,0===g&&h?(t(Td(h)),t(c.setTokenIsInvalid(!1))):t(c.setTokenIsInvalid(!0));case 19:case"end":return e.stop()}var f}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Hd=function(e){return{platform:e.getIn(["global","accessPlatform"]),isMobileStyle:e.getIn(["global","isMobileStyle"]),botAvatar:e.getIn(["user","botAvatar"]),liveAgentAvatar:e.getIn(["user","liveAgentAvatar"])}},Fd=function(e){return Object(O.b)(Hd)((function(t){var n=Object.assign({},t);return m.a.createElement(e,n)}))},Gd=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){var e;Object(b.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).container=null,e}return Object(E.a)(n,[{key:"componentDidMount",value:function(){this.createContainer()}},{key:"componentWillUnmount",value:function(){this.removeContainer()}},{key:"createContainer",value:function(){var e=this.props,t=e.getPopupContainer,n=e.document,a=void 0===n?window.document:n,r=e.onRender;this.container=a.createElement("div"),this.container.style.position="absolute",this.container.style.top="0",this.container.style.left="0",this.container.style.width="100%",(t?t():a.body).appendChild(this.container),r&&r(),this.forceUpdate()}},{key:"removeContainer",value:function(){var e=this.props.onDestroy;e&&e(),this.container&&null!==this.container.parentNode&&this.container.parentNode.removeChild(this.container)}},{key:"render",value:function(){return this.container?_.a.createPortal(this.props.children,this.container):null}}]),n}(h.Component);function Vd(e){return _.a.createPortal(e,Qd())}function Qd(){var e=document.querySelector("#".concat("cs-chat-popup-container"));return null==e&&((e=document.createElement("div")).id="cs-chat-popup-container",e.className="cs-chat-container",document.body.appendChild(e)),e}var qd=Gd;function Kd(){return(Kd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function zd(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Jd=m.a.createElement("path",{d:"M12,1 C17.0350586,1 21.2799931,4.38292334 22.5858962,8.9998627 L23,9 C23.5522847,9 24,9.44771525 24,10 L24,14 C24,14.5522847 23.5522847,15 23,15 L22.5856141,15.0011345 C21.4795303,18.9102077 18.2664974,21.9344751 14.2509632,22.7694889 L14.0004156,22.8185474 L13.7686128,22.8585687 L13.3891283,22.9131245 L13.0250841,22.9528672 L12.7416636,22.9753919 L12.2884075,22.9962926 L12,23 C11.5209462,23 11.0490449,22.9693767 10.5861468,22.909981 C10.2402198,22.7529831 10,22.4045447 10,22 C10,21.4477153 10.4477153,21 11,21 L13,21 C13.4849074,21 13.8892034,21.3451385 13.9806325,21.8031601 C18.5544301,20.8852186 22,16.8449873 22,12 C22,6.4771525 17.5228475,2 12,2 C6.4771525,2 2,6.4771525 2,12 L2,14 C2,14.5522847 1.55228475,15 1,15 C0.487164161,15 0.0644928393,14.6139598 0.00672773133,14.1166211 L0,14 L0,10 C0,9.48716416 0.38604019,9.06449284 0.883378875,9.00672773 L1,9 L1.41410381,8.9998627 C2.72000691,4.38292334 6.96494141,1 12,1 Z M12,4 C16.418278,4 20,7.581722 20,12 C20,16.418278 16.418278,20 12,20 C7.581722,20 4,16.418278 4,12 C4,7.581722 7.581722,4 12,4 Z M12,5 C8.13400675,5 5,8.13400675 5,12 C5,15.8659932 8.13400675,19 12,19 C15.8659932,19 19,15.8659932 19,12 C19,8.13400675 15.8659932,5 12,5 Z"}),Yd=function(e){var t=e.svgRef,n=e.title,a=zd(e,["svgRef","title"]);return m.a.createElement("svg",Kd({width:24,height:24,viewBox:"0 0 24 24",ref:t},a),n?m.a.createElement("title",null,n):null,Jd)},Xd=m.a.forwardRef((function(e,t){return m.a.createElement(Yd,Kd({svgRef:t},e))})),Zd="avatar-".concat("cn".toLocaleLowerCase()),$d=[fe.NoAgent,fe.QueueError,fe.Error,fe.SystemError],ep=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).entryRef=void 0,a.originOverflowValue=void 0,a.handleClickEntry=a.handleClickEntry.bind(Object(y.a)(a)),a.handleMouseOver=a.handleMouseOver.bind(Object(y.a)(a)),a.handleMouseLeave=a.handleMouseLeave.bind(Object(y.a)(a)),a.hideNewGuide=a.hideNewGuide.bind(Object(y.a)(a)),a.entryRef=Object(h.createRef)(),a.state={showPopover:!1,showNewGuide:!1},a.originOverflowValue="",a.onRender=a.onRender.bind(Object(y.a)(a)),a.onDestroy=a.onDestroy.bind(Object(y.a)(a)),a.handleOnline=a.handleOnline.bind(Object(y.a)(a)),a.handleOffline=a.handleOffline.bind(Object(y.a)(a)),a.handleBeforeUnload=a.handleBeforeUnload.bind(Object(y.a)(a)),a.getShopeecnChatingEntryBtn=a.getShopeecnChatingEntryBtn.bind(Object(y.a)(a)),a.handleVisibilityChange=a.handleVisibilityChange.bind(Object(y.a)(a)),a.handlePageShow=a.handlePageShow.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"getSellerCenterEntryBtn",value:function(){var e,t=this.props,n=t.conversationStatus,a=t.shouldShowWindow,r=t.displayQueuePosition,o=t.disableMinimize,i=t.platform;return o?m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.disabled,Object(x.a)({},N.a.spxEntryBtn,ou(i)))}):a?m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.active,Object(x.a)({},N.a.spxEntryBtn,ou(i)))}):n===fe.AgentQueue?m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.queueNum,Object(x.a)({},N.a.spxEntryBtn,ou(i)))},r):n===fe.Chatting?m.a.createElement("div",{className:w()(N.a.entryBtn,Object(x.a)({},N.a.spxEntryBtn,ou(i)))},m.a.createElement("div",{className:w()(N.a.avatar,N.a[Zd])})):m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.normal,(e={},Object(x.a)(e,N.a.gudangkuEntry,i===Oe.Gudangku),Object(x.a)(e,N.a.spxEntryBtn,ou(i)),e))},m.a.createElement(Xd,{className:w()(Object(x.a)({},N.a.spxEntryBtnIcon,ou(i)))}))}},{key:"getShopeecnChatingEntryBtn",value:function(){var e,t=this.props,n=t.transferChatStatus,a=t.shouldShowWindow,r=t.displayQueuePosition,o=t.disableMinimize,i=t.platform,s=n;return o?m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.disabled,N.a.shopeeCnBtn)}):a?m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.active,N.a.shopeeCnBtn)}):s===fe.AgentQueue?m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.queueNum,N.a.shopeeCnBtn)},r):s===fe.Chatting?m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.shopeeCnBtn)},m.a.createElement("div",{className:w()(N.a.avatar,N.a[Zd])})):m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.normal,(e={},Object(x.a)(e,N.a.gudangkuEntry,i===Oe.Gudangku),Object(x.a)(e,N.a.shopeeCnBtn,!0),e))},m.a.createElement(Xd,{className:w()()}))}},{key:"getShopeeCnEntryBtn",value:function(){return m.a.createElement("div",{className:w()(N.a.shopeeCnEntryBtn,this.props.shouldShowWindow?N.a.active:N.a.normal)},m.a.createElement(Xd,null))}},{key:"getEntryBtn",value:function(){var e=this.props,t=e.platform,n=e.transferChatStatus;return t===Oe.ShopeeCn||t===Oe.ShopeeCnEdu||t===Oe.Cnsc?n===fe.Chatting||n===fe.AgentQueue?this.getShopeecnChatingEntryBtn():this.getShopeeCnEntryBtn():this.getSellerCenterEntryBtn()}},{key:"tipMessage",value:function(){var e=this.props,t=e.unreadMessageCount,n=e.shouldShowWindow,a=e.conversationStatus;if(!n)return $d.includes(a)?m.a.createElement("div",{className:N.a.errorIcon}):t>99?m.a.createElement("div",{className:N.a.unreadCount},"99+"):t>0?m.a.createElement("div",{className:N.a.unreadCount},t):void 0}},{key:"onRender",value:function(){document.body.style.overflow="hidden"}},{key:"onDestroy",value:function(){document.body.style.overflow=this.originOverflowValue}},{key:"handleOnline",value:function(){var e=this.props,t=e.updateNetworkStatus,n=e.platform,a=e.transferChatStatus,r=e.initSocketSession,o=e.conversationStatus;t("online"),Zc(n)&&o===fe.Chatting&&(a||r())}},{key:"handleOffline",value:function(){(0,this.props.updateNetworkStatus)("offline")}},{key:"handleBeforeUnload",value:function(){this.props.conversationStatus===fe.Chatting?Ot("status",fe.Chatting):Ot("status",null),this.props.transferChatStatus===fe.Chatting?Ot("transferStatus",fe.Chatting):(Ot("transferStatus",""),Ot("prevEnquiryType",""),Ot("prevUserType","")),Ot("conflicted","NO")}},{key:"componentDidMount",value:function(){var e=this,t=this.props.platform;this.originOverflowValue=document.body.style.overflow;var n=yt("ImmediateChatAfterLogin");(t===Oe.WeChat||n)&&(this.handleClickEntry(),n&&setTimeout((function(){Et("ImmediateChatAfterLogin",!1)}),3e3));var a=!yt("isNotNew");this.setState({showNewGuide:a}),this.initExternalFn(),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),window.addEventListener("beforeunload",this.handleBeforeUnload),Re&&t===Oe.WeChat&&(document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("pageshow",this.handlePageShow)),hi.on("displayUnreadMessages",(function(){if(e.props.shouldShowWindow){if("hidden"===document.visibilityState){var t=Gi();Pi({targetType:"chat_window",operation:"impression",data:{viewed_objects:[Object(d.a)({has_unread:e.props.unreadMessageCount>0,from_pn:!0,ctx_url:window.location.href},t)]}})}}else e.handleClickEntry(void 0,!0)}))}},{key:"componentWillUnmount",value:function(){var e=this.props.platform;window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("beforeunload",this.handleBeforeUnload),Re&&e===Oe.WeChat&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("pageshow",this.handlePageShow))}},{key:"handlePageShow",value:function(){var e=this.props,t=e.initChatSdk,n=e.transferChatStatus;Re&&n===fe.Chatting&&(null===t||void 0===t||t())}},{key:"initExternalFn",value:function(){var e=this;window.CsChat.minimizeCsChatWindow=function(){e.props.shouldShowWindow&&(e.props.updateDisableMinimizeStatus(!1),e.props.minimizeWindow())},window.CsChat.openCsChatWindow=function(){e.props.shouldShowWindow||(window.ChatEasy&&window.ChatEasy.minimizeChatWindow&&window.ChatEasy.minimizeChatWindow(),e.handleClickEntry())}}},{key:"handleMouseOver",value:function(){this.props.shouldShowWindow||this.setState({showPopover:!0})}},{key:"handleMouseLeave",value:function(){this.setState({showPopover:!1})}},{key:"handleVisibilityChange",value:function(){var e,t=this.props,n=t.connection,a=t.initChatSdk,r=t.transferChatStatus;"hidden"===document.visibilityState&&(null===n||void 0===n||null===(e=n.stop)||void 0===e||e.call(n));"visible"===document.visibilityState&&r===fe.Chatting&&a()}},{key:"hideNewGuide",value:function(e){e.stopPropagation(),this.setState({showNewGuide:!1})}},{key:"handleClickEntry",value:function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s,c,u,l,p,g,h,m,v,_,b,E,y,C,S,O,A,T,I,w,L,k,M,j,x,R,N,P,U,D,B,W,F;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ri("debug","click entry button"),a=this.props,r=a.shouldShowWindow,o=a.conversationStatus,i=a.initSession,s=a.updateChatWindowStatus,c=a.minimizeWindow,u=a.hideAgentJoinedTips,l=a.disableMinimize,p=a.unreadMessageCount,g=a.showConflicted,h=a.transferChatStatus,m=a.platform,v=a.pushEnquiryTypeMessage,_=a.messageList,b=a.setReadedMessageTotal,E=a.checkPlatformToken,y=a.setConversationCanRead,C=a.messageStopIndex,S=a.supportUnloginChatWithAgent,O=a.pushUnloginGreetings,A=a.pushRegisterWebformMessage,T=a.restoredConnection,I=a.resetTimestamp,w=a.canClickEntry,L=a.authInfo,k=a.initSocketSession,M=a.chatbotEnabled,j=yt("ImmediateChatAfterLogin"),w||m===Oe.WeChat||j){e.next=5;break}return e.abrupt("return");case 5:if(r||Bi(),this.handleMouseLeave(),x=g||"YES"===St("conflicted"),this.state.showNewGuide&&this.setState({showNewGuide:!1}),R=Gi(),Pi({targetType:"chat_icon",operation:"click",data:{has_unread:p>0,platform_type:R.platform_type}}),!l){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,E();case 16:N=h!==fe.Chatting&&h!==fe.Transfering&&h!==fe.AgentQueue,!r&&(o===fe.Uninitialized||S&&o===fe.End)&&!x&&N&&(!S||T||(null===_||void 0===_?void 0:_.find((function(e){return e.get("type")===H.RegisterWebform})))?ru(m)?v():m!==Oe.WeChat&&(Zc(m)?null!=L&&(null!=(null===L||void 0===L?void 0:L.userId)||null!=(null===L||void 0===L?void 0:L.token))||M?i():k():i()):(I(),O(),A())),r||x||h===fe.Chatting||fs.firstInit(h===fe.Transfering||h===fe.AgentQueue),P=_.last(),U=null===P||void 0===P?void 0:P.get("id"),D=/^[0-9]+$/.test(U),B=We.LastConversationReadMessageId,W=We.UnloginLastConversationReadMessageId,U&&D&&Et(S?W:B,U),r?(c(),y(!1)):(window.ChatEasy&&window.ChatEasy.minimizeChatWindow&&window.ChatEasy.minimizeChatWindow(),s(!0),b(),u(),C<_.size-1?y(!1):y(!0),n&&(F=Gi(),Pi({targetType:"chat_window",operation:"impression",data:{viewed_objects:[Object(d.a)({has_unread:p>0,from_pn:!0,ctx_url:window.location.href},F)]}})));case 25:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renderNewGuide",value:function(){var e=this.props,t=e.isMobileStyle,n=e.platform,a=e.t,r=n===Oe.ShopeeCn||n===Oe.ShopeeCnEdu;return t?t&&r?m.a.createElement(m.a.Fragment,null,m.a.createElement(k.a,{style:{maxWidth:"228px"},arrow:!0,open:!0,anchorRef:this.entryRef,rootRef:{current:Qd()}},m.a.createElement("div",{className:w()(N.a.newGuide,N.a.mobileGuide)},m.a.createElement("div",{className:N.a.guideTips},a("cschat_new_guide_text")),m.a.createElement(j.a,{type:"primary",onClick:this.hideNewGuide,className:N.a.gotBtn},a("cschat_got_it_btn")))),m.a.createElement(qd,{onRender:this.onRender,onDestroy:this.onDestroy,getPopupContainer:Qd},m.a.createElement("div",{style:{zIndex:91},className:N.a.guideMask}))):void 0:m.a.createElement("div",{className:N.a.portal},m.a.createElement("div",{className:N.a.guideContent},m.a.createElement("div",{className:N.a.guideTips},a("cschat_new_guide_text"))),m.a.createElement(j.a,{type:"primary",onClick:this.hideNewGuide,className:N.a.guideBtn},a("cschat_got_it_btn")))}},{key:"render",value:function(){var e,t,n,a=this.props,r=a.t,o=a.shouldShowAgentJoined,i=a.shouldShowWindow,s=a.agentJoinText,c=a.platform,u=a.canClickEntry,l=c===Oe.ShopeeCn||c===Oe.ShopeeCnEdu||c===Oe.Cnsc;if(c===Oe.WeChat)return null;var d=ou(c)?r("cschat_chat_with_spx"):c===Oe.Gudangku?r("cschat_customer_support"):r("cschat_chat_with_shopee");return m.a.createElement("div",{onClick:this.handleClickEntry,className:w()((e={},Object(x.a)(e,N.a.wrapper,!0),Object(x.a)(e,N.a.cannotClick,!u),e)),ref:this.entryRef},!this.state.showPopover&&m.a.createElement("div",{className:N.a.normalStatus,onMouseEnter:this.handleMouseOver},this.getEntryBtn()),this.state.showPopover&&!i&&m.a.createElement("div",{onMouseLeave:this.handleMouseLeave},m.a.createElement("div",{className:w()(N.a.hoverStatus,(t={},Object(x.a)(t,N.a.gudangkuHoverStatus,c===Oe.Gudangku),Object(x.a)(t,N.a.spxHoverStatus,ou(c)),Object(x.a)(t,N.a.shopeeCNHoverStatus,l),t))},m.a.createElement("div",{className:N.a.text},d)),m.a.createElement("div",{className:w()(N.a.entryBtn,N.a.hoverBtn,(n={},Object(x.a)(n,N.a.gudangkuHoverBtn,c===Oe.Gudangku),Object(x.a)(n,N.a.spxHoverStatusBtn,ou(c)),Object(x.a)(n,N.a.shopeeCNHoverBtn,l),n))})),this.tipMessage(),o&&!i&&m.a.createElement(k.a,{arrow:!0,open:!0,anchorRef:this.entryRef,className:N.a.agentJoinedPopover,rootRef:{current:Qd()}},m.a.createElement("div",{onClick:this.handleClickEntry,className:N.a.tips},s)),this.state.showNewGuide?this.renderNewGuide():null)}}]),n}(h.PureComponent),tp=Object(O.b)((function(e){return{messageList:e.getIn(["message","messageList"]),messageStopIndex:e.getIn(["message","messageStopIndex"]),shouldShowWindow:e.getIn(["global","shouldShowWindow"]),conversationStatus:e.getIn(["conversation","conversationStatus"]),disableMinimize:e.getIn(["conversation","disableMinimize"]),displayQueuePosition:e.getIn(["message","displayQueuePosition"]),isLogined:e.getIn(["user","isLogined"]),unreadMessageCount:e.getIn(["message","currentMessageTotal"])-e.getIn(["message","readedMessageTotal"]),shouldShowAgentJoined:e.getIn(["message","shouldShowAgentJoined"]),agentJoinText:e.getIn(["message","agentJoinText"]),oldestMessageId:e.getIn(["conversation","oldestMessageId"]),transferChatStatus:e.getIn(["user","transferChatStatus"]),showConflicted:e.getIn(["conversation","showConflicted"]),connection:e.getIn(["conversation","connection"]),supportUnloginChatWithAgent:e.getIn(["global","supportUnloginChatWithAgent"]),restoredConnection:e.getIn(["conversation","restoredConnection"]),canClickEntry:e.getIn(["global","canClickEntry"]),chatbotEnabled:e.getIn(["chatbot","enabled"])}}),(function(e){return{updateChatWindowStatus:function(t){e(u.updateChatWindowStatus(t))},initSession:function(){e(c.initSession({needCheckConflict:!0}))},initChatSdk:function(){e(c.initChatSdk({restore:!0}))},minimizeWindow:function(){e(u.minimizeWindow())},setReadedMessageTotal:function(){e(i.setReadedMessageTotal())},hideAgentJoinedTips:function(){e(i.updateShouldShowAgentJoined(!1))},updateNetworkStatus:function(t){e(u.updateNetworkStatus(t))},updateDisableMinimizeStatus:function(t){e(c.updateDisableMinimizeStatus(t))},initSocketSession:function(){e(c.initSocketSession())},getPaginationHistoryMessage:function(){e(i.getPaginationHistoryMessage())},pushEnquiryTypeMessage:function(){e(i.pushEnquiryTypeMessage())},checkPlatformToken:function(){return Object(g.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(u.checkPlatformToken());case 2:case"end":return t.stop()}}),t)})))()},setConversationCanRead:function(t){e(c.setConversationCanRead(t))},pushUnloginGreetings:function(){e(i.pushEmergencyMessage(G.t(_e.Unlogined),!1))},pushRegisterWebformMessage:function(){e(i.pushRegisterWebformMessage())},resetTimestamp:function(){e(i.setPrevMessageTimestamp(0))}}}))(Object(V.a)()(Fd(ep))),np=n(21),ap=n.n(np),rp=n(658);function op(){return(op=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ip(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var sp=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 22V7.92593L11.8519 2L23.7037 7.92593V22H0ZM11.8519 3.85185L1.48148 9.03704V20.5185H4.07407V16.0741H11.4815V20.5185H12.2222V16.0741H19.6296V20.5185H22.2222V9.03704L11.8519 3.85185ZM15.5556 9.40741V15.3333H8.14815V9.40741H15.5556ZM7.40741 13.8519V15.3333H4.07407L4.81482 13.8519H7.40741ZM18.8889 13.8519L19.6296 15.3333H16.2963V13.8519H18.8889ZM14.8148 7.18518L15.5556 8.66667H8.14815L8.88889 7.18518H14.8148Z",fill:"#EE4D2D"}),cp=function(e){var t=e.svgRef,n=e.title,a=ip(e,["svgRef","title"]);return m.a.createElement("svg",op({width:24,height:24,viewBox:"0 0 24 24",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,sp)},up=m.a.forwardRef((function(e,t){return m.a.createElement(cp,op({svgRef:t},e))}));function lp(){return(lp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function dp(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var pp=m.a.createElement("path",{d:"M4.48673 5.48121C3.13931 5.02715 2.57283 4.43003 2.68786 3.60877C2.85665 2.69659 3.80349 2.00912 4.96882 1.96916C5.90757 1.96916 6.70296 2.21936 7.44921 2.74582C7.63997 2.8715 7.74922 2.82285 7.89315 2.66473C7.90876 2.6433 7.96252 2.57902 8.13998 2.36704C8.30819 2.16607 8.37119 2.08789 8.39143 2.06298C8.51975 1.87244 8.53362 1.7734 8.34634 1.6234C8.18506 1.4954 7.72436 1.23767 7.45673 1.12473C6.71137 0.810654 5.90847 0.656945 5.10004 0.673565C3.23758 0.714107 1.61385 1.92109 1.29477 3.51147C1.0728 4.65938 1.52599 5.58256 2.64798 6.26135C2.96763 6.44378 4.13991 6.90827 4.68327 7.07218C6.23532 7.54477 6.94342 8.40425 6.63186 9.41142C6.34804 10.3253 5.29658 10.941 3.92199 10.9833C2.92058 10.9586 1.95786 10.5909 1.19419 9.94136L1.13639 9.89155L1.07569 9.84116C0.902281 9.70969 0.764707 9.70969 0.605744 9.90777C0.599964 9.91587 0.472216 10.0751 0.345046 10.2338C0.196489 10.4192 0.132326 10.4997 0.0970653 10.5448C-0.0381971 10.7111 -0.0312606 10.8008 0.112673 10.9387C0.419067 11.2174 0.755661 11.4608 1.11616 11.6644C1.90519 12.0779 2.78439 12.2957 3.74742 12.3154C4.37055 12.3472 5.1775 12.1995 5.80121 11.9377C6.93418 11.4634 7.74344 10.5408 8.02032 9.40042C8.47235 7.5523 7.42667 6.4015 4.48673 5.48121Z",fill:"#EE4D2D"}),fp=m.a.createElement("path",{d:"M13.1597 5.02019C12.3943 5.02893 11.6486 5.26474 11.0169 5.69781L11.6863 0.926658C11.7123 0.740167 11.6487 0.66835 11.4643 0.66835H10.6019C10.3967 0.66835 10.3337 0.736692 10.3071 0.926658L8.75155 12.0177C8.72554 12.2001 8.76889 12.2765 8.97352 12.2765H9.83596C10.0238 12.2765 10.1053 12.1978 10.1308 12.0177L10.6389 8.39556C10.8036 7.28009 11.8447 6.37891 12.9695 6.37891C14.0944 6.37891 14.8858 7.28415 14.7337 8.40599L14.2268 12.02C14.1973 12.2291 14.2418 12.2789 14.4488 12.2789H15.3089C15.5141 12.2789 15.5748 12.2291 15.6037 12.02L16.1124 8.39498C16.3656 6.53471 15.032 5.02019 13.1597 5.02019Z",fill:"#EE4D2D"}),gp=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.169 8.66662C17.4505 6.65692 19.3384 5.02773 21.3853 5.02773C23.4321 5.02773 24.8622 6.65634 24.5801 8.66662C24.2981 10.6769 22.4102 12.3061 20.3639 12.3061C18.3176 12.3061 16.8875 10.6763 17.169 8.66662ZM18.5286 8.66488C18.35 9.93673 19.2552 10.9676 20.5518 10.9676C21.8478 10.9676 23.0426 9.93615 23.2212 8.66488C23.3998 7.39361 22.494 6.36212 21.1981 6.36212C19.9021 6.36212 18.7073 7.39303 18.5286 8.66488Z",fill:"#EE4D2D"}),hp=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.8424 9.15658H48.8233L48.8192 9.1589H43.6116C43.6497 9.81839 44.0313 10.4091 44.6163 10.714C44.7782 10.7956 44.9478 10.861 45.1226 10.9091C46.1397 11.132 47.2029 10.8863 48.0198 10.2396C48.0271 10.2327 48.0376 10.2253 48.05 10.2167C48.0603 10.2096 48.0719 10.2016 48.084 10.1921C48.2366 10.0717 48.3279 10.1024 48.4158 10.2356C48.4158 10.2356 48.5389 10.4475 48.7499 10.8819C48.8412 11.0661 48.8204 11.1524 48.5955 11.3557C48.5863 11.3638 48.5689 11.3783 48.5435 11.3979C48.5019 11.431 48.4527 11.4674 48.3949 11.5068C48.2111 11.6305 48.0178 11.7395 47.8169 11.8329C47.003 12.2169 46.0406 12.397 44.9463 12.2632L44.8533 12.2476L44.792 12.2354C43.9995 12.0837 43.3255 11.6771 42.8706 11.084V11.08C42.4541 10.5268 42.2356 9.84932 42.2503 9.15658V9.10909C42.254 8.95929 42.2661 8.80981 42.2867 8.6614C42.5688 6.65228 44.3666 5.02251 46.3105 5.02251C48.2545 5.02251 49.5984 6.65228 49.3163 8.6614L49.3123 8.68862C49.3088 8.69846 49.3088 8.70831 49.3088 8.71931V8.71931C49.2736 8.95596 49.0804 9.13713 48.8424 9.15658ZM46.1256 6.35517C45.1579 6.36747 44.285 6.94051 43.8874 7.82451L47.9909 7.82219C47.8135 6.9824 47.0424 6.35517 46.1256 6.35517Z",fill:"#EE4D2D"}),mp=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27.4548 5.82988C28.1545 5.30605 29.0022 5.01847 29.8756 5.00862C31.8866 5.00862 33.289 6.64013 33.0069 8.64983C32.7248 10.6595 30.8658 12.2887 28.8548 12.2887C28.0022 12.2887 27.2363 11.9951 26.6657 11.4675L26.0663 15.7417C26.0391 15.9334 25.9767 16 25.7715 16H24.9513C24.7461 16 24.7021 15.9317 24.7293 15.7417L26.1981 5.2704C26.2259 5.06943 26.2877 5.01152 26.4929 5.01152H27.3126C27.5178 5.01152 27.5623 5.07465 27.5351 5.2704L27.4548 5.82988ZM27.053 8.7031C26.9091 9.94947 27.7912 10.9462 29.0415 10.9462C30.3144 10.9462 31.4913 9.91587 31.6693 8.64403C31.8473 7.37218 30.9595 6.34127 29.6878 6.34127C28.4369 6.34127 27.275 7.33859 27.0698 8.5838L27.053 8.7031Z",fill:"#EE4D2D"}),vp=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38.1763 5.02194C40.1203 5.02194 41.4642 6.65171 41.1821 8.66083C41.1804 8.67006 41.1781 8.67915 41.1752 8.68805V8.71875C41.1396 8.95519 40.9465 9.13615 40.7087 9.15602H35.482C35.5201 9.81551 35.9017 10.4063 36.4867 10.7111C36.6484 10.7926 36.8179 10.858 36.9925 10.9063C38.0095 11.1303 39.0733 10.8854 39.8908 10.2391C39.8982 10.2322 39.9085 10.2251 39.9205 10.2167C39.9309 10.2094 39.9426 10.2012 39.9549 10.1916C40.1081 10.0711 40.1994 10.1018 40.2873 10.235C40.2873 10.235 40.4099 10.447 40.6208 10.8813C40.7127 11.0655 40.6919 11.1518 40.4671 11.3551C40.4578 11.3632 40.4405 11.3777 40.4145 11.3974C40.3729 11.4304 40.3237 11.4669 40.2659 11.5063C40.0821 11.6301 39.8888 11.7391 39.6879 11.8323C38.874 12.2163 37.9121 12.3964 36.8173 12.2627L36.7242 12.247L36.6624 12.2349C35.8699 12.0831 35.1959 11.6765 34.741 11.0835L34.7381 11.0794C34.3212 10.5264 34.1021 9.84892 34.1161 9.15602V9.10853C34.1197 8.95872 34.1319 8.80925 34.1525 8.66083C34.4346 6.65171 36.2323 5.02194 38.1763 5.02194ZM37.9937 6.35517C37.0257 6.36616 36.1518 6.93834 35.7531 7.82219H39.8584C39.681 6.9824 38.9104 6.35517 37.9937 6.35517Z",fill:"#EE4D2D"}),_p=m.a.createElement("path",{d:"M57.1096 0H53.576L55.9118 6.1403L49.2915 13.0121H53.0089L59.4975 6.27641L57.1096 0Z",fill:"#EE4D2D"}),bp=m.a.createElement("path",{d:"M57.2947 9.77455L58.5265 13.0121H62.0607L59.8282 7.14456L57.2947 9.77455Z",fill:"#EE4D2D"}),Ep=m.a.createElement("path",{d:"M65.5444 0H61.827L59.0426 2.89003L60.0952 5.65612L65.5444 0Z",fill:"#EE4D2D"}),yp=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M88.9981 0L86.7143 2.36878H65.5943L67.8781 0H88.9981ZM78.1061 7.00789C77.6974 8.34345 76.6534 9.24347 75.1106 9.59444L76.7373 13.0086H74.2135L72.7106 9.64019L71.7198 13.0086H69.6181L72.2591 4.25049H75.2436C77.6379 4.25396 78.6535 5.22407 78.1061 7.01137V7.00789ZM80.5662 9.32455H84.1275L84.6587 7.76486H80.9691L81.5835 5.84146H85.1293L85.6385 4.25223H79.9049L77.3355 13.0104H83.0697L83.5252 11.2202H80.0147L80.5662 9.32455ZM66.4544 9.99174C68.5735 9.99174 70.2313 8.87511 70.7816 7.07623C71.3284 5.28777 70.3099 4.25396 68.018 4.25396H64.9335L62.2965 13.0121H64.4734L65.3561 9.99174H66.4544ZM89.1953 8.30175C90.6132 9.04308 90.7196 9.87823 90.6132 10.5605C90.3768 12.0773 89.2173 13.0121 86.7981 13.0121C85.7889 13.0121 84.8906 13.004 84.3975 12.8829L84.9756 11.2115C85.4611 11.3273 86.5114 11.4153 87.1444 11.4153C87.7773 11.4153 88.6525 11.1634 88.6525 10.4615C88.6525 10.01 88.1584 9.79578 87.4061 9.46965L87.2415 9.39811C86.4132 9.01296 85.3918 8.12974 85.6473 6.85615C85.9658 5.25361 87.5357 4.25744 89.3467 4.25744C90.1271 4.25744 91.5063 4.51285 91.8566 4.83661C91.5612 5.08275 91.0364 5.60921 90.8739 6.42294C90.3294 5.99204 89.6548 5.89532 88.9531 5.99204C88.2513 6.08876 87.5369 6.69399 87.8005 7.38204C87.8982 7.64498 88.5779 8.0139 89.1953 8.30175ZM95.2375 5.96192C94.508 6.05633 93.7658 6.65113 94.0398 7.32586C94.1439 7.58185 94.8491 7.94614 95.4919 8.22877C96.9653 8.95736 97.1104 9.77688 97.0011 10.4476C96.7555 11.9372 95.4919 13.0121 92.9791 13.0121C91.9219 13.0121 90.6768 12.408 90.6768 12.408C91.1577 11.998 91.434 11.4263 91.5057 10.6931C91.8034 10.9653 92.7016 11.2868 93.3595 11.2868C94.0173 11.2868 94.9271 11.0447 94.9884 10.4476C95.038 9.96059 94.3558 9.67725 93.4951 9.31976L93.4606 9.30544C92.5993 8.92782 91.5404 8.06024 91.8034 6.80924C92.1346 5.23623 93.7687 4.25744 95.6462 4.25744C96.8092 4.25744 97.8699 4.47637 98.233 4.83661L97.0011 6.27583C96.7312 6.03316 95.967 5.86694 95.2375 5.96192ZM68.5671 7.10635C68.7983 6.3488 68.3613 5.89648 67.3839 5.89648H66.6058L65.8544 8.34924H66.5232C67.5856 8.34924 68.3255 7.89749 68.5671 7.10635ZM74.8742 5.82292C75.7898 5.82292 76.1962 6.28856 75.9597 7.06175V7.0658C75.7077 7.88822 74.9643 8.35213 73.8892 8.34865H73.1065L73.8799 5.82292H74.8742ZM102 0H99.3329L97.0514 2.36878H99.7162L102 0ZM91.8819 2.36878H87.5466L89.8316 0H94.1669L91.8819 2.36878ZM92.7161 2.36878H96.2173L98.4994 0H94.9988L92.7161 2.36878Z",fill:"url(#paint0_linear)"}),Cp=m.a.createElement("defs",null,m.a.createElement("linearGradient",{id:"paint0_linear",x1:71.0831,y1:11.6696,x2:101.853,y2:11.6696,gradientUnits:"userSpaceOnUse"},m.a.createElement("stop",{stopColor:"#EE4D2D"}),m.a.createElement("stop",{offset:1,stopColor:"#FF8833"}))),Sp=function(e){var t=e.svgRef,n=e.title,a=dp(e,["svgRef","title"]);return m.a.createElement("svg",lp({width:102,height:16,viewBox:"0 0 102 16",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,pp,fp,gp,hp,mp,vp,_p,bp,Ep,yp,Cp)},Op=m.a.forwardRef((function(e,t){return m.a.createElement(Sp,lp({svgRef:t},e))})),Ap=n(1358),Tp=n(238),Ip=n.n(Tp),wp=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).triggerRef=void 0,a.alignRef=void 0,a.triggerRef=m.a.createRef(),a.alignRef=m.a.createRef(),a.updateStyle=a.updateStyle.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"updateStyle",value:function(){var e=this.triggerRef&&this.triggerRef.current,t=this.alignRef&&this.alignRef.current;if(e&&t){var n=this.props,a=n.position,r=n.distanceFromTop,o=n.distanceAddonLeft,i=e.getBoundingClientRect(),s=i.left,c=i.top,u=i.width,l=t.getBoundingClientRect(),d=l.width,p=l.height,f=0;f="right"===a?s-(d-u):"center"===a?s-(d-u)/2:s,t.style.top=c-p-r-4+"px",t.style.left=f+o+"px"}}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,a=t.title,r=t.hideOnClick,o=t.position,i=t.isShowArrow,s=t.isOrderTitle,c=t.isHidden;return m.a.createElement(Ap.a,{closeOnOutsideClick:!0,onOpen:this.updateStyle,node:Qd()},(function(t){var u=t.openPortal,l=t.closePortal,d=t.portal;return m.a.createElement("div",null,m.a.createElement("div",{ref:e.triggerRef,onMouseEnter:u,onMouseLeave:l,onClick:function(){return r&&l()}},n),d(!c&&m.a.createElement("div",{ref:e.alignRef,className:w()(Ip.a.portal,Ip.a[o],Object(x.a)({},Ip.a.arrow,i),Object(x.a)({},Ip.a.orderTitle,s))},a)))}))}}]),n}(h.Component);wp.defaultProps={hideOnClick:!1,position:"center",distanceFromTop:4,distanceAddonLeft:0,isShowArrow:!0,isOrderTitle:!1};var Lp=wp,kp=n(402),Mp=n.n(kp),jp=n(137),xp=n.n(jp),Rp=Object(O.b)((function(e){return{sessionInfo:e.getIn(["chatbot","sessionInfo"]),socketStatus:e.getIn(["socket","socketStatus"])}}))(Fd((function(e){var t=e.socketStatus,a=e.liveAgentAvatar,r=e.botAvatar,o=e.sessionInfo,i=e.isLiveAgentChatting;return m.a.createElement("div",{className:xp.a.avatar},function(){var e=String(yt("chat_region")||"default").toLowerCase(),s="cn"!==e?"avatar_".concat(e,"_l"):"avatar_default_l",c=n(1138)("./".concat(e,".png")),u=n(576)("./".concat(s,".png"));return i?m.a.createElement("div",{className:w()(xp.a.avatar)},m.a.createElement("img",{className:xp.a.avatarImage,src:Object(so.cdnFile)(o.sellerLiveAgentAvatar)||Object(so.cdnFile)(yt("liveAgentAvatar"))||a||u,alt:""})):t===Lt.OPEN?m.a.createElement("div",{className:w()(xp.a.avatar)},m.a.createElement("img",{className:xp.a.avatarImage,src:r||c||Mp.a,alt:""})):m.a.createElement("div",{className:w()(xp.a.avatar)},m.a.createElement("img",{className:xp.a.avatarImage,src:Object(so.cdnFile)(o.chatbotAvatar)||c||Mp.a,alt:""}))}())}))),Np=Object(O.b)((function(e){return{shouldShowWindow:e.getIn(["global","shouldShowWindow"]),disableMinimize:e.getIn(["conversation","showConflicted"])||e.getIn(["conversation","disableMinimize"]),messageList:e.getIn(["message","messageList"]),agentName:e.getIn(["conversation","agentName"]),conversationStatus:e.getIn(["conversation","conversationStatus"]),transferChatStatus:e.getIn(["user","transferChatStatus"])}}),(function(e){return{minimizeWindow:function(){e(u.minimizeWindow())}}}))(Fd((function(e){var t=Object(rp.a)().t,n=e.minimizeWindow,a=e.disableMinimize,r=e.isMobileStyle,o=e.platform,i=e.messageList,s=e.agentName,c=e.conversationStatus,u=e.transferChatStatus,l=function(){var e=Gi();if(Pi({targetType:"fold_button",operation:"click",data:Object(d.a)({},e)}),!a){var t=i.last(),r=null===t||void 0===t?void 0:t.get("id"),o=/^[0-9]+$/.test(r);r&&o&&Et("lastConversationReadMessageId",r),n()}},p=(null===s||void 0===s?void 0:s.length)>0?s:yt("agentName"),f=!1;f=Zc(o)?u===fe.Chatting:c===fe.Chatting||u===fe.Chatting;var g=ou(o)&&!f,h=f?p:o===Oe.Gudangku?t("cschat_chat_with_customer_support"):ou(o)?t("cschat_chat_with_title"):t("cschat_chat_with_shopee"),v=function(){return o!==Oe.Gudangku||f?g?m.a.createElement(Op,{className:ap.a.SPXLogo}):m.a.createElement(Rp,{isLiveAgentChatting:f}):m.a.createElement(up,{className:ap.a.gudangkuLogo})};return m.a.createElement("div",{className:ap.a.header},!g&&v(),m.a.createElement("div",{className:ap.a.headerTitle},h,g&&v()),r?m.a.createElement("div",{className:"".concat(ap.a.minimizeIcon," ").concat(a?ap.a.disabledMinIcon:""),onClick:l}):m.a.createElement(Lp,{title:t("cschat_minimize")},m.a.createElement("div",{className:"".concat(ap.a.minimizeIcon," ").concat(a?ap.a.disabledMinIcon:""),onClick:l})))}))),Pp=n(33),Up=n.n(Pp),Dp=n(661),Bp=n.n(Dp),Wp=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).handleClick=a.handleClick.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props.t;return m.a.createElement("div",{className:Up.a.container},m.a.createElement("img",{className:Up.a.failImage,src:Bp.a,alt:""}),m.a.createElement("div",{className:Up.a.text},e("cschat_failed_load"),",",m.a.createElement("span",{onClick:this.handleClick,className:Up.a.link},e("cschat_click_to_try_again"))))}},{key:"handleClick",value:function(){this.props.initSession()}}]),n}(h.PureComponent),Hp=Object(O.b)(void 0,(function(e){return{initSession:function(){e(c.initSession())}}}))(Object(V.a)()(Wp)),Fp=n(662),Gp=n.n(Fp),Vp=n(663),Qp=n.n(Vp),qp=n(664),Kp=n.n(qp),zp=n(665),Jp=n.n(zp),Yp=function(e){return m.a.createElement("a",{className:Jp.a.phone,href:"tel:".concat(e.phoneNumber)},e.children)},Xp=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).handleClick=a.handleClick.bind(Object(y.a)(a)),a.leaveMessageClick=a.leaveMessageClick.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"renderPCElement",value:function(){var e=this.props,t=e.t,n=e.type,a=e.noValidAgentReason,r=e.showLeaveMessageBtn,o=void 0===r||r,i=e.minimizeWindow,s=e.platform;return m.a.createElement("div",{className:Up.a.container},m.a.createElement("img",{className:Up.a.errorImage,src:"system"===n?Gp.a:Kp.a,alt:""}),m.a.createElement("div",{className:Up.a.info},t("system"===n?"cschat_something_went_wrong":a||"cschat_no_agents_avaliable")),m.a.createElement("div",{className:Up.a.text,onClick:this.handleClick,dangerouslySetInnerHTML:{__html:t(ou(s)?"cschat_spx_try_again_later":xe?"cschat_try_again_later":"cschat_try_again_later_and_phone_number",{linkClass:Up.a.link})}}),m.a.createElement("div",{className:Up.a.btnGroup},m.a.createElement(j.a,{onClick:i,className:Up.a.cancelBtn},t("cschat_general_cancel")),o?m.a.createElement(j.a,{className:Up.a.leaveUsMessage,type:"primary",onClick:this.leaveMessageClick},t("cschat_leave_us_a_message")):null))}},{key:"renderMobileElement",value:function(){var e=this.props,t=e.t,n=e.type,a=e.minimizeWindow,r=e.platform;return m.a.createElement("div",{className:Up.a.container},m.a.createElement("div",{className:Up.a.top},m.a.createElement("div",{className:Up.a.topContainer},m.a.createElement("img",{className:Up.a.errorImage,src:Qp.a,alt:""}),m.a.createElement("div",{className:Up.a.info},t("system"===n?"cschat_something_went_wrong":"cschat_no_agents_avaliable")),m.a.createElement("div",{className:Up.a.text,onClick:this.handleClick,dangerouslySetInnerHTML:{__html:t(xe?"cschat_try_again_later":"cschat_try_again_later_and_phone_number",{linkClass:Up.a.link})}}),m.a.createElement("div",{className:Up.a.btnGroup},m.a.createElement(j.a,{className:Up.a.leaveUsMessage,type:"primary",onClick:this.leaveMessageClick},t("cschat_leave_us_a_message"))),xe&&m.a.createElement("div",{className:Up.a.callUs},m.a.createElement(Yp,{phoneNumber:"4001268888"},t("cschat_call_us"))))),m.a.createElement("div",{className:Up.a.bottom},r!==Oe.WeChat&&m.a.createElement("div",{className:Up.a.mobileCancelWrap},m.a.createElement(j.a,{className:Up.a.mobileCancel,type:"link",onClick:a}," ",t("cschat_general_cancel")," "))))}},{key:"handleClick",value:function(e){var t=this.props,n=t.initSession,a=t.needKeepConversation;e.target.className.indexOf("link")>-1&&n({needKeepConversation:a})}},{key:"leaveMessageClick",value:function(){Yc(this.props.platform)}},{key:"render",value:function(){return this.props.isMobileStyle?this.renderMobileElement():this.renderPCElement()}}]),n}(h.PureComponent),Zp=Object(O.b)((function(e){return{needKeepConversation:e.getIn(["conversation","needKeepConversation"]),noValidAgentReason:e.getIn(["conversation","noValidAgentReason"]),showLeaveMessageBtn:e.getIn(["conversation","showLeaveMessageBtn"])}}),(function(e){return{initSession:function(t){e(c.initSession(t))},minimizeWindow:function(){e(u.minimizeWindow({needKeepConversation:!0}))}}}))(Object(V.a)()(Fd(Xp))),$p=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).state={showCancelQueueModal:!1,avatarRegionCls:"avatar-bot",contactingText:e.t("cschat_contacting_tips_text")},a.closeCancelQueueModal=a.closeCancelQueueModal.bind(Object(y.a)(a)),a.showCancelQueueModal=a.showCancelQueueModal.bind(Object(y.a)(a)),a.leaveMessageClick=a.leaveMessageClick.bind(Object(y.a)(a)),a.endQueue=a.endQueue.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"closeCancelQueueModal",value:function(){this.setState({showCancelQueueModal:!1}),this.props.updateDisableMinimizeStatus(!1)}},{key:"endQueue",value:function(){var e=Object(g.a)(f.a.mark((function e(){var t,n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,n=t.endConversation,a=t.minimizeWindow,r=t.updateDisableMinimizeStatus,n(),r(!1),this.setState({showCancelQueueModal:!1}),a();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"showCancelQueueModal",value:function(){this.setState({showCancelQueueModal:!0}),this.props.updateDisableMinimizeStatus(!0)}},{key:"leaveMessageClick",value:function(){Yc(this.props.accessPlatform)}},{key:"componentDidMount",value:function(){this.setState({avatarRegionCls:Zc(this.props.accessPlatform)?"avatar-bot":"avatar-".concat("cn".toLocaleLowerCase()),contactingText:Zc(this.props.accessPlatform)?"cschat_connecting_bot_tips_text":"cschat_contacting_tips_text"}),this.closeCancelQueueModal()}},{key:"render",value:function(){var e=this.props,t=e.t,n=e.conversationStatus,a=e.displayQueuePosition,r=e.disableMinimize,o=e.queuePositionUpdateSwitchOpen;return m.a.createElement(h.Fragment,null,(n===fe.Uninitialized||n===fe.AgentQueue)&&m.a.createElement("div",{className:ap.a.contactWrapper},m.a.createElement("div",{className:"".concat(ap.a.waterRipple," ").concat(n===fe.AgentQueue?ap.a.waterRippleSlide:"")},m.a.createElement("div",{className:"".concat(ap.a.avatar," ").concat(ap.a[this.state.avatarRegionCls])}),m.a.createElement("div",{className:"".concat(ap.a.wave," ").concat(ap.a.wave4)}),m.a.createElement("div",{className:"".concat(ap.a.wave," ").concat(ap.a.wave3)}),m.a.createElement("div",{className:"".concat(ap.a.wave," ").concat(ap.a.wave2)}),m.a.createElement("div",{className:"".concat(ap.a.wave," ").concat(ap.a.wave1)})),n===fe.Uninitialized&&m.a.createElement("div",{className:ap.a.contactingTips},t(this.state.contactingText)),n===fe.AgentQueue&&m.a.createElement(h.Fragment,null,!1===o?m.a.createElement("div",{className:ap.a.queueTips},t("cschat_long_queue_time")):m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:ap.a.queueTips},t("cschat_queue_tips_text")),m.a.createElement("div",{className:ap.a.queueNumber},a)),m.a.createElement("div",{className:ap.a.btnGroup},m.a.createElement(j.a,{onClick:this.showCancelQueueModal,className:ap.a.cancelBtn},t("cschat_general_cancel")),m.a.createElement(j.a,{type:"primary",onClick:this.leaveMessageClick},t("cschat_leave_us_a_message"))))),(n===fe.ContactingError||n===fe.QueueError)&&m.a.createElement(Hp,null),n===fe.SystemError&&m.a.createElement(Zp,{type:"system"}),n===fe.NoAgent&&m.a.createElement(Zp,{type:"noAgent"}),this.state.showCancelQueueModal&&n===fe.AgentQueue&&r&&m.a.createElement("div",{className:ap.a.cancelModal},m.a.createElement("div",{className:ap.a.modalTitle},t("cschat_cancel_queue")),m.a.createElement("div",{className:ap.a.modalContent},t("cschat_cancel_queue_tips")),m.a.createElement("div",{className:ap.a.modalBtnGroup},m.a.createElement(j.a,{onClick:this.closeCancelQueueModal,className:ap.a.noBtn},t("cschat_genera_no")),m.a.createElement(j.a,{onClick:this.endQueue,type:"primary"},t("cschat_genera_yes")))))}}]),n}(h.PureComponent),ef=Object(O.b)((function(e){return{conversationStatus:e.getIn(["conversation","conversationStatus"]),displayQueuePosition:e.getIn(["message","displayQueuePosition"]),disableMinimize:e.getIn(["conversation","disableMinimize"]),queuePositionUpdateSwitchOpen:e.getIn(["conversation","connectionConfigInfo"]).queuePositionUpdateSwitchOpen,accessPlatform:e.getIn(["global","accessPlatform"])}}),(function(e){return{minimizeWindow:function(){e(u.minimizeWindow({needKeepConversation:!0}))},endConversation:function(){e(c.endConversation({noNeedUpdateStates:!0}))},updateDisableMinimizeStatus:function(t){e(c.updateDisableMinimizeStatus(t))}}}))(Object(V.a)()($p)),tf=n(301),nf=n(403),af=n.n(nf),rf=n(670),of=n.n(rf),sf=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){return m.a.createElement("div",{className:af.a.root},m.a.createElement("img",{src:of.a,className:af.a.img}))}}]),n}(h.PureComponent),cf=n(240),uf=n.n(cf),lf=/(https?|ftp|file):\/\/([\w-]+\.)+[\w-]+(:\d+)?(\/[\w-./?%&=]*)?/g,df=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props,t=e.isSender,n=e.text,a=e.status,r=e.sourceType,o=a===ln.Typing,i=function(e){if(!e)return e;var t=e.match(lf);if(!t)return e;for(var n=[];t.length;){var a=t.shift(),r=e.indexOf(a);n.push({type:"text",content:e.substring(0,r)},{type:"link",content:e.substr(r,a.length)}),e=e.substring(r+a.length)}return e&&n.push({type:"text",content:e}),n}(n),s=r===dn.Bot&&!t,c=w()(uf.a.content,t?uf.a.senderContent:uf.a.receiverContent),u=!s&&Array.isArray(i)?m.a.createElement("span",null,i.map((function(e,t){var n=e.type,a=e.content;if("link"===n){var r=/^https?/.test(a)?a:"https://".concat(a);return m.a.createElement("a",{rel:"noopener noreferrer",key:t,href:r,target:"_blank",onClick:function(){Re&&(window.ignoreError=!0)},className:uf.a.link},a)}return a}))):n;return o?m.a.createElement("pre",{className:c},m.a.createElement(sf,null)):s?m.a.createElement("div",{className:c,dangerouslySetInnerHTML:{__html:n}}):m.a.createElement("pre",{className:c},u)}}]),n}(h.PureComponent);df.defaultProps={isSender:!1};var pf,ff=df,gf=n(671),hf=n.n(gf),mf=function(e){var t=e.text;return m.a.createElement("div",{className:hf.a.root},t)},vf=n(294),_f=n.n(vf),bf=n(295),Ef=n.n(bf),yf=n(296),Cf=n.n(yf),Sf=n(165),Of=n.n(Sf),Af=(pf={},Object(x.a)(pf,se.Positive,{img:Cf.a,title:"cschat_thank_for_rate",subTitle:"cschat_spx_good_will_improve_service"}),Object(x.a)(pf,se.Neutral,{img:Ef.a,title:"cschat_sorry_for_inconvenience",subTitle:"cschat_spx_average_will_improve_service"}),Object(x.a)(pf,se.Unliked,{img:_f.a,title:"cschat_sorry_for_inconvenience",subTitle:"cschat_spx_bad_will_improve_service"}),pf),Tf=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.t,a=e.platform,r=Af[t];return r?m.a.createElement("div",{className:Of.a.root},m.a.createElement("div",{className:Of.a.left},m.a.createElement("img",{className:Of.a.img,src:r.img,alt:""})),m.a.createElement("div",{className:Of.a.right},m.a.createElement("div",{className:Of.a.title},n(r.title)),m.a.createElement("div",{className:Of.a.subTitle},ou(a)?n(r.subTitle):n("cschat_will_improve_service")))):null}}]),n}(h.PureComponent),If=Object(V.a)()(Tf),wf=n(672),Lf=n.n(wf),kf=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){return m.a.createElement("div",{className:Lf.a.root})}}]),n}(h.Component),Mf=n(673),jf=n.n(Mf),xf=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){return m.a.createElement("div",{className:jf.a.root},m.a.createElement(kf,null))}}]),n}(h.Component);function Rf(){return(Rf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Nf(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Pf=m.a.createElement("g",{fill:"none",fillRule:"evenodd"},m.a.createElement("path",{fill:"#E0E0E0",fillRule:"nonzero",d:"M27.6818182,2.84217094e-13 C28.4098299,2.84217094e-13 29,0.62680135 29,1.4 L28.9999918,17.07089 C26.7710364,17.3897198 24.880815,18.7586033 23.846504,20.6603639 C15.4785375,14.0935975 11.2886972,10.8052978 11.2767149,10.7965395 C10.7663501,10.4287931 10.0775548,10.5260164 9.67871408,11.0011237 L9.59785698,11.1086847 L2.15462166,23.0183674 C1.78047291,24.1844469 2.08533941,24.7674866 3.06922115,24.7674866 C7.66499822,24.7674866 14.3300175,24.8303356 23.064279,24.9560336 C23.2178638,26.0774213 23.6366594,27.1144007 24.255617,28.0013298 L1.31818182,28 C0.590170102,28 1.0658141e-14,27.3731986 1.0658141e-14,26.6 L1.0658141e-14,1.4 C1.0658141e-14,0.62680135 0.590170102,2.84217094e-13 1.31818182,2.84217094e-13 L27.6818182,2.84217094e-13 Z M20.8963991,5 C19.4360308,5 18.2521684,6.20411207 18.2521684,7.68945958 C18.2521684,9.17480709 19.4360308,10.3789192 20.8963991,10.3789192 C22.3567675,10.3789192 23.5406299,9.17480709 23.5406299,7.68945958 C23.5406299,6.20411207 22.3567675,5 20.8963991,5 Z"}),m.a.createElement("circle",{cx:30,cy:24,r:6,fill:"#5C7"}),m.a.createElement("path",{fill:"#FFF",d:"M28.7426407,20.7426407 L28.7426407,23.7426407 L33.7426407,23.7426407 L33.7426407,25.7426407 L26.7426407,25.7426407 L26.7426407,20.7426407 L28.7426407,20.7426407 Z",transform:"rotate(-45 30.243 23.243)"})),Uf=function(e){var t=e.svgRef,n=e.title,a=Nf(e,["svgRef","title"]);return m.a.createElement("svg",Rf({width:36,height:30,viewBox:"0 0 36 30",ref:t},a),n?m.a.createElement("title",null,n):null,Pf)},Df=m.a.forwardRef((function(e,t){return m.a.createElement(Uf,Rf({svgRef:t},e))})),Bf=n(674),Wf=n.n(Bf),Hf=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){return m.a.createElement("div",{className:Wf.a.root},m.a.createElement(Df,null))}}]),n}(h.Component);function Ff(){return(Ff=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Gf(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Vf=m.a.createElement("path",{fill:"#CCCCCC",fillRule:"evenodd",d:"M8,0 C12.418278,0 16,3.581722 16,8 C16,12.418278 12.418278,16 8,16 C3.581722,16 0,12.418278 0,8 C0,3.581722 3.581722,0 8,0 Z M8.8,10.5 L7.3,10.5 L7.3,12 L8.8,12 L8.8,10.5 Z M8.8,4 L7.3,4 L7.3,9 L8.8,9 L8.8,4 Z"}),Qf=function(e){var t=e.svgRef,n=e.title,a=Gf(e,["svgRef","title"]);return m.a.createElement("svg",Ff({width:16,height:16,viewBox:"0 0 16 16",ref:t},a),n?m.a.createElement("title",null,n):null,Vf)},qf=m.a.forwardRef((function(e,t){return m.a.createElement(Qf,Ff({svgRef:t},e))})),Kf=n(404),zf=n.n(Kf),Jf=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.onClick;return m.a.createElement("div",{className:zf.a.root,onClick:n},m.a.createElement(qf,null),m.a.createElement("div",{className:zf.a.reload},t("cschat_relaod_picture")))}}]),n}(h.Component),Yf=Object(V.a)()(Jf),Xf=n(675),Zf=n.n(Xf),$f=16/9,eg=9/16,tg=0,ng=1,ag=2,rg=3,og=4,ig={},sg=function(e){return"style__".concat(e)},cg=function(e){return"data__".concat(e)},ug=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).status=void 0,a.unmounted=!1,a.measured=!1,a.needMeasure=!1,a.status=kn.get(sg(e.messageId))?ag:tg,a.handleLoad=a.handleLoad.bind(Object(y.a)(a)),a.handleError=a.handleError.bind(Object(y.a)(a)),a.handleCalculate=a.handleCalculate.bind(Object(y.a)(a)),a.setPreviewImageSrc=a.setPreviewImageSrc.bind(Object(y.a)(a)),a.handleReload=a.handleReload.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(){this.needMeasure&&(this.props.measure(),this.measured=!0,this.needMeasure=!1)}},{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"loadImage",value:function(e){var t=this;try{var n=this.props.messageId,a=new XMLHttpRequest;a.responseType="blob",a.open("get",e,!0),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE&&200===a.status){var e=new FileReader;e.readAsDataURL(a.response),e.onload=function(){if("string"===typeof e.result){var a=new Image;a.src=e.result,kn.set(cg(n),a.src),t.handleCalculate(a)}}}a.readyState===XMLHttpRequest.DONE&&200!==a.status&&(t.handleError(),Pi({operation:"impression",targetType:"reload_image"}))},a.send()}catch(r){this.handleError()}}},{key:"handleCalculate",value:function(e){if(!this.measured&&!this.unmounted){var t=this.props.messageId,n=e.width,a=e.height,r={maxWidth:144,minHeight:28,borderRadius:8};n>a&&n/a>=$f&&(r={maxWidth:184}),n<a&&n/a<=eg&&(r={maxHeight:184}),this.status=ag,kn.set(sg(t),r),this.forceUpdate()}}},{key:"handleLoad",value:function(){this.needMeasure=!0,Pi({operation:"impression",targetType:"image"}),this.forceUpdate()}},{key:"handleError",value:function(){this.needMeasure=!0;var e=this.props.isHistoryImageMessage;this.status=e?og:rg,this.forceUpdate()}},{key:"setPreviewImageSrc",value:function(){var e=this.props,t=e.messageId,n=e.setPreviewImageSrc;Pi({operation:"click",targetType:"image"}),n(t)}},{key:"handleReload",value:function(){this.status=tg,Pi({operation:"click",targetType:"reload_image"}),this.forceUpdate()}},{key:"render",value:function(){var e=this.props,t=e.url,n=e.messageId,a=kn.get(sg(n),"");return this.status===rg?m.a.createElement(Hf,null):this.status===og?m.a.createElement(Yf,{onClick:this.handleReload}):(this.status===tg&&(this.status=ng,this.loadImage(t)),a?m.a.createElement("div",{className:Zf.a.root,onClick:this.setPreviewImageSrc},m.a.createElement("img",{src:kn.get(cg(n),""),style:a||ig,onLoad:this.handleLoad,onError:this.handleError,alt:""})):m.a.createElement(xf,null))}}]),n}(h.PureComponent),lg=n(163),dg=n(677),pg=n.n(dg),fg=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).handleDownloadFile=a.handleDownloadFile.bind(Object(y.a)(a)),a.downloadFile=a.downloadFile.bind(Object(y.a)(a)),a.handleClick=a.handleClick.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"handleDownloadFile",value:function(){var e,t=this;this.props.isSender?(e={fileKey:this.props.fileKey},wn().get("/validate_download",{params:e})).then((function(e){!e.data||e.data.exist?0===e.code&&t.downloadFile():Hc.dispatch(Od({msg:t.props.t("cschat_file_expire")}))})):this.downloadFile()}},{key:"downloadFile",value:function(){var e=this.props,t=e.platform,n=(e.isMobileStyle,document.createElement("a"));n.href=this.props.url,t===Oe.WeChat&&n.setAttribute("target","_blank"),n.style.display="none","undefined"===typeof n.download&&n.setAttribute("target","_blank"),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)}},{key:"componentDidMount",value:function(){Pi({operation:"impression",targetType:"file"})}},{key:"handleClick",value:function(){Pi({operation:"click",targetType:"file"})}},{key:"render",value:function(){var e=this.props,t=e.url,n=e.size,a=e.name,r=e.messageId,o=e.isSender,i=e.progress,s=e.measure;return m.a.createElement("div",{className:pg.a.root,onClick:this.handleClick},m.a.createElement(lg.c,{url:t,name:a,size:n,uploadProgress:i,measure:s,messageId:r,isSender:o,downloadFileAction:this.handleDownloadFile}))}}]),n}(h.PureComponent),gg=Object(V.a)()(Fd(fg)),hg=n(207),mg=n.n(hg),vg=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props.t;return m.a.createElement("div",{className:mg.a.root},m.a.createElement("div",{className:mg.a.title},e("cschat_contact_customer_service_team_tips")),m.a.createElement("div",{className:mg.a.message},m.a.createElement("a",{onClick:this.gotoLeaveMessagePage,href:"javascript:void(0)",rel:"noopener noreferrer"},e("cschat_leave_us_a_message"))),m.a.createElement("div",{className:w()(mg.a.call,Object(x.a)({},mg.a.callColor,xe))},xe?m.a.createElement(Yp,{phoneNumber:"4001268888"},e("cschat_call_us")):e("cschat_call_us")))}},{key:"componentDidMount",value:function(){Pi({operation:"impression",targetType:"contact_cs_team"})}},{key:"gotoLeaveMessagePage",value:function(){Pi({operation:"click",targetType:"contact_cs_team"}),Yc(Oe.ShopeeCn)}}]),n}(h.PureComponent),_g=Object(V.a)()(Fd(vg)),bg=n(125),Eg=n.n(bg),yg=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).handleChatWithAgent=a.handleChatWithAgent.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){var e=Gi();delete e.enquiry_type,Pi({targetType:"chat_with_agent",operation:"impression",data:Object(d.a)({},e)})}},{key:"handleChatWithAgent",value:function(){var e=this.props,t=e.t,n=e.platform,a=e.messageId,r=e.isLogined,o=e.transferChatStatus,i=e.currentLiveAgentMessageId,s=e.sendMessage,c=e.initSession,u=e.updateTransferChatStatus,l=e.pushEnquiryTypeMessage,p=e.updateCurrentLiveMessageId,f=e.redirectToLogin;r?o!==fe.Chatting&&a===i&&(s(t("message_liveagent_chatwithagent"),1),ru(n)||Zc(n)?l():(c(),u(fe.Transfering)),p("#")):(Et("ImmediateChatAfterLogin",!0),s(t("message_liveagent_chatwithagent"),1),f());var g=Gi();delete g.enquiry_type,Pi({targetType:"chat_with_agent",operation:"click",data:Object(d.a)({},g)})}},{key:"render",value:function(){var e=this.props,t=e.t,n=e.messageId!==e.currentLiveAgentMessageId;return m.a.createElement("div",{className:Eg.a.root},m.a.createElement("div",{className:"".concat(Eg.a.inner," ").concat(n?Eg.a.disabledInner:"")},m.a.createElement("div",{className:Eg.a.option},t("message_liveagent_tips")),m.a.createElement("div",{className:"".concat(Eg.a.agent," ").concat(n?Eg.a.disabledOption:"")},m.a.createElement("span",{className:Eg.a.agentIcon}),m.a.createElement("span",{className:Eg.a.agentText,onClick:this.handleChatWithAgent},t("message_liveagent_chatwithagent")))))}}]),n}(m.a.PureComponent),Cg=Object(O.b)((function(e){var t=e.getIn(["user","isLogined"]),n=e.getIn(["user","transferChatStatus"]),a=e.getIn(["message","currentLiveAgentMessageId"]);return{enquiryTypes:e.getIn(["user","enquiryTypes"]),isLogined:t,transferChatStatus:n,currentLiveAgentMessageId:a}}),(function(e){return{initSession:function(){e(c.initChatSdk({}))},updateTransferChatStatus:function(t){e(r.updateTransferChatStatus(t))},pushEnquiryTypeMessage:function(){e(i.pushEnquiryTypeMessage())},updateCurrentLiveMessageId:function(t){e(i.updateCurrentLiveAgentMessageId(t))},redirectToLogin:function(){e(u.redirectToLogin())}}}))(Object(V.a)()(Fd(yg))),Sg=n(241),Og=n.n(Sg),Ag=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).getGreetTittleTransfyKey=function(){var e=a.props.platform;return ou(e)?"cschat_enquiry_spx_greeting":ru(e)?"cschat_enquiry_seller_greeting":"cschat_enquiry_message_title"},a.goEnquiry=a.goEnquiry.bind(Object(y.a)(a)),a.autoGoEnquiry=a.autoGoEnquiry.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"goEnquiry",value:function(e){var t=this.props,n=t.messageId,a=t.currentEnquiryMessageId,r=t.sendMessage,o=t.initSession,i=t.updateTransferChatStatus,s=t.updateCurrentEnquiryMessageId,c=t.platform,u=t.addBotMessage;n===a&&(ru(c)?u(e.content):r(e.content,1,!0),o(e.value,e.content),i(fe.Transfering),s("#"))}},{key:"autoGoEnquiry",value:function(e){var t=this.props,n=t.initSession,a=t.updateTransferChatStatus;n(e.value,e.content),a(fe.Transfering)}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,a=t.enquiryTypes,r=t.messageId,o=t.currentEnquiryMessageId,i=Hc.getState().getIn(["conversation","conversationStatus"]),s=Hc.getState().getIn(["user","transferChatStatus"]),c=i===fe.Chatting&&s===fe.Chatting,u=r!==o||c,l=this.getGreetTittleTransfyKey();return m.a.createElement("div",{className:Og.a.root},m.a.createElement("div",{className:Og.a.title},n(l)),(a||[]).map((function(t){return m.a.createElement("div",{key:t.value,className:"".concat(Og.a.option," ").concat(u?Og.a.disabledOptions:""),onClick:function(){return e.goEnquiry(t)}},t.content)})))}}]),n}(m.a.PureComponent),Tg=Object(O.b)((function(e){return{enquiryTypes:e.getIn(["user","enquiryTypes"]),currentEnquiryMessageId:e.getIn(["message","currentEnquiryMessageId"])}}),(function(e){return{initSession:function(t,n){e(c.initChatSdk({enquiryType:t,enquiryName:n}))},updateTransferChatStatus:function(t){e(r.updateTransferChatStatus(t))},updateCurrentEnquiryMessageId:function(t){e(i.updateCurrentEnquiryMessageId(t))},removeMessageItem:function(t){e(i.removeMessageItem(t))},addBotMessage:function(t){e(fr(t))}}}))(Object(V.a)()(Ag)),Ig=n(138),wg=n.n(Ig),Lg=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){return m.a.createElement("div",{className:wg.a.wrapper},m.a.createElement("span",{className:"".concat(wg.a.loading," ").concat(wg.a.loading1)}),m.a.createElement("span",{className:"".concat(wg.a.loading," ").concat(wg.a.loading2)}),m.a.createElement("span",{className:"".concat(wg.a.loading," ").concat(wg.a.loading3)}))}}]),n}(m.a.PureComponent),kg=n(103),Mg=n.n(kg),jg=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).gotoLeaveMessagePage=function(){fs.resumeOrInit(),a.props.cancelQueueWaiting(),Yc(a.props.platform)},a.cancelQueue=a.cancelQueue.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(e){if(e.queuePosition!==this.props.queuePosition){var t=this.props.measure;t&&t()}}},{key:"cancelQueue",value:function(){this.props.updateCancelQueueConfirm(!0),this.props.pushCancelQueueMessage()}},{key:"render",value:function(){var e=this.props,t=e.t,n=e.displayQueuePosition,a=e.queuePosition,r=e.queuePositionUpdateSwitchOpen,o=Number(a);return m.a.createElement("div",{className:Mg.a.root},o?m.a.createElement("div",null,m.a.createElement("div",{className:Mg.a.wrapper},m.a.createElement("span",{className:Mg.a.loading},m.a.createElement(Lg,null)),m.a.createElement("span",{className:Mg.a.onqueue},!1===r?t("cschat_long_queue_time"):t("cschat_message_queue_position",{position:n}))),m.a.createElement("div",{className:Mg.a.wrapper},m.a.createElement("div",null,m.a.createElement("span",{className:Mg.a.joinerbtn,onClick:this.cancelQueue},t("cschat_general_cancel")),m.a.createElement("span",{className:Mg.a.joiner},t("cschat_cancel_and_leave_message_joiner")),m.a.createElement("span",{className:Mg.a.joinerbtn,onClick:this.gotoLeaveMessagePage},t("cschat_leave_us_a_message"))))):m.a.createElement("div",{className:Mg.a.wrapper},m.a.createElement("span",{className:Mg.a.loading},m.a.createElement(Lg,null)),t("cschat_queue_message_connecting")))}}]),n}(m.a.PureComponent),xg=Object(O.b)((function(e){return{queuePosition:e.getIn(["message","queuePosition"]),displayQueuePosition:e.getIn(["message","displayQueuePosition"]),queuePositionUpdateSwitchOpen:e.getIn(["conversation","connectionConfigInfo"]).queuePositionUpdateSwitchOpen,chatbotEnabled:e.getIn(["chatbot","enabled"])}}),(function(e){return{updateCancelQueueConfirm:function(t){e(r.updateCancelQueueConfirm(t))},pushCancelQueueMessage:function(){e(rc())},cancelQueueWaiting:function(){e(c.endConversation({noNeedUpdateStates:!0}))}}}))(Object(V.a)()(jg)),Rg=n(139),Ng=n.n(Rg),Pg=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).displayQueuePosition=void 0,a.cancel=a.cancel.bind(Object(y.a)(a)),a.confirm=a.confirm.bind(Object(y.a)(a)),a.displayQueuePosition=e.displayQueuePosition,a}return Object(E.a)(n,[{key:"cancel",value:function(){this.props.isLastMessage&&(0,this.props.updateCancelQueueConfirm)(!1)}},{key:"confirm",value:function(){if(this.props.isLastMessage){var e=this.props,t=e.updateCancelQueueConfirm,n=e.cancelQueueLogic;t(!1),fs.resumeOrInit(),n()}}},{key:"render",value:function(){var e=this.props,t=e.t,n=e.isLastMessage;return m.a.createElement("div",{className:Ng.a.root},m.a.createElement("div",{className:Ng.a.title},t("cschat_message_cancel_queue_title",{position:this.displayQueuePosition})),m.a.createElement("div",{className:Ng.a.option},m.a.createElement("div",{className:"".concat(Ng.a.optionChoose," ").concat(n?"":Ng.a.disabledOptions),onClick:this.cancel},t("cschat_genera_no")),m.a.createElement("div",{className:"".concat(Ng.a.optionChoose," ").concat(n?"":Ng.a.disabledOptions),onClick:this.confirm},t("cschat_genera_yes"))))}}]),n}(m.a.PureComponent),Ug=Object(O.b)((function(e){return{displayQueuePosition:e.getIn(["message","displayQueuePosition"]),chatbotEnabled:e.getIn(["chatbot","enabled"])}}),(function(e){return{updateCancelQueueConfirm:function(t){e(r.updateCancelQueueConfirm(t))},cancelQueueLogic:function(){e(c.endConversation({noNeedUpdateStates:!0}))}}}))(Object(V.a)()(Pg)),Dg=n(113),Bg=n.n(Dg),Wg=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).gotoLeaveMessagePage=a.gotoLeaveMessagePage.bind(Object(y.a)(a)),a.tryAgain=a.tryAgain.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"tryAgain",value:function(){var e=this.props,t=e.errorType,n=e.pushEnquiryTypeMessage,a=e.connectCount,r=e.oldConnectCount,o=e.isLastMessage,i=e.platform,s=e.isLogined,c=e.transferChatStatus,u=e.initSession,l=e.updateTransferChatStatus,d=e.chatbotEnabled;if(!(a>r)&&o)if(s||Ue.includes(i))c!==fe.Chatting&&(t===fe.Error||Ue.includes(i)&&!s?(u(),l(fe.Transfering)):(d&&fs.pushEnquiryMessage(),n()));else if(Et("ImmediateChatAfterLogin",!0),i===Oe.ShopeeCn||i===Oe.ShopeeCnEdu)window.csChatLogin&&window.csChatLogin();else if(i===Oe.WeChat){var p=Xc();window.location.href=p}}},{key:"gotoLeaveMessagePage",value:function(){var e=this.props,t=e.connectCount,n=e.oldConnectCount,a=e.platform,r=e.isLastMessage;t>n||!r||Yc(a)}},{key:"render",value:function(){var e=this.props,t=e.t,n=e.errorType,a=e.connectCount,r=e.oldConnectCount,o=e.isLastMessage,i=e.platform,s=e.noValidAgentReason,c=e.showLeaveMessageBtn,u=void 0===c||c,l=n===fe.NoAgent?t(s||"cschat_message_queue_noagent"):n===fe.Error?t("cschat_message_queue_error_network"):t("cschat_message_queue_error_longtime"),d=a>r||!o;return m.a.createElement("div",{className:Bg.a.root},m.a.createElement("div",{className:"".concat(Bg.a.inner," ").concat(d?Bg.a.disabledInner:"")},m.a.createElement("div",{className:Bg.a.title},l),m.a.createElement("div",{className:"".concat(Bg.a.option," ").concat(d?Bg.a.disabledOption:""),onClick:this.tryAgain},t(ou(i)?"cschat_spx_try_again_later":"cschat_general_try_again")),u?m.a.createElement("div",{onClick:this.gotoLeaveMessagePage,className:"".concat(Bg.a.option," ").concat(d?Bg.a.disabledOption:"")},m.a.createElement("span",{className:Bg.a.icon}),t("cschat_leave_us_a_message")):null))}}]),n}(m.a.PureComponent),Hg=Object(O.b)((function(e){var t=e.getIn(["user","isLogined"]),n=e.getIn(["user","transferChatStatus"]),a=e.getIn(["conversation","connectCount"]),r=e.getIn(["chatbot","enabled"]);return{isLogined:t,transferChatStatus:n,connectCount:a,platform:e.getIn(["global","accessPlatform"]),chatbotEnabled:r,noValidAgentReason:e.getIn(["conversation","noValidAgentReason"]),showLeaveMessageBtn:e.getIn(["conversation","showLeaveMessageBtn"])}}),(function(e){return{initSession:function(){e(c.initChatSdk({}))},updateTransferChatStatus:function(t){e(r.updateTransferChatStatus(t))},removeMessageItem:function(t){e(i.removeMessageItem(t))},pushEnquiryTypeMessage:function(){e(i.pushEnquiryTypeMessage())}}}))(Object(V.a)()(Fd(Wg))),Fg=n(67),Gg=n.n(Fg);function Vg(){return(Vg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Qg(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var qg=m.a.createElement("path",{fill:"#FE4741",fillRule:"evenodd",d:"M8,0 C12.418278,0 16,3.581722 16,8 C16,12.418278 12.418278,16 8,16 C3.581722,16 0,12.418278 0,8 C0,3.581722 3.581722,0 8,0 Z M8.8,10.5 L7.3,10.5 L7.3,12 L8.8,12 L8.8,10.5 Z M8.8,4 L7.3,4 L7.3,9 L8.8,9 L8.8,4 Z"}),Kg=function(e){var t=e.svgRef,n=e.title,a=Qg(e,["svgRef","title"]);return m.a.createElement("svg",Vg({width:16,height:16,viewBox:"0 0 16 16",ref:t},a),n?m.a.createElement("title",null,n):null,qg)},zg=m.a.forwardRef((function(e,t){return m.a.createElement(Kg,Vg({svgRef:t},e))}));function Jg(){return(Jg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Yg(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Xg=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM10.9778 12L8 9.02222L5.02222 12L4 10.9778L6.97778 8L4 5.02222L5.02222 4L8 6.97778L10.9778 4L12 5.02222L9.02222 8L12 10.9778L10.9778 12Z",fill:"#EB2B25"}),Zg=function(e){var t=e.svgRef,n=e.title,a=Yg(e,["svgRef","title"]);return m.a.createElement("svg",Jg({width:16,height:16,viewBox:"0 0 16 16",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,Xg)},$g=m.a.forwardRef((function(e,t){return m.a.createElement(Zg,Jg({svgRef:t},e))})),eh=n(678),th=new(n.n(eh).a);th.locale.set(null==="cn"?void 0:"cn".toUpperCase());var nh=function(e){var t=function(t){Object(C.a)(a,t);var n=Object(S.a)(a);function a(e){var t;return Object(b.a)(this,a),(t=n.call(this,e)).debounceResend=void 0,t.debounceCancelUpload=void 0,t.state={timeId:null},t.renderStatus=t.renderStatus.bind(Object(y.a)(t)),t.handleResend=t.handleResend.bind(Object(y.a)(t)),t.handleCancelUpload=t.handleCancelUpload.bind(Object(y.a)(t)),t.debounceResend=T()(t.handleResend,500,{leading:!0,trailing:!1}),t.debounceCancelUpload=T()(t.handleCancelUpload,500,{leading:!0,trailing:!1}),t}return Object(E.a)(a,[{key:"handleResend",value:function(){var e=this.props.handleResend;e&&e()}},{key:"handleCancelUpload",value:function(){var e=this.props.handleCancelUpload;e&&e()}},{key:"renderStatus",value:function(){var e=this.props,t=e.status,n=e.cantShowLoading,a=e.t,r=e.isMobileStyle,o=t===ln.Fail,i=t===ln.Sending,s=t===ln.Uploading;return o?r?m.a.createElement("div",{className:Gg.a.status,onClick:this.debounceResend},m.a.createElement(zg,null)):m.a.createElement(Lp,{distanceAddonLeft:-4,title:a("cschat_general_resend")},m.a.createElement("div",{className:Gg.a.status,onClick:this.debounceResend},m.a.createElement(zg,null))):i&&!n?m.a.createElement("div",{className:Gg.a.status},m.a.createElement(kf,null)):s?r?m.a.createElement("div",{className:Gg.a.status,onClick:this.debounceCancelUpload},m.a.createElement($g,null)):m.a.createElement(Lp,{distanceAddonLeft:-4,title:a("cschat_cancel_upload")},m.a.createElement("div",{className:Gg.a.status,onClick:this.debounceCancelUpload},m.a.createElement($g,null))):null}},{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.measure,a=t.status,r=t.messageId,o=t.noHandleStatus,i=t.updateMessageStatus,s=t.platform;if(n&&n(),Zc(s)&&!o&&a===ln.Sending&&i){var c=setTimeout((function(){e.props.status===ln.Sending&&i(r,ln.Fail)}),2e3);this.setState({timeId:c})}}},{key:"componentWillUnmount",value:function(){this.state.timeId&&clearTimeout(this.state.timeId)}},{key:"componentDidUpdate",value:function(e){var t=this;["messageId","isLastMessage","messageLength"].some((function(n){return t.props[n]!==e[n]}))&&this.props.measure&&this.props.measure()}},{key:"render",value:function(){var t,n,a,r=this.props,o=r.style,i=void 0===o?{}:o,s=r.timestamp,c=r.sourceType,u=r.isLastMessage,l=r.messageType,d=r.status,p=r.showPullHistoryButton,f=r.isFirstMessage,g=r.marginTop,h=[ln.Fail,ln.Sending,ln.Uploading].includes(d),v=w()((t={},Object(x.a)(t,Gg.a.sender,[dn.Client].includes(c)),Object(x.a)(t,Gg.a.receiver,[dn.Agent,dn.Bot].includes(c)),t)),_=w()((n={},Object(x.a)(n,Gg.a.senderWrap,[dn.Client].includes(c)),Object(x.a)(n,Gg.a.receiverWrap,[dn.Agent,dn.Bot].includes(c)),n)),b=[H.System,H.Csat,H.Rating,H.NoMore].includes(l),E=Boolean(s)&&!(p&&f);return m.a.createElement("div",{style:i,className:w()(Gg.a.root,(a={},Object(x.a)(a,Gg.a.lastMessage,u),Object(x.a)(a,Gg.a.desktopWechat,Zo()),a))},E&&m.a.createElement("div",{className:Gg.a.time},function(e){var t=th.create(e),n=t.format("hh:mm");return"".concat(t.format("LHDS"),", ").concat(n)}(1e3*s)),m.a.createElement("div",{className:w()(v),style:{marginTop:E?12:g}},m.a.createElement("div",{className:w()(_,Object(x.a)({},Gg.a.center,b),Object(x.a)({},Gg.a.hasStatus,h))},this.renderStatus(),m.a.createElement(e,this.props))))}}]),a}(h.PureComponent);return Object(O.b)((function(e){return{supportUnloginChatWithAgent:e.getIn(["global","supportUnloginChatWithAgent"]),showPullHistoryButton:e.getIn(["chatbot","showPullHistoryButton"])}}))(Object(V.a)()(Fd(t)))};function ah(){return(ah=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function rh(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var oh=m.a.createElement("path",{fill:"#E0E0E0",d:"M30,18 C33.3137085,18 36,20.6862915 36,24 C36,27.3137085 33.3137085,30 30,30 C26.6862915,30 24,27.3137085 24,24 C24,20.6862915 26.6862915,18 30,18 Z M27.6818182,1.42108547e-14 C28.4098299,1.42108547e-14 29,0.62680135 29,1.4 L29,17.07089 C26.7710364,17.3897198 24.880815,18.7586033 23.846504,20.6603639 L11.2767149,10.7965395 L11.2767149,10.7965395 C10.7663501,10.4287931 10.0775548,10.5260164 9.67871408,11.0011237 L9.59785698,11.1086847 L2.15462166,23.0183674 C1.78047291,24.1844469 2.08533941,24.7674866 3.06922115,24.7674866 L6.65697945,24.7779252 C10.916038,24.8005421 16.3851379,24.8599116 23.064279,24.9560336 C23.2178638,26.0774213 23.6366594,27.1144007 24.255617,28.0013298 L1.31818182,28 C0.590170102,28 0,27.3731986 0,26.6 L0,1.4 C0,0.62680135 0.590170102,1.42108547e-14 1.31818182,1.42108547e-14 L27.6818182,1.42108547e-14 Z M30.6,25.875 L29.475,25.875 L29.475,27 L30.6,27 L30.6,25.875 Z M30.6,21 L29.475,21 L29.475,24.75 L30.6,24.75 L30.6,21 Z M20.8963991,5 C19.4360308,5 18.2521684,6.20411207 18.2521684,7.68945958 C18.2521684,9.17480709 19.4360308,10.3789192 20.8963991,10.3789192 C22.3567675,10.3789192 23.5406299,9.17480709 23.5406299,7.68945958 C23.5406299,6.20411207 22.3567675,5 20.8963991,5 Z"}),ih=function(e){var t=e.svgRef,n=e.title,a=rh(e,["svgRef","title"]);return m.a.createElement("svg",ah({width:36,height:30,viewBox:"0 0 36 30",ref:t},a),n?m.a.createElement("title",null,n):null,oh)},sh=m.a.forwardRef((function(e,t){return m.a.createElement(ih,ah({svgRef:t},e))})),ch=n(679),uh=n.n(ch),lh=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){return m.a.createElement("div",{className:uh.a.root},m.a.createElement(sh,null))}}]),n}(h.Component),dh=n(242),ph=n.n(dh),fh=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).debounceSendMessage=void 0,a.sendMessage=a.sendMessage.bind(Object(y.a)(a)),a.debounceSendMessage=T()(a.sendMessage,1e3,{leading:!0,trailing:!1}),a}return Object(E.a)(n,[{key:"sendMessage",value:function(e){var t=this.props.sendMessage;t&&t(e)}},{key:"render",value:function(){var e=this,t=this.props.content;return(t=t.toJS())&&t.title&&Array.isArray(t.options)?m.a.createElement("div",{className:ph.a.root},m.a.createElement("div",{className:ph.a.title},t.title),t.options.map((function(t,n){return m.a.createElement("div",{key:n,className:ph.a.option},m.a.createElement("div",{onClick:function(){e.debounceSendMessage(t.text)},className:ph.a.text},t.text))}))):null}}]),n}(m.a.Component),gh=n(299),hh=n.n(gh),mh=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).handleGoInquiry=a.handleGoInquiry.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"handleGoInquiry",value:function(){var e=this.props.platform;Yc(e)}},{key:"render",value:function(){var e=this.props.t;return m.a.createElement("div",{className:hh.a.root},m.a.createElement("div",{className:"".concat(hh.a.inner)},m.a.createElement("div",{className:hh.a.title},e("cschat_server_error"))))}}]),n}(m.a.PureComponent),vh=Fd(Object(V.a)()(mh)),_h=n(300),bh=n.n(_h),Eh=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).handleGoInquiry=a.handleGoInquiry.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"handleGoInquiry",value:function(){var e=this.props.platform;Yc(e)}},{key:"render",value:function(){var e=this.props,t=e.t,n=e.content,a=null===n||void 0===n?void 0:n.get("text"),r=null===n||void 0===n?void 0:n.get("showWebButton");return m.a.createElement("div",{className:bh.a.root},m.a.createElement("div",{className:bh.a.title},m.a.createElement(ff,{status:ln.Success,text:a,sourceType:dn.Bot})),r&&m.a.createElement("div",{className:bh.a.option,onClick:this.handleGoInquiry},t("cschat_leave_us_a_message")))}}]),n}(h.PureComponent),yh=Fd(Object(V.a)()(Eh)),Ch=n(405),Sh=n.n(Ch);function Oh(){return(Oh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ah(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Th,Ih,wh,Lh=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.837422 8.42364C0.64217 8.22838 0.64217 7.91182 0.837423 7.71656C1.03269 7.5213 1.34928 7.52131 1.54453 7.7166L6.00189 12.1748L6.00269 0.61808C6.00271 0.341951 6.22657 0.118116 6.50269 0.118116C6.77885 0.118116 7.00271 0.341995 7.00269 0.618152L7.00189 12.1748L11.4609 7.71649C11.6562 7.52126 11.9728 7.52128 12.168 7.71653C12.3633 7.9118 12.3633 8.22839 12.168 8.42365L6.85628 13.7354C6.68272 13.909 6.41329 13.9282 6.21842 13.7932L6.14918 13.7354L0.837422 8.42364Z",fill:"#BBBBBB"}),kh=function(e){var t=e.svgRef,n=e.title,a=Ah(e,["svgRef","title"]);return m.a.createElement("svg",Oh({width:13,height:14,viewBox:"0 0 13 14",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,Lh)},Mh=m.a.forwardRef((function(e,t){return m.a.createElement(kh,Oh({svgRef:t},e))})),jh=Object(V.a)()((function(e){var t=e.t,n=Gi();return Pi({operation:"impression",targetType:"scroll_down_to_view_history",data:Object(d.a)({},n)}),m.a.createElement("div",{className:Sh.a.root},m.a.createElement(Mh,{className:Sh.a.icon}),t("cschat_message_scroll_tip"))}));!function(e){e.Username="user_name",e.Phone="phone",e.Email="email"}(Th||(Th={})),function(e){e[e.Gudangku=102]="Gudangku"}(Ih||(Ih={})),function(e){e[e.FrequentRequest=429]="FrequentRequest"}(wh||(wh={}));var xh=n(94),Rh=n.n(xh),Nh=Object(O.b)((function(e){return{messageList:e.getIn(["message","messageList"]),accessPlatform:e.getIn(["global","accessPlatform"])}}),(function(e){return{initSession:function(){e(c.initSession({needCheckConflict:!0,isForceOnline:!0}))},updateAccessToken:function(t){e(u.updateAccessToken(t))},setTokenIsInvalid:function(t){e(c.setTokenIsInvalid(t))},updateTransferChatStatus:function(t){e(r.updateTransferChatStatus(t))},updateCurrentEnquiryMessageId:function(t){e(i.updateCurrentEnquiryMessageId(t))},pushSystemMessage:function(t){e(i.pushSystemMessage(t))},removeMessageItem:function(t){e(i.removeMessageItem(t))},updateIsSubmitRegisterWebform:function(t){e(u.updateIsSubmitRegisterWebform(t))},updateToast:function(t){e(u.updateToast({msg:t}))}}}))(Object(V.a)()((function(e){var t=e.t,n=e.initSession,a=e.updateAccessToken,r=e.pushSystemMessage,o=e.setTokenIsInvalid,i=e.updateIsSubmitRegisterWebform,s=e.updateTransferChatStatus,c=e.updateCurrentEnquiryMessageId,u=e.messageList,p=e.removeMessageItem,v=e.accessPlatform,_=e.updateToast,b=Object(h.useState)(!1),E=Object(l.a)(b,2),y=E[0],C=E[1],S=Object(h.useState)(!1),O=Object(l.a)(S,2),A=O[0],T=O[1],I=Object(h.useState)(""),w=Object(l.a)(I,2),L=w[0],k=w[1],M=Object(h.useState)(""),j=Object(l.a)(M,2),x=j[0],R=j[1],N=Object(h.useState)(""),P=Object(l.a)(N,2),U=P[0],D=P[1],B=Object(h.useRef)(null),W=function(e){return e.length?/[\*&\u2026^\uff01:\uff1a@#\xa5\$%\(\)\~\+\-\=\uffe5!\/\[\]\u3010\u3011]+/i.test(e)?t(be.InputValidName):"":t(be.WebformRequired)},F=Object(h.useCallback)((function(){var e,t,n=(null===(e=B.current)||void 0===e?void 0:e.querySelectorAll("input"))||[];L&&k(W(null===(t=n[0])||void 0===t?void 0:t.value))}),[L]),G=function(e){if(!e.length)return t(be.WebformRequired);var n;switch(v){case Oe.Gudangku:n="cn"===Ve.ID?/^(\+?0*62)?(\d+| )$/i:/^(\+?0*84)?(\d+| )$/i}return n.test(e)?"":t(be.InputValidPhone)},V=Object(h.useCallback)((function(){var e,t,n=(null===(e=B.current)||void 0===e?void 0:e.querySelectorAll("input"))||[];x&&R(G(null===(t=n[1])||void 0===t?void 0:t.value))}),[x]),Q=function(e){return e.length?/^[a-z0-9_\-\.]+@[a-z0-9_-]+(\.[a-z0-9_-]+)+$/i.test(e)?"":t(be.InputValidEmail):""},q=Object(h.useCallback)((function(){var e,t,n=(null===(e=B.current)||void 0===e?void 0:e.querySelectorAll("input"))||[];U&&D(Q(null===(t=n[2])||void 0===t?void 0:t.value))}),[U]),K=function(){var e=Object(g.a)(f.a.mark((function e(){var l,g,h,m,v,b,E,S,O,I,w,L,M,j,x,N,P;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!A&&!y){e.next=2;break}return e.abrupt("return");case 2:if(v=(null===(l=B.current)||void 0===l?void 0:l.querySelectorAll("input"))||[],b={user_name:null===(g=v[0])||void 0===g?void 0:g.value.trim(),phone:null===(h=v[1])||void 0===h?void 0:h.value.trim(),email:null===(m=v[2])||void 0===m?void 0:m.value.trim()},E="phone=".concat(b.phone,";user_name=").concat(b.user_name),S=W(b.user_name),O=G(b.phone),I=Q(b.email),k(S),R(O),D(I),!(S||O||I)){e.next=13;break}return e.abrupt("return");case 13:return e.prev=13,C(!0),w=(new Date).getTime(),e.next=18,mu(Object(d.a)({account_type:Ih.Gudangku,timestamp:w,sign:Bn.a.HmacSHA256(E,"".concat(w)).toString(),max_ttl:3600},b));case 18:L=e.sent,M=L.code,j=L.data,0===M?(x=(j||{}).access_token,N=We.UnloginChatAccessToken,P=(null===u||void 0===u?void 0:u.find((function(e){return e.get("type")===H.RegisterWebform}))).get("id"),o(!1),Et(N,x),a(x),T(!0),n({isClickRegisterWebform:!0}),r(t(be.ThanksForFillingWebform)),s(fe.Transfering),c("#"),i(!0),p(P)):M===wh.FrequentRequest?(_(t(be.UnloginTokenFrequentRequest)),o(!0)):o(!0),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),o(!0);case 26:return e.prev=26,C(!1),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[13,23,26,29]])})));return function(){return e.apply(this,arguments)}}(),z=A||y;return m.a.createElement("div",{className:Rh.a.content},m.a.createElement("h3",{className:Rh.a.title},t(be.ContactDetail)),m.a.createElement("form",{name:"registerWebform",ref:B,target:"rfFrame"},m.a.createElement("div",{className:Rh.a.form_row},m.a.createElement("label",{className:Rh.a.required},t(be.Name)),m.a.createElement("input",{placeholder:t(be.Name),name:Th.Username,disabled:z,onChange:F,autoComplete:"off",maxLength:80}),m.a.createElement("div",{className:Rh.a.error_msg},L)),m.a.createElement("div",{className:Rh.a.form_row},m.a.createElement("label",{className:Rh.a.required},t(be.PhoneNumber)),m.a.createElement("input",{placeholder:t(be.PhoneNumber),disabled:z,name:Th.Phone,onChange:V,autoComplete:"off",maxLength:20}),m.a.createElement("div",{className:Rh.a.error_msg},x)),m.a.createElement("div",{className:Rh.a.form_row},m.a.createElement("label",null,t(be.EmailAddress)),m.a.createElement("input",{placeholder:t(be.EmailAddress),disabled:z,name:Th.Email,onChange:q,autoComplete:"off",maxLength:256}),m.a.createElement("div",{className:Rh.a.error_msg},U))),m.a.createElement("iframe",{id:"rfFrame",name:"rfFrame",src:"about:blank",style:{display:"none"}}),m.a.createElement("button",{className:Rh.a.btn_start_chat,disabled:z,onClick:K},t(be.StartChat)))}))),Ph=n(243),Uh=n.n(Ph),Dh=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){return m.a.createElement("div",{className:Uh.a.noMore},m.a.createElement("div",{className:Uh.a.line}),m.a.createElement("div",{className:Uh.a.text},"No more chat history. Only keep 2 weeks"),m.a.createElement("div",{className:Uh.a.line}))}}]),n}(h.Component),Bh=n(406),Wh=n.n(Bh),Hh=(n(1342),n(407)),Fh=n.n(Hh),Gh=n(45),Vh=n.n(Gh);n(1343);function Qh(e){var t=[se.Unliked,se.Neutral,se.Positive],n={};return t.forEach((function(t){n["Shopee_ID_".concat(t,"_CSAT__c")]=t===e})),n}var qh=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;Object(b.a)(this,n),(a=t.call(this,e)).RateOptions=void 0;a.props.platform;return a.handleChange=a.handleChange.bind(Object(y.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(y.a)(a)),a.RateOptions=[],a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this,n=this.props.scrollToBottom;["rateType"].some((function(n){return t.props[n]!==e[n]}))&&this.props.measure&&(this.props.measure(),n&&n())}},{key:"componentDidMount",value:function(){var e=Gi();Pi({targetType:"csat",operation:"impression",data:Object(d.a)({},e)})}},{key:"handleRate",value:function(e){var t=this.props,n=t.setRateCheckOptions,a=t.messageId,r=t.feedbackOptions;n(a,"rateType",e);var o=e===se.Positive?"good":e===se.Neutral?"average":"bad",i=Gi();Pi({targetType:"csat_rate",operation:"click",data:Object(d.a)({rating:o},i)}),this.RateOptions=(null===r||void 0===r?void 0:r[e])||[]}},{key:"renderRateCard",value:function(){var e=this,t=this.props,n=t.rateType,a=t.t,r=n===se.Unliked,o=n===se.Neutral,i=n===se.Positive;return m.a.createElement("div",{className:Vh.a.ratingsWrap},m.a.createElement("div",{className:w()(Vh.a.ratingItem,Object(x.a)({},Vh.a.ratingItemActive,r)),onClick:function(){return e.handleRate(se.Unliked)}},m.a.createElement("img",{className:Vh.a.rateImg,src:_f.a,alt:""}),m.a.createElement("span",{className:Vh.a.rateText},a("cschat_rate_bad"))),m.a.createElement("div",{className:w()(Vh.a.ratingItem,Vh.a.ratingItemMid,Object(x.a)({},Vh.a.ratingItemActive,o)),onClick:function(){return e.handleRate(se.Neutral)}},m.a.createElement("img",{className:Vh.a.rateImg,src:Ef.a,alt:""}),m.a.createElement("span",{className:Vh.a.rateText},a("cschat_rate_average"))),m.a.createElement("div",{className:w()(Vh.a.ratingItem,Object(x.a)({},Vh.a.ratingItemActive,i)),onClick:function(){return e.handleRate(se.Positive)}},m.a.createElement("img",{className:Vh.a.rateImg,src:Cf.a,alt:""}),m.a.createElement("span",{className:Vh.a.rateText},a("cschat_rate_good"))))}},{key:"handleChange",value:function(e){var t=this.props;(0,t.setRateCheckOptions)(t.messageId,"checkOptions",e)}},{key:"handleSubmit",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o,i,s,u,l,p,g,h,m,v;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,a=n.checkOptions,r=n.rateType,o=n.isLoading,i=n.messageId,s=n.setRateCheckOptions,u=n.pushRatingMessage,l=n.shopeeChatKey,!o){e.next=3;break}return e.abrupt("return");case 3:return t=t||r,p=this.RateOptions.filter((function(e){return a.includes(e.value)})).map((function(e){return e.text})).join(";"),g=Object(d.a)({Shopee_ID_Community_Language__c:"EN_US",Shopee_Chat_Key__c:l,Shopee_ID_Chat_Id__c:l,Shopee_ID_Chat_Feedbacks__c:p,Shopee_ID_Source_Type__c:"Web Browser",Shopee_ID_Chat_Feedbacks_V2__c:null===a||void 0===a?void 0:a.map((function(e){return Number(e)}))},Qh(t)),s(i,"isLoading",!0),h=null,e.prev=8,e.next=11,f={csat_object:JSON.stringify(g)},hu().post("/v1/send_rating",f);case 11:h=e.sent,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),console.log(e.t0);case 17:m=t===se.Positive?"good":t===se.Neutral?"average":"bad",v=Gi(),Pi({targetType:"csat_feedback_submit",operation:"click",data:Object(d.a)(Object(d.a)({rating:m},v),{},{feedback_option:a})}),s(i,"isLoading",!1),h&&!h.error&&(u(i,t),c.emitRating(i,t));case 22:case"end":return e.stop()}var f}),e,this,[[8,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"renderRateForm",value:function(){var e=this,t=this.props,n=t.checkOptions,a=t.isLoading,r=t.t,o=t.rateType,i=this.RateOptions||[],s=o===se.Neutral?"average":"bad",c=Gi();return Pi({targetType:"csat_feedback",operation:"impression",data:Object(d.a)({rating:s},c)}),m.a.createElement("div",{className:w()(Vh.a.ratingsForm,"cschat-ratings-form")},o!==se.Positive?m.a.createElement(Fh.a.Group,{layout:"vertical",onChange:this.handleChange,value:n,className:Vh.a.checkOptionsWrapper},i.map((function(e){return m.a.createElement(Fh.a,{key:e.text,value:e.value},e.text)}))):null,m.a.createElement("div",{className:Vh.a.submitBtnWrapper},m.a.createElement(j.a,{disabled:!n.length&&o!==se.Positive||a,onClick:function(){return e.handleSubmit()},className:Vh.a.submitBtn,type:"primary",size:"small"},m.a.createElement("div",{className:Vh.a.buttonText},r("cschat_general_submit")),a&&m.a.createElement("div",{className:Vh.a.buttonLoading}))))}},{key:"render",value:function(){var e=this.props,t=e.rateType,n=e.feedbackOptions,a=e.isLoading,r=e.platform,o=e.t,i=o("cschat_rate_our_service"),s=ou(r)?o("cschat_spx_rate_our_service_subtitle"):o("cschat_rate_our_service_subtitle");return t&&(this.RateOptions=n[t]||[]),m.a.createElement("div",{className:w()(Vh.a.root,Object(x.a)({},Vh.a.inLoading,a))},m.a.createElement("div",{className:Vh.a.titleWrap},m.a.createElement("div",{className:Vh.a.title},i),m.a.createElement("div",{className:Vh.a.subTitle},s)),this.renderRateCard(),t?this.renderRateForm():null)}}]),n}(h.PureComponent),Kh=Object(O.b)((function(e,t){var n=e.getIn(["message","messageList"]).find((function(e){return e.get("id")===t.messageId})),a=e.getIn(["global","feedbackOptions"]);if(!n)return{};var r=n.getIn(["content","rateType"]),o=n.getIn(["content","checkOptions"]),i=n.getIn(["content","isLoading"]);return{rateType:r,checkOptions:o.toJS?o.toJS():[],isLoading:i,feedbackOptions:a}}),(function(e){return{setRateCheckOptions:function(t,n,a){e(i.setRateMessageContent(t,n,a))},pushRatingMessage:function(t,n){e(i.pushRatingMessage(t,n))}}}))(Object(V.a)()(Fd(qh))),zh=n(166),Jh=n.n(zh);function Yh(){return(Yh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Xh(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Zh=m.a.createElement("rect",{width:16,height:16,fill:"white"}),$h=m.a.createElement("mask",{id:"mask0","mask-type":"alpha",maskUnits:"userSpaceOnUse",x:0,y:0,width:16,height:16},m.a.createElement("rect",{width:16,height:16,fill:"white"})),em=m.a.createElement("g",{mask:"url(#mask0)"},m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.60715 7.18934L4.12356 3.21967C3.86653 2.92678 3.4498 2.92678 3.19277 3.21967C2.93574 3.51256 2.93574 3.98744 3.19277 4.28033L7.14176 8.78033C7.39878 9.07322 7.81551 9.07322 8.07254 8.78033L12.0215 4.28033C12.2786 3.98744 12.2786 3.51256 12.0215 3.21967C11.7645 2.92678 11.3478 2.92678 11.0907 3.21967L7.60715 7.18934Z"}),m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.60715 11.1893L4.12356 7.21967C3.86653 6.92678 3.4498 6.92678 3.19277 7.21967C2.93574 7.51256 2.93574 7.98744 3.19277 8.28033L7.14176 12.7803C7.39878 13.0732 7.81551 13.0732 8.07254 12.7803L12.0215 8.28033C12.2786 7.98744 12.2786 7.51256 12.0215 7.21967C11.7645 6.92678 11.3478 6.92678 11.0907 7.21967L7.60715 11.1893Z"})),tm=function(e){var t=e.svgRef,n=e.title,a=Xh(e,["svgRef","title"]);return m.a.createElement("svg",Yh({width:16,height:16,viewBox:"0 0 16 16",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,Zh,$h,em)},nm=m.a.forwardRef((function(e,t){return m.a.createElement(tm,Yh({svgRef:t},e))})),am=!1,rm=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).handleClickScrollToBottom=a.handleClickScrollToBottom.bind(Object(y.a)(a)),a.onTouchEnd=a.onTouchEnd.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.showScrollToBottom,n=e.unreadMessagesCount;if(t&&!am){var a=Gi();Pi({targetType:n?"new_message_pop_up":"scroll_to_down",operation:"impression",data:Object(d.a)({},a)})}}},{key:"handleClickScrollToBottom",value:function(){var e=this.props,t=e.unreadMessagesCount;(0,e.handleScrollToBottom)(),am=!0;var n=Gi();Pi({targetType:t?"new_message_pop_up":"scroll_to_down",operation:"click",data:Object(d.a)({},n)}),setTimeout((function(){am=!1}),300)}},{key:"onTouchEnd",value:function(e){e.preventDefault(),e.nativeEvent.preventDefault()}},{key:"render",value:function(){var e=this.props,t=e.t,n=e.showScrollToBottom,a=e.unreadMessagesCount,r=a>1?t("cschat_multi_new_messages",{count:a}):t("cschat_one_new_message"),o=Re?{onTouchStart:this.handleClickScrollToBottom,onTouchEnd:this.onTouchEnd}:{onClick:this.handleClickScrollToBottom};return m.a.createElement(m.a.Fragment,null,n&&m.a.createElement("div",Object.assign({},o,{className:w()(Jh.a.root,a?Jh.a.unread:Jh.a.noUnread)}),m.a.createElement("div",{className:w()(Jh.a.icon,Object(x.a)({},Jh.a.unread,!!a))},m.a.createElement(nm,null)),!!a&&m.a.createElement("div",{className:Jh.a.text},r)))}}]),n}(h.PureComponent),om=Object(V.a)()(rm),im=n(408),sm=n.n(im),cm=n(167),um=n.n(cm),lm=n(140),dm=n.n(lm);function pm(){return(pm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function fm(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var gm=m.a.createElement("path",{d:"M37 73.5C57.1584 73.5 73.5 57.1584 73.5 37C73.5 16.8416 57.1584 0.5 37 0.5C16.8416 0.5 0.5 16.8416 0.5 37C0.5 57.1584 16.8416 73.5 37 73.5Z",fill:"black",fillOpacity:.54,stroke:"white"}),hm=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M28 22.798C28 21.19 29.8014 20.2394 31.1288 21.147L51.9004 35.3489C53.062 36.1431 53.062 37.8567 51.9004 38.6509L31.1288 52.8529C29.8014 53.7605 28 52.8099 28 51.2019V22.798Z",fill:"white"}),mm=function(e){var t=e.svgRef,n=e.title,a=fm(e,["svgRef","title"]);return m.a.createElement("svg",pm({width:74,height:74,viewBox:"0 0 74 74",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,gm,hm)},vm=m.a.forwardRef((function(e,t){return m.a.createElement(mm,pm({svgRef:t},e))}));function _m(){return(_m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function bm(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Em=m.a.createElement("path",{d:"M37 73.5C57.1584 73.5 73.5 57.1584 73.5 37C73.5 16.8416 57.1584 0.5 37 0.5C16.8416 0.5 0.5 16.8416 0.5 37C0.5 57.1584 16.8416 73.5 37 73.5Z",fill:"black",fillOpacity:.54,stroke:"white"}),ym=m.a.createElement("g",{filter:"url(#filter0_d)"},m.a.createElement("rect",{x:25,y:23,width:8,height:28,rx:2,fill:"white"})),Cm=m.a.createElement("g",{filter:"url(#filter1_d)"},m.a.createElement("rect",{x:40.9999,y:23,width:8,height:28,rx:2,fill:"white"})),Sm=m.a.createElement("defs",null,m.a.createElement("filter",{id:"filter0_d",x:18,y:16,width:22,height:42,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},m.a.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),m.a.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),m.a.createElement("feOffset",null),m.a.createElement("feGaussianBlur",{stdDeviation:3.5}),m.a.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),m.a.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow"}),m.a.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"})),m.a.createElement("filter",{id:"filter1_d",x:33.9999,y:16,width:22,height:42,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},m.a.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),m.a.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),m.a.createElement("feOffset",null),m.a.createElement("feGaussianBlur",{stdDeviation:3.5}),m.a.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),m.a.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow"}),m.a.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"}))),Om=function(e){var t=e.svgRef,n=e.title,a=bm(e,["svgRef","title"]);return m.a.createElement("svg",_m({width:74,height:74,viewBox:"0 0 74 74",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,Em,ym,Cm,Sm)},Am=m.a.forwardRef((function(e,t){return m.a.createElement(Om,_m({svgRef:t},e))})),Tm=function(e){var t=e.status,n=void 0===t?"loading":t,a=e.percent,r=void 0===a?0:a,o=e.style;return m.a.createElement("div",{className:w()(dm.a.controller),style:o},m.a.createElement("div",{className:w()(dm.a.wrapper,Object(x.a)({},dm.a.loadingWrapper,"loading"===n)),style:"loading"===n?{"--percent":r}:{}},"loading"===n?m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:dm.a.left}),m.a.createElement("div",{className:dm.a.right})):"pause"===n?m.a.createElement(vm,{className:dm.a.controlIcon}):m.a.createElement(Am,{className:dm.a.controlIcon})))},Im=Fd((function(e){var t=e.isSender,n=e.videoInfo,a=e.onPlayVideo,r=e.messageId,o=e.status,i=e.platform,s=e.measure,c=e.updateToast,u=e.isMobileStyle,p=Object(rp.a)().t,f=o===ln.Uploading,g=o===ln.Sending,v=o===ln.Success,_=o===ln.Fail,b=n.video_url,E=n.thumbnail_url,y=n.width,C=n.height,S=n.percent,O=void 0===S?0:S,A=n.duration,T=n.error,I=E||sm.a,L=Object(h.useState)(I),k=Object(l.a)(L,2),M=k[0],j=k[1],R=Object(h.useRef)(null),N=Object(h.useRef)(!1);Object(h.useEffect)((function(){v&&E&&N.current&&j(E),N.current||(N.current=!0)}),[v]),Object(h.useEffect)((function(){try{Pi({accessPlatform:i,operation:"impression",targetType:"video_play_thumbnail",data:P})}catch(e){}}),[]);var P={message_id:v?r:"0",video_original_duration:Math.ceil(A)};Object(h.useEffect)((function(){try{if(_&&T){var e=Gi();P.failure_reason=(null===T||void 0===T?void 0:T.code)||0,(null===T||void 0===T?void 0:T.errorCode)&&(e.be_error_code=T.errorCode),Pi({accessPlatform:i,operation:"impression",targetType:"resend_video",data:Object(d.a)({trackerData:P},e)})}}catch(t){}}),[_]);var U=Fn(y,C),D="".concat(um.a.root," ").concat(t?um.a.send:um.a.receive),B=function(){var e;j(sm.a),e=M,Jt({type:Gt.Count,value:{label:"cs_video_cover_load_error"}}),ri("error","cs_video_cover_load_error",{url:e})};return m.a.createElement("div",{className:D,onClick:function(){if(Pi({targetType:"video_play_thumbnail",operation:"click",data:P}),f)c({msg:p("cschat_video_sending")});else{var e,t;if(b)return null===(e=R.current)||void 0===e||e.addEventListener("error",(function(e){Qn(b)})),Pi({targetType:"video_play_thumbnail",operation:"impression",data:P}),i===Oe.WeChat?Me?void(null===(t=R.current)||void 0===t||t.play()):je?void a(r):void window.open(b):void a(r);_&&c({msg:p("cschat_video_send_failed")})}}},m.a.createElement("video",{preload:"auto",width:"0",height:"0",style:{visibility:"hidden"},ref:R,"x5-video-player-type":"h5"},m.a.createElement("source",{src:b}),"Sorry, your browser doesn't support HTML5 videos."),m.a.createElement("img",{src:M,style:U,onError:function(){B()},alt:"",onLoad:s}),m.a.createElement("div",{className:um.a.controller},m.a.createElement(Tm,{style:function(){var e=0,t=0;return Zo()?(e=60,t=60):u?(t=45,e=45):(e=30,t=30),{width:"".concat(e,"px"),height:"".concat(t,"px")}}(),percent:O,status:b||v||!g&&!f?"pause":O<100?"loading":"pause"})),A>0&&m.a.createElement("div",{className:w()(um.a.duration,Object(x.a)({},um.a.desktopWechatDuration,Zo()))},Hn(A)))})),wm=n(83),Lm=n.n(wm),km=Fd((function(e){var t=Object(rp.a)().t;return m.a.createElement("div",{className:Lm.a.orderMessage,onClick:function(){e.order_id&&e.checkout_id&&uu(e.platform,e.order_id,e.checkout_id,e.order_list_type,e.uri_key)}},m.a.createElement("img",{src:e.image&&Object(so.cdnFile)(e.image),alt:"",className:Lm.a.orderPicture}),m.a.createElement("div",{className:Lm.a.orderInfos},m.a.createElement("div",{className:Lm.a.orderTitle},e.order_name),m.a.createElement("div",{className:Lm.a.specification},m.a.createElement("div",{className:Lm.a.content},e.specification),m.a.createElement("div",{className:Lm.a.amount},"X",e.amount)),m.a.createElement("div",{className:Lm.a.priceInfo},m.a.createElement("div",{className:Lm.a.count},e.item_count,e.item_count&&e.item_count>1?t("cschat_order_items"):t("cschat_order_item")),m.a.createElement("div",{className:Lm.a.price},cu(e.price))),m.a.createElement("div",{className:Lm.a.statusInfo},m.a.createElement("span",{className:Lm.a.status},e.status))))})),Mm=new Map,jm=function(e){return fs.render(e.message)||null},xm=Object(O.b)((function(e){return{messageList:e.getIn(["message","messageList"]),shouldShowWindow:e.getIn(["global","shouldShowWindow"])}}))((function(e){var t,n,a=e.id,r=e.message,o=e.scrollToBottom,i=e.isLastMessage,s=e.measure,c=e.shouldShowWindow,u=Object(h.useRef)(null),d=Mm.get(a);Object(h.useEffect)((function(){var e;c&&s();var t=function(){c&&(s(),Mm.set(a,u.current.getBoundingClientRect().height)),i&&(null===o||void 0===o||o())},n=null===(e=u.current)||void 0===e?void 0:e.querySelectorAll("img");return null===n||void 0===n||n.forEach((function(e){e.src.startsWith("http")&&e.addEventListener("load",t)})),function(){null===n||void 0===n||n.forEach((function(e){e.src.startsWith("http")&&e.removeEventListener("load",t)}))}}),[]),Object(h.useEffect)((function(){var e,t=function(){setTimeout((function(){s()}),0)};return null===(e=u.current)||void 0===e||e.addEventListener("click",t),function(){var e;return null===(e=u.current)||void 0===e?void 0:e.removeEventListener("click",t)}}),[]);var p=Object(h.useState)(fs.render(r)),f=Object(l.a)(p,2),g=f[0],v=f[1];Object(h.useEffect)((function(){v(fs.render(r))}),[r.hashKey]);var _=null===(t=u.current)||void 0===t||null===(n=t.getBoundingClientRect())||void 0===n?void 0:n.height;return Object(h.useEffect)((function(){s()}),[_]),m.a.createElement("div",{ref:u,style:{height:d}},g)})),Rm=n(680),Nm=n.n(Rm);var Pm=nh(Object(O.b)((function(e){return{show:e.getIn(["chatbot","showPullHistoryButton"]),isLogined:e.getIn(["user","isLogined"])}}),(function(e){return{getPaginationHistoryMessage:function(){e(i.getPaginationHistoryMessage())}}}))(Object(V.a)()((function(e){var t=e.show,n=e.isLogined,a=e.getPaginationHistoryMessage;return t&&n?m.a.createElement("div",{className:Nm.a.root},m.a.createElement("span",{onClick:function(){return a()}},gs("click_to_view_history"))):null})))),Um=function(e){var t=Object(h.useState)(e.timestamp),n=Object(l.a)(t,2),a=n[0],r=n[1];return Object(h.useEffect)((function(){a&&r(a)}),[a]),m.a.createElement(Pm,Object.assign({},e,{timestamp:a}))},Dm=n(126),Bm=n.n(Dm);var Wm,Hm,Fm,Gm,Vm,Qm=Fd((function(e){var t=e.liveAgentAvatar;return m.a.createElement("div",{className:Bm.a.avatar},function(){var e=String(yt("chat_region")).toLowerCase(),a="avatar_".concat(e,"_l"),r=n(576)("./".concat(a,".png"));return m.a.createElement("img",{className:Bm.a.avatarImage,src:t||r,alt:""})}())})),qm=Object(V.a)()(Fd((function(e){var t=e.content,n=e.t;return m.a.createElement("div",{className:Bm.a.root},m.a.createElement("div",{className:Bm.a.placeholder}),m.a.createElement("div",{className:Bm.a.card},m.a.createElement("div",{className:Bm.a.avatarWrapper},m.a.createElement(Qm,null)),m.a.createElement("div",{className:Bm.a.name},t.get("name")),m.a.createElement("div",{className:Bm.a.agent},n("live_chat_agent"))))}))),Km=nh(lh),zm=nh(xf),Jm=nh(ff),Ym=nh(mf),Xm=nh(jh),Zm=nh(ug),$m=nh(gg),ev=nh(If),tv=nh(_g),nv=nh(Cg),av=nh(Tg),rv=nh(xg),ov=nh(Hg),iv=nh(Ug),sv=nh(Kh),cv=nh(fh),uv=nh(Dh),lv=nh(Im),dv=nh(vh),pv=nh(yh),fv=nh(km),gv=nh(Nh),hv=nh(qm),mv=nh(xm);!function(e){e[e.No=0]="No",e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Left=3]="Left",e[e.Right=4]="Right"}(Vm||(Vm={}));var vv=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).cache=void 0,a.listRef=void 0,a.scrollTop=void 0,a.debounceFetchPrevMessage=void 0,a.debounceHandleScroll=void 0,a.startIndex=void 0,a.stopIndex=void 0,a.timeId=null,a.debounceGetHistoryMessages=void 0,a.containerHeight=void 0,a.containerWidth=void 0,a.scrollToTarget=void 0,a.bufferScrollTop=void 0,a.firstFetch=void 0,a.deleteMessageFlag=void 0,a.removeStartIndex=void 0,a.lastScrollHeight=void 0,a.renderRow=a.renderRow.bind(Object(y.a)(a)),a.cache=new tf.b({fixedWidth:!0}),a.scrollTop=0,a.listRef=Object(h.createRef)(),a.startIndex=0,a.stopIndex=0,a.containerHeight=0,a.containerWidth=0,a.scrollToTarget=0,a.bufferScrollTop=0,a.firstFetch=!1,a.deleteMessageFlag=!1,a.removeStartIndex=0,a.renderMessage=a.renderMessage.bind(Object(y.a)(a)),a.scrollToBottom=a.scrollToBottom.bind(Object(y.a)(a)),a.handleScroll=a.handleScroll.bind(Object(y.a)(a)),a.debounceHandleScroll=T()(a.handleScroll,200,{trailing:!0,maxWait:200}),a.fetchPrevMessage=a.fetchPrevMessage.bind(Object(y.a)(a)),a.debounceFetchPrevMessage=T()(a.fetchPrevMessage,200,{trailing:!0,maxWait:200}),a.renderAutoSizerList=a.renderAutoSizerList.bind(Object(y.a)(a)),a.getHistoryMessages=a.getHistoryMessages.bind(Object(y.a)(a)),a.debounceGetHistoryMessages=T()(a.getHistoryMessages,200,{trailing:!0,maxWait:200}),a.handleWheel=a.handleWheel.bind(Object(y.a)(a)),a.handleContainerSizeChange=a.handleContainerSizeChange.bind(Object(y.a)(a)),a.handlePrependMessage=a.handlePrependMessage.bind(Object(y.a)(a)),a.handleAppendMessage=a.handleAppendMessage.bind(Object(y.a)(a)),a.touchStart=a.touchStart.bind(Object(y.a)(a)),a.touchEnd=a.touchEnd.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"handlePrependMessage",value:function(){var e=this;setTimeout((function(){e.scrollToRow(e.scrollToTarget)}),200)}},{key:"handleAppendMessage",value:function(){var e=this,t=this.props;(0,t.updateMessageStopIndex)(t.messageList.size-1),setTimeout((function(){var t=e.props.messageList.size-1;e.goToBottom({toRow:!0,index:t<0?0:t})}),200)}},{key:"goToBottom",value:function(e){var t=this,n=e.toRow,a=e.index;n&&this.scrollToRow(a),setTimeout((function(){n&&t.scrollToRow(a)}))}},{key:"componentDidUpdate",value:function(e){var t=this,n=e.messageList,a=e.isInputFocus,r=this.props,o=r.messageList,i=r.isInputFocus,s=r.conversationCanRead,c=r.fromChatbotForceScrollToEnd,u=n.size,l=o.size;if(u!==l){var d=n.getIn(["0","id"])===o.getIn(["0","id"]),p=o.last(),f=p&&p.get("sourceType"),g=p&&p.get("type"),h=l&&l>u&&(f===dn.Client||g===H.Csat||g===H.EnquiryType);if(d)(h||u-1===this.stopIndex)&&this.handleAppendMessage();else{var m=l-u;this.scrollToTarget=m,this.bufferScrollTop=this.scrollTop;var v=o.getIn(["0","type"]);(v!==H.ScrollTip&&v!==H.EnquiryType||this.props.conversationStatus!==fe.Uninitialized)&&this.handlePrependMessage()}this.deleteMessageFlag&&(this.scrollToTarget=this.stopIndex,this.bufferScrollTop=0,this.handlePrependMessage(),this.deleteMessageFlag=!1,this.removeStartIndex=0)}else{var _=n.last(),b=o.last();_&&b&&_.get("type")===H.Queue&&b.get("type")===H.CancelQueue&&this.handleAppendMessage()}!a&&i&&(clearTimeout(this.timeId),this.timeId=setTimeout((function(){s&&t.scrollToBottom()}),500)),c&&this.handleAppendMessage(),this.stopIndex=o.size-1}},{key:"componentWillUnmount",value:function(){this.timeId&&(clearTimeout(this.timeId),this.timeId=null),document.removeEventListener("touchstart",this.touchStart),document.removeEventListener("touchend",this.touchEnd)}},{key:"componentDidMount",value:function(){var e=this;document.addEventListener("touchstart",this.touchStart,!1),document.addEventListener("touchend",this.touchEnd,!1),hi.on("displayUnreadMessages",(function(t){var n=e.props.messageList;setTimeout((function(){var a=n.findIndex((function(e){return e.get("id")===t}));-1!==a&&a<n.size-1?e.scrollToRow(a+1):e.scrollToBottom()}),250)})),this.lastScrollHeight=this.listRef.current.scrollHeight}},{key:"touchStart",value:function(e){Wm=e.touches[0].pageX,Hm=e.touches[0].pageY}},{key:"touchEnd",value:function(e){Fm=e.changedTouches[0].pageX,Gm=e.changedTouches[0].pageY,this.getDirection(Wm,Hm,Fm,Gm)!==Vm.Down||this.firstFetch||(this.firstFetch=!0,this.props.getPaginationHistoryMessage(!0))}},{key:"getAngle",value:function(e,t){return 180*Math.atan2(t,e)/Math.PI}},{key:"getDirection",value:function(e,t,n,a){var r=n-e,o=a-t,i=0;if(Math.abs(r)<2&&Math.abs(o)<2)return i;var s=this.getAngle(r,o);return s>=-135&&s<=-45?i=Vm.Up:s>45&&s<135?i=Vm.Down:s>=135&&s<=180||s>=-180&&s<-135?i=Vm.Left:s>=-45&&s<=45&&(i=Vm.Right),i}},{key:"handleWheel",value:function(e){var t=this.props,n=t.isLoadingHistory,a=t.hasFetchedHistory,r=t.supportUnloginChatWithAgent,o=t.restoredConnection;!(e.deltaY<0)||this.scrollTop||n||a||(r?o&&this.debounceGetHistoryMessages(!0):this.debounceGetHistoryMessages(!0))}},{key:"fetchPrevMessage",value:function(){if(this.scrollTop<100){var e=this.props.loadMoreData;if(this.hitCNCBChatbotAndUserNotLogin())return;e()}}},{key:"hitCNCBChatbotAndUserNotLogin",value:function(){var e=this.props,t=e.accessPlatform,n=e.chatbotEnabled,a=e.isLogined;return Zc(t)&&n&&!a}},{key:"getHistoryMessages",value:function(e){var t=this.props,n=t.hasMoreHistory,a=t.isLoadingHistory,r=t.getPaginationHistoryMessage,o=t.cancelPullHistory,i=t.disableCancelPullHistory;this.hitCNCBChatbotAndUserNotLogin()||(!n||a||o||r(e),i())}},{key:"handleScroll",value:function(){var e=this.props,t=e.hasMoreHistory,n=e.updateMessageDirection,a=e.accessPlatform,r=e.conversationCanRead,o=e.setConversationCanRead,i=e.readLastMessage,s=e.isLoadingHistory,c=e.isLogined,u=e.shouldShowWindow,l=e.disableChatbotForceScrollToEnd,d=e.updateMessageStopIndex,p=e.messageList,f=this.listRef.current.scrollTop,g=this.listRef.current.clientHeight;u&&t&&f<100&&0!==g&&this.scrollTop>f&&(n(Rt.Older),!Zc(a)||c?s||this.debounceGetHistoryMessages(!0):this.debounceFetchPrevMessage()),this.scrollTop=f;var h=this.listRef.current.scrollHeight;u&&(f+g>=h&&!r?o(!0):f+g<h&&r&&(o(!1),i())),d(f+g>=h?p.size-1:0),l()}},{key:"scrollToBottom",value:function(){var e=this,t=this.props,n=t.messageList,a=t.lastReadMessageId,r=t.setLastReadMessageId,o=function(){var t=e.listRef.current.scrollHeight;e.listRef.current.scrollTo({top:t,behavior:"smooth"})};o();var i=setTimeout((function(){i&&clearTimeout(i),o()})),s=n.last(),c=null===s||void 0===s?void 0:s.get("id");a!==c&&r(c)}},{key:"scrollToRow",value:function(e){if(this.props.messageList.size-1===e){var t=this.listRef.current.scrollHeight;this.listRef.current.scrollTop=t}else{var n,a,r,o=null===(n=this.listRef.current)||void 0===n||null===(a=n.children)||void 0===a||null===(r=a[e])||void 0===r?void 0:r.offsetTop;o&&(this.listRef.current.scrollTop=o)}}},{key:"renderMessage",value:function(e){var t=this,n=e.message,a=e.style,r=e.measure,o=e.isFirstMessage,i=e.isLastMessage,s=e.messageLength,c=e.prevMessageType,u=e.timeFlag,l=e.marginTop,d=n.get("id"),p=n.get("type"),f=n.get("status"),g=n.get("content"),h=n.getIn(["content","text"]),v=n.getIn(["content","file"]),_=n.getIn(["content","url"]),b=n.get("sourceType"),E=n.get("shopeeChatKey"),y=n.getIn(["content","size"]),C=n.getIn(["content","name"]),S=n.getIn(["content","fileKey"]),O=n.getIn(["content","progress"]),A=n.getIn(["content","errorType"]),T=n.getIn(["content","oldConnectCount"]),I=f===ln.Sending,w=f===ln.Fail,L=b===dn.Client,k=this.props,M=k.resendImageMessage,j=k.resendFileMessage,x=k.resendMessage,R=k.updateMessageStatus,N=k.sendMessage,P=k.cancelFileUpload,U=k.cancelVideoUpload,D=k.resendVideoMessage,B=k.handlePreviewMedia,W=k.updateToast,F=k.resendOrderMessage,G=c===H.System;if(b===dn.Chatbot)return n.get("isEmpty")?m.a.createElement(jm,{message:g.toJS()}):p===H.History?m.a.createElement(Um,{id:d,isFirstMessage:o,isLastMessage:i,key:d,measure:r,sourceType:b,timestamp:u,style:a,messageLength:s,isPrevMessageSystem:G,scrollToBottom:this.scrollToBottom,messageType:p,marginTop:l}):m.a.createElement(mv,{id:d,isFirstMessage:o,isLastMessage:i,key:d,message:g.toJS(),measure:r,sourceType:b,timestamp:u,style:a,messageLength:s,isPrevMessageSystem:G,scrollToBottom:this.scrollToBottom,messageType:p,marginTop:l});if(p===H.Text)return m.a.createElement(Jm,{isLastMessage:i,key:d,isSender:L,text:h,messageId:d,timestamp:u,sourceType:b,style:a,measure:r,status:f,messageLength:s,updateMessageStatus:R,handleResend:function(){!I&&x(d,h)},isPrevMessageSystem:G,messageType:p,marginTop:l});if(p===H.Image){var V=n.getIn(["content","isHistory"]);return I?m.a.createElement(zm,{isLastMessage:i,key:d,status:f,noHandleStatus:!0,messageId:d,sourceType:b,timestamp:u,style:a,measure:r,cantShowLoading:!0,messageLength:s,updateMessageStatus:R,handleResend:function(){!I&&M(d,v)},isPrevMessageSystem:G,messageType:p,marginTop:l}):w?m.a.createElement(Km,{messageId:d,key:d,status:f,sourceType:b,measure:r,timestamp:u,style:a,handleResend:function(){!I&&M(d,v)},isLastMessage:i,messageLength:s,isPrevMessageSystem:G,messageType:p,marginTop:l}):m.a.createElement(Zm,{setPreviewImageSrc:B,style:a,messageId:d,key:d,measure:r,status:f,timestamp:u,sourceType:b,url:_,messageLength:s,handleResend:function(){!I&&M(d,v)},isLastMessage:i,updateMessageStatus:R,isPrevMessageSystem:G,messageType:p,isHistoryImageMessage:V,marginTop:l})}if(p===H.File)return m.a.createElement($m,{style:a,messageId:d,key:d,isSender:L,measure:r,size:y,name:C,progress:O,status:f,timestamp:u,sourceType:b,url:_,fileKey:S,messageLength:s,handleResend:function(){!I&&j(d,v)},isLastMessage:i,updateMessageStatus:R,isPrevMessageSystem:G,messageType:p,handleCancelUpload:function(){P(d,g.toJS())},marginTop:l});if(p===H.System)return m.a.createElement(Ym,{style:a,messageId:d,status:f,key:d,measure:r,sourceType:b,timestamp:u,messageLength:s,text:h,isLastMessage:i,isPrevMessageSystem:G,messageType:p,marginTop:l});if(p===H.Csat)return m.a.createElement(sv,{isLastMessage:i,messageId:d,shopeeChatKey:E,style:a,status:f,key:d,measure:r,sourceType:b,timestamp:u,messageLength:s,scrollToBottom:this.scrollToBottom,isPrevMessageSystem:G,messageType:p,marginTop:l});if(p===H.Rating){var Q=n.getIn(["content","type"]);return m.a.createElement(ev,{isLastMessage:i,type:Q,key:d,messageId:d,style:a,status:f,measure:r,sourceType:b,timestamp:u,messageLength:s,isPrevMessageSystem:G,messageType:p,marginTop:l})}if(p===H.ServiceOptions)return m.a.createElement(tv,{isLastMessage:i,key:d,content:g,messageId:d,timestamp:u,sourceType:b,style:a,measure:r,status:f,messageLength:s,isPrevMessageSystem:G,messageType:p,marginTop:l});if(p===H.ServerError)return m.a.createElement(dv,{style:a,status:f,measure:r,messageId:d,sourceType:b,timestamp:u,messageLength:s,isPrevMessageSystem:G,messageType:p,isLastMessage:i,marginTop:l});if(p===H.Emergency)return m.a.createElement(pv,{style:a,status:f,measure:r,messageId:d,sourceType:b,timestamp:u,messageLength:s,isPrevMessageSystem:G,content:g,messageType:p,isLastMessage:i,marginTop:l});if(p===H.OptionsText)return m.a.createElement(cv,{isLastMessage:i,key:d,messageId:d,style:a,status:f,measure:r,sourceType:b,timestamp:u,sendMessage:N,messageLength:s,content:g,isPrevMessageSystem:G,messageType:p,marginTop:l});if(p===H.LiveAgent)return m.a.createElement(nv,{style:a,status:f,measure:r,content:g,messageId:d,sourceType:b,timestamp:u,sendMessage:N,messageLength:s,isPrevMessageSystem:G,messageType:p,isLastMessage:i,marginTop:l});if(p===H.EnquiryType)return m.a.createElement(av,{style:a,status:f,measure:r,messageId:d,sourceType:b,timestamp:u,sendMessage:N,messageLength:s,isPrevMessageSystem:G,messageType:p,isLastMessage:i,marginTop:l});if(p===H.Queue)return m.a.createElement(rv,{style:a,messageId:d,key:d,measure:r,isLastMessage:i,messageType:p,marginTop:l});if(p===H.QueueError)return m.a.createElement(ov,{style:a,status:f,measure:r,oldConnectCount:T,sourceType:b,errorType:A,timestamp:u,sendMessage:N,messageLength:s,isPrevMessageSystem:G,messageType:p,isLastMessage:i,marginTop:l});if(p===H.CancelQueue)return m.a.createElement(iv,{style:a,status:f,measure:r,sourceType:b,timestamp:u,sendMessage:N,messageLength:s,isPrevMessageSystem:G,messageType:p,isLastMessage:i,key:d,marginTop:l});if(p===H.NoMore)return m.a.createElement(uv,{isLastMessage:i,key:d,messageId:d,style:a,status:f,measure:r,sourceType:b,timestamp:u,messageLength:s,isPrevMessageSystem:G,messageType:p,marginTop:l});if(p===H.Video){var q=n.getIn(["content","video_info"]).toJS();return m.a.createElement(lv,{style:a,messageId:d,key:d,status:f,timestamp:u,sourceType:b,messageLength:s,isLastMessage:i,updateMessageStatus:R,isPrevMessageSystem:G,messageType:p,onPlayVideo:B,isSender:L,videoInfo:q,updateToast:W,handleCancelUpload:function(){t.deleteMessageFlag=!0,t.removeStartIndex=t.startIndex,U(d),Pi({targetType:"cancel_video",operation:"click",data:{message_id:0,video_original_duration:Math.ceil((null===q||void 0===q?void 0:q.duration)||0)}})},handleResend:function(){if(D(d),t.scrollToBottom(),null===q||void 0===q?void 0:q.error){var e,n,a,r={message_id:0,video_original_duration:Math.ceil(q.duration||0),failure_reason:(null===(e=q.error)||void 0===e?void 0:e.code)||0};if(null===(n=q.error)||void 0===n?void 0:n.errorCode)r.be_error_code=null===(a=q.error)||void 0===a?void 0:a.errorCode;Pi({targetType:"resend_video",operation:"click",data:r})}},measure:r,marginTop:l})}if(p===H.ScrollTip)return m.a.createElement(Xm,{style:a,messageId:d,status:f,key:d,measure:r,sourceType:b,timestamp:u,messageLength:s,isLastMessage:i,isPrevMessageSystem:G,messageType:p,marginTop:l});if(p===H.Order){var K=n.getIn(["content"]).toJS();return m.a.createElement(fv,Object.assign({style:a,messageId:d,status:f,key:d,measure:r,sourceType:b,timestamp:u,messageLength:s,isLastMessage:i,isPrevMessageSystem:G,handleResend:function(){!I&&F(d,K)}},K,{messageType:p,marginTop:l}))}return p!==H.RegisterWebform||this.props.isSubmitedRegisterWebform?p===H.AgentJoined?m.a.createElement(hv,{style:a,status:f,measure:r,sourceType:b,timestamp:u,sendMessage:N,messageLength:s,isPrevMessageSystem:G,messageType:p,isLastMessage:i,key:d,content:g,marginTop:l}):null:m.a.createElement(gv,{style:a,messageId:d,status:f,key:d,measure:r,sourceType:b,timestamp:u,messageLength:s,isLastMessage:i,isPrevMessageSystem:G,messageType:p,marginTop:l})}},{key:"getTimeFlag",value:function(e,t,n){var a=this.props.accessPlatform,r=t&&t.get("timestamp"),o=e&&e.get("timestamp"),i=t&&t.get("greeting");return r&&(t.get("type")===H.History||i||!n&&Zc(a)||!o&&r||r-o>300)?r:null}},{key:"renderRow",value:function(e){var t=this.props.messageList,n=t.get(e);if(!n)return null;var a=0===e,r=e===t.size-1,o=t.get(e-1),i=o&&"function"===typeof o.get?o.get("type"):"",s=this.getTimeFlag(o,n,e),c=this.computeMarginTop(o,n,e);return this.renderMessage({message:t.get(e),prevMessageType:i,style:{},measure:function(){},isFirstMessage:a,isLastMessage:r,messageLength:t.size,timeFlag:s,marginTop:c})}},{key:"computeMarginTop",value:function(e,t,n){if(0===n)return 12;var a=this.getLayoutType(e),r=this.getLayoutType(t);return a===pn.System||r===pn.System||a!==r?12:8}},{key:"getLayoutType",value:function(e){var t=e.get("sourceType"),n=e.get("type");return t===dn.Chatbot?n===H.History?pn.System:e.get("from"):n===H.System?pn.System:t===dn.Client?pn.User:pn.Agent}},{key:"handleContainerSizeChange",value:function(e){var t=e.width,n=e.height,a=this.containerHeight,r=this.containerWidth;a===n&&r===t||(this.containerHeight=n,this.containerWidth=t)}},{key:"renderAutoSizerList",value:function(e,t){var n=this,a=this.props,r=a.messageList,o=a.messageListUUID;return m.a.createElement(tf.a,{key:o},(function(e){var a=e.width,o=e.height;return n.handleContainerSizeChange({width:a,height:o}),m.a.createElement(tf.c,{height:o,overscanRowCount:10,ref:function(e){n.listRef=e,t&&t(e)},onScroll:n.debounceHandleScroll,noRowsRenderer:function(){return null},rowCount:r.size,deferredMeasurementCache:n.cache,rowHeight:n.cache.rowHeight,rowRenderer:n.renderRow,width:a})}))}},{key:"isRowLoaded",value:function(e){var t=e.index;return!!this.props.messageList[t]}},{key:"render",value:function(){var e=this,t=this.props,n=t.conversationCanRead,a=t.unreadCount,r=t.messageList;return m.a.createElement("div",{className:Wh.a.root,id:"messageSessionLayout",onWheel:this.handleWheel},m.a.createElement("div",{className:Wh.a.scrollWrapper,onScroll:this.debounceHandleScroll,ref:this.listRef},r.map((function(t,n){return e.renderRow(n)}))),m.a.createElement(om,{showScrollToBottom:!n,unreadMessagesCount:a,handleScrollToBottom:this.scrollToBottom}))}}]),n}(h.PureComponent),_v=Object(O.b)((function(e){return{chatbotEnabled:e.getIn(["chatbot","enabled"]),isLogined:e.getIn(["user","isLogined"]),conversationStatus:e.getIn(["conversation","conversationStatus"]),restoredConnection:e.getIn(["conversation","restoredConnection"]),shouldShowWindow:e.getIn(["global","shouldShowWindow"]),supportUnloginChatWithAgent:e.getIn(["global","supportUnloginChatWithAgent"]),isSubmitedRegisterWebform:e.getIn(["global","isSubmitedRegisterWebform"]),fromChatbotForceScrollToEnd:e.getIn(["chatbot","scrollToEnd"]),cancelPullHistory:e.getIn(["chatbot","cancelPullHistory"])}}),(function(e){return{disableChatbotForceScrollToEnd:function(){e(Zi(!1))},disableCancelPullHistory:function(){e(es(!1))}}}))(Object(V.a)()(vv)),bv=n(168),Ev=n.n(bv);function yv(){return(yv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Cv(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Sv=m.a.createElement("path",{fillRule:"evenodd",d:"M8,1 C11.8659932,1 15,4.13400675 15,8 C15,11.8659932 11.8659932,15 8,15 C4.13400675,15 1,11.8659932 1,8 C1,4.13400675 4.13400675,1 8,1 Z M8.00070711,7.29218611 L5.87867966,5.17157288 C5.68341751,4.97631073 5.36683502,4.97631073 5.17157288,5.17157288 C4.99800652,5.34513923 4.97872137,5.61456363 5.11371742,5.80943177 L5.17157288,5.87867966 L7.29289322,8 L5.17157288,10.1213203 C4.97631073,10.3165825 4.97631073,10.633165 5.17157288,10.8284271 C5.34513923,11.0019935 5.61456363,11.0212786 5.80943177,10.8862826 L5.87867966,10.8284271 L8,8.70710678 L10.1213203,10.8284271 C10.3165825,11.0236893 10.633165,11.0236893 10.8284271,10.8284271 C11.0019935,10.6548608 11.0212786,10.3854364 10.8862826,10.1905682 L10.8284271,10.1213203 L8.70710678,8 L10.8284271,5.87867966 C11.0236893,5.68341751 11.0236893,5.36683502 10.8284271,5.17157288 C10.6548608,4.99800652 10.3854364,4.97872137 10.1905682,5.11371742 L10.1213203,5.17157288 L8.00070711,7.29218611 L5.87867966,5.17157288 L8.00070711,7.29218611 Z"}),Ov=function(e){var t=e.svgRef,n=e.title,a=Cv(e,["svgRef","title"]);return m.a.createElement("svg",yv({width:16,height:16,viewBox:"0 0 16 16",ref:t},a),n?m.a.createElement("title",null,n):null,Sv)},Av=m.a.forwardRef((function(e,t){return m.a.createElement(Ov,yv({svgRef:t},e))})),Tv=n(169),Iv=n.n(Tv),wv=n(681),Lv=n.n(wv);var kv=function(){return m.a.createElement("div",{className:Lv.a.root})};var Mv=function(e){var t=function(t){Object(C.a)(a,t);var n=Object(S.a)(a);function a(e){var t;return Object(b.a)(this,a),(t=n.call(this,e)).handleTryAgain=t.handleTryAgain.bind(Object(y.a)(t)),t.loadData=t.loadData.bind(Object(y.a)(t)),t.state={status:e.historyStatus},t}return Object(E.a)(a,[{key:"handleTryAgain",value:function(){var e=this.state.status,t=this.props,n=t.fetchRequested,a=t.getPaginationHistoryMessage,r=t.accessPlatform;e===Nt.ERROR&&(Zc(r)?n():a())}},{key:"loadData",value:function(){var e=this.state.status,t=this.props.fetchRequested;e===Nt.NORMAL&&t()}},{key:"renderPendingContent",value:function(){return m.a.createElement("div",{className:Iv.a.loading},m.a.createElement(kv,null),m.a.createElement("span",null,gs("loading_history")))}},{key:"renderErrorContent",value:function(){var e=this.props.t;return m.a.createElement("div",{className:Iv.a.error},e("cschat_failed_load"),", ",m.a.createElement("span",{onClick:this.handleTryAgain,className:Iv.a.tryAgain},"\xa0",e("cschat_click_to_try_again"),"\xa0"))}},{key:"render",value:function(){var t=this.state.status,n=void 0===t?"":t,a=n===Nt.ERROR,r=n===Nt.LOADING,o=this.props.messageDirection;return m.a.createElement("div",{className:w()(Iv.a.root,Object(x.a)({},Iv.a.reverse,o===Rt.Older))},m.a.createElement("div",{className:Iv.a.component},m.a.createElement(e,Object.assign({},this.props,{loadMoreData:this.loadData}))),a&&this.renderErrorContent(),r&&this.renderPendingContent())}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.historyStatus;return n!==t.historyStatus?{status:n}:null}}]),a}(h.PureComponent);return Object(V.a)()(t)},jv=n(297),xv=n.n(jv),Rv=n(69),Nv=n.n(Rv);function Pv(){return(Pv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Uv(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Dv=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 1l1.119 1.119L6.237 12l9.882 9.881L15 23 4 12 15 1z"}),Bv=function(e){var t=e.svgRef,n=e.title,a=Uv(e,["svgRef","title"]);return m.a.createElement("svg",Pv({viewBox:"0 0 24 24",className:"chat-icon",ref:t},a),n?m.a.createElement("title",null,n):null,Dv)},Wv=m.a.forwardRef((function(e,t){return m.a.createElement(Bv,Pv({svgRef:t},e))})),Hv=n(52),Fv=n.n(Hv);function Gv(){return(Gv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Vv(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Qv=m.a.createElement("path",{fillRule:"evenodd",d:"M14.5069172,9.00824711 C14.7523771,9.00824711 14.9565256,9.18512227 14.9988615,9.41837148 L15.0069172,9.50824711 L15.0069172,13.508579 C15.0069172,13.7540389 14.8300421,13.9581874 14.5967928,14.0005234 L14.5069172,14.008579 L1.5,14.008579 C1.25454011,14.008579 1.05039163,13.8317039 1.00805567,13.5984547 L1,13.508579 L1,9.50824711 C1,9.23210474 1.22385763,9.00824711 1.5,9.00824711 C1.74545989,9.00824711 1.94960837,9.18512227 1.99194433,9.41837148 L2,9.50824711 L2,13.008579 L14.0069172,13.008579 L14.0069172,9.50824711 C14.0069172,9.23210474 14.2307748,9.00824711 14.5069172,9.00824711 Z M8,2 C8.2576,2 8.46666667,2.2086 8.46666667,2.46666667 L8.46666667,9.6006 L10.4654,7.2682 C10.6497333,7.0848 10.9479333,7.0848 11.1313333,7.2682 C11.3156667,7.45253333 11.3156667,7.75026667 11.1313333,7.9346 L8.33413333,11.198 L8.31686667,11.2054667 L8.31686667,11.2054667 C8.25701667,11.2611167 8.18299167,11.3010167 8.10030417,11.3192604 L8.01213333,11.3305333 C7.88706667,11.3342667 7.76106667,11.2936667 7.6654,11.198 L4.8682,7.9346 C4.68433333,7.75026667 4.68433333,7.45253333 4.8682,7.2682 C5.05206667,7.0848 5.35026667,7.0848 5.53413333,7.2682 L7.53333333,9.6006 L7.53333333,2.46666667 C7.53333333,2.2086 7.74193333,2 8,2 Z"}),qv=function(e){var t=e.svgRef,n=e.title,a=Vv(e,["svgRef","title"]);return m.a.createElement("svg",Gv({viewBox:"0 0 16 16",ref:t},a),n?m.a.createElement("title",null,n):null,Qv)},Kv=m.a.forwardRef((function(e,t){return m.a.createElement(qv,Gv({svgRef:t},e))}));function zv(){return(zv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Jv(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Yv=m.a.createElement("path",{d:"M13.9221768,13.7815284 L13.8927126,13.8217978 L13.840498,13.8800776 L13.784025,13.9256754 L13.6899599,13.9769075 L13.6275039,13.9979073 L13.5597126,14.0097978 L13.4993648,14.0145181 L9.49936476,14.0145181 C9.22322238,14.0145181 8.99936476,13.7906605 8.99936476,13.5145181 C8.99936476,13.2690582 9.17623992,13.0649097 9.40948912,13.0225738 L9.49936476,13.0145181 L12.2923648,13.0145181 L8.86731421,9.58957434 C8.69374786,9.41600798 8.67446271,9.14658358 8.80945876,8.95171544 L8.86731421,8.88246755 C9.04088056,8.7089012 9.31030497,8.68961605 9.50517311,8.8246121 L9.57442099,8.88246755 L12.9993648,12.3075181 L12.9993648,9.5145181 C12.9993648,9.26905821 13.1762399,9.06490973 13.4094891,9.02257377 L13.4993648,9.0145181 C13.7448246,9.0145181 13.9489731,9.19139326 13.9913091,9.42464247 L13.9993648,9.5145181 L13.9992413,13.525739 L13.9882725,13.6197458 L13.9692481,13.6858098 L13.9425598,13.7462763 C13.9360714,13.7585648 13.9293454,13.7702006 13.9221768,13.7815284 Z M6.50237045,2.00127641 C6.77851282,2.00127641 7.00237045,2.22513403 7.00237045,2.50127641 C7.00237045,2.74673629 6.82549529,2.95088478 6.59224608,2.99322074 L6.50237045,3.00127641 L3.70937045,3.00127641 L7.13442099,6.42622017 C7.30798735,6.59978652 7.3272725,6.86921092 7.19227644,7.06407906 L7.13442099,7.13332695 C6.96085464,7.3068933 6.69143024,7.32617845 6.4965621,7.1911824 L6.42731421,7.13332695 L3.00237045,3.70827641 L3.00237045,6.50127641 C3.00237045,6.74673629 2.82549529,6.95088478 2.59224608,6.99322074 L2.50237045,7.00127641 C2.25691056,7.00127641 2.05276208,6.82440125 2.01042612,6.59115204 L2.00237045,6.50127641 L2.00415332,2.45889455 L2.01897871,2.37313064 L2.04016269,2.31023984 L2.07955846,2.23426609 L2.10637045,2.19427641 L2.16123717,2.13571689 L2.21771022,2.09011908 L2.2909747,2.04801992 L2.37423131,2.01788723 L2.43337045,2.00627641 L2.50237045,2.00127641 L6.50237045,2.00127641 Z M9.49936476,2.00127641 L13.4987126,2.00127641 L13.5527623,2.00409655 L13.6275039,2.01788723 L13.7107605,2.04801992 L13.784025,2.09011908 L13.8467471,2.14165577 L13.8937126,2.19427641 L13.9221768,2.23426609 L13.9615725,2.31023984 L13.9827565,2.37313064 L13.9939029,2.42735864 L13.9992413,2.49005552 L13.9993648,6.50127641 L13.9913091,6.59115204 C13.9542651,6.79524509 13.7933334,6.95617677 13.5892404,6.99322074 L13.4993648,7.00127641 L13.4094891,6.99322074 C13.2053961,6.95617677 13.0444644,6.79524509 13.0074204,6.59115204 L12.9993648,6.50127641 L12.9993648,3.70827641 L9.57442099,7.13332695 L9.50517311,7.1911824 C9.33466348,7.30930395 9.10707172,7.30930395 8.9365621,7.1911824 L8.86731421,7.13332695 L8.80945876,7.06407906 C8.69133722,6.89356944 8.69133722,6.66597768 8.80945876,6.49546806 L8.86731421,6.42622017 L12.2923648,3.00127641 L9.49936476,3.00127641 L9.40948912,2.99322074 C9.17623992,2.95088478 8.99936476,2.74673629 8.99936476,2.50127641 C8.99936476,2.25581652 9.17623992,2.05166804 9.40948912,2.00933208 L9.49936476,2.00127641 Z M6.50237045,14.0145181 L2.50237045,14.0145181 L2.43837045,14.0097978 L2.37423131,13.9979073 L2.31177535,13.9769075 L2.27024321,13.9574838 L2.20022653,13.9129354 L2.16123717,13.8800776 L2.11135409,13.8262058 L2.06911183,13.7642626 L2.04016269,13.7055547 L2.01897871,13.6426639 L2.00783232,13.5884359 L2.00415332,13.5569 L2.00237045,9.5145181 L2.01042612,9.42464247 C2.04747008,9.22054941 2.20840176,9.05961773 2.41249482,9.02257377 L2.50237045,9.0145181 L2.59224608,9.02257377 C2.79633914,9.05961773 2.95727082,9.22054941 2.99431478,9.42464247 L3.00237045,9.5145181 L3.00237045,12.3075181 L6.42731421,8.88246755 L6.4965621,8.8246121 C6.66707172,8.70649056 6.89466348,8.70649056 7.06517311,8.8246121 L7.13442099,8.88246755 L7.19227644,8.95171544 C7.31039799,9.12222506 7.31039799,9.34981682 7.19227644,9.52032645 L7.13442099,9.58957434 L3.70937045,13.0145181 L6.50237045,13.0145181 L6.59224608,13.0225738 C6.82549529,13.0649097 7.00237045,13.2690582 7.00237045,13.5145181 C7.00237045,13.759978 6.82549529,13.9641265 6.59224608,14.0064624 L6.50237045,14.0145181 Z"}),Xv=function(e){var t=e.svgRef,n=e.title,a=Jv(e,["svgRef","title"]);return m.a.createElement("svg",zv({viewBox:"0 0 16 16",ref:t},a),n?m.a.createElement("title",null,n):null,Yv)},Zv=m.a.forwardRef((function(e,t){return m.a.createElement(Xv,zv({svgRef:t},e))}));function $v(){return($v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function e_(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var t_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.93062 9.11995L8.965 9.07302L9.02593 9.0051L9.09183 8.95196L9.20159 8.89225L9.27447 8.86778L9.35358 8.85392L9.424 8.84842H14.0916C14.4138 8.84842 14.675 9.10931 14.675 9.43112C14.675 9.71718 14.4686 9.9551 14.1965 10.0044L14.0916 10.0138H10.8324L14.8291 14.0053C15.0316 14.2075 15.0541 14.5215 14.8966 14.7486L14.8291 14.8293C14.6266 15.0316 14.3122 15.0541 14.0848 14.8968L14.004 14.8293L10.0074 10.8378V14.0927C10.0074 14.3788 9.80105 14.6167 9.52887 14.6661L9.424 14.6754C9.13757 14.6754 8.89935 14.4693 8.84995 14.1975L8.84055 14.0927L8.8407 9.41805L8.8535 9.30849L8.87569 9.2315L8.90684 9.16103C8.91441 9.14671 8.92226 9.13315 8.93062 9.11995Z",fill:"white"}),n_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.90816 7.15137C1.58593 7.15137 1.32471 6.89048 1.32471 6.56867C1.32471 6.28261 1.5311 6.04469 1.80328 5.99535L1.90816 5.98596H5.16729L1.17062 1.99452C0.968085 1.79225 0.945581 1.47826 1.10311 1.25116L1.17062 1.17046C1.37315 0.968184 1.68754 0.945708 1.91493 1.10303L1.99574 1.17046L5.99229 5.16202V1.90705C5.99229 1.62099 6.19868 1.38308 6.47086 1.33374L6.57573 1.32435C6.86216 1.32435 7.10038 1.53048 7.14978 1.80231L7.15918 1.90705L7.1571 6.61806L7.1398 6.71801L7.11508 6.7913L7.06911 6.87984L7.03782 6.92644L6.9738 6.99469L6.9079 7.04783L6.82241 7.09689L6.72526 7.13201L6.65625 7.14554L6.57573 7.15137H1.90816Z",fill:"white"}),a_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.0916 7.15137L9.42476 7.15137L9.36169 7.14808L9.27447 7.13201L9.17732 7.09689L9.09183 7.04783L9.01864 6.98777L8.96384 6.92644L8.93062 6.87984L8.88465 6.7913L8.85993 6.71801L8.84693 6.65481L8.8407 6.58174L8.84055 1.90705L8.84995 1.80231C8.89318 1.56446 9.08097 1.37691 9.31912 1.33374L9.424 1.32435L9.52887 1.33374C9.76703 1.37691 9.95482 1.56446 9.99805 1.80231L10.0074 1.90705V5.16202L14.004 1.17046L14.0848 1.10303C14.2838 0.965374 14.5493 0.965374 14.7483 1.10303L14.8291 1.17046L14.8966 1.25116C15.0345 1.44987 15.0345 1.71511 14.8966 1.91382L14.8291 1.99452L10.8324 5.98596H14.0916L14.1965 5.99535C14.4686 6.04469 14.675 6.28261 14.675 6.56867C14.675 6.85473 14.4686 7.09264 14.1965 7.14198L14.0916 7.15137Z",fill:"white"}),r_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.90816 8.84842H6.57573L6.65041 8.85392L6.72526 8.86778L6.79814 8.89225L6.8466 8.91489L6.9283 8.96681L6.9738 9.0051L7.03201 9.06788L7.0813 9.14007L7.11508 9.20849L7.1398 9.28178L7.15281 9.34498L7.1571 9.38173L7.15918 14.0927L7.14978 14.1975C7.10655 14.4353 6.91876 14.6229 6.68061 14.6661L6.57573 14.6754L6.47086 14.6661C6.2327 14.6229 6.04491 14.4353 6.00169 14.1975L5.99229 14.0927V10.8378L1.99574 14.8293L1.91493 14.8968C1.71597 15.0344 1.45039 15.0344 1.25142 14.8968L1.17062 14.8293L1.10311 14.7486C0.965272 14.5499 0.965272 14.2847 1.10311 14.086L1.17062 14.0053L5.16729 10.0138H1.90816L1.80328 10.0044C1.5311 9.9551 1.32471 9.71718 1.32471 9.43112C1.32471 9.14506 1.5311 8.90715 1.80328 8.85781L1.90816 8.84842Z",fill:"white"}),o_=function(e){var t=e.svgRef,n=e.title,a=e_(e,["svgRef","title"]);return m.a.createElement("svg",$v({viewBox:"0 0 16 16",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,t_,n_,a_,r_)},i_=m.a.forwardRef((function(e,t){return m.a.createElement(o_,$v({svgRef:t},e))}));function s_(){return(s_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function c_(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48 24C48 37.2548 37.2548 48 24 48C10.7452 48 0 37.2548 0 24C0 10.7452 10.7452 0 24 0C37.2548 0 48 10.7452 48 24ZM26.4001 27.0001H21.9001V12.0001H26.4001V27.0001ZM21.9001 36H26.4001V31.5H21.9001V36Z",fill:"white"}),l_=function(e){var t=e.svgRef,n=e.title,a=c_(e,["svgRef","title"]);return m.a.createElement("svg",s_({viewBox:"0 0 48 48",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,u_)},d_=m.a.forwardRef((function(e,t){return m.a.createElement(l_,s_({svgRef:t},e))})),p_=n(203),f_=n.n(p_),g_="play",h_="pause",m_=Object(h.forwardRef)((function(e,t){var n=e.src,a=e.autoPlay,r=void 0===a||a,o=e.sendTrack,i=Object(rp.a)().t,s=Object(h.useState)(h_),c=Object(l.a)(s,2),u=c[0],d=c[1],p=Object(h.useState)(!0),f=Object(l.a)(p,2),g=f[0],v=f[1],_=Object(h.useState)(!1),b=Object(l.a)(_,2),E=b[0],y=b[1],C=Object(h.useState)(!0),S=Object(l.a)(C,2),O=S[0],A=S[1],T=Object(h.useState)(0),I=Object(l.a)(T,2),L=I[0],k=I[1],M=Object(h.useState)(0),j=Object(l.a)(M,2),x=j[0],R=j[1],N=Object(h.useState)(0),P=Object(l.a)(N,2),U=P[0],D=P[1],B=Object(h.useState)(!1),W=Object(l.a)(B,2),H=W[0],F=W[1],G=Object(h.useState)("00:00"),V=Object(l.a)(G,2),Q=V[0],q=V[1],K=Object(h.useState)("00:00"),z=Object(l.a)(K,2),J=z[0],Y=z[1],X=Object(h.useState)(!1),Z=Object(l.a)(X,2),$=Z[0],ee=Z[1],te=Object(h.useRef)(null),ne=Object(h.useRef)(null),ae=Object(h.useRef)(null),re=Object(h.useRef)(null);Object(h.useEffect)((function(){q(Hn(x))}),[x]),Object(h.useEffect)((function(){Y(Hn(L))}),[L]),Object(h.useEffect)((function(){var e;ne.current&&(null===(e=ne.current)||void 0===e?void 0:e.load())&&R(0)}),[n]),Object(h.useImperativeHandle)(t,(function(){return{currentTime:x,durationTime:L,isFullScreen:$}}));var oe=function(e){H&&ie(e),g?(re.current&&clearTimeout(re.current),re.current=setTimeout((function(){return v(!1)}),2e3)):(v(!0),re.current=setTimeout((function(){return v(!1)}),2e3))},ie=function(e){if(ae.current){var t=ae.current.getBoundingClientRect(),n=t.left,a=t.width,r=(e.clientX-n)/a*100;r<0&&(r=0),r>100&&(r=100);var o=L*r/100;D(r),R(o)}},se=function(e){o({targetType:"slide_bar",needStopTime:!1}),F(!0)},ce=function(){H&&(ue(),F(!1))},ue=function(){ne.current&&(ne.current.currentTime=x)},le=function(){o({targetType:$?"minimize":"expand"}),ee(!$)},de=function(){y(!0),Qn(n),o({targetType:"reload_video",needStopTime:!1,operation:"impression"})},pe=function(){var e,t;switch(u){case g_:o({targetType:"restart_video",needStopTime:!0}),null===(e=ne.current)||void 0===e||e.pause();break;case h_:o({targetType:"stop_video",needStopTime:!0}),null===(t=ne.current)||void 0===t||t.play()}};return m.a.createElement("section",{className:w()(Fv.a.container,$?Fv.a.fullscreen:""),onMouseLeave:function(){ce(),v(!1)},onMouseEnter:function(){return v(!0)},onMouseMove:oe,onMouseUp:ce,onClick:function(e){return e.stopPropagation()}},m.a.createElement("video",{className:Fv.a.video,ref:ne,src:n,autoPlay:r,onPlay:function(){return d(g_)},onPause:function(){return d(h_)},onLoadedMetadata:function(){ne.current&&k(ne.current.duration)},onTimeUpdate:function(){if(!H&&ne.current){var e=ne.current;R(e.currentTime);var t=e.currentTime/e.duration*100;D(t),t>=100&&o({targetType:"video_end",needStopTime:!1,operation:"action_finish_video"})}},onWaiting:function(){A(!0),te.current=setTimeout((function(){return de()}),3e4)},onPlaying:function(){A(!1),E&&y(!1),te.current&&clearTimeout(te.current)},onError:de,onClick:pe}),E&&m.a.createElement("div",{className:Fv.a.errorLayer},m.a.createElement("div",{className:Fv.a.errorWrap},m.a.createElement(d_,{className:Fv.a.errorIcon}),m.a.createElement("div",{className:Fv.a.reload,onClick:function(){y(!1),R(0),o({targetType:"reload_video",needStopTime:!1}),ne.current&&ne.current.load()}},i("label.reload_video")))),g&&!O&&!E&&m.a.createElement("div",{className:Fv.a.playerStatus,onClick:function(){return pe()}},m.a.createElement(Tm,{style:{width:"90px",height:"90px"},status:u})),!E&&O&&m.a.createElement("div",{className:Fv.a.loading},m.a.createElement("img",{className:Fv.a.loadingSpin,src:f_.a,alt:""})),!E&&g&&m.a.createElement("div",{className:Fv.a.controlBar,onClick:function(e){return e.stopPropagation()}},m.a.createElement("div",{className:Fv.a.time},"".concat(Q,"/").concat(J)),m.a.createElement("div",{className:Fv.a.progress},m.a.createElement("div",{className:Fv.a.progressTotal,onMouseDown:function(e){se(),ie(e)},ref:ae,onMouseUp:ce}),m.a.createElement("div",{className:Fv.a.currentProgress,style:{width:"".concat(U,"%")}},m.a.createElement("div",{className:Fv.a.progressAnchor,onMouseMove:oe,onMouseDown:se}))),m.a.createElement("div",{className:Fv.a.actions},m.a.createElement(Kv,{className:Fv.a.actionIcon,onClick:function(){o({targetType:"download"}),function(e,t){var n=new XMLHttpRequest;n.open("get",e),n.responseType="blob",n.onload=function(){t(n.response)},n.send()}(n,(function(e){var t=window.URL.createObjectURL,n=window.URL.revokeObjectURL,a=t(e),r=document.createElement("a");r.download="chat-video.mp4",r.setAttribute("target","_blank"),r.style.display="none",r.href=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),n(a)}))}}),$?m.a.createElement(i_,{className:Fv.a.actionIcon,onClick:le}):m.a.createElement(Zv,{className:Fv.a.actionIcon,onClick:le}))))}));function v_(){return(v_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function __(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 1.41176L13.4118 11.9986L24 22.5882L22.5882 24L11.9993 13.4111L1.41176 24L0 22.5882L10.5875 11.9993L0 1.41176L1.41176 0L11.9993 10.5875L22.5882 0L24 1.41176Z",fill:"white"}),E_=function(e){var t=e.svgRef,n=e.title,a=__(e,["svgRef","title"]);return m.a.createElement("svg",v_({width:24,height:24,viewBox:"0 0 24 24",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,b_)},y_=m.a.forwardRef((function(e,t){return m.a.createElement(E_,v_({svgRef:t},e))})),C_={INIT:0,LOADING:1,LOADED:2,FAILED:3},S_=function(e){var t=e.medias,n=e.modalZIndex,a=void 0===n?99999:n,r=e.onVisibleChange,o=e.currentPreviewMediaId,i=Object(h.useMemo)((function(){return Array.isArray(t)?t:[t]}),[t]),s=Object(h.useRef)(null),c=Object(h.useRef)(),u=Object(h.useRef)(null),d=Object(h.useRef)(0),p=Object(h.useState)(),f=Object(l.a)(p,2),g=f[0],v=f[1],_=Object(h.useState)(C_.INIT),b=Object(l.a)(_,2),E=b[0],y=b[1],C=Object(h.useState)(i[d.current-1]),S=Object(l.a)(C,2),O=S[0],A=S[1],T=Object(h.useState)(i[d.current+1]),I=Object(l.a)(T,2),L=I[0],k=I[1],M=null===g||void 0===g?void 0:g.type,j=M===fn.Image,x=M===fn.Video,R=function(e){document.body.style.overflow=e?"hidden":"auto"};Object(h.useEffect)((function(){return R(!0),function(){R(!1)}}),[]);var N=function(e){var t=e.targetType,n=e.needStopTime,a=void 0===n||n,r=e.operation,o=void 0===r?"click":r;if(!j){var i=c.current||{},s=i.currentTime,u=i.durationTime,l={is_expand_page:i.isFullScreen?1:0,video_original_duration:Math.ceil(u||0),message_id:"0"};a&&(l.video_stop_duration=Math.ceil(s||0)),(null===g||void 0===g?void 0:g.status)===ln.Success&&(l.message_id=g.id),Pi({targetType:t,pageSection:"video_pop_up",operation:o,data:l})}},P=function(e){N({targetType:e?"close_pop_up":"close_pop_up_background"}),r(!1)},U=function(){u.current&&(u.current.onerror=null,u.current.onload=null),u.current=new Image,u.current.onload=function(){y(C_.LOADED),s&&s.current&&u.current&&(s.current.innerHTML="",s.current.appendChild(u.current))},u.current.onerror=function(){y(C_.FAILED)},u.current.src=(i[d.current]||{}).url,y(C_.LOADING)},D=Object(h.useCallback)((function(e){return e.stopPropagation()}),[]),B=function(e,t){e.stopPropagation(),N({targetType:-1===t?"left":"right"}),d.current+=t,A(i[d.current-1]),k(i[d.current+1]),y(C_.INIT),U()};return Object(h.useEffect)((function(){var e=i.map((function(e){return e.id})).indexOf(o);-1!==e&&(d.current=e,A(i[d.current-1]),k(i[d.current+1]))}),[o]),Object(h.useEffect)((function(){var e=i[d.current];v(e)}),[d.current]),Object(h.useEffect)((function(){U()}),[]),Vd(m.a.createElement("div",{className:w()(Nv.a.root),style:{zIndex:a},onClick:function(){return P(!1)}},j&&[C_.INIT,C_.LOADING].includes(E)&&m.a.createElement("div",{className:Nv.a.loading},m.a.createElement("img",{className:Nv.a.loadingSpin,onClick:D,src:f_.a,alt:""})),j&&E===C_.FAILED&&m.a.createElement("div",{className:Nv.a.failedBg},m.a.createElement("img",{src:xv.a,className:Nv.a.failed,alt:""})),j&&E===C_.LOADED&&m.a.createElement("div",{onClick:D,className:Nv.a.image,ref:s}),x&&m.a.createElement(m_,{ref:c,src:(null===g||void 0===g?void 0:g.url)||"",key:d.current,sendTrack:N}),m.a.createElement("div",{className:Nv.a.close,onClick:function(e){e.stopPropagation(),P(!0)}},m.a.createElement(y_,{className:Nv.a.closeIcon})),O&&m.a.createElement("div",{className:w()(Nv.a.arrow,Nv.a.arrowLeft),onClick:function(e){return B(e,-1)}},m.a.createElement(Wv,{className:Nv.a.arrowIcon})),L&&m.a.createElement("div",{className:w()(Nv.a.arrow,Nv.a.arrowRight),onClick:function(e){return B(e,1)}},m.a.createElement(Wv,{className:Nv.a.arrowIcon}))))},O_=n(244),A_=n.n(O_);function T_(){return(T_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function I_(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var w_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.31071 9.25006L10.5304 2.03039L9.46973 0.969727L0.97497 9.46448C0.836135 9.6006 0.75 9.79027 0.75 10.0001C0.75 10.2101 0.83631 10.3999 0.975391 10.5361L9.46973 19.0304L10.5304 17.9697L3.31072 10.7501H21.5V9.25006H3.31071Z",fill:"white"}),L_=function(e){var t=e.svgRef,n=e.title,a=I_(e,["svgRef","title"]);return m.a.createElement("svg",T_({width:22,height:20,viewBox:"0 0 22 20",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,w_)},k_=m.a.forwardRef((function(e,t){return m.a.createElement(L_,T_({svgRef:t},e))}));function M_(){return(M_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function j_(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var x_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5.01415C3 4.71737 3.13182 4.43592 3.35982 4.24592L8.34393 0.0924993C8.60446 -0.12461 9 0.0606532 9 0.399788V14.6918C9 15.0309 8.60446 15.2162 8.34393 14.999L3.35982 10.8456C3.13182 10.6556 3 10.3742 3 10.0774V5.01415ZM0 5.54577C0 4.99349 0.447715 4.54577 1 4.54577C1.55228 4.54577 2 4.99349 2 5.54577V9.54577C2 10.0981 1.55228 10.5458 1 10.5458C0.447715 10.5458 0 10.0981 0 9.54577V5.54577ZM14.2728 5.87846C14.5071 5.64415 14.887 5.64415 15.1213 5.87846C15.3556 6.11278 15.3556 6.49268 15.1213 6.72699L13.8485 7.99978L15.1213 9.27257C15.3556 9.50689 15.3556 9.88679 15.1213 10.1211C14.887 10.3554 14.5071 10.3554 14.2728 10.1211L13 8.84831L11.7272 10.1211C11.4929 10.3554 11.113 10.3554 10.8787 10.1211C10.6444 9.88679 10.6444 9.50689 10.8787 9.27257L12.1515 7.99978L10.8787 6.72699C10.6444 6.49268 10.6444 6.11278 10.8787 5.87846C11.113 5.64415 11.4929 5.64415 11.7272 5.87846L13 7.15125L14.2728 5.87846Z",fill:"white"}),R_=function(e){var t=e.svgRef,n=e.title,a=j_(e,["svgRef","title"]);return m.a.createElement("svg",M_({width:16,height:16,viewBox:"0 0 16 16",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,x_)},N_=m.a.forwardRef((function(e,t){return m.a.createElement(R_,M_({svgRef:t},e))}));function P_(){return(P_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function U_(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var D_=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.35982 4.24614C3.13182 4.43613 3 4.71758 3 5.01436V10.0776C3 10.3744 3.13182 10.6558 3.35982 10.8458L8.34393 14.9993C8.60446 15.2164 9 15.0311 9 14.692V0.400002C9 0.0608668 8.60446 -0.124396 8.34393 0.0927129L3.35982 4.24614ZM1 4.54599C0.447715 4.54599 0 4.9937 0 5.54599V9.54599C0 10.0983 0.447715 10.546 1 10.546C1.55228 10.546 2 10.0983 2 9.54599V5.54599C2 4.9937 1.55228 4.54599 1 4.54599Z",fill:"white"}),B_=m.a.createElement("path",{d:"M11 11.8222C13.4301 11.8222 15.4 10.0712 15.4 7.91111C15.4 5.75106 13.4301 4 11 4",stroke:"white",strokeLinecap:"round",strokeLinejoin:"round"}),W_=m.a.createElement("path",{d:"M11.3999 9.68889C12.5045 9.68889 13.3999 8.89295 13.3999 7.91111C13.3999 6.92927 12.5045 6.13333 11.3999 6.13333",stroke:"white",strokeLinecap:"round",strokeLinejoin:"round"}),H_=function(e){var t=e.svgRef,n=e.title,a=U_(e,["svgRef","title"]);return m.a.createElement("svg",P_({viewBox:"0 0 16 16",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,D_,B_,W_)},F_=m.a.forwardRef((function(e,t){return m.a.createElement(H_,P_({svgRef:t},e))})),G_=n(49),V_=n.n(G_),Q_="play",q_="pause",K_=function(e){var t=e.src,n=e.autoPlay,a=void 0===n||n,r=e.onClose,o=e.tracker,i=e.duration,s=Object(rp.a)().t,c=Object(h.useState)(!1),u=Object(l.a)(c,2),d=u[0],p=u[1],f=Object(h.useState)(q_),g=Object(l.a)(f,2),v=g[0],_=g[1],b=Object(h.useState)(!0),E=Object(l.a)(b,2),y=E[0],C=E[1],S=Object(h.useState)(!1),O=Object(l.a)(S,2),A=O[0],T=O[1],I=Object(h.useState)(!0),w=Object(l.a)(I,2),L=w[0],k=w[1],M=Object(h.useState)(0),j=Object(l.a)(M,2),x=j[0],R=j[1],N=Object(h.useState)(i||0),P=Object(l.a)(N,2),U=P[0],D=P[1],B=Object(h.useState)(!1),W=Object(l.a)(B,2),H=W[0],F=W[1],G=Object(h.useState)("0:0"),V=Object(l.a)(G,2),Q=V[0],q=V[1],K=Object(h.useState)("0:0"),z=Object(l.a)(K,2),J=z[0],Y=z[1],X=Object(h.useRef)(null),Z=Object(h.useRef)(null),$=Object(h.useRef)(null),ee=Object(h.useRef)(null);Object(h.useEffect)((function(){o({operation:"impression"})}),[]),Object(h.useEffect)((function(){q(Hn(x))}),[x]),Object(h.useEffect)((function(){Y(Hn(U))}),[U]),Object(h.useEffect)((function(){X.current&&X.current.load()&&R(0)}),[t]);Object(h.useEffect)((function(){y&&(H&&ee.current&&clearTimeout(ee.current),ee.current||(ee.current=setTimeout((function(){!H&&C(!1)}),2e3)))}),[y,H,x]),Object(h.useEffect)((function(){ee.current&&clearTimeout(ee.current),ee.current=setTimeout((function(){!H&&C(!1)}),2e3)}),[v]);var te=function(e){H&&ne(e),!y&&C(!0)},ne=function(e){if(Z.current){var t=Z.current.getBoundingClientRect(),n=t.left,a=t.width,r=(e.touches[0].pageX-n)/a*100;r<0&&(r=0),r>100&&(r=100),R(U*r/100)}},ae=function(e){o({type:"slide_bar"}),F(!0)},re=function(){H&&X.current&&(F(!1),X.current.currentTime=x)},oe=function(){T(!0)},ie=function(){var e,t;if(y)switch(v){case Q_:o({type:"stop_video"},x),null===(e=X.current)||void 0===e||e.pause();break;case q_:o({type:"restart_video"},x),null===(t=X.current)||void 0===t||t.play()}},se=function(){if(X.current){var e=!d;p(e),e&&o({type:"mute_video"}),X.current.muted=e}},ce=!y&&!A,ue=U?x/U*100:0;return m.a.createElement("section",{className:V_.a.container,onTouchMove:te,onTouchEnd:re,onTouchStart:function(e){!y&&e.preventDefault(),C(!0)}},!ce&&m.a.createElement("div",{className:V_.a.top},m.a.createElement("div",{className:V_.a.icon,onClick:function(){o({type:"back"},x),r()}},m.a.createElement(k_,{className:V_.a.x}))),m.a.createElement("div",{className:V_.a.videoWrapper},m.a.createElement("video",{playsInline:!0,src:t,ref:X,className:V_.a.video,autoPlay:a,onPlay:function(){return _(Q_)},onPause:function(){return _(q_)},onLoadedMetadata:function(){var e;X.current&&(null===(e=X.current)||void 0===e?void 0:e.duration)&&D(X.current.duration)},onTimeUpdate:function(){if(!H&&X.current){var e=X.current||{};R(e.currentTime),U&&e.currentTime>=U&&o({type:"video_end",operation:"action_finish_video"})}},onWaiting:function(){k(!0),$.current=setTimeout((function(){return oe()}),3e4)},onPlaying:function(){k(!1),A&&T(!1),$.current&&clearTimeout($.current)},onError:oe,onTouchStart:ie,"x5-video-player-type":"h5"}),y&&!L&&!A&&m.a.createElement("div",{className:V_.a.playerStatus,onClick:ie},m.a.createElement(Tm,{style:{width:"72px",height:"72px"},status:v}))),!A&&L&&m.a.createElement("div",{className:V_.a.loading},m.a.createElement("img",{className:V_.a.loadingSpin,src:f_.a,alt:"loading"})),A&&m.a.createElement("div",{className:V_.a.errorLayer},m.a.createElement("div",{className:V_.a.errorWrap},m.a.createElement(d_,{className:V_.a.errorIcon}),m.a.createElement("div",{className:V_.a.reload,onClick:function(){T(!1),R(0),X.current&&X.current.load()}},s("cschat.reload_video")))),!ce&&m.a.createElement("div",{className:V_.a.controlBar,onClick:function(e){return e.stopPropagation()}},m.a.createElement("div",{className:V_.a.time},Q),m.a.createElement("div",{className:V_.a.progress},m.a.createElement("div",{ref:Z,className:V_.a.progressTotal,onTouchStart:function(e){ae(),ne(e)},onTouchEnd:re}),m.a.createElement("div",{className:V_.a.currentProgress,style:{width:"".concat(ue,"%")}},m.a.createElement("div",{className:V_.a.progressAnchor,onTouchMove:te,onTouchStart:ae}))),m.a.createElement("div",{className:V_.a.time},J),d?m.a.createElement(N_,{className:V_.a.volume,onClick:se}):m.a.createElement(F_,{className:V_.a.volume,onClick:se})))},z_=function(e){var t=e.type,n=e.src,a=e.onClose,r=e.tracker,o=e.duration,i=Object(h.useState)(n),s=Object(l.a)(i,2),c=s[0],u=s[1];return Vd(m.a.createElement("div",{className:A_.a.portal},t===fn.Image&&m.a.createElement("div",{onClick:a},m.a.createElement("div",{className:A_.a.top},m.a.createElement(k_,{className:A_.a.back})),m.a.createElement("img",{src:c,className:A_.a.image,onError:function(){u(xv.a)}})),t===fn.Video&&m.a.createElement(K_,{src:n,onClose:a,tracker:r,duration:o})))},J_=n(170),Y_=n.n(J_),X_=Object(O.b)((function(e){var t=e.getIn(["global","mobileConfirmModalOption"]).toJS();return{isOpen:t.isOpen,title:t.title,content:t.content}}),(function(e){return{close:function(){e(Ud({isOpen:!1,title:"",content:""}))}}}))((function(e){var t=e.title,n=e.content,a=e.isOpen,r=e.close,o=Object(rp.a)().t,i=m.a.createElement("div",{className:Y_.a.container},m.a.createElement("div",{className:Y_.a.body},m.a.createElement("div",{className:Y_.a.header},t),m.a.createElement("div",{className:Y_.a.content},n),m.a.createElement("div",{className:Y_.a.footer},m.a.createElement(j.a,{type:"link",className:Y_.a.button,onClick:r},o("cschat_general_ok")))));return a?Vd(i):null})),Z_=n(409),$_=n.n(Z_);var eb=Object(O.b)((function(e){return{show:e.getIn(["chatbot","showLoginExpired"])}}),(function(e){return{onClose:function(){e(Yi(!1))}}}))(Object(V.a)()((function(e){var t,n=e.show,a=e.onClose;return Object(h.useEffect)((function(){setTimeout((function(){a()}),5e3)}),[n]),m.a.createElement(h.Fragment,null,n&&m.a.createElement("div",{className:$_.a.bar},m.a.createElement(Av,{className:$_.a.failIcon}),m.a.createElement("span",{style:{verticalAlign:"middle"}},null===fs||void 0===fs||null===(t=fs.chatbotI18n)||void 0===t?void 0:t.getTrans("login_expired"))))}))),tb=Object(_t.a)(),nb=Object(_t.a)(),ab=(Object(_t.a)(),Mv(_v)),rb=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).state={showMediaPreviewModal:!1,currentPreviewMediaId:""},a.handleScrollToBottom=a.handleScrollToBottom.bind(Object(y.a)(a)),a.handlePreviewMedia=a.handlePreviewMedia.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"handlePreviewMedia",value:function(e){this.setState({showMediaPreviewModal:!0,currentPreviewMediaId:e})}},{key:"handleScrollToBottom",value:function(){}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,a=t.resendImageMessage,r=t.resendMessage,o=t.sendMessage,i=t.conversationStatus,s=t.networkStatus,c=t.messageList,u=t.socketUserType,l=t.accessPlatform,d=t.messageDirection,p=t.updateMessageStatus,f=t.fetchPrevMessage,g=t.updateMessageDirection,h=t.historyStatus,v=t.isInputFocus,_=t.resendFileMessage,b=t.conversationCanRead,E=t.setConversationCanRead,y=t.unreadCount,C=t.getPaginationHistoryMessage,S=t.setLastReadMessageId,O=t.lastReadMessageId,A=t.readLastMessage,T=t.hasFetchedHistory,I=t.cancelVideoUpload,w=t.resendVideoMessage,L=t.isMobileStyle,k=t.transferChatStatus,M=t.isLogined,j=t.updateToast,x=t.isInvalidToken,R=t.resendOrderMessage,N=t.updateMessageStopIndex,P=t.platform,U=h!==Nt.NO_MORE,D=h===Nt.LOADING,B=c.toJS().filter((function(e){var t,n;return e.type===H.Video&&(null===(t=e.content)||void 0===t||null===(n=t.video_info)||void 0===n?void 0:n.video_url)||e.type===H.Image})).map((function(e){var t,n,a,r,o,i,s="",c=0;e.type===H.Video&&(s=(null===(n=e.content)||void 0===n||null===(a=n.video_info)||void 0===a?void 0:a.video_url)||"",t=fn.Video,c=(null===(r=e.content)||void 0===r||null===(o=r.video_info)||void 0===o?void 0:o.duration)||0);e.type===H.Image&&(s=(null===(i=e.content)||void 0===i?void 0:i.url)||"",t=fn.Image);return{url:s,id:e.id,type:t,duration:c,status:e.status}})),W=B.find((function(t){return t.id===e.state.currentPreviewMediaId})),F=x&&!(!M&&Ue.includes(P));return m.a.createElement("div",{className:Ev.a.root},F&&m.a.createElement("div",{className:"".concat(Ev.a.networkBar,"  ").concat(Ev.a.SPXTokenInvalid)},m.a.createElement("span",{style:{verticalAlign:"middle"}},n("cschat_spx_unlogin_remind"))),"offline"===s&&m.a.createElement("div",{className:"".concat(Ev.a.networkBar," ").concat(Zc(l)||i!==fe.Chatting?"":Ev.a.fixTop)},m.a.createElement(Av,{className:Ev.a.failIcon}),m.a.createElement("span",{style:{verticalAlign:"middle"}},n("cschat_network_disconnected_text"))),!F&&"offline"!==s&&m.a.createElement(eb,null),m.a.createElement(X_,null),0!==c.size&&m.a.createElement(ab,{isLogined:M,transferChatStatus:k,unreadCount:y,messageList:c,resendMessage:r,sendMessage:o,accessPlatform:l,socketUserType:u,conversationStatus:i,resendImageMessage:a,resendFileMessage:_,updateMessageStatus:p,fetchRequested:f,historyStatus:h,hasMoreHistory:U,messageDirection:d,updateMessageDirection:g,isInputFocus:v,cancelFileUpload:Xn,conversationCanRead:b,setConversationCanRead:E,setLastReadMessageId:S,lastReadMessageId:O,readLastMessage:A,isLoadingHistory:D,hasFetchedHistory:T,getPaginationHistoryMessage:C,handlePreviewMedia:this.handlePreviewMedia,cancelVideoUpload:I,resendVideoMessage:w,updateToast:j,resendOrderMessage:R,updateMessageStopIndex:N}),this.state.showMediaPreviewModal&&(L?W&&m.a.createElement(z_,{src:(null===W||void 0===W?void 0:W.url)||"",duration:null===W||void 0===W?void 0:W.duration,tracker:function(){},onClose:function(){e.setState({showMediaPreviewModal:!1})},type:W.type}):m.a.createElement(S_,{medias:B,onVisibleChange:function(t){e.setState({showMediaPreviewModal:t})},currentPreviewMediaId:this.state.currentPreviewMediaId})))}}]),n}(h.Component),ob=Object(O.b)((function(e){var t=e.getIn(["message","agentTyping"]),n=e.getIn(["message","lastReadMessageId"]),a=e.getIn(["conversation","conversationCanRead"]),r=e.getIn(["user","transferChatStatus"]),o=e.getIn(["user","isLogined"]),i=e.getIn(["user","cancelQueueConfirm"]),s=e.getIn(["user","userEvents"]),c=e.getIn(["chatbot","enabled"]),u=0,l=e.getIn(["message","messageList"]),d=!ei(s,me.HistoryMessage)&&!c,p=l.size;if((t&&a&&(l=l.push(Object(Q.fromJS)({type:H.Text,sourceType:dn.Agent,id:tb,status:ln.Typing,content:{}}))),n&&p)&&n!==l.last().get("id")){var f=l.filter((function(e){var t=e.get("sourceType");return dn.Client!==t&&dn.Chatbot!==t})).map((function(e){return e.get("id")})),g=f.lastIndexOf(n);-1!==g&&(u=f.size-g-1)}return r!==fe.AgentQueue&&r!==fe.Transfering||i||(l=l.push(Object(Q.fromJS)({type:H.Queue,sourceType:dn.Bot,id:nb,content:{}}))),d&&(l=l.unshift(Object(Q.fromJS)({type:H.ScrollTip,id:Object(_t.a)(),content:{}}))),{messageList:l,isInputFocus:e.getIn(["global","isInputFocus"]),socketUserType:e.getIn(["socket","userType"]),messageDirection:e.getIn(["message","messageDirection"]),conversationStatus:e.getIn(["conversation","conversationStatus"]),networkStatus:e.getIn(["global","networkStatus"]),historyStatus:e.getIn(["message","fetchHistoryStatus"]),conversationCanRead:e.getIn(["conversation","conversationCanRead"]),unreadCount:u,lastReadMessageId:n,transferChatStatus:r,isLogined:o,hasFetchedHistory:e.getIn(["message","hasFetchedHistory"]),isMobileStyle:e.getIn(["global","isMobileStyle"]),isInvalidToken:e.getIn(["conversation","tokenIsInvalid"])}}),(function(e){return{resendImageMessage:function(t,n){e(o.resendImageMessage(t,n))},resendMessage:function(t,n){e(o.resendMessage(t,n))},sendMessage:function(t,n){e(o.sendMessage(t,n))},updateMessageDirection:function(t){e(i.updateMessageDirection(t))},updateMessageStatus:function(t,n){e(i.updateMessageStatus(t,n))},fetchPrevMessage:function(){e(a.fetchPrevMessage())},resendFileMessage:function(t,n){e(i.resendFileMessage(t,n))},setConversationCanRead:function(t){e(c.setConversationCanRead(t))},getPaginationHistoryMessage:function(t){e(i.getPaginationHistoryMessage(t))},setLastReadMessageId:function(t){e(i.setLastReadMessageId(t))},readLastMessage:function(){e(i.readLastMessage())},cancelVideoUpload:function(t){e(function(e){return function(t){t(Ua(e)),t(Ta(e))}}(t))},resendVideoMessage:function(t){e(ka(t))},updateToast:function(t){e(u.updateToast(t))},resendOrderMessage:function(t,n){e(hr(t,Object(d.a)({},n)))},updateMessageStopIndex:function(t){e(i.updateMessageStopIndex(t))}}}))(Fd(Object(V.a)()(rb))),ib=n(63),sb=n.n(ib);function cb(){return(cb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ub(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var lb=m.a.createElement("circle",{cx:14,cy:14,r:13,stroke:"#666666",strokeWidth:2}),db=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 13V8H13V13H8V15H13V20H15V15H20V13H15Z",fill:"#666666"}),pb=function(e){var t=e.svgRef,n=e.title,a=ub(e,["svgRef","title"]);return m.a.createElement("svg",cb({width:28,height:28,viewBox:"0 0 28 28",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,lb,db)},fb=m.a.forwardRef((function(e,t){return m.a.createElement(pb,cb({svgRef:t},e))}));function gb(){return(gb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function hb(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var mb=m.a.createElement("circle",{cx:14,cy:14,r:13,stroke:"#666666",strokeWidth:2}),vb=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.4142 13.9999L18.9497 10.4644L17.5355 9.05018L14 12.5857L10.4645 9.05018L9.05025 10.4644L12.5858 13.9999L9.05025 17.5355L10.4645 18.9497L14 15.4141L17.5355 18.9497L18.9497 17.5355L15.4142 13.9999Z",fill:"#666666"}),_b=function(e){var t=e.svgRef,n=e.title,a=hb(e,["svgRef","title"]);return m.a.createElement("svg",gb({width:28,height:28,viewBox:"0 0 28 28",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,mb,vb)},bb=m.a.forwardRef((function(e,t){return m.a.createElement(_b,gb({svgRef:t},e))})),Eb=/Chrome\/(\d{2})/i,yb=/Macintosh/i,Cb=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).editorRef=null,a.originHeight=void 0,a.handlePaste=a.handlePaste.bind(Object(y.a)(a)),a.handleChange=a.handleChange.bind(Object(y.a)(a)),a.handleKeyDown=a.handleKeyDown.bind(Object(y.a)(a)),a.handleSendMessage=a.handleSendMessage.bind(Object(y.a)(a)),a.handleEditorHeight=a.handleEditorHeight.bind(Object(y.a)(a)),a.handleDropAndParseImage=a.handleDropAndParseImage.bind(Object(y.a)(a)),a.editorRef=m.a.createRef(),a.handleBlur=a.handleBlur.bind(Object(y.a)(a)),a.handleFocus=a.handleFocus.bind(Object(y.a)(a)),a.originHeight=0,a.handleKeyboard=a.handleKeyboard.bind(Object(y.a)(a)),a.onTouchEnd=a.onTouchEnd.bind(Object(y.a)(a)),a.changeMobileToolbarVisible=a.changeMobileToolbarVisible.bind(Object(y.a)(a)),a.state={value:""},a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){this.handleEditorHeight(),this.originHeight=document.documentElement.clientHeight||document.body.clientHeight,je&&window.addEventListener("resize",this.handleKeyboard,!1)}},{key:"componentWillUnmount",value:function(){je&&window.removeEventListener("resize",this.handleKeyboard,!1)}},{key:"onTouchEnd",value:function(e){e.preventDefault(),e.nativeEvent.preventDefault()}},{key:"handleKeyboard",value:function(){var e=this.props.updateIsInputFocus,t=document.documentElement.clientHeight||document.body.clientHeight;this.originHeight<t?(console.log("Android \u952e\u76d8\u6536\u8d77\u5566\uff01"),e(!1)):console.log("Android \u952e\u76d8\u6253\u5f00\u5566\uff01"),this.originHeight=t}},{key:"componentDidUpdate",value:function(){this.handleEditorHeight()}},{key:"handlePaste",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o,i,s,c,u,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,a=n.t,r=n.onError,o=window.clipboardData||t.clipboardData,i=window.navigator.userAgent||"",s=i.match(Eb)?i.match(Eb)[1]:0,o&&o.items){e.next=6;break}return e.abrupt("return");case 6:if(!(o.items&&2===o.items.length&&"string"===o.items[0].kind&&"file"===o.items[1].kind&&o.types&&2===o.types.length&&"text/plain"===o.types[0]&&"Files"===o.types[1]&&i.match(yb)&&Number(s)<49)){e.next=8;break}return e.abrupt("return");case 8:c=null,u=0;case 10:if(!(u<o.items.length)){e.next=19;break}if("file"!==(l=o.items[u]).kind){e.next=16;break}return(c=l.getAsFile())||(t.preventDefault(),r&&r(a("cschat_file_type_limit",{type:"JPG, JPEG, PNG"}))),e.abrupt("break",19);case 16:u++,e.next=10;break;case 19:if(!c){e.next=22;break}return e.next=22,this.handleDropAndParseImage(t,c);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDropAndParseImage",value:function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,r,o,i,s,c,u,l,d,p,g;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=this.props,r=a.onError,o=a.currentFileLength,i=void 0===o?0:o,s=a.t,c=n.size,u=void 0===c?0:c,l=n.type,d=void 0===l?"":l,p=!1,i+1>9&&(r&&r(s("cschat_maximum_file",{number:9})),p=!0),Ae.includes(d)||(r&&r(s("cschat_file_type_limit",{type:"JPG,JPEG,PNG"})),p=!0),u>2097152&&(r&&r(s("cschat_image_exceed_size",{size:2})),p=!0),!p){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,Zn(Array.isArray(n)?n:[n]);case 11:g=e.sent,this.props.addFiles(g);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.setState({value:e})}},{key:"handleBlur",value:function(){var e=this.props,t=e.updateIsInputFocus;e.platform===Oe.WeChat&&Me&&window.scrollTo(0,document.documentElement.clientHeight),t(!1)}},{key:"handleFocus",value:function(){(0,this.props.updateIsInputFocus)(!0)}},{key:"handleEditorHeight",value:function(){var e=this.editorRef,t=this.props.isMobileStyle,n=e&&e.current;if(n){n.style.height="";var a=t?120:100;n.scrollHeight>a?(n.style.height="".concat(a,"px"),n.style.overflow="auto"):(n.style.height=n.scrollHeight+"px",n.style.overflow="hidden")}}},{key:"handleSendMessage",value:function(e){e&&e.nativeEvent.preventDefault();var t=this.props,n=t.onSend,a=t.currentFileLength,r=t.onError,o=t.t,i=this.state.value.trim();(i||a)&&n&&(i.length>4096?(r&&r(o("cschat_message_too_long")),n()):(n(i),this.handleChange()))}},{key:"handleKeyDown",value:function(e){switch(e.keyCode){case 13:if(e.shiftKey)return;return e.preventDefault(),this.handleSendMessage(),!1}}},{key:"changeMobileToolbarVisible",value:function(){this.props.setIsMobileToolbarOpen(!this.props.isMobileToolbarOpen)}},{key:"render",value:function(){var e=this,t=this.props,n=t.currentFileLength,a=t.t,r=t.platform,o=t.isMobileStyle,i=t.isMobileToolbarOpen,s=(t.setIsMobileToolbarOpen,t.transferChatStatus),c=this.state.value,u=!!c.trim().length||n,l=Zc(r)&&s!==fe.Chatting?function(){}:this.handlePaste,d=Re?{onTouchStart:this.handleSendMessage,onTouchEnd:this.onTouchEnd}:{onClick:this.handleSendMessage},p=Re?{onTouchStart:this.changeMobileToolbarVisible,onTouchEnd:this.onTouchEnd}:{onClick:this.changeMobileToolbarVisible},f=Re?{}:{onKeyDown:this.handleKeyDown};return m.a.createElement("div",{className:w()(sb.a.root,Object(x.a)({},sb.a.desktopWechat,Zo()))},o?m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:sb.a.textareaContainer},m.a.createElement("div",{className:sb.a.textWrap},m.a.createElement("textarea",Object.assign({value:c,className:sb.a.textarea,onPaste:l,onChange:function(t){return e.handleChange(t.target.value)}},f,{ref:this.editorRef,onFocus:this.handleFocus,onClick:this.handleFocus,onBlur:this.handleBlur,placeholder:a("cschat_type_message")})),m.a.createElement("div",Object.assign({className:sb.a.sendButton},d),m.a.createElement("div",{className:w()(sb.a.button,Object(x.a)({},sb.a.buttonActive,u))}))),s===fe.Chatting&&m.a.createElement("div",Object.assign({},p,{className:sb.a.toolbarButtonContainer}),i?m.a.createElement(bb,{className:sb.a.toolbarButtonIcon}):m.a.createElement(fb,{className:sb.a.toolbarButtonIcon})))):m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:sb.a.textareaContainer},m.a.createElement("textarea",{value:c,className:sb.a.textarea,onPaste:l,onChange:function(t){return e.handleChange(t.target.value)},onKeyDown:this.handleKeyDown,ref:this.editorRef,placeholder:a("cschat_type_message")})),m.a.createElement("div",{className:sb.a.sendButton},m.a.createElement("div",{className:w()(sb.a.button,Object(x.a)({},sb.a.buttonActive,u)),onClick:this.handleSendMessage}))))}}]),n}(h.PureComponent),Sb=Object(O.b)(void 0,(function(e){return{addFiles:function(t){e(s.addFiles(t))}}}))(Object(V.a)()(Fd(Cb))),Ob=n(410),Ab=n.n(Ob),Tb=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).fileUploaderRef=null,a.handleClick=a.handleClick.bind(Object(y.a)(a)),a.handleChange=a.handleChange.bind(Object(y.a)(a)),a.getAcceptFileType=a.getAcceptFileType.bind(Object(y.a)(a)),a.fileUploaderRef=Object(h.createRef)(),a}return Object(E.a)(n,[{key:"handleClick",value:function(){var e=this.props,t=e.onClick;e.disabled||(this.fileUploaderRef&&this.fileUploaderRef.current&&this.fileUploaderRef.current.click(),t&&t())}},{key:"handleChange",value:function(){var e=Object(g.a)(f.a.mark((function e(){var t,n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.onSuccess,n=this.fileUploaderRef&&this.fileUploaderRef.current?this.fileUploaderRef.current:null){e.next=4;break}return e.abrupt("return");case 4:return a=n.files||[],e.next=7,Zn(Array.from(a));case 7:if(r=e.sent,n&&(n.value=""),0!==r.length){e.next=11;break}return e.abrupt("return");case 11:r.forEach((function(e){t&&t(e)}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAcceptFileType",value:function(e){var t=[];if(Zo())return"*";switch(e){case fn.File:t=ke;break;case fn.Video:t=Le;break;case fn.Image:t=Ae;break;case fn.Gallery:t=[].concat(Object(Wt.a)(Ae),Object(Wt.a)(Le))}return t.join(", ")}},{key:"render",value:function(){var e=this.props,t=e.fileType,n=e.children,a=e.multiple,r=e.disabled,o=e.className,i=a?{multiple:"multiple"}:{},s=this.getAcceptFileType(t);return m.a.createElement("div",{onClick:this.handleClick,className:w()(o,Object(x.a)({},Ab.a.disabled,r))},m.a.createElement("input",Object.assign({},i,{type:"file",className:Ab.a.input,accept:s,ref:this.fileUploaderRef,onChange:this.handleChange})),n)}}]),n}(h.PureComponent);Tb.defaultProps={multiple:!0,disabled:!1,currentFileLength:0,className:""};var Ib=Object(V.a)()(Tb),wb=n(95),Lb=n.n(wb),kb=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).imageIconRef=void 0,a.handleSuccess=a.handleSuccess.bind(Object(y.a)(a)),a.handleTrack=a.handleTrack.bind(Object(y.a)(a)),a.imageIconRef=m.a.createRef(),a}return Object(E.a)(n,[{key:"handleSuccess",value:function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,this.props.addFiles)([t]);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",n=Gi();Pi({pageSection:"upload_panel",targetType:e,operation:t,data:Object(d.a)({},n)})}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,a=t.onError,r=t.platform,o=t.currentFileLength,i=t.transferChatStatus,s=t.onOrder,c=o>=9,u=Vn();return m.a.createElement("div",{className:w()(Lb.a.root,Object(x.a)({},Lb.a.desktopWechat,Zo()))},m.a.createElement("div",{className:Lb.a.left},(!Zc(r)||i===fe.Chatting)&&m.a.createElement("div",{className:Lb.a.item},m.a.createElement(Ib,{fileType:fn.File,currentFileLength:o,onSuccess:this.handleSuccess,onError:a,disabled:c},m.a.createElement(Lp,{title:n(c?"cschat_maximum_file":"cschat_general_file",{number:9})},m.a.createElement("div",{className:w()(Lb.a.icon,Lb.a.fileIcon),ref:this.imageIconRef,onClick:function(){e.handleTrack("file")},onMouseEnter:function(){c&&e.handleTrack("exceed_maximum_media_no","impression")}}))),m.a.createElement(Ib,{fileType:fn.Image,currentFileLength:o,onSuccess:this.handleSuccess,onError:a,disabled:c},m.a.createElement(Lp,{title:n(c?"cschat_maximum_file":"cschat_general_image",{number:9})},m.a.createElement("div",{className:Lb.a.icon,ref:this.imageIconRef,onMouseEnter:function(){c&&e.handleTrack("exceed_maximum_media_no","impression")},onClick:function(){e.handleTrack("photo")}}))),u&&m.a.createElement(Ib,{fileType:fn.Video,currentFileLength:o,onSuccess:this.handleSuccess,onError:a,disabled:c},m.a.createElement(Lp,{title:n(c?"cschat_maximum_file":"cschat_general_video",{number:9})},m.a.createElement("div",{className:w()(Lb.a.icon,Lb.a.videoIcon),onMouseEnter:function(){c&&e.handleTrack("exceed_maximum_media_no","impression")},onClick:function(){e.handleTrack("video")}}))),su(r)&&m.a.createElement("div",null,m.a.createElement(Lp,{title:n("cschat_order_order_menu")},m.a.createElement("div",{className:w()(Lb.a.icon,Lb.a.orderIcon),onClick:function(){s(!0)}}))))))}}]),n}(h.PureComponent),Mb=Object(V.a)()(Fd(kb)),jb=n(171),xb=n.n(jb),Rb=n(73),Nb=n.n(Rb),Pb=Object(O.b)((function(e){return{platform:e.getIn(["global","accessPlatform"])}}),(function(e){return{sendFileMessage:function(t){e(Xa(t))}}}))((function(e){var t=e.sendFileMessage,n=Object(rp.a)().t,a=function(){},r=function(){var e=Object(g.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t([n]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=Vn();return m.a.createElement("div",{className:Nb.a.container},m.a.createElement(Ib,{fileType:fn.File,onSuccess:r,onError:a,className:Nb.a.fileSelector},m.a.createElement("div",{className:w()(Nb.a.fileIcon,Nb.a.icon)}),m.a.createElement("div",{className:Nb.a.desc},n("cschat_general_file"))),o&&m.a.createElement(Ib,{fileType:fn.Gallery,onSuccess:r,onError:a,className:Nb.a.fileSelector},m.a.createElement("div",{className:w()(Nb.a.galleryIcon,Nb.a.icon)}),m.a.createElement("div",{className:Nb.a.desc},n("cschat_general_gallery"))),su(e.platform)&&m.a.createElement("div",{className:Nb.a.fileSelector},m.a.createElement("div",{className:w()(Nb.a.icon,Nb.a.orderIcon),onClick:function(){e.onOrder(!0)}}),m.a.createElement("div",{className:Nb.a.desc},n("cschat_order_order_menu"))))})),Ub=n(135),Db=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).debounceInit=void 0,a.debounceRestartChatbot=void 0,a.clickTryLiveAgentAgain=Object(g.a)(f.a.mark((function e(){var t,n,r,o,i,s,c,u,l,d,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props,n=t.pushEnquiryTypeMessage,r=t.transferChatStatus,o=t.pushRegisterWebformMessage,i=t.pushUnloginGreetings,t.token,s=t.accessPlatform,c=t.conversationStatus,u=t.resetTimeStamp,l=t.supportUnloginChatWithAgent,d=t.tokenIsInvalid,!t.chatbotEnabled){e.next=6;break}return e.next=4,fs.reInit();case 4:return Bi(),e.abrupt("return");case 6:l&&(c===fe.End||d)?(u(),i(),o()):ru(s)&&r!==fe.Chatting?n():!St("prevEnquiryType")&&Zc(s)?null===(p=a.props)||void 0===p||p.initSocketSession():a.initSession();case 7:case"end":return e.stop()}}),e)}))),a.restartChatbot=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fs.reInit();case 2:Bi();case 3:case"end":return e.stop()}}),e)}))),a.filesChanged=a.filesChanged.bind(Object(y.a)(a)),a.validateFiles=a.validateFiles.bind(Object(y.a)(a)),a.onSend=a.onSend.bind(Object(y.a)(a)),a.initSession=a.initSession.bind(Object(y.a)(a)),a.debounceInit=T()(a.clickTryLiveAgentAgain,500,{leading:!0,trailing:!1}),a.debounceRestartChatbot=T()(a.restartChatbot,500,{leading:!0,trailing:!1}),a.setIsMobileToolbarOpen=a.setIsMobileToolbarOpen.bind(Object(y.a)(a)),a.state={isMobileToolbarOpen:!1},a}return Object(E.a)(n,[{key:"setIsMobileToolbarOpen",value:function(e){this.setState({isMobileToolbarOpen:e})}},{key:"initSession",value:function(){var e=this.props.initSession;e&&e()}},{key:"filesChanged",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.map((function(e){var t=$n(e.file);return Object(d.a)(Object(d.a)({},e),{},{type:t})})),this.props.updateFiles(n);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"validateFiles",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zn(Array.from(t));case 2:n=e.sent,this.props.addFiles(n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSend",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,r,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,a=n.files,r=n.sendMessage,o=n.sendFilesAndImages,i=n.updateFiles,s=n.currentFileLength,i([]),!t){e.next=7;break}return e.next=5,r(t);case 5:return e.next=7,zo(500);case 7:if(!s){e.next=10;break}return e.next=10,o(a);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.t,n=e.onError,a=e.files,r=e.conversationStatus,o=e.transferChatStatus,i=e.isMobileStyle,s=e.updateIsInputFocus,c=e.currentFileLength,u=e.platform,l=e.clickOrderMenu,p=e.chatbotIsChatting,f=e.chatbotEnabled,g=e.connectAgentSuccess;if(p)return m.a.createElement(Ub.ChatbotInput,null);var h=o===fe.AgentQueue||o===fe.Chatting||o===fe.Transfering;if(f&&!g&&!h)return m.a.createElement("div",{className:xb.a.root},m.a.createElement("div",{className:xb.a.contactAgain},m.a.createElement("div",{className:xb.a.contactText,onClick:this.debounceRestartChatbot},t("cschat_chat_with_chatbot_again"))));var v=a.map((function(e){var t;switch(e.type){case fn.Video:t=lg.b.Video;break;case fn.Image:t=lg.b.Image;break;case fn.File:t=lg.b.File}return Object(d.a)(Object(d.a)({},e),{},{mediaType:t})})),_=!!c,b=Se.includes(r),E=!ru(u)||r===fe.Chatting;return m.a.createElement("div",{className:xb.a.root},b?m.a.createElement("div",{className:xb.a.contactAgain},m.a.createElement("div",{className:xb.a.contactText,onClick:this.debounceInit},t(f?"cschat_contact_customer_service_again":"cschat_contact_agent_again"))):E&&m.a.createElement(m.a.Fragment,null,_&&m.a.createElement(lg.a,{max:9,files:v,multiple:!0,accept:Zo()?"*":[].concat(Object(Wt.a)(Ae),Object(Wt.a)(ke),Object(Wt.a)(Le)).join(", "),imagePreviewIndex:99999,validateFiles:this.validateFiles,filesChanged:this.filesChanged,size:Zo()?"large":"small",addIconTooltip:t("cschat_add_drawer_tip"),onAddButtonClick:function(){Pi({targetType:"preview_add_media",operation:"click"})},onItemClick:function(){Pi({targetType:"preview_media",operation:"click"})},onClose:function(){Pi({targetType:"close_preview_media",operation:"click"})},onItemDelete:function(){Pi({targetType:"delete_preview_media",operation:"click"})}}),m.a.createElement(Sb,{addImages:this.props.addFiles,transferChatStatus:o,currentFileLength:c,onSend:this.onSend,onError:n,updateIsInputFocus:s,isMobileToolbarOpen:this.state.isMobileToolbarOpen,setIsMobileToolbarOpen:this.setIsMobileToolbarOpen}),(!i||o===fe.Chatting)&&(i?this.state.isMobileToolbarOpen&&m.a.createElement(Pb,{onOrder:l}):m.a.createElement(Mb,{onError:n,addFiles:this.props.addFiles,transferChatStatus:o,currentFileLength:c,onOrder:l}))))}}]),n}(h.Component),Bb=Object(O.b)((function(e){return{conversationStatus:e.getIn(["conversation","conversationStatus"]),currentFileLength:e.getIn(["file","currentFileLength"]),files:e.getIn(["file","files"]).toJS(),transferChatStatus:e.getIn(["user","transferChatStatus"]),enquiryTypes:e.getIn(["user","enquiryTypes"]),supportUnloginChatWithAgent:e.getIn(["global","supportUnloginChatWithAgent"]),tokenIsInvalid:e.getIn(["conversation","tokenIsInvalid"]),token:e.getIn(["conversation","token"]),chatbotIsChatting:e.getIn(["chatbot","chatting"]),chatbotEnabled:e.getIn(["chatbot","enabled"]),connectAgentSuccess:e.getIn(["chatbot","connectAgentSuccess"])}}),(function(e){return{sendFilesAndImages:function(t){e(o.sendFilesAndImages(t))},sendMessage:function(t){e(o.sendMessage(t))},initSession:function(){e(c.initSession({needKeepConversation:!0,isForceOnline:!0}))},initSocketSession:function(){e(c.initSocketSession())},updateIsInputFocus:function(t){e(u.updateIsInputFocus(t))},addFiles:function(t){e(s.addFiles(t))},updateFiles:function(t){e(s.updateFiles(t))},pushEnquiryTypeMessage:function(){e(i.pushEnquiryTypeMessage())},clickOrderMenu:function(t){e(u.updateShowOrderModal(t))},updateTransferChatStatus:function(t){e(r.updateTransferChatStatus(t))},updateConversationStatus:function(t){e(c.updateConversationStatus(t))},pushUnloginGreetings:function(){e(i.pushEmergencyMessage(G.t(_e.Unlogined),!1))},pushRegisterWebformMessage:function(){e(i.pushRegisterWebformMessage())},resetTimeStamp:function(){e(i.setPrevMessageTimestamp(0))}}}))(Object(V.a)()(Fd(Db))),Wb=n(64),Hb=n.n(Wb),Fb=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).state={showEndModal:!1},pt.destroy(),a.setContainer=a.setContainer.bind(Object(y.a)(a)),a.handleError=a.handleError.bind(Object(y.a)(a)),a.onEndChatClick=a.onEndChatClick.bind(Object(y.a)(a)),a.onCancelClick=a.onCancelClick.bind(Object(y.a)(a)),a.onEndClick=a.onEndClick.bind(Object(y.a)(a)),a}return Object(E.a)(n,[{key:"handleError",value:function(e){(0,this.props.updateToast)({msg:e})}},{key:"onEndChatClick",value:function(){var e=this.props,t=e.updateDisableMinimizeStatus,n=e.showChatbotEndChat;if(this.setState({showEndModal:!0}),t(!0),!n){var a=St("prevEnquiryType");Pi({targetType:"end_chat_button",operation:"click",data:{enquiry_type:a}})}}},{key:"onCancelClick",value:function(){var e=this.props.updateDisableMinimizeStatus;this.setState({showEndModal:!1}),e(!1)}},{key:"onEndClick",value:function(){var e=this.props,t=e.endConversation,n=e.updateDisableMinimizeStatus,a=e.chatbotIsChatting,r=e.cancelPullHistory;this.setState({showEndModal:!1}),a?(fs.end(),r()):t(),n(!1),function(){var e=Hc.getState().getIn(["chatbot","sessionInfo"]);Ui({section:"session_global",target:"end_chatbot",data:{chat_session_id:e.sessionId}})}()}},{key:"setContainer",value:function(e){window.csChatToastContainer=e}},{key:"componentDidMount",value:function(){var e=Gi();Pi({targetType:"chat_window",operation:"impression",data:Object(d.a)({has_unread:!1},e)})}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.conversationStatus,n=e.transferChatStatus;e.showChatbotEndChat||!(t===fe.Chatting||n===fe.Chatting)&&this.state.showEndModal&&this.setState({showEndModal:!1})}},{key:"render",value:function(){var e,t,n,a,r=this.props,o=r.conversationStatus,i=r.t,s=r.accessPlatform,c=r.transferChatStatus,u=r.supportUnloginChatWithAgent,l=r.messageList,d=r.showChatbotEndChat,p=!1;p=Zc(s)?c===fe.Chatting:o===fe.Chatting||c===fe.Chatting;var f=this.state.showEndModal;return m.a.createElement("div",{className:w()(Hb.a.root,Object(x.a)({},Hb.a.desktopWechat,Zo())),ref:this.setContainer},m.a.createElement(rt.a,{in:p||d&&c!==fe.AgentQueue&&c!==fe.Transfering,unmountOnExit:!0,timeout:200,classNames:{enter:Hb.a.enter,enterActive:Hb.a.enterActive,exit:Hb.a.exit,exitActive:Hb.a.exitActive}},m.a.createElement("div",{className:Hb.a.tagWrap},m.a.createElement("div",{className:Hb.a.tagLeft},m.a.createElement("span",{className:Hb.a.tagDot}),m.a.createElement("span",{className:Hb.a.tagText},d?null===fs||void 0===fs||null===(e=fs.chatbotI18n)||void 0===e?void 0:e.getTrans("connected_to_agent"):i("cschat_connected_to_agent"))),m.a.createElement("div",{className:Hb.a.tagRight,onClick:this.onEndChatClick},d?null===fs||void 0===fs||null===(t=fs.chatbotI18n)||void 0===t?void 0:t.getTrans("end_chat"):i("cschat_end_chat")))),m.a.createElement(ob,{accessPlatform:s}),(!u||!(null===l||void 0===l?void 0:l.find((function(e){return e.get("type")===H.RegisterWebform})))&&c!==fe.Transfering&&c!==fe.AgentQueue&&c!==fe.NoAgent)&&m.a.createElement(Bb,{onError:this.handleError,accessPlatform:s}),f&&m.a.createElement("div",{className:Hb.a.endModal},m.a.createElement("div",{className:Hb.a.modalTitle},d?null===fs||void 0===fs||null===(n=fs.chatbotI18n)||void 0===n?void 0:n.getTrans("end_session"):i("cschat_end_session")),m.a.createElement("div",{className:Hb.a.modalContent},d?null===fs||void 0===fs||null===(a=fs.chatbotI18n)||void 0===a?void 0:a.getTrans("agent_will_leave"):i("cschat_agent_will_leave")),m.a.createElement("div",{className:Hb.a.modalBtnGroup},m.a.createElement(j.a,{onClick:this.onCancelClick,className:Hb.a.noBtn},i("cschat_general_cancel")),m.a.createElement(j.a,{onClick:this.onEndClick,type:"primary"},i("cschat_general_end")))))}}]),n}(h.Component),Gb=Object(O.b)((function(e){return{conversationStatus:e.getIn(["conversation","conversationStatus"]),accessPlatform:e.getIn(["global","accessPlatform"]),transferChatStatus:e.getIn(["user","transferChatStatus"]),supportUnloginChatWithAgent:e.getIn(["global","supportUnloginChatWithAgent"]),isSubmitedRegisterWebform:e.getIn(["global","isSubmitedRegisterWebform"]),messageList:e.getIn(["message","messageList"]),showChatbotEndChat:e.getIn(["chatbot","showEndChat"]),chatbotIsChatting:e.getIn(["chatbot","chatting"])}}),(function(e){return{endConversation:function(){e(o.endConversation())},updateDisableMinimizeStatus:function(t){e(c.updateDisableMinimizeStatus(t))},updateToast:function(t){e(u.updateToast(t))},cancelPullHistory:function(){e(es(!0))}}}))(Object(V.a)()(Fd(Fb))),Vb=Object(O.b)(void 0,(function(e){return{minimizeWindow:function(){e(u.minimizeWindow()),e(c.updateConflicted(!1))}}}))(Fd((function(e){var t=Object(rp.a)().t;Object(h.useEffect)((function(){Pi({targetType:"chat_session_conflict",operation:"impression"})}),[]);var n=e.isMobileStyle||e.platform===Oe.WeChat;return m.a.createElement("div",{className:Up.a.conflictedModal},m.a.createElement("div",{className:Up.a.title},t("cschat_cannot_chat_here")),m.a.createElement("div",{className:Up.a.content},t("cschat_conflicted_text")),!n&&m.a.createElement(j.a,{className:Up.a.gotBtn,onClick:e.minimizeWindow,type:"primary"},t("cschat_got_it_btn")))}))),Qb=n(208),qb=n.n(Qb),Kb=n(682),zb=n.n(Kb),Jb=function(e){var t=Object(rp.a)().t,n=e.onDragLeave,a=e.onDrop,r=e.onSuccess,o=e.onDragOver,i=function(){var e=Object(g.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a&&a(t),n=t.dataTransfer.files,r(n),e.abrupt("return");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return m.a.createElement("div",{className:w()(qb.a.dragging,Object(x.a)({},qb.a.desktopWechatDragging,Zo())),onDrop:i,onDragOver:function(e){e.preventDefault(),o&&o(e)},onDragLeave:function(e){e.preventDefault(),n&&n(e)}},m.a.createElement("div",{className:qb.a.content},m.a.createElement("div",{className:qb.a.dragFileWave},m.a.createElement("img",{src:zb.a,alt:""})),m.a.createElement("p",{className:qb.a.dragFileTips},t("cschat_drop_files"))))},Yb=n(172),Xb=n.n(Yb);function Zb(){return(Zb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function $b(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var eE,tE=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.3963 2.37057C15.5916 2.17531 15.9082 2.17531 16.1035 2.37057L16.1918 2.45896C16.3871 2.65422 16.3871 2.9708 16.1918 3.16606L10.3579 9.00001L16.5448 15.1869C16.74 15.3821 16.74 15.6987 16.5448 15.894L16.4564 15.9824C16.2611 16.1776 15.9445 16.1776 15.7493 15.9824L9.5624 9.79551L3.37554 15.9824C3.18027 16.1776 2.86369 16.1776 2.66843 15.9824L2.58004 15.894C2.38478 15.6987 2.38478 15.3821 2.58004 15.1869L8.76691 9.00001L2.93296 3.16606C2.7377 2.9708 2.7377 2.65422 2.93296 2.45896L3.02135 2.37057C3.21661 2.17531 3.5332 2.17531 3.72846 2.37057L9.5624 8.20451L15.3963 2.37057Z",fill:"black",fillOpacity:.65}),nE=function(e){var t=e.svgRef,n=e.title,a=$b(e,["svgRef","title"]);return m.a.createElement("svg",Zb({width:18,height:18,viewBox:"0 0 18 18",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,tE)},aE=m.a.forwardRef((function(e,t){return m.a.createElement(nE,Zb({svgRef:t},e))})),rE=function(e){var t=e.title,n=e.children,a=e.platform,r=Object(O.c)(),o=Object(O.d)((function(e){return e.getIn(["global","showOrderModal"])})),i=[Oe.SellerCenter,Oe.EduHub,Oe.ShopeeCn].includes(a);function s(){r(u.updateShowOrderModal(!1))}return Object(h.useEffect)((function(){return function(){}}),[]),m.a.createElement(rt.a,{in:o,timeout:200,unmountOnExit:!0,classNames:{}},m.a.createElement("div",{className:Xb.a.rootLayer,onClick:function(e){e.target===e.currentTarget&&s()}},m.a.createElement("div",{className:Xb.a.modalContent},m.a.createElement("div",{className:w()(Xb.a.modalHeader,Object(x.a)({},Xb.a.pcStyle,i))},t,m.a.createElement(aE,{onClick:s,className:w()(Xb.a.closeIcon)})),m.a.createElement("div",{className:Xb.a.modalBody},n&&Object(d.a)({},n)))))},oE=n(20),iE=n.n(oE);!function(e){e[e.left=0]="left",e[e.right=1]="right"}(eE||(eE={}));var sE=function(e){var t,n,a=e.onChange,r=e.active,o=e.showPcStyle,i=e.isMobileStyle,s=e.platform,c=Object(rp.a)().t,u=Object(h.useRef)(null),d=Object(h.useState)(0),p=Object(l.a)(d,2),f=p[0],g=p[1],v=[{label:c("cschat_order_status_all"),value:He.ALL},{label:c("cschat_order_status_unpaid"),value:He.Unpaid},{label:c("cschat_order_status_to_ship"),value:He.ToShip},{label:c("cschat_order_status_shiping"),value:He.ToReceive},{label:c("cschat_order_status_compeleted"),value:He.Complete},{label:c("cschat_order_status_cancellation"),value:He.Cancelled},{label:c("cschat_order_status_refund"),value:He.Refund}];Object(h.useEffect)((function(){return function(){}}),[r]);return m.a.createElement("div",{className:iE.a.tabBar},f===eE.right&&m.a.createElement("span",{className:w()([iE.a.optBtn,iE.a.scrollLeftBtn]),onClick:function(){var e=u.current;e&&(e.scrollLeft=0,g(eE.left))}}),m.a.createElement("div",{className:w()((t={},Object(x.a)(t,iE.a.barBox,!0),Object(x.a)(t,iE.a.toRight,f===eE.right||i),t))},m.a.createElement("div",{className:w()((n={},Object(x.a)(n,iE.a.scroller,!0),Object(x.a)(n,iE.a.toLeft,f===eE.left||i),n)),ref:u},v.map((function(e,t){return m.a.createElement("span",{onClick:function(){a(e.value)},className:w()([iE.a.tabItem,r===e.value?iE.a.active:"",o?iE.a.pcStyle:""]),key:t},e.label)})))),!i&&s!==Oe.WeChat&&f===eE.left&&m.a.createElement("span",{className:w()([iE.a.optBtn,iE.a.scrollRightBtn]),onClick:function(){var e=u.current;e&&(e.scrollLeft=e.clientWidth,g(eE.right))}}))};function cE(){return(cE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function uE(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var lE=m.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5116 0C10.8701 0 11.1862 0.220906 11.3465 0.595144C11.6671 1.56869 11.9981 2.5551 12.3374 3.54857L12.9089 5.20443C12.9754 5.42014 13.0057 5.63885 12.9993 5.85074C13.0008 6.84499 12.3697 7.69343 11.5008 7.93269L11.5 11.9936C11.5 12.5459 11.0523 12.9936 10.5 12.9936H2.5C1.94772 12.9936 1.5 12.5459 1.5 11.9936L1.50025 7.93266C0.631748 7.69367 0.000680041 6.84768 0.00085744 5.86595C-0.00562877 5.64223 0.0248121 5.42118 0.0878345 5.21424L0.664267 3.55645C1.00934 2.55562 1.34785 1.55831 1.68445 0.552324C1.82843 0.220906 2.14453 0 2.503 0H10.5116ZM9.50066 7.27324C9.13598 7.71772 8.60191 8 8.00066 8C7.45953 8 6.97281 7.77135 6.61504 7.4016L6.50065 7.27324L6.38627 7.4016C6.02849 7.77135 5.54178 8 5.00065 8C4.3994 8 3.86533 7.71772 3.50065 7.27324C3.24125 7.5894 2.89615 7.8235 2.50212 7.93231L2.5 11.9936H10.5L10.4992 7.93231C10.1052 7.8235 9.76005 7.5894 9.50066 7.27324ZM10.4291 1H2.58727L2.22238 2.0868C1.97657 2.81433 1.7255 3.54821 1.46838 4.29061L1.04155 5.51785C1.01083 5.62502 0.997389 5.73364 1.00065 5.85146C1.00065 6.42886 1.36911 6.89376 1.83513 6.98409C2.07084 6.96001 2.29486 6.89791 2.50124 6.80344L2.50148 6.84472C2.79721 6.64743 3.00065 6.2805 3.00065 5.85146C3.00065 5.1848 4.00065 5.1848 4.00065 5.85146C4.00065 6.49577 4.45945 7 5.00065 7C5.54185 7 6.00065 6.49577 6.00065 5.85146C6.00065 5.1848 7.00065 5.1848 7.00065 5.85146C7.00065 6.49577 7.45946 7 8.00066 7C8.54185 7 9.00066 6.49577 9.00066 5.85146C9.00066 5.1848 10.0007 5.1848 10.0007 5.85146C10.0007 6.2805 10.2041 6.64743 10.4998 6.84472L10.4999 6.80332C10.7061 6.89773 10.9299 6.95983 11.165 6.98321C11.6321 6.89363 12.0002 6.42747 11.9996 5.8369C12.0027 5.72947 11.9893 5.62347 11.9556 5.50899L11.6039 4.49158C11.1929 3.29731 10.7986 2.12639 10.4291 1Z",fill:"#999999"}),dE=function(e){var t=e.svgRef,n=e.title,a=uE(e,["svgRef","title"]);return m.a.createElement("svg",cE({width:13,height:13,viewBox:"0 0 13 13",fill:"none",ref:t},a),n?m.a.createElement("title",null,n):null,lE)},pE=m.a.forwardRef((function(e,t){return m.a.createElement(dE,cE({svgRef:t},e))})),fE=function(e){var t,n=e.orderData,a=e.selectOrder,r=e.platform,o=e.isMobileStyle,i=e.isForRR,s=n.items,c=void 0===s?[]:s,u=n.shop_image,p=c[0]||{},f=p.image&&p.image[0]||"",g=Object(rp.a)().t,v=u[0]&&Object(so.cdnFile)(u[0]),_=n.item_count>1?g("cschat_order_items"):g("cschat_order_item"),b=Object(h.useState)(!1),E=Object(l.a)(b,2),y=E[0],C=E[1],S=Object(h.useRef)(null),O=(t={},Object(x.a)(t,He.Unpaid,g("cschat_order_status_unpaid")),Object(x.a)(t,He.ToShip,g("cschat_order_status_to_ship")),Object(x.a)(t,He.ToReceive,g("cschat_order_status_shiping")),Object(x.a)(t,He.Complete,g("cschat_order_status_compeleted")),Object(x.a)(t,He.Cancelled,g("cschat_order_status_cancellation")),Object(x.a)(t,He.Refund,g("cschat_order_status_refund")),t),A=i?n.return_status:n.order_list_type&&O[null===n||void 0===n?void 0:n.order_list_type];return Object(h.useEffect)((function(){var e;(null===S||void 0===S?void 0:S.current).offsetWidth>=(null===(e=(null===S||void 0===S?void 0:S.current).firstChild)||void 0===e?void 0:e.offsetWidth)&&C(!0)}),[]),m.a.createElement("div",{className:iE.a.orderItem},m.a.createElement("div",{onClick:function(){(o||r===Oe.WeChat)&&uu(r,n.order_id,n.checkout_id,n.order_list_type,n.uri_key)}},m.a.createElement("div",{className:iE.a.orderTitle},m.a.createElement("div",{className:iE.a.titleInfo},v?m.a.createElement("img",{src:v,className:iE.a.shopIcon}):m.a.createElement(pE,{className:iE.a.shopIcon}),m.a.createElement("div",{className:iE.a.shopName},n.shop_name)),m.a.createElement("div",{className:iE.a.titleStatus},A)),m.a.createElement("div",{className:iE.a.goodsPanel},m.a.createElement("img",{src:Object(so.cdnFile)(f),className:iE.a.goodsImage}),m.a.createElement("div",{className:iE.a.goodsInfo},m.a.createElement(Lp,{title:p.title,isShowArrow:!1,isOrderTitle:!0,isHidden:y,position:"right"},m.a.createElement("div",{className:iE.a.goodsTittle,ref:S},m.a.createElement("span",null,p.title))),m.a.createElement("div",{className:iE.a.standard},m.a.createElement("div",{className:iE.a.goodsName},p.specification),m.a.createElement("div",{className:iE.a.goodsNumber},"x ",p.amount)),m.a.createElement("div",{className:iE.a.goodsPrice},cu(p.order_price)))),m.a.createElement("div",{className:iE.a.orderItem},m.a.createElement("span",{className:iE.a.itemLeft},n.item_count," ",_),m.a.createElement("span",{className:iE.a.itemRight},g("cschat_order_total_payment"),"\uff1a",m.a.createElement("span",{className:iE.a.totalPrice},cu(i?n.refund_amount:n.total_price)))),m.a.createElement("div",{className:iE.a.orderItem},m.a.createElement("span",{className:iE.a.itemLeft},g("cschat_order_order_id")),m.a.createElement("span",{className:iE.a.itemRight},n.order_sn))),m.a.createElement("div",{className:iE.a.operationBtnGroup},!o&&r!==Oe.WeChat&&m.a.createElement("button",{className:w()(iE.a.operationBtn,iE.a.detailBtn),onClick:function(){}