/**
 * @hitv/hls-loader v0.1.24 - P2P loader for hls.js integration.
 *
 * @author Allex Wang <allex.wxn@gmail.com>
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).P2Hls={})}(this,function(exports){
/*! *****************************************************************************
 Copyright (c) Microsoft Corporation.
 Permission to use, copy, modify, and/or distribute this software for any
 purpose with or without fee is hereby granted.
 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
 REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
 AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
 INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
 LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
 PERFORMANCE OF THIS SOFTWARE.
 ***************************************************************************** */
var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},domain;function EventHandlers(){}function EventEmitter(){EventEmitter.init.call(this)}function $getMaxListeners(e){return e._maxListeners===undefined?EventEmitter.defaultMaxListeners:e._maxListeners}function emitNone(e,t,r){if(t)e.call(r);else for(var n=e.length,i=arrayClone(e,n),o=0;o<n;++o)i[o].call(r)}function emitOne(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,o=arrayClone(e,i),s=0;s<i;++s)o[s].call(r,n)}function emitTwo(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=e.length,s=arrayClone(e,o),a=0;a<o;++a)s[a].call(r,n,i)}function emitThree(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var s=e.length,a=arrayClone(e,s),c=0;c<s;++c)a[c].call(r,n,i,o)}function emitMany(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,o=arrayClone(e,i),s=0;s<i;++s)o[s].apply(r,n)}function _addListener(e,t,r,n){var i,o,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]):(o=e._events=new EventHandlers,e._eventsCount=0),s){if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),!s.warned&&(i=$getMaxListeners(e))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,emitWarning(a)}}else s=o[t]=r,++e._eventsCount;return e}function emitWarning(e){console.warn}function _onceWrap(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function listenerCount(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function spliceOne(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}function arrayClone(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}function unwrapListeners(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}EventHandlers.prototype=Object.create(null),EventEmitter.EventEmitter=EventEmitter,EventEmitter.usingDomains=!1,EventEmitter.prototype.domain=undefined,EventEmitter.prototype._events=undefined,EventEmitter.prototype._maxListeners=undefined,EventEmitter.defaultMaxListeners=10,EventEmitter.init=function(){this.domain=null,EventEmitter.usingDomains&&domain.active&&domain.Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||undefined},EventEmitter.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(e){var t,r,n,i,o,s,a,c="error"===e;if(s=this._events)c=c&&null==s.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=s[e]))return!1;var f="function"==typeof r;switch(n=arguments.length){case 1:emitNone(r,f,this);break;case 2:emitOne(r,f,this,arguments[1]);break;case 3:emitTwo(r,f,this,arguments[1],arguments[2]);break;case 4:emitThree(r,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];emitMany(r,f,this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)},EventEmitter.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.removeListener=function(e,t){var r,n,i,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new EventHandlers:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;if(1===r.length){if(r[0]=undefined,0==--this._eventsCount)return this._events=new EventHandlers,this;delete n[e]}else spliceOne(r,i);n.removeListener&&this.emit("removeListener",e,s||t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new EventHandlers:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},EventEmitter.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:unwrapListeners(t):[]},EventEmitter.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function wrapPeerConnectionEvent(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}var utils={extractVersion:extractVersion,wrapPeerConnectionEvent:wrapPeerConnectionEvent,disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(logDisabled_=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(deprecationWarnings_=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(logDisabled_)return;"undefined"!=typeof console&&console.log}},deprecated:function(e,t){},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r},wrapPeerConnectionCtor:function(t){var r=t.RTCPeerConnection;if(r){var n=function(t,r){try{new t(r)}catch(e){return!1}return!0},i={iceServers:[{urls:"stun:stun.iallex.com"}]};if(!n(r,i)){var o=function(e,t){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls")){var s=o.urls;s="string"==typeof s?[s]:s;for(var a=0;a<s.length;a++){var c={url:s[a]};0===s[a].indexOf("turn")&&(c.username=o.username,c.credential=o.credential),n.push(c)}}else n.push(e.iceServers[i])}e.iceServers=n}return new r(e,t)};n(o,i)&&((o.prototype=r.prototype).constructor=o,t.RTCPeerConnection=o)}return t.RTCPeerConnection}}},logging=utils.log,getusermedia=function(e){var t=utils.detectBrowser(e),r=e&&e.navigator,n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==typeof e[r]?e[r]:{ideal:e[r]};n.exact!==undefined&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(n.ideal!==undefined){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),(o={})[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}n.exact!==undefined&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){n[e]!==undefined&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var a,c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?a=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(a=["front"]),a)return r.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return a.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==a.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),logging("chrome: "+JSON.stringify(e)),i(e)});e.video=n(e.video)}return logging("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){i(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(o(e))})})};var s=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:s,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return i(e,function(e){return a(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(o(e))})})}}else r.mediaDevices.getUserMedia=function(e){return s(e)};"undefined"==typeof r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){logging("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){logging("Dummy mediaDevices.removeEventListener called.")})},logging$1=utils.log;function walkStats(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?walkStats(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){walkStats(e,e.get(t),r)})}))}function filterStats(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&walkStats(e,r,i)})}),i}var chrome_shim={shimGetUserMedia:getusermedia,shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)utils.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return this._dtmf===undefined&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],i.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),utils.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return filterStats(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,o=arguments[0];return this.getSenders().forEach(function(e){e.track===o&&(t?n=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===o&&(r?n=!0:r=e),e.track===o}),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return this.src="",undefined;this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var t=utils.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());r._streams[t.id]=i,r._reverseStreams[i.id]=t,t=i}n.apply(r,[t])};var i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},i.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var o=n._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);n._streams[r.id]=s,n._reverseStreams[s.id]=r,n.addStream(s)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var n=o(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,[e])},arguments[2]]):r.apply(e,arguments).then(function(t){return o(e,t)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===r))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");r._streams=r._streams||{},Object.keys(r._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?r.removeStream(r._reverseStreams[t.id]):t.removeTrack(e.track),r.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=utils.detectBrowser(e);!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,r){return logging$1("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}}));var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var s=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return r.apply(this,[function(e){o[1](a(s(e)))},arguments[0]])}return new Promise(function(e,t){r.apply(i,[function(t){e(a(s(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:undefined;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(e){utils.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||"function"==typeof t&&(navigator.getDisplayMedia=function(e){return t(e).then(function(t){var r=e.video&&e.video.width,n=e.video&&e.video.height,i=e.video&&e.video.frameRate;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},r&&(e.video.mandatory.maxWidth=r),n&&(e.video.mandatory.maxHeight=n),navigator.mediaDevices.getUserMedia(e)})})}},filtericeservers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&utils.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?n[0]:n,!!n.length}})},sdp=createCommonjsModule(function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},t.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},t.getDescription=function(e){var r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){var r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter(function(e){return 0===e.indexOf(r)})},t.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){var t=e.payloadType;e.preferredPayloadType!==undefined&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){var t="",r=e.payloadType;if(e.preferredPayloadType!==undefined&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",r=e.payloadType;return e.preferredPayloadType!==undefined&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},t.getMid=function(e){var r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:undefined,mkiLength:t[2]?t[2].split(":")[1]:undefined}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){var n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],i=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],s=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=t.parseRtpMap(s),c=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?t.parseFmtp(c[0]):{},a.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),r.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(a.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach(function(e){r.headerExtensions.push(t.parseExtmap(e))}),r},t.writeRtpDescription=function(e,r){var n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map(function(e){return e.preferredPayloadType!==undefined?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach(function(e){n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)});var i=0;return r.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",r.headerExtensions&&r.headerExtensions.forEach(function(e){n+=t.writeExtmap(e)}),n},t.parseRtpEncodingParameters=function(e){var r,n=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(r=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),n.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&c&&n.push({ssrc:c});var f=t.matchPrefix(e,"b=");return f.length&&(f=0===f[0].indexOf("b=TIAS:")?parseInt(f[0].substr(7),10):0===f[0].indexOf("b=AS:")?1e3*parseInt(f[0].substr(5),10)*.95-16e3:undefined,n.forEach(function(e){e.maxBitrate=f})),n},t.parseRtcpParameters=function(e){var r={},n=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=0===i.length;var o=t.matchPrefix(e,"a=rtcp-mux");return r.mux=o.length>0,r},t.parseMsid=function(e){var r,n=t.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(r=n[0].substr(7).split(" "))[0],track:r[1]};var i=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(r=i[0].value.split(" "))[0],track:r[1]}:void 0},t.parseSctpDescription=function(e){var r,n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};if(t.matchPrefix(e,"a=sctpmap:").length>0){var s=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],t.maxMessageSize!==undefined&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,n){var i=r!==undefined?r:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,r,n,i){var o=t.writeRtpDescription(e.kind,r);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),o},t.getDirection=function(e,r){for(var n=t.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var r=t.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){var r=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var r=t.splitLines(e),n=0;n<r.length;n++)if(r[n].length<2||"="!==r[n].charAt(1))return!1;return!0},e.exports=t});function fixStatsType(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function writeMediaSection(e,t,r,n,i){var o=sdp.writeRtpDescription(e.kind,t);if(o+=sdp.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=sdp.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var a="msid:"+(n?n.id:"-")+" "+s+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+sdp.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+sdp.localCName+"\r\n"),o}function filterIceServers(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&e.urls;var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}function getCommonCapabilities(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),s=n(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!i(n,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(n.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function isActionAllowedInSignalingState(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function maybeAddCandidate(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function makeError(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:undefined,OperationError:undefined}[e],r}var rtcpeerconnection=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function n(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var i=function(r){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw makeError("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=filterIceServers(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var o=r.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=sdp.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=undefined,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},i.prototype.addTrack=function(t,r){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw makeError("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},i.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},i.prototype.removeTrack=function(t){if(this._isClosed)throw makeError("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw makeError("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},i.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,a=!s||0===Object.keys(s).length;if(a)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),s.component=1,s.ufrag=i.getLocalParameters().usernameFragment;var c=sdp.writeCandidate(s);o.candidate=Object.assign(o.candidate,sdp.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=sdp.getMediaSections(n._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=a?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",n._localDescription.sdp=sdp.getDescription(n._localDescription.sdp)+u.join("");var f=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),a||n._dispatchEvent("icecandidate",o),f&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,r,n){var i=getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:sdp.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t,r,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+e.type+'"'));if(!isActionAllowedInSignalingState("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=sdp.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=sdp.parseRtpParameters(e);n.transceivers[t].localCapabilities=r}),n.transceivers.forEach(function(e,t){n._gather(e.mid,t)});else if("answer"===e.type){t=sdp.splitSections(n._remoteDescription.sdp),r=t.shift();var i=sdp.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var o=n.transceivers[t],s=o.iceGatherer,a=o.iceTransport,c=o.dtlsTransport,u=o.localCapabilities,f=o.remoteCapabilities;if(!(sdp.isRejected(e)&&0===sdp.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var d=sdp.getIceParameters(e,r),h=sdp.getDtlsParameters(e,r);i&&(h.role="server"),n.usingBundle&&0!==t||(n._gather(o.mid,t),"new"===a.state&&a.start(s,d,i?"controlling":"controlled"),"new"===c.state&&c.start(h));var l=getCommonCapabilities(u,f);n._transceive(o,l.codecs.length>0,!1)}})}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(makeError("TypeError",'Unsupported type "'+i.type+'"'));if(!isActionAllowedInSignalingState("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(makeError("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var s={};o.remoteStreams.forEach(function(e){s[e.id]=e});var a=[],c=sdp.splitSections(i.sdp),u=c.shift(),f=sdp.matchPrefix(u,"a=ice-lite").length>0,d=sdp.matchPrefix(u,"a=group:BUNDLE ").length>0;o.usingBundle=d;var h=sdp.matchPrefix(u,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!h&&h.substr(14).split(" ").indexOf("trickle")>=0,c.forEach(function(n,c){var h=sdp.splitLines(n),l=sdp.getKind(n),p=sdp.isRejected(n)&&0===sdp.matchPrefix(n,"a=bundle-only").length,m=h[0].substr(2).split(" ")[2],g=sdp.getDirection(n,u),v=sdp.parseMsid(n),y=sdp.getMid(n)||sdp.generateIdentifier();if(p||"application"===l&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))o.transceivers[c]={mid:y,kind:l,protocol:m,rejected:!0};else{var _,b,w,E,S,C,T,R,k;!p&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(l,!0));var P,A,x=sdp.parseRtpParameters(n);p||(P=sdp.getIceParameters(n,u),(A=sdp.getDtlsParameters(n,u)).role="client"),T=sdp.parseRtpEncodingParameters(n);var I=sdp.parseRtcpParameters(n),L=sdp.matchPrefix(n,"a=end-of-candidates",u).length>0,O=sdp.matchPrefix(n,"a=candidate:").map(function(e){return sdp.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!p&&d&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||p){if("answer"===i.type&&!p){b=(_=o.transceivers[c]).iceGatherer,w=_.iceTransport,E=_.dtlsTransport,S=_.rtpReceiver,C=_.sendEncodingParameters,R=_.localCapabilities,o.transceivers[c].recvEncodingParameters=T,o.transceivers[c].remoteCapabilities=x,o.transceivers[c].rtcpParameters=I,O.length&&"new"===w.state&&(!f&&!L||d&&0!==c?O.forEach(function(e){maybeAddCandidate(_.iceTransport,e)}):w.setRemoteCandidates(O)),d&&0!==c||("new"===w.state&&w.start(b,P,"controlling"),"new"===E.state&&E.start(A)),!getCommonCapabilities(_.localCapabilities,_.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,o._transceive(_,"sendrecv"===g||"recvonly"===g,"sendrecv"===g||"sendonly"===g),!S||"sendrecv"!==g&&"sendonly"!==g?delete _.rtpReceiver:(k=S.track,v?(s[v.stream]||(s[v.stream]=new e.MediaStream),r(k,s[v.stream]),a.push([k,S,s[v.stream]])):(s["default"]||(s["default"]=new e.MediaStream),r(k,s["default"]),a.push([k,S,s["default"]])))}}else{(_=o.transceivers[c]||o._createTransceiver(l)).mid=y,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(c,d)),O.length&&"new"===_.iceTransport.state&&(!L||d&&0!==c?O.forEach(function(e){maybeAddCandidate(_.iceTransport,e)}):_.iceTransport.setRemoteCandidates(O)),R=e.RTCRtpReceiver.getCapabilities(l),t<15019&&(R.codecs=R.codecs.filter(function(e){return"rtx"!==e.name})),C=_.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var B,$=!1;if("sendrecv"===g||"sendonly"===g){if($=!_.rtpReceiver,S=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,l),$)k=S.track,v&&"-"===v.stream||(v?(s[v.stream]||(s[v.stream]=new e.MediaStream,Object.defineProperty(s[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(k,"id",{get:function(){return v.track}}),B=s[v.stream]):(s["default"]||(s["default"]=new e.MediaStream),B=s["default"])),B&&(r(k,B),_.associatedRemoteMediaStreams.push(B)),a.push([k,S,B])}else _.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(t){var r,n,i=t.getTracks().find(function(e){return e.id===_.rtpReceiver.track.id});i&&(r=i,(n=t).removeTrack(r),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:r})))}),_.associatedRemoteMediaStreams=[]);_.localCapabilities=R,_.remoteCapabilities=x,_.rtpReceiver=S,_.rtcpParameters=I,_.sendEncodingParameters=C,_.recvEncodingParameters=T,o._transceive(o.transceivers[c],!1,$)}}}),o._dtlsRole===undefined&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(s).forEach(function(t){var r=s[t];if(r.getTracks().length){if(-1===o.remoteStreams.indexOf(r)){o.remoteStreams.push(r);var i=new Event("addstream");i.stream=r,e.setTimeout(function(){o._dispatchEvent("addstream",i)})}a.forEach(function(e){var t=e[0],i=e[1];r.id===e[2].id&&n(o,t,i,[r])})}}),a.forEach(function(e){e[2]||n(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&e.iceTransport.addRemoteCandidate({})})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},i.prototype._updateIceConnectionState=function(){var e,t={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t["new"]>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},i.prototype._updateConnectionState=function(){var e,t={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t["new"]>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},i.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter(function(e){return"audio"===e.kind}).length,i=r.transceivers.filter(function(e){return"video"===e.kind}).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");o.offerToReceiveAudio!==undefined&&(n=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),o.offerToReceiveVideo!==undefined&&(i=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)});n>0||i>0;)n>0&&(r._createTransceiver("audio"),n--),i>0&&(r._createTransceiver("video"),i--);var s=sdp.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(n,i){var o=n.track,s=n.kind,a=n.mid||sdp.generateIdentifier();n.mid=a,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(s);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&e.parameters["level-asymmetry-allowed"]===undefined&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var u=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=c,n.sendEncodingParameters=u}),"max-compat"!==r._config.bundlePolicy&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){s+=writeMediaSection(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+sdp.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var a=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(a)},i.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(makeError("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=sdp.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var i=sdp.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,o){if(!(o+1>i)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?n+="m=application 0 DTLS/SCTP 5000\r\n":n+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var s;if(e.stream)"audio"===e.kind?s=e.stream.getAudioTracks()[0]:"video"===e.kind&&(s=e.stream.getVideoTracks()[0]),s&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var a=getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);!a.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=writeMediaSection(e,a,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}});var o=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(o)},i.prototype.addIceCandidate=function(e){var t,r=this;return e&&e.sdpMLineIndex===undefined&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(n,i){if(!r._remoteDescription)return i(makeError("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<r.transceivers.length;s++)if(r.transceivers[s].mid===e.sdpMid){o=s;break}var a=r.transceivers[o];if(!a)return i(makeError("OperationError","Can not add ICE candidate"));if(a.rejected)return n();var c=Object.keys(e.candidate).length>0?sdp.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return n();if(c.component&&1!==c.component)return n();if((0===o||o>0&&a.iceTransport!==r.transceivers[0].iceTransport)&&!maybeAddCandidate(a.iceTransport,c))return i(makeError("OperationError","Can not add ICE candidate"));var u=e.candidate.trim();0===u.indexOf("a=")&&(u=u.substr(2)),(t=sdp.getMediaSections(r._remoteDescription.sdp))[o]+="a="+(c.type?u:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=sdp.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var f=0;f<r.transceivers.length&&(r.transceivers[f].rejected||(r.transceivers[f].iceTransport.addRemoteCandidate({}),(t=sdp.getMediaSections(r._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=sdp.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));f++);n()})},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw makeError("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=fixStatsType(e[r]),t.set(r,e[r])}),t})}}});var o=["createOffer","createAnswer"];return o.forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),i},getusermedia$1=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e)["catch"](function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}},edge_shim={shimGetUserMedia:getusermedia$1,shimPeerConnection:function(e){var t=utils.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=rtcpeerconnection(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=filtericeservers(e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}},logging$2=utils.log,getusermedia$2=function(e){var t=utils.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack,i=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,n,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(n.min===undefined&&n.max===undefined&&n.exact===undefined||t.push(r),n.exact!==undefined&&("number"==typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),n.ideal!==undefined){e.advanced=e.advanced||[];var i={};"number"==typeof n.ideal?i[r]={min:n.ideal,max:n.ideal}:i[r]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(logging$2("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),logging$2("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){o(i(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,r){o(e,t,r)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var s=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return s().then(undefined,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return a(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(i(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var c=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),c(e.audio,"autoGainControl","mozAutoGainControl"),c(e.audio,"noiseSuppression","mozNoiseSuppression")),u(e)},n&&n.prototype.getSettings){var f=n.prototype.getSettings;n.prototype.getSettings=function(){var e=f.apply(this,arguments);return c(e,"mozAutoGainControl","autoGainControl"),c(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var d=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),c(e,"autoGainControl","mozAutoGainControl"),c(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}r.getUserMedia=function(e,n,i){if(t.version<44)return o(e,n,i);utils.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(n,i)}},firefox_shim={shimGetUserMedia:getusermedia$2,shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(t){var r=utils.detectBrowser(t);if("object"==typeof t&&(t.RTCPeerConnection||t.mozRTCPeerConnection)){t.RTCPeerConnection||(t.RTCPeerConnection=t.mozRTCPeerConnection,t.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return t.mozRTCPeerConnection.generateCertificate}}),t.RTCSessionDescription=t.mozRTCSessionDescription,t.RTCIceCandidate=t.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var r=t.RTCPeerConnection.prototype[e];t.RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var n=t.RTCPeerConnection.prototype.addIceCandidate;t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(t,n,s){return o.apply(this,[t||null]).then(function(t){if(r.version<48&&(t=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t}(t)),r.version<53&&!n)try{t.forEach(function(e){e.type=i[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;t.forEach(function(e,r){t.set(r,Object.assign({},e,{type:i[e.type]||e.type}))})}return t}).then(n,s)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r}),utils.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;utils.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(!e||!e.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===e.video?e.video={mediaSource:t}:e.video.mediaSource=t,navigator.mediaDevices.getUserMedia(e)})}},safari_shim={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var a=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=a}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(utils.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){"undefined"!=typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio"),"undefined"!=typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||r.addTransceiver("video")}return t.apply(r,arguments)}}},common_shim={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),n=sdp.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,utils.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if(!("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL))return undefined;var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),i=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;return i.set(t,e),utils.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),i["delete"](e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var a=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),a.apply(this,arguments)}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=utils.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"==typeof this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,n,i,o;if(this._sctp=null,i=arguments[0],(o=sdp.splitSections(i.sdp)).shift(),o.some(function(e){var t=sdp.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var s,a=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),c=(e=a,n=65536,"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n),u=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=sdp.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],a);s=0===c&&0===u?Number.POSITIVE_INFINITY:0===c||0===u?Math.max(c,u):Math.min(c,u);var f={};Object.defineProperty(f,"maxMessageSize",{get:function(){return s}}),this._sctp=f}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},utils.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}},adapter_factory=function(e,t){var r=e&&e.window,n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var i in t)hasOwnProperty.call(t,i)&&(n[i]=t[i]);var o=utils.log,s=utils.detectBrowser(r),a=chrome_shim||null,c=edge_shim||null,u=firefox_shim||null,f=safari_shim||null,d=common_shim||null,h={browserDetails:s,commonShim:d,extractVersion:utils.extractVersion,disableLog:utils.disableLog,disableWarnings:utils.disableWarnings};switch(s.browser){case"chrome":if(!a||!a.shimPeerConnection||!n.shimChrome)return o("Chrome shim is not included in this adapter release."),h;o("adapter.js shimming chrome."),h.browserShim=a,d.shimCreateObjectURL(r),a.shimGetUserMedia(r),a.shimMediaStream(r),a.shimSourceObject(r),a.shimPeerConnection(r),a.shimOnTrack(r),a.shimAddTrackRemoveTrack(r),a.shimGetSendersWithDtmf(r),a.shimSenderReceiverGetStats(r),a.fixNegotiationNeeded(r),d.shimRTCIceCandidate(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;case"firefox":if(!u||!u.shimPeerConnection||!n.shimFirefox)return o("Firefox shim is not included in this adapter release."),h;o("adapter.js shimming firefox."),h.browserShim=u,d.shimCreateObjectURL(r),u.shimGetUserMedia(r),u.shimSourceObject(r),u.shimPeerConnection(r),u.shimOnTrack(r),u.shimRemoveStream(r),u.shimSenderGetStats(r),u.shimReceiverGetStats(r),u.shimRTCDataChannel(r),d.shimRTCIceCandidate(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;case"edge":if(!c||!c.shimPeerConnection||!n.shimEdge)return o("MS edge shim is not included in this adapter release."),h;o("adapter.js shimming edge."),h.browserShim=c,d.shimCreateObjectURL(r),c.shimGetUserMedia(r),c.shimPeerConnection(r),c.shimReplaceTrack(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;case"safari":if(!f||!n.shimSafari)return o("Safari shim is not included in this adapter release."),h;o("adapter.js shimming safari."),h.browserShim=f,d.shimCreateObjectURL(r),f.shimRTCIceServerUrls(r),f.shimCreateOfferLegacy(r),f.shimCallbacksAPI(r),f.shimLocalStreamsAPI(r),f.shimRemoteStreamsAPI(r),f.shimTrackEventTransceiver(r),f.shimGetUserMedia(r),d.shimRTCIceCandidate(r),d.shimMaxMessageSize(r),d.shimSendThrowTypeError(r);break;default:o("Unsupported browser!")}return utils.wrapPeerConnectionCtor(r),h},adapter_core=adapter_factory({window:commonjsGlobal.window}),getBrowserRtc=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(t,0);try{return cachedSetTimeout(t,0)}catch(e){try{return cachedSetTimeout.call(null,t,0)}catch(e){return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(t);try{return cachedClearTimeout(t)}catch(e){try{return cachedClearTimeout.call(null,t)}catch(e){return cachedClearTimeout.call(this,t)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance$1=global$1.performance||{},performanceNow=performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance$1),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var process={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},browser$1=!0,s=1e3,m=60*s,h=60*m,d=24*h,w=7*d,y=365.25*d,ms=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return parse(e);if("number"===r&&isFinite(e))return t.long?fmtLong(e):fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*y;case"weeks":case"week":case"w":return r*w;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*h;case"minutes":case"minute":case"mins":case"min":case"m":return r*m;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return undefined}}}}function fmtShort(e){var t=Math.abs(e);return t>=d?Math.round(e/d)+"d":t>=h?Math.round(e/h)+"h":t>=m?Math.round(e/m)+"m":t>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){var t=Math.abs(e);return t>=d?plural(e,t,d,"day"):t>=h?plural(e,t,h,"hour"):t>=m?plural(e,t,m,"minute"):t>=s?plural(e,t,s,"second"):e+" ms"}function plural(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}function setup(e){function t(e){var n,i,o,s=null;function a(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(a.enabled){var o=a,s=Number(new Date),c=s-(n||s);o.diff=c,o.prev=n,o.curr=s,n=s,r[0]=t.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var u=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return"%";u++;var i=t.formatters[n];if("function"==typeof i){var s=r[u];e=i.call(o,s),r.splice(u,1),u--}return e}),t.formatArgs.call(o,r),(o.log||t.log).apply(o,r)}}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o)},set:function(e){s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){var n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t["default"]=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(t.names.map(n),t.skips.map(n).map(function(e){return"-"+e})).join(",");return t.enable(""),e},t.enable=function(e){var r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=ms,t.destroy=function(){},Object.keys(e).forEach(function(r){t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}var common=setup,browser$2=createCommonjsModule(function(e,t){var r;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))}),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(error){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(error){}!e&&void 0!==process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(error){}}(),t.destroy=(r=!1,function(){r||(r=!0)}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=common(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}}),browser_1=browser$2.formatArgs,browser_2=browser$2.save,browser_3=browser$2.load,browser_4=browser$2.useColors,browser_5=browser$2.storage,browser_6=browser$2.destroy,browser_7=browser$2.colors,browser_8=browser$2.log;function isatty(){return!1}function ReadStream(){throw new Error("tty.ReadStream is not implemented")}function WriteStream(){throw new Error("tty.ReadStream is not implemented")}var tty={isatty:isatty,ReadStream:ReadStream,WriteStream:WriteStream},lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)lookup[t]=e[t],revLookup[e.charCodeAt(t)]=t;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(e){var t,r,n,i,o,s;inited||init();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new Arr(3*a/4-o),n=o>0?a-4:a;var c=0;for(t=0,r=0;t<n;t+=4,r+=3)i=revLookup[e.charCodeAt(t)]<<18|revLookup[e.charCodeAt(t+1)]<<12|revLookup[e.charCodeAt(t+2)]<<6|revLookup[e.charCodeAt(t+3)],s[c++]=i>>16&255,s[c++]=i>>8&255,s[c++]=255&i;return 2===o?(i=revLookup[e.charCodeAt(t)]<<2|revLookup[e.charCodeAt(t+1)]>>4,s[c++]=255&i):1===o&&(i=revLookup[e.charCodeAt(t)]<<10|revLookup[e.charCodeAt(t+1)]<<4|revLookup[e.charCodeAt(t+2)]>>2,s[c++]=i>>8&255,s[c++]=255&i),s}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[63&e]}function encodeChunk(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(tripletToBase64(n));return i.join("")}function fromByteArray(e){var t;inited||init();for(var r=e.length,n=r%3,i="",o=[],s=0,a=r-n;s<a;s+=16383)o.push(encodeChunk(e,s,s+16383>a?a:s+16383));return 1===n?(t=e[r-1],i+=lookup[t>>2],i+=lookup[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=lookup[t>>10],i+=lookup[t>>4&63],i+=lookup[t<<2&63],i+="="),o.push(i),o.join("")}function read(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,f=-7,d=r?i-1:0,h=r?-1:1,l=e[t+d];for(d+=h,o=l&(1<<-f)-1,l>>=-f,f+=a;f>0;o=256*o+e[t+d],d+=h,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=n;f>0;s=256*s+e[t+d],d+=h,f-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:(l?-1:1)*Infinity;s+=Math.pow(2,n),o-=u}return(l?-1:1)*s*Math.pow(2,o-n)}function write(e,t,r,n,i,o){var s,a,c,u=8*o-i-1,f=(1<<u)-1,d=f>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===Infinity?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=f?(a=0,s=f):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+l]=255&a,l+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+l]=255&s,l+=p,s/=256,u-=8);e[r+l-p]|=128*m}var toString$1={}.toString,isArray=Array.isArray||function(e){return"[object Array]"==toString$1.call(e)},INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global$1.TYPED_ARRAY_SUPPORT===undefined||global$1.TYPED_ARRAY_SUPPORT;var _kMaxLength=kMaxLength();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(e,t){if(kMaxLength()<t)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Buffer.prototype:(null===e&&(e=new Buffer(t)),e.length=t),e}function Buffer(e,t,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,e)}return from(this,e,t,r)}function from(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?fromArrayBuffer(e,t,r,n):"string"==typeof t?fromString(e,t,r):fromObject(e,t)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function alloc(e,t,r,n){return assertSize(t),t<=0?createBuffer(e,t):r!==undefined?"string"==typeof n?createBuffer(e,t).fill(r,n):createBuffer(e,t).fill(r):createBuffer(e,t)}function allocUnsafe(e,t){if(assertSize(t),e=createBuffer(e,t<0?0:0|checked(t)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function fromString(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(t,r),i=(e=createBuffer(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}function fromArrayLike(e,t){var r=t.length<0?0:0|checked(t.length);e=createBuffer(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function fromArrayBuffer(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=r===undefined&&n===undefined?new Uint8Array(t):n===undefined?new Uint8Array(t,r):new Uint8Array(t,r,n),Buffer.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Buffer.prototype:e=fromArrayLike(e,t),e}function fromObject(e,t){if(internalIsBuffer(t)){var r=0|checked(t.length);return 0===(e=createBuffer(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||isnan(t.length)?createBuffer(e,0):fromArrayLike(e,t);if("Buffer"===t.type&&isArray(t.data))return fromArrayLike(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(e){if(e>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|e}function SlowBuffer(e){return+e!=e&&(e=0),Buffer.alloc(+e)}function internalIsBuffer(e){return!(null==e||!e._isBuffer)}function byteLength(e,t){if(internalIsBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case undefined:return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(n)return utf8ToBytes(e).length;t=(""+t).toLowerCase(),n=!0}}function slowToString(e,t,r){var n=!1;if((t===undefined||t<0)&&(t=0),t>this.length)return"";if((r===undefined||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),internalIsBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,i);if("number"==typeof t)return t&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(n!==undefined&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var f=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===c)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var d=!0,h=0;h<c;h++)if(u(e,o+h)!==u(t,h)){d=!1;break}if(d)return o}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(asciiToBytes(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(utf16leToBytes(t,e.length-r),e,r,n)}function base64Slice(e,t,r){return 0===t&&r===e.length?fromByteArray(e):fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,u=e[i],f=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=r)switch(d){case 1:u<128&&(f=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(f=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(f=c)}null===f?(f=65533,d=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),i+=d}return decodeCodePointsArray(n)}Buffer.poolSize=8192,Buffer._augment=function(e){return e.__proto__=Buffer.prototype,e},Buffer.from=function(e,t,r){return from(null,e,t,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array),Buffer.alloc=function(e,t,r){return alloc(null,e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(null,e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(null,e)},Buffer.isBuffer=isBuffer,Buffer.compare=function(e,t){if(!internalIsBuffer(e)||!internalIsBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(t===undefined)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!internalIsBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(e){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",t=INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,t,r,n,i){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");if(t===undefined&&(t=0),r===undefined&&(r=e?e.length:0),n===undefined&&(n=0),i===undefined&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(n,i),u=e.slice(t,r),f=0;f<a;++f)if(c[f]!==u[f]){o=c[f],s=u[f];break}return o<s?-1:s<o?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,n){if(t===undefined)n="utf8",r=this.length,t=0;else if(r===undefined&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,n===undefined&&(n="utf8")):(n=r,r=undefined)}var i=this.length-t;if((r===undefined||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=toHex(e[o]);return i}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,i,o){if(!internalIsBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function objectWriteUInt16(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function checkIEEE754(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,n,i){return i||checkIEEE754(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,i){return i||checkIEEE754(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),write(e,t,r,n,52,8),r+8}Buffer.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=t===undefined?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),Buffer.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Buffer.prototype;else{var i=t-e;r=new Buffer(i,undefined);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},Buffer.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},Buffer.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Buffer.prototype.readUInt8=function(e,t){return t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,t){return t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},Buffer.prototype.readInt8=function(e,t){return t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(e,t){return t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},Buffer.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},Buffer.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(n!==undefined&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=r===undefined?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=internalIsBuffer(e)?e:utf8ToBytes(new Buffer(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(e){if((e=stringtrim(e).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function stringtrim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||Infinity;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}function base64ToBytes(e){return toByteArray(base64clean(e))}function blitBuffer(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function isnan(e){return e!=e}function isBuffer(e){return null!=e&&(!!e._isBuffer||isFastBuffer(e)||isSlowBuffer(e))}function isFastBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isFastBuffer(e.slice(0,0))}var bufferEs6=Object.freeze({INSPECT_MAX_BYTES:INSPECT_MAX_BYTES,kMaxLength:_kMaxLength,Buffer:Buffer,SlowBuffer:SlowBuffer,isBuffer:isBuffer}),inherits;inherits="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};var inherits$1=inherits,formatRegExp=/%[sdj%]/g;function format(e){if(!isString(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(inspect(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(_){return"[Circular]"}default:return e}}),s=n[r];r<i;s=n[++r])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o}function deprecate(e,t){if(isUndefined(global$1.process))return function(){return deprecate(e,t).apply(this,arguments)};var r=!1;return function(){return r||(r=!0),e.apply(this,arguments)}}var debugs={},debugEnviron;function debuglog(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){debugs[e]=function(){format.apply(null,arguments)}}else debugs[e]=function(){};return debugs[e]}function inspect(e,t){var r={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),isBoolean(t)?r.showHidden=t:t&&_extend(r,t),isUndefined(r.showHidden)&&(r.showHidden=!1),isUndefined(r.depth)&&(r.depth=2),isUndefined(r.colors)&&(r.colors=!1),isUndefined(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=stylizeWithColor),formatValue(r,e,r.depth)}function stylizeWithColor(e,t){var r=inspect.styles[t];return r?"["+inspect.colors[r][0]+"m"+e+"["+inspect.colors[r][1]+"m":e}function stylizeNoColor(e,t){return e}function arrayToHash(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function formatValue(e,t,r){if(e.customInspect&&t&&isFunction(t.inspect)&&t.inspect!==inspect&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return isString(n)||(n=formatValue(e,n,r)),n}var i=formatPrimitive(e,t);if(i)return i;var o=Object.keys(t),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),isError(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(t);if(0===o.length){if(isFunction(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(isError(t))return formatError(t)}var c,u="",f=!1,d=["{","}"];(isArray$1(t)&&(f=!0,d=["[","]"]),isFunction(t))&&(u=" [Function"+(t.name?": "+t.name:"")+"]");return isRegExp(t)&&(u=" "+RegExp.prototype.toString.call(t)),isDate(t)&&(u=" "+Date.prototype.toUTCString.call(t)),isError(t)&&(u=" "+formatError(t)),0!==o.length||f&&0!=t.length?r<0?isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=f?formatArray(e,t,r,s,o):o.map(function(n){return formatProperty(e,t,r,s,n,f)}),e.seen.pop(),reduceToSingleString(c,u,d)):d[0]+u+d[1]}function formatPrimitive(e,t){if(isUndefined(t))return e.stylize("undefined","undefined");if(isString(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return isNumber(t)?e.stylize(""+t,"number"):isBoolean(t)?e.stylize(""+t,"boolean"):isNull(t)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)hasOwnProperty$1(t,String(s))?o.push(formatProperty(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,t,r,n,i,!0))}),o}function formatProperty(e,t,r,n,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),hasOwnProperty$1(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=isNull(r)?formatValue(e,c.value,null):formatValue(e,c.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function reduceToSingleString(e,t,r){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function isArray$1(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function isBuffer$1(e){return isBuffer(e)}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var e=new Date,t=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],t].join(" ")}function log(){}function _extend(e,t){if(!t||!isObject(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function hasOwnProperty$1(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var util={inherits:inherits$1,_extend:_extend,log:log,isBuffer:isBuffer$1,isPrimitive:isPrimitive,isFunction:isFunction,isError:isError,isDate:isDate,isObject:isObject,isRegExp:isRegExp,isUndefined:isUndefined,isSymbol:isSymbol,isString:isString,isNumber:isNumber,isNullOrUndefined:isNullOrUndefined,isNull:isNull,isBoolean:isBoolean,isArray:isArray$1,inspect:inspect,deprecate:deprecate,format:format,debuglog:debuglog},browser$3={stdout:!1,stderr:!1},node=createCommonjsModule(function(e,t){t.init=function(e){e.inspectOpts={};for(var r=Object.keys(t.inspectOpts),n=0;n<r.length;n++)e.inspectOpts[r[n]]=t.inspectOpts[r[n]]},t.log=function(){return process.stderr.write(util.format.apply(util,arguments)+"\n")},t.formatArgs=function(r){var n=this.namespace;if(this.useColors){var i=this.color,o="[3"+(i<8?i:"8;5;"+i),s="  "+o+";1m"+n+" [0m";r[0]=s+r[0].split("\n").join("\n"+s),r.push(o+"m+"+e.exports.humanize(this.diff)+"[0m")}else r[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+n+" "+r[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):tty.isatty(process.stderr.fd)},t.destroy=util.deprecate(function(){},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{var r=browser$3;r&&(r.stderr||r).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(error){}t.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()}),n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[r]=n,e},{}),e.exports=common(t);var n=e.exports.formatters;n.o=function(e){return this.inspectOpts.colors=this.useColors,util.inspect(e,this.inspectOpts).split("\n").map(function(e){return e.trim()}).join(" ")},n.O=function(e){return this.inspectOpts.colors=this.useColors,util.inspect(e,this.inspectOpts)}}),node_1=node.init,node_2=node.log,node_3=node.formatArgs,node_4=node.save,node_5=node.load,node_6=node.useColors,node_7=node.destroy,node_8=node.colors,node_9=node.inspectOpts,src=createCommonjsModule(function(e){void 0===process||"renderer"===process.type||!0===browser$1||process.__nwjs?e.exports=browser$2:e.exports=node}),isUndefined$1=function(e){return e===undefined||null===e},CompositeKeyWeakMap=function(){function e(){this._weakMap=new WeakMap}var t=e.prototype;return t.set=function(e,t){for(var r=this._weakMap,n=0,i=e.length-1;n<i;n++){var o=e[n],s=r.get(o);s||(s=new Map,r.set(o,s)),r=s}r.set(e[e.length-1],t)},t.get=function(e){for(var t=this._weakMap,r=0,n=e.length;r<n&&(t=t.get(e[r]),!isUndefined$1(t));r++);return t},t.has=function(e){return!isUndefined$1(this.get(e))},t["delete"]=function(e){for(var t,r,n=this._weakMap,i=[n],o=0,s=e.length-1;o<s;o++){var a=n.get(e[o]);if(!a)return;i.push(a),n=a}for(;r=i.pop(),(t=e.pop())&&r&&(r["delete"](t),!r.size););},e}(),HEX_CHARS="0123456789abcdef".split(""),safeAdd=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},ROTL=function(e,t){return e<<t|e>>>32-t},ensureBuffer=function(e){return"string"!=typeof e?(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))&&(e=fromArrayBuffer$1(e)):e=str2utf8b(e),e};function fromArrayBuffer$1(e){return new Uint8Array(e)}function str2utf8b(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=t.split(""),i=n.length;i--;)r[i]=n[i].charCodeAt(0);return r}function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var crc32b=function(){for(var e=new Uint32Array(256),t=256;t--;){for(var r=t,n=8;n--;)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return function(t){var r=-1;"string"==typeof t&&(t=function(e){for(var t=e.length,r=new Array(t),n=-1;++n<t;)r[n]=e.charCodeAt(n);return r}(t));for(var n=0,i=t.length;n<i;n++)r=r>>>8^e[255&r^t[n]];return(-1^r)>>>0}}(),e=Array.isArray||function(e){return"[object Array]"===toString.call(e)},o=void 0,u=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null","Object"].reduce(function(e,t,r){return e["[object "+t+"]"]=t.toLowerCase(),e},{});function c(e){return"string"==typeof e}function s$1(e){return"function"==typeof e}function l(e){return null!==e&&"object"==typeof e}function y$1(e,t){return e===o||null===e&&!t}
/*! *****************************************************************************
 Copyright (c) Microsoft Corporation. All rights reserved.
 Licensed under the Apache License, Version 2.0 (the "License"); you may not use
 this file except in compliance with the License. You may obtain a copy of the
 License at http://www.apache.org/licenses/LICENSE-2.0
 THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
 WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
 MERCHANTABLITY OR NON-INFRINGEMENT.
 See the Apache Version 2.0 License for specific language governing permissions
 and limitations under the License.
 ***************************************************************************** */var d$1=function(e,t){return(d$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function _(e,t){function r(){this.constructor=e}d$1(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}_(t,e);var r=t.prototype;return r.on=function(t,r){return e.prototype.on.call(this,t,r)},r.off=function(t,r){return e.prototype.off.call(this,t,r)},r.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.prototype.emit.apply(this,[t].concat(r))},t}(EventEmitter),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._q=new Map,t}_(t,e);var r=t.prototype;return Object.defineProperty(r,"size",{get:function(){return this._q.size},enumerable:!0,configurable:!0}),r.set=function(e,t){this._q.set(e,t),this.emit("queue/set",e,t)},r.get=function(e){return this._q.get(e)},r.keys=function(){return Array.from(this._q.keys())},r.values=function(){return Array.from(this._q.values())},r["delete"]=function(e){return this._q["delete"](e)},r.forEach=function(e){this._q.forEach(e)},r.clear=function(){this._q.clear()},r.has=function(e){return this._q.has(e)},r.isEmpty=function(){return 0===this._q.size},t}(b),j=function(){},A=function(){var e={},t=new Promise(function(t,r){e.f=t,e.r=r});return t.resolve=e.f,t.reject=e.r,t.destroy=function(){t.destroy=j,e=t.resolve=t.reject=e.f=e.r=null},t},E=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t,i=function(t,r,i){var o=function(e,t,r){return i||Object.getOwnPropertyDescriptor(e,t)||{}}(t,r),s=o.value;return o.value=e.apply(void 0,[s].concat(n)),o};return function(e){return e.length>=2&&l(e[0])&&c(e[1])&&s$1(e[0].constructor)&&e[0].constructor.prototype===e[0]}(t)?(n=[],i(t[0],t[1],t[2])):i}},k=window.setTimeout,P=window.clearTimeout,D=function(e,t){return t.reduce(function(t,r){return t[r]=e[r],t},{})},F=function(e){return 0===e.indexOf("http://")||0===e.indexOf("https://")},N=function(){return performance.now()},S=window.setImmediate||nextTick;
/**
 * Queue implements based on Map, supports collection and map features.
 *
 * @author Allex Wang (allex.wxn@gmail.com) <http://fedor.io/>
 * MIT Licensed
 */function C(e,t,r,n){var i;return void 0===t&&(t=0),function(){var o=n||this,s=arguments,a=r&&!i;P(i),i=k(function(){i=0,r||e.apply(o,s)},t),a&&e.apply(o,s)}}function M(e,t,r,n){var i=n||function(){var t=[].slice.call(arguments,0);return e.emit.apply(e,t)};r.forEach(function(r){return t.on(r,i.bind(e,r))})}function B(e,t){var r=new Error(e);return y$1(t)||(r.code=t),r}var createClass=createCommonjsModule(function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e},e.exports["default"]=e.exports,e.exports.__esModule=!0}),_createClass=unwrapExports(createClass),runtime_1=createCommonjsModule(function(e){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(I){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),s=new P(n||[]);return o._invoke=function(e,t,r){var n=d;return function(i,o){if(n===l)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw o;return x()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=T(s,r);if(a){if(a===m)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=l;var c=f(e,t,r);if("normal"===c.type){if(n=r.done?p:h,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=p,r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",l="executing",p="completed",m={};function g(){}function v(){}function y(){}var _={};c(_,o,function(){return this});var b=Object.getPrototypeOf,w=b&&b(b(A([])));w&&w!==r&&n.call(w,o)&&(_=w);var E=y.prototype=g.prototype=Object.create(_);function S(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function C(e,t){var r;this._invoke=function(i,o){function s(){return new t(function(r,s){!function a(r,i,o,s){var c=f(e[r],e,i);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then(function(e){a("next",e,o,s)},function(e){a("throw",e,o,s)}):t.resolve(d).then(function(e){u.value=e,o(u)},function(e){return a("throw",e,o,s)})}s(c.arg)}(i,o,r,s)})}return r=r?r.then(s,s):s()}}function T(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator["return"]&&(r.method="return",r.arg=t,T(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=f(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function A(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:x}}function x(){return{value:t,done:!0}}return v.prototype=y,c(E,"constructor",y),c(y,"constructor",v),v.displayName=c(y,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,a,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},S(C.prototype),c(C.prototype,s,function(){return this}),e.AsyncIterator=C,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var s=new C(u(t,r,n,i),o);return e.isGeneratorFunction(r)?s:s.next().then(function(e){return e.done?e.value:s.next()})},S(E),c(E,a,"Generator"),c(E,o,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=A,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=n.call(s,"catchLoc"),u=n.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),m}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(r){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}),regenerator=runtime_1,iterator=function(e){e.prototype[Symbol.iterator]=regenerator.mark(function t(){var e;return regenerator.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=this.head;case 1:if(!e){t.next=7;break}return t.next=4,e.value;case 4:e=e.next,t.next=1;break;case 7:case"end":return t.stop()}},t,this)})},yallist=Yallist;function Yallist(e){var t=this;if(t instanceof Yallist||(t=new Yallist),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)t.push(arguments[r]);return t}function insert(e,t,r){var n=t===e.head?new Node(r,null,t,e):new Node(r,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}function push(e,t){e.tail=new Node(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function unshift(e,t){e.head=new Node(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Node(e,t,r,n){if(!(this instanceof Node))return new Node(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}Yallist.Node=Node,Yallist.create=Yallist,Yallist.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},Yallist.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},Yallist.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},Yallist.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)push(this,arguments[e]);return this.length},Yallist.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)unshift(this,arguments[e]);return this.length},Yallist.prototype.pop=function(){if(!this.tail)return undefined;var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e},Yallist.prototype.shift=function(){if(!this.head)return undefined;var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e},Yallist.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},Yallist.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},Yallist.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},Yallist.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},Yallist.prototype.map=function(e,t){t=t||this;for(var r=new Yallist,n=this.head;null!==n;)r.push(e.call(t,n.value,this)),n=n.next;return r},Yallist.prototype.mapReverse=function(e,t){t=t||this;for(var r=new Yallist,n=this.tail;null!==n;)r.push(e.call(t,n.value,this)),n=n.prev;return r},Yallist.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var i=0;null!==n;i++)r=e(r,n.value,i),n=n.next;return r},Yallist.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var i=this.length-1;null!==n;i--)r=e(r,n.value,i),n=n.prev;return r},Yallist.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},Yallist.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},Yallist.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Yallist;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,i=this.head;null!==i&&n<e;n++)i=i.next;for(;null!==i&&n<t;n++,i=i.next)r.push(i.value);return r},Yallist.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Yallist;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,i=this.tail;null!==i&&n>t;n--)i=i.prev;for(;null!==i&&n>e;n--,i=i.prev)r.push(i.value);return r},Yallist.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,n=this.head;null!==n&&r<e;r++)n=n.next;var i=[];for(r=0;n&&r<t;r++)i.push(n.value),n=this.removeNode(n);null===n&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(r=2;r<arguments.length;r++)n=insert(this,n,arguments[r]);return i},Yallist.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{iterator(Yallist)}catch(er){}var MAX=Symbol("max"),LENGTH=Symbol("length"),LENGTH_CALCULATOR=Symbol("lengthCalculator"),ALLOW_STALE=Symbol("allowStale"),MAX_AGE=Symbol("maxAge"),DISPOSE=Symbol("dispose"),NO_DISPOSE_ON_SET=Symbol("noDisposeOnSet"),LRU_LIST=Symbol("lruList"),CACHE=Symbol("cache"),UPDATE_AGE_ON_GET=Symbol("updateAgeOnGet"),naiveLength=function(){return 1},LRUCache=function(){function e(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[MAX]=e.max||Infinity;var t=e.length||naiveLength;if(this[LENGTH_CALCULATOR]="function"!=typeof t?naiveLength:t,this[ALLOW_STALE]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[MAX_AGE]=e.maxAge||0,this[DISPOSE]=e.dispose,this[NO_DISPOSE_ON_SET]=e.noDisposeOnSet||!1,this[UPDATE_AGE_ON_GET]=e.updateAgeOnGet||!1,this.reset()}var t=e.prototype;return t.rforEach=function(e,t){t=t||this;for(var r=this[LRU_LIST].tail;null!==r;){var n=r.prev;forEachStep(this,e,r,t),r=n}},t.forEach=function(e,t){t=t||this;for(var r=this[LRU_LIST].head;null!==r;){var n=r.next;forEachStep(this,e,r,t),r=n}},t.keys=function(){return this[LRU_LIST].toArray().map(function(e){return e.key})},t.values=function(){return this[LRU_LIST].toArray().map(function(e){return e.value})},t.reset=function(){var e=this;this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length&&this[LRU_LIST].forEach(function(t){return e[DISPOSE](t.key,t.value)}),this[CACHE]=new Map,this[LRU_LIST]=new yallist,this[LENGTH]=0},t.dump=function(){var e=this;return this[LRU_LIST].map(function(t){return!isStale(e,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}}).toArray().filter(function(e){return e})},t.dumpLru=function(){return this[LRU_LIST]},t.set=function(e,t,r){if((r=r||this[MAX_AGE])&&"number"!=typeof r)throw new TypeError("maxAge must be a number");var n=r?Date.now():0,i=this[LENGTH_CALCULATOR](t,e);if(this[CACHE].has(e)){if(i>this[MAX])return _del(this,this[CACHE].get(e)),!1;var o=this[CACHE].get(e).value;return this[DISPOSE]&&(this[NO_DISPOSE_ON_SET]||this[DISPOSE](e,o.value)),o.now=n,o.maxAge=r,o.value=t,this[LENGTH]+=i-o.length,o.length=i,this.get(e),trim(this),!0}var s=new Entry(e,t,i,n,r);return s.length>this[MAX]?(this[DISPOSE]&&this[DISPOSE](e,t),!1):(this[LENGTH]+=s.length,this[LRU_LIST].unshift(s),this[CACHE].set(e,this[LRU_LIST].head),trim(this),!0)},t.has=function(e){if(!this[CACHE].has(e))return!1;var t=this[CACHE].get(e).value;return!isStale(this,t)},t.get=function(e){return _get(this,e,!0)},t.peek=function(e){return _get(this,e,!1)},t.pop=function(){var e=this[LRU_LIST].tail;return e?(_del(this,e),e.value):null},t.del=function(e){_del(this,this[CACHE].get(e))},t.load=function(e){this.reset();for(var t=Date.now(),r=e.length-1;r>=0;r--){var n=e[r],i=n.e||0;if(0===i)this.set(n.k,n.v);else{var o=i-t;o>0&&this.set(n.k,n.v,o)}}},t.prune=function(){var e=this;this[CACHE].forEach(function(t,r){return _get(e,r,!1)})},_createClass(e,[{key:"max",get:function(){return this[MAX]},set:function(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[MAX]=e||Infinity,trim(this)}},{key:"allowStale",get:function(){return this[ALLOW_STALE]},set:function(e){this[ALLOW_STALE]=!!e}},{key:"maxAge",get:function(){return this[MAX_AGE]},set:function(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[MAX_AGE]=e,trim(this)}},{key:"lengthCalculator",get:function(){return this[LENGTH_CALCULATOR]},set:function(e){var t=this;"function"!=typeof e&&(e=naiveLength),e!==this[LENGTH_CALCULATOR]&&(this[LENGTH_CALCULATOR]=e,this[LENGTH]=0,this[LRU_LIST].forEach(function(e){e.length=t[LENGTH_CALCULATOR](e.value,e.key),t[LENGTH]+=e.length})),trim(this)}},{key:"length",get:function(){return this[LENGTH]}},{key:"size",get:function(){return this[LENGTH]}},{key:"itemCount",get:function(){return this[LRU_LIST].length}}]),e}(),_get=function(e,t,r){var n=e[CACHE].get(t);if(n){var i=n.value;if(isStale(e,i)){if(_del(e,n),!e[ALLOW_STALE])return undefined}else r&&(e[UPDATE_AGE_ON_GET]&&(n.value.now=Date.now()),e[LRU_LIST].unshiftNode(n));return i.value}},isStale=function(e,t){if(!t||!t.maxAge&&!e[MAX_AGE])return!1;var r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[MAX_AGE]&&r>e[MAX_AGE]},trim=function(e){if(e[LENGTH]>e[MAX])for(var t=e[LRU_LIST].tail;e[LENGTH]>e[MAX]&&null!==t;){var r=t.prev;_del(e,t),t=r}},_del=function(e,t){if(t){var r=t.value;e[DISPOSE]&&e[DISPOSE](r.key,r.value),e[LENGTH]-=r.length,e[CACHE]["delete"](r.key),e[LRU_LIST].removeNode(t)}},Entry=function(e,t,r,n,i){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=i||0},forEachStep=function(e,t,r,n){var i=r.value;isStale(e,i)&&(_del(e,r),e[ALLOW_STALE]||(i=undefined)),i&&t.call(n,i.value,i.key,e)},__proto__=LRUCache.prototype;[["clear","reset"],["delete","del"]].forEach(function(e){var t=e[0],r=e[1];__proto__[t]=__proto__[r]});var lruCache=LRUCache,parse_1=parse$1,map={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},parseRegExp=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;
/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */function parse$1(e){if("number"==typeof e&&!isNaN(e))return e;if("string"!=typeof e)return null;var t,r=parseRegExp.exec(e),n="b";return r?(t=parseFloat(r[1]),n=r[4].toLowerCase()):(t=parseInt(e,10),n="b"),Math.floor(map[n]*t)}
/*!
 * MD5 implements with pure js. supports string, Buffer, ArrayBuffer, Uint8Array
 *
 * Copyright 2018, Allex Wang (https://iallex.com)
 *
 * Licensed under the MIT license:
 * https://opensource.org/licenses/MIT
 *
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */var byteLength$1=function(e){return e.byteLength?e.byteLength:e.length},promise;function md5cmn(e,t,r,n,i,o){return safeAdd(ROTL(safeAdd(safeAdd(t,e),safeAdd(n,o)),i),r)}function md5ff(e,t,r,n,i,o,s){return md5cmn(t&r|~t&n,e,t,i,o,s)}function md5gg(e,t,r,n,i,o,s){return md5cmn(t&n|r&~n,e,t,i,o,s)}function md5hh(e,t,r,n,i,o,s){return md5cmn(t^r^n,e,t,i,o,s)}function md5ii(e,t,r,n,i,o,s){return md5cmn(r^(t|~n),e,t,i,o,s)}function binlMD5(e,t){var r,n,i,o,s;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var a=1732584193,c=-271733879,u=-1732584194,f=271733878;for(r=0;r<e.length;r+=16)n=a,i=c,o=u,s=f,a=md5ff(a,c,u,f,e[r],7,-680876936),f=md5ff(f,a,c,u,e[r+1],12,-389564586),u=md5ff(u,f,a,c,e[r+2],17,606105819),c=md5ff(c,u,f,a,e[r+3],22,-1044525330),a=md5ff(a,c,u,f,e[r+4],7,-176418897),f=md5ff(f,a,c,u,e[r+5],12,1200080426),u=md5ff(u,f,a,c,e[r+6],17,-1473231341),c=md5ff(c,u,f,a,e[r+7],22,-45705983),a=md5ff(a,c,u,f,e[r+8],7,1770035416),f=md5ff(f,a,c,u,e[r+9],12,-1958414417),u=md5ff(u,f,a,c,e[r+10],17,-42063),c=md5ff(c,u,f,a,e[r+11],22,-1990404162),a=md5ff(a,c,u,f,e[r+12],7,1804603682),f=md5ff(f,a,c,u,e[r+13],12,-40341101),u=md5ff(u,f,a,c,e[r+14],17,-1502002290),a=md5gg(a,c=md5ff(c,u,f,a,e[r+15],22,1236535329),u,f,e[r+1],5,-165796510),f=md5gg(f,a,c,u,e[r+6],9,-1069501632),u=md5gg(u,f,a,c,e[r+11],14,643717713),c=md5gg(c,u,f,a,e[r],20,-373897302),a=md5gg(a,c,u,f,e[r+5],5,-701558691),f=md5gg(f,a,c,u,e[r+10],9,38016083),u=md5gg(u,f,a,c,e[r+15],14,-660478335),c=md5gg(c,u,f,a,e[r+4],20,-405537848),a=md5gg(a,c,u,f,e[r+9],5,568446438),f=md5gg(f,a,c,u,e[r+14],9,-1019803690),u=md5gg(u,f,a,c,e[r+3],14,-187363961),c=md5gg(c,u,f,a,e[r+8],20,1163531501),a=md5gg(a,c,u,f,e[r+13],5,-1444681467),f=md5gg(f,a,c,u,e[r+2],9,-51403784),u=md5gg(u,f,a,c,e[r+7],14,1735328473),a=md5hh(a,c=md5gg(c,u,f,a,e[r+12],20,-1926607734),u,f,e[r+5],4,-378558),f=md5hh(f,a,c,u,e[r+8],11,-2022574463),u=md5hh(u,f,a,c,e[r+11],16,1839030562),c=md5hh(c,u,f,a,e[r+14],23,-35309556),a=md5hh(a,c,u,f,e[r+1],4,-1530992060),f=md5hh(f,a,c,u,e[r+4],11,1272893353),u=md5hh(u,f,a,c,e[r+7],16,-155497632),c=md5hh(c,u,f,a,e[r+10],23,-1094730640),a=md5hh(a,c,u,f,e[r+13],4,681279174),f=md5hh(f,a,c,u,e[r],11,-358537222),u=md5hh(u,f,a,c,e[r+3],16,-722521979),c=md5hh(c,u,f,a,e[r+6],23,76029189),a=md5hh(a,c,u,f,e[r+9],4,-640364487),f=md5hh(f,a,c,u,e[r+12],11,-421815835),u=md5hh(u,f,a,c,e[r+15],16,530742520),a=md5ii(a,c=md5hh(c,u,f,a,e[r+2],23,-995338651),u,f,e[r],6,-198630844),f=md5ii(f,a,c,u,e[r+7],10,1126891415),u=md5ii(u,f,a,c,e[r+14],15,-1416354905),c=md5ii(c,u,f,a,e[r+5],21,-57434055),a=md5ii(a,c,u,f,e[r+12],6,1700485571),f=md5ii(f,a,c,u,e[r+3],10,-1894986606),u=md5ii(u,f,a,c,e[r+10],15,-1051523),c=md5ii(c,u,f,a,e[r+1],21,-2054922799),a=md5ii(a,c,u,f,e[r+8],6,1873313359),f=md5ii(f,a,c,u,e[r+15],10,-30611744),u=md5ii(u,f,a,c,e[r+6],15,-1560198380),c=md5ii(c,u,f,a,e[r+13],21,1309151649),a=md5ii(a,c,u,f,e[r+4],6,-145523070),f=md5ii(f,a,c,u,e[r+11],10,-1120210379),u=md5ii(u,f,a,c,e[r+2],15,718787259),c=md5ii(c,u,f,a,e[r+9],21,-343485551),a=safeAdd(a,n),c=safeAdd(c,i),u=safeAdd(u,o),f=safeAdd(f,s);return[a,c,u,f]}function binl2rstr(e){for(var t=32*e.length,r="",n=0;n<t;n+=8)r+=String.fromCharCode(e[n>>5]>>>n%32&255);return r}function rstr2binl(e){var t,r=[];for(r[((e=ensureBuffer(e)).length>>2)-1]=undefined,t=0;t<r.length;t+=1)r[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e[t/8])<<t%32;return r}function rstrMD5(e){return binl2rstr(binlMD5(rstr2binl(e),8*byteLength$1(e)))}function rstrHMACMD5(e,t){var r,n=rstr2binl(e),i=[],o=[];for(i[15]=o[15]=undefined,n.length>16&&(n=binlMD5(n,8*e.length)),r=0;r<16;r+=1)i[r]=909522486^n[r],o[r]=1549556828^n[r];var s=binlMD5(i.concat(rstr2binl(t)),512+8*t.length);return binl2rstr(binlMD5(o.concat(s),640))}function rstr2hex(e){for(var t,r=HEX_CHARS,n="",i=0;i<e.length;i+=1)n+=r[(t=e.charCodeAt(i))>>>4&15]+r[15&t];return n}function rawMD5(e){return rstrMD5(e)}function hexMD5(e){return rstr2hex(rawMD5(e))}function rawHMACMD5(e,t){return rstrHMACMD5(e,t)}function hexHMACMD5(e,t){return rstr2hex(rawHMACMD5(e,t))}function md5(e,t,r){return t?r?rawHMACMD5(t,e):hexHMACMD5(t,e):r?rawMD5(e):hexMD5(e)}var queueMicrotask_1="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:commonjsGlobal):function(e){return(promise||(promise=Promise.resolve())).then(e)["catch"](function(e){return setTimeout(function(){throw e},0)})},runParallel_1=runParallel;function runParallel(e,t){var r,n,i,o=!0;function s(e){function n(){t&&t(e,r),t=null}o?queueMicrotask_1(n):n()}function a(e,t,i){r[e]=i,(0==--n||t)&&s(t)}Array.isArray(e)?(r=[],n=e.length):(i=Object.keys(e),r={},n=i.length),n?i?i.forEach(function(t){e[t](function(e,r){a(t,e,r)})}):e.forEach(function(e,t){e(function(e,r){a(t,e,r)})}):s(null),o=!1}function unique_pred(e,t){for(var r=1,n=e.length,i=e[0],o=e[0],s=1;s<n;++s)if(o=i,t(i=e[s],o)){if(s===r){r++;continue}e[r++]=i}return e.length=r,e}function unique_eq(e){for(var t=1,r=e.length,n=e[0],i=e[0],o=1;o<r;++o,i=n)if(i=n,(n=e[o])!==i){if(o===t){t++;continue}e[t++]=n}return e.length=t,e}function unique(e,t,r){return 0===e.length?e:t?(r||e.sort(t),unique_pred(e,t)):(r||e.sort(),unique_eq(e))}var uniq=unique,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(e){throw new RangeError(errors[e])}function map$1(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function mapDomain(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+map$1((e=e.replace(regexSeparators,".")).split("."),t).join(".")}function ucs2decode(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function digitToBasic(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function adapt(e,t,r){var n=0;for(e=r?floor(e/damp):e>>1,e+=floor(e/t);e>baseMinusTMin*tMax>>1;n+=base)e=floor(e/baseMinusTMin);return floor(n+(baseMinusTMin+1)*e/(e+skew))}function encode(e){var t,r,n,i,o,s,a,c,u,f,d,h,l,p,m,g=[];for(h=(e=ucs2decode(e)).length,t=initialN,r=0,o=initialBias,s=0;s<h;++s)(d=e[s])<128&&g.push(stringFromCharCode(d));for(n=i=g.length,i&&g.push(delimiter);n<h;){for(a=maxInt,s=0;s<h;++s)(d=e[s])>=t&&d<a&&(a=d);for(a-t>floor((maxInt-r)/(l=n+1))&&error("overflow"),r+=(a-t)*l,t=a,s=0;s<h;++s)if((d=e[s])<t&&++r>maxInt&&error("overflow"),d==t){for(c=r,u=base;!(c<(f=u<=o?tMin:u>=o+tMax?tMax:u-o));u+=base)m=c-f,p=base-f,g.push(stringFromCharCode(digitToBasic(f+m%p,0))),c=floor(m/p);g.push(stringFromCharCode(digitToBasic(c,0))),o=adapt(r,l,n==i),r=0,++n}++r,++t}return g.join("")}function toASCII(e){return mapDomain(e,function(e){return regexNonASCII.test(e)?"xn--"+encode(e):e})}function hasOwnProperty$2(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var isArray$2=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function stringifyPrimitive(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function stringify(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=undefined),"object"==typeof e?map$2(objectKeys(e),function(n){var i=encodeURIComponent(stringifyPrimitive(n))+r;return isArray$2(e[n])?map$2(e[n],function(e){return i+encodeURIComponent(stringifyPrimitive(e))}).join(t):i+encodeURIComponent(stringifyPrimitive(e[n]))}).join(t):n?encodeURIComponent(stringifyPrimitive(n))+r+encodeURIComponent(stringifyPrimitive(e)):""}function map$2(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var objectKeys=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};function parse$2(e,t,r,n){t=t||"&",r=r||"=";var i={};if("string"!=typeof e||0===e.length)return i;var o=/\+/g;e=e.split(t);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a=e.length;s>0&&a>s&&(a=s);for(var c=0;c<a;++c){var u,f,d,h,l=e[c].replace(o,"%20"),p=l.indexOf(r);p>=0?(u=l.substr(0,p),f=l.substr(p+1)):(u=l,f=""),d=decodeURIComponent(u),h=decodeURIComponent(f),hasOwnProperty$2(i,d)?isArray$2(i[d])?i[d].push(h):i[d]=[i[d],h]:i[d]=h}return i}var url={parse:urlParse,resolve:urlResolve,resolveObject:urlResolveObject,format:urlFormat,Url:Url};function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(e,t,r){if(e&&isObject(e)&&e instanceof Url)return e;var n=new Url;return n.parse(e,t,r),n}function parse$3(e,t,r,n){if(!isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),o=-1!==i&&i<t.indexOf("#")?"?":"#",s=t.split(o);s[0]=s[0].replace(/\\/g,"/");var a=t=s.join(o);if(a=a.trim(),!n&&1===t.split("#").length){var c=simplePathPattern.exec(a);if(c)return e.path=a,e.href=a,e.pathname=c[1],c[2]?(e.search=c[2],e.query=r?parse$2(e.search.substr(1)):e.search.substr(1)):r&&(e.search="",e.query={}),e}var u,f,d,h,l=protocolPattern.exec(a);if(l){var p=(l=l[0]).toLowerCase();e.protocol=p,a=a.substr(l.length)}if(n||l||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var m="//"===a.substr(0,2);!m||l&&hostlessProtocol[l]||(a=a.substr(2),e.slashes=!0)}if(!hostlessProtocol[l]&&(m||l&&!slashedProtocol[l])){var g,v,y=-1;for(u=0;u<hostEndingChars.length;u++)-1!==(f=a.indexOf(hostEndingChars[u]))&&(-1===y||f<y)&&(y=f);for(-1!==(v=-1===y?a.lastIndexOf("@"):a.lastIndexOf("@",y))&&(g=a.slice(0,v),a=a.slice(v+1),e.auth=decodeURIComponent(g)),y=-1,u=0;u<nonHostChars.length;u++)-1!==(f=a.indexOf(nonHostChars[u]))&&(-1===y||f<y)&&(y=f);-1===y&&(y=a.length),e.host=a.slice(0,y),a=a.slice(y),parseHost(e),e.hostname=e.hostname||"";var _="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(!_){var b=e.hostname.split(/\./);for(u=0,d=b.length;u<d;u++){var w=b[u];if(w&&!w.match(hostnamePartPattern)){for(var E="",S=0,C=w.length;S<C;S++)w.charCodeAt(S)>127?E+="x":E+=w[S];if(!E.match(hostnamePartPattern)){var T=b.slice(0,u),R=b.slice(u+1),k=w.match(hostnamePartStart);k&&(T.push(k[1]),R.unshift(k[2])),R.length&&(a="/"+R.join(".")+a),e.hostname=T.join(".");break}}}}e.hostname.length>hostnameMaxLen?e.hostname="":e.hostname=e.hostname.toLowerCase(),_||(e.hostname=toASCII(e.hostname)),h=e.port?":"+e.port:"";var P=e.hostname||"";e.host=P+h,e.href+=e.host,_&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!unsafeProtocol[p])for(u=0,d=autoEscape.length;u<d;u++){var A=autoEscape[u];if(-1!==a.indexOf(A)){var x=encodeURIComponent(A);x===A&&(x=escape(A)),a=a.split(A).join(x)}}var I=a.indexOf("#");-1!==I&&(e.hash=a.substr(I),a=a.slice(0,I));var L=a.indexOf("?");if(-1!==L?(e.search=a.substr(L),e.query=a.substr(L+1),r&&(e.query=parse$2(e.query)),a=a.slice(0,L)):r&&(e.search="",e.query={}),a&&(e.pathname=a),slashedProtocol[p]&&e.hostname&&!e.pathname&&(e.pathname="/"),e.pathname||e.search){h=e.pathname||"";var O=e.search||"";e.path=h+O}return e.href=format$2(e),e}function urlFormat(e){return isString(e)&&(e=parse$3({},e)),format$2(e)}function format$2(e){var t=e.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var r=e.protocol||"",n=e.pathname||"",i=e.hash||"",o=!1,s="";e.host?o=t+e.host:e.hostname&&(o=t+(-1===e.hostname.indexOf(":")?e.hostname:"["+this.hostname+"]"),e.port&&(o+=":"+e.port)),e.query&&isObject(e.query)&&Object.keys(e.query).length&&(s=stringify(e.query));var a=e.search||s&&"?"+s||"";return r&&":"!==r.substr(-1)&&(r+=":"),e.slashes||(!r||slashedProtocol[r])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),i&&"#"!==i.charAt(0)&&(i="#"+i),a&&"?"!==a.charAt(0)&&(a="?"+a),r+o+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+i}function urlResolve(e,t){return urlParse(e,!1,!0).resolve(t)}function urlResolveObject(e,t){return e?urlParse(e,!1,!0).resolveObject(t):t}function parseHost(e){var t=e.host,r=portPattern.exec(t);r&&(":"!==(r=r[0])&&(e.port=r.substr(1)),t=t.substr(0,t.length-r.length)),t&&(e.hostname=t)}Url.prototype.parse=function(e,t,r){return parse$3(this,e,t,r)},Url.prototype.format=function(){return format$2(this)},Url.prototype.resolve=function(e){return this.resolveObject(urlParse(e,!1,!0)).format()},Url.prototype.resolveObject=function(e){if(isString(e)){var t=new Url;t.parse(e,!1,!0),e=t}for(var r,n=new Url,i=Object.keys(this),o=0;o<i.length;o++){var s=i[o];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),c=0;c<a.length;c++){var u=a[c];"protocol"!==u&&(n[u]=e[u])}return slashedProtocol[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!slashedProtocol[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var h=f[d];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||hostlessProtocol[e.protocol])n.pathname=e.pathname;else{for(r=(e.pathname||"").split("/");r.length&&!(e.host=r.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),n.pathname=r.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var l=n.pathname||"",p=n.search||"";n.path=l+p}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var m,g=n.pathname&&"/"===n.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=v||g||n.host&&e.pathname,_=y,b=n.pathname&&n.pathname.split("/")||[],w=n.protocol&&!slashedProtocol[n.protocol];if(r=e.pathname&&e.pathname.split("/")||[],w&&(n.hostname="",n.port=null,n.host&&(""===b[0]?b[0]=n.host:b.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===r[0]?r[0]=e.host:r.unshift(e.host)),e.host=null),y=y&&(""===r[0]||""===b[0])),v)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,b=r;else if(r.length)b||(b=[]),b.pop(),b=b.concat(r),n.search=e.search,n.query=e.query;else if(!isNullOrUndefined(e.search))return w&&(n.hostname=n.host=b.shift(),(m=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=m.shift(),n.host=n.hostname=m.shift())),n.search=e.search,n.query=e.query,isNull(n.pathname)&&isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!b.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=b.slice(-1)[0],S=(n.host||e.host||b.length>1)&&("."===E||".."===E)||""===E,C=0,T=b.length;T>=0;T--)"."===(E=b[T])?b.splice(T,1):".."===E?(b.splice(T,1),C++):C&&(b.splice(T,1),C--);if(!y&&!_)for(;C--;C)b.unshift("..");!y||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),S&&"/"!==b.join("/").substr(-1)&&b.push("");var R=""===b[0]||b[0]&&"/"===b[0].charAt(0);return w&&(n.hostname=n.host=R?"":b.length?b.shift():"",(m=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=m.shift(),n.host=n.hostname=m.shift())),(y=y||n.host&&b.length)&&!R&&b.unshift(""),b.length?n.pathname=b.join("/"):(n.pathname=null,n.path=null),isNull(n.pathname)&&isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},Url.prototype.parseHost=function(){return parseHost(this)};var safeBuffer=createCommonjsModule(function(e,t){var r=bufferEs6.Buffer;function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=bufferEs6:(n(bufferEs6,t),t.Buffer=i),i.prototype=Object.create(r.prototype),n(r,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return t!==undefined?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return bufferEs6.SlowBuffer(e)}}),safeBuffer_1=safeBuffer.Buffer,browser$4=createCommonjsModule(function(e){var t=65536,r=4294967295;var n=safeBuffer.Buffer,i=commonjsGlobal.crypto||commonjsGlobal.msCrypto;i&&i.getRandomValues?e.exports=function(e,o){if(e>r)throw new RangeError("requested too many random bytes");var s=n.allocUnsafe(e);if(e>0)if(e>t)for(var a=0;a<e;a+=t)i.getRandomValues(s.slice(a,a+t));else i.getRandomValues(s);if("function"==typeof o)return nextTick(function(){o(null,s)});return s}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}),assertThisInitialized=createCommonjsModule(function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports["default"]=e.exports,e.exports.__esModule=!0}),_assertThisInitialized=unwrapExports(assertThisInitialized),setPrototypeOf=createCommonjsModule(function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports["default"]=e.exports,e.exports.__esModule=!0,t(r,n)}e.exports=t,e.exports["default"]=e.exports,e.exports.__esModule=!0});unwrapExports(setPrototypeOf);var inheritsLoose=createCommonjsModule(function(e){e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,setPrototypeOf(e,t)},e.exports["default"]=e.exports,e.exports.__esModule=!0}),_inheritsLoose=unwrapExports(inheritsLoose);function BufferList(){this.head=null,this.tail=null,this.length=0}BufferList.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},BufferList.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},BufferList.prototype.concat=function(e){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var t=Buffer.allocUnsafe(e>>>0),r=this.head,n=0;r;)r.data.copy(t,n),n+=r.data.length,r=r.next;return t};var isBufferEncoding=Buffer.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function assertEncoding(e){if(e&&!isBufferEncoding(e))throw new Error("Unknown encoding: "+e)}function StringDecoder(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0}function passThroughWrite(e){return e.toString(this.encoding)}function utf16DetectIncompleteChar(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}StringDecoder.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var i;n=(t+=e.toString(this.encoding,0,n)).length-1;if((i=t.charCodeAt(n))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,n)}return t},StringDecoder.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},StringDecoder.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t},Readable.ReadableState=ReadableState;var debug=debuglog("stream");function prependListener(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function listenerCount$1(e,t){return e.listeners(t).length}function ReadableState(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof Duplex&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){if(!(this instanceof Readable))return new Readable(e);this._readableState=new ReadableState(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),EventEmitter.call(this)}function readableAddChunk(e,t,r,n,i){var o=chunkInvalid(t,r);if(o)e.emit("error",o);else if(null===r)t.reading=!1,onEofChunk(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!i){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else{var c;!t.decoder||i||n||(r=t.decoder.write(r),c=!t.objectMode&&0===r.length),i||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,i?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&emitReadable(e))),maybeReadMore(e,t)}else i||(t.reading=!1);return needMoreData(t)}function needMoreData(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}inherits$1(Readable,EventEmitter),Readable.prototype.push=function(e,t){var r=this._readableState;return r.objectMode||"string"!=typeof e||(t=t||r.defaultEncoding)!==r.encoding&&(e=Buffer.from(e,t),t=""),readableAddChunk(this,r,e,t,!1)},Readable.prototype.unshift=function(e){return readableAddChunk(this,this._readableState,e,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(e){return this._readableState.decoder=new StringDecoder(e),this._readableState.encoding=e,this};var MAX_HWM=8388608;function computeNewHighWaterMark(e){return e>=MAX_HWM?e=MAX_HWM:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function howMuchToRead(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=computeNewHighWaterMark(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function chunkInvalid(e,t){var r=null;return isBuffer(t)||"string"==typeof t||null===t||t===undefined||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function onEofChunk(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,emitReadable(e)}}function emitReadable(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(debug("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?nextTick(emitReadable_,e):emitReadable_(e))}function emitReadable_(e){debug("emit readable"),e.emit("readable"),flow(e)}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,nextTick(maybeReadMore_,e,t))}function maybeReadMore_(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(debug("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;debug("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,flow(e))}}function nReadingNextTick(e){debug("readable nexttick read 0"),e.read(0)}function resume(e,t){t.resumeScheduled||(t.resumeScheduled=!0,nextTick(resume_,e,t))}function resume_(e,t){t.reading||(debug("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),flow(e),t.flowing&&!t.reading&&e.read(0)}function flow(e){var t=e._readableState;for(debug("flow",t.flowing);t.flowing&&null!==e.read(););}function fromList(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=fromListPartial(e,t.buffer,t.decoder),r);var r}function fromListPartial(e,t,r){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?copyFromBufferString(e,t):copyFromBuffer(e,t),n}function copyFromBufferString(e,t){var r=t.head,n=1,i=r.data;for(e-=i.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}function copyFromBuffer(e,t){var r=Buffer.allocUnsafe(e),n=t.head,i=1;for(n.data.copy(r),e-=n.data.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,s),0===(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}function endReadable(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,nextTick(endReadableNT,t,e))}function endReadableNT(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function forEach(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)}function indexOf(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function nop(){}function WriteReq(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function WritableState(e,t){Object.defineProperty(this,"buffer",{get:deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof Duplex&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(e){if(!(this instanceof Writable||this instanceof Duplex))return new Writable(e);this._writableState=new WritableState(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),EventEmitter.call(this)}function writeAfterEnd(e,t){var r=new Error("write after end");e.emit("error",r),nextTick(t,r)}function validChunk(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):Buffer.isBuffer(r)||"string"==typeof r||r===undefined||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),nextTick(n,o),i=!1),i}function decodeChunk(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=Buffer.from(t,r)),t}function writeOrBuffer(e,t,r,n,i){r=decodeChunk(t,r,n),Buffer.isBuffer(r)&&(n="buffer");var o=t.objectMode?1:r.length;t.length+=o;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var a=t.lastBufferedRequest;t.lastBufferedRequest=new WriteReq(r,n,i),a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else doWrite(e,t,!1,o,r,n,i);return s}function doWrite(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function onwriteError(e,t,r,n,i){--t.pendingcb,r?nextTick(i,n):i(n),e._writableState.errorEmitted=!0,e.emit("error",n)}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(onwriteStateUpdate(r),t)onwriteError(e,r,n,t,i);else{var o=needFinish(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||clearBuffer(e,r),n?nextTick(afterWrite,e,r,o,i):afterWrite(e,r,o,i)}}function afterWrite(e,t,r,n){r||onwriteDrain(e,t),t.pendingcb--,n(),finishMaybe(e,t)}function onwriteDrain(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function clearBuffer(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var s=0;r;)i[s]=r,r=r.next,s+=1;doWrite(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new CorkedRequest(t)}else{for(;r;){var a=r.chunk,c=r.encoding,u=r.callback;if(doWrite(e,t,!1,t.objectMode?1:a.length,a,c,u),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function needFinish(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function prefinish(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function finishMaybe(e,t){var r=needFinish(t);return r&&(0===t.pendingcb?(prefinish(e,t),t.finished=!0,e.emit("finish")):prefinish(e,t)),r}function endWritable(e,t,r){t.ending=!0,finishMaybe(e,t),r&&(t.finished?nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function CorkedRequest(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}Readable.prototype.read=function(e){debug("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return debug("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?endReadable(this):emitReadable(this),null;if(0===(e=howMuchToRead(e,t))&&t.ended)return 0===t.length&&endReadable(this),null;var n,i=t.needReadable;return debug("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&debug("length less than watermark",i=!0),t.ended||t.reading?debug("reading or ended",i=!1):i&&(debug("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=howMuchToRead(r,t))),null===(n=e>0?fromList(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&endReadable(this)),null!==n&&this.emit("data",n),n},Readable.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,debug("pipe count=%d opts=%j",n.pipesCount,t);var i=!t||!1!==t.end?s:u;function o(e){debug("onunpipe"),e===r&&u()}function s(){debug("onend"),e.end()}n.endEmitted?nextTick(i):r.once("end",i),e.on("unpipe",o);var a=pipeOnDrain(r);e.on("drain",a);var c=!1;function u(){debug("cleanup"),e.removeListener("close",l),e.removeListener("finish",p),e.removeListener("drain",a),e.removeListener("error",h),e.removeListener("unpipe",o),r.removeListener("end",s),r.removeListener("end",u),r.removeListener("data",d),c=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||a()}var f=!1;function d(t){debug("ondata"),f=!1,!1!==e.write(t)||f||((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==indexOf(n.pipes,e))&&!c&&(debug("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,f=!0),r.pause())}function h(t){debug("onerror",t),m(),e.removeListener("error",h),0===listenerCount$1(e,"error")&&e.emit("error",t)}function l(){e.removeListener("finish",p),m()}function p(){debug("onfinish"),e.removeListener("close",l),m()}function m(){debug("unpipe"),r.unpipe(e)}return r.on("data",d),prependListener(e,"error",h),e.once("close",l),e.once("finish",p),e.emit("pipe",r),n.flowing||(debug("pipe resume"),r.resume()),e},Readable.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}var o=indexOf(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},Readable.prototype.on=function(e,t){var r=EventEmitter.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&emitReadable(this,n):nextTick(nReadingNextTick,this))}return r},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var e=this._readableState;return e.flowing||(debug("resume"),e.flowing=!0,resume(this,e)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(e){var t=this._readableState,r=!1,n=this;for(var i in e.on("end",function(){if(debug("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)}),e.on("data",function(i){(debug("wrapped data"),t.decoder&&(i=t.decoder.write(i)),!t.objectMode||null!==i&&i!==undefined)&&((t.objectMode||i&&i.length)&&(n.push(i)||(r=!0,e.pause())))}),e)this[i]===undefined&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return forEach(["error","close","destroy","pause","resume"],function(t){e.on(t,n.emit.bind(n,t))}),n._read=function(t){debug("wrapped _read",t),r&&(r=!1,e.resume())},n},Readable._fromList=fromList,Writable.WritableState=WritableState,inherits$1(Writable,EventEmitter),WritableState.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(e,t,r){var n=this._writableState,i=!1;return"function"==typeof t&&(r=t,t=null),Buffer.isBuffer(e)?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=nop),n.ended?writeAfterEnd(this,r):validChunk(this,n,e,r)&&(n.pendingcb++,i=writeOrBuffer(this,n,e,t,r)),i},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||clearBuffer(this,e))},Writable.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Writable.prototype._write=function(e,t,r){r(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&e!==undefined&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||endWritable(this,n,r)},inherits$1(Duplex,Readable);for(var keys=Object.keys(Writable.prototype),v$1=0;v$1<keys.length;v$1++){var method=keys[v$1];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(e){if(!(this instanceof Duplex))return new Duplex(e);Readable.call(this,e),Writable.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||nextTick(onEndNT,this)}function onEndNT(e){e.end()}function TransformState(e){this.afterTransform=function(t,r){return afterTransform(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function afterTransform(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==r&&r!==undefined&&e.push(r),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function Transform(e){if(!(this instanceof Transform))return new Transform(e);Duplex.call(this,e),this._transformState=new TransformState(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){done(t,e)}):done(t)})}function done(e,t){if(t)return e.emit("error",t);var r=e._writableState,n=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function PassThrough(e){if(!(this instanceof PassThrough))return new PassThrough(e);Transform.call(this,e)}function Stream(){EventEmitter.call(this)}function assign(e,t){for(var r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}function createError(e,t,r){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof t&&(r=t,t=""),t&&(r.code=t);try{return assign(e,r)}catch(_){r.message=e.message,r.stack=e.stack;var n=function(){};return n.prototype=Object.create(Object.getPrototypeOf(e)),assign(new n,r)}}inherits$1(Transform,Duplex),Transform.prototype.push=function(e,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,e,t)},Transform.prototype._transform=function(e,t,r){throw new Error("Not implemented")},Transform.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},inherits$1(PassThrough,Transform),PassThrough.prototype._transform=function(e,t,r){r(null,e)},inherits$1(Stream,EventEmitter),Stream.Readable=Readable,Stream.Writable=Writable,Stream.Duplex=Duplex,Stream.Transform=Transform,Stream.PassThrough=PassThrough,Stream.Stream=Stream,Stream.prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",a));var o=!1;function s(){o||(o=!0,e.end())}function a(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===EventEmitter.listenerCount(this,"error"))throw e}function u(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",s),r.removeListener("close",a),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("error",c),e.on("error",c),r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e};var errCode=createError,debug$1=src("simple-peer"),Buffer$1=bufferEs6.Buffer,MAX_BUFFERED_AMOUNT=65536,ICECOMPLETE_TIMEOUT=5e3,CHANNEL_CLOSING_TIMEOUT=5e3;function filterTrickle(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}function warn(e){}var Peer=function(e){function t(r){var n;if(r=Object.assign({allowHalfOpen:!1},r),(n=e.call(this,r)||this)._id=browser$4(4).toString("hex").slice(0,7),n._debug("new peer %o",r),n.channelName=r.initiator?r.channelName||browser$4(20).toString("hex"):null,n.initiator=r.initiator||!1,n.channelConfig=r.channelConfig||t.channelConfig,n.channelNegotiated=n.channelConfig.negotiated,n.config=Object.assign({},t.config,r.config),n.offerOptions=r.offerOptions||{},n.answerOptions=r.answerOptions||{},n.sdpTransform=r.sdpTransform||function(e){return e},n.streams=r.streams||(r.stream?[r.stream]:[]),n.trickle=r.trickle===undefined||r.trickle,n.allowHalfTrickle=r.allowHalfTrickle!==undefined&&r.allowHalfTrickle,n.iceCompleteTimeout=r.iceCompleteTimeout||ICECOMPLETE_TIMEOUT,n.destroyed=!1,n.destroying=!1,n._connected=!1,n.remoteAddress=undefined,n.remoteFamily=undefined,n.remotePort=undefined,n.localAddress=undefined,n.localFamily=undefined,n.localPort=undefined,n._wrtc=r.wrtc&&"object"==typeof r.wrtc?r.wrtc:getBrowserRtc(),!n._wrtc)throw"undefined"==typeof window?errCode(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):errCode(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");n._pcReady=!1,n._channelReady=!1,n._iceComplete=!1,n._iceCompleteTimer=null,n._channel=null,n._pendingCandidates=[],n._isNegotiating=!1,n._firstNegotiation=!0,n._batchedNegotiation=!1,n._queuedNegotiation=!1,n._sendersAwaitingStable=[],n._senderMap=new Map,n._closingInterval=null,n._remoteTracks=[],n._remoteStreams=[],n._chunk=null,n._cb=null,n._interval=null;try{n._pc=new n._wrtc.RTCPeerConnection(n.config)}catch(i){return n.destroy(errCode(i,"ERR_PC_CONSTRUCTOR")),_assertThisInitialized(n)}return n._isReactNativeWebrtc="number"==typeof n._pc._peerConnectionId,n._pc.oniceconnectionstatechange=function(){n._onIceStateChange()},n._pc.onicegatheringstatechange=function(){n._onIceStateChange()},n._pc.onconnectionstatechange=function(){n._onConnectionStateChange()},n._pc.onsignalingstatechange=function(){n._onSignalingStateChange()},n._pc.onicecandidate=function(e){n._onIceCandidate(e)},"object"==typeof n._pc.peerIdentity&&n._pc.peerIdentity["catch"](function(e){n.destroy(errCode(e,"ERR_PC_PEER_IDENTITY"))}),n.initiator||n.channelNegotiated?n._setupData({channel:n._pc.createDataChannel(n.channelName,n.channelConfig)}):n._pc.ondatachannel=function(e){n._setupData(e)},n.streams&&n.streams.forEach(function(e){n.addStream(e)}),n._pc.ontrack=function(e){n._onTrack(e)},n._debug("initial negotiation"),n._needsNegotiation(),n._onFinishBound=function(){n._onFinish()},n.once("finish",n._onFinishBound),n}_inheritsLoose(t,e);var r=t.prototype;return r.address=function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}},r.signal=function(e){var t=this;if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(r){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(function(){t.destroyed||(t._pendingCandidates.forEach(function(e){t._addIceCandidate(e)}),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})["catch"](function(e){t.destroy(errCode(e,"ERR_SET_REMOTE_DESCRIPTION"))}),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(errCode(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}},r._addIceCandidate=function(e){var t=this,r=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(r)["catch"](function(e){!r.address||r.address.endsWith(".local")?warn("Ignoring unsupported ICE candidate."):t.destroy(errCode(e,"ERR_ADD_ICE_CANDIDATE"))})},r.send=function(e){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}},r.addTransceiver=function(e,t){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(r){this.destroy(errCode(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}},r.addStream=function(e){var t=this;if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(function(r){t.addTrack(r,e)})}},r.addTrack=function(e,t){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var r=this._senderMap.get(e)||new Map,n=r.get(t);if(n)throw n.removed?errCode(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):errCode(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");n=this._pc.addTrack(e,t),r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()}},r.replaceTrack=function(e,t,r){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");var n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw errCode(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(errCode(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}},r.removeTrack=function(e,t){if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");var r=this._senderMap.get(e),n=r?r.get(t):null;if(!n)throw errCode(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(i){"NS_ERROR_UNEXPECTED"===i.name?this._sendersAwaitingStable.push(n):this.destroy(errCode(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}},r.removeStream=function(e){var t=this;if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(function(r){t.removeTrack(r,e)})}},r._needsNegotiation=function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask_1(function(){e._batchedNegotiation=!1,e.initiator||!e._firstNegotiation?(e._debug("starting batched negotiation"),e.negotiate()):e._debug("non-initiator initial negotiation request discarded"),e._firstNegotiation=!1}))},r.negotiate=function(){var e=this;if(!this.destroying){if(this.destroyed)throw errCode(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(function(){e._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}},r.destroy=function(e){this._destroy(e,function(){})},r._destroy=function(e,t){var r=this;this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask_1(function(){if(r.destroyed=!0,r.destroying=!1,r._debug("destroy (error: %s)",e&&(e.message||e)),r.readable=r.writable=!1,r._readableState.ended||r.push(null),r._writableState.finished||r.end(),r._connected=!1,r._pcReady=!1,r._channelReady=!1,r._remoteTracks=null,r._remoteStreams=null,r._senderMap=null,clearInterval(r._closingInterval),r._closingInterval=null,clearInterval(r._interval),r._interval=null,r._chunk=null,r._cb=null,r._onFinishBound&&r.removeListener("finish",r._onFinishBound),r._onFinishBound=null,r._channel){try{r._channel.close()}catch(e){}r._channel.onmessage=null,r._channel.onopen=null,r._channel.onclose=null,r._channel.onerror=null}if(r._pc){try{r._pc.close()}catch(e){}r._pc.oniceconnectionstatechange=null,r._pc.onicegatheringstatechange=null,r._pc.onsignalingstatechange=null,r._pc.onicecandidate=null,r._pc.ontrack=null,r._pc.ondatachannel=null}r._pc=null,r._channel=null,e&&r.emit("error",e),r.emit("close"),t()}))},r._setupData=function(e){var t=this;if(!e.channel)return this.destroy(errCode(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=MAX_BUFFERED_AMOUNT),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){var r=e.error instanceof Error?e.error:new Error("Datachannel error: "+e.message+" "+e.filename+":"+e.lineno+":"+e.colno);t.destroy(errCode(r,"ERR_DATA_CHANNEL"))};var r=!1;this._closingInterval=setInterval(function(){t._channel&&"closing"===t._channel.readyState?(r&&t._onChannelClose(),r=!0):r=!1},CHANNEL_CLOSING_TIMEOUT)},r._read=function(){},r._write=function(e,t,r){if(this.destroyed)return r(errCode(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(n){return this.destroy(errCode(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>MAX_BUFFERED_AMOUNT?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r},r._onFinish=function(){var e=this;if(!this.destroyed){var t=function(){setTimeout(function(){return e.destroy()},1e3)};this._connected?t():this.once("connect",t)}},r._startIceCompleteTimeout=function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))},this.iceCompleteTimeout))},r._createOffer=function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then(function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=filterTrickle(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var r=function(){if(!e.destroyed){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp})}};e._pc.setLocalDescription(t).then(function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?r():e.once("_iceComplete",r))})["catch"](function(t){e.destroy(errCode(t,"ERR_SET_LOCAL_DESCRIPTION"))})}})["catch"](function(t){e.destroy(errCode(t,"ERR_CREATE_OFFER"))})},r._requestMissingTransceivers=function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach(function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))})},r._createAnswer=function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then(function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=filterTrickle(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var r=function(){if(!e.destroyed){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp}),e.initiator||e._requestMissingTransceivers()}};e._pc.setLocalDescription(t).then(function(){e.destroyed||(e.trickle||e._iceComplete?r():e.once("_iceComplete",r))})["catch"](function(t){e.destroy(errCode(t,"ERR_SET_LOCAL_DESCRIPTION"))})}})["catch"](function(t){e.destroy(errCode(t,"ERR_CREATE_ANSWER"))})},r._onConnectionStateChange=function(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(errCode(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))},r._onIceStateChange=function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(errCode(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(errCode(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}},r.getStats=function(e){var t=this,r=function(e){return"[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach(function(t){Object.assign(e,t)}),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then(function(t){var n=[];t.forEach(function(e){n.push(r(e))}),e(null,n)},function(t){return e(t)}):this._pc.getStats.length>0?this._pc.getStats(function(n){if(!t.destroyed){var i=[];n.result().forEach(function(e){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(r(t))}),e(null,i)}},function(t){return e(t)}):e(null,[])},r._maybeReady=function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var t=function(){e.destroyed||e.getStats(function(r,n){if(!e.destroyed){r&&(n=[]);var i={},o={},s={},a=!1;n.forEach(function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(s[e.id]=e)});var c=function(t){a=!0;var r=o[t.localCandidateId];r&&(r.ip||r.address)?(e.localAddress=r.ip||r.address,e.localPort=Number(r.port)):r&&r.ipAddress?(e.localAddress=r.ipAddress,e.localPort=Number(r.portNumber)):"string"==typeof t.googLocalAddress&&(r=t.googLocalAddress.split(":"),e.localAddress=r[0],e.localPort=Number(r[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var n=i[t.remoteCandidateId];n&&(n.ip||n.address)?(e.remoteAddress=n.ip||n.address,e.remotePort=Number(n.port)):n&&n.ipAddress?(e.remoteAddress=n.ipAddress,e.remotePort=Number(n.portNumber)):"string"==typeof t.googRemoteAddress&&(n=t.googRemoteAddress.split(":"),e.remoteAddress=n[0],e.remotePort=Number(n[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(n.forEach(function(e){"transport"===e.type&&e.selectedCandidatePairId&&c(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&c(e)}),a||Object.keys(s).length&&!Object.keys(o).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(r){return e.destroy(errCode(r,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var u=e._cb;e._cb=null,u(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval(function(){return e._onInterval()},150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}})};t()}},r._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>MAX_BUFFERED_AMOUNT||this._onChannelBufferedAmountLow()},r._onSignalingStateChange=function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))},r._onIceCandidate=function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())},r._onChannelMessage=function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=Buffer$1.from(t)),this.push(t)}},r._onChannelBufferedAmountLow=function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}},r._onChannelOpen=function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},r._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this.destroy())},r._onTrack=function(e){var t=this;this.destroyed||e.streams.forEach(function(r){t._debug("on track"),t.emit("track",e.track,r),t._remoteTracks.push({track:e.track,stream:r}),t._remoteStreams.some(function(e){return e.id===r.id})||(t._remoteStreams.push(r),queueMicrotask_1(function(){t._debug("on stream"),t.emit("stream",r)}))})},r._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],debug$1.apply(null,e)},_createClass(t,[{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}}]),t}(Stream.Duplex);Peer.WEBRTC_SUPPORT=!!getBrowserRtc(),Peer.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Peer.channelConfig={};var simplePeer=Peer,_extends_1=createCommonjsModule(function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.exports["default"]=e.exports,e.exports.__esModule=!0,t.apply(this,arguments)}e.exports=t,e.exports["default"]=e.exports,e.exports.__esModule=!0}),_extends=unwrapExports(_extends_1),ws={},debug$2=src("simple-websocket"),_WebSocket="function"!=typeof ws?WebSocket:ws,MAX_BUFFERED_AMOUNT$1=65536,Socket=function(e){function t(t){var r;if(void 0===t&&(t={}),"string"==typeof t&&(t={url:t}),t=Object.assign({allowHalfOpen:!1},t),r=e.call(this,t)||this,null==t.url&&null==t.socket)throw new Error("Missing required `url` or `socket` option");if(null!=t.url&&null!=t.socket)throw new Error("Must specify either `url` or `socket` option, not both");if(r._id=browser$4(4).toString("hex").slice(0,7),r._debug("new websocket: %o",t),r.connected=!1,r.destroyed=!1,r._chunk=null,r._cb=null,r._interval=null,t.socket)r.url=t.socket.url,r._ws=t.socket,r.connected=t.socket.readyState===_WebSocket.OPEN;else{r.url=t.url;try{r._ws="function"==typeof ws?new _WebSocket(t.url,null,_extends({},t,{encoding:undefined})):new _WebSocket(t.url)}catch(n){return queueMicrotask_1(function(){return r.destroy(n)}),_assertThisInitialized(r)}}return r._ws.binaryType="arraybuffer",t.socket&&r.connected?queueMicrotask_1(function(){return r._handleOpen()}):r._ws.onopen=function(){return r._handleOpen()},r._ws.onmessage=function(e){return r._handleMessage(e)},r._ws.onclose=function(){return r._handleClose()},r._ws.onerror=function(e){return r._handleError(e)},r._handleFinishBound=function(){return r._handleFinish()},r.once("finish",r._handleFinishBound),r}_inheritsLoose(t,e);var r=t.prototype;return r.send=function(e){this._ws.send(e)},r.destroy=function(e){this._destroy(e,function(){})},r._destroy=function(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){var r=this._ws,n=function(){r.onclose=null};if(r.readyState===_WebSocket.CLOSED)n();else try{r.onclose=n,r.close()}catch(e){n()}r.onopen=null,r.onmessage=null,r.onerror=function(){}}this._ws=null,e&&this.emit("error",e),this.emit("close"),t()}},r._read=function(){},r._write=function(e,t,r){if(this.destroyed)return r(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(n){return this.destroy(n)}"function"!=typeof ws&&this._ws.bufferedAmount>MAX_BUFFERED_AMOUNT$1?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r},r._handleOpen=function(){var e=this;if(!this.connected&&!this.destroyed){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(r){return this.destroy(r)}this._chunk=null,this._debug('sent chunk from "write before connect"');var t=this._cb;this._cb=null,t(null)}"function"!=typeof ws&&(this._interval=setInterval(function(){return e._onInterval()},150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}},r._handleMessage=function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=Buffer.from(t)),this.push(t)}},r._handleClose=function(){this.destroyed||(this._debug("on close"),this.destroy())},r._handleError=function(e){this.destroy(new Error("Error connecting to "+this.url))},r._handleFinish=function(){var e=this;if(!this.destroyed){var t=function(){setTimeout(function(){return e.destroy()},1e3)};this.connected?t():this.once("connect",t)}},r._onInterval=function(){if(this._cb&&this._ws&&!(this._ws.bufferedAmount>MAX_BUFFERED_AMOUNT$1)){this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);var e=this._cb;this._cb=null,e(null)}},r._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],debug$2.apply(null,e)},t}(Stream.Duplex);Socket.WEBSOCKET_SUPPORT=!!_WebSocket;var simpleWebsocket=Socket,Events,P2PFailReason;Events=exports.Events||(exports.Events={}),Events.SegmentLoaded="segment-loaded",Events.SegmentError="segment-error",Events.SegmentAbort="segment-abort",Events.SegmentTimeout="segment-timeout",Events.SegmentProgress="segment-progress",Events.P2PError="p2p-error",Events.P2PReport="p2p-report",Events.PeerConnect="peer-connect",Events.PeerClose="peer-close",Events.PieceBytesLoaded="piece-bytes-loaded",Events.PieceBytesUploaded="piece-bytes-uploaded",function(e){e[e.LESS_BUFFER=1]="LESS_BUFFER",e[e.NO_PEER_CONNECTED=2]="NO_PEER_CONNECTED",e[e.NO_CONTENT=3]="NO_CONTENT",e[e.IS_BUSY=4]="IS_BUSY",e[e.BUSY_AND_NO_CONTENT=5]="BUSY_AND_NO_CONTENT",e[e.P2P_LIMIT=6]="P2P_LIMIT",e[e.TIME_OUT=7]="TIME_OUT",e[e.OTHER=99]="OTHER"}(P2PFailReason||(P2PFailReason={}));var Segment=function(){function e(e,t,r,n,i,o,s,a,c,u,f,d,h,l){void 0===a&&(a=0),this.id=e,this.url=t,this.sn=r,this.priority=n,this.range=i,this.data=o,this.downloadSpeed=s,this.bytesLoaded=a,this.tfirst=c,this.tload=u,this.method=f,this.hDate=d,this.timeLoad=h,this.downloadInfo=l}return e["new"]=function(t,r,n,i,o,s,a,c,u,f,d,h,l){if(void 0===r&&(r=""),void 0===n&&(n=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===u&&(u=0),void 0===f&&(f=0),void 0===d&&(d=""),void 0===h&&(h=""),void 0===l&&(l=new Date),t&&"object"==typeof t){var p=t;t=p.id,r=p.url||r,n=p.sn||n,i=i===undefined?p.priority:i,o=p.range||o,s=p.data||s,a=p.downloadSpeed||a,c=p.bytesLoaded||c,u=p.tfirst||u,f=p.tload||f,d=p.method||d,h=p.hDate||h,l=p.timeLoad||l}return i===undefined&&(i=0),new e(t,r,n,i,o,s,a,c,u,f,d,h,l,new DownLoadInfo)},e}(),SegmentStatus,LoaderStatus;!function(e){e[e.Loaded=0]="Loaded",e[e.LoadingByHttp=1]="LoadingByHttp"}(SegmentStatus||(SegmentStatus={})),function(e){e[e.NULL=0]="NULL",e[e.LOADING=1]="LOADING",e[e.ABORT=2]="ABORT"}(LoaderStatus||(LoaderStatus={}));var DownLoadInfo=function(){return function(){this.p2pFailReason=P2PFailReason.OTHER,this.start=0,this.tcon=0,this.rcon=0,this.cons=0,this.busy=0,this.total=0}}(),extendStatics$1=function(e,t){return(extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends$1(e,t){function r(){this.constructor=e}extendStatics$1(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign$1=function(){return(__assign$1=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __decorate$1(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}function __awaiter$1(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{c(n.next(e))}catch(t){o(t)}}function a(e){try{c(n["throw"](e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((n=n.apply(e,t||[])).next())})}function __generator$1(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n["return"]:o[0]?n["throw"]||((i=n["return"])&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var debounce$1=E(C),LoaderCallbacks={0:"onSuccess",1:"onAbort",2:"onError",3:"onProgress"},ESegmentLoaderState;!function(e){e[e.Loaded=0]="Loaded",e[e.Abort=1]="Abort",e[e.Error=2]="Error",e[e.Progress=3]="Progress"}(ESegmentLoaderState||(ESegmentLoaderState={}));var LoadEntryChainMap=new CompositeKeyWeakMap,BaseLoaderEntry=function(){function e(e,t,r){void 0===t&&(t={}),void 0===r&&(r={}),this.segment=e,this.ctx=t,this._cbs=r,this._pr=A(),this.stats={trequest:performance.now(),retry:0}}var t=e.prototype;return t.call=function(e,t){var r=LoaderCallbacks[e],n=this._cbs,i=n&&n[r];return i&&S(function(){return i.apply(null,t||[])}),this},t.resolve=function(e){var t=this;return S(function(){return t._pr&&t._pr.resolve(e)}),this._pr},t.reject=function(e){var t=this;return S(function(){return t._pr&&t._pr.reject(e)}),this._pr},t.then=function(e,t){return this._pr.then(e,t)},t["catch"]=function(e){return this._pr["catch"](e)},t.destroy=function(){var e=this;this._pr&&(this._pr.destroy(),Object.keys(this).forEach(function(t){return delete e[t]}))},e}();function handleEvent(e,t,r){var n=[].slice.call(arguments,2);switch(e){case exports.Events.SegmentLoaded:this.onLoaded(t);break;case exports.Events.SegmentError:case exports.Events.SegmentTimeout:this.onError(t,n[0]);break;case exports.Events.SegmentAbort:this.onAbort(t);break;case exports.Events.SegmentProgress:t&&this.onProgress(t,r)}}var AbstractLoader=function(e){function t(){var t=e.call(this)||this;return[exports.Events.SegmentLoaded,exports.Events.SegmentError,exports.Events.SegmentAbort,exports.Events.SegmentTimeout,exports.Events.SegmentProgress].forEach(function(e){return t.on(e,handleEvent.bind(t,e))}),t.on("queue/set",function(e,r){return LoadEntryChainMap.set([t,e],r)}),t}__extends$1(t,e);var r=t.prototype;return r.onLoaded=function(e){var t=this;this.call(ESegmentLoaderState.Loaded,e,[e],function(){t.done(e,ESegmentLoaderState.Loaded)})},r.onError=function(e,t){var r=this;"string"==typeof t&&(t=new Error(t));var n=[t=t||B("Unexpected error.")];this.call(ESegmentLoaderState.Error,e,n,function(){r.done(e,ESegmentLoaderState.Error,n)})},r.onAbort=function(e){var t=this,r=B("Loading aborted.",LoaderStatus.ABORT);this.call(ESegmentLoaderState.Abort,e,[r],function(){t.done(e,ESegmentLoaderState.Abort)})},r.onProgress=function(e,t){this.call(ESegmentLoaderState.Progress,e,[t],function(){})},r.isLoading=function(e){return this.has(e.id)},r.call=function(e,t,r,n){var i=LoadEntryChainMap.get([this,t.id]);if(i){var o=void 0;if(e===ESegmentLoaderState.Progress)return n(r[0]),void i.call(e,r);e===ESegmentLoaderState.Loaded?i.resolve(r):(o=r[0]||B("load error",500),i.reject(o)),n(o),i.call(e,r),S(function(){return i.destroy()})}else n(new Error("Invalid load triggered"))},r.onComplete=function(e,t,r){},r.done=function(e,t,r){var n=e.id;this["delete"](n),LoadEntryChainMap["delete"]([this,n]),this.onComplete(e,t,r)},t}(g),debug$3=src("p2pcore:http-loader"),performance$1$1=window.performance,XHRSegmentRequest=function(e){function t(t,r,n,i){void 0===n&&(n={}),void 0===i&&(i={});var o=e.call(this,r,n,i)||this;return o.xhr=t,o}__extends$1(t,e);var r=t.prototype;return r.abort=function(){this.xhr&&this.xhr.abort()},r.destroy=function(){this.xhr.destroy(),this.xhr=null,e.prototype.destroy.call(this)},t}(BaseLoaderEntry),LoaderHttpImpl=function(e){function t(t){var r=e.call(this)||this;if(r.settings=t,!t.xhrLoader)throw new Error("XHR loader not implement yet.");return r}__extends$1(t,e);var r=t.prototype;return r.load=function(e,t,r){var n=this;if(this.isLoading(e))return Promise.reject(1);var i=e.url;debug$3(">>>> %s",i);var o=new this.settings.xhrLoader,s=new XHRSegmentRequest(o,e,t,r),a={url:i,responseType:"arraybuffer"},c=0;return e.method="cdn",e.bytesLoaded=0,e.tfirst=performance$1$1.now(),o.load(a,{timeout:15e3,maxRetry:1,retryDelay:0,maxRetryDelay:45e3},{onError:function(t,r,i){var o=t.code,s=B(t.text,o);e.tload=performance$1$1.now(),n["delete"](e.id),n.emit("segment-error",e,s)},onTimeout:function(t,r,i){var o=t.code,s=B(t.text,o);e.tload=performance$1$1.now(),n["delete"](e.id),n.emit("segment-timeout",e,s)},onAbort:function(t,r,i){var o=t.code,s=B(t.text,o);e.tload=performance$1$1.now(),n["delete"](e.id),n.emit("segment-abort",e,s)},onProgress:function(t,r,i,o){var s=t.loaded,a=s-c;n.emit("bytes-loaded",a,e),n.emit("segment-progress",e,i),c=s,e.bytesLoaded=t.loaded},onSuccess:function(t,r,i,o){var s=t.data;t.url;e.data=s,e.tload=performance$1$1.now(),e.hDate=r.hDate,e.timeLoad=r.timeLoad,n.emit("segment-loaded",e)}}),this.set(e.id,s),s.then(null)},r.abort=function(e){var t=e.id,r=this.get(t);r&&(debug$3("http segment abort",t),r.abort(),e.tload=performance$1$1.now(),this.emit("segment-abort",e),this["delete"](t))},r.destroy=function(){this.forEach(function(e){return e&&e.destroy()}),this.clear()},t}(AbstractLoader),PeerTypes;!function(e){e[e.OFFER=0]="OFFER",e[e.ANSWER=1]="ANSWER"}(PeerTypes||(PeerTypes={}));var P2pDebug=function(){function e(){this._current="",this._indexes="",this._p2p=null,this._peers=new Map,this._peers.set(PeerTypes.ANSWER,new Set),this._peers.set(PeerTypes.OFFER,new Set),window.p2pDebug=this}e.getInstance=function(){return this._instance||(this._instance=new e),this._instance};var t=e.prototype;return t.setP2P=function(e){this._p2p=e},Object.defineProperty(t,"p2pPeers",{get:function(){return this._p2p?Array.from(this._p2p.peers.values()).map(function(e){return e.id}):""},enumerable:!0,configurable:!0}),t.getP2pPeers=function(){return"test"},t.setCurrent=function(e){this._current=e},Object.defineProperty(t,"peers",{get:function(){var e=this._peers.get(PeerTypes.ANSWER)||[],t=this._peers.get(PeerTypes.OFFER)||[];return{current:this._current,answer:Array.from(e).join(" "),offer:Array.from(t).join(" ")}},enumerable:!0,configurable:!0}),t.setIndexes=function(e){var t=[],r={start:-1,end:-1},n=[];e.forEach(function(e){var t=e[0],r=e[1],i=Number(t.split("+")[1]);r===SegmentStatus.Loaded&&n.push(i)}),n.sort(function(e,t){return e-t});for(var i=0;i<n.length;i++){var o=n[i];-1===r.start?r.start=r.end=o:r.end+1===o?r.end=o:(t.push("["+r.start+","+r.end+"]"),r.start=r.end=o)}-1!==r.start&&t.push("["+r.start+","+r.end+"]"),this._indexes=t.join(",")},Object.defineProperty(t,"indexes",{get:function(){return this._indexes},enumerable:!0,configurable:!0}),t.addPeer=function(e,t){var r=this._peers.get(t);r&&r.add(e)},t.removePeer=function(e){var t=this._peers.get(PeerTypes.ANSWER);t&&t["delete"](e);var r=this._peers.get(PeerTypes.OFFER);r&&r["delete"](e)},e}(),debug$1$1=src("bittorrent-tracker:websocket-tracker"),DESTROY_TIMEOUT=1e3,socketPool={},RECONNECT_MINIMUM=1e4,RECONNECT_MAXIMUM=3e5,RECONNECT_VARIANCE=1e4,noop$1=function(){},WebSocketTracker=function(){function e(e,t){this.DEFAULT_ANNOUNCE_INTERVAL=3e4,this._socketPool={},this.announceUrlIndex=0,this.announceConnectTotal=0,this.serverAddr="",this.trackice_switch=!1,this.offer_timeout=10,this.ip="",debug$1$1("new websocket tracker %s",t[0]),this.client=e,this.announceUrls=t,this.announceUrlIndex=0,this.announceUrl=t[this.announceUrlIndex],this.interval=null,this.destroyed=!1,this._socketPool=socketPool,this.peers={},this.candidates={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}var t=e.prototype;return t.heartbeat=function(e){var t=this;void 0===e&&(e={}),this.destroyed||this.reconnecting||(this.socket.connected?this._send(Object.assign({event:"heartbeat"},e)):this.socket.once("connect",function(){t.heartbeat(e)}))},t.handshake=function(e){var t=this;if(!this.destroyed&&!this.reconnecting)if(this.socket.connected){debug$1$1("handshake",e);var r=Object.assign({},e,{event:"handshake",peer_id:this.client.peerId,peer_type:this.client.peer_type,network_type:2,nat_type:0,cver:4,pver:2});this._send(r)}else this.socket.once("connect",function(){t.handshake(e)})},t.announce=function(e){var t=this;if(!this.destroyed&&!this.reconnecting)if(this.socket.connected){debug$1$1("announce",e);var r=Object.assign({},e,{swarm_id:this.client.swarm_id,peer_id:this.client.peerId});if("stopped"===e.event||"completed"===e.event)this._send(r);else if("offer"===e.event)this.generateOffer().then(function(e){r.offer=e.offer,r.offer_id=e.offer_id,t.peers[e.offer_id].sendOfferTime=Date.now(),t._send(r)});else{var n=e.want_free_peer_num+e.want_pcdn_peer_num;this._generateOffers(n,function(e){r.offers=e;var n=Date.now();e.forEach(function(e){var r=e.offer_id;t.peers[r].sendOfferTime=n}),t._send(r)})}}else this.socket.once("connect",function(){t.announce(e)})},t.destroy=function(e){if(void 0===e&&(e=noop$1),this.destroyed)return e();for(var t in this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer),this.peers){var r=this.peers[t];clearTimeout(r.trackerTimeout),r.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,socketPool[this.announceUrl]&&(socketPool[this.announceUrl].consumers-=1),socketPool[this.announceUrl].consumers>0)return e();var n=socketPool[this.announceUrl];if(delete socketPool[this.announceUrl],n.on("error",noop$1),n.once("close",e),!this.expectingResponse)return o();var i=setTimeout(o,DESTROY_TIMEOUT);function o(){i&&(clearTimeout(i),i=null),n.removeListener("data",o),n.destroy(),n=null}n.once("data",o)},t._generateAuthKey=function(){var e=this.client,t=e.appId,r=e.appkey,n=e.peerId,i=Math.random().toString(36),o=Math.floor(+new Date/1e3)+12e4;return"?peerid="+n+"&appid="+t+"&salt="+i+"&timestamp="+o+"&auth_key="+md5(n+"-"+i+"-"+o+"-"+r)},t._openSocket=function(){var e=this;if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=function(){e._onSocketConnect()},this._onSocketErrorBound=function(t){e._onSocketError(t)},this._onSocketDataBound=function(t){e._onSocketData(t)},this._onSocketCloseBound=function(){e._onSocketClose()},this.socket=socketPool[this.announceUrl],this.socket)socketPool[this.announceUrl].consumers+=1;else{var t=this._generateAuthKey();this.socket=socketPool[this.announceUrl]=new simpleWebsocket(this.announceUrl+t),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)},t._onSocketConnect=function(){this.destroyed||(this.handshake({}),this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.handshake({})))},t._onSocketData=function(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(e)}catch(r){return void this.client.emit("warning",{from:1e3,code:12001,msg:"Invalid tracker response"})}if("started"===e.event)this._onAnnounceStarted(e);else if("offer"===e.event||"answer"===e.event||"candidate"===e.event)this._onAnnounceResponse(e);else if("handshake"===e.event)this._onHandshakeResponse(e);else{var t=e.errmsg||"invalid action in WS response: "+e.action;debug$1$1(t)}}},t._onAnnounceStarted=function(e){if(e.free_peer_info&&e.free_peer_info.errcode){var t=1e3+e.free_peer_info.origin;this.client.emit("warning",{from:t,code:e.free_peer_info.errcode,msg:"free peer error"})}e.pcdn_peer_info&&e.pcdn_peer_info.errcode&&this.client.emit("warning",{from:1e3,code:e.pcdn_peer_info.errcode,msg:"pcdn peer error"}),this.client.onStartedReponse(e)},t._onAnnounceResponse=function(e){var t=this;if(e.swarm_id===this.client.swarm_id){if(!e.peer_id||e.peer_id!==this.client.peerId){if(debug$1$1("received %s from %s for %s",JSON.stringify(e),this.announceUrl,this.client.swarm_id),null!=e.complete){var r=Object.assign({},e,{announce:this.announceUrl,swarm_id:e.info_hash});this.client.emit("update",r)}var n;if(e.offer&&e.from_peer_id&&(debug$1$1("creating peer (from remote offer)"),(n=this._createPeer({},!1)).id=e.from_peer_id,n.peer_type=e.from_peer_type,n.trace_id=e.trace_id||"",n.on("signal",function(r){if(r.candidate){var i={event:"candidate",swarm_id:t.client.swarm_id,peer_id:t.client.peerId,to_peer_id:e.from_peer_id,candidates:[__assign$1({type:"candidate"},r.candidate)],offer_id:e.offer_id};t._send(i)}else{i={event:"answer",swarm_id:t.client.swarm_id,peer_id:t.client.peerId,peer_type:t.client.peer_type,score:e.score,to_peer_id:e.from_peer_id,answer:r,nat_type:0,offer_id:e.offer_id,trace_id:e.trace_id,peer_ip:t.ip};t.client.emit("candidate_result",{result:1,type:2,stime:Date.now()-n.startCandidateTime,code:12901}),t._send(i)}}),n.signal(e.offer),this.client.emit("peer",n,!1)),e.candidates){var i=e.offer_id;(n=this.peers[i])&&e.candidates.forEach(function(e){n.signal({candidate:e})})}if(e.answer&&e.peer_id){i=e.offer_id;n=this.peers[i];var o=this.candidates[i];if(n?(n.id=e.peer_id,n.signal(e.answer),n.peer_type=e.peer_type,this.client.emit("peer",n,!0),n.score=e.score,clearTimeout(n.trackerTimeout),n.trackerTimeout=null):debug$1$1("got unexpected answer: "+JSON.stringify(e.answer)),o&&o.candidates&&o.candidates.length>0){var s={event:"candidate",swarm_id:this.client.swarm_id,peer_id:this.client.peerId,to_peer_id:e.peer_id,candidates:o.candidates,offer_id:e.offer_id};o.to_peer_id=e.peer_id,o.candidates=[],this._send(s)}else o&&(o.to_peer_id=e.peer_id)}}}else debug$1$1("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,e.info_hash,this.client.swarm_id)},t._onHandshakeResponse=function(e){this.trackice_switch=1===e.trackice_switch,this.serverAddr=e.cmd_server_addr,this.offer_timeout=e.offer_timeout||10,this.ip=e.ip,this.client.onHandshakeResponse(e),debug$1$1("Peer ID: "+e.peer_id)},t._onSocketClose=function(){this.destroyed||(this.destroy(),this._startReconnectTimer())},t._onSocketError=function(e){this.destroyed||(this.destroy(),this.client.emit("warning",{from:1e3,code:12002,msg:"unexpected websocket error"}),this._startReconnectTimer())},t._startReconnectTimer=function(){var e=this,t=Math.floor(Math.random()*RECONNECT_VARIANCE)+Math.min(Math.pow(2,this.retries)*RECONNECT_MINIMUM,RECONNECT_MAXIMUM);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(function(){e.retries++,e.retries>=2&&(e.retries=0,e.announceUrlIndex++,e.announceUrlIndex>=e.announceUrls.length&&(e.announceUrlIndex=0),e.announceUrl=e.announceUrls[e.announceUrlIndex],e.client.emit("connect-fail",{code:0===e.announceUrlIndex?12903:12904})),e.announceConnectTotal++,e.announceConnectTotal>10?e.client.emit("connect-fail",{code:12905}):e._openSocket()},t),this.reconnectTimer.unref&&this.reconnectTimer.unref(),debug$1$1("reconnecting socket in %s ms",t)},t._send=function(e){if(!this.destroyed){this.expectingResponse=!0;var t=JSON.stringify(e);debug$1$1("send %s",t),this.socket.send(t)}},t.generateOffer=function(){return __awaiter$1(this,void 0,void 0,function(){var e,t,r,n,i=this;return __generator$1(this,function(o){return e=this,t=browser$4(20).toString("hex"),debug$1$1("creating peer (from _generateOffers)"),r=e.peers[t]=e._createPeer({initiator:!0},!0),n=e.candidates[t],n=e.candidates[t]||{to_peer_id:"",candidates:[]},[2,new Promise(function(o,s){r.on("signal",function(s){if(s.candidate){if(n.candidates.push(__assign$1({},s.candidate,{type:"candidate"})),n.to_peer_id){var a={event:"candidate",swarm_id:e.client.swarm_id,peer_id:e.client.peerId,to_peer_id:n.to_peer_id,candidates:n.candidates,offer_id:t};n.candidates=[],e._send(a)}e.candidates[t]=n}else i.client.emit("candidate_result",{result:1,type:1,stime:Date.now()-r.startCandidateTime,code:12901}),o({offer:s,offer_id:t})}),r.trackerTimeout=e.setTrackerTimeout(r,t)})]})})},t._generateOffers=function(e,t){var r=this,n=[];debug$1$1("generating %s offers",e);for(var i=0;i<e;++i)o();function o(){var e=browser$4(20).toString("hex");debug$1$1("creating peer (from _generateOffers)");var t=r.peers[e]=r._createPeer({initiator:!0},!0),i=r.candidates[e];i=r.candidates[e]||{to_peer_id:"",candidates:[]},t.on("signal",function(o){if(o.candidate){if(i.candidates.push(__assign$1({},o.candidate,{type:"candidate"})),i.to_peer_id){var a={event:"candidate",swarm_id:r.client.swarm_id,peer_id:r.client.peerId,to_peer_id:i.to_peer_id,candidates:i.candidates,offer_id:e};i.candidates=[],r._send(a)}r.candidates[e]=i}else r.client.emit("candidate_result",{result:1,type:1,stime:Date.now()-t.startCandidateTime,code:12901}),n.push({offer:o,offer_id:e}),s()}),t.trackerTimeout=r.setTrackerTimeout(t,e)}function s(){n.length===e&&(debug$1$1("generated %s offers",e),t(n))}s()},t.setTrackerTimeout=function(e,t){var r=this,n=setTimeout(function(){debug$1$1('tracker timeout: destroying peer (offer_id: "%s")',t),e.trackerTimeout=null,delete r.peers[t],e.destroy("timeout"),r.client.emit("answer-timeout",e)},1e3*this.offer_timeout);return n.unref&&n.unref(),n},t._createPeer=function(e,t){var r=this,n=this;e=Object.assign({trickle:this.trackice_switch,config:n.client._rtcConfig,wrtc:n.client._wrtc},e);var i=new simplePeer(e);i.once("error",s),i.once("connect",function a(){i.removeListener("error",s);i.removeListener("connect",a)}),i.startCandidateTime=Date.now();var o=i;return o._pc&&o._pc.addEventListener("icecandidateerror",function(e){var n=e.errorText.includes("allocate request timed out")?12901:12902;r.client.emit("candidate_result",{result:0,type:t?1:2,code:n})}),i;function s(e){n.client.emit("warning",{from:i.peer_type,code:12010,msg:"Connection error: "+e.message}),i.destroy()}},e}(),debug$2$1=src("bittorrent-tracker:client"),DEFAULT_MAX_BAD_PEERS=100,DEFAULT_MAX_NO_DATA=60,TrackerClient=function(e){function t(t){var r=e.call(this)||this;if(r.peerId="",r.currentSN=0,r.heartbeatCnt=0,r.heartbeatInterval=120,r.startInterval=120,r.p2pInterval=20,r.max_badpeer_count=DEFAULT_MAX_BAD_PEERS,r.max_nodata_timeout=DEFAULT_MAX_NO_DATA,r.f_switch=0,!t.swarm_id)throw new Error("Option `swarm_id` is required");if(!t.announce)throw new Error("Option `announce` is required");r.peerId=t.peerId||"",r.peer_type=t.peer_type||4,r.appId=t.appId||"100",r.appkey=t.appkey||"%$^@mgtv398nma",r.playlist=t.playlist||{},r.endSN=r.playlist.manifest.endSN,r.m3u8Url=(url.parse(r.playlist.url).path||"").split("?")[0],r.currentSN=0,r.swarm_id=t.swarm_id,P2pDebug.getInstance().setCurrent(r.peerId),debug$2$1("new client %s",r.swarm_id),r.destroyed=!1,r._port=t.port,r._getAnnounceOpts=t.getAnnounceOpts,r._getUploadInfo=t.getUploadInfo,r._rtcConfig=t.rtcConfig,r._userAgent=t.userAgent,r._getCacheRange=t.getCacheRange,r._wrtc="function"==typeof t.wrtc?t.wrtc():t.wrtc;var n="string"==typeof t.announce?[[t.announce]]:null==t.announce?[]:t.announce;return n=n.map(function(e){return e.forEach(function(t,r){"/"===(t=t.toString())[t.length-1]&&(e[r]=t.substring(0,t.length-1))}),uniq(e)}),r._trackers=n.map(function(e){return new WebSocketTracker(r,e)}),r}__extends$1(t,e);var r=t.prototype;return r.start=function(e){debug$2$1("send `start`"),e=this._defaultAnnounceOpts(e),(e=Object.assign({peer_id:this.peerId,event:"offer",url:this.m3u8Url,ts_index_range:Math.min(this.currentSN,this.endSN-1)+"-"+(this.endSN-1)+"/"+this.endSN},e)).event="started",0!==e.want_free_peer_num&&this._announce(e)},r.stop=function(e){debug$2$1("send `stop`"),(e=this._defaultAnnounceOpts(e)).event="stopped",this._announce(e)},r.complete=function(e){debug$2$1("send `complete`"),e||(e={}),(e=this._defaultAnnounceOpts(e)).event="completed",this._announce(e)},r.update=function(e){debug$2$1("send `update`"),(e=this._defaultAnnounceOpts(e)).event&&delete e.event,this._announce(e)},r._announce=function(e){this._trackers.forEach(function(t){t.announce(e)})},r.onHandshakeResponse=function(e){var t=this;this.peerId=e.peer_id,P2pDebug.getInstance().setCurrent(this.peerId),this.heartbeatInterval=e.interval,this.startInterval=e.start_interval,this.p2pInterval=e.p2p_interval,this.max_badpeer_count=e.max_badpeer_count||DEFAULT_MAX_BAD_PEERS,this.heartTimer&&clearInterval(this.heartTimer),this.max_nodata_timeout=e.max_nodata_timeout||DEFAULT_MAX_NO_DATA,this.f_switch=e.f_switch||0,clearInterval(this._startLoop),this.start(),this.heartTimer=setInterval(function(){t.heartbeatCnt++,t.heartbeatCnt,t.startInterval,t.heartbeatCnt%t.heartbeatInterval==0&&t.sendHeartBeat(),t.heartbeatCnt%t.p2pInterval==0&&t.sendP2pInfo()},1e3)},r.sendHeartBeat=function(){var e=this,t=this._getCacheRange(),r=t[0],n=t[1];this._trackers.forEach(function(t){t.heartbeat({swarm_info:[{swarm_id:e.swarm_id,ts_index:e.currentSN,start_index:r,end_index:n}]})})},r.sendP2pInfo=function(){var e=this._getUploadInfo();debug$2$1("sendP2pInfo %d",e),this._trackers.forEach(function(t){t._send(e)})},r.destroy=function(e){if(!this.destroyed){this.destroyed=!0,debug$2$1("destroy");var t=this._trackers.map(function(e){return function(t){e.destroy(t)}});runParallel_1(t,e),this._trackers=[],this._getAnnounceOpts=null,this.heartTimer&&clearInterval(this.heartTimer),clearInterval(this._startLoop)}},r._defaultAnnounceOpts=function(e){return void 0===e&&(e={}),null==e.want_free_peer_num&&(e.want_free_peer_num=5),null==e.want_pcdn_peer_num&&(e.want_pcdn_peer_num=2),this._getAnnounceOpts&&(e=Object.assign({},e,this._getAnnounceOpts())),e},r.onStartedReponse=function(e){var t=this;this.lastStartInfo=e;var r=e.start_interval||120;clearInterval(this._startLoop),this._startLoop=setInterval(function(){t.start()},1e3*r),e.free_peer_info&&e.free_peer_info.reserved_peers&&this.startLoadReservedPeers(e)},r.startLoadReservedPeers=function(e){var t=this;clearInterval(this.reserved_interval);var r=e.p2precon_interval||5,n=0,i=e.free_peer_info.reserved_peers,o=e.trace_id||"";this.reserved_interval=setInterval(function(){var e=t._defaultAnnounceOpts().want_free_peer_num;if(e>0&&n<i.length)for(var r=e;r>0&&n<i.length;)t.offer(i[n],o),n++,r--;else clearInterval(t.reserved_interval)},1e3*r)},r.offer=function(e,t){var r={event:"offer",swarm_id:this.swarm_id,loginfo:"",offer_id:"",from_peer_type:this.peer_type,from_peer_id:this.peerId,to_peer_id:e,offer:{},trace_id:t};this._announce(r)},t}(EventEmitter),global$1$1=void 0!==global$1?global$1:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},lookup$1=[],revLookup$1=[],Arr$1="undefined"!=typeof Uint8Array?Uint8Array:Array,inited$1=!1;function init$1(){inited$1=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)lookup$1[t]=e[t],revLookup$1[e.charCodeAt(t)]=t;revLookup$1["-".charCodeAt(0)]=62,revLookup$1["_".charCodeAt(0)]=63}function toByteArray$1(e){var t,r,n,i,o,s;inited$1||init$1();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new Arr$1(3*a/4-o),n=o>0?a-4:a;var c=0;for(t=0,r=0;t<n;t+=4,r+=3)i=revLookup$1[e.charCodeAt(t)]<<18|revLookup$1[e.charCodeAt(t+1)]<<12|revLookup$1[e.charCodeAt(t+2)]<<6|revLookup$1[e.charCodeAt(t+3)],s[c++]=i>>16&255,s[c++]=i>>8&255,s[c++]=255&i;return 2===o?(i=revLookup$1[e.charCodeAt(t)]<<2|revLookup$1[e.charCodeAt(t+1)]>>4,s[c++]=255&i):1===o&&(i=revLookup$1[e.charCodeAt(t)]<<10|revLookup$1[e.charCodeAt(t+1)]<<4|revLookup$1[e.charCodeAt(t+2)]>>2,s[c++]=i>>8&255,s[c++]=255&i),s}function tripletToBase64$1(e){return lookup$1[e>>18&63]+lookup$1[e>>12&63]+lookup$1[e>>6&63]+lookup$1[63&e]}function encodeChunk$1(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(tripletToBase64$1(n));return i.join("")}function fromByteArray$1(e){var t;inited$1||init$1();for(var r=e.length,n=r%3,i="",o=[],s=0,a=r-n;s<a;s+=16383)o.push(encodeChunk$1(e,s,s+16383>a?a:s+16383));return 1===n?(t=e[r-1],i+=lookup$1[t>>2],i+=lookup$1[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=lookup$1[t>>10],i+=lookup$1[t>>4&63],i+=lookup$1[t<<2&63],i+="="),o.push(i),o.join("")}function read$1(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,f=-7,d=r?i-1:0,h=r?-1:1,l=e[t+d];for(d+=h,o=l&(1<<-f)-1,l>>=-f,f+=a;f>0;o=256*o+e[t+d],d+=h,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=n;f>0;s=256*s+e[t+d],d+=h,f-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:(l?-1:1)*Infinity;s+=Math.pow(2,n),o-=u}return(l?-1:1)*s*Math.pow(2,o-n)}function write$1(e,t,r,n,i,o){var s,a,c,u=8*o-i-1,f=(1<<u)-1,d=f>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===Infinity?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=f?(a=0,s=f):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+l]=255&a,l+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+l]=255&s,l+=p,s/=256,u-=8);e[r+l-p]|=128*m}var toString$2={}.toString,isArray$3=Array.isArray||function(e){return"[object Array]"==toString$2.call(e)},INSPECT_MAX_BYTES$1=50;function kMaxLength$1(){return Buffer$2.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer$1(e,t){if(kMaxLength$1()<t)throw new RangeError("Invalid typed array length");return Buffer$2.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Buffer$2.prototype:(null===e&&(e=new Buffer$2(t)),e.length=t),e}function Buffer$2(e,t,r){if(!(Buffer$2.TYPED_ARRAY_SUPPORT||this instanceof Buffer$2))return new Buffer$2(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe$1(this,e)}return from$1(this,e,t,r)}function from$1(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?fromArrayBuffer$2(e,t,r,n):"string"==typeof t?fromString$1(e,t,r):fromObject$1(e,t)}function assertSize$1(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function alloc$1(e,t,r,n){return assertSize$1(t),t<=0?createBuffer$1(e,t):r!==undefined?"string"==typeof n?createBuffer$1(e,t).fill(r,n):createBuffer$1(e,t).fill(r):createBuffer$1(e,t)}function allocUnsafe$1(e,t){if(assertSize$1(t),e=createBuffer$1(e,t<0?0:0|checked$1(t)),!Buffer$2.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function fromString$1(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer$2.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength$2(t,r),i=(e=createBuffer$1(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}function fromArrayLike$1(e,t){var r=t.length<0?0:0|checked$1(t.length);e=createBuffer$1(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function fromArrayBuffer$2(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=r===undefined&&n===undefined?new Uint8Array(t):n===undefined?new Uint8Array(t,r):new Uint8Array(t,r,n),Buffer$2.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Buffer$2.prototype:e=fromArrayLike$1(e,t),e}function fromObject$1(e,t){if(internalIsBuffer$1(t)){var r=0|checked$1(t.length);return 0===(e=createBuffer$1(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||isnan$1(t.length)?createBuffer$1(e,0):fromArrayLike$1(e,t);if("Buffer"===t.type&&isArray$3(t.data))return fromArrayLike$1(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked$1(e){if(e>=kMaxLength$1())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength$1().toString(16)+" bytes");return 0|e}function internalIsBuffer$1(e){return!(null==e||!e._isBuffer)}function byteLength$2(e,t){if(internalIsBuffer$1(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case undefined:return utf8ToBytes$1(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes$1(e).length;default:if(n)return utf8ToBytes$1(e).length;t=(""+t).toLowerCase(),n=!0}}function slowToString$1(e,t,r){var n=!1;if((t===undefined||t<0)&&(t=0),t>this.length)return"";if((r===undefined||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice$1(this,t,r);case"utf8":case"utf-8":return utf8Slice$1(this,t,r);case"ascii":return asciiSlice$1(this,t,r);case"latin1":case"binary":return latin1Slice$1(this,t,r);case"base64":return base64Slice$1(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice$1(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function swap$1(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf$1(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer$2.from(t,n)),internalIsBuffer$1(t))return 0===t.length?-1:arrayIndexOf$1(e,t,r,n,i);if("number"==typeof t)return t&=255,Buffer$2.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf$1(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf$1(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(n!==undefined&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var f=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===c)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var d=!0,h=0;h<c;h++)if(u(e,o+h)!==u(t,h)){d=!1;break}if(d)return o}return-1}function hexWrite$1(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function utf8Write$1(e,t,r,n){return blitBuffer$1(utf8ToBytes$1(t,e.length-r),e,r,n)}function asciiWrite$1(e,t,r,n){return blitBuffer$1(asciiToBytes$1(t),e,r,n)}function latin1Write$1(e,t,r,n){return asciiWrite$1(e,t,r,n)}function base64Write$1(e,t,r,n){return blitBuffer$1(base64ToBytes$1(t),e,r,n)}function ucs2Write$1(e,t,r,n){return blitBuffer$1(utf16leToBytes$1(t,e.length-r),e,r,n)}function base64Slice$1(e,t,r){return 0===t&&r===e.length?fromByteArray$1(e):fromByteArray$1(e.slice(t,r))}function utf8Slice$1(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,u=e[i],f=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=r)switch(d){case 1:u<128&&(f=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(f=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(f=c)}null===f?(f=65533,d=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),i+=d}return decodeCodePointsArray$1(n)}Buffer$2.TYPED_ARRAY_SUPPORT=global$1$1.TYPED_ARRAY_SUPPORT===undefined||global$1$1.TYPED_ARRAY_SUPPORT,Buffer$2.poolSize=8192,Buffer$2._augment=function(e){return e.__proto__=Buffer$2.prototype,e},Buffer$2.from=function(e,t,r){return from$1(null,e,t,r)},Buffer$2.TYPED_ARRAY_SUPPORT&&(Buffer$2.prototype.__proto__=Uint8Array.prototype,Buffer$2.__proto__=Uint8Array),Buffer$2.alloc=function(e,t,r){return alloc$1(null,e,t,r)},Buffer$2.allocUnsafe=function(e){return allocUnsafe$1(null,e)},Buffer$2.allocUnsafeSlow=function(e){return allocUnsafe$1(null,e)},Buffer$2.isBuffer=isBuffer$2,Buffer$2.compare=function(e,t){if(!internalIsBuffer$1(e)||!internalIsBuffer$1(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer$2.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer$2.concat=function(e,t){if(!isArray$3(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer$2.alloc(0);var r;if(t===undefined)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer$2.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!internalIsBuffer$1(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},Buffer$2.byteLength=byteLength$2,Buffer$2.prototype._isBuffer=!0,Buffer$2.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap$1(this,t,t+1);return this},Buffer$2.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap$1(this,t,t+3),swap$1(this,t+1,t+2);return this},Buffer$2.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap$1(this,t,t+7),swap$1(this,t+1,t+6),swap$1(this,t+2,t+5),swap$1(this,t+3,t+4);return this},Buffer$2.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?utf8Slice$1(this,0,e):slowToString$1.apply(this,arguments)},Buffer$2.prototype.equals=function(e){if(!internalIsBuffer$1(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer$2.compare(this,e)},Buffer$2.prototype.inspect=function(){var e="",t=INSPECT_MAX_BYTES$1;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},Buffer$2.prototype.compare=function(e,t,r,n,i){if(!internalIsBuffer$1(e))throw new TypeError("Argument must be a Buffer");if(t===undefined&&(t=0),r===undefined&&(r=e?e.length:0),n===undefined&&(n=0),i===undefined&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(n,i),u=e.slice(t,r),f=0;f<a;++f)if(c[f]!==u[f]){o=c[f],s=u[f];break}return o<s?-1:s<o?1:0},Buffer$2.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer$2.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf$1(this,e,t,r,!0)},Buffer$2.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf$1(this,e,t,r,!1)},Buffer$2.prototype.write=function(e,t,r,n){if(t===undefined)n="utf8",r=this.length,t=0;else if(r===undefined&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,n===undefined&&(n="utf8")):(n=r,r=undefined)}var i=this.length-t;if((r===undefined||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return hexWrite$1(this,e,t,r);case"utf8":case"utf-8":return utf8Write$1(this,e,t,r);case"ascii":return asciiWrite$1(this,e,t,r);case"latin1":case"binary":return latin1Write$1(this,e,t,r);case"base64":return base64Write$1(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write$1(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer$2.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH$1=4096;function decodeCodePointsArray$1(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH$1)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH$1));return r}function asciiSlice$1(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function latin1Slice$1(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hexSlice$1(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=toHex$1(e[o]);return i}function utf16leSlice$1(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function checkOffset$1(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt$1(e,t,r,n,i,o){if(!internalIsBuffer$1(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function objectWriteUInt16$1(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32$1(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function checkIEEE754$1(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat$1(e,t,r,n,i){return i||checkIEEE754$1(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),write$1(e,t,r,n,23,4),r+4}function writeDouble$1(e,t,r,n,i){return i||checkIEEE754$1(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),write$1(e,t,r,n,52,8),r+8}Buffer$2.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=t===undefined?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),Buffer$2.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Buffer$2.prototype;else{var i=t-e;r=new Buffer$2(i,undefined);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},Buffer$2.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset$1(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},Buffer$2.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset$1(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Buffer$2.prototype.readUInt8=function(e,t){return t||checkOffset$1(e,1,this.length),this[e]},Buffer$2.prototype.readUInt16LE=function(e,t){return t||checkOffset$1(e,2,this.length),this[e]|this[e+1]<<8},Buffer$2.prototype.readUInt16BE=function(e,t){return t||checkOffset$1(e,2,this.length),this[e]<<8|this[e+1]},Buffer$2.prototype.readUInt32LE=function(e,t){return t||checkOffset$1(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer$2.prototype.readUInt32BE=function(e,t){return t||checkOffset$1(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer$2.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset$1(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Buffer$2.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset$1(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},Buffer$2.prototype.readInt8=function(e,t){return t||checkOffset$1(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer$2.prototype.readInt16LE=function(e,t){t||checkOffset$1(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer$2.prototype.readInt16BE=function(e,t){t||checkOffset$1(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer$2.prototype.readInt32LE=function(e,t){return t||checkOffset$1(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer$2.prototype.readInt32BE=function(e,t){return t||checkOffset$1(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer$2.prototype.readFloatLE=function(e,t){return t||checkOffset$1(e,4,this.length),read$1(this,e,!0,23,4)},Buffer$2.prototype.readFloatBE=function(e,t){return t||checkOffset$1(e,4,this.length),read$1(this,e,!1,23,4)},Buffer$2.prototype.readDoubleLE=function(e,t){return t||checkOffset$1(e,8,this.length),read$1(this,e,!0,52,8)},Buffer$2.prototype.readDoubleBE=function(e,t){return t||checkOffset$1(e,8,this.length),read$1(this,e,!1,52,8)},Buffer$2.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt$1(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},Buffer$2.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt$1(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},Buffer$2.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,1,255,0),Buffer$2.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Buffer$2.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,2,65535,0),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16$1(this,e,t,!0),t+2},Buffer$2.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,2,65535,0),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16$1(this,e,t,!1),t+2},Buffer$2.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,4,4294967295,0),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):objectWriteUInt32$1(this,e,t,!0),t+4},Buffer$2.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,4,4294967295,0),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32$1(this,e,t,!1),t+4},Buffer$2.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt$1(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Buffer$2.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt$1(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Buffer$2.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,1,127,-128),Buffer$2.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer$2.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,2,32767,-32768),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16$1(this,e,t,!0),t+2},Buffer$2.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,2,32767,-32768),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16$1(this,e,t,!1),t+2},Buffer$2.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,4,2147483647,-2147483648),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):objectWriteUInt32$1(this,e,t,!0),t+4},Buffer$2.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt$1(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer$2.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32$1(this,e,t,!1),t+4},Buffer$2.prototype.writeFloatLE=function(e,t,r){return writeFloat$1(this,e,t,!0,r)},Buffer$2.prototype.writeFloatBE=function(e,t,r){return writeFloat$1(this,e,t,!1,r)},Buffer$2.prototype.writeDoubleLE=function(e,t,r){return writeDouble$1(this,e,t,!0,r)},Buffer$2.prototype.writeDoubleBE=function(e,t,r){return writeDouble$1(this,e,t,!1,r)},Buffer$2.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!Buffer$2.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},Buffer$2.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(n!==undefined&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer$2.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=r===undefined?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=internalIsBuffer$1(e)?e:utf8ToBytes$1(new Buffer$2(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var INVALID_BASE64_RE$1=/[^+\/0-9A-Za-z-_]/g;function base64clean$1(e){if((e=stringtrim$1(e).replace(INVALID_BASE64_RE$1,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function stringtrim$1(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function toHex$1(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes$1(e,t){var r;t=t||Infinity;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function asciiToBytes$1(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes$1(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}function base64ToBytes$1(e){return toByteArray$1(base64clean$1(e))}function blitBuffer$1(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function isnan$1(e){return e!=e}function isBuffer$2(e){return null!=e&&(!!e._isBuffer||isFastBuffer$1(e)||isSlowBuffer$1(e))}function isFastBuffer$1(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer$1(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isFastBuffer$1(e.slice(0,0))}var setTimeout$1=window.setTimeout,clearTimeout$1=window.clearTimeout,debug$3$1=src("p2pcore:transfer-peer"),EPeerCommand;function tryParseJSONBuffer(e){var t=new Uint8Array(e);if(123===t[0]&&34===t[1]&&125===t[e.byteLength-1])try{return JSON.parse(new TextDecoder("utf-8").decode(e))}catch(r){}return null}function detectSafari11_0(){var e="undefined"!=typeof navigator&&navigator.userAgent||"";if(-1!==e.indexOf("Safari")&&-1===e.indexOf("Chrome")){var t=e.match(/version\/(\d+(\.\d+)?)/i);if("11.0"===(t&&t.length>1&&t[1]||""))return!0}return!1}!function(e){e.REQUEST="request",e.HEADERS="headers",e.LOST="lost",e.INDEXES="indexes",e.ABORT="abort"}(EPeerCommand||(EPeerCommand={}));var getCommandName=function(e){return e.toLowerCase()},PeerStream=function(){function e(e,t,r){var n=r.length,i=r.md5,o=r.contentRange;this.id=e,this.sessionId=t,this.bytesLoaded=0,this.length=n,this.md5=i,this.contentRange=o,this.start=Number(o.split("/")[0].split("-")[0]),this.end=Number(o.split("/")[0].split("-")[1]),this.pieces=new Uint8Array(n),this.buffer=this.pieces.buffer}return e.prototype.write=function(e){this.pieces.set(new Uint8Array(e),this.bytesLoaded),this.bytesLoaded+=e.byteLength},e}(),IS_SAFARI11_0=detectSafari11_0(),TransferPeer=function(e){function t(t,r,n,i,o){var s=e.call(this)||this;s.peer=t,s.playlistSegments=r,s._swarmId=n,s.settings=i,s.isAnswer=o,s.remoteAddress="",s.remotePort=-1,s.remoteFamily="",s.seeding=!1,s.upload_bytes=0,s.upload_speed=0,s.connectDuration=0,s.last_transport=0,s._sid="",s._indexes=new Map,s._ex=null,s._sessionId=0,s._connectStart=0,s.isDownload=!1,s._connectStart=performance.now(),s.isDownload=o,t.on("connect",function(){return s.onConnect()}),t.on("close",function(){return s.onClose()}),t.on("error",function(e){return s.onError(e)}),t.on("data",function(e){return s.onData(e)}),s.id=t.id;var a=t;return a._pc&&a._pc.addEventListener("icecandidateerror",function(e){return s.onIceCandiateError(e)}),s}__extends$1(t,e);var r=t.prototype;return Object.defineProperty(r,"isIdle",{get:function(){return!this._sid},enumerable:!0,configurable:!0}),r.onIceCandiateError=function(e){var t=e.errorText,r=this._sid,n=t.includes("allocate request timed out")?12901:12902;this.emit("connect-error",{peer:this,id:r,message:t,code:n})},Object.defineProperty(r,"peer_type",{get:function(){return this.peer.peer_type},enumerable:!0,configurable:!0}),r.address=function(){return this.peer.address()},r.destroy=function(){debug$3$1("peer destroy",this.id,this),this.terminateRequest(),this.peer.destroy(),this.peer.removeAllListeners(),this.removeAllListeners()},r.getIndexesFromBitmap=function(e){for(var t=new Map,r=0;r<e.length;r++)for(var n=0;n<8;n++){(e[r]&Math.pow(2,7-n))==Math.pow(2,7-n)&&t.set(this._swarmId+"+"+(8*r+n),SegmentStatus.Loaded)}return t},r.getIndexesBitmap=function(e){var t=Math.ceil(this.playlistSegments.length/8),r=Buffer$2.alloc(t,0);return e.forEach(function(e){var t=e[0];if(e[1]===SegmentStatus.Loaded){var n=parseInt(t.split("+").slice(-1)[0]),i=Math.floor(n/8),o=Math.pow(2,7-n%8);r[i]=r[i]|o}}),r.toString("hex")},r.hasIndex=function(){}