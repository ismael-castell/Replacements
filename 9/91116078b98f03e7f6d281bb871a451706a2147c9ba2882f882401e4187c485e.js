!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="CvKd")}({"1J4y":function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==i(t)&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=32)}([function(t,e,s){"use strict";var r=s(11),n=s(5),a=99;function o(){return n.a.getDateTimeStr()+" "}var h=!1,u={_data:[],_length:0,debug:function(){var t=o(),e=Array.apply(null,arguments);e[0]=t+e[0],a<=-1&&console.log.apply(console,e)},log:function(t){var e=o(),i=Array.apply(null,arguments);i[0]=e+i[0],a<=0&&console.log.apply(console,i),u.record(i,"log")},info:function(t){var e=o(),i=Array.apply(null,arguments);i[0]=e+i[0],a<=1&&console.info.apply(console,i),u.record(i,"info")},warn:function(t){var e=o(),i=Array.apply(null,arguments);i[0]=e+i[0],a<=2&&console.warn.apply(console,i),u.record(i,"warn")},error:function(t){var e=o(),i=Array.apply(null,arguments);i[0]=e+i[0],a<=3&&console.error.apply(console,i),u.record(i,"error")},group:function(t){var e=o(),i=Array.apply(null,arguments);if(i[0]=e+i[0],a<=1){var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}u.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(t){t!=a&&(console.log(o()+" set log level from "+a+" to "+t),a=t)},getLevel:function(){return a},record:function(t,e){1100===u._length&&(u._data.splice(0,100),u._length=1e3);var s=0,r=(t.shift()||"").toString();for(r=r.replace(/\%c/gi,(function(t,e){return s++,""}));s--&&t.length;)t.shift();for(var n=0,a=t.length;n<a;n++)"object"==i(t[n])&&(t[n]="");t.unshift(r);var o=t.join(" ");u._length++,u._data.push("[".concat(e,"]").concat(o))},getLog:function(){return h||(h=!0,u._data.unshift(r.a.platform+" "+r.a.name+" "+r.a.version.string)),u._data},logcss:function(t,e,i){var s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s},padNum:function(t,e){var i=t.toString().length,s=Math.max(0,e-i);return"0".repeat(s)+t}};e.a=u},function(t,e,i){"use strict";e.a={KEY_VALUE:"value",KEY_STR:"str",KEY_DIM:"dim",K:"k",LIVE_TYPE:{FLV:0,P2P:1,HLS:2},HEART_TYPE:{START:0,CONTINUS:1,END:2},DIM_COM:{P2P:"p2p",OEXP:"oexp",STREAM_URL:"stream_url",CDNDOMAIN:"cdndomain",STREAM:"stream",CDNP_CONNECT_IP:"cdnp_connect_ip",CDNP_CONNECTED:"cdnp_connected",CDP_ID:"cdp_id",USER_WAN_IP:"user_wan_ip",VIDEO_LOGIN_FAIL:"video_login_fail",ORIGINAL_BITRATE:"original_bitrate",BROWSER_NAME:"browser_name",BROWSER_VERSION:"browser_version",BROWSER_KERNEL:"browser_kernel",BROWSER_KERNEL_VERSION:"browser_kernel_version",SPHD_TYPE:"sphd_type",DPI:"dpi",CDNIP:"cdnip",AUTO_BITRATE:"auto_bitrate",P2P_COOL_FLAG:"p2p_cool_flag",MP_EXPERIMENT:"mp_experiment",ACT_LOAD_TYPE:"act_load_type",STREAM_INDEX:"stream_index",OBS_RENDER_MODE:"obs_render_mode",PLAYER_TYPE:"player_type",LIVE_TYPE:"live_type",STREAM_TYPE:"stream_type",HLS_TYPE:"hls_type",VR_ENABLE:"vr_enable",VR_MODE:"vr_mode",CODEC_TYPE:"codec_type",CDN_CIP:"cdn_cip",CDN_SIP:"cdn_sip",ALT_SVC:"alt_svc",QUIC:"quic",START_TYPE:"start_type",PCDN_ORIGIN:"pcdn_origin",SUB_PCDN_STATE:"sub_pcdn_state",STREAM_TOTAL_DURATION:"stream_total_duration",CODERATE_BPS:"coderatebps",PLAYBACK_RATE:"playbackrate",ANCHOR_UID:"anchoruid",FLV_PCDN_STATE:"flv_pcdn_state",H265:"h265",V_DECODEC:"v_decodec",V_RECV_FRAME:"v_recv_frames",V_TO_DECODE_FRAMES:"v_to_decode_frames",V_DECODE_FRAME:"v_decode_frames",V_PLAY_FRAME:"v_play_frame",V_TO_PLAY_FRAME:"v_to_play_frames",SUB_CHANGE_STATE:"sub_change_state",FORCE_SUB_TYPE:"force_sub_type",MUTE_DATA:"mute_data",VISIBILITY_STATE:"visibility_state",SESSION_ID:"session_id",VIDEO_MIN_BUF:"video_min_buf",AUTO_VERSION:"auto_version",MSE_PLAYER:"mse_player",START_CODERATEBPS:"start_coderatebps",AUTO_OPEN:"auto_open"},DIM_CORE:{VIDEO_BAD_QUALITY_OLD:"video_bad_quality_old",VIDEO_BAD_QUALITY:"video_bad_quality",VIDEO_BAD_REASON:"video_bad_reason",USER_PROPERTY:"user_property",HEART_TYPE:"heart_type",SIGNAL_USER_PROPERTY:"signal_user_property",VIDEO_H265_BAD_QUALITY:"video_h265_bad_quality",AUTO_U_REASON:"auto_u_reason",AUTO_D_REASON:"auto_down_reason",AUTO_HEART_TYPE:"auto_heart_type",AUTO_CODEC_CHANGE_TYPE:"auto_codec_change_type",AUTO_BAD_REASON:"auto_bad_reason",AUTO_BAD_MIN_REASON:"auto_bad_min_reason",DISPATCH_ID:"dispatch_id"},DIM_LINK_STA:{name:"link_sta",CONNECT_SUC:"cns",HAS_DATA:"hd",DATA_ENOUGH:"de",AUDIO_CONFIG:"acf",VIDEO_CONFIG:"vcf",VIDEO_IFRAME:"vif",VIDEO_FRAME:"vf",AUDIO_FRAME:"af",NO_SLICE_DATA:"nsd",H265:"h265"},DIM_LINK_SAM:{name:"link_sam",AUDIO_DTS:"ad",VIDEO_DTS:"vd",AUDIO_RATE:"ar",VIDEO_RATE:"vr",AUDIO_WAIT_PUSH:"awp",VIDEO_WAIT_PUSH:"vwp",AUDIO_WAIT_REASON:"awr",VIDEO_WAIT_REASON:"vwr",AUDIO_WAIT_GAP:"awg",VIDEO_WAIT_GAP:"vwg",VIDEO_DROP_FRAMES:"vdf",VIDEO_AUDIO_GAP:"vag",VIDEO_BUFFER_EMPTY_TIME:"vbet",VIDEO_BUFFER_EMPTY_COUNT:"vbec",SPEED:"sp"},DIM_H265_SAM:{name:"h265_sam",decode_fps:"decode_fps",render_fps:"render_fps",frame_list_len:"frame_list_len"},DIM_EXT:{CDN_IP:"cdn_ip"},CORE:{name:"yspwl.web.live.user.heart20",CDN_TOTAL_BW:"cdn_total_bw",CDN_VALID_BW:"cdn_valid_bw",CDN_REPEAT_BW:"cdn_repeat_bw",P2P_TOTAL_BW:"p2p_total_bw",P2P_REPEAT_BW:"p2p_repeat_bw",P2P_VALID_BW:"p2p_valid_bw",RANGE_TOTAL_BW:"range_total_bw",RANGE_VALID_BW:"range_valid_bw",DEFAULT_BW:"default_bw",FAST_BW:"fast_bw",PATCH_BW:"patch_bw",COMPETE_BW:"compete_bw",FIXED_BW:"fixed_bw",FORCE_BW:"force_bw",SIGNAL_UP_BW:"signal_up_bw",SIGNAL_DOWN_BW:"signal_down_bw",ENC_FLOW:"enc_flow",DEC_FLOW:"dec_flow",DEC_OK_CNT:"dec_ok_cnt",DEC_FAIL_CNT:"dec_fail_cnt",BUFFER_LENGTH:"buffer_length",PLAY_DELAY:"play_delay",DELAY_ANCHOR:"delay_anchor",DELAY_SERVER:"delay_server",DELAY_NET:"delay_net",SVR_DELAY_INFOS:"svr_delay_infos",DELAY_NODE_INFO:"delay_node_info",SVR_LAST_P_DELAY:"svr_last_p_delay",UPLOADER_TYPE:"uploader_type",ENCODER_SOURCE:"encoder_source",OBS_FPS:"obs_fps",OBS_UPLOAD_TS:"obs_upload_ts",VIDEO_BLOCK_COUNT:"video_block_count",VIDEO_BLOCK_DURATION:"video_block_duration",VIDEO_BAD_BUFFER:"video_bad_buffer",VIDEO_CONTINUE_BUFFER:"video_continue_buffer",AUTO_SWITCH_CNT:"auto_switch_cnt",AUTO_SWITCH_SAME_CNT:"auto_switch_same_cnt",AUTO_BAD_QUALITY:"auto_bad_quality",AUTO_BAD_QUALITY_UP:"auto_bad_quality_up",AUTO_BAD_DURATION:"auto_bad_duration",AUTO_BAD_DURATION_UP:"auto_bad_duration_up",AUTO_BAD_SWITCH:"auto_bad_switch",AUTO_BAD_SWITCH_SAME:"auto_bad_switch_same",AUTO_BAD_SWITCH_UP:"auto_bad_switch_up",AUTO_BAD_DONE:"auto_bad_done",AUTO_BAD_BUFFER:"auto_bad_buffer",AUTO_CONTINUE_BUFFER:"auto_continue_buffer",PCDN_TOTAL_BW:"pcdn_total_bw",SWITCH_CDN_CNT:"switch_cdn_cnt",GET_STREAM_CNT:"get_stream_cnt",GET_STREAM_ERROR_CNT:"get_stream_error_cnt",REAL_KBPS_SAMPLE:"real_kbps_sample",REAL_FLAC_KBPS_SAMPLE:"real_flac_kbps_sample",RECV_TOTAL_SAMPLE:"recv_total_sample",RECV_LAN_SAMPLE:"recv_lan_sample",HAS_PUNCH_NODES:"has_punch_nodes",FORWARD_REJECT_CNT:"forward_reject_cnt",FRAME_BUFFER_DELAY:"frame_buffer_delay",STREAM_BUFFERED:"stream_buffered"},UPDOWN_INFO:{name:"updown_info",UPLINK_BW:"uplink_bw",DOWNLINK_BW:"downlink_bw",UPLINK_CNT:"uplink_cnt",UPLINK_LIMIT_CNT:"uplink_limit_cnt"},SIGNAL_HEART20:{name:"yspwl.web.live.signal.heart20",STREAM_NAME:"stream_name",STREAM_DELAY:"stream_delay",FULL_FRAME_NUM:"full_frame_num",LOST_FRAME_NUM:"lost_frame_num",P2P_FLOW_DANMU:"p2p_flow_danmu",P2P_FLOW_EMPTY:"p2p_flow_empty",MIN_DELAY:"min_delay",MAX_DELAY:"max_delay",AVE_DELAY:"ave_delay",SER_2_REC_DELAY:"ser_2_rec_delay",REC_2_MERGE_DELAY:"rec_2_merge_delay",MERGE_2_NOTIFY_DELAY:"merge_2_notify_delay",CDN_FLOW_DANMU_VALID:"cdn_flow_danmu_valid",CDN_FLOW_DANMU_TOTAL:"cdn_flow_danmu_total",CDN_FLOW_EMPTY_VALID:"cdn_flow_empty_valid",CDN_FLOW_EMPTY_TOTAL:"cdn_flow_empty_total"},HLS_INFO:{name:"hls_info",M3U8_CNT:"m3u8_cnt",M3U8_SUC_CNT:"m3u8_suc_cnt",M3U8_FAIL_CNT:"m3u8_fail_cnt",M3U8_EMPTY_CNT:"m3u8_empty_cnt",M3U8_WRONG_CNT:"m3u8_wrong_cnt",M3U8_TIMEOUT_CNT:"m3u8_timeout_cnt",TS_CNT:"ts_cnt",TS_SUC_CNT:"ts_suc_cnt",TS_FAIL_CNT:"ts_fail_cnt",TS_TIMEOUT_CNT:"ts_timeout_cnt",TS_OPEN_AVG:"ts_open_avg",TS_LOADED_AVG:"ts_loaded_avg",TS_SPEED_AVG:"ts_speed_avg",TS_SIZE_AVG:"ts_size_avg"},FRAME_INFO:{name:"frame_info",LATE_SEQS:"late_seqs",LOSS_FRAMES:"loss_frames",PLAY_FRAMES:"play_frames",DTS_JUMPPAUSE_CNT:"dts_jumppause_cnt",SKIP_PAUSE_CNT:"skip_pause_cnt",EMPTY_FRAMES:"empty_frames",FULL_RATIO:"full_ratio"},SUB_INFO:{name:"sub_info",TOTAL_CNT:"total_cnt",SUCC_CNT:"succ_cnt",FAIL_CNT:"fail_cnt",TIMEOUT_CNT:"timeout_cnt",KICK_CNT:"kick_cnt",TRY_CNT:"try_cnt",CMP_TOTAL_CNT:"cmp_total_cnt",CMP_SUCC_CNT:"cmp_succ_cnt",CMP_FAIL_CNT:"cmp_fail_cnt",CMP_TIMEOUT_CNT:"cmp_timeout_cnt",FORCE_CNT:"force_cnt"},PUNCH_INFO:{name:"punch_info",TOTAL_CNT:"total_cnt",VALID_CNT:"valid_cnt",TRY_CNT:"try_cnt",SUCC_CNT:"succ_cnt",BACK_CNT:"back_cnt",BACK_SUCC_CNT:"back_succ_cnt",BACK_TRY_CNT:"back_try_cnt"},PUNCH_BACK_RET:{name:"punch_back_ret"},RESEND_INFO:{name:"resend_info",RESEND_CNT:"resend_cnt",TIMEOUT_CNT:"timeout_cnt",ERROR_CNT:"error_cnt",SLICE_CNT:"slice_cnt",RESPOND_CNT:"respond_cnt",LATE_CNT:"late_cnt",MISS_CNT:"miss_cnt",REPEAT_CNT:"repeat_cnt",REPEAT_SUCC_CNT:"repeat_succ_cnt",REPEAT_FAIL_CNT:"repeat_fail_cnt",LIMIT_CNT:"limit_cnt"},SUBSTREAM_INFO:{name:"substream_info",FIXED_CNT:"fixed_cnt",FORCE_CNT:"force_cnt",COMPETE_CNT:"compete_cnt"},FORCESUB_REASON:{name:"forcesub_reason",NOPEER_CNT:"nopeer_cnt",SUBEND_CNT:"subend_cnt",TIMEOUT_CNT:"timeout_cnt"},SUB_RETURN:{sub_name:"sub_return",switch_name:"switch_return",last_name:"last_return"},NONODE_RETURN:{name:"nonode_return",PRESENTER_CNT:"presenter_cnt",UPLINK_LESS_CNT:"uplink_less_cnt",PULL_SAME_CNT:"pull_same_cnt",SUBED_CNT:"subed_cnt",COOL_CNT:"cool_cnt",DELAY_CNT:"delay_cnt",RTT_CNT:"rtt_cnt",LATE_CNT:"late_cnt",FAST_CNT:"fast_cnt",NONE_CNT:"none_cnt"},AUTO_INFO:{name:"auto_info",UP_CNT:"up_cnt",DOWN_CNT:"down_cnt",BACK_CNT:"back_cnt"},P2P_TCP_TYPE:{name:"p2p_tcp_type"},P2P_TCP_STATE:{name:"p2p_tcp_state"},PCDN_BW_DATA:{name:"pcdn_bw_data"},AI_CONTROL_DATA:{name:"ai_control_data",AI_P2P_CNT:"ai_p2p_cnt",AI_FLV_CNT:"ai_flv_cnt",AI_P2P_TIMEOUT_CNT:"ai_p2p_timeout_cnt",AI_FLV_TIMEOUT_CNT:"ai_flv_timeout_cnt",AI_P2P_ERROR_CNT:"ai_p2p_error_cnt",AI_FLV_ERROR_CNT:"ai_flv_error_cnt",AI_P2P_SWITCH_CNT:"ai_p2p_switch_cnt",AI_FLV_SWITCH_CNT:"ai_flv_switch_cnt",AI_P2P_NOT_SWITCH_CNT:"ai_p2p_not_switch_cnt",AI_FLV_NOT_SWITCH_CNT:"ai_flv_not_switch_cnt",AI_FLV_ERROR_SWITCH_CNT:"ai_flv_error_switch_cnt",AI_FLV_ERROR_NOT_SWITCH_CNT:"ai_flv_error_not_switch_cnt：flv",AI_START_P2P_CNT:"ai_start_p2p_cnt",AI_START_FLV_CNT:"ai_start_flv_cnt"},ACT:{name:"yspwl.web.live.user.act",field:"act_type",SWITCH_BITRATE:"switch_bitrate",SWITCH_AUTO:"switch_auto",SWITCH_LINE:"switch_line",SWITCH_PTS:"switch_pts",FAST_SAMPLE:"fast_sample",NO_PICTURE:"no_picture",LINK_STA:"link_sta",HLS_PLAY_SUCC:"hls_play_succ",HLS_LOAD_SUCC:"hls_load_succ",P2P_PLAY_FAIL:"p2p_play_fail",P2P_LOAD_VIDEO:"p2p_load_video",P2P_RESTART:"p2p_restart",TCP_NO_SLICE:"tcp_no_slice",TCP_OPEN_TIME:"tcp_open_time",HTTP_CODE_:"http_code_",TCP_TIMEOUT:"tcp_timeout",P2P_COOLING:"p2p_cooling",CONNECT_VIDEO_TS:"connect_video_ts",RECV_VIDEO_TS:"recv_video_ts",FIRST_VIDEO_PKG_TS:"first_video_pkg_ts",FIRST_VIDEO_IFRAME_TS:"first_video_iframe_ts",VIDEO_IFRAME_TS:"video_iframe_ts",FIRST_VIDEO_RENDER_TS:"first_video_render_ts",VIDEO_PLAYED_TS:"video_played_ts",VIDEO_LOAD_TS:"video_load_ts",VIDEO_GET_VP_TS:"video_get_vp_ts",VIDEO_LOGIN_TS:"video_login_ts",LOAD_M3U8_TS:"load_m3u8_ts",FIRST_FRAG_LOAD_TS:"first_frag_load_ts",FIRST_FRAG_LOADED_TS:"first_frag_loaded_ts",FIRST_FRAG_SIZE:"first_frag_size",SIGNAL_TURN_BACK:"signal_turn_back",SWITCH_COST:"switch_cost",OB_BG_DURATION:"ob_bg_duration",LOAD_P2PLIB_ERROR:"load_p2plib_error",LOAD_PCDNLIB_ERROR:"load_pcdnlib_error",PCDN_TO_CDN:"pcdn_to_cdn",MUTE_STATUS:"mute_status",NO_PICTURE2:"no_picture2",H265_WORKER_LOAD_TS:"h265_worker_load_ts",H265_STATUS:"h265_status",MOSAIC_STATUS:"mosaic_status"},ROOM_HEART60:{name:"yspwl.web.liveroom.user.heart1",SESSION_ID:"session_id",NOW_TS:"now_ts",MAX_NO_RENDER_DU:"max_no_render_du",NO_RENDER_DURATION:"no_render_duration",REPEAT_PIC_TS:"repeat_pic_ts"}}},function(t,e,i){"use strict";function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function r(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}i.d(e,"a",(function(){return r}))},function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}i.d(e,"a",(function(){return s}))},function(t,e,s){"use strict";var r=s(3),n=s(2),a=s(9),o=s(0),h=s(7),u=s(11),c=new(function(){function t(){Object(r.a)(this,t),this.pushGop=!1,this.jitBufLen=3e3,this.jitMaxBufLen=4e3,this.jitMinBufLen=2e3,this.resendPlayThreshold=1800,this.mutilLinkConfig=[[0,4e3],[8,4]],this.resendModeConfig=[[0,4e3],[1,2]],this.resendMode=1,this.resendWaitLimitList={500:3e3,2e3:3e3,4e3:3e3,8e3:3e3,1e4:3e3,12e3:3500,2e4:5e3},this.noUrgentResentBuffer=2e3,this.latency=[[3e3,2e3,4e3,2e3],[1e3,500,1500,1500]],this.jitTest=[2e3,5e3,1500],this.jitPid=[],this.hlsJitCfg=[6e3,4e3,8e3],this.hlsUseFetch=100,this.obsUseFull=0,this.obsFullRatio=1,this.obsBgRatio=0,this.obsFaceRatio=0,this.obsSrAudio=1,this.obsFrame=0,this.obsSyncTs=50,this.obsSeekTs=200,this.obsSeekJumpTs=0,this.obsRateTs=10,this.baseSubs=10,this.urgentResend=1,this.urgentResendAudio=1,this.crossCdn=0,this.p2pWssLines="all",this.connectTotalTime=6e3,this.connectTimeout=2e3,this.connectPcdnTimeout=4e3,this.flowTimeout=2e3,this.flowRetryTimes=3,this.renderTimeout=4e3,this.noDataTimeout=3e3,this.noPcdnDataTimeout=1e3,this.testResender=0,this.maxResendTs=3e3,this.minResendTs=200,this.maxResendTimes=2,this.resendGapTs=400,this.resendMinCnt=10,this.resendDelayTs=400,this.patchSubTs=250,this.http2Channel="",this.deleteH264Aud=[],this.useChangeRate=[],this.freeBufferBitrate=1e4,this.needCooling=1,this.needQueue=1,this.queueTime=3e3,this.punchedCoolingTime=3e4,this.delayCloseNum=200,this.punchTimeout=1e6,this.maxPunchedCnt=15,this.maxPunchedCntMore=30,this.maxNodeCnt=30,this.punchBackCooling=2e4,this.punchIgnoreTime=3e5,this.coefficient=8,this.trySubNum=5,this.trySubTime=5e3,this.fastTime=5e3,this.lostSeqTime=6,this.sliceLate=500,this.sliceFast=2e3,this.sliceConstraints=6e3,this.badDelay=2e3,this.emuteDelay=1800,this.switchDelay=500,this.aliveTimeout=1e3,this.resubTime=3e4,this.sliceTimeout=2e3,this.maxPeerStreamNum=7,this.maxPeerStreamNum20M=4,this.maxUplinkBw=2e3,this.closeUids=[],this.flvEmptyAudioFrame=1,this.sendHeartBeatAlone=0,this.signalNoCdnp=[],this.switchSeamLessLine=0,this.isProduce=!0,this.coderates=[[15e3,1,8e3,5,5,230,1,20],[8e3,1,4e3,5,5,230,5,10],[6e3,1,4e3,5,5,170,5,10],[4e3,0,4e3,5,5,120,5,10],[3e3,0,4e3,5,5,80,5,10],[0,0,4e3,5,5,50,5,10]],this.swapdomain={},this.iP2PType=2,this.danmuZipPids=[],this.randomPercent=1e4,this.frameBufLen=[2e3,2e3,1500,2500],this.bufferMode=2,this.bufferConfig=[],this.urgentResendTime=1500,this.forceSkipFrameTime=3900,this.frameTimeout=2500,this.p2pBuffer=[3500,2500,4500],this.jitCfg=[[0,3e3,2e3,4e3]],this.jitCfgPid=[],this.jitJump=[2e4,8e3],this.jitLowLatency=2e3,this.jitLow=[1500,1e3,2e3],this.safariPlayDelay=500,this.safariFirstLoad=!0,this.jitAB=[],this.waitAudio=1,this._isFrameBuffer=-1,this.isSubUseHttps=0,this.pcdnSubsConfig=[1,1,1],this.notUsePcdnUids=[],this.isPcdnReportErr=1,this.isMute=1,this.isAutoNoPicture=0,this.playbackrateMin=.95,this.playbackrateMax=1.05,this.pcdnFlv=1,this.isAiP2PToFlv=1,this.randomAIP2PFlvPercent=Math.floor(1e4*Math.random()),this.aiRandomPercent=5e3,this.allUidsAiP2P=0,this.aiABRandomPercent=2e3,this.aiUids=[],this.aiBlackUids=[],this.aiBlack2Uids=[],this.isAutoH265=0,this.renderDelta=300,this.h265Config=[[[2e3,4e3],[4e4,4e4]],[4e3,2e3,500],75,[[2e3,4e3],[3,4]],30,3,[!0,!0]],this.h265Config2=[6,1],this.h265BlackUids=[],this.h265NoPushVideoDis=2e4,this.randomH265Percent=Math.floor(1e4*Math.random()),this.h265PercentConfig=1e5,this.enableAiMosaic=0,this.aiMosaicUis=[],this.aiRequestInterval=5e3,this.aiBathRequestInterval=3e4,this.aiBufferEmptyRequestInterval=3e5,this.playerdata={profileP2POpt:""},this.isCommonAb=1,this.aiP2PFlvConfig=[5e3,5],this.closePcdnBitrate=8e3,this.closePcdn500=500,this.closePlayBackRateCfg=[[90,91,92,93,96],0],this.setVideoCTCfg=[-100,1500,1e4],this.sliceQuantityPerSecond=1e3,this.useNewPloy=1,this.minPlayout=300,this.maxPlayout=500,this.playoutUids=[],this.isMuteAct=1,this.useAV1=!1,this.useAV1PidList=[],this.useAV1LinesAndBitRates=[[],0],this.isClosePlayBackRate=1,this.pcdnAbConnectData=[0,[1e3,2e3,3e3,4e3]],this.isUseWebWorkerTick=1,this.platform=h.a.PLATFORM_TYPE_NAME.web,this.av1PercentConfig=5e3,this.isConfigSupportH265=1,this.abUseAv1=1,this.platform=h.a.PLATFORM_TYPE_NAME.web,this.h265GameIds=[!0,[]],this.isNoVideoReport=0,this.simdAbPercentConfig=5e3,this.isH265Filter4MCfg=[1,1,1,1080],this.useNewParser=1,this.maxGop=3e3,this.autoCfg={close:0,closeLines:[],closePids:[],upGap:0,downGap:15e3,backGap:15e3,upPer:.8,downPer:.3,downNowPer:.2,waitPer:.8,downBitrate:2e3,slow:.85,bufCnt:10,sucPer:.9,sampleTime:200,minTime:1e4,maxTime:3e5,sysTime:1e4,evalTime:300,highRate:4e3,badBuf:2e3,badCnt:3,badS:[1e4,3],badL:[6e4,5],noRederTime:12e4,monitorTime:15e3},this.continueBufferDeltaStart=6e3,this.continueBufferDeltaEnd=3e3,this.autoBufferScore=1e3,this.autoConnectScore=500,this.autoFirstScore=500,this.autoPtsScore=500,this.force_auto_count=9999,this.force_auto_effective_time=2592e5,this.autoReportCfg=[1,3,0,1],this.isWebAutoAB=0,this.maxBitRate=500,this.recSysExpiredTime=6e4}return Object(n.a)(t,[{key:"initByBitrate",value:function(t){if(this.maxPeerStreamNum=t>=1e4?this.maxPeerStreamNum20M:7,this.resendMode=1,this.resendModeConfig&&this.resendModeConfig[0].length===this.resendModeConfig[1].length)for(var e=this.resendModeConfig[0].length-1;e>=0;e--)if(t>=this.resendModeConfig[0][e]){this.resendMode=this.resendModeConfig[1][e];break}}},{key:"isAutoClose",value:function(t,e){if(1===this.autoCfg.close||-1!==this.autoCfg.closeLines.indexOf(Number(t)))return!0;for(var i=this.autoCfg.closePids.length,s=0;s<i;s++){var r=this.autoCfg.closePids[s];if(Number(r.pid)===Number(e))return!r.hasOwnProperty("lines")||-1!==r.lines.indexOf(t)}return!1}},{key:"setLowLatency",value:function(t){t&&t.setJitter(this.jitLow[0],this.jitLow[1],this.jitLow[2])}},{key:"setJitterCfg",value:function(t,e,i){this.setJitterAB(t,e,i)||this.setJitterByPid(t,e,i)||this.setJitterByRate(t,i,this.jitCfg)}},{key:"setJitterAB",value:function(t,e,i){if(this.jitAB.length>0){var s=this.jitAB[0],r=this.jitAB[1],n=this.jitAB[2];if("all"===s||-1!==s.indexOf(e+"")){var a=this.getGroupNum(n.length);return o.a.log("setJitterAB name=".concat(r," group=").concat(a)),this.setJitterByRate(t,i,n[a]),!0}}return!1}},{key:"getGroupNum",value:function(t){for(var e=1e4*Math.random(),i=t-1;i<t;i--)if(e>1e4/t*i)return i;return 0}},{key:"setJitterByPid",value:function(t,e,i){for(var s=0;s<this.jitCfgPid.length;s++){var r=this.jitCfgPid[s];if(-1!==r[0].indexOf(e+""))return o.a.log("setJitterByPid"),this.setJitterByRate(t,i,r[1]),!0}return!1}},{key:"setJitterByRate",value:function(t,e,i){for(var s=0;s<i.length;s++){var r=i[s];if(e>=r[0])return t&&t.setJitter(r[1],r[2],r[3]),!0}return!1}},{key:"init",value:function(t){if(t){Object.assign(this,t),o.a.group("Configs");var e=["Configs:"];for(var s in this){var r=this[s];"string"==typeof r&&("pushGop"==s?r=!!Number(r):"coderates"==s||"testCoderates"==s||"swapdomain"==s?(r=r.replace(/[↵\s+\n]/gm,""),r=JSON.parse(r)):"p2pWssLines"!=s&&"http2Channel"!=s&&(r=Number(r))),this[s]=r,"object"==i(r)&&(r=JSON.stringify(r)),s=a.b.padStrLen(s,18,!1),e.push("\t"+s+" => "+r)}o.a.log(e.join("\n")),o.a.groupEnd(),o.a.log("Config",this)}}},{key:"setAiP2PToFlv",value:function(t){this.isAiP2PToFlv=t}},{key:"setUseAV1",value:function(t){var e=this.useAV1PidList,i=t.presenterUid,s=!1,r=this.useAV1LinesAndBitRates[0],n=this.useAV1LinesAndBitRates[1];e.forEach((function(t){i&&t.toString()==i.toString()&&(s=!0)})),s&&(r.forEach((function(e){e==t.lineType&&(s=!1)})),t.curBitrate<Number(n)&&(s=!1)),this.useAV1=s,s&&(this.autoCfg.close=1)}},{key:"isCloseP2P",value:function(t){return t&&this.closeUids&&-1!==this.closeUids.indexOf(t)}},{key:"getEnableAiMosaic",value:function(t){return!!this.enableAiMosaic}},{key:"setMute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.isMute=t}},{key:"setUseAuto",value:function(t){t&&(this.isConfigSupportH265=0)}},{key:"getEnableJumpBuffer",value:function(){var t=u.a.version.major,e=this.closePlayBackRateCfg.length>0&&(1==this.closePlayBackRateCfg[1]||-1!=this.closePlayBackRateCfg[0].indexOf(t));return u.a.chrome&&e}},{key:"isFrameBuffer",get:function(){return 2}}]),t}());e.a=c},function(t,e,i){"use strict";function s(t,e){var i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(var n=0;n<s;n++)r+="0";return r+t}var r=0,n={now:function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return~~t.now();if(void 0!==t.webkitNow)return~~t.webkitNow();if(void 0!==t.mozNow)return~~t.mozNow();if(void 0!==t.msNow)return~~t.msNow()}0===r&&(r=Date.now()-1);var e=Date.now()-r;return e>4294967295?(r+=4294967295,e-4294967295):e},utc:function(){return Math.round(Date.now()/1e3)},getDateStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=null,i=(e=t?new Date(t):new Date).getFullYear(),r=s(e.getMonth()+1,2),n=s(e.getDate(),2);return"".concat(i,"-").concat(r,"-").concat(n)},getTimeStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=s((i=t?new Date(t):new Date).getHours(),2),n=s(i.getMinutes(),2),a=s(i.getSeconds(),2),o="".concat(r,":").concat(n,":").concat(a);if(e){var h=s(i.getMilliseconds(),3);o+="."+h}return o},getDateTimeStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=(i=t?new Date(t):new Date).getFullYear(),n=s(i.getMonth()+1,2),a=s(i.getDate(),2),o=s(i.getHours(),2),h=s(i.getMinutes(),2),u=s(i.getSeconds(),2),c="".concat(r,"-").concat(n,"-").concat(a," ").concat(o,":").concat(h,":").concat(u);if(e){var l=s(i.getMilliseconds(),3);c+="."+l}return c}};e.a=n},function(t,e,i){"use strict";var s=i(0),r=i(5),n=i(28),a=i.n(n),o=i(4),h=!1,u=[],c=0,l=null;function d(t,e){for(var i=0,s=u.length;i<s;i++){var r=u[i];if(r.callback==t&&r.thisObj==e)return r}return null}function p(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<10||i%10!=0||!t)return s.a.error("Timer.add Invalide interval value or callback function."),!1;var a=d(t,e);return a||(a={callback:t,thisObj:e,bindCallback:e?t.bind(e):t,param:r},u.push(a)),a.times=n,a.tickCount=0,a.interval=i/10,a.delayDel=!1,f(),!0}function f(){l&&1==Number(o.a.isUseWebWorkerTick)?l.postMessage("start"):!c&&u.length>0&&(c=setInterval(_,10))}function _(){if(0!=u.length){h=!0;for(var t=r.a.now(),e=u.length-1;e>=0;e--){var i=u[e];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var s=i.bindCallback,n=i.tickCount/i.interval;s(t,n,i.param),i.times>0&&i.times<=n&&i.tickCount>0&&u.splice(e,1)}}else u.splice(e,1)}h=!1}else l&&1==Number(o.a.isUseWebWorkerTick)?l.postMessage("stop"):(clearInterval(c),c=0)}e.a={initWorker:function(){(l=a()(29)).addEventListener("message",(function(t){_()})),l.addEventListener("error",(function(t){s.a.error("TimerWorker.error:",t.lineno+","+t.colno,t.message),l.terminate(),l=null,s.a.warn("[ TimerWorker terminate ]"),f()}))},has:function(t,e){return!!d(t,e)},add:p,remove:function(t,e){for(var i=0,s=u.length;i<s;i++){var r=u[i];if(r.callback==t&&r.thisObj==e)return h?r.delayDel=!0:u.splice(i,1),!0}return!1},once:function(t,e,i,s){p(t,e,i+10,s,1)},getSize:function(){return u.length}}},function(t,e,i){"use strict";var s=i(10),r={SLICE_SPEED:12.5,MAX_PACKET_CNT:1e4,SWITCH_INTERVAL:10,MAX_DELAY:66e4,DEFAULT_DELAY:65535,SUBSCRIBE_TIMEOUT:1e4,PUNCH_BACK_COOLING:2e4,PUNCH_IGNORE_TIME:3e5,SUB_TIMEOUT:5e3,RESUB_TIMEOUT:3e4,STREAM_DELAY:2e3,EMULATE_DELAY:1800,MAX_DEPTH:1,PROXY_NUM:3,MAX_PEER_STREAM_NUM:8,MAX_PUSH_NUM:3,MAX_PULL_NUM:3,SLICE_DELAY:100,SLICE_LATE:50,SLICE_FAST:50,SLICE_TIMEOUT:2e3,SWITCH_DELAY:500,StreamType:{NONE:0,FORCE:1,FIXED:2,COMPETE:3,PEER:4},LeaveReason:{PING_DIF:1,RESET:2},DEL_REASON:{CHANNEL_CLOSE:1,CHANNEL_ERROR:2,NODE_LEAVE:3,SERVER_REJECT:5,PEER_ERROR:6,PEER_TIMEOUT:7,PING_TIMEOUT:8,OTHER_SID:9,EMPTY_SLICE:10,SUB_TIMEOUT:11,SUB_FAIL_TIMES:12,NODE_REJECT:13,DIF_CDNP:14,PEER_HANDLER_ERR:15},PERIOD:{UPLINK_CALC:10,CHECK_SEED:20,GET_NODE:5},SubType:{SUBSCRIBE_FORCE:0,SUBSCRIBE_NORMAL:1},LoadVideoTimeoutReason:{FLV_DISCONNECTED:0,FLV_CONNECTED:1,FLV_CONNECT_ERROR:2,FLV_RECV_DATA:3,FLV_DATA_INVALID:4,FLV_STARTPLAY:5,FLV_PLAYERROR:6,HLS_DISCONNECTED:7,HLS_LOADMANIFEST_ERROR:8,HLS_LOADMANIFEST_SUCCESS:9,HLS_LOADFRAMENT:10,HLS_LOADFRAMENT_ERROR:11,HLS_LOADFRAMENT_SUCCESS:12,HLS_PLAY_ERROR:13},SubResCode:{ACCEPT_SUBSCRIBE:0,EMPTY_UPLOAD_NUM:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,INVALID_TREE_DEPTH:15,INVALID_MAX_SUBSTREAM_NUM:16,STREAM_LATE:17,DEPTH_LARGE:18,STREAM_LIMIT:19,SLICE_LARGE:20,NOT_FOUND_PKG:21,KICK_OUT:22,SELF_WORST:23,SLICE_LATE:24,SLICE_FAST:25,RESTART:26,RESET:27,DIF_BASE_SUBS:28},VIDEO_COMPETE_UID:4294967295,VIDEO_FORCE_UID:0,VIDEO_FIXED_UID:-1,VIDEO_DEFAULT_UID:-2,isProxyUid:function(t){return t===r.VIDEO_COMPETE_UID||t===r.VIDEO_FORCE_UID||t===r.VIDEO_FIXED_UID||t===r.VIDEO_DEFAULT_UID},isCompete:function(t){return t===r.VIDEO_COMPETE_UID},isForce:function(t){return t===r.VIDEO_FORCE_UID},isFixed:function(t){return t===r.VIDEO_FIXED_UID},isDefault:function(t){return t===r.VIDEO_DEFAULT_UID},isSliceJumpFromPeer:function(t,e){return e.isFromPeer&&t>0&&e.seq-t>10*r.LOST_SEQ_NUM},offerReject:{REASON_NOTSTART:1,REASON_PUNCHFAILED_CD:2,REASON_PUNCHED_FULL:3,REASON_QUOTA_EXHAUST:4,REASON_VERSION:5,REASON_DIF_LINE:6,REASON_FAIL:7,REASON_IGNORE:8,REASON_HAS_NODE:9,REASON_WAITING:10,REASON_OTHER:100},offerRejectTime:12e4,punchBackRet:{SUC:0,DIF_STREAM:1,CLOSING:2,COOLING:3,REQUEST:4,REJECT:5},restartReason:{RANGE_SEQ_MAX:1,RANGE_SEQ_LARGE:2,CDN_JUMP:3,PLAYER_NO_DATA:4,LOST_SEQ:5,CONNECT:6,WORKER_ERROR:7,MULTI_CDN:8,FLV_TO_P2P:9,PLAYER_ERROR:10,PLAYER_DISPOSE:11,LOST_SEQ_JUMP:12},turnToFlvReason:{FULL_PLAY_FAIL:1,FULL_CONNECT_TIMEOUT:2,SUB_CONNECT_TIMEOUT:3,FULL_NO_DATA:4,SUB_NO_DATA:5,P2P_ARGS_ERROR:6,P2P_COOLING:7,FLV_TO_P2P_FAIL:8,FLV_TO_P2P_FULL_STREAM_COMPLETE:9,FULL_ERROR:10,FULL_CLOSE:11,SUB_ERROR:12,SUB_CLOSE:13,RESTART_TIMES:14,SIGNAL_TIMEOUT:15,PROBE_TIMEOUT:16,PROBE_ERROR:17,NO_DATA_TIMEOUT:18,IS_NOT_FIRST_FETCH:19,VIDEO_BUFFER_EMPTY:20},userProperty:{SERVER_CLOSE:1,CLIENT_CLOSE:2,BROWSER_UN_SUPPORT:3,FLASH:4,UNKNOW:5,P2P:6,FIRST_FULL_CONNECT_TIMEOUT:7,FIRST_FULL_PLAY_FAIL:8,FIRST_FULL_NO_DATA:17,RESTART_RANGE_MAX:9,RESTART_RANGE_LARGE:10,RESTART_CONNECT:11,RESTART_MUTI_CDN:12,RESTART_PLAYER_NO_DATA:13,RESTART_PLAYER_ERROR:14,SUB_NO_DATA:15,SUB_CONNECT_TIMEOUT:16,P2P_ARGS_ERROR:18,FLV_TO_P2P:19,LOST_SEQ:20,P2P_COOLING:21,IS_NOT_FIRST_FETCH:22,VIDEO_BUFFER_EMPTY:23},h265TurnToH264Reason:{DECODE_ERROR:1,RENDER_ERROR:2},pauseReason:{FLV_NO_BUFF:1,FLV_UNKNOW_PAUSE:2,FLV_NET_SLOW:3,P2P_NO_BUFF:4,P2P_UNKNOW_PAUSE:5,P2P_FULL_LOADER_NO_DATA:10,P2P_FULL_LOADER_CONNECT_FAIL:11,P2P_SUB_LOADER_NO_DATA:12,P2P_SUB_LOADER_CONNECT_FAIL:13,FLV_NO_DATA:14,P2P_NO_SLICE:15,P2P_RESEND_SKIP_FRAME:20,P2P_RESEND_TOOLATE:21,P2P_RESEND_TIMEOUT:22,P2P_RESEND_ERROR:23,P2P_RESEND_MISSING:24,P2P_DTS_JUMP:25,P2P_NET_SLOW:26},DataType:{SIGNALLING:0,PING:1,SLICE:2},LOST_SEQ_NUM:4e3,initConfig:function(t,e){for(var i=e.coderates,n=null,a=0;a<i.length;a++)if(n=i[a],t>Number(n[0])){r.PROXY_NUM=Number(n[1]),r.SLICE_DELAY=Number(n[2]),r.MAX_PUSH_NUM=Number(n[3]),r.MAX_PULL_NUM=Number(n[4]),r.SLICE_LARGE=Number(n[5]);break}r.MAX_PEER_STREAM_NUM=Number(e.maxPeerStreamNum)||8;var o=r.SLICE_SPEED*s.a.baseSubs*(t/1e3);r.SLICE_LATE=parseInt(o*((Number(e.sliceLate)||1e3)/1e3)),r.SLICE_FAST=parseInt(o*((Number(e.sliceFast)||2e3)/1e3)),r.STREAM_DELAY=Number(e.badDelay)||2e3,r.EMULATE_DELAY=Number(e.emuteDelay)||1800,r.RESUB_TIMEOUT=Number(e.resubTime)||3e4,r.SLICE_TIMEOUT=Number(e.sliceTimeout)||2e3,r.SWITCH_DELAY=Number(e.switchDelay)||500},HLS_LOAD_TYPE:{FETCH:1,XHR:2},PLATFORM_TYPE:{web:100,mini_app:102,wap:103,huya_liveshareh5:104,adr:2,ios:3},PLATFORM_TYPE_NAME:{web:"web",wap:"wap"},H5_ERROR_CODE:{VIDEO_ERROR:-1e3,PLAY_TIMEOUT:-1001},VISIBILITY_STATE:{VISIBLE:"visible",HIDDEN:"hidden",PRERENDER:"prerender"}};e.a=r},function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return r}));var s={PLAY_STATUS:"PLAY_STATUS",PLAY_CARTON:"PLAY_CARTON",PLAY_TIME_STATUS:"PLAY_TIME_STATUS",VIDEO_PLAY:"VIDEO_PLAY",VIDEO_PLAYING:"VIDEO_PLAYING",VIDEO_PAUSE:"VIDEO_PAUSE",VIDEO_BAD_QUALITY:"VIDEO_BAD_QUALITY",METADATA:"METADATA",RECV_VIDEO_FRAME:"RECV_VIDEO_FRAME",VIDEO_STOP:"VIDEO_STOP",VIDEO_SEEK:"VIDEO_SEEK",BROWSER_PAUSE:"BROWSER_PAUSE",AUDIO_PLAY:"AUDIO_PLAY",AUDIO_SOUND:"AUDIO_SOUND",ANCHOR_STOP:"ANCHOR_STOP",VIDEO_LINK_CLOSE:"VIDEO_LINK_CLOSE",NO_VIDEO:"NO_VIDEO",HLS_URL_UNAVAILABLE:"HLS_URL_UNAVAILABLE",HLS_URL_LOAD_TIMEOUT:"HLS_URL_LOAD_TIMEOUT",HLS_MAINFEST_LOAD_TIMEOUT:"HLS_MAINFEST_LOAD_TIMEOUT",FLV_URL_UNAVAILABLE:"FLV_URL_UNAVAILABLE",FLV_URL_LOAD_TIMEOUT:"FLV_URL_LOAD_TIMEOUT",H5_PLAYER_ERROR:"H5_PLAYER_ERROR",PAUSE_5S_RETRY:"PAUSE_5S_RETRY",NO_DATA_RECEIVED:"NO_DATA_RECEIVED",P2P_REPORT:"P2P_REPORT",DATA_METRIC:"DATA_METRIC",DATA_METRIC2:"DATA_METRIC2",P2P_TIMEOUT:"P2P_TIMEOUT",FLV_TO_P2P:"FLV_TO_P2P",FLV_TRY_TO_P2P:"FLV_TRY_TO_P2P",FLAC_AUDIO_START:"FLAC_AUDIO_START",FLAC_AUDIO_ERROR:"FLAC_AUDIO_ERROR",FLAC_AUDIO_NEED_RETRY:"FLAC_AUDIO_NEED_RETRY",SIGNAL_PLAY:"SIGNAL_PLAY",SIGNAL_HEART:"SIGNAL_HEART",SIGNAL_DATA:"SIGNAL_DATA",SIGNAL_ERROR:"SIGNAL_ERROR",H264_SEI_PLAY:"H264_SEI_PLAY",TRANS_END:"TRANS_END",NEED_UPDATE_M3U8:"NEED_UPDATE_M3U8",PLAYBACK_UPDATE:"PLAYBACK_UPDATE",PLAYBACK_M3U8_UPDATED:"PLAYBACK_M3U8_UPDATED",PLAYBACK_DIF_CDN:"PLAYBACK_DIF_CDN",UPDATE_INTERSITY:"UPDATE_INTERSITY",PLAY_DOWNLINK_INFO:"PLAY_DOWNLINK_INFO",PLAY_FRAME_BUFFER:"PLAY_FRAME_BUFFER",WEBRTC_VIDEO_ERROR:"WEBRTC_VIDEO_ERROR",SWITCH_DONE:"SWITCH_DONE",AUTO_BITRATE_CHANGED:"AUTO_BITRATE_CHANGED",AUTO_FORCE_RSP:"AUTO_FORCE_RSP",VISIBILITY_CHANGE:"VISIBILITY_CHANGE",REPLAY_VIDEO:"REPLAY_VIDEO",P2P_PLAYING_EVENT:"P2P_PLAYING_EVENT",TURN_TO_H264:"TURN_TO_H264",H265_VIDEO_RETRY:"H265_VIDEO_RETRY",H265_PLAY:"H265_PLAY",PAUSE_5SEC_ERROR:"PAUSE_5SEC_ERROR"},r={VIDEO_PLAYING:"VIDEO_PLAYING",VIDEO_STOP:"VIDEO_STOP",VIDEO_CACHING:"VIDEO_CACHING",BROWSER_PAUSE:"BROWSER_PAUSE",AUDIO_START:"AUDIO_START",AUDIO_STOP:"AUDIO_STOP",AUDIO_PLAYING:"AUDIO_PLAYING"};e.c=s},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s=i(3),r=i(2),n=i(4),a=(i(0),function(){function t(){Object(s.a)(this,t)}return Object(r.a)(t,null,[{key:"turnStr",value:function(t,e,i){for(var s=t.toString(e),r=s.length;r<i;r++)s="0"+s;return s}},{key:"rotl64",value:function(e,i){var s=t.turnStr(e,2,64),r=s.substring(0,32),n=s.substring(32),a=n.substr(i,32-i)+n.substr(0,i);return parseInt(r+a,2)}},{key:"rotr64",value:function(e,i){var s=t.turnStr(e,2,64),r=s.substring(0,32),n=s.substring(32),a=n.substr(32-i,i)+n.substr(0,32-i);return parseInt(r+a,2)}},{key:"rotUid",value:function(e,i){return 0===e&&(e="1234"+t.turnStr(parseInt(9999*Math.random()),10,4)),isNaN(i)&&(i=0),e=parseInt(e),i=parseInt(i),t.rotl64(e,8)}},{key:"revertUid",value:function(e,i){return e=parseInt(e),t.rotr64(e,8)}},{key:"inet_ntoa",value:function(t){var e,i,s,r=new Uint8Array(4),n=new DataView(r.buffer);return n.setUint32(0,t),e=n.getUint8(0),i=n.getUint8(1),s=n.getUint8(2),n.getUint8(3)+"."+s+"."+i+"."+e}},{key:"ip2uint",value:function(t){for(var e=0,i=t.split("."),s=0;s<i.length;s++)e|=Number(i[s])<<8*s;return e<0&&(e+=4294967296),e}},{key:"isBiggerUint",value:function(t,e){return t!==e&&(t>e?t-e<2147483647:!(e-t<2147483647))}},{key:"isEqualOrBiggerUint",value:function(t,e){return t===e||(t>e?t-e<2147483647:!(e-t<2147483647))}},{key:"isUintMax",value:function(t){return 4294967295===t}},{key:"isUint64Max",value:function(t){return 0x10000000000000000===t}},{key:"getQueryString",value:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null}},{key:"printHexBytes",value:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new DataView(t.buffer),s=e?10:0,r=[];s<i.byteLength;){var n=i.getUint8(s++);(n=n.toString(16).toUpperCase()).length<2&&(n="0"+n),r.push(n,"\t"),s%10==0&&r.push("\n")}console.log(r.join("")+"\tsize:",i.byteLength)}},{key:"getCookie",value:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var n=i[s].trim();if(0==n.indexOf(e))return n.substr(e.length)}return""}},{key:"formatByteSize",value:function(t){var e=t/1024;return e>1024?(e/=1024).toFixed(1)+"MB":e.toFixed(1)+"KB"}},{key:"padStrLen",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.length>=e)return t;var s=" ".repeat(e-t.length);return i?s+t:t+s}},{key:"xhr",value:function(t,e,i,s,r){var n=new XMLHttpRequest;n.overrideMimeType("text/plain; charset=x-user-defined"),n.addEventListener("readystatechange",(function t(){4===n.readyState&&(200===n.status||304===n.status?s(n.response):r(n.status),n.removeEventListener("readystatechange",t),n=void 0)})),n.open(e,t,!0),n.send(i)}},{key:"getAv1Random",value:function(t,e){if(!t)return!1;var i=localStorage.av1PresentUid,s=t.presenterUid;localStorage.randomAv1Percent&&i==s||(localStorage.randomAv1Percent=Math.floor(1e4*Math.random()));var r=Number(localStorage.randomAv1Percent);return localStorage.av1PresentUid=t.presenterUid,r<e}},{key:"is64bitSoftware",value:function(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}},{key:"isGameIdSupport265",value:function(t,e){if(t[0])return!0;var i=!1;return t[1].map((function(t){e&&e.toString()==t.toString()&&(i=!0)})),i}},{key:"unescapeHTML",value:function(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace("↵","")}},{key:"getSdkAbRandom",value:function(t){var e=localStorage.abPresentUid;localStorage.randomAbPercent&&e==t.presenterUid||(localStorage.randomAbPercent=Math.floor(1e4*Math.random()));var i=Number(localStorage.randomAbPercent);return localStorage.abPresentUid=t.presenterUid,i<n.a.simdAbPercentConfig}}]),t}());function o(t){return atob(t)}a.indateLocalStorage={set:function(t,e,i){var s={value:e,expirse:new Date(i).getTime()};localStorage.setItem(t,JSON.stringify(s))},get:function(t){var e=JSON.parse(localStorage.getItem(t));if(null!==e){if(!(null!=e.expirse&&e.expirse<(new Date).getTime()))return e.value;localStorage.removeItem(t)}return null},update:function(t,e){var i=JSON.parse(localStorage.getItem(t));i&&(i.value=e,localStorage.setItem(t,JSON.stringify(i)))}},a.IntMax=2147483647,a.IntMin=-2147483647,a.UintMax=4294967295,e.b=a},function(t,e,i){"use strict";var s=i(3),r=i(2),n=i(0),a=new(function(){function t(){Object(s.a)(this,t),this.version=1100,this.baseSubs=10,this.uid=0,this.sGuid="",this.roomId=0,this.uuid=0,this.convertUid=0,this.appId=66,this.appid=66,this.p2pCooling=!1,this.flvTryToP2P=0}return Object(r.a)(t,[{key:"initUUId",value:function(){0===this.uuid&&(this.uuid=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295));var t=Number(localStorage.appid);t&&(this.appid=t,n.a.warn("--- test appid "+t+" ---",this))}}]),t}());e.a=a},function(t,e,i){"use strict";var s={};self||(self=window),function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(edg)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],r={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},n={};if(r.browser){n[r.browser]=!0;var a=r.majorVersion.split(".");n.version={major:parseInt(r.majorVersion,10),string:r.version},a.length>1&&(n.version.minor=parseInt(a[1],10)),a.length>2&&(n.version.build=parseInt(a[2],10))}for(var o in r.platform&&(n[r.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),(n.rv||n.iemobile)&&(n.rv&&delete n.rv,r.browser="msie",n.msie=!0),n.edge&&(delete n.edge,r.browser="msedge",n.chrome=!0),n.edg&&(delete n.edg,r.browser="msedge",n.chrome=!0),n.opr&&(r.browser="opera",n.opera=!0),n.safari&&n.android&&(r.browser="android",n.android=!0),n.name=r.browser,n.platform=r.platform,s)s.hasOwnProperty(o)&&delete s[o];Object.assign(s,n)}(),s.version||(s.version={major:0,minor:0,build:0,string:"0.0.0"}),e.a=s},function(t,e,i){"use strict";i.r(e);var s={},r={setTaf:function(t){return s=t}};e.default=r,r.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},r.UserId.prototype._clone=function(){return new r.UserId},r.UserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.UserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.UserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sHuYaUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType)},r.UserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sHuYaUA=t.readString(3,!1,this.sHuYaUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType)},r.VideoGatewayProxy2VGPingReq=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingReq.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingReq},r.VideoGatewayProxy2VGPingReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoGatewayProxy2VGPingReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoGatewayProxy2VGPingReq.prototype.writeTo=function(t){t.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingReq.prototype.readFrom=function(t){this.lLocalTime=t.readInt64(0,!1,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingRsp.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingRsp},r.VideoGatewayProxy2VGPingRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoGatewayProxy2VGPingRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoGatewayProxy2VGPingRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp.prototype.readFrom=function(t){this.lLocalTime=t.readInt64(0,!1,this.lLocalTime)},r.GetInfoFromVGReq=function(){this.lUid=0,this.iServiceType=0,this.iClientType=0,this.iClientIp=0,this.iTerminalType=0,this.iRequestVPType=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName="",this.lSid=0,this.vStreamName=new s.Vector(new s.STRING),this.tId=new r.UserId},r.GetInfoFromVGReq.prototype._clone=function(){return new r.GetInfoFromVGReq},r.GetInfoFromVGReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetInfoFromVGReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetInfoFromVGReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt32(1,this.iServiceType),t.writeInt32(2,this.iClientType),t.writeInt64(3,this.iClientIp),t.writeInt32(4,this.iTerminalType),t.writeInt32(5,this.iRequestVPType),t.writeBytes(6,this.sMsg),t.writeInt64(7,this.iUri),t.writeString(8,this.sProtoName),t.writeInt64(9,this.lSid),t.writeVector(10,this.vStreamName),t.writeStruct(11,this.tId)},r.GetInfoFromVGReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.iServiceType=t.readInt32(1,!1,this.iServiceType),this.iClientType=t.readInt32(2,!1,this.iClientType),this.iClientIp=t.readInt64(3,!1,this.iClientIp),this.iTerminalType=t.readInt32(4,!1,this.iTerminalType),this.iRequestVPType=t.readInt32(5,!1,this.iRequestVPType),this.sMsg=t.readBytes(6,!1,this.sMsg),this.iUri=t.readInt64(7,!1,this.iUri),this.sProtoName=t.readString(8,!1,this.sProtoName),this.lSid=t.readInt64(9,!1,this.lSid),this.vStreamName=t.readVector(10,!1,this.vStreamName),this.tId=t.readStruct(11,!1,this.tId)},r.GetInfoFromVGRsp=function(){this.lUid=0,this.ServerId=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName=""},r.GetInfoFromVGRsp.prototype._clone=function(){return new r.GetInfoFromVGRsp},r.GetInfoFromVGRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetInfoFromVGRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetInfoFromVGRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt64(1,this.ServerId),t.writeBytes(2,this.sMsg),t.writeInt64(3,this.iUri),t.writeString(4,this.sProtoName)},r.GetInfoFromVGRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.ServerId=t.readInt64(1,!1,this.ServerId),this.sMsg=t.readBytes(2,!1,this.sMsg),this.iUri=t.readInt64(3,!1,this.iUri),this.sProtoName=t.readString(4,!1,this.sProtoName)},r.GetCdnTokenExReq=function(){this.sFlvUrl="",this.sStreamName="",this.iLoopTime=0,this.tId=new r.UserId,this.iAppId=66},r.GetCdnTokenExReq.prototype._clone=function(){return new r.GetCdnTokenExReq},r.GetCdnTokenExReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetCdnTokenExReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetCdnTokenExReq.prototype.writeTo=function(t){t.writeString(0,this.sFlvUrl),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iLoopTime),t.writeStruct(3,this.tId),t.writeInt32(4,this.iAppId)},r.GetCdnTokenExReq.prototype.readFrom=function(t){this.sFlvUrl=t.readString(0,!1,this.sFlvUrl),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iLoopTime=t.readInt32(2,!1,this.iLoopTime),this.tId=t.readStruct(3,!1,this.tId),this.iAppId=t.readInt32(4,!1,this.iAppId)},r.GetCdnTokenExRsp=function(){this.sFlvToken="",this.iExpireTime=0},r.GetCdnTokenExRsp.prototype._clone=function(){return new r.GetCdnTokenExRsp},r.GetCdnTokenExRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetCdnTokenExRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetCdnTokenExRsp.prototype.writeTo=function(t){t.writeString(0,this.sFlvToken),t.writeInt32(1,this.iExpireTime)},r.GetCdnTokenExRsp.prototype.readFrom=function(t){this.sFlvToken=t.readString(0,!1,this.sFlvToken),this.iExpireTime=t.readInt32(1,!1,this.iExpireTime)},r.LiveScenarioType={ECommon_Live:0,EAudio_Only:1,EVideo_Only:2,ELink_Live:3},r.LimitedStreamInfo=function(){this.iVerMin=0,this.iVerMax=0,this.sCdnType="",this.iIsMaster=0,this.lChannelId=0,this.lSubChannelId=0,this.lPresenterUid=0,this.sStreamName="",this.sFlvUrl="",this.sFlvUrlSuffix="",this.sFlvAntiCode="",this.sHlsUrl="",this.sHlsUrlSuffix="",this.sHlsAntiCode="",this.iLineIndex=0,this.iIsMultiStream=0,this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.vFlvIPList=new s.Vector(new s.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pUrlSuffix="",this.sP2pAntiCode="",this.lFreeFlag=0},r.LimitedStreamInfo.prototype._clone=function(){return new r.LimitedStreamInfo},r.LimitedStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LimitedStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LimitedStreamInfo.prototype.writeTo=function(t){t.writeInt32(0,this.iVerMin),t.writeInt32(1,this.iVerMax),t.writeString(2,this.sCdnType),t.writeInt32(3,this.iIsMaster),t.writeInt64(4,this.lChannelId),t.writeInt64(5,this.lSubChannelId),t.writeInt64(6,this.lPresenterUid),t.writeString(7,this.sStreamName),t.writeString(8,this.sFlvUrl),t.writeString(9,this.sFlvUrlSuffix),t.writeString(10,this.sFlvAntiCode),t.writeString(11,this.sHlsUrl),t.writeString(12,this.sHlsUrlSuffix),t.writeString(13,this.sHlsAntiCode),t.writeInt32(14,this.iLineIndex),t.writeInt32(15,this.iIsMultiStream),t.writeInt32(16,this.iPCPriorityRate),t.writeInt32(17,this.iWebPriorityRate),t.writeInt32(18,this.iMobilePriorityRate),t.writeVector(19,this.vFlvIPList),t.writeInt32(20,this.iIsP2PSupport),t.writeString(21,this.sP2pUrl),t.writeString(22,this.sP2pUrlSuffix),t.writeString(23,this.sP2pAntiCode),t.writeInt64(24,this.lFreeFlag)},r.LimitedStreamInfo.prototype.readFrom=function(t){this.iVerMin=t.readInt32(0,!1,this.iVerMin),this.iVerMax=t.readInt32(1,!1,this.iVerMax),this.sCdnType=t.readString(2,!1,this.sCdnType),this.iIsMaster=t.readInt32(3,!1,this.iIsMaster),this.lChannelId=t.readInt64(4,!1,this.lChannelId),this.lSubChannelId=t.readInt64(5,!1,this.lSubChannelId),this.lPresenterUid=t.readInt64(6,!1,this.lPresenterUid),this.sStreamName=t.readString(7,!1,this.sStreamName),this.sFlvUrl=t.readString(8,!1,this.sFlvUrl),this.sFlvUrlSuffix=t.readString(9,!1,this.sFlvUrlSuffix),this.sFlvAntiCode=t.readString(10,!1,this.sFlvAntiCode),this.sHlsUrl=t.readString(11,!1,this.sHlsUrl),this.sHlsUrlSuffix=t.readString(12,!1,this.sHlsUrlSuffix),this.sHlsAntiCode=t.readString(13,!1,this.sHlsAntiCode),this.iLineIndex=t.readInt32(14,!1,this.iLineIndex),this.iIsMultiStream=t.readInt32(15,!1,this.iIsMultiStream),this.iPCPriorityRate=t.readInt32(16,!1,this.iPCPriorityRate),this.iWebPriorityRate=t.readInt32(17,!1,this.iWebPriorityRate),this.iMobilePriorityRate=t.readInt32(18,!1,this.iMobilePriorityRate),this.vFlvIPList=t.readVector(19,!1,this.vFlvIPList),this.iIsP2PSupport=t.readInt32(20,!1,this.iIsP2PSupport),this.sP2pUrl=t.readString(21,!1,this.sP2pUrl),this.sP2pUrlSuffix=t.readString(22,!1,this.sP2pUrlSuffix),this.sP2pAntiCode=t.readString(23,!1,this.sP2pAntiCode),this.lFreeFlag=t.readInt64(24,!1,this.lFreeFlag)},r.ClassifiedStreamInfoPack=function(){this.iLiveScenarioType=0,this.vStreamInfo=new s.Vector(new r.LimitedStreamInfo),this.vCdnList=new s.Vector(new s.STRING),this.lLiveId=0,this.sLinkGroupId="",this.mStreamRatioWeb=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioPC=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioMobile=new s.Map(new s.STRING,new s.INT32)},r.ClassifiedStreamInfoPack.prototype._clone=function(){return new r.ClassifiedStreamInfoPack},r.ClassifiedStreamInfoPack.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClassifiedStreamInfoPack.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClassifiedStreamInfoPack.prototype.writeTo=function(t){t.writeInt32(0,this.iLiveScenarioType),t.writeVector(1,this.vStreamInfo),t.writeVector(2,this.vCdnList),t.writeInt64(3,this.lLiveId),t.writeString(4,this.sLinkGroupId),t.writeMap(5,this.mStreamRatioWeb),t.writeMap(6,this.mStreamRatioPC),t.writeMap(7,this.mStreamRatioMobile)},r.ClassifiedStreamInfoPack.prototype.readFrom=function(t){this.iLiveScenarioType=t.readInt32(0,!1,this.iLiveScenarioType),this.vStreamInfo=t.readVector(1,!1,this.vStreamInfo),this.vCdnList=t.readVector(2,!1,this.vCdnList),this.lLiveId=t.readInt64(3,!1,this.lLiveId),this.sLinkGroupId=t.readString(4,!1,this.sLinkGroupId),this.mStreamRatioWeb=t.readMap(5,!1,this.mStreamRatioWeb),this.mStreamRatioPC=t.readMap(6,!1,this.mStreamRatioPC),this.mStreamRatioMobile=t.readMap(7,!1,this.mStreamRatioMobile)},r.LivingStreamInfoNotice=function(){this.lPresenterUid=0,this.lLiveId=0,this.mStreamInfo=new s.Map(new s.INT32,new r.ClassifiedStreamInfoPack)},r.LivingStreamInfoNotice.prototype._clone=function(){return new r.LivingStreamInfoNotice},r.LivingStreamInfoNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LivingStreamInfoNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LivingStreamInfoNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeInt64(1,this.lLiveId),t.writeMap(2,this.mStreamInfo)},r.LivingStreamInfoNotice.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.lLiveId=t.readInt64(1,!1,this.lLiveId),this.mStreamInfo=t.readMap(2,!1,this.mStreamInfo)},r.LivingStreamEndNotice=function(){this.sStreamName="",this.sCdnType="",this.iLineIndex=0,this.lLiveId=0,this.iLiveScenarioType=0},r.LivingStreamEndNotice.prototype._clone=function(){return new r.LivingStreamEndNotice},r.LivingStreamEndNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LivingStreamEndNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LivingStreamEndNotice.prototype.writeTo=function(t){t.writeString(0,this.sStreamName),t.writeString(1,this.sCdnType),t.writeInt32(2,this.iLineIndex),t.writeInt64(3,this.lLiveId),t.writeInt32(4,this.iLiveScenarioType)},r.LivingStreamEndNotice.prototype.readFrom=function(t){this.sStreamName=t.readString(0,!1,this.sStreamName),this.sCdnType=t.readString(1,!1,this.sCdnType),this.iLineIndex=t.readInt32(2,!1,this.iLineIndex),this.lLiveId=t.readInt64(3,!1,this.lLiveId),this.iLiveScenarioType=t.readInt32(4,!1,this.iLiveScenarioType)},r.GetLivingStreamInfoReq=function(){this.tId=new r.UserId,this.lTopSid=0,this.lSubSid=0,this.lPresenterUid=0,this.sTraceSource=""},r.GetLivingStreamInfoReq.prototype._clone=function(){return new r.GetLivingStreamInfoReq},r.GetLivingStreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetLivingStreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetLivingStreamInfoReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTopSid),t.writeInt64(2,this.lSubSid),t.writeInt64(3,this.lPresenterUid),t.writeString(4,this.sTraceSource)},r.GetLivingStreamInfoReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.lTopSid=t.readInt64(1,!1,this.lTopSid),this.lSubSid=t.readInt64(2,!1,this.lSubSid),this.lPresenterUid=t.readInt64(3,!1,this.lPresenterUid),this.sTraceSource=t.readString(4,!1,this.sTraceSource)},r.GetLivingStreamInfoRsp=function(){this.bIsLiving=0,this.tNotice=new r.LivingStreamInfoNotice,this.bIsSelfLiving=0},r.GetLivingStreamInfoRsp.prototype._clone=function(){return new r.GetLivingStreamInfoRsp},r.GetLivingStreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetLivingStreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetLivingStreamInfoRsp.prototype.writeTo=function(t){t.writeInt32(0,this.bIsLiving),t.writeStruct(1,this.tNotice),t.writeInt32(2,this.bIsSelfLiving)},r.GetLivingStreamInfoRsp.prototype.readFrom=function(t){this.bIsLiving=t.readInt32(0,!1,this.bIsLiving),this.tNotice=t.readStruct(1,!1,this.tNotice),this.bIsSelfLiving=t.readInt32(2,!1,this.bIsSelfLiving)},r.VideoClientReportReq=function(){this.iReportType=0,this.sReportString="",this.sMsg=new s.BinBuffer,this.lUid=0},r.VideoClientReportReq.prototype._clone=function(){return new r.VideoClientReportReq},r.VideoClientReportReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoClientReportReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoClientReportReq.prototype.writeTo=function(t){t.writeInt32(0,this.iReportType),t.writeString(1,this.sReportString),t.writeBytes(2,this.sMsg),t.writeInt64(3,this.lUid)},r.VideoClientReportReq.prototype.readFrom=function(t){this.iReportType=t.readInt32(0,!1,this.iReportType),this.sReportString=t.readString(1,!1,this.sReportString),this.sMsg=t.readBytes(2,!1,this.sMsg),this.lUid=t.readInt64(3,!1,this.lUid)},r.LiveMeetingSyncNotice=function(){this.tStat=new r.MeetingStat,this.vSeats=new s.Vector(new r.MeetingSeat),this.iVersion=0,this.sMessage=""},r.LiveMeetingSyncNotice.prototype._clone=function(){return new r.LiveMeetingSyncNotice},r.LiveMeetingSyncNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LiveMeetingSyncNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LiveMeetingSyncNotice.prototype.writeTo=function(t){t.writeStruct(0,this.tStat),t.writeVector(1,this.vSeats),t.writeInt32(2,this.iVersion),t.writeString(3,this.sMessage)},r.LiveMeetingSyncNotice.prototype.readFrom=function(t){this.tStat=t.readStruct(0,!1,this.tStat),this.vSeats=t.readVector(1,!1,this.vSeats),this.iVersion=t.readInt32(2,!1,this.iVersion),this.sMessage=t.readString(3,!1,this.sMessage)},r.MeetingStat=function(){this.lPresenterUid=0,this.sPresenterNick="",this.sPresenterAvatarUrl="",this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iVersion=0,this.iCurAction=0,this.sPassword="",this.lSessionId=0,this.vApplyList=new s.Vector(new r.ApplyUser),this.iState=0,this.iSilence=0,this.iActiveTime=0,this.iLastSyncTime=0,this.mpUserSession=new s.Map(new s.INT64,new s.STRING),this.iBeginTime=0,this.iPresenterGender=0,this.tTransferRoom=new r.TransferLiveRoomState,this.iMode=0,this.iModeV2=0},r.MeetingStat.prototype._clone=function(){return new r.MeetingStat},r.MeetingStat.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MeetingStat.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MeetingStat.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeString(1,this.sPresenterNick),t.writeString(2,this.sPresenterAvatarUrl),t.writeMap(4,this.mpContext),t.writeInt32(5,this.iVersion),t.writeInt32(6,this.iCurAction),t.writeString(7,this.sPassword),t.writeInt64(8,this.lSessionId),t.writeVector(9,this.vApplyList),t.writeInt32(10,this.iState),t.writeInt32(11,this.iSilence),t.writeInt32(12,this.iActiveTime),t.writeInt32(13,this.iLastSyncTime),t.writeMap(14,this.mpUserSession),t.writeInt32(15,this.iBeginTime),t.writeInt32(16,this.iPresenterGender),t.writeStruct(17,this.tTransferRoom),t.writeInt32(18,this.iMode),t.writeInt32(19,this.iModeV2)},r.MeetingSeat=function(){this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iPos=0,this.iLocked=0,this.lUid=0,this.sNick="",this.sAvatarUrl="",this.iMute=0,this.iVersion=0,this.iCurAction=0,this.iActiveTime=0,this.iSilence=0,this.iGender=0,this.lOfferSeatTimeStamp=0,this.iSilenceTime=0,this.iMuteTime=0,this.iSeatType=0,this.iSeatTypeV2=0,this.sSeatUrl="",this.sCharm="",this.sName="",this.sSourceUrl=""},r.MeetingSeat.prototype._clone=function(){return new r.MeetingSeat},r.MeetingSeat.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MeetingSeat.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MeetingSeat.prototype.writeTo=function(t){t.writeMap(0,this.mpContext),t.writeInt32(1,this.iPos),t.writeInt32(2,this.iLocked),t.writeInt64(3,this.lUid),t.writeString(4,this.sNick),t.writeString(5,this.sAvatarUrl),t.writeInt32(7,this.iMute),t.writeInt32(8,this.iVersion),t.writeInt32(9,this.iCurAction),t.writeInt32(10,this.iActiveTime),t.writeInt32(11,this.iSilence),t.writeInt32(12,this.iGender),t.writeInt64(13,this.lOfferSeatTimeStamp),t.writeInt32(14,this.iSilenceTime),t.writeInt32(15,this.iMuteTime),t.writeInt32(16,this.iSeatType),t.writeInt32(17,this.iSeatTypeV2),t.writeString(18,this.sSeatUrl),t.writeString(19,this.sCharm),t.writeString(20,this.sName),t.writeString(21,this.sSourceUrl)},r.MeetingSeat.prototype.readFrom=function(t){this.mpContext=t.readMap(0,!1,this.mpContext),this.iPos=t.readInt32(1,!1,this.iPos),this.iLocked=t.readInt32(2,!1,this.iLocked),this.lUid=t.readInt64(3,!1,this.lUid),this.sNick=t.readString(4,!1,this.sNick),this.sAvatarUrl=t.readString(5,!1,this.sAvatarUrl),this.iMute=t.readInt32(7,!1,this.iMute),this.iVersion=t.readInt32(8,!1,this.iVersion),this.iCurAction=t.readInt32(9,!1,this.iCurAction),this.iActiveTime=t.readInt32(10,!1,this.iActiveTime),this.iSilence=t.readInt32(11,!1,this.iSilence),this.iGender=t.readInt32(12,!1,this.iGender),this.lOfferSeatTimeStamp=t.readInt64(13,!1,this.lOfferSeatTimeStamp),this.iSilenceTime=t.readInt32(14,!1,this.iSilenceTime),this.iMuteTime=t.readInt32(15,!1,this.iMuteTime),this.iSeatType=t.readInt32(16,!1,this.iSeatType),this.iSeatTypeV2=t.readInt32(17,!1,this.iSeatTypeV2),this.sSeatUrl=t.readString(18,!1,this.sSeatUrl),this.sCharm=t.readString(19,!1,this.sCharm),this.sName=t.readString(20,!1,this.sName),this.sSourceUrl=t.readString(21,!1,this.sSourceUrl)},r.ApplyUser=function(){this.lUid=0,this.sNick="",this.sAvatarUrl="",this.lActiveTime=0,this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iGender=0,this.sStreamName="",this.iSeatType=0},r.ApplyUser.prototype._clone=function(){return new r.ApplyUser},r.ApplyUser.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ApplyUser.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ApplyUser.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sNick),t.writeString(2,this.sAvatarUrl),t.writeInt64(3,this.lActiveTime),t.writeMap(4,this.mpContext),t.writeInt32(5,this.iGender),t.writeString(6,this.sStreamName),t.writeInt32(7,this.iSeatType)},r.ApplyUser.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sNick=t.readString(1,!1,this.sNick),this.sAvatarUrl=t.readString(2,!1,this.sAvatarUrl),this.lActiveTime=t.readInt64(3,!1,this.lActiveTime),this.mpContext=t.readMap(4,!1,this.mpContext),this.iGender=t.readInt32(5,!1,this.iGender),this.sStreamName=t.readString(6,!1,this.sStreamName),this.iSeatType=t.readInt32(7,!1,this.iSeatType)},r.TransferLiveRoomState=function(){this.lTargetUid=0,this.iInviteTime=0,this.iTokeOverTime=0,this.iBeginLiveTime=0,this.lNewLiveId=0,this.iInviteExpire=0,this.iState=0,this.iResult=0,this.iSuccessTime=0,this.sTargetNick=""},r.TransferLiveRoomState.prototype._clone=function(){return new r.TransferLiveRoomState},r.TransferLiveRoomState.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.TransferLiveRoomState.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.TransferLiveRoomState.prototype.writeTo=function(t){t.writeInt64(0,this.lTargetUid),t.writeInt32(1,this.iInviteTime),t.writeInt32(2,this.iTokeOverTime),t.writeInt32(3,this.iBeginLiveTime),t.writeInt64(4,this.lNewLiveId),t.writeInt32(5,this.iInviteExpire),t.writeInt32(6,this.iState),t.writeInt32(7,this.iResult),t.writeInt32(8,this.iSuccessTime),t.writeString(9,this.sTargetNick)},r.TransferLiveRoomState.prototype.readFrom=function(t){this.lTargetUid=t.readInt64(0,!1,this.lTargetUid),this.iInviteTime=t.readInt32(1,!1,this.iInviteTime),this.iTokeOverTime=t.readInt32(2,!1,this.iTokeOverTime),this.iBeginLiveTime=t.readInt32(3,!1,this.iBeginLiveTime),this.lNewLiveId=t.readInt64(4,!1,this.lNewLiveId),this.iInviteExpire=t.readInt32(5,!1,this.iInviteExpire),this.iState=t.readInt32(6,!1,this.iState),this.iResult=t.readInt32(7,!1,this.iResult),this.iSuccessTime=t.readInt32(8,!1,this.iSuccessTime),this.sTargetNick=t.readString(9,!1,this.sTargetNick)},r.GetP2PStreamInfoReq=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0},r.GetP2PStreamInfoReq.prototype._clone=function(){return new r.GetP2PStreamInfoReq},r.GetP2PStreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iP2PType)},r.GetP2PStreamInfoReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iP2PType=t.readInt32(2,!1,this.iP2PType)},r.GetP2PStreamInfoRsp=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0,this.sP2PToken="",this.iP2PExpireTime=0,this.sP2PUrl="",this.sCodecType="",this.sCdnBrand="",this.mpOption=new s.Map(new s.INT16,new s.INT64),this.line=0},r.GetP2PStreamInfoRsp.prototype._clone=function(){return new r.GetP2PStreamInfoRsp},r.GetP2PStreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iP2PType),t.writeString(3,this.sP2PToken),t.writeInt32(4,this.iP2PExpireTime),t.writeString(5,this.sP2PUrl),t.writeString(6,this.sCodecType),t.writeString(7,this.sCdnBrand),t.writeMap(8,this.mpOption),t.writeUInt8(9,this.line)},r.GetP2PStreamInfoRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iP2PType=t.readInt32(2,!1,this.iP2PType),this.sP2PToken=t.readString(3,!1,this.sP2PToken),this.iP2PExpireTime=t.readInt32(4,!1,this.iP2PExpireTime),this.sP2PUrl=t.readString(5,!1,this.sP2PUrl),this.sCodecType=t.readString(6,!1,this.sCodecType),this.sCdnBrand=t.readString(7,!1,this.sCdnBrand),this.mpOption=t.readMap(8,!1,this.mpOption),this.line=t.readUInt8(9,!1,this.line)},r.GetP2PStreamTokenExReq=function(){this.sStreamName="",this.iLoopTime=0},r.GetP2PStreamTokenExReq.prototype._clone=function(){return new r.GetP2PStreamTokenExReq},r.GetP2PStreamTokenExReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamTokenExReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamTokenExReq.prototype.writeTo=function(t){t.writeString(0,this.sStreamName),t.writeInt32(1,this.iLoopTime)},r.GetP2PStreamTokenExReq.prototype.readFrom=function(t){this.sStreamName=t.readString(0,!1,this.sStreamName),this.iLoopTime=t.readInt32(1,!1,this.iLoopTime)},r.GetP2PStreamTokenExRsp=function(){this.sP2PToken="",this.iExpireTime=0},r.GetP2PStreamTokenExRsp.prototype._clone=function(){return new r.GetP2PStreamTokenExRsp},r.GetP2PStreamTokenExRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamTokenExRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamTokenExRsp.prototype.writeTo=function(t){t.writeString(0,this.sP2PToken),t.writeInt32(1,this.iExpireTime)},r.GetP2PStreamTokenExRsp.prototype.readFrom=function(t){this.sP2PToken=t.readString(0,!1,this.sP2PToken),this.iExpireTime=t.readInt32(1,!1,this.iExpireTime)},r.HttpDnsItem=function(){this.vIp=new s.Vector(new s.STRING),this.iExpireTime=0,this.vIpv6=new s.Vector(new s.STRING)},r.HttpDnsItem.prototype._clone=function(){return new r.HttpDnsItem},r.HttpDnsItem.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.HttpDnsItem.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.HttpDnsItem.prototype.writeTo=function(t){t.writeVector(0,this.vIp),t.writeInt64(1,this.iExpireTime),t.writeVector(2,this.vIpv6)},r.HttpDnsItem.prototype.readFrom=function(t){this.vIp=t.readVector(0,!1,this.vIp),this.iExpireTime=t.readInt64(1,!1,this.iExpireTime),this.vIpv6=t.readVector(2,!1,this.vIpv6)},r.QueryHttpDnsReq=function(){this.lUid=0,this.sUA="",this.vDomain=new s.Vector(new s.STRING),this.sAppSrc=""},r.QueryHttpDnsReq.prototype._clone=function(){return new r.QueryHttpDnsReq},r.QueryHttpDnsReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QueryHttpDnsReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QueryHttpDnsReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sUA),t.writeVector(2,this.vDomain),t.writeString(3,this.sAppSrc)},r.QueryHttpDnsReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sUA=t.readString(1,!1,this.sUA),this.vDomain=t.readVector(2,!1,this.vDomain),this.sAppSrc=t.readString(3,!1,this.sAppSrc)},r.QueryHttpDnsRsp=function(){this.mDomain2Ip=new s.Map(new s.STRING,new r.HttpDnsItem)},r.QueryHttpDnsRsp.prototype._clone=function(){return new r.QueryHttpDnsRsp},r.QueryHttpDnsRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QueryHttpDnsRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QueryHttpDnsRsp.prototype.writeTo=function(t){t.writeMap(0,this.mDomain2Ip)},r.QueryHttpDnsRsp.prototype.readFrom=function(t){this.mDomain2Ip=t.readMap(0,!1,this.mDomain2Ip)},r.WSTimeSyncReq=function(){this.sGuid="",this.lClientTime=0},r.WSTimeSyncReq.prototype._clone=function(){return new r.WSTimeSyncReq},r.WSTimeSyncReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.WSTimeSyncReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.WSTimeSyncReq.prototype.writeTo=function(t){t.writeString(0,this.sGuid),t.writeInt64(1,this.lClientTime)},r.WSTimeSyncReq.prototype.readFrom=function(t){this.sGuid=t.readString(0,!1,this.sGuid),this.lClientTime=t.readInt64(1,!1,this.lClientTime)},r.WSTimeSyncRsp=function(){this.lServerTime=0},r.WSTimeSyncRsp.prototype._clone=function(){return new r.WSTimeSyncRsp},r.WSTimeSyncRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.WSTimeSyncRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.WSTimeSyncRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lServerTime)},r.WSTimeSyncRsp.prototype.readFrom=function(t){this.lServerTime=t.readInt64(0,!1,this.lServerTime)},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iTokenType=0,this.iAppid=0,this.bAnonymous=0,this.sStrUid=""},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaUserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaUserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType),t.writeInt32(6,this.iAppid),t.writeInt32(7,this.bAnonymous),t.writeString(8,this.sStrUid)},r.MediaUserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sUA=t.readString(3,!1,this.sUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType),this.iAppid=t.readInt32(6,!1,this.iAppid),this.bAnonymous=t.readInt32(7,!1,this.bAnonymous),this.sStrUid=t.readString(8,!1,this.sStrUid)},r.LoginVerifyReq=function(){this.tId=new r.MediaUserId,this.iCookieDeadTime=0},r.LoginVerifyReq.prototype._clone=function(){return new r.LoginVerifyReq},r.LoginVerifyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LoginVerifyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LoginVerifyReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt32(1,this.iCookieDeadTime)},r.LoginVerifyReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.iCookieDeadTime=t.readInt32(1,!1,this.iCookieDeadTime)},r.LoginVerifyRsp=function(){this.iResCode=0,this.lUid=0,this.sCookie="",this.sUid="",this.iAppId=0},r.LoginVerifyRsp.prototype._clone=function(){return new r.LoginVerifyRsp},r.LoginVerifyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LoginVerifyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LoginVerifyRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iResCode),t.writeInt64(1,this.lUid),t.writeString(2,this.sCookie),t.writeString(3,this.sUid),t.writeInt32(4,this.iAppId)},r.LoginVerifyRsp.prototype.readFrom=function(t){this.iResCode=t.readInt32(0,!1,this.iResCode),this.lUid=t.readInt64(1,!1,this.lUid),this.sCookie=t.readString(2,!1,this.sCookie),this.sUid=t.readString(3,!1,this.sUid),this.iAppId=t.readInt32(4,!1,this.iAppId)},r.JoinMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupReq.prototype._clone=function(){return new r.JoinMediaGroupReq},r.JoinMediaGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.JoinMediaGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.JoinMediaGroupReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vGroupId)},r.JoinMediaGroupReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.vGroupId=t.readVector(1,!1,this.vGroupId)},r.JoinMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupRsp.prototype._clone=function(){return new r.JoinMediaGroupRsp},r.JoinMediaGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.JoinMediaGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.JoinMediaGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iCode),t.writeString(1,this.sMsg),t.writeVector(2,this.vGroupId)},r.JoinMediaGroupRsp.prototype.readFrom=function(t){this.iCode=t.readInt32(0,!1,this.iCode),this.sMsg=t.readString(1,!1,this.sMsg),this.vGroupId=t.readVector(2,!1,this.vGroupId)},r.QuitMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupReq.prototype._clone=function(){return new r.QuitMediaGroupReq},r.QuitMediaGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QuitMediaGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QuitMediaGroupReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vGroupId)},r.QuitMediaGroupReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.vGroupId=t.readVector(1,!1,this.vGroupId)},r.QuitMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupRsp.prototype._clone=function(){return new r.QuitMediaGroupRsp},r.QuitMediaGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QuitMediaGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QuitMediaGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iCode),t.writeString(1,this.sMsg),t.writeVector(2,this.vGroupId)},r.QuitMediaGroupRsp.prototype.readFrom=function(t){this.iCode=t.readInt32(0,!1,this.iCode),this.sMsg=t.readString(1,!1,this.sMsg),this.vGroupId=t.readVector(2,!1,this.vGroupId)},r.ikk=1,r.skk="123",r.eIType={k4AM:10001,k6AM:10002},r.EM_PCDN_MODE={E_PcdnMode_Min:0,E_PcdnMode_P2pHttpSubstream:1,E_PcdnMode_P2pOutsideSdkSubstream:2,E_PcdnMode_FlvHttpFullstream:3,E_PcdnMode_FlvOutsideSdkFullstream:4,E_PcdnMode_Max:255},r.EM_BUSI_TYPE={E_BusiType_Min:0,E_BusiType_Live:1,E_BusiType_Max:255},r.EM_CLINET_TYPE={E_CLIENT_MIN:0,E_CLIENT_PC:1,E_CLIENT_ADR:2,E_CLIENT_IOS:3,E_CLIENT_WEB:4,E_CLIENT_MAX:255},r.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP={E_SUCCESS:0,E_HYGW_ERR:1,E_PCDNGW_40X:2,E_PCDNGW_50X:3,E_PCDNGW_TIO:4,E_PCDNGW_RSPERR:5,E_CLIREQ_ERR:6,E_PCDN_OFF:7,E_LIMIT_FLOWS:8},r.MyReq=function(){this.name="",this.opt="",this.mMap=new s.Map(new s.STRING,new s.STRING)},r.MyReq.prototype._clone=function(){return new r.MyReq},r.MyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MyReq.prototype.writeTo=function(t){t.writeString(0,this.name),t.writeString(1,this.opt),t.writeMap(2,this.mMap)},r.MyReq.prototype.readFrom=function(t){this.name=t.readString(0,!1,this.name),this.opt=t.readString(1,!1,this.opt),this.mMap=t.readMap(2,!1,this.mMap)},r.MyRsp=function(){this.value=0,this.origin=new r.MyReq,this.types=new s.Vector(new s.INT32),this.eType=0},r.MyRsp.prototype._clone=function(){return new r.MyRsp},r.MyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MyRsp.prototype.writeTo=function(t){t.writeInt32(0,this.value),t.writeStruct(1,this.origin),t.writeVector(2,this.types),t.writeInt32(3,this.eType)},r.MyRsp.prototype.readFrom=function(t){this.value=t.readInt32(0,!1,this.value),this.origin=t.readStruct(1,!1,this.origin),this.types=t.readVector(2,!1,this.types),this.eType=t.readInt32(3,!1,this.eType)},r.ClientQueryPcdnScheduleReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.vPcdnMode=new s.Vector(new s.INT32),this.iBusiType=0,this.sStreamName="",this.mPcdnModeCliSupportPcdns=new s.Map(new s.INT32,new s.Vector(new s.STRING))},r.ClientQueryPcdnScheduleReq.prototype._clone=function(){return new r.ClientQueryPcdnScheduleReq},r.ClientQueryPcdnScheduleReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientQueryPcdnScheduleReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientQueryPcdnScheduleReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeInt32(5,this.iCliType),t.writeInt64(6,this.lBucketPara),t.writeVector(30,this.vPcdnMode),t.writeInt32(31,this.iBusiType),t.writeString(32,this.sStreamName),t.writeMap(100,this.mPcdnModeCliSupportPcdns)},r.ClientQueryPcdnScheduleReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.iCliType=t.readInt32(5,!1,this.iCliType),this.lBucketPara=t.readInt64(6,!1,this.lBucketPara),this.vPcdnMode=t.readVector(30,!1,this.vPcdnMode),this.iBusiType=t.readInt32(31,!1,this.iBusiType),this.sStreamName=t.readString(32,!1,this.sStreamName),this.mPcdnModeCliSupportPcdns=t.readMap(100,!1,this.mPcdnModeCliSupportPcdns)},r.ClientQueryPcdnScheduleRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.mPcdnModeSwitch=new s.Map(new s.INT32,new s.INT32),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.mPcdnModePcdnName=new s.Map(new s.INT32,new s.STRING)},r.ClientQueryPcdnScheduleRsp.prototype._clone=function(){return new r.ClientQueryPcdnScheduleRsp},r.ClientQueryPcdnScheduleRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientQueryPcdnScheduleRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientQueryPcdnScheduleRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeMap(10,this.mPcdnModeSwitch),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamName),t.writeMap(200,this.mPcdnModePcdnName)},r.ClientQueryPcdnScheduleRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.mPcdnModeSwitch=t.readMap(10,!1,this.mPcdnModeSwitch),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamName=t.readString(102,!1,this.sStreamName),this.mPcdnModePcdnName=t.readMap(200,!1,this.mPcdnModePcdnName)},r.ClientGetStunAndPcdnProxyReq=function(){this.lReqTs=0,this.lUid=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.curPcdnName=""},r.ClientGetStunAndPcdnProxyReq.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyReq},r.ClientGetStunAndPcdnProxyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetStunAndPcdnProxyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetStunAndPcdnProxyReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sStreamname),t.writeInt32(3,this.iBaseSubs),t.writeVector(4,this.vSub),t.writeString(5,this.sGuid),t.writeInt64(6,this.lAnchorUid),t.writeInt32(7,this.iCdnLine),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeString(11,this.curPcdnName)},r.ClientGetStunAndPcdnProxyReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sStreamname=t.readString(2,!1,this.sStreamname),this.iBaseSubs=t.readInt32(3,!1,this.iBaseSubs),this.vSub=t.readVector(4,!1,this.vSub),this.sGuid=t.readString(5,!1,this.sGuid),this.lAnchorUid=t.readInt64(6,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(7,!1,this.iCdnLine),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.curPcdnName=t.readString(11,!1,this.curPcdnName)},r.PCdnProxyUrl=function(){this.sProtocol="",this.vUrl=new s.Vector(new s.STRING),this.iStatusPcdn=0,this.iPcdnThresholdHotDegreeIn=-1,this.iPcdnThresholdHotDegreeKick=-1,this.iPcdnNowHotDegree=-1,this.iPcdnNowPullstreamUcnt=-1,this.iPcdnNowGetpcdnUcnt=-1},r.PCdnProxyUrl.prototype._clone=function(){return new r.PCdnProxyUrl},r.PCdnProxyUrl.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.PCdnProxyUrl.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.PCdnProxyUrl.prototype.writeTo=function(t){t.writeString(0,this.sProtocol),t.writeVector(2,this.vUrl),t.writeInt32(3,this.iStatusPcdn),t.writeInt32(10,this.iPcdnThresholdHotDegreeIn),t.writeInt32(11,this.iPcdnThresholdHotDegreeKick),t.writeInt32(12,this.iPcdnNowHotDegree),t.writeInt32(13,this.iPcdnNowPullstreamUcnt),t.writeInt32(14,this.iPcdnNowGetpcdnUcnt)},r.PCdnProxyUrl.prototype.readFrom=function(t){this.sProtocol=t.readString(0,!1,this.sProtocol),this.vUrl=t.readVector(2,!1,this.vUrl),this.iStatusPcdn=t.readInt32(3,!1,this.iStatusPcdn),this.iPcdnThresholdHotDegreeIn=t.readInt32(10,!1,this.iPcdnThresholdHotDegreeIn),this.iPcdnThresholdHotDegreeKick=t.readInt32(11,!1,this.iPcdnThresholdHotDegreeKick),this.iPcdnNowHotDegree=t.readInt32(12,!1,this.iPcdnNowHotDegree),this.iPcdnNowPullstreamUcnt=t.readInt32(13,!1,this.iPcdnNowPullstreamUcnt),this.iPcdnNowGetpcdnUcnt=t.readInt32(14,!1,this.iPcdnNowGetpcdnUcnt)},r.ClientGetStunAndPcdnProxyRsp=function(){this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sStreamname="",this.iErrCode=0,this.iBaseSubs=0,this.mSubToPullStreamUrl=new s.Map(new s.INT32,new s.Map(new s.STRING,new r.PCdnProxyUrl)),this.cliProv="",this.cliIsp="",this.pcdnName="",this.iCdnLine=0,this.sPcdnIsp="",this.sPcdnArea=""},r.ClientGetStunAndPcdnProxyRsp.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyRsp},r.ClientGetStunAndPcdnProxyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetStunAndPcdnProxyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetStunAndPcdnProxyRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt64(2,this.lUid),t.writeString(3,this.sStreamname),t.writeInt32(4,this.iErrCode),t.writeInt32(5,this.iBaseSubs),t.writeMap(12,this.mSubToPullStreamUrl),t.writeString(13,this.cliProv),t.writeString(14,this.cliIsp),t.writeString(15,this.pcdnName),t.writeInt32(100,this.iCdnLine),t.writeString(200,this.sPcdnIsp),t.writeString(201,this.sPcdnArea)},r.ClientGetStunAndPcdnProxyRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.lUid=t.readInt64(2,!1,this.lUid),this.sStreamname=t.readString(3,!1,this.sStreamname),this.iErrCode=t.readInt32(4,!1,this.iErrCode),this.iBaseSubs=t.readInt32(5,!1,this.iBaseSubs),this.mSubToPullStreamUrl=t.readMap(12,!1,this.mSubToPullStreamUrl),this.cliProv=t.readString(13,!1,this.cliProv),this.cliIsp=t.readString(14,!1,this.cliIsp),this.pcdnName=t.readString(15,!1,this.pcdnName),this.iCdnLine=t.readInt32(100,!1,this.iCdnLine),this.sPcdnIsp=t.readString(200,!1,this.sPcdnIsp),this.sPcdnArea=t.readString(201,!1,this.sPcdnArea)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeString(5,this.sStreamname),t.writeInt32(6,this.iBaseSubs),t.writeVector(7,this.vSub),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeVector(11,this.vCliSupportPcdns),t.writeString(12,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.sStreamname=t.readString(5,!1,this.sStreamname),this.iBaseSubs=t.readInt32(6,!1,this.iBaseSubs),this.vSub=t.readVector(7,!1,this.vSub),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=t.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=t.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.mP2pSubstreamUrl=new s.Map(new s.INT32,new s.STRING),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamname=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeString(10,this.sPcdnName),t.writeMap(11,this.mP2pSubstreamUrl),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamname)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.sPcdnName=t.readString(10,!1,this.sPcdnName),this.mP2pSubstreamUrl=t.readMap(11,!1,this.mP2pSubstreamUrl),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamname=t.readString(102,!1,this.sStreamname)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sCodec="",this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeString(5,this.sStreamName),t.writeInt32(6,this.iRatio),t.writeString(7,this.sCodec),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeVector(11,this.vCliSupportPcdns),t.writeString(12,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.sStreamName=t.readString(5,!1,this.sStreamName),this.iRatio=t.readInt32(6,!1,this.iRatio),this.sCodec=t.readString(7,!1,this.sCodec),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=t.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=t.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.sFlvFullstreamUrl="",this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sTransUid=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeString(10,this.sPcdnName),t.writeString(11,this.sFlvFullstreamUrl),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamName),t.writeInt32(103,this.iRatio),t.writeString(104,this.sTransUid)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.sPcdnName=t.readString(10,!1,this.sPcdnName),this.sFlvFullstreamUrl=t.readString(11,!1,this.sFlvFullstreamUrl),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamName=t.readString(102,!1,this.sStreamName),this.iRatio=t.readInt32(103,!1,this.iRatio),this.sTransUid=t.readString(104,!1,this.sTransUid)},r.RecSysInfo=function(){this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.sStrategy="",this.lServerTs=0,this.lAction=0,this.sActionReason="",this.sActValue=""},r.RecSysInfo.prototype._clone=function(){return new r.RecSysInfo},r.RecSysInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysInfo.prototype.writeTo=function(t){t.writeString(0,this.sAnchorUid),t.writeString(1,this.sRoomId),t.writeString(2,this.sDispatchId),t.writeInt32(3,this.iScene),t.writeString(4,this.sStrategy),t.writeInt64(5,this.lServerTs),t.writeInt64(6,this.lAction),t.writeString(7,this.sActionReason),t.writeString(8,this.sActValue)},r.RecSysInfo.prototype.readFrom=function(t){this.sAnchorUid=t.readString(0,!1,this.sAnchorUid),this.sRoomId=t.readString(1,!1,this.sRoomId),this.sDispatchId=t.readString(2,!1,this.sDispatchId),this.iScene=t.readInt32(3,!1,this.iScene),this.sStrategy=t.readString(4,!1,this.sStrategy),this.lServerTs=t.readInt64(5,!1,this.lServerTs),this.lAction=t.readInt64(6,!1,this.lAction),this.sActionReason=t.readString(7,!1,this.sActionReason),this.sActValue=t.readString(8,!1,this.sActValue)},r.RecSysReq=function(){this.tId=new r.MediaUserId,this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.bDebug=0,this.sNet="",this.sSdkVer="",this.mAppendInfo=new s.Map(new s.STRING,new s.STRING)},r.RecSysReq.prototype._clone=function(){return new r.RecSysReq},r.RecSysReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeString(1,this.sAnchorUid),t.writeString(2,this.sRoomId),t.writeString(3,this.sDispatchId),t.writeInt32(4,this.iScene),t.writeInt32(5,this.bDebug),t.writeString(6,this.sNet),t.writeString(7,this.sSdkVer),t.writeMap(8,this.mAppendInfo)},r.RecSysReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.sAnchorUid=t.readString(1,!1,this.sAnchorUid),this.sRoomId=t.readString(2,!1,this.sRoomId),this.sDispatchId=t.readString(3,!1,this.sDispatchId),this.iScene=t.readInt32(4,!1,this.iScene),this.bDebug=t.readInt32(5,!1,this.bDebug),this.sNet=t.readString(6,!1,this.sNet),this.sSdkVer=t.readString(7,!1,this.sSdkVer),this.mAppendInfo=t.readMap(8,!1,this.mAppendInfo)},r.RecSysRsp=function(){this.iStatus=0,this.sError="",this.tRecSysInfo=new r.RecSysInfo},r.RecSysRsp.prototype._clone=function(){return new r.RecSysRsp},r.RecSysRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iStatus),t.writeString(1,this.sError),t.writeStruct(2,this.tRecSysInfo)},r.RecSysRsp.prototype.readFrom=function(t){this.iStatus=t.readInt32(0,!1,this.iStatus),this.sError=t.readString(1,!1,this.sError),this.tRecSysInfo=t.readStruct(2,!1,this.tRecSysInfo)},r.RecSysNotice=function(){this.tRecSysInfo=new r.RecSysInfo},r.RecSysNotice.prototype._clone=function(){return new r.RecSysNotice},r.RecSysNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysNotice.prototype.writeTo=function(t){t.writeStruct(0,this.tRecSysInfo)},r.RecSysNotice.prototype.readFrom=function(t){this.tRecSysInfo=t.readStruct(0,!1,this.tRecSysInfo)}},function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var r=s(16);function n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function a(t){return(a="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}var o=s(15);function h(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?Object(o.a)(t):e}function u(t){return function(){var e,i=Object(r.a)(t);if(n()){var s=Object(r.a)(this).constructor;e=Reflect.construct(i,arguments,s)}else e=i.apply(this,arguments);return h(this,e)}}},function(t,e,i){"use strict";function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}i.d(e,"a",(function(){return r}))},function(t,e,i){"use strict";function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}i.d(e,"a",(function(){return s}))},function(t,e,i){"use strict";function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.d(e,"a",(function(){return s}))},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=i(14),a=i(13),o=i(19),h=i(5),u=i(0),c=i(12),l=i(20),d=i(25),p=!!Number(localStorage._printProtocol),f=!!Number(localStorage._printGateway),_=function(t){Object(n.a)(i,t);var e=Object(a.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this)).WEBSOCKET_CONNECTED="WEBSOCKET_CONNECTED",t.WEBSOCKET_CLOSED="WEBSOCKET_CLOSED",t.WEBSOCKET_ERROR="WEBSOCKET_ERROR",t.TAFLINK_INITED="TAFLINK_INITED",t._taf=null,t.delayWup=[],t.delayListener=[],t.streamName=null,t.requestId=1,t}return Object(r.a)(i,[{key:"getRequestId",value:function(){return this.requestId++,1e5===this.requestId&&(this.requestId=1),this.requestId}},{key:"getTaf",value:function(){return this._taf}},{key:"setTafHandler",value:function(t){var e=h.a.now();u.a.log("%c[TIME] initTafTime="+e,"color:#A23400;background:#FFF5C2"),t.getTaf&&c.default.setTaf(t.getTaf()),t.registerUriMap(y.UriMapping),t.registerWupMap(y.WupMapping),this._taf=t,this._taf.connected?this._onConnected():this._taf.addListener(this.WEBSOCKET_CONNECTED,this._onConnected.bind(this)),this.emit(this.TAFLINK_INITED)}},{key:"_onConnected",value:function(){u.a.log("TafLink._onConnected sendWup size=".concat(this.delayWup.length));var t=this;this.delayWup.forEach((function(e){var i=e.servantName,s=e.funcName,r=e.data,n=e.callback,a=e.once,o=e.iRequestId,h=e.noTid;t.sendWup(i,s,r,n,a,o,h)})),this.delayWup=[],this.delayListener.forEach((function(e){var i=e.p0,s=e.p1,r=e.p2;switch(i){case"add":t.addListener(s,r);break;case"remove":t.removeListener(s,r);break;case"dispatch":t.dispatch(s,r)}})),this.delayListener=[]}},{key:"getUserId",value:function(){return this._taf.getUserId()}},{key:"sendWup",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!this.connected)return u.a.log("TafLink.sendWup connected=false",t,e),void this.delayWup.push({servantName:t,funcName:e,data:i,callback:s,once:r,iRequestId:n,noTid:a});this._taf.sendWup2?this._taf.sendWup2(t,e,i,s,r,n,a):this._taf.sendWup(t,e,i,s,r,n,a)}},{key:"sendYY",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._taf){var n=t.constructor.name,a=l.a[n];a||"function"!=typeof t.marshall||(a=new DataView(t.marshall().buffer).getUint32(4,!0)),p&&u.a.log("%c>>>>>>> "+n,m("#009100"),"uri="+a,t);var o=null,h="mediaui",_="getInfoFromVGM";if("function"==typeof this._taf.packVGInfo)o=this._taf.packVGInfo(a,t,this.streamName);else{var y=this._taf.getTaf().BinBuffer;h="videogateway",_=r?"getInfoFromCdnVG":"getInfoFromVG",(o=new c.default.GetInfoFromVGReq).lUid=i||0,o.sMsg=new y(t.marshall().buffer),o.sProtoName="yy",o.iUri=a||0,o.lSid=0,o.tId=this.getUserId()}this.sendWup(h,_,o,function(i){if(0!=i.sMsg.len){if(!i.lUid||!o.lUid||i.lUid==o.lUid){var s=new DataView(i.sMsg.buffer),r=new d.a(s);if(!(n=l.a[r.uri]))throw f||u.a.log("%c<<<<<<< %crspWup:%c GetInfoFromVG",m("#0000E3"),m("black"),m("#0000E3"),"videogateway",i),new Error("[x] Unmatched protocol, uri=".concat(r.uri>>8," resCode=").concat(r.resCode," len=").concat(r.len));var a=r;p&&u.a.log("%c<<<<<<< "+n,m("#0000E3"),a),"function"==typeof e?e(a):this.dispatch(r.uri,a)}}else u.a.warn("GetInfoFromVG response an empty pkg.",t,o,i)}.bind(this),s)}else u.a.warn("TafLink.sendYY taf not init!")}},{key:"addListener",value:function(t,e){this.connected?this._taf.addListener(t,e):this.delayListener.push({p0:"add",p1:t,p2:e})}},{key:"removeListener",value:function(t,e){this.connected?this._taf.removeListener(t,e):this.delayListener.push({p0:"remove",p1:t,p2:e})}},{key:"dispatch",value:function(t,e){this.connected?this._taf.dispatch(t,e):this.delayListener.push({p0:"dispatch",p1:t,p2:e})}},{key:"inited",get:function(){return!!this._taf}},{key:"connected",get:function(){return this._taf&&this._taf.connected}}]),i}(o.EventEmitter);function m(t,e,i){var s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s}var y={UriMapping:{8102:c.default.LivingStreamInfoNotice,8103:c.default.LivingStreamEndNotice,1025601:c.default.LiveMeetingSyncNotice},WupMapping:{getInfoFromVG:c.default.GetInfoFromVGRsp,GetInfoFromVG:c.default.GetInfoFromVGRsp,getInfoFromCdnVG:c.default.GetInfoFromVGRsp,getCdnTokenInfoEx:c.default.GetCdnTokenExRsp,getLivingStreamInfo:c.default.GetLivingStreamInfoRsp,getP2PStreamInfo:c.default.GetP2PStreamInfoRsp,getP2PStreamTokenInfoEx:c.default.GetP2PStreamTokenExRsp,queryHttpDns:c.default.QueryHttpDnsRsp,loginVerify:c.default.LoginVerifyRsp,joinGroup:c.default.JoinMediaGroupRsp,quitGroup:c.default.QuitMediaGroupRsp,wsTimeSync:c.default.WSTimeSyncRsp,onClientGetStunAndPcdnProxyReq:c.default.ClientGetStunAndPcdnProxyRsp,clientQueryPcdnSchedule:c.default.ClientQueryPcdnScheduleRsp,onClientGetPcdnFlvOutsideSdkFullstreamInfo:c.default.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp,getMediaRec:c.default.RecSysRsp},NoLog:{8102:1,8103:1,1025601:1,getInfoFromVG:1,GetInfoFromVG:1,getInfoFromCdnVG:1,getInfoFromVGM:1,getCdnTokenInfoEx:1,videoClientReport:1}},v=new _;e.default=v},function(t,e,i){"use strict";e.a={NO_DATA:1,NO_DECODE:2,WORKER_ERROR:3,DECODE_ERROR:4,RENDER_ERROR:5,NO_RENDER:6,RECEIVE_LIST_OUT_LIMIT:7,YUV_OUT_LIMIT:8,WASM_TIMEOUT:9,CREATE_WEBGL_FAIL:10,CREATE_WORKER_ERROR:11,AUDIO_FAST:12,VIDEO_FAST:13,START_CODE_ERROR:14,dic:{1:"20s无数据",2:"10s无解码",3:"worker异常",4:"解码失败",5:"渲染失败",6:"10s无渲染",7:"解码前队列大于2000",8:"yuv队列大于300",9:"wasm timeout",10:"创建webgl失败",11:"web worker异常",12:"音频快，视频慢，切264",13:"音频慢，视频快，切264",14:"hevcFindNextStartCode failed"}}},function(t,e,s){"use strict";var r,n="object"==("undefined"==typeof Reflect?"undefined":i(Reflect))?Reflect:null,a=n&&"function"==typeof n.apply?n.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function h(){h.init.call(this)}t.exports=h,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var u=10;function c(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+i(t))}function l(t){return void 0===t._maxListeners?h.defaultMaxListeners:t._maxListeners}function d(t,e,i,s){var r,n,a,o;if(c(i),void 0===(n=t._events)?(n=t._events=Object.create(null),t._eventsCount=0):(void 0!==n.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),n=t._events),a=n[e]),void 0===a)a=n[e]=i,++t._eventsCount;else if("function"==typeof a?a=n[e]=s?[i,a]:[a,i]:s?a.unshift(i):a.push(i),(r=l(t))>0&&a.length>r&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,o=h,console&&console.warn&&console.warn(o)}return t}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,i){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=p.bind(s);return r.listener=i,s.wrapFn=r,r}function _(t,e,i){var s=t._events;if(void 0===s)return[];var r=s[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):y(r,r.length)}function m(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function y(t,e){for(var i=new Array(e),s=0;s<e;++s)i[s]=t[s];return i}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");u=t}}),h.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},h.prototype.getMaxListeners=function(){return l(this)},h.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var n;if(e.length>0&&(n=e[0]),n instanceof Error)throw n;var o=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw o.context=n,o}var h=r[t];if(void 0===h)return!1;if("function"==typeof h)a(h,this,e);else{var u=h.length,c=y(h,u);for(i=0;i<u;++i)a(c[i],this,e)}return!0},h.prototype.addListener=function(t,e){return d(this,t,e,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(t,e){return d(this,t,e,!0)},h.prototype.once=function(t,e){return c(e),this.on(t,f(this,t,e)),this},h.prototype.prependOnceListener=function(t,e){return c(e),this.prependListener(t,f(this,t,e)),this},h.prototype.removeListener=function(t,e){var i,s,r,n,a;if(c(e),void 0===(s=this._events))return this;if(void 0===(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,n=i.length-1;n>=0;n--)if(i[n]===e||i[n].listener===e){a=i[n].listener,r=n;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(s[t]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",t,a||e)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(t){var e,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,n=Object.keys(i);for(s=0;s<n.length;++s)"removeListener"!==(r=n[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},h.prototype.listeners=function(t){return _(this,t,!0)},h.prototype.rawListeners=function(t){return _(this,t,!1)},h.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):m.call(t,e)},h.prototype.listenerCount=m,h.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,i){"use strict";var s={PAudienceGetProxyListReq:530178,PAudienceGetProxyListRsp:530434,PNotifyStreamSwitch:268034,PLoginVideoProxyUniformly:5650690,PLoginVideoProxyUniformlyRes:5650434,PNotifyCurrentCdnStream:2739202,PNotifyCurrentStream4:2675714,PSubscribeStream3:2667266,PSubscribeStreamRes3:2667522,PStreamData3:2666754,PStopStream3:2666498,PStopStream:2560514,PPullStreamData:2694146,PResendStreamData4:2689026,PResendStreamDataFailAck:2694402,PVideoSyncSpeakerTime3:2674690,PForceConnectVideoProxy3:2685442,PVideoProxyPing3:2669570,PVideoProxyPingRes4:2683650,PNotifyMultiVideo:2746370,PLoginAndSubscribe:4097282,PLoginAndSubscribeRes:4097538,PNotifyUplinkRecvCount3:2672642,PVideoBroadcast4:2754050,PUpdateVideoConfig2:2569474,PVideoQualityStatistics:2591746,PP2pPing2:40706,PP2pPing3:41218,PP2pVideoPing3:2671874,VIDEOP2P_PFlashP2PKeepAlive:3072514,VIDEOP2P_PFlashP2PKeepAliveRes:3072770,P2PGetNodesProxy3:2673410,P2PGetNodesProxyRes3:2673666,P2PSubscribeStream3:2673922,P2PRemoveSubscribe3:2674178,P2PKeepAlive:3074562,P2PKeepAliveRes:3074818,P2PNotifyNodeLeave:3075074,P2PSyncDepth:3075330,P2PKeepAliveWebrtc:3075842,P2PKeepAliveWebrtcRes:3076098,PP2PWSForward:2757378,PP2PWSForwardReject:5653506,P2PSubStream:3073026,P2PSubStreamRes:3073282,P2PSyncSubTree:3073538,P2PTest:3073794,P2PRemoveSub:3074306,P2PRemoveSubRes:3075586,P2PStreamAlive:3076354,P2POffer:12316162,P2PAnswer:12316418,P2PCandidate:12316674,P2POfferReject:12316930,P2PRequestOffer:12317186,P2PVersionFailed:12317442,P2PPingOverProxy:12317698,P2PPunchBackReq:12317954,P2PPunchBackRsp:12318210,PCDNNotifyUrl:20740866,PCDNStatusReport:20741122,PCDNGetUrl:20741378,PCDNSwitchUrl:20741634,PCdnP2PWSForward:53283,PCdnP2PWSForwardReject:53539,PCdnProxyPing:26147,PCdnProxyPingRes:26403,PCdnP2PStatics:26659,PCdnP2PErrStatics:26915,PCdnP2pGetNode:51235,PCdnP2pGetNodeRes:51491,PCdnP2PNodePingThroughProxy:52259,PCdnP2PNodePunchThroughProxy:52515,PCdnP2PUserRegister:52771,PCdnP2PUserRegisterRes:53027,PCdnP2pReportLog:54051,PCdnForceConnectVideoProxy:54563,PCDNGetProxyListReq:153635,PCDNGetProxyListRsp:153891,PCDNGetSliceStreamInfoReq:154147,PCDNGetSliceStreamInfoRsp:154403,PCDNSubscribeReq:768547,PCDNSubscribeRes:768803,PCDNCompeteSubscribeReq:769059,PCDNCompeteSubscribeRes:769315,PCDNForceSubscribeNotify:769571,PCdnP2pUserUnRegister:770083,PP2pSliceData:511779,PP2pSliceAudioData:512035,PP2pSliceVideoData:512291,PP2pSliceCommonData:514083,PP2pSliceSignalData:514595,PP2pSliceControlData:1024547,PForceConnectCdnVideoProxy3:2711042,HuyaDelaySeiData:17920770};!function t(){if(!t.done){t.done=!0;var e=[];for(var i in s){var r=s[i];e.push({uri:r,name:i})}e.forEach((function(t){s[t.uri]=t.name}))}}(),e.a=s},function(t,e,s){t.exports=function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==i(t)&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function a(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function h(t,e){var i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(var n=0;n<s;n++)r+="0";return r+t}function u(){var t=new Date,e=t.getFullYear(),i=h(t.getMonth()+1,2),s=h(t.getDate(),2),r=h(t.getHours(),2),n=h(t.getMinutes(),2),a=h(t.getSeconds(),2);return"["+"".concat(e,"-").concat(i,"-").concat(s," ").concat(r,":").concat(n,":").concat(a)+"."+h(t.getMilliseconds(),3)+"][w265]"}s.r(e);var c=[];function l(){for(var t,e=u(),i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];s[0]=e+s[0],self.logCallback?(t=self.logCallback).call.apply(t,[null].concat(s)):c.push(s)}var d=function(){function t(e,i){r(this,t),this.width=e,this.height=i,this.stridey=this.width,this.strideu=this.stridey/2,this.stridev=this.stridey/2}return a(t,[{key:"calc",value:function(t){for(var e=new Uint8Array(this.stridey*this.height).fill(128,0,this.stridey*this.height),i=new Uint8Array(this.strideu*this.height).fill(128,0,this.strideu*this.height),s=new Uint8Array(this.stridev*this.height).fill(128,0,this.stridev*this.height),r=new Uint8Array(this.width*this.height*4),n=1e3*window.performance.now(),a=0;a<t;a++)this.convertYUV420(e,i,s,this.width,this.height,this.stridey,this.strideu,this.stridev,r);return 1e3*window.performance.now()-n}},{key:"convertYUV420",value:function(t,e,i,s,r,n,a,o,h){for(var u,c,l,d,p,f=0,_=0,m=s>>1,y=m*r,v=0,S=0,g=0,T=0;T<y;T++)p=T<<1,u=1.164*(t[v+(d=f<<1)]-16),c=e[S+f]-128,l=i[g+f]-128,h[0+(p<<2)]=u+1.596*l,h[1+(p<<2)]=u-.813*l-.391*c,h[2+(p<<2)]=u+2.018*c,h[3+(p<<2)]=255,u=1.164*(t[v+d+1]-16),h[0+(p+1<<2)]=u+1.596*l,h[1+(p+1<<2)]=u-.813*l-.391*c,h[2+(p+1<<2)]=u+2.018*c,h[3+(p+1<<2)]=255,++f===m&&(f=0,v+=n,S=(++_>>1)*a,g=(_>>1)*o)}}]),t}(),p=function(){function t(){r(this,t)}return a(t,null,[{key:"isSupportWasm",value:function(){return"object"==("undefined"==typeof WebAssembly?"undefined":i(WebAssembly))}},{key:"isSupportWasmThread",value:function(){if("undefined"==typeof SharedArrayBuffer||"undefined"==typeof Atomics)return l("hevcd","SharedArrayBuffer undefined or Atomics undefined"),!1;var t=new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer instanceof SharedArrayBuffer;return self.SharedArrayBuffer&&self.Atomics&&t}}]),t}(),f=function(){function t(){r(this,t),this.cla="hevcd",this.configs=null,this.costUs=0,this.reason=0,this.cores=navigator.hardwareConcurrency,this.is64bit=this.is64bitSoftware(),this.enableCost=!0}return a(t,[{key:"parseConfigs",value:function(t){this.configs=t,l(this.cla,"parse",JSON.stringify(t),"cfg",this.configs.enableWebH265)}},{key:"isSupportH265",value:function(t,e){if(null==this.configs)return l(this.cla,"isSupportH265 configs==null"),!1;this.reason=0;var i=this.isConfigEnable()&&this.isCPUCoresSatisfy(e)&&this.isWasm()&&this.isBitrateInRange(e)&&this.isCostInRange(e);return l(this.cla,"isSupportH265",i,"kbps=",e,"costUs",this.costUs.toFixed(0),"cores",this.cores,"64b",this.is64bit,"reason",this.reason,"version",t,"cfg",JSON.stringify(this.configs)),l("ua:",navigator.userAgent),{isSupport:i,costUs:this.costUs.toFixed(0),reason:this.reason}}},{key:"isWasm",value:function(){return!!p.isSupportWasm()||(this.reason=7,!1)}},{key:"isConfigEnable",value:function(){return!(!this.hasOwnProperty("enableWebH265")||1!=this.configs.enableWebH265&&(this.reason=1,1))}},{key:"isCPUCoresSatisfy",value:function(t){if(this.hasOwnProperty("core")){var e=this.configs.core[4e3];if(this.configs.core.hasOwnProperty(t)&&(e=this.configs.core[t]),this.cores>e)return!0}else if(this.cores>4)return!0;return this.reason=2,!1}},{key:"is64bitSoftware",value:function(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}},{key:"isBitrateInRange",value:function(t){return p.isSupportWasmThread()?!(!this.hasOwnProperty("multiThreadBitKbps")||((t>=4e3||0==t)&&!this.checkX86(t)?(this.reason=4,1):(!Array.isArray(this.configs.multiThreadBitKbps)||!this.configs.multiThreadBitKbps.includes(t))&&(this.reason=3,1))):(this.reason=6,!1)}},{key:"checkX86",value:function(t){if(this.is64bit)return!0;if(!this.hasOwnProperty("x86"))return!1;var e=!1;return this.configs.x86.hasOwnProperty(t)&&(e=1==this.configs.x86[t]),e}},{key:"isCostInRange",value:function(t){if(!this.enableCost)return!0;if(!this.hasOwnProperty("baseCostUs"))return!1;var e=this.configs.baseCostUs[2e3];return this.configs.baseCostUs.hasOwnProperty(t)&&(e=this.configs.baseCostUs[t]),this.costUs=this.getCost(),this.costUs<=e||(this.reason=5,!1)}},{key:"getCost",value:function(){var t=this;if(!this.hasOwnProperty("loopCount"))return l(this.cla,"getCost configs==null or has no key=loopCount"),0;var e=0;return localStorage.hasOwnProperty("w265LastCost")&&(e=Number(localStorage.w265LastCost)),this.sid&&clearTimeout(this.sid),this.sid=setTimeout((function(){var e=new d(120,120);localStorage.w265LastCost=Math.floor(e.calc(t.configs.loopCount))}),5e3),e}},{key:"hasOwnProperty",value:function(t){return!!this.configs.hasOwnProperty(t)||(this.reason=1,!1)}}]),t}(),_=function(){function t(){r(this,t),this.configMgr=new f}return a(t,[{key:"parseConfigs",value:function(t){this.configMgr.parseConfigs(t)}},{key:"isSupportH265",value:function(t){return this.configMgr.isSupportH265(this.version(),t)}},{key:"version",value:function(){return"1.5.2"}},{key:"setLogCallback",value:function(t){var e;e=t,self.logCallback=e,l("Logger setLogCallback"),c.length>0&&(c.forEach((function(t){var e;(e=self.logCallback).call.apply(e,[null].concat(function(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t)))})),c.length=0)}},{key:"isStripe",value:function(){return-1!==navigator.userAgent.indexOf("Windows")}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();e.default=_}]).default},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=function(){function t(){Object(s.a)(this,t),this.uid=0,this.encoderSource=0,this.uploadType=0,this.frameDts=0,this.caputureTime=0,this.encodeEndTime=0,this.sendFrameTime=0}return Object(r.a)(t,[{key:"unmarshall",value:function(t){this.uid=t.popUInt64(),this.encoderSource=t.popUInt8(),this.uploadType=t.popUInt8(),this.frameDts=t.popUInt64(),this.caputureTime=t.popUInt64(),this.encodeEndTime=t.popUInt64(),this.sendFrameTime=t.popUInt64()}}]),t}();e.default=n},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=i(24),a=function(){function t(){Object(s.a)(this,t),this.dtsGapSum=0,this.delaySum=0,this.serverInfos=[]}return Object(r.a)(t,[{key:"unmarshall",value:function(t){this.dtsGapSum=t.popInt64(),this.delaySum=t.popUInt64();for(var e=t.popUInt32();e>0;){e--;var i=new n.default;i.unmarshall(t),this.serverInfos.push(i)}}}]),t}();e.default=a},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=function(){function t(){Object(s.a)(this,t),this.enable=0,//!=0时表示有效数据
this.proxyIdLow=0,this.proxyIdHigh=0,this.proxyType=0,this.serverDelay=0,this.lastPeriodDelay=0}return Object(r.a)(t,[{key:"unmarshall",value:function(t){this.enable=t.popUInt8(),this.proxyIdLow=t.popUInt32(),this.proxyIdHigh=t.popUInt32(),this.proxyType=t.popUInt16(),this.serverDelay=t.popUInt32(),this.lastPeriodDelay=t.popUInt32()}},{key:"getProxyIdStr",value:function(){return this.proxyIdHigh.toString(16)+this.proxyIdLow.toString(16)}}]),t}();e.default=n},function(t,e,i){"use strict";var s=i(3),r=i(2),n=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,t),this.view=e,this.pos=0,this.len=0,this.uri=0,this.resCode=0,!0===i&&(this.len=this.popUInt32(),this.uri=this.popUInt32(),this.resCode=this.popUInt16())}return Object(r.a)(t,[{key:"bytesAvailable",value:function(){return this.view.byteLength-this.pos}},{key:"popBool",value:function(){return 1==this.popUInt8()}},{key:"popUInt8",value:function(){if(this.pos+1>this.view.byteLength)return 0;var t=this.view.getUint8(this.pos);return this.pos++,t}},{key:"popUInt16",value:function(){if(this.pos+2>this.view.byteLength)return 0;var t=this.view.getUint16(this.pos,!0);return this.pos+=2,t}},{key:"popUInt32",value:function(){if(this.pos+4>this.view.byteLength)return 0;var t=this.view.getUint32(this.pos,!0);return this.pos+=4,t}},{key:"popUInt64",value:function(){if(this.pos+8>this.view.byteLength)return 0;var t=this.view.getUint32(this.pos,!0);this.pos+=4;var e=this.view.getUint32(this.pos,!0);return this.pos+=4,4294967296*e+t}},{key:"popInt64",value:function(){for(var t=0,e=(128&this.view.getUint8(this.pos+7))>0,i=!0,s=0;s<8;s++){var r=this.view.getUint8(this.pos+s);e&&(i?0!=r&&(r=255&~(r-1),i=!1):r=255&~r),t+=r*Math.pow(2,8*s)}return e&&(t=-t),this.pos+=8,t}},{key:"popUint8Array",value:function(){var t=this.popUInt16();if(this.pos+t>this.view.byteLength)return null;var e=new Uint8Array(this.view.buffer,this.pos,t);return this.pos+=t,e.slice()}},{key:"popUint8Array32",value:function(){var t=this.popUInt32();if(this.pos+t>this.view.byteLength)return null;var e=new Uint8Array(this.view.buffer,this.pos,t);return this.pos+=t,e.slice()}},{key:"popUInt64Vector",value:function(){var t=this.popUInt32();if(this.pos+8*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt64());return e}},{key:"popUInt32Vector",value:function(){var t=this.popUInt32();if(this.pos+4*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt32());return e}},{key:"popUInt16Vector",value:function(){var t=this.popUInt32();if(this.pos+2*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt16());return e}},{key:"popString",value:function(){var t=this.popUInt16();if(this.pos+t>this.view.byteLength)return null;for(var e=[],i=0;i<t;++i)e[i]=String.fromCharCode(this.popUInt8());return e.join("")}},{key:"popMapKey8Val32",value:function(){for(var t=this.popUInt32(),e=new Map,i=0;i<t;i++){var s=this.popUInt8(),r=this.popUInt32();e.set(s,r)}return e}},{key:"popMapKey64Val64",value:function(){for(var t=this.popUInt32(),e=new Map,i=0;i<t;i++){var s=this.popUInt64(),r=this.popUInt64();e.set(s,r)}return e}}]),t}();e.a=n},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=function(){function t(){Object(s.a)(this,t),this.systime=0,this.encode_delay=0,this.send_buffer=0}return Object(r.a)(t,[{key:"unmarshall",value:function(t){this.systime=t.popUInt64(),this.encode_delay=t.popUInt32(),this.send_buffer=t.popUInt32()}}]),t}();e.default=n},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=i(22),a=i(23),o=function(){function t(){Object(s.a)(this,t),this.anchorSei=new n.default,this.serverSei=new a.default}return Object(r.a)(t,[{key:"unmarshall",value:function(t){this.anchorSei.unmarshall(t),this.serverSei.unmarshall(t)}}]),t}();e.default=o},function(t,e,i){function s(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var s=i(i.s=ENTRY_MODULE);return s.default||s}function r(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(t,e,s){var n={};n[s]=[];var a=e.toString(),o=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return n;for(var h,u=o[1],c=new RegExp("(\\\\n|\\W)"+r(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");h=c.exec(a);)"dll-reference"!==h[3]&&n[s].push(h[3]);for(c=new RegExp("\\("+r(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");h=c.exec(a);)t[h[2]]||(n[s].push(h[1]),t[h[2]]=i(h[1]).m),n[h[2]]=n[h[2]]||[],n[h[2]].push(h[4]);for(var l,d=Object.keys(n),p=0;p<d.length;p++)for(var f=0;f<n[d[p]].length;f++)l=n[d[p]][f],isNaN(1*l)||(n[d[p]][f]=1*n[d[p]][f]);return n}function a(t){return Object.keys(t).reduce((function(e,i){return e||t[i].length>0}),!1)}t.exports=function(t,e){e=e||{};var r={main:i.m},o=e.all?{main:Object.keys(r.main)}:function(t,e){for(var i={main:[e]},s={main:[]},r={main:{}};a(i);)for(var o=Object.keys(i),h=0;h<o.length;h++){var u=o[h],c=i[u].pop();if(r[u]=r[u]||{},!r[u][c]&&t[u][c]){r[u][c]=!0,s[u]=s[u]||[],s[u].push(c);for(var l=n(t,t[u][c],u),d=Object.keys(l),p=0;p<d.length;p++)i[d[p]]=i[d[p]]||[],i[d[p]]=i[d[p]].concat(l[d[p]])}}return s}(r,t),h="";Object.keys(o).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;o[t][e];)e++;o[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o[t].map((function(e){return JSON.stringify(e)+": "+r[t][e].toString()})).join(",")+"});\n"})),h=h+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o.main.map((function(t){return JSON.stringify(t)+": "+r.main[t].toString()})).join(",")+"}))(self);";var u=new window.Blob([h],{type:"text/javascript"});if(e.bare)return u;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),l=new window.Worker(c);return l.objectURL=c,l}},function(t,e){t.exports=function(t){console.log("[ Timer worker init ]");var e=null;function i(){clearInterval(e),e=null}t.addEventListener("message",(function(s){switch(s.data){case"start":i(),e=setInterval((function(){t.postMessage({})}),10);break;case"stop":i()}})),t.addEventListener("messageerror",(function(t){console.error("[TimerWorker.messageerror]",t)}))}},function(t,e,i){var s={"./AnchorDtsSei":22,"./AnchorDtsSei.js":22,"./AnchorSeiInfo":26,"./AnchorSeiInfo.js":26,"./HuyaDelaySeiData":27,"./HuyaDelaySeiData.js":27,"./ServerDtsSei":23,"./ServerDtsSei.js":23,"./ServerNodeInfo":24,"./ServerNodeInfo.js":24};function r(t){var e=n(t);return i(e)}function n(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=n,t.exports=r,r.id=30},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=function(){function t(){Object(s.a)(this,t)}return Object(r.a)(t,null,[{key:"isSupported",value:function(){return!1}}]),t}();e.default=n},function(t,e,i){"use strict";i.r(e);var s=i(3),r=i(2),n=i(8),a=i(4),o=i(17),u=i(0),c=i(5),l=i(1),d=function(){function t(e){var i=e.eventEmiter,r=e.stat;Object(s.a)(this,t),this.eventEmiter=i,this.stat=r,this.isSendLoadTime=!1,this.isSendH265=!1,this.hasP2P=0,this.restartReason=-1,this.restartTimes=0,this.turnToFlvReason=-1,this.turnToFlvTimes=0,this.httpError=!1,this.busiSource=""}return Object(r.a)(t,[{key:"sendCdnTime",value:function(t,e,i){if(!this.isSendLoadTime)if(this.isSendLoadTime=!0,e){var s=Math.max(0,t.connectVideoTime-t.startTime),r=t.firstVideoPkgTime-t.connectVideoTime,n=t.firstIFrameTime1-t.connectVideoTime,a=t.firstIFrameTime2-t.firstIFrameTime1,o=t.firstRenderTime-t.firstIFrameTime2,h=t.onPlayTime-t.firstRenderTime,u=t.recvDataTime-t.startTime,c=(t.onPlayTime,t.startTime,t.firstP2POnDataTime-t.startTime);c=c<0?0:c;var d=0;t.firstP2PIframeTime>0&&(d=(d=t.firstP2PIframeTime-t.startTime)<0?0:d);var p=[t.hyPlayerLoadTs,u,s,0,0,i,0,0,0,c,d],f=[this.stat.createAct(l.a.ACT.CONNECT_VIDEO_TS,{value:[s]}),this.stat.createAct(l.a.ACT.FIRST_VIDEO_PKG_TS,{value:[r]}),this.stat.createAct(l.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[n]}),this.stat.createAct(l.a.ACT.VIDEO_IFRAME_TS,{value:[a]}),this.stat.createAct(l.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[o]}),this.stat.createAct(l.a.ACT.VIDEO_PLAYED_TS,{value:[h]}),this.stat.createAct(l.a.ACT.VIDEO_LOAD_TS,{value:p})];this.sendMetrics(f)}else{var _=t.getVPTime-t.startTime,m=Math.max(0,t.connectVideoTime-t.getVPTime),y=t.loginTime-t.connectVideoTime,v=t.firstVideoPkgTime-t.loginTime,S=t.firstIFrameTime-t.firstVideoPkgTime,g=t.firstRenderTime-t.firstIFrameTime,T=t.onPlayTime-t.firstRenderTime,w=t.onPlayTime-t.startTime,I=[this.stat.createAct(l.a.ACT.VIDEO_GET_VP_TS,{value:[_]}),this.stat.createAct(l.a.ACT.CONNECT_VIDEO_TS,{value:[m]}),this.stat.createAct(l.a.ACT.VIDEO_LOGIN_TS,{value:[y]}),this.stat.createAct(l.a.ACT.FIRST_VIDEO_PKG_TS,{value:[v]}),this.stat.createAct(l.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[S]}),this.stat.createAct(l.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[g]}),this.stat.createAct(l.a.ACT.VIDEO_PLAYED_TS,{value:[T]}),this.stat.createAct(l.a.ACT.VIDEO_LOAD_TS,{value:[w]})];this.sendMetrics(I)}}},{key:"sendFlvTime",value:function(t,e,i,s){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;if((!this.isSendLoadTime||r)&&(this.isSendLoadTime=!0,!(t>1e4||e>1e4))){var c=0;a&&(c+=1),n&&(c+=2),this.stat.setComDim(l.a.DIM_COM.ACT_LOAD_TYPE,c);var d=[t,i,e,n,a,o,0,0,0,h,u],p=[this.stat.createAct(l.a.ACT.VIDEO_LOAD_TS,{value:d}),this.stat.createAct(l.a.ACT.CONNECT_VIDEO_TS,{value:[e]}),this.stat.createAct(l.a.ACT.RECV_VIDEO_TS,{value:[i,s]})];this.sendMetrics(p)}}},{key:"sendWebRtcTime",value:function(t,e,i,s,r){this.isSendLoadTime=!0,this.stat.setActDim("p2p","3");var n=[this.stat.createAct(l.a.ACT.VIDEO_LOAD_TS,{value:[t,0,0,0,0,e,i,s,r]})];this.sendMetrics(n)}},{key:"sendHlsTime",value:function(t,e,i,s,r,n){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!this.isSendLoadTime){var h=0;if(o&&(h+=1),a&&(h+=2),this.stat.setComDim(l.a.DIM_COM.ACT_LOAD_TYPE,h),this.isSendLoadTime=!0,!(e>1e4||i>1e4||r>1e4)){var u=[this.stat.createAct(l.a.ACT.VIDEO_LOAD_TS,{value:[e,t,0,a,o],str:[this.busiSource]}),this.stat.createAct(l.a.ACT.LOAD_M3U8_TS,{value:[i,t]}),this.stat.createAct(l.a.ACT.FIRST_FRAG_LOAD_TS,{value:[s,t]}),this.stat.createAct(l.a.ACT.FIRST_FRAG_LOADED_TS,{value:[r,t]}),this.stat.createAct(l.a.ACT.FIRST_FRAG_SIZE,{value:[n,t]})];this.sendMetrics(u)}}}},{key:"setBusiSource",value:function(t){this.busiSource=t}},{key:"sendMP4Time",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.loadTime;if(!(e>1e4)){var i=[this.stat.createAct(l.a.ACT.VIDEO_LOAD_TS,{value:[e],str:[this.busiSource]})];this.sendMetrics(i)}}},{key:"sendMetrics",value:function(t){this.eventEmiter.trigger(n.c.DATA_METRIC2,t)}},{key:"sendOldMetrics",value:function(t){this.eventEmiter.trigger(n.c.DATA_METRIC,t)}}]),t}();d.METRIC={VIDEO_FLOW_LINE:"video.flow.line",VIDEO_FLOW_P2P:"video.flow.p2p",VIDEO_BAD_QUALITY_RATIO:"video.video_bad_quality_ratio",WEB_HLS_PLAY_VIDEO_RATIO:"web.hls.play_video_ratio",WEB_HLS_PLAY_SUC_RATIO:"web.hls.play_suc_ratio",WEB_P2P_PLAY_RATIO:"web.p2p.play_ratio",WEB_P2P_PUNCH:"web.p2p.punch",WEB_P2P_BW_P2P_VALID:"web.p2p.bw_p2p_valid",WEB_P2P_BW_P2P_REPEAT:"web.p2p.bw_p2p_repeat",WEB_P2P_BW_P2P_TOTAL:"web.p2p.bw_p2p_total",WEB_P2P_BW_CDN_VALID:"web.p2p.bw_cdn_valid",WEB_P2P_BW_CDN_REPEAT:"web.p2p.bw_cdn_repeat",WEB_P2P_BW_CDN_TOTAL:"web.p2p.bw_cdn_total",WEB_P2P_BW_RANGE_VALID:"web.p2p.bw_range_valid",WEB_P2P_BW_RANGE_TOTAL:"web.p2p.bw_range_total",WEB_P2P_PLAY_FAIL:"web.p2p.play_fail",WEB_P2P_LOAD_RATIO:"web.p2p.load_ratio",WEB_P2P_CDN_RESTART:"web.p2p.cdn_restart",WEB_P2P_TCP_NO_SLICE:"web.p2p.tcp_no_slice",WEB_P2P_TCP_OPEN_TIME:"web.p2p.tcp_open_time",WEB_P2P_HTTP_CODE:"web.p2p.http_code_",WEB_P2P_TCP_TIMEOUT:"web.p2p.tcp_timeout",WEB_H265:"web.h265",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_VIDEO_LOGIN_SUC:"sdk.video.login_suc",SDK_P2P_COOLING:"sdk.p2p.cooling",SDK_P2P_SERVER_OPEN:"sdk.p2p.server_open",SDK_P2P_USER_PROPERTY:"sdk.p2p.user_property",VIDEO_VIDEO_BAD_QUALITY_5M_RATIO:"video.video_bad_quality_5m_ratio",VIDEO_VIDEO_LOAD_ERROR:"video_load_error",RECV_DANMU_CARTON:"recv_danmu_carton",SDK_P2P_DETAILS:"sdk.p2p.details",SDK_P2P_FORCE_REASON:"sdk.p2p.force_reason",SDK_P2P_DEFAULT_REASON:"sdk.p2p.default_reason",SDK_P2P_VALID_RET:"sdk.p2p.valid_ret",SDK_P2P_GET_NODE:"sdk.p2p.get_node",WEB_USER:"web.user"},d.INTERVAL={SDK_VIDEO_QUALITY:"sdk.video.quality",SDK_VIDEO_QUALITY_5M:"sdk.video.quality_5m",SDK_CALC_FLOW:"sdk.calc.flow",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_P2P_FLOW:"sdk.p2p.flow",SDK_P2P_PUNCH:"sdk.p2p.punch",SDK_P2P_SUB:"sdk.p2p.sub",SDK_P2P_RESEND:"sdk.p2p.resend",SDK_P2P_DELAY:"sdk.p2p.resend",SDK_P2P_OTHER:"sdk.p2p.other"},d.TRIGGER={SDK_HLS_PLAY:"sdk.hls.play",SDK_HLS_LOAD:"sdk.hls.load",SDK_MSE_ERROR:"sdk.mse.error",SDK_P2P_LOAD:"sdk.p2p.load",SDK_P2P_LOAD_SAMPLE:"sdk.p2p.load_sample",SDK_P2P_RESTART:"sdk.p2p.restart",SDK_WEB_H265:"sdk.web.h265"};var p=d,f=i(11);function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function m(t,e){if(t){if("string"==typeof t)return _(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_(t,e):void 0}}function y(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=m(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r,n=!0,a=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return n=t.done,t},e:function(t){a=!0,r=t},f:function(){try{n||null==s.return||s.return()}finally{if(a)throw r}}}}var v=i(9),S=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;Object(s.a)(this,t),this.maxSize=e,this.sum=0,this.list=[],this.idx=0,this.cur=0}return Object(r.a)(t,[{key:"reset",value:function(){this.sum=0,this.list=[],this.idx=0,this.cur=0}},{key:"addCur",value:function(t){this.cur+=t}},{key:"calculate",value:function(){this.add(this.cur);var t=this.cur;return this.cur=0,t}},{key:"add",value:function(t){this.sum+=t,this.list.length<this.maxSize?this.list.push(t):(this.sum-=this.list[this.idx],this.list[this.idx]=t),this.idx++,this.idx>=this.maxSize&&(this.idx=0)}},{key:"average",value:function(){return 0===this.list.length?v.b.UintMax:Math.round(this.sum/this.list.length)}},{key:"getSamples",value:function(){return this.list}},{key:"max",value:function(){if(0===this.list.length)return v.b.UintMax;var t,e=0,i=y(this.list);try{for(i.s();!(t=i.n()).done;){var s=t.value;s>e&&(e=s)}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"min",value:function(){var t,e=v.b.UintMax,i=y(this.list);try{for(i.s();!(t=i.n()).done;){var s=t.value;s<e&&(e=s)}}catch(t){i.e(t)}finally{i.f()}return e}}]),t}(),g=function(){function t(){Object(s.a)(this,t),this.speed=new S(20),this.rtt=new S(20),this.p2p=0}return Object(r.a)(t,[{key:"addSpeed",value:function(t){var e=parseInt(t.replace("KB",""));this.speed.add(e)}},{key:"addRtt",value:function(t){this.rtt.add(t)}},{key:"setP2p",value:function(t){this.p2p=t}},{key:"getP2p",value:function(){return this.p2p}},{key:"getResult",value:function(){return{speed:this.speed.getSamples(),rtt:this.rtt.getSamples(),p2p:this.p2p}}}]),t}(),T=i(19),w=i.n(T),I=i(15),E=i(16);function P(t,e,i){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Object(E.a)(t)););return t}(t,e);if(s){var r=Object.getOwnPropertyDescriptor(s,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}var b=i(14),C=i(13),R=i(7),A=i(6),k=function(){function t(){Object(s.a)(this,t),this.fpsIndex=0,this.fpsArr=[],this.fpsMap=new Map,this.started=!1,this.recvFps=new S(20),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap=new Map}return Object(r.a)(t,[{key:"reset",value:function(){this.fpsArr=[],this.fpsMap.clear(),this.started=!1,this.recvFps.reset(),A.a.remove(this.onFrameTimer,this),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap.clear()}},{key:"onFrameTimer",value:function(t,e){this.recvFps.calculate()}},{key:"addDts",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.recvFps.addCur(1),this.started||(this.started=!0,A.a.add(this.onFrameTimer,this,1e3));var i=parseInt(t/1e3);if(this.fpsMap.has(i))this.fpsMap.set(i,this.fpsMap.get(i)+1);else{this.fpsIndex>=10&&(this.fpsIndex=0);var s=this.fpsArr[this.fpsIndex];this.fpsMap.delete(s),this.fpsArr[this.fpsIndex]=i,this.fpsMap.set(i,1),this.fpsIndex++}e&&this.addDataSize(i,e)}},{key:"getRecvFps",value:function(){var t=this.recvFps.average();return t===v.b.UintMax?0:t}},{key:"getFps",value:function(){if(this.fpsArr.length>1){var e=this.fpsArr[1],i=this.fpsMap.get(e),s=0,r=i;return t.FIXED_FPS.forEach((function(t){var e=t>i?t-i:i-t;e<3&&(0===s||e<s)&&(s=e,r=t)})),r}return 0}},{key:"addDataSize",value:function(t,e){if(this.perSecondMap.has(t))this.perSecondMap.set(t,this.perSecondMap.get(t)+e);else{this.perSecondIndex>=10&&(this.perSecondIndex=0);var i=this.perSecondArr[this.perSecondIndex];this.perSecondMap.delete(i),this.perSecondArr[this.perSecondIndex]=t,this.perSecondMap.set(t,e),this.perSecondIndex++}}},{key:"getRealBitrate",value:function(){var t=0,e=this.perSecondArr.length;if(e>1){var i=this.perSecondArr[e-2];t=this.perSecondMap.get(i)}return parseInt(8*t/1e3)}}]),t}();k.FIXED_FPS=[0,15,20,24,30,40,48,60];var D=k,L=function(){function t(){Object(s.a)(this,t)}return Object(r.a)(t,null,[{key:"init",value:function(){var e;for(e in t.types={av01:[],av1C:[],avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:i,audio:s};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=n,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,h,a,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,r))}},{key:"box",value:function(t){for(var e,i=Array.prototype.slice.call(arguments,1),s=8,r=i.length,n=r;r--;)s+=i[r].byteLength;for((e=new Uint8Array(s))[0]=s>>24&255,e[1]=s>>16&255,e[2]=s>>8&255,e[3]=255&s,e.set(t,4),r=0,s=8;r<n;r++)e.set(i[r],s),s+=i[r].byteLength;return e}},{key:"hdlr",value:function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return t.box(t.types.mdat,e)}},{key:"mdhd",value:function(e,i){return t.box(t.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}},{key:"mdia",value:function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))}},{key:"mfhd",value:function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))}},{key:"moof",value:function(e,i,s){return t.box(t.types.moof,t.mfhd(e),t.traf(s,i))}},{key:"moov",value:function(e){for(var i=e.length,s=[];i--;)s[i]=t.trak(e[i]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(s).concat(t.mvex(e)))}},{key:"mvex",value:function(e){for(var i=e.length,s=[];i--;)s[i]=t.trex(e[i]);return t.box.apply(null,[t.types.mvex].concat(s))}},{key:"mvhd",value:function(e,i){var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24&255,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,s)}},{key:"sdtp",value:function(e){var i,s,r=e.samples||[],n=new Uint8Array(4+r.length);for(s=0;s<r.length;s++)i=r[s].flags,n[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return t.box(t.types.sdtp,n)}},{key:"stbl",value:function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))}},{key:"av01",value:function(e){var i=e.bytes,s=e.width,r=e.height;return t.box(t.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,r>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),t.box(t.types.av1C,i))}},{key:"avc1",value:function(e){var i,s,r,n=[],a=[];for(i=0;i<e.sps.length;i++)r=(s=e.sps[i]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)r=(s=e.pps[i]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(s));var o=t.box(t.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(a))),h=e.width,u=e.height;return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,255&h,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"hvc1",value:function(e){var i,s,r,n=[],a=[],o=[];for(n.push(161),n.push(e.vps.length>>>8&255),n.push(255&e.vps.length),i=0;i<e.vps.length;i++)r=(s=e.vps[i]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(s));for(a.push(162),a.push(e.sps.length>>>8&255),a.push(255&e.sps.length),i=0;i<e.sps.length;i++)r=(s=e.sps[i]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(s));var h=[],u=0;for(i=0;i<a.length;)s=a[i],2!==u||3!==s?(0===s?u++:u=0,h.push(s),++i):(++i,u=0);for(o.push(163),o.push(e.pps.length>>>8&255),o.push(255&e.pps.length),i=0;i<e.pps.length;i++)r=(s=e.pps[i]).byteLength,o.push(r>>>8&255),o.push(255&r),o=o.concat(Array.prototype.slice.call(s));var c=t.box(t.types.hvcC,new Uint8Array([1,h[8],h[9],h[10],h[11],h[12],h[13],h[14],h[15],h[16],h[17],h[18],h[19],240,0,255,253,248,248,0,0,15].concat([3]).concat(n).concat(a).concat(o))),l=e.width,d=e.height;return t.box(t.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),c,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function(e){var i=e.audiosamplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),t.box(t.types.esds,t.esds(e)))}},{key:"stsd",value:function(e){return"audio"===e.type?t.box(t.types.stsd,t.STSD,t.mp4a(e)):e.isHevc?t.box(t.types.stsd,t.STSD,t.hvc1(e)):e.isAV01?t.box(t.types.stsd,t.STSD,t.av01(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))}},{key:"tkhd",value:function(e){var i=e.id,s=e.duration,r=e.width,n=e.height;return t.box(t.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,n>>8&255,255&n,0,0]))}},{key:"traf",value:function(e,i){var s=t.sdtp(e),r=e.id;return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),t.box(t.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),t.trun(e,s.length+16+16+8+16+8+8),s)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))}},{key:"trex",value:function(e){var i=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(e,i){var s,r,n,a,o,h,u=e.samples||[],c=u.length,l=12+16*c,d=new Uint8Array(l);for(i+=8+l,d.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),s=0;s<c;s++)n=(r=u[s]).duration,a=r.size,o=r.flags,h=r.cts,d.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s);return t.box(t.types.trun,d)}},{key:"initSegment",value:function(e){t.types||t.init();var i,s=t.moov(e);return(i=new Uint8Array(t.FTYP.byteLength+s.byteLength)).set(t.FTYP),i.set(s,t.FTYP.byteLength),i}}]),t}(),O=function(){function t(e){Object(s.a)(this,t),this.mse=e,this.audioISGenerated=!1,this.videoISGenerated=!1,this.PES2MP4SCALEFACTOR=1,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this._forceFirstIDR=!(!f.a.chrome||!(f.a.version.major<50||50===f.a.version.major&&f.a.version.build<2661))}return Object(r.a)(t,[{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(){this.insertDiscontinuity(),this.switchLevel()}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=void 0}},{key:"getInitDts",value:function(){return void 0!==this._initDTS?this._initDTS/90:void 0}},{key:"switchLevel",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];u.a.log("mp4-remuxer.switchLevel"),t&&(this.videoISGenerated=!1),e&&(this.audioISGenerated=!1)}},{key:"remux",value:function(t,e,i,s){Number(localStorage._printMp4Remux)&&u.a.debug("\n### Audio",t,"\n### Video",e),this.audioISGenerated||this.generateAudioIS(t,i),this.videoISGenerated||this.isWebglRender||this.generateVideoIS(e,i),this.initTs(t,e,i),e.samples.length&&(this.isWebglRender?this.renderVideo(e,s):this.remuxVideo(e,s)),t.samples.length&&this.remuxAudio(t,s),this.mse.onFragParsed()}},{key:"initTs",value:function(t,e,i){if(null==this._initPTS){var s=t.samples,r=e.samples,n=s.length,a=r.length,o=this.PES_TIMESCALE;0===n&&0===a?u.a.warn("mp4-remuxer.initTs have no nbAudio&nbVideo"):0===a?(this._initPTS=s[0].pts-o*i,this._initDTS=s[0].dts-o*i):0===n?(this._initPTS=r[0].pts-o*i,this._initDTS=r[0].dts-o*i):(this._initPTS=Math.min(r[0].pts,s[0].pts)-o*i,this._initDTS=Math.min(r[0].dts,s[0].dts)-o*i),u.a.log("mp4-remuxer initDTS/initPTS=[".concat(this._initDTS,", ").concat(this._initPTS,"]"))}}},{key:"generateAudioIS",value:function(t,e){if(t.config){var i={audioMoov:L.initSegment([t]),audioCodec:t.codec,audioChannelCount:t.channelCount};this.mse.onInitSegment(i),this.audioISGenerated=!0}}},{key:"generateVideoIS",value:function(t,e){if(t.isAV01||t.sps&&t.pps){var i={videoMoov:L.initSegment([t]),videoCodec:t.isAV01?t.codec:"avc1.640033",videoWidth:1280,videoHeight:720};this.mse.onInitSegment(i),this.videoISGenerated=!0}}},{key:"remuxVideo",value:function(t,e){var i,s,r,n,a,o,h,c,l,d,p,f,_,m,y=8,v=this.PES2MP4SCALEFACTOR,S=[],g=t.isAV01?0:4*t.naluCnt;for(h=new Uint8Array(t.len+g+8),(i=new DataView(h.buffer)).setUint32(0,h.byteLength),h.set(L.types.mdat,4);t.samples.length;){for(r=t.samples.shift(),a=0;r.units.length;)s=(o=r.units.shift()).data.byteLength,"av01"!=r.type&&(i.setUint32(y,s),y+=4,a+=4),h.set(o.data,y),y+=s,a+=s;if(p=r.pts-this._initDTS,((f=r.dts-this._initDTS)<0||p<0)&&u.a.log("warn"),void 0!==d)_=this._PTSNormalize(p,d),m=this._PTSNormalize(f,d),n.duration=(m-d)/v,n.duration<0&&(Number(localStorage._printMp4RemuxVideo)&&u.a.warn("mp4-remuxer.remuxVideo invalid sample duration at pts="+r.pts/90+" dts="+r.dts/90+" duration="+n.duration/90),n.duration=0,m=d);else{var T,w=this.nextAvcDts||f;_=this._PTSNormalize(p,w),m=this._PTSNormalize(f,w),T=Math.round((m-w)/90),(e||Math.abs(T)<600)&&T&&(T>1&&Number(localStorage._printMp4RemuxVideo)?u.a.warn("mp4-remuxer.remuxVideo hole="+T+" filling it"):T<-1&&Number(localStorage._printMp4RemuxVideo)&&u.a.warn("mp4-remuxer.remuxVideo overlapping="+-T+" detected"),m=w,_=Math.max(_-T,m)),Math.max(0,_),l=Math.max(0,m)}var I=r.key;n={size:a,duration:0,cts:(_-m)/v,flags:{isLeading:0,degradPrio:0,hasRedundancy:0,dependsOn:I?2:1,isDependedOn:I?1:0,isNonSync:I?0:1}},S.push(n),d=m}this._forceFirstIDR&&(S[0].flags.dependsOn=2,S[0].flags.isNonSync=0),void 0!==t.endDts?(n.duration=(90*t.endDts-this._initDTS-m)/v,n.duration<0?(n.duration=0,this.nextAvcDts=m):this.nextAvcDts=90*t.endDts-this._initDTS):(S.length>=2&&(n.duration=S[S.length-2].duration),this.nextAvcDts=m+n.duration*v),t.len=0,t.naluCnt=0,t.samples=S,c=L.moof(t.sn,l/v,t),t.samples=[];var E={type:"video",data:this._mergeBoxes(c,h)};this.mse.onFragParsing(E)}},{key:"remuxAudio",value:function(t,e){var i,s,r,n,a,o,h,c,l,d,p,f=8,_=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,y=[];for(n=new Uint8Array(t.len+8),new DataView(n.buffer).setUint32(0,n.byteLength),n.set(L.types.mdat,4);t.samples.length;){if(r=(i=t.samples.shift()).unit,n.set(r,f),f+=r.byteLength,c=i.pts-this._initDTS,l=i.dts-this._initDTS,void 0!==h)d=this._PTSNormalize(c,h),p=this._PTSNormalize(l,h),s.duration=(p-h)/m,s.duration<0&&(Number(localStorage._printMp4RemuxAudio)&&u.a.warn("mp4-remuxer.remuxAudio invalid AAC sample duration at PTS="+i.pts+" duration="+s.duration),s.duration=0,d=p=h);else{var v,S=this.nextAacPts||c;d=this._PTSNormalize(c,S),p=this._PTSNormalize(l,S),v=Math.round(1e3*(d-S)/_),(e||Math.abs(v)<600)&&v&&(d=p=S),Math.max(0,d),o=Math.max(0,p)}s={size:r.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(s),h=p}y.length>=2&&(s.duration=y[y.length-2].duration),this.nextAacPts=d+s.duration*m,t.len=0,t.samples=y,a=L.moof(t.sn,o/m,t),t.samples=[];var g={type:"audio",data:this._mergeBoxes(a,n)};this.mse.onFragParsing(g)}},{key:"renderVideo",value:function(t,e){this.mse.h265Proxy.pushVideoFrame(t,e)}},{key:"_mergeBoxes",value:function(t,e){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(t,0),i.set(e,t.byteLength),i}},{key:"_PTSNormalize",value:function(t,e){var i;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=i;return t}},{key:"timescale",get:function(){return this.MP4_TIMESCALE}},{key:"isWebglRender",get:function(){return this.mse.h265Proxy&&this.mse.h265Proxy.renderInited}}]),t}(),B=function(){function t(e){Object(s.a)(this,t),this.data=e,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return Object(r.a)(t,[{key:"loadWord",value:function(){var t=this.data.byteLength-this.bytesAvailable,e=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");e.set(this.data.subarray(t,t+i)),this.word=new DataView(e.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}},{key:"readBits",value:function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return t>32&&u.a.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0?i<<e|this.readBits(e):i}},{key:"skipLZ",value:function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(t){var e,i=8,s=8;for(e=0;e<t;e++)0!==s&&(s=(i+this.readEG()+256)%256),i=0===s?i:s}},{key:"readSPS",value:function(){var t,e,i,s,r,n,a,o=0,h=0,u=0,c=0,l=0;if(this.readUByte(),t=this.readUByte(),this.readBits(5),this.skipBits(3),this.readUByte(),this.skipUEG(),100===t||110===t||122===t||144===t||244===t||44===t||83===t||86===t||118===t||128===t||138===t){var d=this.readUEG();if(3===d&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(n=3!==d?8:12,a=0;a<n;a++)this.readBoolean()&&(a<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var p=this.readUEG();if(0===p)this.readUEG();else if(1===p)for(this.skipBits(1),this.skipEG(),this.skipEG(),e=this.readUEG(),a=0;a<e;a++)this.skipEG();if(this.skipUEG(),this.skipBits(1),i=this.readUEG(),s=this.readUEG(),0===(r=this.readBits(1))&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(o=this.readUEG(),h=this.readUEG(),u=this.readUEG(),c=this.readUEG()),this.readBoolean()&&(this.readBoolean()&&255===this.readUByte()&&(this.readBits(16),this.readBits(16)),this.readBoolean()&&this.skipBits(1),this.readBoolean()&&(this.readBits(3),this.skipBits(1),this.readBoolean()&&(this.readUByte(),this.readUByte(),this.readUByte())),this.readBoolean()&&(this.readUEG(),this.readUEG()),this.readBoolean())){var f=this.readBits(32);l=this.readBits(32)/f,this.readBoolean()&&(l=Math.ceil(l/2))}return{fps:l,width:16*(i+1)-2*o-2*h,height:(2-r)*(s+1)*16-(u+c)*(r?2:4)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),t}(),N=function(){function t(){Object(s.a)(this,t)}return Object(r.a)(t,null,[{key:"getSilentFrame",value:function(t,e){if(2===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),t}();N.emptyAacFrameAdts=[255,241,92,64,18,64,252,0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],N.emptyAacFrame=[0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],N.emptyAacFrame_44_1=[1,64,34,128,163,78,129,64,0,0,0,0,4,96,6,246,81,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94];var U=N,F=function(){function t(e,i){Object(s.a)(this,t),this.mse=e,this.remuxer=i,this.width=0,this.height=0,this.lastSN=0,this.lastLevel=0,this.PES_TIMESCALE=9e4,this.lastTsData=null,this.lastPos=0,this.hasRemux=!1,this.fragStartTs=0,this.vFps=new D,this.aFps=new D,this._initPts=0,this.nextAudioPts=0}return Object(r.a)(t,[{key:"getFps",value:function(){return this.vFps&&this.vFps.getFps()}},{key:"getAudioFps",value:function(){return this.aFps&&this.aFps.getFps()}},{key:"getStartTs",value:function(){return this.fragStartTs}},{key:"destroy",value:function(){this.switchLevel(),this.duration=0}},{key:"probe",value:function(t){return t.length>=564&&71===t[0]&&71===t[188]&&71===t[376]}},{key:"resetAVData",value:function(){this._avcTrack&&(this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.samples=[])}},{key:"pushAllData",value:function(){this._avcTrack&&this._avcTrack.sn>0&&this.remuxTs(this._aacTrack,this._avcTrack,this._avcTrack.sn)}},{key:"switchLevel",value:function(){var t=this.createTrack;!this._avcTrack&&(this._avcTrack=t("video")),!this._aacTrack&&(this._aacTrack=t("audio")),!this._id3Track&&(this._id3Track=t("id3")),this.pmtParsed=!1,this._pmtId=-1,this.remuxer.switchLevel()}},{key:"createTrack",value:function(t){return{type:t,id:-1,sn:0,samples:[],len:0,naluCnt:0}}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity(),this.mse.insertDiscontinuity()}},{key:"reset",value:function(){this.vFps.reset(),this.aFps.reset(),this.hasRemux=!1,this.lastTsData=null,this._avcTrack&&(this._avcTrack.sps=null,this._avcTrack.pps=null,this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.naluCnt=0,this._aacTrack.samples=[])}},{key:"resetTsData",value:function(){var t=this._avcTrack,e=this._aacTrack,i=this._id3Track;e&&(t.pesData=null,e.pesData=null,i.pesData=null,this.lastTsData=null),this.fragStartTs=0}},{key:"appendTsData",value:function(t,e){var i;e&&this.resetTsData(),t instanceof Uint8Array||(t=new Uint8Array(t));var s=this.lastTsData,r=this.lastPos;if(s){var n=s.byteLength-r,a=n+t.byteLength;(i=new Uint8Array(a)).set(s.slice(r),0),i.set(t,n)}else i=t;return this.lastPos=0,this.lastTsData=i,i}},{key:"syncOffset",value:function(t){for(var e=Math.min(188,t.length-564),i=0;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1}},{key:"parseTs",value:function(t){var e=t.data,i=t.audioCodec,s=t.videoCodec,r=t.timeOffset,n=t.duration,a=t.discontinuity,o=t._discontinuity,h=t.level,c=t.sn,l=t.seeking,d=t.hlsDT,p=t.tsDT,_=(e=this.appendTsData(e,l)).length;this.audioCodec=i,this.videoCodec=s,this.timeOffset=r,this.duration=n,this.contiguous=!1,a||o?(u.a.log("TsParser.parseTs discontinuity detected"),this.insertDiscontinuity()):h!==this.lastLevel?(u.a.log("TsParser.parseTs level switch detected"),this.switchLevel(),this.lastLevel=h):c===this.lastSN+1&&(this.contiguous=!0),this.lastSN=c,this.contiguous||(this.aacOverFlow=null),this._avcTrack||this.insertDiscontinuity();var m=this.syncOffset(e);if(!(m<0)){this.lastPos=_-=(_+m)%188,_===e.length&&(this.lastTsData=null);for(var y,v,S,g,T,w=this._avcTrack,I=this._aacTrack,E=this._id3Track,P=this.pmtParsed,b=w.pesData,C=I.pesData,R=E.pesData,A=w.id,k=I.id,D=E.id,L=m;L<_;L+=188)if(71===e[L]){if(y=!!(64&e[L+1]),v=((31&e[L+1])<<8)+e[L+2],(48&e[L+3])>>4>1){if((S=L+5+e[L+4])===L+188)continue}else S=L+4;P?(g=(T=L+188)-S,v===A?(y&&(b&&this._parseAVCPES(this._parsePES(b,r,d,p)),b={data:[],size:0}),b&&(b.data.push(e.subarray(S,T)),b.size+=g)):v===k?(y&&(C&&(this._parseAACPES(this._parsePES(C,r,d,p)),!this.hasRemux&&w.samples.length>1&&this.remuxTs(I,w,c)),C={data:[],size:0}),C&&(C.data.push(e.subarray(S,T)),C.size+=g)):v===D&&(y&&(R&&this._parseID3PES(this._parsePES(R,r,d,p)),R={data:[],size:0}),R&&(R.data.push(e.subarray(S,T)),R.size+=g))):(y&&(S+=e[S]+1),0===v?this._parsePAT(e,S):v===this._pmtId&&(this._parsePMT(e,S),P=this.pmtParsed=!0,A=this._avcTrack.id,k=this._aacTrack.id,D=this._id3Track.id))}else u.a.error("TsParser.parseTs ERROR: TS packet did not start with 0x47");if(b&&(w.pesData=b),C&&(I.pesData=C),R&&(E.pesData=R),I.samples.length>1||this.maxVideo()){if(0===I.samples.length&&"firefox"===f.a.name&&this.mse.reloadInError&&!this.mse.isLive)return void this.mse.reloadInError();this.remuxTs(I,w,c)}}}},{key:"maxVideo",value:function(){var t=this._avcTrack;if(t.samples.length>1){var e=t.samples[0];return(t.samples[t.samples.length-1].dts-e.dts)/90>2e3}return!1}},{key:"remuxTs",value:function(t,e,i){t.sn=e.sn=i,this.hasRemux=!0;try{if(!this._initPts){var s=t.samples.length>0?t.samples[0].pts:0,r=e.samples.length>0?e.samples[0].pts:0;this._initPts=Math.min(s,r)}this.remuxAudio(t,e.samples.length>0)}catch(t){u.a.error("remux ts error: ",t)}this.remuxer.remux(t,e,this.timeOffset,this.contiguous)}},{key:"remuxAudio",value:function(t,e){var i=9216e4/t.audiosamplerate;0==this.nextAudioPts&&(this.nextAudioPts=this._initPts);for(var s=this.nextAudioPts,r=t.samples,n=0,a=s;n<r.length;n++){var o=r[n].pts,h=o-a,c=Math.abs(1e3*h/t.timescale);if(h<=-i&&e)0===n&&(u.a.warn("Audio frame @ ".concat((o/t.timescale).toFixed(3),"s \n                        overlaps nextAudioPts by ").concat(Math.round(1e3*h/t.timescale)," ms.")),this.nextAudioPts=s=a=o);else if(h>i&&c<1e4&&e){var l=Math.round(h/i);(a=o-l*i)<0&&(l--,a+=i),0===n&&(this.nextAudioPts=s=a),u.a.warn("[mp4-remuxer]: Injecting ".concat(l," audio frame nextPts=").concat(a," @ ").concat((a/t.timescale).toFixed(3),"s \n                    due to ").concat(Math.round(1e3*h/t.timescale)," ms gap."));for(var d=0;d<l;d++){var p=Math.max(a,0),f=U.getSilentFrame(t.config[0],t.channelCount),_={unit:f,pts:Math.round(p),dts:Math.round(p)};r.splice(n,0,_),t.len+=f.length,a+=i,n++}}a+=i,this.nextAudioPts=a}}},{key:"_parsePAT",value:function(t,e){var i=t[e+8]<<8|t[e+9];1==i&&(this._pmtId=(31&t[e+10])<<8|t[e+11]),u.a.log("TsParser._parsePAT program_number=".concat(i," pmtId=").concat(this._pmtId))}},{key:"_parsePMT",value:function(t,e){var i=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<i;){var s=t[e],r=(31&t[e+1])<<8|t[e+2];switch(s){case 15:this._aacTrack.id=r;break;case 21:this._id3Track.id=r;break;case 27:this._avcTrack.id=r;break;default:u.a.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}u.a.log("TsParser._parsePMT aacTrack.id=".concat(this._aacTrack.id," avcTrack.id=").concat(this._avcTrack.id))}},{key:"_parsePES",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.data[0],n=(r[0]<<16)+(r[1]<<8)+r[2];if(1!=n)return null;var a,o,h=(r[4]<<8)+r[5],u=r[7];192&u&&((a=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2)>4294967295&&(a-=8589934592),64&u?(o=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2)>4294967295&&(o-=8589934592):o=a);var c=r[8],l=c+9;t.data[0]=t.data[0].subarray(l),t.size-=l;for(var d=0,p=new Uint8Array(t.size);t.data.length;)r=t.data.shift(),p.set(r,d),d+=r.byteLength;return s>i&&s-i-1e3*e>0&&(a-=90*(s-i-1e3*e),o-=90*(s-i-1e3*e)),{data:p,pts:a,dts:o,len:h}}},{key:"_parseAVCPES",value:function(t){if(null!=t){0===this.fragStartTs&&(this.fragStartTs=t.pts/this.PES_TIMESCALE);var e,i=this._avcTrack,s=i.samples,r=this._parseAVCNALu(t.data),n=[],a=0;0===r.length&&s.length>0&&this._pushToPreUnit(t.data),t.data=null;var o,h=!1,c=!1,d="",p=y(r);try{for(p.s();!(o=p.n()).done;){var f=o.value;switch(f.type){case 1:c=!0;break;case 5:c=!0,h=!0,i.idr=!0;break;case 6:c=!0;break;case 7:if(c=!0,!i.sps){i.sps=[f.data],i.timescale=this.remuxer.timescale,i.duration=this.remuxer.timescale*this.duration;var _=new B(f.data).readSPS();this.width=i.width=_.width,this.height=i.height=_.height,this.mse&&this.mse.setResolution&&this.mse.setResolution(this.width,this.height);for(var m=f.data.subarray(1,4),v="avc1.",S=0;S<3;S++){var g=m[S].toString(16);g.length<2&&(g="0"+g),v+=g}i.codec=v}break;case 8:c=!0,i.pps||(i.pps=[f.data]);break;case 9:c=!0;break;default:c=!1,d+="unknown NAL "+f.type+" "}c&&(n.push(f),a+=f.data.byteLength)}}catch(t){p.e(t)}finally{p.f()}d.length,i.idr&&this.mse.setExceptionStat(l.a.DIM_LINK_STA.VIDEO_IFRAME,1),i.codec&&this.mse.setExceptionStat(l.a.DIM_LINK_STA.VIDEO_CONFIG,1),i.sps&&i.pps&&!i.idr||n.length&&(!0===h||i.sps)&&(this.mse&&(this.mse.curVideoDts=parseInt(t.dts/90)),this.mse&&this.mse.setExceptionStat(l.a.DIM_LINK_STA.VIDEO_FRAME,1),this.vFps.addDts(t.dts/90),e={units:n,dts:t.dts,pts:t.pts,key:h},s.push(e),i.len+=a,i.naluCnt+=n.length)}else u.a.error("TsParser._parseAVCPES pes is null.")}},{key:"_parseAVCNALu",value:function(t){for(var e,i,s,r,n,a,o=0,h=t.byteLength,u=0,c=[];o<h;)switch(e=t[o++],u){case 0:0===e&&(u=1);break;case 1:u=0===e?2:0;break;case 2:case 3:0===e?u=3:1===e?(r=31&t[o],n?(s={data:t.subarray(n,o-u-1),type:a},c.push(s)):(i=o-u-1)&&this._pushToPreUnit(t.subarray(0,i)),o<h?(n=o,a=r,u=0):u=-1):u=0}return n&&(s={data:t.subarray(n,h),type:a},c.push(s)),c}},{key:"_pushToPreUnit",value:function(t){var e=this._avcTrack.samples.length;if(0!=e){var i=this._avcTrack.samples[e-1],s=i.units[i.units.length-1],r=new Uint8Array(s.data.byteLength+t.byteLength);r.set(s.data,0),r.set(t,s.data.byteLength),s.data=r,this._avcTrack.len+=t.byteLength}}},{key:"_parseAACPES",value:function(t){var e=this;if(null!=t){var i,s,r,n,a,o,h,c,d=this._aacTrack,p=t.data,f=p.length,_=0;if(this.aacOverFlow){var m=new Uint8Array(this.aacOverFlow.byteLength+p.byteLength);m.set(this.aacOverFlow,0),m.set(p,this.aacOverFlow.byteLength),p=m,this.aacOverFlow=null}for(s=0;s<f-1&&(255!==p[s]||240!=(240&p[s+1]));s++);if(s&&(s<f-1?(h="AAC PES did not start with ADTS header, offset:".concat(s),c=!1):(h="no ADTS header found in AAC PES",c=!0),u.a.error("TsParser._parseAACPES ERROR:".concat(h)),c))return;var y=function(t){d.config=t.config,d.audiosamplerate=t.samplerate,d.channelCount=t.channelCount,d.codec=t.codec,d.timescale=e.remuxer.timescale,d.duration=e.remuxer.timescale*e.duration,e.mse&&e.mse.setExceptionStat(l.a.DIM_LINK_STA.AUDIO_CONFIG,1),u.a.log("TsParser._parseAACPES parsed codec:".concat(d.codec,",rate:").concat(t.samplerate,",nb channel:").concat(t.channelCount))};if(this.mse&&this.mse.isLive)d.audiosamplerate||y(this._ADTStoAudioConfig(p,s,this.audioCodec));else{var v=this._ADTStoAudioConfig(p,s,this.audioCodec);d.audiosamplerate?d.audiosamplerate!==v.samplerate&&this.mse&&this.mse.onParseError(99):y(v)}for(;s+5<f;){if(r=1&p[s+1]?7:9,n=(3&p[s+3])<<11,n|=p[s+4]<<3,n|=(224&p[s+5])>>>5,(n-=r)<0)return void u.a.error("TsParser._parseAACPES adtsFrameSize:".concat(n,", adtsStartOffset:").concat(s,", len:").concat(f));if(0!=n){if(!((a=s+r)+n<=f))break;for(o=Math.round(t.pts+1024*_*this.PES_TIMESCALE/d.audiosamplerate),i={unit:p.subarray(a,a+n),pts:o,dts:o},this.aFps.addDts(o/90),this.mse&&(this.mse.curAudioDts=parseInt(o/90)),this.mse&&this.mse.setExceptionStat(l.a.DIM_LINK_STA.AUDIO_FRAME,1),d.samples.push(i),d.len+=n,s+=r+n,_++;s<f-1&&(255!==p[s]||240!=(240&p[s+1]));s++);}else s+=r}s<f&&(this.aacOverFlow=p.subarray(s,f))}else u.a.error("TsParser._parseAACPES pes is null.")}},{key:"_ADTStoAudioConfig",value:function(e,i,s){var r=t.AdtsSampleingRates,n=1+((192&e[i+2])>>>6),a=(60&e[i+2])>>>2;if(!(a>r.length-1)){var o,h,c=(1&e[i+2])<<2|(192&e[i+3])>>>6,l=navigator.userAgent.toLowerCase();return-1!==l.indexOf("firefox")?a>=6?(n=5,h=new Array(4),o=a-3):(n=2,h=new Array(2),o=a):-1!==l.indexOf("android")?-1!==l.indexOf("mqqbrowser")?(n=2,h=new Array(2),o=a):(n=5,h=new Array(4),o=a):(n=5,h=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&a>=6?o=a-3:(s&&-1!==s.indexOf("mp4a.40.2")&&(a>=6||1===c)&&(n=2,h=new Array(2)),o=a)),h[0]=n<<3,h[0]|=(14&a)>>1,h[1]|=(1&a)<<7,h[1]|=c<<3,5===n&&(h[1]|=(14&o)>>1,h[2]=(1&o)<<7,h[2]|=8,h[3]=0),{config:h,samplerate:r[a],channelCount:c,codec:"mp4a.40."+n}}u.a.error("TsParser._ADTStoAudioConfig ERROR:invalid ADTS sampling index:".concat(a))}},{key:"_parseID3PES",value:function(t){this._id3Track.samples.push(t)}}]),t}();F.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var M,V=F,x=function(){function t(){Object(s.a)(this,t),this.size=0,this.buffers=[]}return Object(r.a)(t,[{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(){u.a.log("FlvCacher.reset",this.size),this.size=0,this.buffers=[]}},{key:"append",value:function(t){0!==t.length&&(this.buffers.push(t),this.size+=t.length)}},{key:"getByte",value:function(t){for(var e=0,i=0;i<this.buffers.length;++i){var s=this.buffers[i];if(e+s.length>t)return s[t-e];e+=s.length}return u.a.warn("FlvCacher.getByte has no offset="+t),0}},{key:"popFrame",value:function(){if(0===this.size)return null;if(0===this.buffers.length)return u.a.error("FlvCacher.popFront error no buffers, size:"+this.size+" not eq 0"),this.reset(),null;if(this.size<=Ct.TAG_HEADER_LEN+Ct.PREV_TAG_SIZE_LEN)return null;var t=(this.getByte(1)<<16)+(this.getByte(2)<<8)+this.getByte(3),e=Ct.TAG_HEADER_LEN+t+Ct.PREV_TAG_SIZE_LEN;if(this.size<e)return null;if(1===this.buffers.length){if(this.buffers[0].length===e)return this.size-=e,this.buffers.shift();var i=this.buffers[0].slice(0,e);return this.buffers[0]=this.buffers[0].slice(e),this.size-=e,i}for(var s,r=new Uint8Array(e),n=0,a=0;n<e;){var o=e-n;if(this.buffers[0].length>o){s=this.buffers[0].slice(0,o),r.set(s,a),a+=o,n+=o,this.buffers[0]=this.buffers[0].slice(o),this.size-=o;break}s=this.buffers.shift(),r.set(s,a),a+=s.length,n+=s.length,this.size-=s.length}return r}}]),t}(),H=(M=new ArrayBuffer(2),new DataView(M).setInt16(0,256,!0),256===new Int16Array(M)[0]),G=function(){function t(){Object(s.a)(this,t)}return Object(r.a)(t,null,[{key:"parseObject",value:function(e,i,s){var r=t.parseString(e,i),n=t.parseScript(e,i+r.size);return{data:{name:r.data,value:n.data},size:n.size}}},{key:"parseVariable",value:function(e,i,s){return t.parseObject(e,i,s)}},{key:"parseDate",value:function(t,e,i){if(i<10)throw new Error("Data size invalid when parse Date");var s=new DataView(t,e),r=s.getFloat64(0,!H),n=s.getInt16(8,!H);return{data:new Date(r+=60*n*1e3),size:10}}},{key:"parseString",value:function(t,e){var i=new DataView(t,e),s=i.getUint16(0,!H),r="";if(s>0)for(var n=0;n<s;n++)r+=String.fromCharCode(i.getUint8(n+2));return{data:r,size:2+s}}},{key:"parseMetadata",value:function(e){var i=t.parseScript(e,0);return t.parseScript(e,i.size,e.length-i.size)}},{key:"parseScript",value:function(e,i,s){var r=i,n=new Uint8Array(e).buffer,a=new DataView(n,0,s),o=null,h=a.getUint8(r);switch(r+=1,h){case 0:o=a.getFloat64(r,!H),r+=8;break;case 1:o=!!a.getUint8(r),r+=1;break;case 2:var u=t.parseString(n,r);o=u.data,r+=u.size;break;case 3:for(o={};r<s-3;){var c=t.parseObject(n,r,s-i);if(o[c.data.name]=c.data.value,r=c.size,0===a.getUint8(r)&&0===a.getUint8(r+1)&&9===a.getUint8(r+2)){r+=3;break}}break;case 8:for(o={},r+=4;r<s-8;){var l=t.parseVariable(n,r);o[l.data.name]=l.data.value,r=l.size}r<=s-3&&9==(16777215&a.getUint32(r-1,!H))&&(r+=3);break;case 10:o=[];var d=a.getUint32(r,!H);r+=4;for(var p=0;p<d;p++){var f=t.parseScript(n,r);o.push(f.data),r=f.size}break;case 11:var _=t.parseDate(n,r+1,s-1);o=_.data,r+=_.size;break;case 12:var m=t.parseString(n,r+1);o=m.data,r+=m.size;break;default:r=s,console.log("AMF","Unsupported AMF value type "+h)}return{data:o,size:r}}},{key:"getStr",value:function(t,e,i){for(var s="",r=0;r<i;r++)s+=String.fromCharCode(t[e++]);return s}}]),t}(),W=function(){function t(){Object(s.a)(this,t),this.listeners={}}return Object(r.a)(t,[{key:"clear",value:function(){this.listeners={}}},{key:"has",value:function(t,e,i){var s=this.listeners[t];if(!s)return!1;for(var r=0,n=s.length;r<n;r++){var a=s[r];if(a.callback==e&&a.thisObj==i)return!0}return!1}},{key:"on",value:function(t,e,i,s){if(!this.has(t,e,i)){var r=this.listeners[t]||[];r.push({priority:s||0,callback:e,thisObj:i,bindCallback:i?e.bind(i):e}),r.sort((function(t,e){return e.priority-t.priority})),this.listeners[t]=r}}},{key:"off",value:function(t,e,i){var s=this.listeners[t];if(s)for(var r=s.length-1;r>=0;r--){var n=s[r];if(n.callback==e&&n.thisObj==i)return void s.splice(r,1)}}},{key:"trigger",value:function(t,e){var i=this.listeners[t];if(i)for(var s=i.length-1;s>=0;s--)(0,i[s].bindCallback)(e)}}]),t}(),j=i(25),q=i(20),Y=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this)).printProtocol=!!Number(localStorage._printProtocol),t}return Object(r.a)(i,[{key:"onData",value:function(t,e){var i=this.unmarshall(t,e);this.trigger(t,i)}},{key:"unmarshall",value:function(t,e){var i=new j.a(e),s=q.a[t],r=i,n=null;try{n=this.getClass(s)}catch(e){u.a.warn("%c[x] Unmatched protocol ".concat(t>>8," ").concat(s),"color:red;background:#FFF0F0")}return n&&(void 0===(r=new n).unmarshall?u.a.error("[x]"+s+".unmarshall undefined!"):r.unmarshall(i)),this.printProtocol&&!J[s]&&u.a.debug("%c<<<<< "+s,function(t,e,i){var s="font-weight:900";return s+=";color:"+t}("#0000E3"),r),r}},{key:"getClass",value:function(t){return null}}]),i}(W),J={PCdnProxyPing:1,PCdnProxyPingRes:1,PP2pSliceAudioData:1,PP2pSliceVideoData:1,PP2pSliceControlData:1,PCdnP2pGetNode:1,PCdnP2pGetNodeRes:1,P2POffer:1,P2PAnswer:1,P2PCandidate:1,P2POfferReject:1,P2PRequestOffer:1,PCdnP2PWSForward:1,PCdnP2PWSForwardReject:1,PCdnP2pReportLog:1,PCDNSubscribeReq:1,PCDNSubscribeRes:1,PCDNCompeteSubscribeReq:1,PCDNCompeteSubscribeRes:1,P2PPunchBackReq:1,P2PPunchBackRsp:1,HuyaDelaySeiData:1},K=Y,z=function(){function t(){Object(s.a)(this,t),this.osTime=0,this.syncLocalTime=0,this.rttList=[]}return Object(r.a)(t,[{key:"convertToSrvTime",value:function(t){if(0===this.osTime)return 0;var e=t-this.osTime;return this.syncLocalTime+e}},{key:"isFinishNtp",value:function(){return 0!==this.osTime}},{key:"ntpProcess",value:function(t,e){var i=c.a.now(),s=i-t,r=Math.round(e+s/2);if(0===this.osTime&&0===this.syncLocalTime)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else if(this.rttList.length<10)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else{for(var n=[],a=0;a<this.rttList.length;++a)n.push(this.rttList[a]);n.sort((function(t,e){return t-e}));for(var o=0,h=0;h<4;++h)o+=n[h];var u=o>>2;(4*s>3*u&&4*s<5*u||s>6e4)&&(this.osTime=i,this.syncLocalTime=r),this.rttList.shift(),this.rttList.push(s),n=null}}}]),t}(),Q=i(10),X=i(12).default,$=i(17).default,Z=new(function(){function t(){Object(s.a)(this,t),this._info=new z,this._clientTime=0,this._requestId=0,this._onWsTimeSyncBind=this._onWsTimeSync.bind(this)}return Object(r.a)(t,[{key:"start",value:function(){this.wsTimeSync(),A.a.add(this._onTimer,this,1e3)}},{key:"_onTimer",value:function(t,e){e%60==0&&this.wsTimeSync()}},{key:"wsTimeSync",value:function(){""!==Q.a.sGuid&&(this._req||(this._req=new X.WSTimeSyncReq),this._requestId=$.getRequestId(),this._clientTime=c.a.now(),this._req.sGuid=Q.a.sGuid,this._req.lClientTime=this._clientTime,$.sendWup("launch","wsTimeSync",this._req,this._onWsTimeSyncBind,!0,this._requestId))}},{key:"_onWsTimeSync",value:function(t){this._info.ntpProcess(this._clientTime,Number(t.lServerTime))}},{key:"getSyncTime",value:function(){return this._info.convertToSrvTime(c.a.now())}},{key:"isFinishNtp",value:function(){return this._info.isFinishNtp()}}]),t}()),tt=function(){function t(e){Object(s.a)(this,t),this._split=e,this._str=""}return Object(r.a)(t,[{key:"isEmpty",value:function(){return""===this._str}},{key:"addStr",value:function(t){this._str.length>0&&(this._str+=this._split),this._str+=t}},{key:"getStr",value:function(){return this._str}}]),t}(),et=[72,85,89,65,58],it=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],st={HUMEN:"00000001",DELAY:"00000200",VOLUME:"00000400",IFRAME:"00000600"},rt=function(t){Object(b.a)(n,t);var e=Object(C.a)(n);function n(){return Object(s.a)(this,n),e.call(this)}return Object(r.a)(n,[{key:"getClass",value:function(t){return i(30)("./"+t).default}}]),n}(K),nt=function(){function t(e){Object(s.a)(this,t),this._mse=e,this._protoHandler=new rt,this._proto=null,this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._curAnchorDelay=0,this._offset=0,this.initDts=0,this.initSeiDts=0}return Object(r.a)(t,[{key:"getStat",value:function(){if(0===this._delayCnt)return null;var t={fields:{},dims:{}};if(this._delayCnt>0&&(t.fields[l.a.CORE.DELAY_ANCHOR]=Math.floor(this._c2cDelaySum/this._delayCnt),t.fields[l.a.CORE.DELAY_SERVER]=Math.floor(this._svrDelaySum/this._delayCnt),t.fields[l.a.CORE.DELAY_NET]=Math.floor(this._netDelaySum/this._delayCnt),this._proto)){t.dims[l.a.CORE.UPLOADER_TYPE]=this._proto.anchorSei.uploadType+"",t.dims[l.a.CORE.ENCODER_SOURCE]=this._proto.anchorSei.encoderSource+"";var e=new tt(","),i=new tt(","),s=new tt(",");this._proto.serverSei.serverInfos.forEach((function(t){t.enable>0&&(e.addStr(t.getProxyIdStr()+"-"+t.proxyType),t.serverDelay>0&&t.serverDelay<1e4&&i.addStr(t.proxyType+":"+t.serverDelay),t.lastPeriodDelay>0&&t.lastPeriodDelay<1e4&&s.addStr(t.proxyType+":"+t.lastPeriodDelay))})),e.isEmpty()||(t.dims[l.a.CORE.DELAY_NODE_INFO]=e.getStr()),i.isEmpty()||(t.dims[l.a.CORE.SVR_DELAY_INFOS]=i.getStr()),s.isEmpty()||(t.dims[l.a.CORE.SVR_LAST_P_DELAY]=s.getStr())}return this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._proto=null,t}},{key:"_record",value:function(t,e){this._proto=e;var i=Z.getSyncTime(),s=t-e.serverSei.dtsGapSum-e.anchorSei.frameDts,r=i-e.anchorSei.sendFrameTime-s;if(this.initSeiDts!=e.anchorSei.frameDts&&(this._mse.offsetDts=t-e.anchorSei.frameDts),this.initSeiDts=e.anchorSei.frameDts,0<r&&r<3e4){var n=i-e.anchorSei.caputureTime-s;this._netDelaySum+=r,this._c2cDelaySum+=n,this._svrDelaySum+=r-e.serverSei.delaySum,this._delayCnt++,this._curAnchorDelay=n||this._curAnchorDelay,this._curAnchorDelay>3e5&&(this._curAnchorDelay=0),this._mse.setSeiDelay(this._curAnchorDelay)}}},{key:"parseSei",value:function(e,i,s,r){if(e+=this.initDts,this._offset=0,s==t.H265_CODEC_TYPE?(i=this._nalUintExtractRbsp(i),this._offset+=2):s==t.AV1_CODEC_TYPE||(this._offset+=1),this._getValue(i),this._getValue(i),this._getH265Len(i),this._isHuya(i)){var n=i.subarray(this._offset),a=this._getType(n);r[a]=1,a===st.DELAY?this._parseDelay(e,n):a===st.HUMEN?this._mse.saveH264SeiData(e,n):a===st.VOLUME&&this._mse.parser&&this._mse.parser.parseScriptTagMixAudio&&this._mse.parser.parseScriptTagMixAudio(this._getStr(n),e)}}},{key:"_nalUintExtractRbsp",value:function(t){for(var e=new Uint8Array(t.length),i=t.length,s=0,r=0;s+2<i;)t[s]||t[s+1]||3!==t[s+2]?e[r++]=t[s++]:(e[r++]=t[s++],e[r++]=t[s++],s++);for(;s<i;)e[r++]=t[s++];return e.subarray(0,r)}},{key:"_getStr",value:function(t){for(var e=t.length,i=new Uint8Array(t.length),s=0;s<e;s++)i[s]=t[s];e=this._getLength(t)+8+16+2;for(var r=26,n=new DataView(i.buffer),a=[];r+9<=e;){var o=4294967296*n.getUint32(r,!1)+n.getUint32(r+4,!1),h=n.getUint8(r+8);a.push(o+"_"+h),r+=9}return a.join(",")}},{key:"_getLength",value:function(t){for(var e="",i=9;i<26;i++)e+=String.fromCharCode(t[i]);return parseInt(e)}},{key:"_getValue",value:function(t){for(var e=0,i=t.length;this._offset<i;){if(e+=t[this._offset],255!==t[this._offset]){this._offset++;break}this._offset++}return e}},{key:"_parseDelay",value:function(t,e){if(Z.isFinishNtp())for(var i=this._decodeData(e),s=i.length,r=new DataView(i.buffer),n=0;n+10<s;){var a=r.getUint32(n,!0),o=r.getUint32(n+4,!0);if(0===a||a>s)break;if(o===q.a.HuyaDelaySeiData){var h=new DataView(i.buffer,n,a),u=this._protoHandler.unmarshall(o,h);this._record(t,u)}n+=a}}},{key:"_decodeData",value:function(t){for(var e=this._decodeBase64(t),i=e.length,s=new Uint8Array(i),r=0;r<i;r++)s[r]=e.charCodeAt(r);return s}},{key:"_decodeBase64",value:function(t){for(var e="",i=this._getPayloadLen(t),s=0;s<i;s++)e+=String.fromCharCode(t[s+26]);return atob(e)}},{key:"_getPayloadLen",value:function(t){for(var e="",i=0;i<16;i++)e+=String.fromCharCode(t[i+9]);return parseInt(e)}},{key:"_getType",value:function(t){for(var e="",i=0;i<8;i++)e+=String.fromCharCode(t[i]);return e}},{key:"_getH265Len",value:function(t){for(var e=0,i=0;i<16&&t[this._offset]===it[i];i++)this._offset++,e++;return e}},{key:"_isHuya",value:function(t){for(var e=0;e<5;e++){if(t[this._offset]!==et[e])return!1;this._offset++}return!0}}]),t}();nt.H264_CODEC_TYPE=0,nt.H265_CODEC_TYPE=1,nt.AV1_CODEC_TYPE=2,nt.SEI_TYPES=st;var at=nt,ot=function(){function t(e){Object(s.a)(this,t),this._bytes=e,this._bitIndex=0,this._bitLen=8*e.byteLength}return Object(r.a)(t,[{key:"getBits",value:function(t){var e=Math.floor(this._bitIndex/8),i=8-this._bitIndex%8,s=this._bytes[e]&(1<<i)-1;if(t<=i)return this._bitIndex+=t,s>>>i-t;var r=t-i;return this._bitIndex+=i,(s<<r|this.getBits(r))>>>0}},{key:"skipBits",value:function(t){this._bitIndex+=t}},{key:"getBytes",value:function(t){if(this._bitIndex%8!=0)throw new Error("can't get bytes from mid-byte: bit index="+this._bitIndex);var e=Math.floor(this._bitIndex/8);return this._bitIndex+=8*t,this._bytes.subarray(e,e+t)}},{key:"bytePosition",get:function(){return Math.floor(this._bitIndex/8)}},{key:"bitposition",get:function(){return this._bitIndex}}]),t}(),ht=function(){function t(){Object(s.a)(this,t)}return Object(r.a)(t,null,[{key:"leb128",value:function(t){for(var e=0,i=0;i<8;i++){var s=t.getBits(8);if(e|=(127&s)<<7*i,!(128&s))break}return e}},{key:"parseOBUHeader",value:function(t){var e={},i=t.bits;return e.obu_forbidden_bit=i.getBits(1),e.obu_type=i.getBits(4),e.obu_extension_flag=i.getBits(1),e.obu_has_size_field=i.getBits(1),e.obu_reserved_1bit=i.getBits(1),1==e.obu_extension_flag&&(e.temporal_id=i.getBits(3),e.spatial_id=i.getBits(2),e.extension_header_reserved_3bits=i.getBits(3)),e}},{key:"uvlc",value:function(t){for(var e=0;!t.getBits(1);)++e;return e>=32?0:t.getBits(e)+(1<<e)-1}},{key:"color_config",value:function(e){var i={};return i.high_bitdepth=e.getBits(1),2==i.seq_profile&&i.high_bitdepth?(i.twelve_bit=e.getBits(1),i.BitDepth=i.twelve_bit?12:10):i.BitDepth=i.high_bitdepth?10:8,1==i.seq_profile?i.mono_chrome=0:i.mono_chrome=e.getBits(1),i.color_description_present_flag=e.getBits(1),i.color_description_present_flag?(i.color_primaries=e.getBits(8),i.transfer_characteristics=e.getBits(8),i.matrix_coefficients=e.getBits(8)):(i.color_primaries=t.CP_UNSPECIFIED,i.transfer_characteristics=t.TC_UNSPECIFIED,i.matrix_coefficients=t.MC_UNSPECIFIED),i.mono_chrome?(i.color_range=e.getBits(1),i.subsampling_x=1,i.subsampling_y=1,i.chroma_sample_position=t.CSP_UNKNOWN,i.separate_uv_delta_q=0,i):(i.color_primaries==t.CP_BT_709&&i.transfer_characteristics==t.TC_SRGB&&i.matrix_coefficients==t.MC_IDENTITY?(i.color_range=1,i.subsampling_x=0,i.subsampling_y=0):(i.color_range=e.getBits(1),0==i.seq_profile?(i.subsampling_x=1,i.subsampling_y=1):1==i.seq_profile?(i.subsampling_x=0,i.subsampling_y=0):12==i.BitDepth?(i.subsampling_x=e.getBits(1),i.subsampling_x?i.subsampling_y=e.getBits(1):i.subsampling_y=0):(i.subsampling_x=1,i.subsampling_y=0),i.subsampling_x&&i.subsampling_y&&(i.chroma_sample_position=e.getBits(2))),i.separate_uv_delta_q=e.getBits(1),i)}},{key:"metadata_obu",value:function(e,i){var s={},r=e.bits;if(s.metadata_type=t.leb128(r),s.metadata_type==t.METADATA_TYPE_ITUT_T35){s.itu_t_t35_country_code=r.getBits(8),255==s.itu_t_t35_country_code&&(s.itu_t_t35_country_code_extension_byte=r.getBits(8));var n=(8*i-r.bitposition)/8;s.itu_t_t35_payload_bytes=r.getBytes(n)}else if(s.metadata_type==t.METADATA_TYPE_HDR_CLL)s.max_cll=r.getBits(16),s.max_fall=r.getBits(16);else if(s.metadata_type==t.METADATA_TYPE_HDR_MDCV){s.primary_chromaticity_x=[],s.primary_chromaticity_y=[];for(var a=0;a<3;a++)s.primary_chromaticity_x[a]=r.getBits(16),s.primary_chromaticity_y[a]=r.getBits(16);s.white_point_chromaticity_x=r.getBits(16),s.white_point_chromaticity_y=r.getBits(16),s.luminance_max=r.getBits(32),s.luminance_min=r.getBits(32)}else if(s.metadata_type==t.METADATA_TYPE_SCALABILITY){if(s.scalability_mode_idc=r.getBits(8),s.scalability_mode_idc==t.SCALABILITY_SS){if(s.spatial_layers_cnt_minus_1=r.getBits(2),s.spatial_layer_dimensions_present_flag=r.getBits(1),s.spatial_layer_description_present_flag=r.getBits(1),s.temporal_group_description_present_flag=r.getBits(1),s.scalability_structure_reserved_3bits=r.getBits(3),s.spatial_layer_dimensions_present_flag)for(var o=0;o<=s.spatial_layers_cnt_minus_1;o++)s.spatial_layer_max_width[o]=r.getBits(16),s.spatial_layer_max_height[o]=r.getBits(16);if(s.spatial_layer_description_present_flag)for(var h=0;h<=s.spatial_layers_cnt_minus_1;h++)s.spatial_layer_ref_id[h]=r.getBits(8);if(s.temporal_group_description_present_flag){s.temporal_group_size=r.getBits(8);for(var u=0;u<s.temporal_group_size;u++){s.temporal_group_temporal_id[u]=r.getBits(3),s.temporal_group_temporal_switching_up_point_flag[u]=r.getBits(1),s.temporal_group_spatial_switching_up_point_flag[u]=r.getBits(1),s.temporal_group_ref_cnt[u]=r.getBits(3);for(var c=0;c<temporal_group_ref_cnt[u];c++)s.temporal_group_ref_pic_diff[u][c]=r.getBits(8)}}}}else s.metadata_type==t.METADATA_TYPE_TIMECODE&&(s.counting_type=r.getBits(5),s.full_timestamp_flag=r.getBits(1),s.discontinuity_flag=r.getBits(1),s.cnt_dropped_flag=r.getBits(1),s.n_frames=r.getBits(9),s.full_timestamp_flag?(s.seconds_value=r.getBits(6),s.minutes_value=r.getBits(6),s.hours_value=r.getBits(5)):(s.seconds_flag=r.getBits(1),s.seconds_flag&&(s.seconds_value=r.getBits(6),s.minutes_flag=r.getBits(1),s.minutes_flag&&(s.minutes_value=r.getBits(6),s.hours_flag=r.getBits(1),s.hours_flag&&(s.hours_value=r.getBits(5))))),s.time_offset_length=r.getBits(5),s.time_offset_length>0&&(s.time_offset_value=r.getBits(s.time_offset_length)));return s}},{key:"sequence_header_obu",value:function(e){var i={},s=e.bits;if(i.seq_profile=s.getBits(3),i.still_picture=s.getBits(1),i.reduced_still_picture_header=s.getBits(1),i.reduced_still_picture_header)i.timing_info_present_flag=0,i.decoder_model_info_present_flag=0,i.initial_display_delay_present_flag=0,i.operating_points_cnt_minus_1=0,i["operating_point_idc[0]"]=0,i["seq_level_idx[0]"]=s.getBits(5),i["seq_tier[0]"]=0,i["decoder_model_present_for_this_op[0]"]=0,i["initial_display_delay_present_for_this_op[0]"]=0;else{i.timing_info_present_flag=s.getBits(1),i.timing_info_present_flag?(i.num_units_in_display_tick=s.getBits(32),i.time_scale=s.getBits(32),i.equal_picture_interval=s.getBits(1),i.equal_picture_interval&&(i.num_ticks_per_picture_minus_1=t.uvlc(s)),i.decoder_model_info_present_flag=s.getBits(1),i.decoder_model_info_present_flag&&(i.buffer_delay_length_minus_1=s.getBits(5)),i.num_units_in_decoding_tick=s.getBits(32),i.buffer_removal_time_length_minus_1=s.getBits(5),i.frame_presentation_time_length_minus_1=s.getBits(5),i.initial_display_delay_present_flag=s.getBits(1),i.operating_points_cnt_minus_1=s.getBits(5)):(i.decoder_model_info_present_flag=0,i.initial_display_delay_present_flag=s.getBits(1),i.operating_points_cnt_minus_1=s.getBits(5));for(var r=0;r<=i.operating_points_cnt_minus_1;r++){if(i["operating_point_idc["+r+"]"]=s.getBits(12),i["seq_level_idx["+r+"]"]=s.getBits(5),i["seq_level_idx["+r+"]"]>7?i["seq_tier["+r+"]"]=s.getBits(1):i["seq_tier["+r+"]"]=0,i.decoder_model_info_present_flag){if(i["decoder_model_present_for_this_op["+r+"]"]=s.getBits(1),i["decoder_model_present_for_this_op["+r+"]"]){var n=i.buffer_delay_length_minus_1+1;i["decoder_buffer_delay["+r+"]"]=s.getBits(n),i["encoder_buffer_delay["+r+"]"]=s.getBits(n),i["low_delay_mode_flag["+r+"]"]=s.getBits(1)}}else i["decoder_model_present_for_this_op["+r+"]"]=0;i.initial_display_delay_present_flag&&(i["initial_display_delay_present_for_this_op["+r+"]"]=s.getBits(1)),i["initial_display_delay_present_for_this_op["+r+"]"]&&(i["initial_display_delay_minus_1["+r+"]"]=s.getBits(4))}}return i.frame_width_bits_minus_1=s.getBits(4),i.frame_height_bits_minus_1=s.getBits(4),i.max_frame_width_minus_1=s.getBits(i.frame_width_bits_minus_1+1),i.max_frame_height_minus_1=s.getBits(i.frame_height_bits_minus_1+1),i.reduced_still_picture_header?i.frame_id_numbers_present_flag=0:i.frame_id_numbers_present_flag=s.getBits(1),i.frame_id_numbers_present_flag&&(i.delta_frame_id_length_minus_2=s.getBits(4),i.additional_frame_id_length_minus_1=s.getBits(3)),i.use_128x128_superblock=s.getBits(1),i.enable_filter_intra=s.getBits(1),i.enable_intra_edge_filter=s.getBits(1),i.reduced_still_picture_header?(i.enable_interintra_compound=0,i.enable_masked_compound=0,i.enable_warped_motion=0,i.enable_dual_filter=0,i.enable_order_hint=0,i.enable_jnt_comp=0,i.enable_ref_frame_mvs=0,i.seq_force_screen_content_tools=t.SELECT_SCREEN_CONTENT_TOOLS,i.seq_force_integer_mv=1,i["#OrderHintBits"]=0):(i.enable_interintra_compound=s.getBits(1),i.enable_masked_compound=s.getBits(1),i.enable_warped_motion=s.getBits(1),i.enable_dual_filter=s.getBits(1),i.enable_order_hint=s.getBits(1),i.enable_order_hint&&(i.enable_jnt_comp=s.getBits(1),i.enable_ref_frame_mvs=s.getBits(1)),i.seq_choose_screen_content_tools=s.getBits(1),i.seq_choose_screen_content_tools?i.seq_force_screen_content_tools=t.SELECT_SCREEN_CONTENT_TOOLS:i.seq_force_screen_content_tools=s.getBits(1),i.seq_force_screen_content_tools>0&&(i.seq_choose_integer_mv=s.getBits(1),i.seq_choose_integer_mv?i.seq_force_integer_mv=1:i.seq_force_integer_mv=s.getBits(1)),i.enable_order_hint?(i.order_hint_bits_minus_1=s.getBits(3),i["#OrderHintBits"]=i.order_hint_bits_minus_1+1):i["#OrderHintBits"]=0,i.enable_superres=s.getBits(1),i.enable_cdef=s.getBits(1),i.enable_restoration=s.getBits(1),Object.assign(i,t.color_config(s)),i.film_grain_params_present=s.getBits(1)),i}},{key:"parseOBU",value:function(e,i,s,r){for(var n={bits:new ot(e)},a=0;e.length-a>1;){var o;1==(o=t.parseOBUHeader(n)).obu_extension_flag&&a++;var h,u=e.length-a;if(h=o.obu_has_size_field?t.leb128(n.bits):u-1-o.obu_extension_flag,o.obu_type==t.OBU_SEQUENCE_HEADER&&s)s(t.sequence_header_obu(n));else if(o.obu_type==t.OBU_METADATA&&r){var c=t.metadata_obu(n,n.bits.bytePosition+h);c.itu_t_t35_payload_bytes&&r(i,c)}else n.bits.skipBits(8*h);a=n.bits.bytePosition}}},{key:"zeroPad",value:function(t,e,i){t||(t=0),void 0===i&&(i=10);for(var s=t.toString(i);s.length<e;)s="0"+s;return s}}]),t}();ht.OBU_SEQUENCE_HEADER=1,ht.OBU_TEMPORAL_DELIMITER=2,ht.OBU_FRAME_HEADER=3,ht.OBU_TILE_GROUP=4,ht.OBU_METADATA=5,ht.OBU_FRAME=6,ht.OBU_REDUNDANT_FRAME_HEADER=7,ht.OBU_TILE_LIST=8,ht.OBU_PADDING=15,ht.SELECT_SCREEN_CONTENT_TOOLS=2,ht.CP_BT_709=1,ht.CP_UNSPECIFIED=2,ht.TC_SRGB=13,ht.TC_UNSPECIFIED=2,ht.MC_IDENTITY=0,ht.MC_UNSPECIFIED=2,ht.CSP_UNKNOWN=0,ht.METADATA_TYPE_HDR_CLL=1,ht.METADATA_TYPE_HDR_MDCV=2,ht.METADATA_TYPE_SCALABILITY=3,ht.METADATA_TYPE_ITUT_T35=4,ht.METADATA_TYPE_TIMECODE=5,ht.SCALABILITY_SS=14;var ut=ht,ct=function(){function t(){Object(s.a)(this,t),this.type=-1,this.sn=0,this.samples=[],this.firstDts=0,this.playDts=0,this.lastSampleDts=0}return Object(r.a)(t,[{key:"destroy",value:function(){this.samples=[]}},{key:"clear",value:function(){this.samples=[],this.firstDts=0,this.playDts=0,this.lastSampleDts=0}},{key:"addSample",value:function(t){if(this.lastSampleDts>0){var e=t.ts-this.lastSampleDts;(e>100||e<-100)&&u.a.warn("BufferFrame.addSample type=".concat(this.type," dis=").concat(e," lastDts=").concat(this.lastSampleDts," curDts=").concat(t.ts))}return this.lastSampleDts=t.ts,this.samples.push(t),this._setFirstDts(t.ts),this.setPlayDts(t.ts),t.ts-this.playDts}},{key:"_setFirstDts",value:function(t){0===this.firstDts&&(this.firstDts=t)}},{key:"setPlayDts",value:function(t){0===this.playDts&&(this.playDts=t)}},{key:"_createTrack",value:function(e){return{type:e,id:e===t.TYPES.video?1:2,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0,naluCnt:0}}},{key:"getTrack",value:function(t){var e=this._createTrack(this.type),i=this._fillTrack(e,t);return i>0&&this.samples.splice(0,i),e.endDts>0&&(e.sn=this.sn,this.sn++),e}},{key:"_fillTrack",value:function(t,e){return 0}},{key:"_addTrack",value:function(t,e){t.samples.push(e),-1===t.startDts&&(t.startDts=e.ts),t.endDts=e.ts,e.av1Bytes&&(t.bytes=e.av1Bytes)}},{key:"getBufferLen",value:function(){var t=this.samples.length;if(t>1){var e=this.samples[0];return this.samples[t-1].ts-e.ts}return 0}},{key:"getSize",value:function(){return this.samples.length}}]),t}();ct.TYPES={video:"video",audio:"audio"};var lt=ct,dt=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this)).type=lt.TYPES.video,t}return Object(r.a)(i,[{key:"_fillTrack",value:function(t,e){for(var i=0,s=this.samples.length,r=this.playDts+e,n=0;n<s;n++){var a=this.samples[n];if(a.ts>=r){t.endDts=a.ts;break}i++,this._addTrack(t,a)}return t.endDts>0&&(this.playDts=t.endDts),i}},{key:"_addTrack",value:function(t,e){P(Object(E.a)(i.prototype),"_addTrack",this).call(this,t,e),t.naluCnt+=e.units.length,t.len+=e.len}}]),i}(lt),pt=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this)).type=lt.TYPES.audio,t.needEmptyAudioFrame=!0,t.isPureAudio=!1,t.lastAacTs=0,t.audioObjectType=5,t.audioChannelCount=1,t.audioSampleRate=22050,t.aacTimeLen=1024e3/t.audioSampleRate,t}return Object(r.a)(i,[{key:"_setFirstDts",value:function(t){this.playDts>0&&0===this.firstDts&&t>this.playDts&&t-this.playDts<this.aacTimeLen&&(u.a.log("BufferFrameAudio._setFirstDts reset playDts ".concat(this.playDts," to ").concat(t)),this.playDts=t),P(Object(E.a)(i.prototype),"_setFirstDts",this).call(this,t)}},{key:"_fillTrack",value:function(t,e){for(var i=e,s=this.playDts,r=0,n=0,a=0,o=this.samples.length,h=0;s<i;s+=this.aacTimeLen){var c=this.samples[r];if(h=Math.round(s),c&&c.ts<=h){if(r++,a++,this._fixDts(c,h),this._addTrack(t,c),r>=o){s+=this.aacTimeLen;break}}else if(!this.isPureAudio&&this.needEmptyAudioFrame){n++;var l={unit:null,pts:0,dts:0,ts:0};22050===this.audioSampleRate&&2===this.audioObjectType?l.unit=new Uint8Array(U.emptyAacFrame):l.unit=U.getSilentFrame(this.audioObjectType,this.audioChannelCount),this._fixDts(l,h),this._addTrack(t,l)}}return this.playDts=s,n>0&&u.a.log("BufferFrameAudio add empty frames ".concat(n)),a}},{key:"_fixDts",value:function(t,e){t.pts=t.dts=90*e,t.ts=e}},{key:"_addTrack",value:function(t,e){P(Object(E.a)(i.prototype),"_addTrack",this).call(this,t,e),t.len+=e.unit.length}}]),i}(lt),ft=function(){function t(e,i){Object(s.a)(this,t),this.popSize=e.bufferSize+e.popDuration,this.waitSize=e.waitSize,this.popDuration=e.popDuration,this.timescale=e.timescale,this.isPureAudio=e.isPureAudio,this.remuxCb=i,this.avcChange=!1,this.inited=!0,this.hasOriginIFrame=!1,this.gop=a.a.maxGop,this.lastKeyFrameDts=0,this.paused=!1,this.videoConfig={isHevc:!1,vps:null,sps:null,pps:null,codec:"",width:0,height:0},this.audioConfig={config:null,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},this.vBuffer=new dt,this.aBuffer=new pt}return Object(r.a)(t,[{key:"_updateGop",value:function(t){!t.key||this.hasOriginIFrame&&!t.origin_iframe||(this.lastKeyFrameDts>0&&(this.gop=Math.min(a.a.maxGop,t.ts-this.lastKeyFrameDts)),this.lastKeyFrameDts=t.ts)}},{key:"updateVideoConfig",value:function(t,e){this.videoConfig=t,this.avcChange=e}},{key:"updateAudioConfig",value:function(t){this.audioConfig=t,this.aBuffer.audioSampleRate=t.audiosamplerate,this.aBuffer.aacTimeLen=t.aacTimeLen,this.aBuffer.audioObjectType=t.audioObjectType,this.aBuffer.audioChannelCount=t.audioChannelCount}},{key:"destroy",value:function(){this.remuxCb=null,this.vBuffer.destroy(),this.aBuffer.destroy()}},{key:"addSample",value:function(e){this.inited=!1,e.type===t.TYPES.avc||e.type===t.TYPES.av01?this._addSampleVideo(e):e.type===t.TYPES.aac&&this._addSmapleAudio(e)}},{key:"_addSampleVideo",value:function(t){t.key&&t.origin_iframe&&!this.hasOriginIFrame&&(u.a.log("BufferAv.addSampleVideo find origin_iframe! isIframe=".concat(t.key)),this.hasOriginIFrame=!0),!t.key&&t.origin_iframe&&u.a.warn("BufferAv.addSampleVideo find origin_iframe sei not in iframe"),this.aBuffer.setPlayDts(t.ts),this._updateGop(t);var e=this.vBuffer.addSample(t);!this.paused&&e>this.popSize&&(e>this.waitSize||this.aBuffer.getSize()>0)&&this.popBuffer(this.popDuration)}},{key:"_addSmapleAudio",value:function(t){var e=this.aBuffer.addSample(t);!this.paused&&this.isPureAudio&&e>this.popSize&&this.popBuffer(this.popDuration)}},{key:"popBuffer",value:function(t){var e=this.vBuffer.getTrack(t);e&&(0===e.sn||this.avcChange)&&Object.assign(e,this.videoConfig),e.timescale=this.timescale,e.duration=Math.round((e.endDts-e.startDts)*(this.timescale/1e3)),this.avcChange=!1;var i=null;(i=this.isPureAudio?this.aBuffer.getTrack(this.aBuffer.playDts+t):this.aBuffer.getTrack(e.endDts)).config=this.audioConfig.config,i.audiosamplerate=this.audioConfig.audiosamplerate,i.channelCount=this.audioConfig.channelCount,i.codec=this.audioConfig.codec,i.timescale=this.timescale,i.duration=Math.round((i.endDts-i.startDts)*(this.timescale/1e3)),this.remuxCb&&this.remuxCb(e,i)}},{key:"clearBuffer",value:function(){this.vBuffer.clear(),this.aBuffer.clear()}},{key:"setNeedEmptyAudioFrame",value:function(t){this.aBuffer.needEmptyAudioFrame=t}},{key:"getBufferLen",value:function(){return this.isPureAudio?this.aBuffer.getBufferLen():this.vBuffer.getBufferLen()}},{key:"getSize",value:function(){return this.vBuffer.getSize()}}]),t}();ft.TYPES={avc:"avc",av01:"av01",aac:"aac"};var _t=ft,mt=function(){function t(){Object(s.a)(this,t),this.list=[],this.switchIFrameDts=0,this.switchIFramePts=0,this.lastIFrameDts=0,this.lastIFRamePts=0}return Object(r.a)(t,[{key:"getDts",value:function(){return this.switchIFrameDts||this.lastIFrameDts}},{key:"getPts",value:function(){return this.switchIFramePts||this.lastIFRamePts}},{key:"setSwitchTs",value:function(t,e){this.switchIFrameDts=t,this.switchIFramePts=e}},{key:"setLastTs",value:function(t,e){this.lastIFrameDts=t,this.lastIFRamePts=e}},{key:"resetPtsSample",value:function(){this.list=[]}},{key:"addPtsSample",value:function(t,e,i,s,r,n){this.list.push({dts:t,pts:e,dtsGap:i,ptsGap:s,hasOrigin:r,isOrigin:n})}},{key:"getMetric",value:function(){var t=[0,0,0],e=[0,0];if(this.list.length>0){var i=this.list[0],s=this.list[this.list.length-1];t[0]=i.dtsGap,t[1]=i.ptsGap,t[2]=this.list.length,t[3]=0,t[4]=s.ptsGap,e[0]=s.hasOrigin?1:2,e[1]=s.isOrigin?1:2,e[2]=0}return{values:t,strs:e}}}]),t}(),yt=0,vt=function(){function t(e,i){Object(s.a)(this,t),this.config=e,this.remuxCb=i,this.hasVideoConfig=!1,this.needEmptyAudioFrame=!0,this.timescale=9e4,this.hasFrame=!1,this.state=0,this.switchTs=new mt,this.avBuffer=this._createBuffer(),this.evalBw=null,this.callbacks=null,this._buffered=null,this.id=yt++,u.a.log("CtrlBuffer.constructor(".concat(this.id,")")),this._curFrameId=0}return Object(r.a)(t,[{key:"setCurFrameId",value:function(t){this._curFrameId=t}},{key:"setBuffered",value:function(t){this._buffered=t}},{key:"addBuffered",value:function(t,e,i){(t.type===_t.TYPES.avc||t.type===_t.TYPES.av01&&this._buffered)&&this._buffered.addSample(this._curFrameId,t.ts,e,i)}},{key:"destroy",value:function(){this.remuxCb=null,this.callbacks=null,this._destroyBuffer()}},{key:"_destroyBuffer",value:function(){this.avBuffer&&(this.avBuffer.destroy(),this.avBuffer=null)}},{key:"_createBuffer",value:function(){this._destroyBuffer();var t=new _t(this.config,this.remuxCb);return t.timescale=this.timescale,t.setNeedEmptyAudioFrame(this.needEmptyAudioFrame),t}},{key:"pause",value:function(){this.avBuffer.paused=!0}},{key:"play",value:function(){this.avBuffer.paused=!1}},{key:"isPaused",value:function(){return this.avBuffer.paused}},{key:"isWaitForIFrame",value:function(){return 1===this.state}},{key:"switchBitrate",value:function(t,e,i){u.a.log("CtrlBuffer(".concat(this.id,").switchBitrate isDown=").concat(t)),this._lastBitrate=e,this._curBitrate=i,this.state=1}},{key:"switchBack",value:function(){u.a.log("CtrlBuffer(".concat(this.id,").switchBack switchIFramePts=").concat(this.switchTs.getDts()," lastIFramePts=").concat(this.switchTs.getPts())),this.state=2,this.avBuffer=this._createBuffer(),this.callbacks&&this.callbacks.start(this.switchTs.getDts(),this.switchTs.getPts())}},{key:"setEval",value:function(t){this.evalBw=t}},{key:"addSample",value:function(t){var e=t.key&&(!this.avBuffer.hasOriginIFrame||t.origin_iframe);if(e&&this.switchTs.setLastTs(t.ts,t.ts+t.cts),t.type!==_t.TYPES.avc&&t.type!==_t.TYPES.av01||this.evalBw&&this.evalBw.addSample(t),2===this.state&&(this.hasFrame||t.type!==_t.TYPES.avc&&t.type!==_t.TYPES.av01||(u.a.log("CtrlBuffer(".concat(this.id,").addSample first sample dts=").concat(t.ts," pts=").concat(t.ts+t.cts)),this.hasFrame=!0,this.callbacks&&this.callbacks.first())),t.type!==_t.TYPES.avc&&t.type!==_t.TYPES.av01||this.hasVideoConfig)if(2===this.state){if(t.key){var i=t.ts+t.cts,s=t.ts-this.switchTs.getDts(),r=i-this.switchTs.getPts();u.a.log("CtrlBuffer(".concat(this.id,").addSample find IFrame origin_iframe=").concat(t.origin_iframe," dts=").concat(t.ts," pts=").concat(i," switchDts=").concat(this.switchTs.switchIFrameDts," switchPts=").concat(this.switchTs.switchIFramePts," dtsGap=").concat(s," ptsGap=").concat(r," iFrameGap=").concat(this.avBuffer.gop)),1===Number(a.a.autoReportCfg[0])&&1===Number(a.a.autoReportCfg[3])&&r>0&&(u.a.log("CtrlBuffer.addSample autoReport"),this.callbacks&&this.callbacks.autoReport(Event.P2P_REPORT,2)),this.switchTs.addPtsSample(t.ts,i,s,r,this.avBuffer.hasOriginIFrame,t.origin_iframe),i>=this.switchTs.switchIFramePts&&(u.a.log("CtrlBuffer(".concat(this.id,").addSample find new IFrame, switch done")),this.state=0,this.switchTs.setSwitchTs(0,0),this.avBuffer.addSample(t),this.addBuffered(t,!0,r),this.callbacks&&this.callbacks.done(s,t.ts,r))}}else 1===this.state?e?(this._popAllBuffer(),this.avBuffer.hasOriginIFrame=!1,this.hasVideoConfig=!1,this.hasFrame=!1,this.state=2,this.switchTs.setSwitchTs(t.ts,t.ts+t.cts),this.switchTs.resetPtsSample(),u.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame origin_iframe=").concat(t.origin_iframe," dts=").concat(this.switchTs.switchIFrameDts," pts=").concat(this.switchTs.switchIFramePts," iFrameGap=").concat(this.avBuffer.gop,", switch start!")),this.callbacks&&this.callbacks.start(this.switchTs.switchIFrameDts,this.switchTs.switchIFramePts)):(t.key&&u.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame fail, origin_iframe=").concat(t.origin_iframe," dts=").concat(t.ts," pts=").concat(t.ts+t.cts)),this.avBuffer.addSample(t),this.addBuffered(t,!1,0)):(this.avBuffer.addSample(t),this.addBuffered(t,!1,0))}},{key:"_popAllBuffer",value:function(){this.avBuffer&&(this.avBuffer.getBufferLen()>0&&this.avBuffer.popBuffer(Number.MAX_SAFE_INTEGER),this.avBuffer.clearBuffer())}},{key:"updateVideoConfig",value:function(t,e){e&&this._popAllBuffer(),this.hasVideoConfig=!0,this.avBuffer.updateVideoConfig(t,e)}},{key:"updateAudioConfig",value:function(t,e){e&&this._popAllBuffer(),this.avBuffer.updateAudioConfig(t)}},{key:"setNeedEmptyAudioFrame",value:function(t){this.needEmptyAudioFrame=t,this.avBuffer.setNeedEmptyAudioFrame(t)}},{key:"getBufferLen",value:function(){return this.avBuffer.getBufferLen()}},{key:"getLastIFrameDts",value:function(){return this.switchTs.lastIFrameDts}},{key:"getSize",value:function(){return this.avBuffer.getSize()}}]),t}(),St=function(){function t(e){Object(s.a)(this,t),this.hasSample=!1,this.samples=new S(e)}return Object(r.a)(t,[{key:"getSamples",value:function(){return this.samples.getSamples()}},{key:"addCur",value:function(t,e){this.hasSample=!0}},{key:"getResult",value:function(){var t=[],e=this.samples.getSamples(),i=e.length;if(i>0){t.push("size:"+i);for(var s=0;s<i;s++)t.push("".concat(i-s,":").concat(e[s]))}return t.join(",")}},{key:"reset",value:function(){var t=this.samples.cur;this.samples.reset(),this.samples.addCur(t)}}]),t}(),gt=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return Object(s.a)(this,i),(t=e.call(this,r)).lastTs=0,t}return Object(r.a)(i,[{key:"addCur",value:function(t,e){P(Object(E.a)(i.prototype),"addCur",this).call(this,t,e);var s=parseInt(e/1e3);this.lastTs>0&&this.lastTs!==s&&this.samples.calculate(),this.lastTs=s,this.samples.addCur(t)}}]),i}(St),Tt=function(){function t(){Object(s.a)(this,t),this.aSample=new gt(20),this.vSample=new gt(20)}return Object(r.a)(t,[{key:"addAudioSample",value:function(t,e){this.aSample.addCur(t,e)}},{key:"addVideoSample",value:function(t,e){this.vSample.addCur(t,e)}},{key:"getResult",value:function(){var t=[],e=this.aSample.getSamples(),i=this.vSample.getSamples(),s=Math.min(i.length,e.length);if(s>0){t.push("size:".concat(s));for(var r=0;r<s;r++)t.push("".concat(s-r,":").concat(i[r]+e[r]))}return t.join(",")}},{key:"reset",value:function(){this.aSample.reset(),this.vSample.reset()}},{key:"recordStat",value:function(t){var e=this.getResult();""!==e&&(this.reset(),t.setCoreDim(l.a.CORE.REAL_KBPS_SAMPLE,e))}}]),t}(),wt=!!Number(localStorage._dropAudio),It=!!Number(localStorage._dropVideo),Et=function(){function t(){Object(s.a)(this,t),this.lastDts=0,this.lastPts=0,this.lastCts=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0],this.playVideoFrameCnt=0,this.playAudioFrameCnt=0}return Object(r.a)(t,[{key:"reset",value:function(){this.lastDts=this.lastPts=this.lastCts=0,this.playVideoFrameCnt=this.playAudioFrameCnt=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0]}},{key:"setTimeStamp",value:function(t,e,i){this.addStat(this.dtsStat,this.lastDts,t),this.addStat(this.ptsStat,this.lastPts,e),this.addStat(this.ctsStat,this.lastCts,i),this.lastDts=t,this.lastPts=e,this.lastCts=i}},{key:"addStat",value:function(t,e,i){if(e>0&&i>e){var s=i-e;s>=1e3?t[4]++:s>=800?t[3]++:s>=600?t[2]++:s>=400?t[1]++:s>=200&&t[0]++}}}]),t}(),Pt=[43,138,8,0],bt=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(t,r){var n;return Object(s.a)(this,i),(n=e.call(this)).mse=t,n.remuxer=r,n.flvCacher=new x,n.fps=new D,n.audioFps=new D,n.sei=new at(t),n.avSample=new Tt,n.timeStampStat=new Et,n.emptyFrames=0,n.ctrlBuffer=new vt({bufferSize:0,popDuration:200,timescale:r.timescale,isPureAudio:t.isPureAudio},n._remux.bind(Object(I.a)(n))),n.DEFAULT_GOP=200,n.bufLen=400,n.firstBufLen=400,n.remuxLen=n.firstBufLen,n.maxWaitTime=2e3,n.pushGop=!1,n.parseFlvHead=!1,n.lengthSizeMinusOne=0,n.hasRemuxed=!1,n.recvVideoFrameTimeStamp=0,n.recvVideoFrameNums=0,n.videoFramePlayDelayTs=0,n.videoFrameCalculatePlayDelayFrames=0,n.audioConfig=Pt.slice(),n.audioSampleRate=22050,n.aacTimeLen=1024e3/n.audioSampleRate,n.validAacTime=500*n.aacTimeLen,n.audioChannelCount=1,n.audioObjectType=5,n.audioIncreaseTSMap=new Map,n.firstDemuxAudioTS=-1,n.ctrlBuffer.updateAudioConfig({config:n.audioConfig,codec:"mp4a.40.5",audiosamplerate:n.audioSampleRate,aacTimeLen:n.aacTimeLen,audioObjectType:n.audioObjectType,audioChannelCount:n.audioChannelCount},!1),n.spsUnit=null,n.ppsUnit=null,n.vpsUnit=null,n.videoConfig={},n.hasCtsZero=!1,n.paused=!1,n.hasEmptyFrames=!1,n.playVideoFrameCnt=0,n.playVideoLength=0,n.playAudioFrameCnt=0,n.playAudioLength=0,n.playEmptyAudioFrameCnt=0,n.beginParseTs=0,n.hasAudioTag=!1,n.lastAacTs=0,n.hasKeyFrame=!1,n.lastAudioTs=0,n.lastVideoTs=0,n.lastParseDts=0,n.maxaudioptsList=[0,0,0,0,0,0,0,0,0,0],n.last10anduiptsList=[0,0,0,0,0,0,0,0,0,0],n.firstAudioTs=-1,n.showH265Tip=!1,n.appendHighQualityEmptyAudio=!0,n.deleteH264Aud=!1,n.incompleteFlvheaderLen=0,n.videoFrames=0,n.audioFrames=0,n.headCache=null,n.OBUParser=new ut,n.seiTypes={},n.av1Bytes=0,n.reset(),n.onAV1SequenceHeaderBind=n.onAV1SequenceHeader.bind(Object(I.a)(n)),n.onAV1MetaDataBind=n.onAV1MetaData.bind(Object(I.a)(n)),n}return Object(r.a)(i,[{key:"printPlayFrameInfo",value:function(){u.a.log("FlvParser.playFrameInfo",this.timeStampStat.playVideoFrameCnt,this.timeStampStat.playAudioFrameCnt)}},{key:"getLastIFrameDts",value:function(){return this.ctrlBuffer.getLastIFrameDts()}},{key:"getFrameBufferLen",value:function(){return this.ctrlBuffer.getBufferLen()}},{key:"getAudioFrames",value:function(){return this.audioFrames}},{key:"getVideoFrames",value:function(){return this.videoFrames}},{key:"getFps",value:function(){return this.fps&&this.fps.getFps()}},{key:"getAudioFps",value:function(){return this.audioFps&&this.audioFps.getFps()}},{key:"getFrameReadyed",value:function(){return this.ctrlBuffer.getSize()}},{key:"setDecoctorTimeAbnormal",value:function(){var t=localStorage.decodeabnormal;if(t&&t.split("_").length>1){var e=parseInt(t.split("_")[1]),i=(new Date).getTime()-e;i&&i>864e5?(this.appendHighQualityEmptyAudio=!0,localStorage.decodeabnormal=""):this.appendHighQualityEmptyAudio=!1}}},{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(t){u.a.log("FlvParser.reset"),this.printFirstVideoTs=!1,this.printFirstAudioTs=!1,this.pfvTs=!1,this.pfaTs=!1,this.fps.reset(),this.audioFps.reset(),this.flvCacher.destroy(),this.timeStampStat.reset(),this.lastParseDts=0,this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastVideoTs=0,this.showH265Tip=!1,this.bufLen=400,this.remuxLen=this.firstBufLen,this.hasCtsZero=!1,this.hasRemuxed=!1,this.audioIncreaseTSMap.clear(),this.firstDemuxAudioTS=-1,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0,this.incompleteFlvheaderLen=0,this.parseFlvHead=!1,this.switchingUrl=!1,this.droppingSample=null,this.decodeIFRTime=0,this.waitRemuxTime=0,this.isFirstRemux=!1,this.av1Bytes=0,this.onAV1SequenceHeaderBind=null,this.onAV1MetaDataBind=null}},{key:"getPlayStat",value:function(){var t={videoFrameCnt:this.playVideoFrameCnt,videoLength:this.playVideoLength,audioFrameCnt:this.playAudioFrameCnt,audioLength:this.playAudioLength,emptyAudioFrameCnt:this.playEmptyAudioFrameCnt};return this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,t}},{key:"setPaused",value:function(t){this.paused=t}},{key:"setPushGop",value:function(t){this.pushGop=t,u.a.log("FlvParser.setPushGop "+t)}},{key:"setDeleteH264Aud",value:function(t){this.deleteH264Aud=t,u.a.log("FlvParser.deleteH264Aud "+t)}},{key:"setNeedEmptyAudioFrame",value:function(t){this.ctrlBuffer.setNeedEmptyAudioFrame(t),u.a.log("FlvParser.setNeedEmptyAudioFrame "+t)}},{key:"getParserBufLen",value:function(){return this.ctrlBuffer.getBufferLen()}},{key:"setDroppingSample",value:function(t){this.droppingSample=t}},{key:"parseFlv",value:function(t){var e=0;if(this.headCache){var s=new Uint8Array(t.length+this.headCache.length);s.set(this.headCache,0),s.set(t,this.headCache.length),t=s}var r,n=t.length;if(!1===this.parseFlvHead){var a=i.FLV_HEADER_LEN+i.PREV_TAG_SIZE_LEN;if(n<a)return u.a.warn("FlvParser.parseFlv flv has no header len="+n),void(this.headCache=t.slice());if(this.headCache=null,e+=a,!i.probe(t))return;this.parseFlvHead=!0,this.beginParseTs=Date.now()}for(0===e?this.flvCacher.append(t):this.flvCacher.append(t.slice(e));null!==(r=this.flvCacher.popFrame());)this.parseTag(r)}},{key:"parseTag",value:function(t){var e=t.length;if(e<i.TAG_HEADER_LEN+i.PREV_TAG_SIZE_LEN)u.a.warn("FlvParser.parseTag flv has no whole tag len="+e+" data="+t);else{var s=0,r=t[s++],n=(t[s++]<<16)+(t[s++]<<8)+t[s++];if(e-(i.TAG_HEADER_LEN+i.PREV_TAG_SIZE_LEN)<n)u.a.warn("FlvParser.parseTag flv has no enough data dataLen="+n+" len="+e);else if(0!==n){var a=(t[s++]<<16)+(t[s++]<<8)+t[s++]+parseInt(t[s++].toString(16)+"000000",16);s+=3,r===i.VIDEO_TYPE?(this.avSample.addVideoSample(e,a),It||this.mse.isPureAudio||(this.parseVideo(t,11,n,a),this.mse.setExceptionStat(l.a.DIM_LINK_STA.VIDEO_FRAME,1))):r===i.AUDIO_TYPE?(this.avSample.addAudioSample(e,a),wt||this.mse.isPureVideo||(this.parseAudio(t,11,n,a),this.mse.setExceptionStat(l.a.DIM_LINK_STA.AUDIO_FRAME,1))):r===i.SCRIPT_TYPE?this.parseScriptTag(t,11,n,a):(u.a.warn("%cFlvParser.parseTag discard type="+r+" len="+n,"color:white;background:black"),this.mse&&this.mse.onVideoParseInvalid&&this.mse.onVideoParseInvalid())}else u.a.warn("FlvParser.parseTag flvtag empty type="+r)}}},{key:"parseScriptTag",value:function(t,e,s,r){if(e+i.SCRIPT_AMF1_HEAD_LEN>s)u.a.log("script too small");else{t[e++];var n=(t[e++]<<8)+t[e++],a=G.getStr(t,e,n);e+=n,"onMetaData"===a?Object.assign(this.mse.metadata,G.parseScript(t,e,t.length).data):-1!==a.indexOf("onMixAudio")&&this.mse.scriptVolumeInfos.addMixAudio(a.replace("onMixAudio:",""),r)}}},{key:"parseVideo",value:function(t,e,s,r){if(s<5)u.a.warn("FlvParser.parseVideo avc videotag not enough dataLen="+s);else{var n=t[e]>>4;this.codec=15&t[e++];var a=t[e++];if(5!==s)if(0===a)this.parseVideoConfig(t,e,s,r);else if(1===a){if(n==i.IFRAME)this.mse.setExceptionStat(l.a.DIM_LINK_STA.VIDEO_IFRAME,1),this.hasKeyFrame||(this.decodeIFRTime=c.a.now()),this.hasKeyFrame=!0;else if(!this.hasKeyFrame)return void u.a.log("-------- drop video tag has no IFrame",r);Number(localStorage._printVideoTs)&&u.a.debug("%cFlvParser video ts","color:green",r,r-this.lastVideoTs),this.lastVideoTs>0&&r-this.lastVideoTs>200&&u.a.warn("FlvParser video dts jump lastDts=".concat(this.lastVideoTs," curDts=").concat(r," gap=").concat(r-this.lastVideoTs)),this.lastVideoTs=r,this.parseVideoNalu(t,e,s,r,n)}else 2===a?u.a.info("%cFlvParser.parseVideo avc_end dataLen="+s,"color:white;background:black"):u.a.warn("%cFlvParser.parseVideo error avc packet type="+a,"color:white;background:black");else u.a.log("FlvParser.parseVideo avc_empty frameType="+n+" avcPacketType="+a)}}},{key:"onAV1SequenceHeader",value:function(t){var e="av01."+t.seq_profile+"."+ut.zeroPad(t["seq_level_idx[0]"],2)+(t["seq_tier[0]"]?"H":"M")+"."+ut.zeroPad(t.BitDepth,2)+"."+t.mono_chrome+"."+t.subsampling_x+t.subsampling_y+(1===t.subsampling_x&&1===t.subsampling_y?t.chroma_sample_position:0);t.color_description_present_flag&&(e+="."+ut.zeroPad(t.colorPrimaries,2)+"."+ut.zeroPad(t.transferCharacteristics,2)+"."+ut.zeroPad(t.matrixCoefficients,2)+"."+t.color_range);var i=t.max_frame_width_minus_1+1,s=t.max_frame_height_minus_1+1,r={isHevc:!1,isAV01:!0,width:i,height:s,codec:e};this.mse.setExceptionStat(l.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.mse.setResolution(i,s),this.remuxer.switchLevel(!1,!1),this.ctrlBuffer.updateVideoConfig(r,!1)}},{key:"onAV1MetaData",value:function(t,e){e.itu_t_t35_payload_bytes&&this.sei.parseSei(t,e.itu_t_t35_payload_bytes,at.AV1_CODEC_TYPE,this.seiTypes)}},{key:"parseVideoConfig",value:function(t,e,s,r){var n,a,o=[],h=[],c=[],d=!1,p=null,f=(e+=3)+s-5;if(this.isAv01()){this.av1Bytes=t.subarray(e,e+s-5);var _=t.subarray(e+=4,e+s);ut.parseOBU(_,0,this.onAV1SequenceHeaderBind)}else{if(this.isHevc()){this.showH265Tip||(this.showH265Tip=!0,u.a.warn("This is a H265 video.")),this.mse.setExceptionStat(l.a.DIM_LINK_STA.H265,1);for(var m=(126&t[e+=4])>>1,y=e;e<f;){if(this.isHevcNal(t,e)||e+1===f){switch(m){case i.NAL_VPS:var v={data:t.subarray(y,e),type:m};this.vpsUnit&&this.vpsUnit.data.toString(16)!==v.data.toString(16)&&(u.a.log("FlvParser.parseVideoConfig vps changed"),d=!0),this.vpsUnit=v,c.push(v.data);break;case i.NAL_SPS:var S={data:t.subarray(y,e),type:m};this.spsUnit&&this.spsUnit.data.toString(16)!==S.data.toString(16)&&(u.a.log("FlvParser.parseVideoConfig sps changed"),d=!0),this.spsUnit=S,o.push(S.data);break;case i.NAL_PPS:var g={data:t.subarray(y,e),type:m};this.ppsUnit&&this.ppsUnit.data.toString(16)!==g.data.toString(16)&&(u.a.log("FlvParser.parseVideoConfig pps changed"),d=!0),this.ppsUnit=g,h.push(g.data)}if(e+4<f){m=(126&t[e+=4])>>1,y=e;continue}}e++}p={isHevc:!0,isAV01:!1,vps:c,sps:o,pps:h,codec:"avc1.4d401f",width:this.mse.width,height:this.mse.height},this.hasCtsZero=!0}else{e+=4,this.lengthSizeMinusOne=3&t[e++];for(var T=0,w=0,I="",E=31&t[e++],P=0;P<E;++P){n=(t[e++]<<8)+t[e++];var b={data:t.subarray(e,e+n),type:7};this.spsUnit&&this.spsUnit.data.toString(16)!==b.data.toString(16)&&(u.a.log("FlvParser.parseVideoConfig sps changed"),d=!0),this.spsUnit=b,e+=n,o.push(b.data);var C=new B(b.data).readSPS();T=C.width,w=C.height;for(var R=b.data.subarray(1,4),A="avc1.",k=0;k<3;k++){var D=R[k].toString(16);D.length<2&&(D="0"+D),A+=D}I=A}for(var L=t[e++],O=0;O<L;++O){a=(t[e++]<<8)+t[e++];var N={data:t.subarray(e,e+a),type:8};this.ppsUnit&&this.ppsUnit.data.toString(16)!==N.data.toString(16)&&(u.a.log("FlvParser.parseVideoConfig pps changed"),d=!0),this.ppsUnit=N,e+=a,h.push(N.data)}p={isHevc:!1,isAV01:!1,sps:o,pps:h,width:T,height:w,codec:I},this.mse.setExceptionStat(l.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.mse.setResolution(T,w)}this.remuxer.switchLevel(d,!1),this.ctrlBuffer.updateVideoConfig(p,d),u.a.log("FlvParser.parseVideoConfig avccfg dataLen="+s+" spsLen="+n+" ppsLen="+a+" w/h="+p.width+"/"+p.height+" codec="+p.codec)}}},{key:"parseVideoNalu",value:function(t,e,s,r,n){var a,o,h=[],c=0,l=n===i.IFRAME,d=(t[e++]<<16)+(t[e++]<<8)+t[e++];0===d?this.hasCtsZero||(this.hasCtsZero=!0):d>=8388608?d-=16777216:d>2500&&d<3500?d=0:d>600&&u.a.warn("FlvParser.parseVideoNalu large cts="+d+" dts="+r),l&&!this.isAv01()&&(this.vpsUnit&&(h.push(this.vpsUnit),c+=this.vpsUnit.data.length),this.spsUnit&&(h.push(this.spsUnit),c+=this.spsUnit.data.length),this.ppsUnit&&(h.push(this.ppsUnit),c+=this.ppsUnit.data.length));var p=e+s-5,f=!1;if(this.seiTypes={},this.isAv01()){var _=t.subarray(e,e+s-5);h.push({data:_,type:1===n?5:1}),ut.parseOBU(_,r,null,this.onAV1MetaDataBind),c+=_.length,a=1}else if(this.isHevc()){var m=this.hevcFindNextStartCode(t,e);if(!m.found)return u.a.error("hevcFindNextStartCode failed! dataLen",s),void this.mse.on265StartCodeError();for(var y=(126&t[e+=m.startCodeSize])>>1,v=e;e<p;)((m=this.hevcFindNextStartCode(t,e)).found||e+1===p)&&(y<10&&(f=!((98&y)>>1)),o={data:t.subarray(v,e),type:y},39===y?this.sei.parseSei(r,o.data,at.H265_CODEC_TYPE,this.seiTypes):(h.push(o),c+=o.data.length),e+m.startCodeSize<p)?(y=(126&t[e+=m.startCodeSize])>>1,v=e):e++}else for(var S=s-5;S;){a=0;for(var g=0;g<=this.lengthSizeMinusOne;++g)a+=t[e++]<<8*(this.lengthSizeMinusOne-g);if(S-=this.lengthSizeMinusOne+1,0!==a){if(a<0||a>s-5)break;if(a>S){e+=S;break}S-=a,o={data:t.subarray(e,e+a),type:1===n?5:1},this.isH264Sei(o.data)?this.sei.parseSei(r,o.data,at.H264_CODEC_TYPE,this.seiTypes):this.isH264NALUPPS(o.data)?(h.push(o),c+=o.data.length):this.isH264Aud(o.data)&&this.deleteH264Aud||(h.push(o),c+=o.data.length),e+=a}}if(c>0){var T={type:this.isAv01()?"av01":"avc",units:h,len:c,ts:r,cts:d,dts:90*r,pts:90*(r+d),key:n===i.IFRAME,origin_iframe:1===this.seiTypes[at.SEI_TYPES.IFRAME],isBFrameType:f,av1Bytes:this.av1Bytes};if(this.droppingSample&&this.droppingSample(T))return;this.printFirstVideoTs||(this.printFirstVideoTs=!0,u.a.log("FlvParser.parseVideo dts=".concat(r," pts=").concat(T.pts/90," isIFrame=").concat(l))),this.pfvTs||(this.pfvTs=!0,u.a.log("FlvParser.parseVideo11 dts=".concat(r," pts=").concat(T.pts/90," isIFrame=").concat(l))),this.fps.addDts(r,s),this.mse.curVideoDts=r,this.lastParseDts=r,this.videoFrames++,this.timeStampStat.setTimeStamp(r,r+d,d),this.ctrlBuffer.addSample(T),this.playVideoFrameCnt++,this.timeStampStat.playVideoFrameCnt++,this.playVideoLength+=s}else u.a.warn("FlvParser.parseVideoNalu discard empty nalu dts="+r+" pts="+(r+d)+" dataLen="+s+" naluLen="+a)}},{key:"parseAudio",value:function(t,e,s,r){var n=t[e++]>>>4,a=!0,o=r;10!=n&&u.a.error("FlvParser.parseAudio Unsupported audio codec, soundFormat="+n),this.calcAudioFrameRate(r),null!=this.audioIncreaseTSMap.get(r)&&(r=this.audioIncreaseTSMap.get(r)),r<this.lastAudioTs&&0!=this.lastAudioTs&&(a=!1);var h=t[e++];if(0===h)if(s>=4){var c=t[e]>>3;this.audioObjectType=c;var d=((7&t[e])<<1)+((128&t[e+1])>>7);if(d>=i.AdtsSampleingRates.length)return void u.a.error("FlvParser.parseAudio SampleingRate out of bounds. samplingIndex="+d);this.audioChannelCount=(120&t[e+1])>>3;var p=!1,f=this.getAdtsConfig(c,d,this.audioChannelCount);f.toString(16)!==this.audioConfig.toString(16)&&(this.audioConfig.toString(16)===Pt.toString(16)&&this.remuxer.videoISGenerated&&(p=!0),u.a.warn("FlvParser.parseAudio adts changed old="+this.audioConfig+" new="+f)),this.audioConfig=f,this.ctrlBuffer.updateAudioConfig({config:f,codec:"mp4a.40.5",audiosamplerate:this.audioSampleRate,aacTimeLen:this.aacTimeLen,audioObjectType:this.audioObjectType,audioChannelCount:this.audioChannelCount},p),this.firstAudioTs=-1,this.firstDemuxAudioTS=-1,this.lastAudioTs=0,this.remuxer.switchLevel(!1,p),this.mse.setExceptionStat(l.a.DIM_LINK_STA.AUDIO_CONFIG,1)}else u.a.warn("FlvParser.parseAudio adts error dataLen="+s+" ts="+r);else if(1===h){if(this.last10anduiptsList.shift(),this.last10anduiptsList.push(r),-1==this.firstAudioTs&&(this.firstAudioTs=r),-1==this.firstDemuxAudioTS)this.firstDemuxAudioTS=r;else if(r==this.firstDemuxAudioTS)return void u.a.warn("parseaudio audio too much audio in firstTs ts="+r);if(!a)return void u.a.warn("parseaudio audio ts too small maxlist="+this.maxaudioptsList+"  now="+r+"  first="+this.firstAudioTs+"  last="+this.lastAudioTs);for(var _=0;_<10;_++)this.maxaudioptsList[_]=this.last10anduiptsList[_];if(this.lastAudioTs>0&&this.lastAudioTs==r){var m=r+(0|this.aacTimeLen);this.audioIncreaseTSMap.set(o,m),r=m}if(Number(localStorage._printAudioTs)&&u.a.debug("%cFlvParser audio ts","color:red",r,r-this.lastAudioTs),this.lastAudioTs=r,this.hasAudioTag=!0,!this.validAacSample(r))return;var y=s-2,v={type:"aac",unit:t.subarray(e,e+y),dts:90*r,pts:90*r,ts:r};if(this.droppingSample&&this.droppingSample(v))return;this.printFirstAudioTs||(this.printFirstAudioTs=!0,u.a.log("FlvParser.parseAudio",r)),this.pfaTs||(this.pfaTs=!0,u.a.log("FlvParser.parseAudio11",r)),this.audioFps.addDts(r),this.mse.curAudioDts=r,this.lastParseDts=r,this.audioFrames++,this.ctrlBuffer.addSample(v)}else u.a.warn("FlvParser.parseAudio error aac packet type="+h)}},{key:"validAacSample",value:function(t){var e=this.ctrlBuffer.avBuffer.aBuffer.samples,i=e.length;if(i>0){var s=e[i-1];return 1===i&&s.ts>t&&s.ts-t>this.validAacTime?(e.shift(),!0):t-s.ts<this.validAacTime}return!0}},{key:"getAdtsConfig",value:function(t,e,s){var r=0,n=null,a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox")?e>=6?(t=5,n=new Array(4),r=e-3):(t=2,n=new Array(2),r=e):-1!==a.indexOf("android")?-1!==a.indexOf("mqqbrowser")?(t=2,n=new Array(2),r=e):(t=5,n=new Array(4),r=e):(t=5,n=new Array(4),r=e,e>=6?r=e-3:1===s&&(t=2,n=new Array(2),r=e)),this.audioSampleRate=i.AdtsSampleingRates[e],this.aacTimeLen=1024e3/this.audioSampleRate,u.a.log("FlvParser.getAdtsConfig audioSampleRate="+this.audioSampleRate+" aacTimeLen="+this.aacTimeLen),n[0]=t<<3,n[0]|=(14&e)>>1,n[1]=(1&e)<<7,n[1]|=s<<3,5===t&&(n[1]|=(14&r)>>1,n[2]=(1&r)<<7,n[2]|=8,n[3]=0),u.a.log("FlvParser.getAdtsConfig type="+t+" index="+e+" channel="+s+" exIndex="+r+" config="+n),n}},{key:"parseOBUHeader",value:function(t){var e={};return e.obu_forbidden_bit=t>>7,e.obu_type=(120&t)>>3,e.obu_extension_flag=(4&t)>>2,e.obu_has_size_field=(2&t)>>1,e.obu_reserved_1bit=1&t,e}},{key:"isHevc",value:function(){return 12==this.codec}},{key:"isAv01",value:function(){return 13==this.codec}},{key:"hevcFindNextStartCode",value:function(t,e){return 0===t[e]&&0===t[e+1]?1===t[e+2]?{found:!0,startCodeSize:3}:0===t[e+2]&&1===t[e+3]?{found:!0,startCodeSize:4}:{found:!1}:{found:!1}}},{key:"isHevcNal",value:function(t,e){return 0===t[e]&&0===t[e+1]&&0===t[e+2]&&1===t[e+3]}},{key:"isH264Sei",value:function(t){return 6===t[0]}},{key:"isH264Aud",value:function(t){return 9===t[0]}},{key:"isH264NALUPPS",value:function(t){return 40===t[0]}},{key:"getCalculateVideoFramePlayDelay",value:function(){return 0}},{key:"_remux",value:function(t,e){this.remuxer.remux(e,t,0,!1)}},{key:"calcAudioFrameRate",value:function(t){this.audioFrameRateTs||(this.audioFrameRateTs=t,this.audioFrameCnt=0),t-this.audioFrameRateTs<1e3?this.audioFrameCnt++:(Number(localStorage._printAudioFrameRate)&&u.a.log("@@@@@@@@ audioFrameRate="+this.audioFrameCnt),this.audioFrameRateTs=t,this.audioFrameCnt=0)}}],[{key:"probe",value:function(t){return!(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])}}]),i}(W);bt.EVENTS={META_DATA:"meta_data",SWITCH_URL_DONE:"switch_url_done"},bt.REMUX_TYPE_AUDIO=0,bt.REMUX_TYPE_VIDEO=1,bt.FLV_HEADER_LEN=9,bt.TAG_HEADER_LEN=11,bt.PREV_TAG_SIZE_LEN=4,bt.AUDIO_TYPE=8,bt.VIDEO_TYPE=9,bt.SCRIPT_TYPE=18,bt.SCRIPT_AMF1_HEAD_LEN=13,bt.SCRIPT_AMF2_HEAD_LEN=5,bt.IFRAME=1,bt.NAL_VPS=32,bt.NAL_SPS=33,bt.NAL_PPS=34,bt.H265_SEI_HEAD=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],bt.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var Ct=bt,Rt=function(){function t(e){Object(s.a)(this,t),this.seiList=[],this.player=e,this.lastTs=-1,this.internal=10,this.timerStart=!1}return Object(r.a)(t,[{key:"add",value:function(t,e){var i=this.seiList.length;if(this.seiList.length>0)for(i=this.seiList.length-1;i>0&&!(t>this.seiList[i].timeStamp);i--);this.seiList.splice(i+1,0,{timeStamp:t,data:e}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchSei.bind(this),this.internal))}},{key:"checkDispatchSei",value:function(){if(this.timerStart){for(var t=this.player.getCurrentRealTime(),e=0,i=null;e<this.seiList.length-2;){if(t>=this.seiList[e].timeStamp&&this.seiList[e+1].timeStamp>t){i=this.seiList[e+1].data,this.player.onH264Sei(i,this.seiList[e+1].timeStamp),this.seiList.splice(0,e+1);break}e++}setTimeout(this.checkDispatchSei.bind(this),this.internal)}}},{key:"reset",value:function(){this.seiList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}]),t}(),At=function(){function t(e){Object(s.a)(this,t),this.volumeList=[],this.player=e,this.lastTs=-1,this.internal=100,this.timerStart=!1,this.dispatchMap=new Map}return Object(r.a)(t,[{key:"addMixAudio",value:function(t,e){if(t.length>0)for(var i=t.split(","),s=0;s<i.length;s++)this.add(e,i[s])}},{key:"add",value:function(t,e){var i=this.volumeList.length;if(this.volumeList.length>0)for(i=this.volumeList.length-1;i>0&&!(t>this.volumeList[i].timeStamp);i--);this.volumeList.splice(i+1,0,{timeStamp:t,data:e}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchVolume.bind(this),this.internal))}},{key:"checkDispatchVolume",value:function(){var t=this;if(this.timerStart){var e=this.player.getCurrentRealTime(),i=0;for(this.dispatchMap.clear();this.volumeList[i]&&this.volumeList[i].timeStamp<e;){var s=this.volumeList[i].data.split("_");s.length>1&&this.dispatchMap.set(s[0],s[1]),i++}this.dispatchMap.forEach((function(e,i,s){t.player.onScriptVolumeInfo(i,e)})),this.dispatchMap.clear(),this.volumeList.splice(0,i),this.volumeList.length>0?setTimeout(this.checkDispatchVolume.bind(this),this.internal):this.timerStart=!1}}},{key:"reset",value:function(){this.volumeList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}]),t}(),kt=function(){function t(e,i){Object(s.a)(this,t),this.mse=e,this.video=i,this.playing=!1,this.seekTime=0,this.isMuffled=!1,this.cacheVolume=1,i.addEventListener("pause",e.onVideoPauseBind),i.addEventListener("error",e.onVideoErrorBind),i.addEventListener("play",e.onVideoPlayBind),i.addEventListener("playing",e.onVideoPlayingBind),i.addEventListener("loadeddata",e.onVideoLoadedBind)}return Object(r.a)(t,[{key:"seek",value:function(t){this.seekTime=t,this.video&&(this.video.currentTime=t)}},{key:"_checkPlay",value:function(){u.a.log("MSEVideo.checkPlay seekTime=".concat(this.seekTime," playing=").concat(this.playing," currentTime=").concat(this.video&&this.video.currentTime)),this.video&&0===this.video.currentTime&&!this.playing?(this.seekTime>0?(this.seekTime++,this.video.currentTime=this.seekTime):this.video.currentTime+=1,this._play()):A.a.remove(this._checkPlay,this)}},{key:"play",value:function(){"safari"!==f.a.name||this.mse.isLive?(this._play(),A.a.add(this._checkPlay,this,1e3)):A.a.add(this._checkPlay,this,1e3)}},{key:"_play",value:function(){var t=this;if(this.video){var e=this.video.play();e?e.then((function(){A.a.remove(t._checkPlay,t),u.a.log("MSEVideo._play suc currentTime=".concat(t.video&&t.video.currentTime)),t.mse&&t.mse.handler.eventEmitter&&t.mse.handler.eventEmitter.roomRecordStat&&t.mse.handler.eventEmitter.roomRecordStat.roomNoRenderStat.resume(),a.a.platform===R.a.PLATFORM_TYPE_NAME.wap&&!t.playing&&t.mse&&t.mse.triggerH5PlayVideo(),t.playing=!0})).catch((function(e){t.playing=!1;var i=e.toString();u.a.error("MSEVideo.play error: ".concat(i)),t.mse&&(i.indexOf("NotAllowedError")>=0||i.indexOf("request was interrupted")>=0||t.video.paused)&&(t.mse&&t.mse.onPauseByBrowser(),a.a.platform===R.a.PLATFORM_TYPE_NAME.wap&&A.a.remove(t._checkPlay,t))})):this.playing=!1}else A.a.remove(this._checkPlay,this)}},{key:"pause",value:function(){this.video.pause()}},{key:"getBufferLen",value:function(){var t=0;if(this.video){var e=this.video.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.video.currentTime)>>0)}return t}},{key:"printBuffered",value:function(){for(var t=this.video.buffered,e=[],i=0;i<t.length;i++)e.push("[".concat(t.start(i),", ").concat(t.end(i),"]"));u.a.log("video.buffered",e.join(" "),"video.currentTime=",this.video.currentTime)}},{key:"getCurrentTime",value:function(){return Math.round(1e3*this.video.currentTime)}},{key:"setVolume",value:function(t){this.isMuffled?this.video.volume=0:this.video.volume=t,this.cacheVolume=t}},{key:"setMuffledVolume",value:function(t){this.isMuffled=t,this.isMuffled?this.video.volume=0:this.setVolume(this.cacheVolume)}},{key:"getVolume",value:function(){return this.video.volume}},{key:"setMuted",value:function(t){this.video&&(this.video.muted=t,u.a.log("MSEVideo.setMuted ".concat(t," hasVideo=").concat(!!this.videoSourceBuffer," hasAudio=").concat(!!this.audioSourceBuffer)))}},{key:"getMuted",value:function(){return this.video?this.video.muted:-1}},{key:"destroy",value:function(){this.video.removeEventListener("error",this.mse.onVideoErrorBind),this.video.removeEventListener("pause",this.mse.onVideoPauseBind),this.video.removeEventListener("play",this.mse.onVideoPlayBind),this.video.removeEventListener("loadeddata",this.mse.onVideoLoadedBind),this.pause(),this.video.removeAttribute("src"),"function"==typeof this.video.load&&function(){try{this.video.load()}catch(t){}}(),this.video=null,this.mse=null}}]),t}(),Dt=function(){function t(){Object(s.a)(this,t),this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0,this.aiEmptyTime=0,this.aiEmptyCnt=0}return Object(r.a)(t,[{key:"reset",value:function(){this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0}},{key:"getStats",value:function(){var t={emptyTime:this.emptyTime,emptyCnt:this.emptyCnt};return this.emptyTime=0,this.emptyCnt=0,t}},{key:"getAiStats",value:function(){var t={aiEmptyTime:this.aiEmptyTime,aiEmptyCnt:this.aiEmptyCnt};return this.aiEmptyTime=0,this.aiEmptyCnt=0,t}},{key:"checkBuffer",value:function(t,e){e<200&&0===this.emptyTs?this.emptyTs=t:e>500&&this.emptyTs>0&&(this.emptyTime+=t-this.emptyTs,this.aiEmptyTime+=t-this.emptyTs,this.emptyTs=0,this.emptyCnt++,this.aiEmptyCnt++)}}]),t}(),Lt=function(){function t(){Object(s.a)(this,t),this._cnt=0,this._duration=0,this._pauseTs=0,this._aiCnt=0,this._aiDuration=0}return Object(r.a)(t,[{key:"reset",value:function(){this.resetStat(),this.resetAiStat(),this._pauseTs=0}},{key:"resetStat",value:function(){this._cnt=0,this._duration=0}},{key:"pause",value:function(){0===this._pauseTs&&(this._pauseTs=c.a.now())}},{key:"resume",value:function(){this.calc(!0)}},{key:"calc",value:function(t){if(this._pauseTs>0){var e=c.a.now(),i=e-this._pauseTs;i>=200&&(this._cnt++,this._aiCnt++,this._duration+=i,this._aiDuration+=i),this._pauseTs=t?0:e}}},{key:"resetAiStat",value:function(){this._aiCnt=0,this._aiDuration=0}},{key:"getAiStat",value:function(){var t={aiCnt:this._aiCnt,aiDuration:this._aiDuration};return this.resetAiStat(),t}},{key:"record",value:function(t){this.calc(!1),t.setCore(l.a.CORE.VIDEO_BLOCK_COUNT,this._cnt),t.setCore(l.a.CORE.VIDEO_BLOCK_DURATION,this._duration),this.resetStat()}}]),t}(),Ot=i(18),Bt=function(){function t(e,i){Object(s.a)(this,t),this._mse=e,this._callbacks=i,this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0}return Object(r.a)(t,[{key:"reset",value:function(){this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0}},{key:"check",value:function(t){var e=this._mse.video.video;!this._mse.isLive&&e.currentTime<=1||(0!==this._playedTime&&(e.currentTime===this._playedTime?this._paused?this._fixedCurrentTime(t,e):this._setPaused(t,e):this._paused&&this._setResume(t,e)),this._playedTime=e.currentTime)}},{key:"_setPaused",value:function(t,e){this._paused=!0,this._pausedTs=t,this._lastPausedTs=t,this._log("_setPaused",e),this._callbacks.pause(t)}},{key:"_setResume",value:function(t,e){var i=t-this._pausedTs;this._paused=!1,this._pausedTs=0,this._lastPausedTs=0,this._log("_setResume",e),this._callbacks.resume(t,i)}},{key:"_fixedCurrentTime",value:function(t,e){t-this._lastPausedTs>500&&(this._fixedByBuffered(e)||this._fixedByDts(e))&&(this._lastPausedTs=t)}},{key:"_fixedByBuffered",value:function(t){if("flv"===this._mse.videoType){var e=t.buffered.length;if(e>0){var i=t.buffered.start(e-1),s=t.buffered.end(e-1);if(i>t.currentTime&&s-i>1)return this._log("_fixedByBuffered",t),t.currentTime=i,!0}}return!1}},{key:"_fixedByDts",value:function(t){return!!(this._mse.getBufferLen()>2e3&&this._mse.isLive)&&(this._log("_fixedByDts",t),t.currentTime+=1,!0)}},{key:"_log",value:function(t,e,i){this._mse.video.printBuffered(),u.a.log("MSEPause(".concat(this._mse._num_,").").concat(t," readyState=").concat(e.readyState," currentTime=").concat(e.currentTime," buf=").concat(this._mse.getBufferLen()," dts=").concat(this._mse.getCurrentDts()," ").concat(i||""))}},{key:"paused",get:function(){return this._paused}},{key:"pausedTs",get:function(){return this._pausedTs}}]),t}(),Nt=function(){function t(){Object(s.a)(this,t),this.startDts=0,this.endDts=0,this.endFrameId=0}return Object(r.a)(t,[{key:"isDisconnectDts",value:function(t){return this.endDts>0&&t-this.endDts>200}},{key:"isDisconnectFrame",value:function(t){return this.endFrameId>0&&t-this.endFrameId!=1}},{key:"getContinueBuffer",value:function(t){return t>=this.startDts&&t<=this.endDts?this.endDts-t:0}},{key:"addBuffer",value:function(t,e){0===this.startDts&&(this.startDts=e),this.endDts=e,this.endFrameId=t}}]),t}(),Ut=1,Ft=2,Mt=3,Vt=1,xt=2,Ht=3,Gt=0,Wt=1,jt=2,qt=3,Yt=4,Jt=5,Kt=6,zt=7,Qt=9,Xt=10,$t=0,Zt=1,te=2,ee=3,ie=4,se="timer",re="record",ne="resume",ae=function(){function t(){Object(s.a)(this,t),this._frameId=0,this._lastFrameId=0,this._startFrameId=0}return Object(r.a)(t,[{key:"reset",value:function(){this._frameId=0,this._lastFrameId=0,this._startFrameId=0}},{key:"setStartFrameId",value:function(t){this._startFrameId=t,this._lastFrameId=this._frameId}},{key:"getFrameId",value:function(t,e){return 0===t?(this._frameId++,e>0&&this._frameId++):(e>0&&this._lastFrameId++,this._frameId=this._lastFrameId+(t-this._startFrameId+1)),this._frameId}}]),t}(),oe=function(){function t(){Object(s.a)(this,t),this._mse=null,this._list=[],this._dtsList=[],this._tsList=[],this._currentBuffered=null,this._continueBuffer=-1,this._lastFrameTs=0,this._startTs=0,this._started=!1,this._lastRemoveTs=0,this._deltaStart=Number(a.a.continueBufferDeltaStart)||6e3,this._deltaEnd=Number(a.a.continueBufferDeltaEnd)||3e3,this._localFrameId=new ae,this._printContinueBuffer=1==localStorage._printContinueBuffer}return Object(r.a)(t,[{key:"setMse",value:function(t){this._mse=t}},{key:"stop",value:function(){u.a.log("VideoBufferedList.stop"),this._startTs=0,this._list=[],this._dtsList=[],this._continueBuffer=-1,this._currentBuffered=null,this._localFrameId.reset(),A.a.remove(this.onCheckFastTimer,this)}},{key:"printInfo",value:function(t){var e=[];this._list.forEach((function(t){e.push("[".concat(t.startDts,", ").concat(t.endDts,"]"))})),u.a.log("VideoBufferedList.print dts=".concat(t," buffered=").concat(e.join(" ")))}},{key:"record",value:function(t){this._calc(c.a.now(),re),t.setCore(l.a.CORE.VIDEO_CONTINUE_BUFFER,this._continueBuffer),this._continueBuffer=-1}},{key:"start",value:function(){0===this._startTs&&(u.a.log("VideoBufferList.start"),this._startTs=c.a.now(),A.a.add(this.onCheckFastTimer,this,50))}},{key:"onCheckFastTimer",value:function(t){if(0===this._lastRemoveTs)this._lastRemoveTs=t;else if(this._lastRemoveTs>0&&t-this._lastRemoveTs>5e3){this._lastRemoveTs=t;for(var e=this._mse.getCurrentDts()-2e4,i=this._dtsList.length-1;i>=0;i--)if(this._dtsList[i]<e){this._dtsList=this._dtsList.slice(i),this._tsList=this._tsList.slice(i);break}}var s=t-this._lastFrameTs;this._lastFrameTs>0&&s>100&&(this._calc(t,se),this._lastFrameTs=t)}},{key:"addSample",value:function(t,e,i,s){var r=c.a.now();this._tsList.push(r),this._dtsList.push(e),(0===this._lastFrameTs||i)&&this._localFrameId.setStartFrameId(t),this._lastFrameTs=r;var n=this._localFrameId.getFrameId(t,s);this._currentBuffered&&!this._currentBuffered.isDisconnectFrame(n)||(this._currentBuffered=new Nt,this._list.push(this._currentBuffered),this._list.length>10&&e-this._list[0].endDts>3e5&&this._list.shift()),this._currentBuffered.addBuffer(n,e)}},{key:"_calc",value:function(t,e){var i=t-this._deltaStart,s=t-this._deltaEnd;if((e===re||e===ne)&&-1===this._continueBuffer)return this._continueBuffer=this._getContinueBuffer(this._mse.getCurrentDts()),void(this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+" continueBuffer=".concat(this._continueBuffer," from=").concat(e," ")));if(!(0===this._startTs||i<this._startTs)){for(var r=this._getDtsBound(i,s),n=r.startDts,a=r.endDts,o=Number.MAX_SAFE_INTEGER,h=this._dtsList.length,u=0;u<h;u++){var c=this._dtsList[u];if(c>a)break;if(c>=n&&c<=a&&(o=Math.min(o,this._getContinueBuffer(c))),0===o)break}o===Number.MAX_SAFE_INTEGER&&(o=0),(-1===this._continueBuffer||this._continueBuffer>o)&&(this._continueBuffer=o,this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+" now=".concat(t," startDts=").concat(n," endDts=").concat(a," continueBuffer=").concat(o," from=").concat(e)))}}},{key:"_getDtsBound",value:function(t,e){for(var i=this._tsList.length,s=Number.MAX_SAFE_INTEGER,r=0,n=0;n<i;n++){var a=this._tsList[n];if(a>=t&&a<=e){var o=this._dtsList[n];o<s&&(s=o),o>r&&(r=o)}else if(a>e)break}return{startDts:s,endDts:r}}},{key:"_getContinueBuffer",value:function(t){for(var e=0,i=0;i<this._list.length&&0===(e=this._list[i].getContinueBuffer(t));i++);return e}},{key:"continueBuffer",get:function(){return this._continueBuffer},set:function(t){this._continueBuffer=t}}]),t}(),he=(i(31).default,0),ue=function(){function t(e,i){Object(s.a)(this,t);var r=i.videoType,n=void 0===r?"flv":r,a=i.isLive,o=void 0===a||a,h=i.isPureAudio,c=void 0!==h&&h,l=i.isPureVideo,d=void 0!==l&&l,p=i.h265Proxy,f=void 0===p?null:p,_=i.videoElement,m=void 0===_?null:_;this.handler=e,this.videoType=n,this.isLive=o,this.isPureAudio=c,this.isPureVideo=d,this.pushVideoStartRenderTime=0,this.h265Proxy=f,this.videoElement=m,this.requestAnimationId=-1,this._num_=++he,u.a.log("MSEPlayer(".concat(this._num_,").constructor")),this.buffered=new oe,this.buffered.setMse(this),this.remuxer=new O(this),"ts"===n?this.parser=new V(this,this.remuxer):(this.parser=new Ct(this,this.remuxer),this.parser.ctrlBuffer.setBuffered(this.buffered)),this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.latencySeek=0,this.userPaused=!1,this._triggerPlay=!1,this.hasData=!1,this.playing=!1,this.lastPlayTime=0,this.lastCheckPlayTime=0,this.maxGop=0,this.playStartTime=0,this.delayReset=!1,this.isPlayerError=!1,this.isErrorEvent=!1,this.startPlayBackRate=.9,this.pausedByBrowser=!1,this.metadata={},this.bufStat=new Dt,this.pauseStat=new Lt,this.tryPlayAgainTimout=0,this.onUpdateErrorBind=this.onUpdateError.bind(this),this.onAudioUpdateEndBind=this.onAudioUpdateEnd.bind(this),this.onVideoUpdateEndBind=this.onVideoUpdateEnd.bind(this),this.onMediaSourceOpenBind=this.onMediaSourceOpen.bind(this),this.onVideoErrorBind=this.onVideoError.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoLoadedBind=this.onVideoLoaded.bind(this),this.checkVideoPlayingBind=this.checkVideoPlaying.bind(this),this.onVideoPlayingBind=this.onVideoPlaying.bind(this),this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.h264SeiInfos=new Rt(this),this.scriptVolumeInfos=new At(this),this.video=this.createVideo(),this.msePause=new Bt(this,{pause:this._msePaused.bind(this),resume:this._mseResume.bind(this)}),this.audioSourceBuffer=null,this.videoSourceBuffer=null,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.width=1280,this.height=720,this.autoJitter=!0,this.autoBitrateJitter=!1,this.playbackrateChangeAccess=!0,this.enableLowLatency=!1,this.sensitivePause=!0,this.waitSwapToPcdn=!1,this.printJitter=!!Number(localStorage._printJitter);var y=navigator.userAgent.toLowerCase();this.isAndroid=-1!==y.indexOf("Android"),-1==u.a.getLevel()&&window.chrome&&(window.chrome.mse=this),this.videoDataAppended=!1,this.avcchangeCheckTimer=0,this.offsetDts=0,this.curVideoDts=0,this.curAudioDts=0,this.isOnFragParsed=!1,this.onFragParsedTime=0,this.isH265Play=!1,this.playRateIncrease=0,this.playRateDecrease=0,this.startPlayTime=0,this.isStartBuffer=!0,this.bufferCd=12e4,this.startCd=5e3,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.bufferMoreContinueTime=6e4,this.maxJumpWaitNow=0,this.mediaDelay=null,this.seiAnchorDelay=-1,this.discontinuityAudio=!1,this.discontinuityVideo=!1,this.isPlaybackRateNormal=!0,f&&f.initRender(this)}return Object(r.a)(t,[{key:"getDelayStat",value:function(){return"ts"!==this.videoType?this.parser.sei.getStat():null}},{key:"getDelayInfo",value:function(){return u.a.log("MSEPlayer.getDelayInfo: delay: ",this.mediaDelay),this.mediaDelay}},{key:"setSeiDelay",value:function(t){if(this.seiAnchorDelay!==t||!this.mediaDelay){var e=this.getBufferLen();this.seiAnchorDelay=t,this.mediaDelay={total_delay:this.seiAnchorDelay+e,buffer_delay:e,status:0},0===this.seiAnchorDelay&&(this.mediaDelay.status=1)}}},{key:"getRealBitrate",value:function(){var t=0;return this.parser.fps&&(t=this.parser.fps.getRealBitrate()),t}},{key:"destroy",value:function(){if(u.a.log("MSEPlayer(".concat(this._num_,").destroy")),this.buffered.stop(),this.h265Proxy&&this.h265Proxy.stop(),this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.handler&&(this.handler.onVideoStop(this.video.video,!!this.videoSourceBuffer),this.handler=null),this.remuxer.destroy(),this.parser.destroy(),this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var t=this.mediaSource.sourceBuffers;t.length;)this.mediaSource.removeSourceBuffer(t[0]);this.mediaSource=this.onMediaSourceOpenBind=null}this.onAudioUpdateEndBind=this.onVideoUpdateEndBind=this.onUpdateErrorBind=null,this.video&&(this.video.destroy(),this.video=null),this.videoElement=null,this.pushVideoStartRenderTime=0,this.playbackrateChangeAccess=!0,-1!==this.requestAnimationId&&(cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=-1),this.onFragParsedTime=0,A.a.remove(this.triggerPlayVideo,this)}},{key:"resetHls",value:function(){this.parser.pushAllData&&this.parser.pushAllData(),this.parser.reset&&this.parser.reset(),this.remuxer.reset()}},{key:"reset",value:function(){if(u.a.log("MSEPlayer(".concat(this._num_,").reset")),this.handler.onVideoStop(this.video.video,!!this.videoSourceBuffer),this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.userPaused=!1,this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.discontinuityAudio=!1,this.discontinuityVideo=!1,this.metadata={},this.msePause.paused&&this.handler.onPlayResume(c.a.now()),this.pauseStat.reset(),this.bufStat.reset(),this.msePause.reset(),this.maxGop=0,this.isPlaybackRateNormal=!0,clearTimeout(this.tryPlayAgainTimout),this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var t=this.mediaSource.sourceBuffers;t.length;)this.mediaSource.removeSourceBuffer(t[0])}this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.playbackrateChangeAccess=!0,this.videoDataAppended=!1,this.onFragParsedTime=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.maxJumpWaitNow=0}},{key:"resetVideo",value:function(){if(this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var t=this.mediaSource.sourceBuffers;t.length;)this.mediaSource.removeSourceBuffer(t[0])}this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.videoCodec=null,this.audioCodec=null,this.lastPlayTime=0}},{key:"createVideo",value:function(){this._triggerPlay=!1;var t=this.videoElement?this.videoElement:document.createElement("video");return t.src=URL.createObjectURL(this.mediaSource),new kt(this,t)}},{key:"insertDiscontinuity",value:function(){this.discontinuityAudio=!0,this.discontinuityVideo=!0}},{key:"setPushGop",value:function(t){this.parser.setPushGop(t)}},{key:"setDeleteH264Aud",value:function(t){this.parser.setDeleteH264Aud(t)}},{key:"setNeedEmptyAudioFrame",value:function(t){this.parser.setNeedEmptyAudioFrame(t)}},{key:"getPlayStat",value:function(){return this.parser.getPlayStat()}},{key:"getPlayVideo",value:function(){return this.video?this.video.video:null}},{key:"getFrameReadyed",value:function(){return this.parser&&this.parser.getFrameReadyed?this.parser.getFrameReadyed():0}},{key:"getFramePlayDelays",value:function(){return this.parser.getCalculateVideoFramePlayDelay?this.parser.getCalculateVideoFramePlayDelay():0}},{key:"getBufferLen",value:function(){return this.video?this.video.getBufferLen():0}},{key:"getFrameBufferLen",value:function(){return this.parser.getFrameBufferLen?this.parser.getFrameBufferLen():0}},{key:"getContinueBuffer",value:function(){return this.buffered.continueBuffer}},{key:"setSensitivePause",value:function(t){this.sensitivePause=t}},{key:"getParserBufLen",value:function(){return this.parser.getParserBufLen()}},{key:"getCurrentDts",value:function(){return void 0===this.remuxer.getInitDts()?0:this.video.getCurrentTime()+this.remuxer.getInitDts()}},{key:"getCurrentSeiOffsetDts",value:function(){return this.offsetDts||0}},{key:"getCurrentTime",value:function(){return this.video?this.video.getCurrentTime():0}},{key:"getCurrentRealTime",value:function(){return this.video?this.getCurrentDts():0}},{key:"appendFlv",value:function(t){this.addPlayEvent(),this.parser.parseFlv(t)}},{key:"addPlayEvent",value:function(){this.hasData||(this.hasData=!0,this.videoElement&&(this.videoElement.addEventListener("loadeddata",this.onVideoLoadedBind),this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)))}},{key:"appendTs",value:function(t){this.addPlayEvent(),this.parser.parseTs(t)}},{key:"saveH264SeiData",value:function(t,e){this.h264SeiInfos.add(t,e)}},{key:"setPlaybackrateAccess",value:function(t){this.playbackrateChangeAccess=t}},{key:"checkBuffer",value:function(){if(!this.video.video.paused){var t=c.a.now(),e=this.video.video.buffered,i=e.length,s=this.getBufferLen();if(this.bufStat.checkBuffer(t,s),0===this.video.video.currentTime&&0!==this.lastPlayTime)return u.a.warn("MSEPlayer.checkBuffer onPlayerError(true) lastPlayTime="+this.lastPlayTime+" bufLen="+s),this._onPlayerError(!0),this._onErrorEvent(9),void(this.lastPlayTime=0);if(this.lastPlayTime=this.video.video.currentTime,t>this.playStartTime+3e3&&s>4e3&&0==this.video.currentTime&&(i>0&&e.start(0)<=4&&(u.a.log("MSEPlayer.checkBuffer buffer full but can not play"),this.video.currentTime=Math.round(e.start(0)+1)),this.video.play()),0!==this.playStartTime&&t>this.playStartTime+5e3&&(s>5e3||0===s))if(0==this.video.video.currentTime&&s>2e3)u.a.log("MSEPlayer(".concat(this._num_,") ####### currentTime=0 ++ bufLen=").concat(s," paused=").concat(this.video.video.paused)),this.video.play();else if(this.playStartTime=0,0===this.video.video.currentTime&&!this.isAndroid)return u.a.warn("MSEPlayer(".concat(this._num_,").checkBuffer onPlayerError(true) playTime=")+this.video.video.currentTime+" bufLen="+s),this._onErrorEvent(6),void this._onPlayerError(!0);null==this.videoElement&&i&&this.video.video.currentTime-e.start(0)>20&&(this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&this.audioSourceBuffer.remove(0,this.video.video.currentTime-10),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&this.videoSourceBuffer.remove(0,this.video.video.currentTime-10))}}},{key:"_onPlayerError",value:function(t){!this.isPlayerError&&this.handler&&(this.isPlayerError=!0,this.handler.onPlayerError(t))}},{key:"_onErrorEvent",value:function(t){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:t}))}},{key:"onParseError",value:function(t){this._onErrorEvent(t)}},{key:"onAvcCfgChange",value:function(){return u.a.log("MSEPlayer(".concat(this._num_,").onAvcCfgChange")),this.getBufferLen()<500?(u.a.log("MSEPlayer(".concat(this._num_,").onAvcCfgChange reset player")),this.remuxer.reset(),this.parser.setPaused(!1),!1):(this.delayReset=!0,!0)}},{key:"onRestart",value:function(){u.a.log("MSEPlayer(".concat(this._num_,").onRestart")),this.reset()}},{key:"onVideoParseInvalid",value:function(){this.handler&&this.handler.onVideoParseInvalid&&this.handler.onVideoParseInvalid()}},{key:"onGop",value:function(t){this.handler.onGop&&this.handler.onGop(t),t>this.maxGop&&(this.maxGop=t,u.a.log("MSEPlayer(".concat(this._num_,").onGop update maxGop=")+this.maxGop))}},{key:"getMaxGop",value:function(){return this.maxGop}},{key:"setVolume",value:function(t){this.video.setVolume(t)}},{key:"setEnableLowLatency",value:function(t){this.enableLowLatency=t}},{key:"getVolume",value:function(){return this.video?this.video.getVolume():-1}},{key:"setMuted",value:function(t){this.video&&(this.video.setMuted(t),u.a.log("MSEPlayer.setMuted ".concat(t," hasVideo=").concat(!!this.videoSourceBuffer," hasAudio=").concat(!!this.audioSourceBuffer)))}},{key:"getMuted",value:function(){return this.video?this.video.getMuted():-1}},{key:"setResolution",value:function(t,e){u.a.log("MSEPlayer(".concat(this._num_,").setResolution w/h=")+t+"/"+e),this.width=t,this.height=e}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setExceptionStat",value:function(t,e){this.handler&&this.handler.exceptionStat&&this.handler.exceptionStat.setStat(t,e)}},{key:"turnToH264",value:function(){this.h265Proxy&&this.h265Proxy.stop(),this.handler&&this.handler.turnToH264()}},{key:"on265StartCodeError",value:function(){this.h265Proxy&&this.h265Proxy.on265StartCodeError(Ot.a.START_CODE_ERROR)}},{key:"h265Retry",value:function(){this.h265Proxy&&this.h265Proxy.stop(),this.handler.h265Retry()}},{key:"onInitSegment",value:function(t){t.audioCodec&&(this.audioCodec=t.audioCodec),t.videoCodec&&(this.videoCodec=t.videoCodec),this.isMediaSourceOpen&&this.initSourceBuffer(),t.audioMoov&&this.audioSegments.push(t.audioMoov),t.videoMoov&&this.videoSegments.push(t.videoMoov),this.playStartTime=0}},{key:"onFragParsing",value:function(t){"audio"===t.type?this.audioSegments.push(t.data):"video"===t.type&&this.videoSegments.push(t.data)}},{key:"onFragParsed",value:function(){this.audioSourceBuffer&&this.appendBuffer("audio"),this.videoSourceBuffer&&this.appendBuffer("video"),null==this.videoElement&&this.isLive&&(this.isOnFragParsed||(this.onFragParsedTime=c.a.now(),u.a.log("MSEPlayer.onFragParsed",this.onFragParsedTime),this.isOnFragParsed=!0),this.triggerPlay())}},{key:"checkVideoPlaying",value:function(){0==this.pushVideoStartRenderTime&&this.video&&this.video.video&&this.video.video.videoWidth>0&&this.video.video.videoHeight>0?this.pushVideoStartRenderTime=c.a.now():this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)}},{key:"onVideoLoaded",value:function(){u.a.log("MSEPlayer.onVideoLoaded"),this.triggerPlay()}},{key:"reloadInError",value:function(){this.handler.reloadInError&&this.handler.reloadInError()}},{key:"initSourceBuffer",value:function(){if(this.audioCodec&&!this.audioSourceBuffer){u.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer audio codec=")+this.audioCodec);try{this.audioSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(this.audioCodec)),this.audioSourceBuffer.addEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(t){return u.a.warn("MSEPlayer.initSourceBuffer audio err="+t.message),t.message&&-1!=t.message.indexOf("No additional SourceBuffer objects may be added")&&(u.a.log("MSEPlayer.initSourceBuffer resetMediasource in audio"),this.handler.resetMediasource)?void this.handler.resetMediasource():(this._onErrorEvent(4),void this._onPlayerError(!0))}}else this.audioCodec&&this.audioSourceBuffer&&this.discontinuityAudio&&(u.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer reset audio codec=")+this.audioCodec),this.audioSourceBuffer.changeType("video/mp4;codecs=".concat(this.audioCodec)));if(this.videoCodec&&!this.videoSourceBuffer){u.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer video codec=")+this.videoCodec);try{this.videoSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(this.videoCodec)),this.videoSourceBuffer.addEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(t){if(t.message&&-1!=t.message.indexOf("No additional SourceBuffer objects may be added")&&(u.a.log("MSEPlayer.initSourceBuffer resetMediasource in video"),this.handler.resetMediasource))return void this.handler.resetMediasource();u.a.warn("MSEPlayer(".concat(this._num_,").initSourceBuffer video err=")+t.message),this._onErrorEvent(5),this._onPlayerError(!0)}}else this.videoCodec&&this.videoSourceBuffer&&this.discontinuityVideo&&(u.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer reset video codec=")+this.videoCodec),this.videoSourceBuffer.changeType("video/mp4;codecs=".concat(this.videoCodec)));this.discontinuityVideo=!1,this.discontinuityAudio=!1}},{key:"appendBuffer",value:function(t){if(0!=this.mediaSource.sourceBuffers.length&&!this.isPlayerError)if("audio"==t){if(this.audioSegments.length>0&&this.audioSourceBuffer&&!this.audioSourceBuffer.updating){var e=this.audioSegments.shift();try{this.audioSourceBuffer.appendBuffer(e),this.videoDataAppended=!0}catch(t){u.a.warn("MSEPlayer(".concat(this._num_,").appendBuffer audio err=")+t.message),this._onErrorEvent(7),this._onPlayerError(!0)}}}else{if("video"!=t)throw new Error("MSEPlayer(".concat(this._num_,").appendBuffer type error! Valide type is audio or video."));if(this.videoSegments.length>0&&this.videoSourceBuffer&&!this.videoSourceBuffer.updating){var i=this.videoSegments.shift();try{this.videoSourceBuffer.appendBuffer(i),this.videoDataAppended=!0}catch(t){u.a.warn("MSEPlayer(".concat(this._num_,").appendBuffer video err=")+t.message),this._onErrorEvent(8),this._onPlayerError(!0)}}}}},{key:"recvDataFull",value:function(){this.handler&&this.handler.recvDataFull&&this.handler.recvDataFull()}},{key:"getVideoFrames",value:function(){return this.parser&&this.parser.getVideoFrames?this.parser.getVideoFrames():0}},{key:"getAudioFrames",value:function(){return this.parser&&this.parser.getAudioFrames?this.parser.getAudioFrames():0}},{key:"triggerH265Play",value:function(t,e){this.isH265Play||(u.a.log("MSEPlayer.triggerH265Play"),this.isH265Play=!0,this.h265Proxy&&this.h265Proxy.reportDecodeRenderTime(t,e))}},{key:"triggerPlay",value:function(){if(!this.playing&&this.isMediaSourceOpen){if(this.playing=!0,this.playStartTime=c.a.now(),this.videoElement&&!this.videoElement.autoplay||this.video.play(),a.a.platform===R.a.PLATFORM_TYPE_NAME.wap)return;"safari"===f.a.name?a.a.safariFirstLoad?(a.a.safariFirstLoad=!1,this.triggerPlayVideo()):A.a.once(this.triggerPlayVideo,this,a.a.safariPlayDelay):this.triggerPlayVideo()}}},{key:"triggerPlayVideo",value:function(){var t=!!this.videoSourceBuffer,e="h264";13==this.parser.codec?e="av1":12==this.parser.codec&&(e="h265"),u.a.log("MSEPlayer.onPlayVideo codec: ",e),0==this.parser.decodeIFRTime&&1==Number(a.a.isNoVideoReport)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(n.a.P2P_REPORT),this.h265Proxy&&this.h265Proxy.isReady?this.handler.onPlayVideo(this.video.video,this.width,this.height,t,this.h265Proxy.canvas,this.onFragParsedTime,e):this.handler.onPlayVideo(this.video.video,this.width,this.height,t,null,this.onFragParsedTime,e),this.startPlayTime=c.a.now()}},{key:"triggerH5PlayVideo",value:function(){if(u.a.log("trigger h5 video play"),this.pausedByBrowser)this.pausedByBrowser=!1;else{this.startPlayTime=c.a.now();var t=!!this.videoSourceBuffer;this.handler.onPlayVideo(this.video.video,this.width,this.height,t,null,this.onFragParsedTime)}}},{key:"onH264Sei",value:function(t,e){this.handler.onSendSeiData(t,e,this.video.video.currentTime)}},{key:"onScriptVolumeInfo",value:function(t,e){this.handler.onSendScriptVolumeInfo(t,e)}},{key:"onMediaSourceOpen",value:function(){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind),(this.audioSegments.length>0||this.videoSegments.length>0)&&(this.initSourceBuffer(),this.appendBuffer("audio"),this.appendBuffer("video"),u.a.log("MSEPlayer.onMediaSourceOpen"),0==this.onFragParsedTime&&(this.onFragParsedTime=c.a.now()),null==this.videoElement&&this.triggerPlay())}},{key:"onAudioUpdateEnd",value:function(){this.appendBuffer("audio"),this.checkAppendOver()}},{key:"onVideoUpdateEnd",value:function(){this.appendBuffer("video"),this.checkAppendOver()}},{key:"checkAppendOver",value:function(){0===this.videoSegments.length&&0===this.audioSegments.length&&(this.videoSourceBuffer&&this.videoSourceBuffer.updating||this.audioSourceBuffer&&this.audioSourceBuffer.updating||this.handler&&this.handler.onSBUpdateEnd&&this.handler.onSBUpdateEnd())}},{key:"onUpdateError",value:function(t){u.a.warn("MSEPlayer.onUpdateError",t)}},{key:"onVideoPause",value:function(t){this.userPaused=!0}},{key:"onPauseByBrowser",value:function(){this.handler&&(this.handler.onPauseByBrowser&&this.handler.onPauseByBrowser(),this.handler.updateStatus&&this.handler.updateStatus(n.b.BROWSER_PAUSE),this.pausedByBrowser=!0,this.handler.eventEmitter&&this.handler.eventEmitter.trigger(n.a.BROWSER_PAUSE,{video:this.video.video}))}},{key:"onVideoPlaying",value:function(){if(this.handler&&this.handler.updateStatus){if(this.video.video&&this.video.video.paused)return void u.a.log("video is playing, video.paused=",this.video.video.paused);u.a.log("video is playing",this.isPureAudio);var t=this.isPureAudio?n.b.AUDIO_PLAYING:n.b.VIDEO_PLAYING;this.handler.updateStatus(t)}}},{key:"onVideoPlay",value:function(t){this.userPaused=!1}},{key:"onVideoError",value:function(t){var e="";if(this.video.video.error){var i=this.video.video.error.code;e=" errCode="+i+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][i],3!=i&&4!=i||(this._onErrorEvent(3==i?1:2),this._onPlayerError(!0),localStorage.decodeabnormal="abnormal_"+(new Date).getTime())}u.a.warn("MSEPlayer.onVideoError"+e)}},{key:"pause",value:function(){u.a.info("MSEPlayer.pause"),this.userPaused=!0,this.video&&this.video.pause(),this.handler.eventEmitter&&this.handler.eventEmitter.roomRecordStat&&this.handler.eventEmitter.roomRecordStat.roomNoRenderStat.pause()}},{key:"play",value:function(){u.a.info("MSEPlayer.play"),this.userPaused=!1,this.video&&this.video.play()}},{key:"seek",value:function(t){this.lastPlayTime=t,u.a.info("MSEPlayer.seek seekTime="+t,"currentTime="+this.video.video.currentTime),this.video&&this.video.seek(t)}},{key:"onCheckTimer",value:function(t,e){if(this.playing&&this.isMediaSourceOpen){this.parser&&this.parser.fps&&(this.metadata.fps=this.parser.fps.getFps(),this.metadata.recvVideoFps=this.parser.fps.getRecvFps()),this.parser&&this.parser.audioFps&&(this.metadata.audioFps=this.parser.audioFps.getFps(),this.metadata.recvAudioFps=this.parser.audioFps.getRecvFps());var i=this.getBufferLen(),s=Number(localStorage._printBufferLen);if(-1==s||s>0&&s==this._num_){var r=Math.max(0,i/100);u.a.debug(this._getTag(),"bufLen","-".repeat(r),i)}if(Number(localStorage._printMseLog)&&this.audioSegments&&this.videoSegments&&u.a.debug("MSE aSegments=".concat(this.audioSegments.length," vSegments=").concat(this.videoSegments.length," bufLen=").concat(this.getBufferLen())),!this.video.video.paused&&!this.userPaused){if(null==this.videoElement&&this.isLive&&e%4==0&&i>a.a.jitJump[0]&&!Number(localStorage._localFlvTest)){var n=.001*(a.a.jitJump[0]-a.a.jitJump[1]);this.video.video.currentTime+=n,u.a.warn("MSEPlayer.onCheckTimer jumpTs=".concat(n," bufLen=").concat(this.getBufferLen()))}this.checkBuffer(),this.onJitterTimer();var o=(this.handler?this.handler.lastEmptySliceTs:0)||0,h=o>0&&t-o<3e3,c=!!this.videoSourceBuffer;this.isLive&&c&&this.msePause.pausedTs>0&&t-this.msePause.pausedTs>5e3&&!h&&this.sensitivePause&&(u.a.warn("MSEPlayer.onCheckTimer paused 5 sec."),this._onErrorEvent(3),this._onPlayerError(!0),this.handler&&this.handler.onPause5Sec&&this.handler.onPause5Sec())}}else this.parser&&this.parser.printPlayFrameInfo&&this.parser.printPlayFrameInfo()}},{key:"onCheckFastTimer",value:function(t,e){if(1===Number(a.a.isMute)&&this.muffledVoice(),this.playing&&this.isMediaSourceOpen&&!this.video.video.paused&&!this.userPaused){this.checkEmptyFrames(),this.checkDelayReset(),this.msePause.check(t);var i=(this.handler?this.handler.lastEmptySliceTs:0)||0,s=i>0&&t-i<3e3,r=!!this.videoSourceBuffer;if(null==this.videoElement&&!this.pause500checked&&r&&this.msePause.pausedTs>0&&t-this.msePause.pausedTs>500&&!s){this.pause500checked=!0;var n=this.bufferedInfo(),o=n.bufferLen.toFixed(2),h=(n.nextStart-n.end).toFixed(2);if(u.a.info("MSEPlayer(".concat(this._num_,").onCheckFastTimer paused"),"bufferLen="+o,"hole="+h,"nextStart="+n.nextStart.toFixed(2),"currentTime="+this.video.video.currentTime),this.isLive&&"ts"!=this.videoType){this.video.printBuffered();var c=Number(n.nextStart);this.video.video&&c&&h>0&&h<3&&c-this.video.video.currentTime>.5&&(this.video.video.currentTime=c,u.a.log("MSEPlayer(".concat(this._num_,").onCheckFastTimer try jump currentTime=")+this.video.video.currentTime))}}}}},{key:"checkEmptyFrames",value:function(){this.handler.hasOwnProperty("hasEmptyFrames")&&this.parser.hasEmptyFrames&&(this.handler.hasEmptyFrames=this.parser.hasEmptyFrames)}},{key:"checkDelayReset",value:function(){this.delayReset&&this.getBufferLen()<500&&(u.a.log("MSEPlayer(".concat(this._num_,").checkDelayReset reset player")),this.remuxer.reset(),this.parser.setPaused(!1),this.delayReset=!1)}},{key:"_msePaused",value:function(t){this.pauseStat.pause(),this.handler.eventEmitter&&this.handler.eventEmitter.roomRecordStat&&this.handler.eventEmitter.roomRecordStat.roomNoRenderStat.pause(),this.handler.onPlayPause(t,!!this.videoSourceBuffer)}},{key:"_mseResume",value:function(t,e){this.pause500checked=!1,this.pauseStat.resume(),this.handler.eventEmitter&&this.handler.eventEmitter.roomRecordStat&&this.handler.eventEmitter.roomRecordStat.roomNoRenderStat.resume(),this.handler.onPlayResume(t,!!this.videoSourceBuffer)}},{key:"bufferedInfo",value:function(){var t,e,i,s,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,a=[],o=[],h=this.video.video.buffered;for(r=0;r<h.length;r++)a.push({start:h.start(r),end:h.end(r)});for(a.sort((function(t,e){return t.start-e.start||e.end-t.end})),r=0;r<a.length;r++){var u=o.length;if(u){var c=o[u-1].end;a[r].start-c<n?a[r].end>c&&(o[u-1].end=a[r].end):o.push(a[r])}else o.push(a[r])}var l=this.video.video.currentTime;for(r=0,t=0,e=i=l;r<o.length;r++){var d=o[r].start,p=o[r].end;if(l+n>=d&&l<p)e=d,t=(i=p)-l;else if(l+n<d){s=d;break}}return s||(s=i),{bufferLen:t,start:e,end:i,nextStart:s}}},{key:"printBuffer",value:function(t){if(this.video.video){var e=this.video.video.buffered,i="buffered=["+(1e3*e.start(0)|0)+","+(1e3*e.end(0)|0)+"]",s=1e3*this.video.video.currentTime>>0,r=this.getBufferLen();u.a.log("MSEPlayer(".concat(this._num_,").printBuffer ").concat(t," currentTime=").concat(s," bufLen=").concat(r," ").concat(i))}}},{key:"playbackRateSet",value:function(t){var e=this,i=this.getPlayVideo();if(i){var s=function(t){if(e.playRateIncrease%2==0){var s=t<1&&t+.02>1?1:t+.02;s>a.a.playbackrateMax&&(s=a.a.playbackrateMax),e.playRateDecrease=0,i.playbackRate=s}},r=function(t){if(e.playRateDecrease%2==0){var s=t>1&&t-.02<1?1:t-.02;s<a.a.playbackrateMin&&(s=a.a.playbackrateMin),e.playRateIncrease=0,i.playbackRate=s}},n=this.getBufferLen(),o=i.playbackRate;t<0?r(o):t>0?s(o):1!==o&&(o<1&&n<this.JITTER_BUFLEN?r(o):o>1&&n>this.JITTER_BUFLEN?s(o):i.playbackRate=1),this.playRateDecrease++,this.playRateIncrease++}}},{key:"setPlaybackRate",value:function(t){var e=this.getPlayVideo();e&&(e.playbackRate=t)}},{key:"onJitterTimer",value:function(t,e){if(this.playing&&("ts"!=this.videoType||this.isLive)&&this.autoJitter&&!this.autoBitrateJitter){var i=this.getPlayVideo();if(i){var s=this.getBufferLen();if(a.a.getEnableJumpBuffer()){var r=c.a.now();if(this.latencySeek>0&&s>4e3)return void(i.currentTime+=s-this.latencySeek);if(this.enableLowLatency&&s>Number(a.a.jitLowLatency))i.currentTime+=s-a.a.jitLowLatency;else{var n=s-this.JITTER_BUFLEN;if(r-this.startPlayTime<this.startCd)return;if(s>=(a.a.setVideoCTCfg[2]||1e4))return void this.setJumpBufferCurrentTime(n,s,0,r);if(this.isStartBuffer&&r-this.startPlayTime>this.startCd)n>=a.a.setVideoCTCfg[1]&&this.setJumpBufferCurrentTime(n,s,1,r),this.isStartBuffer=!1;else if(r-this.setVideoCurrentTime>=this.bufferCd||0==this.setVideoCurrentTime){if(r-this.startMoreBufferTime>=this.bufferMoreContinueTime&&0!=this.startMoreBufferTime)return this.setJumpBufferCurrentTime(n,s,2,r),void(this.startMoreBufferTime=0);n>=a.a.setVideoCTCfg[1]?0==this.startMoreBufferTime&&(this.startMoreBufferTime=r):this.startMoreBufferTime=0}}}else if(this.latencySeek>0&&s>4e3)i.currentTime+=s-this.latencySeek;else try{var o=0;if(s<this.JITTER_BUFMIN?o=s-this.JITTER_BUFLEN:s>this.JITTER_BUFMAX&&(o=s-this.JITTER_BUFMAX),this.enableLowLatency&&s>Number(a.a.jitLowLatency))i.playbackRate=1.1;else if(this.playbackrateChangeAccess){o=Number(localStorage.ab_adjust)||o,1!=i.playbackRate&&this.isPlaybackRateNormal&&u.a.log("MSEPlayer.onJitterTimer.playbackRate=",i.playbackRate),1!=i.playbackRate?this.isPlaybackRateNormal=!1:this.isPlaybackRateNormal=!0,this.playbackRateSet(o)}else i.playbackRate=1;-1===Number(localStorage._print_ab_log)&&u.a.log("BUFMIN: %d, BUFMAX: %d, BUFLEN:%d, bufLen: %d, adjust: %d, playbackRate: %f",this.JITTER_BUFMIN,this.JITTER_BUFMAX,this.JITTER_BUFLEN,s,o,i.playbackRate)}catch(t){u.a.error("MSEPlayer.onJitterTimer set playbackRateSet error",t)}}}}},{key:"setJumpBufferCurrentTime",value:function(t,e,i,s){this.h265Proxy&&this.h265Proxy.isReady?this.h265Proxy.jumpBuffer(t,e,i,s):this.setVideoCurrentTimeHand(t,e,i,s)}},{key:"setVideoCurrentTimeHand",value:function(t,e,i,s){var r=this.getPlayVideo();if(r){var n="";0===i?n="maxBuffer":1===i?n="fiveJump":2===i&&(n="ContinueJudgeJump"),u.a.log("MSEPlayer.onJitterTimer.jumpBuffer ".concat(n," video.currentTime before=").concat(r.currentTime," bufLen=").concat(e," minusBuffer=").concat(t," curDts=").concat(this.getCurrentDts())),r.currentTime+=t/1e3,this.setVideoCurrentTime=s,u.a.log("MSEPlayer.onJitterTimer.jumpBuffer ".concat(n," video.currentTime now=").concat(r.currentTime," curDts=").concat(this.getCurrentDts()," bufLen=").concat(this.getBufferLen()))}}},{key:"setJitter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;this.JITTER_BUFLEN=t,this.JITTER_BUFMIN=e,this.JITTER_BUFMAX=i,u.a.info("".concat(this._getTag()," MSEPlayer.setJitter bufMin=").concat(e," bufLen=").concat(t," bufMax=").concat(i))}},{key:"_getTag",value:function(){var t=this.handler.constructor.name;return this._num_+" "+t}},{key:"muffledVoice",value:function(){var t=this;if(this.handler&&this.handler.voiceEliminationData){var e=this.handler.voiceEliminationData,i=!1;if(e&&0!==e.length){var s=this.getCurrentDts(),r=0,n=0;[].slice.call(e).map((function(e,a){r=e.begin,n=e.end,0==e.type&&(r+=t.offsetDts,n+=t.offsetDts),s>=r&&s<=n?(i=!0,u.a.log("MSEPlayer.muffledVoice data",JSON.stringify(e))):s>n&&(u.a.log("MSEPlayer.muffledVoice stop muffle audio"),t.handler.voiceEliminationData.splice(a,1))})),i?this.video.setMuffledVolume(!0):this.video.setMuffledVolume(!1)}}}},{key:"isMediaSourceOpen",get:function(){return this.mediaSource&&"open"===this.mediaSource.readyState}}]),t}(),ce={isMacChrome72:function(){return"mac"===f.a.platform&&"chrome"===f.a.name&&72===Number(f.a.version.major)},isNeedAud:function(){return f.a.chrome&&f.a.version.major>=73},isBrowserSupport:function(){return f.a.firefox||f.a.opera||f.a.chrome&&53!=f.a.version.major||f.a.safari||f.a.edge||f.a.edg},isP2PCooling:function(){return 1===Number(a.a.needCooling)&&1===Number(localStorage.getItem("__p2p_cooling_play"))},isSupportP2P:function(){return this.isBrowserSupport()&&!this.isP2PCooling()},isWebrtcSupport:function(){try{var t=navigator.userAgent,e={Trident:t.indexOf("Trident")>0||t.indexOf("NET CLR")>0,Presto:t.indexOf("Presto")>0,WebKit:t.indexOf("AppleWebKit")>0,Gecko:t.indexOf("Gecko/")>0,UC:t.indexOf("UC")>0||t.indexOf(" UBrowser")>0,BaiDu:t.indexOf("Baidu")>0||t.indexOf("BIDUBrowser")>0,Maxthon:t.indexOf("Maxthon")>0,LBBROWSER:t.indexOf("LBBROWSER")>0,SouGou:t.indexOf("MetaSr")>0||t.indexOf("Sogou")>0,IE:t.indexOf("MSIE")>0||t.indexOf("Trident")>0,Firefox:t.indexOf("Firefox")>0,Opera:t.indexOf("Opera")>0||t.indexOf("OPR")>0,Safari:t.indexOf("Safari")>0,Chrome:t.indexOf("Chrome")>0||t.indexOf("CriOS")>0,Wechat:t.indexOf("MicroMessenger")>0,Windows:t.indexOf("Windows")>0,Linux:t.indexOf("Linux")>0,Mac:t.indexOf("Macintosh")>0,Android:t.indexOf("Android")>0||t.indexOf("Adr")>0,WP:t.indexOf("IEMobile")>0,BlackBerry:t.indexOf("BlackBerry")>0||t.indexOf("RIM")>0||t.indexOf("BB")>0,MeeGo:t.indexOf("MeeGo")>0,Symbian:t.indexOf("Symbian")>0,iOS:t.indexOf("like Mac OS X")>0,iPhone:t.indexOf("iPh")>0,iPad:t.indexOf("iPad")>0,Mobile:t.indexOf("Mobi")>0||t.indexOf("iPh")>0||t.indexOf("480")>0,Tablet:t.indexOf("Tablet")>0||t.indexOf("iPad")>0||t.indexOf("Nexus 7")>0};return e.Chrome&&(e.Chrome=!(e.Opera||e.BaiDu||e.Maxthon||e.SouGou||e.UC||e.LBBROWSER)),e.Chrome}catch(t){return!1}}},le=function(){function t(e){Object(s.a)(this,t),this.flvPlayer=e,this.eventEmitter=e.eventEmitter,this.jumpToP2PCd=1e3*(Math.floor(120*Math.random())+180),this.nextJumpToP2PTs=0,this.waitPlayEnd=!1,this.lastP2PInfo=null}return Object(r.a)(t,[{key:"reset",value:function(){this.waitPlayEnd=!1}},{key:"initJumpTs",value:function(t){0==this.nextJumpToP2PTs&&(this.nextJumpToP2PTs=t+this.jumpToP2PCd)}},{key:"onCheckTimer",value:function(t,e){if(!this.waitPlayEnd&&ce.isSupportP2P()&&!(t<this.nextJumpToP2PTs)){var i=this.flvPlayer;if(this.lastP2PInfo&&!a.a.isCloseP2P(this.lastP2PInfo.uid)&&this.lastP2PInfo.lineType==i.lineType){var s=this.lastP2PInfo.sStreamName;s&&i.url&&-1!=i.url.indexOf(s)&&(i.getBufferLen()<i.mse.JITTER_BUFLEN||(i.loader&&(u.a.warn("BackToP2P.tryPlayP2P"),i.loader.close()),this.waitPlayEnd=!0))}}}},{key:"onCheckFastTimer",value:function(t,e){var i=this.flvPlayer.getBufferLen();this.waitPlayEnd&&i<1e3&&(this.waitPlayEnd=!1,this.jumpToP2PCd<18e5&&(this.jumpToP2PCd+=12e4),this.nextJumpToP2PTs=t+this.jumpToP2PCd,this.flvPlayer.getRecSysRsp({info:this.flvPlayer.info,type:"flv",metadata:this.flvPlayer.mse.metadata,isBackToP2P:!0}))}},{key:"recSysRspHandler",value:function(t,e,i){t&&e&&e.tRecSysInfo&&0==e.tRecSysInfo.lAction||(u.a.warn("BackToP2P.onCheckFastTimer jumpToP2PCd=".concat(this.jumpToP2PCd/6e4,"min")),this.eventEmitter.trigger(n.a.FLV_TRY_TO_P2P),this.lastP2PInfo=null)}}]),t}(),de=function(){function t(e){Object(s.a)(this,t),this.flvPlayer=e,this.stat=e.stat,this.tsdb=e.tsdb,this.img=null,this.isPaused=!1,this.isFirstReport=!0}return Object(r.a)(t,[{key:"sendFlow",value:function(t,e,i,s,r,n){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.record(t,e,i,s,r,n,a)}},{key:"getUserProperty",value:function(){var t=this.tsdb;return a.a[100]?a.a[101]?ce.isBrowserSupport()?ce.isP2PCooling()?R.a.userProperty.P2P_COOLING:1==t.turnToFlvTimes&&0==t.restartTimes?t.turnToFlvReason==R.a.turnToFlvReason.FULL_CONNECT_TIMEOUT?R.a.userProperty.FIRST_FULL_CONNECT_TIMEOUT:t.turnToFlvReason==R.a.turnToFlvReason.FULL_NO_DATA?R.a.userProperty.FIRST_FULL_NO_DATA:t.turnToFlvReason==R.a.turnToFlvReason.FULL_PLAY_FAIL?R.a.userProperty.FIRST_FULL_PLAY_FAIL:t.turnToFlvReason==R.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?R.a.userProperty.SUB_CONNECT_TIMEOUT:t.turnToFlvReason==R.a.turnToFlvReason.SUB_NO_DATA?R.a.userProperty.SUB_NO_DATA:t.turnToFlvReason==R.a.turnToFlvReason.P2P_ARGS_ERROR?R.a.userProperty.P2P_ARGS_ERROR:t.turnToFlvReason==R.a.turnToFlvReason.P2P_COOLING?R.a.userProperty.P2P_COOLING:t.turnToFlvReason==R.a.turnToFlvReason.IS_NOT_FIRST_FETCH?R.a.userProperty.IS_NOT_FIRST_FETCH:t.turnToFlvReason==R.a.turnToFlvReason.VIDEO_BUFFER_EMPTY?R.a.userProperty.VIDEO_BUFFER_EMPTY:R.a.userProperty.UNKNOW:t.turnToFlvReason==R.a.turnToFlvReason.FULL_CONNECT_TIMEOUT||t.turnToFlvReason==R.a.turnToFlvReason.FULL_NO_DATA||t.turnToFlvReason==R.a.turnToFlvReason.FULL_PLAY_FAIL?t.restartReason==R.a.restartReason.RANGE_SEQ_MAX?R.a.userProperty.RESTART_RANGE_MAX:t.restartReason==R.a.restartReason.RANGE_SEQ_LARGE?R.a.userProperty.RESTART_RANGE_LARGE:t.restartReason==R.a.restartReason.CONNECT?R.a.userProperty.RESTART_CONNECT:t.restartReason==R.a.restartReason.MULTI_CDN?R.a.userProperty.RESTART_MUTI_CDN:t.restartReason==R.a.restartReason.PLAYER_NO_DATA?R.a.userProperty.RESTART_PLAYER_NO_DATA:t.restartReason==R.a.restartReason.PLAYER_ERROR?R.a.userProperty.RESTART_PLAYER_ERROR:t.restartReason==R.a.restartReason.FLV_TO_P2P?R.a.userProperty.FLV_TO_P2P:t.restartReason==R.a.restartReason.LOST_SEQ?R.a.userProperty.LOST_SEQ:R.a.userProperty.UNKNOW:t.turnToFlvReason==R.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?R.a.userProperty.SUB_CONNECT_TIMEOUT:t.turnToFlvReason==R.a.turnToFlvReason.SUB_NO_DATA?R.a.userProperty.SUB_NO_DATA:t.turnToFlvReason==R.a.turnToFlvReason.P2P_ARGS_ERROR?R.a.userProperty.P2P_ARGS_ERROR:t.turnToFlvReason==R.a.turnToFlvReason.P2P_COOLING?R.a.userProperty.P2P_COOLING:t.turnToFlvReason==R.a.turnToFlvReason.IS_NOT_FIRST_FETCH?R.a.userProperty.IS_NOT_FIRST_FETCH:t.turnToFlvReason==R.a.turnToFlvReason.VIDEO_BUFFER_EMPTY?R.a.userProperty.VIDEO_BUFFER_EMPTY:R.a.userProperty.UNKNOW:R.a.userProperty.BROWSER_UN_SUPPORT:R.a.userProperty.CLIENT_CLOSE:R.a.userProperty.SERVER_CLOSE}},{key:"record",value:function(t,e,i,s,r,n){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.volumeEnergy=n,i&&(this.isPaused=!0);var o=this.getUserProperty();this.stat.setCoreDim(l.a.DIM_CORE.USER_PROPERTY,o),this.stat.setCoreDim(l.a.DIM_CORE.SIGNAL_USER_PROPERTY,0),this.stat.setComDim(l.a.DIM_COM.VIDEO_MIN_BUF,this.flvPlayer.mse.JITTER_BUFLEN);var h=this.flvPlayer.mse.parser.timeStampStat,u=[];h.reset();var c=this.flvPlayer.info;this.stat.setCoreDim(l.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,i?100:0),this.stat.setCoreDim(l.a.DIM_CORE.VIDEO_BAD_QUALITY,i||t>0?100:0),this.stat.setCoreDim(l.a.DIM_CORE.VIDEO_BAD_REASON,r),this.stat.setCore(l.a.CORE.BUFFER_LENGTH,this.flvPlayer.getBufferLen()+this.flvPlayer.getFrameBufferLen()),this.stat.setCore(l.a.CORE.PLAY_DELAY,this.flvPlayer.getBufferLen()),this.stat.setCore(l.a.CORE.FRAME_BUFFER_DELAY,this.flvPlayer.getFrameBufferLen()),this.recordSample(),this.recordAuto(),this.flvPlayer.recSysStat.recordHeart(this.stat),this.flvPlayer.mse.buffered.record(this.stat),this.flvPlayer.mse.pauseStat.record(this.stat),this.flvPlayer.autoMonitor.recordHeartType();var d=this.flvPlayer.mse.metadata,f=d.recvVideoFps,_=d.recvAudioFps;this.stat.setComp(l.a.DIM_LINK_SAM.name,l.a.DIM_LINK_SAM.AUDIO_RATE,_),this.stat.setComp(l.a.DIM_LINK_SAM.name,l.a.DIM_LINK_SAM.VIDEO_RATE,f);var m=this.flvPlayer.mse.bufStat.getStats(),y=m.emptyTime,v=m.emptyCnt;if(this.stat.setComp(l.a.DIM_LINK_SAM.name,l.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_COUNT,v),this.stat.setComp(l.a.DIM_LINK_SAM.name,l.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_TIME,y),this.flvPlayer.h265Proxy.rendering){var S=this.flvPlayer.h265Proxy.getStats(),g=S.statProps,T=S.h265PauseCnt;for(var w in g)"toDecode"==w?this.recordH265Frame(g[w],l.a.DIM_COM.V_TO_DECODE_FRAMES):"decoded"==w?this.recordH265Frame(g[w],l.a.DIM_COM.V_DECODE_FRAME):"render"==w?this.recordH265Frame(g[w],l.a.DIM_COM.V_PLAY_FRAME):"rawList"==w?this.recordH265Frame(g[w],l.a.DIM_COM.V_RECV_FRAME):"frameList"==w?this.recordH265Frame(g[w],l.a.DIM_COM.V_TO_PLAY_FRAME):this.stat.setComp(l.a.DIM_H265_SAM.name,w,g[w].join("|"));this.stat.setCoreDim(l.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,T>0?100:0)}this.flvPlayer.eventEmitter&&this.flvPlayer.eventEmitter.costUs>0&&this.stat.setComp(l.a.DIM_H265_SAM.name,"costUs",this.flvPlayer.eventEmitter.costUs);var I=this.flvPlayer.loader.speed;this.stat.setComp(l.a.DIM_LINK_SAM.name,l.a.DIM_LINK_SAM.SPEED,I);var E=this.flvPlayer.mse.curVideoDts,P=this.flvPlayer.mse.curAudioDts;this.stat.setComp(l.a.DIM_LINK_SAM.name,l.a.DIM_LINK_SAM.VIDEO_DTS,E),this.stat.setComp(l.a.DIM_LINK_SAM.name,l.a.DIM_LINK_SAM.AUDIO_DTS,P),this.stat.setCompFormat(l.a.DIM_LINK_SAM.name,":",","),this.recordC2CDelay(),this.flvPlayer.mse.metadata&&this.flvPlayer.mse.metadata.codecname&&this.stat.setComDim(l.a.DIM_COM.SPHD_TYPE,this.flvPlayer.mse.metadata.codecname),this.isFirstReport?this.isFirstReport=!1:u.push({sMetricName:p.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0,pausecnt:t},vDimension:{p2p:0,originalBitrate:0===c.originalBitrate?1:0,p2pCooling:Q.a.p2pCooling?1:0,topSid:c.sid,reason:r,quality:i||t>0?100:0},vExLog:{cdnip:this.flvPlayer.cdnip}}),this.stat.setComDim(l.a.DIM_COM.CDNIP,this.flvPlayer.cdnip),this.recordAiData(),this.recordMuteData(),this.stat.fill(u,a),this.tsdb.sendMetrics(u),this.isPaused=!1}},{key:"recordSample",value:function(t){this.flvPlayer.sampleController.recordStat(this.stat,t),this.flvPlayer.mse.parser.avSample.recordStat(this.stat)}},{key:"recordAuto",value:function(){var t=this.flvPlayer.ctrlBitrate;t&&(this.stat.setCoreDim(l.a.DIM_CORE.AUTO_U_REASON,t._switchUpReason),this.stat.setCoreDim(l.a.DIM_CORE.AUTO_D_REASON,t._switchDownReason))}},{key:"recordH265Frame",value:function(t,e){var i=this;this.stat.setComp(e,"size",t.length),t.map((function(t,s){i.stat.setComp(e,"k"+(s+1),t),i.stat.setCompFormat(e,":",",")}))}},{key:"recordAiData",value:function(){var t=this.flvPlayer.getAiStat(),e=t.aiP2PCnt,i=t.aiFlvCnt,s=t.aiP2PTimeoutCnt,r=t.aiFlvTimeoutCnt,n=t.aiP2PErrorCnt,a=t.aiFlvErrorCnt,o=t.aiP2PSwitchCnt,h=t.aiFlvSwitchCnt,u=t.aiP2PNotSwitchCnt,c=t.aiFlvNotSwitchCnt,d=t.aiFlvErrorSwitchCnt,p=t.aiFlvErrorNotSwitchCnt,f=t.aiStartP2PCnt,_=t.aiStartFlvCnt;this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_P2P_CNT,e),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_FLV_CNT,i),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_P2P_TIMEOUT_CNT,s),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_FLV_TIMEOUT_CNT,r),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_P2P_ERROR_CNT,n),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_FLV_ERROR_CNT,a),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_P2P_SWITCH_CNT,o),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_FLV_SWITCH_CNT,h),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_P2P_NOT_SWITCH_CNT,u),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_FLV_NOT_SWITCH_CNT,c),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_FLV_ERROR_SWITCH_CNT,d),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_FLV_ERROR_NOT_SWITCH_CNT,p),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_START_P2P_CNT,f),this.stat.setComp(l.a.AI_CONTROL_DATA.name,l.a.AI_CONTROL_DATA.AI_START_FLV_CNT,_),this.stat.setCompFormat(l.a.AI_CONTROL_DATA.name,":",",")}},{key:"recordMuteData",value:function(){if(this.flvPlayer.eventEmitter&&this.flvPlayer.eventEmitter.getMuteStat&&this.flvPlayer.eventEmitter.getMuteStat){var t=this.flvPlayer.eventEmitter.getMuteStat().muteData,e=[];t.map((function(t){var i=[];i.push(t.value),i.push(t.type),i.push(t.currentDts),i.push(t.reqKey),i.push(t.begin),i.push(t.end),e.push(i.join(":"))})),this.stat.setCoreDim(l.a.DIM_COM.MUTE_DATA,e.join(","))}}},{key:"recordC2CDelay",value:function(){var t=this.flvPlayer.mse.getDelayStat();if(t){for(var e in t.fields)this.stat.setCore(e,t.fields[e]);for(var i in t.dims)this.stat.setCoreDim(i,t.dims[i])}}}]),t}(),pe=function(){function t(e,i){Object(s.a)(this,t),this.hyPlayer=e,this.mse=i,this.tickCnt=0}return Object(r.a)(t,[{key:"reset",value:function(){this.tickCnt=0}},{key:"onCheckTimer",value:function(t,e){this.tickCnt++,4!==this.tickCnt&&this.tickCnt%10!=0||this.trigger()}},{key:"trigger",value:function(){var t={};Object.assign(t,this.mse.metadata),this.hyPlayer.trigger(n.c.METADATA,t)}}]),t}();window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;var fe=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this)).audioContext=null,t.playing=!1,t.audio=null,t.analyser=null,t.source=null,t.timer=0,t}return Object(r.a)(i,[{key:"reset",value:function(){this.playing=!1}},{key:"createAudioContext",value:function(t){if(t)try{this.audio!=t&&(this.audio=t,this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(t),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination)),this.playing=!0,this.loop(2e3)}catch(t){u.a.log("createAudioContext err:"+t)}}},{key:"loop",value:function(t){if(this.playing&&this.analyser&&this.analyser.fftSize){this.audio&&!this.audio.error&&this.playing&&(clearTimeout(this.timer),this.timer=setTimeout(this.loop.bind(this),t,t));var e=this.analyser.fftSize,s=new Uint8Array(e);this.analyser.getByteFrequencyData(s),s.some((function(t){return t}))?this.emit(i.AUDIO_FREQUENCY,{value:1}):this.emit(i.AUDIO_FREQUENCY,{value:0})}}}]),i}(T.EventEmitter),_e=fe;function me(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],s=!0,r=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){r=!0,n=t}finally{try{s||null==o.return||o.return()}finally{if(r)throw n}}return i}}(t,e)||m(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function ve(t,e,i,s,r,n){return ye((a=ye(ye(e,t),ye(s,n)))<<(o=r)|a>>>32-o,i);var a,o}function Se(t,e,i,s,r,n,a){return ve(e&i|~e&s,t,e,r,n,a)}function ge(t,e,i,s,r,n,a){return ve(e&s|i&~s,t,e,r,n,a)}function Te(t,e,i,s,r,n,a){return ve(e^i^s,t,e,r,n,a)}function we(t,e,i,s,r,n,a){return ve(i^(e|~s),t,e,r,n,a)}function Ie(t,e){var i,s,r,n,a;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var o=1732584193,h=-271733879,u=-1732584194,c=271733878;for(i=0;i<t.length;i+=16)s=o,r=h,n=u,a=c,o=Se(o,h,u,c,t[i],7,-680876936),c=Se(c,o,h,u,t[i+1],12,-389564586),u=Se(u,c,o,h,t[i+2],17,606105819),h=Se(h,u,c,o,t[i+3],22,-1044525330),o=Se(o,h,u,c,t[i+4],7,-176418897),c=Se(c,o,h,u,t[i+5],12,1200080426),u=Se(u,c,o,h,t[i+6],17,-1473231341),h=Se(h,u,c,o,t[i+7],22,-45705983),o=Se(o,h,u,c,t[i+8],7,1770035416),c=Se(c,o,h,u,t[i+9],12,-1958414417),u=Se(u,c,o,h,t[i+10],17,-42063),h=Se(h,u,c,o,t[i+11],22,-1990404162),o=Se(o,h,u,c,t[i+12],7,1804603682),c=Se(c,o,h,u,t[i+13],12,-40341101),u=Se(u,c,o,h,t[i+14],17,-1502002290),o=ge(o,h=Se(h,u,c,o,t[i+15],22,1236535329),u,c,t[i+1],5,-165796510),c=ge(c,o,h,u,t[i+6],9,-1069501632),u=ge(u,c,o,h,t[i+11],14,643717713),h=ge(h,u,c,o,t[i],20,-373897302),o=ge(o,h,u,c,t[i+5],5,-701558691),c=ge(c,o,h,u,t[i+10],9,38016083),u=ge(u,c,o,h,t[i+15],14,-660478335),h=ge(h,u,c,o,t[i+4],20,-405537848),o=ge(o,h,u,c,t[i+9],5,568446438),c=ge(c,o,h,u,t[i+14],9,-1019803690),u=ge(u,c,o,h,t[i+3],14,-187363961),h=ge(h,u,c,o,t[i+8],20,1163531501),o=ge(o,h,u,c,t[i+13],5,-1444681467),c=ge(c,o,h,u,t[i+2],9,-51403784),u=ge(u,c,o,h,t[i+7],14,1735328473),o=Te(o,h=ge(h,u,c,o,t[i+12],20,-1926607734),u,c,t[i+5],4,-378558),c=Te(c,o,h,u,t[i+8],11,-2022574463),u=Te(u,c,o,h,t[i+11],16,1839030562),h=Te(h,u,c,o,t[i+14],23,-35309556),o=Te(o,h,u,c,t[i+1],4,-1530992060),c=Te(c,o,h,u,t[i+4],11,1272893353),u=Te(u,c,o,h,t[i+7],16,-155497632),h=Te(h,u,c,o,t[i+10],23,-1094730640),o=Te(o,h,u,c,t[i+13],4,681279174),c=Te(c,o,h,u,t[i],11,-358537222),u=Te(u,c,o,h,t[i+3],16,-722521979),h=Te(h,u,c,o,t[i+6],23,76029189),o=Te(o,h,u,c,t[i+9],4,-640364487),c=Te(c,o,h,u,t[i+12],11,-421815835),u=Te(u,c,o,h,t[i+15],16,530742520),o=we(o,h=Te(h,u,c,o,t[i+2],23,-995338651),u,c,t[i],6,-198630844),c=we(c,o,h,u,t[i+7],10,1126891415),u=we(u,c,o,h,t[i+14],15,-1416354905),h=we(h,u,c,o,t[i+5],21,-57434055),o=we(o,h,u,c,t[i+12],6,1700485571),c=we(c,o,h,u,t[i+3],10,-1894986606),u=we(u,c,o,h,t[i+10],15,-1051523),h=we(h,u,c,o,t[i+1],21,-2054922799),o=we(o,h,u,c,t[i+8],6,1873313359),c=we(c,o,h,u,t[i+15],10,-30611744),u=we(u,c,o,h,t[i+6],15,-1560198380),h=we(h,u,c,o,t[i+13],21,1309151649),o=we(o,h,u,c,t[i+4],6,-145523070),c=we(c,o,h,u,t[i+11],10,-1120210379),u=we(u,c,o,h,t[i+2],15,718787259),h=we(h,u,c,o,t[i+9],21,-343485551),o=ye(o,s),h=ye(h,r),u=ye(u,n),c=ye(c,a);return[o,h,u,c]}function Ee(t){var e,i="",s=32*t.length;for(e=0;e<s;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function Pe(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var s=8*t.length;for(e=0;e<s;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function be(t){var e,i,s="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),s+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return s}function Ce(t){return unescape(encodeURIComponent(t))}function Re(t){return function(t){return Ee(Ie(Pe(t),8*t.length))}(Ce(t))}function Ae(t,e){return function(t,e){var i,s,r=Pe(t),n=[],a=[];for(n[15]=a[15]=void 0,r.length>16&&(r=Ie(r,8*t.length)),i=0;i<16;i+=1)n[i]=909522486^r[i],a[i]=1549556828^r[i];return s=Ie(n.concat(Pe(e)),512+8*e.length),Ee(Ie(a.concat(s),640))}(Ce(t),Ce(e))}fe.AUDIO_FREQUENCY="AUDIO_FREQUENCY";var ke,De,Le,Oe=function(t,e,i){return e?i?Ae(e,t):be(Ae(e,t)):i?Re(t):be(Re(t))},Be=Object(v.a)("X2Zt"),Ne=Object(v.a)("Zm0="),Ue=Object(v.a)("X3dzVGltZQ=="),Fe=Object(v.a)("d3NUaW1l"),Me=Object(v.a)("X2ludmFsaWRUaW1l"),Ve=Object(v.a)("X25leHRSZWZyZXNoVGltZQ=="),xe=Object(v.a)("X2N0eXBl"),He=Object(v.a)("Y3R5cGU="),Ge=Object(v.a)("d3NTZWNyZXQ="),We=Object(v.a)("X3BhcmFtcw=="),je=Object(v.a)("X3NGbHZBbnRpY29kZQ=="),qe=Object(v.a)("X3NGbHZVcmw="),Ye=Object(v.a)("X3NTdHJlYW1OYW1l"),Je=Object(v.a)("X3JlcQ=="),Ke=Object(v.a)("c2VxaWQ="),ze=Object(v.a)("X3NlcWlk"),Qe=Object(v.a)("X3BjZG4="),Xe=Object(v.a)("JDA="),$e=Object(v.a)("JDE="),Ze=Object(v.a)("JDI="),ti=Object(v.a)("JDM="),ei=Object(v.a)("aW5pdA=="),ii=Object(v.a)("aXNJbnZhbGlk"),si=Object(v.a)("Z2V0QW50aWNvZGU="),ri=Object(v.a)("cGFyc2VBbnRpY29kZQ=="),ni=Object(v.a)("aGFzQW50aWNvZGU="),ai=Object(v.a)("b25DaGVja1RpbWVy"),oi=Object(v.a)("X29uUmVmcmVzaA=="),hi=Object(v.a)("X29uUmVmcmVzaEJpbmQ="),ui=Object(v.a)("dmFsaWQ="),ci=Object(v.a)("Z2V0VG9rZW4="),li=Object(v.a)("X2dldFRva2Vu"),di=Object(v.a)("bGl2ZXVp"),pi=Object(v.a)("Z2V0Q2RuVG9rZW5JbmZvRXg="),fi=(Object(v.a)("MTAw"),Object(v.a)("dmVyPTE=")),_i=Object(v.a)("Jg=="),mi=Object(v.a)("PQ=="),yi=Object(v.a)("UkVGUkVTSA=="),vi=Object(v.a)("cmVmcmVzaA=="),Si=(Object(v.a)("ZGVjb2RlVVJJ"),Object(v.a)("dW5lc2NhcGU="),Object(v.a)("Z2V0U2VxaWQ=")),gi=i(12).default,Ti=i(17).default,wi=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this))[Ue]="",t[Be]="",t[xe]="",t[We]=[],t[je]="",t[qe]="",t[Ye]="",t[ze]="",t[Me]=Number.MAX_SAFE_INTEGER,t[Ve]=Number.MAX_SAFE_INTEGER,t[hi]=t[oi].bind(Object(I.a)(t)),t}return Object(r.a)(i,[{key:ni,value:function(){return""!==this[je]}},{key:ei,value:function(t,e,i){this[qe]=t,this[Ye]=e,this[ri](i)}},{key:ri,value:function(t){var e=this;this[Be]="",this[Ue]="",this[xe]="",this[We]=[],this[je]=t,t.split(_i).forEach((function(t){var i=me(t.split(mi),2),s=i[0],r=i[1];if(s===Ne)r=decodeURI(r),r=unescape(r),r=atob(r),e[Be]=r;else if(s===Fe){e[Ue]=r;var n=1e3*parseInt(r,16)+3e5;e[Me]=c.a.now()+(n-Date.now()),e[Ve]=e[Me]-3e4}else s==He?e[xe]=r:s!==Ge&&e[We].push(t)}))}},{key:ii,value:function(t){return t>this[Me]}},{key:si,value:function(t){if(""===this[Be])return this[je];var e=a.a.platform,i=R.a.PLATFORM_TYPE[e]||R.a.PLATFORM_TYPE.web;this[ze]=Q.a.uid+Date.now();var s=Oe("".concat(this[ze],"|").concat(this[xe],"|").concat(i)),r=e===R.a.PLATFORM_TYPE_NAME.wap?Q.a.uid:Q.a.convertUid,n=this[Be].replace(Xe,r).replace($e,this[Ye]).replace(Ze,s).replace(ti,this[Ue]);t&&(n+=Qe);var o="".concat(Ge).concat(mi).concat(Oe(n)).concat(_i).concat(Fe).concat(mi).concat(this[Ue]).concat(_i).concat(Ke).concat(mi).concat(this[ze]).concat(_i).concat(He).concat(mi).concat(this[xe]).concat(_i).concat(fi);return this[We].length>0&&(o+=_i+this[We].join(_i)),o}},{key:Si,value:function(){return this[ze]}},{key:ai,value:function(t,e){t>=this[Ve]&&this[ci]().then(this[hi])}},{key:oi,value:function(){this.trigger(i.Events[yi])}},{key:ui,value:function(){var t=this;return new Promise((function(e){t[ii](c.a.now())?t[ci]().then(e):e()}))}},{key:ci,value:function(){var t=this;return new Promise((function(e){Ti.connected?t[li](e):Ti.on(Ti.TAFLINK_INITED,(function(){t[li](e)}))}))}},{key:li,value:function(t){var e=this;this[Je]||(this[Je]=new gi.GetCdnTokenExReq),this[Je].sFlvUrl=this._sFlvUrl,this[Je].sStreamName=this._sStreamName,this[Je].tId=Ti.getUserId(),this[Je].iAppId=Q.a.appid,this[Ve]=Number.MAX_SAFE_INTEGER,Ti.sendWup(di,pi,this._req,(function(s){u.a.log("".concat(i.name,".").concat(ci,"="),s.sFlvToken),e[ri](s.sFlvToken),t()}),!0,Ti.getRequestId())}}]),i}(W);wi.Events=(Le=vi,(De=yi)in(ke={})?Object.defineProperty(ke,De,{value:Le,enumerable:!0,configurable:!0,writable:!0}):ke[De]=Le,ke);var Ii=wi,Ei=function(){function t(e){Object(s.a)(this,t),this.player=e,this.recordMap=new Map,this.init(),this.reset()}return Object(r.a)(t,[{key:"init",value:function(){this.keys=Object.values(l.a.DIM_LINK_STA);var t=this.keys.indexOf(l.a.DIM_LINK_STA.name);-1!==t&&this.keys.splice(t,1)}},{key:"setStat",value:function(t,e){this.recordMap.has(t)||(this.recordMap.set(t,1),this.exceptionStat[t]=e)}},{key:"getStat",value:function(){var t=this;this.player.getDurationTime&&this.player.getDurationTime()>2&&this.setStat(l.a.DIM_LINK_STA.DATA_ENOUGH,1);var e=[];return Object.keys(this.exceptionStat).forEach((function(i){e.push("".concat(i,":").concat(t.exceptionStat[i]))})),e.join(",")}},{key:"reset",value:function(){var t=this;this.recordMap.clear(),this.exceptionStat={},this.keys.forEach((function(e){t.exceptionStat[e]=0}))}}]),t}(),Pi=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;Object(s.a)(this,t),this.linkHandler=e,this.ws=null,this.connected=!1,this.isYY=i,this.url=null,this.avgSpeed=new S(r)}return Object(r.a)(t,[{key:"destroy",value:function(){this.linkHandler=null,this.reset(),A.a.remove(this.onCheckTimer,this)}},{key:"connect",value:function(t){this.reset(),A.a.add(this.onCheckTimer,this,1e3),this.url=t,this.ws=new WebSocket(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onopen.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onmessage=this.onmessage.bind(this)}},{key:"reset",value:function(){this.ws&&(this.connected=!1,this.ws.onopen=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null),this.url=null,this.avgSpeed.reset()}},{key:"send",value:function(t){this.ws&&this.connected&&this.ws.send(t)}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(t){u.a.log("ProtoLink.onerror event="+t),this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onerror(t),this.linkHandler=null)}},{key:"onclose",value:function(){this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onmessage",value:function(t){this.avgSpeed.addCur(t.data.byteLength),t.data instanceof ArrayBuffer?this.processArrayBuffer(t.data):this.processText(t.data)}},{key:"processText",value:function(t){u.a.log("ProtoLink.processText data="+t)}},{key:"processArrayBuffer",value:function(t){if(this.isYY)for(var e=new DataView(t),i=0,s=0,r=0;i+10<t.byteLength;){if(i+(s=e.getUint32(i,!0))>t.byteLength||s<10)return void u.a.error("ProtoLink.processArrayBuffer length error pktLen="+s+" bufferLen="+t.byteLength);r=e.getUint32(i+4,!0);var n=new DataView(t,i,s);this.linkHandler&&this.linkHandler.onData(r,n),i+=s}else this.linkHandler&&this.linkHandler.onData(t)}},{key:"onCheckTimer",value:function(t,e){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),t}(),bi=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;Object(s.a)(this,t),this.linkHandler=e,this.connected=!1,this.url=null,this.xhr=null,this.avgSpeed=new S(i)}return Object(r.a)(t,null,[{key:"isSupported",value:function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===t.responseType}catch(t){return u.a.warn("MozChunkedLoader",t.message),!1}}}]),Object(r.a)(t,[{key:"destroy",value:function(){this.reset(),this.linkHandler=null,A.a.remove(this.onCheckTimer,this)}},{key:"reset",value:function(){this.abort(),this.url=null,this.xhr=null,this.connected=!1,this.avgSpeed.reset()}},{key:"abort",value:function(){this.xhr&&(u.a.log("ProtoLinkXhrFF abort"),this.xhr.abort())}},{key:"connect",value:function(t){this.reset(),this.url=t;var e=this.xhr=new XMLHttpRequest;e.responseType="moz-chunked-arraybuffer",e.open("GET",this.url,!0),e.onerror=this.onerror.bind(this),e.onprogress=this.onprogress.bind(this),e.onloadend=this.loadend.bind(this),e.onload=this.onclose.bind(this),e.send(),A.a.add(this.onCheckTimer,this,1e3)}},{key:"onprogress",value:function(t){this.connected||this.onopen();var e=t.target.response;this.linkHandler.onData(e),this.avgSpeed.addCur(e.byteLength)}},{key:"onreadystatechange",value:function(t){}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(t){u.a.log("ProtoLinkXhrFF.onerror "+t);var e=t.currentTarget.status;this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(t,e),this.linkHandler=null)}},{key:"loadend",value:function(t){404===t.currentTarget.status&&this.onerror(t)}},{key:"onclose",value:function(){u.a.log("ProtoLinkXhrFF.onclose"),this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onCheckTimer",value:function(t,e){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),t}(),Ci=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;Object(s.a)(this,t),this.linkHandler=e,this.connected=!1,this.url=null,this.requestAbort=!1,this.avgSpeed=new S(i)}return Object(r.a)(t,[{key:"destroy",value:function(){this.abort(),this.linkHandler=null,this.reset(),A.a.remove(this.onCheckTimer,this)}},{key:"reset",value:function(){this.url=null,this.connected=!1,this.avgSpeed.reset()}},{key:"pump",value:function(t){var e=this;t.read().then(function(i){if(i.done)e.onclose();else if(!e.checkAbort(t)){var s=i.value.buffer;e.avgSpeed.addCur(s.byteLength),e.linkHandler&&e.linkHandler.onData(s),e.pump(t)}}.bind(this))}},{key:"checkAbort",value:function(t){return!!this.requestAbort&&(this.requestAbort=!1,t.cancel(),!0)}},{key:"connect",value:function(t){var e=this;A.a.add(this.onCheckTimer,this,1e3),this.url=t,fetch(t).then((function(t){Number(localStorage._printFetchUrl)&&u.a.log("FetchUrl",t.url);var i=t.body.getReader();e.checkAbort(i)||(e.linkHandler&&e.linkHandler.onstatus&&e.linkHandler.onstatus(t.status),t.ok&&t.status>=200&&t.status<300?(e.onheader(t),e.onopen(),e.pump.call(e,i)):(u.a.log("ProtoLinkFetch http code invalid status:"+t.status),e.onerror(t.statusText,t.status)))})).catch((function(t){u.a.log("ProtoLinkFetch exception"),e.onerror(t.message)}))}},{key:"abort",value:function(){this.requestAbort=!0}},{key:"onheader",value:function(t){var e,i={},s=[],r=y(t.headers);try{for(r.s();!(e=r.n()).done;){var n=me(e.value,2),a=n[0],o=n[1];i[a]=o,s.push(a+":"+o)}}catch(t){r.e(t)}finally{r.f()}u.a.log("ProtoLinkFetch.onheader",s.join(" | ")),this.linkHandler.onheader&&this.linkHandler.onheader(i)}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(t,e){u.a.log("ProtoLinkFetch.onerror "+t),this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(t,e),this.linkHandler=null)}},{key:"onclose",value:function(){this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onCheckTimer",value:function(t,e){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),t}(),Ri=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,t),this.flvPlayer=e,e.hyPlayer&&(this.hyPlayer=e.hyPlayer,this.stat=e.hyPlayer.stat),this._newLink(),this.needRetry=i,this.status=0,this.url=null,this.started=!1,this.lastGetProxyTime=0,this.getProxyPeriod=t.DEFAULT_GET_PROXY_PERIOD,this.headers=null}return Object(r.a)(t,[{key:"_newLink",value:function(){f.a.firefox&&bi.isSupported()?this.link=new bi(this):ce.isMacChrome72()?this.link=new Pi(this):this.link=new Ci(this)}},{key:"abort",value:function(){this.link.destroy()}},{key:"reset",value:function(){this.lastGetProxyTime=0,this.status=0,this.url=null,this.started&&(u.a.log("FlvLoader.reset"),this.link.destroy(),this._newLink())}},{key:"connect",value:function(t){t?(this.link instanceof Pi&&(t=t.replace("http","ws")),this.reset(),this.lastGetProxyTime=c.a.now()-2e3,u.a.log("FlvLoader.connect url="+t,this.lastGetProxyTime),this.headers=null,this.url=t,this.link.connect(this.url),this.started=!0):u.a.warn("FlvLoader.connect url is null")}},{key:"close",value:function(){u.a.log("FlvLoader.close"),this.reset(),this.started=!1}},{key:"onstatus",value:function(t){this.status=t}},{key:"onheader",value:function(t){this.headers=t,u.a.log("FlvLoader.onheader",t),this.flvPlayer&&this.flvPlayer.onHeader&&this.flvPlayer.onHeader(t)}},{key:"onopen",value:function(){u.a.log("FlvLoader.onopen"),this.getProxyPeriod=t.DEFAULT_GET_PROXY_PERIOD,this.flvPlayer.onConnected()}},{key:"onclose",value:function(){localStorage.hasOwnProperty("_toPcdn")||(u.a.log("FlvLoader.onclose"),this.flvPlayer.onClosed(),this.lastGetProxyTime=0,this.needRetry&&this.getProxy())}},{key:"onerror",value:function(t,e){u.a.log("FlvLoader.onerror",e),this.lastGetProxyTime=0,this.needRetry&&this.getProxy(),this.flvPlayer.onLoadError&&this.flvPlayer.onLoadError(t)}},{key:"onData",value:function(t){this.flvPlayer.onData(t,1)}},{key:"onCheckTimer",value:function(t,e){if(this.started&&(this.onCheckConnect(t),e%10==0)){var i=this.link.speed;i!=v.b.UintMax&&(i=v.b.formatByteSize(i),u.a.log("FlvLoader speed ".concat(i,"/s")))}}},{key:"onCheckConnect",value:function(t){this.connected||(this.needRetry?this.getProxy():t-this.lastGetProxyTime>15e3&&0!=this.lastGetProxyTime&&this.flvPlayer&&this.flvPlayer.onLoadTimeout&&(this.flvPlayer.onLoadTimeout(),this.lastGetProxyTime=0))}},{key:"getProxy",value:function(){var t=c.a.now();t-this.lastGetProxyTime<this.getProxyPeriod||(u.a.log("FlvLoader.getProxy lastGetProxyTime="+this.lastGetProxyTime+" now="+t+" period="+this.getProxyPeriod),this.reset(),this.lastGetProxyTime=t,this.getProxyPeriod=Math.min(2*this.getProxyPeriod,128e3),this.flvPlayer.requestUrl())}},{key:"speed",get:function(){var t=this.link.speed;return t==v.b.UintMax&&(t=0),t}},{key:"connected",get:function(){return this.link&&this.link.connected}}]),t}();Ri.DEFAULT_GET_PROXY_PERIOD=4e3;var Ai=Ri,ki="loaded",Di="error",Li="timeout",Oi=new Map,Bi=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(t){var r;return Object(s.a)(this,i),(r=e.call(this))._libName=t,r._script=null,r._loaded=!1,r._onLoadBind=r._onLoad.bind(Object(I.a)(r)),r._onErrorBind=r._onError.bind(Object(I.a)(r)),r}return Object(r.a)(i,[{key:"load",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4;if(this._loaded)this.trigger(ki);else{var i=this._script;i||((i=document.createElement("script")).async=!0,i.onload=i.onreadystatechange=this._onLoadBind,i.onerror=this._onErrorBind,i.src=t.endsWith("/")?t+this._libName:t+"/"+this._libName,document.getElementsByTagName("head")[0].appendChild(i),this._script=i,A.a.once(this._onTimeout,this,e))}}},{key:"_onLoad",value:function(){var t=this._script,e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,this._loaded=!0,A.a.remove(this._onTimeout,this),this.trigger(ki))}},{key:"_onTimeout",value:function(){this._clear(),this.trigger(Li)}},{key:"_onError",value:function(){this._clear(),this.trigger(Di)}},{key:"_clear",value:function(){var t=this._script;t&&(t.onload=t.onreadystatechange=t.onerror=null,t.src="",t.parentNode&&t.parentNode.removeChild(t),this._script=null)}}]),i}(W),Ni={ppio:"ppio",xy:"xy"},Ui={ppio:"EcdnLive.js",xy:"XYLive.js"},Fi={},Mi=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this))._pcdnName="",t._loader=null,t._lastDataTs=0,t._started=!1,t._speed=new S(10),t._callbacks={onLoaded:t._onLoadLibSUc,onError:t._onLoadLibErr,thisObj:Object(I.a)(t)},t._binds={},t._binds.LOAD_FAIL=t._onLoadFail.bind(Object(I.a)(t)),t._binds.GATHER_SUC=t._onGatherSuc.bind(Object(I.a)(t)),t._binds.GATHER_FAIL=t._onGatherFail.bind(Object(I.a)(t)),t._binds.DATA=t._onData.bind(Object(I.a)(t)),t._binds.LOAD_STOP=t._onLoadStop.bind(Object(I.a)(t)),t._binds.LOAD_FINISH=t._onLoadFinish.bind(Object(I.a)(t)),t._binds.SDK_DESTROYED=t._sdkDestroy.bind(Object(I.a)(t)),t}return Object(r.a)(i,[{key:"setPcdnName",value:function(t){this._pcdnName=t}},{key:"isLibReady",value:function(){return Fi[this._pcdnName]}},{key:"loadLib",value:function(t){this.isLibReady()?this.trigger(i.BaseEvents.LIB_READY,{type:i.BaseEvents.LIB_READY,isFirst:!1}):function(t,e,i){var s=i.onLoaded,r=void 0===s?null:s,n=i.onError,a=void 0===n?null:n,o=i.onTimeout,h=void 0===o?null:o,u=i.thisObj,c=void 0===u?null:u,l=i.timeout,d=void 0===l?6e4:l,p=Oi.get(e);p||(p=new Bi(e),Oi.set(e,p)),r&&p.on(ki,r,c),a&&p.on(Di,a,c),h&&p.on(Li,h,c),p.load(t,d)}(t,Ui[this._pcdnName],this._callbacks)}},{key:"_onLoadLibSUc",value:function(){(function(t,e){var i=e.onLoaded,s=void 0===i?null:i,r=e.onError,n=void 0===r?null:r,a=e.onTimeout,o=void 0===a?null:a,h=e.thisObj,u=void 0===h?null:h,c=Oi.get(t);c&&(s&&c.off(ki,s,u),n&&c.off(Di,n,u),o&&c.off(Li,o,u))})(Ui[this._pcdnName],this._callbacks),this._hasInterface()?(Fi[this._pcdnName]=1,this.trigger(i.BaseEvents.LIB_READY,{type:i.BaseEvents.LIB_READY,isFirst:!0})):this.trigger(i.BaseEvents.LIB_ERR,{type:i.BaseEvents.LIB_ERR,msg:"".concat(this._pcdnName," has no constructor!")})}},{key:"_hasInterface",value:function(){return this._pcdnName===Ni.ppio?!!window.EcdnLive:this._pcdnName===Ni.xy&&!!window.xyvp&&!!window.xyvp.Loader}},{key:"_createLoader",value:function(){this._pcdnName===Ni.ppio?this._loader=new window.EcdnLive({appId:"huya",debug:!1,logLevel:""}):this._pcdnName===Ni.xy&&(this._loader=new window.xyvp.Loader),this._doPcdnEvents(!0)}},{key:"_destroyLoader",value:function(){this._loader&&(this._doPcdnEvents(!1),this._loader.stopLoad(),this._loader.stopPeerGather(),this._loader.destroy(),this._loader=null)}},{key:"_doPcdnEvents",value:function(t){if(this._loader)for(var e in this._binds)t?this._loader.on(e,this._binds[e]):this._loader.off(e,this._binds[e])}},{key:"_onLoadLibErr",value:function(){this.trigger(i.BaseEvents.LIB_ERR,{type:i.BaseEvents.LIB_ERR,msg:"".concat(this._pcdnName," load_fail")})}},{key:"_onLoadFail",value:function(){this.trigger(i.LoadEvents.LOAD_FAIL,{type:i.LoadEvents.LOAD_FAIL})}},{key:"_onData",value:function(t){0===this._lastDataTs&&(this.trigger(i.LoadEvents.LOAD_SUC,{type:i.LoadEvents.LOAD_SUC}),A.a.remove(this.onConnectTimeout,this));var e="xy"===this._pcdnName?t:t.data;this._lastDataTs=c.a.now(),this._speed.addCur(e.byteLength),this.trigger(i.LoadEvents.DATA,{type:i.LoadEvents.DATA,data:e})}},{key:"_onGatherSuc",value:function(){this.trigger(i.BaseEvents.GATHER_SUC,{type:i.BaseEvents.GATHER_SUC})}},{key:"_onGatherFail",value:function(){this.trigger(i.BaseEvents.GATHER_FAIL,{type:i.BaseEvents.GATHER_FAIL})}},{key:"_onLoadStop",value:function(){this.trigger(i.LoadEvents.LOAD_STOP,{type:i.LoadEvents.LOAD_STOP})}},{key:"_onLoadFinish",value:function(){this.trigger(i.LoadEvents.LOAD_FINISH,{type:i.LoadEvents.LOAD_FINISH})}},{key:"_sdkDestroy",value:function(){this.trigger(i.LoadEvents.SDK_DESTROYED,{type:i.LoadEvents.SDK_DESTROYED})}},{key:"getName",value:function(){return this._pcdnName}},{key:"create",value:function(){this._destroyLoader(),this._createLoader()}},{key:"startPeerGather",value:function(t){this._callPcdn("startPeerGather",[t])}},{key:"stopPeerGather",value:function(){this._callPcdn("stopPeerGather")}},{key:"refreshUrl",value:function(t){this._callPcdn("refreshUrl",[t])}},{key:"startLoad",value:function(t,e){u.a.log("PcdnLoader.startLoad url="+t,JSON.stringify(e)),this._started=!0,this._lastDataTs=0,A.a.once(this.onConnectTimeout,this,3e3),this._callPcdn("startLoad",[t,e])}},{key:"onConnectTimeout",value:function(){this.trigger(i.LoadEvents.CONNECT_TIMEOUT,{type:i.LoadEvents.CONNECT_TIMEOUT})}},{key:"stopLoad",value:function(t){this._started&&(this._lastDataTs=0,this._started=!1,this._speed.reset(),A.a.remove(this.onConnectTimeout,this),this._callPcdn("stopLoad",{reason:t}))}},{key:"destroy",value:function(){this.clear(),this._lastDataTs=0,this._started=!1,A.a.remove(this.onConnectTimeout,this),this._doPcdnEvents(!1),this._callPcdn("destroy")}},{key:"close",value:function(){this.clear(),this._doPcdnEvents(!1),this.stopLoad(),this.stopPeerGather(),this._callPcdn("destroy"),this._loader=null}},{key:"_callPcdn",value:function(t,e){this._loader&&this._loader[t]?(u.a.log("PcdnLoader.".concat(t," ").concat(this._pcdnName," ").concat(e?JSON.stringify(e):"")),this._loader[t].apply(this._loader,e)):u.a.log("PcdnLoader.".concat(t," ").concat(this._pcdnName," hasLoader=").concat(!!this._loader," hasInterface=").concat(!!this._loader&&!!this._loader[t]))}},{key:"onCheckTimer",value:function(t,e){this._speed.calculate()}},{key:"onCheckFastTimer",value:function(t,e){this._lastDataTs>0&&t-this._lastDataTs>500&&(this._lastDataTs=t,this.trigger(i.LoadEvents.DATA_TIMEOUT,{type:i.LoadEvents.DATA_TIMEOUT}))}},{key:"speed",get:function(){var t=this._speed.average();return t===v.b.UintMax&&(t=0),t}},{key:"connected",get:function(){return this._lastDataTs>0}}],[{key:"hasPcdn",value:function(t){return!!Ni[t]}}]),i}(W);Mi.BaseEvents={LIB_READY:"LIB_READY",LIB_ERR:"LIB_ERR",GATHER_SUC:"GATHER_SUC",GATHER_FAIL:"GATHER_FAIL"},Mi.LoadEvents={CONNECT_TIMEOUT:"CONNECT_TIMEOUT",LOAD_SUC:"LOAD_SUC",DATA:"DATA",DATA_TIMEOUT:"DATA_TIMEOUT",LOAD_FAIL:"LOAD_FAIL",LOAD_STOP:"LOAD_STOP",LOAD_FINISH:"LOAD_FINISH",SDK_DESTROYED:"SDK_DESTROYED"};var Vi=Mi,xi=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,t),this._flvPlayer=e,this._flvLoader=new Ai(e,i),this._pcdnLoader=new Vi,this._sPcdnName="",this._requesting=!1,this._loader=null,this._swapTs=0,this._gatherSuc=!1,this._failCnt=0,this.url="",this._checkSampleBind=this._checkSample.bind(this)}return Object(r.a)(t,[{key:"close",value:function(){u.a.log("LoaderCtrl.close"),this._flvPlayer.anticode.off(Ii.Events.REFRESH,this._onAnticodeRefresh,this),this._flvLoader.close(),this._pcdnLoader.close(),this._requesting=!1,this._loader=null,this._failCnt=0,this._gatherSuc=!1,this._swapTs=0,this._sPcdnName=""}},{key:"checkPcdnMode",value:function(){this._reqPcdn()}},{key:"connect",value:function(t){this.close(),this.url=t,this._connect(t),this._reqPcdn()}},{key:"_connect",value:function(t,e){t=this._getUrlParams(t,!1),u.a.log("LoaderCtrl._connect",t),this._flvPlayer.anticode.off(Ii.Events.REFRESH,this._onAnticodeRefresh,this),this._stopPcdn(e),this._flvLoader.connect(t),this._loader=this._flvLoader,this.url=this._flvLoader.url?this._flvLoader.url:t}},{key:"_stopPcdn",value:function(t){this._doPcdnEventHandler(Vi.LoadEvents,!1),this._pcdnLoader.stopLoad(t)}},{key:"_reqPcdn",value:function(){var t=this;if(1!=localStorage._closePcdn){if(this._flvPlayer.info.isAuto&&Number(a.a.closePcdn500)===this._flvPlayer.info.curBitrate)u.a.log("LoaderCtrl._reqPcdn closePcdn500");else if(localStorage._pcdnName&&(this._flvPlayer.info.usePcdn=1),1!==this._flvPlayer.info.usePcdn&&this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,1),1===this._flvPlayer.info.usePcdn&&!this._requesting&&""===this._sPcdnName){this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,2),this._requesting=!0;var e=new X.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq;e.lReqTs=Date.now(),e.lUid=Q.a.uid,e.sGuid=Q.a.sGuid,e.lAnchorUid=this._flvPlayer.info.presenterUid,e.iCdnLine=this._flvPlayer.info.lineType,e.iCliType=X.EM_CLINET_TYPE.E_CLIENT_WEB,e.lBucketPara=Number(localStorage.randomPcdnPercent)||0,e.iBusiType=X.EM_BUSI_TYPE.E_BusiType_Live,e.vCliSupportPcdns.value=["ppio","xy"],e.sStreamName=this._flvPlayer.info.sStreamName,u.a.log("LoaderCtrl.reqPcdn req",e),$.sendWup("hypcdngw","onClientGetPcdnFlvOutsideSdkFullstreamInfo",e,(function(e){u.a.log("HYPlayer.reqPcdn res",e),!e||0!=e.iErrCode&&7!=e.iErrCode||t._rspPcdn(e)}),!0,$.getRequestId())}}else u.a.log("LoaderCtrl._reqPcdn host close")}},{key:"_rspPcdn",value:function(t){this._requesting=!1,localStorage._pcdnName&&(t.sPcdnName=localStorage._pcdnName),this._sPcdnName!==t.sPcdnName&&(this._sPcdnName=t.sPcdnName,this._flvPlayer.stat.setComDim(l.a.DIM_COM.PCDN_ORIGIN,t.sPcdnName),this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,3),this._loadPcdn())}},{key:"onCheckTimer",value:function(t,e){this._loader&&this._loader.onCheckTimer(t,e),this._checkSwapToPcdn(t)}},{key:"_checkSwapToPcdn",value:function(t){return!!(t>this._swapTs&&this._gatherSuc&&this._loader!==this._pcdnLoader)&&(this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,10),this._swapToPcdn(),!0)}},{key:"onCheckFastTimer",value:function(t,e){this._loader&&this._loader.onCheckFastTimer&&this._loader.onCheckFastTimer(t,e)}},{key:"_loadPcdn",value:function(){Vi.hasPcdn(this._sPcdnName)?(this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,5),this._doPcdnEventHandler(Vi.BaseEvents,!0),this._pcdnLoader.setPcdnName(this._sPcdnName),this._pcdnLoader.loadLib(this._flvPlayer.info.h5Root)):this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,4)}},{key:"_doPcdnEventHandler",value:function(t,e){for(var i in t){var s=t[i];e?this._pcdnLoader.on(s,this._onPcdnEventHandler,this):this._pcdnLoader.off(s,this._onPcdnEventHandler,this)}}},{key:"_onPcdnEventHandler",value:function(t){switch(t.type!==Vi.LoadEvents.DATA&&u.a.log("LoaderCtrl._onPcdnEventHandler",t.type,t.msg),t.type){case Vi.BaseEvents.LIB_READY:t.isFirst&&this._reportPcdnLibAct([0],[this._pcdnLoader.getName()]),this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,7),this._pcdnLoader.create(),this._pcdnLoader.startPeerGather(this._getUrl(!0));break;case Vi.BaseEvents.LIB_ERR:this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,6),this._reportPcdnLibAct([100],[this._pcdnLoader.getName()]);break;case Vi.LoadEvents.CONNECT_TIMEOUT:this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,11),this._swapToCdn(t.type);break;case Vi.LoadEvents.DATA_TIMEOUT:this._flvPlayer.getBufferLen()<1500&&(this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,12),this._swapToCdn(t.type));break;case Vi.LoadEvents.LOAD_SUC:this._failCnt=0,this._flvLoader.close(),this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,15),this._beforeSwap();break;case Vi.LoadEvents.LOAD_FAIL:this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,14),this._swapToCdn(t.type);break;case Vi.BaseEvents.GATHER_SUC:this._gatherSuc=!0,u.a.log("LoaderCtrl gather_suc",this._loader!==this._pcdnLoader),this._checkSwapToPcdn(c.a.now())||this._loader===this._pcdnLoader||this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,9);break;case Vi.BaseEvents.GATHER_FAIL:this._gatherSuc=!1,this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,8);break;case Vi.LoadEvents.DATA:this._flvPlayer.onData(t.data,2);break;case Vi.LoadEvents.LOAD_STOP:this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,13),this._swapToCdn(t.type);break;case Vi.LoadEvents.LOAD_FINISH:this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,16),this._swapToCdn(t.type);break;case Vi.LoadEvents.SDK_DESTROYED:this._flvPlayer.stat.setComDim(l.a.DIM_COM.FLV_PCDN_STATE,17),this._swapToCdn(t.type)}}},{key:"_reportPcdnLibAct",value:function(t,e){this._flvPlayer.tsdb.sendMetrics([this._flvPlayer.stat.createAct(l.a.ACT.LOAD_PCDNLIB_ERROR,{value:t,str:e})])}},{key:"_onAnticodeRefresh",value:function(){this._flvPlayer.initInfo(this._flvPlayer.info,!0),this._pcdnLoader.refreshUrl(this._flvPlayer.info.url)}},{key:"_checkSample",value:function(t){var e=this._flvPlayer.mse.parser;return e.lastParseDts>0&&t.ts<=e.lastParseDts||(e.setDroppingSample(null),!1)}},{key:"_swapToPcdn",value:function(){this._flvPlayer.anticode.on(Ii.Events.REFRESH,this._onAnticodeRefresh,this),this._doPcdnEventHandler(Vi.LoadEvents,!0);var t=this._flvPlayer.mse,e=t.parser||{};u.a.log("LoaderCtrl.swapToPcdn vDts=".concat(t.curVideoDts," aDts=").concat(t.curAudioDts," lastParseDts=").concat(e.lastParseDts)),this._pcdnLoader.startLoad(this._getUrl(!0),{startDts:e.lastParseDts}),this._loader=this._pcdnLoader,this._flvPlayer.stat.addCore(l.a.CORE.GET_STREAM_CNT,1)}},{key:"_swapToCdn",value:function(t){var e=this._loader!==this._flvLoader;u.a.log("LoaderCtrl.swapToCdn reason=".concat(t," swap=").concat(e)),e&&(this._flvPlayer.tsdb.sendMetrics([this._flvPlayer.stat.createAct(l.a.ACT.PCDN_TO_CDN,{str:[t]})]),this._failCnt++,this._swapTs=c.a.now()+1e4*Math.min(6,this._failCnt),this._flvPlayer.stat.addCore(l.a.CORE.SWITCH_CDN_CNT,1),this._beforeSwap(),this._connect(this._getUrl(!1),t))}},{key:"_getUrl",value:function(t){return this._flvPlayer.initInfo(this._flvPlayer.info,t),this._getUrlParams(this._flvPlayer.info.url,t)}},{key:"_getUrlParams",value:function(t,e){var i="";e&&(i+="pulltype=pcdn&"),i+="&wsiphost=ipdbme&";var s=a.a.platform,r=R.a.PLATFORM_TYPE[s]||R.a.PLATFORM_TYPE.web,n=s===R.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(Q.a.uid,"&uuid=").concat(Q.a.uuid):"u=".concat(Q.a.convertUid);i+="".concat(n,"&t=").concat(r,"&sv=").concat(2202141204),-1===t.indexOf("?")?t+="?":t+="&";var o={url:t+=i};return e&&this._flvPlayer.isUseAV1()?o.url+="&codec=av1":e&&this._flvPlayer.h265Proxy.checkUrl(o),o.url}},{key:"_beforeSwap",value:function(){var t=this._flvPlayer.mse.parser;t.parseFlvHead=!1,t.flvCacher.reset(),t.printFirstVideoTs=!1,t.printFirstAudioTs=!1,t.pfvTs=!1,t.pfaTs=!1,t.setDroppingSample(this._checkSampleBind)}},{key:"connected",get:function(){return this._loader&&this._loader.connected}},{key:"speed",get:function(){return this._loader&&this._loader.speed}}]),t}(),Hi=function(){function t(e){Object(s.a)(this,t),this.samples=new S(e),this.maxSize=e,this.lastTs=0,this.isOver=!1,this.callback=null}return Object(r.a)(t,[{key:"getResult",value:function(){for(var t=this.samples.getSamples(),e=t.length,i=[],s=0;s<e;s++)i.push("".concat(s+1,":").concat(t[s]));return i.join(",")}},{key:"start",value:function(t){this.isOver=!1,this.callback=t,A.a.add(this.onCheckTime,this,20)}},{key:"stop",value:function(){this.callback=null,this.samples.reset(),this.lastTs=0,A.a.remove(this.onCheckTime,this)}},{key:"setOver",value:function(){if(!this.isOver){this.isOver=!0;var t=this.getResult();u.a.log("FastSample.over result=".concat(t)),this.callback&&this.callback(t),this.stop()}}},{key:"add",value:function(t){if(!this.isOver){this.samples.addCur(t);var e=c.a.now();0===this.lastTs?this.lastTs=e:this._checkSample(e)}}},{key:"onCheckTime",value:function(t){this._checkSample(t)}},{key:"_checkSample",value:function(t){this.lastTs>0&&t-this.lastTs>500&&(this.lastTs=t,this.samples.calculate(),this.samples.getSamples().length===this.maxSize&&this.setOver())}}]),t}(),Gi=function t(e){Object(s.a)(this,t),this.iHEVCBitRate=e.iHEVCBitRate,this.iCodecType=e.iCodecType,this.iBitRate=e.iBitRate,this.bitrate=e.bitrate},Wi=0,ji=function(){function t(e){Object(s.a)(this,t),this._id=Wi++,this._callbacks=e,this._timeout=!1,this._destroy=!1,this._timeoutTime=1e3,this._onRspBind=this._onRsp.bind(this)}return Object(r.a)(t,[{key:"destroy",value:function(){this._destroy=!0,this._callbacks=null,A.a.remove(this._onTimeout,this)}},{key:"sendP2PFlv",value:function(t){var e=t.info,i=this._getReq(t);i.mAppendInfo.value={streamType:t.type,expVideoFps:t.metadata&&t.metadata.fps||0,expAudioFps:t.metadata&&t.metadata.audioFps||0,codeRate:e.curBitrate,isOriginal:Number(0===e.originalBitrate),line:t.lineType,codeType:t.isH265?"265":"264",sStreamName:e.sStreamName,playType:t.playType,isServer:0,iIsP2PSupport:e.iIsP2PSupport},this._sendReq(i)}},{key:"sendAuto",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this._timeoutTime=e;var i=this._getReq(t);i.mAppendInfo.value=t.appendInfo,this._sendReq(i)}},{key:"_getReq",value:function(t){var e=new X.RecSysReq;return e.tId.iAppid=Q.a.appid,e.tId.lUid=Q.a.uid,e.tId.sGuid=Q.a.sGuid,e.tId.sUA="webh5",e.sAnchorUid=t.presenterUid,e.sRoomId=t.roomId,e.iScene=t.scene,e.bDebug=1,e}},{key:"_sendReq",value:function(t){var e=Object.assign({},t);u.a.log("RecSysProxy(".concat(this._id,").sendReq"),t,JSON.stringify(e)),$.sendWup("mediaui","getMediaRec",t,this._onRspBind,!0,$.getRequestId(),!0),A.a.once(this._onTimeout,this,this._timeoutTime)}},{key:"_onRsp",value:function(t){if(1!=localStorage._testTimeout){A.a.remove(this._onTimeout,this);var e=Object.assign({},t);u.a.log("RecSysProxy(".concat(this._id,").onRsp"),t,JSON.stringify(e)),this._destroy||this._callbacks&&this._callbacks.onRsp(t)}else u.a.log("RecSysProxy._onRsp _testTimeout=".concat(localStorage._testTimeout))}},{key:"_onTimeout",value:function(){this._callbacks&&this._callbacks.onTimeout&&this._callbacks.onTimeout()}}]),t}(),qi=function(){function t(e){Object(s.a)(this,t),this.ctrlBitrate=e,this.timeLineTs=0,this.sampleTs=0,this.sampleCheckTs=0,this.sampleDts=0,this.sampleCheckDts=0,this.printTs=0,this.printSampleTs=0,this.printSampleDts=0,this.startTs=0,this.startDts=0,this.cnt12=0}return Object(r.a)(t,[{key:"start",value:function(t,e){u.a.log("EvalBw.start now=".concat(t," dts=").concat(e)),this.startTs=this.timeLineTs=this.sampleTs=this.sampleCheckTs=this.printTs=this.printSampleTs=t,this.startDts=this.printSampleDts=this.sampleCheckDts=this.sampleDts=e,this.cnt12=0}},{key:"stop",value:function(){this.reset()}},{key:"reset",value:function(){u.a.log("EvalBw.reset"),this.startTs=this.timeLineTs=this.sampleTs=this.sampleCheckTs=this.printTs=this.printSampleTs=0,this.startDts=this.printSampleDts=this.sampleCheckDts=this.sampleDts=0,this.cnt12=0}},{key:"onCheckFastTimer",value:function(t,e){if(this.startTs>0){var i=t-this.timeLineTs;if(i>300){var s=this.sampleTs-this.sampleCheckTs,r=this.sampleDts-this.sampleCheckDts,n=r>0?s/r:2;u.a.log("EvalBw.onCheckFastTimer eval timeline=".concat(i," costtime=").concat(s," duration=").concat(r," costtime/duration=").concat(n," dts=").concat(this.sampleDts)),n>1.4&&!this._downBwCheck()?this._evalFail():n>1.2&&!this._downBwCheck()?(this.cnt12++,this.cnt12>=2&&this._evalFail()):this.cnt12=0,this.timeLineTs=t,this.sampleCheckTs=t,this.sampleCheckDts=this.sampleDts}}if(Number(localStorage._printEval)>0&&t-this.printTs>Number(localStorage._printEval)&&this.sampleDts>0){var a=t-this.printTs,o=this.sampleTs-this.printSampleTs,h=this.sampleDts-this.printSampleDts;u.a.log("EvalBw.onCheckFastTimer print timeline=".concat(a," duration=").concat(h," costtime=").concat(o," costtime/duration=").concat(o/h," dts=").concat(this.sampleDts)),this.printTs=t,this.printSampleTs=this.sampleTs,this.printSampleDts=this.sampleDts}}},{key:"_evalFail",value:function(){this.stop(),this.ctrlBitrate.evalFail()}},{key:"_downBwCheck",value:function(){var t=this.sampleTs-this.startTs,e=this.sampleDts-this.startDts;return u.a.log("EvalBw._downBwCheck costtime=".concat(t," duration=").concat(e," costtime/duration=").concat(t/e," dts=").concat(this.sampleDts)),e>0&&t/e<1.2}},{key:"addSample",value:function(t){var e=c.a.now();if(0===this.printSampleDts&&(this.printSampleDts=t.ts,this.printTs=this.printSampleTs=e),this.sampleTs=e,this.sampleDts=t.ts,this.startTs>0&&t.key){var i=this._downBwCheck();this.stop(),i?this.ctrlBitrate.evalSuc():this.ctrlBitrate.evalFail()}}}]),t}(),Yi=function(){function t(e){Object(s.a)(this,t),this.statSwitch=e,this.type=0,this.startTs=0,this.nextIFrameTs=0,this.connectedTs=0,this.firstVideoPkgTs=0,this.ptsIFrameTs=0,this.endTs=0}return Object(r.a)(t,[{key:"start",value:function(t,e){this.statSwitch.sendSwitchAuto([t,e||0]),this.type=t,this.reset(),this.startTs=c.a.now()}},{key:"nextIFrame",value:function(){this.startTs>0&&(this.nextIFrameTs=c.a.now())}},{key:"connected",value:function(){this.startTs>0&&(this.connectedTs=c.a.now())}},{key:"firstVideo",value:function(){this.startTs>0&&(this.firstVideoPkgTs=c.a.now())}},{key:"ptsIFrame",value:function(){this.startTs>0&&(this.ptsIFrameTs=c.a.now())}},{key:"end",value:function(t){if(this.startTs>0){this.endTs=c.a.now();var e=[this.endTs-this.startTs,this.nextIFrameTs>0?this.nextIFrameTs-this.startTs:-1,this.connectedTs>0&&this.nextIFrameTs>0?this.connectedTs-this.nextIFrameTs:-1,this.firstVideoPkgTs>0&&this.connectedTs>0?this.firstVideoPkgTs-this.connectedTs:-1,this.ptsIFrameTs>0&&this.firstVideoPkgTs>0?this.ptsIFrameTs-this.firstVideoPkgTs:-1,this.ptsIFrameTs>0?this.endTs-this.ptsIFrameTs:-1];u.a.log("AutoSeg.end",e.toString()),this.statSwitch.sendSwitchCost(e,[this.type,t])}this.reset()}},{key:"reset",value:function(){this.startTs=0,this.nextIFrameTs=0,this.connectedTs=0,this.firstVideoPkgTs=0,this.ptsIFrameTs=0,this.endTs=0}}]),t}(),Ji=function(){function t(){Object(s.a)(this,t),this._size=0,this._cnt=0,this._index=0,this._map=new Map,this._bufCnt=Number(a.a.autoCfg.bufCnt),this._sucPer=Number(a.a.autoCfg.sucPer),this._sucCnt=0,this._contiCnt=0}return Object(r.a)(t,[{key:"reset",value:function(){this._cnt=0,this._index=0,this._map.clear(),this._sucCnt=0,this._contiCnt=0}},{key:"setSwitchTime",value:function(t){this.reset(),this._size=t/Number(a.a.autoCfg.sampleTime)}},{key:"addSample",value:function(t){if(this._cnt++,t?(this._contiCnt++,this._sucCnt++,this._map.set(this._index,1)):(this._contiCnt=0,this._map.set(this._index,0)),this._cnt>this._size){this._cnt--;var e=this._index-this._size,i=this._map.get(e);this._map.delete(e),1===i&&this._sucCnt--}return this._index++,this.isFullSize()&&this.isLastReach()&&this.isPercentReach()}},{key:"isFullSize",value:function(){return this._cnt>=this._size}},{key:"isLastReach",value:function(){return this._contiCnt>=this._bufCnt}},{key:"isPercentReach",value:function(){return this._sucCnt/this._cnt>=this._sucPer}}]),t}(),Ki=function(){function t(){Object(s.a)(this,t),this._minTime=Number(a.a.autoCfg.minTime),this._maxTime=Number(a.a.autoCfg.maxTime),this._map=new Map}return Object(r.a)(t,[{key:"reset",value:function(){u.a.log("AutoUpGap.reset"),this._map.clear()}},{key:"getMin",value:function(){return this._minTime}},{key:"getGap",value:function(t){return this._map.has(t)||this._map.set(t,this._minTime),this._map.get(t)}},{key:"addFail",value:function(t,e){u.a.log("AutoUpGap.addFail bitrate=".concat(t," isMin=").concat(e));var i=this.getGap(t);if(!e){var s=Math.min(2*i,this._maxTime);this._map.set(t,s)}}}]),t}(),zi=new Set,Qi=new Map,Xi=function(){function t(){Object(s.a)(this,t),this._highRate=Number(a.a.autoCfg.highRate),this._badBuf=Number(a.a.autoCfg.badBuf),this._badCnt=Number(a.a.autoCfg.badCnt),this._sList=[],this._sTime=a.a.autoCfg.badS[0],this._sCnt=a.a.autoCfg.badS[1],this._lList=[],this._lTime=a.a.autoCfg.badL[0],this._lCnt=a.a.autoCfg.badL[1]}return Object(r.a)(t,[{key:"reset",value:function(){this._sList=[],this._lList=[]}},{key:"getBitrates",value:function(){return Array.from(zi).join(",")}},{key:"hasBitrate",value:function(t){return zi.has(t)}},{key:"addBadQuality",value:function(t,e,i,s){return this._addBadQuality(t,e,i,s,this._sList,this._sTime,this._sCnt)||this._addBadQuality(t,e,i,s,this._lList,this._lTime,this._lCnt)}},{key:"_addBadQuality",value:function(t,e,i,s,r,n,a){if(r.push({now:e,pauseTime:i,bufferLen:s}),r.length>a&&r.shift(),r.length>=a){var o=e-r[0].now;if(o<=n)return u.a.log("AutoBadQuality._addBadQuality disTime=".concat(o," time=").concat(n," cnt=").concat(a)),this._checkPerformance(t,r),!0}return!1}},{key:"_checkPerformance",value:function(t,e){var i=this;if(t>this._highRate)if(e.some((function(t){return t.bufferLen<i._badBuf}))){Qi.has(t)||Qi.set(t,0);var s=Qi.get(t)+1;Qi.set(t,s),s>=this._badCnt&&zi.add(t)}else zi.add(t)}}]),t}(),$i={UP_PTS:Math.pow(2,0),UP_WAIT_IFRAME:Math.pow(2,1),UP_CONNECT_FAIL:Math.pow(2,2),UP_CONNECT_SLOW:Math.pow(2,3),UP_FIRST_FRAME:Math.pow(2,4),UP_PTS_FRAME:Math.pow(2,5),BACK_CONNECT_FAIL:Math.pow(2,6),BACK_PTS:Math.pow(2,7),EVAL_BEFORE:Math.pow(2,8),EVAL_AFTER:Math.pow(2,9),BACK_CONNECT_SLOW:Math.pow(2,10),BACK_FIRST_FRAME:Math.pow(2,11),BACK_PTS_FRAME:Math.pow(2,12),DOWN_NO_IFRAME:Math.pow(2,13),DOWN_CONNECT_FAIL:Math.pow(2,14),DOWN_PTS:Math.pow(2,15),DOWN_CONNECT_SLOW:Math.pow(2,16),DOWN_FIRST_FRAME:Math.pow(2,17),DOWN_PTS_FRAME:Math.pow(2,18),UP_NO_IFRAME:Math.pow(2,19)},Zi=function(){function t(e,i){Object(s.a)(this,t),this._ctrlBitrate=e,this._autoMonitor=i,this._buffer=null,this._startTs=0,this._connectedTs=0,this._firstFrameTs=0}return Object(r.a)(t,[{key:"setStart",value:function(t){this._startTs=c.a.now(),this._connectedTs=0,this._firstFrameTs=0,t<a.a.autoBufferScore&&this._ctrlBitrate.isSwitchUp()&&this._autoMonitor.addBadReason($i.UP_WAIT_IFRAME)}},{key:"setConnected",value:function(){this._connectedTs=c.a.now(),this._connectedTs-this._startTs>a.a.autoConnectScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason($i.UP_CONNECT_SLOW):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason($i.DOWN_CONNECT_SLOW):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason($i.BACK_CONNECT_SLOW))}},{key:"setFirstFrame",value:function(){this._firstFrameTs=c.a.now(),this._checkFirstFrame()}},{key:"setFirstVideoTimeout",value:function(){this._connectedTs>0?this._checkFirstFrame():this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason($i.UP_CONNECT_FAIL):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason($i.DOWN_CONNECT_FAIL):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason($i.BACK_CONNECT_FAIL)}},{key:"_checkFirstFrame",value:function(){c.a.now()-this._connectedTs>a.a.autoFirstScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason($i.UP_FIRST_FRAME):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason($i.DOWN_FIRST_FRAME):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason($i.BACK_FIRST_FRAME))}},{key:"setPtsFrame",value:function(t){this._checkPtsFrame(),t>0&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason($i.UP_PTS):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason($i.DOWN_PTS):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason($i.BACK_PTS))}},{key:"setPtsFrameTimeout",value:function(){this._checkPtsFrame()}},{key:"_checkPtsFrame",value:function(){c.a.now()-this._firstFrameTs>a.a.autoPtsScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason($i.UP_PTS_FRAME):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason($i.DOWN_PTS_FRAME):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason($i.BACK_PTS_FRAME))}},{key:"setEvalBefore",value:function(t){t<a.a.autoBufferScore&&this._autoMonitor.addBadReason($i.EVAL_BEFORE)}},{key:"setEvalAfter",value:function(t){t<a.a.autoBufferScore&&this._autoMonitor.addBadReason($i.EVAL_AFTER)}},{key:"setNoIFrame",value:function(){this._buffer&&this._buffer.isWaitForIFrame()&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason($i.UP_NO_IFRAME):this._ctrlBitrate.isSwitchDown()&&this._autoMonitor.addBadReason($i.DOWN_NO_IFRAME))}},{key:"reset",value:function(){this._startTs=0,this._connectedTs=0,this._firstFrameTs=0}},{key:"buffer",set:function(t){this._buffer=t}}]),t}(),ts={NONE:0,H264ToH264:1,H264ToH265:2,H265ToH264:3,H265ToH265:4},es=function(){function t(e,i){var r=e.player,n=e.statSwitch,o=e.autoMonitor,h=e.recSysStat;Object(s.a)(this,t),this._player=r,this._statSwitch=n,this._autoMonitor=o,this._recSysStat=h,this._callbacks=i,this._seg=new Yi(n),this._badStat=new Zi(this,o),this._buffer=null,this._curBitrate=0,this._lastBitrate=0,this._startBitrate=0,this._sessionId=0,this._maxBitrate=0,this._originalMaxBitrate=0,this._minBitrate=0,this._bitrateList=[],this._allBitratebps="",this._switchSampleTime=Number(a.a.autoCfg.sampleTime),this._switchUpGap=Number(a.a.autoCfg.upGap),this._switchDownGap=Number(a.a.autoCfg.downGap),this._switchBackGap=Number(a.a.autoCfg.backGap),this._nextReqInterval=Number(a.a.recSysExpiredTime),this._firstRecSysTime=Number(a.a.autoCfg.sysTime),this._switchUpPer=Number(a.a.autoCfg.upPer),this._switchDownPer=Number(a.a.autoCfg.downPer),this._switchDownNowPer=Number(a.a.autoCfg.downNowPer),this._switchWaitPer=Number(a.a.autoCfg.waitPer),this._switchDownBitrate=Number(a.a.autoCfg.downBitrate),this._beforeSwitchCb=null,this._mse=null,this._evalBw=new qi(this),this._switchNextTime=0,this._switchSampleTs=0,this._upGap=new Ki,this._switchUpSample=new Ji,this._badRate=new Xi,this._switchUpReason=Gt,this._switchDownReason=$t,this._switchType=ts.NONE,this._switchOver=!1,this._evalOver=!1,this._started=!1,this._nextRecSysTs=0,this._switchState=0,this._recSysProxy=null,this._badQualityCoderatebps=[],this._recSysExpiredTime=0,this._visibilityState=R.a.VISIBILITY_STATE.VISIBLE,this._onRecSysBind=this._onRecSys.bind(this),this._onRecSysDownTimeoutBind=this._onRecSysDownTimeout.bind(this),this._onRecSysIntervalTimeoutBind=this._onRecSysIntervalTimeout.bind(this),this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this._switchUpSample.setSwitchTime(this._upGap.getMin()),this.closeAuto=2===Number(localStorage.openAuto),this.switchStartTime=0}return Object(r.a)(t,[{key:"isSwitchUp",value:function(){return 1===this._switchState}},{key:"isSwitchDown",value:function(){return 3===this._switchState}},{key:"isSwitchBack",value:function(){return 4===this._switchState}},{key:"start",value:function(t,e){var i=this;if(!this._started)if(t&&t.parser&&t.parser.ctrlBuffer){u.a.log("CtrlBitrate.start",JSON.stringify(e)),this._mse=t;var s=t.parser.ctrlBuffer;s.setEval(this._evalBw),s.callbacks=this._callbacks,this._buffer=s,this._badStat.buffer=s,this._sessionId=e.sessionId,this._curBitrate=e.curBitrate,this._maxBitrate=e.startBitrate,3===Number(a.a.isWebAutoAB)&&(this._maxBitrate=a.a.maxBitRate),this._originalMaxBitrate=this._maxBitrate,this._startBitrate=e.startBitrate,this._bitrateList=[],this._minBitrate=Number.MAX_SAFE_INTEGER;var r=[];e.bitrateList.forEach((function(t){i._bitrateList.push(new Gi(t)),r.push(1e3*t.bitrate),i._minBitrate=Math.min(i._minBitrate,t.bitrate)})),this._allBitratebps=r.join(","),this._bitrateList.sort((function(t,e){return t.bitrate>e.bitrate?-1:1})),this._start()}else u.a.warn("CtrlBitrate.start waring mse")}},{key:"_start",value:function(){u.a.log("CtrlBitrate._start started=".concat(this._started," bitrates=").concat(this._bitrateList.length," mse=").concat(!!this._mse)),this._mse&&this._bitrateList.length>0&&!this._started&&(this._started=!0,this._player.eventEmitter.on(n.c.VISIBILITY_CHANGE,this._onVisibilityChangeBind),this._switchNextTime=c.a.now()+5e3,A.a.add(this._onCheckFastTimer,this,100),A.a.once(this._firstReqAuto,this,1e3+10*Math.floor(Math.random()*this._firstRecSysTime/10)),this._onVisibilityChange())}},{key:"_onVisibilityChange",value:function(){u.a.log("CtrlBitrate._onVisibilityChange old=".concat(this._visibilityState," new=").concat(document.visibilityState)),this._visibilityState!==R.a.VISIBILITY_STATE.VISIBLE&&document.visibilityState===R.a.VISIBILITY_STATE.VISIBLE&&(this._switchSampleTs=0,this._switchUpSample.reset()),this._visibilityState=document.visibilityState}},{key:"_firstReqAuto",value:function(){u.a.log("CtrlBitrate._firstReqAuto"),this._reqAutoRecSys(1,this._onRecSysIntervalTimeoutBind)}},{key:"stop",value:function(){u.a.log("CtrlBitrate.stop"),this._mse=null,this._buffer=null,this._started=!1,this._switchState=0,this._switchType=ts.NONE,this._switchUpReason=Gt,this._switchDownReason=$t,this._badQualityCoderatebps=[],this._recSysExpiredTime=0,this._switchNextTime=0,this._switchTarget=null,this._curBitrate=0,this._lastBitrate=0,this._nextRecSysTs=0,this._bitrateList=[],this._evalBw.stop(),this._switchUpSample.reset(),this._upGap.reset(),this._badRate.reset(),this._destroyRecSys(),this._player.eventEmitter.off(n.c.VISIBILITY_CHANGE,this._onVisibilityChangeBind),A.a.remove(this._onCheckFastTimer,this),A.a.remove(this._firstReqAuto,this),this.switchStartTime=0}},{key:"pause",value:function(){this._buffer.pause()}},{key:"_sendSwitchStat",value:function(t){var e=this._buffer.switchTs.getMetric(),i=e.values,s=e.strs;this._buffer.switchTs.resetPtsSample(),i[3]=this._seg.type,s[2]=t,this._statSwitch.sendSwitchPts(i,s),this._seg.end(t)}},{key:"switchBitrate",value:function(t){this._curBitrate!==t&&(0!==this._curBitrate&&u.a.log("CtrlBitrate.switchBitrate from=".concat(this._curBitrate," to=").concat(t," buffer=").concat(this._mse.getBufferLen())),this._switchOver=!1,this._lastBitrate=this._curBitrate,this._curBitrate=t,this._buffer.switchBitrate(3===this._switchState,this._lastBitrate,this._curBitrate))}},{key:"switchBack",value:function(t){if(this.switchStartTime=0,0!==this._switchState&&this._lastBitrate<this._curBitrate){this._upGap.addFail(this._lastBitrate,this._curBitrate===this._minBitrate),this._evalBw.stop(),this._sendSwitchStat(t===Ht?1:2),this._seg.start(Mt,t),this._switchState=4,u.a.log("CtrlBitrate.switchBack from=".concat(this._curBitrate," lastBitrate=").concat(this._lastBitrate," reason=").concat(t," buffer=").concat(this._mse.getBufferLen()));for(var e=this._bitrateList.length,i=0;i<e;i++){var s=this._bitrateList[i];if(s.bitrate===this._lastBitrate){var r=this._getDownInfo(i+1,e);r&&r.bitrate>=this._switchDownBitrate&&(s=r),u.a.log("CtrlBitrate.switchBack to=".concat(s.bitrate)),this._beforeSwitchCb&&this._beforeSwitchCb(s),this._buffer.switchBack();break}}}}},{key:"startEval",value:function(t){if(1===this._switchState){var e=this._mse.getBufferLen();u.a.log("CtrlBitrate.switchDone start eval buffer=".concat(e)),this._badStat.setEvalBefore(e),this._switchState=6,this._switchUpReason=Qt,this._evalOver=!1,this._evalBw.start(c.a.now(),t)}}},{key:"evalSuc",value:function(){var t=this._mse.getBufferLen();u.a.log("CtrlBirate.evalSuc buffer=".concat(t)),this._badStat.setEvalAfter(t);var e=c.a.now();this._switchNextTime>e?this._switchNextTime+=this._switchUpGap:this._switchNextTime=e+this._switchUpGap,this._evalOver=!0,this._resetProperties(),this._sendSwitchStat(1),this._setPlaybackrate(!1),this._switchUpSample.setSwitchTime(this._upGap.getGap(this._curBitrate))}},{key:"evalFail",value:function(){var t=this._mse.getBufferLen();u.a.log("CtrlBirate.evalFail buffer=".concat(t)),this._badStat.setEvalAfter(t),this._switchUpReason=Xt,this._evalOver=!0,this.switchBack(Ht)}},{key:"_resetProperties",value:function(){this._evalOver&&this._switchOver&&(this._switchState=0,this._switchType=ts.NONE,this._switchUpReason=Gt,this._switchDownReason=$t)}},{key:"switchDone",value:function(t){this._switchOver=!0;var e=this._mse.getBufferLen();u.a.log("CtrlBitrate.switchDone buffer=".concat(e," switchType=").concat(this._switchType," switchNextGap=").concat(t));var i=c.a.now();if(this._switchNextTime=i+t,6===this._switchState&&(this.switchStartTime=i),3===this._switchState||4===this._switchState){this._evalBw.reset(),this._sendSwitchStat(1),3===this._switchState?(this._switchUpReason=Gt,this._switchDownReason=$t,this._switchNextTime+=this._switchDownGap,this._switchState=0,this._switchType=ts.NONE,this._setPlaybackrate(!1)):(this._switchState=5,this._switchNextTime+=this._switchBackGap);var s=this._upGap.getGap(this._curBitrate);u.a.log("CtrlBitrate.switchDone switchTime=".concat(s)),this._switchUpSample.setSwitchTime(s)}else this._resetProperties();this._buffer.play()}},{key:"_setPlaybackrate",value:function(t){var e=this._mse.getBufferLen(),i=Number(a.a.autoCfg.slow);i=e>3e3?.95:e>2e3?.9:.85,this._mse.setPlaybackRate(t?i:1),this._mse.autoBitrateJitter=t}},{key:"_switchUp",value:function(){if(this._curBitrate<this.maxBitrate){if(0===this._switchState){for(var t=null,e=this._bitrateList.length-1;e>=0;e--){var i=this._bitrateList[e];if(i.bitrate>this._curBitrate&&!this._badRate.hasBitrate(i.bitrate)&&i.bitrate<=this.maxBitrate&&!this._isBadBitrate(i.bitrate)){t=i;break}}t?(u.a.log("CtrlBitrate._switchUp suc"),this._setPlaybackrate(!0),this._seg.start(Ut),this._switchState=1,this._beforeSwitchCb&&this._beforeSwitchCb(t),this._autoMonitor.start(Ut,this.switchType)):this._bitrateList[0].bitrate>this.maxBitrate?this._switchUpReason=zt:this._switchUpReason=Kt}}else this._switchUpReason=Jt}},{key:"addBadQuality",value:function(t,e,i){t=t||c.a.now(),u.a.log("CtrlBitrate.addBadQuality started=".concat(this._started," switchState=").concat(this._switchState)),this._started&&0===this._switchState&&this._badRate.addBadQuality(this._curBitrate,t,e,i)&&(this._badRate.reset(),u.a.log("CtrlBitrate pause down!"),this._switchDownBefore())}},{key:"_switchDownBefore",value:function(){var t=this._bitrateList[this._bitrateList.length-1].bitrate;this._curBitrate>t&&(this._switchState=2,2===Number(a.a.isWebAutoAB)||3===Number(a.a.isWebAutoAB)?this._switchDown():this._reqAutoRecSys(2,this._onRecSysDownTimeoutBind))}},{key:"_switchDown",value:function(){var t=c.a.now();a.a.autoCfg&&0!=this.switchStartTime&&t-this.switchStartTime<a.a.autoCfg.noRederTime&&this._upGap.addFail(this._lastBitrate,this._curBitrate===this._minBitrate),this.switchStartTime=0;for(var e=this.badQualityCoderatebps,i=this._bitrateList.length,s=null,r=0;r<i;r++){var n=this._bitrateList[r];if(n.bitrate<this._curBitrate&&!this._isBadBitrate(n.bitrate)){if(n.bitrate===this._minBitrate||n.bitrate<=this._switchDownBitrate)s=n;else{var o=this._getDownInfo(r+1,i);s=!o||o.bitrate<this._switchDownBitrate?n:o}break}}if(s)u.a.log("CtrlBitrate._switchDown suc"),this._setPlaybackrate(!0),this._seg.start(Ft),this._switchState=3,this._beforeSwitchCb&&this._beforeSwitchCb(s),this._autoMonitor.start(Ft,this.switchType);else{u.a.log("CtrlBitrate._switchDown fail bad_host=".concat(this._badRate.getBitrates()," bad_svr=").concat(e.join(",")));var h=this._bitrateList[i-1];-1!==e.indexOf(1e3*h.bitrate)?this._switchDownReason=ee:this._badRate.hasBitrate(h.bitrate)&&(this._switchDownReason=ie)}}},{key:"_isBadBitrate",value:function(t){return-1!==this.badQualityCoderatebps.indexOf(1e3*t)||this._badRate.hasBitrate(t)}},{key:"_getDownInfo",value:function(t,e){return null}},{key:"_onRecSysDownTimeout",value:function(){u.a.log("CtrlBitrate._onRecSysTimeout"),this._nextRecSysTs=c.a.now()+this.nextReqInterval,this._destroyRecSys(),this._switchDown()}},{key:"_onCheckFastTimer",value:function(t,e){if(this._evalBw.onCheckFastTimer(t,e),5===this._switchState)this._fillBuf();else if(this._visibilityState===R.a.VISIBILITY_STATE.VISIBLE&&0===this._switchState&&t>this._switchNextTime&&!this._buffer.isPaused()&&!this.closeAuto){if(0===this._switchSampleTs)this._switchSampleTs=t;else if(t-this._switchSampleTs>=this._switchSampleTime){this._switchSampleTs=t;var i=this._mse.getBufferLen(),s=this._player.getWaitBufferLen(),r=this._player.getWaitFrameTime(t);this._needSwitchDown(t,i,s,r)?(u.a.log("CtrlBitrate buffer down! buffer=".concat(i," waitBuffer=").concat(s," waitFrameTime=").concat(r)),this._switchDownBefore()):(this._switchDownReason=te,this._switchUpSample.addSample(i>=this._mse.JITTER_BUFLEN*this._switchUpPer)?this._switchUp():this._switchUpSample.isFullSize()?this._switchUpSample.isLastReach()?this._switchUpSample.isPercentReach()||(this._switchUpReason=Yt):this._switchUpReason=qt:this._switchUpReason=jt)}}else t<this._switchNextTime&&(this._switchUpReason=Wt,this._switchDownReason=Zt);this._nextRecSysTs>0&&t>=this._nextRecSysTs&&this._reqAutoRecSys(0,this._onRecSysIntervalTimeoutBind)}},{key:"_needSwitchDown",value:function(t,e,i,s){return e+i<this._mse.JITTER_BUFLEN*this._switchDownPer}},{key:"_fillBuf",value:function(){var t=this._mse.getBufferLen();t>=this._mse.JITTER_BUFLEN*this._switchUpPer&&(u.a.log("CtrlBitrate.fillBuf suc bufferLen=".concat(t)),this._switchState=0,this._switchType=ts.NONE,this._setPlaybackrate(!1))}},{key:"_reqAutoRecSys",value:function(t,e){if(2!==Number(a.a.isWebAutoAB)&&3!==Number(a.a.isWebAutoAB)){this._nextRecSysTs=Number.MAX_SAFE_INTEGER,this._destroyRecSys();var i=this._player.info,s=new ji({onRsp:this._onRecSysBind,onTimeout:e});s.sendAuto({presenterUid:i.presenterUid,roomId:i.roomId,scene:1,appendInfo:{platform:"webh5&".concat(2202141204),p2p:this._player.playerType,h265:this._player.h265Proxy&&this._player.h265Proxy.isReady?1:0,line:i.lineType,coderatebps:1e3*i.curBitrate,gameid:i.gameId,all_coderatebps:this._allBitratebps,req_type:t,start_coderatebps:1e3*this._startBitrate,session_id:this._sessionId}},1e3),this._recSysProxy=s}}},{key:"_onRecSysIntervalTimeout",value:function(){this._nextRecSysTs=c.a.now()+this.nextReqInterval,this._destroyRecSys()}},{key:"_onRecSys",value:function(t){var e=!1,i=c.a.now();if(t){if(this._recSysStat.addItem(1,t.tRecSysInfo.sDispatchId,i+a.a.recSysExpiredTime),Number(localStorage._testAction)>0&&(u.a.log("CtrlBitrate._onRecSys _testAction=".concat(localStorage._testAction)),t.tRecSysInfo.lAction=Number(localStorage._testAction)),0===t.tRecSysInfo.lAction)e=!0;else if(t.tRecSysInfo.lAction>=100&&t.tRecSysInfo.lAction<200){if(""!==t.tRecSysInfo.sActValue){var s=JSON.parse(v.b.unescapeHTML(t.tRecSysInfo.sActValue));u.a.log("CtrlBitrate._onRecSys",JSON.stringify(s)),this._maxBitrate=Number(s.auto_max_coderatebps)/1e3||this._maxBitrate,this._nextReqInterval=1e3*Number(s.next_req_interval)||this._nextReqInterval,this._badQualityCoderatebps=s.bad_quality_coderatebps||[],this._recSysExpiredTime=c.a.now();var r=Number(s.force_auto_count),o=Number(s.force_auto_effective_time);r>0&&o>0&&this._player.trigger(n.c.AUTO_FORCE_RSP,{force_auto_count:r,force_auto_effective_time:o})}e=!0}}else e=!0;Number(localStorage._testBadQuality)>0&&(u.a.log("CtrlBitrate._onRecSys _testBadQuality=".concat(localStorage._testBadQuality)),this._badQualityCoderatebps=[1e3*Number(localStorage._testBadQuality)]),Number(localStorage._testMaxBitrate)>0&&(u.a.log("CtrlBitrate._onRecSys _testMaxBitrate=".concat(localStorage._testMaxBitrate)),this._maxBitrate=Number(localStorage._testMaxBitrate)),2===this._switchState&&(this._switchState=0,e?this._switchDown():this._switchNextTime=this._nextRecSysTs),this._nextRecSysTs=i+this.nextReqInterval-1e4}},{key:"_destroyRecSys",value:function(){this._recSysProxy&&this._recSysProxy.destroy(),this._recSysProxy=null}},{key:"_recSysExpired",value:function(){var t=c.a.now()-this._recSysExpiredTime;return 0!=this._recSysExpiredTime&&t>a.a.recSysExpiredTime}},{key:"switchType",get:function(){return this._switchType},set:function(t){this._switchType=t}},{key:"beforeSwitchCb",set:function(t){this._beforeSwitchCb=t}},{key:"lastBitrate",get:function(){return this._lastBitrate}},{key:"curBitrate",get:function(){return this._curBitrate}},{key:"maxBitrate",get:function(){return this._recSysExpired()&&(this._maxBitrate=this._originalMaxBitrate),this._maxBitrate}},{key:"nextReqInterval",get:function(){return this._recSysExpired()&&(this._nextReqInterval=Number(a.a.recSysExpiredTime)),this._nextReqInterval}},{key:"badQualityCoderatebps",get:function(){return this._recSysExpired()&&(this._badQualityCoderatebps=[]),this._badQualityCoderatebps}}]),t}();es.SwitchType=ts;var is=es,ss=function(){function t(){Object(s.a)(this,t),this.mse=null,this.dtsGap=0,this.lastBufferLen=0,this.pauseCnt=0,this.callbacks=null}return Object(r.a)(t,[{key:"stop",value:function(){this.mse=null,this.dtsGap=0,this.callbacks=null,A.a.remove(this._onTimer,this)}},{key:"start",value:function(t,e,i){u.a.log("SwitchDoneBefore.start bufferLen=".concat(t.getBufferLen()," dtsGap=").concat(e)),this.mse=t,this.dtsGap=e,this.lastBufferLen=0,this.pauseCnt=0,this.callbacks=i,A.a.add(this._onTimer,this,100),this._onTimer(0)}},{key:"_onTimer",value:function(t){if(this.mse){var e=200;Number(localStorage._localBuffer)>0&&(e=Number(localStorage._localBuffer));var i=this.mse.getBufferLen();i<=e||this.dtsGap+i<=0||this.pauseCnt>2?(u.a.log("SwitchDoneBefore.done bufferLen=".concat(i," dtsGap=").concat(this.dtsGap," pauseCnt=").concat(this.pauseCnt)),A.a.remove(this._onTimer,this),this.callbacks&&this.callbacks.done()):i===this.lastBufferLen&&this.pauseCnt++,this.lastBufferLen=i}else this.stop()}}]),t}(),rs="heart",ns=0,as=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(t,r){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(s.a)(this,i),a=e.call(this,t,r),u.a.log("FlvPlayer(".concat(a._id,").constructor"));var h=r.isPureAudio,c=r.isPureVideo;return a.startTs=0,a.startTime=0,a.lineType=0,a.loader=new xi(Object(I.a)(a),!0),a.recvTime=0,a.firstPkgTime=0,a.connectTime=0,a.loadFlvStatus=0,a.isPureAudio=h,a.isPureVideo=c,a.videoElement=o,a.flvLoadTimeSended=!1,a.enableLowLatency=!1,a.anticode=new Ii,a.mse=a.createMse(),a.pauseStartTs=0,a.metadataTick=new pe(t,a.mse),a.pauseReason=0,a.loadTime=0,a.connectTime=0,a.recvDataTime=0,a.loadStartTs=0,a.cdnip="",a.sendPauseTimeout=0,a.videoStatus=n.b.VIDEO_STOP,void 0!==de&&(a.qaStat=new de(Object(I.a)(a))),a.playedStat=null,a.flowSize=0,a.flvDataSize=0,a.backToP2P=new le(Object(I.a)(a)),a.volumeCount=0,a.sendMetricTimer=0,a.sendMetricTimes=0,a.businessStartCost=0,a.startTimeStamp=0,a.noNeedSendVideoLoadTime=!1,a.exceptionStat=new Ei(Object(I.a)(a)),a.startUrlBind=a.startUrl.bind(Object(I.a)(a)),a.playerType=0,a}return Object(r.a)(i,[{key:"createMse",value:function(){var t=new ue(this,{videoType:"flv",isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,videoElement:this.videoElement});return t.setPushGop(a.a.pushGop),t}},{key:"getFrameData",value:function(){return{pts:this.mse.getCurrentRealTime()}}},{key:"reset",value:function(){this.started&&(u.a.log("FlvPlayer(".concat(this._id,").reset")),A.a.remove(this.onCheckTimer,this),A.a.remove(this.onCheckFastTimer,this),this.exceptionStat.reset(),this.loader.close(),this.mse&&(this.mse.destroy(),this.mse=null),this.mse=this.createMse(),this.pauseStartTs=0,this.qaStat.isFirstReport=!0,this.metadataTick.reset(),this.metadataTick.mse=this.mse,this.startTs=0,this.recvTime=0,this.startTime=0,this.enableLowLatency=!1,this.pauseCheckLock=!1,this.loadTime=0,this.connectTime=0,this.recvDataTime=0,this.flowSize=0,this.flvDataSize=0,this.recvDataEnough=!1,this.recvFlvData=!1,this.cdnip="",this.appStartPlayTime=0,this.backToP2P.reset(),this.stat.reset(),this.stopMetricTimer(),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.videoStatus=n.b.VIDEO_STOP)}},{key:"getCostTimes",value:function(){return[this.connectTime>0?this.connectTime-this.startTs:0,this.recvDataTime>0?this.recvDataTime-this.connectTime:0,this.mse.pushVideoStartRenderTime>0?this.mse.pushVideoStartRenderTime-this.startTs:0]}},{key:"getRecvInfo",value:function(){return[this.connectTime>0?this.connectTime-this.startTs:0,this.recvDataTime>0?this.recvDataTime-this.connectTime:0,this.mse.pushVideoStartRenderTime>0?this.mse.pushVideoStartRenderTime-this.startTs:0,this.mse.getVideoFrames(),this.mse.getAudioFrames(),this.flowSize]}},{key:"checkPcdnMode",value:function(t){P(Object(E.a)(i.prototype),"checkPcdnMode",this).call(this,t),this.loader.checkPcdnMode()}},{key:"_getUsePcdn",value:function(t){return 1===Number(t[X.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream])?1:0}},{key:"_getPcdnName",value:function(t){var e="";return t&&(e=t[X.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream]),e}},{key:"start",value:function(t){this.firstPkgTime=0,P(Object(E.a)(i.prototype),"start",this).call(this),this.reset(),this.checkParams(t,this.startUrlBind)}},{key:"checkParams",value:function(t,e){u.a.log("FlvPlayer(".concat(this._id,").checkParams"),JSON.stringify(t)),this.started=!0,this.info=t,t.sFlvUrl&&t.sStreamName?(t.sFlvUrl=t.sFlvUrl.replace("http://","https://"),this.initDomain(t),t.sFlvAntiCode?(this.anticode.init(t.sFlvUrl,t.sStreamName,t.sFlvAntiCode),this.anticode.valid().then((function(){e(t)}))):e(t)):t.url?e(t):u.a.error("FlvPlayer(".concat(this._id,").start has no params(sFlvUrl,sStreamName,url)"))}},{key:"startUrl",value:function(t){if(this.started){this.initInfo(t),this.appStartPlayTime=t.appStartPlayTime?t.appStartPlayTime:0;var e=c.a.now();if(this.businessStartCost=0,this.UIStartCost=0,this.loadStartTs=0,this.startTimeStamp=Number(t.startTimeStamp)||0,t.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=Math.floor(t.startTimeStamp>1?(new Date).getTime()-t.startTimeStamp:0),this.noNeedSendVideoLoadTime=!1),t.uistartTs&&t.uistartTs>0&&(this.UIStartCost=Math.floor((new Date).getTime()-t.uistartTs)),this.startTs=e,u.a.log("FlvPlayer(".concat(this._id,").startNow"),Date.now(),e),this.startTime=e,this.backToP2P.initJumpTs(e),this.loadFlvStatus=0,this.mse.setPushGop(a.a.pushGop),ce.isNeedAud()?this.mse.setDeleteH264Aud(-1===a.a.deleteH264Aud.indexOf(t.presenterUid)?0:1):this.mse.setDeleteH264Aud(0),t.latencyLevel){var i=a.a.latency[t.latencyLevel];i||(i=[3e3,2e3,4e3,2e3]),this.mse.latencySeek=i[3],this.mse.setJitter(i[0],i[1],i[2])}else this.enableLowLatency?a.a.setLowLatency(this.mse):a.a.setJitterCfg(this.mse,t.presenterUid,t.curBitrate);var s=this.h265Proxy.isReady,r=this.isUseAV1(t);this.stat.setComDim(l.a.DIM_COM.ORIGINAL_BITRATE,0===t.originalBitrate?1:0),this.stat.setComDim(l.a.DIM_COM.P2P,l.a.LIVE_TYPE.FLV),this.stat.setComDim(l.a.DIM_COM.STREAM_TYPE,1),this.stat.setComDim(l.a.DIM_COM.H265,s?1:0),this.stat.setComDim(l.a.DIM_COM.V_DECODEC,r?2:s?1:0),r?(t.url+="&codec=av1",-1==t.url.indexOf("ratio")&&(t.url+="&ratio=0")):s&&(this.h265Proxy.checkUrl(t),this.eventEmitter.tsdbUtil.sendMetrics([this.stat.createAct(l.a.ACT.H265_STATUS,{value:[0],str:[0]})])),this.statSwitch.check(t,!1),delete t.pullStreamFrom,this.startFastSample(),this._startContinueBuffer(),this.loader.connect(t.url,null==this.videoElement),this.stat.setComDim(l.a.DIM_COM.STREAM_URL,this.loader.url),function(t,e,i){i=i||"";var s="cdndomain",r=(e=e||"").match(/\/\/(.+?)\//i);r&&r.length>1&&(s=r[1]),t.setComDim(l.a.DIM_COM.CDNDOMAIN,s),t.setComDim(l.a.DIM_COM.STREAM,i||"stream")}(this.stat,this.info.url,this.info.sStreamName),A.a.add(this.onCheckTimer,this,1e3),A.a.add(this.onCheckFastTimer,this,100),null!=this.videoElement&&this.startMetricTimer(2e4)}}},{key:"_switchStart",value:function(t,e){P(Object(E.a)(i.prototype),"_switchStart",this).call(this,t,e),this.initInfo(this.info),-1!==this.info.url.indexOf("?")?this.info.url+="&startPts=".concat(e):this.info.url+="?startPts=".concat(e),this.h265Proxy.checkUrl(this.info),this.mse.parser.reset(),this.loader.close(),1==localStorage._testBack?localStorage._testBack=0:(this.startTs=c.a.now(),this.loader.connect(this.info.url)),this.updateFlvConfig()}},{key:"initInfo",value:function(t,e){this.info=t,t.sFlvUrl&&t.sStreamName&&(t.url="".concat(t.sFlvUrl,"/").concat(t.sStreamName,".flv"));var i=[];this.anticode.hasAnticode()&&i.push(this.anticode.getAnticode(e)),-1!==a.a.useChangeRate.indexOf(Number(t.presenterUid))?i.push("ratio=".concat(t.curBitrate)):t.iBitRate>0?i.push("ratio=".concat(t.iBitRate)):localStorage._ratio&&i.push("&ratio=".concat(localStorage._ratio)),-1===t.url.indexOf("va.huya.com")&&-1===t.url.indexOf("cdnweb.huya.com")&&-1===t.url.indexOf("va-cmcc.huya.com")||i.push("&https=1"),i.length>0&&(t.url+=(-1!==t.url.indexOf("?")?"&":"?")+"".concat(i.join("&"))),this.url=t.url,this.lineType=t.lineType}},{key:"recSysRspHandler",value:function(t,e,i){i&&i.isBackToP2P?this.backToP2P.recSysRspHandler(t,e,i):!t||e&&e.tRecSysInfo&&1==e.tRecSysInfo.lAction?(u.a.warn("FlvPlayer(".concat(this._id,").recSysRspHandler FLV_TRY_TO_P2P")),this.eventEmitter.trigger(n.a.FLV_TRY_TO_P2P)):(u.a.warn("FlvPlayer(".concat(this._id,").recSysRspHandler jumpToP2PCd=").concat(this.jumpToP2PCd/6e4,"min fail")),this.eventEmitter.trigger(n.a.H5_PLAYER_ERROR))}},{key:"setVideoPlayTimeSended",value:function(){this.flvLoadTimeSended=!0}},{key:"getPlayVideo",value:function(){return this.mse.getPlayVideo()}},{key:"setJitter",value:function(t,e,i){this.mse&&this.mse.setJitter(t,e,i)}},{key:"stop",value:function(){this.started&&(u.a.log("FlvPlayer(".concat(this._id,").stopFlv")),this._reportFlvFlow(),this.reset(),this.started=!1),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.recvDataEnough=!1,this.recvFlvData=!1,P(Object(E.a)(i.prototype),"stop",this).call(this)}},{key:"recvDataFull",value:function(){this.recvDataTime=c.a.now(),this.eventEmitter.trigger(n.a.RECV_VIDEO_FRAME),u.a.log("FlvPlayer(".concat(this._id,").recvDataFull"))}},{key:"initDomain",value:function(t){if(!t.inited){t.inited=!0;var e=t.domainList;if(e&&e.length){var i=t.sFlvUrl.match(/\/\/(.+?)\//i);t._domain=i?i[1]:"",u.a.log("FlvPlayer(".concat(this._id,").initDomain:\n\t")+e.join("\n\t"));var s=e.shift();this.cdnip=s,this.stat.setComDim(l.a.DIM_COM.CDNIP,s),t.sFlvUrl=t.sFlvUrl.replace(/\/\/(.+?)\//,"//"+s+"/"+t._domain+"/")}}}},{key:"retryVideo",value:function(){this.eventEmitter.trigger(n.a.REPLAY_VIDEO)}},{key:"setEnableLowLatency",value:function(t){this.enableLowLatency=t,t&&a.a.setLowLatency(this.mse)}},{key:"updateFlvConfig",value:function(){this.enableLowLatency?a.a.setLowLatency(this.mse):a.a.setJitterCfg(this.mse,this.info.presenterUid,this.info.curBitrate),this.mse&&(this.mse.setNeedEmptyAudioFrame(a.a.flvEmptyAudioFrame>0),u.a.log("FlvPlayer(".concat(this._id,").updateFlvConfig flvEmptyAudioFrame=")+this.getConfig("flvEmptyAudioFrame")))}},{key:"requestUrl",value:function(){var t=this.info,e=t.domainList;if(e&&t._domain){var i=new RegExp("//(.*?)"+t._domain+"/"),s=e.shift();return s?(this.cdnip=s,this.stat.setExtDim(l.a.DIM_EXT.CDN_IP,s),u.a.warn("FlvPlayer(".concat(this._id,").requestUrl change domain to ").concat(s)),t.sFlvUrl=t.sFlvUrl.replace(i,"//"+s+"/"+t._domain+"/")):(this.cdnip="",this.stat.delDim(l.a.DIM_EXT.CDN_IP),u.a.warn("FlvPlayer(".concat(this._id,").requestUrl change domain to ").concat(t._domain)),t.sFlvUrl=t.sFlvUrl.replace(i,"//"+t._domain+"/"),delete t.domainList),this._reportFlvFlow(),void this.startUrl(t)}this.eventEmitter.trigger(n.a.FLV_URL_UNAVAILABLE)}},{key:"setConfig",value:function(t,e){a.a.setConfig(t,e)}},{key:"getConfig",value:function(t){return a.a[t]}},{key:"setVolume",value:function(t){this.mse.setVolume(t)}},{key:"setMuted",value:function(t){this.mse.setMuted(t)}},{key:"getMuted",value:function(){return this.mse.getMuted()}},{key:"getBufferLen",value:function(){return this.mse&&this.mse.getBufferLen?this.mse.getBufferLen():0}},{key:"getFrameBufferLen",value:function(){return this.mse&&this.mse.getFrameBufferLen?this.mse.getFrameBufferLen():0}},{key:"getCurrentTime",value:function(){return this.mse.getCurrentRealTime()}},{key:"getCurrentDts",value:function(){return this.mse.getCurrentDts()}},{key:"getCurrentSeiOffsetDts",value:function(){return this.mse.getCurrentSeiOffsetDts()}},{key:"getDurationTime",value:function(){var t=(this.mse.video||{}).video,e=0;return t&&(e=Math.floor(t.duration||0)),e}},{key:"getVolumeEnergy",value:function(){var t=this.volumeCount>5?1:0;return this.volumeCount=0,t}},{key:"getAnticodeHandler",value:function(){return this.anticode}},{key:"play",value:function(){this.mse.play()}},{key:"pause",value:function(){this.loader.close(),this.mse&&this.mse.pause(),A.a.remove(this.onCheckTimer,this),A.a.remove(this.onCheckFastTimer,this),this.stopMetricTimer()}},{key:"setPlaybackrateAccess",value:function(t){this.mse&&this.mse.setPlaybackrateAccess(t)}},{key:"setAutoJitter",value:function(t){this.mse.autoJitter=t}},{key:"setLoadFlvStatus",value:function(t){t>this.loadFlvStatus&&(this.loadFlvStatus=t)}},{key:"sendLoadVideoErrorStatus",value:function(){this.eventEmitter.tsdbUtil.sendMetrics([this.stat.createAct(p.METRIC.VIDEO_VIDEO_LOAD_ERROR,{value:[this.loadFlvStatus]})])}},{key:"turnToH264",value:function(){this.stop(),this.eventEmitter.trigger(n.a.TURN_TO_H264)}},{key:"h265Retry",value:function(){this.stop(),this.eventEmitter.trigger(n.a.H265_VIDEO_RETRY)}},{key:"onHeader",value:function(t){t.hasOwnProperty("cdncip")&&this.stat.setComDim(l.a.DIM_COM.CDN_CIP,t.cdncip),t.hasOwnProperty("cdnsip")&&this.stat.setComDim(l.a.DIM_COM.CDN_SIP,t.cdnsip),t.hasOwnProperty("alt-svc")&&this.stat.setComDim(l.a.DIM_COM.ALT_SVC,t["alt-svc"]),t.hasOwnProperty("x-hy-quic")&&this.stat.setComDim(l.a.DIM_COM.QUIC,t["x-hy-quic"])}},{key:"onConnected",value:function(){P(Object(E.a)(i.prototype),"onConnected",this).call(this),this.connectTime=c.a.now(),u.a.log("%c[TIME] FlvPlayer(".concat(this._id,").onConnected connectTime=")+(this.connectTime-this.startTs),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(R.a.LoadVideoTimeoutReason.FLV_CONNECTED),this.exceptionStat.setStat(l.a.DIM_LINK_STA.CONNECT_SUC,1)}},{key:"onClosed",value:function(){this.eventEmitter.trigger(n.a.VIDEO_LINK_CLOSE,{video:this.mse.getPlayVideo()})}},{key:"onError",value:function(){this.eventEmitter.trigger(n.a.ANCHOR_STOP,{video:this.mse.getPlayVideo()})}},{key:"onData",value:function(t,e){0==this.firstPkgTime&&(this.firstPkgTime=c.a.now()),this.exceptionStat.setStat(l.a.DIM_LINK_STA.HAS_DATA,1);var i=new Uint8Array(t);this.flowSize+=i.byteLength,this.addBytes(i.byteLength),this.recvDataEnough||(this.flvDataSize+=i.byteLength,this.flvDataSize>1e6&&(this.setLoadFlvStatus(R.a.LoadVideoTimeoutReason.FLV_DATA_INVALID),this.recvDataEnough=!0)),1===e?this.stat.addCore(l.a.CORE.CDN_TOTAL_BW,i.byteLength):this.stat.addCore(l.a.CORE.PCDN_TOTAL_BW,i.byteLength),this.mse.appendFlv(i);var s=c.a.now();0==this.recvTime&&(u.a.log("%c[TIME] FlvPlayer(".concat(this._id,").onData firstPkgTime=")+(s-this.connectTime),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(R.a.LoadVideoTimeoutReason.FLV_RECV_DATA)),this.recvTime=s}},{key:"getMse",value:function(){return this.mse}},{key:"onPlayVideo",value:function(t,e,s,r,a,o,h){P(Object(E.a)(i.prototype),"onPlayVideo",this).call(this,t,e,s,r,a,o,h),this.stat.setComDim(l.a.DIM_COM.DPI,e+"*"+s);var d=c.a.now();u.a.log("FlvPlayer(".concat(this._id,").onStartVideo loadeddata=").concat(d)),this.loadTime=d-this.startTs,this.newLoadTime=d-this.eventEmitter.startTs,this.waitRemuxTime=0,this.mse&&this.mse.parser&&0!=this.mse.parser.waitRemuxTime&&(this.waitRemuxTime=this.mse.parser.waitRemuxTime);var p=this.connectTime-this.startTs,f=this.recvDataTime-this.startTs,_=this.mse.pushVideoStartRenderTime-this.startTs,m=this.UIStartCost>0?this.loadTime+this.UIStartCost:0,y=0;this.startTimeStamp>1?y=this.loadTime+this.businessStartCost:1===this.startTimeStamp&&(y=this.loadTime);var v=this.firstPkgTime-this.startTs,S=0;0!=this.mse.parser.decodeIFRTime&&(S=this.mse.parser.decodeIFRTime-this.startTs),u.a.log("%cFlvPlayer(".concat(this._id,").onPlayVideo loadTime=")+this.loadTime+"  businessStartCost="+this.businessStartCost+"  UIStartCost="+this.UIStartCost,"color:#A23400;background:#FFF5C2"),u.a.log("%cFlvPlayer(".concat(this._id,").onPlayVideo newLoadTime=")+this.newLoadTime,"color:#A23400;background:#FFF5C2"),this.tsdb.sendFlvTime(this.newLoadTime,p,f,_,null!=this.videoElement,y,m,this.waitRemuxTime,v,S);var g={video:t,width:e,height:s,loadTime:this.loadTime,connectTime:p,recvDataTime:f,pushVideoTime:_,canvas:a,videoCodec:h,delayRemove:this.info._delayRemove};this.info._delayRemove=!1,this.eventEmitter.trigger(n.a.VIDEO_PLAY,g),this.updateStatus(n.b.VIDEO_PLAYING),this.setLoadFlvStatus(R.a.LoadVideoTimeoutReason.FLV_STARTPLAY),this.eventEmitter.onPlayVideo&&this.eventEmitter.onPlayVideo(t)}},{key:"onAudioFrequency",value:function(t){t.value&&this.volumeCount++}},{key:"onVideoStop",value:function(t,e){u.a.log("FlvPlayer(".concat(this._id,").onVideoStop hasVideo=")+e),e&&this.updateStatus(n.b.VIDEO_STOP),this.eventEmitter.trigger(n.a.VIDEO_STOP,{video:t,hasVideo:e})}},{key:"onSendSeiData",value:function(t,e,i){this.eventEmitter.trigger(n.a.H264_SEI_PLAY,{data:t,ts:e,now:(new Date).getTime(),vt:i})}},{key:"onSendScriptVolumeInfo",value:function(t,e){Number(localStorage._printAudioIntensity)&&u.a.log("FlvPlayer(".concat(this._id,").onSendScriptVolumeInfo uid:")+t+"  intensity:"+e),this.eventEmitter.trigger(n.a.UPDATE_INTERSITY,{uid:t,intensity:e})}},{key:"onLoadError",value:function(t){this.eventEmitter.trigger(n.a.FLV_URL_UNAVAILABLE,{msg:t}),this.setLoadFlvStatus(R.a.LoadVideoTimeoutReason.FLV_CONNECT_ERROR)}},{key:"onVideoParseInvalid",value:function(){this.setLoadFlvStatus(R.a.LoadVideoTimeoutReason.FLV_DATA_INVALID)}},{key:"onLoadTimeout",value:function(){this.eventEmitter.trigger(n.a.FLV_URL_LOAD_TIMEOUT)}},{key:"onPlayerError",value:function(t){}},{key:"onErrorEvent",value:function(t){P(Object(E.a)(i.prototype),"onErrorEvent",this).call(this,t),this.eventEmitter&&this.eventEmitter.lastP2PInfo?this.getRecSysRsp({info:this.info,type:"flv",metadata:this.mse.metadata,isFlvError:!0}):this.eventEmitter.trigger(n.a.H5_PLAYER_ERROR,{code:t.type,msg:"播放错误"})}},{key:"onPlayPause",value:function(t,e){this.startSendPauseTimer(),P(Object(E.a)(i.prototype),"onPlayPause",this).call(this,t,e)}},{key:"onPlayResume",value:function(t,e){this.stopSendPauseTimer(),P(Object(E.a)(i.prototype),"onPlayResume",this).call(this,t,e)}},{key:"sendPauseEvent",value:function(){this.eventEmitter.trigger(n.a.PLAY_CARTON)}},{key:"startMetricTimer",value:function(t){clearTimeout(this.sendMetricTimer),this.sendMetricTimer=setTimeout(this.heartBeat20sMetric.bind(this),t)}},{key:"stopMetricTimer",value:function(){this.sendMetricTimes=0,clearTimeout(this.sendMetricTimer)}},{key:"setAudioUtil",value:function(t){this.audiouitil=t,this.audiouitil.removeAllListeners([_e.AUDIO_FREQUENCY]),this.audiouitil.createAudioContext(this.mse.video),this.audiouitil.on(_e.AUDIO_FREQUENCY,this.onAudioFrequency.bind(this))}},{key:"startSendPauseTimer",value:function(){this.stopSendPauseTimer(),this.sendPauseTimeout=setTimeout(this.sendPauseEvent.bind(this),200)}},{key:"stopSendPauseTimer",value:function(){clearTimeout(this.sendPauseTimeout)}},{key:"heartBeat20sMetric",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e4,e=c.a.now();if(u.a.log("FlvPlayer(".concat(this._id,").heartBeat20sMetric ")),this.sendMetricTimes++,this._checkPaused(e,rs),this.qaStat){0==this.pauseTime&&(this.pauseReason=0);var i=this.pauseStartTs>0;this.qaStat.record(this.pauseCnt,this.pauseTime,i,this.flowSize,this.pauseReason,this.getVolumeEnergy())}this.pauseStartTs>0&&this.autoMonitor.setPause(this.pauseStartTs,this.getBufferLen()),this.pauseCnt=0,this.pauseTime=0,this.pauseReason=0,this.flowSize=0,this.sendMetricTimes%15==0&&(this.tsdb.sendMetrics([{sMetricName:p.METRIC.VIDEO_VIDEO_BAD_QUALITY_5M_RATIO,vField:{value:this.pauseCnt5>0?100:0}}]),this.pauseCnt5=0,this.pauseTime5=0),t>0&&this.startMetricTimer(t)}},{key:"onCheckTimer",value:function(t,e){if(this.started){if(this.connected&&this.recvTime>0&&t-this.recvTime>8e3){var i=this.getBufferLen();return u.a.warn("FlvPlayer(".concat(this._id,").onCheckTimer no data received ")+(t-this.recvTime)+" buffLen="+i),void this.eventEmitter.trigger(n.a.NO_DATA_RECEIVED)}if(this.anticode.onCheckTimer(t,e),this.loader.onCheckTimer(t,e),this.mse&&this.mse.onCheckTimer(t,e),this.metadataTick.onCheckTimer(t,e),this.connected){null==this.videoElement&&(0===this.heart20Ts?this.heart20Ts=t:t-this.heart20Ts>=2e4&&(this.heartBeat20sMetric(0),this.heart20Ts=t));try{this.eventEmitter.trigger(n.a.PLAY_DOWNLINK_INFO,{buffer:this.getBufferLen()/1e3,downLinkSpeed:0|this.loader.speed,videoBufferEnd:this.mse.video.video.buffered.end(this.mse.video.video.buffered.length-1)})}catch(t){u.a.log("FlvPlayer(".concat(this._id,").onCheckTimer cannot get down link info"))}this.backToP2P.onCheckTimer(t,e),this.eventEmitter.trigger(n.a.PLAY_FRAME_BUFFER,{frameStorage:this.mse.getFrameReadyed(),jitterBuffer:this.mse.getBufferLen(),playdelay:this.mse.getFramePlayDelays()})}}}},{key:"onCheckFastTimer",value:function(t,e){this.started&&(this.mse.onCheckFastTimer(t,e),this.backToP2P.onCheckFastTimer(t,e),this.loader.onCheckFastTimer(t,e),!this.pauseCheckLock&&this.pauseStartTs>0&&t-this.pauseStartTs>200&&(this.pauseCheckLock=!0,this.pauseCheck(t)))}},{key:"_reportFlvFlow",value:function(){this.qaStat&&(this._checkPaused(c.a.now(),"stop"),this.qaStat.sendFlow(this.pauseCnt,this.pauseTime,this.pauseStartTs,this.flowSize,this.pauseReason,this.getVolumeEnergy(),!0),this.pauseCnt=0,this.pauseTime=0,this.pauseReason=0,this.flowSize=0)}},{key:"pauseCheck",value:function(t){if(this.started){var e=0,i=this.info.curBitrate/8-10,s=this.loader.speed/1024|0;e=s>0&&s<i?R.a.pauseReason.FLV_NET_SLOW:R.a.pauseReason.FLV_NO_BUFF,this.recvTime>0&&t-this.recvTime>2e3&&(e=R.a.pauseReason.FLV_NO_DATA);var r=this.getBufferLen();r>1e3&&(e=R.a.pauseReason.FLV_UNKNOW_PAUSE),e>this.pauseReason&&(this.pauseReason=e),u.a.warn("FlvPlayer(".concat(this._id,").pauseCheck curReason=").concat(e," reportReason=").concat(this.pauseReason," buffLen=").concat(r))}}},{key:"connected",get:function(){return this.loader.connected}},{key:"isPlaying",get:function(){return this.videoStatus!==n.b.VIDEO_STOP}},{key:"hasPicture",get:function(){var t=this.isPlaying&&0!==this.mse.getCurrentTime();return this.h265Proxy.rendering&&(t=t&&this.isH265Playing),t}}]),i}(function(){function t(e,i){Object(s.a)(this,t),this._id=ns++,this.eventEmitter=e,this.stat=i.stat,this.tsdb=i.tsdb,this.statSwitch=i.statSwitch,this.sampleController=i.sampleController,this.h265Proxy=i.h265Proxy,this.autoMonitor=i.autoMonitor,this.recSysStat=i.recSysStat,this.info=null,this.isH265Playing=!1,this.playerType=-1,this.started=!1,this.heart20Ts=0,this.pauseCnt=0,this.pauseTime=0,this.pauseCnt5=0,this.pauseTime5=0,this.pauseCnt60Sec=0,this.pauseStartTs=0,this.pauseCheckLock=!1,this.videoStatus=n.b.VIDEO_STOP,this.isSwitchPause=!1,this._useAV1=!1,this.isAV1MediaSupported=this.checkAV1MediaSupported(),this.resetAiProps(),this.videoBadList=[],this.fastSample=new Hi(20),this.onFastSampleOverBind=this.onFastSampleOver.bind(this),this._switch265FailBind=this._switch265Fail.bind(this),this.ctrlBitrate=new is({player:this,statSwitch:this.statSwitch,autoMonitor:this.autoMonitor,recSysStat:this.recSysStat},{start:this._switchStart.bind(this),first:this._switchFirstSample.bind(this),done:this._switchDone.bind(this),autoReport:this.autoReport.bind(this)}),this.ctrlBitrate.beforeSwitchCb=this._beforeSwitch.bind(this),this.switchDoneBefore=new ss}return Object(r.a)(t,[{key:"_beforeSwitch",value:function(t){this.switchDoneBefore.stop();var e=this.info;e._delayRemove=!1,e.iBitRate=t.iBitRate,e.curBitrate=t.bitrate,e.originalBitrate=0===t.iBitRate,e.iCodecType=t.iCodecType,e.iHEVCBitRate=t.iHEVCBitRate;var i=this.h265Proxy.renderInited;this.h265Proxy.initSupport(e);var s=this.h265Proxy.isSupported;!i&&s?(this.ctrlBitrate.switchType=is.SwitchType.H264ToH265,this.h265Proxy.loadDecoder(e.h5Root,{ready:this._onH265DecoderReady.bind(this),error:this._switch265FailBind,timeout:this._switch265FailBind})):(i||s?i&&s?this.ctrlBitrate.switchType=is.SwitchType.H265ToH265:i&&!s&&(this.ctrlBitrate.switchType=is.SwitchType.H265ToH264,e._delayRemove=!0):this.ctrlBitrate.switchType=is.SwitchType.H264ToH264,this.switchLevel(e))}},{key:"_onH265DecoderReady",value:function(){u.a.log("IPlayer._onH265DecoderReady"),this.info._delayRemove=!0,this.switchLevel(this.info)}},{key:"_switch265Fail",value:function(){this.ctrlBitrate.switchType=is.SwitchType.H264ToH264,this.switchLevel(this.info)}},{key:"setAutoInfo",value:function(t){this.ctrlBitrate.setAutoInfo(t)}},{key:"switchLevel",value:function(t){a.a.initByBitrate(t.curBitrate),this.isUserPaused()?this.start(t):this.started&&(this.info=t,this.statSwitch.check(t,!0),this.ctrlBitrate.switchBitrate(t.curBitrate),this._triggerAutoChanged())}},{key:"_switchStart",value:function(t,e){var i=this.getBufferLen();this.ctrlBitrate._badStat.setStart(i),this.ctrlBitrate._seg.nextIFrame(),u.a.log("IPlayer(".concat(this._id,")._switchStart bufferLen=").concat(i," dts=").concat(t," pts=").concat(e)),A.a.once(this._switchFirstVideoTimeout,this,1e3),this.isSwitchPause=!1,A.a.once(this._checkSwitchPause,this,5e3)}},{key:"onConnected",value:function(){u.a.log("IPlayer(".concat(this._id,").onConnected")),this.ctrlBitrate._badStat.setConnected(),this.ctrlBitrate._seg.connected()}},{key:"_switchFirstSample",value:function(){u.a.log("IPlayer(".concat(this._id,")._switchFirstSample")),this.ctrlBitrate._badStat.setFirstFrame(),this.ctrlBitrate._seg.firstVideo(),A.a.remove(this._switchFirstVideoTimeout,this),A.a.once(this._switchPtsIFrameTimeout,this,1e3)}},{key:"_switchFirstVideoTimeout",value:function(){u.a.log("IPlayer(".concat(this._id,")._switchFirstVideoTimeout")),this.ctrlBitrate._badStat.setFirstVideoTimeout(),this.switchDoneBefore.stop(),this.ctrlBitrate.switchBack(Vt)}},{key:"_switchPtsIFrameTimeout",value:function(){u.a.log("IPlayer(".concat(this._id,")._switchPtsIFrameTimeout")),this.ctrlBitrate._badStat.setPtsFrameTimeout(),this.switchDoneBefore.stop(),this.ctrlBitrate.switchBack(xt)}},{key:"_switchDone",value:function(t,e,i){this.ctrlBitrate._badStat.setPtsFrame(i),this.ctrlBitrate._seg.ptsIFrame(),A.a.remove(this._switchPtsIFrameTimeout,this),this.ctrlBitrate.startEval(e),this.ctrlBitrate.switchType===is.SwitchType.H264ToH265||this.ctrlBitrate.switchType===is.SwitchType.H265ToH264?(this.ctrlBitrate.pause(),this.switchDoneBefore.start(this.getMse(),t,{done:this._onSwitchDoneBefore.bind(this)})):this._switchDoneReal(0)}},{key:"_onSwitchDoneBefore",value:function(){var t=this.getMse();u.a.log("IPlayer(".concat(this._id,")._onSwitchDoneBefore mse=").concat(!!t," switchType=").concat(this.ctrlBitrate.switchType)),t&&(t.resetVideo(),t.playing=!1,t.parser.remuxer.reset(),this.ctrlBitrate.switchType===is.SwitchType.H265ToH264?this.h265Proxy.stop():this.ctrlBitrate.switchType===is.SwitchType.H264ToH265&&this.h265Proxy.initRender(t)),this._switchDoneReal(3e3)}},{key:"_switchDoneReal",value:function(t){u.a.log("IPlayer(".concat(this._id,")._switchDoneReal")),this.ctrlBitrate.switchDone(t)}},{key:"_triggerAutoChanged",value:function(){this.eventEmitter.trigger(n.a.AUTO_BITRATE_CHANGED,{lastBitrate:this.ctrlBitrate.lastBitrate,curBitrate:this.ctrlBitrate.curBitrate})}},{key:"isUserPaused",value:function(){return!1}},{key:"onPlayVideo",value:function(t,e,i,s,r,n,o){this.info&&this.info.isAuto&&0===Number(a.a.autoCfg.close)&&(this.ctrlBitrate.start(this.getMse(),{sessionId:this.info._sessionId,startBitrate:this.info._startBitrate,bitrateList:this.info.bitrateList,curBitrate:this.info.curBitrate}),this._triggerAutoChanged()),this.stat.setComDim(l.a.DIM_COM.DPI,e+"*"+i),this.h265Proxy.needPreload&&this.h265Proxy.loadDecoder(this.info.h5Root,null)}},{key:"_startContinueBuffer",value:function(){var t=this.getMse();t&&t.buffered.start()}},{key:"onPlayPause",value:function(t,e){this.pauseStartTs=t,this.pauseCheckLock=!1,this.isSwitchPause=!0,this.autoMonitor.setPause(t,this.getBufferLen()),e&&this.updateStatus(n.b.VIDEO_CACHING)}},{key:"onPlayResume",value:function(t,e){this._checkPaused(t,"resume"),e&&this.updateStatus(n.b.VIDEO_PLAYING)}},{key:"_checkPaused",value:function(t,e){if(this.pauseStartTs>0){var i=t-this.pauseStartTs;if(i>=200){u.a.warn("IPlayer(".concat(this._id,")._checkPaused type=").concat(e," pauseTime=").concat(i));var s=this.getMse(),r=0;s&&(s.buffered._calc(t,ne),r=s.getContinueBuffer()),this.autoMonitor.addBadQuality(t,i,e,r),this.pauseCnt++,this.pauseTime+=i,this.pauseCnt5++,this.pauseTime5+=i,this.ctrlBitrate.addBadQuality(t,i,this.getBufferLen()),this.pauseCnt60Sec++}else this.autoMonitor.resetPausedTs();this.pauseStartTs=e===rs?t:0}}},{key:"updateStatus",value:function(t){this.videoStatus!==t&&(this.videoStatus=t,this.eventEmitter.trigger(n.a.PLAY_STATUS,{status:t}))}},{key:"onErrorEvent",value:function(t){3===t.type&&this.ctrlBitrate._badStat.setNoIFrame()}},{key:"getMse",value:function(){return null}},{key:"getBufferLen",value:function(){return 0}},{key:"getWaitBufferLen",value:function(){return 0}},{key:"getWaitFrameTime",value:function(t){return 0}},{key:"triggerVideoBadQuality",value:function(){this.eventEmitter.trigger(n.a.VIDEO_BAD_QUALITY)}},{key:"trigger",value:function(t,e){this.eventEmitter.trigger(t,e)}},{key:"onFastSampleOver",value:function(t){var e=[this.stat.createAct(l.a.ACT.FAST_SAMPLE,{str:[t]})];this.tsdb.sendMetrics(e)}},{key:"startFastSample",value:function(){this.fastSample.start(this.onFastSampleOverBind)}},{key:"addBytes",value:function(t){this.sampleController.addTotalSample(t),this.fastSample.add(t)}},{key:"init",value:function(t){}},{key:"start",value:function(t){this.stop(),A.a.add(this.getVideoBadQuality,this,2e4),A.a.add(this.pauseTimer60Sec,this,6e4),this.sampleController.start()}},{key:"stop",value:function(){this.isH265Playing=!1,this.heart20Ts=0,this.videoBadList=[],this.pauseCnt60Sec=0,this.isSwitchPause=!1,this.fastSample.stop(),this.sampleController.stop(),this.ctrlBitrate.stop(),this.switchDoneBefore.stop(),A.a.remove(this._switchFirstVideoTimeout,this),A.a.remove(this._switchPtsIFrameTimeout,this),A.a.remove(this.timeoutRecSysRsp,this),A.a.remove(this.getVideoBadQuality,this),A.a.remove(this.getVideoLoad,this),A.a.remove(this.pauseTimer60Sec,this)}},{key:"getVideoBadQuality",value:function(){if(0!==Number(a.a.isAiP2PToFlv)&&this.mse){var t=this.mse.pauseStat.getAiStat(),e=t.aiDuration,i=t.aiCnt;if(this.videoBadList.length<3&&(e>=a.a.aiP2PFlvConfig[0]||i>=a.a.aiP2PFlvConfig[1]?this.videoBadList.push(1):this.videoBadList.push(0)),this.videoBadList.length>=3){var s=0;this.videoBadList.map((function(t){1==t&&s++}));var r=c.a.now();if(s>=2){if(1===this.playerType){var n=this.eventEmitter.getVideoP2PBuffertEmptyTime;0!=n&&r-n<=a.a.aiBufferEmptyRequestInterval?u.a.log("IPlayer(".concat(this._id,").getVideoBadQuality.getVideoP2PBuffertEmptyTime"),r-n):(this.getRecSysRsp({info:this.info,type:"p2p",metadata:this.player?this.player.msePlayer.metadata:null,reason:R.a.turnToFlvReason.VIDEO_BUFFER_EMPTY}),this.eventEmitter.getVideoP2PBuffertEmptyTime=r)}else if(0===this.playerType){var o=this.eventEmitter.getVideoFlvBuffertEmptyTime;if(0!=o&&r-o<=a.a.aiBufferEmptyRequestInterval)return void u.a.log("IPlayer(".concat(this._id,").getVideoBadQuality.getVideoFlvBuffertEmptyTime"),r-o);this.eventEmitter&&this.eventEmitter.lastP2PInfo&&(this.getRecSysRsp({info:this.info,type:"flv",metadata:this.mse.metadata}),this.eventEmitter.getVideoFlvBuffertEmptyTime=r)}this.videoBadList=[]}else this.videoBadList.shift()}}}},{key:"startP2PUrl",value:function(t){}},{key:"stopStream",value:function(t){}},{key:"checkPcdnMode",value:function(t,e){if(this.info){this.info.usePcdn=this._getUsePcdn(t),localStorage.usePcdn&&(this.info.usePcdn=1),this.p2pMgr&&this.p2pMgr.stream&&(this.p2pMgr.stream.usePcdn=this._checkUsePcdn()),this.stat.setComDim(l.a.DIM_COM.FORCE_SUB_TYPE,this.info.usePcdn);var i=this._getPcdnName(e);""!=i&&null!=i&&this.stat.setComDim(l.a.DIM_COM.PCDN_ORIGIN,i)}}},{key:"_checkUsePcdn",value:function(){return this.info.isAuto&&Number(a.a.closePcdn500)===this.info.curBitrate?0:this.info.usePcdn}},{key:"checkAV1MediaSupported",value:function(){return MediaSource.isTypeSupported('video/mp4; codecs="av01.0.08M.08"')}},{key:"setUseAV1",value:function(t){this._useAV1=t}},{key:"isUseAV1",value:function(t){this._useAV1=a.a.useAV1;var e=!0;return this.eventEmitter.noLoadAv1Count&&(e=this.eventEmitter.noLoadAv1Count<3),this.isAV1MediaSupported&&this._useAV1&&e&&v.b.getAv1Random(t,a.a.av1PercentConfig)&&1==Number(a.a.abUseAv1)}},{key:"_getUsePcdn",value:function(t){return 0}},{key:"_getPcdnName",value:function(){return""}},{key:"setEnableLowLatency",value:function(t){}},{key:"setPlaybackrateAccess",value:function(t){}},{key:"setVolume",value:function(t){}},{key:"getCurrentTime",value:function(){return 0}},{key:"getFrameData",value:function(){return null}},{key:"resetAiProps",value:function(){this.aiP2PCnt=0,this.aiFlvCnt=0,this.aiP2PTimeoutCnt=0,this.aiFlvTimeoutCnt=0,this.aiP2PErrorCnt=0,this.aiFlvErrorCnt=0,this.aiP2PSwitchCnt=0,this.aiFlvSwitchCnt=0,this.aiP2PNotSwitchCnt=0,this.aiFlvNotSwitchCnt=0,this.aiFlvErrorNotSwitchCnt=0,this.aiFlvErrorSwitchCnt=0}},{key:"recordAiP2PFlv",value:function(t){"p2p"==t?this.aiP2PCnt++:"flv"==t&&this.aiFlvCnt++}},{key:"initAiReq",value:function(t,e,i,s,r,n){var a=new X.RecSysReq;a.tId.iAppid=Q.a.appid,a.tId.lUid=Q.a.uid,a.tId.sGuid=Q.a.sGuid,a.tId.sUA="webh5",a.sAnchorUid=t.presenterUid,a.sRoomId=Q.a.roomId,a.iScene=6,a.bDebug=1,a.mAppendInfo.value={streamType:e,expVideoFps:i&&null!=i.fps?i.fps:0,expAudioFps:i&&null!=i.audioFps?i.audioFps:0,codeRate:t.curBitrate,isOriginal:0==t.originalBitrate?1:0,line:n,codeType:this.isH265?"265":"264",sStreamName:t.sStreamName,playType:s,isServer:0,iIsP2PSupport:t.iIsP2PSupport};var o=Object.assign({},a);return u.a.log("IPlayer(".concat(this._id,").getRecSysRsp.req"),a,JSON.stringify(o)),a}},{key:"getRecSysRsp",value:function(t,e){var i=this,s=t.info,r=t.type,n=(t.reason,t.metadata),o=t.isNotAi,h=c.a.now();if(0===Number(a.a.isAiP2PToFlv)||o)return this.recordAiP2PFlv(r),void this.recSysRspHandler(!1,null,t);var l=this.eventEmitter.getAIRequestTime;if(0!=l&&h-l<=a.a.aiRequestInterval)u.a.log("IPlayer(".concat(this._id,").getRecSysRsp.getAIRequestTime"),h-l);else{this.eventEmitter.getAIRequestTime=h,this.recordAiP2PFlv(r),A.a.remove(this.timeoutRecSysRsp),this.isTimeout=!0,this.isResTimeout=!1;var d=this.initAiReq(s,r,n,0,"264",s.lineType);$.sendWup("mediaui","getMediaRec",d,(function(e){if(!i.eventEmitter.isBusiStop){var s=Object.assign({},e);if(u.a.log("IPlayer(".concat(i._id,").getRecSysRsp res"),e,JSON.stringify(s)),i.isTimeout=!1,!i.isResTimeout)if(0===e.iStatus)e&&e.tRecSysInfo&&1==e.tRecSysInfo.lAction?"p2p"==r?i.aiP2PSwitchCnt++:"flv"==r&&(i.aiFlvSwitchCnt++,t.isFlvError&&i.aiFlvErrorSwitchCnt++):"p2p"==r?i.aiP2PNotSwitchCnt++:"flv"==r&&(i.aiFlvNotSwitchCnt++,t.isFlvError&&i.aiFlvErrorNotSwitchCnt++),i.recSysRspHandler(!0,e,t);else{if(t.isNotFirstFetch)return;"p2p"==r?i.aiP2PErrorCnt++:"flv"==r&&(i.aiFlvErrorCnt++,t.isFlvError&&i.aiFlvErrorSwitchCnt++),i.recSysRspHandler(!1,null,t)}}}),!0,$.getRequestId(),!0),this.aiP2PFlvProps=t,A.a.once(this.timeoutRecSysRsp,this,5e3)}}},{key:"getAiStat",value:function(){var t={};this.eventEmitter&&this.eventEmitter.getAiStartStat&&(t=this.eventEmitter.getAiStartStat()),this.aiP2PSwitchCnt+=t.aiStartFlvCnt;var e={aiP2PCnt:this.aiP2PCnt,aiFlvCnt:this.aiFlvCnt,aiP2PTimeoutCnt:this.aiP2PTimeoutCnt,aiFlvTimeoutCnt:this.aiFlvTimeoutCnt,aiP2PErrorCnt:this.aiP2PErrorCnt,aiFlvErrorCnt:this.aiFlvErrorCnt,aiP2PSwitchCnt:this.aiP2PSwitchCnt,aiFlvSwitchCnt:this.aiFlvSwitchCnt,aiP2PNotSwitchCnt:this.aiP2PNotSwitchCnt,aiFlvNotSwitchCnt:this.aiFlvNotSwitchCnt,aiStartP2PCnt:t.aiStartP2PCnt||0,aiStartFlvCnt:t.aiStartFlvCnt||0,aiFlvErrorSwitchCnt:this.aiFlvErrorSwitchCnt,aiFlvErrorNotSwitchCnt:this.aiFlvErrorNotSwitchCnt};return this.resetAiProps(),e}},{key:"timeoutRecSysRsp",value:function(){if(this.isTimeout){var t=this.aiP2PFlvProps,e=t.type;if(t.isNotFirstFetch)return;"p2p"==e?this.aiP2PTimeoutCnt++:"flv"==e&&(this.aiFlvTimeoutCnt++,t.isFlvError&&this.aiFlvErrorSwitchCnt++),this.recSysRspHandler(!1,null,t),this.isResTimeout=!0}}},{key:"onPause5Sec",value:function(){this.eventEmitter&&(u.a.log("IPlayer(".concat(this._id,").onPause5Sec")),this.eventEmitter.trigger(n.a.PAUSE_5SEC_ERROR))}},{key:"pauseTimer60Sec",value:function(t,e){this.pauseCnt60Sec>=a.a.autoReportCfg[1]&&1===Number(a.a.autoReportCfg[2])&&this.autoReport(0),this.pauseCnt60Sec=0}},{key:"_checkSwitchPause",value:function(){this.isSwitchPause&&1===Number(a.a.autoReportCfg[2])&&this.autoReport(1),this.isSwitchPause=!1}},{key:"autoReport",value:function(t){1!=this.playerType&&0!=this.playerType||!this.info.isAuto||1===Number(a.a.autoReportCfg[0])&&(u.a.log("IPlayer autoReport type=".concat(t)),this.eventEmitter&&this.eventEmitter.trigger(n.a.P2P_REPORT))}},{key:"hasPicture",get:function(){return!1}},{key:"isPlaying",get:function(){return!1}}]),t}()),os=function(){function t(){Object(s.a)(this,t),this.comDim=new Map,this.coreDim=new Map,this.actDim=new Map,this.extDim=new Map,this.comFormatMap=new Map,this.coreMap=new Map,this.compMap=new Map,this.heart_type=l.a.HEART_TYPE.START}return Object(r.a)(t,[{key:"reset",value:function(){this.comDim.clear(),this.coreDim.clear(),this.actDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type=l.a.HEART_TYPE.START}},{key:"createAct",value:function(t,e){return this._createAct(t,e)}},{key:"createActs",value:function(t){var e=[];if(t)for(var i=0;i<t.length;i++){var s=t[i],r=this._createAct(s.type,s.params);e.push(r)}return e}},{key:"_createAct",value:function(t,e){var i={sMetricName:l.a.ACT.name,vField:{},vDimension:{}};if(i.vDimension[l.a.ACT.field]=t,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),e){var s=0;if(e.hasOwnProperty(l.a.KEY_VALUE)){var r=e[l.a.KEY_VALUE];for(s=0;s<r.length;s++)i.vField[l.a.KEY_VALUE+(s+1)]=r[s]}if(e.hasOwnProperty(l.a.KEY_STR)){var n=e[l.a.KEY_STR];for(s=0;s<n.length;s++)i.vDimension[l.a.KEY_STR+(s+1)]=n[s]}e.hasOwnProperty(l.a.KEY_DIM)&&Object.assign(i.vDimension,e[l.a.KEY_DIM])}return i.vDimension.appid=Q.a.appid,this.actDim.clear(),i}},{key:"fill",value:function(t,e){e?(this.heart_type=l.a.HEART_TYPE.END,this._fill(t),this.heart_type=l.a.HEART_TYPE.START):this._fill(t)}},{key:"_fill",value:function(t){if(0!=this.coreMap.size||0!=this.compMap.size){var e={sMetricName:l.a.CORE.name,vField:{},vDimension:{},vExLog:{}};this.coreDim.set(l.a.DIM_CORE.HEART_TYPE,this.heart_type),this._fillFromMap(e.vDimension,this.comDim),this._fillFromMap(e.vDimension,this.coreDim),this._fillFromMap(e.vExLog,this.extDim),this._fillFromMap(e.vField,this.coreMap),this._fillComp(e.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type==l.a.HEART_TYPE.START&&(this.heart_type=l.a.HEART_TYPE.CONTINUS),e.vDimension.appid=Q.a.appid,t.push(e)}}},{key:"_fillComp",value:function(t){var e,i=y(this.compMap.keys());try{for(i.s();!(e=i.n()).done;){var s,r=e.value,n=this._getCompMapFormat(r),a=n.get("ref")||",",o=n.get("split")||";",h=this.compMap.get(r),u="",c=y(h.keys());try{for(c.s();!(s=c.n()).done;){var l=s.value;u.length>0&&(u+=o),u+=l+a+h.get(l)}}catch(t){c.e(t)}finally{c.f()}t[r]=u}}catch(t){i.e(t)}finally{i.f()}}},{key:"_fillFromMap",value:function(t,e){var i,s=y(e.keys());try{for(s.s();!(i=s.n()).done;){var r=i.value;t[r]=e.get(r)}}catch(t){s.e(t)}finally{s.f()}}},{key:"setComDim",value:function(t,e){this.comDim.set(t,e)}},{key:"setCoreDim",value:function(t,e){this.coreDim.set(t,e)}},{key:"setActDim",value:function(t,e){this.actDim.set(t,e)}},{key:"setExtDim",value:function(t,e){this.extDim.set(t,e)}},{key:"delDim",value:function(t){this.comDim.has(t)?this.comDim.delete(t):this.coreDim.has(t)?this.coreDim.delete(t):this.actDim.has(t)&&this.actDim.delete(t)}},{key:"setCore",value:function(t,e){this.coreMap.set(t,e)}},{key:"addCore",value:function(t,e){this._addValue(this.coreMap,t,e)}},{key:"setComp",value:function(t,e,i){this._getCompMap(t).set(e,i)}},{key:"addComp",value:function(t,e,i){var s=this._getCompMap(t);this._addValue(s,e,i)}},{key:"setCompFormat",value:function(t,e,i){var s=this._getCompMapFormat(t);s.set("ref",e),s.set("split",i)}},{key:"_getCompMapFormat",value:function(t){if(this.comFormatMap.has(t))return this.comFormatMap.get(t);var e=new Map;return this.comFormatMap.set(t,e),e}},{key:"_getCompMap",value:function(t){if(this.compMap.has(t))return this.compMap.get(t);var e=new Map;return this.compMap.set(t,e),e}},{key:"_addValue",value:function(t,e,i){if(t.has(e)){var s=t.get(e);t.set(e,s+i)}else t.set(e,i)}}]),t}(),hs="VIDEO_TIMEUPDATE",us="VIDEO_PROGRESS",cs=[n.c.H264_SEI_PLAY,n.c.AUDIO_SOUND,n.c.SIGNAL_DATA,n.c.UPDATE_INTERSITY,n.c.SIGNAL_HEART,n.c.METADATA,n.c.TRANS_END,n.c.PLAY_DOWNLINK_INFO,n.c.PLAY_FRAME_BUFFER,n.c.PLAY_TIME_STATUS,n.c.PLAYBACK_UPDATE,n.c.PLAYBACK_M3U8_UPDATED,hs,us],ls=i(12),ds=function(){function t(){Object(s.a)(this,t),this._mediaUserId=null,this._bAnonymous=0,this._tryTimes=0,this._isLogin=!1,this._roomId=0}return Object(r.a)(t,[{key:"loginMedia",value:function(t,e,i){if(this._roomId=e,!this._mediaUserId){var s=new ls.default.MediaUserId;s.lUid=i,s.sGuid=v.b.getCookie("guid"),s.sToken=t,s.sUA="media_web&1000&",s.iAppid=Q.a.appid,s.sStrUid="",this._mediaUserId=s}this._login()}},{key:"_login",value:function(){this._mediaUserId.bAnonymous=this._bAnonymous;var t=new ls.default.LoginVerifyReq;t.tId=this._mediaUserId,o.default.sendWup("mediaui","loginVerify",t,this._onLogin.bind(this),!0,o.default.getRequestId(),!0)}},{key:"_onLogin",value:function(t){u.a.log("MediaLink._onLogin iResCode=".concat(t.iResCode)),0===t.iResCode?(this._isLogin=!0,this._mediaUserId.sCookie=t.sCookie,this._join()):1===t.iResCode&&(this._tryTimes++,this._tryTimes<5&&(this._bAnonymous=1,this._login()))}},{key:"_join",value:function(){var t=new ls.default.JoinMediaGroupReq;t.tId=this._mediaUserId,t.vGroupId.value=[this._roomId],o.default.sendWup("mediaui","joinGroup",t,this._onJoin.bind(this),!0,o.default.getRequestId(),!0)}},{key:"_onJoin",value:function(t){u.a.log("MediaLink._onJoin iCode=".concat(t.iCode))}},{key:"quitMedia",value:function(){var t=new ls.default.QuitMediaGroupReq;t.tId=this._mediaUserId,t.vGroupId.value=[this._roomId],o.default.sendWup("mediaui","quitGroup",t,this._onQuit.bind(this),!0,o.default.getRequestId(),!0)}},{key:"_onQuit",value:function(t){u.a.log("MediaLink._onQuit iCode=".concat(t.iCode))}}]),t}(),ps={},fs=ps;ps.INT8=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt8(e,i)},this._read=function(t,e,i){return t.readInt8(e,!0,i)},this._className=function(){return ps.CHAR}},ps.INT16=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt16(e,i)},this._read=function(t,e,i){return t.readInt16(e,!0,i)},this._className=function(){return ps.SHORT}},ps.INT32=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)},this._className=function(){return ps.INT32}},ps.INT64=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt64(e,i)},this._read=function(t,e,i){return t.readInt64(e,!0,i)},this._className=function(){return ps.INT64}},ps.UINT8=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt16(e,i)},this._read=function(t,e,i){return t.readInt16(e,!0,i)},this._className=function(){return ps.SHORT}},ps.UInt16=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)},this._className=function(){return ps.INT32}},ps.UInt32=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt64(e,i)},this._read=function(t,e,i){return t.readInt64(e,!0,i)},this._className=function(){return ps.INT64}},ps.Float=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeFloat(e,i)},this._read=function(t,e,i){return t.readFloat(e,!0,i)},this._className=function(){return ps.FLOAT}},ps.Double=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeDouble(e,i)},this._read=function(t,e,i){return t.readDouble(e,!0,i)},this._className=function(){return ps.DOUBLE}},ps.STRING=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeString(e,i)},this._read=function(t,e,i){return t.readString(e,!0,i)},this._className=function(){return ps.STRING}},ps.BOOLEAN=function(){this._clone=function(){return!1},this._write=function(t,e,i){return t.writeBoolean(e,i)},this._read=function(t,e,i){return t.readBoolean(e,!0,i)},this._className=function(){return ps.BOOLEAN}},ps.ENUM=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)}},ps.Vector=function(t){this.proto=t,this.value=new Array},ps.Vector.prototype._clone=function(){return new ps.Vector(this.proto)},ps.Vector.prototype._write=function(t,e,i){return t.writeVector(e,i)},ps.Vector.prototype._read=function(t,e,i){return t.readVector(e,!0,i)},ps.Vector.prototype._className=function(){return ps.TypeHelp.VECTOR.replace("$t",this.proto._className())},ps.Map=function(t,e){this.kproto=t,this.vproto=e,this.value=new Object},ps.Map.prototype._clone=function(){return new ps.Map(this.kproto,this.vproto)},ps.Map.prototype._write=function(t,e,i){return t.writeMap(e,i)},ps.Map.prototype._read=function(t,e,i){return t.readMap(e,!0,i)},ps.Map.prototype.put=function(t,e){this.value[t]=e},ps.Map.prototype.get=function(t){return this.value[t]},ps.Map.prototype.getKeys=function(){var t=[];for(var e in this.value)""!=e&&t.push(e);return t},ps.Map.prototype.hasKey=function(t){return this.value.hasOwnProperty(t)},ps.Map.prototype.remove=function(t){delete this.value[t]},ps.Map.prototype.clear=function(){this.value=new Object},ps.Map.prototype.size=function(){var t=0;for(var e in this.value)t++;return t},ps.Vector.prototype._className=function(){return ps.TypeHelp.Map.replace("$k",this.kproto._className()).replace("$v",this.vproto._className())},ps.DataHelp={EN_INT8:0,EN_INT16:1,EN_INT32:2,EN_INT64:3,EN_FLOAT:4,EN_DOUBLE:5,EN_STRING1:6,EN_STRING4:7,EN_MAP:8,EN_LIST:9,EN_STRUCTBEGIN:10,EN_STRUCTEND:11,EN_ZERO:12,EN_SIMPLELIST:13},ps.TypeHelp={BOOLEAN:"bool",CHAR:"char",SHORT:"short",INT32:"int32",INT64:"int64",FLOAT:"float",DOUBLE:"double",STRING:"string",VECTOR:"list<$t>",MAP:"map<$k, $v>"},ps.BinBuffer=function(t){this.buf=null,this.vew=null,this.len=0,this.position=0,null!=t&&null!=t&&(t instanceof ArrayBuffer?(this.buf=t,this.vew=new DataView(this.buf),this.len=this.vew.byteLength,this.position=0):(this.buf=t.buf,this.vew=new DataView(this.buf),this.len=t.length,this.position=t.position)),this.__defineGetter__("length",(function(){return this.len})),this.__defineGetter__("buffer",(function(){return this.buf}))},ps.BinBuffer.prototype._write=function(t,e,i){return t.writeBytes(e,i)},ps.BinBuffer.prototype._read=function(t,e,i){return t.readBytes(e,!0,i)},ps.BinBuffer.prototype._clone=function(){return new ps.BinBuffer},ps.BinBuffer.prototype.allocate=function(t){if(t=this.position+t,!(null!=this.buf&&this.buf.length>t)){var e=new ArrayBuffer(Math.max(256,2*t));null!=this.buf&&(new Uint8Array(e).set(new Uint8Array(this.buf)),this.buf=void 0),this.buf=e,this.vew=void 0,this.vew=new DataView(this.buf)}},ps.BinBuffer.prototype.getBuffer=function(){var t=new ArrayBuffer(this.len);return new Uint8Array(t).set(new Uint8Array(this.buf,0,this.len)),t},ps.BinBuffer.prototype.memset=function(t,e,i){this.allocate(i),new Uint8Array(this.buf).set(new Uint8Array(t,e,i),this.position)},ps.BinBuffer.prototype.writeInt8=function(t){this.allocate(1),this.vew.setInt8(this.position,t),this.position+=1,this.len=this.position},ps.BinBuffer.prototype.writeUInt8=function(t){this.allocate(1),this.vew.setUint8(this.position++,t),this.len=this.position},ps.BinBuffer.prototype.writeInt16=function(t){this.allocate(2),this.vew.setInt16(this.position,t),this.position+=2,this.len=this.position},ps.BinBuffer.prototype.writeUInt16=function(t){this.allocate(2),this.vew.setUint16(this.position,t),this.position+=2,this.len=this.position},ps.BinBuffer.prototype.writeInt32=function(t){this.allocate(4),this.vew.setInt32(this.position,t),this.position+=4,this.len=this.position},ps.BinBuffer.prototype.writeUInt32=function(t){this.allocate(4),this.vew.setUint32(this.position,t),this.position+=4,this.len=this.position},ps.BinBuffer.prototype.writeInt64=function(t){this.allocate(8),this.vew.setUint32(this.position,parseInt(t/4294967296)),this.vew.setUint32(this.position+4,t%4294967296),this.position+=8,this.len=this.position},ps.BinBuffer.prototype.writeFloat=function(t){this.allocate(4),this.vew.setFloat32(this.position,t),this.position+=4,this.len=this.position},ps.BinBuffer.prototype.writeDouble=function(t){this.allocate(8),this.vew.setFloat64(this.position,t),this.position+=8,this.len=this.position},ps.BinBuffer.prototype.writeString=function(t){for(var e=[],i=0;i<t.length;i++)e.push(255&t.charCodeAt(i));this.allocate(e.length),new Uint8Array(this.buf).set(new Uint8Array(e),this.position),this.position+=e.length,this.len=this.position},ps.BinBuffer.prototype.writeBytes=function(t){0!=t.length&&null!=t.buf&&(this.allocate(t.length),new Uint8Array(this.buf).set(new Uint8Array(t.buf,0,t.length),this.position),this.position+=t.length,this.len=this.position)},ps.BinBuffer.prototype.readInt8=function(){return this.vew.getInt8(this.position++)},ps.BinBuffer.prototype.readInt16=function(){return this.position+=2,this.vew.getInt16(this.position-2)},ps.BinBuffer.prototype.readInt32=function(){return this.position+=4,this.vew.getInt32(this.position-4)},ps.BinBuffer.prototype.readUInt8=function(){return this.position+=1,this.vew.getUint8(this.position-1)},ps.BinBuffer.prototype.readUInt16=function(){return this.position+=2,this.vew.getUint16(this.position-2)},ps.BinBuffer.prototype.readUInt32=function(){return this.position+=4,this.vew.getUint32(this.position-4)},ps.BinBuffer.prototype.readInt64=function(){var t=this.vew.getUint32(this.position),e=this.vew.getUint32(this.position+4);return this.position+=8,4294967296*t+e},ps.BinBuffer.prototype.readFloat=function(){var t=this.vew.getFloat32(this.position);return this.position+=4,t},ps.BinBuffer.prototype.readDouble=function(){var t=this.vew.getFloat64(this.position);return this.position+=8,t},ps.BinBuffer.prototype.readString=function(t){for(var e=[],i=0;i<t;i++)e.push(String.fromCharCode(this.vew.getUint8(this.position++)));var s=e.join("");try{s=decodeURIComponent(escape(s))}catch(t){}return s},ps.BinBuffer.prototype.readBytes=function(t){var e=new ps.BinBuffer;return e.allocate(t),e.memset(this.buf,this.position,t),e.position=0,e.len=t,this.position=this.position+t,e},ps.JceOutputStream=function(){this.buf=new ps.BinBuffer,this.getBinBuffer=function(){return this.buf},this.getBuffer=function(){return this.buf.getBuffer()}},ps.JceOutputStream.prototype.clear=function(){return this.buf=new ps.BinBuffer,this},ps.JceOutputStream.prototype.writeTo=function(t,e){t<15?this.buf.writeUInt8(t<<4&240|e):this.buf.writeUInt16((240|e)<<8|t)},ps.JceOutputStream.prototype.writeBoolean=function(t,e){this.writeInt8(t,1==e?1:0)},ps.JceOutputStream.prototype.writeInt8=function(t,e){0==e?this.writeTo(t,ps.DataHelp.EN_ZERO):(this.writeTo(t,ps.DataHelp.EN_INT8),this.buf.writeInt8(e))},ps.JceOutputStream.prototype.writeInt16=function(t,e){e>=-128&&e<=127?this.writeInt8(t,e):(this.writeTo(t,ps.DataHelp.EN_INT16),this.buf.writeInt16(e))},ps.JceOutputStream.prototype.writeInt32=function(t,e){e>=-32768&&e<=32767?this.writeInt16(t,e):(this.writeTo(t,ps.DataHelp.EN_INT32),this.buf.writeInt32(e))},ps.JceOutputStream.prototype.writeInt64=function(t,e){e>=-2147483648&&e<=2147483647?this.writeInt32(t,e):(this.writeTo(t,ps.DataHelp.EN_INT64),this.buf.writeInt64(e))},ps.JceOutputStream.prototype.writeUInt8=function(t,e){this.writeInt16(t,e)},ps.JceOutputStream.prototype.writeUInt16=function(t,e){this.writeInt32(t,e)},ps.JceOutputStream.prototype.writeUInt32=function(t,e){this.writeInt64(t,e)},ps.JceOutputStream.prototype.writeFloat=function(t,e){0==e?this.writeTo(t,ps.DataHelp.EN_ZERO):(this.writeTo(t,ps.DataHelp.EN_FLOAT),this.buf.writeFloat(e))},ps.JceOutputStream.prototype.writeDouble=function(t,e){0==e?this.writeTo(t,ps.DataHelp.EN_ZERO):(this.writeTo(t,ps.DataHelp.EN_DOUBLE),this.buf.writeDouble(e))},ps.JceOutputStream.prototype.writeStruct=function(t,e){if(null==e.writeTo)throw Error("not defined writeTo Function");this.writeTo(t,ps.DataHelp.EN_STRUCTBEGIN),e.writeTo(this),this.writeTo(0,ps.DataHelp.EN_STRUCTEND)},ps.JceOutputStream.prototype.writeString=function(t,e){var i=e;try{i=unescape(encodeURIComponent(i))}catch(t){}i.length>255?(this.writeTo(t,ps.DataHelp.EN_STRING4),this.buf.writeUInt32(i.length)):(this.writeTo(t,ps.DataHelp.EN_STRING1),this.buf.writeUInt8(i.length)),this.buf.writeString(i)},ps.JceOutputStream.prototype.writeBytes=function(t,e){this.writeTo(t,ps.DataHelp.EN_SIMPLELIST),this.writeTo(0,ps.DataHelp.EN_INT8),this.writeInt32(0,e.length),this.buf.writeBytes(e)},ps.JceOutputStream.prototype.writeVector=function(t,e){this.writeTo(t,ps.DataHelp.EN_LIST),this.writeInt32(0,e.value.length);for(var i=0;i<e.value.length;i++)e.proto._write(this,0,e.value[i])},ps.JceOutputStream.prototype.writeMap=function(t,e){for(var i in this.writeTo(t,ps.DataHelp.EN_MAP),this.writeInt32(0,e.size()),e.value)e.kproto._write(this,0,i),e.vproto._write(this,1,e.value[i])},ps.JceInputStream=function(t){this.buf=new ps.BinBuffer(t)},ps.JceInputStream.prototype.setBuffer=function(t){return this.buf=new ps.BinBuffer(t),this},ps.JceInputStream.prototype.readFrom=function(){var t=this.buf.readUInt8(),e=(240&t)>>4,i=15&t;return e>=15&&(e=this.buf.readUInt8()),{tag:e,type:i}},ps.JceInputStream.prototype.peekFrom=function(){var t=this.buf.position,e=this.readFrom();return this.buf.position=t,{tag:e.tag,type:e.type,size:e.tag>=15?2:1}},ps.JceInputStream.prototype.skipField=function(t){switch(t){case ps.DataHelp.EN_INT8:this.buf.position+=1;break;case ps.DataHelp.EN_INT16:this.buf.position+=2;break;case ps.DataHelp.EN_INT32:this.buf.position+=4;break;case ps.DataHelp.EN_INT64:this.buf.position+=8;break;case ps.DataHelp.EN_STRING1:var e=this.buf.readUInt8();this.buf.position+=e;break;case ps.DataHelp.EN_STRING4:var i=this.buf.readInt32();this.buf.position+=i;break;case ps.DataHelp.EN_STRUCTBEGIN:this.skipToStructEnd();break;case ps.DataHelp.EN_STRUCTEND:case ps.DataHelp.EN_ZERO:break;case ps.DataHelp.EN_MAP:for(var s=this.readInt32(0,!0),r=0;r<2*s;++r){var n=this.readFrom();this.skipField(n.type)}break;case ps.DataHelp.EN_SIMPLELIST:if((n=this.readFrom()).type!=ps.DataHelp.EN_INT8)throw Error("skipField with invalid type, type value: "+t+","+n.type);e=this.readInt32(0,!0),this.buf.position+=e;break;case ps.DataHelp.EN_LIST:for(s=this.readInt32(0,!0),r=0;r<s;++r)n=this.readFrom(),this.skipField(n.type);break;default:throw new Error("skipField with invalid type, type value: "+t)}},ps.JceInputStream.prototype.skipToStructEnd=function(){for(;;){var t=this.readFrom();if(this.skipField(t.type),t.type==ps.DataHelp.EN_STRUCTEND)return}},ps.JceInputStream.prototype.skipToTag=function(t,e){for(;this.buf.position<this.buf.length;){var i=this.peekFrom();if(t<=i.tag||i.type==ps.DataHelp.EN_STRUCTEND)return i.type!=ps.DataHelp.EN_STRUCTEND&&t==i.tag;this.buf.position+=i.size,this.skipField(i.type)}if(e)throw Error("require field not exist, tag:"+t);return!1},ps.JceInputStream.prototype.readBoolean=function(t,e,i){return 1==this.readInt8(t,e,i)},ps.JceInputStream.prototype.readInt8=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();switch(s.type){case ps.DataHelp.EN_ZERO:return 0;case ps.DataHelp.EN_INT8:return this.buf.readInt8()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+s.type)},ps.JceInputStream.prototype.readInt16=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();switch(s.type){case ps.DataHelp.EN_ZERO:return 0;case ps.DataHelp.EN_INT8:return this.buf.readInt8();case ps.DataHelp.EN_INT16:return this.buf.readInt16()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+s.type)},ps.JceInputStream.prototype.readInt32=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();switch(s.type){case ps.DataHelp.EN_ZERO:return 0;case ps.DataHelp.EN_INT8:return this.buf.readInt8();case ps.DataHelp.EN_INT16:return this.buf.readInt16();case ps.DataHelp.EN_INT32:return this.buf.readInt32()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+s.type)},ps.JceInputStream.prototype.readInt64=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case ps.DataHelp.EN_ZERO:return 0;case ps.DataHelp.EN_INT8:return this.buf.readInt8();case ps.DataHelp.EN_INT16:return this.buf.readInt16();case ps.DataHelp.EN_INT32:return this.buf.readInt32();case ps.DataHelp.EN_INT64:return this.buf.readInt64()}throw Error("read int64 type mismatch, tag:"+t+", get type:"+h.type)},ps.JceInputStream.prototype.readFloat=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case ps.DataHelp.EN_ZERO:return 0;case ps.DataHelp.EN_FLOAT:return this.buf.readFloat()}throw Error("read float type mismatch, tag:"+t+", get type:"+h.type)},ps.JceInputStream.prototype.readDouble=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case ps.DataHelp.EN_ZERO:return 0;case ps.DataHelp.EN_DOUBLE:return this.buf.readDouble()}throw Error("read double type mismatch, tag:"+t+", get type:"+h.type)},ps.JceInputStream.prototype.readUInt8=function(t,e,i){return this.readInt16(t,e,i)},ps.JceInputStream.prototype.readUInt16=function(t,e,i){return this.readInt32(t,e,i)},ps.JceInputStream.prototype.readUInt32=function(t,e,i){return this.readInt64(t,e,i)},ps.JceInputStream.prototype.readStruct=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();if(s.type!=ps.DataHelp.EN_STRUCTBEGIN)throw Error("read struct type mismatch, tag: "+t+", get type:"+s.type);return i.readFrom(this),this.skipToStructEnd(),i},ps.JceInputStream.prototype.readString=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();if(s.type==ps.DataHelp.EN_STRING1)return this.buf.readString(this.buf.readUInt8());if(s.type==ps.DataHelp.EN_STRING4)return this.buf.readString(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+t+", get type: "+s.type+".")},ps.JceInputStream.prototype.readString2=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();if(s.type==ps.DataHelp.EN_STRING1)return this.buf.readBytes(this.buf.readUInt8());if(s.type==ps.DataHelp.EN_STRING4)return this.buf.readBytes(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+t+", get type: "+s.type+".")},ps.JceInputStream.prototype.readBytes=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();if(s.type==ps.DataHelp.EN_SIMPLELIST){var r=this.readFrom();if(r.type!=ps.DataHelp.EN_INT8)throw Error("type mismatch, tag:"+t+",type:"+s.type+","+r.type);if((n=this.readInt32(0,!0))<0)throw Error("invalid size, tag:"+t+",type:"+s.type+","+r.type);return this.buf.readBytes(n)}if(s.type==ps.DataHelp.EN_LIST){var n=this.readInt32(0,!0);return this.buf.readBytes(n)}throw Error("type mismatch, tag:"+t+",type:"+s.type)},ps.JceInputStream.prototype.readVector=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();if(s.type!=ps.DataHelp.EN_LIST)throw Error("read 'vector' type mismatch, tag: "+t+", get type: "+s.type);var r=this.readInt32(0,!0);if(r<0)throw Error("invalid size, tag: "+t+", type: "+s.type+", size: "+r);for(var n=0;n<r;++n)i.value.push(i.proto._read(this,0,i.proto._clone()));return i},ps.JceInputStream.prototype.readMap=function(t,e,i){if(0==this.skipToTag(t,e))return i;var s=this.readFrom();if(s.type!=ps.DataHelp.EN_MAP)throw Error("read 'map' type mismatch, tag: "+t+", get type: "+s.type);var r=this.readInt32(0,!0);if(r<0)throw Error("invalid map, tag: "+t+", size: "+r);for(var n=0;n<r;n++){var a=i.kproto._read(this,0,i.kproto._clone()),o=i.vproto._read(this,1,i.vproto._clone());i.put(a,o)}return i},ps.Wup=function(){this.iVersion=3,this.cPacketType=0,this.iMessageType=0,this.iRequestId=0,this.sServantName="",this.sFuncName="",this.sBuffer=new ps.BinBuffer,this.iTimeout=0,this.context=new ps.Map(new ps.STRING,new ps.STRING),this.status=new ps.Map(new ps.STRING,new ps.STRING),this.data=new ps.Map(new ps.STRING,new ps.Map(new ps.STRING,new ps.BinBuffer)),this.newdata=new ps.Map(new ps.STRING,new ps.BinBuffer),this.iStream=new ps.JceInputStream,this.oStream=new ps.JceOutputStream},ps.Wup.prototype.hasKey=function(t){return this.newdata.hasKey(t)},ps.Wup.prototype.setVersion=function(t){this.iVersion=t},ps.Wup.prototype.getVersion=function(t){return this.iVersion},ps.Wup.prototype.setServant=function(t){this.sServantName=t},ps.Wup.prototype.setFunc=function(t){this.sFuncName=t},ps.Wup.prototype.setRequestId=function(t){this.iRequestId=t||++this.iRequestId},ps.Wup.prototype.getRequestId=function(){return this.iRequestId},ps.Wup.prototype.setTimeOut=function(t){this.iTimeout=t},ps.Wup.prototype.getTimeOut=function(){return this.iTimeout},ps.Wup.prototype.writeTo=function(){var t=this.oStream.clear();return t.writeInt16(1,this.iVersion),t.writeInt8(2,this.cPacketType),t.writeInt32(3,this.iMessageType),t.writeInt32(4,this.iRequestId),t.writeString(5,this.sServantName),t.writeString(6,this.sFuncName),t.writeBytes(7,this.sBuffer),t.writeInt32(8,this.iTimeout),t.writeMap(9,this.context),t.writeMap(10,this.status),new ps.BinBuffer(t.getBuffer())},ps.Wup.prototype.encode=function(){var t=this.oStream.clear();3==this.iVersion?t.writeMap(0,this.newdata):t.writeMap(0,this.data),this.sBuffer=t.getBinBuffer();var e=this.writeTo(),i=new ps.BinBuffer;return i.writeInt32(4+e.len),i.writeBytes(e),i},ps.Wup.prototype.writeBoolean=function(t,e){var i=this.oStream.clear();if(i.writeBoolean(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=TAF.TypeHelp.BOOLEAN;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new ps.BinBuffer(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeInt8=function(t,e){var i=this.oStream.clear();if(i.writeInt8(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=TAF.TypeHelp.CHAR;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new ps.BinBuffer(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeInt16=function(t,e){var i=this.oStream.clear();if(i.writeInt16(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=TAF.TypeHelp.SHORT;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeInt32=function(t,e){var i=this.oStream.clear();if(i.writeInt32(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=TAF.TypeHelp.INT32;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeInt64=function(t,e){var i=this.oStream.clear();if(i.writeInt64(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=TAF.TypeHelp.INT64;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeFloat=function(t,e){var i=this.oStream.clear();if(i.writeFloat(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=TAF.TypeHelp.FLOAT;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeDouble=function(t,e){var i=this.oStream.clear();if(i.writeDouble(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=TAF.TypeHelp.DOUBLE;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeString=function(t,e){var i=this.oStream.clear();if(i.writeString(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=ps.TypeHelp.STRING;null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeVector=function(t,e){var i=this.oStream.clear();if(i.writeVector(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBinBuffer()));else{var s=this.data.get(t),r=e._className();null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeStruct=function(t,e){var i=this.oStream.clear();if(i.writeStruct(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t);null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(" ",new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeBytes=function(t,e){var i=this.oStream.clear();if(i.writeBytes(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t);null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put("vec",new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.writeMap=function(t,e){var i=this.oStream.clear();if(i.writeMap(0,e),3==this.iVersion)this.newdata.put(t,new ps.BinBuffer(i.getBuffer()));else{var s=this.data.get(t),r=ps.Util.getClassType(e);null==s&&(s=new ps.Map(ps.STRING,ps.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(t,s)}},ps.Wup.prototype.readFrom=function(t){this.iVersion=t.readInt16(1,!0),this.cPacketType=t.readInt8(2,!0),this.iMessageType=t.readInt32(3,!0),this.iRequestId=t.readInt32(4,!0),this.sServantName=t.readString(5,!0),this.sFuncName=t.readString(6,!0),localStorage.__wup&&console.info("%c@@@ "+this.sServantName+"."+this.sFuncName,"color:white;background:black;",this),this.sBuffer=t.readBytes(7,!0),this.iTimeout=t.readInt32(8,!0),this.context=t.readMap(9,!0,this.context),this.status=t.readMap(10,!0,this.status)},ps.Wup.prototype.decode=function(t){var e=this.iStream.setBuffer(t);if(e.buf.vew.getInt32(e.buf.position)<4)throw Error("packet length too short");e.buf.position+=4,this.readFrom(e),e=this.iStream.setBuffer(this.sBuffer.getBuffer()),3==this.iVersion?(this.newdata.clear(),e.readMap(0,!0,this.newdata)):(this.data.clear(),e.readMap(0,!0,this.data))},ps.Wup.prototype.readBoolean=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readBoolean(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var s=ps.TypeHelp.BOOLEAN,r=e.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readBoolean(0,!0,i)}return i},ps.Wup.prototype.readInt8=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt8(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var s=ps.TypeHelp.CHAR,r=e.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readInt8(0,!0,i)}return i},ps.Wup.prototype.readInt16=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=(n=this.iStream.setBuffer(e.buffer)).readInt16(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var s=ps.TypeHelp.SHORT,r=e.get(s),n=this.iStream.setBuffer(r);if(null==r)throw Error("UniAttribute not found type:"+s);i=n.readInt16(0,!0,i)}return i},ps.Wup.prototype.readInt32=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt32(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var s=ps.TypeHelp.INT32,r=e.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readInt32(0,!0,i)}return i},ps.Wup.prototype.readInt64=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt64(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var s=ps.TypeHelp.INT64,r=e.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readInt64(0,!0,i)}return i},ps.Wup.prototype.readFloat=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readFloat(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var s=ps.TypeHelp.FLOAT,r=e.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readFloat(0,!0,i)}return i},ps.Wup.prototype.readDouble=function(t){var e;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);var i=this.iStream.setBuffer(e.buffer);def=i.readDouble(0,!0,def)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var s=ps.TypeHelp.DOUBLE,r=e.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r),def=i.readDouble(0,!0,def)}return def},ps.Wup.prototype.readVector=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readVector(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readVector(0,!0,e)}return e},ps.Wup.prototype.readStruct=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readStruct(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readStruct(0,!0,e)}return e},ps.Wup.prototype.readMap=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readMap(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readMap(0,!0,e)}return e},ps.Wup.prototype.readBytes=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readBytes(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readBytes(0,!0,e)}return e},ps.Util=ps.Util||{},ps.Util.jcestream=function(t,e){if(null!=t&&null!=t)if(t instanceof ArrayBuffer){e=e||16;for(var i=new Uint8Array(t),s="",r=0;r<i.length;r++)0!=r&&r%e==0?s+="\n":0!=r&&(s+=" "),s+=(i[r]>15?"":"0")+i[r].toString(16);console.log(s.toUpperCase())}else console.log("Taf.Util.jcestream::value is not ArrayBuffer");else console.log("Taf.Util.jcestream::value is null or undefined")},ps.Util.str2ab=function(t){var e,i=t.length,s=new Array(i);for(e=0;e<i;++e)s[e]=t.charCodeAt(e);return new Uint8Array(s).buffer},ps.Util.ajax=function(t,e,i,s){var r=new XMLHttpRequest;r.overrideMimeType("text/plain; charset=x-user-defined"),r.addEventListener("readystatechange",(function t(){4===r.readyState&&(200===r.status||304===r.status?i(ps.Util.str2ab(r.response)):s(r.status),r.removeEventListener("readystatechange",t),r=void 0)})),r.open("post",t),r.send(e)};var _s=function(t){Object(b.a)(i,t);var e=Object(C.a)(i);function i(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Object(s.a)(this,i),(r=e.call(this,n)).duration=t,r.lastTs=0,r}return Object(r.a)(i,[{key:"addCur",value:function(t,e){P(Object(E.a)(i.prototype),"addCur",this).call(this,t,e),this.samples.addCur(t),this.calculate(e)}},{key:"calculate",value:function(t){0===this.lastTs?this.lastTs=t:t-this.lastTs>=this.duration&&(this.lastTs=t,this.samples.calculate())}},{key:"onCheckFastTimer",value:function(t,e){this.calculate(t)}}]),i}(St),ms=function(){function t(){Object(s.a)(this,t),this.recvTotalSample=new _s(1e3),this.recvLanSample=new _s(1e3),this.realFlacSample=new gt}return Object(r.a)(t,[{key:"start",value:function(){A.a.add(this.onCheckFastTimer,this,100)}},{key:"stop",value:function(){A.a.remove(this.onCheckFastTimer,this)}},{key:"onCheckFastTimer",value:function(t,e){this.recvTotalSample.onCheckFastTimer(t,e),this.recvLanSample.onCheckFastTimer(t,e)}},{key:"addTotalSample",value:function(t){this.recvTotalSample.addCur(t,c.a.now())}},{key:"recordStat",value:function(t,e){this._recordStat(t,l.a.CORE.RECV_TOTAL_SAMPLE,this.recvTotalSample,!0,e),this._recordStat(t,l.a.CORE.RECV_LAN_SAMPLE,this.recvLanSample,!0,e),this._recordStat(t,l.a.CORE.REAL_FLAC_KBPS_SAMPLE,this.realFlacSample)}},{key:"_recordStat",value:function(t,e,i,s,r){if(i.hasSample){var n=i.getResult();""!==n&&(i.reset(),s?t.setCoreDim(e,"type:".concat(r?2:t.heart_type,",").concat(n)):t.setCoreDim(e,n))}}},{key:"addLanSample",value:function(t){this.recvLanSample.addCur(t,c.a.now())}}]),t}(),ys="force_auto_count",vs="force_auto_effective_time",Ss=localStorage,gs=function(){function t(e,i){Object(s.a)(this,t),this._abConfig=i,this._forceCnt=0,this._sysForceCnt=0,this._effectiveTime=0,this._sysEffectiveTime=0,this._isInit=!1,this._closed=!1,e.on(n.c.AUTO_FORCE_RSP,this.onAutoForceRsp.bind(this))}return Object(r.a)(t,[{key:"_init",value:function(){if(!this._isInit)if(this._isInit=!0,this._sysEffectiveTime>0?this._effectiveTime=this._sysEffectiveTime:this._effectiveTime=Number(a.a.force_auto_effective_time),this._sysForceCnt>0)this._forceCnt=this._sysForceCnt,u.a.log("AutoForce._init useSys");else{this._forceCnt=Number(a.a.force_auto_count);var t=[],e=this._abConfig.getConfig("quitAutoCount");null!==e&&(this._forceCnt=Number(e),t.push("_forceCnt=".concat(this._forceCnt)));var i=this._abConfig.getConfig("isWebAutoABBBB");null!==i&&(this._closed=1===i,t.push("isWebAutoAB=".concat(i))),u.a.log("AutoForce._init ".concat(t.join(" ")))}}},{key:"onAutoForceRsp",value:function(t,e){var i=e.force_auto_count,s=e.force_auto_effective_time;u.a.log("AutoForce.onAutoForceRsp force_auto_count=".concat(i," force_auto_effective_time=").concat(s)),this._forceCnt=this._sysForceCnt=i,this._effectiveTime=this._sysEffectiveTime=1e3*s,this._checkEffective()}},{key:"addForce",value:function(){var t=Number(Ss.getItem(ys))||0;Ss.setItem(ys,t+1),u.a.log("AutoForce.addForce forceCnt=".concat(t+1)),this._checkEffective()}},{key:"_checkEffective",value:function(){(Number(Ss.getItem(ys))||0)>=this._forceCnt&&!Ss.hasOwnProperty(vs)&&(Ss.setItem(vs,Date.now()+this._effectiveTime),u.a.log("AutoForce._checkEffective cooling"))}},{key:"getUseAuto",value:function(){if(this._init(),this._closed)return!1;if(Ss.hasOwnProperty(vs)){var t=Number(Ss.getItem(vs));if(Date.now()<t)return u.a.log("AutoForce.getUseAuto cooling!"),!1;Ss.removeItem(ys),Ss.removeItem(vs)}var e=Number(Ss.getItem(ys))||0;return u.a.log("AutoForce.getUseAuto forceCnt=".concat(e," _forceCnt=").concat(this._forceCnt)),e<this._forceCnt}}]),t}(),Ts=localStorage,ws=function(){function t(){Object(s.a)(this,t),this._isInit=!1,this._mpConfig=null}return Object(r.a)(t,[{key:"_init",value:function(){if(!this._isInit){u.a.log("AbConfigParser._init",Ts.abConfig),this._isInit=!0;try{var t=JSON.parse(Ts.abConfig);t&&t.mpConfig&&(this._mpConfig=t.mpConfig)}catch(t){u.a.log("AbConfigParser._init ".concat(t.message))}}}},{key:"getConfig",value:function(t){return this._init(),this._mpConfig&&this._mpConfig.hasOwnProperty(t)?this._mpConfig[t]:null}}]),t}(),Is=function(){function t(e,i,r){Object(s.a)(this,t),this.tsdb=e,this.stat=i,this.autoMonitor=null,this.recSysStat=null,this.autoForce=null,this.lineType=-1,this.curBitrate=-1,this.isAuto=!1,this.handler=r}return Object(r.a)(t,[{key:"init",value:function(t,e,i){this.autoMonitor=t,this.recSysStat=e,this.autoForce=i}},{key:"check",value:function(t,e){if(!isNaN(t.lineType)&&!isNaN(t.curBitrate)&&-1!==t.lineType){if(-1!==this.lineType){var i=null;if(this.lineType!==t.lineType)i=this.stat.createAct(l.a.ACT.SWITCH_LINE,{value:[this.lineType,t.lineType]});else{var s=1e3*t.curBitrate,r=1e3*this.curBitrate,n=this.isAuto?1:0,a=0;e?this.curBitrate!==t.curBitrate&&(a=2):t&&1==t.pullStreamFrom&&(a=1);var o=[s,r,n,a,0,0,1,t.bitrateList?t.bitrateList.length:0];1==a&&this.handler&&(o[8]=c.a.now()-this.handler.inRoomTimeNow),1===n&&(this.recSysStat.recordAct(this.stat),1===a&&(this.autoForce.addForce(),this.recSysStat.removeItem(1))),this.autoMonitor.addSwitch(c.a.now(),s,r,a),i=this.stat.createAct(l.a.ACT.SWITCH_BITRATE,{value:o}),u.a.log("StatSwitch.reportSwitchBitrate value4=".concat(a," metric="),i)}i&&this.tsdb.sendMetrics([i])}this.lineType=t.lineType,this.curBitrate=t.curBitrate,this.isAuto=t.isAuto}}},{key:"sendSwitchAuto",value:function(t){t[0]===Ut?this.stat.addComp(l.a.AUTO_INFO.name,l.a.AUTO_INFO.UP_CNT,1):t[0]===Ft?this.stat.addComp(l.a.AUTO_INFO.name,l.a.AUTO_INFO.DOWN_CNT,1):t[0]===Mt&&this.stat.addComp(l.a.AUTO_INFO.name,l.a.AUTO_INFO.BACK_CNT,1);var e=this.stat.createAct(l.a.ACT.SWITCH_AUTO,{value:t});this.tsdb.sendMetrics([e])}},{key:"sendSwitchCost",value:function(t,e){this._sendMetric(l.a.ACT.SWITCH_COST,t,e)}},{key:"sendSwitchPts",value:function(t,e){this._sendMetric(l.a.ACT.SWITCH_PTS,t,e)}},{key:"_sendMetric",value:function(t,e,i){var s=this.stat.createAct(t,{value:e,str:i});this.tsdb.sendMetrics([s])}}]),t}(),Es=i(21),Ps=i.n(Es),bs=function(){function t(e,i){Object(s.a)(this,t),this.stat=e,this.tsdb=i,this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.costUs=0,this.isCodecSupport=!1,this.isBrowserSupport=!1,this.isCfgSupport=!1}return Object(r.a)(t,[{key:"onTurntoH264",value:function(t){2===t?this.isP2PUseH265=!1:1===t&&(this.isFlvUseH265=!1)}},{key:"init",value:function(t){this.isCodecSupport=!1,this.isBrowserSupport=!1,this.isCfgSupport=!1,this._initCodec(t),this._initBrowser(),this._initRandom(t),this._initCfg(),u.a.log("H265Support.init isCodecSupport=".concat(this.isCodecSupport," isBrowserSupport=").concat(this.isBrowserSupport," isCfgSupport=").concat(this.isCfgSupport))}},{key:"_initCodec",value:function(t){var e=arguments;if(1==localStorage.open265&&(localStorage.w265LastCost=0),this.isReport265||5===t.type||(this.tsdb.sendMetrics([this.stat.createAct(l.a.ACT.H265_STATUS,{value:[10],str:[v.b.is64bitSoftware()?1:2]})]),this.tsdb.sendMetrics([this.stat.createAct(l.a.ACT.H265_STATUS,{value:[5],str:[navigator.hardwareConcurrency]})]),u.a.log("HYPlayer.initH265 support hardwareConcurrency hardwareConcurrency=",navigator.hardwareConcurrency),this.isReport265=!0),this._isSupported(t)&&Ps.a&&Ps.a.getInstance){var i={enableWebH265:1,baseCostUs:{2e3:32e3,4e3:3e4},loopCount:100,singleThreadBitKbps:[10],multiThreadBitKbps:[4e3,2e3,500],threadCount:2,degrade:0,statIntervalMs:1e3,fmt:11,share:0,wasmLoad:500,core:{2e3:3,4e3:4},x86:{4e3:1}},s={};v.b.is64bitSoftware()||(a.a.h265Config[3][1][1]=a.a.h265Config2[0]),1==Number(a.a.h265Config2[1])?i.x86={4e3:1}:i.x86={4e3:0},a.a.h265Config[0][0].forEach((function(t,e){s[t]=a.a.h265Config[0][1][e]})),i.baseCostUs=s,i.multiThreadBitKbps=a.a.h265Config[1];var r={};a.a.h265Config[3][0].forEach((function(t,e){r[t]=a.a.h265Config[3][1][e]})),i.core=r,1===Number(localStorage._enable4000Bitrate)&&(i.multiThreadBitKbps=[4e3,2e3,500],i.core=2),Ps.a.getInstance().parseConfigs(i);var n=Ps.a.getInstance().isSupportH265(0===t.originalBitrate?0:t.curBitrate),o=window.screen.height;1!=a.a.isH265Filter4MCfg[0]||4e3!=t.curBitrate||v.b.isGameIdSupport265(a.a.h265GameIds,t.gameId)?1==a.a.isH265Filter4MCfg[1]&&4e3==t.curBitrate&&-1!=navigator.userAgent.indexOf("Macintosh")?(n.isSupport=!1,n.reason=101):1==a.a.isH265Filter4MCfg[2]&&4e3==t.curBitrate&&o<(a.a.isH265Filter4MCfg[3]||1080)&&(n.isSupport=!1,n.reason=102):(n.isSupport=!1,n.reason=100),u.a.log("H265Support.initH265 bitRate",0===t.originalBitrate?0:t.curBitrate,n),this.isCodecSupport=n.isSupport,this.costUs=n.costUs,this.tsdb.sendMetrics([this.stat.createAct(l.a.ACT.H265_STATUS,{value:[2],str:[n.reason]})]),Ps.a.getInstance().setLogCallback((function(){var t=["H265 render setLogCallback"].concat(Array.apply(null,e));u.a.log.apply(u.a,t)}))}}},{key:"_isSupported",value:function(t){var e;return e=t.iIsHEVCSupport>0&&t.iHEVCBitRate>=0||this._isH265(t.iCodecType)&&0===t.iBitRate,1===t.type?this.isFlvUseH265&&e:2===t.type&&this.isP2PUseH265&&e}},{key:"_isH265",value:function(t){return 1===t||4===t||6===t||8===t}},{key:"_initBrowser",value:function(){var t=f.a.version.major,e=!1;f.a.chrome&&t>=a.a.h265Config[2]&&(e=!0),1===Number(localStorage._enableBrowser)&&(e=!0),this.isBrowserSupport=e}},{key:"_initRandom",value:function(t){var e=this._getRandomUse(t);this.isCodecSupport&&(e?this.stat.setComDim("backup_field2",1):(this.isCodecSupport=!1,this.stat.setComDim("backup_field2",2))),t.randomH265=e}},{key:"_getRandomUse",value:function(t){var e=localStorage.h265PresentUid,i=t.presenterUid,s=!0;if(a.a.h265BlackUids.forEach((function(t){i&&t.toString()==i.toString()&&(s=!1)})),!s)return!1;localStorage.randomH265Percent&&e==i||(localStorage.randomH265Percent=a.a.randomH265Percent),1==localStorage.open265?localStorage.randomH265Percent=3e3:2==localStorage.open265&&(localStorage.randomH265Percent=6e3);var r=Number(localStorage.randomH265Percent);return localStorage.h265PresentUid=t.presenterUid,r<a.a.h265PercentConfig}},{key:"_initCfg",value:function(){this.isCfgSupport=1===Number(a.a.isConfigSupportH265)}},{key:"isSupported",get:function(){return this.isCodecSupport&&this.isBrowserSupport&&this.isCfgSupport}},{key:"canPreload",get:function(){return this.isBrowserSupport&&this.isCfgSupport}}]),t}(),Cs=function(){function t(e,i){Object(s.a)(this,t),this._stat=e,this._tsdb=i,this._onMessageBind=this._onMessage.bind(this),this._onErrorBind=this._onError.bind(this),this._startTs=0,this._readyTs=0,this._isReady=!1,this._isTimeout=!1,this._isError=!1,this._decoder=null,this._callbacks=null,this._onMessageCb=null}return Object(r.a)(t,[{key:"terminate",value:function(){u.a.log("H265Decoder.terminate"),this._destroyDecoder(),A.a.remove(this._onTimeout,this),this._callbacks=null,this._onMessageCb=null,this._isReady=!1,this._startTs=0,this._readyTs=0}},{key:"destroy",value:function(){u.a.log("H265Decoder.destroy"),this._stat=null,this._tsdb=null,this.stopDecoder()}},{key:"_destroyDecoder",value:function(){if(this._decoder){this._decoder.onmessage=null,this._decoder.onerror=null,this.stopDecoder();try{this._decoder.terminate()}catch(t){u.a.log("H265Decoder._destroyDecoder",t)}this._decoder=null}}},{key:"stopDecoder",value:function(){this._decoder&&this._decoder.postMessage({t:6})}},{key:"load",value:function(t,e){if(this._callbacks=e,this._decoder)this._callbacks&&this._callbacks.ready();else{var i=f.a.chrome&&f.a.version.major>=91;1==Number(localStorage._unSupportSimd)&&(i=!1),u.a.log("H265Decoder.load"),this._startTs=c.a.now();var s='importScripts("'.concat(t+(i?"decoder.worker.simd.js":"decoder.worker.js"),'")'),r=new Blob([s],{type:"application/javascript"}),n=window.URL.createObjectURL(r),a=new Worker(n);a.onmessage=this._onMessageBind,a.onerror=this._onErrorBind,this._decoder=a,A.a.once(this._onTimeout,this,1e3)}}},{key:"_onMessage",value:function(e){switch(e.data.t){case 0:this._decoder.postMessage({t:1});break;case 2:u.a.log("H265Decoder._onMessage worker isReady!"),A.a.remove(this._onTimeout,this),t.preloaded=!0,this._isReady=!0,this._readyTs=c.a.now();var i=this._readyTs-this._startTs;this._tsdb.sendMetrics([this._stat.createAct(l.a.ACT.H265_WORKER_LOAD_TS,{value:[i]})]),this._isError||this._isTimeout||this._callbacks&&this._callbacks.ready()}this._onMessageCb&&this._onMessageCb(e)}},{key:"_onError",value:function(t){u.a.error("H265Decoder._onError",t),this._tsdb.sendMetrics([this._stat.createAct(l.a.ACT.H265_STATUS,{value:[1],str:[11]})]),this._destroyDecoder(),A.a.remove(this._onTimeout,this),this._readyTs=0,this._isReady=!1,this._isError=!0,localStorage.h265WorkerError=1,this._callbacks&&this._callbacks.error()}},{key:"_onTimeout",value:function(){u.a.log("H265Decoder._onTimeout"),this._destroyDecoder(),this._readyTs=0,this._isTimeout=!0,this._isReady=!1,this._callbacks&&this._callbacks.timeout()}},{key:"onMessageCb",set:function(t){this._onMessageCb=t}},{key:"decoder",get:function(){return this._decoder}},{key:"isReady",get:function(){return this._isReady}}]),t}();Cs.preloaded=!1;var Rs=Cs,As=i(33).default,ks=function(){function t(e,i){Object(s.a)(this,t),this._stat=e,this._tsdb=i,this._support=new bs(e,i),this._decoder=new Rs(e,i),this._render=new As(e,i),this._renderInited=!1,this._rendering=!1}return Object(r.a)(t,[{key:"stop",value:function(){u.a.log("H265Proxy.stop"),this._rendering=!1,this._renderInited=!1,this._decoder.stopDecoder(),this._render&&this._render.destroy&&this._render.destroy()}},{key:"destroy",value:function(){this._render.destroy(),this._support.destroy(),this._decoder.destroy(),this._stat=null,this._tsdb=null,this._render=null,this._support=null,this._decoder=null}},{key:"initSupport",value:function(t){this._support.init(t)}},{key:"loadDecoder",value:function(t,e){this._decoder.load(t,e)}},{key:"initRender",value:function(t){this.isSupported&&(u.a.log("H265Proxy.initRender isSupported=".concat(this._support.isSupported," isReady=").concat(this._decoder.isReady)),this._rendering=!1,this._renderInited=!1,this._render.destroy(),this.isReady&&(this._renderInited=!0,this._render.attachMse(t)))}},{key:"terminate",value:function(){this._decoder.terminate()}},{key:"containerResize",value:function(t){this.rendering&&this._render.containerResize(t)}},{key:"pushVideoFrame",value:function(t,e){this._rendering=!0,this._render&&this._render.pushVideoFrame(t,e)}},{key:"onTurnToH264",value:function(t){this._rendering=!1,this._renderInited=!1,this._support.onTurntoH264(t)}},{key:"checkUrl",value:function(t){this.isReady&&-1===t.url.indexOf("codec=265")&&(t.url+="&codec=265")}},{key:"on265StartCodeError",value:function(t){this._render&&this._render.handlerError(t)}},{key:"reportDecodeRenderTime",value:function(t,e){this._render&&this._render.reportDecodeRenderTime(t,e)}},{key:"getStats",value:function(){return this._render.getStats()}},{key:"jumpBuffer",value:function(t,e,i,s){this._rendering&&this._render.jumpBuffer(t,e,i,s)}},{key:"render",get:function(){return this._render}},{key:"canvas",get:function(){return this._render.canvas}},{key:"decoder",get:function(){return this._decoder}},{key:"isSupported",get:function(){return this._support.isSupported}},{key:"isReady",get:function(){return this._support.isSupported&&this._decoder.isReady}},{key:"needPreload",get:function(){return!Rs.preloaded&&this._support.canPreload&&!this._decoder.isReady}},{key:"renderInited",get:function(){return this._renderInited}},{key:"rendering",get:function(){return this._rendering}}]),t}(),Ds=function(){function t(){Object(s.a)(this,t),this._buffer=-1}return Object(r.a)(t,[{key:"reset",value:function(){this._buffer=-1}},{key:"buffer",get:function(){return this._buffer},set:function(t){(-1===this._buffer||t<this._buffer)&&(this._buffer=t<0?0:t)}}]),t}(),Ls=function(){function t(){Object(s.a)(this,t),this._badBuffer=new Ds}return Object(r.a)(t,[{key:"reset",value:function(){this._badBuffer.reset()}},{key:"setItem",value:function(t){this._badBuffer.buffer=t.badBuffer}},{key:"setBuffers",value:function(t){this._badBuffer.buffer=t}},{key:"badBuffer",get:function(){return this._badBuffer.buffer}}]),t}(),Os=function(){function t(){Object(s.a)(this,t),this.autoBuffer=new Ls,this.videoBuffer=new Ls}return Object(r.a)(t,[{key:"reset",value:function(){this.autoBuffer.reset(),this.videoBuffer.reset()}}]),t}(),Bs=function(){function t(){Object(s.a)(this,t),this.stat=null,this.endTs=0,this.pausedStartTs=0,this.isInTime=!1,this.switchType=0,this.switchCodecType=0,this.recordCodecType=0,this.heartType=0,this.monitorTime=Number(a.a.autoCfg.monitorTime),this.tempBuffer=new Os,this.usefulBuffer=new Os,this._continueBuffer=-1,this._badReasons=0,this._minReason=0}return Object(r.a)(t,[{key:"init",value:function(t){this.stat=t}},{key:"start",value:function(t,e){0===this.endTs&&(this._badReasons=0,this._minReason=0),this.switchType=t,this.switchCodecType=e,u.a.log("AutoSwitchMonitor.start"),this.endTs=c.a.now()+this.monitorTime,this.pausedStartTs>0&&(this.isInTime=!0,this.tempBuffer.autoBuffer.setItem(this.tempBuffer.videoBuffer)),this._checkStat(),A.a.add(this.onCheckTimer,this,100)}},{key:"_checkStat",value:function(){this.endTs>c.a.now()?(this.heartType=this._getHeartType(),this.recordCodecType=this.switchCodecType):(this.heartType=0,this.recordCodecType=0)}},{key:"recordHeartType",value:function(){this.stat.setCoreDim(l.a.DIM_CORE.AUTO_HEART_TYPE,this.heartType),this.stat.setCoreDim(l.a.DIM_CORE.AUTO_CODEC_CHANGE_TYPE,this.recordCodecType),this.stat.setCoreDim(l.a.CORE.AUTO_BAD_BUFFER,this.usefulBuffer.autoBuffer.badBuffer),this.stat.setCoreDim(l.a.CORE.VIDEO_BAD_BUFFER,this.usefulBuffer.videoBuffer.badBuffer),this.stat.setCore(l.a.CORE.AUTO_CONTINUE_BUFFER,this._continueBuffer),this.usefulBuffer.reset(),this._continueBuffer=-1,this._checkStat()}},{key:"_getHeartType",value:function(){return this.switchType===Ut?1:2}},{key:"stop",value:function(){this.endTs=0,A.a.remove(this.onCheckTimer,this)}},{key:"addBadReason",value:function(t){this._badReasons|=t;var e=Math.log2(t)+1;(0===this._minReason||this._minReason>e)&&(this._minReason=e)}},{key:"addSwitch",value:function(t,e,i,s){1===s&&(u.a.log("AutoSwitchMonitor.addSwitch"),this.stat.addCore(l.a.CORE.AUTO_SWITCH_CNT,1),e===i&&this.stat.addCore(l.a.CORE.AUTO_SWITCH_SAME_CNT,1),this.endTs>t&&(e===i&&this.stat.addCore(l.a.CORE.AUTO_BAD_SWITCH_SAME,1),this.switchType===Ut&&this.stat.addCore(l.a.CORE.AUTO_BAD_SWITCH_UP,1),this.stat.addCore(l.a.CORE.AUTO_BAD_SWITCH,1)))}},{key:"addBadQuality",value:function(t,e,i,s){u.a.log("AutoSwitchMonitor.addBadQuality isIntime=".concat(this.isInTime," pausedStartTs=").concat(this.pausedStartTs," endTs=").concat(this.endTs," now=").concat(t)),this.usefulBuffer.videoBuffer.setItem(this.tempBuffer.videoBuffer),this.isInTime&&(this.usefulBuffer.autoBuffer.setItem(this.tempBuffer.autoBuffer),this.stat.addCore(l.a.CORE.AUTO_BAD_QUALITY,1),this.stat.addCore(l.a.CORE.AUTO_BAD_DURATION,e),this.stat.setCoreDim(l.a.DIM_CORE.AUTO_BAD_REASON,this._badReasons),this.stat.setCoreDim(l.a.DIM_CORE.AUTO_BAD_MIN_REASON,this._minReason),this._continueBuffer=s,this.switchType===Ut&&(this.stat.addCore(l.a.CORE.AUTO_BAD_QUALITY_UP,1),this.stat.addCore(l.a.CORE.AUTO_BAD_DURATION_UP,e))),i!==rs&&(this.pausedStartTs=0,this.isInTime=!1),this.tempBuffer.reset()}},{key:"onCheckTimer",value:function(t,e){t>=this.endTs&&(u.a.log("AutoSwitchMonitor.onCheckTimer stop."),this.stat.setCore(l.a.CORE.AUTO_BAD_DONE,1),this.stop())}},{key:"resetPausedTs",value:function(){this.tempBuffer.reset(),this.pausedStartTs=0,this.isInTime=!1}},{key:"setPause",value:function(t,e){u.a.log("AutoSwitchMonitor.setPause now=".concat(t," buffer=").concat(e," endTs=").concat(this.endTs)),this.pausedStartTs=t,this.tempBuffer.videoBuffer.setBuffers(e),this.endTs>t?(this.isInTime=!0,this.tempBuffer.autoBuffer.setBuffers(e)):this.isInTime=!1}}]),t}(),Ns=function(){function t(e){Object(s.a)(this,t),this.hyPlayer=e,this.hasEvent=!1,this.isSupported=void 0!==document.addEventListener&&void 0!==document.hidden,this.onVisibilitychangeBind=this.onVisibilitychange.bind(this),this.stat=null}return Object(r.a)(t,[{key:"setStat",value:function(t){this.stat=t,this.onVisibilitychange(),this.addVisibilitychange()}},{key:"addVisibilitychange",value:function(){!this.hasEvent&&this.isSupported&&(this.hasEvent=!0,document.addEventListener("visibilitychange",this.onVisibilitychangeBind))}},{key:"delVisibilitychange",value:function(){this.hasEvent&&(this.hasEvent=!1,document.removeEventListener("visibilitychange",this.onVisibilitychangeBind))}},{key:"onVisibilitychange",value:function(){this.isSupported&&(u.a.log("Visibility.onVisibilitychange visibilityState=".concat(document.visibilityState)),this.stat&&this.stat.setComDim(l.a.DIM_COM.VISIBILITY_STATE,document.visibilityState),this.hyPlayer.trigger(n.a.VISIBILITY_CHANGE))}}]),t}(),Us=function(){function t(e){Object(s.a)(this,t),this.scene=e,this.sDispatchId="",this.expiredTime=0}return Object(r.a)(t,[{key:"isExpired",value:function(t){return t>this.expiredTime}}]),t}(),Fs=function(){function t(){Object(s.a)(this,t),this._sysMap=new Map}return Object(r.a)(t,[{key:"addItem",value:function(t,e,i){u.a.log("RecSysStat.addItem scene=".concat(t," now=").concat(c.a.now()," expiredTime=").concat(i));var s=this._sysMap.get(t);s||(s=new Us(t),this._sysMap.set(t,s)),s.sDispatchId=e,s.expiredTime=Number(i)||c.a.now()+6e4}},{key:"removeItem",value:function(t){this._sysMap.delete(t)}},{key:"recordAct",value:function(t){var e=this.getResult();e.length>0&&t.setActDim(l.a.DIM_CORE.DISPATCH_ID,e)}},{key:"recordHeart",value:function(t){var e=this.getResult();e.length>0&&t.setCoreDim(l.a.DIM_CORE.DISPATCH_ID,e)}},{key:"getResult",value:function(){var t=[],e=c.a.now();return this._sysMap.forEach((function(i){i.isExpired(e)||t.push("".concat(i.scene,":").concat(i.sDispatchId))})),t.join(",")}}]),t}(),Ms=function(){function t(e){Object(s.a)(this,t),c.a.now();var i=Number(localStorage.sdkLogLevel);isNaN(i)||this.setLogLevel(i),Q.a.initUUId(),this.uuid=Q.a.uuid;var r=f.a.platform+" "+f.a.name+" "+f.a.version.string;u.a.warn("SDK ".concat(2202141204," | ").concat("2022-02-14 12:04:25"," | ").concat("RELEASE"," | ").concat(r," | ").concat(this.uuid)),this.config=a.a,this.config.init(e);var h=function(){var t=new w.a;return t.trigger=function(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];var a=s;"Array"===s.constructor.name&&(a=s[0]),e===n.c.PLAY_STATUS?u.a.log("%c"+e+" %c"+a.status,"color:#F9F900;background:gray","color:#53FF53;background:gray"):-1===cs.indexOf(e)&&u.a.log("%c"+e,"color:#F9F900;background:gray",a),t.emit.apply(t,[e,e].concat(s))},t.off=function(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];t.removeListener.apply(t,[e].concat(s))},t}();this.on=h.on.bind(h),this.off=h.off.bind(h),this.trigger=h.trigger.bind(h),this.stat=new os,this.metrics=new g,this.abConfig=new ws,this.tsdbUtil=new p({stat:this.stat,eventEmiter:this}),this.sampleController=new ms,this.statSwitch=new Is(this.tsdbUtil,this.stat,this),this.h265Proxy=new ks(this.stat,this.tsdbUtil),this.autoMonitor=new Bs,this.recSysStat=new Fs,this.visibility=new Ns,this.autoForce=new gs(this,this.abConfig),this.statSwitch.init(this.autoMonitor,this.recSysStat,this.autoForce),this.autoMonitor.init(this.stat),this.volume=1,this._type=0,this.player=null,this.lastFlvInfo=null,this.lastP2PInfo=null,this.noPictureP2PSended=!1,this.noPictureFlvSended=!1,this.noPictureWebrtcSended=!1,this.playingMgr=null,this.flacMgr=null,this.flacLibURL="flaclib.js",this.videoPlaybackrateAccess=!f.a.firefox,this.enableLowLatency=!1,this.webrtcErrored=!1,this._isP2pPlayIng=!1,this.isForceFlv=!1,this.isGetPcdnMode=!1,window.HYApplication&&(window.HYApplication.tafHandler&&o.default.setTafHandler(window.HYApplication.tafHandler),window.HYApplication.config&&this.config.init(window.HYApplication.config)),this.on(n.c.VIDEO_PLAY,this.onPlayVideo.bind(this)),this.on(n.c.H5_PLAYER_ERROR,this.onH5PlayerError.bind(this)),this._mediaLink=new ds,o.default.addListener("1200000",this._sendMuffledMessage.bind(this)),this.isUsePcdn=!0,this.getAIRequestTime=0,this.isAiSupportP2P=!0,this.aiStartP2PCnt=0,this.aiStartFlvCnt=0,this.aiComp=0,this.sdkTurnToP2P=!0,this.sdkInRoomTs=Date.now(),this.startTs=0}return Object(r.a)(t,null,[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function(){return n.c}}]),Object(r.a)(t,[{key:"loginMedia",value:function(t,e,i){this._mediaLink.loginMedia(t,e,i)}},{key:"quitMedia",value:function(){this._mediaLink.quitMedia()}},{key:"onPlayVideo",value:function(t,e){this.player&&this.player.setVolume(this.volume)}},{key:"checkCooling",value:function(){if(Q.a.p2pCooling=!1,this.stat.delDim(l.a.DIM_COM.P2P_COOL_FLAG),localStorage.hasOwnProperty("p2p_cooling_time")){var t=new Date,e=new Date(Number(localStorage.getItem("p2p_cooling_time")));Q.a.p2pCooling=!(t.getFullYear()!=e.getFullYear()||t.getMonth()!=e.getMonth()||t.getDate()!=e.getDate()),Q.a.p2pCooling&&this.stat.setComDim(l.a.DIM_COM.P2P_COOL_FLAG,1)}}},{key:"setIDs",value:function(){}},{key:"setExtendConfig",value:function(t){var e={};t.p2pConfig&&(Object.assign(e,t.p2pConfig),delete t.p2pConfig),t.sdk&&(t.sdk.p2pConfig&&(Object.assign(e,t.sdk.p2pConfig),delete t.sdk.p2pConfig),Object.assign(e,t.sdk),delete t.sdk),Object.assign(e,t),this.config.init(e)}},{key:"setConfig",value:function(t,e){this.config[t]!=e&&(this.config[t]=e,u.a.log("HYPlayer.setConfig ".concat(t,"=").concat(e)))}},{key:"getConfig",value:function(t){return this.config[t]}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(t){var e=Math.max(0,Number(t));e=Math.min(1,e),this.volume=e,this.flacMgr&&this.flacMgr.isPlaying()?(e=0,this.flacMgr.setVolume(this.volume),this.setVideoPlaybackrateAccess(!1)):this.setVideoPlaybackrateAccess(!0),this.player&&this.player.setVolume(e)}},{key:"setLogLevel",value:function(t){u.a.setLevel(t)}},{key:"getLog",value:function(){return u.a.getLog()}},{key:"getMetrics",value:function(){return this.metrics.getResult()}},{key:"getBufferLen",value:function(){return this.player&&this.player.getBufferLen&&this.player.getBufferLen()||0}},{key:"getCurrentTime",value:function(){return this.player?this.player.getCurrentTime():0}},{key:"getCurrentDts",value:function(){return this.player&&this.player.getCurrentDts?this.player.getCurrentDts():0}},{key:"getCurrentSeiOffsetDts",value:function(){return this.player&&this.player.getCurrentSeiOffsetDts?this.player.getCurrentSeiOffsetDts():0}},{key:"getCurrentSeiDts",value:function(){return this.getCurrentDts()-this.getCurrentSeiOffsetDts()}},{key:"getVideoInfo",value:function(){var t=0,e=NaN,i=this.player;if(i&&i.mse){var s=i.mse.video;t=s.currentTime,e=s.duration}return{currentTime:t,duration:e}}},{key:"sendMetrics",value:function(t){this.trigger(n.c.DATA_METRIC2,t)}},{key:"start",value:function(e){if(e.type!==t.STREAM||!a.a.isCloseP2P(e.uid)){e=Object.assign({uuid:this.uuid,type:0,lineType:-1,curBitrate:0,originalBitrate:0},e),this.stop(),this.stat.setComDim(l.a.DIM_COM.PLAYER_TYPE,e.type),this.stat.setComDim(l.a.DIM_COM.LIVE_TYPE,e.liveType||0),this.stat.setComDim(l.a.DIM_COM.VR_ENABLE,e.type===t.VR?1:0),this.stat.setComDim(l.a.DIM_COM.BROWSER_KERNEL,f.a.name),this.stat.setComDim(l.a.DIM_COM.BROWSER_KERNEL_VERSION,f.a.version.major),this.stat.setComDim(l.a.DIM_COM.SESSION_ID,this.sdkInRoomTs),Q.a.sGuid=e.sGuid||Q.a.sGuid,Q.a.uid=e.uid||Q.a.uid,Q.a.roomId=e.uid||Q.a.roomId,0===Q.a.convertUid&&Q.a.uid>0&&(Q.a.convertUid=v.b.rotUid(Q.a.uid,e.presenterUid)),e.curBitrate>=1e4?a.a.maxPeerStreamNum=a.a.maxPeerStreamNum20M:a.a.maxPeerStreamNum=7,a.a.resendMode=this.getResendMode(e.curBitrate),Z.wsTimeSync(),u.a.log("HYPlayer.start type=".concat(e.type," convertUid=").concat(Q.a.convertUid),e),this.setAiP2PFlvComp(e),this.isAiSupportP2P=!0,this.getAiSupportP2P(e),e.type===t.P2PFLV?(e.iIsP2PSupport&&(this.lastP2PInfo=e),e.iIsP2PSupport&&this.isAiSupportP2P?e.type=t.P2P:e.type=t.FLV):e.type===t.VR&&e.iIsP2PSupport&&this.isAiSupportP2P&&!this.isForceFlv&&(e.vr.playerType=1),this._type=e.type,e.type!==t.FLV&&e.type!==t.P2P||A.a.once(this.onNoPictureFlv,this,1e4);var i={stat:this.stat,tsdb:this.tsdbUtil,statSwitch:this.statSwitch,sampleController:this.sampleController,h265Proxy:this.h265Proxy,autoMonitor:this.autoMonitor,recSysStat:this.recSysStat};switch(this.startTs=c.a.now(),e.type){case t.FLV:this.player=new as(this,i),this.getFrameData=this.player.getFrameData.bind(this.player),this.lastFlvInfo=e;break;default:return void u.a.error("HYPlayer.start Unknown type[".concat(e.type,"]"))}this.checkCooling(),e.type==t.P2P&&e.p2purl?this.player.startP2PUrl(e):e.type==t.HUYA?(this.player.init(e),this.player.start(e.curBitrate)):this.player.start(e),this.enableLowLatency&&this.player&&this.player.setEnableLowLatency&&this.player.setEnableLowLatency(!0),this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(this.videoPlaybackrateAccess),this.playingMgr=this.player,this.getAbTestConfig(),this._type!==t.STREAM&&(this.pcdnInfo=e,this.isGetPcdnMode=!1,this.getPcdnSchedule(e))}}},{key:"getAiSupportP2P",value:function(e){var i=this;if(0!==Number(a.a.isAiP2PToFlv))if(this.isGetAiSupportP2P)this.isGetAiSupportP2P=!0;else if(a.a.playerdata){var s=a.a.playerdata.profileP2POpt;if(u.a.log("HYPlayer.getAiSupportP2P sProfileP2POpt",s),s&&""!=s&&0!=s.length){if(e.type===t.P2PFLV){if(!e.iIsP2PSupport)return}else if(e.type===t.VR&&(!e.iIsP2PSupport||this.isForceFlv))return;var r=0==e.originalBitrate?0:e.bitrate,n=e.lineType,o=JSON.parse(this.unescapeHTML(s));u.a.log("HYPlayer.getAiSupportP2P",o),o&&(o.p2pKa.split(",").map((function(t){var e=t.split("|");3==e.length&&n==e[0]&&r==e[1]&&(i.isAiSupportP2P=0==e[2])})),this.isAiSupportP2P?this.aiStartP2PCnt++:this.aiStartFlvCnt++)}}}},{key:"getAiStartStat",value:function(){var t={aiStartP2PCnt:this.aiStartP2PCnt,aiStartFlvCnt:this.aiStartFlvCnt};return this.aiStartP2PCnt=0,this.aiStartFlvCnt=0,t}},{key:"getResendMode",value:function(t){if(null!=a.a.resendModeConfig&&a.a.resendModeConfig[0].length==a.a.resendModeConfig[1].length){for(var e=a.a.resendModeConfig[0].length-1;e>=0;e--)if(t>=a.a.resendModeConfig[0][e])return a.a.resendModeConfig[1][e];return 1}}},{key:"getFrameData",value:function(){return this.player&&this.player.getFrameData?this.player.getFrameData():null}},{key:"updateLiveVodUrl",value:function(t){this.player&&this.player.updateLiveVodUrl&&this.player.updateLiveVodUrl(t)}},{key:"getExceptionStat",value:function(){return this.player.exceptionStat?this.player.exceptionStat.getStat():""}},{key:"seek",value:function(t){this.player&&this.player.seek&&this.player.seek(t)}},{key:"onNoPictureP2P",value:function(){}},{key:"onNoPictureWebrtc",value:function(){}},{key:"onNoPictureFlv",value:function(){this.player&&this.isFlv&&!this.noPictureFlvSended&&(this.noPictureFlvSended=!0,this.onNoPicture())}},{key:"onNoPictureHls",value:function(){this.player&&this.isHls&&!this.noPictureHlsSended&&(this.noPictureHlsSended=!0,this.onNoPicture())}},{key:"onNoPicture",value:function(){var t=[this.stat.createAct(l.a.ACT.NO_PICTURE,{value:[this.player.hasPicture?0:100],str:[f.a.platform]})];this.stat.setActDim(l.a.DIM_LINK_STA.name,this.getExceptionStat()),t.push(this.stat.createAct(l.a.ACT.LINK_STA,{value:[this.player.hasPicture?0:100],str:[f.a.platform]})),this.trigger(n.c.DATA_METRIC2,t),1==a.a.isAutoNoPicture&&Math.floor(1e3*Math.random())<50&&this.player&&!this.player.hasPicture&&(u.a.log("HYPlayer.onNoPicture auto report"),this.trigger(n.c.P2P_REPORT))}},{key:"onWebrtcVideoError",value:function(t){}},{key:"stop",value:function(){u.a.group("HYPlayer.stop"),A.a.remove(this.onNoPictureFlv,this),A.a.remove(this.onNoPictureP2P,this),this.player&&(this.player.stop(),this.player.destroy&&this.player.destroy(),this.player=null),this.stopFlac(),u.a.groupEnd(),this._isP2pPlayIng=!1,this.p2pPlayingEvent(this._isP2pPlayIng),this.player&&this.player.voiceEliminationData&&(this.player.voiceEliminationData=[]),this.stat.reset(),this.isGetPcdnMode=!1}},{key:"stopStream",value:function(t){u.a.log("HYPlayer.stopStream",t),this.player&&this.player.stopStream&&this.player.stopStream(t)}},{key:"setTafHandler",value:function(t){u.a.log("HYPlayer.setTafHandler success"),o.default.setTafHandler(t),Z.start()}},{key:"onH5PlayerError",value:function(){this._type==t.P2P&&(this.sdkTurnToP2P=!0)}},{key:"switchLevel",value:function(t){this.player&&this.player.switchLevel(t)}},{key:"initMeeting",value:function(){}},{key:"startLiveMeeting",value:function(t,e,i){}},{key:"setMeetingStat",value:function(t){}},{key:"stopLiveMeeting",value:function(){}},{key:"startFlac",value:function(t,e){}},{key:"stopFlac",value:function(){this.flacMgr&&this.flacMgr.stop()}},{key:"flacPlayStatusChange",value:function(){this.setVolume(this.volume)}},{key:"setVideoPlaybackrateAccess",value:function(t){this.player&&this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(!!this.videoPlaybackrateAccess&&t)}},{key:"reportLoadP2PLib",value:function(t){var e=[this.stat.createAct(l.a.ACT.LOAD_P2PLIB_ERROR,{value:[t?100:0],str:[f.a.platform]})];this.trigger(n.c.DATA_METRIC2,e)}},{key:"p2pPlayingEvent",value:function(t){this.trigger(n.c.P2P_PLAYING_EVENT,{isP2pPlayIng:t})}},{key:"unescapeHTML",value:function(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace("↵","")}},{key:"_sendMuffledMessage",value:function(e){if(this._type!==t.STREAM&&e&&e.sMuteInfo){var i=JSON.parse(this.unescapeHTML(e.sMuteInfo));this.sendMuffledMessage(i.voiceEliminationData)}}},{key:"sendMuffledMessage",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.player){this.player.voiceEliminationData||(this.player.voiceEliminationData=[]);var i=this.getCurrentDts(),s=this.getCurrentSeiOffsetDts();e.length>0&&e.map((function(e){var r=!1;0===t.player.voiceEliminationData.length?r=!0:t.player.voiceEliminationData.map((function(t){t.type===e.type&&t.begin==t.begin&&t.end===e.end||(r=!0)})),r&&(t.reportMuffledDelay(s,i,e),t.player.voiceEliminationData.push(e),u.a.log("HYPlayer._sendMuffledMessage currentDts: ".concat(t.getCurrentDts(),", currentSeiOffsetDts: ").concat(t.getCurrentSeiOffsetDts()),JSON.stringify(e),t.player.mse.getBufferLen()))}))}}},{key:"reportMuffledDelay",value:function(t,e,i){var s=i.begin,r=i.end,a=e;0==i.type&&(s+=t,r+=t,a=e-t);var o=0;e<=s?o=0:e>s&&e<r?o=2:e>=r&&(o=1);var h=[this.stat.createAct(l.a.ACT.MUTE_STATUS,{value:[o,i.type,a],str:[i.reqKey]})];u.a.log("HYPlayer.reportMuffledDelay"),this.trigger(n.c.DATA_METRIC2,h)}},{key:"getPcdnSchedule",value:function(e){var i=this;if(!a.a.isCloseP2P(e.uid)&&(this.type===t.P2P||this.type===t.FLV))if(e.sStreamName){if(a.a.notUsePcdnUids&&a.a.notUsePcdnUids.length>0){var s=!1;if(a.a.notUsePcdnUids.map((function(t){t===String(e.presenterUid)&&(s=!0)})),s)return}if(this.isUsePcdn)if(o.default.connected){A.a.remove(this.timeoutGetPcdn),A.a.remove(this.httpsFetch),A.a.once(this.httpsFetch,this,1e3);var r=this.getPcdnReq(e);u.a.log("HYPlayer.getPcdnSchedule tqf req",r),o.default.sendWup("hypcdngw","clientQueryPcdnSchedule",r,(function(t){i.getPcdnRes(t)}),!0,o.default.getRequestId()),A.a.once(this.timeoutGetPcdn,this,1e3)}else o.default.on(o.default.TAFLINK_INITED,(function(){u.a.log("HYPlayer.getPcdnSchedule taf inited"),i.getPcdnSchedule(e)}))}else u.a.log("HYPlayer.getPcdnSchedule has no sStreamName")}},{key:"getPcdnRes",value:function(t){u.a.log("HYPlayer.getPcdnSchedule res",t),this.isGetPcdnMode=!0,!t||0!=t.iErrCode&&7!=t.iErrCode||this.player&&this.player.checkPcdnMode&&this.player.checkPcdnMode(t.mPcdnModeSwitch.value,t.mPcdnModePcdnName.value)}},{key:"getPcdnReq",value:function(t){var e=new ls.default.ClientQueryPcdnScheduleReq;e.lReqTs=Date.now(),e.lUid=Q.a.uid,e.sGuid=Q.a.sGuid,e.lAnchorUid=t.presenterUid,e.iCdnLine=t.lineType,e.iCliType=ls.default.EM_CLINET_TYPE.E_CLIENT_WEB,e.lBucketPara=Number(localStorage.randomPcdnPercent)||0,e.vPcdnMode.value=[ls.default.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream];var i=new fs.Vector(new fs.STRING);return i.value=["xy","ppio"],1===Number(a.a.pcdnFlv)&&(e.vPcdnMode.value.push(ls.default.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream),e.mPcdnModeCliSupportPcdns.value[ls.default.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream]=i),e.iBusiType=ls.default.EM_BUSI_TYPE.E_BusiType_Live,e.sStreamName=t.sStreamName,e}},{key:"httpsFetch",value:function(){var t=this;if(!this.isGetPcdnMode){u.a.log("HYPlayer.httpsFetch");var e=this.pcdnInfo,i=this.getPcdnReq(e);u.a.log("HYPlayer.httpsFetch req",i);var s=Date.now().toString(16),r="https://pcdngw.huya.com/huyalive/clientQueryPcdnSchedule";r+="?wsSecret=".concat(Oe("clientQueryPcdnSchedule".concat(s,"1211huyalive")),"&wsTime=").concat(s);var n=new fs.JceOutputStream;i.writeTo(n),fetch(r,{body:n.getBuffer(),method:"POST"}).then((function(e){var i=e.body.getReader();t.pump.call(t,i)}))}}},{key:"pump",value:function(t){var e=this;t.read().then(function(i){if(i.done)u.a.log("httpsFetch done");else{var s=i.value.buffer;e.pump(t);var r=new fs.JceInputStream(s),n=new ls.default.ClientQueryPcdnScheduleRsp;n.readFrom(r),e.getPcdnRes(n)}}.bind(this))}},{key:"getAnticode",value:function(t,e){var i=e.split("&"),s={};return i.map((function(t){var e=t.split("=");2==e.length&&(s[e[0]]=e[1])})),s[t]?s[t]:""}},{key:"timeoutGetPcdn",value:function(){u.a.log("HYPlayer.timeoutGetPcdn"),this.isGetPcdnMode||this.getPcdnSchedule(this.pcdnInfo)}},{key:"containerResize",value:function(){}},{key:"getUseAuto",value:function(){return this.autoForce.getUseAuto()}},{key:"getSupportAuto",value:function(){return!a.a.getEnableJumpBuffer()}},{key:"getRandomUseAiP2PFlv",value:function(t){var e=localStorage.aiP2PFlvPresentUid,i=t.presenterUid,s=!0;if(1==Number(a.a.allUidsAiP2P))s=!0;else{var r=a.a.aiBlackUids.concat(a.a.aiBlack2Uids);u.a.log("HYPlayer.getRandomUseAiP2PFlv blackUids",r),r.forEach((function(t){i&&t.toString()==i.toString()&&(s=!1)}))}if(/\/huyalive/g.test(t.sFlvUrl))return u.a.log("HYPlayer.getRandomUseAiP2PFlv flvUrk huyalive"),2;if(!s||7==t.lineType||0==t.iIsP2PSupport)return 2;if(a.a.isCloseP2P(t.uid))return 2;localStorage.randomAIP2PFlvPercent&&e==i||(localStorage.randomAIP2PFlvPercent=a.a.randomAIP2PFlvPercent);var n=Number(localStorage.randomAIP2PFlvPercent);return localStorage.aiP2PFlvPresentUid=t.presenterUid,n<a.a.aiRandomPercent?1:0}},{key:"setAiP2PFlvComp",value:function(t){var e=this.getRandomUseAiP2PFlv(t);this.aiComp=e,this.stat.setComDim("backup_field1",e),0==e||2==e?a.a.setAiP2PToFlv(0):1==e&&a.a.setAiP2PToFlv(1)}},{key:"getAbTestConfig",value:function(){var t=localStorage.abConfig;if(u.a.log("HYPlayer.getAbTestConfig abConfig",t),!t)return null;""!=(t=JSON.parse(t)).mpExperiment&&this.stat.setComDim(l.a.DIM_COM.OEXP,t.mpExperiment),!t.mpConfig||0!=Number(t.mpConfig.usePcdn)&&1!=Number(t.mpConfig.usePcdn)||(u.a.log("HYPlayer.getAbTestConfig",t.mpConfig,t.mpConfig.usePCdn),this.isUsePcdn=1==Number(t.mpConfig.usePcdn));var e=Number(t.mpConfig.abPlaybackMinRate),i=Number(t.mpConfig.abPlaybackMaxRate);t.mpConfig&&e&&i&&(u.a.log("HYPlayer.getAbTestConfig playbackRate, min=%f, max=%f",e,i),a.a.setAbPlaybackRate(e,i))}},{key:"getSdkTestConfig",value:function(){var t="";if(1===Number(a.a.isCommonAb))t=1;else{var e=this.aiComp;1===e?t=1:0===e?t=0:2===e&&(t="")}return u.a.log("HYPlayer.getSdkTestConfig",t),t}},{key:"isSupportP2P",get:function(){return ce.isSupportP2P()}},{key:"isWebrtcSupport",get:function(){return ce.isWebrtcSupport()}},{key:"type",get:function(){return this._type}},{key:"isFlv",get:function(){return this._type==t.FLV}},{key:"isP2P",get:function(){return this._type==t.P2P}},{key:"isHls",get:function(){return this._type==t.HLS}},{key:"isHuya",get:function(){return this._type==t.HUYA}},{key:"isHuyaWebrtc",get:function(){return this._type==t.HUYAWEBRTC}},{key:"isP2pPlayIng",get:function(){return this._isP2pPlayIng}}]),t}();Ms.FLV=1,Ms.P2P=2,Ms.HLS=3,Ms.HUYA=4,Ms.STREAM=5,Ms.OBS=6,Ms.VR=7,Ms.HUYAWEBRTC=8,Ms.PLAYBACK=9,Ms.P2PFLV=10,e.default=Ms,window.HYPlayer=Ms,window.H5Player=Ms},function(t,e,s){"use strict";s.r(e);var r=s(3),n=s(2),a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame,h=s(0),u=s(4),c=s(5),l=s(6),d=s(1),p=s(8),f=function(){function t(){Object(r.a)(this,t),this.count=0,this.arr=[]}return Object(n.a)(t,[{key:"inc",value:function(t){this.count+=t}},{key:"dec",value:function(t){this.count-=t,this.count<0&&(this.count=0)}},{key:"collect",value:function(){this.arr.push(this.count),this.count=0}},{key:"stat",value:function(){var t=this.arr;return this.arr=[],t}},{key:"reset",value:function(){this.count=0,this.arr=[]}}]),t}(),_={toDecode:0,decoded:1,render:2,throwFrame:3,throwRaw:4,rawList:5,frameList:6},m=function(){function t(){Object(r.a)(this,t),this.toDecodeItem=new f,this.decodedItem=new f,this.renderItem=new f,this.throwFraItem=new f,this.throwRawItem=new f,this.rawItem=new f,this.frameItem=new f,this.rafItem=new f,this.items=[this.toDecodeItem,this.decodedItem,this.renderItem,this.throwFraItem,this.throwRawItem,this.rawItem,this.frameItem,this.rafItem],this.reset()}return Object(n.a)(t,null,[{key:"TYPES",get:function(){return _}}]),Object(n.a)(t,[{key:"inc",value:function(t,e){for(var i=0;i<t.length;i++){var s=this.getItem(t[i]);s&&s.inc(e[i])}this.collect()}},{key:"dec",value:function(t,e){for(var i=0;i<t.length;i++){var s=this.getItem(t[i]);s&&s.dec(e[i])}this.collect()}},{key:"collect",value:function(){var t=c.a.now();if(0==this.lastStatTime&&(this.lastStatTime=t),t-this.lastStatTime>=1e3){for(var e=0;e<this.items.length;e++)this.items[e].collect();this.lastStatTime=t}}},{key:"getStat",value:function(){return{toDecode:this.toDecodeItem.stat(),decoded:this.decodedItem.stat(),render:this.renderItem.stat(),rawList:this.rawItem.stat(),frameList:this.frameItem.stat()}}},{key:"getItem",value:function(t){return t>=this.items.length?null:this.items[t]}},{key:"reset",value:function(){this.lastStatTime=0;for(var t=0;t<this.items.length;t++)this.items[t].reset()}}]),t}(),y=s(18);function v(t,e){Object.keys(t).forEach((function(i){return e(i,t[i])}))}var S=function(){function t(e,i){Object(r.a)(this,t),this.stat=e,this.tsdb=i,this.resetProps(),this.bindEvents={play:this.onPlay.bind(this),pause:this.onPaused.bind(this)},this.stat=new m,this.fpsList=[],this.avgFrameGap=0,this.rafTime=0,this.isHidden=!1,this.retryFlvTimes=0,this.retryP2PTimes=0,this.rafFrameBind=this.rafFrame.bind(this),this.onVisibilityChangedBind=this.onVisibilityChanged.bind(this)}return Object(n.a)(t,null,[{key:"isSupported",value:function(){return"object"==("undefined"==typeof WebAssembly?"undefined":i(WebAssembly))}}]),Object(n.a)(t,[{key:"addEvents",value:function(){document.addEventListener("visibilitychange",this.onVisibilityChangedBind,!1),document.addEventListener("mozvisibilitychange",this.onVisibilityChangedBind,!1),document.addEventListener("msvisibilitychange",this.onVisibilityChangedBind,!1)}},{key:"delEvents",value:function(){document.removeEventListener("visibilitychange",this.onVisibilityChangedBind,!1),document.removeEventListener("mozvisibilitychange",this.onVisibilityChangedBind,!1),document.removeEventListener("msvisibilitychange",this.onVisibilityChangedBind,!1)}},{key:"addTimer",value:function(){l.a.add(this.timerHandler,this,1e3),l.a.add(this.fasterTimerHandler,this,100)}},{key:"delTimer",value:function(){l.a.remove(this.timerHandler,this),l.a.remove(this.fasterTimerHandler,this)}},{key:"attachMse",value:function(t){h.a.log("H265Player.attachMse"),this.mse=t,this.resetProps();var e=c.a.now();this.onVideoFrameTime=e,this.pushVideoTime=0,this.workerHeartTime=e,this.updteFpsTime=0,this.mediaElement=t.video.video,this.rafId=null,this.rafFrame(),this._initGL(t),this.addEvents(),this.addTimer()}},{key:"_initGL",value:function(t){var e=t.h265Proxy.decoder;e.onMessageCb=this._onMessage.bind(this),this.decoder=e.decoder,this.decoder.postMessage({t:8,d:u.a.h265Config}),this.isPlaying=!0,this.canvas=document.createElement("canvas"),this.canvas.width=t.getWidth(),this.canvas.height=t.getHeight(),h.a.log("H265Player._initGL width=".concat(t.getWidth()," height=").concat(t.getHeight()));var i=this.canvas.transferControlToOffscreen();this.decoder.postMessage({t:10,canvas:i,width:this.mse.getWidth(),height:this.mse.getHeight(),config:u.a.h265Config[6]},[i]),this._initDecodeWorker(),v(this.bindEvents,(function(e,i){t.video.video.addEventListener(e,i)}))}},{key:"updateSize",value:function(){}},{key:"resetProps",value:function(){this.canvas=null,this.frameList=[],this.isPlaying=!1,this._audioErrorCnt=0,this.onVideoFrameTime=0,this.pushVideoTime=0,this.workerHeartTime=0,this.decodeNow=0,this.renderTime=0,this.curPic=null,this.pauseDecode=!1,this.avgFrameGap=33,this.updteFpsTime=0,this.rafTime=0,this.pauseCnt=0,this.countHeart=0,this.rafNoRenderCount=0,this.isFirsrToDecode=!1,this.toDecodeStamp=0,this.isFirstDecoded=!1,this.decodedStamp=0,this.isFirstRender=!1,this.renderStamp=0,this.renderStat=[],this.decodedStat=[],this.toDecodeStat=[],this.frameListStat=[],this.rafStat=[],this.rawListStat=[]}},{key:"timerHandler",value:function(){var t=c.a.now();this.checkTimer(t),this.timerTime=t}},{key:"fasterTimerHandler",value:function(){this.isHidden&&this.storeAudioDts()}},{key:"checkTimer",value:function(){var t=this,e=c.a.now();0!=this.workerHeartTime&&e-this.workerHeartTime>5e3&&this.mse.h265Proxy&&(h.a.log("H265Player.checkTimer worker error"),this.mse.h265Proxy.terminate(),setTimeout((function(){t.handlerError(y.a.WORKER_ERROR)}),200)),0!=this.pushVideoTime&&e-this.pushVideoTime>u.a.h265NoPushVideoDis&&(h.a.log("H265Player.checkTimer pushVideoFrame timeout"),this.handlerError(y.a.NO_DATA))}},{key:"getQueryString",value:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null}},{key:"onVisibilityChanged",value:function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?(h.a.log("H265Player.onVisibilityChanged isHidden true"),this.isHidden=!0,this.decoder&&this.decoder.postMessage({t:12})):(h.a.log("H265Player.onVisibilityChanged isHidden false"),this.renderTime=0,this.isHidden=!1,this.decoder&&this.decoder.postMessage({t:13}))}},{key:"_onMessage",value:function(t){var e=t.data;switch(e.t){case 5:break;case 7:if(!this.isPlaying)return;e.d.logList&&e.d.logList.length>0&&(h.a.log("H265Player.onmessage.worker.log",e.d.logList.join(",")),e.d.logList=[]),this.onDecodeError(e.d.data);break;case 9:if(0==e.d.length)return;h.a.log("H265Player.onmessage.worker.log",e.d.join(",")),e.d=[];break;case 10:var i=c.a.now();this.workerHeartTime=i,this.countHeart++,this.countHeart%20==0&&h.a.log("H265Player.onmessage.webWorker.heart");break;case 11:break;case 12:this.handlerError(y.a.RECEIVE_LIST_OUT_LIMIT);break;case 13:this.onRenderError(e.d);break;case 14:var s=e.d.renderNow,r=e.d.decodedNow,n=Date.now()-s;h.a.log("H265Player.onmessage render play postMessage cost",n),this.isFirstDecoded||(this.decodedStamp=r,this.isFirstDecoded=!0),this.isFirstRender||(this.renderStamp=s,this.isFirstRender=!0,h.a.log("H265Player.onmessage 送帧到解码，解码到渲染耗时",this.decodedStamp-this.toDecodeStamp,this.renderStamp-this.decodedStamp)),this.mse&&this.mse.handler&&(this.mse.triggerH265Play(this.decodedStamp-this.toDecodeStamp,this.renderStamp-this.decodedStamp),this.mse.handler.isH265Playing=!0);break;case 15:this.pauseCnt++,h.a.log("H265Player.onmessage pauseCnt",this.pauseCnt);break;case 16:h.a.log("H265Player.onmessage worker noRender 10s",this.isHidden),this.handlerError(y.a.NO_RENDER),this.autoReport();break;case 17:this.handlerError(y.a.NO_DECODE);break;case 18:e.d.render.length>0&&(this.renderStat=this.renderStat.concat(e.d.render)),e.d.decoded.length>0&&(this.decodedStat=this.decodedStat.concat(e.d.decoded)),e.d.toDecode.length>0&&(this.toDecodeStat=this.decodedStat.concat(e.d.toDecode)),e.d.frameList.length>0&&(this.frameListStat=this.frameListStat.concat(e.d.frameList)),e.d.raf.length>0&&(this.rafStat=this.rafStat.concat(e.d.raf)),e.d.rawList.length>0&&(this.rawListStat=this.rawListStat.concat(e.d.rawList));break;case 19:this.handlerError(y.a.YUV_OUT_LIMIT);break;case 20:this.reportError(y.a.CREATE_WEBGL_FAIL),this.turnToH264();break;case 21:this.reportError(y.a.AUDIO_FAST),this.turnToH264();break;case 22:this.reportError(y.a.VIDEO_FAST),this.turnToH264();break;case 23:var a=e.data.width,o=e.data.height;h.a.log("H265Player.onMessage 23 width=".concat(a," height = ").concat(o)),this.mse.setResolution(a,o);break;case 24:this.mse&&e&&e.d&&(this.mse.setVideoCurrentTimeHand(e.d.minusBuffer,e.d.bufLen,e.d.type,e.d.timeNow),this.storeAudioDts())}}},{key:"_initDecodeWorker",value:function(t){var e=new SharedArrayBuffer(8);this.audioDtsShareBuffer=new Uint32Array(e),this.decoder.postMessage({t:16,d:this.audioDtsShareBuffer})}},{key:"rafFrame",value:function(){1==Number(localStorage._print265RenderInterval)&&!this.isRenderInterval&&this.decoder&&(this.isRenderInterval=!0,this.isNotRenderInterval=!1,this.decoder.postMessage({t:14,d:0})),0==Number(localStorage._print265RenderInterval)&&!this.isNotRenderInterval&&this.decoder&&(this.isNotRenderInterval=!0,this.isRenderInterval=!1,this.decoder.postMessage({t:14,d:1})),this.storeAudioDts(),this.rafFrameBind&&(this.rafId=a(this.rafFrameBind))}},{key:"getStats",value:function(){var t=this.stat.getStat();t.decoded=[].slice.call(this.decodedStat),t.render=[].slice.call(this.renderStat),t.toDecode=[].slice.call(this.toDecodeStat),t.frameList=[].slice.call(this.rafStat),t.rawListWorker=[].slice.call(this.rawListStat);var e="H265Player.getStats\n";for(var i in t)e+="".concat(i,": ").concat(t[i].toString(),"\n");h.a.log(e);var s={frameListLen:this.frameList.length,statProps:t,h265PauseCnt:this.pauseCnt};return this.pauseCnt=0,this.renderStat=[],this.decodedStat=[],this.toDecodeStat=[],this.frameListStat=[],this.rafStat=[],this.rawListStat=[],s}},{key:"pushVideoFrame",value:function(t){t.vps,t.sps,t.pps;var e=t.samples;if(this.isPlaying){for(var i,s=c.a.now(),r=0;r<e.length;r++){var n={units:(i=e[r]).units,dtsInMs:i.dts/90,ptsInMs:i.pts/90,key:i.key?1:0};this.isFirsrToDecode||(this.toDecodeStamp=Date.now(),this.isFirsrToDecode=!0),this.decoder.postMessage({t:4,d:n},n.units[0].data.buffer)}if(this.stat.inc([m.TYPES.rawList],[e.length]),s-this.updteFpsTime>=1e3){if(this.fpsList.length>=5){var a=0;this.fpsList.forEach((function(t){a+=t}));var o=Math.floor(1e3/(a/5));this.avgFrameGap=o>this.avgFrameGap?this.avgFrameGap:o,this.decoder.postMessage({t:9,d:this.avgFrameGap})}else this.fpsList.push(this.mse.parser.fps.getFps());this.updteFpsTime=s}this.pushVideoTime=s}}},{key:"getPts",value:function(){return this.mse&&this.mse.getCurrentDts?this.mse.getCurrentDts():0}},{key:"onPlay",value:function(){}},{key:"autoReport",value:function(){1==u.a.isAutoH265&&this.mse&&this.mse.handler&&this.mse.handler.eventEmitter&&(h.a.log("H265Player.autoReport"),this.mse.handler.eventEmitter.trigger(p.c.P2P_REPORT))}},{key:"onPaused",value:function(){}},{key:"destroy",value:function(){var t=this;this.delEvents(),this.delTimer(),this.getStats(),h.a.log("H265Player.destroy, rafid=",this.rafId),o(this.rafId),this.rafId=null,clearInterval(this.timerHandler),this.onPaused(),this.decoder&&this.decoder.postMessage({t:6}),v(this.bindEvents,(function(e,i){t.mediaElement&&t.mediaElement.removeEventListener(e,i)})),this.resetProps(),this.mediaElement=null,this.mse=null,this.pauseDecode=!1,this.stat.reset(),this.audioDtsShareBuffer&&Atomics.store(this.audioDtsShareBuffer,0,0)}},{key:"onDecodeError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,i=t.desc;h.a.error("H265Player.onDecodeError desc",i,e),7==e?(this.reportError(y.a.WASM_TIMEOUT),this.turnToH264()):(this.autoReport(),this.handlerError(y.a.DECODE_ERROR,e))}},{key:"onRenderError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,i=t.desc;h.a.error("H265Player.onRenderError desc",i,e),this.handlerError(y.a.RENDER_ERROR)}},{key:"turnToH264",value:function(){this.mse&&this.mse.turnToH264()}},{key:"retry",value:function(){if(this.mse&&this.mse.handler&&this.mse.handler.eventEmitter){var t=this.mse.handler.eventEmitter.type;t==window.HYPlayer.FLV?this.retryFlvTimes++:t==window.HYPlayer.P2P&&this.retryP2PTimes++}this.mse&&this.mse.h265Retry()}},{key:"handlerError",value:function(t,e){if(this.isPlaying&&(h.a.log("H265Player.handlerError",t),this.reportError(t,e),this.mse&&this.mse.handler&&this.mse.handler.eventEmitter)){var i=this.mse.handler.eventEmitter.type;i==window.HYPlayer.FLV?this.retryFlvTimes>=10?this.turnToH264():this.retry():i==window.HYPlayer.P2P&&(this.retryP2PTimes>=10?this.turnToH264():this.retry())}}},{key:"reportError",value:function(t,e){if(this.isPlaying&&(h.a.log("H265Player.reportError",t,y.a.dic[t]),this.mse&&this.mse.handler&&this.mse.handler.eventEmitter)){var i={value:[1],str:[t,null!=e?e:1e4]};this.mse.handler.eventEmitter.tsdbUtil.sendMetrics([this.mse.handler.stat.createAct(d.a.ACT.H265_STATUS,i)])}}},{key:"reportDecodeRenderTime",value:function(t,e){if(h.a.log("H265Player.reportDecodeRenderTime",t,e),this.mse&&this.mse.handler&&this.mse.handler.eventEmitter){var i={value:[t,e]};this.mse.handler.eventEmitter.tsdbUtil.sendMetrics([this.mse.handler.stat.createAct("pcdn_video_load_ts",i)])}}},{key:"containerResize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.canvas){var e=this.canvas.clientWidth,i=this.canvas.clientHeight;t.width=e,t.height=i,this.decoder&&this.decoder.postMessage({t:15,d:t})}}},{key:"storeAudioDts",value:function(){var t=this.getPts();this.audioDtsShareBuffer&&this.isPlaying&&Atomics.store(this.audioDtsShareBuffer,0,t)}},{key:"jumpBuffer",value:function(t,e,i,s){this.decoder&&this.decoder.postMessage({t:17,d:{minusBuffer:t,bufLen:e,type:i,timeNow:s}})}}]),t}();e.default=S}])},"9P+k":function(t,e,i){},CvKd:function(t,e,i){"use strict";i.r(e);i("9P+k");var s=i("nfRe"),r=i.n(s);function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a={storeDns:function(t){for(var e="",i=this.getIpsKey(!0),s=t.join("|").toLocaleLowerCase(),r=0,n=s.length;r<n;r++){var a=i[s.charAt(r)],o=Math.random()*a.length>>0;e+=a.charAt(o)}localStorage.wssdns=e},getDns:function(){var t=localStorage.wssdns;if(!t)return[];for(var e="",i=this.getIpsKey(!1),s=0,r=t.length;s<r;s++){e+=i[t.charAt(s)]}return e.split("|")},storeIps:function(t){for(var e="",i=this.getIpsKey(!0),s=t.join("|").toLocaleLowerCase(),r=0,n=s.length;r<n;r++){var a=i[s.charAt(r)],o=Math.random()*a.length>>0;e+=a.charAt(o)}localStorage.wssips=e},getIps:function(){var t=localStorage.wssips;if(!t)return[];for(var e="",i=this.getIpsKey(!1),s=0,r=t.length;s<r;s++){e+=i[t.charAt(s)]}return e.split("|")},getIpsKey:function(t){for(var e=["-",".",":","|"],i="_N1Y%/ny^6?Mi7|wCe#$VmT=.GBut]3L*f<acX2Eop>d}WqKPQ@r;zx!s`(:IHFRZ~[A{Jb-O&D)v0Ukj95,8lg+h4S",s={},r=0;r<40;r++){var n=r<11?3:2,a=i.substr(0,n);i=i.substr(n);var o=r+"";if(r>13?o=String.fromCharCode(r+83):r>9&&(o=e[r-10]),t)s[o]=a;else for(var h=0;h<a.length;h++){s[a.charAt(h)]=o}}return s},compareVersion:function(t,e){for(var i=(t+"").split("."),s=(e+"").split("."),r=i.length,n=s.length,a=Math.min(i.length,s.length),o=0;o<a;o++){var h=parseInt(i[o]),u=parseInt(s[o]);if(h!=u)return h-u}return r==n?0:r-n},deepCopy:function(t,e){e=e||{};for(var i in t)null!=t[i]&&"object"==n(t[i])?(e[i]=t[i].constructor===Array?[]:{},this.deepCopy(t[i],e[i])):e[i]=t[i];return e},NoDrag:function(t,e){e.ondragstart=function(){return!1}},NoSelect:function(t,e){e.onselectstart=function(){return!1}},setCookie:function(t,e,i,s){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3);var n=t+"="+e+"; "+("expires="+r.toUTCString());s&&(n+="; domain="+s),document.cookie=n},getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var n=i[s].trim();if(0==n.indexOf(e))return n.substr(e.length)}return""},clearCookie:function(t){setCookie(t,"",-1)},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null},getPos:function(t){var e=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft,s=t.getBoundingClientRect();return{top:s.top+e,left:s.left+i,right:s.right+i,bottom:s.bottom+e}},parseQueryString:function(t){for(var e=/([^\?\=\&]+)\=([^\?\=\&]*)/g,i={};e.exec(t);)i[RegExp.$1]=RegExp.$2;return i},getStringLength:function(t){for(var e=0,i=t,s=/[^\x00-\xff]/,r=0;r<i.length;r++){var n=i.charAt(r);1==s.test(n)?e+=2:e+=1}return e=Math.ceil(e/2)},unescapeHTML:function(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}},o={ISDEBUG:!1,config:{},VER:"0000",pid:0};o.yyuid=parseInt(a.getCookie("yyuid"))||parseInt(a.getCookie("udb_uid"))||0,o.anonymousUid=0,o.isLogin=o.yyuid>0,o.showDanmu=!1,o.streamInfo=null,o.appid=0,o.topsid=0,o.subsid=0,o.channelId=0,o.profileRoom=0,o.gameId=0,o.hasVideo=!0,o.isPlaying=!1,o.isPause=!1,o.shortlink2room=0,o.H5ROOT="",o.flv="",o.videoData=null,o.pidList="",o.isCsdnTokenTimeout=!1,o.slidesKey="",o.iLineIndex=1,o.isShowLoading=!1,o.codeRate=0,o.curRate=0,o.sCdnType="",o.userId=null,o.isHttps=function(){return-1!=window.location.href.indexOf("https")},o.browerPause=!1,o.beginTime=0,o.wsConnectTime=0,o.reConnectTimes=0,o.wsIps=[],o.httpWs=[],o.badWsIps=[],o.badCode=[],o.wsconnected=!1,o.danmuStatus=0,o.domain_list=[],o.from="",o.arrEmoji=["/{dx","/{pz","/{fn","/{tp","/{jy","/{ot","/{ng","/{hk","/{kz","/{wx","/{se","/{tx","/{lh","/{hp","/{am","/{kun","/{by","/{ka","/{cy","/{kx","/{ll","/{fd","/{yw","/{xu","/{yun","/{zs","/{88","/{qd","/{kl","/{dy","/{hx","/{bz","/{yb","/{dai","/{sj","/{zt","/{gz","/{qq","/{kb","/{wq","/{yx","/{kel","/{bs","/{zk","/{bq","/{ok","/{zan","/{ruo","/{ws","/{sl","/{mg","/{kw","/{wen","/{xd","/{xs","/{lw","/{sd","/{zd","/{dao","/{cc","/{dk","/{hh","/{66","/{jx","/{pu","/{zc","/{fe","/{xk","/{bk","/{hq","/{gl","/{cl","/{sh","/{gd","/{xh","/{sq","/{dg","&#x221C1;","&#x1F601;"],o.regEmoji=new RegExp(o.arrEmoji.join("|"),"g"),o.playerConfig={};var u,c=o,l={},d=null,p={},f={addEvent:function(t,e){return void 0===l[t]&&(l[t]=[]),"function"==typeof e&&l[t].push(e),this},removeEvent:function(t,e){if(null!=t&&t===d)return void 0===p[t]&&(p[t]=[]),p[t].push(e),this;var i=l[t];if("string"==typeof t&&i instanceof Array)if("function"==typeof e){for(var s=0,r=i.length;s<r;s++)if(i[s]===e){i.splice(s,1);break}0==i.length&&delete l[t]}else null==e&&delete l[t];return this},fireEvent:function(t,e){d=t;var i=l[t];if(i instanceof Array)for(var s=0,r=i.length;s<r;s++)"function"==typeof i[s]&&i[s](e);if(d=null,(i=p[t])instanceof Array){for(s=0,r=i.length;s<r;s++)this.removeEvent(t,i[s]);delete p[t]}return this},VIDEO_PLAY:"VIDEO_PLAY",VIDEO_PAUSE:"VIDEO_PAUSE",VIDEO_REFRESH:"VIDEO_REFRESH",SHOW_PLAY_TIPS:"SHOW_PLAY_TIPS",SHOW_BROWER_PAUSE_GUIDE:"SHOW_BROWER_PAUSE_GUIDE",VIDEO_VOLUME:"VIDEO_VOLUME",SET_BITRATE_LIST:"SET_BITRATE_LIST",SET_BITRATE:"SET_BITRATE",HIDE_BITRATE:"HIDE_BITRATE",SWITCH_BITRATE:"SWITCH_BITRAT",SHOW_LOADING:"SHOW_LOADING",HIDE_LOADING:"HIDE_LOADING",HUYA_REPORT:"HUYA_REPORT",PAUSE_VIDEO:"PAUSE_VIDEO",PLAY_VIDEO:"PLAY_VIDEO",SHOW_OR_HIDE_PLAY_STOP_BTN:"SHOW_OR_HIDE_PLAY_STOP_BTN",HIDE_BROWER_PAUSE_GUIDE:"HIDE_BROWER_PAUSE_GUIDE",WEBSOCKET_CONNECTED:"WEBSOCKET_CONNECTED",SERVICE_STOP_VIDEO:"SERVICE_STOP_VIDEO",PLAY_TIPS:"PLAY_TIPS",DATA_METRIC2:"DATA_METRIC2"},_=i("EO7y"),m=i.n(_),y=i("Qy2/"),v=i.n(y),S=!1,g="//live.huya.com/briefs/liverecommend?appid=16&gid=1&uid=0&callback=?";function T(){c.ISDEBUG&&(g="//test.briefsapi.huya.com/briefs/liverecommend?appid=9&gid=1&uid=0&callback=?"),$.getJSON(g,(function(t){var e=JSON.parse(t.data);console.log("<=== RecommendList",e);for(var i=[],s=e.liveList.length>3?3:e.liveList.length,r=0;r<s;r++){var n=e.liveList[r];n.privateHost||(n.privateHost=""),i.push(n)}$(m()()).appendTo("#player-recommend-wrap");for(var a=$("#player-recommend ul"),o=0,h=i;o<h.length;o++){var u=h[o],l=u.yyid,d=u.profileRoom,p=u.privateHost,f=u.screenshot,_=u.intro,y=u.avatar,S=u.nick,g=u.totalCount,T=u.gameName,P=v()({yyid:l,profileRoom:d,privateHost:p,screenshot:f,intro:_,avatar:y,nick:S,totalCount:g,gameName:T});a.append($(P))}$(".player-recommend-vbox").click(E),I(),$(window).resize(w),function(){$("#player-recommend-bg");var t=c.config.avatarImg;c.config&&c.config.avatarImg&&(t=c.config.avatarImg,$("#player-recommend-bg").attr("src",t))}()}))}function w(){clearTimeout(u),u=setTimeout(I,100)}function I(){var t=$("#player-recommend").width(),e=$("#player-recommend").height(),i=(t-20)/280>>0,s=$(".player-recommend-container");i=Math.min(3,Math.max(0,i)),s.width(300*i+38),s.height(250),s.css({left:t-s.width()-20>>1,top:e-s.height()>>1})}function E(t){f.fireEvent(f.HUYA_REPORT,{name:"click/zhibo/jieshutuijian"});var e=t.currentTarget.parentNode,i=$(e).attr("yyid"),s=$(e).attr("profileRoom"),r=$(e).attr("privateHost");console.log(c.ISDEBUG,s,r);var n=location.protocol+"//"+location.host+"/yy/"+i;r?n=location.protocol+"//"+location.host+"/"+r:s&&(n=location.protocol+"//"+location.host+"/"+s),location.href=n}var P={isShow:S,show:function(){S||(S=!0,g=(g=g.replace(/gid=(.+?)&/,"gid="+(c.config.gameId||1)+"&")).replace(/uid=(.+?)&/,"uid="+c.pid+"&"),T(),f.fireEvent(f.SHOW_OR_HIDE_PLAY_STOP_BTN,!1))},hide:function(){f.fireEvent(f.SHOW_OR_HIDE_PLAY_STOP_BTN,!0),S=!1,$(".player-recommend-vbox").unbind("click"),$(window).unbind("resize",w),$("#player-recommend").remove()}},b={log:function(){var t=localStorage.loglevel;"1"!=t&&"3"!=t||window.console.log.apply(console,arguments)}};i("1J4y");function C(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return R(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){o=!0,n=t},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw n}}}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function A(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var k=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.vplayer=e,this.isRefreshing=!1,this.lastRefreshTime=0,this.refreshChannel=0,this.tokenTimeId=0,this.capture=document.createElement("canvas"),this.captureImg=document.getElementById("hy-video-capture"),this.tryPlay=!0,this.isVideoLoad=!1,this.isFirstPlay=!0,this.cacheMetric2=[],this.volume=0,f.addEvent(f.VIDEO_PLAY,this.play.bind(this)),f.addEvent(f.VIDEO_PAUSE,this.pause.bind(this)),f.addEvent(f.VIDEO_REFRESH,this.refresh.bind(this)),f.addEvent(f.VIDEO_VOLUME,this.setVolume.bind(this)),f.addEvent(f.SERVICE_STOP_VIDEO,this.stop.bind(this)),f.addEvent(f.WEBSOCKET_CONNECTED,this.onWebsocketInited.bind(this))}var e,i,s;return e=t,(i=[{key:"initH5player",value:function(){var t=parseInt(localStorage.sdkLogLevel)||1;this.h5player=new window.H5Player({debug:!0}),this.h5player.setIDs(c.appid,c.topsid,c.subsid,c.yyuid),Number(c.config.gameId),this.h5player.setConfig("jitBufLen",4e3),this.h5player.setLogLevel(t),this.h5player.on(H5Player.Events.VIDEO_PLAY,this.onPlayVideo.bind(this)),this.h5player.on(H5Player.Events.VIDEO_STOP,this.onStopVideo.bind(this)),this.h5player.on(H5Player.Events.ANCHOR_STOP,this.onEndVideo.bind(this)),this.h5player.on(H5Player.Events.NO_VIDEO,this.onNoVideo.bind(this)),this.h5player.on(H5Player.Events.H5_PLAYER_ERROR,this.onH5PlayerError.bind(this)),this.h5player.on(H5Player.Events.FLV_URL_UNAVAILABLE,this.onFlvUrlUnavailable.bind(this)),this.h5player.on(H5Player.Events.PLAY_STATUS,this.onPlayStatus.bind(this)),this.h5player.on(H5Player.Events.NO_DATA_RECEIVED,this.onDataReceived.bind(this)),this.h5player.on(H5Player.Events.DATA_METRIC2,this.onDataMetric2.bind(this)),this.h5player.on(H5Player.Events.BROWSER_PAUSE,this.onBrowerPause.bind(this))}},{key:"checkChannelId",value:function(t){var e,i=C(t);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(s.codeRate<=2e3)return s.channelId}}catch(t){i.e(t)}finally{i.f()}return t[0].channelId}},{key:"sortBitRate",value:function(t,e){return e.codeRate-t.codeRate}},{key:"getDisplayName",value:function(t){return t>=2500?"蓝光":t>=1500?"超清":t>=1e3?"高清":t>=800?"标清":"流畅"}},{key:"onPlayVideo",value:function(t,e){e.video.autoplay=!0,c.isPause=!1,c.isPlaying=!0,this.isRefreshing=!1,this.tryPlay=!0,this.video||(window.h5VideoloadTime&&h5VideoloadTime(),this.vplayer.trigger("indexVideoload"),this.isVideoLoad=!0),this.video&&(this.video.pause(),this.video.src="");var i=this.video=e.video;$(i).attr("id","hy-video"),$("#player-video video").remove(),$("#player-video").append(i),this.captureImg.src="",$(this.captureImg).hide(),P.hide(),this.showTip("play",!0),f.fireEvent(f.HIDE_LOADING),this.vplayer.barrage&&this.vplayer.barrage.isShow&&this.vplayer.barrage.setDanmuVisible(!0),this.h5player.setVolume(.01*this.volume),b.log("%c======onPlayVideo","color:#F9F900;background:gray",e)}},{key:"onStopVideo",value:function(t,e){b.log("%c======onStopVideo","color:#F9F900;background:gray",e),b.log(c.isPlaying,c.isPause)}},{key:"onDataReceived",value:function(t,e){b.log("%c======onDataReceived","color:#F9F900;background:gray",e),1==this.tryPlay?(this.playAgain(),this.tryPlay=!1):(P.show(),this.showTip("none"))}},{key:"onEndVideo",value:function(t,e){b.log("%c======onEndVideo","color:#F9F900;background:gray",e),P.show(),this.showTip("none")}},{key:"onNoVideo",value:function(t,e){b.log("%c======onNoVideo","color:#F9F900;background:gray",e),P.show(),this.showTip("none")}},{key:"onH5PlayerError",value:function(t,e){b.log("%c======onH5PlayerError","color:#F9F900;background:gray",e),this.playAgain()}},{key:"onFlvUrlUnavailable",value:function(t,e){b.log("%c======onFlvUrlUnavailable","color:#F9F900;background:gray",e),this.playAgain()}},{key:"onPlayStatus",value:function(t,e){var i=e.status;b.log("%c======onPlayStatus:","color:#F9F800;background:gray",e),"VIDEO_PLAYING"==i&&f.fireEvent(f.HIDE_BROWER_PAUSE_GUIDE)}},{key:"pause",value:function(){if(this.video&&($(this.video).unbind(),this.video.videoWidth>0)){var t=this.video.videoWidth,e=this.video.videoHeight;this.capture.width=t,this.capture.height=e,this.capture.getContext("2d").drawImage(this.video,0,0,t,e),this.captureImg.src=this.capture.toDataURL("image/png"),$(this.captureImg).show()}this.stop(),c.isPause=!0,this.showTip("pause",!0),this.vplayer.barrage&&this.vplayer.barrage.setDanmuVisible(!1),this.refreshChannel=c.channelId}},{key:"stop",value:function(){c.isPlaying=!1,this.h5player.stop()}},{key:"play",value:function(){var t=this.getLiveInfo();if(!c.videoData||!t||0==t.gameStreamInfoList.length){if(P.show(),this.showTip("none"),this.isVideoLoad)return;return this.vplayer.trigger("indexVideoload"),void(this.isVideoLoad=!0)}P.hide(),this.setDisPlay(t),this.intType(),1==c.isCsdnTokenTimeout?(b.log("getCdnToken"),this.getCdnToken()):(b.log("startFlv",t),this.startFlv(t))}},{key:"playAgain",value:function(){var t=Date.now();t-this.lastClickTime<1e3||(this.lastClickTime=t,this.getCdnToken())}},{key:"startFlv",value:function(t){var e=t.gameLiveInfo.codecType,i=this.isH265CodecType(e);this.makeFlv(t,i),b.log("G.flv",c.flv);var s={uid:c.yyuid>0?c.yyuid:c.anonymousUid,sid:c.topsid,subSid:c.subsid,presenterUid:c.pid,lineType:c.iLineIndex,sGuid:a.getCookie("guid"),roomId:c.profileRoom,h5Root:c.H5ROOT,liveType:1};s.url=c.flv,s.originalBitrate=i||c.codeRate!=c.curRate?1:0,s.curBitrate=c.curRate,s.type=H5Player.FLV,s.domainList=this.getDomainList(),s.sFlvUrl=c.streamInfo.sFlvUrl,s.sStreamName=c.streamInfo.sStreamName,s.sFlvAntiCode=c.streamInfo.sFlvAntiCode.replace(/&amp;/g,"&");var r=i||c.codeRate!=c.curRate?c.curRate:0;s.bitrate=r,s.iBitRate=r,this.h5player.start(s);var n=this.isRefreshing?"refresh":"loading";this.showTip(n,!1)}},{key:"getDomainList",value:function(){for(var t=c.domain_list||[],e=[],i=0,s=t.length;i<s;i++)if(c.iLineIndex==t[i].line_index){t[i].flv_domain_list&&(e=t[i].flv_domain_list.concat());break}return e}},{key:"setDisPlay",value:function(t){var e=t.gameLiveInfo.bitRate;c.codeRate=e;var i=this.getDisplayName(e);f.fireEvent(f.SET_BITRATE,i)}},{key:"makeFlv",value:function(t,e){for(var i in t.gameStreamInfoList)t.gameStreamInfoList[i].sFlvUrl&&-1==t.gameStreamInfoList[i].sFlvUrl.indexOf("ws3")||t.gameStreamInfoList.splice(i,1);var s=t.gameStreamInfoList,r=s.length,n=-1;try{this.setRatioByDomainList(s);for(var a=-1,o=[],h=0,u=0;u<r;u++){var l=s[u].iWebPriorityRate;parseInt(l)<0||(h+=l,o.push({index:u,rate:l}),100==l&&(a=u))}if(1==r)n=0;else if(-1!=a)n=a;else for(var d=0,p=Math.random(),f=0,_=o.length;f<_;f++){var m=o[f];if(p<=(d+=m.rate/h)){n=m.index;break}}}catch(t){b.log("makeFlv",t)}-1==n&&(n=parseInt(Math.random()*r)),c.streamInfo=s[n],c.iLineIndex=parseInt(s[n].iLineIndex);var y=s[n].sFlvUrl+"/"+s[n].sStreamName;y+=".flv?",y+=s[n].newCFlvAntiCode,b.log("sStreamName",s[n].sStreamName),c.sCdnType=s[n].sCdnType,c.curRate=c.codeRate,e?c.codeRate>=2e3?(y+="&ratio=2000",c.curRate=2e3):y+="&ratio=".concat(c.codeRate):c.codeRate>2e3&&(y+="&ratio=2000",c.curRate=2e3),c.isHttps()&&(y=y.replace("http","https")),y=y.replace(/&amp;/g,"&"),c.flv=y}},{key:"isH265CodecType",value:function(t){return 1==t||4==t||6==t||8==t}},{key:"setRatioByDomainList",value:function(t){for(var e=c.domain_list||[],i=0,s=e.length;i<s;i++)for(var r=0;r<t.length;r++)t[r].iLineIndex==e[i].line_index&&e[i].line_ratio_web&&(t[r].iWebPriorityRate=e[i].line_ratio_web)}},{key:"getCdnToken",value:function(){this.getJson(this.getCdnTokenRsp.bind(this))}},{key:"getJson",value:function(t){var e,i,s;e=t,i={m:"Stream",do:"getBannerStreamInfo"},s=window.APP_URL+"member/index.php",i.us=c.pidList,i.k=c.slidesKey,$.get(s,i,e,"json")}},{key:"getCdnTokenRsp",value:function(t){b.log("getCdnTokenRsp",t),c.videoData=t.data.data,c.isCsdnTokenTimeout=!1,this.checkTimeOut(),this.play()}},{key:"intType",value:function(){c.topsid=parseInt(c.topsid),c.subsid=parseInt(c.subsid),c.appid=parseInt(c.appid),c.curBitRate=parseInt(c.curBitRate),isNaN(c.curBitRate)&&(c.curBitRate=c.appid)}},{key:"refresh",value:function(){if(!this.isRefreshing){var t=Date.now();t-this.lastRefreshTime<3e3||(b.log("%c======refresh","color:#F9F900;background:gray"),this.lastRefreshTime=t,this.refreshChannel=c.channelId,this.isRefreshing=!0,this.stop(),this.play())}}},{key:"setVolume",value:function(t){t=Math.min(t,100),t=Math.max(t,0),this.volume=t,this.h5player&&(b.log("setVolume",t),this.h5player.setVolume(.01*this.volume))}},{key:"getLiveInfo",value:function(){for(var t in c.videoData)if(c.videoData[t].gameLiveInfo){var e=c.videoData[t].gameLiveInfo.uid;if(c.pid==e)return c.videoData[t]}return null}},{key:"checkTimeOut",value:function(){clearTimeout(this.tokenTimeId),this.tokenTimeId=setTimeout(this.onTimeOut,6e4)}},{key:"onTimeOut",value:function(){c.isCsdnTokenTimeout=!0,b.log("G.isCsdnTokenTimeout = true")}},{key:"showTip",value:function(){}