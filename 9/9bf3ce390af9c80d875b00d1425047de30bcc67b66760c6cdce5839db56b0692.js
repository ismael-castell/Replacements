define("text!cb/site-create/errors.jst",[],function(){return"<%\n    var helpClass = 'help-inline';\n    if (messages.length == 1) {\n        helpClass += ' list-unstyled';\n    }\n%>\n<ul class=\"<%= helpClass %>\">\n<% _.each(messages, function(message) { %>\n    <li><%= message %></li>\n<% }); %>\n</ul>\n"}),define("cb/site-create/site-create",["jquery","underscore","text!cb/site-create/errors.jst"],function(a,b,c){"use strict";var d=".site-create-step",e=function(){var e,f=this;f.initialize=function(){f.cachedNameAvailable={},f.nameCacheTimeToLive=3e4,f.$form=a(".js-create-site-steps"),a(d).find('button[data-role="previous"]').on("click.create-site-steps",f.onClickPrevious),a(d).find('button[data-role="next"]').on("click.create-site-steps",f.onClickNext),a(d).find('button[data-role="default-privacy"]').on("click.create-site-steps",f.onClickDefaultPrivacy),a(d).find('button[data-role="custom-privacy"]').on("click.create-site-steps",f.onClickCustomPrivacy),a(d).find('input[name="privacy"]').on("change.create-site-steps",f.onChangePrivacy),a(d).find('input[name="isSearchable"]').on("change.create-site-steps",f.onChangeCBSearchable),a(d).find("button[data-activate]").on("click.create-site-steps",f.onClickActivate),a(d).find("#name").on("programmatic-change.create-site-steps blur.create-site-steps",f.onChangeName),a("#firstName").on("change.create-site-steps",f.onChangeFirstName),a(d).find("input, select, textarea").on("change.create-site-steps-visual-validation input.site-create-steps-visual-validation",f.onChangeForVisualValidation),f.$form.on("keypress.create-site-steps",f.onKeypress),a(d).find("button[data-skip-step]").on("click.create-site-steps",f.onDataSkipCheck),a(d).find("button[data-activate]").each(function(){var b=a(this);a(b.data("activate")).on("change",{button:b},f.onRadioActivate)}),a('[name="isForSelf"]').on("change.create-site",f.toggleSelfOther),Modernizr.hasEvent("input")?a("#firstName, #lastName").on("input.create-site",f.updateSuggestedTitle):(a("#firstName, #lastName").on("change.create-site blur.create-site",f.updateSuggestedTitle),a("#firstName, #lastName").on("keyup.create-site",function(a){9!==a.keyCode&&f.updateSuggestedTitle.apply(f,[a])})),Modernizr.hasEvent("input")?a("#title").on("input.create-site",f.updateSuggestedName):(a("#title").on("change.create-site blur.create-site",f.updateSuggestedName),a("#title").on("keyup.create-site",function(a){9!==a.keyCode&&f.updateSuggestedName.apply(f,[a])})),Modernizr.hasEvent("input")?a("#firstName, #lastName, #title, #name, #journalPost").on("input.create-site",f.markUserModified):a("#firstName, #lastName, #title, #name, #journalPost").on("change.create-site",f.markUserModified),a("#firstName").triggerHandler("change.create-site-steps"),a('input[name="privacy"]').triggerHandler("change.create-site-steps"),a(".alert-error, .form-group.has-error").size()&&f.handleServerSideErrors(),f.refresh(),a(".hide-when-loaded").remove(),a(".show-when-loaded").removeClass("hidden"),f.toggleSelfOther(),f.updateSuggestedTitle()},f.bindDirtyDetector=function(){a(d+".active").one("blur.create-site-steps change.create-site-steps",function(){f.setDirty(a(this))})},f.clearErrorsForElement=function(a){a.parents(".has-error").find(".help-inline").remove(),a.parents(".has-error").removeClass("has-error")},f.clearErrorsInStep=function(a){a.find(".has-error .help-inline").remove(),a.find(".has-error").removeClass("has-error")},f.clearPageLevelMessages=function(){a("#flash-messages").empty()},f.computeProgress=function(a,b){if(!b.size()||!b.filter(a).size())return 0;var c=b.filter(a)[0],d=b.index(c);return d<0&&(d=0),(d+1)/b.size()},f.doNameLookup=function(b){if(!f.freshNameDataExistsInCache(b))return a.get("/createwebsite/check-availability",{name:b}).done(function(a){f.cachedNameAvailable[b]=a,f.cachedNameAvailable[b].createdAt=window.Date.now()}).fail(function(){delete e[b]});var c=new a.Deferred;return setTimeout(function(){c.resolve(f.cachedNameAvailable[b])},250),c},f.elementIsValid=function(a){return!a.size()||!a.data("validation-lock")&&("undefined"!=typeof a.data("valid")?a.data("valid"):!Modernizr.formvalidation||a[0].checkValidity())},f.freshNameDataExistsInCache=function(a){return!!(f.cachedNameAvailable&&f.cachedNameAvailable[a]&&f.cachedNameAvailable[a].createdAt&&"undefined"!=typeof window.Date&&window.Date&&"function"==typeof window.Date.now)&&window.Date.now()-f.cachedNameAvailable[a].createdAt<=f.nameCacheTimeToLive},f.getAllSteps=function(){return a(d)},f.getShowableSteps=function(){return a(d).filter(function(){return!(a(this).data("skip")||f.stepIsValid(a(this))&&a(this).data("dirty"))})},f.getValidationMessages=function(a){var b=[];return!Modernizr.formvalidation||a.validity.valid?b:(a.validity.patternMismatch&&b.push("Your response doesn’t match the pattern we were expecting"),a.validity.rangeOverflow&&b.push("Your response is too large"),a.validity.rangeUnderflow&&b.push("Your response is too small"),a.validity.stepMismatch&&b.push("Your response must match the scale we’ve set"),a.validity.tooLong&&b.push("Your response is too long"),a.validity.typeMismatch&&b.push("Your response doesn’t match the type we were expecting"),a.validity.valueMissing&&b.push("Please fill out this field"),b)},f.getValidSteps=function(){return a(d).filter(function(){return f.stepIsValid(a(this))})},f.handleServerSideErrors=function(){var b=f.getValidSteps();b.size()&&b.each(function(){f.setDirty(a(this))})},f.markUserModified=function(b){var c=a(b.currentTarget);c.val()!==c.prop("defaultValue")&&a(b.currentTarget).data("user-modified",!0)},f.onChangeCBSearchable=function(){return"high"===a('input[name="privacy"]:checked').val()?(f.setSkip(a("#sc-public-search-listing")),void a('input[name="isGoogleable"][value="0"]').prop("checked","checked")):void("1"===a('input[name="isSearchable"]:checked').val()?f.unsetSkip(a("#sc-public-search-listing")):(f.setSkip(a("#sc-public-search-listing")),a('input[name="isGoogleable"][value="0"]').prop("checked","checked")))},f.onDataSkipCheck=function(b){var c=a(b.currentTarget),e=c.parents(d),g=e.find(a("[data-skippable]")),h=c.data("skipStep"),i=c.data("clearValue");g.each(function(b){a(this).prop("required",!h),h&&i&&a(this).val("")}),"skip-journal"===c.prop("name")&&e.find("#isJournalDraft").val(h),f.onClickNext(b)},f.onChangeFirstName=function(b){var c=a.trim(a(b.currentTarget).val());c?a(".create-other-possessive-name").text(c+"’s"):a(".create-other-possessive-name").text("their")},f.onChangeForVisualValidation=function(b){var c=a(b.currentTarget);f.elementIsValid(c)&&f.clearErrorsForElement(c),f.validateElement(c[0])},f.onChangeName=function(b){var c=a(b.currentTarget);if(!c.data("validation-lock")){var e=c.val();c.data("validation-lock",!0),c.parents(".form-group").removeClass("has-error has-warning has-success"),f.showInlineHelp(c,['<img alt="" src="/assets/images/spinner.gif" /> Checking availability...']),c.parents(d).prop("disabled",!0),f.doNameLookup(e).done(function(a){return c.data("validation-lock",!1),c.val()!==e&&c.trigger("programmatic-change"),a.sanitized&&a.sanitized!==e&&(c.val(a.sanitized),c.trigger("programmatic-change")),a.valid?(c.data("valid",!0),c.parents(".form-group"),f.showInlineHelp(c,["Address is available"]),void c.parents(d).prop("disabled",!1)):(c.data("valid",!1),c.parents(".form-group").addClass("has-warning"),a.suggest&&(c.val(a.suggest),c.data("valid",!0),c.parents(d).prop("disabled",!1)),void(a.messages?f.showInlineHelp(c,a.messages):f.showInlineHelp(c,["Address is unavailable"])))}).fail(function(){c.data("validation-lock",!1),c.data("valid",!0),c.parents(".form-group").removeClass("has-warning"),c.parents(d).prop("disabled",!1)})}},f.onChangePrivacy=function(){"high"===a('input[name="privacy"]:checked').val()?f.setSkip(a("#sc-public-search-listing")):f.unsetSkip(a("#sc-public-search-listing")),"low"===a('input[name="privacy"]:checked').val()||"medium"===a('input[name="privacy"]:checked').val()?(f.setSkip(a("#sc-custom-cb-search")),a('input[name="isSearchable"][value="1"]').prop("checked","checked")):f.unsetSkip(a("#sc-custom-cb-search")),"low"===a('input[name="privacy"]:checked').val()?f.setSkip(a("#sc-recaptcha")):f.unsetSkip(a("#sc-recaptcha"))},f.onClickActivate=function(b){var c=a(b.currentTarget);if(a(c.data("activate")).prop("checked",!0).trigger("change"),c.data("advanceSteps"))f.onClickNext(b);else{var e=a(b.currentTarget).parents(d);e.find(".secondary-content.hidden").removeClass("hidden")}},f.onClickCustomPrivacy=function(b){f.unsetSkip(a("#sc-custom-privacy")),f.unsetSkip(a("#sc-custom-cb-search")),f.onClickNext(b)},f.onClickDefaultPrivacy=function(b){f.setSkip(a("#sc-custom-privacy")),f.setSkip(a("#sc-custom-cb-search")),f.onClickNext(b),a('input[name="privacy"][value="medium"]').prop("checked",!0),a('input[name="isSearchable"][value="1"]').prop("checked",!0)},f.onClickNext=function(b){var c=a(b.currentTarget).parents(d);c.data("dirty",!0),f.clearPageLevelMessages(),f.validateStep(c),f.refresh()},f.onClickPrevious=function(b){var c=a(b.currentTarget).parents(d);f.unsetDirty(c);var e=c.prevAll(".site-create-step").filter(function(){return!a(this).data("skip")}).first();e.size()&&(f.unsetDirty(e),f.refresh())},f.onKeypress=function(b){return 13!==b.keyCode||void(a(b.target).is("input")&&(b.preventDefault(),a(b.target).trigger("change").trigger("programmatic-change"),a(b.target).parents(d).find('button[data-role="next"]').trigger("click")))},f.onRadioActivate=function(b){var c=a(b.currentTarget),d=a(b.data.button),e=a('[name="'+c.attr("name")+'"]');c.prop("checked")&&(e.each(function(){a('[data-activate="#'+this.id+'"]').removeClass("active")}),d.addClass("active"))},f.refresh=function(){var b=f.getShowableSteps();b.size()||("1"===a("#enableRecaptchaV3").val()?window.grecaptcha.ready(function(){window.grecaptcha.execute(a("#recaptchaV3PublicKey").val(),{action:"create_site"}).then(function(b){return a("#recaptcha_token").val(b),a("#recaptcha_action").val("create_site"),f.$form.unbind("submit").submit(),!0})}):f.$form.unbind("submit").submit()),a(d).removeClass("active"),b.first().addClass("active"),a(".site-create-steps").offset()&&a(".site-create-steps").offset().top&&a("html, body").animate({scrollTop:a(".site-create-steps").offset().top-250},250),f.updateProgressBar(a(d+".active").find("div.progress-bar"),f.computeProgress(".active",f.getAllSteps())),f.bindDirtyDetector()},f.removeInlineHelp=function(a){a.parents(".form-group").find(".help-inline").remove()},f.setDirty=function(a){a.data("dirty",!0)},f.setSkip=function(a){a.data("skip",!0)},f.showInlineHelp=function(a,d){f.removeInlineHelp(a),d&&d.length&&a.parents(".form-group").append(b.template(c,{messages:d}))},f.stepIsValid=function(b){if(b.find(".has-error").size()&&!b.data("dirty"))return!1;if(!Modernizr.formvalidation)return!0;var c=b.find("input, select, textarea").filter(function(){return!f.elementIsValid(a(this))});return!c.size()},f.toggleSelfOther=function(){var b=a('select[name="isForSelf"], input[name="isForSelf"]:checked').val(),c=!1;"0"===b?(a("span.create-self").hide(),a("span.create-other").show(),a("#firstName, #lastName").each(function(){a(this).val()===a(this).data("profile")&&(a(this).val("").trigger("programmatic-change"),c=!0)}),c&&f.updateSuggestedTitle()):(a("span.create-self").show(),a("span.create-other").hide(),a("#firstName, #lastName").each(function(){a(this).val()||(a(this).val(a(this).data("profile")).trigger("programmatic-change"),c=!0)}),c&&f.updateSuggestedTitle()),f.updateSuggestedJournalPost()},f.unsetDirty=function(a){a.data("dirty",!1)},f.unsetSkip=function(a){a.data("skip",!1)},f.updateProgressBar=function(a,b){a.size()&&(b<0&&(b=0),b>1&&(b=1),a.prop("aria-valuenow",100*b).css("width",100*b+"%").find(".progress-bar-value").text(100*b))},f.updateSuggestedName=function(){var b=a("#name");if(!b.data("user-modified")){var c=a("#title");if(c.size()){var d=c.val().replace(/[^A-Za-z0-9\.\-]*/g,"");d=d.replace(/[^A-Za-z0-9]*$/g,""),d=d.replace(/[^A-Za-z]*/,""),d=a.trim(d).toLowerCase(),b.val(d),b.trigger("programmatic-change")}}},f.updateSuggestedTitle=function(){var b=a("#title");if(!b.data("user-modified")){var c=a("#firstName").val()+" "+a("#lastName").val(),d=a("<div>"+c+"</div>").text();d=a.trim(d).substring(0,25),b.val(d),b.trigger("programmatic-change"),f.updateSuggestedName(),f.updateSuggestedJournalPost()}},f.updateSuggestedJournalPost=function(){var b=a("#journalPost");if(!b.data("user-modified")){var c="1"===a('select[name="isForSelf"], input[name="isForSelf"]:checked').val(),d=c?"my":a("#firstName").val()+"’s",e=c?"I":"We",f=c?"my":"our";b.val("This is "+d+" CaringBridge site. "+e+" will be using this site to inform family and friends about "+d+" health journey and progress. Make sure you keep updated on "+f+" site by clicking the 'Follow' button. Your support is appreciated."),b.trigger("programmatic-change")}},f.validateElement=function(b){if(Modernizr.formvalidation){f.clearErrorsForElement(a(b));var c=f.getValidationMessages(b);c&&c.length&&(a(b).parents(".form-group").addClass("has-error"),f.showInlineHelp(a(b),c))}},f.validateStep=function(a){Modernizr.formvalidation&&(f.clearErrorsInStep(a),a.find("input, select, textarea").each(function(){f.validateElement(this)}))}};return e}),require(["jquery","cb/site-create/site-create"],function(a,b){"use strict";a(function(){a(".js-create-site-steps").size()&&(new b).initialize()})}),define("cb/site-create/main",function(){}),require(["jquery"],function(a){"use strict";var b=function(){var b=this;this.renderError=function(){this.setText(),a(".geo-link .icon").css("color","#af1e26"),a("#flash-messages").html('<div class="alert alert-error">Unable to determine your geographical location.</div>')},this.get=function(b,c){var d="#geo-"+b,e=a(d);return e.size()?e.val():c},this.set=function(c,d){var e="geo-"+c,f=a("#"+e);return f.size()&&f.remove(),f=a('<input id="'+e+'" class="geo-report" type="hidden" name="'+e+'" value="'+d+'"/>'),b.$link.after(f),this},this.reportStatus=function(c){return a("#geo-status").remove(),c+=' <img src="/assets/images/spinner.gif" alt=""/>',b.$el.after('<div id="geo-status"><i class="icon-map-marker"></i> '+c+"</div>"),this},this.reportError=function(){return a("#geo-status").remove(),b.$el.after('<div id="geo-status" style="color: red;">Unable to determine your location.</div>'),this},this.reportLocation=function(c){return a("#geo-status").remove(),b.$el.after('<div id="geo-status"><i class="icon-map-marker"></i> <button class="close" type="button">&times;</button><small class="muted">Location:</small> <span>'+c+"</span></div>"),this},this.requestServer=function(){b.reportStatus("Searching");var c=this.get("lat",0),d=this.get("lng",0);return a.get("/geo/"+c+"/"+d).done(function(c){b.reportLocation(c.city+", "+c.state),b.set("city",c.city).set("state",c.state).set("lat",c.lat).set("lng",c.lng),b.$link.css("color","#333333"),a("#state").size()&&a("#city").size()&&(a("#state").val(c.state),a("#city").val(c.city),a("#geo-status").remove())}).fail(function(){b.reportError("Unknown"),b.$link.css("color","red")}),this},this.onClick=function(a){return a.preventDefault(),navigator.geolocation?(b.reportStatus("Requesting Permission"),void navigator.geolocation.getCurrentPosition(function(a){b.set("lat",a.coords.latitude).set("lat",a.coords.longitude),b.requestServer()},function(){b.requestServer()},{timeout:1e4})):void b.requestServer()},this.onDismiss=function(c){c.preventDefault(),a("#geo-status").remove(),b.$el.find(".geo-report").remove()},this.initialize=function(c,d){b.$el=a(c),b.$link=a(d),b.$link.click(b.onClick),a(document).on("click","#geo-status .close",b.onDismiss)}};a(function(){var c=a("#upload-bar");c.size()&&(new b).initialize(c,a("#bar-action-geo")),c=a("#location-geo").parents(".input-group-btn"),c.size()&&(new b).initialize(c,a("#location-geo"))})}),define("cb/geo/main",function(){}),define("text!cb/hoverable/task.jst",[],function(){return'<button class="close close-hoverable" type="button">&times;</button>\n<div class="hoverable-task">\n    <h4 class="user-generated"><%= title %></h4>\n    <div class="body">\n        <span class="user-generated"><%= body %></span>\n        <% if (linkDecline) { %>\n            <p><i>Assigned to you</i></p>\n        <% } %>\n    </div>\n    <div class="when">\n        <p>When: <small><%= when %></small></p>\n    </div>\n    <div class="btn-group">\n        <a href="<%= link %>" class="btn btn-default">Details</a>\n        <% if (linkAccept) { %>\n            <a href="<%= linkAccept %>" class="btn btn-default" data-qa-id="hover-accept-task">Accept this task</a>\n        <% } %>\n        <% if (linkDecline) { %>\n            <a href="<%= linkDecline %>" class="btn btn-default" data-qa-id="hover-decline-task">Decline this task</a>\n        <% } %>\n    </div>\n</div>\n'}),define("text!cb/hoverable/profile.jst",[],function(){return'<button class="close close-hoverable" type="button">&times;</button>\n<div class="media">\n    <span class="pull-left">\n        <img class="media-object" src="<%= photo %>" alt="<%= name %>" />\n    </span>\n    <div class="media-body">\n        <h4 class="media-heading user-generated"><%= name %></h4>\n        <div class="last-activity"><small class="text-muted"><%= activity %></small></div>\n    </div>\n</div>\n<div class="btn-group">\n    <a href="<%= linkMessage %>" class="btn btn-default">\n        <i class="icon-envelope" aria-hidden="true" role="presentation"></i>\n        Message\n    </a>\n    <a href="<%= linkProfile %>" class="btn btn-default">\n        Profile\n    </a>\n</div>\n'}),define("cb/hoverable/main",["jquery","underscore","text!cb/templates/error.jst","text!cb/hoverable/task.jst","text!cb/hoverable/profile.jst","bootstrap"],function(a,b,c,d,e){"use strict";var f=function(){this.delay=500,this.timer=null,this.$el=null,this.makeRequest=function(){var c,f,g=this.$el.attr("href"),h=this;this.$el.removeClass("loading");var i=this.$el.parentsUntil(".popover-container").parent();i&&i.data("popover-container")&&(c=i.data("popover-container")),a.ajax({url:this.$el.attr("href"),dataType:"json"}).done(function(i){if(a(".popover").remove(),g.indexOf("planner")!==-1)f=d;else{if(g.indexOf("profile")===-1)return void h.renderError.apply(h,[""]);f=e}h.$el.attr("title",""),c?h.$el.popover({content:b.template(f,i),placement:"bottom",trigger:"manual",html:!0,container:c}):h.$el.popover({content:b.template(f,i),placement:"bottom",trigger:"manual",html:!0}),h.$el.popover("show")}).fail(function(){h.renderError.apply(h,[""])})},this.showLoading=function(){var a=this;this.$el.addClass("loading"),this.timer=setTimeout(function(){a.makeRequest.apply(a,[])},this.delay)},this.initialize=function(){var b=this;a(document).on("click.close-hoverable",".close-hoverable",function(c){c.preventDefault(),a(c.currentTarget).parents(".hoverable").popover("destruct"),b.cancelActions()}),a(document).on("mouseenter focus",".hoverable",function(c){b.timeout&&a(c.currentTarget)===b.$el||(b.cancelActions.apply(b,[]),b.$el=a(c.currentTarget),b.timer=setTimeout(function(){b.showLoading.apply(b,[])},b.delay))}),a(document).on("mouseleave focus",".hoverable",function(){a(".popover").size()||b.cancelActions.apply(b,[])})},this.cancelActions=function(){a(".popover").remove(),this.timer&&(clearTimeout(this.timer),this.timer=null),this.$el&&this.$el.removeClass("loading")},this.renderError=function(d){a("#flash-messages").prepend(b.template(c,{message:d}))}};a(function(){var a=new f;a.initialize.apply(a,[])})}),define("text!cb/site-privacy/contact.jst",[],function(){return'<li>\n    <label class="checkbox">\n        <input type="checkbox" name="<%= action %>-<%= email.id %>" value="1" class="access-list-remove-item" data-item-id="<%= email.id %>"/>\n        <%= email.address %>\n    </label>\n</li>\n'}),require(["jquery","underscore","text!cb/site-privacy/contact.jst"],function(a,b,c){"use strict";var d=function(){var d=this;this.isPasswordToggled=function(){return a("#hasPassword:checked").size()},this.togglePassword=function(){this.isPasswordToggled()?a("#password-controls").removeClass("hidden"):a("#password-controls").addClass("hidden")},this.togglePrivacy=function(){var b=a('input[name="privacy"]:checked').val();a("#submit-btn").attr("data-ga-label",b),"high"===b?(a(".high-controls").removeClass("hidden"),a(".medium-controls").addClass("hidden")):"medium"===b?(a(".high-controls").addClass("hidden"),a(".medium-controls").removeClass("hidden")):(a(".high-controls").addClass("hidden"),a(".medium-controls").addClass("hidden"))},this.toggleBlockList=function(){a("#block-visitors:checked").size()?a(".medium-controls .inner-access-list").removeClass("hidden"):a(".medium-controls .inner-access-list").addClass("hidden")},this.addContactToList=function(d,e){e.preventDefault();var f=a(e.currentTarget);f.after(' <img src="/assets/images/spinner.gif" alt="" class="loading"/>'),f.attr("disabled","disabled"),a("#access-list-"+d).attr("disabled","disabled"),a(".alert-error").remove();var g=function(){a(".access-list .loading").remove(),f.removeAttr("disabled"),a("#access-list-"+d).removeAttr("disabled")};a.post(f.data("src"),{address:a("#access-list-"+d).val()}).done(function(e){g(),a("#access-list-"+d).val(""),a("#access-list-"+d+"-container").removeClass("hidden"),a("#access-list-"+d+"-container ul li").remove(),a(e.addresses).each(function(e,f){a("#access-list-"+d+"-container ul").append(b.template(c,{email:f,action:d}))})}).fail(function(){g(),a("#access-list-"+d).before('<div class="alert alert-error">The email address(es) you entered do not appear to be valid. Please correct any errors and try again.</div>')})},this.removeContactFromList=function(b,c){c.preventDefault();var d=a(c.currentTarget),e=d.parents(".access-list");d.after(' <img src="/assets/images/spinner.gif" alt="" class="loading"/>'),d.attr("disabled","disabled");var f=[];e.find(".access-list-remove-item:checked").each(function(b,c){f.push(a(c).data("item-id"))}),e.find(".access-list-remove-item").attr("disabled","disabled"),a.post(d.data("src"),{ids:f}).done(function(){e.find(".access-list-remove-item:checked").each(function(b,c){a(c).parents("li").first().remove()}),e.find(".access-list-remove-item").removeAttr("disabled"),a(".access-list .loading").remove(),d.removeAttr("disabled")}).fail(function(){a("#site-privacy").submit()})},d.onIsSearchableChange=function(){"yes"===a('input[name="isSearchable"]:checked').val()?(a(".js-show-if-cb-searchable").removeClass("hidden"),a(".js-show-if-not-cb-searchable").addClass("hidden")):"no"===a('input[name="isSearchable"]:checked').val()&&(a(".js-show-if-cb-searchable").addClass("hidden"),a(".js-show-if-not-cb-searchable").removeClass("hidden"),a('input[name="isGoogleable"][value="no"]').prop("checked","checked"))},d.onIsGoogleableChange=function(){"yes"===a('input[name="isGoogleable"]:checked').val()?(a(".js-show-if-googleable").removeClass("hidden"),a(".js-show-if-not-googleable").addClass("hidden")):"no"===a('input[name="isGoogleable"]:checked').val()&&(a(".js-show-if-googleable").addClass("hidden"),a(".js-show-if-not-googleable").removeClass("hidden"))},this.initialize=function(){d.initialized||(d.initialized=!0,a('input[name="hasPassword"]').change(function(a){d.togglePassword.apply(d,[a])}),a('#privacy, input[name="privacy"]').change(function(a){d.togglePrivacy.apply(d,[a])}),a("#block-visitors").change(function(a){d.toggleBlockList.apply(d,[a])}),a(".medium-controls .access-list-add").click(function(a){d.addContactToList.apply(d,["block",a])}),a(".medium-controls .access-list-remove").click(function(a){d.removeContactFromList.apply(d,["block",a])}),a(".high-controls .access-list-add").click(function(a){d.addContactToList.apply(d,["allow",a])}),a(".high-controls .access-list-remove").click(function(a){d.removeContactFromList.apply(d,["allow",a])}),a('input[name="isSearchable"]').on("change.site-privacy",d.onIsSearchableChange),a('input[name="isGoogleable"]').on("change.site-privacy",d.onIsGoogleableChange),a('input[name="isSearchable"]').trigger("change.site-privacy"),a('input[name="isGoogleable"]').trigger("change.site-privacy"))}};a(function(){a("#site-privacy").size()&&(new d).initialize()})}),define("cb/site-privacy/main",function(){}),require(["jquery","underscore","text!cb/site-privacy/contact.jst"],function(a,b,c){"use strict";var d=function(){var d=this;this.allowAccess=function(d,e){this.reduceRequestCount(),e.preventDefault();var f=a(e.currentTarget),g=f.parents(".access-request-row");g.remove(),f.after(' <img src="/assets/images/spinner.gif" alt="" class="loading"/>'),f.attr("disabled","disabled"),a("#access-list-"+d).attr("disabled","disabled"),a.post(f.data("src"),{address:a("#access-list-"+d).val()}).done(function(e){a("#access-list-"+d).val(""),a("#access-list-"+d+"-container").removeClass("hidden"),a("#access-list-"+d+"-container ul li").remove(),a("#access-list-allow-container ul").length&&(a("#access-list-allow-container ul li:contains("+e.address+")").length||a("#access-list-allow-container ul").append(b.template(c,{email:{address:e.address,id:e.id},action:d})))}).fail(function(){a("#pending-request-list").before('<div class="alert alert-error">It appears there was a failure trying to approve this request.  Please try again.</div>')})},this.denyAccess=function(b){this.reduceRequestCount();var c=a(b.currentTarget),d=c.parents(".access-request-row");c.after(' <img src="/assets/images/spinner.gif" alt="" class="loading"/>'),c.attr("disabled","disabled"),d.remove(),a.post(c.data("src"),{}).done(function(){a(".access-list .loading").remove(),c.removeAttr("disabled")})},this.reduceRequestCount=function(b){var c=parseInt(a("#request-count-num").text(),10);c--,a("#request-count-num").text(c),a("#request-count-text").text(1===c?"Pending Request":"Pending Requests"),this.hideTableBorder()},this.hideTableBorder=function(b){var c=parseInt(a("#request-count-num").text(),10);0===c&&a("#pending-request-container").hide()},this.bindButtons=function(b){a(".access-request-add").click(function(a){d.allowAccess.apply(d,["block",a])}),a(".access-request-deny").click(function(a){d.denyAccess.apply(d,[a])})},this.initialize=function(){d.initialized||(d.initialized=!0,this.bindButtons(),this.hideTableBorder(),a(".js-infinite-scroll").on("load-more-complete",this.bindButtons))}};a(function(){a("#pending-request-list").size()&&(new d).initialize()})}),define("cb/visitors/main",function(){}),require(["jquery","bootstrap"],function(a){"use strict";var b=a("#general-settings");if(b.size()){var c=function(){var c=this;this.toggleCustomCondtion=function(){var b=a(a("#healthCondition").data("target"));"Other|Other"===a("#healthCondition").val()?b.collapse("show"):b.collapse("hide")},this.toggleCustomFacility=function(){var b=a("#facilityLocation, #facilityName");a(this).is(":checked")?b.prop("disabled",!0).attr("disabled","disabled"):b.removeProp("disabled").removeAttr("disabled")},this.toggleCommentReplies=function(){var b=a('input[name="enableCommentReplies"]:checked').val();"0"===b?a("#commentSubmitButton").attr("data-ga-label","Disable Comment Replies"):a("#commentSubmitButton").attr("data-ga-label","Enable Comment Replies")},this.onExpand=function(b){a(b.target).prop("aria-hidden","false").prop("aria-disabled","false").find("input, select, textarea").prop("tabIndex","0")},this.onCollapse=function(b){a(b.target).prop("aria-hidden","true").prop("aria-disabled","true").find("input, select, textarea").prop("tabIndex","-1")},this.defaultCustomValues=function(){a("#customFacilityName").val()||a("#customFacilityName").val(a("#facilityName").find("option:selected").text()),a("#customFacilityState").val()||a("#customFacilityState").val(a("#facilityLocation").val())},this.initialize=function(){b.on("change.healthCondition","#healthCondition",c.toggleCustomCondtion),c.toggleCustomCondtion(),a('input[name="enableCommentReplies"]').change(function(a){c.toggleCommentReplies.apply(c,[a])}),b.on("show.bs.collapse",".customFacility",c.onExpand),b.on("hide.bs.collapse",".customFacility",c.onCollapse);var d=b.find(".customFacility").addClass("collapse");d.filter(".in").triggerHandler("show.bs.collapse"),d.filter(":not(.in)").triggerHandler("hide.bs.collapse"),b.on("change.customFacility","#isCustomFacility",c.toggleCustomFacility),b.on("change.facility","#facilityLocation, #facilityName",c.defaultCustomValues),c.defaultCustomValues()}};a(function(){(new c).initialize()})}}),define("cb/site-settings-general/main",function(){}),define("cb/media-stand-alone/media-stand-alone",["jquery","cb/photo/view","cb/picker/main"],function(a,b){"use strict";var c=function(a){return!a.photo.isEmpty()},d=function(a){var b=a.data.mediaStandAlone;c(b)||(b.hidePicker(),b.showPhotoAdd(),b.showPhotoContainer(),b.photo.add())},e=function(a){var b=a.data.mediaStandAlone;c(b)||(b.hidePhotoAdd(),b.hidePhotoContainer(),b.showPicker())},f=function(a){a.photo.on("all",function(){a.refresh()}),a.$container.on("loaded",{mediaStandAlone:a},function(a){d(a)}),a.$container.find(".js-media-attachment-control-photo").on("click.media-stand-alone",{mediaStandAlone:a},d),a.$container.find(".js-media-attachment-control-picker").on("click.media-stand-alone",{mediaStandAlone:a},e)},g=function(c){this.$container=a(c),this.photo=c.cbPhotoView||new b(this.$container),f(this),this.refresh()};return g.prototype.refresh=function(){this.showPhotoContainer(),c(this)?this.hidePhotoAdd():this.$container.trigger("loaded")},g.prototype.hidePhotoAdd=function(){this.$container.find(".js-media-attachment-stage-photo").addClass("hidden"),this.$container.find(".js-media-attachment-info").removeClass("hidden")},g.prototype.hidePhotoContainer=function(){this.$container.find(".media-attachment-container-photo").addClass("hidden")},g.prototype.hidePicker=function(){this.$container.find(".media-attachment-container-picker, .js-media-attachment-container-picker").addClass("hidden")},g.prototype.showPhotoAdd=function(){this.$container.find(".js-media-attachment-stage-photo").removeClass("hidden"),this.$container.find(".js-media-attachment-info").addClass("hidden")},g.prototype.showPhotoContainer=function(){this.$container.find(".media-attachment-container-photo").removeClass("hidden")},g.prototype.showPicker=function(){this.$container.find(".media-attachment-container-picker, .js-media-attachment-container-picker").removeClass("hidden")},g}),require(["jquery","cb/media-stand-alone/media-stand-alone"],function(a,b){"use strict";a(function(){a(".js-media-attachments-stand-alone").each(function(){this.cbMediaStandAlone=new b(this)})})}),define("cb/media-stand-alone/main",function(){}),require(["jquery"],function(a){"use strict";var b=a("#cover-photo");if(b.size()){var c=function(){this.initialize=function(){var b=a('input[name="theme"]:checked');b.offset()&&b.offset().top||(b=a(".custom-preview")),b.offset()&&b.offset().top&&a("html, body").animate({scrollTop:b.offset().top-250},250)}};a(function(){(new c).initialize()})}}),define("cb/site-theme/main",function(){}),require(["jquery","cb/bar/bar"],function(a,b){"use strict";a(function(){var c=".js-media-attachments",d=function(){a(this).parents(".js-late-init").size()>0||(this.cbBar=new b(this))};a(c).each(d),a(".overview-feeds").on("load-feed-complete",function(b){a(b.relatedTarget).find(c).each(d)})})}),define("cb/bar/main",function(){}),require(["jquery"],function(a){"use strict";var b=a("#manage-notifications-form");if(b.size()){var c=function(){this.toggleCheckbox=function(){a(this).is(":checked")?a(a(this).data("target")).slideDown("fast"):a(a(this).data("target")).slideUp("fast")},this.toggleSiteAllNotifications=function(b){b.stopPropagation();var c=a(b.currentTarget);c.is("label")&&(c=c.find("input:checkbox"));var d,e=c.parents(".panel"),f=e.find(".panel-collapse input:checkbox");c.is(":checked")?(e.removeClass("muted"),d=c.data("checked-message"),c.prop("title",d).prev("span").html(d),f.each(function(){a(this).prop("checked",a(this).prop("defaultChecked"))})):(e.addClass("muted"),d=c.data("unchecked-message"),
c.prop("title",d).prev("span").html(d),f.each(function(){a(this).prop("checked",!1)}))},this.toggleSiteSingleNotification=function(b){var c=a(b.currentTarget),d=c.parents(".panel"),e=d.find(".site-notifications-toggle");return c.is(":checked")?(d.removeClass("muted"),void e.prop("checked",!0)):void(0===d.find(".panel-collapse input:checked").size()&&(d.addClass("muted"),e.prop("checked",!1)))},this.preventCollapse=function(a){a.stopPropagation()},this.onExpand=function(c){b.find(".panel").removeClass("expanded"),a(c.target).parents(".panel").addClass("expanded").find(".panel-collapse").prop("aria-hidden","false").prop("tabIndex","0").prop("aria-disabled","false")},this.onCollapse=function(b){a(b.target).parents(".panel").removeClass("expanded").find(".panel-collapse").prop("aria-hidden","true").prop("tabIndex","-1").prop("aria-disabled","true")},this.showSiteWithCheckboxFocus=function(b){a(b.target).parents(".panel-collapse").not(".in").collapse("show")},this.accordionKeyboardHandler=function(b){if("keydown"===b.type){if(13!==b.which&&32!==b.which||(b.preventDefault(),a(a(b.target).data("target")).collapse("toggle")),38===b.which){b.preventDefault();var c=a(b.target).parents(".panel").prev(".panel").find('[data-toggle="collapse"]');c.size()&&c.focus()}if(40===b.which){b.preventDefault();var d=a(b.target).parents(".panel").next(".panel").find('[data-toggle="collapse"]');d.size()&&d.focus()}}},this.initialize=function(){b.find(".panel-collapse:not(.in)").addClass("collapse").prop("aria-hidden","true").prop("tabIndex","-1"),b.find(".panel-collapse.in").prop("aria-hidden","false").prop("tabIndex","0"),b.on("change.toggle-checkbox",'[data-toggle="checkbox-toggle"]',this.toggleCheckbox),b.find(b.find('[data-toggle="checkbox-toggle"]:not(:checked)').data("target")).hide(),b.on("click",".site-notifications-toggle, .site-toggle-container",this.toggleSiteAllNotifications),b.on("click",".js-no-collapse",this.preventCollapse),b.on("change",".site-notification",this.toggleSiteSingleNotification),b.on("focus",".site-notification",this.showSiteWithCheckboxFocus),b.on("keydown",'[data-toggle="collapse"]',this.accordionKeyboardHandler),b.on("show.bs.collapse",".panel-group",this.onExpand),b.on("hide.bs.collapse",".panel-group",this.onCollapse),a("#site-notifications .panel-collapse:not(.in)").collapse("hide"),window.location.hash?a(window.location.hash).find(".panel-collapse").collapse("show"):a("#site-notifications .panel-collapse").first().collapse("show")}};a(function(){(new c).initialize()})}}),define("cb/manage-notifications/main",function(){}),define("cb/dismiss/dismiss",["jquery"],function(a){"use strict";var b=function(){var b=this;this.dismissContent=function(b){b.preventDefault();var c,d=a(b.currentTarget);c=d.data("target")?d.parents(d.data("target")):d.parent(),c.slideUp("fast"),a.post(d.attr("href")).fail(function(){document.location.href=d.attr("href")})},this.initialize=function(){a(".dismiss").on("click.dismiss",b.dismissContent)}};return new b}),require(["jquery","cb/dismiss/dismiss"],function(a,b){"use strict";a(function(){a(".dismiss").size()&&b.initialize()})}),define("cb/dismiss/main",function(){}),require(["jquery","cb/autosave/autosave"],function(a,b){"use strict";a(function(){a("form.autosave").each(function(){b.initialize(a(this))})})}),define("cb/autosave/main",function(){}),define("cb/form-confirm-navigate-away/main",["jquery"],function(a){"use strict";var b=function(){var b=this;this.setNavigationConfirmation=function(b){a(window).on("beforeunload",function(){return b})},this.clearNavigationConfirmation=function(){a(window).off("beforeunload")},this.markFormClean=function(){b.formIsDirty=!1,b.clearNavigationConfirmation()},this.markFormDirty=function(){b.formIsDirty||(b.formIsDirty=!0,b.setNavigationConfirmation('Your preferences will not be saved if you leave without clicking the "Save Changes" button below.'))},this.initialize=function(){var c=a("form.confirm-navigate");c.find("input, select, textarea").one("change.confirm-navigate keyup.confirm-navigate keydown.autosave",b.markFormDirty),c.on("submit.confirm-navigate",b.markFormClean)}};a(function(){a("form.confirm-navigate").size()&&(new b).initialize()})}),require(["jquery","vendor/jquery.cookie"],function(a){"use strict";a(".client-timezone").each(function(){var b=Intl.DateTimeFormat().resolvedOptions().timeZone;a(this).val(b),a.cookie("tz",b,{path:"/"})}),a(function(){a('select[name="tz"]').size()&&(a(document).on("change.timezone",'select[name="tz"]',function(b){a.removeCookie("tz"),a.cookie("tz",a(b.target).val(),{path:"/"})}),a(document).on("click.timezone","#btn-timezone-refresh",function(){"undefined"!=typeof location&&location.reload(!0)}))})}),define("cb/timezone/main",function(){}),define("text!cb/modal-photo-thumbnail/modal-photo-viewer.jst",[],function(){return'<div id="photo-viewer" class="modal fade gallery-container modal-viewer photo-viewer vertical-centered" id="modal-photos" role="dialog" tabindex="-1">\n    <div class="photo-viewer-container">\n        <span class="close-viewer-container">\n            <button type="button" class="close-viewer close" data-dismiss="modal">\n                <span class="icon-remove"></span>\n                <span class="sr-only">Close</span>\n            </button>\n        </span>\n        <div class="photo-viewer-image-area vertical-centered js-swipeable-container">\n            <button class="left carousel-control js-previous" data-target="#photo-carousel" role="button" data-slide="prev">\n                <span class="icon-chevron-left"></span>\n                <span class="sr-only">Previous</span>\n            </button>\n            <button class="right carousel-control js-next" data-target="#photo-carousel" role="button" data-slide="next">\n                <span class="icon-chevron-right"></span>\n                <span class="sr-only">Next</span>\n            </button>\n            <img class="loader" src="/assets/images/loader.gif"/>\n            <div id="photo-carousel" class="carousel" data-interval="false" data-wrap="false">\n                <div class="carousel-inner">\n                <% _.each(photos, function(photo) { %>\n                    <div class="item <%= photo.active ? \'active\' : \'\' %>">\n                        <img src="<%= photo.src %>" class="img-responsive img-inline" alt="<%= photo.caption %>">\n                        <div class="photo-viewer-caption text-center"><%= photo.caption %></div>\n                    </div>\n                <% }); %>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("cb/swipeable/swipeable",["jquery"],function(a){"use strict";var b=function(){var b=this,c=10,d=0;this.swipe=function(b){if(Math.abs(d-c)>30){var e=a(b.target),f=e;e.hasClass("js-swipeable-container")||(f=e.parents(".js-swipeable-container")),d>c?f.find(".js-previous").click():d<c&&f.find(".js-next").click()}},this.recordTouchStart=function(a){c=a.originalEvent.changedTouches[0].screenX},this.recordTouchEnd=function(a){d=a.originalEvent.changedTouches[0].screenX,b.swipe(a)},this.initialize=function(){a(".js-swipeable-container").on("touchstart",b.recordTouchStart),a(".js-swipeable-container").on("touchend",b.recordTouchEnd)}};return b}),define("cb/modal-photo-thumbnail/modal-photo-viewer",["jquery","underscore","text!cb/modal-photo-thumbnail/modal-photo-viewer.jst","cb/swipeable/swipeable"],function(a,b,c,d){"use strict";var e={bindKeyStrokes:function(b){a(document).on("keydown",function(a){a.preventDefault();var c=a.keyCode?a.keyCode:a.which;37===c?b.find(".js-previous").click():39===c?b.find(".js-next").click():27===c&&b.modal("hide")})},handleCarouselControl:function(a,b,c){a.find(".js-previous").toggle(b>0),a.find(".js-next").toggle(b<c-1)},onSlide:function(b,c){var d=a(c.target),f=d.find(".carousel-inner > .item").length,g=a(c.relatedTarget).index();e.handleCarouselControl(b,g,f)}},f=function(a){this.$thumbnails=a.find('[data-toggle="modal-photo-thumbnail"]')};return f.prototype.initialize=function(){this.$thumbnails.on("click.modal-photo-thumbnail",function(f){var g=a(f.currentTarget);f.preventDefault();var h=g.data("photo-index"),i=[];g.closest(".photo-container").find(".js-carousel-viewer").each(function(){var b=a(this).find("img");i.push({caption:b.attr("alt")||"",src:a(this).attr("href"),index:a(this).data("photo-index"),active:h===a(this).data("photo-index")})});var j=a(b.template(c,{photos:i}));j.on("show.bs.modal",function(){e.bindKeyStrokes(j),e.handleCarouselControl(j,h,i.length),(new d).initialize()}),j.on("hidden.bs.modal",function(){a(document).off("keydown"),j.remove()}),j.find("#photo-carousel").on("slide.bs.carousel",function(a){e.onSlide(j,a)}),g.after(j),j.modal("show")})},f}),require(["jquery","cb/modal-photo-thumbnail/modal-photo-viewer"],function(a,b){"use strict";a(function(){var c=new b(a("body"));c.initialize(),a(".js-infinite-scroll").on("load-more-complete",function(c,d){if(d instanceof Array)for(var e=0,f=d.length;e<f;e++)new b(a(d[e])).initialize();else new b(a(d)).initialize()})})}),define("cb/modal-photo-thumbnail/main",function(){}),define("cb/support/message-model",["backbone"],function(a){"use strict";return a.Model.extend({defaults:{supportTitle:"",supportMessage:""},initialize:function(){}})}),define("cb/support/support-links-model",["backbone"],function(a){"use strict";return a.Model.extend({defaults:{links:{gofundme:{url:"",hasCampaign:""},mealtrain:{url:"",hasMealTrain:""},other:[],shipt:{email:"",hasActiveShipt:""}}},initialize:function(){}})}),define("text!cb/support/modal-add-gofundme.jst",[],function(){return'<div id="modal-add-gofundme" class="modal fade support-modal" tabindex="-1" data-ga-label-prefix="Add GoFundMe Link - ">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <form method="post" enctype="multipart/form-data" action="">\n                <div class="modal-header text-center">\n                    <button\n                         type="button"\n                         class="close"\n                         data-dismiss="modal"\n                         title="Close"\n                         data-ga-label="x"\n                         data-ga-action="Click - button"\n                         data-qa-id"support-add-gofundme-close-0">\n                             &times;\n                    </button>\n                    <h3 class="modal-title">Already have a GoFundMe fundraiser?</h3>\n                </div>\n                <div class="modal-body">\n                    <p class="modal-description">Enter your link below so that visitors can easily donate.</p>\n                    <div>\n                        <p>Supported link formats:</p>\n                        <ul class="gofundme-link-format">\n                            <li>https://gofundme.com/mysite</li>\n                            <li>https://gofund.me/mysite</li>\n                            <li>https://gofundme.com/f/mysite</li>\n                            <li>https://gofund.me/f/mysite</li>\n                        </ul>\n                    </div>\n                    <input type="url" class="form-control" id="campaign-url" placeholder="https://gofundme.com/mysite" data-qa-id="gofundme-campaign-url" pattern="^(?:[hH][tT]{2}[pP][sS]?:\\/\\/)?(?:[wW]{3}\\.)?(?:[gG][oO][fF][uU][nN][dD][mM][eE]\\.[cC][oO][mM]|[gG][oO][fF][uU][nN][dD]\\.[mM][eE]|[gG][oO][fF][uU][nN][dD][mM][eE]\\.[cC][oO][mM]\\/[fF]|[gG][oO][fF][uU][nN][dD]\\.[mM][eE]\\/[fF])\\/[^\\/]+\\/?(?:[?#][^\\/]+)?$"/><br/>\n                    <p class="error-msg"></p>\n                </div>\n                <div class="modal-footer">\n                     <button\n                         class="submit-modal btn btn-primary"\n                         type="submit"\n                         data-ga-label="Save"\n                         data-ga-action="Click - button"\n                         data-qa-id="support-links-edit-submit">\n                         Save\n                     </button>\n                     <button\n                         class="clear-form btn btn-link"\n                         type="button"\n                         data-ga-label="clear"\n                         data-ga-action="Click - button"\n                         data-qa-id="support-add-gofundme-clear">\n                         Clear\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/support/modal-add-link.jst",[],function(){return'<div id="modal-add-link" class="modal fade support-modal" tabindex="-1" data-ga-label-prefix="Add Your Additional Support - ">\n    <div class="modal-dialog ">\n        <div class="modal-content">\n            <form method="post" enctype="multipart/form-data" action="">\n                <div class="modal-header text-center">\n                    <button\n                        type="button"\n                        class="close"\n                        data-dismiss="modal"\n                        title="Close"\n                        data-ga-label="x"\n                        data-ga-action="Click - button"\n                        data-qa-id"support-links-edit-close-0">\n                            &times;\n                    </button>\n                    <h1 class="modal-title">Add Your Additional Support</h1>\n                    <p>You\'re welcome to add up to 3 links here:</p>\n                </div>\n                <div class="modal-body">\n                    <% var numberWords = [ \'Zero\', \'First\', \'Second\', \'Third\', \'Fourth\' ]; %> \n                    <% _.each([1,2,3], function(index) { %>                \n                        <div class="well">\n                            <p class="h3 text-center"><%= index %>. Add your <%= numberWords[index] %> Support Link</p>\n                            <input type="hidden" id="site<%= index %>Id" class="site-id" data-id="" />\n                            <div class="site-entry-controls">\n                                <div>\n                                    <label for="site<%= index %>Url">Enter Support Link Here</label><br/>\n                                    <input type="url" class="site-url" id="site<%= index %>Url" name="site<%= index %>Url" placeholder="http://www.support.com/" pattern="https?://.+\\.[a-z]{2,3}?([^?#]*)(\\?([^#]*))?(#(.*))?"/>\n                                    <p class="error-msg"></p>\n                                </div>\n                                <div>\n                                    <label for="site<%= index %>Name">Enter Link Label Here</label><br/>\n                                    <input type="text" class="site-label" id="site<%= index %>Name" name="site<%= index %>Name" placeholder="Support Me at Site" maxlength="30" />\n                                    <p class="error-msg"></p>\n                                </div>\n                            </div>\n                            <p class="text-center"><button data-id="<%= index-1 %>" class="btn btn-sm btn-tertiary clear-fields">Clear Fields</button></p>\n                        </div>\n                    <% }); %>\n                    <p id="support-otherlinks-error" class="error-msg"></p>\n                </div>\n                <div class="modal-footer">\n                    <button \n                        class="submit-modal btn btn-primary"\n                        type="submit"\n                        data-ga-label="Save"\n                        data-ga-action="Click - button"\n                        data-qa-id="support-links-edit-save">\n                        Save\n                    </button>\n                    <button\n                        class="btn btn-link"\n                        data-dismiss="modal"\n                        type="button"\n                        data-ga-label="x"\n                        data-ga-action="Click - button"\n                        data-qa-id="support-links-edit-close-1">\n                        Cancel\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/support/modal-add-mealtrain.jst",[],function(){return'<div id="modal-add-mealtrain" class="modal fade support-modal" tabindex="-1" data-ga-label-prefix="Add Meal Train Link - ">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <form method="post" enctype="multipart/form-data" action="">\n                <div class="modal-header text-center">\n                    <button\n                         type="button"\n                         class="close"\n                         data-dismiss="modal"\n                         title="Close"\n                         data-ga-label="x"\n                         data-ga-action="Click - button"\n                         data-qa-id"support-add-mealtrain-close">\n                             &times;\n                    </button>\n                    <h2 class="modal-title mealtrain-modal-title">\n                        Add Your Meal Train Page\n                    </h2>\n                </div>\n                <div class="modal-body">\n                    <p class="modal-description mealtrain-body">\n                        CaringBridge has partnered with Meal Train to organize meals for families on health journeys.\n                    </p>\n                    <div id="rectangle" class="mealtrain-rectangle">\n                        <div>\n                            <p class="mealtrain-subtext">\n                                Enter the unique link for your Meal Train page that appears on the Meal Train site.\n                            </p>\n                        </div>\n                        <div class="mealtrain-url">\n                            <input type="url"\n                                   class="form-control"\n                                   id="mealtrain-url"\n                                    placeholder="https://www.mealtrain.com/xXxXxX"\n                                    data-qa-id="mealtrain-url"\n                                    pattern="^(?:[hH][tT]{2}[pP][sS]?:\\/\\/)?(?:[wW]{3}\\.)?(?:[mM][eE][aA][lL][tT][rR][aA][iI][nN]\\.[cC][oO][mM])\\/[^\\/]+\\/?(?:[?#][^\\/]+)?$"/>\n                             <br/>\n                        </div>\n                        <div class="modal-footer mealtrain-footer">\n                            <button\n                                 class="clear-form btn btn-tertiary"\n                                 type="button"\n                                 data-ga-label="clear"\n                                 data-ga-action="Click - button"\n                                 data-qa-id="support-add-mealtrain-clear">\n                                 Clear Field\n                            </button>\n                        </div>\n                    </div>\n                    <p class="error-msg"></p>\n                </div>\n                <div class="modal-footer">\n                     <button\n                         class="submit-modal btn btn-primary"\n                         type="submit"\n                         data-ga-label="Save"\n                         data-ga-action="Click - button"\n                         data-qa-id="support-add-mealtrain-submit">\n                         Save\n                     </button>\n                     <button\n                         class="cancel-form btn btn-link"\n                         data-dismiss="modal"\n                         type="button"\n                         data-ga-label="cancel"\n                         data-ga-action="Click - button"\n                         data-qa-id="support-add-mealtrain-cancel">\n                         Cancel\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/support/modal-add-shipt.jst",[],function(){return'<div id="modal-add-shipt" class="modal fade support-modal" tabindex="-1" data-ga-label-prefix="Add Shipt - ">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <form method="post" enctype="multipart/form-data" action="">\n                <div class="modal-header text-center">\n                    <button\n                        type="button"\n                        class="close"\n                        data-dismiss="modal"\n                        title="Close"\n                        data-ga-label="x"\n                        data-ga-action="Click - button"\n                        data-qa-id"support-add-shipt-close">\n                    &times;\n                    </button>\n                    <h2 class="modal-title shipt-modal-title">\n                        How Family and Friends<br/>Can Help With Your Shopping\n                    </h2>\n                </div>\n                <div class="modal-body">\n                    <p class="modal-description shipt-modal-sub-title">\n                        Through a partnership with Shipt, you may accept offers from family and friends to order your groceries or arrange delivery at your convenience.\n                    </p>\n                    <div id="rectangle" class="shipt-rectangle">\n                        <div>\n                            <p class="shipt-subtext">\n                                Family and friends will reach out to you personally, via the email address you use for CaringBridge, or any email you choose:\n                            </p>\n                        </div>\n                        <div class="shipt-email">\n                            <label for="shipt-email" class="shipt-email-label">Email Address</label><br/>\n                            <input type="email"\n                                   name="shipt-email"\n                                   class="form-control"\n                                   id="shipt-email"\n                                   placeholder=""\n                                   data-qa-id="shipt-email"\n                            />\n                            <p class="error-msg"></p>\n                        </div>\n                        <div class="modal-footer shipt-footer">\n                            <button\n                                class="clear-form btn btn-tertiary"\n                                type="button"\n                                data-ga-label="clear email address"\n                                data-ga-action="Click - button"\n                                data-qa-id="support-add-shipt-clear">\n                                Clear Email Address\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                <div class="modal-footer">\n                    <button\n                        class="submit-modal btn btn-primary"\n                        type="submit"\n                        data-ga-label="Save"\n                        data-ga-action="Click - button"\n                        data-qa-id="support-add-shipt-submit">\n                        Save\n                    </button>\n                    <button\n                        class="cancel-form btn btn-tertiary"\n                        data-dismiss="modal"\n                        type="button"\n                        data-ga-label="cancel"\n                        data-ga-action="Click - button"\n                        data-qa-id="support-add-shipt-cancel">\n                        Cancel\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>\n'}),define("cb/support/view",["jquery","underscore","backbone","cb/support/message-model","cb/support/support-links-model","text!cb/support/modal-add-gofundme.jst","text!cb/support/modal-add-link.jst","text!cb/support/modal-add-mealtrain.jst","text!cb/support/modal-add-shipt.jst","bootstrap"],function(a,b,c,d,e,f,g,h,i){"use strict";return c.View.extend({EDIT_FIELD_DATA:{title:{editField:"support-title",helpField:"support-title-help",maxLength:50},message:{editField:"support-message",helpField:"support-message-help",maxLength:250}},initialize:function(){this.msgModel=new d,this.linksModel=new e,this.setElement(a(".support-container")),this.updateModelFromView(),this.$(".js-popover-help-text").popover()},events:{"click .edit-view-control":"edit","click #cancel-support-text":"cancel","keyup #support-title":"validateTitle","click #save-support-text":"saveMessage","keyup #support-message":"validateMessage","click .edit-gofundme":"modalEditGoFundMe","click .edit-mealtrain":"modalEditMealTrain","click .support-add-link":"modalAddLink","click .support-edit-links":"modalAddLink","click .support-box":"clearNotification","click .add-shipt":"modalAddShipt"},clearNotification:function(b){var c=a(b.target).closest(".support-box"),d=c.attr("id");"gofundme"!==d||c.hasClass("low-privacy")||a.ajax({url:"support/update/count?category="+d,method:"PUT"}).success(function(a){c.find(".support-unread-items-badge").addClass("hide")}),"mealtrain"!==d||c.hasClass("low-privacy")||a.ajax({url:"support/update/count?category="+d,method:"PUT"}).success(function(a){c.find(".support-unread-items-badge").addClass("hide")}),"shipt"!==d||c.hasClass("low-privacy")||a.ajax({url:"support/update/count?category="+d,method:"PUT"}).success(function(a){c.find(".support-unread-items-badge").addClass("hide")})},render:function(){this.updateViewFromModel(),this.$("#support-title-container").removeClass("editable-field"),this.$("#support-title").removeAttr("contenteditable"),this.$("#support-message").removeClass("editable-field").removeAttr("contenteditable"),this.$(".edit-submission-control").addClass("hide"),this.$(".edit-view-control").removeClass("hide"),this.$(".error-msg").addClass("hide")},edit:function(a){a.preventDefault(),this.$("#support-title-container").addClass("editable-field"),this.$("#support-title").attr("contenteditable","true").css("outline","none"),this.$("#support-message").addClass("editable-field").attr("contenteditable","true"),this.$(".edit-submission-control").removeClass("hide"),this.$(".edit-view-control").addClass("hide"),this.$("#support-title").focus()},cancel:function(){this.render()},saveMessage:function(){var b=this;this.updateModelFromView(),a.ajax({url:"support/update/message",method:"PUT",data:JSON.stringify(this.msgModel),dataType:"json"}).done(function(a){b.msgModel.attributes.supportTitle=a.supportTitle,b.msgModel.attributes.supportMessage=a.supportMessage,b.render()}).fail(function(c){var d=a.parseJSON(c.responseText);a("#support-message-help").html(d.message).removeClass("hide"),b.edit()})},validateTitle:function(b){return this.validateFieldLength(a(b.target),"title")},validateMessage:function(b){return this.validateFieldLength(a(b.target),"message")},validateFieldLength:function(b,c){return b.text().length>this.EDIT_FIELD_DATA[c].maxLength?(a("#"+this.EDIT_FIELD_DATA[c].helpField).hasClass("hide")&&(a("#"+this.EDIT_FIELD_DATA[c].helpField).html("The "+c+" is limited to "+this.EDIT_FIELD_DATA[c].maxLength+" characters.").removeClass("hide"),a("#save-support-text").attr("disabled","disabled")),!1):(a("#"+this.EDIT_FIELD_DATA[c].helpField).addClass("hide"),this.areAllFieldsValid()&&a("#save-support-text").attr("disabled",!1),!0)},areAllFieldsValid:function(){var b=!0;for(var c in this.EDIT_FIELD_DATA)if(a("#"+this.EDIT_FIELD_DATA[c].editField).text().length>this.EDIT_FIELD_DATA[c].maxLength){b=!1;break}return b},updateModelFromView:function(){this.msgModel.attributes.supportTitle=a.trim(this.$("#support-title").text()),this.msgModel.attributes.supportMessage=a.trim(this.$("#support-message").text());var b=this.linksModel;b.attributes.links.other=[],a(".other-support-link").each(function(c,d){var e={};e.id=a(d).attr("data-id"),e.label=a.trim(a(d).text()),e.url=a(d).attr("href"),e.orderIndex=c,e.label&&e.url&&(b.attributes.links.other[c]=e)}),b.attributes.links.gofundme.url=a(".gofundme-link").attr("href"),b.attributes.links.gofundme.hasCampaign=a('[name="hasCampaign"]').val(),b.attributes.links.mealtrain.url=a(".mealtrain-link").attr("href"),b.attributes.links.mealtrain.hasMealTrain=a('[name="hasMealTrain"]').val(),b.attributes.links.shipt.hasActiveShipt=a('[name="hasActiveShipt"]').val(),b.attributes.links.shipt.email=a('[name="defaultModalEmail"]').val()},updateViewFromModel:function(){this.$("#support-title").html(this.msgModel.get("supportTitle")),this.$("#support-message").html(this.msgModel.get("supportMessage")),this.updateViewFromOtherLinksModel(),a(".gofundme-link").attr("href",this.linksModel.attributes.links.gofundme.url),a('[name="hasCampaign"]').val(this.linksModel.attributes.links.gofundme.hasCampaign),a(".mealtrain-link").attr("href",this.linksModel.attributes.links.mealtrain.url),a('[name="hasMealTrain"]').val(this.linksModel.attributes.links.mealtrain.hasMealTrain),a('[name="hasActiveShipt"]').val(this.linksModel.attributes.links.shipt.hasActiveShipt),a('[name="defaultModalEmail"]').val(this.linksModel.attributes.links.shipt.email),"yes"===this.linksModel.attributes.links.gofundme.hasCampaign?(a(".gfm-post-setup").removeClass("hide"),a(".gfm-initial-setup").addClass("hide")):(a(".gfm-post-setup").addClass("hide"),a(".gfm-initial-setup").removeClass("hide")),"yes"===this.linksModel.attributes.links.mealtrain.hasMealTrain?(a(".mealtrain-post-setup").removeClass("hide"),a(".mealtrain-initial-setup").addClass("hide")):(a(".mealtrain-post-setup").addClass("hide"),a(".mealtrain-initial-setup").removeClass("hide")),"yes"===this.linksModel.attributes.links.shipt.hasActiveShipt?(a(".shipt-author-active").removeClass("hide"),a(".shipt-author-inactive").addClass("hide")):(a(".shipt-author-active").addClass("hide"),a(".shipt-author-inactive").removeClass("hide"))},updateViewFromOtherLinksModel:function(){var b=this.linksModel.attributes.links.other.length;0===b?(this.$(".other-support-no-links").removeClass("hide"),this.$(".other-support-has-links").addClass("hide")):(this.$(".other-support-no-links").addClass("hide"),this.$(".other-support-has-links").removeClass("hide")),this.linksModel.attributes.links.other.forEach(function(b,c){a(a(".other-support-link")[c]).removeClass("hide"),a(a(".other-support-link")[c]).attr("data-id",b.id).attr("href",b.url).html(b.label)});for(var c=2;c>b-1;--c)a(a(".other-support-link")[c]).addClass("hide")},modalEditGoFundMe:function(c){c.preventDefault();var d=this;a("#modal-add-gofundme").remove(),a("body").prepend(b.template(f,{}));var e=a("#modal-add-gofundme");e.modal({backdrop:!0,keyboard:!0,show:!0}),"yes"===a('[name="hasCampaign"]').val()?e.find("#campaign-url").val(d.linksModel.attributes.links.gofundme.url):e.find("#campaign-url").val("https://"),a("#campaign-url").bind("blur",function(){var b=a.trim(this.value);return""===b?(this.value=b,this.value):(/^https?:\/\//i.test(b)||(b="https://"+b),this.value=b,this.value)}),e.on("submit","form",d,function(b){var c=b.data;b.preventDefault(),e.find(".submit-modal").attr("disabled","disabled").addClass("waiting"),e.find(".error-msg").addClass("hide"),a("#campaign-url").get(0).checkValidity()?(c.linksModel.attributes.links.gofundme.url=e.find("#campaign-url").val(),a.ajax({url:"support/update/gofundme",method:"PUT",data:JSON.stringify(c.linksModel.attributes.links.gofundme),dataType:"json"}).done(function(){e.modal("hide"),""!==c.linksModel.attributes.links.gofundme.url?c.linksModel.attributes.links.gofundme.hasCampaign="yes":c.linksModel.attributes.links.gofundme.hasCampaign="no",c.render()}).fail(function(b){var c=a.parseJSON(b.responseText);e.find(".error-msg").html(c.message).removeClass("hide"),e.find(".submit-modal").removeAttr("disabled").removeClass("waiting")})):(e.find(".error-msg").removeClass("hide").text("Invalid URL"),e.find(".submit-modal").removeAttr("disabled").removeClass("waiting"))}).on("click",".clear-form",function(a){a.preventDefault(),e.find("#campaign-url").val(""),
e.find(".error-msg").addClass("hide")})},deleteGoFundMe:function(a){a.preventDefault()},modalEditMealTrain:function(c){c.preventDefault();var d=this;a("#modal-add-mealtrain").remove(),a("body").prepend(b.template(h,{}));var e=a("#modal-add-mealtrain");e.modal({backdrop:!0,keyboard:!0,show:!0}),"yes"===a('[name="hasMealTrain"]').val()?e.find("#mealtrain-url").val(d.linksModel.attributes.links.mealtrain.url):e.find("#mealtrain-url").val(""),a("#mealtrain-url").bind("blur",function(){var b=a.trim(this.value);return""===b?(this.value=b,this.value):(/^https?:\/\//i.test(b)||(b="https://"+b),this.value=b,this.value)}),e.on("submit","form",d,function(b){var c=b.data;b.preventDefault(),e.find(".submit-modal").attr("disabled","disabled").addClass("waiting"),e.find(".error-msg").addClass("hide"),a("#mealtrain-url").get(0).checkValidity()?(c.linksModel.attributes.links.mealtrain.url=e.find("#mealtrain-url").val(),a.ajax({url:"support/update/mealtrain",method:"PUT",data:JSON.stringify(c.linksModel.attributes.links.mealtrain),dataType:"json"}).done(function(){e.modal("hide"),""!==c.linksModel.attributes.links.mealtrain.url?c.linksModel.attributes.links.mealtrain.hasMealTrain="yes":c.linksModel.attributes.links.mealtrain.hasMealTrain="no",c.render()}).fail(function(b){var c=a.parseJSON(b.responseText);e.find(".error-msg").html(c.message).removeClass("hide"),e.find(".submit-modal").removeAttr("disabled").removeClass("waiting")})):(e.find(".error-msg").removeClass("hide").text("Invalid URL"),e.find(".submit-modal").removeAttr("disabled").removeClass("waiting"))}).on("click",".clear-form",function(a){a.preventDefault(),e.find("#mealtrain-url").val(""),e.find(".error-msg").addClass("hide")})},deleteMealTrain:function(a){a.preventDefault()},modalAddShipt:function(c){c.preventDefault();var d=this;a("#modal-add-shipt").remove(),a("body").prepend(b.template(i,{}));var e=a("#modal-add-shipt");e.modal({backdrop:!0,keyboard:!0,show:!0}),e.find("#shipt-email").val(d.linksModel.attributes.links.shipt.email),e.on("submit","form",d,function(b){var c=b.data;b.preventDefault(),e.find(".submit-modal").attr("disabled","disabled").addClass("waiting"),e.find(".error-msg").addClass("hide"),a("#shipt-email")[0].checkValidity()?(c.linksModel.attributes.links.shipt.email=e.find("#shipt-email").val(),a.ajax({url:"support/update/shipt",method:"PUT",data:JSON.stringify(c.linksModel.attributes.links.shipt),dataType:"json"}).done(function(b){e.modal("hide"),""!==b.email?(c.linksModel.attributes.links.shipt.hasActiveShipt="yes",c.linksModel.attributes.links.shipt.email=b.email):(c.linksModel.attributes.links.shipt.hasActiveShipt="no",c.linksModel.attributes.links.shipt.email=a('[name="displayEmail"]').val()),c.render()}).fail(function(b){var d=a.parseJSON(b.responseText);c.linksModel.attributes.links.shipt.email=a('[name="defaultModalEmail"]').val(),e.find(".error-msg").html(d.message).removeClass("hide"),e.find(".submit-modal").removeAttr("disabled").removeClass("waiting")})):(e.find(".error-msg").removeClass("hide").html("Please enter your email address in format:</br>yourname@example.com"),e.find(".submit-modal").removeAttr("disabled").removeClass("waiting"))}).on("click",".clear-form",function(a){a.preventDefault(),e.find("#shipt-email").val(""),e.find(".error-msg").addClass("hide")})},modalAddLink:function(c){c.preventDefault();var d=this;a("#modal-add-link").remove(),a("body").prepend(b.template(g,{})),d.linksModel.attributes.links.other.forEach(function(b,c){a(a(".site-id")[c]).attr("data-id",b.id),a(a(".site-label")[c]).val(b.label),a(a(".site-url")[c]).val(b.url)});var e=a("#modal-add-link");e.modal({backdrop:!0,keyboard:!0,show:!0}),a(".site-url").bind("blur",function(){var b=a.trim(this.value);return/^https?:\/\//.test(b)||(b="http://"+b),this.value=b,this.value}),e.on("submit","form",d,function(c){var d=c.data;c.preventDefault(),e.find(".submit-modal").attr("disabled","disabled").addClass("waiting"),e.find(".error-msg").addClass("hide");var f=[],g=[],h=[];e.find(".site-id").each(function(b,c){f[b]=a(c).attr("data-id")?a(c).attr("data-id"):""}),e.find(".site-label").each(function(b,c){g[b]=a.trim(a(c).val())}),e.find(".site-url").each(function(b,c){h[b]=a.trim(a(c).val())}),e.find("error-msg").addClass("hide");var i=!0,j=[];b.range(e.find(".site-label").length).forEach(function(b){var c=a(e.find(".site-url")[b]),f=a(e.find(".error-msg")[2*b]),g=a(e.find(".site-label")[b]),h=a(e.find(".error-msg")[2*b+1]);if(a.trim(a(c).val())||a.trim(a(g).val())){var k=d.isValidSupportLinkLabel(g,h),l=d.isValidSupportLinkUrl(c,f);if(k&&l){var m={};m.id=a.trim(a(e.find(".site-id")[b]).attr("data-id")),m.label=a.trim(a(g).val()),m.url=a.trim(a(c).val()),m.orderIndex=b,j.push(m)}else i=!1}}),i?(d.updateModelFromView(),a.ajax({url:"support/update/otherlinks",method:"PUT",data:JSON.stringify(j),dataType:"json"}).done(function(){e.modal("hide"),d.linksModel.attributes.links.other=j,d.render()}).fail(function(b){var c=a.parseJSON(b.responseText);e.find("#support-otherlinks-error").html(c.message).removeClass("hide"),e.find(".submit-modal").removeAttr("disabled").removeClass("waiting")})):e.find(".submit-modal").removeAttr("disabled").removeClass("waiting")}).on("click",".clear-fields",function(b){b.preventDefault(),d.modalClearFields(a(this).attr("data-id"))})},modalClearFields:function(b){a(a(".site-label")[b]).val(""),a(a(".site-url")[b]).val("")},isValidSupportLinkLabel:function(b,c){return!(a.trim(a(b).val()).length<1||a.trim(a(b).val()).length>30)||(a(c).text("Name must be between 1 and 30 characters.").removeClass("hide"),!1)},isValidSupportLinkUrl:function(b,c){return a.trim(a(b).val()).length<1?(a(c).text("URL is required.").removeClass("hide"),!1):!!a(b)[0].checkValidity()||(a(c).removeClass("hide").text("Invalid URL"),!1)}})}),define("cb/support/main",["jquery","cb/support/view"],function(a,b){"use strict";var c=new b;return a(function(){c.render()}),c}),define("cb/youtube-expander/youtube-expander",[],function(){"use strict";var a="data-youtube",b="data-youtube-params",c="data-youtube-autoplay",d="data-ga-category",e={buildPlayer:function(a,b){var c=a.container.ownerDocument,d=c.createElement("div");d.className="video hidden",d.id="youtube"+Math.round(1e15*Math.random()),a.container.parentNode.insertBefore(d,a.container),"undefined"==typeof a.api&&(a.api=window.YT);new a.api.Player(d.id,{height:a.container.offsetHeight,width:a.container.offsetWidth,videoId:a.videoId,playerVars:a.videoParams,events:{onReady:function(c){e.onPlayerReady.call(this,c,a,b)}}})},initializeApi:function(a,b){b=b||function(){};var c=a.container.ownerDocument,d=c.defaultView||c.parentWindow,f=c.getElementById("youtube-api");if(f)return a.api=d.YT,void e.registerEvent(a);f=c.createElement("script"),f.src="https://www.youtube.com/iframe_api",f.id="youtube-api";var g=c.getElementsByTagName("script")[0];g.parentNode.insertBefore(f,g),d.onYouTubeIframeAPIReady=function(){a.api=d.YT,e.registerEvent(a),b(a)}},onClickLink:function(a,b){a.preventDefault(),b.expand()},onPlayerReady:function(a,b,c){e.showPlayer(a.target.a),a.target.playVideo();var d=b.videoId;if("function"==typeof a.target.getVideoData){var f=a.target.getVideoData();d=f.title+" ("+f.video_id+")"}e.sendEventToGoogleAnalytics("Play Video",b.category,d),c()},registerEvent:function(a){for(var b=0,c=a.events.length;b<c;b++)a.container.addEventListener?a.container.addEventListener(a.events[b][0],a.events[b][1]):a.container.attachEvent&&a.container.attachEvent("on"+a.events[b][0],a.events[b][1])},showPlayer:function(a){var b="hidden";a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")},videoIdFromUrl:function(a){if("string"!=typeof a)return null;var b=/^(?:http(?:s)?:\/\/)?(?:www\.)?(?:m\.)?(?:youtu\.be\/|youtube\.com\/(?:(?:watch)?\?(?:.*&)?v(?:i)?=|(?:embed|v|vi|user)\/))([^\?&\"'>]+)/,c=a.match(b);return c&&c.length>1?c[1]:null},videoParamsFromUrl:function(a){if(null===a)return{};var b={},c=a.split("&");return c.forEach(function(a){var c=a.split("=");b[c[0]]=c[1]}),b},sendEventToGoogleAnalytics:function(a,b,c){window.dataLayer=window.dataLayer||[],window.dataLayer.push({eventCategory:b,eventAction:a,eventLabel:c,event:"trackEvent"})},apiInitialized:function(a){a.autoplay&&a.expand()}},f=function(f){var g=this;this.container=f,this.events=[],this.url=null,this.container.hasAttribute(a)&&(this.url=this.container.getAttribute(a)),this.params=null,this.container.hasAttribute(b)&&(this.params=this.container.getAttribute(b)),this.autoplay=!1,this.container.hasAttribute(c)&&(this.autoplay="true"===this.container.getAttribute(c)),this.category="YouTube Video",this.container.hasAttribute(d)&&(this.category=this.category+" - "+this.container.getAttribute(d)),this.videoId=e.videoIdFromUrl(this.url),this.videoParams=e.videoParamsFromUrl(this.params),null!==this.videoId&&(this.events.push(["click",function(a){e.onClickLink.call(this,a,g)}]),e.initializeApi(this,e.apiInitialized)),Object.defineProperty&&Object.defineProperty(this,"methods",{value:e,writable:!1,enumerable:!0,configurable:!0})};return f.prototype.expand=function(){var a=this;a.expanded||null!==this.url&&e.buildPlayer(this,function(){a.container.parentNode.removeChild(a.container),a.expanded=!0})},f}),require(["jquery","cb/youtube-expander/youtube-expander"],function(a,b){"use strict";a(function(){var c="a[data-youtube]",d=function(){this.youtubeLink=new b(this)},e=function(b){a(b).find(".js-infinite-scroll").on("load-more-complete",function(b,c){if(c instanceof Array)for(var e=0,f=c.length;e<f;e++)a(c[e]).find("a[data-youtube]").each(d);else a(c).find("a[data-youtube]").each(d)})};a("a[data-youtube]").each(d),e(document),a(".overview-feeds").on("load-feed-complete",function(b){a(b.relatedTarget).find(c).each(d),e(b.relatedTarget)})})}),define("cb/youtube-expander/main",function(){}),define("cb/date-separator/date-separator",[],function(){"use strict";var a=["January","February","March","April","May","June","July","August","September","October","November","December"],b={dateCompare:function(a,b){if(!(a instanceof Date&&b instanceof Date))return null;var c=a.getTime(),d=b.getTime();return c===d?0:c>d?1:c<d?-1:null},fetchDate:function(a,b){var c=a.getAttribute(b)||null;if(null!==c){var d=new Date(c);c=d instanceof Date&&!isNaN(d.getTime())?d:null}return c},fetchDateFromParents:function(a,c){var d=b.fetchDate(a,c);if(a.parentElement){var e=b.fetchDateFromParents(a.parentElement,c);if(null!==e)return e}return d},fetchOrder:function(a){var b,c=a.getAttribute("data-order")||null;return b=c?Number(c):Number.NaN,isNaN(b)?1:b},insertAfter:function(a,b,c){b.nextSibling?c.insertBefore(a,b.nextSibling):c.appendChild(a)},insertSeparator:function(a,c,d,e){null!==c?b.insertAfter(d,c,e):a.length&&-1===a[a.length-1].dsComparison?b.insertAfter(d,a[a.length-1],e):a.length&&e.insertBefore(d,a[0])},parseElement:function(a,c,d,e){var f=b.fetchDate(a,"data-date");if(null!==f){a.dsComparison=b.dateCompare(f,d)*e;var g=c&&c.dsComparison!==a.dsComparison;return{element:a,target:g?c:null}}return null},parseElements:function(a,c,d){for(var e=[],f=null,g=0,h=a.length;g<h;g++){var i=a[g],j=e?e[e.length-1]:null,k=b.parseElement(i,j,c,d);k&&(e.push(k.element),f=k.target?k.target:f)}return{elements:e,target:f}}},c=function(a,c){this.container=a,this.separatorClass=c||"",this.separator=null,this.comparator=b.fetchDateFromParents(this.container,"data-date-comparator"),this.order=b.fetchOrder(this.container),Object.defineProperty&&Object.defineProperty(this,"methods",{value:b,writable:!1,enumerable:!0,configurable:!0})};return c.prototype.update=function(){if(null!==this.comparator){var a=b.parseElements(this.container.children,this.comparator,this.order);b.insertSeparator(a.elements,a.target,this.getSeparator(),this.container)}return this},c.prototype.getSeparator=function(){if(null===this.separator){var b=this.comparator,c=this.container.ownerDocument;if(this.separator=c.createElement("div"),this.separator.innerText="Your Last Visit",this.separator.className=this.separatorClass,b){var d=a[b.getMonth()],e=b.getDate(),f=b.getFullYear();this.separator.innerText+=" ("+d+" "+e+", "+f+")"}}return this.separator},c}),require(["jquery","cb/date-separator/date-separator"],function(a,b){"use strict";a(function(){var c=function(){var c=this;this.dateSeparator=new b(this,"list-group-item text-center last-visit").update(),a(this).closest(".js-infinite-scroll").on("load-more-complete",function(a,b){c.dateSeparator.update()})};a(".list-group-date-separator").each(c),a(".overview-feeds").on("load-feed-complete",function(b){a(b.relatedTarget).find(".list-group-date-separator").each(c)})})}),define("cb/date-separator/main",function(){}),define("cb/overview-feeds/overview-feeds",["jquery"],function(a){"use strict";var b={createSpinner:function(a){var b=a.ownerDocument,c=b.createElement("img");c.src="/assets/images/spinner.gif",c.setAttribute("alt","");var d=b.createElement("div");return d.appendChild(c),d.style.textAlign="center",d},fetchMenuLinksFromTarget:function(a){var b=[];if(a.className&&a.className.match(/dropdown\-toggle/)){var c=a.nextElementSibling||!1,d=!!c&&c.className.match(/dropdown\-menu/);if(d)for(var e=c.querySelectorAll("a"),f=0,g=e.length;f<g;f++)!e[f].className.match(/active/)&&e[f].hasAttribute("data-url")&&b.push(e[f])}return b},fetchMenuLinksFromTargets:function(a){for(var c=[],d=0,e=a.length;d<e;d++)c=c.concat(b.fetchMenuLinksFromTarget(a[d]));return c},applyOrderClickHandler:function(a,c){for(var d=b.fetchMenuLinksFromTargets(c.querySelectorAll(".order-btn")),e=function(d){d.preventDefault(),b.loadContent(a,c,this.getAttribute("data-url"))},f=0,g=d.length;f<g;f++)d[f].addEventListener?d[f].addEventListener("click",e):d[f].attachEvent&&d[f].attachEvent("onclick",e)},fetchContentUrl:function(a){return a&&a.getAttribute?a.getAttribute("data-url")||null:null},getTabByContentId:function(b,c){var d=a(b).find('[aria-controls="'+c.replace("#","")+'"][role="tab"]');return d.length>0?d.get(0):null},hasContent:function(a){return a&&a.children&&a.children.length},loadContent:function(a,c,d){var e=new XMLHttpRequest;e.open("GET",d,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest");var f=b.createSpinner(c);c.innerHTML="",c.appendChild(f),e.onreadystatechange=function(){4===this.readyState&&(c.removeChild(f),this.status>=200&&this.status<400?b.onContentLoaded(a,c,this.responseText):b.onContentLoadError())},e.send(),e=null},onContentLoaded:function(c,d,e){d.innerHTML=e,b.applyOrderClickHandler(c,d);var f=new a.Event("load-feed-complete");f.relatedTarget=d,a(c.container).trigger(f)},onContentLoadError:function(){},onShowTab:function(a,c){var d=b.getTabContentPanel(c),e=b.fetchContentUrl(d);d&&e&&!b.hasContent(d)&&b.loadContent(a,d,e)},getTabContentPanel:function(b){return a(a(b).attr("href")).get(0)||null}},c=function(c){this.container=c;var d=this.container.querySelector(".nav-tabs li.active a");null!==d&&b.onShowTab(this,d);var e=this;a(c).find('a[data-toggle="tab"]').on("shown.bs.tab",function(c){a(b.getTabContentPanel(c.target)).trigger("content-shown")}),a(c).find('a[data-toggle="tab"]').on("show.bs.tab",function(d){var f=a(d.target);b.onShowTab(e,d.target),a(c).find("#"+f.attr("aria-controls")+" .alert").remove()});var f=c.ownerDocument.parentWindow||c.ownerDocument.defaultView;a(f).on("hashchange",function(){var a=this;a.location&&a.location.hash&&e.showTabById(a.location.hash)}),a(f).trigger("hashchange"),a(c).on("response-inserted","form.js-submit",function(){var b=a(this).closest(".tab-pane").first(),d=a(c).find('a[aria-controls="'+b.attr("id")+'"]'),e=d.find(".count"),f=Number(e.text());isNaN(f)||(e.removeClass("hidden"),e.text(f+1))}),a(c).on("item-deleted",".tab-pane",function(b){var d=a(this),e=a(c).find('a[aria-controls="'+d.attr("id")+'"]'),f=e.find(".count"),g=Number(f.text());if(d.find(".alert").remove(),!isNaN(g)&&g>0){var h=g-1;f.text(h),0>=h&&f.addClass("hidden")}}),a(function(){if(null!==d){var f=a(c).find("#"+d.getAttribute("aria-controls"));b.hasContent(f)&&b.applyOrderClickHandler(e,f.get(0))}})};return c.prototype.showTabById=function(c){var d=b.getTabByContentId(this.container,c);d&&!d.parentElement.className.match(/active/)&&a(d).click(),d&&this.scrollToTabs()},c.prototype.scrollToTabs=function(){var b=a(this.container).find(".nav-tabs:first"),c=b.offset().top,d=this.container.ownerDocument.parentWindow||this.container.ownerDocument.defaultView;a(d).scrollTop(c+50)},c}),require(["jquery","cb/overview-feeds/overview-feeds"],function(a,b){"use strict";a(function(){a(".overview-feeds").each(function(){this.overviewFeeds=new b(this)})})}),define("cb/overview-feeds/main",function(){}),define("cb/password-unmask/password-unmask",["jquery"],function(a){"use strict";var b=function(b){var c=this;this.$password=b,this.isMasked=!0,this.getUnmaskedPassword=function(){var b=a('<input type="text" />');return b.prop("class",this.$password.prop("class")),b.addClass("hidden"),b},this.$password.wrap('<div class="input-group"></div>');var d=this.$password.attr("autofocus");if("undefined"!=typeof d&&d!==!1){var e=this.$password;e.focus(),setTimeout(function(){e.focus()},1)}this.$unmaskedPassword=this.getUnmaskedPassword(),this.$password.after(this.$unmaskedPassword),this.$toggleButton=a('<button type="button" class="btn btn-link">Show password</button>'),this.$toggleButton.wrap('<div class="input-group-btn"></div>'),this.$unmaskedPassword.after(this.$toggleButton.parent()),this.$toggleButton.on("click.password-unmask",function(){c.toggleMask.call(c)}),this.$password.add(this.$unmaskedPassword).on("input.password-unmask change.password-unmask",function(a){c.syncValues.call(c,a)})};return b.prototype.syncValues=function(b){var c=a(b.target).val();this.$password.val()!==c&&this.$password.val(c),this.$unmaskedPassword.val()!==c&&this.$unmaskedPassword.val(c)},b.prototype.toggleMask=function(){this.isMasked=!this.isMasked,this.updateFieldVisibility(),this.$toggleButton.html(this.getButtonHtml()),this.$toggleButton.attr("data-ga-label",(this.isMasked?"Hide":"Show")+" password while typing")},b.prototype.updateFieldVisibility=function(){if(this.$password.add(this.$unmaskedPassword).removeClass("hidden"),this.isMasked)this.$unmaskedPassword.addClass("hidden"),this.$unmaskedPassword.removeAttr("data-h5-errorid"),this.$unmaskedPassword.removeAttr("title"),this.$unmaskedPassword.removeAttr("pattern");else{this.$password.addClass("hidden");var a=this.$password.attr("data-new-password");"undefined"!=typeof a&&a!==!1&&(this.$unmaskedPassword.attr("data-h5-errorid","invalid-password"),this.$unmaskedPassword.attr("title","Password is less than 6 characters."),this.$unmaskedPassword.attr("pattern",".{6,}"))}},b.prototype.getButtonHtml=function(){var a;return a=this.isMasked?"Show":"Hide",a+' password <span class="sr-only">while typing</span>'},b}),define("cb/password-unmask/intercept-submit-signin",["jquery"],function(a){"use strict";var b=function(b){b.click(function(b){"1"===a("#enableRecaptchaV3").val()&&(b.preventDefault(),window.grecaptcha.ready(function(){window.grecaptcha.execute(a("#recaptchaV3PublicKey").val(),{action:"sign_in"}).then(function(b){a("#recaptcha_token").val(b),a("#recaptcha_action").val("sign_in"),a("#signin").unbind("submit").submit()})}))})};return b}),define("cb/password-unmask/intercept-submit-signup",["jquery"],function(a){"use strict";var b=function(b){b.click(function(b){"1"===a("#enableRecaptchaV3").val()&&(b.preventDefault(),window.grecaptcha.ready(function(){window.grecaptcha.execute(a("#recaptchaV3PublicKey").val(),{action:"sign_up"}).then(function(b){a("#recaptcha_token").val(b),a("#recaptcha_action").val("sign_up"),a("#signup").unbind("submit").submit()})}))})};return b}),define("cb/password-unmask/intercept-submit-create",["jquery"],function(a){"use strict";var b=function(b){b.click(function(b){"1"===a("#enableRecaptchaV3").val()&&(b.preventDefault(),window.grecaptcha.ready(function(){window.grecaptcha.execute(a("#recaptchaV3PublicKey").val(),{action:"create"}).then(function(b){a("#recaptcha_token").val(b),a("#recaptcha_action").val("create"),a("#createwebsitebuttonform").unbind("submit").submit()})}))})};return b}),require(["jquery","cb/password-unmask/password-unmask","cb/password-unmask/intercept-submit-signin","cb/password-unmask/intercept-submit-signup","cb/password-unmask/intercept-submit-create"],function(a,b,c,d,e){"use strict";a(function(){a(".js-unmaskable").each(function(){this.passwordUnmask=new b(a(this))}),a(".intercept-submit-signin").each(function(){this.interceptSubmitSignIn=new c(a(this))}),a(".intercept-submit-signup").each(function(){this.interceptSubmitSignUp=new d(a(this))}),a(".intercept-submit-create").each(function(){this.interceptSubmitCreate=new e(a(this))})})}),define("cb/password-unmask/main",function(){}),define("cb/my-story/model",["backbone"],function(a){"use strict";return a.Model.extend({defaults:{myStoryHeading:"",myStoryDescription:"",myStoryFullDescription:""},initialize:function(){}})}),define("cb/my-story/view",["jquery","backbone","cb/my-story/model","bootstrap"],function(a,b,c){"use strict";return b.View.extend({initialize:function(){this.model=new c,this.setElement(a(".my-story-container")),this.updateModelFromView()},events:{"click .edit-my-story-control":"edit","click #cancel-my-story-text":"cancel","click #save-my-story-text":"save","keyup #my-story-description":"validateMyStory"},render:function(){this.updateViewFromModel(),this.$("#my-story-description").removeClass("my-story-description-edit"),this.$("#my-story-description").removeClass("editable-field").removeAttr("contenteditable"),this.$("#my-story-description").addClass("my-story-description"),this.$(".edit-my-story-submission-control").addClass("hide"),this.$(".cancel-my-story-submission-control").addClass("hide"),this.$(".edit-my-story-control").removeClass("hide"),this.$(".more-my-story-control").removeClass("hide"),this.$(".my-story-error-message").addClass("hide")},edit:function(a){a&&a.preventDefault(),this.$("#my-story-read-more").trigger("click"),this.$("#my-story-description").addClass("editable-field").attr("contenteditable","true"),this.$("#my-story-description").removeClass("my-story-description"),this.$("#my-story-description").addClass("my-story-description-edit"),this.$(".edit-my-story-submission-control").removeClass("hide"),this.$(".cancel-my-story-submission-control").removeClass("hide"),this.$(".edit-my-story-control").addClass("hide"),this.$(".more-my-story-control").addClass("hide"),this.$("#my-story-description").focus()},cancel:function(){this.render(),this.$(".fade-out-medium").addClass("fade-out"),this.$("#my-story-read-more").show(),this.scrollBack()},save:function(){var b=this;this.updateModelFromView();var c=this.cleanPastedText();this.model.attributes.myStoryDescription=c;var d=window.location.pathname;d.indexOf("/journal")===d.length-8?d=d.replace("journal","mystory/edit"):d+="/mystory/edit",a.ajax({url:d,method:"PUT",data:c}).done(function(a){b.model.attributes.myStoryDescription=a.description,b.render(),b.scrollBack()}).fail(function(c){b.edit();var d=a.parseJSON(c.responseText);a("#my-story-help").html(d.message).removeClass("hide")})},scrollBack:function(){var b=a("#my-story-container").offset().top-a("header").offset().top;window.scroll(0,b)},validateMyStory:function(){var b=a("#my-story-description").data("myStoryMaxInlineLength");return this.cleanPastedText().length>b?(a("#my-story-help").hasClass("hide")&&(a("#my-story-help").html("My Story is limited to "+b+" characters.").removeClass("hide"),a("#save-my-story-text").attr("disabled","disabled")),!1):(a("#my-story-help").addClass("hide"),a("#my-story-description").attr("disabled",!1),a("#save-my-story-text").attr("disabled",!1),!0)},updateModelFromView:function(){this.model.attributes.myStoryHeading=a.trim(this.$("#my-story-heading").text()),this.model.attributes.myStoryDescription=a.trim(this.$("#my-story-description").html())},updateViewFromModel:function(){this.$("#my-story-heading").text(this.model.get("myStoryHeading")),this.$("#my-story-description").html(this.model.get("myStoryDescription"))},cleanPastedText:function(){var b=a("#my-story-description").html(),c=/(\n|\r| class=(")?Mso[a-zA-Z]+(")?)/g;return b=b.replace(c," "),b=b.replace(new RegExp("<!--(.*?)-->","g"),""),b=b.replace(new RegExp("<(/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>","gi"),""),b=b.replace(new RegExp("<style.*?style(.*?)>","gi"),""),b=b.replace(new RegExp("<script.*?script(.*?)>","gi"),""),b=b.replace(new RegExp("<applet.*?applet(.*?)>","gi"),""),b=b.replace(new RegExp("<embed.*?embed(.*?)>","gi"),""),b=b.replace(new RegExp("<noframes.*?noframes(.*?)>","gi"),""),b=b.replace(new RegExp("<noscript.*?noscript(.*?)>","gi"),""),b=b.replace(new RegExp(' style="(.*?)"',"gi"),""),b=b.replace(new RegExp(' start="(.*?)"',"gi"),""),b.trim()}})}),define("cb/my-story/main",["jquery","cb/my-story/view"],function(a,b){"use strict";var c=new b;return a(function(){c.render()}),c}),require(["jquery","cb/site-journal-modal/site-journal-modal"],function(a,b){"use strict";var c=function(a){var b=a.data("touch-link");Modernizr.touch&&b&&a.attr("href",b)},d=function(){a(".js-journal-modal").each(function(){a(this).is(":visible")&&"undefined"==typeof this.siteJournalModal&&(this.siteJournalModal=new b(a(this)))})};a(function(){d(),a(".js-infinite-scroll").on("load-more-complete",d)}),a(".js-remote-link").each(function(){a(this).is(":visible")&&c(a(this))})}),define("cb/site-journal-modal/main",function(){}),require(["jquery"],function(a){"use strict";a(function(){a(".suppress-if-js-enabled").addClass("suppress-link")})}),define("cb/progressive-enhancement/main",function(){}),define("cb/ajax-submit/ajax-submit",["jquery"],function(a){"use strict";var b="An error occurred while attempting to submit the form.",c="The form was submitted successfully.",d=function(b){var c=a("<div>").html(b);return c.text()},e=function(b,c){var e=a(b),f=e.parent(),g=(e.parent(".list-group"),d(e.data("responseWrapper")||"")),h=a(g).append(c),i=d(e.data("responseDestination")||""),j=f.find(i);e.data("responseAppend")?j.append(h):j.prepend(h);var k=new a.Event("response-inserted");k.relatedTarget=h,e.trigger(k)},f=function(b){var c=this;this.form=b,a(this.form).on("submit",function(a){a.preventDefault(),c.submit()}),a(this.form).on("clear-alerts",function(){c.clearAlerts()})};return f.prototype.submit=function(){var d=this,f=this.form;a.ajax({type:f.method,url:f.action,data:a(f).serialize(),beforeSend:function(){d.clearAlerts()}}).done(function(b){e(f,b),f.reset();var g=a(f).data("successMessage")||c;d.displaySuccessAlert(g)}).fail(function(c,e){var g=a(f).data("errorMessage")||b;d.displayErrorAlert(g,e)})},f.prototype.clearAlerts=function(){a(this.form).find(".alert").remove()},f.prototype.displaySuccessAlert=function(b){a("<p>").addClass("alert alert-success").text(b).prependTo(a(this.form))},f.prototype.displayErrorAlert=function(b,c){a("<p>").addClass("alert alert-danger").text(b+" ("+c+")").prependTo(a(this.form))},f}),require(["jquery","cb/ajax-submit/ajax-submit"],function(a,b){"use strict";a(function(){var c="form.js-submit",d=function(){this.cbAjaxSubmit=new b(this)};a(c).each(d),a(".overview-feeds").on("load-feed-complete",function(b){a(b.relatedTarget).find(c).each(d)})})}),define("cb/ajax-submit/main",function(){}),require(["jquery"],function(a){"use strict";var b=a("nav.navbar");if(b.size()){var c=function(){this.initialize=function(){var c=window.location.hash;if(c&&c.indexOf("=")>-1)history.replaceState("",document.title,window.location.pathname);else if(c){var d=a(c).offset();d&&d.top&&a("body").scrollTop(d.top-b.height()-5)}}};a(function(){(new c).initialize()})}}),define("cb/navigation/main",function(){}),define("cb/ways-to-help-settings/settings",["jquery"],function(a){"use strict";var b=function(b){var c=a(b).closest(".panel-default").find(".slider-checkbox"),d=c.is(":checked");d||(c.prop("checked",!0),c.trigger("auto-activate"))},c=function(b){var c=a(b.currentTarget),d=a("#toggleSelectionMessage"),e=c.data("support-tool-name"),f=c.val(),g=c.is(":checked"),h=c.data("save-url");"auto-activate"!==b.type&&b.data.supportSettings.resetAllAlertMessages(),"undefined"!=typeof h?(c.prop("disabled",!0).attr("disabled","disabled"),a.post(h,{supportToolId:f,isActivated:g}).done(function(a){d.removeClass("hidden").addClass("alert-success"),d.html("Your support option '"+e+"' has been turned "+(g?"on.":"off."))}).fail(function(a){d.removeClass("hidden").addClass("alert-danger"),d.html("There was an error processing your request"),c.prop("checked",!g)}).always(function(){c.removeProp("disabled").removeAttr("disabled")})):(d.removeClass("hidden").addClass("alert-danger"),d.html("There was an error processing your request"),c.prop("checked",!g))},d=function(b,c,d,e,f,g){var h=a(".alert",d),i=c.attr("action");a(d).find(".has-error").removeClass("has-error"),b.resetAllAlertMessages(),a.ajax({url:i,method:"POST",data:e,dataType:"json"}).done(function(a){h.removeClass("hidden").addClass("alert-success"),h.html("Your changes are saved successfully"),f&&f(a)}).fail(function(b){if(400===b.status){var c=a.parseJSON(b.responseText),d=c.fields;a.each(d,function(b,c){a("#"+c).closest(".form-group").addClass("has-error")}),h.html(c.message)}else h.html("There was an error processing your request.");h.removeClass("hidden").addClass("alert-danger"),g&&g()})},e=function(b){b.preventDefault();var c=a(".supportMessageForm"),e={supportTitle:a("#supportTitle").val(),supportMessage:a("#supportMessage").val()},f=function(b){a("#supportTitle").val(b.supportTitle),a("#supportMessage").val(b.supportMessage)};d(b.data.supportSettings,c,"#personalmessage",JSON.stringify(e),f)},f=function(c){c.preventDefault();var e=a("form#hospital"),f=e.serialize(),g=function(c){("success"===c.status&&a("#facilityName").val()||a("#customFacilityName").val()&&a("#isCustomFacility").is(":checked"))&&b("#hospital")};d(c.data.supportSettings,e,"#hospital",f,g)},g=function(b){b.preventDefault(),b.data.supportSettings.resetAllAlertMessages();var c=a(this).data("id"),d=a(a(".site-label")[c]),e=a(a(".site-url")[c]),f=a(a(".error-row")[c]);d.val("").removeClass("has-error"),e.val("").removeClass("has-error"),f.hasClass("hidden")||f.addClass("hidden")},h=function(c){c.preventDefault(),c.data.supportSettings.resetInlineError();for(var e=a(".supportLinksForm"),f=[],g=!0,h=0;h<3;h++){var i=a(a(".site-label")[h]),j=a(a(".site-url")[h]),k=a(a(".url-error-msg")[h]),l=a(a(".name-error-msg")[h]);if(a.trim(j.val())||a.trim(i.val())){var m=c.data.supportSettings.isValidSupportLinkLabel(i,l),n=c.data.supportSettings.isValidSupportLinkUrl(j,k);if(m&&n){var o={};o.label=a.trim(a(i).val()),o.url=a.trim(a(j).val()),o.orderIndex=h+1,f.push(o)}else g=!1}}var p=function(c){for(var d=!1,e=0;e<3;e++){var g=a(a(".site-label")[e]),h=a(a(".site-url")[e]);f[e]?(g.val(f[e].label),h.val(f[e].url),d=!0):(g.val(""),h.val(""))}d&&b("#other-support-links")};g&&d(c.data.supportSettings,e,"#other-support-links",JSON.stringify(f),p)},i=function(c){c.preventDefault();var e=c.data.supportSettings,f=a(".goFundMeForm"),g=a("#campaign-url"),h=a(".gfm-error-msg");e.resetInlineError();var i=function(c){var d=a.trim(c.url);d.length>0?(a(".gofundme-link").attr("href",d),a(".gfm-post-setup").removeClass("hide"),a(".gfm-initial-setup").addClass("hide"),b("#gofundme-support")):(a(".gfm-post-setup").addClass("hide"),a(".gfm-initial-setup").removeClass("hide"),g.val("https://"))};a(g)[0].checkValidity()?d(e,f,"#gofundme-support",JSON.stringify({url:g.val()}),i):(g.parent().addClass("has-error"),a(h).text("Invalid URL").removeClass("hidden"))},j=function(a){a.data.supportSettings.defaultCustomValues()},k=function(b){b.data.supportSettings.toggleCustomFacility(a(this))},l=function(b){var c=a.trim(this.value);return c&&!/^https?:\/\//.test(c)&&(c="http://"+c),this.value=c,this.value},m=function(b){b.preventDefault(),b.data.supportSettings.resetAllAlertMessages(),b.data.supportSettings.resetInlineError(),
a("#campaign-url").val("")},n=function(a){a.preventDefault(),a.data.supportSettings.resetAllAlertMessages(),a.data.supportSettings.resetInlineError()},o=function(b){b.preventDefault(),n(b),a("#updateDisplayEmail").val("")},p=function(b){b.preventDefault(),n(b),a("#updateShiptEmail").val("")},q=function(c){c.preventDefault();var e=a("#displayEmailForm"),f=a(".display-email-error-msg"),g=a("#updateDisplayEmail"),h=e.serialize();if(g[0].checkValidity()){var i=function(c){a(g).parent().removeClass("has-error"),f.hasClass("hidden")||f.addClass("hidden");var d=a("#isDisplayPrimaryEmail").is(":checked"),e=a.trim(g.val()).length>0;(d||e)&&b("#display-support-email")};d(c.data.supportSettings,e,"#display-support-email",h,i)}else a(g).parent().addClass("has-error"),a(f).text("Invalid Email Address").removeClass("hidden")},r=function(c){c.preventDefault();var e=a("#shiptEmailForm"),f=a(".display-email-error-msg0"),g=a(".display-email-error-msg1"),h=a("#updateShiptEmail"),i=e.serialize();if(h[0].checkValidity()){var j=function(c){a(h).parent().removeClass("has-error"),f.hasClass("hidden")||f.addClass("hidden"),g.hasClass("hidden")||g.addClass("hidden"),a.trim(h.val()).length>0&&b("#shipt-support")};d(c.data.supportSettings,e,"#shipt-support",i,j)}else{var k=a("#shipt-support > .alert");k.hasClass("hidden")||k.addClass("hidden"),a(h).parent().addClass("has-error"),a(f).text("Please enter your email address in format:").removeClass("hidden"),a(g).text("yourname@example.com").removeClass("hidden")}},s=function(){};return s.prototype.initialize=function(){return a("#support-activation-panel").on("change auto-activate",".slider-checkbox",{supportSettings:this},c),a("#personalmessage").on("click",".save-personal-message",{supportSettings:this},e),a("#hospital").on("click","#submit-btn",{supportSettings:this},f),a("#hospital").on("change.facility","#facilityLocation, #facilityName",{supportSettings:this},j),a("#hospital").on("change.customFacility","#isCustomFacility",{supportSettings:this},k),a("#other-support-links").on("blur.site-url",".site-url",{supportSettings:this},l),a("#other-support-links").on("click",".submit-btn",{supportSettings:this},h),a("#other-support-links").on("click",".clear-fields",{supportSettings:this},g),a("#gofundme-support").on("click",".clear-form",{supportSettings:this},m),a("#gofundme-support").on("click",".submit-btn",{supportSettings:this},i),a("#gofundme-support").on("blur","#campaign-url",{supportSettings:this},l),a("#display-support-email").on("click",".submit-btn",{supportSettings:this},q),a("#display-support-email").on("click",".clear-form",{supportSettings:this},o),a("#shipt-support").on("click",".submit-btn",{supportSettings:this},r),a("#shipt-support").on("click",".clear-form",{supportSettings:this},p),a(".js-popover-help-text").popover(),this.defaultCustomValues(),this},s.prototype.resetAllAlertMessages=function(){a(".alert").each(function(){var b=a(this);b.html(""),b.hasClass("hidden")||b.addClass("hidden"),b.removeClass("alert-success alert-danger")})},s.prototype.resetInlineError=function(){a(".has-error").each(function(){a(this).removeClass("has-error")}),a(".error-msg").each(function(){var b=a(this);b.html(""),b.parent(".error-row").hasClass("hidden")||b.parent(".error-row").addClass("hidden")})},s.prototype.isValidSupportLinkLabel=function(b,c){return!(a.trim(a(b).val()).length<1||a.trim(a(b).val()).length>30)||(b.addClass("has-error"),a(c).text("Name must be between 1 and 30 characters.").parent(".error-row").removeClass("hidden"),!1)},s.prototype.isValidSupportLinkUrl=function(b,c){return a.trim(a(b).val()).length<1?(b.addClass("has-error"),a(c).text("URL is required.").parent(".error-row").removeClass("hidden"),!1):!!a(b)[0].checkValidity()||(b.addClass("has-error"),a(c).text("Invalid URL").parent(".error-row").removeClass("hidden"),!1)},s.prototype.toggleCustomFacility=function(b){var c=a("#facilityLocation, #facilityName");b.is(":checked")?c.prop("disabled",!0).attr("disabled","disabled"):c.removeProp("disabled").removeAttr("disabled")},s.prototype.defaultCustomValues=function(){a("#customFacilityName").val()||a("#customFacilityName").val(a("#facilityName").find("option:selected").text()),a("#customFacilityState").val()||a("#customFacilityState").val(a("#facilityLocation").val())},s}),define("cb/ways-to-help-settings/main",["jquery","cb/ways-to-help-settings/settings"],function(a,b){"use strict";a(function(){window.waysToHelpSettings=(new b).initialize()})}),function(a,b){"function"==typeof define&&define.amd?define("croppie",["exports"],b):b("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:a.commonJsStrict={})}(this,function(a){function b(a){if(a in U)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=T.length;c--;)if(a=T[c]+b,a in U)return a}function c(a,b){a=a||{};for(var d in b)b[d]&&b[d].constructor&&b[d].constructor===Object?(a[d]=a[d]||{},c(a[d],b[d])):a[d]=b[d];return a}function d(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function e(a){if("createEvent"in document){var b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0),a.dispatchEvent(b)}else a.fireEvent("onchange")}function f(a,b,c){if("string"==typeof b){var d=b;b={},b[d]=c}for(var e in b)a.style[e]=b[e]}function g(a,b){a.classList?a.classList.add(b):a.className+=" "+b}function h(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(b,"")}function i(a){return parseInt(a,10)}function j(a,b,c){var d=b||new Image;return d.style.opacity=0,new Promise(function(b){function e(){setTimeout(function(){b(d)},1)}return d.src===a?void e():(d.exifdata=null,d.removeAttribute("crossOrigin"),a.match(/^https?:\/\/|^\/\//)&&d.setAttribute("crossOrigin","anonymous"),d.onload=function(){c?EXIF.getData(d,function(){e()}):e()},void(d.src=a))})}function k(a){var b=a.naturalWidth,c=a.naturalHeight;if(a.exifdata&&a.exifdata.Orientation>=5){var d=b;b=c,c=d}return{width:b,height:c}}function l(a){return a.exifdata.Orientation}function m(a,b,c){var d=b.width,e=b.height,f=a.getContext("2d");switch(a.width=b.width,a.height=b.height,f.save(),c){case 2:f.translate(d,0),f.scale(-1,1);break;case 3:f.translate(d,e),f.rotate(180*Math.PI/180);break;case 4:f.translate(0,e),f.scale(1,-1);break;case 5:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.scale(1,-1);break;case 6:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.translate(0,-e);break;case 7:a.width=e,a.height=d,f.rotate(-90*Math.PI/180),f.translate(-d,e),f.scale(1,-1);break;case 8:a.width=e,a.height=d,f.translate(0,d),f.rotate(-90*Math.PI/180)}f.drawImage(b,0,0,d,e),f.restore()}function n(){var a,b,c,d,e,h,i=this,j="croppie-container",k=i.options.viewport.type?"cr-vp-"+i.options.viewport.type:null;i.options.useCanvas=i.options.enableOrientation||o.call(i),i.data={},i.elements={},a=i.elements.boundary=document.createElement("div"),c=i.elements.viewport=document.createElement("div"),b=i.elements.img=document.createElement("img"),d=i.elements.overlay=document.createElement("div"),i.options.useCanvas?(i.elements.canvas=document.createElement("canvas"),i.elements.preview=i.elements.canvas):i.elements.preview=i.elements.img,g(a,"cr-boundary"),e=i.options.boundary.width,h=i.options.boundary.height,f(a,{width:e+(isNaN(e)?"":"px"),height:h+(isNaN(h)?"":"px")}),g(c,"cr-viewport"),k&&g(c,k),f(c,{width:i.options.viewport.width+"px",height:i.options.viewport.height+"px"}),c.setAttribute("tabindex",0),g(i.elements.preview,"cr-image"),g(d,"cr-overlay"),i.element.appendChild(a),a.appendChild(i.elements.preview),a.appendChild(c),a.appendChild(d),g(i.element,j),i.options.customClass&&g(i.element,i.options.customClass),v.call(this),i.options.enableZoom&&r.call(i),i.options.enableResize&&p.call(i)}function o(){return this.options.enableExif&&window.EXIF}function p(){function a(a){if((void 0===a.button||0===a.button)&&(a.preventDefault(),!o)){var f=m.elements.overlay.getBoundingClientRect();if(o=!0,e=a.pageX,h=a.pageY,d=a.currentTarget.className.indexOf("vertical")!==-1?"v":"h",i=f.width,j=f.height,a.touches){var g=a.touches[0];e=g.pageX,h=g.pageY}window.addEventListener("mousemove",b),window.addEventListener("touchmove",b),window.addEventListener("mouseup",c),window.addEventListener("touchend",c),document.body.style[S]="none"}}function b(a){var b=a.pageX,c=a.pageY;if(a.preventDefault(),a.touches){var g=a.touches[0];b=g.pageX,c=g.pageY}var k=b-e,l=c-h,o=m.options.viewport.height+l,q=m.options.viewport.width+k;"v"===d&&o>=p&&o<=j?(f(n,{height:o+"px"}),m.options.boundary.height+=l,f(m.elements.boundary,{height:m.options.boundary.height+"px"}),m.options.viewport.height+=l,f(m.elements.viewport,{height:m.options.viewport.height+"px"})):"h"===d&&q>=p&&q<=i&&(f(n,{width:q+"px"}),m.options.boundary.width+=k,f(m.elements.boundary,{width:m.options.boundary.width+"px"}),m.options.viewport.width+=k,f(m.elements.viewport,{width:m.options.viewport.width+"px"})),w.call(m),A.call(m),u.call(m),x.call(m),h=c,e=b}function c(){o=!1,window.removeEventListener("mousemove",b),window.removeEventListener("touchmove",b),window.removeEventListener("mouseup",c),window.removeEventListener("touchend",c),document.body.style[S]=""}var d,e,h,i,j,k,l,m=this,n=document.createElement("div"),o=!1,p=50;g(n,"cr-resizer"),f(n,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),this.options.resizeControls.height&&(k=document.createElement("div"),g(k,"cr-resizer-vertical"),n.appendChild(k)),this.options.resizeControls.width&&(l=document.createElement("div"),g(l,"cr-resizer-horisontal"),n.appendChild(l)),k&&k.addEventListener("mousedown",a),l&&l.addEventListener("mousedown",a),this.elements.boundary.appendChild(n)}function q(a){if(this.options.enableZoom){var b=this.elements.zoomer,c=J(a,4);b.value=Math.max(b.min,Math.min(b.max,c))}}function r(){function a(){s.call(c,{value:parseFloat(e.value),origin:new X(c.elements.preview),viewportRect:c.elements.viewport.getBoundingClientRect(),transform:W.parse(c.elements.preview)})}function b(b){var d,e;d=b.wheelDelta?b.wheelDelta/1200:b.deltaY?b.deltaY/1060:b.detail?b.detail/-60:0,e=c._currentZoom+d*c._currentZoom,b.preventDefault(),q.call(c,e),a.call(c)}var c=this,d=c.elements.zoomerWrap=document.createElement("div"),e=c.elements.zoomer=document.createElement("input");g(d,"cr-slider-wrap"),g(e,"cr-slider"),e.type="range",e.step="0.0001",e.value=1,e.style.display=c.options.showZoomer?"":"none",c.element.appendChild(d),d.appendChild(e),c._currentZoom=1,c.elements.zoomer.addEventListener("input",a),c.elements.zoomer.addEventListener("change",a),c.options.mouseWheelZoom&&(c.elements.boundary.addEventListener("mousewheel",b),c.elements.boundary.addEventListener("DOMMouseScroll",b))}function s(a){function b(){var a={};a[R]=d.toString(),a[Q]=g.toString(),f(c.elements.preview,a)}var c=this,d=a?a.transform:W.parse(c.elements.preview),e=a?a.viewportRect:c.elements.viewport.getBoundingClientRect(),g=a?a.origin:new X(c.elements.preview);if(c._currentZoom=a?a.value:c._currentZoom,d.scale=c._currentZoom,b(),c.options.enforceBoundary){var h=t.call(c,e),i=h.translate,j=h.origin;d.x>=i.maxX&&(g.x=j.minX,d.x=i.maxX),d.x<=i.minX&&(g.x=j.maxX,d.x=i.minX),d.y>=i.maxY&&(g.y=j.minY,d.y=i.maxY),d.y<=i.minY&&(g.y=j.maxY,d.y=i.minY)}b(),Y.call(c),x.call(c)}function t(a){var b=this,c=b._currentZoom,d=a.width,e=a.height,f=b.elements.boundary.clientWidth/2,g=b.elements.boundary.clientHeight/2,h=b.elements.preview.getBoundingClientRect(),i=h.width,j=h.height,k=d/2,l=e/2,m=(k/c-f)*-1,n=m-(i*(1/c)-d*(1/c)),o=(l/c-g)*-1,p=o-(j*(1/c)-e*(1/c)),q=1/c*k,r=i*(1/c)-q,s=1/c*l,t=j*(1/c)-s;return{translate:{maxX:m,minX:n,maxY:o,minY:p},origin:{maxX:r,minX:q,maxY:t,minY:s}}}function u(){var a=this,b=a._currentZoom,c=a.elements.preview.getBoundingClientRect(),d=a.elements.viewport.getBoundingClientRect(),e=W.parse(a.elements.preview.style[R]),g=new X(a.elements.preview),h=d.top-c.top+d.height/2,i=d.left-c.left+d.width/2,j={},k={};j.y=h/b,j.x=i/b,k.y=(j.y-g.y)*(1-b),k.x=(j.x-g.x)*(1-b),e.x-=k.x,e.y-=k.y;var l={};l[Q]=j.x+"px "+j.y+"px",l[R]=e.toString(),f(a.elements.preview,l)}function v(){function a(a,b){var c=n.elements.preview.getBoundingClientRect(),d=m.y+b,e=m.x+a;n.options.enforceBoundary?(l.top>c.top+b&&l.bottom<c.bottom+b&&(m.y=d),l.left>c.left+a&&l.right<c.right+a&&(m.x=e)):(m.y=d,m.x=e)}function b(a){function b(a){switch(a){case d:return[1,0];case e:return[0,1];case f:return[-1,0];case g:return[0,-1]}}var d=37,e=38,f=39,g=40;if(!a.shiftKey||a.keyCode!=e&&a.keyCode!=g){if(n.options.enableKeyMovement&&a.keyCode>=37&&a.keyCode<=40){a.preventDefault();var h=b(a.keyCode);m=W.parse(n.elements.preview),document.body.style[S]="none",l=n.elements.viewport.getBoundingClientRect(),c(h)}}else{var i=0;i=a.keyCode==e?parseFloat(n.elements.zoomer.value,10)+parseFloat(n.elements.zoomer.step,10):parseFloat(n.elements.zoomer.value,10)-parseFloat(n.elements.zoomer.step,10),n.setZoom(i)}}function c(b){var c=b[0],d=b[1],e={};a(c,d),e[R]=m.toString(),f(n.elements.preview,e),w.call(n),document.body.style[S]="",u.call(n),x.call(n),k=0}function d(a){if((void 0===a.button||0===a.button)&&(a.preventDefault(),!o)){if(o=!0,i=a.pageX,j=a.pageY,a.touches){var b=a.touches[0];i=b.pageX,j=b.pageY}m=W.parse(n.elements.preview),window.addEventListener("mousemove",g),window.addEventListener("touchmove",g),window.addEventListener("mouseup",h),window.addEventListener("touchend",h),document.body.style[S]="none",l=n.elements.viewport.getBoundingClientRect()}}function g(b){b.preventDefault();var c=b.pageX,d=b.pageY;if(b.touches){var g=b.touches[0];c=g.pageX,d=g.pageY}var h=c-i,l=d-j,o={};if("touchmove"==b.type&&b.touches.length>1){var p=b.touches[0],r=b.touches[1],s=Math.sqrt((p.pageX-r.pageX)*(p.pageX-r.pageX)+(p.pageY-r.pageY)*(p.pageY-r.pageY));k||(k=s/n._currentZoom);var t=s/k;return q.call(n,t),void e(n.elements.zoomer)}a(h,l),o[R]=m.toString(),f(n.elements.preview,o),w.call(n),j=d,i=c}function h(){o=!1,window.removeEventListener("mousemove",g),window.removeEventListener("touchmove",g),window.removeEventListener("mouseup",h),window.removeEventListener("touchend",h),document.body.style[S]="",u.call(n),x.call(n),k=0}var i,j,k,l,m,n=this,o=!1;n.elements.overlay.addEventListener("mousedown",d),n.elements.viewport.addEventListener("keydown",b),n.elements.overlay.addEventListener("touchstart",d)}function w(){var a=this,b=a.elements.boundary.getBoundingClientRect(),c=a.elements.preview.getBoundingClientRect();f(a.elements.overlay,{width:c.width+"px",height:c.height+"px",top:c.top-b.top+"px",left:c.left-b.left+"px"})}function x(){var a,b=this,c=b.get();if(y.call(b))if(b.options.update.call(b,c),b.$&&"undefined"==typeof Prototype)b.$(b.element).trigger("update",c);else{var a;window.CustomEvent?a=new CustomEvent("update",{detail:c}):(a=document.createEvent("CustomEvent"),a.initCustomEvent("update",!0,!0,c)),b.element.dispatchEvent(a)}}function y(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function z(){var a=this,b=1,c={},d=a.elements.preview,e=a.elements.preview.getBoundingClientRect(),g=new W(0,0,b),h=new X,i=y.call(a);i&&!a.data.bound&&(a.data.bound=!0,c[R]=g.toString(),c[Q]=h.toString(),c.opacity=1,f(d,c),a._originalImageWidth=e.width,a._originalImageHeight=e.height,a.options.enableZoom?A.call(a,!0):a._currentZoom=b,g.scale=a._currentZoom,c[R]=g.toString(),f(d,c),a.data.points.length?B.call(a,a.data.points):C.call(a),u.call(a),w.call(a))}function A(a){var b,c,d,f,g=this,h=0,i=1.5,j=g.elements.zoomer,k=parseFloat(j.value),l=g.elements.boundary.getBoundingClientRect(),m=g.elements.preview.getBoundingClientRect(),n=g.elements.viewport.getBoundingClientRect();g.options.enforceBoundary&&(d=n.width/(a?m.width:m.width/k),f=n.height/(a?m.height:m.height/k),h=Math.max(d,f)),h>=i&&(i=h+1),j.min=J(h,4),j.max=J(i,4),a&&(c=Math.max(l.width/m.width,l.height/m.height),b=null!==g.data.boundZoom?g.data.boundZoom:c,q.call(g,b)),e(j)}function B(a){if(4!=a.length)throw"Croppie - Invalid number of points supplied: "+a;var b=this,c=a[2]-a[0],d=b.elements.viewport.getBoundingClientRect(),e=b.elements.boundary.getBoundingClientRect(),g={left:d.left-e.left,top:d.top-e.top},h=d.width/c,i=a[1],j=a[0],k=-1*a[1]+g.top,l=-1*a[0]+g.left,m={};m[Q]=j+"px "+i+"px",m[R]=new W(l,k,h).toString(),f(b.elements.preview,m),q.call(b,h),b._currentZoom=h}function C(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=a.elements.boundary.getBoundingClientRect(),e=c.left-d.left,g=c.top-d.top,h=e-(b.width-c.width)/2,i=g-(b.height-c.height)/2,j=new W(h,i,a._currentZoom);f(a.elements.preview,R,j.toString())}function D(a){var b=this,c=b.elements.canvas,d=b.elements.img,e=c.getContext("2d"),f=o.call(b),a=b.options.enableOrientation&&a;if(e.clearRect(0,0,c.width,c.height),c.width=d.width,c.height=d.height,f&&!a){var g=l(d);m(c,d,i(g||0,10))}else a&&m(c,d,a)}function E(a){var b=this,c=a.points,d=i(c[0]),e=i(c[1]),f=i(c[2]),g=i(c[3]),h=f-d,j=g-e,k=a.circle,l=document.createElement("canvas"),m=l.getContext("2d"),n=h,o=j,p=0,q=0,r=n,s=o,t=a.outputWidth&&a.outputHeight,u=1;return t&&(r=a.outputWidth,s=a.outputHeight,u=r/n),l.width=r,l.height=s,a.backgroundColor&&(m.fillStyle=a.backgroundColor,m.fillRect(0,0,n,o)),b.options.enforceBoundary||(d<0&&(p=Math.abs(d),d=0),e<0&&(q=Math.abs(e),e=0),f>b._originalImageWidth&&(h=b._originalImageWidth-d,n=h),g>b._originalImageHeight&&(j=b._originalImageHeight-e,o=j)),1!==u&&(p*=u,q*=u,n*=u,o*=u),m.drawImage(this.elements.preview,d,e,Math.min(h,b._originalImageWidth),Math.min(j,b._originalImageHeight),p,q,n,o),k&&(m.fillStyle="#fff",m.globalCompositeOperation="destination-in",m.beginPath(),m.arc(n/2,o/2,n/2,0,2*Math.PI,!0),m.closePath(),m.fill()),l}function F(a){var b=a.points,c=document.createElement("div"),d=document.createElement("img"),e=b[2]-b[0],h=b[3]-b[1];return g(c,"croppie-result"),c.appendChild(d),f(d,{left:-1*b[0]+"px",top:-1*b[1]+"px"}),d.src=a.url,f(c,{width:e+"px",height:h+"px"}),c}function G(a){return E.call(this,a).toDataURL(a.format,a.quality)}function H(a){var b=this;return new Promise(function(c,d){E.call(b,a).toBlob(function(a){c(a)},a.format,a.quality)})}function I(a,b){var c,d=this,e=[],f=null,g=o.call(d);if("string"==typeof a)c=a,a={};else if(Array.isArray(a))e=a.slice();else{if("undefined"==typeof a&&d.data.url)return z.call(d),x.call(d),null;c=a.url,e=a.points||[],f="undefined"==typeof a.zoom?null:a.zoom}return d.data.bound=!1,d.data.url=c||d.data.url,d.data.boundZoom=f,j(c,d.elements.img,g).then(function(c){if(e.length)d.options.relative&&(e=[e[0]*c.naturalWidth/100,e[1]*c.naturalHeight/100,e[2]*c.naturalWidth/100,e[3]*c.naturalHeight/100]);else{var f,g,h=k(c),i=d.elements.viewport.getBoundingClientRect(),j=i.width/i.height,l=h.width/h.height;l>j?(g=h.height,f=g*j):(f=h.width,g=f/j);var m=(h.width-f)/2,n=(h.height-g)/2,o=m+f,p=n+g;d.data.points=[m,n,o,p]}d.data.points=e.map(function(a){return parseFloat(a)}),d.options.useCanvas&&D.call(d,a.orientation||1),z.call(d),x.call(d),b&&b()})}function J(a,b){return parseFloat(a).toFixed(b||0)}function K(){var a=this,b=a.elements.preview.getBoundingClientRect(),c=a.elements.viewport.getBoundingClientRect(),d=c.left-b.left,e=c.top-b.top,f=(c.width-a.elements.viewport.offsetWidth)/2,g=(c.height-a.elements.viewport.offsetHeight)/2,h=d+a.elements.viewport.offsetWidth+f,i=e+a.elements.viewport.offsetHeight+g,j=a._currentZoom;(j===1/0||isNaN(j))&&(j=1);var k=a.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;return d=Math.max(k,d/j),e=Math.max(k,e/j),h=Math.max(k,h/j),i=Math.max(k,i/j),{points:[J(d),J(e),J(h),J(i)],zoom:j}}function L(a){var b,d=this,e=K.call(d),f=c(Z,c({},a)),g="string"==typeof a?a:f.type||"base64",h=f.size||"viewport",i=f.format,j=f.quality,k=f.backgroundColor,l="boolean"==typeof f.circle?f.circle:"circle"===d.options.viewport.type,m=d.elements.viewport.getBoundingClientRect(),n=m.width/m.height;return"viewport"===h?(e.outputWidth=m.width,e.outputHeight=m.height):"object"==typeof h&&(h.width&&h.height?(e.outputWidth=h.width,e.outputHeight=h.height):h.width?(e.outputWidth=h.width,e.outputHeight=h.width/n):h.height&&(e.outputWidth=h.height*n,e.outputHeight=h.height)),$.indexOf(i)>-1&&(e.format="image/"+i,e.quality=j),e.circle=l,e.url=d.data.url,e.backgroundColor=k,b=new Promise(function(a,b){switch(g.toLowerCase()){case"rawcanvas":a(E.call(d,e));break;case"canvas":case"base64":a(G.call(d,e));break;case"blob":H.call(d,e).then(a);break;default:a(F.call(d,e))}})}function M(){z.call(this)}function N(a){if(!this.options.useCanvas)throw"Croppie: Cannot rotate without enableOrientation";var b=this,c=b.elements.canvas,d=document.createElement("canvas"),e=1;d.width=c.width,d.height=c.height;var f=d.getContext("2d");f.drawImage(c,0,0),90!==a&&a!==-270||(e=6),a!==-90&&270!==a||(e=8),180!==a&&a!==-180||(e=3),m(c,d,e),s.call(b),d=null}function O(){var a=this;a.element.removeChild(a.elements.boundary),h(a.element,"croppie-container"),a.options.enableZoom&&a.element.removeChild(a.elements.zoomerWrap),delete a.elements}function P(a,b){if(this.element=a,this.options=c(c({},P.defaults),b),"img"===this.element.tagName.toLowerCase()){var d=this.element;g(d,"cr-original-image");var e=document.createElement("div");this.element.parentNode.appendChild(e),e.appendChild(d),this.element=e,this.options.url=this.options.url||d.src}if(n.call(this),this.options.url){var f={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,I.call(this,f)}}"function"!=typeof Promise&&!function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j=setTimeout,k="function"==typeof setImmediate&&setImmediate||function(a){j(a,1)},l=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){k=a},"undefined"!=typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this),"function"!=typeof window.CustomEvent&&!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){for(var d=atob(this.toDataURL(b,c).split(",")[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;g++)f[g]=d.charCodeAt(g);a(new Blob([f],{type:b||"image/png"}))}});var Q,R,S,T=["Webkit","Moz","ms"],U=document.createElement("div").style;R=b("transform"),Q=b("transformOrigin"),S=b("userSelect");var V={translate3d:{suffix:", 0px"},translate:{suffix:""}},W=function(a,b,c){this.x=parseFloat(a),this.y=parseFloat(b),this.scale=parseFloat(c)};W.parse=function(a){return a.style?W.parse(a.style[R]):a.indexOf("matrix")>-1||a.indexOf("none")>-1?W.fromMatrix(a):W.fromString(a)},W.fromMatrix=function(a){var b=a.substring(7).split(",");return b.length&&"none"!==a||(b=[1,0,0,1,0,0]),new W(i(b[4]),i(b[5]),parseFloat(b[0]))},W.fromString=function(a){var b=a.split(") "),c=b[0].substring(P.globals.translate.length+1).split(","),d=b.length>1?b[1].substring(6):1,e=c.length>1?c[0]:0,f=c.length>1?c[1]:0;return new W(e,f,d)},W.prototype.toString=function(){var a=V[P.globals.translate].suffix||"";return P.globals.translate+"("+this.x+"px, "+this.y+"px"+a+") scale("+this.scale+")"};var X=function(a){if(!a||!a.style[Q])return this.x=0,void(this.y=0);var b=a.style[Q].split(" ");this.x=parseFloat(b[0]),this.y=parseFloat(b[1])};X.prototype.toString=function(){return this.x+"px "+this.y+"px"};var Y=d(w,500),Z={type:"canvas",format:"png",quality:1},$=["jpeg","webp","png"];if(window.jQuery){var _=window.jQuery;_.fn.croppie=function(a){var b=typeof a;if("string"===b){var c=Array.prototype.slice.call(arguments,1),d=_(this).data("croppie");return"get"===a?d.get():"result"===a?d.result.apply(d,c):"bind"===a?d.bind.apply(d,c):this.each(function(){var b=_(this).data("croppie");if(b){var d=b[a];if(!_.isFunction(d))throw"Croppie "+a+" method not found";d.apply(b,c),"destroy"===a&&_(this).removeData("croppie")}})}return this.each(function(){var b=new P(this,a);b.$=_,_(this).data("croppie",b)})}}P.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function(){}},P.globals={translate:"translate3d"},c(P.prototype,{bind:function(a,b){return I.call(this,a,b)},get:function(){var a=K.call(this),b=a.points;return this.options.relative&&(b[0]/=this.elements.img.naturalWidth/100,b[1]/=this.elements.img.naturalHeight/100,b[2]/=this.elements.img.naturalWidth/100,b[3]/=this.elements.img.naturalHeight/100),a},result:function(a){return L.call(this,a)},refresh:function(){return M.call(this)},setZoom:function(a){q.call(this,a),e(this.elements.zoomer)},rotate:function(a){N.call(this,a)},destroy:function(){return O.call(this)}}),a.Croppie=window.Croppie=P,"object"==typeof module&&module.exports&&(module.exports=P)}),define("cb/cover-photo/cover-photo-upload",["jquery","croppie","modernizr"],function(a,b){"use strict";var c=function(a,b){if(a.files&&a.files[0]){var c=new FileReader;c.onload=function(a){b.croppie("bind",{url:a.target.result})},c.readAsDataURL(a.files[0])}},d=function(a){b.filereader||(a.find(".cropping-disabled").addClass("hidden"),a.find(".save-grouping").addClass("hidden"),a.find(".cropped-result").removeClass("hidden"))},e=function(a,b,c){var d=c.find(".cropping-tool-container"),e=d.innerWidth(),f=parseInt(d.css("padding-left"),10),g=parseInt(d.css("padding-right"),10),h=50,i=e-(f+g)-h,j=i/a,k={smallCoverPhotoWidth:i,smallCoverPhotoHeight:b*j};return k.paddingCoverPhotoWidth=k.smallCoverPhotoWidth+h,k.paddingCoverPhotoHeight=k.smallCoverPhotoHeight+h,k},f=function(a){var b=a.data.coverPhotoUpload;a.preventDefault(),b.saveImage()},g=function(a){var b=a.data.coverPhotoUpload,d=b.$elm;b=b.initCroppie();var e=b.dimensions.paddingCoverPhotoWidth;c(this,b.croppie),d.find(".preview-grouping").removeClass("hidden"),d.find(".cropping-wrapper").css({width:e,"margin-left":"auto","margin-right":"auto"}),d.find(".cr-slider").attr("step","any");var f=d.find(".save-grouping");f.hasClass("hidden")||f.addClass("hidden")},h=function(a){var b=a.data.$elm;b.find(".theme-options").addClass("hidden"),b.find(".custom-cover-photo-heading").addClass("hidden"),b.find(".custom-cover-photo-help").removeClass("hidden")},i=function(a){var b=a.data;b.coverPhotoUpload.$elm.find(".crop-result").hasClass("dont-process")||b.coverPhotoUpload.croppie.croppie("result",{type:"blob",size:b.dimensions}).then(function(a){b.coverPhotoUpload.getResult({src:a})})},j=function(b,c,d){this.elm=b,this.$elm=a(b),this.width=c,this.height=d};return j.prototype.init=function(){d(this.$elm),this.$input=this.$elm.find('[name="photo"]'),this.$input.on("change",{coverPhotoUpload:this},g),this.$input.on("click",{$elm:this.$elm},h),this.$elm.find("#save-btn").on("click",{coverPhotoUpload:this},f),a(".crop-result").on("click",{dimensions:{width:this.width,height:this.height},coverPhotoUpload:this},i)},j.prototype.initCroppie=function(){return this.croppie?this:(this.dimensions=e(this.width,this.height,this.$elm),this.croppie=this.$elm.find(".cropping-container").croppie({viewport:{width:this.dimensions.smallCoverPhotoWidth,height:this.dimensions.smallCoverPhotoHeight,type:"square"},boundary:{width:this.dimensions.paddingCoverPhotoWidth,height:this.dimensions.paddingCoverPhotoHeight},enableExif:!0}),this)},j.prototype.getResult=function(b){var c=(window.URL||window.webkitURL).createObjectURL(b.src);this.$elm.find(".custom-cover-photo-upload").attr("src",c),this.$elm.find(".preview-grouping").addClass("hidden"),this.$elm.find(".save-grouping").removeClass("hidden"),a("html,body").animate({scrollTop:a(".cropped-result").offset().top-250}),this.image=b.src},j.prototype.saveImage=function(){var b=new FormData;b.append("photo",this.image);var c=this.$input.get(0).form.action;a.ajax({url:c,type:"POST",data:b,contentType:!1,processData:!1}).done(function(a){if(a.redirect)return void(window.location.href=a.redirect)})},j}),require(["jquery","cb/cover-photo/cover-photo-upload"],function(a,b){"use strict";a(function(){a(".js-cover-photo-upload").each(function(){var c=a(this);this.coverPhotoUpload=new b(this,Number.parseInt(c.data("photoWidth"),10),Number.parseInt(c.data("photoHeight"),10)),this.coverPhotoUpload.init()})})}),define("cb/cover-photo/main",function(){}),require(["jquery"],function(a){"use strict";function b(a,b){b=b.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+b+"(=([^&#]*)|&|#|$)"),d=c.exec(a);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null}a(function(){var c=window.location.href,d=b(c,"location"),e=b(c,"backup"),f=null;null!==d&&""!==d&&"undefined"!=typeof a("#"+d).offset()?f=d:null!==e&&""!==e&&"undefined"!=typeof a("#"+e).offset()&&(f=e),null!==f&&a("html, body").animate({scrollTop:a("#"+f).offset().top-250},250)})}),define("cb/site-anchor/main",function(){}),require(["jquery","cb/swipeable/swipeable"],function(a,b){"use strict";a(function(){a(".js-swipeable-container").size()&&(new b).initialize()})}),define("cb/swipeable/main",function(){}),define("cb/slider-switch/slider-switch",["jquery"],function(a){"use strict";var b={postData:function(b,c,d,e,f){var g=b.data("group"),h=b.is(":checked");b.prop("disabled",!0).attr("disabled","disabled"),b.addClass("in"),a('[data-group="'+g+'"]').each(function(){a(this).prop("disabled",!0).attr("disabled","disabled")}),a.post(c,d).done(function(a){e&&e(a)}).fail(function(a){b.prop("checked",!h);var c;try{c=JSON.parse(a.responseText)}catch(d){c={}}f&&f(a.status,c)}).always(function(){a('[data-group="'+g+'"]').each(function(){a(this).removeProp("disabled").removeAttr("disabled")}),b.removeProp("disabled").removeAttr("disabled"),
b.removeClass("in")})},handleHttpError:function(a,b){401===a&&b.redirect&&(window.location.href=b.redirect)},onToggleNotification:function(c){var d=a(c.currentTarget),e=d.data("save-url"),f=d.is(":checked"),g={name:d.data("name"),value:d.val(),isEnabled:f},h=function(a){};b.postData(d,e,g,h,b.handleHttpError)}},c=function(){this.methods=b};return c.prototype.initialize=function(){a(".js-slider-checkbox").on("change",{saveSettings:this},this.methods.onToggleNotification)},c}),define("cb/slider-switch/main",["jquery","cb/slider-switch/slider-switch"],function(a,b){"use strict";a(function(){(new b).initialize()})}),define("text!cb/amplify/template.jst",[],function(){return'<div id="amplifiers-modal" class="modal fade">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" title="Close">&times;</button>\n                <h3 class="modal-title">People who <i class="cbicon-heart"></i> this</h3>\n            </div>\n            <div class="modal-body">\n                <ul>\n                <% _.each(amplifiers, function(a) { %>\n                    <li><%= a.name %></li>\n                <% }); %>\n                </ul>\n                <div style="overflow: hidden;">\n                    <% if (hasPrev) { %>\n                        <button class="show-prev pull-left btn btn-default" data-page="<%= prevPage %>">&larr; Previous</button>\n                    <% } %>\n                    <% if (hasNext) { %>\n                        <button class="show-next pull-right btn btn-default" data-page="<%= nextPage %>">Show Next &rarr;</button>\n                    <% } %>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("cb/amplify/main",["jquery","underscore","text!cb/amplify/template.jst","bootstrap"],function(a,b,c){"use strict";var d=function(){var d=this,e=new Image;e.src="/assets/images/spinner.gif",this.onListAmplifiers=function(d,f){d.css("opacity","0.5").append(' <img src="'+e.src+'" alt=""/>');var g;g=d.data("page")?parseInt(d.data("page"),10):1,a.ajax(f,{type:"GET",dataType:"json",data:{page:g}}).done(function(e){d.css("opacity","1.0").find("img").remove();var g=a(b.template(c,{amplifiers:e.amplifiers,hasNext:e.hasNext,hasPrev:e.hasPrev,prevPage:e.prevPage,nextPage:e.nextPage}));a("#amplifiers-modal").size()?a("#amplifiers-modal .modal-body").replaceWith(g.find(".modal-body")):a("body").prepend(g),a("#amplifiers-modal").data("request",f),a("#amplifiers-modal").modal({backdrop:!0,keyboard:!0,show:!0})}).fail(function(){d.css("opacity","1.0").find("img").remove()})},this.listAmplifiers=function(b){b.preventDefault();var c=a(b.currentTarget),e=c.parents(".amplify-action-list").data("request");d.onListAmplifiers(c,e)},this.amplify=function(b){b.preventDefault();var c=a(b.currentTarget),d=c.parents(".amplify").find(".amplify-action-list"),f=c.hasClass("active");d.html('<img src="'+e.src+'" alt=""/>'),c.css("opacity",.5),a.ajax(c.data("request"),{type:f?"DELETE":"POST",dataType:"json"}).done(function(a){c.removeClass("active"),a.amped&&c.addClass("active"),a.count?(d.size()||(d=c.parents(".amplify").append('<div class="amplify-action-list"></div>').find(".amplify-action-list")),d.html(a.count)):d.empty(),c.css("opacity",1)}).fail(function(b){if(401===b.status){var d=a.parseJSON(b.responseText);document.location.href=d.redirect}else document.location.href=c.siblings("input").val()})},this.showNext=function(b){b.preventDefault();var c=a("#amplifiers-modal").data("request"),e=a(b.currentTarget);d.onListAmplifiers(e,c)},this.showPrev=function(b){b.preventDefault();var c=a("#amplifiers-modal").data("request"),e=a(b.currentTarget);d.onListAmplifiers(e,c)},this.initialize=function(){a("body").on("click",".amplify-action-list a",d.listAmplifiers),a("body").on("click",".amplify-action-link",d.amplify),a("body").on("click","#amplifiers-modal .show-next",d.showNext),a("body").on("click","#amplifiers-modal .show-prev",d.showPrev)}};a(function(){(new d).initialize()})}),define("text!cb/author/remove.jst",[],function(){return'<div id="author-remove-modal" class="modal fade">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" title="Close">&times;</button>\n                <h3 class="modal-title">Remove Co-Author</h3>\n            </div>\n            <div class="modal-body">\n                Are you sure you want to remove <%- name %> as a co-author?\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>\n                <a href="<%= src %>" data-target="<%= target %>" class="submit-modal btn btn-primary">Yes, I\'m Sure</a>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/author/designate.jst",[],function(){return'<div id="author-designate-modal" class="modal fade">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" title="Close">&times;</button>\n                <h3 class="modal-title">Make Primary Author</h3>\n            </div>\n            <div class="modal-body">\n                You are designating <%- name %> as the primary author of this site. By doing so,\n                you will become a co-author and no longer have the ability to delete the site\n                or manage co-authors.\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>\n                <a href="<%= src %>" class="submit-modal btn btn-primary">OK</a>\n            </div>\n        </div>\n    </div>\n</div>\n'}),require(["jquery","underscore","text!cb/author/remove.jst","text!cb/author/designate.jst","bootstrap"],function(a,b,c,d){"use strict";var e=function(){var e=this;this.designateModal=function(c){c.preventDefault();var e=a(c.currentTarget);a("#author-designate-modal").remove(),a("body").append(b.template(d,{src:e.attr("href"),name:e.data("name")})),a("#author-designate-modal").modal({backdrop:!0,keyboard:!0,show:!0})},this.removeModal=function(d){d.preventDefault();var e=a(d.currentTarget);a("#author-remove-modal").remove(),a("body").append(b.template(c,{src:e.attr("href"),name:e.data("name"),target:e.parents("tr").attr("id")})),a("#author-remove-modal").modal({backdrop:!0,keyboard:!0,show:!0})},this.removeCoAuthor=function(b){b.preventDefault();var c=a(b.currentTarget),d=a("#"+c.data("target"));a("#author-remove-modal").modal("hide"),d.css("opacity","0.5"),d.find(".author-name").append('<img src="/assets/images/spinner.gif" alt=""/>'),a.post(c.attr("href")).done(function(){d.remove(),a("[id=flash-messages] div").remove(),a("[id=flash-messages]").append('<div class="alert alert-success">The co-author has been removed.</div>')}).fail(function(){document.location.href=c.attr("href")})},this.initialize=function(){a("body").on("click","a.coauthor-remove-link",e.removeModal).on("click","#author-remove-modal .submit-modal",e.removeCoAuthor).on("click","a.coauthor-designate-link",e.designateModal),a(".coauthor-help").popover()}};a(function(){a("#manage-coauthors").size()&&(new e).initialize()})}),define("cb/author/main",function(){}),require(["jquery"],function(a){"use strict";var b=function(){var b=this;this.isLoading=!1,this.taskCreate=function(c){if(a(c.target).is("a, button"))return!0;if(b.isLoading)return!1;var d=a(c.currentTarget),e=d.data("click");e&&(b.isLoading=!0,d.css("background","#f9f9f9 url(/assets/images/spinner.gif) no-repeat center center"),document.location.href=e)},this.hideMore=function(){a(".more-tasks-container").slideUp(100),a(".task-preview").hide()},this.showMore=function(c){c.preventDefault(),b.hideMore();var d=a(c.currentTarget),e=d.parent().parent(),f=e.position(),g=f.left-(d.prev().width()/2-e.width()/2),h=d.position().top+d.height()+12,i=a("#calendar-controls").width()+a("#calendar-controls").position().left;return g+d.prev().width()>i&&(g=i-d.prev().width()),d.prev().show().css("left",g+"px").css("top",h+"px"),!1},this.initialize=function(){a("#add-task-btn").size()&&a("body").on("click.add-task",".calendar-cell",b.taskCreate),a(document).keyup(function(a){27===a.keyCode&&b.hideMore.apply(b,[])}),a(".more-tasks").on("click.show-more-tasks",b.showMore)}};a(function(){a("#calendar-controls").size()&&(new b).initialize()})}),define("cb/calendar/main",function(){}),require(["jquery"],function(a){"use strict";a(".journal-action-non-mobile #draft-btn, .journal-action-mobile #draft-btn").click(function(){a("#add-journal-toolbar-alert").addClass("hidden");var b=a(this).closest("form"),c=b.attr("action"),d=b.serializeArray();d.push({name:this.name,value:this.value}),a.ajax({type:"POST",url:c,data:d,success:function(b){if(b.success===!0){var c=window.location.href.split("#")[0];c=c.split("?")[0],c+=b.url,window.location.href=c}else a("#add-journal-toolbar-alert").removeClass("hidden")}})}),a(".journal-action-non-mobile #journal-submit-btn, .journal-action-mobile #journal-submit-btn").click(function(){a("#add-journal-toolbar-alert").addClass("hidden");var b=a(this).closest("form"),c=b.attr("action"),d=b.serializeArray();d.push({name:this.name,value:this.value}),a.ajax({type:"POST",url:c,data:d,success:function(b){if(b.success===!0){var c=window.location.href.split("#")[0];c=c.split("?")[0],c+=b.url,window.location.href=c}else a("#add-journal-toolbar-alert").removeClass("hidden")}})}),a("#journal").on("submit",function(a){a.preventDefault()})}),define("cb/index-journal/main",function(){}),define("cb/comments/model",["jquery","underscore","backbone"],function(a,b,c){"use strict";return c.Model.extend({url:function(){var b=a("#comment-container").find(".comment-replies"),c=this.attributes["item-type"]?this.attributes["item-type"]:b.data("type"),d=this.attributes["item-id"]?this.attributes["item-id"]:b.data("item"),e=this.attributes.site?this.attributes.site:b.data("site"),f="/comments/"+c+"/"+d;return e&&(f="/visit/"+e+"/comments/"+c+"/"+d),this.get("id")&&(f=f+"/"+this.get("id")),f},defaults:{"author-photo":"","reply-link":"","edit-link":"","delete-link":"","author-name":"",body:"",posted:"",signature:"",amps:"","item-type":"","item-id":"",site:""}})}),define("cb/comments/collection",["jquery","underscore","backbone","cb/comments/model"],function(a,b,c,d){"use strict";return c.Collection.extend({url:function(){var b=a("#comment-container").find(".comment-replies"),c=b.data("type"),d=b.data("item"),e="/comments/"+c+"/"+d;if(b.data("site")){var f=b.data("site");e="/visit/"+f+"/comments/"+c+"/"+d}return e},model:d})}),define("text!cb/comments/comments.jst",[],function(){return'<%\n/**\n * This is comments on task\n */\n%>\n<% _.each(comments, function(comment) { %>\n    <article class="comment-reply list-group-item" id="comment-<%= comment.get(\'id\') %>">\n        <div class="comment-reply" id="comment-<%= comment.get(\'id\') %>">\n            <div class="media">\n                <span class="pull-left">\n                    <%= comment.get(\'author-photo\') %>\n                </span>\n                <div class="media-body">\n                    <header>\n                        <div class="btn-group pull-right">\n                            <% if (comment.get(\'edit-link\')) { %>\n                                <a href="<%= comment.get(\'edit-link\') %>" data-id="<%= comment.get(\'id\') %>" class="btn btn-default edit-reply">\n                                    Edit\n                                </a>\n                        <% } %>\n                        <% if (comment.get(\'delete-link\')) { %>\n                            <a href="<%= comment.get(\'delete-link\') %>" data-id="<%= comment.get(\'id\') %>" class="btn btn-default delete-reply confirm-delete" data-item-description="Comment">\n                                <span class="sr-only">Delete comment</span>\n                                <i class="icon-trash" role="presentation" aria-hidden="true"></i>\n                            </a>\n                        <% } %>\n                        </div>\n                        <h5 class="media-heading">\n                            <span class="js-comment-signature">\n                                <%= (comment.get(\'signature\')) ? comment.get(\'signature\') : comment.get(\'author-name\') %>\n                            </span>\n                        </h5>\n                        <span class="text-muted">\n                            <time><%= comment.get(\'posted\') %></time>\n                        </span>\n                    </header>\n                <div class="user-generated">\n                    <%= comment.get(\'body\') %>\n                </div>\n                <% if (comment.get(\'amps\')) { %>\n                    <div class="comment-actions">\n                        <%= comment.get(\'amps\') %>\n                    </div>\n                <% } %>\n            </div>\n        </div>\n    </article>\n<% }); %>\n'}),define("text!cb/comments/photo-comments.jst",[],function(){return'<%\n/**\n * This is comments on photos\n */\n%>\n<% _.each(comments, function(comment) { %>\n    <article class="comment-reply list-group-item" id="comment-<%= comment.get(\'id\') %>">\n        <div class="comment-reply" id="comment-<%= comment.get(\'id\') %>">\n            <div class="media">\n                <span class="pull-left">\n                    <%= comment.get(\'author-photo\') %>\n                </span>\n                <div class="media-body">\n                    <header>\n                        <div class="btn-group pull-right">\n                            <% if (comment.get(\'edit-link\')) { %>\n                                <a href="<%= comment.get(\'edit-link\') %>" data-id="<%= comment.get(\'id\') %>" class="edit-reply">\n                                    <i class="icon-edit" role="presentation" aria-hidden="true"></i>\n                                </a>\n                        <% } %>\n                        <% if (comment.get(\'delete-link\')) { %>\n                            <a href="<%= comment.get(\'delete-link\') %>" data-id="<%= comment.get(\'id\') %>" class="delete-reply confirm-delete" data-item-description="Comment" data-handler-target="#comment-<%= comment.get(\'id\') %>">\n                                <span class="sr-only">Delete comment</span>\n                                <i class="icon-trash" role="presentation" aria-hidden="true"></i>\n                            </a>\n                        <% } %>\n                        </div>\n                        <h5 class="media-heading">\n                            <span class="js-comment-signature photo-comment-signature">\n                                <%= (comment.get(\'signature\')) ? comment.get(\'signature\') : comment.get(\'author-name\') %>\n                            </span>\n                        </h5>\n                        <span class="text-muted">\n                            <time><%= comment.get(\'posted\') %></time>\n                        </span>\n                    </header>\n                <div class="user-generated">\n                    <%= comment.get(\'body\') %>\n                </div>\n                <% if (comment.get(\'amps\')) { %>\n                    <div class="comment-actions">\n                        <%= comment.get(\'amps\') %>\n                    </div>\n                <% } %>\n            </div>\n        </div>\n    </article>\n<% }); %>\n'}),define("text!cb/comments/replies.jst",[],function(){return'<%\n/**\n * This is replies to private messages\n */\n%>\n<% _.each(comments, function(comment) { %>\n    <article class="comment-reply list-group-item" id="comment-<%= comment.get(\'id\') %>">\n        <div class="media">\n            <span class="pull-left">\n                <%= comment.get(\'author-photo\') %>\n            </span>\n            <div class="media-body">\n                <header>\n                    <div class="btn-group pull-right">\n                        <% if (comment.get(\'edit-link\')) { %>\n                            <a href="<%= comment.get(\'edit-link\') %>" data-id="<%= comment.get(\'id\') %>" class="btn btn-default edit-reply">\n                                Edit\n                            </a>\n                        <% } %>\n                        <% if (comment.get(\'delete-link\')) { %>\n                            <a href="<%= comment.get(\'delete-link\') %>" data-id="<%= comment.get(\'id\') %>" class="btn btn-default close delete-reply confirm-delete" data-item-description="Comment">\n                                <span class="sr-only">Delete comment</span>\n                                <i class="icon-trash" role="presentation" aria-hidden="true"></i>\n                            </a>\n                        <% } %>\n                    </div>\n                    <h5 class="media-heading">\n                        <%= (comment.get(\'signature\')) ? comment.get(\'signature\') : comment.get(\'author-name\') %>\n                    </h5>\n                    <span class="text-muted">\n                        <time><%= comment.get(\'posted\') %></time>\n                    </span>\n                </header>\n                <div class="user-generated">\n                    <%= comment.get(\'body\') %>\n                </div>\n            </div>\n        </div>\n    </article>\n<% }); %>\n'}),define("text!cb/comments/success-subscribe.jst",[],function(){return'<div class="alert alert-success">\n    <p>Your reply has been posted.</p>\n    <p>To keep up on new journal entries, you\'ll receive notifications making it easy to stay connected. As always, you can choose to unsubscribe from your <a href="/notifications">notifications</a>.</p>\n</div>\n'}),define("text!cb/comments/success.jst",[],function(){return'<div class="alert alert-success">\n    <p>Your reply has been posted.</p>\n</div>\n'}),define("text!cb/comments/comment-edit.jst",[],function(){return'<div id="comment-edit-form" class="comment-edit-form">\n    <div class="form-group">\n        <label for="edit-comment" class="sr-only">Post your comment</label>\n        <textarea data-qa-id="edit-comment-textarea" name="edit-comment" id="edit-comment" rows="1" class="form-control"><%= content %></textarea>\n    </div>\n    <input type="hidden" name="edit-signature" id="edit-signature" value="<%= signature %>">\n    <div class="form-group button-bar">\n        <button class="btn btn-primary save-edit-changes pull-right" data-qa-id="save-changes" data-id="<%= id %>" type="button">Save Changes</button>\n        <button class="btn btn-link cancel-edit-changes pull-right" type="button">Cancel</button>\n    </div>\n</div>\n'}),define("cb/comments/view",["jquery","underscore","backbone","cb/comments/collection","cb/comments/model","text!cb/templates/error.jst","text!cb/comments/comments.jst","text!cb/comments/photo-comments.jst","text!cb/comments/replies.jst","text!cb/comments/success-subscribe.jst","text!cb/comments/success.jst","text!cb/comments/comment-edit.jst"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";return c.View.extend({events:{"click .delete-reply":"deleteReply","click .edit-reply":"editReply","click .user-generated":"editReply","click .submit-comment":"add","click .save-edit-changes":"editSave","click .cancel-edit-changes":"editCancel"},initialize:function(){this.collection=new d,this.model=e,this.setElement(a("#comment-container")),"message"===this.$el.data("type")?this.template=i:"photo"===this.$el.data("type")?this.template=h:this.template=g},render:function(){var a=this.collection.models,c=this.$el.find(".pagination").clone(),d=this.$el.find(".comment-replies");return d.html(b.template(this.template,{comments:a})),d.append(c),this.renderCommentCount(),this},renderCommentCount:function(){var a=this.collection.length,b=this.$el.find(".comment-count");b.find(".num").text(a),b.find(".text").text(1===a?"Comment":"Comments")},decrementCommentCount:function(){var a=this.$el.find(".comment-count"),b=parseInt(a.find(".num").text(),10);if(b>0){var c=parseInt(a.find(".num").text(),10)-1;a.find(".num").text(c),a.find(".text").text(1===c?"Comment":"Comments")}},refresh:function(a){var b=this;return this.collection.fetch({success:function(){b.render()},error:function(){b.renderError.apply(b,[""])}}),this},editSave:function(b){b.preventDefault();var c=a(b.currentTarget),d=c.data("id"),f=a("#comment-edit-container");f.find("img, .alert-error").remove(),f.find(".save-edit-changes").before('<img src="/assets/images/spinner.gif" alt=""/>'),f.find("textarea").attr("disabled","disabled").css("opacity","0.4");var g=new e,h=this;g.set({id:d,body:a.trim(a("#edit-comment").val()),signature:a.trim(a("#edit-signature").val())}),g.save(null,{wait:!0,success:function(){var b=c.parents(".comment-reply");b.find(".user-generated").show(),b.find(".user-generated").html(g.get("body").replace(/\r\n|\r|\n/g,"<br>\n")),b.find(".js-comment-signature").html(g.get("signature")),a("#comment-edit-form").remove(),a(".photo-viewer-modal").trigger("photo-viewer-comment-complete")},error:function(a,b){f.find("img").remove(),f.find("textarea").removeAttr("disabled").css("opacity","1.0"),401===b.status?document.location.href=c.attr("href"):404===b.status?h.renderError.apply(h,[b.responseText]):f.find("textarea").after('<div class="alert alert-error"><i class="icon-exclamation-sign"></i> There was a problem saving your changes. Please try again.</div>')}})},editCancel:function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a(b.currentTarget);c.parents(".comment-reply").find(".user-generated").show(),a("#comment-edit-form").remove()},editReply:function(c){c.preventDefault();var d=a("#comment-edit-form");d.parents(".comment-reply").find(".user-generated").show(),d.remove();var e=a(c.currentTarget).parents(".comment-reply").find(".edit-reply");if(e.size()){var f=e.data("id"),g=a("#comment-"+f),h=g.find(".user-generated"),i=g.find(".js-comment-signature"),j=a.trim(i.text())||"",k=a.trim(h.text().replace(/<br\s*\/?>/g,""));h.after(b.template(l,{id:f,content:k,signature:j}));var m=a("#edit-comment");m.focus();var n=0,o=m.css("padding-top");"undefined"!==o&&(n=parseInt(o.replace("px",""),10)),o=m.css("padding-bottom"),"undefined"!==o&&(n+=parseInt(o.replace("px",""),10)),m.css("height","auto").css("height",h.height()+n),m.css("border-radius","18px"),m.css("resize","none"),m.css("width","90%"),m.on("keyup input",function(){var b=a(this),c=this.offsetHeight-this.clientHeight;b.css("height","auto").css("height",this.scrollHeight+c)}),h.hide()}},deleteReply:function(b){b.preventDefault();var c=a(b.currentTarget),d=c.data("id"),f=a("#comment-"+d),g=new e,h=this;c.hasClass("confirm-delete")?f.on("item-deleted",function(a,b){f.remove(),h.collection.remove(g),h.decrementCommentCount()}):(g.set({id:d}),g.destroy({wait:!0,success:function(){f.size()&&f.hide(250,function(){f.remove()}),this.renderCommentCount()},error:function(a,b){401===b.status?document.location.href=c.attr("href"):404===b.status&&h.renderError.apply(h,[b.responseText])}}))},add:function(b){b.preventDefault();var c=new e,d=a(b.currentTarget).parents("form"),f=this,g=a.trim(d.find("textarea").val());if(d.find(".alert").remove(),!g.length)return void d.find("textarea").after('<div class="alert alert-error">Your comment is empty. Please enter your comment.</div>');var h={body:g,signature:d.find('input[name="signature"]').val()};d.find('input[name="client-metrics"]').size()&&(h["client-metrics"]=d.find('input[name="client-metrics"]').val()),c.save(h,{success:function(b,c){var e;c.autoSubscribe&&(f.autoSubscribe=!0,e="Your comment has been posted. To make it easy to stay connected, you will get an email notification when new Journal entries are posted. As always, you can choose to unfollow the site to stop receiving notifications."),f.collection.add(b),f.$el.find(".comment-replies").prepend('<div class="comment-loader"><img src="/assets/images/loader.gif" alt=""/></div>'),f.refresh(b.get("id")),e&&d.prepend('<p class="alert alert-success">'+e+"</p>");var g=d.find("textarea");g.val(""),g.css("height","auto").css("height",g.scrollHeight),a(".photo-viewer-modal").trigger("photo-viewer-comment-complete")},error:function(b,c){400===c.status?a("#comment-container").before(c.responseText):d.submit()}})},renderError:function(c){a("#comment-container").before(b.template(f,{message:c})),this.render()}})}),!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():a[b]=c()}(this,"verge",function(){function a(){return{width:k(),height:l()}}function b(a,b){var c={};return b=+b||0,c.width=(c.right=a.right+b)-(c.left=a.left-b),c.height=(c.bottom=a.bottom+b)-(c.top=a.top-b),c}function c(a,c){return a=a&&!a.nodeType?a[0]:a,!(!a||1!==a.nodeType)&&b(a.getBoundingClientRect(),c)}function d(b){b=null==b?a():1===b.nodeType?c(b):b;var d=b.height,e=b.width;return d="function"==typeof d?d.call(b):d,e="function"==typeof e?e.call(b):e,e/d}var e={},f="undefined"!=typeof window&&window,g="undefined"!=typeof document&&document,h=g&&g.documentElement,i=f.matchMedia||f.msMatchMedia,j=i?function(a){return!!i.call(f,a).matches}:function(){return!1},k=e.viewportW=function(){var a=h.clientWidth,b=f.innerWidth;return b>a?b:a},l=e.viewportH=function(){var a=h.clientHeight,b=f.innerHeight;return b>a?b:a};return e.mq=j,e.matchMedia=i?function(){return i.apply(f,arguments)}:function(){return{}},e.viewport=a,e.scrollX=function(){return f.pageXOffset||h.scrollLeft},e.scrollY=function(){return f.pageYOffset||h.scrollTop},e.rectangle=c,e.aspect=d,e.inX=function(a,b){var d=c(a,b);return!!d&&d.right>=0&&d.left<=k()},e.inY=function(a,b){var d=c(a,b);return!!d&&d.bottom>=0&&d.top<=l()},e.inViewport=function(a,b){var d=c(a,b);return!!d&&d.bottom>=0&&d.right>=0&&d.top<=l()&&d.left<=k()},e}),define("verge",function(a){return function(){var b;return b||a.verge}}(this)),!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():a[b]=c()}(this,"res",function(){function a(a){return null==a?m:a===a&&(l?l>=a:k([["min--moz-device-pixel-ratio:",a],["min-resolution:",a*d,"dpi"]],j))}function b(b){return null==b?a()*d:a(b/d)}function c(b){return null==b?a()/e:a(b*e)}var d=96,e=2.54/d,f="undefined"!=typeof window&&window,g="undefined"!=typeof screen&&screen,h=[].join,i=f.matchMedia,j=i?function(){return!!i.call(f,"("+h.call(arguments,"")+")").matches}:function(){return!1},k=function(a,b,c){for(var d=0,e=a.length;e>d;)if(b.apply(c,a[d++]))return!0;return!1},l=+f.devicePixelRatio||Math.sqrt(g.logicalXDPI*g.logicalYDPI)/d||0,m=l||!i?l:function(a){for(var b,c=41;c--&&!a(b=c/20););return b}(a);return{dppx:a,dpcm:c,dpi:b}}),define("res",function(a){return function(){var b;return b||a.res}}(this)),define("cb/client-metrics/client-metrics",["modernizr","verge","res"],function(a,b,c){"use strict";var d=function(){this.getMetrics=function(){var d={};if("undefined"!=typeof b){var e=b.viewportW();e&&(d.vpw=e);var f=b.viewportH();f&&(d.vph=f)}if("undefined"!=typeof c){var g=c.dpi();g&&(d.dpi=g)}if("undefined"!=typeof window.screen){if("undefined"!=typeof window.screen.width){var h=window.screen.width;h&&(d.dw=h)}if("undefined"!=typeof window.screen.height){var i=window.screen.height;i&&(d.dh=i)}if("undefined"!=typeof window.screen.availWidth){var j=window.screen.availWidth;j&&(d.daw=j)}if("undefined"!=typeof window.screen.availHeight){var k=window.screen.availHeight;k&&(d.dah=k)}"undefined"!=typeof a&&"undefined"!=typeof a.touch&&(d.touch=a.touch),d.userAgent=navigator.userAgent}return d}};return new d}),define("text!cb/comments/single.jst",[],function(){return'<article class="comment-block <% (\'comment\' === parentType) ? print(\'reply-block\') : print(\'\') %>">\n   <div class="row">\n      <div class="col-xs-12">\n         <div class="comment-item">\n             <div class="info-line">\n                <span class="comment-signature"><%= signature %></span>|<span class="comment-date"><%= posted %></span>\n             </div>\n             <div class="fade-out fade-out-medium">\n                <div class="user-generated comment-body" data-qa-id="comment-body-<%= commentId %>"><%= body %></div>\n                <div class="read-more">\n                   <button class="comments pull-right show-more btn btn-link" data-qa-id="comment-<%= commentId %>-read-more" data-ga-action="Click - link" data-ga-label="Read more comment">\n                   <small>\n                        Read More <span class="visuallyhidden">of <%= signature %>’s post from <%= posted %></span>\n                   </small>\n                   </button>\n                </div>\n             </div>\n         </div>\n         <span class="toolbar" role="toolbar">\n             <%= amps %>\n             <% if (replyLink) { %>\n                 <a class="js-reply-comment reply-comment" data-toggle="collapse" href="#reply-<%= parentId %>" data-id="<%= parentId %>" title="Reply to this comment post" data-ga-action="Click - link" data-ga-label="Reply to child comment">\n                    <i class="icon cbicon-comments" aria-hidden="true" role="presentation"></i>\n                    Reply\n                </a>\n             <% } %>\n             <% if (editLink) { %>\n                 <a href="<%= editLink %>" class="edit-comment" data-id="<%= commentId %>" title="Edit this journal comment post" data-ga-action="Click - link" data-ga-label="Edit child comment">\n                    <i class="icon icon-edit" aria-hidden="true" role="presentation"></i>\n                    Edit\n                </a>\n             <% } %>\n             <% if (editLink) { %>\n                 <a href="<%= deleteLink %>"\n                     class="confirm-delete"\n                     data-target="article"\n                     data-handler-target="[data-item-type=\'journal\'][data-item-id=\'<%= journalId %>\']"\n                     data-type="comment"\n                     data-id="<%= commentId %>"\n                     data-suppress-redirect="true"\n                     data-item-description="Comment"\n                     data-ga-action="Click - link"\n                     data-ga-label="Delete child comment"\n                     title="Delete this journal comment post">\n                 <i class="icon cbicon-delete" aria-hidden="true" role="presentation"></i>Delete</a>\n             <% } %>\n         </span>\n      </div>\n   </div>\n</article>\n'}),define("cb/comments/aggregate-view",["underscore","jquery","cb/client-metrics/client-metrics","cb/comments/model","text!cb/comments/single.jst","text!cb/comments/comment-edit.jst"],function(a,b,c,d,e,f){"use strict";var g={applyCommentsToggleClickHandler:function(a){a.find(".comments-toggle").on("click",function(a){a.preventDefault(),b(this).closest("article.supports-comments").find(".comments-toggle i").toggleClass("hide"),b(this).closest("article.supports-comments").find(".comments-body").toggleClass("hide"),b(this).closest("article.supports-comments").find(".first-load-more").click(),b(this).closest("article.supports-comments").find(".comments-body").hasClass("hide")||b("html, body").animate({scrollTop:b(".timeline-comment").offset().top-100},"slow")}),a.find(".submit-comment").on("click",function(a){g.createNewComment(a)})},applyCommentsAnchorClickHandler:function(a){a.find(".comments-anchor").on("click",function(a){a.preventDefault(),b("html, body").animate({scrollTop:b(this).closest("article.supports-comments").find(".comments-anchor").offset().top+370})})},applyDeleteCommentHandler:function(a){a.hasClass("supports-comments")&&"article"===a.prop("tagName").toLowerCase()&&a.on("item-deleted",function(a,c){
"comment"===c.type&&(g.updateCommentCountLabel(b(a.currentTarget),-1),b(this).closest("article.supports-comments").find(".alert").remove())})},applyEditCommentsClickHandler:function(a){b(a).find(".edit-comment").off("click").on("click",function(a){g.editComment(a)})},applyReplyCommentsClickHandler:function(a){b(a).find(".submit-reply").off("click").on("click",function(a){g.createNewComment(a)}),b(a).find("#comment-body").on("keyup focus input",function(a){var c=b(this),d=this.offsetHeight-this.clientHeight;c.css("height","auto").css("height",this.scrollHeight+d)}),b(a).find(".js-reply-comment").on("click",function(a){var d=b(this).attr("href");b(d).on("hide.bs.collapse",function(){return g.scrollToViewPort(this,120),b(this).find("textarea#comment-body").focus(),!1}),b(d).on("shown.bs.collapse",function(){var a=JSON.stringify(c.getMetrics());a&&b(this).find("input.client-metrics").each(function(){b(this).val(a)}),g.scrollToViewPort(this,120),b(this).find("textarea#comment-body").focus()})})},scrollToViewPort:function(a,c){var d=a.getBoundingClientRect(),e=d.top>=0&&d.left>=0&&d.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&d.right<=(window.innerWidth||document.documentElement.clientWidth);e||b("html, body").animate({scrollTop:b(a).offset().top-c})},applyCommentFormAnchorClickHandler:function(a){b(a).find(".js-anchor-comment-form").off("click.infinite-scroll"),b(a).find(".js-anchor-comment-form").on("click",function(){var a=b(this).closest("article.supports-comments").find("form#comment");g.scrollToViewPort(a[0],120),a.find("textarea#comment-body").focus()}),b(a).find(".load-more").on("click",function(a){a.preventDefault();var c=b(this).closest(".js-journal-list-more").siblings(".js-anchor-comment-form-button"),d=c.length;d>0&&c.last().remove()})},applyInfiniteScrollEventHandler:function(a,c){b(c).find(".js-infinite-scroll").on("load-more-complete",function(c,d){if(g.applyEditCommentsClickHandler(d),g.applyReplyCommentsClickHandler(d),g.applyCommentFormAnchorClickHandler(d),d instanceof Array)for(var e=0,f=d.length;e<f;e++)a.append(b(d[e]).find(".comments-toggle").closest("article.supports-comments"));else a.append(b(d).find(".comments-toggle").closest("article.supports-comments"))})},editComment:function(c){c.preventDefault();var d=b(c.currentTarget);if(d.size()){var e=d.closest("article.comment-block"),h=e.hasClass("reply-block");h?e.parent(".comment-block").find(".cancel-edit-changes").trigger("click"):e.find(".cancel-edit-changes").trigger("click");var i=d.data("id"),j=e.find(".comment-body:first"),k=e.find(".comment-signature:first"),l=b.trim(k.text())||"",m=b.trim(j.text().replace(/<br\s*\/?>/g,""));j.after(a.template(f,{id:i,content:m,signature:l}));var n=j.outerHeight();j.hide(),e.find(".show-more").trigger("click"),g.applySaveEditHandler(e),e.find(".cancel-edit-changes").on("click",function(a){a.preventDefault(),g.switchToReadMode(e)});var o=e.find("#edit-comment");o.focus();var p=0,q=o.css("padding-top");"undefined"!==q&&(p=parseInt(q.replace("px",""),10)),q=o.css("padding-bottom"),"undefined"!==q&&(p+=parseInt(q.replace("px",""),10)),o.css("height","auto").css("height",n+p),o.on("keyup input",function(){var a=b(this),c=this.offsetHeight-this.clientHeight;a.css("height","auto").css("height",this.scrollHeight+c)})}},switchToReadMode:function(a){a.find(".comment-body").show(),a.find("#comment-edit-form").remove()},applySaveEditHandler:function(a){a.find(".save-edit-changes").on("click",function(c){c.preventDefault();var e=b(c.currentTarget),f=e.data("id");a.find(".save-edit-changes").before('<span class="spinner"><img src="/assets/images/spinner.gif" alt=""/></span>'),a.find("textarea#edit-comment").attr("disabled","disabled").css("opacity","0.4");var h=new d;h.attributes["item-type"]=a.closest("article.supports-comments").data("item-type"),h.attributes["item-id"]=a.closest("article.supports-comments").data("item-id"),h.attributes.site=a.closest("article.supports-comments").data("site");h.set({id:f,body:b.trim(a.find("#edit-comment").val()),signature:b.trim(a.find("#edit-signature").val())}),h.save(null,{wait:!0,success:function(){g.switchToReadMode(a),a.find(".comment-body:first").html(h.get("body").replace(/\r\n|\r|\n/g,"<br>\n")),a.find(".comment-signature:first").html(h.get("signature"))},error:function(b,c){var d="There was a problem saving your changes. Please try again.";401===c.status?d="You do not have access to edit this comment.":404===c.status&&(d="There was a problem saving your changes. Please try again. If the problem persists, reload and retry."),a.find(".alert-error").remove(),a.find("textarea").after('<div class="alert alert-error"><i class="icon-exclamation-sign"></i>'+d+"</div>"),a.find(".spinner").remove(),a.find("textarea").removeAttr("disabled").css("opacity","1.0")}})})},createNewComment:function(c){c.preventDefault();var f=new d,h=b(c.currentTarget).closest("form"),i=h.find("textarea"),j=b.trim(i.val());if(h.find(".alert").remove(),!j.length)return i.before('<div class="alert alert-error">Your comment is empty. Please enter your comment.</div>'),void i.focus();var k={body:j,signature:h.find('input[name="signature"]').val()};h.find('input[name="client-metrics"]').size()&&(k["client-metrics"]=h.find('input[name="client-metrics"]').val()),f.attributes["item-type"]=h.closest("article.supports-comments").data("item-type"),f.attributes["item-id"]=h.closest("article.supports-comments").data("item-id"),f.attributes.site=h.closest("article.supports-comments").data("site"),f.save(k,{success:function(b,c){var d="Your Journal comment has been posted.";c.goFundMe&&c.isAuthor!==!0&&(d='Your Journal comment has been posted. <a class="gfmComment" href="'+c.waysToHelpUrl+'" target="_blank" >'+c.siteFirstName+" has a GoFundMe to help with health expenses. Learn More.</a>"),c.autoSubscribe&&(d="Your comment was posted. Staying connected is important, so new journal entries will be emailed to you. You can unfollow the site to stop receiving emails.");var f=h.closest("article.supports-comments"),i=a.template(e,{signature:c.signature,posted:c.posted,body:c.body,amps:c.amps,editLink:c["edit-link"],replyLink:c["reply-link"],deleteLink:c["delete-link"],commentId:c.id,journalId:b.attributes["item-id"],parentId:b.attributes["item-id"],parentType:b.attributes["item-type"]});"comment"===b.attributes["item-type"]?f.find(".js-comment-reply").before(i):f.find(".comments").prepend(i),f.trigger("load-more-complete",[f]),g.updateCommentCountLabel(f,1),"comment"!==b.attributes["item-type"]&&h.prepend('<p class="alert alert-success">'+d+"</p>");var j=h.find("textarea");j.val(""),j.css("height","auto").css("height",j.scrollHeight)},error:function(a,c){if(401===c.status){var d=b.parseJSON(c.responseText);document.location.href=d.redirect}else h.find(".submit-comment").before(c.responseText)}})},updateCommentCountLabel:function(a,b){var c=parseInt(a.find(".comment-count").text(),10);switch(c+=b,a.find(".comment-count").text(c),c){case 0:g.setCommentLabelToPost(a);break;case 1:g.setCommentLabelToSingular(a);break;default:g.setCommentLabelToPlural(a)}},setCommentLabelToPost:function(a){a.find(".comment-count").addClass("hide"),a.find(".no-comment-label").removeClass("hide"),a.find(".singular-comment-label").addClass("hide"),a.find(".plural-comment-label").addClass("hide")},setCommentLabelToSingular:function(a){a.find(".comment-count").removeClass("hide"),a.find(".no-comment-label").addClass("hide"),a.find(".singular-comment-label").removeClass("hide"),a.find(".plural-comment-label").addClass("hide")},setCommentLabelToPlural:function(a){a.find(".comment-count").removeClass("hide"),a.find(".no-comment-label").addClass("hide"),a.find(".singular-comment-label").addClass("hide"),a.find(".plural-comment-label").removeClass("hide")}},h=function(c){this.append(c),g.applyInfiniteScrollEventHandler(this,document),a.each(b(".first-load-more"),function(a){b(a).data("auto-load")&&b(a).click()})};return h.prototype.append=function(c){this.elements||(this.elements={});var d=this.elements;a.each(c,function(a){var c=b(a).data("item-type")+":"+b(a).data("item-id");d[c]||(g.applyCommentsToggleClickHandler(b(a)),g.applyCommentsAnchorClickHandler(b(a)),g.applyDeleteCommentHandler(b(a))),d[c]=b(a)})},h}),define("cb/comments/main",["jquery","cb/comments/view","cb/comments/aggregate-view"],function(a,b,c){"use strict";var d=function(){return a(".comments-toggle").size()?new c(a(".comments-toggle").closest("article.supports-comments")):a(".comments-anchor").size()?new c(a(".comments-anchor").closest("article.supports-comments")):a("#comment").size()?new b:void 0};return a(function(){a(".photo-viewer-modal").is(":visible")?a(".photo-viewer-modal").on("photo-viewer-load-complete",d):d()}),a(function(){a("#comment-body, #edit-comment").on("keyup input",function(){var b=a(this),c=this.offsetHeight-this.clientHeight;b.css("height","auto").css("height",this.scrollHeight+c)})}),null}),define("text!cb/confirm-delete/template.jst",[],function(){return'<div id="confirm-delete-modal" class="modal" data-ga-label-prefix="Delete - " data-qa-id="journal-delete-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button"\n                    class="close"\n                    data-dismiss="modal"\n                    title="Close"\n                    data-ga-label="x"\n                    data-qa-id="journal-delete-x"\n                >&times;</button>\n                <h3 class="modal-title">Delete <%= type %></h3>\n            </div>\n            <div class="modal-body">\n                <p><strong><%\n                    if (numJournalUsage && isMainSitePhoto) {\n                        print(\'Are you sure you want to delete this photo? It will also be removed from the Journal and your main site photo.\');\n                    } else if (numJournalUsage) {\n                        print(\'Are you sure you want to delete this photo? It will also be removed from the Journal.\');\n                    } else if (isMainSitePhoto) {\n                        print(\'Are you sure you want to delete this photo? It will also be removed from your main site photo.\');\n                    } else {\n                        print(\'Are you sure you want to delete this \' + type + \'? By checking the box below, this \' + type + parent + \' will be removed permanently — this action cannot be undone.\');\n                    }\n                %></strong></p>\n                <div class="form-group">\n                    <label for="confirm-delete-checkbox" class="control-label checkbox">\n                        <input type="checkbox"\n                            value="1"\n                            id="confirm-delete-checkbox"\n                            data-qa-id="journal-delete-confirmation"\n                        />\n                        I understand, delete this <%= type %> from my site.\n                    </label>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default"\n                    data-dismiss="modal"\n                    type="button"\n                    data-ga-label="No"\n                    data-qa-id="journal-delete-close"\n                >Close</button>\n                <button class="submit-modal btn btn-primary"\n                    type="button"\n                    data-ga-label="Yes"\n                    data-qa-id="journal-delete-submit"\n                >Delete</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/confirm-delete/site-template.jst",[],function(){return'<div id="confirm-site-deactivate-modal" class="modal fade" data-ga-label-prefix="Deactive - " data-qa-id="site-deactivate-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" title="Close" data-ga-label="x" data-qa-id="site-deactivate">&times;</button>\n                <h3 class="modal-title">Deactivate Site</h3>\n            </div>\n            <div class="modal-body">\n                <p><strong>Are you sure you want to deactivate this site? By checking the box below, the your site will be\n                removed permanently -- this action cannot be undone.</strong></p>\n                <p>If you deactivate this site, you won\'t be able to read or post journal entries or view or upload photos.</p>\n                <div class="form-group">\n                    <label for="confirm-delete-checkbox" class="control-label checkbox">\n                        <input type="checkbox" value="1" id="confirm-delete-checkbox" data-qa-id="journal-delete-confirmation"/>\n                        I understand, deactivate this site\n                    </label>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button" data-ga-label="No"\n                    data-qa-id="site-deactivate-close">Close</button>\n                <button class="submit-modal btn btn-primary" type="button" data-ga-label="Yes" data-qa-id="site-deactivate-submit">Deactive Site</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/confirm-delete/site-memorialize-template.jst",[],function(){return'<div id="confirm-site-memorialize-modal" class="modal fade" data-ga-label-prefix="Memorialize - " data-qa-id="site-memorialize-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" title="Close" data-ga-label="x" data-qa-id="site-memorialize">&times;</button>\n                <h3 class="modal-title">Memorialize Site</h3>\n            </div>\n            <div class="modal-body">\n                <p><strong>If you choose to memorialize this site, you may continue to post Journal updates and photos, but future visitors will always see a designation of “Remembering.”</strong></p>\n                <div class="form-group">\n                    <label for="confirm-delete-checkbox" class="control-label checkbox">\n                        <input type="checkbox" value="1" id="confirm-delete-checkbox" data-qa-id="site-memorialize-confirmation"/>\n                        I understand, memorialize this site.\n                    </label>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button" data-ga-label="No"\n                    data-qa-id="site-memorialize-close">Close</button>\n                <button class="submit-modal btn btn-primary" type="button" data-ga-label="Yes" data-qa-id="site-memorialize-submit">Memorialize Site</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/confirm-delete/site-dememorialize-template.jst",[],function(){return'<div id="confirm-site-dememorialize-modal" class="modal fade" data-ga-label-prefix="DeMemorialize - " data-qa-id="site-dememorialize-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" title="Close" data-ga-label="x" data-qa-id="site-dememorialize">&times;</button>\n                <h3 class="modal-title">De-Memorialize Site</h3>\n            </div>\n            <div class="modal-body">\n                <p><strong>Are you sure you want to de-memorialize this site? The \'In Memory of\' on the Private Homepage above the profile name will be removed.</strong></p>\n                <div class="form-group">\n                    <label for="confirm-delete-checkbox" class="control-label checkbox">\n                        <input type="checkbox" value="1" id="confirm-delete-checkbox" data-qa-id="site-dememorialize-confirmation"/>\n                        I understand, de-memorialize this site\n                    </label>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button" data-ga-label="No"\n                    data-qa-id="site-dememorialize-close">Close</button>\n                <button class="submit-modal btn btn-primary" type="button" data-ga-label="Yes" data-qa-id="site-dememorialize-submit">De-Memorialize Site</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/confirm-delete/inline-template.jst",[],function(){return'<div>\n    This will permanently delete this journal.\n    <div class="centered-controls ">\n        <a href="#" class="btn btn-tertiary js-inline-confirm-cancel">Cancel</a>\n        <a href="#" class="btn btn-primary js-inline-confirm-submit">Delete</a>\n    </div>\n</div>\n'}),define("text!cb/confirm-delete/notification-template.jst",[],function(){return'<div id="confirm-clear-notifications-modal" class="modal fade" data-ga-label-prefix="Confirm Clear Notifications - ">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" title="Close" data-ga-label="x">&times;</button>\n                <h3 class="modal-title">Clear Notifications</h3>\n            </div>\n            <div class="modal-body">\n                <p><strong>Are you sure you want to clear all of your notifications?</strong></p>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button" data-ga-label="No">Cancel</button>\n                <button class="submit-modal-preconfirmed btn btn-primary" type="button" data-ga-label="Yes">Clear</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),require(["jquery","underscore","text!cb/confirm-delete/template.jst","text!cb/confirm-delete/site-template.jst","text!cb/confirm-delete/site-memorialize-template.jst","text!cb/confirm-delete/site-dememorialize-template.jst","text!cb/confirm-delete/inline-template.jst","text!cb/confirm-delete/notification-template.jst"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(){var i=this;this.inlineDelete=function(c){var d=a(c.data("inline-confirm-container")),e=d.html();d.html(b.template(g)),d.on("click",".js-inline-confirm-cancel",function(){d.html(e)}),d.on("click",".js-inline-confirm-submit",function(){i.submitDelete(c)})},this.modalDelete=function(g){var j;if("site-deactivate"===g.data("action"))a("#confirm-site-deactivate-modal").off("click",".submit-modal"),a("#confirm-site-deactivate-modal").remove(),a("body").prepend(b.template(d)),j=a("#confirm-site-deactivate-modal");else if("site-memorialize"===g.data("action"))a("#confirm-site-memorialize-modal").off("click",".submit-modal"),a("#confirm-site-memorialize-modal").remove(),a("body").prepend(b.template(e)),j=a("#confirm-site-memorialize-modal");else if("site-dememorialize"===g.data("action"))a("#confirm-site-dememorialize-modal").off("click",".submit-modal"),a("#confirm-site-dememorialize-modal").remove(),a("body").prepend(b.template(f)),j=a("#confirm-site-dememorialize-modal");else if("clear-notifications"===g.data("action"))a("#confirm-clear-notifications-modal").off("click",".submit-modal"),a("#confirm-clear-notifications-modal").remove(),a("body").prepend(b.template(h)),j=a("#confirm-clear-notifications-modal");else{a("#confirm-delete-modal").off("click",".submit-modal"),a("#confirm-delete-modal").remove();var k=g.data("parent-text"),l=g.data("is-main-site-photo");a("body").prepend(b.template(c,{type:g.data("item-description"),parent:k?k:"",numJournalUsage:parseInt(g.data("num-journal-usage"),10),isMainSitePhoto:Boolean(l)&&"false"!==l})),j=a("#confirm-delete-modal")}j.modal({backdrop:!0,keyboard:!0,show:!0}),j.on("click",".submit-modal-preconfirmed",function(b){a(b.currentTarget).css({"pointer-events":"none",opacity:.3}),i.submitDelete(g)}),j.on("click",".submit-modal",function(b){if(b.preventDefault(),!j.find("#confirm-delete-checkbox:checked").size())return a("#confirm-delete-checkbox").parents("label").css("color","red"),!1;j.find(".submit-modal").css({"pointer-events":"none",opacity:.3});var c;g.data("target")?(c=a(g.data("target")),c.size()>1&&(c=g.closest(g.data("target")))):c=g.parents(".content-list-item"),c.html('<img src="/assets/images/spinner.gif" class="confirm-delete-spinner" alt=""/>'),i.submitDelete(g,function(){j.modal("hide");var b=a(g.data("handler-target"));g.parents(".content-list-item").remove(),b.trigger("item-deleted",{type:g.data("type"),id:g.data("id")}),c.remove()})})},this.submitDelete=function(b,c){var d;b.attr("href")?d=b.attr("href"):b.data("url")?d=b.data("url"):""!==a("body").find("#autoSaveId").val()&&(d=b.attr("data-redirect-url")+"/delete/id/"+a("body").find("#autoSaveId").val()),d||(document.location.href=b.attr("data-redirect-url")),a.post(d).done(function(d){return a(".confirm-delete-spinner").remove(),"undefined"==typeof d.redirect||b.data("suppress-redirect")?"site-deactivate"!==b.data("action")||b.data("suppress-redirect")?void(("site-memorialize"!==b.data("action")||b.data("suppress-redirect"))&&("site-dememorialize"!==b.data("action")||b.data("suppress-redirect"))&&c&&c()):void(document.location.href=d.linkProfile):void(document.location.href=d.redirect)}).fail(function(){document.location.href=d})},this.onDelete=function(b){b.preventDefault();var c=a(b.currentTarget);return c.hasClass("inline-confirm")?void i.inlineDelete(c):void i.modalDelete(c)},this.initialize=function(){a("body").on("click.delete",".confirm-delete, .js-confirm-delete, .js-confirm-memorialize, .js-confirm-dememorialize",i.onDelete)}};a(function(){(new i).initialize()})}),define("cb/confirm-delete/main",function(){}),define("text!cb/invite/success-invite.jst",[],function(){return'<div class="alert alert-invite alert-<% if (error) { %>error<% } else { %>success<% } %>">\n    <h4><% if (error) { %>There was a problem<% } else { %>Success<% } %>:</h4>\n    <%= message %>\n</div>\n'}),require(["jquery","underscore","text!cb/templates/error.jst","text!cb/invite/success-invite.jst"],function(a,b,c,d){"use strict";var e=function(){var c=this;this.onInvite=function(c){c.preventDefault();var e=a("#invite-addresses").val(),f=a("#quick-invite-form").parents(".tab-pane"),g=f.find('input[type="submit"]'),h=a(c.currentTarget);if(!e.length){var i=a("#quick-invite-form");return i.find(".alert-error").remove(),void i.find("textarea").before('<div class="alert alert-error">You must enter at least one e-mail address.</div>')}f.css("opacity","0.5"),g.attr("disabled","disabled"),g.before('<img src="/assets/images/spinner.gif" class="invite-spinner pull-left" alt=""/>'),a(".alert-error").remove(),a(".alert-invite").remove(),a.post(h.attr("action"),{addresses:e}).done(function(c){a(".rhs-invite-inner").before(b.template(d,c)),f.css("opacity","1.0"),g.removeAttr("disabled"),a(".invite-spinner").remove(),c.error||a("#invite-addresses").val("")}).fail(function(){h.off("submit"),h.submit()})},this.importContacts=function(b){return a(".alert-invite-error").size()>0&&a(".alert-invite-error").remove(),0!==a(".invite-select:checked").length||(b.preventDefault(),a(".scrollable").before('<div class="alert alert-error text-left alert-invite-error">Please select at least 1 email address.</div>'),!1)},this.initialize=function(){a("#quick-invite-form").submit(function(a){c.onInvite.apply(c,[a])}),a(".share-options-collapse").click(function(a){c.loadInviteFormAsync.apply(c,[a])}),a(".import-contacts").on("submit",c.importContacts)},this.linkInviteAsyncSubmitButton=function(){var b=a("#share-options-panel").attr("data-url");a("#submit-btn").click(function(){return a.post(b,a("#visitor-invite-manual").serialize()).done(function(b){b.error?a("#share-options-alert-section").html('<div id="invite-alert-dialog" class="alert alert-danger"><p>'+b.message+"</p></div>"):(a("#share-options-alert-section").html('<div id="invite-alert-dialog" class="alert alert-success"><p>'+b.message+"</p></div>"),a("#visitor-invite-manual").get(0).reset())}).error(function(a){}),!1})},this.loadInviteFormAsync=function(){if(a("#share-options-panel").attr("data-populated"))return a("#invite-alert-dialog").size()>0&&a("#invite-alert-dialog").alert("close"),!1;var b=new XMLHttpRequest,d=a("#share-options-panel").attr("data-url");b.open("GET",d,!0),b.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.onreadystatechange=function(){if(4===b.readyState&&(200===b.status||406===b.status)){var d=b.responseText;if(406===b.status){var e=JSON.parse(d);d=e.message}a("#site-invite-email-area").replaceWith(d),a("#share-options-panel").attr("data-populated","true"),c.linkInviteAsyncSubmitButton.apply(c,null)}},b.send()}};a(function(){a("#quick-invite-form, .import-contacts").size()?(new e).initialize():a(".share-options-collapse").size()&&((new e).initialize(),a(".share-options-collapse").click())}),a(function(){a("#quick-invite-form, .share-options-collapse, .import-contacts").size()&&(new e).initialize()})}),define("cb/invite/main",function(){}),require(["jquery","underscore","text!cb/templates/error.jst"],function(a,b,c){"use strict";var d=function(){var d=this;this.initialize=function(){a(".notifications-menu").on("change.notification",".notification-pref input",d.setNotification),a(".notifications-menu").on("click.notification",".notification-pref",function(a){a.stopPropagation()})},this.setNotification=function(b){if(!a("#notification-loading").size()){var c=a(b.currentTarget),e=c.parent("label"),f=a(".notifications-menu").data("target");c.css("visibility","hidden"),e.css("color","#C0C0C0").prepend('<div class="spinner" id="notification-loading"><img src="/assets/images/spinner.gif" alt=""/></div>');var g=f.replace(/:param:/,c.attr("name")).replace(/:param2:/,c.is(":checked")?"on":"off");a.post(g).done(function(b,e,f){return f.getResponseHeader("Content-Type").indexOf("application/json")===-1?void(document.location.href="/auth"):b.success?(d.onResponse.apply(d,[]),c.prop("checked",b.value),void(b.isEnabled?a(".notifications-button .toggle-switch").addClass("enabled"):a(".notifications-button .toggle-switch").removeClass("enabled"))):void d.onResponse.apply(d,[b.error])}).fail(function(){d.onResponse.apply(d,["Your notification preferences were unable to be saved due to an error. You can make the changes in your settings area or try again later."])})}},this.onResponse=function(d){var e=a("#notification-loading"),f=e.parents(".notification-pref"),g=f.find("input");e.remove(),g.css("visibility","visible"),f.css("color",d?"red":"#38393C"),d&&a("#flash-messages").after(b.template(c,{message:d}))}};a(function(){a(".notifications-menu").size()&&(new d).initialize()})}),define("cb/notifications/main",function(){}),require(["jquery","underscore"],function(a,b){"use strict";a("#facilityLocation").change(function(c){var d=a(c.currentTarget),e=a("#facilityName"),f=d.data("src");d.attr("disabled","disabled"),d.css("opacity","0.3"),e.attr("disabled","disabled"),e.css("opacity","0.3"),d.after('<img src="/assets/images/spinner.gif" class="facility-spinner" alt=""/>');var g=function(){d.removeAttr("disabled"),d.css("opacity","1.0"),e.removeAttr("disabled"),e.css("opacity","1.0"),a(".facility-spinner").remove()};a.post(f,{location:d.val()}).done(function(c){var d='<option value=""></option>';a(c).each(function(a,c){d=d+'<option value="'+b.escape(c.value)+'">'+b.escape(c.label)+"</option>"}),a("#facilityName option").remove(),a("#facilityName").append(d),g()}).fail(function(){g()})})}),define("cb/partner/main",function(){}),define("text!cb/task/error.jst",[],function(){return'<div class="alert alert-error">\n    <h4>We\'re sorry, there was a problem building the fields for that task type.</h4>\n    <p>Here are some things you can try:</p>\n    <ul>\n        <li>Try selecting a different type of task (you can edit this later).</li>\n        <li>Try again later &mdash; we may already be fixing the problem.</li>\n        <li><a href="/contact">Contact customer care</a> to inform them of the problem.</li>\n    </ul>\n</div>\n'}),require(["jquery","underscore","text!cb/task/error.jst","jquery-ui","bootstrap"],function(a,b,c){"use strict";var d=function(){var d=this;this.taskTypeData={},this.formHash={},this.formValid={},this.getFormData=function(b){var c=a("#startDate").val(),e=a("#startTime").val(),f=a("#endDate").val(),g=a("#endTime").val(),h=a("#allDay:checked").size()?"1":"0",i=c+e+f+g+h,j=d.formHash[b],k=d.formValid[b]===i;return d.formHash[b]=i,{startDate:c,startTime:e,endDate:f,endTime:g,allDay:h,stale:i!==j,isValid:k,hash:i}},this.markFormValid=function(a){var b=d.getFormData("validate");d.formValid[a]=b.hash},this.validate=function(b){var c=a("#startDate").data("validate"),e=d.getFormData("validate");if(!e.isValid){var f=function(){a("#submit-btn").css("opacity","1.0").val("Add Task").removeProp("disabled"),a(".spinner").remove()};a("#submit-btn").css("opacity","0.3").val("Please wait ...").prop("disabled","disabled").after(' <img src="/assets/images/spinner.gif" class="spinner task-spinner" alt=""/>'),b.preventDefault(),a.post(c,e).done(function(b){return b.redirect?void(document.location.href=b.redirect):(a("#startTime").val(b.startTime),a("#endTime").val(b.endTime),a("#startDate").val(b.startDate),a("#endDate").val(b.endDate),void(b.notes&&b.target&&a("#"+b.target+":visible").size()?(f(),a(".select-date, .select-time").popover("destroy"),a("html, body").animate({scrollTop:a("#"+b.target).offset().top-300},250),a("#"+b.target).popover({placement:"top",trigger:"manual",title:"There was a problem ...",content:b.notes}).popover("show"),setTimeout(function(){a(".select-date, .select-time").popover("destroy")},5e3)):(d.markFormValid("validate"),a("form#task, form#content-region").data("submitted",!1).submit())))}).fail(function(){f(),d.markFormValid("validate"),a("form#task").data("submitted",!1).submit()})}},this.prepareAllDayToggling=function(){a("[data-all-day-class]").each(function(){a(this).data("original-class",a(this).attr("class"))})},this.selectAllDay=function(b){b&&b.preventDefault(),a("#allDay:checked").size()?(a("[data-all-day-class]").each(function(){a(this).attr("class",a(this).data("all-day-class"))}),a("#endTime, #startTime").removeProp("required"),a("#form-group-endDate a").remove(),a("#form-group-endDate .collapse").show()):(a("[data-all-day-class]").each(function(){a(this).attr("class",a(this).data("original-class"))}),a("#endTime, #startTime").prop("required","required"))},this.selectRecurring=function(){var b=a("#until-container"),c=a("#repeat").val(),d=""!==c;d?b.removeClass("hidden").find("input").prop("required","required"):b.addClass("hidden").find("input").removeProp("required")},this.selectTaskType=function(){var e=a("#type"),f=a("#task-fields"),g=e.val(),h='<img src="/assets/images/spinner.gif" class="spinner" alt=""/>',i=a("#title").data("type-fields");a(".input-type-custom").each(function(b,c){var e=a(c);e.val()&&(d.taskTypeData[e.attr("name")]=e.val())}),e.css("opacity","0.3").prop("disabled","disabled").after(" "+h),f.addClass("loading").html(h+" <small>Loading Form ...</small>");var j=function(){e.css("opacity","1.0").removeProp("disabled").parents("form").find("img.spinner").remove(),a(".input-type-custom").each(function(b,c){var e=a(c);e.val()||e.val(d.taskTypeData[e.attr("name")])})};a.post(e.data("href"),{type:g,typeFields:i}).done(function(a){f.removeClass("loading").html(a),j()}).fail(function(){j(),f.removeClass("loading").html(b.template(c))})},this.selectEndDate=function(b){b.preventDefault();var c=a(b.currentTarget);c.remove(),a("#endDate").show()},this.onShowSummary=function(){var b=a("#task-summary");this.lastSummaryRequestXhr=a.post(a("#title").data("summary-href"),{startDate:a("#startDate").val(),
startTime:a("#startTime").val(),endDate:a("#endDate").val(),endTime:a("#endTime").val(),allDay:a("#allDay:checked").size()?"1":"0",repeat:a("#repeat").val(),until:a("#until").val()}).done(function(a){b.html(a)}).fail(function(){b.remove()})},this.getIsoDate=function(a){return 10===a.length&&a.substring(6,10)+a.substring(0,2)+a.substring(3,5)},this.onChangeStartDate=function(b){var c=a(b.currentTarget).val(),d=this.getIsoDate(c);if(d){if(!a("#endDate").is(":visible"))return void a("#endDate").val(c);var e=this.getIsoDate(a("#endDate").val());return d&&d>e?void a("#endDate").val(c):void 0}},this.onChangeEndDate=function(b){var c=a(b.currentTarget).val(),d=this.getIsoDate(c),e=this.getIsoDate(a("#startDate").val());if(d)return d&&e>d?void a("#startDate").val(c):void 0},this.showSummary=function(){if(a("form#task").size()){var b=a("#task-summary");if(b.size()||a("#task-fields").after('<p id="task-summary"></p>'),a("#task-summary").html('<img src="/assets/images/spinner.gif" alt=""/>'),!this.summaryTimer){this.lastSummaryRequestXhr&&this.resetSummary();var c=(new Date).getTime()-this.lastSummaryRequestXhr;if(c<this.summaryFrequency)return void(this.summaryTimer=setTimeout(function(){d.summaryTimer=null,d.lastSummaryRequestXhr=(new Date).getTime(),d.onShowSummary.apply(d,[])},this.summaryFrequency));this.lastSummaryRequestXhr=(new Date).getTime(),this.onShowSummary()}}},this.resetSummary=function(){this.summaryXhr&&(this.summaryXhr.abort(),this.summaryXhr=null),this.summaryTimer&&(clearTimeout(this.summaryTimer),this.summaryTimer=null)},this.initialize=function(){d.selectRecurring.apply(d,[null]),a('.select-date[type="text"]').datepicker({constrainInput:!0,dateFormat:"mm/dd/yy",changeMonth:!0,onClose:function(){d.showSummary.apply(d,[])}}),a("form#task, form#content-region").submit(function(a){d.validate.apply(d,[a])}),a("#type").change(function(a){d.selectTaskType.apply(d,[a])}),a("#repeat").change(function(a){d.selectRecurring.apply(d,[a])}),d.prepareAllDayToggling(),a("#allDay").change(function(a){d.selectAllDay.apply(d,[a])}),a(".show-end-date").click(function(a){d.selectEndDate.apply(d,[a])}),a("#repeat, #allDay").change(function(a){d.showSummary.apply(d,[a])}),a("#startDate").change(function(a){d.onChangeStartDate.apply(d,[a])}),a("#endDate").change(function(a){d.onChangeEndDate.apply(d,[a])}),a("#startTime, #endTime").blur(function(a){d.showSummary.apply(d,[a])}),a("#startDate, #endDate").datepicker({onSelect:function(a){d.showSummary.apply(d,[a])}}),d.showSummary()}};a(function(){a("#task").size()&&(new d).initialize()})}),define("cb/task/main",function(){}),require(["jquery","jquery-ui","bootstrap"],function(a,b,c){"use strict";var d=function(){var b=this,c=["January","February","March","April","May","June","July","August","September","October","November","December"],d=2005,e=(new Date).getFullYear();this.initialize=function(){b.filterAll(),a(document).on("click","#advanced-search-submit-btn",function(a){b.validateDates(a)}),b.initDates(),a(document).on("click","#search-all-filter",function(){b.filterAll()}),a(document).on("click","#search-recent-filter",function(){b.filterRecent()})},this.filterAll=function(){a("#search-all-filter").removeClass().addClass("btn search-tab-margin btn-tertiary search-tab-button"),a("#search-recent-filter").removeClass().addClass("btn search-tab-margin btn-default btn-default-border"),a("#exact-site").show(),a("#no-exact-site").hide(),a("#sites-you-visit").show(),a("#main-results").show(),a("#total-found").show(),a("#recently-visited").hide()},this.filterRecent=function(){a("#search-all-filter").removeClass().addClass("btn search-tab-margin btn-default btn-default-border"),a("#search-recent-filter").removeClass().addClass("btn search-tab-margin btn-tertiary search-tab-button"),a("#exact-site").hide(),a("#no-exact-site").hide(),a("#sites-you-visit").hide(),a("#main-results").hide(),a("#total-found").hide(),a("#recently-visited").show()},this.validateDates=function(c){a(".siteCreateDates").prev().remove("div");var d=document.getElementById("fromDateYear"),e=document.getElementById("toDateYear"),f=document.getElementById("fromDateMonth"),g=document.getElementById("toDateMonth"),h=b.validateAllDatesFilledIn(c);h&&(Number(d.value)>Number(e.value)?(a(".siteCreateDates").before('<div class="alert alert-error">Please correct the sequence of the years entered.</div>'),c.preventDefault()):Number(d.value)===Number(e.value)&&Number(f.value)>Number(g.value)&&(a(".siteCreateDates").before('<div class="alert alert-error">Make sure your FROM month is not after your TO month.</div>'),c.preventDefault()))},this.validateAllDatesFilledIn=function(b){var c=document.getElementById("fromDateYear"),d=document.getElementById("toDateYear"),e=document.getElementById("fromDateMonth"),f=document.getElementById("toDateMonth");return"0"===c.value&&"0"===d.value&&"0"===e.value&&"0"===f.value||"0"!==c.value&&"0"!==d.value&&"0"!==e.value&&"0"!==f.value||(a(".siteCreateDates").before('<div class="alert alert-error">Please complete both the TO and FROM date fields to complete your search.</div>'),b.preventDefault(),!1)},this.initDates=function(){b.initFromYear(),b.initToYear(),b.initFromMonth(),b.initToMonth()},this.initFromYear=function(){var a,c=document.getElementById("fromDateYear"),f=d;for(a=document.createElement("option"),a.value="0",a.innerHTML="Year",a.disabled=!0,a.selected=!0,a.hidden=!0,c.appendChild(a),f;f<=e;f++)a=document.createElement("option"),a.value=f,a.innerHTML=f,c.appendChild(a);var g=b.getUrlVars().fromDateYear;g&&(c.value=g)},this.initToYear=function(){var a,c=document.getElementById("toDateYear"),f=d;for(a=document.createElement("option"),a.value="0",a.innerHTML="Year",a.disabled=!0,a.selected=!0,a.hidden=!0,c.appendChild(a),f;f<=e;f++)a=document.createElement("option"),a.value=f,a.innerHTML=f,c.appendChild(a);var g=b.getUrlVars().toDateYear;g&&(c.value=g)},this.initFromMonth=function(){var a,d=document.getElementById("fromDateMonth"),e=0;for(a=document.createElement("option"),a.value="0",a.innerHTML="Month",a.disabled=!0,a.selected=!0,a.hidden=!0,d.appendChild(a),e;e<12;e++)a=document.createElement("option"),a.value=e+1,a.innerHTML=c[e],d.appendChild(a);var f=b.getUrlVars().fromDateMonth;f&&(d.value=f)},this.initToMonth=function(){var a,d=document.getElementById("toDateMonth"),e=0;for(a=document.createElement("option"),a.value="0",a.innerHTML="Month",a.disabled=!0,a.selected=!0,a.hidden=!0,d.appendChild(a),e;e<12;e++)a=document.createElement("option"),a.value=e+1,a.innerHTML=c[e],d.appendChild(a);var f=b.getUrlVars().toDateMonth;f&&(d.value=f)},this.getUrlVars=function(){var a,b=[],c=0,d=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(c;c<d.length;c++)a=d[c].split("="),b.push(a[0]),b[a[0]]=a[1];return b}};a(function(){a("#advanced-search-form").size()&&(new d).initialize()})}),define("cb/search/main",function(){}),define("text!cb/site-notifications/modal-toggle.jst",[],function(){return'<div id="site-notifications-modal" class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal">\n                    <span aria-hidden="true">&times;</span>\n                    <span class="sr-only">Close</span>\n                </button>\n                <h2 class="modal-title"><%= modalHeading %></h2>\n            </div>\n            <div class="modal-body">\n                <p>Select how you want to get notifications for this website:</p>\n\n                <% if (menu.vanMethod) { %>\n                    <section class="form-group">\n                        <h3>Visitor Updates</h3>\n                        <div class="row">\n                            <div class="col-xs-4 col-xs-offset-1 col-sm-3 col-sm-offset-2">\n                                <div class="checkbox">\n                                    <label for="van-email">\n                                        <input type="checkbox" name="van-email" id="van-email"<% if (menu.vanEmail) { %> checked<% } %>/>\n                                        Email <i class="icon-envelope"></i>\n                                    </label>\n                                </div>\n                                <div class="checkbox">\n                                    <label for="van-sms">\n                                        <input type="checkbox" name="van-email" id="van-sms"<% if (menu.vanSms) { %> checked<% } %>/>\n                                        Text <i class="icon-mobile-phone"></i>\n                                    </label>\n                                </div>\n                            </div>\n                            <div class="col-xs-6 col-sm-6 show-if-van-email-checked">\n                                <div class="form-group">\n                                    <select id="notification-method" class="notification-method form-control">\n                                        <option value="summary"<% if (menu.vanMethod == \'summary\') { %> selected<% } %>>Daily Summary</option>\n                                        <option value="immediate"<% if (menu.vanMethod == \'immediate\') { %> selected<% } %>>Immediate</option>\n                                    </select>\n                                <span class="help-block notification-summary muted">Sent at 5:00 PM, CDT</span>\n                            </div>\n                        </div>\n                    </section>\n                <% } %>\n\n                <section class="form-group">\n                    <h3>Journal Updates</h3>\n                    <div class="row">\n                        <div class="col-xs-4 col-xs-offset-1 col-sm-3 col-sm-offset-2">\n                            <div class="checkbox">\n                                <label for="jen-email">\n                                    <input type="checkbox" name="jen-email" id="jen-email"<% if (menu.jenEmail) { %> checked<% } %>/>\n                                    Email <i class="icon-envelope"></i>\n                                </label>\n                            </div>\n                            <% if (isLoggedIn) { %>\n                                <div class="checkbox">\n                                    <label for="jen-sms">\n                                        <input type="checkbox" name="jen-sms" id="jen-sms"<% if (menu.jenSms) { %> checked<% } %>/>\n                                        Text <i class="icon-mobile-phone"></i>\n                                    </label>\n                                </div>\n                            <% } %>\n                        </div>\n                    </div>\n                </section>\n\n                <% if (menu.hasSad) { %>\n                    <section class="form-group">\n                        <h3>All Other Updates</h3>\n\n                        <div class="row">\n                            <div class="col-xs-4 col-xs-offset-1 col-sm-3 col-sm-offset-2">\n                                <div class="checkbox">\n                                    <label for="sad-email">\n                                        <input type="checkbox" name="sad-email" id="sad-email"<% if (menu.sadEmail) {\n                                            %> checked<% } %>/>\n                                        Email <i class="icon-envelope"></i>\n                                    </label>\n                                </div>\n                            </div>\n                        </div>\n                    </section>\n                <% } %>\n\n                <% if (isLoggedIn) { %>\n                    <section class="form-group">\n                        <p>\n                            <a href="/notifications">\n                                <i class="cbicon-settings hidden-phone"></i>\n                                All Notification Settings...\n                            </a>\n                        </p>\n                    </section>\n                <% } %>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>\n                <button class="submit-modal btn btn-primary" type="button">Save Changes</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),require(["jquery","underscore","text!cb/site-notifications/modal-toggle.jst","bootstrap"],function(a,b,c){"use strict";var d=function(){var d=this,e="#site-notifications-modal";this.showModal=function(f){f.preventDefault();var g=d.$el.data("menu");a(".notification-modal-alert").remove(),a(e).remove(),a("body").append(b.template(c,{menu:g,isLoggedIn:d.$el.data("loggedin"),isOrganizer:d.$el.data("isOrganizer"),modalHeading:d.$el.data("heading")})),a(e).modal({keyboard:!0,backdrop:!0,show:!0}).on("change.site-notifications",".notification-method",d.changeMethod).on("click.site-notifications",".submit-modal",d.onSave).on("hide",function(){d.$el.children("a").css("font-weight","normal")}),a("#notification-method").val(g.vanMethod).trigger("change")},this.changeMethod=function(){"immediate"===a(this).val()?a(this).next(".notification-summary").hide(200):a(this).next(".notification-summary").show(200)},this.onSave=function(b){b.preventDefault();var c=d.$el.data("src");a(".img-spinner").remove(),a(b.currentTarget).unbind("click").attr("disabled","disabled").css("opacity","0.3").before('<img class="img-spinner" src="/assets/images/spinner.gif" alt=""/> '),a.post(c,{"jen-email":a("#jen-email").is(":checked"),"jen-sms":a("#jen-sms").is(":checked"),"sad-email":a("#sad-email").is(":checked"),"van-immediate-email":"immediate"===a("#notification-method").val()&&a("#van-email").is(":checked"),"van-immediate-sms":"immediate"===a("#notification-method").val()&&a("#van-sms").is(":checked"),"van-summary-email":"summary"===a("#notification-method").val()&&a("#van-email").is(":checked"),"van-summary-sms":"summary"===a("#notification-method").val()&&a("#van-sms").is(":checked")}).done(function(b){return b.redirect?void(window.location.href=b.redirect):(d.$el.data("menu",b),void a("#flash-messages").after('<div class="alert alert-success notification-modal-alert"><i class="icon-check"></i> Your notification preferences have been saved.</div>'))}).fail(function(b){b.redirect||a(e+" .modal-body button").after('<div class="alert alert-error notification-modal-alert">We failed to save your preferences. Please try again later or <a href="/contact">contact customer care</a> for assistance.')}).always(function(){a(e).modal("hide")})},this.initialize=function(a){d.$el=a,d.$el.on("click.site-notifications",d.showModal)}};a(function(){a(".choose-site-notifications").size()&&a(".choose-site-notifications").each(function(){(new d).initialize(a(this))})})}),define("cb/site-notifications/main",function(){}),define("text!cb/site-follow/follow-modal.jst",[],function(){return'<div id="<%= modalID %>" class="modal fade" tabindex="-1" role="dialog"\n    data-ga-label-prefix="Follow Modal - "\n    data-qa-id="follow-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"\n                    data-qa-label="X"\n                    data-qa-id="follow-modal-x">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n                <h3 class="modal-title"><%= modalTitle %></h3>\n            </div>\n            <div class="modal-body text-center">\n                <p>You will get an email notification when new Journal entries are posted.\n                    If you would also like to receive text messages, click the Change Notifications\n                    link below.</p>\n                <div class="row">\n                    <div class="col-xs-6">\n                        <a href="<%= notificationsUrl %>"\n                            data-ga-label="Notifications"\n                            data-qa-id="follow-modal-notifications">Change Notifications</a>\n                    </div>\n                    <div class="col-xs-6">\n                        <a href="<%= unfollowUrl %>" class="<%= unfollowClass %>"\n                            data-ga-label="Unfollow"\n                            data-qa-id="follow-modal-unfollow">Unfollow</a>\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button"\n                    data-ga-label="Close"\n                    data-qa-id="follow-modal-close">Close</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("cb/site-follow/follow-button",["jquery","underscore","text!cb/site-follow/follow-modal.jst","bootstrap"],function(a,b,c){"use strict";var d="unfollow-button",e=["followUrl","unfollowUrl","following","notificationsUrl","followLabel","unfollowLabel","modalTitle"],f={captureDataAttributes:function(a,b){for(var c=0,d=e.length;c<d;c++){var f=e[c],g="data-"+f;b[g]&&(a[f]=b[g].value||null)}},createInfoPanel:function(e){var f=e.form.ownerDocument.getElementById(e.modalID);if(!f){var g=a(b.template(c,{modalID:e.modalID,modalTitle:e.modalTitle,notificationsUrl:e.notificationsUrl,unfollowUrl:e.unfollowUrl,unfollowClass:d}));a(e.form.ownerDocument).find("html body").append(g),g.modal({show:!1}),f=g.get(0),f.open=function(){g.modal("show")},f.close=function(){g.modal("hide")};var h=f.querySelector("."+d);h&&h.addEventListener("click",function(a){a.preventDefault(),e.unfollow()})}return f},onFollowing:function(a){a.following=!0,a.button.innerHTML=a.unfollowLabel,a.button.setAttribute("data-ga-label",a.unfollowLabel),a.form.attributes.action.value=a.unfollowUrl,a.open(),a.hideOnFollow()&&f.hideButton(a)},onUnfollowed:function(a){a.following=!1,a.button.innerHTML=a.followLabel,a.button.setAttribute("data-ga-label",a.followLabel),a.form.attributes.action.value=a.followUrl,a.close(),a.hideOnFollow()&&f.showButton(a)},triggerActionOnAllInstances:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];f[b]&&e.followButton&&f[b](e.followButton)}},hideButton:function(a){var b=a.form.className;b.indexOf("hidden")===-1&&(a.form.className=b+" hidden")},showButton:function(a){var b=new RegExp("(^|\\b)hidden(\\b|$)","gi");a.form.className=a.form.className.replace(b," ")},createXMLHttpRequest:function(a){return new a.window.XMLHttpRequest},sendUpdate:function(a,b,c,d){var e;try{e=f.createXMLHttpRequest(a)}catch(g){return void a.submit()}e.open("POST",b,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400)c();else{var a;try{a=JSON.parse(this.responseText)}catch(b){a={}}d(this.status,a)}},e.send(),e=null},handleHttpError:function(a,b,c){401===b&&c.redirect&&f.setBrowserLocation(a,c.redirect)},setBrowserLocation:function(a,b){a.window.location=b}},g=function(a,b,c){this.form=a,this.baseClass=b,this.window=c,this.modalID=b+"-modal",this.button=a.querySelector("button"),this.methods=f,this.form&&this.form.attributes&&this.methods.captureDataAttributes(this,this.form.attributes),this.following="true"===this.following,this.form.followButton=this;var d=this;this.button.addEventListener("click",function(a){a.preventDefault(),d.following?d.open():d.follow()}),this.infoPanel=this.methods.createInfoPanel(this)};return g.prototype.getAllRelatedElements=function(){return this.form.ownerDocument.querySelectorAll("."+this.baseClass)},g.prototype.hideOnFollow=function(){return this.form.className.indexOf("hide-on-follow")!==-1},g.prototype.open=function(){this.infoPanel&&this.infoPanel.open()},g.prototype.close=function(){this.infoPanel&&this.infoPanel.close()},g.prototype.follow=function(){var a=this;this.methods.sendUpdate(this,a.followUrl,function(){a.methods.triggerActionOnAllInstances(a.getAllRelatedElements(),"onFollowing")},function(b,c){a.methods.handleHttpError(a,b,c)})},g.prototype.unfollow=function(){var a=this;this.methods.sendUpdate(this,a.unfollowUrl,function(){a.methods.triggerActionOnAllInstances(a.getAllRelatedElements(),"onUnfollowed")},function(b,c){a.methods.handleHttpError(a,b,c)})},g.prototype.submit=function(){this.form.submit()},g}),define("text!cb/site-follow/follow-preferences.jst",[],function(){return'<div id="<%= modalID %>" class="modal fade" tabindex="-1" role="dialog" data-ga-label-prefix="Follow Modal - " data-qa-id="follow-modal">\n    <div class="modal-dialog modal-follow js-modal-follow-menu">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"\n                    data-qa-label="X" data-qa-id="follow-modal-x">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n                <h3 class="text-center modal-title"><i class="icon-check"></i>\n                    You\'re following <%= firstName %>’s Site!</h3>\n            </div>\n            <div class="modal-body">\n                <hr>\n                <div class="row">\n                    <div class="col-xs-12 follow-text text-center">You\'ll get a notification email when a new journal entry is posted.</div>\n                </div>\n                <% if (hasSms == \'1\') { %>\n                <div class="row ">\n                    <div class="text-center sms-follow-preference">\n                        <label class="switch">\n                                <input class="slider-checkbox" name="<%= jSmsName %>" data-alias="j" data-type="sms" type="checkbox"\n                                <%= jSms == \'1\' ? \'checked\' : \'\' %>\n                                data-ga-label="Toggle Activate Journal SMS" data-ga-type="checkbox" data-ga-action="Click checkbox" value="1">\n                                <span class="slider round"></span>\n                        </label>\n                        <span class="sms-follow-preference-text">Receive text messages for journal updates</span>\n                    </div>\n                </div>\n                <% } else { %>\n                <div class="row">\n                    <div class="col-xs-12 sms-link text-center">\n                        <a href="<%= mobileUrl %>">Receive text messages by setting up your text alerts</a>\n                    </div>\n                </div>\n                <% } %>\n                <hr>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default" data-dismiss="modal" type="button"\n                    data-ga-label="Close"\n                    data-qa-id="follow-modal-close">Close</button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!cb/site-follow/unfollow-preferences.jst",[],function(){return'<div id="<%= unFollowModalID %>" class="modal fade" tabindex="-1" role="dialog" data-ga-label-prefix="UnFollow Modal - " data-qa-id="unfollow-modal">\n    <div class="modal-dialog modal-follow js-modal-unfollow-menu">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"\n                    data-qa-label="X" data-qa-id="follow-modal-x">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n                <h3 class="text-center modal-title">\n                    Unfollow <%= firstName %>’s Site?</h3>\n            </div>\n            <div class="modal-body">\n                <hr>\n                <br />\n                <div class="row">\n                    <div class="col-xs-12 follow-text text-center" style="font-weight: bold;">You will no longer be notified when new journal entries are posted.</div>\n                </div>\n                <br />\n                <hr>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-default btn-unfollow" data-dismiss="modal" type="button"\n                        data-ga-label="Unfollow"\n                        data-qa-id="unfollow-modal-close">\n                        Yes, Unfollow\n                </button>\n                <button class="btn btn-default" data-dismiss="modal" type="button"\n                    data-ga-label="Cancel"\n                    data-qa-id="unfollow-modal-cancel">\n                    Cancel\n                </button>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("cb/site-follow/follow-preferences",["jquery","underscore","text!cb/site-follow/follow-preferences.jst","text!cb/site-follow/unfollow-preferences.jst"],function(a,b,c,d){"use strict";var e="j",f="sms",g=e+"-"+f,h=["followUrl","following","followLabel","unfollowLabel","hasSms",g,"firstName","saveUrl","mobileUrl","unfollowUrl"],i={onUnfollow:function(b){var c=b.data.followSettings,d=a(b.currentTarget),e={alias:d.data("alias"),type:d.data("type")};d.prop("disabled",!0).attr("disabled","disabled"),d.addClass("in"),c.methods.sendUpdate(this,c.unfollowUrl,e,function(){d.removeProp("disabled").removeAttr("disabled"),d.removeClass("in")},function(a,b){d.removeProp("disabled").removeAttr("disabled"),d.removeClass("in"),c.methods.handleHttpError(c,a,b)}),c.following=!1;var f=c.followLabel,g=c.followUrl;c.button.innerHTML=f,c.button.setAttribute("data-ga-label",f),c.form.attributes.action.value=g,c.closeUnFollowModal()},onToggleMenu:function(b){var c=b.data.followSettings,d=a(b.currentTarget),e={alias:d.data("alias"),type:d.data("type"),isActivated:d.is(":checked")?1:0};d.prop("disabled",!0).attr("disabled","disabled"),d.addClass("in"),c.methods.sendUpdate(this,c.saveUrl,e,function(){d.removeProp("disabled").removeAttr("disabled"),d.removeClass("in")},function(a,b){d.removeProp("disabled").removeAttr("disabled"),d.removeClass("in"),c.methods.handleHttpError(c,a,b)})},captureDataAttributes:function(a,b){for(var c=0,d=h.length;c<d;c++){var e=h[c],f="data-"+e;b[f]&&(a[e]=b[f].value||null)}},createUnFollowPanel:function(c){var e=c.form.ownerDocument.getElementById(c.unFollowModalID);if(!e){var f=a(b.template(d,{modalID:c.modalID,unFollowModalID:c.unFollowModalID,hasSms:c.hasSms,firstName:c.firstName,jSmsName:g,jSms:c[g],followUrl:c.followUrl,mobileUrl:c.mobileUrl}));a(c.form.ownerDocument).find("html body").append(f),f.modal({show:!1}),e=f.get(0),e.openUnFollowModal=function(){f.modal("show")},e.closeUnFollowModal=function(){f.modal("hide")}}return e},createInfoPanel:function(d){var e=d.form.ownerDocument.getElementById(d.modalID);if(!e){var f=a(b.template(c,{modalID:d.modalID,unFollowModalID:d.unFollowModalID,hasSms:d.hasSms,firstName:d.firstName,jSmsName:g,jSms:d[g],followUrl:d.followUrl,mobileUrl:d.mobileUrl}));a(d.form.ownerDocument).find("html body").append(f),f.modal({show:!1}),e=f.get(0),e.open=function(){f.modal("show")},e.close=function(){f.modal("hide")}}return e},onFollow:function(a,b){a.following=b;var c=a.unfollowLabel,d=a.unfollowUrl;a.button.innerHTML=c,a.button.setAttribute("data-ga-label",c),a.form.attributes.action.value=d},sendUpdate:function(b,c,d,e,f){a.post(c,d).done(function(a){e(a)}).fail(function(a){var b;try{b=JSON.parse(a.responseText)}catch(c){b={}}f(a.status,b)})},handleHttpError:function(a,b,c){401===b&&c.redirect&&i.setBrowserLocation(a,c.redirect)},setBrowserLocation:function(a,b){a.window.location=b}},j=function(a,b,c){this.form=a,this.baseClass=b,this.window=c,this.modalID=b+"-modal",this.unFollowModalID=b+"-unfollowmodal",this.button=a.querySelector("button"),this.methods=i,this.form&&this.form.attributes&&this.methods.captureDataAttributes(this,this.form.attributes),this.following="true"===this.following,this.form.followSettings=this;this.infoPanel=this.methods.createInfoPanel(this),this.infoPanel.followSettings=this,this.unfollowPanel=this.methods.createUnFollowPanel(this),this.unfollowPanel.followSettings=this};return j.prototype.setCheckbox=function(b,c){if(this.infoPanel){var d="input.slider-checkbox[name="+b+"]",e=a(this.infoPanel).find(d);e&&e.prop("checked",c)}},j.prototype.open=function(){this.infoPanel&&this.infoPanel.open()},j.prototype.openUnFollowModal=function(){this.unfollowPanel&&this.unfollowPanel.openUnFollowModal()},j.prototype.close=function(){this.infoPanel&&this.infoPanel.close()},j.prototype.closeUnFollowModal=function(){this.unfollowPanel&&this.unfollowPanel.closeUnFollowModal()},j.prototype.follow=function(a){a.preventDefault();var b=a.data.followSettings;b.following?b.openUnFollowModal():(b.updateMenu(a),b.methods.onFollow(b,!0),b.open())},j.prototype.updateMenu=function(b){var c=b.data.followSettings;c.methods.sendUpdate(this,c.followUrl,{},function(b){var d=b?b.menu:[];d[e]&&c.setCheckbox(g,a.inArray(f,d[e])>-1)},function(a,b){c.methods.handleHttpError(c,a,b)})},j.prototype.initialize=function(){a(".js-modal-follow-menu").on("change",".slider-checkbox",{followSettings:this},this.methods.onToggleMenu),a(".js-modal-unfollow-menu").on("click",".btn-unfollow",{followSettings:this},this.methods.onUnfollow),a(this.form).on("click","button.js-btn-follow",{followSettings:this},this.follow)},j}),require(["jquery","cb/site-follow/follow-button","cb/site-follow/follow-preferences"],function(a,b,c){"use strict";a(function(){var b="enhanced-follow-button";a("."+b).each(function(){var a=new c(this,b,window);a.initialize()})})}),define("cb/site-follow/main",function(){}),define("cb/pdf/pdf",["jquery"],function(a){"use strict";var b=function(b){this.$printBanner=a(b);var c=this;this.heartbeatTimer=setTimeout(function(){c.heartbeat()},2500),this.$printBanner.on("click.pdf-disabled",".btn-disabled",function(a){a.preventDefault()})};return b.prototype.heartbeat=function(){var b=this,c=b.$printBanner.data("src");b.$printBanner.find(".spinner").remove(),b.$printBanner.find("h4").append(' <img src="/assets/images/spinner.gif" alt="" class="spinner"/>'),a.get(c).done(function(a){if(a.complete){var c=b.$printBanner.find(".job-"+a.id);return c.find(".print-status").text(a.text),void c.find(".btn").attr("href",a.src).removeClass("hidden").off("click.pdf-disabled")}setTimeout(b.heartbeat,2500)}).always(function(){b.$printBanner.find(".spinner").remove()})},b}),define("cb/pdf/print",["jquery","modernizr","bootstrap","jquery-ui"],function(a,b){"use strict";var c={defineEventHandlers:function(b,d){d.on("click.pdf-print",{instance:b},c.onClickPrint),a(document).on("click.pdf-print","#mode-print-range",function(){a(".js-show-if-print-range").removeClass("hidden"),a("#pdf-print-range-start-at, #pdf-print-range-end-at").prop("required","required")}),a(document).on("click.pdf-print","#mode-print-all",function(){a("#pdf-print-range-start-at, #pdf-print-range-end-at").removeProp("required"),a(".js-show-if-print-range").addClass("hidden")})},improveDateUsability:function(a){if(!b.inputtypes.date){a.find(".select-date").datepicker({constrainInput:!0,dateFormat:"mm/dd/yy",changeMonth:!0});try{a.find('.select-date[type="date"]').prop("type","text")}catch(c){}}},onClickPrint:function(a){a.preventDefault(),a.data.instance.showModal()}},d=function(b){this.$container=a(b),c.defineEventHandlers(this,this.$container)};return d.prototype.showModal=function(){var b=this;b.$container.addClass("disabled"),b.$container.find(".spinner").remove(),b.$spinner=a(' <img src="/assets/images/spinner.gif" alt="" class="spinner"/>'),b.$spinner.appendTo(b.$container),a.get(b.$container.data("src")).done(function(d){b.$modal&&(b.$modal.remove(),b.$modal=null);var e=a().add(d);a("body").append(e),b.$modal=e.find(".print-modal"),b.$modal.modal({backdrop:!0,keyboard:!0,show:!0}),c.improveDateUsability(b.$modal)}).always(function(){b.$container.removeClass("disabled"),b.$spinner.remove()})},d}),require(["jquery","cb/pdf/pdf","cb/pdf/print"],function(a,b,c){
"use strict";a(function(){var d=function(){this.cbPdf=new b(this)},e=function(){this.cbPrintControls=new c(this)};a("#print-banner").each(d),a(".print-control").each(e),a(".overview-feeds").on("load-feed-complete",function(b){a(b.relatedTarget).find(".print-control").each(e)})})}),define("cb/pdf/main",function(){}),require(["jquery","cb/richtext-tinymce/richtext-tinymce"],function(a,b){"use strict";var c="textarea.js-rich-text-editor",d=function(){a(this).parents(".js-late-init").size()>0||b.initialize(a(this),"false")};a(function(){a(c).each(d),a(".overview-feeds").on("load-feed-complete",function(b){a(b.relatedTarget).find(c).each(d)})})}),define("cb/richtext-tinymce/main",function(){}),define("cb/infinite-scroll/infinite-scroll",["jquery"],function(a){"use strict";var b={applyClickEvent:function(c,d){a(d).find(".load-more:last").on("click.infinite-scroll",function(a){a.preventDefault(),b.loadMoreContent(c,a.target,a.target.href)})},cleanHtml:function(a){if(a&&a.childNodes)for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];8===d.nodeType||3===d.nodeType&&!/\S/.test(d.nodeValue)?(a.removeChild(d),c--):1===d.nodeType&&b.cleanHtml(d)}},loadMoreContent:function(c,d,e){var f,g=a(d),h=g.closest(".list-group-item-load-more"),i="asc"===g.data("displayOrder");a.ajax({url:e,method:"GET",beforeSend:function(){f=a('<img src="/assets/images/spinner.gif" alt="" />').insertBefore(g),g.hide()}}).done(function(d){var e=a.parseHTML(d),f=[];if(e instanceof Array)for(var g=0,j=e.length;g<j;g++)8!==e[g].nodeType&&3!==e[g].nodeType&&(i?f.unshift(e[g]):f.push(e[g]));else f=b.cleanHtml(e);b.applyClickEvent(c,f),h.replaceWith(f),a(c.container).trigger("load-more-complete",[f])}).fail(function(){g.off("click.infinite-scroll").show()}).always(function(){f.remove()})}},c=function(a){this.container=a,b.applyClickEvent(this,this.container)};return c}),define("cb/infinite-scroll/binge-scroll",["jquery"],function(a){"use strict";var b=".js-infinite-scroll.js-binge-scroll.js-autoload",c=!1,d={resetLoading:function(b){c=!1;var e=a(b.target);d.hideReadMore(e)},hideReadMore:function(a){a.find(".show-more").hide().closest(".fade-out").removeClass("fade-out")},applyBingeable:function(){var e=a(b);e.length>0&&(d.hideReadMore(e),a(window).on("scroll",function(){var a=e.data("binge-loader");c||(e.find(a).trigger("click"),c=!0)}))}},e=function(){d.applyBingeable(),a(b).on("load-more-complete",d.resetLoading)};return e}),require(["jquery","cb/infinite-scroll/infinite-scroll","cb/infinite-scroll/binge-scroll"],function(a,b,c){"use strict";a(function(){var d=function(){new b(this)},e=function(){new c(this)};a(".js-infinite-scroll").each(d),a(".js-infinite-scroll.js-binge-scroll").each(e),a(".overview-feeds").on("load-feed-complete",function(b){a(b.relatedTarget).find(".js-infinite-scroll").each(d)})})}),define("cb/infinite-scroll/main",function(){}),define("text!cb/amp-quiz/right.jst",[],function(){return'<div class="alert alert-success">\n    <i aria-hidden="true" class="icon-large icon-ok-sign pull-left" role="presentation"></i>\n    <p>Great!</p>\n</div>\n'}),define("text!cb/amp-quiz/wrong.jst",[],function(){return'<div class="alert alert-danger">\n    <p>Good try, guess again.</p>\n</div>\n'}),require(["jquery","underscore","text!cb/amp-quiz/right.jst","text!cb/amp-quiz/wrong.jst"],function(a,b,c,d){"use strict";var e=function(){this.initialize=function(){a(".amp-quiz").each(function(){var e=a(this);e.find('input[type="radio"]').on("change.amp-quiz",function(f){a(f.currentTarget).val().toString()===e.data("key").toString()?e.find(".amp-quiz-result").html(b.template(c)):e.find(".amp-quiz-result").html(b.template(d))})})}};a(function(){a(".amp-quiz").size()&&(new e).initialize()})}),define("cb/amp-quiz/main",function(){}),require(["jquery"],function(a){"use strict";var b=function(){var b=this;this.toggleLocationType=function(){var b=a('select[name="locType"]').val();"physical"===b?(a(".js-show-if-physical").show(),a(".js-show-if-not-physical").hide()):(a(".js-show-if-physical").hide(),a(".js-show-if-not-physical").show())},this.initialize=function(){a('select[name="locType"]').on("change.amp-admin-volunteer",b.toggleLocationType),a('select[name="locType"]').triggerHandler("change.amp-admin-volunteer"),b.toggleLocationType()}};a('select[name="locType"]').size()&&(new b).initialize()}),define("cb/amp-admin-volunteer/main",function(){}),define("cb/check-whitelist/check-whitelist",["jquery"],function(a){"use strict";var b=function(){var b=this;b.initialize=function(c){b.$field=c.first(),b.url=b.$field.data("checkWhitelistUrl"),b.$target=a(b.$field.data("checkWhitelistTarget")),b.url&&b.$target.size()&&b.bindEvents()},b.bindEvents=function(){b.$field.on("blur.check-whitelist change.check-whitelist",b.checkAddress)},b.checkAddress=function(){try{b.handleResponse(a.get(b.url,{address:b.$field.val()}))}catch(c){b.showTarget()}},b.handleResponse=function(a){a.done(function(a){!0===a.whitelisted?b.hideTarget():b.showTarget()}).fail(b.showTarget)},b.hideTarget=function(){b.$target.addClass("hidden")},b.showTarget=function(){b.$target.removeClass("hidden")}};return b}),require(["jquery","cb/check-whitelist/check-whitelist"],function(a,b){"use strict";a("[data-check-whitelist-target][data-check-whitelist-url]").each(function(){(new b).initialize(a(this))})}),define("cb/check-whitelist/main",function(){}),require(["jquery"],function(a){"use strict";a("#carrierError").hide(),a("#phoneNumberError").hide(),a("#consentError").hide(),a('.lpev-radioContainer input[type="radio"]').on("change",function(){a(".lpev-continue-btn").removeAttr("disabled")}),a("#text-verify").on("change",function(){a(".lpev-phone-verification").removeClass("hidden")}),"text"===a("#spec-situation").val()?(a('.lpev-radioContainer input[name="verify-choice"]').filter('[value="by-text"]').attr("checked",!0),a(".lpev-phone-verification").removeClass("hidden"),a(".lpev-continue-btn").removeAttr("disabled")):(a('.lpev-radioContainer input[name="verify-choice"]').filter('[value="by-text"]').attr("checked",!1),a('input[name="verify-choice"]:checked').length?a(".lpev-continue-btn").removeAttr("disabled"):a(".lpev-continue-btn").attr("disabled","disabled")),a(".lpev-code-input").on("keyup",function(){4===a(this).val().length?a(".lpev-activate-btn").removeAttr("disabled"):a(".lpev-activate-btn").attr("disabled","disabled")}),a(".lpev-resend-btn").click(function(b){b.preventDefault();var c=window.location.pathname,d=a(this);d.after(' <img src="/assets/images/spinner.gif" alt="" class="loading"/>'),d.attr("disabled","disabled"),a(".resent-email-text").hide(),a.ajax({type:"POST",url:c}).done(function(){d.removeAttr("disabled"),a(".resent-email-text").show(),a(".loading").remove()})}),a("#verification").on("submit",function(b){var c=document.querySelector('input[name="verify-choice"]:checked').value,d=1;if("by-text"===c){var e=a("#number").val();""===a("#carrier").val()?(a("#carrierError").show(),d=0):a("#carrierError").hide();var f=/^\d{10}$/;e.match(f)?a("#phoneNumberError").hide():(a("#phoneNumberError").show(),d=0),a("#consentAgree").is(":checked")?a("#consentError").hide():(a("#consentError").show(),d=0)}if(!d)return!1})}),define("cb/verification/main",function(){}),function(a,b){var c,d=a.jQuery||a.Cowboy||(a.Cowboy={});d.throttle=c=function(a,c,e,f){function g(){function d(){i=+new Date,e.apply(j,l)}function g(){h=b}var j=this,k=+new Date-i,l=arguments;f&&!h&&d(),h&&clearTimeout(h),f===b&&k>a?d():c!==!0&&(h=setTimeout(f?g:d,f===b?a-k:a))}var h,i=0;return"boolean"!=typeof c&&(f=e,e=c,c=b),d.guid&&(g.guid=e.guid=e.guid||d.guid++),g},d.debounce=function(a,d,e){return e===b?c(a,d,!1):c(a,e,d!==!1)}}(this),define("vendor/jquery.ba-throttle-debounce.min",function(){}),define("cb/read-more/read-more",["jquery","vendor/jquery.ba-throttle-debounce.min"],function(a){"use strict";var b={applyClickHandler:function(b){b.find(".show-more").on("click",function(b){b.preventDefault(),a(this).hide().closest(".fade-out").removeClass("fade-out")})},applyInfiniteScrollEventHandler:function(b,c){a(c).find(".js-infinite-scroll").on("load-more-complete",function(c,d){if(d instanceof Array)for(var e=0,f=d.length;e<f;e++)b.append(a(d[e]).find(".fade-out"));else b.append(a(d).find(".fade-out"));a(".suppress-if-js-enabled").addClass("suppress-link")})},contentFits:function(b){return!(!b||!b.scrollHeight)&&b.scrollHeight<=a(b).height()}},c=function(c){this.append(c);var d=this;"undefined"!=typeof a.throttle&&a(window).on("resize.read-more",a.throttle(200,function(){d.refresh()})),b.applyInfiniteScrollEventHandler(this,document),a(".overview-feeds").on("load-feed-complete",function(c){d.append(a(c.relatedTarget).find(".fade-out")),b.applyInfiniteScrollEventHandler(d,c.relatedTarget)}),a(document).on("response-inserted","form.js-submit",function(b){d.append(a(b.relatedTarget).find(".fade-out"))});var e=this;a(document).on("content-shown",function(a){e.refresh()})};return c.prototype.append=function(a){b.applyClickHandler(a),this.$elements?this.$elements=this.$elements.add(a):this.$elements=a,this.refresh()},c.prototype.refresh=function(){this.$elements.each(function(){b.contentFits(this)?a(this).addClass("hide-read-more"):a(this).removeClass("hide-read-more")})},c}),define("cb/read-more/main",["jquery","cb/read-more/read-more"],function(a,b){"use strict";a(function(){new b(a(".fade-out"))})});var JSON;JSON||(JSON={}),function(){"use strict";function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;c<f;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("vendor/json2",function(){}),define("cb/client-metrics/main",["jquery","cb/client-metrics/client-metrics","vendor/json2"],function(a,b){"use strict";a(function(){var c=a("input.client-metrics");if(c.size()){var d=function(){var d=JSON.stringify(b.getMetrics());d&&c.each(function(){a(this).val(d)})};d(),c.parents("form").on("submit.client-metrics",d)}})}),require(["jquery"],function(a){"use strict";var b=function(){var b=this;this.initialize=function(c){b.$element=c,b.maxlength=b.$element.attr("maxlength"),b.maxlength&&(b.$target=a(b.$element.data("target")),b.$target.size()&&("undefined"!=typeof Modernizr&&Modernizr.hasEvent("input")?b.$element.on("input.textarea-countdown",b.updateRemaining):b.$element.on("change.textarea-countdown keydown.textarea-countdown keyup.textarea-countdown",b.updateRemaining),b.updateRemaining()))},this.updateRemaining=function(){var a=b.maxlength-b.$element.val().length;a<=0&&b.$element.trigger("full.textarea-countdown"),b.$target.text(a)}};a(function(){a(".textarea-countdown").size()&&a(".textarea-countdown").each(function(){(new b).initialize(a(this))})})}),define("cb/textarea-countdown/main",function(){}),define("cb/backtotop/backtotop",["jquery"],function(a){"use strict";var b=function(b){b.preventDefault(),a("html, body").animate({scrollTop:0},300)},c=function(a){this.$link=a};return c.prototype.bindEvents=function(){a(window).scroll(this.toggleVisibility.bind(this)),this.$link.click(b)},c.prototype.toggleVisibility=function(){var b=a(window).scrollTop(),c=this.$link.data("show-at"),d=this.$link.data("show-class");b>c?this.$link.addClass(d):this.$link.removeClass(d)},c}),require(["jquery","cb/backtotop/backtotop"],function(a,b){"use strict";a(function(){a(".js-back-to-top").each(function(){var c=a(this),d=new b(c);d.bindEvents(),d.toggleVisibility()})})}),define("cb/backtotop/main",function(){}),require(["jquery"],function(a){"use strict";a(function(){a(".banner-linkable").click(function(b){var c=a(b.target).attr("class");"undefined"!=typeof c&&c.indexOf("universal-banner-close")<0&&(window.location=a(this).attr("data-href"))}),a(".banner-linkable > .banner-image > img").click(function(b){window.location=a(".banner-linkable").attr("data-href")}),a(".banner-linkable > .banner-copy > p").click(function(b){window.location=a(".banner-linkable").attr("data-href")})})}),define("cb/universal-banner/main",function(){}),require(["jquery"],function(a){"use strict";a(function(){a(".js-scroll-to-tribute-widget").click(function(b){b.preventDefault(),a("html, body").animate({scrollTop:a("#tribute-panel").offset().top-90},90)})})}),define("cb/tribute-widget/main",function(){}),define("cb/clipboard/ClipboardControl",[],function(){"use strict";var a=function(a){var b=document.createElement("input");return b.value=a.innerText,a.parentNode.insertBefore(b,a),b.parentNode.insertBefore(a,b),b},b=function(a,b,c){this.target=a,this.trigger=b||a,this.triggerEvent=c||"click"};return b.prototype.initialize=function(){if(!(this.target instanceof Element))throw new Error("Cannot initialize with non-Element target.");var a=this;this.trigger.addEventListener(this.triggerEvent,function(){a.copyToClipboard()})},b.prototype.copyToClipboard=function(){var b=this.target instanceof HTMLInputElement,c=b?this.target:a(this.target);c.select(),c.focus(),document.execCommand("copy"),b||c.parentNode.removeChild(c)},b}),require(["cb/clipboard/ClipboardControl","jquery"],function(a,b){"use strict";b(function(){b(".js-clipboard-control").each(function(){var c=b(this),d=c.data("clipboardTarget"),e=d?b(d).get(0):this;this.clipboardControl=new a(e,this),this.clipboardControl.initialize()})})}),define("cb/clipboard/main",function(){}),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},B=[].slice,C={}.hasOwnProperty,D=function(a,b){return function(){return a.apply(b,arguments)}},E=function(a,b){function c(){this.constructor=a}for(var d in b)C.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};x=["extended","included"],p=function(){function a(){}return a["extends"]=function(a){var b,c,d;for(b in a)c=a[b],A.call(x,b)<0&&(this[b]=c);return null!=(d=a.extended)&&d.apply(this),this},a.includes=function(a){var b,c,d;for(b in a)c=a[b],A.call(x,b)<0&&(this.prototype[b]=c);return null!=(d=a.included)&&d.apply(this),this},a.delegate=function(){var a,b,c,d,e,f;for(a=1<=arguments.length?B.call(arguments,0):[],c=a.pop(),f=[],d=0,e=a.length;d<e;d++)b=a[d],f.push(this.prototype[b]=c.prototype[b]);return f},a.aliasFunction=function(a,b){var c=this;return this.prototype[a]=function(){var a;return a=1<=arguments.length?B.call(arguments,0):[],c.prototype[b].apply(c,a)}},a.aliasProperty=function(a,b){return Object.defineProperty(this.prototype,a,{get:function(){return this[b]},set:function(a){return this[b]=a}})},a.included=function(a){return a.call(this,this.prototype)},a}(),y=Array.prototype.slice,a=function(a,b){return null==b&&(b=document),"object"==typeof a||"undefined"!=typeof exports&&null!==exports?a:b.querySelector(a)},v=function(){function a(){}return a.uniqid=function(){var a;return a=0,{get:function(){return a++}}}(),a.extend=function(){var a,b,c,d,e,f,g;for(c=arguments[0],e=2<=arguments.length?B.call(arguments,1):[],b=c,f=0,g=e.length;f<g;f++){a=e[f];for(d in a)C.call(a,d)&&(b[d]=a[d])}return b},a.clampRGB=function(a){return a<0?0:a>255?255:a},a.copyAttributes=function(a,b,c){var d,e,f,g,h,i;for(null==c&&(c={}),g=a.attributes,i=[],e=0,f=g.length;e<f;e++)d=g[e],null!=c.except&&(h=d.nodeName,A.call(c.except,h)>=0)||i.push(b.setAttribute(d.nodeName,d.nodeValue));return i},a.dataArray=function(a){return null==a&&(a=0),e.NodeJS||null!=window.Uint8Array?new Uint8Array(a):new Array(a)},a}(),"undefined"!=typeof exports&&null!==exports?(t=exports,g=require("canvas"),m=g.Image,j=require("fibers"),w=require("fs")):t=window,e=function(c){function d(){this.nodeFileReady=D(this.nodeFileReady,this);var a,c,e,f=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof d?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),a=arguments[0],d.NodeJS||(e=parseInt(d.getAttrId(a[0]),10),c="function"==typeof a[1]?a[1]:"function"==typeof a[2]?a[2]:function(){},isNaN(e)||!u.has(e))?(this.id=v.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new b(this),this.renderer=new s(this),this.domIsLoaded(function(){return f.parseArguments(a),f.setup()}),this):u.execute(e,c)):new d(arguments)}return E(d,c),d.version={release:"4.1.2",date:"7/27/2013"},d.DEBUG=!1,d.allowRevert=!0,d.crossOrigin="anonymous",d.remoteProxy="",d.proxyParam="camanProxyUrl",d.NodeJS="undefined"!=typeof exports&&null!==exports,d.autoload=!d.NodeJS,d.toString=function(){return"Version "+d.version.release+", Released "+d.version.date},d.getAttrId=function(b){return!!d.NodeJS||("string"==typeof b&&(b=a(b)),null==b||null==b.getAttribute?null:b.getAttribute("data-caman-id"))},d.prototype.domIsLoaded=function(a){var b,c=this;return d.NodeJS?setTimeout(function(){return a.call(c)},0):"complete"===document.readyState?(o.debug("DOM initialized"),setTimeout(function(){return a.call(c)},0)):(b=function(){if("complete"===document.readyState)return o.debug("DOM initialized"),a.call(c)},document.addEventListener("readystatechange",b,!1))},d.prototype.parseArguments=function(a){var b,c,d,e;if(0===a.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(a[0]),1!==a.length){switch(typeof a[1]){case"string":this.imageUrl=a[1];break;case"function":this.callback=a[1]}if(2!==a.length&&(this.callback=a[2],4===a.length)){d=a[4],e=[];for(b in d)C.call(d,b)&&(c=d[b],e.push(this.options[b]=c));return e}}},d.prototype.setInitObject=function(b){if(d.NodeJS)return this.initObj=b,void(this.initType="node");if("object"==typeof b?this.initObj=b:this.initObj=a(b),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},d.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},d.prototype.initNode=function(){return o.debug("Initializing for NodeJS"),"string"==typeof this.initObj?w.readFile(this.initObj,this.nodeFileReady):this.nodeFileReady(null,this.initObj)},d.prototype.nodeFileReady=function(a,b){if(a)throw a;return this.image=new m,this.image.src=b,o.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.canvas=new g(this.imageWidth(),this.imageHeight()),this.finishInit()},d.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),v.copyAttributes(this.image,this.canvas,{except:["src"]}),this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},d.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},d.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()&&(o.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),l.isRemote(this.image))return this.image.src=l.proxyUrl(this.image.src),o.debug("Remote image detected, using URL = "+this.image.src)},d.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},d.prototype.isImageLoaded=function(){return!!this.image.complete&&(null==this.image.naturalWidth||0!==this.image.naturalWidth)},d.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},d.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},d.prototype.imageLoaded=function(){return o.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},d.prototype.finishInit=function(){var a,b,c,e,f;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data,d.allowRevert)for(this.initializedPixelData=v.dataArray(this.pixelData.length),this.originalPixelData=v.dataArray(this.pixelData.length),f=this.pixelData,a=c=0,e=f.length;c<e;a=++c)b=f[a],this.initializedPixelData[a]=b,this.originalPixelData[a]=b;return this.dimensions={width:this.canvas.width,height:this.canvas.height},d.NodeJS||u.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},d.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},d.prototype.resetOriginalPixelData=function(){var a,b,c,e,f,g;if(!d.allowRevert)throw"Revert disabled";for(this.originalPixelData=v.dataArray(this.pixelData.length),f=this.pixelData,g=[],a=c=0,e=f.length;c<e;a=++c)b=f[a],g.push(this.originalPixelData[a]=b);return g},d.prototype.hasId=function(){return null!=d.getAttrId(this.canvas)},d.prototype.assignId=function(){if(!d.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)},d.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},d.prototype.hiDPIAdjustments=function(){var a;if(!d.NodeJS&&this.needsHiDPISwap())return a=this.hiDPIRatio(),1!==a?(o.debug("HiDPI ratio = "+a),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*a,this.canvas.height=this.preScaledHeight*a,this.canvas.style.width=""+this.preScaledWidth+"px",this.canvas.style.height=""+this.preScaledHeight+"px",this.context.scale(a,a),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},d.prototype.hiDPIRatio=function(){var a,b;return b=window.devicePixelRatio||1,a=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,b/a},d.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},d.prototype.needsHiDPISwap=function(){return!(this.hiDPIDisabled()||!this.hiDPICapable())&&null!==this.hiDPIReplacement()},d.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},d.prototype.replaceCanvas=function(a){var b;return b=this.canvas,this.canvas=a,this.context=this.canvas.getContext("2d"),d.NodeJS||b.parentNode.replaceChild(this.canvas,b),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},d.prototype.render=function(a){var b=this;return null==a&&(a=function(){}),i.trigger(this,"renderStart"),this.renderer.execute(function(){return b.context.putImageData(b.imageData,0,0),a.call(b)})},d.prototype.revert=function(a){var b,c,e,f,g;if(null==a&&(a=!0),!d.allowRevert)throw"Revert disabled";for(g=this.originalVisiblePixels(),b=e=0,f=g.length;e<f;b=++e)c=g[b],this.pixelData[b]=c;if(a)return this.context.putImageData(this.imageData,0,0)},d.prototype.reset=function(){var a,b,c,d,e,f,g,h,i;for(a=document.createElement("canvas"),v.copyAttributes(this.canvas,a),a.width=this.originalWidth,a.height=this.originalHeight,b=a.getContext("2d"),d=b.getImageData(0,0,a.width,a.height),f=d.data,i=this.initializedPixelData,c=g=0,h=i.length;g<h;c=++g)e=i[c],f[c]=e;return b.putImageData(d,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(a)},d.prototype.originalVisiblePixels=function(){var a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,r,s,t,u,v,w;if(!d.allowRevert)throw"Revert disabled";if(k=[],m=this.cropCoordinates.x,e=m+this.width,n=this.cropCoordinates.y,f=n+this.height,this.resized){for(a=document.createElement("canvas"),a.width=this.originalWidth,a.height=this.originalHeight,c=a.getContext("2d"),h=c.getImageData(0,0,a.width,a.height),j=h.data,t=this.originalPixelData,g=p=0,s=t.length;p<s;g=++p)i=t[g],j[g]=i;c.putImageData(h,0,0),l=document.createElement("canvas"),l.width=this.width,l.height=this.height,c=l.getContext("2d"),c.drawImage(a,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),j=c.getImageData(0,0,this.width,this.height).data,o=this.width}else j=this.originalPixelData,o=this.originalWidth;for(g=r=0,u=j.length;r<u;g=r+=4)b=q.locationToCoordinates(g,o),m<=(v=b.x)&&v<e&&n<=(w=b.y)&&w<f&&k.push(j[g],j[g+1],j[g+2],j[g+3]);return k},d.prototype.process=function(a,b){return this.renderer.add({type:k.Type.Single,name:a,processFn:b}),this},d.prototype.processKernel=function(a,b,c,d){var e,f,g;if(null==c&&(c=null),null==d&&(d=0),null==c)for(c=0,e=f=0,g=b.length;0<=g?f<g:f>g;e=0<=g?++f:--f)c+=b[e];return this.renderer.add({type:k.Type.Kernel,name:a,adjust:b,divisor:c,bias:d}),this},d.prototype.processPlugin=function(a,b){return this.renderer.add({type:k.Type.Plugin,plugin:a,args:b}),this},d.prototype.newLayer=function(a){var b;return b=new n(this),this.canvasQueue.push(b),this.renderer.add({type:k.Type.LayerDequeue}),a.call(b),this.renderer.add({type:k.Type.LayerFinished}),this},d.prototype.executeLayer=function(a){return this.pushContext(a)},d.prototype.pushContext=function(a){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=a,this.pixelData=a.pixelData},d.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},d.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},d}(p),t.Caman=e,e.Analyze=function(){function a(a){this.c=a}return a.prototype.calculateLevels=function(){var a,b,c,d,e,f,g;for(b={r:{},g:{},b:{}},a=d=0;d<=255;a=++d)b.r[a]=0,b.g[a]=0,b.b[a]=0;for(a=e=0,g=this.c.pixelData.length;e<g;a=e+=4)b.r[this.c.pixelData[a]]++,b.g[this.c.pixelData[a+1]]++,b.b[this.c.pixelData[a+2]]++;for(c=this.c.pixelData.length/4,a=f=0;f<=255;a=++f)b.r[a]/=c,b.g[a]/=c,b.b[a]/=c;return b},a}(),b=e.Analyze,e.DOMUpdated=function(){var a,b,c,d,e,g;if(b=document.querySelectorAll("img[data-caman]"),b.length>0){for(g=[],d=0,e=b.length;d<e;d++)a=b[d],g.push(c=new f(a,function(){return this.parse(),this.execute()}));return g}},e.autoload&&!function(){return"complete"===document.readyState?e.DOMUpdated():document.addEventListener("DOMContentLoaded",e.DOMUpdated,!1)}(),f=function(){function a(a,b){this.dataStr=a.getAttribute("data-caman"),this.caman=e(a,b.bind(this))}var b;return b="(\\w+)\\((.*?)\\)",a.prototype.parse=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n;if(this.ele=this.caman.canvas,i=new RegExp(b,"g"),j=this.dataStr.match(i),j.length>0){for(i=new RegExp(b),n=[],k=0,l=j.length;k<l;k++){f=j[k],m=f.match(i),h=m[0],d=m[1],a=m[2],g=new Function("return function() {        this."+d+"("+a+");      };");try{e=g(),n.push(e.call(this.caman))}catch(p){c=p,n.push(o.debug(c))}}return n}},a.prototype.execute=function(){var a;return a=this.ele,this.caman.render(function(){return a.parentNode.replaceChild(this.toImage(),a)})},a}(),e.Blender=function(){function a(){}return a.blenders={},a.register=function(a,b){return this.blenders[a]=b},a.execute=function(a,b,c){return this.blenders[a](b,c)},a}(),c=e.Blender,e.Calculate=function(){function a(){}return a.distance=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},a.randomRange=function(a,b,c){var d;return null==c&&(c=!1),d=a+Math.random()*(b-a),c?d.toFixed(c):Math.round(d)},a.luminance=function(a){return.299*a.r+.587*a.g+.114*a.b},a.bezier=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;for(u=a[0],y=a[1],v=b[0],z=b[1],w=c[0],A=c[1],x=d[0],B=d[1],m={},k=parseInt(3*(v-u),10),i=3*(w-v)-k,g=x-u-k-i,l=3*(z-y),j=3*(A-z)-l,h=B-y-l-j,p=C=0;C<1e3;p=++C)t=p/1e3,n=Math.round(g*Math.pow(t,3)+i*Math.pow(t,2)+k*t+u),o=Math.round(h*Math.pow(t,3)+j*Math.pow(t,2)+l*t+y),e&&o<e?o=e:f&&o>f&&(o=f),m[n]=o;if(m.length<d[0]+1)for(p=D=0,F=d[0];0<=F?D<=F:D>=F;p=0<=F?++D:--D)if(null==m[p]){for(r=[p-1,m[p-1]],q=E=p,G=d[0];p<=G?E<=G:E>=G;q=p<=G?++E:--E)if(null!=m[q]){s=[q,m[q]];break}m[p]=r[1]+(s[1]-r[1])/(s[0]-r[0])*(p-r[0])}return null==m[d[0]]&&(m[d[0]]=m[d[0]-1]),m},a}(),d=e.Calculate,e.Convert=function(){function a(){}return a.hexToRGB=function(a){var b,c,d;return"#"===a.charAt(0)&&(a=a.substr(1)),d=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),b=parseInt(a.substr(4,2),16),{r:d,g:c,b:b}},a.rgbToHSL=function(a,b,c){var d,e,f,g,h,i;return"object"==typeof a&&(b=a.g,c=a.b,a=a.r),a/=255,b/=255,c/=255,g=Math.max(a,b,c),h=Math.min(a,b,c),
f=(g+h)/2,g===h?e=i=0:(d=g-h,i=f>.5?d/(2-g-h):d/(g+h),e=function(){switch(g){case a:return(b-c)/d+(b<c?6:0);case b:return(c-a)/d+2;case c:return(a-b)/d+4}}(),e/=6),{h:e,s:i,l:f}},a.hslToRGB=function(a,b,c){var d,e,f,g,h;return"object"==typeof a&&(b=a.s,c=a.l,a=a.h),0===b?h=e=d=c:(g=c<.5?c*(1+b):c+b-c*b,f=2*c-g,h=this.hueToRGB(f,g,a+1/3),e=this.hueToRGB(f,g,a),d=this.hueToRGB(f,g,a-1/3)),{r:255*h,g:255*e,b:255*d}},a.hueToRGB=function(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a},a.rgbToHSV=function(a,b,c){var d,e,f,g,h,i;return a/=255,b/=255,c/=255,f=Math.max(a,b,c),g=Math.min(a,b,c),i=f,d=f-g,h=0===f?0:d/f,f===g?e=0:(e=function(){switch(f){case a:return(b-c)/d+(b<c?6:0);case b:return(c-a)/d+2;case c:return(a-b)/d+4}}(),e/=6),{h:e,s:h,v:i}},a.hsvToRGB=function(a,b,c){var d,e,f,g,h,i,j,k;switch(g=Math.floor(6*a),e=6*a-g,h=c*(1-b),i=c*(1-e*b),k=c*(1-(1-e)*b),g%6){case 0:j=c,f=k,d=h;break;case 1:j=i,f=c,d=h;break;case 2:j=h,f=c,d=k;break;case 3:j=h,f=i,d=c;break;case 4:j=k,f=h,d=c;break;case 5:j=c,f=h,d=i}return{r:Math.floor(255*j),g:Math.floor(255*f),b:Math.floor(255*d)}},a.rgbToXYZ=function(a,b,c){var d,e,f;return a/=255,b/=255,c/=255,a>.04045?a=Math.pow((a+.055)/1.055,2.4):a/=12.92,b>.04045?b=Math.pow((b+.055)/1.055,2.4):b/=12.92,c>.04045?c=Math.pow((c+.055)/1.055,2.4):c/=12.92,d=.4124*a+.3576*b+.1805*c,e=.2126*a+.7152*b+.0722*c,f=.0193*a+.1192*b+.9505*c,{x:100*d,y:100*e,z:100*f}},a.xyzToRGB=function(a,b,c){var d,e,f;return a/=100,b/=100,c/=100,f=3.2406*a+-1.5372*b+-.4986*c,e=-.9689*a+1.8758*b+.0415*c,d=.0557*a+-.204*b+1.057*c,f>.0031308?f=1.055*Math.pow(f,.4166666667)-.055:f*=12.92,e>.0031308?e=1.055*Math.pow(e,.4166666667)-.055:e*=12.92,d>.0031308?d=1.055*Math.pow(d,.4166666667)-.055:d*=12.92,{r:255*f,g:255*e,b:255*d}},a.xyzToLab=function(a,b,c){var d,e,f,g,h,i;return"object"==typeof a&&(b=a.y,c=a.z,a=a.x),g=95.047,h=100,i=108.883,a/=g,b/=h,c/=i,a=a>.008856451679?Math.pow(a,.3333333333):7.787037037*a+.1379310345,b=b>.008856451679?Math.pow(b,.3333333333):7.787037037*b+.1379310345,c=c>.008856451679?Math.pow(c,.3333333333):7.787037037*c+.1379310345,f=116*b-16,d=500*(a-b),e=200*(b-c),{l:f,a:d,b:e}},a.labToXYZ=function(a,b,c){var d,e,f;return"object"==typeof a&&(b=a.a,c=a.b,a=a.l),e=(a+16)/116,d=e+b/500,f=e-c/200,d=d>.2068965517?d*d*d:.1284185493*(d-.1379310345),e=e>.2068965517?e*e*e:.1284185493*(e-.1379310345),f=f>.2068965517?f*f*f:.1284185493*(f-.1379310345),{x:95.047*d,y:100*e,z:108.883*f}},a.rgbToLab=function(a,b,c){var d;return"object"==typeof a&&(b=a.g,c=a.b,a=a.r),d=this.rgbToXYZ(a,b,c),this.xyzToLab(d)},a.labToRGB=function(a,b,c){},a}(),h=e.Convert,e.Event=function(){function a(){}return a.events={},a.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],a.trigger=function(a,b,c){var d,e,f,g,h;if(null==c&&(c=null),this.events[b]&&this.events[b].length){for(g=this.events[b],h=[],e=0,f=g.length;e<f;e++)d=g[e],null===d.target||a.id===d.target.id?h.push(d.fn.call(a,c)):h.push(void 0);return h}},a.listen=function(a,b,c){var d,e;return"string"==typeof a&&(e=a,d=b,a=null,b=e,c=d),!(A.call(this.types,b)<0)&&(this.events[b]||(this.events[b]=[]),this.events[b].push({target:a,fn:c}),!0)},a}(),i=e.Event,e.Filter=function(){function a(){}return a.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},a.register=function(a,b){return e.prototype[a]=b},a}(),k=e.Filter,e.IO=function(){function a(){}return a.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,a.isRemote=function(a){return null!=a&&(!this.corsEnabled(a)&&this.isURLRemote(a.src))},a.corsEnabled=function(a){var b;return null!=a.crossOrigin&&("anonymous"===(b=a.crossOrigin.toLowerCase())||"use-credentials"===b)},a.isURLRemote=function(a){var b;return b=a.match(this.domainRegex),!!b&&b[1]!==document.domain},a.remoteCheck=function(a){if(this.isURLRemote(a)){if(e.remoteProxy.length)return e.isURLRemote(e.remoteProxy)?void o.info("Cannot use a remote proxy for loading images."):this.proxyUrl(a);o.info("Attempting to load a remote image without a configured proxy. URL: "+a)}},a.proxyUrl=function(a){return""+e.remoteProxy+"?"+e.proxyParam+"="+encodeURIComponent(a)},a.useProxy=function(a){var b;return b={ruby:"rb",python:"py",perl:"pl",javascript:"js"},a=a.toLowerCase(),null!=b[a]&&(a=b[a]),"proxies/caman_proxy."+a},a}(),e.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},e.prototype.browserSave=function(a){var b;return null==a&&(a="png"),a=a.toLowerCase(),b=this.toBase64(a).replace("image/"+a,"image/octet-stream"),document.location.href=b},e.prototype.nodeSave=function(a,b){var c,d;null==b&&(b=!0);try{if(d=w.statSync(a),d.isFile()&&!b)return!1}catch(e){c=e,o.debug("Creating output file "+a)}return w.writeFile(a,this.canvas.toBuffer(),function(){return o.debug("Finished writing to "+a)})},e.prototype.toImage=function(a){var b;return b=document.createElement("img"),b.src=this.toBase64(a),b.width=this.dimensions.width,b.height=this.dimensions.height,window.devicePixelRatio&&(b.width/=window.devicePixelRatio,b.height/=window.devicePixelRatio),b},e.prototype.toBase64=function(a){return null==a&&(a="png"),a=a.toLowerCase(),this.canvas.toDataURL("image/"+a)},l=e.IO,e.Layer=function(){function b(a){this.c=a,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=v.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new g:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return b.prototype.newLayer=function(a){return this.c.newLayer.call(this.c,a)},b.prototype.setBlendingMode=function(a){return this.options.blendingMode=a,this},b.prototype.opacity=function(a){return this.options.opacity=a/100,this},b.prototype.copyParent=function(){var a,b,c,d;for(b=this.c.pixelData,a=c=0,d=this.c.pixelData.length;c<d;a=c+=4)this.pixelData[a]=b[a],this.pixelData[a+1]=b[a+1],this.pixelData[a+2]=b[a+2],this.pixelData[a+3]=b[a+3];return this},b.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},b.prototype.overlayImage=function(b){return"object"==typeof b?b=b.src:"string"==typeof b&&"#"===b[0]&&(b=a(b).src),b?(this.c.renderer.renderQueue.push({type:k.Type.LoadOverlay,src:b,layer:this}),this):this},b.prototype.applyToParent=function(){var a,b,d,e,f,g,h,i,j;for(d=this.c.pixelStack[this.c.pixelStack.length-1],b=this.c.pixelData,j=[],a=h=0,i=b.length;h<i;a=h+=4)g={r:d[a],g:d[a+1],b:d[a+2],a:d[a+3]},f={r:b[a],g:b[a+1],b:b[a+2],a:b[a+3]},e=c.execute(this.options.blendingMode,f,g),e.r=v.clampRGB(e.r),e.g=v.clampRGB(e.g),e.b=v.clampRGB(e.b),null==e.a&&(e.a=f.a),d[a]=g.r-(g.r-e.r)*(this.options.opacity*(e.a/255)),d[a+1]=g.g-(g.g-e.g)*(this.options.opacity*(e.a/255)),j.push(d[a+2]=g.b-(g.b-e.b)*(this.options.opacity*(e.a/255)));return j},b}(),n=e.Layer,e.Logger=function(){function a(){var a,b,c,d;for(d=["log","info","warn","error"],b=0,c=d.length;b<c;b++)a=d[b],this[a]=function(a){return function(){var b,c;if(b=1<=arguments.length?B.call(arguments,0):[],e.DEBUG)try{return console[a].apply(console,b)}catch(d){return c=d,console[a](b)}}}(a);this.debug=this.log}return a}(),o=new e.Logger,e.Pixel=function(){function a(a,b,c,d,e){this.r=null!=a?a:0,this.g=null!=b?b:0,this.b=null!=c?c:0,this.a=null!=d?d:255,this.c=null!=e?e:null,this.loc=0}return a.coordinatesToLocation=function(a,b,c){return 4*(b*c+a)},a.locationToCoordinates=function(a,b){var c,d;return d=Math.floor(a/(4*b)),c=a%(4*b)/4,{x:c,y:d}},a.prototype.setContext=function(a){return this.c=a},a.prototype.locationXY=function(){var a,b;if(null==this.c)throw"Requires a CamanJS context";return b=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),a=this.loc%(4*this.c.dimensions.width)/4,{x:a,y:b}},a.prototype.pixelAtLocation=function(b){if(null==this.c)throw"Requires a CamanJS context";return new a(this.c.pixelData[b],this.c.pixelData[b+1],this.c.pixelData[b+2],this.c.pixelData[b+3],this.c)},a.prototype.getPixelRelative=function(b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.loc+4*this.c.dimensions.width*(c*-1)+4*b,d>this.c.pixelData.length||d<0?new a(0,0,0,255,this.c):this.pixelAtLocation(d)},a.prototype.putPixelRelative=function(a,b,c){var d;if(null==this.c)throw"Requires a CamanJS context";if(d=this.loc+4*this.c.dimensions.width*(b*-1)+4*a,!(newLoc>this.c.pixelData.length||newLoc<0))return this.c.pixelData[newLoc]=c.r,this.c.pixelData[newLoc+1]=c.g,this.c.pixelData[newLoc+2]=c.b,this.c.pixelData[newLoc+3]=c.a,!0},a.prototype.getPixel=function(a,b){var c;if(null==this.c)throw"Requires a CamanJS context";return c=this.coordinatesToLocation(a,b,this.width),this.pixelAtLocation(c)},a.prototype.putPixel=function(a,b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.coordinatesToLocation(a,b,this.width),this.c.pixelData[d]=c.r,this.c.pixelData[d+1]=c.g,this.c.pixelData[d+2]=c.b,this.c.pixelData[d+3]=c.a},a.prototype.toString=function(){return this.toKey()},a.prototype.toHex=function(a){var b;return null==a&&(a=!1),b="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16),a?b+this.a.toString(16):b},a}(),q=e.Pixel,e.Plugin=function(){function a(){}return a.plugins={},a.register=function(a,b){return this.plugins[a]=b},a.execute=function(a,b,c){return this.plugins[b].apply(a,c)},a}(),r=e.Plugin,e.Renderer=function(){function a(a){this.c=a,this.processNext=D(this.processNext,this),this.renderQueue=[],this.modPixelData=null}return a.Blocks=e.NodeJS?require("os").cpus().length:4,a.prototype.add=function(a){if(null!=a)return this.renderQueue.push(a)},a.prototype.processNext=function(){var a;if(0===this.renderQueue.length)return i.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case k.Type.LayerDequeue:return a=this.c.canvasQueue.shift(),this.c.executeLayer(a),this.processNext();case k.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case k.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case k.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},a.prototype.execute=function(a){return this.finishedFn=a,this.modPixelData=v.dataArray(this.c.pixelData.length),this.processNext()},a.prototype.eachBlock=function(b){var c,d,f,g,h,i,k,l,m,n,o,p,q=this;for(this.blocksDone=0,l=this.c.pixelData.length,d=Math.floor(l/4/a.Blocks),c=4*d,k=c+l/4%a.Blocks*4,p=[],i=n=0,o=a.Blocks;0<=o?n<o:n>o;i=0<=o?++n:--n)m=i*c,g=m+(i===a.Blocks-1?k:c),e.NodeJS?(h=j(function(){return b.call(q,i,m,g)}),f=h.run(),p.push(this.blockFinished(f))):p.push(setTimeout(function(a,c,d){return function(){return b.call(q,a,c,d)}}(i,m,g),0));return p},a.prototype.executeFilter=function(){return i.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===k.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},a.prototype.executePlugin=function(){return o.debug("Executing plugin "+this.currentJob.plugin),r.execute(this.c,this.currentJob.plugin,this.currentJob.args),o.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},a.prototype.renderBlock=function(b,c,d){var f,g,h;for(o.debug("Block #"+b+" - Filter: "+this.currentJob.name+", Start: "+c+", End: "+d),i.trigger(this.c,"blockStarted",{blockNum:b,totalBlocks:a.Blocks,startPixel:c,endPixel:d}),g=new q,g.setContext(this.c),f=h=c;h<d;f=h+=4)g.loc=f,g.r=this.c.pixelData[f],g.g=this.c.pixelData[f+1],g.b=this.c.pixelData[f+2],g.a=this.c.pixelData[f+3],this.currentJob.processFn(g),this.c.pixelData[f]=v.clampRGB(g.r),this.c.pixelData[f+1]=v.clampRGB(g.g),this.c.pixelData[f+2]=v.clampRGB(g.b),this.c.pixelData[f+3]=v.clampRGB(g.a);return e.NodeJS?j["yield"](b):this.blockFinished(b)},a.prototype.renderKernel=function(a,b,c){var d,f,g,h,i,k,l,m,n,p,r,s,t,u,w,x,y,z;for(s=this.currentJob.name,g=this.currentJob.bias,k=this.currentJob.divisor,r=this.c.pixelData.length,d=this.currentJob.adjust,f=Math.sqrt(d.length),p=[],o.debug("Rendering kernel - Filter: "+this.currentJob.name),b=Math.max(b,4*this.c.dimensions.width*((f-1)/2)),c=Math.min(c,r-4*this.c.dimensions.width*((f-1)/2)),h=(f-1)/2,u=new q,u.setContext(this.c),l=x=b;x<c;l=x+=4){for(u.loc=l,i=0,m=y=-h;-h<=h?y<=h:y>=h;m=-h<=h?++y:--y)for(n=z=h;h<=-h?z<=-h:z>=-h;n=h<=-h?++z:--z)t=u.getPixelRelative(m,n),p[3*i]=t.r,p[3*i+1]=t.g,p[3*i+2]=t.b,i++;w=this.processKernel(d,p,k,g),this.modPixelData[l]=v.clampRGB(w.r),this.modPixelData[l+1]=v.clampRGB(w.g),this.modPixelData[l+2]=v.clampRGB(w.b),this.modPixelData[l+3]=this.c.pixelData[l+3]}return e.NodeJS?j["yield"](a):this.blockFinished(a)},a.prototype.blockFinished=function(b){var c,d,e;if(b>=0&&o.debug("Block #"+b+" finished! Filter: "+this.currentJob.name),this.blocksDone++,i.trigger(this.c,"blockFinished",{blockNum:b,blocksFinished:this.blocksDone,totalBlocks:a.Blocks}),this.blocksDone===a.Blocks){if(this.currentJob.type===k.Type.Kernel)for(c=d=0,e=this.c.pixelData.length;0<=e?d<e:d>e;c=0<=e?++d:--d)this.c.pixelData[c]=this.modPixelData[c];return b>=0&&o.debug("Filter "+this.currentJob.name+" finished!"),i.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},a.prototype.processKernel=function(a,b,c,d){var e,f,g,h;for(f={r:0,g:0,b:0},e=g=0,h=a.length;0<=h?g<h:g>h;e=0<=h?++g:--g)f.r+=a[e]*b[3*e],f.g+=a[e]*b[3*e+1],f.b+=a[e]*b[3*e+2];return f.r=f.r/c+d,f.g=f.g/c+d,f.b=f.b/c+d,f},a.prototype.loadOverlay=function(a,b){var c,d,e=this;return c=document.createElement("img"),c.onload=function(){return a.context.drawImage(c,0,0,e.c.dimensions.width,e.c.dimensions.height),a.imageData=a.context.getImageData(0,0,e.c.dimensions.width,e.c.dimensions.height),a.pixelData=a.imageData.data,e.c.pixelData=a.pixelData,e.processNext()},d=l.remoteCheck(b),c.src=null!=d?d:b},a}(),s=e.Renderer,e.Store=function(){function a(){}return a.items={},a.has=function(a){return null!=this.items[a]},a.get=function(a){return this.items[a]},a.put=function(a,b){return this.items[a]=b},a.execute=function(a,b){var c=this;return setTimeout(function(){return b.call(c.get(a),c.get(a))},0),this.get(a)},a.flush=function(a){return null==a&&(a=!1),a?delete this.items[a]:this.items={}},a}(),u=e.Store,c.register("normal",function(a,b){return{r:a.r,g:a.g,b:a.b}}),c.register("multiply",function(a,b){return{r:a.r*b.r/255,g:a.g*b.g/255,b:a.b*b.b/255}}),c.register("screen",function(a,b){return{r:255-(255-a.r)*(255-b.r)/255,g:255-(255-a.g)*(255-b.g)/255,b:255-(255-a.b)*(255-b.b)/255}}),c.register("overlay",function(a,b){var c;return c={},c.r=b.r>128?255-2*(255-a.r)*(255-b.r)/255:b.r*a.r*2/255,c.g=b.g>128?255-2*(255-a.g)*(255-b.g)/255:b.g*a.g*2/255,c.b=b.b>128?255-2*(255-a.b)*(255-b.b)/255:b.b*a.b*2/255,c}),c.register("difference",function(a,b){return{r:a.r-b.r,g:a.g-b.g,b:a.b-b.b}}),c.register("addition",function(a,b){return{r:b.r+a.r,g:b.g+a.g,b:b.b+a.b}}),c.register("exclusion",function(a,b){return{r:128-2*(b.r-128)*(a.r-128)/255,g:128-2*(b.g-128)*(a.g-128)/255,b:128-2*(b.b-128)*(a.b-128)/255}}),c.register("softLight",function(a,b){var c;return c={},c.r=b.r>128?255-(255-b.r)*(255-(a.r-128))/255:b.r*(a.r+128)/255,c.g=b.g>128?255-(255-b.g)*(255-(a.g-128))/255:b.g*(a.g+128)/255,c.b=b.b>128?255-(255-b.b)*(255-(a.b-128))/255:b.b*(a.b+128)/255,c}),c.register("lighten",function(a,b){return{r:b.r>a.r?b.r:a.r,g:b.g>a.g?b.g:a.g,b:b.b>a.b?b.b:a.b}}),c.register("darken",function(a,b){return{r:b.r>a.r?a.r:b.r,g:b.g>a.g?a.g:b.g,b:b.b>a.b?a.b:b.b}}),k.register("fillColor",function(){var a;return a=1===arguments.length?h.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(b){return b.r=a.r,b.g=a.g,b.b=a.b,b.a=255,b})}),k.register("brightness",function(a){return a=Math.floor(255*(a/100)),this.process("brightness",function(b){return b.r+=a,b.g+=a,b.b+=a,b})}),k.register("saturation",function(a){return a*=-.01,this.process("saturation",function(b){var c;return c=Math.max(b.r,b.g,b.b),b.r!==c&&(b.r+=(c-b.r)*a),b.g!==c&&(b.g+=(c-b.g)*a),b.b!==c&&(b.b+=(c-b.b)*a),b})}),k.register("vibrance",function(a){return a*=-1,this.process("vibrance",function(b){var c,d,e;return e=Math.max(b.r,b.g,b.b),d=(b.r+b.g+b.b)/3,c=2*Math.abs(e-d)/255*a/100,b.r!==e&&(b.r+=(e-b.r)*c),b.g!==e&&(b.g+=(e-b.g)*c),b.b!==e&&(b.b+=(e-b.b)*c),b})}),k.register("greyscale",function(a){return this.process("greyscale",function(a){var b;return b=d.luminance(a),a.r=b,a.g=b,a.b=b,a})}),k.register("contrast",function(a){return a=Math.pow((a+100)/100,2),this.process("contrast",function(b){return b.r/=255,b.r-=.5,b.r*=a,b.r+=.5,b.r*=255,b.g/=255,b.g-=.5,b.g*=a,b.g+=.5,b.g*=255,b.b/=255,b.b-=.5,b.b*=a,b.b+=.5,b.b*=255,b})}),k.register("hue",function(a){return this.process("hue",function(b){var c,d,e,f,g,i;return f=h.rgbToHSV(b.r,b.g,b.b),e=100*f.h,e+=Math.abs(a),e%=100,e/=100,f.h=e,i=h.hsvToRGB(f.h,f.s,f.v),g=i.r,d=i.g,c=i.b,b.r=g,b.g=d,b.b=c,b})}),k.register("colorize",function(){var a,b;return 2===arguments.length?(b=h.hexToRGB(arguments[0]),a=arguments[1]):4===arguments.length&&(b={r:arguments[0],g:arguments[1],b:arguments[2]},a=arguments[3]),this.process("colorize",function(c){return c.r-=(c.r-b.r)*(a/100),c.g-=(c.g-b.g)*(a/100),c.b-=(c.b-b.b)*(a/100),c})}),k.register("invert",function(){return this.process("invert",function(a){return a.r=255-a.r,a.g=255-a.g,a.b=255-a.b,a})}),k.register("sepia",function(a){return null==a&&(a=100),a/=100,this.process("sepia",function(b){return b.r=Math.min(255,b.r*(1-.607*a)+b.g*(.769*a)+b.b*(.189*a)),b.g=Math.min(255,b.r*(.349*a)+b.g*(1-.314*a)+b.b*(.168*a)),b.b=Math.min(255,b.r*(.272*a)+b.g*(.534*a)+b.b*(1-.869*a)),b})}),k.register("gamma",function(a){return this.process("gamma",function(b){return b.r=255*Math.pow(b.r/255,a),b.g=255*Math.pow(b.g/255,a),b.b=255*Math.pow(b.b/255,a),b})}),k.register("noise",function(a){return a=2.55*Math.abs(a),this.process("noise",function(b){var c;return c=d.randomRange(a*-1,a),b.r+=c,b.g+=c,b.b+=c,b})}),k.register("clip",function(a){return a=2.55*Math.abs(a),this.process("clip",function(b){return b.r>255-a?b.r=255:b.r<a&&(b.r=0),b.g>255-a?b.g=255:b.g<a&&(b.g=0),b.b>255-a?b.b=255:b.b<a&&(b.b=0),b})}),k.register("channels",function(a){var b,c;if("object"!=typeof a)return this;for(b in a)C.call(a,b)&&(c=a[b],0!==c?a[b]/=100:delete a[b]);return 0===a.length?this:this.process("channels",function(b){return null!=a.red&&(a.red>0?b.r+=(255-b.r)*a.red:b.r-=b.r*Math.abs(a.red)),null!=a.green&&(a.green>0?b.g+=(255-b.g)*a.green:b.g-=b.g*Math.abs(a.green)),null!=a.blue&&(a.blue>0?b.b+=(255-b.b)*a.blue:b.b-=b.b*Math.abs(a.blue)),b})}),k.register("curves",function(){var a,b,c,e,f,g,h,i,j,k,l,m;if(b=arguments[0],c=2<=arguments.length?B.call(arguments,1):[],"string"==typeof b&&(b=b.split("")),"v"===b[0]&&(b=["r","g","b"]),c.length<3||c.length>4)throw"Invalid number of arguments to curves filter";if(i=c[0],e=c[1],f=4===c.length?c[2]:c[1],g=c[c.length-1],a=d.bezier(i,e,f,g,0,255),i[0]>0)for(h=j=0,l=i[0];0<=l?j<l:j>l;h=0<=l?++j:--j)a[h]=i[1];if(g[0]<255)for(h=k=m=g[0];m<=255?k<=255:k>=255;h=m<=255?++k:--k)a[h]=g[1];return this.process("curves",function(c){var d,e;for(h=d=0,e=b.length;0<=e?d<e:d>e;h=0<=e?++d:--d)c[b[h]]=a[c[b[h]]];return c})}),k.register("exposure",function(a){var b,c,d;return d=Math.abs(a)/100,b=[0,255*d],c=[255-255*d,255],a<0&&(b=b.reverse(),c=c.reverse()),this.curves("rgb",[0,0],b,c,[255,255])}),e.Plugin.register("crop",function(a,b,c,d){var e,f;return null==c&&(c=0),null==d&&(d=0),"undefined"!=typeof exports&&null!==exports?e=new g(a,b):(e=document.createElement("canvas"),v.copyAttributes(this.canvas,e),e.width=a,e.height=b),f=e.getContext("2d"),f.drawImage(this.canvas,c,d,a,b,0,0,a,b),this.cropCoordinates={x:c,y:d},this.cropped=!0,this.replaceCanvas(e)}),e.Plugin.register("resize",function(a){var b,c;return null==a&&(a=null),null===a||null==a.width&&null==a.height?void o.error("Invalid or missing dimensions given for resize"):(null==a.width?a.width=this.canvas.width*a.height/this.canvas.height:null==a.height&&(a.height=this.canvas.height*a.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?b=new g(a.width,a.height):(b=document.createElement("canvas"),v.copyAttributes(this.canvas,b),b.width=a.width,b.height=a.height),c=b.getContext("2d"),c.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,a.width,a.height),this.resized=!0,this.replaceCanvas(b))}),e.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),e.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),e.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),e.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),e.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),e.Filter.register("motionBlur",function(a){var b;return b=0===a||180===a?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:a>0&&a<90||a>180&&a<270?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===a||270===a?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",b)}),e.Filter.register("sharpen",function(a){return null==a&&(a=100),a/=100,this.processKernel("Sharpen",[0,-a,0,-a,4*a+1,-a,0,-a,0])}),z={brightness:function(a,b,c){return a.r=a.r-a.r*b*c.strength,a.g=a.g-a.g*b*c.strength,a.b=a.b-a.b*b*c.strength,a},gamma:function(a,b,c){return a.r=255*Math.pow(a.r/255,Math.max(10*b*c.strength,1)),a.g=255*Math.pow(a.g/255,Math.max(10*b*c.strength,1)),a.b=255*Math.pow(a.b/255,Math.max(10*b*c.strength,1)),a},colorize:function(a,b,c){return a.r-=(a.r-c.color.r)*b,a.g-=(a.g-c.color.g)*b,a.b-=(a.b-c.color.b)*b,a}},k.register("vignette",function(a,b){var c,e,f,g;return null==b&&(b=60),"string"==typeof a&&"%"===a.substr(-1)&&(a=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(a.substr(0,a.length-1),10)/100):this.dimensions.height*(parseInt(a.substr(0,a.length-1),10)/100)),b/=100,e=[this.dimensions.width/2,this.dimensions.height/2],g=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),f=g-a,c=d.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(g){var h,i,j;return j=g.locationXY(),h=d.distance(j.x,j.y,e[0],e[1]),h>f&&(i=Math.max(1,c[Math.round((h-f)/a*100)]/10*b),g.r=255*Math.pow(g.r/255,i),g.g=255*Math.pow(g.g/255,i),g.b=255*Math.pow(g.b/255,i)),g})}),k.register("rectangularVignette",function(a){var b,c,f,g,i,j,k;if(b={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},a=v.extend(b,a),!a.size)return this;if("string"==typeof a.size)f=parseInt(a.size,10)/100,a.size={width:this.dimensions.width*f,height:this.dimensions.height*f};else if("object"==typeof a.size)for(k=["width","height"],i=0,j=k.length;i<j;i++)c=k[i],"string"==typeof a.size[c]&&(a.size[c]=this.dimensions[c]*(parseInt(a.size[c],10)/100));else"number"===a.size&&(g=a.size,a.size={width:g,height:g});return"string"==typeof a.cornerRadius&&(a.cornerRadius=a.size.width/2*(parseInt(a.cornerRadius,10)/100)),a.strength/=100,a.size.width=Math.floor(a.size.width),a.size.height=Math.floor(a.size.height),a.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===a.method&&"string"==typeof a.color&&(a.color=h.hexToRGB(a.color)),a.coords={left:(this.dimensions.width-a.size.width)/2,right:this.dimensions.width-a.coords.left,bottom:(this.dimensions.height-a.size.height)/2,top:this.dimensions.height-a.coords.bottom},a.corners=[{x:a.coords.left+a.cornerRadius,y:a.coords.top-a.cornerRadius},{x:a.coords.right-a.cornerRadius,y:a.coords.top-a.cornerRadius},{x:a.coords.right-a.cornerRadius,y:a.coords.bottom+a.cornerRadius},{x:a.coords.left+a.cornerRadius,y:a.coords.bottom+a.cornerRadius}],a.maxDist=d.distance(0,0,a.corners[3].x,a.corners[3].y)-a.cornerRadius,this.process("rectangularVignette",function(b){var c,d,f;return d=b.locationXY(),d.x>a.corners[0].x&&d.x<a.corners[1].x&&d.y>a.coords.bottom&&d.y<a.coords.top?b:d.x>a.coords.left&&d.x<a.coords.right&&d.y>a.corners[3].y&&d.y<a.corners[2].y?b:(d.x>a.corners[0].x&&d.x<a.corners[1].x&&d.y>a.coords.top?c=(d.y-a.coords.top)/a.maxDist:d.y>a.corners[2].y&&d.y<a.corners[1].y&&d.x>a.coords.right?c=(d.x-a.coords.right)/a.maxDist:d.x>a.corners[0].x&&d.x<a.corners[1].x&&d.y<a.coords.bottom?c=(a.coords.bottom-d.y)/a.maxDist:d.y>a.corners[2].y&&d.y<a.corners[1].y&&d.x<a.coords.left?c=(a.coords.left-d.x)/a.maxDist:d.x<=a.corners[0].x&&d.y>=a.corners[0].y?(f=e.distance(d.x,d.y,a.corners[0].x,a.corners[0].y),c=(f-a.cornerRadius)/a.maxDist):d.x>=a.corners[1].x&&d.y>=a.corners[1].y?(f=e.distance(d.x,d.y,a.corners[1].x,a.corners[1].y),c=(f-a.cornerRadius)/a.maxDist):d.x>=a.corners[2].x&&d.y<=a.corners[2].y?(f=e.distance(d.x,d.y,a.corners[2].x,a.corners[2].y),c=(f-a.cornerRadius)/a.maxDist):d.x<=a.corners[3].x&&d.y<=a.corners[3].y&&(f=e.distance(d.x,d.y,a.corners[3].x,a.corners[3].y),c=(f-a.cornerRadius)/a.maxDist),c<0?b:z[a.method](b,c,a))})}),function(){var a,b,c,d,f;return d=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],f=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],b=function(a,b,c,d,e,f,h){var i,j,k,l,m,n,o;return i="undefined"!=typeof exports&&null!==exports?new g:document.createElement("canvas"),i.width=a,i.height=b,l=c+Math.cos(e)*f*.5,n=d+Math.sin(e)*f*.5,m=c-Math.cos(e)*f*.5,o=d-Math.sin(e)*f*.5,j=i.getContext("2d"),k=j.createLinearGradient(l,n,m,o),h?(k.addColorStop(0,"white"),k.addColorStop(.5,"black"),k.addColorStop(1,"white")):(k.addColorStop(0,"white"),k.addColorStop(1,"black")),j.fillStyle=k,j.fillRect(0,0,a,b),j.getImageData(0,0,a,b)},c=function(a,b,c,d,e,f){var h,i,j;return h="undefined"!=typeof exports&&null!==exports?new g:document.createElement("canvas"),h.width=a,h.height=b,i=h.getContext("2d"),j=i.createRadialGradient(c,d,e,c,d,f),j.addColorStop(1,"white"),j.addColorStop(0,"black"),i.fillStyle=j,i.fillRect(0,0,a,b),i.getImageData(0,0,a,b)},a=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},e.Plugin.register("compoundBlur",function(b,c,e,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka;for(W=this.dimensions.width,q=this.dimensions.height,v=this.pixelData,I=b.data,U=W*q,V=U<<2,D=[],s=ba=0;0<=V?ba<V:ba>V;s=0<=V?++ba:--ba)D[s]=v[s];for(l=0,R=g,g-=1;R-- >=0;)if(x=c+.5|0,0!==x){for(x>256&&(x=256),m=x+x+1,T=W<<2,X=W-1,r=q-1,J=x+1,S=J*(J+1)/2,Q=new a,N=void 0,M=Q,s=ca=1;1<=m?ca<m:ca>m;s=1<=m?++ca:--ca)M=M.next=new a,s===J&&(N=M);for(M.next=Q,O=null,P=null,aa=$=0,z=d[x],L=f[x],Z=da=0;0<=q?da<q:da>q;Z=0<=q?++da:--da){for(F=n=h=H=p=j=0,G=J*(E=D[$]),o=J*(C=D[$+1]),i=J*(B=D[$+2]),H+=S*E,p+=S*C,j+=S*B,M=Q,s=ea=0;0<=J?ea<J:ea>J;s=0<=J?++ea:--ea)M.r=E,M.g=C,M.b=B,M=M.next;for(s=fa=1;1<=J?fa<J:fa>J;s=1<=J?++fa:--fa)A=$+((X<s?X:s)<<2),H+=(M.r=E=D[A])*(K=J-s),p+=(M.g=C=D[A+1])*K,j+=(M.b=B=D[A+2])*K,F+=E,n+=C,h+=B,M=M.next;for(O=Q,P=N,Y=ga=0;0<=W?ga<W:ga>W;Y=0<=W?++ga:--ga)D[$]=H*z>>L,D[$+1]=p*z>>L,D[$+2]=j*z>>L,H-=G,p-=o,j-=i,G-=O.r,o-=O.g,i-=O.b,A=aa+((A=Y+J)<X?A:X)<<2,F+=O.r=D[A],n+=O.g=D[A+1],h+=O.b=D[A+2],H+=F,p+=n,j+=h,O=O.next,G+=E=P.r,o+=C=P.g,i+=B=P.b,F-=E,n-=C,h-=B,P=P.next,$+=4;aa+=W}for(Y=ha=0;0<=W?ha<W:ha>W;Y=0<=W?++ha:--ha){for(n=h=F=p=j=H=0,$=Y<<2,G=J*(E=D[$]),o=J*(C=D[$+1]),i=J*(B=D[$+2]),H+=S*E,p+=S*C,j+=S*B,M=Q,s=ia=0;0<=J?ia<J:ia>J;s=0<=J?++ia:--ia)M.r=E,M.g=C,M.b=B,M=M.next;for(_=W,s=ja=1;1<=J?ja<J:ja>J;s=1<=J?++ja:--ja)$=_+Y<<2,H+=(M.r=E=D[$])*(K=J-s),p+=(M.g=C=D[$+1])*K,j+=(M.b=B=D[$+2])*K,F+=E,n+=C,h+=B,M=M.next,s<r&&(_+=W);for($=Y,O=Q,P=N,Z=ka=0;0<=q?ka<q:ka>q;Z=0<=q?++ka:--ka)A=$<<2,D[A]=H*z>>L,D[A+1]=p*z>>L,D[A+2]=j*z>>L,H-=G,p-=o,j-=i,G-=O.r,o-=O.g,i-=O.b,A=Y+((A=Z+J)<r?A:r)*W<<2,H+=F+=O.r=D[A],p+=n+=O.g=D[A+1],j+=h+=O.b=D[A+2],O=O.next,G+=E=P.r,o+=C=P.g,i+=B=P.b,F-=E,n-=C,h-=B,P=P.next,$+=W}for(c*=e,s=U;--s>-1;)u=s<<2,y=(255&I[u+2])/255*g,w=0|y,w===l?(k=256*(y-(0|y)),t=256-k,v[u]=v[u]*t+D[u]*k>>8,v[u+1]=v[u+1]*t+D[u+1]*k>>8,v[u+2]=v[u+2]*t+D[u+2]*k>>8):w===l+1&&(v[u]=D[u],v[u+1]=D[u+1],v[u+2]=D[u+2]);l++}return this}),e.Filter.register("tiltShift",function(a){var c,d;return c={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},a=v.extend(c,a),a.angle*=Math.PI/180,d=b(this.dimensions.width,this.dimensions.height,a.center.x,a.center.y,a.angle,a.focusWidth,!0),this.processPlugin("compoundBlur",[d,a.startRadius,a.radiusFactor,a.steps])}),e.Filter.register("radialBlur",function(a){var b,d,e,f;return b={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},a=v.extend(b,a),a.radius||(a.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),e=a.radius/2-a.size,f=a.radius/2,d=c(this.dimensions.width,this.dimensions.height,a.center.x,a.center.y,e,f),this.processPlugin("compoundBlur",[d,a.startRadius,a.radiusFactor,a.steps])})}(),e.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),e.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),e.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),e.Filter.register("posterize",function(a){var b,c;return b=256/a,c=255/(a-1),this.process("posterize",function(a){return a.r=Math.floor(Math.floor(a.r/b)*c),a.g=Math.floor(Math.floor(a.g/b)*c),a.b=Math.floor(Math.floor(a.b/b)*c),a})}),e.Filter.register("vintage",function(a){if(null==a&&(a=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),a)return this.vignette("40%",30)}),e.Filter.register("lomo",function(a){
return null==a&&(a=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),a&&this.vignette("50%",60),this.brightness(5)}),e.Filter.register("clarity",function(a){return null==a&&(a=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),a&&(this.greyscale(),this.contrast(4)),this}),e.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),e.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),e.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),e.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),e.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),e.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),e.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),e.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),e.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),e.Filter.register("glowingSun",function(a){if(null==a&&(a=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),a)return this.vignette("45%",20)}),e.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),e.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),e.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),e.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),e.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),e.Plugin.register("rotate",function(a){var b,c,d,e,f,h,i,j;return b=a%360,0===b?this.dimensions={width:this.canvas.width,height:this.canvas.height}:(f=Math.PI/180,"undefined"!=typeof exports&&null!==exports?c=new g:(c=document.createElement("canvas"),v.copyAttributes(this.canvas,c)),90===b||b===-270||270===b||b===-90?(h=this.canvas.height,e=this.canvas.width,i=h/2,j=e/2):180===b?(h=this.canvas.width,e=this.canvas.height,i=h/2,j=e/2):(h=Math.sqrt(Math.pow(this.originalWidth,2)+Math.pow(this.originalHeight,2)),e=h,i=this.canvas.height/2,j=this.canvas.width/2),c.width=h,c.height=e,d=c.getContext("2d"),d.save(),d.translate(i,j),d.rotate(b*f),d.drawImage(this.canvas,-this.canvas.width/2,-this.canvas.height/2,this.canvas.width,this.canvas.height),d.restore(),this.replaceCanvas(c))}),e.Filter.register("rotate",function(){return this.processPlugin("rotate",Array.prototype.slice.call(arguments,0))}),function(){var a,b,c;return b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],a=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},e.Plugin.register("stackBlur",function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W;if(!(isNaN(d)||d<1)){for(d|=0,s=this.pixelData,H=this.dimensions.width,l=this.dimensions.height,h=d+d+1,G=H<<2,I=H-1,m=l-1,x=d+1,F=x*(x+1)/2,E=new a,A=E,n=O=1;1<=h?O<h:O>h;n=1<=h?++O:--O)A=A.next=new a,n===x&&(B=A);for(A.next=E,C=null,D=null,N=L=0,o=b[d],z=c[d],K=P=0;0<=l?P<l:P>l;K=0<=l?++P:--P){for(u=i=e=w=k=g=0,v=x*(t=s[L]),j=x*(r=s[L+1]),f=x*(q=s[L+2]),w+=F*t,k+=F*r,g+=F*q,A=E,n=Q=0;0<=x?Q<x:Q>x;n=0<=x?++Q:--Q)A.r=t,A.g=r,A.b=q,A=A.next;for(n=R=1;1<=x?R<x:R>x;n=1<=x?++R:--R)p=L+((I<n?I:n)<<2),w+=(A.r=t=s[p])*(y=x-n),k+=(A.g=r=s[p+1])*y,g+=(A.b=q=s[p+2])*y,u+=t,i+=r,e+=q,A=A.next;for(C=E,D=B,J=S=0;0<=H?S<H:S>H;J=0<=H?++S:--S)s[L]=w*o>>z,s[L+1]=k*o>>z,s[L+2]=g*o>>z,w-=v,k-=j,g-=f,v-=C.r,j-=C.g,f-=C.b,p=N+((p=J+d+1)<I?p:I)<<2,u+=C.r=s[p],i+=C.g=s[p+1],e+=C.b=s[p+2],w+=u,k+=i,g+=e,C=C.next,v+=t=D.r,j+=r=D.g,f+=q=D.b,u-=t,i-=r,e-=q,D=D.next,L+=4;N+=H}for(J=T=0;0<=H?T<H:T>H;J=0<=H?++T:--T){for(i=e=u=k=g=w=0,L=J<<2,v=x*(t=s[L]),j=x*(r=s[L+1]),f=x*(q=s[L+2]),w+=F*t,k+=F*r,g+=F*q,A=E,n=U=0;0<=x?U<x:U>x;n=0<=x?++U:--U)A.r=t,A.g=r,A.b=q,A=A.next;for(M=H,n=V=1;1<=d?V<=d:V>=d;n=1<=d?++V:--V)L=M+J<<2,w+=(A.r=t=s[L])*(y=x-n),k+=(A.g=r=s[L+1])*y,g+=(A.b=q=s[L+2])*y,u+=t,i+=r,e+=q,A=A.next,n<m&&(M+=H);for(L=J,C=E,D=B,K=W=0;0<=l?W<l:W>l;K=0<=l?++W:--W)p=L<<2,s[p]=w*o>>z,s[p+1]=k*o>>z,s[p+2]=g*o>>z,w-=v,k-=j,g-=f,v-=C.r,j-=C.g,f-=C.b,p=J+((p=K+x)<m?p:m)*H<<2,w+=u+=C.r=s[p],k+=i+=C.g=s[p+1],g+=e+=C.b=s[p+2],C=C.next,v+=t=D.r,j+=r=D.g,f+=q=D.b,u-=t,i-=r,e-=q,D=D.next,L+=H}return this}}),e.Filter.register("stackBlur",function(a){return this.processPlugin("stackBlur",[a])})}(),e.Filter.register("threshold",function(a){return this.process("threshold",function(b){var c;return c=.2126*b.r+.7152*b.g+.0722*b.b,c<a?(b.r=0,b.g=0,b.b=0):(b.r=255,b.g=255,b.b=255),b})})}.call(this),define("caman",function(a){return function(){var b;return b||a.Caman}}(this)),define("cb/photo/photo-editor",["jquery","caman","vendor/jquery.Jcrop.min"],function(a,b){"use strict";var c=function(c){function d(a){r=!0}function e(){var a=document.getElementById("photo"),b=a.getContext("2d");n=b.getImageData(0,0,a.width,a.height),q=!0}function f(){a("#cropbtn").attr("data-ga-label","Cropped");var b=a("#photo").width(),c=a("#photo").height();o.resize({width:b,height:c});var d=m.tellSelect();o.crop(d.w,d.h,d.x,d.y),o.render();var f=a("canvas").detach();f.css("display","inline-block"),f.css("visibility","visible"),f.css("height",d.h+"px"),f.css("width",d.w+"px"),f.css("position",""),f.prependTo("#image-area"),m.destroy(),e(),r=!1}function g(){var b=a("#image-area").width(),c=a("#image-area").height();a("#photo").Jcrop({onSelect:d,setSelect:[0,0,150,150],minSize:[150,150]},function(){a(".jcrop-holder").css("margin","auto"),m=this}),o.resize({width:b,height:c}),a("#photo").click(),r=!0}function h(){if(n){var a=document.getElementById("photo"),b=a.getContext("2d");b.putImageData(n,0,0),o.reloadCanvasData(),o.render()}else o.reset(),o.render()}function i(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}function j(b){if(null===b){var c=a("#photo-form").data("back-url");window.location.href=c}else{var d=a("#photo-form").data("confirm-url");window.location.href=d+"?message="+b}}function k(b,c){var d=document.getElementById("photo"),e=null,f=new XMLHttpRequest;f.addEventListener("error",function(a){j("Failed to update photo.")},!1),f.onreadystatechange=function(a){4===f.readyState&&j(e)};var g=d.getAttribute("data-url");f.open("POST",g);var h=new FormData;if(q){var k=d.toDataURL("image/jpeg"),l=i(k);h.append("photo",l,"filename.jpg")}b&&h.append("setAsMainPhoto",b),c&&h.append("caption",a("#caption").val()),f.send(h)}this.container=c;var l=a(this.container).find("img").attr("src");a("#photo").attr("src",l),b.Filter.register("rotate",function(){return this.processPlugin("rotate",Array.prototype.slice.call(arguments,0))}),b.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))});var m,n,o=b("#photo",function(){a("#cropbtn").prop("disabled",!1),a(".js-rotate").prop("disabled",!1),a(".dropdown-toggle").prop("disabled",!1),a(".photo-processing").hide()}),p=a("#caption").val(),q=!1,r=!1;a(".js-rotate").click(function(){var b=a("canvas"),c=b.height(),d=b.width(),f=c+"px",g=d+"px";o.rotate(90),o.render(),a("#photo").css("height",g),a("#photo").css("width",f),a(".jcrop-holder").css("height",g),a(".jcrop-holder").css("width",f),a(".jcrop-tracker").css("height",g),a(".jcrop-tracker").css("width",f),e()}),a("#cropbtn").click(function(){r?(f(),a("#rotatebtn").prop("disabled",!1),a(".dropdown-toggle").prop("disabled",!1)):(g(),a("#rotatebtn").prop("disabled",!0),a(".dropdown-toggle").prop("disabled",!0))}),a("#filterMenu a").click(function(b){b.preventDefault();var c=a(this).data("filter"),d="No Filter";c?(a(".photo-processing").show(),h(),"contrast"===c?o.contrast(10):c&&o[c](),o.render(function(){a(".photo-processing").hide()}),q=!0,d=a(this).text()):h(),a("#filter").html('<span class="pull-left">'+d+'</span><span class="caret"></span>')}),a("#submit-btn").click(function(b){b.preventDefault(),r&&f();var c=a("#main-photo").is(":checked"),d=a("#caption").val()!==p;q||c||d?k(c,d):j(null)}),a(".cancel-edit").click(function(a){a.preventDefault(),window.history.back()})};return c}),define("cb/photo/photo-viewer",["jquery"],function(a){"use strict";var b={reCalculateSize:function(b,c,d,e,f,g){c.removeAttr("width"),c.removeAttr("height"),d>=e?(b.css("height",f+"px"),b.css("width",g+"px"),b.css("max-width",g+"px"),c.css("max-height",f+"px"),c.css("width","auto"),c.css("max-width",g+"px")):(b.css("width",g+"px"),b.css("max-height",f+"px"),b.css("max-width",g+"px"),c.css("max-width",g+"px"),c.css("height","auto"),c.css("max-height",f+"px"));var h=a(window).width();if(h<768){b.css("height","auto");var i=a(".photo-viewer-content");i.css("height","auto"),i.css("background-color","white")}},handleIE:function(){var c=Boolean(window.MSInputMethodContext)&&Boolean(document.documentMode);if(c){var d=a(".photo-viewer-image-area"),e=a(".photo-viewer-image-column img"),f=parseInt(e.attr("width"),10),g=parseInt(e.attr("height"),10);a(".js-row-width").css("width","auto");var h=d.find(a(".photo-viewer-image-column")),i=a(".photo-viewer-image-area").width(),j=d.height();(g>j||f>i)&&b.reCalculateSize(h,e,g,f,j,i)}},initializeModalAndDisplayArea:function(){a(".photo-viewer").is(":visible")?a(".body-v5").css("overflow","hidden"):a(".body-v5").css("overflow","auto");var c=a(".photo-viewer-displayable"),d=a(window).height(),e=a(window).width();if(e>=768){var f=.95*d;c.css("max-height",f),c.css("height",f),a(".photo-viewer-scrollable").css("height",c.height())}else{a(".js-row-width").css("width","100%");var g=d-parseInt(a(".photo-viewer-image-area").height(),10);c.css("height",d),c.css("width",e),a(".photo-viewer-scrollable").css("height",g),a(".photo-viewer-content").css("height","auto")}b.handleIE()},closeModal:function(){a(".photo-viewer-modal").hide(),a(".body-v5").css("overflow","auto");var b=a(".gallery-container.modal").data("back-url");0===a(".photo-viewer-modal").length?window.location.href=b:window.history.pushState(null,null,b)},modalDismissal:function(){a('[data-dismiss="modal"]').on("click",function(a){b.closeModal()}),a(".photo-viewer").on("click",function(c){a(c.target).hasClass("photo-viewer-disable")||a(c.target).closest(".photo-viewer-displayable").length||b.closeModal()})},navigation:function(){a(".gallery-arrow").on("click",function(c){c.preventDefault();var d=a(c.target);if(d.hasClass("icon-chevron-left")||d.hasClass("icon-chevron-right")){var e=d.parents(".gallery-arrow");b.repopulateModal(e.data("url"))}else b.repopulateModal(d.data("url"))})},repopulateModal:function(c){a(".photo-viewer-load").show(),a.get(c,function(c){a(".photo-viewer-modal").html(c),b.initializeModalAndDisplayArea(),b.imageLoaded(),b.modalDismissal(),b.navigation(),b.resize(),b.displayControls()})},keystrokeMapping:function(){a(document).keydown(function(c){if("TEXTAREA"!==document.activeElement.nodeName.toUpperCase()&&"INPUT"!==document.activeElement.nodeName.toUpperCase()){c.preventDefault();var d=c.keyCode?c.keyCode:c.which;if(37===d){var e=a(".previous");e.data("url")&&b.repopulateModal(e.data("url"))}else if(39===d){var f=a(".next");f.data("url")&&b.repopulateModal(f.data("url"))}else 27===d&&a('[data-dismiss="modal"]').click()}})},resize:function(){a(window).resize(function(){b.initializeModalAndDisplayArea()})},changeUrl:function(){window.history.pushState(null,null,a(".photo-viewer").data("back-url")+"?id="+a(".photo-viewer").data("photo-id"))},enableAll:function(){a(".photo-viewer-suspend").remove()},triggerComments:function(){setTimeout(function(){a(".photo-viewer-modal").trigger("photo-viewer-load-complete")},500)},applyActions:function(){b.handleIE(),b.enableAll(),b.triggerComments(),b.changeUrl()},imageLoaded:function(c){c&&(a(".photo-viewer-load").hide(),b.applyActions()),a(".img-polaroid").load(function(){a(".photo-viewer-load").hide(),b.applyActions()})},displayControls:function(){a(".photo-viewer-image-area").hover(function(){a(".photo-viewer-control").show()},function(){a(".photo-viewer-control").hide()})},initialization:function(a){b.initializeModalAndDisplayArea(),b.imageLoaded(a),b.modalDismissal(),b.navigation(),b.keystrokeMapping(),b.resize(),b.displayControls()}},c=function(){this.methods=b};return c.prototype.initialize=function(a){return this.methods.initialization(a),this},c}),define("cb/photo/sort-and-filter-widget",["jquery"],function(a){"use strict";function b(a){a.initialSort?this.sort=a.initialSort:this.sort=k,this.el=a.el,this.expanded=!1,this.errorMsg='<p style="padding: 1em; color: darkred"><strong>Error: A required option is missing.</strong></p>',this.ascendingCallback=a.ascendingCallback,this.descendingCallback=a.descendingCallback,this.filterCallback=a.filterCallback,this.el&&"function"==typeof this.ascendingCallback&&"function"==typeof this.descendingCallback&&"function"==typeof this.filterCallback&&(this.errorMsg="")}function c(a){var c={label:b.DESCENDING,checked:a.sort===b.DESCENDING?"checked":"",callback:a.descendingCallback},d={label:b.ASCENDING,checked:a.sort===b.ASCENDING?"checked":"",callback:a.ascendingCallback},e=new Date,f=e.toLocaleDateString("en"),g="";return g+='<div class="sortAndFilterWidget">',g+='  <button class="sfwPill" aria-expanded="'+a.expanded+'" aria-controls="sfwPanel">',g+='    <span class="sfwButtonText">Sort / Filter<br><span class="sfwCurrentSort">',g+="      "+a.sort,g+="    </span></span>",g+='    <svg class="sfwExpandIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 999 630"><path d="M999 130c0-22-8-42-24-58l-48-48a79 79 0 0 0-58-24c-23 0-42 8-58 24L500 335 188 24a77 77 0 0 0-58-24c-23 0-42 8-58 24L24 72a77 77 0 0 0-24 58c0 23 8 42 24 59l418 417c16 16 35 24 58 24 22 0 41-8 58-24l417-417c16-17 24-36 24-59z" fill="currentColor"/></svg>',g+="  </button>",g+='  <div id="sfwPanel" class="'+(a.expanded?"":"hidden")+'">',g+=a.errorMsg,g+='    <fieldset class="sfwSort">',g+='      <legend class="sr-only">Sort order for gallery images</legend>',g+='      <label class="clearfix">',g+='        <input type="radio" name="sfwSortRadio" value="'+c.label+'" '+c.checked+">",g+="        "+c.label,g+="      </label>",g+='      <label class="clearfix">',g+='        <input type="radio" name="sfwSortRadio" value="'+d.label+'" '+d.checked+">",g+="        "+d.label,g+="      </label>",g+="    </fieldset>",g+='    <div class="sfwFilter">',g+='      <label for="dateFrom">Date from<br>',g+='        <input type="text" id="dateFrom" placeholder="mm/dd/yy">',g+="      </label>",g+='      <label for="dateTo">Date to<br>',g+='        <input type="text" id="dateTo" placeholder="mm/dd/yy" value="'+f+'">',g+="      </label>",g+="    </div>",g+='    <div class="sfwApplyFilter">',g+='      <button class="btn btn-primary js-applyBtn">Apply</button>',g+="    </div>",g+="  </div>",g+="</div>"}function d(){var b=document.querySelector(".sfwPill");b.addEventListener("click",function(){this.toggle()}.bind(this),!1),b.addEventListener("keyup",function(b){"Tab"===b.key&&a(b.target).addClass("hasOutline")},!1)}function e(){var b=a("#dateFrom").datepicker({dateFormat:i,prevText:"Previous month",nextText:"Next month",changeMonth:!0,changeYear:!0}).on("change",function(){c.datepicker("option","minDate",g(this))}),c=a("#dateTo").datepicker({dateFormat:i,prevText:"Previous month",nextText:"Next month",changeMonth:!0,changeYear:!0}).on("change",function(){b.datepicker("option","maxDate",g(this))}),d=document.querySelector(".js-applyBtn");d.onclick=h.bind(this)}function f(a){return a===this.sort?void this.toggle():(this.setSort(a),this.toggle(),this.sort===j&&"function"==typeof this.ascendingCallback?void this.ascendingCallback():this.sort===k&&"function"==typeof this.descendingCallback?void this.descendingCallback():void 0)}function g(b){try{return a.datepicker.parseDate(i,b.value)}catch(c){return null}}function h(){var b,c;try{b=a.datepicker.formatDate("yy-mm-dd",g(document.getElementById("dateFrom"))),c=a.datepicker.formatDate("yy-mm-dd",g(document.getElementById("dateTo")))}catch(d){return}for(var e,h=document.querySelectorAll('[name="sfwSortRadio"]'),i=0;i<h.length;i++)h[i].checked&&(e=h[i].value);if(b&&c){this.setSort(e);var k;k=this.sort===j?"asc":"desc",this.toggle(),this.filterCallback(b,c,k)}else f.call(this,e)}var i="mm/dd/yy",j="Oldest to Newest",k="Newest to Oldest";return b.ASCENDING=j,b.DESCENDING=k,b.prototype.setSort=function(a){this.sort=a,this.el.querySelector(".sfwCurrentSort").innerHTML=this.sort},b.prototype.toggle=function(){this.expanded=!this.expanded,this.el.querySelector(".sfwPill").setAttribute("aria-expanded",this.expanded),this.expanded?a("#sfwPanel").removeClass("hidden"):a("#sfwPanel").addClass("hidden")},b.prototype.render=function(){return this.el.innerHTML=c(this),d.call(this),e.call(this),a("body").addClass("galleryPage"),this},b}),define("cb/photo/filter-applied-widget",["jquery"],function(a){"use strict";function b(a){this.el=a.el,this.removeCallback=a.removeCallback,this.localeDateFrom=d(a.dateFrom,e),this.localeDateTo=d(a.dateTo,e),this.removeFilter=this.removeFilter.bind(this)}function c(){var a="";return this.localeDateFrom&&this.localeDateTo&&(a+='<div class="filterAppliedWidget">',a+='  <div class="fawTitle">Filter Applied</div>',a+='  <button class="fawPill">',a+=this.localeDateFrom+" – "+this.localeDateTo,a+='    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M512 45L467 0 256 211 45 0 0 45l211 211L0 467l45 45 211-211 211 211 45-45-211-211z"/></svg>',a+="  </button>",a+="<div>"),a}function d(b,c){var d=a.datepicker.parseDate("yy-mm-dd",b);return a.datepicker.formatDate(c,d)}var e="mm/dd/yy";return b.prototype.render=function(){var a=document.querySelector(".fawPill");return a&&a.removeEventListener("click",this.removeFilter,!1),this.el.innerHTML=c.call(this),a=document.querySelector(".fawPill"),a&&a.addEventListener("click",this.removeFilter,!1),this},b.prototype.setDates=function(a,b){this.localeDateFrom=d(a,e),this.localeDateTo=d(b,e),this.render()},b.prototype.removeFilter=function(){this.localeDateFrom=null,this.localeDateTo=null,this.render(),this.removeCallback()},b}),require(["jquery","cb/photo/multiple-upload","cb/photo/photo-editor","cb/photo/photo-viewer","cb/photo/sort-and-filter-widget","cb/photo/filter-applied-widget","cb/swipeable/swipeable"],function(a,b,c,d,e,f,g){"use strict";var h=function(){(new g).initialize()};a(function(){function g(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function i(a,b){var c="";b||(c=window.location.search);var d;return d=""===c?baseURL+"?sort="+a:l(baseURL+c,"sort",a),function(){window.location=d}}function j(){var a=g("sort").toUpperCase();return"ASC"===a?e.ASCENDING:e.DESCENDING}function k(a,b,c){m&&m.setDates(a,b);var d=baseURL;""===c&&(c="desc"),d+="?dateFrom="+a+"&dateTo="+b+"&sort="+c,window.location.href=d}function l(a,b,c){a=a.replace(new RegExp("id=\\w+"),"").replace("?&","?").replace("&&","&");var d,e=new RegExp("([?&])"+b+"=.*?(&|$)","i"),f=a.indexOf("?")!==-1?"&":"?";return d=a.match(e)?a.replace(e,"$1"+b+"="+c+"$2"):a+f+b+"="+c}a("#uploadForm").each(function(){}