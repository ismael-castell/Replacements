(()=>{"use strict";const t=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;const i=e.document.cookie.match("(^|;) ?".concat(t,"=([^;]*)(;|$)"));return i?i[2]:null};class e{static get CSRF_COOKIE_NAME(){return window.CSRF_COOKIE_NAME||"csrftoken"}static get FORM_CONTENT_TYPE(){return"application/x-www-form-urlencoded"}constructor(t){if(!t)throw new Error("APIClient called without a model!");this.model=t}fetch(){const{_onReadyStateChange:i}=this,{url:n,method:s,data:a,contentType:r,csrfToken:o,headers:_}=this.model;return new Promise(((d,h)=>{this.resolve=d,this.reject=h,this.httpRequest=new XMLHttpRequest,this.httpRequest.onreadystatechange=i.bind(this),this.httpRequest.open(s,n),this.httpRequest.setRequestHeader("Content-Type",r),_.forEach((t=>this.httpRequest.setRequestHeader(t.key,t.value))),o&&this._resolveCSRFToken(this.httpRequest,t(e.CSRF_COOKIE_NAME));const c=r===e.FORM_CONTENT_TYPE?a:JSON.stringify(a);this.httpRequest.send(c)}))}_resolveCSRFToken(t,i){i?t.setRequestHeader("X-CSRFToken",i):console.warn("Unexpected CSRF Token: ".concat(e.CSRF_COOKIE_NAME))}_onReadyStateChange(){4===this.httpRequest.readyState&&(this.httpRequest.status>=200&&this.httpRequest.status<300?this.resolve(this.httpRequest.response):this.reject(this.httpRequest.response))}}class i{constructor(){this._headers=[],this._url="",this._method="",this._data={},this._contentType="application/json",this._csrfToken=!1}get headers(){return[...window.APIClient&&window.APIClient.headers?window.APIClient.headers:[],...this._headers]}set headers(t){Array.isArray(t)&&t.every((t=>t.key&&t.value))&&(this._headers=t)}get url(){return this._url}set url(t){this._url=t}get method(){return this._method}set method(t){this._method=t}get data(){return this._data}set data(t){this._data=t}get contentType(){return this._contentType}set contentType(t){this._contentType=t}get csrfToken(){return this._csrfToken}set csrfToken(t){this._csrfToken=t}}class n{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;this._window=t,this._prefix="-styleguide"}set prefix(t){this._prefix=t}get prefix(){return this._prefix}get environmentPrefixesMap(){return{qa:"qa-my",staging:"staging-my",www:"my"}}static get DEFAULT_SILVERBACK_LOCAL_PORT(){return 48e3}_getEnvironmentPrefix(){return this._window.location.origin.includes("qa.")?"qa":this._window.location.origin.includes("staging.")?"staging":this._window.location.origin.includes("www.")?"www":""}_replaceURLToSilverback(t){const e=this._getEnvironmentPrefix();if(this.environmentPrefixesMap[e]&&(t=t.replace(e,this.environmentPrefixesMap[e])),!e){const e=new URL(t);e.port=n.DEFAULT_SILVERBACK_LOCAL_PORT,t=e.toString().slice(0,-1)}return t}getEndpoint(t){var e;let i=this._window.location.origin.replace(this.prefix,"");return null!==(e=this._window.CAUApi)&&void 0!==e&&e.isProxy&&(i=this._replaceURLToSilverback(i)),"".concat(i).concat(t)}}class s{constructor(){this._data={},this._category="page interaction",this._name="",this._ts=""}get category(){return this._category}set category(t){this._category=t}get name(){return this._name}set name(t){this._name=t}get data(){return this._data}set data(t){this._data=t}get ts(){return this._ts}set ts(t){this._ts=t}_isGAEnabled(){return"function"==typeof window.ga}get payload(){return{category:this._category,name:this._name,data:this._data,...this._ts?{ts:this._ts}:{},sd:{ga_enabled:this._isGAEnabled()}}}}const a={CAPTURE_EXCEPTION_EVENT:"com.consumeraffairs.styleguide.logger.captureException",CAPTURE_MESSAGE_EVENT:"com.consumeraffairs.styleguide.logger.captureMessage"};class r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;this._window=t,this._endpointHelper=new n(this._window),this._apiClientModel=new i,this._apiClientModel.csrfToken=!0,this._apiClientModel.url=this._endpointHelper.getEndpoint("/api/uapi/e/"),this._apiClientModel.method="POST",this._apiClient=new e(this._apiClientModel),this._model=new s,this._handleError=this._handleError.bind(this)}_handleError(t){const e="[CAUserDB Tracker]: Error on network request. ".concat(t),i=new CustomEvent(a.CAPTURE_EXCEPTION_EVENT,{detail:{errorMsg:e}});window.dispatchEvent(i)}}class o extends r{static get EVENT_NAME(){return"cta click"}static get EVENT_NAME_ATTR(){return"data-uapi-event-name"}static get EVENT_DATA_ATTR(){return"data-uapi-event"}static get EVENT_BINDED_ATTR(){return"data-uapi-event-binded"}static get EVENT_WRAPPER_DATA_ATTRIBUTE(){return"[".concat(o.EVENT_DATA_ATTR,"]")}static get EVENT_BINDED_DATA_ATTRIBUTE(){return"[".concat(o.EVENT_BINDED_ATTR,"]")}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window),this._window.CAUApiEvent={},this._window.CAUApiEvent.refreshTargets=this._refreshTargets.bind(this),this._bindEvents()}_bindEvents(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._window.document).querySelectorAll("\n            ".concat(o.EVENT_WRAPPER_DATA_ATTRIBUTE,":not(").concat(o.EVENT_BINDED_DATA_ATTRIBUTE,")\n        ")).forEach((t=>{t.setAttribute(o.EVENT_BINDED_ATTR,!0),t.addEventListener("click",this._elementClickHandler.bind(this,t))}))}_elementClickHandler(t){const e=t.getAttribute(o.EVENT_NAME_ATTR);this._model.name=e||o.EVENT_NAME;try{this._model.data=JSON.parse(t.getAttribute(o.EVENT_DATA_ATTR))}catch(t){throw new Error("Not valid JSON",t)}this._apiClientModel.data=this._model.payload,this._apiClient.fetch().catch(this._handleError)}_refreshTargets(t){this._bindEvents(t)}}const _="custom event",d="com.consumeraffairs.uapi";const h="trackedCTALink";class c extends r{static get KEY_TIME_LIMIT(){return 12e4}static get REQUIRED_KEYS(){return["querystring","path","rawPath","elementLabel","clickTimestamp","referer"]}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window);const t=this._window.localStorage.getItem(h);t&&(this._data=this._getParsedLocalStorageData(t),this._data&&(this._validateRequiredKeys(),this._validateEventTimeFrame()))}_validateRequiredKeys(){if(!c.REQUIRED_KEYS.every((