!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.liberty=t():e.liberty=t()}(self,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{commandQueue:()=>St,version:()=>i});const i="29.0.0";class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.queue=e}push(e){this.queue.push(e)}dequeue(){return this.queue.shift()}length(){return this.queue.length}}function r(e){return e.map((e=>Array.isArray(e)?r(e):e)).reduce(((e,t)=>e.concat(t)),[])}async function n(e,t){const i=["interactive","complete"];return new Promise((s=>{function r(){s(void(e&&setTimeout(e)))}e&&"function"!=typeof e&&(t=e,e=null),t=t||window.document,-1!==i.indexOf(t.readyState)?r():t.addEventListener("DOMContentLoaded",r)}))}function o(e,t){return()=>{try{e()}catch(e){t.error(e)}}}function a(e){return"number"==typeof e&&isFinite(e)}function d(e,t){if(!t||0===t.length)return e;const[i,...s]=t;return Object.prototype.hasOwnProperty.call(e,i)?d(e[i],s):void 0}function c(e,t){if(g(e,"array"),g(t,"otherArray"),e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const s=e[i]instanceof Array,r=t[i]instanceof Array;if(s&&r){if(!c(e[i],t[i]))return!1}else if(e[i]!==t[i])return!1}return!0}function l(e){return null!=e}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"property",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!l(e))throw new Error(i||`${t} should be defined`);return e}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"property";if(g(e,t),Boolean(e)!==e)throw new Error(`${t} should be boolean`);return e}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"property",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(g(e,t),"string"!=typeof e)throw new Error(i||`${t} should be string`);if(0===e.length)throw new Error(i||`${t} should not be empty`);return e}var p;!function(e){e.ADSENSE_WEB="adsense_web",e.AFFILIATESHUB_WEB="affiliateshub_web",e.AFSH_WEB="afsh_web",e.DISPLAY_WEB="display_web",e.DISPLAY_WEB_PREBID="display_web_prebid",e.ADBLOCK_CRITEO_WEB="adblock_criteo_web",e.DISPLAY_WEB_AAX="display_web_aax",e.DISPLAY_WEB_TREEBAY="display_web_treebay",e.IGNITE_WEB="ignite_web",e.IGNITE_MWEB="ignite_mweb",e.DISPLAY_WEB_AMAZON="display_web_amazon",e.DISPLAY_WEB_UNIFIED_AUCTION="display_web_unified_auction"}(p||(p={}));const f=p,b=Object.values(p);class y{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.isBackfill=t,this.positionName=i,this.positionId=s,this.adSettingId=e.adSettingId,this.adSettingName=e.adSettingName,this.type=e.type,this.trackingCode=e.trackingCode,this.settings=e.settings,this.fetcherType=this.type,this.isTreebay()&&(this.fetcherType=f.DISPLAY_WEB_TREEBAY)}copy(e){let{settings:t,advertiserType:i}=e;const s={adSettingId:this.adSettingId,adSettingName:this.adSettingName,settings:t||this.settings,trackingCode:this.trackingCode,type:i||this.type};return new y(s,this.isBackfill,this.positionName,this.positionId)}isTreebay(){const e=this.type===f.DISPLAY_WEB,t="treebay"===this.settings.subtype;return e&&t}}class m{constructor(e,t){this._domElement=g(e,"domElement"),this._hiddenClassName=g(t,"hiddenClassName")}setVisibility(e){e?this._domElement.classList.remove(this._hiddenClassName):this._domElement.classList.add(this._hiddenClassName)}}const v=[/^id$/,/^data-liberty-.*$/,/^class$/];class A{constructor(e,t,i){this._positionName=g(e,"positionName"),this._domElement=g(t,"domElement"),this._hiddenClassName=i}setContainerId(e){this._domElement.id=e}setAdLoaded(e){this._domElement.setAttribute("data-liberty-ad-loaded",e)}cleanContainer(){const e=this._domElement.attributes;for(let t=e.length-1;t>=0;t--){const i=e[t].name;!v.some((e=>e.test(i)))&&this._domElement.removeAttribute(i)}}setVisibility(e){new m(this._domElementWithParent(),this._hiddenClassName).setVisibility(e)}_domElementWithParent(){const e=this._domElement.getAttribute("data-liberty-parent-selector");return e?this._getParentElementFor(this._domElement,e):this._domElement}_getParentElementFor(e,t){const i=e.closest(t);if(!i)throw new Error(`Slot ${this._positionName}: No parent element found for "${t}"`);return i}}class _{constructor(e,t){this._advertiser=t,this._metrics=e,this._isMouseIn=!1,this._keyPressedCount=0}startTracking(e){const t=document.getElementById(e);this._setupOnVisibilityChangeEventListerToDetectClicks(),this._setupMouseEnterAndLeaveEventsToEnableVisibilityChangeListener(t)}_setupMouseEnterAndLeaveEventsToEnableVisibilityChangeListener(e){document.addEventListener("keydown",(()=>{this._keyPressedCount+=1})),document.addEventListener("keyup",(()=>{this._keyPressedCount-=1})),e.addEventListener("mouseenter",(()=>{this._isMouseIn=!0})),e.addEventListener("mouseleave",(()=>{this._isMouseIn=!1}))}_setupOnVisibilityChangeEventListerToDetectClicks(){window.document.addEventListener("visibilitychange",(()=>{this._isMouseIn&&document.hidden&&0===this._keyPressedCount&&this._increment()})),window.addEventListener("beforeunload",(()=>{this._isMouseIn&&0===this._keyPressedCount&&this._increment()}))}_increment(){this._metrics.incrementAdvertiserClickMetric(this._advertiser)}}function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function E(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){T(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function T(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class w{static create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new w(e.fetcherRegistry,e.logger,e.slotConfig,e.document,e.adblocking,e.lazy,e.hiddenClassName,e.metrics,e.enableClickTracking)}constructor(e,t,i,s,r,n,o,a,d){this._logger=g(t,"logger"),this.fetcherRegistry=e,this.config=i,this._document=g(s,"document"),this._enableClickTracking=g(d,"enableClickTracking"),this.adblocking=Boolean(r),this.lazy=Boolean(n),this._metrics=g(a,"metrics"),this._hiddenClassName=g(o,"slot.hiddenClassName"),this.trackingCode=g(i.trackingCode,"slot.trackingCode");const c=g(i.positionName,"slot.positionName");this.positionName=c,this.containerId=`liberty-${c}`}isPresentInDom(){return!!this._domElement()}isLazy(){return this.lazy}isRefreshIntervalEnabled(){return this.firstAdvertiser().settings.refreshIntervalEnabled}setupHtmlContainer(){this._getHtmlSlot().setContainerId(this.containerId)}_setupClickTracking(){this._iframeClickTracker=new _(this._metrics,this._filledAdvertiser),this._iframeClickTracker.startTracking(this.containerId)}setAdLoadedAndSetupTracking(e,t){this._filledAdvertiser=t,e&&(this._metrics.incrementAdvertiserFillMetric(t),this._enableClickTracking&&this._setupClickTracking()),this._getHtmlSlot().setAdLoaded(e)}setVisibility(e){this._getHtmlSlot().setVisibility(e)}firstAdvertiser(){return this._getAdvertisers()[0]}async fetchAd(){return await this._fetchAd(this._getAdvertisers())}async fetchBackfills(){const e=this._getAdvertisers(),t=e.slice(1,e.length);return this._getHtmlSlot().cleanContainer(),0===t.length?(this.setAdLoadedAndSetupTracking(!1,void 0),this._logger.debug(`Slot ${this.containerId}: Not filled by ${e[0].type} and no backfill: abort`),{containerId:this.containerId,type:this.firstAdvertiser().type,filled:!1}):(this._logger.debug(`Slot ${this.containerId}: Not filled by ${e[0].type}, fetch backfill...`),await this._fetchAd(t))}_getAdvertisers(){let e="advertisers";return this.adblocking&&this.config.adblockAdvertisers.length>0&&(e="adblockAdvertisers"),this._buildAdvertisers(e)}_buildAdvertisers(e){const t=[],i=this.config[e];for(let e=0;e<i.length;e++){const s=e>0;t.push(new y(E(E({},i[e]),{},{trackingCode:this.trackingCode,settings:E(E({},i[e].settings),{},{container:this.containerId,positionName:this.positionName})}),s,this.config.positionName,this.config.positionId))}return t}async _fetchAd(e){for(const t of e){const e=this.fetcherRegistry[t.fetcherType];this._logger.debug(`Slot ${this.containerId}: Load ${e.advertiserType} ad...`);const{containerId:i,filled:s}=await e.fetchAd(t);if(s)return this.setAdLoadedAndSetupTracking(!0,t),{containerId:i,type:t.type,filled:!0};this.setAdLoadedAndSetupTracking(!1,void 0),this._getHtmlSlot().cleanContainer(),this._logger.debug(`Slot ${this.containerId}: Load next advertiser if present`)}const t=e[e.length-1];return{containerId:this.containerId,type:t.type,filled:!1}}_getHtmlSlot(){return new A(this.positionName,this._domElement(),this._hiddenClassName)}_domElement(){const e=`[data-liberty-position-name="${this.positionName}"]`;return this._document.querySelector(e)}}function C(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function I(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?C(Object(i),!0).forEach((function(t){O(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):C(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function O(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const k={features:{}},P={reportMissingSlot:!0,lazy:!1};class B{constructor(e,t,i,s,r){this._logger=g(e,"logger"),this.config=g(t,"config"),g(i,"options"),this.options=Object.assign({},k,i),this.metrics=g(s,"metrics"),this._adblocking=h(r,"adblocking")}isAdblockerEnabled(){return this._adblocking}isInitialFullConsentGiven(){return this.options.features.tracking.isInitialFullConsentGiven}isFeatureEnabled(e){return!!this.options.features[e]}getPlatform(){return this.config.platform}getPageType(){return this.config.pageType}getGroupName(){return this.config.groupName}getPageLevelSettings(e){const{pageLevelSettings:t}=this.config,i=t.find((t=>t.type===e));return void 0===i?{}:i.settings}buildSlotsByContainerId(e,t){const i={};return this._buildSlots(e,t).forEach((e=>{i[e.containerId]=e})),i}getPrebidOptions(){return this.options.prebid}getMetrics(){return this.metrics}getSlotSize(e){const{maxWidth:t,maxHeight:i}=this._getSlotOptions(e);if(t&&i)return{maxWidth:t,maxHeight:i}}isMissingSlotReportingEnabled(e){return this._getSlotOptions(e).reportMissingSlot}getRefreshIntervalTime(){return this.config.pageLevelSettings.map((e=>e.settings.refreshInterval)).filter((e=>e))[0]}_getSlotOptions(e){const t=(this.options.slots||[]).find((t=>t.positionNameMatcher.test(e)));return I(I({},P),t)}_buildSlots(e,t){const{features:i}=this.options,s=i.visibility.unfilledSlotClassName;return this.config.slots.map((i=>{const r=this._getSlotOptions(i.positionName).lazy;return w.create({fetcherRegistry:e,logger:this._logger,slotConfig:i,document:t,adblocking:this._adblocking,lazy:r,hiddenClassName:s,metrics:this.metrics,enableClickTracking:this.isFeatureEnabled("clickTracking")})}))}}var R;!function(e){e.AD_BLOCKER_ACTIVE="adblockerActive",e.ADVERTISER_REQUESTS="advertiserRequests",e.ADVERTISER_CLICKS="advertiserClicks",e.DONE_TIME="doneTime",e.ERROR="error",e.ADVERTISER_FILLS="advertiserFills",e.DURATION_FROM_FIRST_JS_TO_LIBERTY_INIT="durationFromFirstJsToLibertyInit",e.MISSING_QUERY="missingQuery"}(R||(R={}));const D=R;class L{constructor(e){this.logger=e,this.observers=[],this.advertiserRequests=L.initializeCounterByAdvertiserTypes(),this.missingQuery=L.initializeCounterByAdvertiserTypes(),this.adblockerActive=0,this.advertiserClicks=[],this.advertiserFills=[],this.startTime=void 0,this.endTime=void 0,this.notifyObservers=this.notifyObservers.bind(this)}static initializeCounterByAdvertiserTypes(){return b.reduce(((e,t)=>(e[t]=0,e)),{})}incrementAdvertiserRequestMetric(e){this.validate(e.type),this.advertiserRequests[e.type]+=1,this.notifyObservers({type:D.ADVERTISER_REQUESTS,value:this.buildAdvertiserData(e)})}incrementErrorMetric(e){this.notifyObservers({type:D.ERROR,value:e})}incrementMissingQuery(e){this.validate(e),this.missingQuery[e]+=1,this.notifyObservers({type:D.MISSING_QUERY,value:{advertiserType:e}})}incrementAdvertiserFillMetric(e){const t=this.buildAdvertiserData(e);this.advertiserFills.push(t),this.notifyObservers({type:D.ADVERTISER_FILLS,value:t})}getAdvertiserFills(){return this.advertiserFills}incrementAdvertiserClickMetric(e){const t=this.buildAdvertiserData(e);this.advertiserClicks.push(t),this.notifyObservers({type:D.ADVERTISER_CLICKS,value:t})}recordExecutionStart(e){this.startTime=(new Date).getTime(),this.notifyObservers({type:D.DURATION_FROM_FIRST_JS_TO_LIBERTY_INIT,value:this.startTime-e})}getStartTime(){return this.startTime}recordExecutionEnd(){this.endTime=(new Date).getTime(),void 0!==this.startTime&&this.notifyObservers({type:D.DONE_TIME,value:this.endTime-this.startTime})}getAdvertiserClicks(){return this.advertiserClicks}setAdblockerActive(){this.adblockerActive=1,this.notifyObservers({type:D.AD_BLOCKER_ACTIVE,value:1})}setAdblockerInactive(){this.adblockerActive=0,this.notifyObservers({type:D.AD_BLOCKER_ACTIVE,value:0})}getAdblockerActiveMetric(){return this.adblockerActive}getAdvertiserRequestsMetrics(){return this.advertiserRequests}getMissingQueryMetrics(){return this.missingQuery}onChange(e){this.observers.push(e)}buildAdvertiserData(e){return{adSettingId:e.adSettingId,adSettingName:e.adSettingName,adTypeName:e.type,positionName:e.positionName,positionId:e.positionId,positionTrackingCode:e.trackingCode,isBackfill:e.isBackfill}}notifyObservers(e){this.logger.debug("Publish event",e),this.observers.forEach((t=>{t(e)}))}validate(e){if(void 0===this.advertiserRequests[e])throw new Error(`Unknown advertiser type '${e}'. Pick one of: ${b}`)}}class j{constructor(e,t,i){this._logger=g(t,"logger"),this.fetcher=e,this.slotsByContainerId=i}selectAndFetchPrimarySlots(e){const t=this.selectPrimarySlots(e);return this.fetchPrimarySlots(t)}selectPrimarySlots(e){const t=e.filter((e=>e.isLazy()));return t.length>0&&this._logger.debug(`Ignoring ${t.length} lazy slot(s). Use liberty.loadLazySlot to load them.`),e.filter((e=>!e.isLazy())).filter((e=>e.firstAdvertiser().fetcherType===this.fetcher.advertiserType))}fetchPrimarySlots(e){const t=e.map((e=>e.firstAdvertiser()));this._logger.debug(`Load ${e.length} primary ${this.fetcher.advertiserType} slots`,e.map((e=>e.containerId)));let i=[];try{i=this.fetcher.fetchAds(t)}catch(e){this._logger.error(new Error(`Fetching ads failed for ${this.fetcher.advertiserType}: ${e.message}`))}return i.map((async e=>{const{containerId:t,filled:i,advertiser:s}=await e;return i?(this._logger.debug(`Slot ${t}: Load ${this.fetcher.advertiserType}...`),this._getSlot(t).setAdLoadedAndSetupTracking(!0,s),{containerId:t,type:this.fetcher.advertiserType,filled:!0}):await this._getSlot(t).fetchBackfills()}))}_getSlot(e){return this.slotsByContainerId[e]}}class F{constructor(e,t){this._window=e,this._logger=g(t,"logger")}start(e,t){g(e,"refreshInterval"),g(t,"executionFunction"),this._logger.debug(`Start refresh interval of ${e}ms...`),this._window.setInterval((()=>{t()}),e)}}class N{constructor(e,t,i,s){this.store=t,this.fetcherRegistry=i,this.document=s,this._intervalLoader=new F(window,e),this.slotsByContainerId=this.store.buildSlotsByContainerId(this.fetcherRegistry,this.document),this._logger=g(e,"logger"),this.slots=Object.values(this.slotsByContainerId)}async fillSlotsWithAds(){const e=this.store.getRefreshIntervalTime();return e&&this._setupIntervalRefreshment(e),await this._fill(this.slots)}async fillSlotsWithAdsFilteredBy(e){const t=this._getFilteredSlotsByPositionNames(e);return await this._fill(t)}async fillLazySlotWithAds(e){await n();const t=`liberty-${e}`,i=this._getSlot(t);if(i){if(!i.isPresentInDom())throw new Error(`Slot '${t}' not found in DOM.`);if(!i.isLazy())throw new Error(`Slot '${t}' needs to be marked as lazy in options.slots`);return i.setupHtmlContainer(),await this._handleFetch(i.fetchAd())}}_setupIntervalRefreshment(e){const t=this.slots.filter((e=>e.isRefreshIntervalEnabled())).map((e=>e.positionName));this._intervalLoader.start(e,(()=>{const e=this._getFilteredSlotsByPositionNames(t).filter((e=>e.isPresentInDom()));this._fill(e)}))}async _fill(e){await n();const t=e.filter((e=>e.isPresentInDom())),i=e.filter((e=>!e.isPresentInDom()));return t.forEach((e=>e.setupHtmlContainer())),[...this._rejectMissingSlots(i),...this._primaryFetch(t)]}_primaryFetch(e){const t=[];return Object.values(this.fetcherRegistry).forEach((i=>{t.push(...this._fetchPrimarySlots(i,e))})),t.map((e=>this._handleFetch(e)))}_getFilteredSlotsByPositionNames(e){return this.slots.filter((t=>e.includes(t.positionName)))}_fetchPrimarySlots(e,t){return new j(e,this._logger,this.slotsByContainerId).selectAndFetchPrimarySlots(t)}async _handleFetch(e){const{containerId:t,type:i,filled:s}=await e;return g(t,"fetch.containerId"),g(i,"fetch.type"),g(s,"fetch.filled"),this._logger.debug(`Slot ${t}: ${s?"Filled":"Not filled"} with ${i}`),this._getSlot(t).setVisibility(s),{containerId:t,type:i,filled:s}}_getSlot(e){return this.slotsByContainerId[e]}_rejectMissingSlots(e){return e.map((async e=>{const t=e.containerId;if(this.store.isMissingSlotReportingEnabled(e.positionName))throw new Error(`Slot ${e.containerId} is not present in DOM.`);return{containerId:t,filled:!1,advertiserType:void 0}}))}}class x{constructor(e){this._advertisers=e,this._promisesByContainerId=this._initializePromisesByContainerId(e)}containsContainerId(e){return Object.keys(this._promisesByContainerId).includes(e)}getCurrentAdvertiser(e){if(!this.containsContainerId(e))throw new Error(`No advertiser found for container id: ${e}`);return this._advertisers.find((t=>t.settings.container===e))}markContainerAs(e,t){this._promisesByContainerId[e].resolve({containerId:e,advertiser:this.getCurrentAdvertiser(e),filled:t})}markAllContainersAs(e,t){e.forEach((e=>{this.markContainerAs(e,t)}))}reject(e){this._promisesByContainerId[e].reject({containerId:e,advertiser:this.getCurrentAdvertiser(e),filled:!1})}abortAll(){this._advertisers.forEach((e=>{this.markContainerAs(e.settings.container,!1)}))}getPromises(){return Object.values(this._promisesByContainerId).map((e=>e.promise))}_initializePromisesByContainerId(e){const t={};return e.forEach((e=>{let i=null,s=null;const r=new Promise(((e,t)=>{i=e,s=t}));t[e.settings.container]={promise:r,resolve:i,reject:s}})),t}}class M{constructor(e,t){this.store=e,this.advertiserType=t}incrementAdvertiserRequestMetric(e){this.store.getMetrics().incrementAdvertiserRequestMetric(e)}async fetchAd(e){return await this.fetchAds([e])[0]}fetchAds(e){if(!Array.isArray(e)||0===e.length)return[];const t=new x(e);return this._fetch(e,t),e.forEach((e=>this.incrementAdvertiserRequestMetric(e))),t.getPromises()}_fetch(e,t){throw new Error("Not implemented")}}var z;function U(e){return Object.values(z).map((e=>String(e))).includes(e)}!function(e){e.TREEBAY="treebay",e.PRO_SELLER="pro_seller",e.EPN="epn",e.DMH="dmh"}(z||(z={}));const W=z;class ${constructor(e,t,i){this.window=e,this.logger=t,this.windowMessageDecoder=i}needsIframeMessage(e){return this.isAdvertiserOfValidSubtype(e)}isAdvertiserOfValidSubtype(e){return U(e.settings.subtype)}resolveMessageStatus(e,t){return this.logger.debug(`[DfpMessageReceiver] Slot ${e}: Waiting for postMessage event because of subtype ${t}...`),new Promise((t=>{this.window.addEventListener("message",(i=>{if(this.isSubtypeEvent(i,e)){this.logger.debug(`[DfpMessageReceiver] Slot ${e}: Got postMessage event:`,i);const s=this.isLoaded(i);t({containerId:e,filled:s})}}),!1)}))}isSubtypeEvent(e,t){if("liberty.ad.loaded"!==e.data.event)return!1;let i={};try{i=this.windowMessageDecoder.decodeMessage(e.data.info)}catch(t){return this.logger.error(new Error(`[DfpMessageReceiver] Invalid info string: '${e.data.info}' Error: ${t} Fetching backfill...`)),!1}const s=i.containerId===t,r=U(i.subtype);return s&&r}isLoaded(e){return"success"===this.windowMessageDecoder.decodeMessage(e.data.info).status}}class G{generateUuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}class H{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.googletag=e,this.logger=t,this.definedSlots=i,this.modifySlotExtensions=s}defineSlotIfUndefined(e){const{code:t,sizes:i}=e.settings,{trackingCode:s}=e,r=H.getContainerId(e);this.pushGoogleTagCmd((()=>{if(this.definedSlots.isUndefined(r)){const n=this.googletag.defineSlot(t,i,r);if(null===n)throw new Error("Slot should not be null");n.addService(this.getPubService()),this.modifySlotExtensions.forEach((t=>t.modifySlot(n,e))),n.setTargeting("pos",s),n.setTargeting("containerId",r),this.definedSlots.push(r,n,i,!1)}}))}loadAdblocks(e){this.displayOrRedefineSlots(e),this.refreshSlots(e)}displayOrRedefineSlots(e){e.forEach((e=>{this.displayOrRedefineSlot(e)}))}displayOrRedefineSlot(e){this.pushGoogleTagCmd((()=>{const t=H.getContainerId(e);this.definedSlots.isDisplayed(t)||this.display(t),this.shouldBeRedefined(e)&&(this.redefineSlot(e),this.display(t))}))}shouldBeRedefined(e){const{code:t,sizes:i}=e.settings,s=H.getContainerId(e),r=this.getDefinedSlot(s).getAdUnitPath(),n=this.definedSlots.getSizes(s);return r!==t||!c(n,i)}redefineSlot(e){const t=H.getContainerId(e);this.debug(t,"Destroy and define slot..."),this.googletag.destroySlots([this.getDefinedSlot(t)]),this.definedSlots.remove(t),this.defineSlotIfUndefined(e)}refreshSlots(e){const t=e.map((e=>H.getContainerId(e)));this.pushGoogleTagCmd((()=>{this.logger.debug("Batched load:",t);const e=t.map((e=>this.definedSlots.getSlot(e)));e.forEach((e=>H.prepareSlotForDfp(e))),this.getPubService().refresh(e)}))}display(e){this.debug(e,"Display..."),this.googletag.display(e),this.definedSlots.markAsDisplayed(e)}static prepareSlotForDfp(e){H.setImpressionId(e)}getDefinedSlot(e){return this.definedSlots.getSlot(e)}static setImpressionId(e){e.setTargeting("imp_id",(new G).generateUuid())}static getContainerId(e){return e.settings.container}pushGoogleTagCmd(e){this.googletag.cmd.push(o(e,this.logger))}getPubService(){return this.googletag.pubads()}