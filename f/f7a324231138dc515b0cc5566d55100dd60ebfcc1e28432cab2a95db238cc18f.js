"use strict";var powerbi,__extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(e,t){for(var r=0,i=t.length,a=e.length;r<i;r++,a++)e[a]=t[r];return e},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__decorate=this&&this.__decorate||function(e,t,r,i){var a,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;0<=s;s--)(a=e[s])&&(o=(n<3?a(o):3<n?a(t,r,o):a(t,r))||o);return 3<n&&o&&Object.defineProperty(t,r,o),o},__awaiter=this&&this.__awaiter||function(e,o,s,u){return new(s=s||Promise)(function(r,t){function i(e){try{n(u.next(e))}catch(e){t(e)}}function a(e){try{n(u.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,a)}n((u=u.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(r,i){var a,n,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(o=2&t[0]?n.return:t[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,t[1])).done)return o;switch(n=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,n=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(r,s)}catch(e){t=[6,e],n=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};!function(a){!function(t){var e=jsCommon.Utility,r=a.telemetryEventFactory,i=a.telemetry.EventFactories;e?e.generateGuid:Function.prototype;t.DataQueryDataEventName="PBI.Data.QueryData",t.DataQueryData=i[t.DataQueryDataEventName]=function(e){return r({name:t.DataQueryDataEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,optionalParameters:["requestId","synchronous","fromCache","resultCount"],loggers:t.DataQueryDataLoggers})},t.DataQueryCancellationEventName="PBI.Data.QueryCancellation",t.DataQueryCancellation=i[t.DataQueryCancellationEventName]=function(e){return r({name:t.DataQueryCancellationEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,loggers:t.DataQueryCancellationLoggers,logRatio:1e-4})},t.DataClientCacheHitEventName="PBI.Data.ClientCacheHit",t.DataClientCacheHit=i[t.DataClientCacheHitEventName]=function(e){return r({name:t.DataClientCacheHitEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,loggers:t.DataClientCacheHitLoggers,logRatio:1e-4})},t.DataGetConceptualSchemaEventName="PBI.Data.GetConceptualSchema",t.DataGetConceptualSchema=i[t.DataGetConceptualSchemaEventName]=function(e){return r({name:t.DataGetConceptualSchemaEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,optionalParameters:["requestId"],loggers:t.DataGetConceptualSchemaLoggers})},t.DataClearConceptualSchemaCacheEventName="PBI.Data.ClearConceptualSchemaCache",t.DataClearConceptualSchemaCache=i[t.DataClearConceptualSchemaCacheEventName]=function(e){return r({name:t.DataClearConceptualSchemaCacheEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,loggers:t.DataClearConceptualSchemaCacheLoggers})},t.DataExecuteQueryEventName="PBI.Data.ExecuteQuery",t.DataExecuteQuery=i[t.DataExecuteQueryEventName]=function(e){return r({name:t.DataExecuteQueryEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,optionalParameters:["requestId"],loggers:t.DataExecuteQueryLoggers})},t.DataDsrToDataViewEventName="PBI.Data.DsrToDataView",t.DataDsrToDataView=i[t.DataDsrToDataViewEventName]=function(e){return r({name:t.DataDsrToDataViewEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,optionalParameters:["jsonparse","categorical","table","tree","matrix","single","script"],loggers:t.DataDsrToDataViewLoggers,logRatio:1e-4})},t.DataSampledDataViewKindAccessEventName="PBI.Data.SampledDataViewKindAccess",t.DataSampledDataViewKindAccess=i[t.DataSampledDataViewKindAccessEventName]=function(e){return r({name:t.DataSampledDataViewKindAccessEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,loggers:t.DataSampledDataViewKindAccessLoggers,logRatio:1e-4})},t.DataDataViewKindAccessEventName="PBI.Data.DataViewKindAccess",t.DataDataViewKindAccess=i[t.DataDataViewKindAccessEventName]=function(e){return r({name:t.DataDataViewKindAccessEventName,baseEvent:t.Verbose(e),info:e,category:a.TelemetryCategory.Verbose,loggers:t.DataDataViewKindAccessLoggers})}}(a.telemetry||(a.telemetry={}))}(powerbi=powerbi||{}),function(e){!function(e){var u;function t(e,t,r,i,a,n,o,s){this.proxy=new u.ExecuteSemanticQueryProxy(e,t,a,r,n,o,i,s),this.featureSwitches=i,this.telemetryService=r}u=e.dsr||(e.dsr={}),t.prototype.execute=function(e){return this.proxy.execute(e)},t.prototype.transform=function(e,t,r,i){return void 0===e?{dataView:{metadata:{columns:[]},error:{code:"UndefinedData"}}}:u.read(t,e,this.featureSwitches,this.telemetryService,r,i)},t.prototype.stopCommunication=function(){this.proxy.stopCommunication()},t.prototype.resumeCommunication=function(){this.proxy.resumeCommunication()},Object.defineProperty(t.prototype,"cache",{get:function(){return this.proxy.cache()},enumerable:!1,configurable:!0}),t.prototype.setLocalCacheResult=function(e,t){this.proxy.setLocalCacheResult(e,t)},t.prototype.setPreferredMaxConnections=function(e){this.proxy.setPreferredMaxConnections(e)},u.DsrDataReader=t}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(a){!function(e){var i;function t(e,t,r){r=r||{},this.promiseFactory=e.promiseFactory(),this.client=r.client||new i.BingSocialClient(t),this.tileRequestDataFactory=r.tileRequestDataFactory||new i.TileRequestDataFactory}i=e.bingSocial||(e.bingSocial={}),t.prototype.execute=function(e){var t=e.command,r=t.searchKey,e=t.queryType;if(!r||!e)return null;t=this.promiseFactory.defer(),e=this.tileRequestDataFactory.getTileRequestData(e);return e?this.client.requestData(t,r,e):t.reject(),a.createRejectablePromise2(t)},t.prototype.transform=function(e){return{dataView:e}},i.BingSocialDataReader=t}(a.data||(a.data={}))}(powerbi=powerbi||{}),function(c){var o,e;function l(t,e,r,i,a){var n={};n[r]=!0;n={displayName:t,queryName:t,index:e,isMeasure:!i,type:i||c.ValueType.fromDescriptor({numeric:!0}),roles:n};return n=a?c.Prototype.inherit(n,function(e){return e.objects={dataPoint:{fill:{solid:{color:a[t]}}}}}):n}function p(e,t){for(var r=0,i=t.split(".");r<i.length;r++){var a=i[r];if(!(null!=e&&a in e))return null;e=e[a]}return e}o=c.data||(c.data={}),(e=(e=o.bingSocial||(o.bingSocial={})).ChartDataViewConstructorUtils||(e.ChartDataViewConstructorUtils={})).createMetadataColumn=l,e.getFieldFromString=p,e.createDataView=function(e,t,r,i,a){void 0===(a=a||{}).percentize&&(a.percentize=!0);var n=o.SQExprBuilder.columnRef(o.SQExprBuilder.entity(null,"table"),"Column");return(a=o.createCategoricalDataViewBuilder().withCategory(function(e,t,r,i,a){for(var n=[],o=0,s=e;o<s.length;o++){var u=p(s[o],r);a&&!(u="function"==typeof a?a(u):a[u])||n.push(u)}return{source:l(_.last(r.split(".")),0,i,c.ValueType.fromDescriptor({text:!0})),identityFrom:{fields:[t]},values:n}}(e,n,t,r,a.mapping)).withValues(function(e,t,r){var i=_.map(e,function(e){return e.Count}),e=l("Count",1,t);r.percentize&&(i=function(e,t){return t.objects=t.objects||{},t.objects.general={formatString:"0%"},function(e){var t=e.reduce(function(e,t){return e+t},0);return e.map(function(e){return e/t})}(e)}(i,e));t=_.min(i),r=_.max(i);return e.aggregates={min:t,max:r},{columns:[{source:e,values:i}]}}(e,i,a)).build()).metadata.objects={labels:{show:!0},categoryLabels:{show:!0}},a}}(powerbi=powerbi||{}),function(d){!function(c){var l;function p(){}l=c.bingSocial||(c.bingSocial={}),p.prototype.formatResponse=function(e){for(var e=e[0].value,t=0,r=e;t<r.length;t++){var i=r[t];i.source="Bing",i.CreatedAt=l.ChartDataViewConstructorUtils.getFieldFromString(i,"Request.RequestTime")}e=this.getCountsPerTime(e,"source");return this.createLineChartDataView(["Bing"],e,{Bing:"#FFB900"})},p.prototype.getCountsPerTime=function(e,t,r){for(var i={},a=0,n=e;a<n.length;a++){var o=n[a],s=o.CreatedAt,u=l.ChartDataViewConstructorUtils.getFieldFromString(o,t);r&&!(u=r[u])||(i[s]=i[s]||{},i[s][u]=o.Count)}return i},p.prototype.createLineChartDataView=function(e,t,r){var i=Object.keys(t),a=p.sortDateStrings(i),n=a.map(function(e){return new Date(e)}),o={},s={},u={},i={};p.getTableData(a,e,t,o,s,u,i);n={source:{queryName:"CreatedAt",displayName:"CreatedAt",type:d.ValueType.fromDescriptor({dateTime:!0}),index:0},values:n},r=this.createMetadataColumns(e,r);return{metadata:{columns:r},categorical:{values:c.DataViewTransform.createValueColumns(this.createValueColumns(e,r,o,s,u,i)),categories:[n]}}},p.getTableData=function(e,t,r,i,a,n,o){for(var s=0,u=t;s<u.length;s++)i[m=u[s]]=[],o[m]=0;for(var c=0,l=e;c<l.length;c++)for(var p=l[c],d=0,h=t;d<h.length;d++){var m=h[d],f=r[p][m]||0;i[m].push(f),a[m]=a[m]?Math.max(a[m],f):f,n[m]=n[m]?Math.min(n[m],f):f,o[m]+=f}},p.prototype.createMetadataColumns=function(e,t){for(var r=[l.ChartDataViewConstructorUtils.createMetadataColumn("CreatedAt",0,"Category",d.ValueType.fromDescriptor({text:!0}))],i=0;i<e.length;i++){var a=e[i],a=l.ChartDataViewConstructorUtils.createMetadataColumn(a,i+1,"Y",null,t);r.push(a)}return r},p.prototype.createValueColumns=function(e,t,r,i,a,n){for(var o=[],s=0;s<e.length;s++){var u=e[s];o.push(p.createValueColumn(r[u],a[u],i[u],n[u],t[s+1]))}return o},p.createValueColumn=function(e,t,r,i,a){return{source:a,values:e,min:t,max:r,subtotal:i}},p.sortDateStrings=function(e){return e.sort(function(e,t){return new Date(e).getTime()-new Date(t).getTime()})},l.ActivityChartResponseFormatter=p}(d.data||(d.data={}))}(powerbi=powerbi||{}),function(r){!function(e){function t(){}e=e.bingSocial||(e.bingSocial={}),t.prototype.formatResponse=function(e){var t=parseInt(e[0],10),r=parseInt(e[1],10);if(0===r){e=this.getMetadata("N/A");return{single:{value:0,column:e.columns[0]},metadata:e}}t=(t-r)/r,r=this.getMetadata("+0.0%;-0.0%");return{single:{value:t,column:r.columns[0]},metadata:r}},t.prototype.getMetadata=function(e){return{columns:[{displayName:"Count Change",isMeasure:!0,type:r.ValueType.fromDescriptor({numeric:!0}),objects:{general:{formatString:e}}}]}},e.CountChangeResponseFormatter=t}(r.data||(r.data={}))}(powerbi=powerbi||{}),function(r){!function(e){function t(){}e=e.bingSocial||(e.bingSocial={}),t.prototype.formatResponse=function(e){var t={displayName:"Count",isMeasure:!0,type:r.ValueType.fromDescriptor({integer:!0})};return{single:{value:e[0],column:t},metadata:{columns:[t]}}},e.CountResponseFormatter=t}(r.data||(r.data={}))}(powerbi=powerbi||{}),function(e){!function(e){function t(){}e=e.bingSocial||(e.bingSocial={}),t.prototype.formatResponse=function(e){return{metadata:{columns:[]},bingSocial:e[0].value}},e.RawDataResponseFormatter=t}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){!function(e){function t(){}e=e.bingSocial||(e.bingSocial={}),t.prototype.formatResponse=function(e){return{metadata:{columns:[]},bingSocial:e[0].value}},e.BingNewsResponseFormatter=t}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(s){!function(n){var o;function e(e,t){this.fieldName=e,this.options=t||{}}o=n.bingSocial||(n.bingSocial={}),e.prototype.formatResponse=function(e){var t=e[0].value;if(this.options.logarithmic)for(var r=0,i=t;r<i.length;r++){var a=i[r];a.Count=Math.log(a.Count)}e=o.ChartDataViewConstructorUtils.createDataView(t,this.fieldName,"Category","Y",{mapping:this.options.mapping,percentize:!1});e.metadata.columns[0].type=s.ValueType.fromDescriptor({geography:{country:!0}});t={selects:[{type:s.ValueType.fromDescriptor({text:!0}),roles:{Category:!0}},{type:s.ValueType.fromDescriptor({numeric:!0}),roles:{Y:!0,Gradient:!0}}],objects:{dataPoint:[{properties:{fillRule:{linearGradient2:{min:{color:n.SQExprBuilder.text("#FFF0CC")},max:{color:n.SQExprBuilder.text("#FFB600")}}}}}]}};return n.DataViewTransform.apply({prototype:e,objectDescriptors:{dataPoint:{properties:{fill:{type:{fill:{solid:{color:!0}}}},fillRule:{type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},transforms:t,colorAllocatorFactory:window.powerbi.visuals.createColorAllocatorFactory(),dataViewMappings:window.powerbi.visuals.getTreemapCapabilities().dataViewMappings,dataRoles:null,visualStyle:s.visuals.visualStyles.create(),featureSwitches:{}}).dataViews[0]},o.MapResponseFormatter=e}(s.data||(s.data={}))}(powerbi=powerbi||{}),function(e){!function(e){var t;function r(e,t){this.fieldName=e,this.options=t||{}}t=e.bingSocial||(e.bingSocial={}),r.prototype.formatResponse=function(e){e=e[0].value;return t.ChartDataViewConstructorUtils.createDataView(e,this.fieldName,"Group","Values",this.options)},t.TreeMapResponseFormatter=r}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){!function(e){function t(e,t){this.urlTemplates=e,this.responseFormatter=t}e=e.bingSocial||(e.bingSocial={}),t.prototype.getUrlTemplates=function(){return this.urlTemplates},t.prototype.getResponseFormatter=function(){return this.responseFormatter},e.TileRequestData=t}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){!function(e){function a(){}e=e.bingSocial||(e.bingSocial={}),a.prototype.getTileRequestData=function(e){return a.tileRequestData[e]},a.createUrl=function(e,t){return"powerbi/providers/bingsocial/?source={{source}}&type={{type}}&searchKey={{searchKey}}&newsApiVersion={{newsApiVersion}}".replace(/{{source}}/g,e).replace(/{{type}}/g,t).replace(/{{newsApiVersion}}/g,"v6")},a.languageMapping={aa:"Afar",af:"Afrikaans",agq:"Aghem",ak:"Akan",sq:"Albanian",gsw:"Alsatian",am:"Amharic",ar:"Arabic",hy:"Armenian",as:"Assamese",ast:"Asturian",asa:"Asu","az-Cyrl":"Azerbaijani (Cyrillic)","az-Latn":"Azerbaijani (Latin)",ksf:"Bafia","bm-Latn":"Bamanankan (Latin)",bn:"Bangla",bas:"Basaa",ba:"Bashkir",eu:"Basque",be:"Belarusian",bem:"Bemba",bez:"Bena",byn:"Blin",brx:"Bodo","bs-Cyrl":"Bosnian (Cyrillic)","bs-Latn":"Bosnian (Latin)",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan","tzm-Arab":"Central Atlas Tamazight (Arabic)","tzm-Latn":"Central Atlas Tamazight (Latin)","tzm-Tfng":"Central Atlas Tamazight (Tifinagh)","ku-Arab":"Central Kurdish","chr-Cher":"Cherokee (Cherokee)",cgg:"Chiga","zh-Hans":"Chinese (Simplified)","zh-Hant":"Chinese (Traditional)",swc:"Congo Swahili",kw:"Cornish",co:"Corsican",hr:"Croatian",cs:"Czech",da:"Danish",prs:"Dari",dv:"Divehi",dua:"Duala",nl:"Dutch",dz:"Dzongkha",bin:"Edo",ebu:"Embu",en:"English",eo:"Esperanto",et:"Estonian",ee:"Ewe",ewo:"Ewondo",fo:"Faroese",fil:"Filipino",fi:"Finnish",fr:"French",fur:"Friulian","ff-Latn":"Fulah",gl:"Galician",lg:"Ganda",ka:"Georgian",de:"German",el:"Greek",kl:"Greenlandic",gn:"Guarani",gu:"Gujarati",guz:"Gusii",ht:"Haitian","ha-Latn":"Hausa (Latin)",haw:"Hawaiian",he:"Hebrew",hi:"Hindi",mww:"Hmong Daw",hu:"Hungarian",is:"Icelandic",ig:"Igbo",smn:"Inari Sami",id:"Indonesian",ia:"Interlingua","iu-Cans":"Inuktitut (Canadian Aboriginal Syllabics)","iu-Latn":"Inuktitut (Latin)",iv:"Invariant Language",ga:"Irish",xh:"isiXhosa",zu:"isiZulu",it:"Italian",ja:"Japanese","jv-Latn":"Javanese (Latin)",dyo:"Jola-Fonyi",quc:"K'iche'",kea:"Kabuverdianu",kab:"Kabyle",kkj:"Kako",kln:"Kalenjin",kam:"Kamba",kn:"Kannada",kr:"Kanuri","ks-Deva":"Kashmiri (Devanagari)","ks-Arab":"Kashmiri (Perso-Arabic)",kk:"Kazakh",km:"Khmer",ki:"Kikuyu",rw:"Kinyarwanda",sw:"Kiswahili",kok:"Konkani",ko:"Korean",khq:"Koyra Chiini",ses:"Koyraboro Senni",nmg:"Kwasio",ky:"Kyrgyz",lkt:"Lakota",lag:"Langi",lo:"Lao",lv:"Latvian",ln:"Lingala",lt:"Lithuanian",dsb:"Lower Sorbian",lu:"Luba-Katanga",smj:"Lule Sami",luo:"Luo",lb:"Luxembourgish",luy:"Luyia",mk:"Macedonian",jmc:"Machame",mgh:"Makhuwa-Meetto",kde:"Makonde",mg:"Malagasy",ms:"Malay (Latin)",ml:"Malayalam",mt:"Maltese",mni:"Manipuri",gv:"Manx",mi:"Maori",arn:"Mapudungun",mr:"Marathi",mas:"Masai",mer:"Meru",mgo:"Meta'",moh:"Mohawk","mn-Cyrl":"Mongolian (Cyrillic)","mn-Mong":"Mongolian (Traditional Mongolian)",mfe:"Morisyen",mua:"Mundang",nqo:"N'Ko",naq:"Nama",ne:"Nepali",nnh:"Ngiemboon",jgo:"Ngomba",nd:"North Ndebele",kmr:"Northern Kurdish",se:"Northern Sami",nb:"Norwegian Bokmål",nn:"Norwegian Nynorsk",nus:"Nuer",nyn:"Nyankole",oc:"Occitan",or:"Odia",om:"Oromo","os-Cyrl":"Ossetian (Cyrillic)",pap:"Papiamento",ps:"Pashto",fa:"Persian",pl:"Polish",pt:"Portuguese","pa-Arab":"Punjabi (Arabic)","pa-Guru":"Punjabi (Gurmukhi)",quz:"Quechua",otq:"Querétaro Otomi",ksh:"Ripuarian",ro:"Romanian",rm:"Romansh",rof:"Rombo",rn:"Rundi",ru:"Russian",rwk:"Rwa",ssy:"Saho",sah:"Sakha",saq:"Samburu",sg:"Sango",sbp:"Sangu",sa:"Sanskrit",gd:"Scottish Gaelic",seh:"Sena","sr-Cyrl":"Serbian (Cyrillic)","sr-Latn":"Serbian (Latin)",st:"Sesotho",nso:"Sesotho sa Leboa",tn:"Setswana",ksb:"Shambala",sn:"Shona","sd-Arab":"Sindhi (Arabic)","sd-Deva":"Sindhi (Devanagari)",si:"Sinhala",ss:"siSwati",sms:"Skolt Sami",sk:"Slovak",sl:"Slovenian",xog:"Soga",so:"Somali",nr:"South Ndebele",sma:"Southern Sami",es:"Spanish","zgh-Tfng":"Standard Moroccan Tamazight (Tifinagh)",sv:"Swedish",syr:"Syriac","shi-Latn":"Tachelhit (Latin)","shi-Tfng":"Tachelhit (Tifinagh)",dav:"Taita","tg-Cyrl":"Tajik (Cyrillic)",ta:"Tamil",twq:"Tasawaq","tt-Cyrl":"Tatar (Cyrillic)",te:"Telugu",teo:"Teso",th:"Thai",bo:"Tibetan",tig:"Tigre",ti:"Tigrinya",to:"Tongan",tr:"Turkish","tk-Latn":"Turkmen (Latin)",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu","ug-Arab":"Uyghur (Arabic)","uz-Cyrl":"Uzbek (Cyrillic)","uz-Latn":"Uzbek (Latin)","uz-Arab":"Uzbek (Perso-Arabic)","vai-Latn":"Vai (Latin)","vai-Vaii":"Vai (Vai)","ca-ES-valencia":"Valencian",ve:"Venda",vi:"Vietnamese",vo:"Volapük",vun:"Vunjo",wae:"Walser",cy:"Welsh",fy:"Western Frisian",wal:"Wolaytta",wo:"Wolof",ts:"Xitsonga",yav:"Yangben",ii:"Yi",yi:"Yiddish",yo:"Yoruba",yua:"Yucatec Maya",dje:"Zarma",az:"Azerbaijani",bm:"Bamanankan",bs:"Bosnian",tzm:"Central Atlas Tamazight",chr:"Cherokee",zh:"Chinese",ha:"Hausa",iu:"Inuktitut",jv:"Javanese",ks:"Kashmiri",mn:"Mongolian",os:"Ossetian",pa:"Punjabi",sr:"Serbian",sd:"Sindhi",zgh:"Standard Moroccan Tamazight",shi:"Tachelhit",tg:"Tajik",tt:"Tatar",tk:"Turkmen",ug:"Uyghur",uz:"Uzbek",vai:"Vai"},a.languageOptions={mapping:function(e){if("string"==typeof e&&e){for(var t,r=e;r;){if(r in a.languageMapping){t=a.languageMapping[r];break}var i=Math.max(r.lastIndexOf("-"),0),r=r.substring(0,i)}return t||e}}},a.tileRequestData={bingVolume:new e.TileRequestData([a.createUrl("Bing","Volume")],new e.CountResponseFormatter),bingVolumeChange:new e.TileRequestData([a.createUrl("Bing","Volume"),a.createUrl("Bing","VolumeChange")],new e.CountChangeResponseFormatter),activity:new e.TileRequestData([a.createUrl("Bing","Activity")],new e.ActivityChartResponseFormatter),languages:new e.TileRequestData([a.createUrl("Bing","Language")],new e.TreeMapResponseFormatter("Query._Microsoft.Language",a.languageOptions)),news:new e.TileRequestData([a.createUrl("Bing","News")],new e.BingNewsResponseFormatter),location:new e.TileRequestData([a.createUrl("Bing","Location")],new e.MapResponseFormatter("User.Country",{logarithmic:!0}))},e.TileRequestDataFactory=a}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){!function(u){u.createDataReaderFactory=function(e,t){return new r(e,t)};var r=(e.prototype.getPlugin=function(e){return this.plugins[a(e)]},e.prototype.getExtension=function(e){return this.extensions[e]},e);function e(e,r){if(r)for(var t in r)!function(t){_.find(e,function(e){return e.name===r[t].extends}),r[t].extends,_.some(e,function(e){return e.name===r[t].name})}(t);this.plugins=e,this.extensions=r||{}}function a(e){return e||"dsr"}!function(e){function o(e){return a(e.type)}function r(e){if(e){var t=[];return new i(t).run(e),t}}function s(e,t){for(var r=[],i=0,a=e;i<a.length;i++){var n=a[i];(_.isEmpty(t)||_.includes(t,n.name))&&(n=o(n),_.includes(r,n)||r.push(n))}return r}e.findTypes=function(e,t){return s(e,r(t))},e.findTypesFromExprs=function(e,t){if(_.isEmpty(e))return[];if(!_.isEmpty(t)){for(var r=[],i=0,a=t;i<a.length;i++){var n=a[i];n instanceof u.SQColumnRefExpr&&(n=n.getTargetEntity(),r.push(n.schema))}r=_.uniq(r)}return s(e,r)},e.readerType=o,e.findSchemas=r,e.uniqueReaderTypes=function(e){return _.chain(e).map(o).uniq().value()};var i=(t.prototype.run=function(e){for(var t=e.from(),r=0,i=t.keys();r<i.length;r++){var a=i[r];t.source(a).accept(this,void 0)}},t.prototype.visitEntity=function(e){this.visitEntityOrPod(e)},t.prototype.visitPod=function(e){this.visitEntityOrPod(e)},t.prototype.visitSubquery=function(e){this.run(e.subquery)},t.prototype.visitExpr=function(e){},t.prototype.visitEntityOrPod=function(e){var t=e.schema,e=this.schemas;_.includes(e,t)||e.push(t)},t);function t(e){this.schemas=e}}(u.DataReaderUtils||(u.DataReaderUtils={}))}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){!function(u){var i=jsCommon.ArrayExtensions;u.createDataReaderProvider=function(e,t){return new r(e,t)};var r=(e.prototype.reader=function(e){var t=this;return this.findSinglePropertyDefinition(i.ensureArray(e),function(e){return e.reader(t.hostServices)},_.noop,this.readers)},e.prototype.readerType=function(e){var t=this,e=this.resolvePluginProperty(i.ensureArray(e),function(e){return e.reader(t.hostServices)},_.noop,this.readers);return e&&e.type},e.prototype.queryGenerator=function(e){return this.findSinglePropertyDefinition(i.ensureArray(e),function(e){return e.queryGenerator&&e.queryGenerator()},_.noop,this.queryGen)},e.prototype.queryExtensionLookup=function(e){var t=i.ensureArray(e),r=_.chain(t).map(function(e){return u.DataReaderUtils.readerType(e)}).uniq().value(),e=this.findSingleBasePropertyDefinition(r,function(e){return e.queryExtensionProvider&&a(e.name,t,e.queryExtensionProvider)});return function(r,i){if(r||i)return r?function(e,t){return r(e,t,i)}:i}(this.findSingleExtensionPropertyDefinition(r,function(e){return e.queryExtensionProvider&&a(e.name,t,e.queryExtensionProvider)}),e)},e.prototype.schemaReader=function(e){var t=this;return this.findSinglePropertyDefinition([e],function(e){return e.schemaReader&&e.schemaReader(t.hostServices)},function(e){return e.schemaReader&&e.schemaReader(t.hostServices)},this.schemaReaders)},e.prototype.getCacheKey=function(e){e=i.ensureArray(e);return e.length<2?e[0]:"["+e.join(",")+"]"},e.prototype.findSinglePropertyDefinition=function(e,t,r,i){var a=this.getCacheKey(e),n=i[a];if(n)return n;r=this.resolvePluginProperty(e,t,r,i);return r?i[a]=r.property:void 0},e.prototype.findSingleExtensionPropertyDefinition=function(e,t){for(var r,i=0,a=e;i<a.length;i++){var n=a[i],o=this.factory.getPlugin(n);if(o){if(s&&s!==o.name)return;s=o.name}else{n=this.factory.getExtension(n);if(!n)return;if(s&&s!==n.extends)return;var s=n.extends,n=t(n);if(n){if(r&&n!==r)return;r=n}}}return r},e.prototype.findSingleBasePropertyDefinition=function(e,t){for(var r,i=0,a=e;i<a.length;i++){var n=a[i],n=this.factory.getPlugin(n);if(n){if(o&&o!==n.name)return;var o=n.name,n=t(n);if(n){if(r&&n!==r)return;r=n}}}return r},e.prototype.resolvePluginProperty=function(e,t,r,i){for(var a,n=0,o=e;n<o.length;n++){var s=o[n],s=this.resolveProperty(s,t,r,i);if(!s||a&&s.property!==a.property)return;a=s}return a},e.prototype.resolveProperty=function(e,t,r,i){var a,n;if(i&&(n=i[a=this.getCacheKey(e)]))return{type:e,property:n};var o=this.factory.getPlugin(e);if(o)return(n=t(o))?(i&&(i[a]=n),{type:e,property:n}):void 0;o=this.factory.getExtension(e);return o?(n=r(o))?(i&&(i[a]=n),{type:e,property:n}):this.resolveProperty(o.extends,t,r,i):void 0},e);function e(e,t){this.factory=e,this.hostServices=t,this.readers={},this.queryGen={},this.schemaReaders={}}function a(e,t,r){for(var i=[],a=0,n=t;a<n.length;a++){var o=n[a],s=u.DataReaderUtils.readerType(o);s===e&&i.push(o[s])}return r(i)}}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){function r(e){e.dataReductionAlgorithm||function(e){e=e.select;return!!e&&_.some(e,function(e){return!!e.dataReductionAlgorithm})}(e)||(e.dataReductionAlgorithm=i())}function i(){return{top:{}}}((e=e.data||(e.data={})).Impl||(e.Impl={})).applyDataReductionDefaults=function(e){var t;e.categorical&&((t=e.categorical).dataReductionAlgorithm||(t.categories&&r(t.categories),(t=t.values)&&t.group&&function(e){e.group,e.group.dataReductionAlgorithm||(e.group.dataReductionAlgorithm=i())}(t))),!e.table||(t=e.table).rows&&r(t.rows),e.matrix&&function(e){e.rows&&r(e.rows);e.columns&&r(e.columns)}(e.matrix)}}(powerbi=powerbi||{}),function(e){var a;(a=e.data||(e.data={})).applyDataReductionDefaults=function(e){for(var t=e.length,r=0;r<t;r++){var i=e[r];a.Impl.applyDataReductionDefaults(i)}}}(powerbi=powerbi||{}),function(f){!function(m){var c=jsCommon.ArrayExtensions;m.compileDataView=function(e){var t=e.mappings;if(!t)return[];var r=e.roles||[],e=new a(e.queryDefn,e.queryProjections,e.schema,e.objectDescriptors,e.objectDefinitions,e.roles||[],e.featureSwitches,e.transformPluginService),i=new m.DataViewMappingCompiler(e,r);return _.map(t,function(e){return i.compileMapping(e)})};var a=(e.prototype.compileRole=function(e,t){var r,i,a=this,n=this.queryDefn.select(),o=this.queryProjections[e],s=c.findItemWithName(this.roles,e);o&&0<o.all().length&&(r=!1,s&&(r=m.ScalarKeyUtils.isScalarKeySupportedForRole(this.schema,this.queryDefn,this.queryProjections,s.name)),i=this.getScalarKeyRoleItemQueryRef(o),(u=_.map(o.all(),function(e){var t=e.queryRef===i;return a.createDataViewRoleItem(n.withName(e.queryRef),s,r,t)})).filter(function(e){return e.scalarKeyInfo&&e.scalarKeyInfo.hasScalarKey}).length);var u={role:e,items:u},e=this.queryProjections[e];return e&&(e.showAll&&(u.showAll=!0),e.activeProjectionRefs&&(u.activeItems=e.activeProjectionRefs)),t&&(u.aggregates=_.cloneDeep(t)),u},e.prototype.getScalarKeyRoleItemQueryRef=function(e){_.isEmpty(e.all());var t=e.activeProjectionRefs;return _.isEmpty(t)?e.all()[0].queryRef:_.last(t)},e.prototype.createDataViewRoleItem=function(e,t,r,i){var a={queryName:e.name},n=this.tryGetExprType(e.expr);if(n&&(a.type=n),t&&null!=t.joinPredicate)a.joinPredicate=t.joinPredicate;else if(m.SQExpr.isTransformOutputRoleRef(e.expr)){t=this.queryDefn.transforms();if(!_.isEmpty(t))for(var o=!1,s=0,u=t;s<u.length;s++){var c=u[s],c=null===(c=this.transformPluginService.getTransformPlugin(c.algorithm))||void 0===c?void 0:c.outputRoles;if(!_.isEmpty(c))for(var l=0,p=c;l<p.length;l++){var d=p[l];if(d.algorithmRole===e.expr.role&&null!=d.joinPredicateBehavior){a.joinPredicate=d.joinPredicateBehavior,o=!0;break}}if(o)break}}return a.scalarKeyInfo={hasScalarKey:r&&i},a},e.prototype.tryGetExprType=function(e){e=e.getMetadata(this.schema,this.exprEvaluationContext);if(e)return e.type},e.prototype.compileMetadata=function(){for(var i={columns:[]},a=this.queryDefn.orderBy(),n=this,e=0,t=this.queryDefn.select();e<t.length;e++)!function(t){var e=_.find(a,function(e){return m.SQExpr.equals(e.expr,t.expr)}),r=m.SQExprUtils.getParameterMetadata(t.expr,n.schema);i.columns.push({displayName:void 0,queryName:t.name,type:n.tryGetExprType(t.expr),sort:e&&e.direction,parameter:r})}(t[e]);var r=this.objectDescriptors,o=this.objectDefinitions;if(!o||!r)return i;var s=m.DataViewObjectEvaluationUtils.groupObjectsBySelector(o),u=m.createEmptyEvalContext(),c=f.visuals.visualStyles.create();if(_.isEmpty(s.metadataOnce)||(d=this.evaluateMetadataOnceObjects(s.metadataOnce,u,c))&&(i.objects=d),!_.isEmpty(s.metadata))for(var l=0,p=i.columns;l<p.length;l++){var d,h=p[l];(d=this.evaluateMetadataObjects(h,s.metadata,u,c))&&(h.objects=d)}return i},e.prototype.evaluateMetadataOnceObjects=function(e,t,r){for(var i,a=new m.DataViewObjectEvaluator(this.featureSwitches,r),n=0,o=e;n<o.length;n++){var s=o[n],u=s.selector&&s.selector.id,s=m.DataViewObjectEvaluationUtils.evaluateDataViewObjects(a,t,this.objectDescriptors,s.objects);s&&f.DataViewObjects.mergeObjects(i=i||{},s,u)}return i},e.prototype.evaluateMetadataObjects=function(e,t,r,i){for(var a,n=new m.DataViewObjectEvaluator(this.featureSwitches,i),o=0,s=t;o<s.length;o++){var u=s[o],c=u.selector;!c.metadata||c.metadata!==e.queryName||(u=m.DataViewObjectEvaluationUtils.evaluateDataViewObjects(n,r,this.objectDescriptors,u.objects))&&f.DataViewObjects.mergeObjects(a=a||{},u,c.id)}return a},e.prototype.compileScriptDefinition=function(e,t){t=f.ScriptResultUtil.getScriptInputFromScriptDefinition(this.queryProjections,this.queryDefn.select(),this.schema,e,t.objects);return{source:e.source,provider:e.provider,scriptInput:t,scriptSourceDefault:e.scriptSourceDefault,scriptProviderDefault:e.scriptProviderDefault,scriptOutputType:e.scriptOutputType}},e);function e(e,t,r,i,a,n,o,s){this.featureSwitches=o,this.transformPluginService=s,this.queryDefn=e,this.queryProjections=t,this.schema=r,this.objectDescriptors=i,this.objectDefinitions=a,this.roles=n,this.exprEvaluationContext=m.SQExprUtils.buildExprEvaluationContext(this.queryDefn.from())}}(f.data||(f.data={}))}(powerbi=powerbi||{}),function(e){var u,c;function n(e,t,r,i){var a=e&&e[t]&&e[t][r];if(a){for(var n=a.currentId;a&&c.lt(i,a.version);)n=a.previousId,a=a.previous;return n}}function o(e,t,r,i,a,n,o,s){return c.max(l(e[u.ObjectPropertyVersionWildcard],a,n,t,r,o,s),l(e[i],a,n,t,r,o,s))}function l(e,t,r,i,a,n,o){t=e&&e[t];return t?c.max(s(t[u.ObjectPropertyVersionWildcard],i,a,n,o),s(t[r],i,a,n,o)):c.ZeroStr}function s(e,t,r,i,a){if(!e)return c.ZeroStr;for(var n=e.length-1;0<=n;n--){var o=e[n];if(n&&c.lt(o.version,e[n-1].version),!c.lt(i,o.version))break;var s=o.property.matchByContents;if((!s||s(t,r))&&(!o.property.isExprBound||a()))return o.version}return c.ZeroStr}u=e.data||(e.data={}),c=jsCommon.Version,u.ObjectPropertyVersionWildcard="*",(e=u.DataViewObjectVersioning||(u.DataViewObjectVersioning={})).getThemePropertyId=function(e,t,r,i,a){return n(a[e],t,r,i)||n(a[u.ObjectPropertyVersionWildcard],t,r,i)||{objectName:t,propertyName:r}},e.shouldApplyDefnToTheme=function(e,t,r,i,a,n){return o(e,t,null,r,i,a,n,function(){return!1})===c.ZeroStr},e.getVersionForDefinition=o,e.getFirstVersionForIdentifier=function(e,t,r){if(r=e[r]){r=r[t.objectName];if(r){t=r[t.propertyName];return _.reduce(t,function(e,t){return t.property.matchByContents||t.property.isExprBound?e:c.max(e,t.version)},c.ZeroStr)}}return c.ZeroStr}}(powerbi=powerbi||{}),function(e){var c,h;function v(e,t){t=e.indexOf(t);0<=t&&e.splice(t,1)}function m(e,t){var r=t.categories;if(r)for(var i=0,a=r;i<a.length;i++){var n=a[i];n.values.splice(0),n.identity.splice(0)}var o=t.values;if(o){var s=o.grouped();if(!_.isEmpty(s)){for(var t=s[0],u=e.columns,c=0,l=t.values;c<l.length;c++)!function(e){var t,r=e.source;r.groupName&&((t=_.find(u,function(e){return!e.groupName&&e.index===r.index&&e.isMeasure===r.isMeasure}))?(e.source=t,v(u,r)):delete r.groupName)}(l[c]);var p=[{values:t.values,objects:t.objects}];if(o.grouped=function(){return p},2<=s.length){t=t.values.length;if(0<t){for(var s=t*(s.length-1),d=t,h=t+s;d<h;d++){var m=o[d].source;v(u,m)}o.splice(t,s)}}}for(var f=0,y=o;f<y.length;f++){var g=y[f];g.values.splice(0),delete g.identity}}r&&_.every(r,function(e){return _.isEmpty(e.values)&&_.isEmpty(e.identity)}),o&&_.every(o.grouped(),function(e){return!e.name&&!e.identity}),o&&_.every(o,function(e){return _.isEmpty(e.values)})}function f(e,t){if(h.isSortedNumeric(t,!0),_.uniq(t).length,t.length,!_.isEmpty(t))if(0<=_.last(t)&&(_.head(t),e.length),e.length!==t.length){for(var r,i=0,a=0,n=t;a<n.length;a++){var o=n[a];void 0===r||r===o+1?(r=o,i++):(e.splice(r,i),r=o,i=1)}e.splice(r,i)}else e.splice(0)}c=e.data||(e.data={}),h=jsCommon.ArrayExtensions,(c.QueryDataViewCategorical||(c.QueryDataViewCategorical={})).removeGroupInstances=function(e,t,r,i){var a,n,o;i&&(a=e,o=i,i=(n=t).values&&n.values.grouped(),_.isEmpty(i)||(o=function(e,t,r){for(var i=[],a=t.length-1;0<=a;a--)r(t[a],e)&&i.push(a);return i}(n.values&&n.values.source,i,o),function(e,t,r){if(debug.assertValue(t&&t.values&&!_.isEmpty(t.values.grouped()),"dataViewCategorical must be defined and the grouped() function must return non-empty result"),h.isSortedNumeric(r,true),_.uniq(r).length,r.length,!_.isEmpty(r)){var i=t.values,a=i.grouped();if(a.length!==r.length){var n=a[0].values.length;if(_.every(a,function(e){return e.values.length===n}),0<n)for(var o=e.columns,s=0,u=r;s<u.length;s++){var c=u[s]*n;i.length;for(var l=c,p=c+n;l<p;l++){var d=i[l].source;v(o,d)}i.splice(c,n)}f(a,r),i.grouped=function(){return a}}else m(e,t)}}(a,n,o))),r&&(o=e,e=r,t=(r=t).categories,_.isEmpty(t)||(e=function(e,t){var r=e[0].values.length;_.every(e,function(e){return e.values.length===r});for(var i=[],a=r-1;0<=a;a--)t(a,e)&&i.push(a);return i}(t,e),function(e,t,r){if(debug.assertValue(t,"dataViewCategorical"),h.isSortedNumeric(r,true),_.uniq(r).length,r.length,!_.isEmpty(r))if(c.DataViewCategoricalUtils.getRowCount(t)!==r.length){c.DataViewCategoricalUtils.getRowCount(t);var i=t.categories;if(!_.isEmpty(i))for(var a=0,n=i;a<n.length;a++){var o=n[a];f(o.values,r),f(o.identity,r)}i=t.values;if(!_.isEmpty(i))for(var s=0,u=i;s<u.length;s++)f(u[s].values,r)}else m(e,t)}(o,r,e)))}}(powerbi=powerbi||{}),function(m){!function(i){var a,e,n=m.data.QueryDataViewCategorical,o=jsCommon.StringExtensions;function s(e){e=e.Condition;if(e.Contains)return e.Contains.SelectIndex;JSON.stringify(e)}function u(e,t){if(_.isEmpty(e)||_.isEmpty(t))return[];for(var r={},i=0,a=t;i<a.length;i++){var n=a[i];r[n.index]=!0}return _.filter(e,function(e){e=s(e);return!!r[e]})}function c(e,t){var r=!1,e=e.Condition;return e.Contains?(e.Contains.LiteralValue,l(e.Contains.LiteralValue),r=!_.isString(t)||(t=l(t),!o.contains(t,e.Contains.LiteralValue))):JSON.stringify(e),r}function l(e){return e&&o.normalizeCase(e)}(e=a=i.ClientSideFilter||(i.ClientSideFilter={})).isMoreRestrictiveFilter=function(e,t){if(!i.SQFilter.targetsEqual(e,t))return!1;if(e=e.condition,t=t.condition,e instanceof i.SQContainsExpr&&t instanceof i.SQContainsExpr){e=p.getInfoIfFilteringByStringConstant(e),t=p.getInfoIfFilteringByStringConstant(t);if(e&&t&&i.SQExpr.equals(e.otherSide,t.otherSide))return o.contains(l(e.constantValue),l(t.constantValue))}return!1},e.tryConvertToClientSideFilters=function(e,t){if(!_.some(t,function(e){return!!e.target})){for(var r=new h(e),i=0,a=t;i<a.length;i++)a[i].condition.accept(r);return r.getClientSideFiltersIfAllSupported()}},e.applyClientSideFilters=function(e,t){if(!_.isEmpty(t)&&!_.isEmpty(e.metadata.columns)){_.every(t,function(t){return _.some(e.metadata.columns,function(e){return!e.isMeasure&&e.index===s(t)})});var r,i=e.categorical;return i&&(r=function(e,t){if(debug.assertAnyValue(e,"seriesMetadataColumn"),e){var a=u(t,[e]);if(!_.isEmpty(a))return function(e){if(!!e.identity)for(var t=e.name,r=0,i=a;r<i.length;r++)if(c(i[r],t))return!0;return!1}}}(i.values&&i.values.source,t),t=function(e,t){var n=u(t,_.map(e,function(e){return e.source}));if(!_.isEmpty(n))return function(r,e){for(var t=0,i=n;t<i.length;t++){var a=function(t){if(_.every(e,function(e){return c(t,e.values[r])}))return{value:!0}}(i[t]);if("object"==typeof a)return a.value}return!1}}(i.categories,t),n.removeGroupInstances(e.metadata,i,t,r)),e}},e.normalizeString=l;var r,p,d,h=(r=i.DefaultSQExprVisitor,__extends(t,r),t.prototype.visitContains=function(e){var t,r;this.hasUnsupportedFilter()||(t=!1,(r=p.getInfoIfFilteringByStringConstant(e))&&(e=r.constantValue,0<=(r=i.SQExprUtils.indexOfNamedExpr(this.selects,r.otherSide))&&e&&(e={Condition:{Contains:{SelectIndex:r,LiteralValue:a.normalizeString(e)}}},this.clientSideFilters.push(e),t=!0)),t||this.setUnsupportedFilter())},t.prototype.visitAnd=function(e){this.hasUnsupportedFilter()||(e.left.accept(this),e.right.accept(this))},t.prototype.visitDefault=function(e){this.setUnsupportedFilter()},t.prototype.getClientSideFiltersIfAllSupported=function(){if(!this.hasUnsupportedFilter())return this.clientSideFilters},t.prototype.hasUnsupportedFilter=function(){return void 0===this.clientSideFilters},t.prototype.setUnsupportedFilter=function(){this.clientSideFilters=void 0},t);function t(e){var t=r.call(this)||this;return t.clientSideFilters=[],t.selects=e,t}(d=p=p||{}).getInfoIfFilteringByStringConstant=function(e){if(e){var t=d.getValueIfStringConstant(e.left);return t?{constantValue:t,otherSide:e.right}:{constantValue:t=d.getValueIfStringConstant(e.right),otherSide:e.left}}},d.getValueIfStringConstant=function(e){if(i.SQExpr.isConstant(e)&&e.type.text)return e.value}}(m.data||(m.data={}))}(powerbi=powerbi||{}),function(N){var F,u,z,o,Q;function e(e,t,r,i,a,n,o){this.warningType=e,this.propertyId=t,this.valueExpr=r,this.selector=i,this.objectDiplayName=a,this.propertyDisplayName=n,this.expectedValueType=o}F=N.data||(N.data={}),u=N.DataViewAnalysis,z=N.data.SQExprUtils,o=jsCommon.StringExtensions,e.prototype.columnNameFromIndex=function(e){},Object.defineProperty(e.prototype,"code",{get:function(){switch(this.warningType){case 1:return"DataBoundObjectQueryExtensionWarningInvalidType";case 2:return"DataBoundObjectQueryExtensionWarningMissingReference";case 0:return;default:this.warningType}},enumerable:!1,configurable:!0}),e.prototype.getDetails=function(e,t){if(t){var r=[],i=e.get("NamePattern_Colon"),a=1===this.warningType,n=a?"DataBoundExprWarning_InvalidType_Message":"DataBoundExprWarning_MissingReference_Message";r.push(o.format(e.get(a?"DataBoundExprWarning_InvalidType_Title":"DataBoundExprWarning_MissingReference_Title"),F.getDisplayName(this.propertyDisplayName,e))),r.push(o.format(i,e.get("VisualWarning_PropertyEvaluation_Tooltip_Section"),F.getDisplayName(this.objectDiplayName,e)));t=t(this.valueExpr);return r.push(o.format(i,e.get("Field_Source"),t)),a&&this.expectedValueType&&r.push(o.format(i,e.get("DataBoundExprWarning_ExpectedDataType"),F.DataBoundExprWarning.getPrimitiveValueType(this.expectedValueType,e))),r.push(e.get(n)),{message:r.join("\n"),displayableErrorInfo:[]}}},Q=e,F.DataBoundObjectQueryExtensionWarning=Q,function(e){function r(m,f,e,y,g,v,t,r){if(!_.isEmpty(e)){for(var S=m.select(),x=[],C=[],D=[],E=[],i=0,a=e;i<a.length;i++){var n=a[i];n.objects&&n.descriptors&&F.DataViewObjectDefinitions.visitPropertyDefinitions(n.objects,n.descriptors,R)}for(var o=0,s=D;o<s.length;o++)for(var u=s[o],c=0,l=E;c<l.length;c++){var p=l[c];if(F.Selector.equals(u.selector,p)){F.DataBoundExprExtractor.addUnique(C,u);break}}for(var d=[],h=[],w=0,I=C;w<I.length;w++){var b=I[w],M=b.selector,V=function(e,t,r,i){var a,n=e.aggregates,o=e.selector,s=e.context,u=e.expr,r=T(e.expr,s,r);{if(n||o&&!_.isEmpty(o.data))return(c=t.selectNameOf(r))?{queryName:c,queryDefn:t,objectDefinitionRewrite:void 0}:{queryName:(t=t.addSelect(r)).selectNameOf(r),queryDefn:t,objectDefinitionRewrite:void 0};t=t.addSelect(r);var c=_.last(t.select());return F.SQExpr.equals(c.expr,r),i&&(i=new F.InlineSubqueryRewriter(t),t=i.rewrite(),i.didRewrite&&(a={from:u,to:F.SQExprBuilder.selectRef(c.name),selector:e.selector})),{queryName:c.name,queryDefn:t,objectDefinitionRewrite:a}}}(b,m,t,r);m=V.queryDefn,V.objectDefinitionRewrite&&h.push(V.objectDefinitionRewrite);V={queryName:V.queryName,selector:M};_.isEmpty(b.targetsQueryName)||(V.relatedProjectionsQueryName=b.targetsQueryName),b.aggregates&&(V.aggregates=b.aggregates),M&&!_.isEmpty(M.data)&&(V.joinPredicate=0),d.push(V)}return _.isEmpty(d)&&_.isEmpty(x)?void 0:{queryDefn:m,warnings:x,additionalProjections:d,objectDefinitionRewrites:h}}function R(e,t,r,i,a){var n=a&&a.properties[t],o=e[t],s=n.type;if(n.rule){if(n.type.fillRule&&N.StructuralObjectDefinition.isFillRuleDefinition(o),!P(n.rule.conditions,g,v))return;var u=function(e,t,r){e=e.inputRole;if(e){var i=r[e];if(!_.isEmpty(i))return _.chain(t.select()).filter(function(e){return _.includes(i,e.name)}).map(function(e){return e.expr}).value()}}(n.rule,m,y);if(_.isEmpty(u))return;_.size(u),r={data:_.map(u,function(e){return F.createDataViewScopeIdentity(e)})},u=F.DataViewObjectDefinitions.getDataBoundExprs(o,n.type,r,S,u[0])}else s&&s.dataBars?r&&r.metadata&&S.withName(r.metadata)&&(_.isEmpty(r.data)&&((r=_.cloneDeep(r)).data=[F.DataViewWildcard.create()]),u=F.DataViewObjectDefinitions.getDataBoundExprs(o,n.type,r,S,S.withName(r.metadata).expr)):(e=F.DataViewObjectDefinitions.getDataBoundExprsAndValueRef(e[t],s,r,S),n.ignoreUnreferenced?(_.isEmpty(e.references),D.push.apply(D,e.expressions)):(u=e.expressions,E.push.apply(E,e.references.map(function(e){return e.selector}))));if(!_.isEmpty(u)&&((!r||function(e,t){var r=e.metadata;if(!r)return!0;for(var i=0,a=t;i<a.length;i++)if(a[i].name===r)return!0}(r,S))&&void 0!==A(null==r?void 0:r.data,S,y)))for(var c=0,l=u;c<l.length;c++){var p=l[c];if(p.expr){if(f){var d=z.buildExprEvaluationContext(m.from()),h=p.expr.getMetadata(f,d);if(null==h||!N.ValueType.isCompatibleFromAny(s,h.type)){d=h?1:2,h=h?N.ValueType.fromDescriptor(s):null,h=new Q(d,{objectName:i,propertyName:t},p.expr,r,a.displayName,n.displayName,h);x.push(h);continue}}F.DataBoundExprExtractor.addUnique(C,p)}}}}function T(e,t,r){if(!F.SQExpr.isAggregation(e)||!F.SQExpr.isColumn(e.arg)||!F.SQExpr.isSubqueryRef(e.arg.source))return e;var i=e.arg.source.query;if(!i)return e;var a=t&&t.filterContext;if(_.isEmpty(a)&&!r)return e;r&&(t=r.conditions(),_.some(t,function(e){return 1===F.FilterKindDetector.runDetector(e)}));r=function e(t,r){var i=function(e){var t,r=!1,i=e.from().sources();for(t in i){var a=i[t];if(N.data.isSQFromEntitySource(a)){r=!0;break}}return r};if(i(t))return s(t,r);var a=t.from().sources();for(var n in a){var o=a[n];if(N.data.isSQFromSubquerySource(o)){o=e(o.subquery,r);return a[n]=new N.data.SQFromSubquerySource(o),t.from(new N.data.SQFrom(a))}}}(i,_.isEmpty(a)?[r]:n(_.map(a,function(e){return e.filter}),r,!0,!1));return e.accept(new o(r))}function s(e,t){if(!F.SemanticQuery.willFiltersAffectQuery(e))return e;var r=F.SemanticFilter.unmerge(F.SemanticFilter.fromSQFromAndSQFilters(e.from(),e.where())),t=_.isEmpty(r)?t:n(r,F.SemanticFilter.merge(t),!1,!0),t=F.SemanticFilter.merge(t);return e.where(t.where(),t.from())}function n(e,t,r,i){for(var a=[],n=0,o=function(e,t){var r=[];t&&r.push({filters:[t],kind:void 0});e=function(e){return _.groupBy(e,function(e){e=e.conditions();return _.size(e),F.FilterKindDetector.runDetector(e[0])})}(e);e[0]&&r.push({filters:e[0],kind:0});e[3]&&r.push({filters:e[3],kind:3});e[2]&&r.push({filters:e[2],kind:2});e[1]&&r.push({filters:e[1],kind:1});return r}(e,t);n<o.length;n++){var s=o[n],u=s.filters;3===s.kind||1===s.kind?(1===s.kind&&r&&(u=[function(e){for(var t,r=F.SemanticQuery.create(),i=0,a=e;i<a.length;i++){var n=a[i];r=r.addSemanticFilter(n);n=n.where()[0].target;_.isEmpty(t)||jsCommon.ArrayExtensions.hasSameValues(n,t,function(e,t){return F.SQExpr.equals(e,t)}),t=t||n}for(var o=0,s=t;o<s.length;o++){var u=s[o];r=r.addSelect(u)}return F.SemanticFilter.fromMeasuresQuery(r,t)}(s.filters)]),i?u=_.map(u,function(e){return F.SubqueryRewriter.makeSubqueriesLowerPrecedenceThanSpecificFilters(e,[t])}):_.isEmpty(a)||(u=_.map(u,function(e){return F.SubqueryRewriter.makeSubqueriesLowerPrecedenceThanSpecificFilters(e,a)})),a.push.apply(a,u)):a.push.apply(a,u)}return a}e.extend=r,e.needsToExtend=function(e,t){return!!r(e,null,t,{},{},{},void 0,void 0)},e.getExpressionToAdd=T;var i,o=(i=F.SQExprRewriter,__extends(t,i),t.prototype.visitSubqueryRef=function(e){return F.SQExprBuilder.subqueryRef(this.query,e.getAnnotations())},t);function t(e){var t=i.call(this)||this;return t.query=e,t}function P(e,t,r){if(!e)return!0;for(var i=0,a=e;i<a.length;i++){var n=a[i],n=u.checkForConditionErrors(t,n,r);if(_.isEmpty(n))return!0}return!1}function A(e,t,r){if(_.isEmpty(e))return null;for(var i=[],a=0,n=e;a<n.length;a++){var o,s=n[a];F.Selector.isRoleWildcard(s)?(o=h(r,s.roles,t),i.push.apply(i,o||[])):F.Selector.isWildcard(s)?(o=h(r,Object.keys(r),t),i.push.apply(i,o||[])):F.Selector.isScopeWildcard(s)||F.Selector.isScopeTotal(s)?i.push.apply(i,s.exprs||[]):F.Selector.isScopeIdentity(s)&&i.push(s.expr)}if(0!==i.length){for(var u=[],c=0,l=t;c<l.length;c++){var p=l[c],d=z.indexOfExpr(i,p.expr);if(!(d<0)&&(i.splice(d,1),u.push(p.name),0===i.length))break}if(!(0<i.length||0===u.length))return u}}function h(e,t,r){for(var i=[],a=0,n=t;a<n.length;a++){var o=n[a];i.push.apply(i,e[o]||[])}r=_.filter(r,function(e){return _.includes(i,e.name)});return _.map(r,function(e){return e.expr})}e.matchesAnyCondition=P,e.getScopeRefs=A}(F.DataBoundObjectQueryExtender||(F.DataBoundObjectQueryExtender={}))}(powerbi=powerbi||{}),function(b){var M;(function(e){var i=b.data.FilterKindDetector,C=b.data.SQFromEntitySource,n=b.data.SQFromPodSource,o=b.data.SQFromSubquerySource,a=jsCommon.StringExtensions,s=(t.serializeQuery=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var i=[],a=e.from();this.serializeFrom(a,i);var n=this.serializeQueryFilters(e.where(),v.create,!1),a=e.transforms();if(!_.isEmpty(a))for(var o=[],s=0,u=a;s<u.length;s++){var c,l=u[s],p=_.map(l.input.parameters,function(e){return v.createNamed(e,t)}),p={Name:l.name,Algorithm:l.algorithm,Input:{Parameters:p},Output:void 0};l.input.table&&(c=this.serializeTransformTableColumns(l.input.table.columns),p.Input.Table={Name:l.input.table.name,Columns:c}),l.output&&l.output.table&&(c=this.serializeTransformTableColumns(l.output.table.columns),p.Output={Table:{Name:l.output.table.name,Columns:c}}),o.push(p)}for(var a=this.serializeSortDefinitions(e.orderBy(),t),d=[],h=e.select(),m=0,f=h.length;m<f;m++)d.push(v.createNamed(h[m],t,r));var y=e.groupBy();if(y&&y.length)for(var g=[],m=0,f=y.length;m<f;m++)g.push(v.createNamed(y[m],t));i={Version:M.SemanticQueryVersions.Version2,From:i,Select:d};return n&&(i.Where=n),o&&(i.Transform=o),a&&(i.OrderBy=a),g&&(i.GroupBy=g),e.top()&&(i.Top=e.top()),i},t.serializeSortDefinitions=function(e,t){if(e&&e.length)for(var r=[],i=0,a=e.length;i<a;i++){var n=e[i];r.push({Direction:n.direction,Expression:v.create(n.expr,t)})}return r},t.tryDeserializeQuery=function(e){var t;try{t=this.deserializeQuery(e)}catch(e){}if(t&&!this.isMalformed(t))return t},t.isMalformed=function(e){for(var t=0,r=e.select();t<r.length;t++)if(!r[t].expr)return!0;return!1},t.serializeQueryFilters=function(e,t,r){if(!_.isEmpty(e))for(var i=[],a=0,n=e;a<n.length;a++){var o=n[a],s={Condition:t(o.condition,r)};if(!_.isEmpty(o.target)){s.Target=[];for(var u=0,c=o.target;u<c.length;u++){var l=c[u];s.Target.push(t(l,r))}}o.annotations&&(s.Annotations=o.annotations),i.push(s)}return i},t.deserializeQuery=function(e){var t=e.Version||M.SemanticQueryVersions.Version0,r=t<M.SemanticQueryVersions.Version1,i=D.from(e.From),a=new M.SemanticQueryBuilder(i),n=e.Where;if(n)for(var o=0,s=n.length;o<s;o++){var u=D.filter(n[o],i);u&&(r&&(u=E.Upgrade(t,u)),a.addWhere(u))}var c=e.Transform,l=i;if(!_.isEmpty(c)){for(var p={},d=0,h=i.keys();d<h.length;d++){var m=h[d];p[m]=i.source(m)}for(var f,o=0,s=c.length;o<s;o++)c[o].Input&&c[o].Input.Table&&(p[f=c[o].Input.Table.Name]=new C(void 0,f)),c[o].Output&&c[o].Output.Table&&(p[f=c[o].Output.Table.Name]=new C(void 0,f));for(l=new M.SQFrom(p),o=0,s=c.length;o<s;o++)a.addTransform(D.transform(c[o],l))}var y=e.OrderBy;if(y)for(o=0,s=y.length;o<s;o++)a.addOrderBy(D.sort(y[o],i));for(var g=e.Select,v={},o=0,s=g.length;o<s;o++)a.addSelect(D.select(g[o],v,l));var S=e.GroupBy;if(S)for(var x={},o=0,s=S.length;o<s;o++)a.addGroupBy(D.groupBy(S[o],x,i));return e.Top&&a.setTop(e.Top),a.toQuery()},t.deserializeSortDefinitions=function(e,t){return _.isEmpty(e)?[]:_.map(e,function(e){return D.sort(e,t)})},t.serializeFilter=function(e){var t=[],r=e.from();this.serializeFrom(r,t);e=this.serializeQueryFilters(e.where(),v.create,!1);return{Version:M.SemanticQueryVersions.Version2,From:t,Where:e}},t.serializeFrom=function(e,t){for(var r=e.keys(),i=new c(e),a=0,n=r.length;a<n;a++)t.push(e.source(r[a]).accept(i,a))},t.deserializeFrom=function(e){return D.from(e)},t.deserializeFilter=function(e,t){var r=e.Version||M.SemanticQueryVersions.Version0,i=r<M.SemanticQueryVersions.Version1,a=D.from(e.From),n=new M.SemanticQueryBuilder(a),o=e.Where;if(o)for(var s=0,u=o.length;s<u;s++){var c=D.filter(o[s],a);c?(i&&(c=E.Upgrade(r,c)),n.addWhere(c)):t&&(_.isEmpty(t.RemovedIndexes)&&(t.RemovedIndexes=[]),t.RemovedIndexes.push(s))}return n.toFilter()},t.serializeExpr=function(e,t){return v.create(e,!0,t=void 0===t?!1:t)},t.serializeExprWithRef=function(e,t){return v.create(e,!1,t=void 0===t?!1:t)},t.deserializeExpr=function(e){return p.createStandalone(e)},t.deserializeExprWithRef=function(e,t){return p.create(e,t)},t.serializeTransformTableColumns=function(e){return _.map(e,function(e){var t={Expression:v.createNamed(e.expression)};return e.role&&(t.Role=e.role),t})},t);function t(){}e.SemanticQuerySerializer=s;var D=(u.from=function(e){var t={};if(e)for(var r=0,i=e.length;r<i;r++){var a=e[r];switch(a.Type){case 2:a.Expression.Subquery?t[a.Name]=new o(s.deserializeQuery(a.Expression.Subquery.Query)):t[a.Name]=new M.SQFromExprSource(p.createFromSourceExpression(a.Expression));break;case 1:t[a.Name]=new n(a.Schema,a.Entity);break;default:t[a.Name]=new C(a.Schema,a.Entity)}}return new M.SQFrom(t)},u.filter=function(e,t){var r=t?p.create(e.Condition,t):p.createStandalone(e.Condition);if(r){var i={condition:r};if(e.Target){i.target=[];for(var a=0,n=e.Target;a<n.length;a++){var o=n[a],o=t?p.create(o,t):p.createStandalone(o);if(!o)return;i.target.push(o)}}return e.Annotations&&(i.annotations=e.Annotations),i}},u.sort=function(e,t){return{direction:e.Direction,expr:p.create(e.Expression,t)}},u.select=function(e,t,r){return u.toNamedQueryExpression(e,t,r)},u.groupBy=function(e,t,r){return u.toNamedQueryExpression(e,t,r)},u.transform=function(e,t){var r,i=_.map(e.Input.Parameters,function(e){return u.toNamedQueryExpression(e,{},t)}),i={name:e.Name,algorithm:e.Algorithm,input:{parameters:i},output:{}};return e.Input.Table&&(r=this.deserializeTransformTableColumns(e.Input.Table.Columns,t),i.input.table={name:e.Input.Table.Name,columns:r}),e.Output&&e.Output.Table&&(r=this.deserializeTransformTableColumns(e.Output.Table.Columns,t),i.output.table={name:e.Output.Table.Name,columns:r}),i},u.toNamedQueryExpression=function(e,t,r){r=p.create(e,r),e=e.Name||a.findUniqueName(t,M.SQExprUtils.defaultName(r));return t[e]=!0,{name:e,expr:r}},u.deserializeTransformTableColumns=function(e,t){var r={};return _.map(e,function(e){return{role:e.Role,expression:u.toNamedQueryExpression(e.Expression,r,t)}})},u);function u(){}var c=(r.prototype.visitEntity=function(e,t){return{Name:this.from.keys()[t],Entity:e.entity,Schema:e.schema,Type:0}},r.prototype.visitPod=function(e,t){return{Name:this.from.keys()[t],Entity:e.pod,Schema:e.schema,Type:1}},r.prototype.visitSubquery=function(e,t){return{Name:this.from.keys()[t],Expression:{Subquery:{Query:s.serializeQuery(e.subquery)}},Type:2}},r.prototype.visitExpr=function(e,t){return{Name:this.from.keys()[t],Expression:s.serializeExpr(e.expr),Type:2}},r);function r(e){this.from=e}var v=(l.getInstance=function(e,t){var r=[+(e=e||!1),+(t=t||!1)].reduce(function(e,t){return e<<1|t});return l.instances[r]||new l(e,t)},l.create=function(e,t,r){return e.accept(l.getInstance(t=void 0===t?!1:t,r=void 0===r?!1:r))},l.createNamed=function(e,t,r){r=l.getInstance(t=void 0===t?!1:t,r=void 0===r?!1:r),r=e.expr.accept(r);return e.name&&(r.Name=e.name),r},l.prototype.visitColumnRef=function(e){return this.addAnnotations(e,{Column:{Expression:e.source.accept(this),Property:e.ref}})},l.prototype.visitMeasureRef=function(e){return this.addAnnotations(e,{Measure:{Expression:e.source.accept(this),Property:e.ref}})},l.prototype.visitNativeMeasure=function(e){var t={Language:e.language,Expression:e.expression,DataType:e.dataType};e.proposedName&&(t.ProposedName=e.proposedName),e.format&&(t.Format=e.format);var r=e.expressionContentCache;return!r||!r.dependencies&&null==r.unrecognizedIdentifiers?{NativeMeasure:t}:(t.ExpressionContentCache={},r.dependencies&&(t.ExpressionContentCache.Dependencies=this.serializeAll(r.dependencies)),null!=r.unrecognizedIdentifiers&&(t.ExpressionContentCache.UnrecognizedIdentifiers=r.unrecognizedIdentifiers),this.addAnnotations(e,{NativeMeasure:t}))},l.prototype.visitNativeColumn=function(e){var t={Language:e.language,Expression:e.expression,DataType:e.dataType,Source:e.source.accept(this)};e.proposedName&&(t.ProposedName=e.proposedName),e.format&&(t.Format=e.format);var r=e.expressionContentCache;return!r||!r.dependencies&&null==r.unrecognizedIdentifiers||(t.ExpressionContentCache={},r.dependencies&&(t.ExpressionContentCache.Dependencies=this.serializeAll(r.dependencies)),null!=r.unrecognizedIdentifiers&&(t.ExpressionContentCache.UnrecognizedIdentifiers=r.unrecognizedIdentifiers)),this.addAnnotations(e,{NativeColumn:t})},l.prototype.visitAggr=function(e){return this.addAnnotations(e,{Aggregation:{Expression:e.arg.accept(this),Function:e.func}})},l.prototype.visitPercentile=function(e){var t=this.addAnnotations(e,{Percentile:{Expression:e.arg.accept(this),K:e.k}});return e.exclusive&&(t.Percentile.Exclusive=e.exclusive),t},l.prototype.visitRangePercent=function(e){return this.addAnnotations(e,{RangePercent:{Min:e.min.accept(this),Max:e.max.accept(this),Percent:e.percent}})},l.prototype.visitHierarchy=function(e){return this.addAnnotations(e,{Hierarchy:{Expression:e.arg.accept(this),Hierarchy:e.hierarchy}})},l.prototype.visitPropertyVariationSource=function(e){var t=e.arg.accept(this),r=e.property,i=e.name;return this.addAnnotations(e,{PropertyVariationSource:{Expression:{SourceRef:t.SourceRef},Name:i,Property:r}})},l.prototype.visitHierarchyLevel=function(e){return this.addAnnotations(e,{HierarchyLevel:{Expression:e.arg.accept(this),Level:e.level}})},l.prototype.visitSelectRef=function(e){return void 0===e.attributeKind||e.attributeKind,this.addAnnotations(e,{SelectRef:{ExpressionName:e.expressionName}})},l.prototype.visitBetween=function(e){return this.addAnnotations(e,{Between:{Expression:e.arg.accept(this),LowerBound:e.lower.accept(this),UpperBound:e.upper.accept(this)}})},l.prototype.visitIn=function(e){var t=this.serializeAll(e.args),r=e.values;if(r){for(var i=[],a=0,n=r.length;a<n;a++)i.push(this.serializeAll(r[a]));return this.addAnnotations(e,{In:{Expressions:t,Values:i}})}return this.addAnnotations(e,{In:{Expressions:this.serializeAll(e.args),Table:e.table.accept(this)}})},l.prototype.visitEntity=function(e){var t;return t=this.standalone?{Schema:e.schema,Entity:e.entity}:(e.variable,{Source:e.variable}),this.addAnnotations(e,{SourceRef:t})},l.prototype.visitSubqueryRef=function(e){return e.variable&&!e.query?this.addAnnotations(e,{SourceRef:{Source:e.variable}}):this.standalone?this.addAnnotations(e,{Subquery:{Query:s.serializeQuery(e.query,!1,this.serializeAnnotations)}}):void 0},l.prototype.visitNamedQueryRef=function(e){return this.standalone?this.addAnnotations(e,{NamedQueryReference:{Name:e.queryName}}):(e.variable,this.addAnnotations(e,{SourceRef:{Source:e.variable}}))},l.prototype.visitAnd=function(e){return this.addAnnotations(e,{And:{Left:e.left.accept(this),Right:e.right.accept(this)}})},l.prototype.visitOr=function(e){return this.addAnnotations(e,{Or:{Left:e.left.accept(this),Right:e.right.accept(this)}})},l.prototype.visitCompare=function(e){return this.addAnnotations(e,{Comparison:{ComparisonKind:e.comparison,Left:e.left.accept(this),Right:e.right.accept(this)}})},l.prototype.visitConditional=function(e){var t=this,r=this.addAnnotations(e,{Conditional:{Cases:_.map(e.cases,function(e){return t.visitCase(e)})}}),e=e.defaultValue;return e&&(r.Conditional.DefaultValue=e.accept(this)),r},l.prototype.visitCase=function(e){return{Condition:e.condition.accept(this),Value:e.value.accept(this)}},l.prototype.visitContains=function(e){return this.addAnnotations(e,{Contains:{Left:e.left.accept(this),Right:e.right.accept(this)}})},l.prototype.visitDateAdd=function(e){return this.addAnnotations(e,{DateAdd:{Expression:e.arg.accept(this),Amount:e.amount,TimeUnit:e.unit}})},l.prototype.visitDateSpan=function(e){return this.addAnnotations(e,{DateSpan:{Expression:e.arg.accept(this),TimeUnit:e.unit}})},l.prototype.visitExists=function(e){return this.addAnnotations(e,{Exists:{Expression:e.arg.accept(this)}})},l.prototype.visitNot=function(e){return this.addAnnotations(e,{Not:{Expression:e.arg.accept(this)}})},l.prototype.visitNow=function(e){return this.addAnnotations(e,{Now:{}})},l.prototype.visitDefaultValue=function(e){return this.addAnnotations(e,{DefaultValue:{}})},l.prototype.visitAnyValue=function(e){var t={};return null!=e.defaultValueOverridesAncestors&&(t.DefaultValueOverridesAncestors=e.defaultValueOverridesAncestors),this.addAnnotations(e,{AnyValue:t})},l.prototype.visitFillRule=function(e){var t={},r=e.rule;return r.linearGradient2&&(t.linearGradient2=this.visitLinearGradient2(r.linearGradient2)),r.linearGradient3&&(t.linearGradient3=this.visitLinearGradient3(r.linearGradient3)),this.addAnnotations(e,{FillRule:{Input:e.input.accept(this),FillRule:t}})},l.prototype.visitLinearGradient2=function(e){var t={min:this.visitRuleStop(e.min),max:this.visitRuleStop(e.max)},e=this.visitNullColoringStrategy(e.nullColoringStrategy);return e&&(t.nullColoringStrategy=e),t},l.prototype.visitLinearGradient3=function(e){var t={min:this.visitRuleStop(e.min),mid:this.visitRuleStop(e.mid),max:this.visitRuleStop(e.max)},e=this.visitNullColoringStrategy(e.nullColoringStrategy);return e&&(t.nullColoringStrategy=e),t},l.prototype.visitRuleStop=function(e){var t={color:e.color.accept(this)};return e.value&&(t.value=e.value.accept(this)),t},l.prototype.visitNullColoringStrategy=function(e){if(e){e.strategy;var t={strategy:e.strategy.accept(this)};return e.color&&(t.color=e.color.accept(this)),t}},l.prototype.visitThemeDataColor=function(e){return this.addAnnotations(e,{ThemeDataColor:{ColorId:e.colorId,Percent:e.percent}})},l.prototype.visitStartsWith=function(e){return this.addAnnotations(e,{StartsWith:{Left:e.left.accept(this),Right:e.right.accept(this)}})},l.prototype.visitGroupRef=function(e){var t=this;return this.addAnnotations(e,{GroupRef:{Expression:e.source.accept(this),Property:e.ref,GroupedColumns:_.map(e.groupedExprs,function(e){return e.accept(t)})}})},l.prototype.visitConstant=function(e){switch(e.type.primitiveType){case 5:case 7:case 2:case 4:case 3:case 0:case 1:return this.addAnnotations(e,{Literal:{Value:e.valueEncoded}});default:e.type.primitiveType}},l.prototype.visitArithmetic=function(e){return this.addAnnotations(e,{Arithmetic:{Left:e.left.accept(this),Right:e.right.accept(this),Operator:e.operator}})},l.prototype.visitFloor=function(e){var t=this.addAnnotations(e,{Floor:{Expression:e.arg.accept(this),Size:e.size}});return null!=e.timeUnit&&(t.Floor.TimeUnit=e.timeUnit),t},l.prototype.visitResourcePackageItem=function(e){return this.addAnnotations(e,{ResourcePackageItem:{PackageName:e.packageName,PackageType:e.packageType,ItemName:e.itemName}})},l.prototype.visitScopedEval=function(e){return this.addAnnotations(e,{ScopedEval:{Expression:e.expression.accept(this),Scope:this.serializeAll(e.scope)}})},l.prototype.visitFilteredEval=function(e){return this.addAnnotations(e,{FilteredEval:{Expression:e.expression.accept(this),Filters:s.serializeQueryFilters(e.filters,l.create,this.standalone)}})},l.prototype.visitWithRef=function(e){return this.addAnnotations(e,{WithRef:{ExpressionName:e.expressionName}})},l.prototype.visitTransformTableRef=function(e){return this.addAnnotations(e,{TransformTableRef:{Source:e.source}})},l.prototype.visitTransformOutputRoleRef=function(e){return this.addAnnotations(e,{TransformOutputRoleRef:{Role:e.role,Transform:e.transform}})},l.prototype.visitRoleRef=function(e){return this.addAnnotations(e,{RoleRef:{Role:e.role}})},l.prototype.visitSummaryValueRef=function(e){return this.addAnnotations(e,{SummaryValueRef:{Name:e.name}})},l.prototype.visitAllRolesRef=function(e){return this.addAnnotations(e,{AllRolesRef:{}})},l.prototype.visitDiscretize=function(e){return this.addAnnotations(e,{Discretize:{Expression:e.source.accept(this),Count:e.count}})},l.prototype.visitMember=function(e){return this.addAnnotations(e,{Member:{Expression:e.source.accept(this),Member:e.member}})},l.prototype.visitSparklineData=function(e){var t={SparklineData:{Measure:e.measure.accept(this),Groupings:this.serializeAll(e.grouping),PointsPerSparkline:e.pointsPerSparkline}};return e.scalarKey&&(t.SparklineData.ScalarKey=e.scalarKey.accept(this)),e.includeMinGroupingInterval&&(t.SparklineData.IncludeMinGroupingInterval=e.includeMinGroupingInterval),t},l.prototype.serializeAll=function(e){for(var t=[],r=0,i=e.length;r<i;r++)t.push(e[r].accept(this));return t},l.prototype.addAnnotations=function(e,t){return!this.serializeAnnotations||(e=e.getAnnotations())&&(t.Annotations=e),t},l.instances=[],l);function l(e,t){this.standalone=e,this.serializeAnnotations=t}var p,d,E=(h.Upgrade=function(e,t){if(!t)return null;if(!t.condition)return null;var r=i.runDetector(t.condition);return e===M.SemanticQueryVersions.Version0&&2!==r?{condition:t.condition}:t},h);function h(){}function m(e,t){return function(e,t){if(e.Column){t=m(e.Column.Expression,t);if(t)return M.SQExprBuilder.columnRef(t,e.Column.Property,e.Annotations)}}(e,t)||function(e,t){if(e.Measure){t=m(e.Measure.Expression,t);if(t)return M.SQExprBuilder.measureRef(t,e.Measure.Property,e.Annotations)}}(e,t)||function(e){if(e.NativeMeasure){var t=void 0;return e.NativeMeasure.ExpressionContentCache&&(t={unrecognizedIdentifiers:e.NativeMeasure.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:y(e.NativeMeasure.ExpressionContentCache.Dependencies)}),"dax"!==e.NativeMeasure.Language&&e.NativeMeasure.Language,M.SQExprBuilder.nativeMeasure(e.NativeMeasure.Language,e.NativeMeasure.Expression,e.NativeMeasure.DataType,e.NativeMeasure.ProposedName,t,e.NativeMeasure.Format,e.Annotations)}}(e)||function(e,t){if(e.NativeColumn){var r=void 0;if(e.NativeColumn.ExpressionContentCache&&(r={unrecognizedIdentifiers:e.NativeColumn.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:y(e.NativeColumn.ExpressionContentCache.Dependencies)}),"dax"===e.NativeColumn.Language){if(e.NativeColumn.Source){t=m(e.NativeColumn.Source,t);return M.SQExprBuilder.nativeColumn(e.NativeColumn.Language,e.NativeColumn.Expression,e.NativeColumn.DataType,t,e.NativeColumn.ProposedName,r,e.NativeColumn.Format,e.Annotations)}}else e.NativeColumn.Language}}(e,t)||function(e,t){if(e.SourceRef){if(!t){var r=e.SourceRef;return M.SQExprBuilder.entity(r.Schema,r.Entity,void 0,e.Annotations)}r=e.SourceRef.Source,t=t.source(r);if(t)return M.isSQFromEntitySource(t)?M.SQExprBuilder.entity(t.schema,t.entity,r,e.Annotations):M.isSQFromPodSource(t)?M.SQExprBuilder.entity(t.schema,t.pod,r):M.isSQFromSubquerySource(t)?M.SQExprBuilder.subqueryRef(r,e.Annotations):(M.isSQFromExprSource(t),t.expr.as(r))}}(e,t)||function(e,t){if(e.Aggregation){t=m(e.Aggregation.Expression,t);if(t)return M.SQExprBuilder.aggregate(t,e.Aggregation.Function,e.Annotations)}}(e,t)||function(e){if(e.SelectRef)return M.SQExprBuilder.selectRef(e.SelectRef.ExpressionName,void 0,e.Annotations)}(e)||function(e,t){if(e.Percentile){t=m(e.Percentile.Expression,t);if(t)return M.SQExprBuilder.percentile(t,e.Percentile.K,e.Percentile.Exclusive||!1,e.Annotations)}}(e,t)||function(e,t){if(e.RangePercent){var r=m(e.RangePercent.Min,t),t=m(e.RangePercent.Max,t);if(r&&t)return M.SQExprBuilder.rangePercent(r,t,e.RangePercent.Percent,e.Annotations)}}(e,t)||function(e,t){if(e.Arithmetic){var r=m(e.Arithmetic.Left,t),t=m(e.Arithmetic.Right,t);if(r&&t)return M.SQExprBuilder.arithmetic(r,t,e.Arithmetic.Operator,e.Annotations)}}(e,t)||function(e,t){if(e.Floor){t=m(e.Floor.Expression,t);if(t)return M.SQExprBuilder.floor(t,e.Floor.Size,e.Floor.TimeUnit,e.Annotations)}}(e,t)||function(e,t){if(e.Discretize){t=m(e.Discretize.Expression,t);if(t)return M.SQExprBuilder.discretize(t,e.Discretize.Count,e.Annotations)}}(e,t)||function(e,t){if(e.Member){t=m(e.Member.Expression,t);if(t)return M.SQExprBuilder.member(t,e.Member.Member,e.Annotations)}}(e,t)||function(e,t){if(e.Hierarchy){t=m(e.Hierarchy.Expression,t);if(t)return M.SQExprBuilder.hierarchy(t,e.Hierarchy.Hierarchy,e.Annotations)}}(e,t)||function(e,t){if(e.HierarchyLevel){t=m(e.HierarchyLevel.Expression,t);if(t)return M.SQExprBuilder.hierarchyLevel(t,e.HierarchyLevel.Level,e.Annotations)}}(e,t)||function(e,t){if(e.PropertyVariationSource){t=m(e.PropertyVariationSource.Expression,t);if(t)return M.SQExprBuilder.propertyVariationSource(t,e.PropertyVariationSource.Name,e.PropertyVariationSource.Property,e.Annotations)}}(e,t)||function(e,t){if(e.And){var r=m(e.And.Left,t),t=m(e.And.Right,t);if(r&&t)return M.SQExprBuilder.and(r,t,e.Annotations)}}(e,t)||function(e,t){if(e.Between){var r=m(e.Between.Expression,t),i=m(e.Between.LowerBound,t),t=m(e.Between.UpperBound,t);if(r&&i&&t)return M.SQExprBuilder.between(r,i,t,e.Annotations)}}(e,t)||function(e,t){if(e.In){if(e.In.Values)return M.SQExprBuilder.inValues(y(e.In.Expressions,t),_.map(e.In.Values,function(e){return y(e,t)}));var r=m(e.In.Table,t);return r?M.SQExprBuilder.inTable(y(e.In.Expressions,t),r,e.Annotations):void 0}}(e,t)||function(e,t){if(e.Or){var r=m(e.Or.Left,t),t=m(e.Or.Right,t);if(r&&t)return M.SQExprBuilder.or(r,t,e.Annotations)}}(e,t)||function(e,t){if(e.Contains){var r=m(e.Contains.Left,t),t=m(e.Contains.Right,t);if(r&&t)return M.SQExprBuilder.contains(r,t,e.Annotations)}}(e,t)||function(e,t){if(e.Comparison){var r=m(e.Comparison.Left,t),t=m(e.Comparison.Right,t);if(r&&t)return M.SQExprBuilder.compare(e.Comparison.ComparisonKind,r,t,e.Annotations)}}(e,t)||function(e){if(e.Conditional){for(var t=e.Conditional.Cases,r=t.length,i=new Array(r),a=0;a<r;a++){var n=function(e){if(e){var t=m(e.Condition),e=m(e.Value);if(t&&e)return{condition:t,value:e}}}(t[a]);if(!n){i=void 0;break}i[a]=n}if(e.Conditional.DefaultValue){var o=m(e.Conditional.DefaultValue);if(i&&o)return M.SQExprBuilder.conditional(i,o,e.Annotations)}else if(i)return M.SQExprBuilder.conditional(i,void 0,e.Annotations)}}(e)||function(e,t){if(e.DateAdd){t=m(e.DateAdd.Expression,t);if(t)return M.SQExprBuilder.dateAdd(e.DateAdd.TimeUnit,e.DateAdd.Amount,t,e.Annotations)}}(e,t)||function(e,t){if(e.DateSpan){t=m(e.DateSpan.Expression,t);if(t)return M.SQExprBuilder.dateSpan(e.DateSpan.TimeUnit,t,e.Annotations)}}(e,t)||function(e,t){if(e.Exists){t=m(e.Exists.Expression,t);if(t)return M.SQExprBuilder.exists(t,e.Annotations)}}(e,t)||function(e,t){if(e.Not){t=m(e.Not.Expression,t);if(t)return M.SQExprBuilder.not(t,e.Annotations)}}(e,t)||function(e){if(e.Now)return M.SQExprBuilder.now(e.Annotations)}(e)||function(e){if(e.DefaultValue)return M.SQExprBuilder.defaultValue(e.Annotations)}(e)||function(e){if(e.AnyValue)return M.SQExprBuilder.anyValue(e.AnyValue.DefaultValueOverridesAncestors,e.Annotations)}(e)||function(e,t){if(e.StartsWith){var r=m(e.StartsWith.Left,t),t=m(e.StartsWith.Right,t);if(r&&t)return M.SQExprBuilder.startsWith(r,t,e.Annotations)}}(e,t)||function(e,t){if(e.FillRule){var r,i=m(e.FillRule.Input,t),a=e.FillRule,n={},o=a.FillRule.linearGradient2,a=a.FillRule.linearGradient3;return o?(n.linearGradient2={min:S(o.min,t),max:S(o.max,t)},(r=x(o.nullColoringStrategy,t))&&(n.linearGradient2.nullColoringStrategy=r)):a&&(n.linearGradient3={min:S(a.min,t),mid:S(a.mid,t),max:S(a.max,t)},(r=x(a.nullColoringStrategy,t))&&(n.linearGradient3.nullColoringStrategy=r)),M.SQExprBuilder.fillRule(i,n,e.Annotations)}}(e,t)||function(e){if(e.ThemeDataColor)return M.SQExprBuilder.themeDataColor(e.ThemeDataColor.ColorId,e.ThemeDataColor.Percent,e.Annotations)}(e)||function(e){if(e.ResourcePackageItem)return M.SQExprBuilder.resourcePackageItem(e.ResourcePackageItem.PackageName,e.ResourcePackageItem.PackageType,e.ResourcePackageItem.ItemName,e.Annotations)}(e)||function(e,t){if(e.ScopedEval){var r=m(e.ScopedEval.Expression,t);if(r)return M.SQExprBuilder.scopedEval(r,y(e.ScopedEval.Scope,t),e.Annotations)}}(e,t)||function(e,t){if(e.FilteredEval){var r=m(e.FilteredEval.Expression,t);return M.SQExprBuilder.filteredEval(r,_.map(e.FilteredEval.Filters,function(e){return D.filter(e,t)}),e.Annotations)}}(e,t)||function(e){if(e.WithRef)return M.SQExprBuilder.withRef(e.WithRef.ExpressionName,e.Annotations)}(e)||function(e){if(e.TransformTableRef)return M.SQExprBuilder.transformTableRef(e.TransformTableRef.Source,e.Annotations)}(e)||function(e){if(e.TransformOutputRoleRef)return M.SQExprBuilder.transformOutputRoleRef(e.TransformOutputRoleRef.Role,e.TransformOutputRoleRef.Transform,e.Annotations)}(e)||function(e){if(e.Literal)return M.PrimitiveValueEncoding.parseValueToSQExpr(e.Literal.Value)}(e)||function(e,t){if(e.GroupRef){var r=m(e.GroupRef.Expression,t),i=_.map(e.GroupRef.GroupedColumns,function(e){return d.create(e,t)});if(r&&!_.isEmpty(i))return M.SQExprBuilder.groupRef(e.GroupRef.Property,r,i,e.Annotations)}}(e,t)||function(e){if(e.RoleRef)return M.SQExprBuilder.roleRef(e.RoleRef.Role,e.Annotations)}(e)||function(e){if(e.AllRolesRef)return M.SQExprBuilder.allRolesRef(e.Annotations)}(e)||function(e){if(e.NamedQueryReference)return M.SQExprBuilder.namedQueryRef(e.NamedQueryReference.Name,void 0,e.Annotations)}(e)||function(e){if(e.Subquery)return M.SQExprBuilder.subqueryRef(s.deserializeQuery(e.Subquery.Query),e.Annotations)}(e)||g(e)||function(e){if(e.SummaryValueRef)return M.SQExprBuilder.summaryValueRef(e.SummaryValueRef.Name,e.Annotations)}(e)||function(e,t){var r=e.SparklineData;if(r)return M.SQExprBuilder.sparklineData(m(r.Measure,t),y(r.Groupings,t),r.ScalarKey?m(e.SparklineData.ScalarKey,t):void 0,r.PointsPerSparkline,r.IncludeMinGroupingInterval)}(e,t)}function f(e){return m(e,null)}function y(e,t){for(var r=[],i=0,a=e.length;i<a;i++)r.push(m(e[i],t));return r}function g(e){return function(e){if(e.Boolean)return M.SQExprBuilder.boolean(e.Boolean.Value,e.Annotations)}(e)||w(e)||function(e){if(e.DateTimeSecond){var t=I(e.DateTimeSecond);return M.SQExprBuilder.dateSpan(5,M.SQExprBuilder.dateTime(t),e.Annotations)}}(e)||w(e)||function(e){if(e.Decimal){var t=e.Decimal.Value;return M.SQExprBuilder.decimal(t,void 0,e.Annotations)}}(e)||function(e){if(e.Integer){var t=e.Integer.Value;return M.SQExprBuilder.integer(t,void 0,e.Annotations)}}(e)||function(e){if(e.Null)return M.SQExprBuilder.nullConstant()}(e)||function(e){if(e.Number)return M.PrimitiveValueEncoding.parseValueToSQExpr(e.Number.Value)}(e)||function(e){if(e.String){var t=e.String.Value;return M.SQExprBuilder.text(t,void 0,e.Annotations)}}(e)}function S(e,t){if(e){var r={color:m(e.color,t)};return e.value&&(r.value=m(e.value,t)),r}}function x(e,t){if(e){var r={strategy:m(e.strategy,t)};return e.color&&(r.color=m(e.color,t)),r}}function w(e){var t=e.DateTime||e.Date;if(t){t=I(t);if(t)return M.SQExprBuilder.dateTime(t,void 0,e.Annotations)}}function I(e){return jsCommon.DateExtensions.tryDeserializeDate(e.Value)}(d=p=e.ExprBuilder||(e.ExprBuilder={})).create=m,d.createStandalone=f,d.createConst=g,d.createFromSourceExpression=f})((M=b.data||(b.data={})).services||(M.services={}))}(powerbi=powerbi||{}),function(a){var e;(function(e){e.AnomalyDetectionTransformPluginName="SampleAndDetectAnomaly";var t="TimeSeriesColumnRole",r="ValueColumnRole";e.AnomalyDetectionColumns={ExpectedValue:"ExpectedValue",ExpectedLow:"ExpectedLow",ExpectedHigh:"ExpectedHigh",RawScore:"RawScore",Anomaly:"Anomaly",BatchStart:"BatchStart",BatchEnd:"BatchEnd"},e.AnomalyDetectionOutputRoles=_.mapValues(e.AnomalyDetectionColumns,function(e){return"anomalyDetection."+e});var i=_.mapValues(e.AnomalyDetectionColumns,function(e){return e+"Role"}),t={name:e.AnomalyDetectionTransformPluginName,inputRoles:[{name:t,visualDataRoleMatching:{cartesianKind:0}},{name:r,visualDataRoleMatching:{cartesianKind:1}}],outputRoles:[{name:e.AnomalyDetectionOutputRoles.ExpectedValue,algorithmRole:i.ExpectedValue,columnName:e.AnomalyDetectionColumns.ExpectedValue,kind:a.VisualDataRoleKind.Measure,joinPredicateBehavior:0},{name:e.AnomalyDetectionOutputRoles.ExpectedLow,algorithmRole:i.ExpectedLow,columnName:e.AnomalyDetectionColumns.ExpectedLow,kind:a.VisualDataRoleKind.Measure,joinPredicateBehavior:0},{name:e.AnomalyDetectionOutputRoles.ExpectedHigh,algorithmRole:i.ExpectedHigh,columnName:e.AnomalyDetectionColumns.ExpectedHigh,kind:a.VisualDataRoleKind.Measure,joinPredicateBehavior:0},{name:e.AnomalyDetectionOutputRoles.RawScore,algorithmRole:i.RawScore,columnName:e.AnomalyDetectionColumns.RawScore,kind:a.VisualDataRoleKind.Measure,joinPredicateBehavior:0},{name:e.AnomalyDetectionOutputRoles.Anomaly,algorithmRole:i.Anomaly,columnName:e.AnomalyDetectionColumns.Anomaly,kind:a.VisualDataRoleKind.Measure,joinPredicateBehavior:0},{name:e.AnomalyDetectionOutputRoles.BatchStart,algorithmRole:i.BatchStart,columnName:e.AnomalyDetectionColumns.BatchStart,kind:a.VisualDataRoleKind.Measure,joinPredicateBehavior:0},{name:e.AnomalyDetectionOutputRoles.BatchEnd,algorithmRole:i.BatchEnd,columnName:e.AnomalyDetectionColumns.BatchEnd,kind:a.VisualDataRoleKind.Measure,joinPredicateBehavior:0}]},r={name:"Forecast",inputRoles:[{name:"X",visualDataRoleMatching:{cartesianKind:0}},{name:"Y",visualDataRoleMatching:{cartesianKind:1}}],outputRoles:[{name:"forecast.ForecastValue",algorithmRole:"Forecast",columnName:"forecastValue",kind:a.VisualDataRoleKind.Measure},{name:"forecast.ConfidenceHighBound",algorithmRole:"UpperBound",columnName:"confidenceHighBound",kind:a.VisualDataRoleKind.Measure},{name:"forecast.ConfidenceLowBound",algorithmRole:"LowerBound",columnName:"confidenceLowBound",kind:a.VisualDataRoleKind.Measure}]},i={name:"KMeansClustering",inputRoles:[{name:"Attribute",visualDataRoleMatching:{matchMeasure:!0,skipJoinPredicateNone:!0}},{name:"Item",visualDataRoleMatching:{matchGrouping:!0}}],outputRoles:[{name:"Series",algorithmRole:"ClusterId",columnName:"clusterId",kind:a.VisualDataRoleKind.Grouping}]};e.plugins=((i={Forecast:r,KMeansClustering:i})[e.AnomalyDetectionTransformPluginName]=t,i)})((e=a.data||(a.data={})).transforms||(e.transforms={}))}(powerbi=powerbi||{}),function(r){var i;i=r.data||(r.data={}),function(){(i.transforms||(i.transforms={})).createTransformPluginService=function(){return new e};var e=(t.prototype.getTransformPlugin=function(e){if(e)return this.plugins[e]},t);function t(){this.plugins=r.data.transforms.plugins}}()}(powerbi=powerbi||{}),function(e){var t,r,i,s,u,c;function a(){return null!==i&&i.apply(this,arguments)||this}t=e.data||(e.data={}),r=t.dsr||(t.dsr={}),t=e.data.DefaultSQExprVisitorWithArg,s=e.data.SQExprBuilder,u=e.data.SQHierarchyExpr,c=e.data.SQPropertyVariationSourceExpr,e.data.SQEntityExpr,__extends(a,i=t),a.prototype.visitColumnRef=function(e,t){if(e.hasGroupOnKeys(t)){var t=e.getConceptualProperty(t),r=e.getTargetEntity();return _.map(t.column.keys,function(e){return s.columnRef(r,e.name)})}return[e]},a.prototype.visitHierarchyLevel=function(e,t){var r=e.arg.getTargetEntity();if(!r)return[e];if(e.arg instanceof u){var i=void 0,a=r.schema,n=e.arg;if(n.arg instanceof c){var o=n.arg,o=t.schema(a).findTargetEntityOfVariation(r.entity,o.property,o.name);if(!o)return[e];i=s.entity(a,o.name)}else i=r,n.arg;n=t.schema(a).findHierarchyLevel(i.entity,n.hierarchy,e.level).column.name;return this.visitColumnRef(s.columnRef(i,n),t)}return[e]},a.prototype.visitGroupRef=function(e,t){return this.visitColumnRef(e,t)},a.prototype.visitDefault=function(e){return[e]},t=a,r.SelectToIdentityExpressionsVisitor=t}(powerbi=powerbi||{}),function(e){var a,l;function o(e,t){return!e||!t||_.isEqual(e,t)}function s(e,t){t&&(e.select||(e.select=[]),(e=e.select).push.apply(e,t||[]))}((a=e.data||(e.data={})).dsr||(a.dsr={})).mergeMappings=function(e,t){var r=e.length;if(1===r)return{mapping:e[0]};for(var i,a,n,o=[],s=e[0].updateType,u=0;u<r;u++){var c=e[u];if(a=c.updateType,n=s,s=null===a||0===a||null===n||0===n?0:a===n?a:1===a||1===n?1:2,!c.categorical)return;0===u&&(i={metadata:c.metadata,categorical:{}}),l.mergeCategorical(i.categorical,c.categorical),o.push(l.createSplit(t,c.categorical))}return i.updateType=s,{mapping:i,splits:o}},(e=l=l||{}).mergeCategorical=function(e,t){var r,i,a,n;t.categories&&(e.categories?function(e,t){if(!e&&!t)return;if(e&&t){if(!e.categories&&!t.categories)return;if(e.categories&&t.categories){var r=e.categories,i=t.categories;if(!o(r.dataReductionAlgorithm,i.dataReductionAlgorithm))return;e=r,t=i;if(e.bind||t.bind)return _.isEqual(e.bind,t.bind);e=r,t=i;if(e.for||t.for)return _.isEqual(e.for,t.for);r=r,i=i;return(r.select||i.select)&&_.isEqual(r.select,i.select)}}}(e,t):e.categories=t.categories),null==t.dataVolume&&null==e.dataVolume||(n=Math.max(t.dataVolume||0,e.dataVolume||0),t.dataVolume=e.dataVolume=n),t.dataReductionAlgorithm&&(e.dataReductionAlgorithm?o(t.dataReductionAlgorithm,e.dataReductionAlgorithm):e.dataReductionAlgorithm=t.dataReductionAlgorithm),t.values&&(r=(r=e.values)||(e.values={}),i=(a=t.values).group,n=r,((t=a).bind||t.for)&&(n.select||(n.select=[]),n.select.push(t)),s(r,a.select),i&&((a=e.values.group)?s(a,i.select):e.values.group={select:i.select.concat([]),by:i.by,dataReductionAlgorithm:i.dataReductionAlgorithm}))},e.createSplit=function(t,e){var r={selects:{}},i={visitRole:function(e){return function(e,t,r){var i=r.items;if(!_.isEmpty(r.items))for(var a=[],n=0,o=i;n<o.length;n++){var s=o[n].queryName,s=t[s];a[s]||(e.selects[s]=!0,a[s]=!0)}}(r,t,e)}};return a.CompiledDataViewMapping.visitCategoricalCategories(e.categories,i),a.CompiledDataViewMapping.visitGrouped(e.values,i),a.CompiledDataViewMapping.visitCategoricalValues(e.values,i),r}}(powerbi=powerbi||{}),function(e){(e=(e=e.data||(e.data={})).QueryCacheOptions||(e.QueryCacheOptions={}))[e.None=0]="None",e[e.AllowCache=1]="AllowCache",e[e.AllowQuery=2]="AllowQuery",e[e.CacheResult=4]="CacheResult",e[e.PreventRefresh=8]="PreventRefresh"}(powerbi=powerbi||{}),function(a){var n;(function(e){var t=(u.findAndParseCalculation=function(e,t){t=this.findCalculation(e,t);if(t)return n.PrimitiveValueEncoding.parseValue(t.Value)},u.findAndParseCalculationToSQExpr=function(e,t){t=this.findCalculation(e,t);if(t)return n.PrimitiveValueEncoding.parseValueToSQExpr(t.Value)},u.findCalculation=function(e,t){for(var r=0,i=e.length;r<i;r++){var a=e[r];if(a.Id===t)return a}},u.describeDataType=function(e,t){var r=0;switch(e=e||0){case 2048:r=1;break;case 1:r=3;break;case 3:r=4;break;case 4096:r=5;break;case 20:r=6;break;case 4:r=7;break;case 8:r=9;break;case 67:r=4,t="Years";break;case 35:r=4,t="Months"}return a.ValueType.fromPrimitiveTypeAndCategory(r,t)},u.getTopLevelSecondaryDynamicMember=function(e,t){e=e.SecondaryHierarchy;return e?t&&t.Secondary?u.getDynamicMember(e,t.Secondary.Groupings,0):u.getDynamicMemberFallback(e):null},u.getTopLevelPrimaryDynamicMember=function(e,t,r){var i,a=e.PrimaryHierarchy;return a?(r&&(i=void 0!==e.Calculations),t&&t.Primary?u.getDynamicMember(a,t.Primary.Groupings,0,i):u.getDynamicMemberFallback(a,i)):null},u.getDynamicMember=function(e,t,r,i){if(0===e.length)return null;if(!t||0===t.length)return u.getDynamicMemberFallback(e,i);var a=t[r].Member;if(!a)return u.getDynamicMemberFallback(e,i);for(var n=0,o=e;n<o.length;n++){var s=o[n];if(s.Id===a)return s}return null},u.getDynamicMemberFallback=function(e,t){return 2===e.length?e[1]:void 0===t||!0===t?e[0]:null},u.fillMetadataColumnAggregate=function(e,t,r){void 0===r&&(r=!0);var i=t.source.aggregates;switch(i||(t.source.aggregates=i={}),t.aggregateKind){case 1:return void(i.subtotal=e);case 2:return void(i.max=e);case 3:return void(i.min=e);case 4:return void(r||(i.single=e));case 5:return void(i.count=e);case 6:return void(i.average=e);case 8:return void(i.median=e);case 7:var a=t.aggregate.Percentile,n=(n=i.percentiles)||(i.percentiles=[]),o={k:a.K,value:e};return null!=a.Exclusive&&(o.exclusive=a.Exclusive),void n.push(o)}},u.copyAggregates=function(e,t){void 0!==e.subtotal&&(t.subtotal=e.subtotal),void 0!==e.min&&(t.min=e.min),void 0!==e.max&&(t.max=e.max),void 0!==e.minLocal&&(t.minLocal=e.minLocal),void 0!==e.maxLocal&&(t.maxLocal=e.maxLocal),void 0!==e.count&&(t.count=e.count)},u.computeAggIdx=function(e,t,r,i){return e+(i-t)*(r+1)},u);function u(){}e.DataShapeUtility=t;Object.defineProperty(r.prototype,"name",{get:function(){return"maxLocal"},enumerable:!1,configurable:!0}),r.prototype.update=function(e){var t;"number"!=typeof e||isNaN(e)||(t=this.current,this.current=void 0===t?e:Math.max(t,e))},r.prototype.value=function(){return this.current},t=r;function r(){}e.MaxValueAggregator=t;Object.defineProperty(i.prototype,"name",{get:function(){return"minLocal"},enumerable:!1,configurable:!0}),i.prototype.update=function(e){var t;"number"!=typeof e||isNaN(e)||(t=this.current,this.current=void 0===t?e:Math.min(t||0,e))},i.prototype.value=function(){return this.current},t=i;function i(){}e.MinValueAggregator=t})((n=a.data||(a.data={})).dsr||(n.dsr={}))}(powerbi=powerbi||{}),function(l){var p=l.ClientErrorStrings,o=jsCommon.StringExtensions;l.DMTS_MultipleGatewaysWithAllDatasourcesToBindError="DMTS_MultipleGatewaysWithAllDatasourcesToBindError",l.DMTS_DatasourceHasNoCredentialError="DMTS_DatasourceHasNoCredentialError",l.DMTS_OAuthTokenRefreshFailedError="DMTS_OAuthTokenRefreshFailedError",l.DM_GWPipeline_Client_GatewayUnreachable="DM_GWPipeline_Client_GatewayUnreachable",l.DM_GWPipeline_Client_OAuthTokenRefreshFailedError="DM_GWPipeline_Client_OAuthTokenRefreshFailedError",l.DMTS_UserLostPermissionToDatasourceError="DMTS_UserLostPermissionToDatasourceError",l.DMTS_UserNotFoundInADGraphError="DMTS_UserNotFoundInADGraphError",l.DM_GWPipeline_Gateway_DataSourceAccessError="DM_GWPipeline_Gateway_DataSourceAccessError",l.DM_GWPipeline_Gateway_ImpersonationError="DM_GWPipeline_Gateway_ImpersonationError",l.DM_GWPipeline_Gateway_InvalidMashupConnectionString="DM_GWPipeline_Gateway_InvalidMashupConnectionString",l.DM_GWPipeline_Gateway_DatabaseLoginError="DM_GWPipeline_Gateway_DatabaseLoginError",l.DM_GWPipeline_Gateway_SqlTimeoutException="DM_GWPipeline_Gateway_SqlTimeoutException",l.DM_GWPipeline_Gateway_AdomdTimeoutException="DM_GWPipeline_Gateway_AdomdTimeoutException",l.DM_GWPipeline_Gateway_InvalidObjectNameException="DM_GWPipeline_Gateway_InvalidObjectNameException",l.DM_GWPipeline_Gateway_InvalidConnectionCredentials="DM_GWPipeline_Gateway_InvalidConnectionCredentials",l.DM_GWPipeline_Gateway_ConnectionBrokenException="DM_GWPipeline_Gateway_ConnectionBrokenException",l.DM_GWPipeline_Gateway_MemoryError="DM_GWPipeline_Gateway_MemoryError",l.DM_GWPipeline_Gateway_MissingStructureError="DM_GWPipeline_Gateway_MissingStructureError",l.DM_GWPipeline_Gateway_UnprocessedStructureError="DM_GWPipeline_Gateway_UnprocessedStructureError",l.DM_GWPipeline_Gateway_ModelLoadError="DM_GWPipeline_Gateway_ModelLoadError",l.DM_GWPipeline_Gateway_CancellationError="DM_GWPipeline_Gateway_CancellationError",l.DM_GWPipeline_Gateway_CancellationOrTimeoutError="DM_GWPipeline_Gateway_CancellationOrTimeoutError",l.DM_GWPipeline_Gateway_QueryExecutionError="DM_GWPipeline_Gateway_QueryExecutionError",l.DM_GWPipeline_Gateway_RecalculationRequiredError="DM_GWPipeline_Gateway_RecalculationRequiredError",l.DM_GWPipeline_Gateway_TimeoutError="DM_GWPipeline_Gateway_TimeoutError",l.DM_GWPipeline_Gateway_AdomdConnectError="DM_GWPipeline_Gateway_AdomdConnectError",l.DM_GWPipeline_Gateway_GatewayOverloadedMemory="DM_GWPipeline_Gateway_GatewayOverloadedMemory",l.DM_GWPipeline_Gateway_GatewayOverloadedConcurrency="DM_GWPipeline_Gateway_GatewayOverloadedConcurrency",l.DM_GWPipeline_Gateway_MashupDataAccessError="DM_GWPipeline_Gateway_MashupDataAccessError",l.DM_GWPipeline_Gateway_DatabaseConnectError="DM_GWPipeline_Gateway_DatabaseConnectError",l.DM_GWPipeline_Gateway_ServerUnreachable="DM_GWPipeline_Gateway_ServerUnreachable",l.DM_GWPipeline_Gateway_GatewayOverloadedProcessor="DM_GWPipeline_Gateway_GatewayOverloadedProcessor",l.RS_AccessDenied="rsAccessDenied",l.azureValues="azure:values",l.KnownDsrClientErrors={ComplexSlicerNotAllowedWithMeasures:{localizedContent:"DsrError_ComplexSlicerNotAllowedWithMeasuresValue"},ComplexHighlightsNotAllowed:{localizedContent:"DsrError_ComplexHighlightsNotAllowed_Details",localizedMessage:"DsrError_ComplexHighlightsNotAllowed_ShortMessage"},CouldNotResolveModelReferencesInSemanticQuery:{localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContent:"DsrError_CouldNotResolveModelRefErrorValNoItems",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelRefErrorValFormat",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690865"},ExclusivePercentileOutOfRange:{localizedMessage:"DsrError_ExclusivePercentileOutOfRangeMessage",localizedTitle:"DsrError_ExclusivePercentileOutOfRangeKey",localizedContent:"DsrError_ExclusivePercentileOutOfRangeValue"},InvalidDataShapeNoOutputData:{localizedContent:"DsrError_InvalidDataShapeValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690860"},InvalidUnconstrainedJoin:{localizedTitle:"DsrError_InvalidUnconstrainedJoinKey",localizedContent:"DsrError_InvalidUnconstrainedJoinValue",helpLink:"https://go.microsoft.com/fwlink/?linkid=2186131"},IsRelatedToManyNotSupportedForDetailTable:{localizedMessage:"DsrError_IsRelatedToManyNotSupportedForDetailTableMessage",localizedTitle:"DsrError_IsRelatedToManyNotSupportedForDetailTableKey",localizedContent:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueFormat"},AA_PowerBIScriptPayloadTooLargeError:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746290"},AA_PowerBIScriptResultTooLargeError:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746291"},AA_PowerBIScriptReturnedNoImageError:{localizedMessage:"DsrError_ScriptReturnedNoImageMessage",localizedTitle:"DsrError_ScriptReturnedNoImageKey",localizedContent:"DsrError_ScriptReturnedNoImageContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733479"},AA_PowerBIScriptRuntimeErrorError:{localizedTitle:"DsrError_ScriptRuntimeErrorKey",localizedMessage:"DsrError_ScriptRuntimeErrorMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=733477"},AA_PowerBIScriptTimeoutError:{localizedMessage:"DsrError_ScriptTimeoutMessage",localizedTitle:"DsrError_ScriptTimeoutKey",localizedContent:"DsrError_ScriptTimeoutContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733478"},AA_PowerBIRequestsQueueOverflowError:{localizedTitle:"DsrError_RequestsQueueOverflowKey",localizedMessage:"DsrError_RequestsQueueOverflowMessage",localizedContent:"DsrError_RequestsQueueOverflowContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799576"},AA_PowerBIScriptRuntimeMaxMemoryError:{localizedTitle:"DsrError_ScriptRuntimeMaxMemoryKey",localizedMessage:"DsrError_ScriptRuntimeMaxMemoryMessage",localizedContent:"DsrError_ScriptRuntimeMaxMemoryContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799578"},AA_PowerBIScriptRuntimeMaxDiskIOError:{localizedTitle:"DsrError_ScriptRuntimeMaxDiskIOKey",localizedMessage:"DsrError_ScriptRuntimeMaxDiskIOMessage",localizedContent:"DsrError_ScriptRuntimeMaxDiskIOContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799579"},AA_PowerBIScriptMissingDependencyError:{localizedTitle:"DsrError_ScriptRuntimeMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeMissingDependencyMessage",localizedContent:"DsrError_ScriptRuntimeMissingDependencyContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799857"},AA_PowerBIScriptSpecificPackageWithMissingDependencyError:{localizedTitle:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799858"},AA_PowerBIScriptSpecificPackageMissingSpecificDependencyError:{localizedTitle:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799859"},AA_PowerBIScriptMissingSpecificPackageError:{localizedTitle:"DsrError_ScriptRuntimeMissingSpecificPackageKey",localizedMessage:"DsrError_ScriptRuntimeMissingSpecificPackageMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=800225"},ModelMeasuresNotSupportedForDetailTable:{localizedMessage:"DsrError_ModelMeasuresNotSupportedForDetailTableMessage",localizedTitle:"DsrError_ModelMeasuresNotSupportedForDetailTableKey",localizedContent:"DsrError_ModelMeasuresNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_ModelMeasuresNotSupportedForDetailTableValueFormat"},ModelUnavailable:{localizedContent:"DsrError_ModelUnavailableValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},NoUniqueKeyForDetailTable:{localizedContent:"DsrError_NoUniqueKeyForDetailTableValue"},OverlappingKeysOnOppositeHierarchies:{localizedTitle:"DsrError_OverlappingKeysKey",localizedContent:"DsrError_OverlappingKeysValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690863"},rsQueryMemoryLimitExceeded:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},rsQueryTimeoutExceeded:{localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},rsAccessDenied:{localizedMessage:"DsrError_NoPermissionMessage",localizedTitle:"DsrError_NoPermissionKey",localizedContent:"DsrError_NoAccessForVisual",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},UnsupportedDateTimeLiteral:{localizedMessage:"DsrError_UnsupportedDateTimeMessage",localizedTitle:"DsrError_UnsupportedDateTimeKey",localizedContent:"DsrError_UnsupportedDateTimeValueNoItems",localizedContentWithAffectedItems:"DsrError_UnsupportedDateTimeValueFormat"},InvalidExtensionDax_UnclosedBracketIdentifier:{localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedBracketIdentifier"},InvalidExtensionDax_UnexpectedCloseParenthesis:{localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnexpectedCloseParenthesis"},InvalidFilterComparisonIncompatibleExpressions:{localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},InvalidFilterConditionIncompatibleDataType:{localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},ExtensionMeasureEmptyExpression:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureEmptyExpression"},ExtensionMeasureNameNotUniqueModel:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUniqueModel"},ExtensionMeasureNameNotUnique:{localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUnique"},CouldNotResolveModelReferencesInQueryExtensionSchema:{localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelReferencesInQueryExtensionSchema"},QueryExtensionMeasureError:{localizedContentWithAffectedItemsAndPosition:"DsrError_QueryExtensionMeasureError",localizedContentWithAffectedItemsAndPositionAndDetails:"DsrError_QueryExtensionMeasureErrorWithDetails"},QueryExtensionMeasureUnexpectedEndOfUserInput:{localizedContentWithAffectedItems:"DsrError_QueryExtensionMeasureUnexpectedEndOfUserInput"},UnsupportedDataSourceVariables:{localizedMessage:"DsrError_UnsupportedDataSourceVariablesMessage",localizedTitle:"DsrError_UnsupportedDataSourceVariablesKey",localizedContent:"DsrError_UnsupportedDataSourceVariablesContent"},DataExtensionMissingResultSet:{localizedMessage:"DsrError_DataExtensionMissingResultSetMessage",localizedTitle:"DsrError_DataExtensionMissingResultSetKey",localizedContent:"DsrError_DataExtensionMissingResultSetContent"},CannotUseMultiColumnFilteringWithMappedColumns:{localizedContent:"DsrError_DQP_CannotUseMultiColumnFilteringWithMappedColumns",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},DifferentMappingsWithinSubqueries:{localizedContent:"DsrError_DQP_DifferentMappingsWithinSubqueries",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},FilterIncompatibleWithParameter:{localizedContent:"DsrError_DQP_FilterIncompatibleWithParameter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},FoundMultipleTargetsWithAtLeastOneMapping:{localizedContent:"DsrError_DQP_FoundMultipleTargetsWithAtLeastOneMapping",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},FoundParameterMappingOnUnsupportedFilter:{localizedContent:"DsrError_DQP_FoundParameterMappingOnUnsupportedFilter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},InTableConditionNotSupportedWithMappedParameters:{localizedContent:"DsrError_DQP_InTableConditionNotSupportedWithMappedParameters",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},InvalidMappedParameterValueExpression:{localizedContent:"DsrError_DQP_InvalidMappedParameterValueExpression",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MappedTargetMustMatchMappedCondition:{localizedContent:"DsrError_DQP_MappedTargetMustMatchMappedCondition",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MixOfAssignedAndUnassignedColumnsWithinORExpression:{localizedContent:"DsrError_DQP_MixOfAssignedAndUnassignedColumnsWithinORExpression",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MultipleParameterAssignmentsWithinORUnsupported:{localizedContent:"DsrError_DQP_MultipleParameterAssignmentsWithinORUnsupported",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},MultipleParameterMappingsUnsupported:{localizedContent:"DsrError_DQP_MultipleParameterMappingsUnsupported",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},ParameterMappingFilterConflict:{localizedContent:"DsrError_DQP_ParameterMappingFilterConflict",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},ParameterMappingsFoundWithinFilteredEvalExpressionFilter:{localizedContent:"DsrError_DQP_ParameterMappingsFoundWithinFilteredEvalExpressionFilter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},ParameterMappingsNotSupportedOnHighlights:{localizedContent:"DsrError_DQP_ParameterMappingsNotSupportedOnHighlights",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},SingleValueParameterWithMultipleValues:{localizedContent:"DsrError_DQP_SingleValueParameterWithMultipleValues",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"}};var e=(Object.defineProperty(d,"maxNumberOfCommaValues",{get:function(){return 9},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"code",{get:function(){return this.oDataCode},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"oDataErrorMessage",{get:function(){if(this.oDataError&&this.oDataError.message&&this.oDataError.message.value)return this.oDataError.message.value},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"source",{get:function(){switch(this.oDataError.source){case"PowerBI":return"PowerBI";case"External":return"External";case"Unknown":return;case"User":return d.isCodeKnown(this.code)?"User":void 0}this.oDataError.source},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"AdditionalErrorMessages",{get:function(){if(this.oDataError){var e=this.oDataError[l.azureValues];if(!_.isEmpty(e))for(var t=0,r=e;t<r.length;t++){var i=r[t];if(!_.isEmpty(i.additionalMessages))return i.additionalMessages}}},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"powerBiErrorDetails",{get:function(){if(this.oDataError){var e=this.oDataError[l.azureValues];if(!_.isEmpty(e))for(var t=0,r=e;t<r.length;t++){var i=r[t];if(!_.isEmpty(i.powerBiErrorDetails))return i.powerBiErrorDetails}}},enumerable:!1,configurable:!0}),d.prototype.getDetails=function(e){var t=this.oDataError[l.azureValues],r=null;if(t)for(var i=0,a=t;i<a.length;i++){var n=a[i];if(n.details){r=n.details;break}}var o=d.getErrorDetailsFromStatusCode(this.code,this.oDataErrorMessage,r,this.AdditionalErrorMessages,e),t=o.displayableErrorInfo[0].errorInfoKey;return!d.isCodeKnown(this.code)&&r&&(o.displayableErrorInfo=[]),r&&(e=0===o.displayableErrorInfo.length?t:e.get("DsrError_MoreInfo"),o.displayableErrorInfo.push({errorInfoKey:e,errorInfoValue:r})),d.isDynamicQueryParameterErrorCode(this.code)&&(o.hideDebugInfo=!0),o},d.getErrorDetailsFromStatusCode=function(e,t,r,i,a){var n=a.get("DsrError_Key"),o=a.get("DsrError_UnknownErrorValue"),s=a.get("DsrError_Message"),u=jsCommon.PowerBIDefaultHelpPage,c=l.KnownDsrClientErrors[e];c&&(n=c.localizedTitle?a.get(c.localizedTitle):n,o=d.getContent(e,r,i,c,a)||o,s=c.localizedMessage?a.get(c.localizedMessage):s,u=c.helpLink||u,c.useODataErrorMessageAsContent&&(o=t||s));u={message:s,displayableErrorInfo:[{errorInfoKey:n,errorInfoValue:o}],helpLink:u,debugErrorInfo:[]};return!c&&e&&u.debugErrorInfo.push({errorInfoKey:p.ErrorCode,errorInfoValue:e}),c&&c.useODataErrorMessageAsContent||!t||u.debugErrorInfo.push({errorInfoKey:p.ODataErrorMessage,errorInfoValue:t}),u},d.getContent=function(e,t,r,i,a){if(i.localizedContentWithAffectedItemsAndPosition||i.localizedContentWithAffectedItemsAndPositionAndDetails){var n=d.findAdditionalMessageWithAffectedItemsAndPosition(e,r);if(i.localizedContentWithAffectedItemsAndPositionAndDetails&&t&&n)return o.format(a.get(i.localizedContentWithAffectedItemsAndPositionAndDetails),o.constructCommaSeparatedList(n.AffectedItems,a,d.maxNumberOfCommaValues),l.formattingService.formatValue(n.Line),l.formattingService.formatValue(n.Position),t);if(i.localizedContentWithAffectedItemsAndPosition&&n)return o.format(a.get(i.localizedContentWithAffectedItemsAndPosition),o.constructCommaSeparatedList(n.AffectedItems,a,d.maxNumberOfCommaValues),l.formattingService.formatValue(n.Line),l.formattingService.formatValue(n.Position))}if(i.localizedContentWithAffectedItems){r=d.getAffectedItemsFromStatusCode(e,r);if(0<r.length)return o.format(a.get(i.localizedContentWithAffectedItems),o.constructCommaSeparatedList(r,a,d.maxNumberOfCommaValues))}if(i.localizedContent)return a.get(i.localizedContent)},d.findAdditionalMessageWithAffectedItemsAndPosition=function(t,e){return _.find(e,function(e){return e.Code===t&&!_.isEmpty(e.AffectedItems)&&null!=e.Position&&null!=e.Line})},d.getAffectedItemsFromStatusCode=function(e,t){for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.Code===e)return a.AffectedItems||[]}return[]},d.prototype.parseCode=function(){var e=this.oDataError.code,t=this.oDataError[l.azureValues],r=[];if(t)for(var i=0,a=t;i<a.length;i++){var n=a[i];n.additionalMessages&&(r=n.additionalMessages)}if(0<r.length)for(var o=0,s=r;o<s.length;o++){var u=s[o];if(d.isCodeKnown(u.Code)){e=u.Code;break}}return e},d.isCodeKnown=function(e){return d.isGeneralKnownErrorCode(e)||d.isDynamicQueryParameterErrorCode(e)},d.isGeneralKnownErrorCode=function(e){switch(e){case"ComplexSlicerNotAllowedWithMeasures":case"ComplexHighlightsNotAllowed":case"ExclusivePercentileOutOfRange":case"InvalidDataShapeNoOutputData":case"InvalidFilterComparisonIncompatibleExpressions":case"InvalidFilterConditionIncompatibleDataType":case"InvalidUnconstrainedJoin":case"ModelUnavailable":case"OverlappingKeysOnOppositeHierarchies":case"rsQueryMemoryLimitExceeded":case"rsQueryTimeoutExceeded":case"CouldNotResolveModelReferencesInSemanticQuery":case"QueryExtensionMeasureUnexpectedEndOfUserInput":case"rsAccessDenied":case"NoUniqueKeyForDetailTable":case"IsRelatedToManyNotSupportedForDetailTable":case"ModelMeasuresNotSupportedForDetailTable":case"UnsupportedDateTimeLiteral":case"InvalidExtensionDax_UnclosedBracketIdentifier":case"InvalidExtensionDax_UnexpectedCloseParenthesis":case"ExtensionMeasureEmptyExpression":case"ExtensionMeasureNameNotUniqueModel":case"ExtensionMeasureNameNotUnique":case"CouldNotResolveModelReferencesInQueryExtensionSchema":case"QueryExtensionMeasureError":case"UnsupportedDataSourceVariables":case"DataExtensionMissingResultSet":return!0;default:return!1}},d.isDynamicQueryParameterErrorCode=function(e){switch(e){case"CannotUseMultiColumnFilteringWithMappedColumns":case"DifferentMappingsWithinSubqueries":case"FilterIncompatibleWithParameter":case"FoundMultipleTargetsWithAtLeastOneMapping":case"FoundParameterMappingOnUnsupportedFilter":case"InTableConditionNotSupportedWithMappedParameters":case"InvalidMappedParameterValueExpression":case"MappedTargetMustMatchMappedCondition":case"MixOfAssignedAndUnassignedColumnsWithinORExpression":case"MultipleParameterAssignmentsWithinORUnsupported":case"MultipleParameterMappingsUnsupported":case"ParameterMappingFilterConflict":case"ParameterMappingsFoundWithinFilteredEvalExpressionFilter":case"ParameterMappingsNotSupportedOnHighlights":case"SingleValueParameterWithMultipleValues":return!0;default:return!1}},d);function d(e){this.oDataError=e,this.oDataCode=this.parseCode()}l.DsrClientError=e}(powerbi=powerbi||{}),function(e){!function(e){function t(e){this.httpService=e}e=e.bingSocial||(e.bingSocial={}),t.prototype.requestData=function(i,e,t){var r=[],a=t.getUrlTemplates(),n=t.getResponseFormatter();e=this.formatSearchKey(e);for(var o=0,s=a;o<s.length;o++){var u=s[o],c=$.Deferred();r.push(c),u=u.replace(/{{searchKey}}/g,encodeURIComponent(e)),this.makeRequest(u,c)}(1===r.length?r[0]:$.when.apply($,r)).pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=n.formatResponse(Array.prototype.slice.call(e));i.resolve(r)},i.reject)},t.prototype.formatSearchKey=function(e){return e=e.trim().toUpperCase(),e=this.removeEdgeBinaryOperator(e,"AND"),e=this.removeEdgeBinaryOperator(e,"OR")},t.prototype.removeEdgeBinaryOperator=function(e,t){return _.startsWith(e,t+" ")&&(e=t.toLowerCase()+e.slice(t.length)),e=_.endsWith(e," "+t)?e.slice(0,e.length-t.length)+t.toLowerCase():e},t.prototype.makeRequest=function(e,t){var r=this.httpService.powerbiRequestOptions();r.responseType="json",this.httpService.get(e,r).then(function(e){e=e.data;if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return t.reject()}t.resolve(e)},t.reject)},e.BingSocialClient=t}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){var i;(function(r){var u=jsCommon.StringExtensions;r.LimitMetadata=function(){};var e=(Object.defineProperty(s.prototype,"code",{get:function(){return"DsrLimitsWarning"},enumerable:!1,configurable:!0}),s.prototype.computeMetadata=function(e,t,r){var i,a,n,o;this.limits={},e.Limits&&(o=s.getExceededLimitsDetails(e,r),i=e.Limits,a=!!o.Primary,n=!!o.Secondary,r=!!o.Intersection,e.ScriptVisualBinding?this.hasScriptVisualBinding=!0:(o=e.Expressions&&e.Expressions.Primary&&e.Expressions.Primary.Groupings?e.Expressions.Primary.Groupings:[],e=e.Expressions&&e.Expressions.Secondary&&e.Expressions.Secondary.Groupings?e.Expressions.Secondary.Groupings:[],a&&n?(this.groupings=o.concat(e),this.limits.Primary=s.getLimitMetadata(i.Primary,t),this.limits.Secondary=s.getLimitMetadata(i.Secondary,t)):a?(this.groupings=o,this.limits.Primary=s.getLimitMetadata(i.Primary,t)):n&&(this.groupings=e,this.limits.Secondary=s.getLimitMetadata(i.Secondary,t)),r&&(this.limits.Intersection=s.getLimitMetadata(i.Intersection,t))))},s.prototype.getDetails=function(e){var t=!!this.limits.Primary,r=!!this.limits.Secondary,i=null,a=-1;this.hasScriptVisualBinding?i=e.get("DsrLimitWarning_TooMuchDataValMultipleColumns"):t||r?i=t&&r?(a=this.limits.Primary.Type,this.getErrorInfoValue(this.groupings,e.get("DsrLimitsWarning_MultipleColumnsWithIssuesFormat"),e)):(a=(t?this.limits.Primary:this.limits.Secondary).Type,this.getErrorInfoValue(this.groupings,s.getDetailedMessageFormatForOneColumn(a,e),e)):this.limits.Intersection&&(a=this.limits.Intersection.Type,i=s.getDetailedMessageFormatForOneColumn(a,e));i=i||e.get("DsrLimitWarning_TooMuchDataValMultipleColumns");return{message:s.getMessage(a,e),displayableErrorInfo:[{errorInfoKey:s.getKey(a,e),errorInfoValue:i}],helpLink:s.getHelpLink(a)}},s.getExceededLimitsDetails=function(e,t){for(var r=e.Limits,i={},a=0,n=t;a<n.length;a++){var o=n[a];r.Primary&&o.Id===r.Primary.Id?i.Primary=r.Primary:r.Secondary&&o.Id===r.Secondary.Id?i.Secondary=r.Secondary:r.Intersection&&o.Id===r.Intersection.Id&&(i.Intersection=r.Intersection)}return i},s.prototype.getErrorInfoValue=function(e,t,r){if(!e||0===e.length)return null;for(var i=[],a=0,n=e.length;a<n;a++){var o=e[a],o=this.getGroupingNameFromGroupingKeys(o);o&&i.push(o)}var s=i.length;return 0===s?null:(r=1===s?i[0]:i.join(r.get("ListJoin_Separator")),u.format(t,r))},s.prototype.getGroupingNameFromGroupingKeys=function(e){for(var t=e.Keys,r=0,i=t.length;r<i;r++){var a=t[r];if(null!==a.Select&&void 0!==a.Select)return this.columnNameFromIndex?this.columnNameFromIndex(a.Select):void 0}},s.getMessage=function(e,t){switch(e){case 2:return t.get("DsrLimitWarning_RepresentativeSampleMessage");case 3:case 4:return t.get("DsrLimitWarning_HighDensitySampleMessage");default:return t.get("DsrLimitWarning_TooMuchDataMessage")}},s.getKey=function(e,t){switch(e){case 2:return t.get("DsrLimitWarning_RepresentativeSampleKey");case 3:case 4:return t.get("DsrLimitWarning_HighDensitySampleKey");default:return t.get("DsrLimitWarning_TooMuchDataKey")}},s.getDetailedMessageFormatForOneColumn=function(e,t){switch(e){case 2:return t.get("DsrLimitWarning_RepresentativeSampleVal");case 3:return t.get("DsrLimitWarning_HighDensitySampleVal");case 4:return t.get("DsrLimitWarning_OverlappingPointsDetails");default:return t.get("DsrLimitWarning_TooMuchDataVal")}},s.getHelpLink=function(e){switch(e){case 3:return"https://go.microsoft.com/fwlink/?linkid=848757";case 4:return"https://go.microsoft.com/fwlink/?linkid=853820"}},s.getLimitMetadata=function(e,t){return e.Top?{Type:0,Count:s.getLimitCount(e.Top,t)}:e.Bottom?{Type:1,Count:s.getLimitCount(e.Bottom,t)}:e.Sample?{Type:2,Count:s.getLimitCount(e.Sample,t)}:e.BinnedLineSample?{Type:3,Count:s.getBinnedLineSampleCount(e.BinnedLineSample)}:e.OverlappingPointsSample?{Type:4,Count:s.getLimitCount(e.OverlappingPointsSample,t)}:{Type:-1,Count:null}},s.getLimitCount=function(e,t){if(e.Calc&&t){t=r.DataShapeUtility.findCalculation(t,e.Calc);if(t){t=i.PrimitiveValueEncoding.parseValue(t.Value);if(_.isNumber(t))return t}}return e.Count},s.getBinnedLineSampleCount=function(e){return e.MaxTargetPointCount},s);function s(e,t,r){t&&t.length,this.computeMetadata(e,r,t)}r.DsrLimitsWarning=e})((i=e.data||(e.data={})).dsr||(i.dsr={}))}(powerbi=powerbi||{}),function(e){(function(r){r.getDsrMessageSeverityValue=function(e){if(0===e)return"Warning"},r.KnownDsrMessages={"ForecastErrorType.DataIsTooSmall":{localizedMessage:"DsrMessage_NotEnoughDataMessage",localizedTitle:"DsrMessage_NotEnoughDataTitle",localizedContent:"DsrMessage_NotEnoughDataContent",isTransformMessage:!0},"ForecastErrorType.TooManyMissingValues":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.NoDominantStepDetected":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.InputTimeStampsNotSorted":{localizedMessage:"DsrMessage_UnsortedDataMessage",localizedTitle:"DsrMessage_UnsortedDataTitle",localizedContent:"DsrMessage_UnsortedDataContent",isTransformMessage:!0},"ForecastErrorType.XAxisIsNull":{localizedMessage:"DsrMessage_ForecastXValueNullMessage",localizedTitle:"DsrMessage_ForecastXValueNullTitle",localizedContent:"DsrMessage_ForecastXValueNullContent",isTransformMessage:!0},"ForecastErrorType.InvalidSeasonality":{localizedMessage:"DsrMessage_ForecastInvalidSeasonalityMessage",localizedTitle:"DsrMessage_ForecastInvalidSeasonalityTitle",localizedContent:"DsrMessage_ForecastInvalidSeasonalityContent",isTransformMessage:!0},"ForecastErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ForecastVariantDataTypeMessage",localizedTitle:"DsrMessage_ForecastVariantDataTypeTitle",localizedContent:"DsrMessage_ForecastVariantDataTypeContent",isTransformMessage:!0},"ForecastErrorType.Unexpected":{localizedMessage:"DsrMessage_ForecastErrorMessage",localizedTitle:"DsrMessage_ForecastErrorTitle",localizedContent:"DsrMessage_ForecastErrorContent",isTransformMessage:!0},ForecastTransformUnsupported:{localizedMessage:"DsrMessage_ForecastNotSupportedMessage",localizedTitle:"DsrMessage_ForecastNotSupportedTitle",localizedContent:"DsrMessage_ForecastNotSupportedContent",isTransformMessage:!0},"ClusteringErrorType.LessThanKDataPoints":{localizedMessage:"DsrMessage_ClusterTooManyClustersTitle",localizedTitle:"DsrMessage_ClusterTooManyClustersTitle",localizedContent:"DsrMessage_ClusterTooManyClustersContent",isTransformMessage:!0},"ClusteringErrorType.TooManyDataPoints":{localizedMessage:"DsrMessage_ClusterExceedsLimitTitle",localizedTitle:"DsrMessage_ClusterExceedsLimitTitle",localizedContent:"DsrMessage_ClusterExceedsLimitContent",isTransformMessage:!0},"ClusteringErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ClusterVariantDataTypeTitle",localizedTitle:"DsrMessage_ClusterVariantDataTypeTitle",localizedContent:"DsrMessage_ClusterVariantDataTypeContent",isTransformMessage:!0}};var e=(Object.defineProperty(t.prototype,"code",{get:function(){return this.dataShapeMessage.Code},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){var t=r.KnownDsrMessages[this.dataShapeMessage.Code];return{message:e.get(t.localizedMessage),displayableErrorInfo:[{errorInfoKey:e.get(t.localizedTitle),errorInfoValue:e.get(t.localizedContent)}]}},t.prototype.isTransformMessage=function(){var e=r.KnownDsrMessages[this.code];return e&&e.isTransformMessage},t);function t(e){this.dataShapeMessage=e}r.DsrMessage=e})((e=e.data||(e.data={})).dsr||(e.dsr={}))}(powerbi=powerbi||{}),function(v){var S,x,t,C;function D(e){if(2===e.Version)return!0}function l(e,t,r,i,a,n,o,s,u,c,l,p,d,h,m){if(!r)return null;var f;if(s=s||{},4&e&&(e|=8),D(r)){if(f="dsr2-read",performance&&performance.mark&&performance.mark(f+"-start"),s.mode="V2",1!==_.size(r.DS))return null;var y=x.createDsrParserContext(t),g=x.reader.V2.createDsrParser(r,y),y=function(e,t,r,i,a){var n,o,s,u,c,l={columns:e.createDataViewMetadataColumns()},p={dataView:{metadata:l}};{var d;(function(e,t){e.reset();e=e.dataShapes();e.count(),e.next(),e.complete()||(t.dataView.metadata.segment={},t.restartToken=e.restartTokens())})(t,p),e.includes(2)&&(d=C(function(){(n=x.converters.createMatrix(e,t,l,a,i.synchronizedGroupsEnabled,i.scopedMeasuresEnabled))&&(p.dataView.matrix=n,t.lockCache())}),n&&(r.matrix=d))}e.includes(1)&&(h=C(function(){(o=x.converters.categorical(e,t,l,i))&&(p.dataView.categorical=o,t.lockCache())}),o&&(r.categorical=h));{var h;e.includes(8)&&(h=C(function(){(s=x.converters.createTable(e,t,l))&&(p.dataView.table=s,t.lockCache())}),s&&(r.table=h))}e.includes(16)&&(m=C(function(){(u=x.converters.createTree(e,t))&&(p.dataView.tree=u,t.lockCache())}),u&&(r.tree=m));{var m;e.includes(4)&&(m=C(function(){(c=x.converters.createSingle(e,t))&&(p.dataView.single=c)}),c&&(r.single=m))}return p}(new x.DataViewConverterContext(e,t,y,h,g.dataShapes()),g,s,i,h);g.reset();h=g.dataShapes(),h.next();h.limitsExceeded()&&(y.warnings||(y.warnings=[]),g=new x.DsrLimitsWarning(t,x.toDsrV1Limit(h),x.toDsrV1Calc(h)),y.warnings.push(g),x.reader.V1.applyReductionMetadata(y.dataView,g.limits)),function(e,t){var r=e.messages();if(r)for(;r.next();)x.KnownDsrMessages[r.code()]&&r.severity()===x.getDsrMessageSeverityValue(0)&&(t.warnings||(t.warnings=[]),t.warnings.push(r.dsrMessage()))}(h,y),y.dataView&&!_.isEmpty(n)&&(S.ClientSideFilter.applyClientSideFilters(y.dataView,n),y.disallowPersisting=!0)}else f="dsr1-read",performance&&performance.mark&&performance.mark(f+"-start"),s.mode="V1Old",y=x.reader.V1.read(e,t,r,s,a,n,o);return y&&(y.timestamp=l,y.fromCache=p,d&&!y.fromCache&&(y.performanceActivities=x.parseExecutionEvents(d.Events,m&&m.getProperty("rootId")))),performance&&(performance.mark&&performance.mark(f+"-end"),performance.measure&&performance.measure(f,f+"-start",f+"-end")),s.total=jsCommon.performance.now()-c,u&&u.logEvent(v.telemetry.DataDsrToDataView,{jsonparse:s.jsonParse,categorical:s.categorical,table:s.table,tree:s.tree,matrix:s.matrix,single:s.single,script:s.script,total:s.total,mode:s.mode,targetDataView:e,dsrLength:s.dsrLength,id:o}),y}S=v.data||(v.data={}),x=S.dsr||(S.dsr={}),t=jsCommon.JsonExtensions,C=jsCommon.PerfTimer.logTime,x.isDsrV2=D,x.getDsrV2MinorVersion=function(e){return e.MinorVersion},x.read=function(e,t,r,i,a,n){if(!t)return null;var o;t.data&&(t=t.data),n&&n.isRunning()&&(o=n.createChildActivity({name:"Parse Query Result"}));var s={},u=t,c=jsCommon.performance.now();return _.isString(t)&&(s.dsrLength=t.length,s.jsonParse=C(function(){u=JSON.parse(t)}),o&&o.setProperty("metrics",{jsonParse:s.jsonParse})),n=l(e,u.descriptor,u.dsr,r,u.requestId,u.clientSideFilters,a,s,i,c,u.timestamp,u.fromCache,u.metrics,r.scopedAggregates,n),null==r||!r.queryContext||(r=u.queryContext)&&(n.queryContext=r),o&&o.resolve(),n},x.readDsr=l,x.containsRestartToken=function(e){return!!e&&(e=e.data,_.isString(e)&&(e=t.tryParseJSON(e)),!_.isEmpty(e)&&function(e){if(e)if(D(e)){for(var t=x.reader.V2.createDsrParser(e,void 0).dataShapes();t.next();)if(t.hasRestartTokens())return!0}else for(var e=e.DataShapes,r=0,i=e;r<i.length;r++){var a=i[r];if(!_.isEmpty(a.RestartTokens))return!0}return!1}(e.dsr))}}(powerbi=powerbi||{}),function(e){!function(e){var M,t;function p(e,t,r,i,a){null!=t.Select||t.ScriptVisualBinding,this.targets=e,this.descriptor=t,this.selects=t.Select,this.selectIndexToColumn={},this.aggregateCalcMetadata={},this._calcInfo={},this.calcIdToColumnIndices={},this.dataMemberIdToIdentityBuilder={};t=t.Expressions;this._primaryAxisGroupings=t&&t.Primary&&t.Primary.Groupings,this._secondaryAxisGroupings=t&&t.Secondary&&t.Secondary.Groupings,this.measureSelectIndices=[],this.dataMemberIdToMetadata=r.dataMemberIdToMetadata,this.maxPrimaryDepth=r.maxPrimaryDepth,this.maxSecondaryDepth=r.maxSecondaryDepth,this.primarySynchronizedGroups=r.primarySynchronizedGroups,this.scopedAggregatesEnabled=i,this.dataShapeParser=a}M=e.dsr||(e.dsr={}),t=jsCommon.EnumExtensions,Object.defineProperty(p.prototype,"primaryAxisGroupings",{get:function(){return this._primaryAxisGroupings},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"secondaryAxisGroupings",{get:function(){return this._secondaryAxisGroupings},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"calcInfo",{get:function(){return this._calcInfo},enumerable:!1,configurable:!0}),p.prototype.createContextForPrimarySynchronizedGroup=function(e,t){var r=this,t=new p(this.targets,this.descriptor,e.context,this.scopedAggregatesEnabled,t);return t._primaryAxisGroupings=_.map(e.groupings,function(e){return r.primaryAxisGroupings[e].SynchronizedGroup}),t._secondaryAxisGroupings=void 0,t._calcInfo=this._calcInfo,t},p.prototype.includes=function(e){return t.hasFlag(this.targets,e)},p.prototype.createDataViewMetadataColumns=function(){var e=this.selects;if(!_.isEmpty(e)){var t=[],r=e.length;this.selectIndexToColumnIndex=new Array(r);for(var i,a=0,n=r;a<n;a++){var o=e[a];if(o){o.Kind,M.SelectKind.None;var s=this.createColumns(t,a),u=s.column,c=s.columnIdx,l=s.dynamicFormatColumn;this.selectIndexToColumn[a]=u,this.selectIndexToColumnIndex[a]=c,o.Kind===M.SelectKind.Measure&&this.measureSelectIndices.push(a);s=o.Aggregates;if(s)for(var p=0,d=s;p<d.length;p++){var h=d[p],m=this.getAggregateKind(h.Aggregate);this.createAggregateCalcMetadata(h.Ids,m,u,a,h.Aggregate)}s=o.Value;s&&(this.calcIdToColumnIndices[s]||(this.calcIdToColumnIndices[s]=[]),this.calcIdToColumnIndices[s].push(c),null!=o.Depth&&null!=o.SecondaryDepth||(this.aggregateCalcMetadata[s]={source:u,aggregateKind:4,selectIdx:a})),o.Kind===M.SelectKind.Measure&&(o.Subtotal&&this.createAggregateCalcMetadata(o.Subtotal,1,u,a),o.SubtotalDynamicFormat&&this.createAggregateCalcMetadata(_.map(o.SubtotalDynamicFormat,function(e){return e&&e.Format}),1,l,a),o.Count&&(_.size(o.Count),this.createAggregateCalcMetadata(o.Count,5,u,a)),o.Max&&this.createAggregateCalcMetadata(o.Max,2,u,a),o.Min&&this.createAggregateCalcMetadata(o.Min,3,u,a))}}for(i in this.parseAxisGroupings(this.primaryAxisGroupings),this.parseAxisGroupings(this.secondaryAxisGroupings),this.calcIdToColumnIndices)1<_.size(this.calcIdToColumnIndices[i])&&(this.calcInfo[i].hasDuplicateColumnIndices=!0,this.calcInfo[i].isGroupKeyButNotSelect);return this.scopedAggregatesEnabled&&(this.createScopedAggregateMetadata(),this.fillDataShapeScopeAggregateValues()),t}},p.prototype.parseAxisGroupings=function(e){if(e)for(var t=0,r=e;t<r.length;t++){var i=r[t],a=i.SynchronizedGroup;a&&(this.parseGroupingKeys(a.Keys,!0),(a=i.SynchronizationIndex)&&(this.calcInfo[a]={kind:M.SelectKind.Measure,calcKind:10})),this.parseGroupingKeys(i.Keys,!1)}},p.prototype.parseGroupingKeys=function(e,t){for(var r,i=this.calcInfo,a=this.selects,n=0,o=e;n<o.length;n++){var s=o[n],u=a[s.Select];null!=u?t?(null===(r=u.Synchronized)||void 0===r||r.Value,i[null===(r=u.Synchronized)||void 0===r?void 0:r.Value].forIdentity=!0):i[u.Value].forIdentity=!0:s.Calc&&(i[s.Calc]={kind:M.SelectKind.Group,forIdentity:!0,isGroupKeyButNotSelect:!0})}},p.prototype.createAggregateCalcMetadata=function(e,t,r,i,a){for(var n=0,o=e;n<o.length;n++){var s=o[n],s=this.aggregateCalcMetadata[s]={source:r,aggregateKind:t,selectIdx:i};a&&(s.aggregate=a)}},p.prototype.getAggregateKind=function(e){return e.Average?6:e.Max?2:e.Min?3:e.Median?8:e.Percentile?7:void 0},p.prototype.createColumns=function(e,t){var r=e.length,i=this.createMetadataColumn(t);e.push(i);var a=this.selects[t],n=a.Kind,o=this.calcInfo;o[a.Value]={kind:n,columnIndex:r,selectIdx:t,calcKind:1};var s=a.Synchronized;if(s&&(M.SelectKind.Group,s.Value,s.GroupKeys,o[s.Value]={kind:n,columnIndex:r,selectIdx:t,calcKind:1},o[a.Value].isSynchronized=!0),a.Subtotal){M.SelectKind.Measure;for(var u=0,c=a.Subtotal;u<c.length;u++)o[I=c[u]]={columnIndex:r,kind:n,selectIdx:t,calcKind:2}}if(a.Highlight){M.SelectKind.Measure;s=a.Highlight.Value;s&&(o[s]={columnIndex:r,kind:n,selectIdx:t,calcKind:3});s=a.Highlight.Subtotal;if(s)for(var l=0,p=s;l<p.length;l++)o[I=p[l]]={columnIndex:r,kind:n,selectIdx:t,calcKind:9}}if(this.scopedAggregatesEnabled){if(!_.isEmpty(a.Aggregates))for(var d=0,h=a.Aggregates;d<h.length;d++)if((g=h[d]).Aggregate.Scope)for(var m=0,f=g.Ids;m<f.length;m++)o[f[m]]={columnIndex:r,kind:n,selectIdx:t,calcKind:7};var y=a.Highlight;if(y&&!_.isEmpty(y.Aggregates))for(var g,v=0,S=y.Aggregates;v<S.length;v++)if((g=S[v]).Aggregate.Scope)for(var x=0,C=g.Ids;x<C.length;x++)o[C[x]]={columnIndex:r,kind:n,selectIdx:t,calcKind:8}}y=this.tryCreateDynamicFormatColumnMetadata(t,i);if(y){M.SelectKind.Measure;var D=r+1;if(e.push(y),o[a.DynamicFormat.Format]={columnIndex:D,kind:M.SelectKind.Measure,selectIdx:t,calcKind:4},a.SubtotalDynamicFormat)for(var E=0,w=a.SubtotalDynamicFormat;E<w.length;E++){var I,b=(I=w[E])&&I.Format;b&&(o[b]={columnIndex:D,kind:M.SelectKind.Measure,selectIdx:t,calcKind:5})}a=a.Highlight&&a.Highlight.DynamicFormat&&a.Highlight.DynamicFormat.Format;a&&(o[a]={columnIndex:D,kind:M.SelectKind.Measure,selectIdx:t,calcKind:6})}return{column:i,columnIdx:r,dynamicFormatColumn:y}},p.prototype.createMetadataColumn=function(e){var t=this.selects[e],r={displayName:"",index:e};t.Format&&(r.format=t.Format),r.type=M.DataShapeUtility.describeDataType(t.Type,t.DataCategory),t.Kind===M.SelectKind.Measure&&(r.isMeasure=!0);var i=t.GroupKeys;if(i)for(var a=r.identityExprs=new Array(i.length),n=0;n<i.length;n++)a[n]=M.convertKey(i[n],e,this.selects);return r},p.prototype.tryCreateDynamicFormatColumnMetadata=function(e,t){e=this.selects[e];if(e.DynamicFormat&&e.DynamicFormat.Format){e={displayName:"",isMeasure:!0};return t.formatSource={formatString:e},e}},p.prototype.createScopedAggregateMetadata=function(){for(var e=this.selects,t=e.length,r=this.selectIndexToColumn,i=0,a=t;i<a;i++){var n=e[i];if(n){var o=n.Aggregates,s=r[i];if(!_.isEmpty(o))for(var u=0,c=o;u<c.length;u++){var l=c[u];this.createScopedAggregateCalcMetadata(l,s)}n=n.Highlight;if(n&&!_.isEmpty(n.Aggregates))for(var p=0,d=n.Aggregates;p<d.length;p++){l=d[p];this.createScopedAggregateCalcMetadata(l,s)}}}},p.prototype.createScopedAggregateCalcMetadata=function(e,t){var r=e.Aggregate,i=r.Scope;if(i){var a=this.selectIndexToColumn,n=i.PrimaryDepth;i.SecondaryDepth;for(var o=new Array(n),s=this.primaryAxisGroupings,u=0,c=0;c<n;c++)for(var l=0,p=s[c].Keys;l<p.length;l++){var d=p[l].Select,d=a[d];o[u++]=d}for(var h={column:t,inputScope:o,respectInstanceFilters:r.RespectInstanceFilters},e=e.Ids,m=this.calcInfo,f=0,y=e;f<y.length;f++){var g=m[y[f]];g.scopedAggregateCalcMetadata={metadata:h,aggregateKind:this.getAggregateKind(r)}}}},p.prototype.fillDataShapeScopeAggregateValues=function(){var c=this.dataShapeParser;if(c){var l=this.calcInfo;c.reset();for(c.next();c.nextCalc();)!function(){var e=l[c.calcId()];if(!e||!e.scopedAggregateCalcMetadata)return;var t=e.scopedAggregateCalcMetadata,r=t.metadata,i=r.column,a=r.inputScope,n=r.respectInstanceFilters,o={inputScope:a,respectInstanceFilters:n,values:{},highlight:{}};i.scopedAggregates?(r=_.find(i.scopedAggregates,function(e){return p.sameScopedAggregatesInputScope(e.inputScope,a)&&e.respectInstanceFilters===n}))?o=r:i.scopedAggregates.push(o):i.scopedAggregates=[o];var s=void 0;switch(e.calcKind){case 7:s=o.values;break;case 8:s=o.highlight}var u=c.calcValue();switch(t.aggregateKind){case 3:s.min=u;break;case 2:s.max=u;break;case 6:s.avg=u}}()}},p.sameScopedAggregatesInputScope=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},M.DataViewConverterContext=p}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(a){var e,n;function o(t,e,r,i,a,n,o){var s={enumerable:!0,configurable:!0,get:function(){return i.logEvent(a,{targetDataView:n,visualType:o}),delete e[r],t[r]},set:function(e){t[r]=e}};Object.defineProperty(e,r,s)}e=a.data||(a.data={}),n=a.Prototype,(e.DataViewTelemetry||(e.DataViewTelemetry={})).wrapKindProperties=function(e,t,r){var i=n.inherit(e);return o(e,i,"tree",t,a.telemetry.DataDataViewKindAccess,16,r),o(e,i,"single",t,a.telemetry.DataSampledDataViewKindAccess,4,r),i}}(powerbi=powerbi||{}),function(e){!function(a){var S,r;function e(e){this.values=e,this.parsedValues=new Array(e.length),this.parsedValueExprs=new Array(e.length)}function t(e){if(e)for(var t in this.resolvedValueDictionaries={},e)this.resolvedValueDictionaries[t]=new r(e[t])}function x(e,t,r,i,a,n){var o=i[r]=[],i=function(e,t){for(var r=e.length,i=new Array(r),a=0;a<r;a++)i[a]=u(e[a],e[a].Select,t);return i}(t.Keys,a),a=t.Member;a&&(o.push(a),s=e[a]={identityFields:i,axisGrouping:t,kind:1,depth:r+1},n?s.forSynchronization=!0:t.SynchronizedGroup&&(s.isSynchronized=!0),t.RestartIdentities&&(s.restartValuesBuilder=new S.RestartValuesBuilder(t.RestartIdentities)));var s,a=t.SubtotalMember;a&&(o.push(a),s={identityFields:i,kind:2,depth:r},n?s.forSynchronization=!0:t.SynchronizedGroup&&(s.isSynchronized=!0),e[a]=s)}function u(e,t,r){e=e.Source;if(e)return a.SQExprBuilder.columnRef(a.SQExprBuilder.entity(S.schemaName(e),e.Entity||e.EntitySet),e.Property);0<=t&&_.size(r);t=r[t].Name;return t?a.SQExprBuilder.selectRef(t):void 0}S=a.dsr||(a.dsr={}),e.prototype.getCalcValue=function(e,t){if(!(e>=this.parsedValues.length)){var r=this.parsedValues[e];return void 0===r&&(r=a.PrimitiveValueEncoding.parseOptimizedValue(this.values[e],t),this.parsedValues[e]=r),r}},e.prototype.getCalcValueExpr=function(e,t,r){if(!(t>=this.parsedValues.length)){var i=this.parsedValueExprs[t];return void 0===i&&(i=a.PrimitiveValueEncoding.parseOptimizedValueToSQExpr(e,this.values[t],r),this.parsedValueExprs[t]=i),i}},r=e,t.prototype.getCalcValue=function(e,t,r){if(t&&"number"==typeof e){this.resolvedValueDictionaries;t=this.resolvedValueDictionaries[t];return t.getCalcValue(e,r)}},t.prototype.getCalcValueExpr=function(e,t,r,i){if(r&&"number"==typeof t){this.resolvedValueDictionaries;r=this.resolvedValueDictionaries[r];return r.getCalcValueExpr(e,t,i)}},S.ValueDictionaryHandler=t,S.createDsrParserContext=function(e){var t=e.Select,r=e.Expressions,i=r&&r.Primary,a=i&&i.Groupings,n=i&&i.Synchronization,o=r&&r.Secondary&&r.Secondary.Groupings,s={},u=a&&[],c=o&&[];if(a)for(var l=0,p=a.length;l<p;l++)x(s,a[l],l,u,t);if(o)for(l=0,p=o.length;l<p;l++)c[l]=[],x(s,o[l],l,c,t);var d=0,h=[];if(t&&o)for(l=0;l<t.length;l++){var m=t[l];m&&m.Kind===S.SelectKind.Measure&&null==m.Depth&&null==m.SecondaryDepth&&(h[d++]=l)}var f={intersectionMeasureToSelectIndex:h,secondaryLeafDataMemberId:o&&[],dataMemberIdToMetadata:s,selects:t,maxPrimaryDepth:_.size(a),maxSecondaryDepth:_.size(o),memberInstanceCalcMetadataCache:{},calcIdToCalcMetadata:{},intersectionCalcMetadataCache:{},primaryDataMemberIdCache:u,secondaryDataMemberIdCache:c,instancesCalcCache:{},lastIntersectionCalcCache:{},locked:!1};if(n){var y=n.length;f.primarySynchronizedGroups=new Array(y);for(l=0;l<y;l++){var g=n[l],v=_.last(g.Groupings);f.primarySynchronizedGroups[l]={groupings:g.Groupings,dataShapeId:g.DataShape,synchronizationIndexCalcId:a[v].SynchronizationIndex,context:function(e,t){e.Expressions.Primary;for(var r=e.Expressions.Primary.Groupings,i=e.Select,a={},n=[],o=t.Groupings,s=0;s<o.length;s++){var u=o[s];x(a,r[u].SynchronizedGroup,s,n,i,!0)}return{dataMemberIdToMetadata:a,selects:i,maxPrimaryDepth:_.size(o),primaryDataMemberIdCache:n,memberInstanceCalcMetadataCache:{},calcIdToCalcMetadata:{},locked:!1,intersectionCalcMetadataCache:{},maxSecondaryDepth:0,secondaryDataMemberIdCache:void 0,instancesCalcCache:{},lastIntersectionCalcCache:{},intersectionMeasureToSelectIndex:[],secondaryLeafDataMemberId:void 0}}(e,g)}}}return f},S.convertKey=u}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){!function(n){var e;function t(e,t){this.context=e,this.calcIdToGroupingKeysIndex={},this.initialize(t)}e=n.dsr||(n.dsr={}),t.prototype.initialize=function(e){var t,r=this.context,i=r.selects,a=r.dataMemberIdToMetadata[e];this.identityFields=a.identityFields,this.identityFieldsCount=this.identityFields.length;var n=a.axisGrouping.Keys;n.length,this.identityFieldsCount;for(var o=0;o<this.identityFieldsCount;o++){var s=n[o],u=void 0;s.Calc?u=s.Calc:null!=s.Select&&0<=s.Select&&(u=a.forSynchronization?null===(t=i[s.Select].Synchronized)||void 0===t?void 0:t.Value:i[s.Select].Value),this.calcIdToGroupingKeysIndex[u]=o}},t.prototype.reset=function(){this.identityParts=new Array(this.identityFieldsCount)},t.prototype.addExpr=function(e,t){var r=this.calcIdToGroupingKeysIndex[e],e=this.identityFields[r];e&&(this.identityParts[r]=n.SQExprBuilder.equal(e,t))},t.prototype.getIdentity=function(){for(var e,t=this.identityParts,r=this.identityFieldsCount,i=0;i<r;i++)e=n.SQExprBuilder.and(e,t[i]);var a=n.createDataViewScopeIdentity(e);return a},t.prototype.getIdentityFields=function(){return this.identityFields},e.IdentityBuilder=t}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){!function(e){var u;function t(e){this.context=e,this.measureValueAggregatorsBySelectIdx=[]}u=e.dsr||(e.dsr={}),t.prototype.read=function(e,t){void 0===t&&(t=!0);for(var r=this.context,i=r.selects,a=new Array(i.length),n=new Array(i.length);e.nextCalc();){var o=r.aggregateCalcMetadata[e.calcId()];o&&o.aggregateKind&&(u.DataShapeUtility.fillMetadataColumnAggregate(e.calcValue(),o,!1),3===o.aggregateKind&&(a[o.selectIdx]=!0),2===o.aggregateKind&&(n[o.selectIdx]=!0))}t&&this.addLocalAggregators(a,n)},t.prototype.addLocalAggregators=function(e,t){for(var r=this.measureValueAggregatorsBySelectIdx,i=this.context.measureSelectIndices,a=i.length,n=!1,o=0;o<a;o++){var s=i[o];e[s]||(n=!0,r[s]||(r[s]=[]),r[s].push(new u.MinValueAggregator)),t[s]||(n=!0,r[s]||(r[s]=[]),r[s].push(new u.MaxValueAggregator))}this.hasLocalAggregators=n},t.prototype.update=function(e,t){if(this.hasLocalAggregators){t=this.measureValueAggregatorsBySelectIdx[t];if(t)for(var r=0,i=t;r<i.length;r++)i[r].update(e)}},t.prototype.copyToColumns=function(){for(var e=this.context.measureSelectIndices,t=e.length,r=0;r<t;r++){var i=e[r],a=this.context.selectIndexToColumn[i],i=this.measureValueAggregatorsBySelectIdx[i];if(i&&i)for(var n=0,o=i;n<o.length;n++){var s=o[n],u=s.value();void 0!==u&&(a.aggregates||(a.aggregates={}),a.aggregates[s.name]=u)}}},u.Aggregator=t}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(e){var n,h;n=e.data||(e.data={}),h=n.dsr||(n.dsr={}),function(){(h.converters||(h.converters={})).categorical=function(e,t,r,i){if(a.isCompatible(e))return(new a).run(e,t,r)};var a=(e.prototype.run=function(e,t,r){this.metadata=r,this.context=e,this.dsrParser=t,this.selectIndexToCategoryColumn={},this.selectIndexToPrimaryValueColumn={},this.selectIndexToDynamicFormatColumn={},this.intersectionValueColumnsMap=[],this.intersectionDynamicFormatColumnsMap=[],this.primaryMeasureCount=0,this.intersectionMeasureCount=0,this.seriesSelectIndex=-1,this.primaryMeasureSelectIndexMap=[],this.intersectionMeasuresSelectIndexMap=[],this.selectIndexToValueColumnsMap=[],t.reset(),this.aggregator=new h.Aggregator(e);var i=this.dsrParser.dataShapes();i.next();var a,r={};return 0===e.maxPrimaryDepth?(this.readSelectsAndCreateCategoryColumns(void 0,void 0),a=r.values=n.DataViewTransform.createValueColumns(),this.readMeasuresWithNoGrouping(i,a)):(t=[],r.categories=e=[],this.readSelectsAndCreateCategoryColumns(e,t),a=void 0,(0<this.intersectionMeasureCount||0<this.primaryMeasureCount||0<=this.seriesSelectIndex)&&(r.values=a=n.DataViewTransform.createValueColumns()),this.readSecondaryAndCreateValueColumns(a),this.readData(i,a,t,t={}),void 0!==t.value&&(r.lastMergeIndex=t.value)),r},e.isCompatible=function(e){return e.maxPrimaryDepth<=1&&e.maxSecondaryDepth<=1&&!(0===e.maxPrimaryDepth&&0<e.maxSecondaryDepth)&&0<_.size(e.selects)},e.prototype.readSelectsAndCreateCategoryColumns=function(e,t){var r=this.context,i=r.selectIndexToColumn,a=r.selects,n=a.length,r=this.dsrParser.dataShapes().secondaryHierarchy();this.primaryMeasureSelectIndexMap=new Array(a.length),this.intersectionMeasuresSelectIndexMap=new Array(a.length);for(var o=!!r,s=0;s<n;s++){var u,c=a[s];c&&c.Value&&(c.Kind===h.SelectKind.Group?null==c.SecondaryDepth?null!=c.Depth&&(u={source:i[s],values:[],identity:t},e.push(u),this.selectIndexToCategoryColumn[s]=u):this.seriesSelectIndex=s:c.Kind===h.SelectKind.Measure&&(o&&null==c.Depth?this.intersectionMeasuresSelectIndexMap[this.intersectionMeasureCount++]=s:this.primaryMeasureSelectIndexMap[this.primaryMeasureCount++]=s))}},e.prototype.readSecondaryAndCreateValueColumns=function(e){var t=this.dsrParser.dataShapes().secondaryHierarchy();!t?this.addPrimaryValueColumns(e,!0):(this.addIntersectionValueColumns(e,t),0<this.primaryMeasureCount&&this.addPrimaryValueColumns(e))},e.prototype.addIntersectionValueColumns=function(e,t){for(var r=new Array,i=this.context;t.next();){var a=t.id(),n=t.instances();if(2!==i.dataMemberIdToMetadata[a].kind){var o=i.dataMemberIdToIdentityBuilder[a];o||(o=new h.IdentityBuilder(i,a),i.dataMemberIdToIdentityBuilder[a]=o);for(var a=o.getIdentityFields(),s=-1;n.next();){s++,o.reset();for(var u=void 0,c=void 0;n.nextCalc();){var c=n.calcId(),l=this.context.calcInfo[c];l.isGroupKeyButNotSelect||(u=n.calcValue()),l.forIdentity&&o.addExpr(c,n.calcValueAsExpr())}this.addIntersectionValueColumnsCore(e,r,c,u,s,o.getIdentity()),n.intersections(),n.members()}0===e.length&&0===r.length&&this.addIntersectionValueColumnsCore(e,r,void 0,void 0,0,void 0),e.grouped=function(){return r},e.source=this.context.selectIndexToColumn[this.seriesSelectIndex],e.identityFields=a}else for(;n.next(););}},e.prototype.addIntersectionValueColumnsCore=function(o,e,t,s,u,c){for(var l,p,d,h=this.context,m=h.selects,r=this.intersectionMeasureCount,f=new Array(r),y=this.metadata.columns,g=this,i=0;i<r;i++)!function(e){var t=void 0,r=g.intersectionMeasuresSelectIndexMap[e];void 0!==s?(t=h.createColumns(y,r).column).groupName=s:t=_.find(y,function(e){return e.index===r});var i=g.createValueColumn(t,c,r,!!m[r].Highlight,!1);o.push(i),f[e]=i;var a=m[r],n=g.intersectionValueColumnsMap[u];(n=n||(g.intersectionValueColumnsMap[u]={}))[a.Value]=i;e=a.Highlight&&a.Highlight.Value;e&&(n[e]=i),t.formatSource&&t.formatSource.formatString&&(null===(l=a.DynamicFormat)||void 0===l||l.Format,i=g.createValueColumn(t.formatSource.formatString,void 0,r,!!m[r].Highlight,!0),(t=(t=g.intersectionDynamicFormatColumnsMap[u])||(g.intersectionDynamicFormatColumnsMap[u]={}))[a.DynamicFormat.Format]=i,o.push(i),(a=null===(d=null===(p=a.Highlight)||void 0===p?void 0:p.DynamicFormat)||void 0===d?void 0:d.Format)&&(t[a]=i))}(i);var a={values:f};void 0!==s&&(a.name=s),void 0!==c&&(a.identity=c),e.push(a)},e.prototype.addPrimaryValueColumns=function(e,t){for(var r,i=new Array,a=this.context,n=a.selects,o=0;o<this.primaryMeasureCount;o++){var s=this.primaryMeasureSelectIndexMap[o],u=a.selectIndexToColumn[s],c=this.createValueColumn(u,void 0,s,!!n[s].Highlight,!1);this.selectIndexToPrimaryValueColumn[s]=c,i.push(c),e.push(c),u.formatSource&&u.formatSource.formatString&&(u=this.createValueColumn(u.formatSource.formatString,void 0,s,!!n[s].Highlight,!0),this.selectIndexToDynamicFormatColumn[s]=u,e.push(u),i.push(u))}t&&e&&(r=[{values:i}],e.grouped=function(){return r})},e.prototype.createValueColumn=function(e,t,r,i,a){e={source:e,values:[]};return i&&(e.highlights=[]),t&&(e.identity=t),a||(this.selectIndexToValueColumnsMap[r]||(this.selectIndexToValueColumnsMap[r]=[])).push(e),e},e.prototype.readData=function(e,t,r,i){var a=this.context,n=e.primaryHierarchy();for(this.aggregator.read(e,0===this.intersectionMeasureCount);n.next();){var o=n.id(),s=a.dataMemberIdToMetadata[o];if(s){var s=1===s.kind,u=a.dataMemberIdToIdentityBuilder[o];!u&&s&&(u=new h.IdentityBuilder(a,o),a.dataMemberIdToIdentityBuilder[o]=u);for(var c=n.instances();c.next();){for(u&&u.reset(),1===c.restartFlagKind()&&(i.value=c.currentIndex());c.nextCalc();)this.readPrimaryHierarchyCalc(c,u);u&&r.push(u.getIdentity()),this.parseIntersections(c),c.members()}if(s)for(var l=u.getIdentityFields(),p=0;p<a.selects.length;p++){var d=this.selectIndexToCategoryColumn[p];d&&(d.identityFields=l)}}}this.aggregator.copyToColumns(),this.copyAggregatesToValueColumns()},e.prototype.copyAggregatesToValueColumns=function(){for(var e=this.context.measureSelectIndices,t=this.context.selectIndexToColumn,r=e.length,i=0;i<r;i++){var a=e[i],n=t[a].aggregates;if(n){var o=this.selectIndexToPrimaryValueColumn[a];o&&h.DataShapeUtility.copyAggregates(n,o);a=this.selectIndexToValueColumnsMap[a];if(a)for(var s=0,u=a;s<u.length;s++){var c=u[s];h.DataShapeUtility.copyAggregates(n,c)}}}},e.prototype.readPrimaryHierarchyCalc=function(e,t){var r,i=e.calcId(),a=this.context.aggregateCalcMetadata[i];a&&1===a.aggregateKind?h.DataShapeUtility.fillMetadataColumnAggregate(e.calcValue(),a):(r=this.context.calcInfo[i])&&(a=e.calcValue(),r.kind===h.SelectKind.Group?(r.isGroupKeyButNotSelect||this.selectIndexToCategoryColumn[r.selectIdx].values.push(a),r.forIdentity&&t.addExpr(i,e.calcValueAsExpr())):r.kind===h.SelectKind.Measure&&(1===(e=r.calcKind)?(this.selectIndexToPrimaryValueColumn[r.selectIdx].values.push(a),this.aggregator.update(a,r.selectIdx)):4===e?this.selectIndexToDynamicFormatColumn[r.selectIdx].values.push(a):3===e?this.selectIndexToPrimaryValueColumn[r.selectIdx].highlights.push(a):6===e&&this.selectIndexToDynamicFormatColumn[r.selectIdx].highlights.push(a)))},e.prototype.parseIntersections=function(e){var t=e.intersections();if(t)for(var r=this.context.calcInfo,i=0;t.next();){var a=this.intersectionValueColumnsMap[i],n=this.intersectionDynamicFormatColumnsMap[i];if(t.nextCalc()&&this.parseIntersectionCalc(t,a,n,r))for(i++;t.nextCalc();)this.parseIntersectionCalc(t,a,n,r)}},e.prototype.parseIntersectionCalc=function(e,t,r,i){var a=e.calcId(),i=i[a];if(i)switch(i.kind,h.SelectKind.Measure,i.calcKind){case 1:return t[a].values.push(e.calcValue()),!0;case 3:return t[a].highlights.push(e.calcValue()),!0;case 4:return r[a].values.push(e.calcValue()),!0;case 6:return r[a].highlights.push(e.calcValue()),!0;case 2:case 5:return!1}},e.prototype.readMeasuresWithNoGrouping=function(e,t){this.aggregator.read(e),this.aggregator.copyToColumns();e=e.primaryHierarchy();if(e.next()){this.addPrimaryValueColumns(t,!0);for(var r=this.context.calcInfo,i=e.instances();i.next();)for(;i.nextCalc();){var a=r[i.calcId()];a&&(a.selectIdx,1===a.calcKind?this.selectIndexToPrimaryValueColumn[a.selectIdx].values.push(i.calcValue()):3===a.calcKind?this.selectIndexToPrimaryValueColumn[a.selectIdx].highlights.push(i.calcValue()):4===a.calcKind?this.selectIndexToDynamicFormatColumn[a.selectIdx].values.push(i.calcValue()):6===a.calcKind&&this.selectIndexToDynamicFormatColumn[a.selectIdx].highlights.push(i.calcValue()))}}},e);function e(){}}()}(powerbi=powerbi||{}),function(g){var e,N;e=g.data||(g.data={}),N=e.dsr||(e.dsr={}),function(){(N.converters||(N.converters={})).createMatrix=function(e,t,r,i,a,n){return new o(e,t,r,i,a,n).run()};var o=(e.prototype.run=function(){var e=this.aggregator,t=this.dsrParser;t.reset();var r=t.dataShapes();this.calcInfoCache={};r.next();this.createHierarchiesLevels(),this.readValueSources(r),0<this.context.maxPrimaryDepth||_.isEmpty(this.context.measureSelectIndices),e.read(r,1===this.context.maxPrimaryDepth&&0===this.context.maxSecondaryDepth);var i=r.secondaryHierarchy(),t=this.readHierarchy(1,i,r),i=r.primaryHierarchy(),r=this.readHierarchy(0,i,r);return e.copyToColumns(),{rows:r,columns:t,valueSources:this.valueSources}},e.prototype.createHierarchiesLevels=function(){var e=this.context.selects,t=this.context.maxPrimaryDepth,r=this.context.maxSecondaryDepth;this.primaryHierarchyLevels=new Array(t),this.secondaryHierarchyLevels=new Array(r);for(var i=0;i<t;i++)this.primaryHierarchyLevels[i]={sources:[]};for(i=0;i<r;i++)this.secondaryHierarchyLevels[i]={sources:[]};for(var a=this.metadata.columns,n=a.length,o=this.columnIndexToZoneIndex=new Array(n),i=0;i<n;i++){var s,u=a[i],c=u.index;null!=c&&(s=void 0,(c=e[c]).Kind===N.SelectKind.Group&&(null!=c.Depth?s=this.primaryHierarchyLevels[c.Depth].sources:null!=c.SecondaryDepth&&(s=this.secondaryHierarchyLevels[c.SecondaryDepth].sources),o[i]=s.length,s.push(u)))}},e.prototype.readHierarchy=function(e,t,r){var i,a=this.valueSources.length;switch(e){case 0:if(i=this.context.primaryAxisGroupings,this.context.maxPrimaryDepth,!i)return this.createRowHierarchyForNoGroupings(t);break;case 1:if(i=this.context.secondaryAxisGroupings,this.context.maxSecondaryDepth,!i)return 0===a?{levels:[],root:{children:[]}}:this.createColumnHierarchyForNoGroupings()}_.size(i);var n,o={levels:0===e?this.primaryHierarchyLevels:this.secondaryHierarchyLevels,root:{}};1===e&&1<a&&o.levels.push(this.createColumnHierarchyMeasuresLevel()),this.synchronizedGroupsEnabled&&(n=this.context.primarySynchronizedGroups,0===e&&n&&this.readRowsSynchronizedGroups(n,o,r));r=this.context;return this.readNodeChildren(r,r.calcInfo,this.columnIndexToZoneIndex,r.dataMemberIdToIdentityBuilder,r.dataMemberIdToMetadata,o.root,t,0,e,a,this.context.maxSecondaryDepth,o.levels),_.isEmpty(o.root.children)||_.isEmpty(o.synchronizedGroups)||this.ensureRowNodeSynchronization(o.root,0),o},e.prototype.readRowsSynchronizedGroups=function(e,t,r){var i=e.length;t.synchronizedGroups=new Array(i),this.primarySynchronizedGroupByLevel=new Array(t.levels.length);for(var a=r.nestedDataShapes(),n=0;n<i;n++){var o=e[n],s=o.groupings;_.isEmpty(s);for(var u=a[o.dataShapeId],c=(u.next(),u.primaryHierarchy()),l=t.synchronizedGroups[n]={levels:new Array,root:{}},p=0;p<s.length;p++){var d=s[p],h=l.levels[p]=t.levels[d];h.valueSources&&((t.levels[d]=g.Prototype.inherit(h)).valueSources=h.valueSources,delete h.valueSources)}this.primarySynchronizedGroupByLevel[s[0]]=l;for(var m=this.metadata.columns,f=new Array(m.length),y=0;y<m.length;y++)!function(e){for(var t=m[e],r=0,i=l.levels;r<i.length;r++){var a=i[r],a=_.findIndex(a.sources,function(e){return e===t});if(-1<a){f[e]=a;break}}}(y);u=this.context.createContextForPrimarySynchronizedGroup(o,u);this.readNodeChildren(u,u.calcInfo,f,u.dataMemberIdToIdentityBuilder,u.dataMemberIdToMetadata,l.root,c,0,0,0,u.maxSecondaryDepth,l.levels,{currentIndex:0})}},e.prototype.readNodeChildren=function(e,t,r,i,a,n,o,s,u,c,l,p,d){if(o&&0!==o.count())for(;o.next();){var h=o.id(),m=a[h];if(m){var f=2===m.kind,y=f&&0===s,g=void 0,v=void 0;f||(v=(g=(g=i[h])||(i[h]=new N.IdentityBuilder(e,h))).getIdentityFields());var S=o.instances();if(S&&0!==S.count()){v&&(n.childIdentityFields=v);var x=x||(n.children=[]),C=this.calcInfoCache[h];for(null==C&&(C=this.calcInfoCache[h]=[]);S.next();){var D=this.readNode(e,m,i,a,t,r,S,s,f,y,C,u,c,l,g,m.restartValuesBuilder,p,d);x.push(D),d&&d.currentIndex++}}}}},e.prototype.readNode=function(e,t,r,i,a,n,o,s,u,c,l,p,d,h,m,f,y,g){var v=e.aggregateCalcMetadata,S={level:s};t.forSynchronization&&(S.synchronizationIndex=g.currentIndex),1===o.restartFlagKind()&&(S.isMerge=!0),u?S.isSubtotal=!0:m.reset();for(var x=[],C=this.synchronizedGroupsEnabled&&t.isSynchronized,D=0;o.nextCalc();D++){var E=o.calcId(),w=l[D];if(!w){if(!(w=a[E]))continue;l[D]=w}if(10!==w.calcKind){var I=w.columnIndex;w.isGroupKeyButNotSelect;var b=n[I];w.isGroupKeyButNotSelect;var I=w.kind,M=void 0;if(I===N.SelectKind.Group)C||(M=(V=o.calcValueAsExpr()).value,w.isGroupKeyButNotSelect||(x[b]={value:M,levelSourceIndex:b}),m.addExpr(E,V));else if(I===N.SelectKind.Measure){if(!this.scopedMeasuresEnabled&&0<h)continue;w.selectIdx;var V=this.measuresGroupingScopeBySelectIndex[w.selectIdx];V.secondary;I=void 0,V=(I=0===h&&V.primary===y.length?(null==S.values&&(I=S.values={}),S.values):(y[s].valueSources[0].length,S.nodeValues||(S.nodeValues={0:{}}),S.nodeValues[0]))[b];V||(V=I[b]={},0<b&&(V.valueSourceIndex=b)),M=o.calcValue(),this.readNodeValueCalc(V,M,w),this.scopedAggregatesEnabled&&w.scopedAggregateCalcMetadata&&this.setScopeAggregateValue(S,M,w,y[s-1]),!c||2!==w.calcKind&&5!==w.calcKind||(e.aggregateCalcMetadata[E],N.DataShapeUtility.fillMetadataColumnAggregate(M,v[E]))}if(!C&&w.hasDuplicateColumnIndices)for(var R=0,T=e.calcIdToColumnIndices[E];R<T.length;R++){var P=n[T[R]];x[P]||(x[P]={value:M,levelSourceIndex:P})}}else{E=o.calcValue();S.synchronizationIndex=E}}u||C||(S.levelValues=x,S.value=x[0].value,S.identity=m.getIdentity(),(A=o.restartKind())&&(1===A?S.restartKind=1:2===A?S.restartKind=2:3===A&&(S.restartKind=3),S.restartKind&&(S.restartValues=f.getRestartValues(o))));var A=o.intersections(),f=o.members();return A?this.readIntersectionsValues(a,n,d,S,A):f?(this.readNodeChildren(e,a,n,r,i,S,f,s+1,p,d,h,y,g),!t.isSynchronized||_.isEmpty(S.children)||void 0!==(t=S.children[0].synchronizationIndex)&&(S.synchronizationIndex=t)):1===p&&1<d&&(s===h-1||S.isSubtotal)&&this.createColumnHierarchyMeasuresNodes(S),S},e.prototype.setScopeAggregateValue=function(e,t,r,i){var a,n=r.scopedAggregateCalcMetadata,o=this.findDataViewNodeAggregates(e,n.metadata);switch(r.calcKind){case 7:a=o.values;break;case 8:a=o.highlight}switch(n.aggregateKind){case 2:a.max=t;break;case 3:a.min=t;break;case 6:a.avg=t}var s=n.metadata,n=i.aggregates;n?_.some(n,function(e){return e.column===s.column&&N.DataViewConverterContext.sameScopedAggregatesInputScope(e.inputScope,s.inputScope)&&e.respectInstanceFilters===s.respectInstanceFilters})||n.push(s):i.aggregates=[s]},e.prototype.findDataViewNodeAggregates=function(e,t){var r,i=e.aggregateValues;return i?(r=_.find(i,function(e){e=e.metadata;return e.column===t.column&&N.DataViewConverterContext.sameScopedAggregatesInputScope(e.inputScope,t.inputScope)&&e.respectInstanceFilters===t.respectInstanceFilters}))||i.push(r={metadata:t,values:{},highlight:{}}):e.aggregateValues=[r={metadata:t,values:{},highlight:{}}],r},e.prototype.readIntersectionsValues=function(e,t,r,i,a){if(0!==r)for(var n=i.values={},o=0;a.next();){for(var s=0;s<r;s++){var u=n[r*o+s]={};0<s&&(u.valueSourceIndex=s)}for(;a.nextCalc();){var c=e[a.calcId()];c&&(u=n[r*o+t[c.columnIndex]],this.readNodeValueCalc(u,a.calcValue(),c))}o++}},e.prototype.readNodeValueCalc=function(e,t,r){switch(r.calcKind){case 1:case 4:e.value=t,this.aggregator.update(t,r.selectIdx);break;case 2:case 5:e.value=t;break;case 3:case 6:case 9:e.highlight=t;break;case 7:case 8:case 10:break;default:r.calcKind}},e.prototype.createRowHierarchyForNoGroupings=function(e){var t={level:0,values:{}},r={levels:[],root:{children:[t]}};e.count(),e.next();e=e.instances();return this.readNodeForNoGroupings(t,e),r},e.prototype.readNodeForNoGroupings=function(e,t){t.count();var r=this.context.calcInfo,i=this.columnIndexToZoneIndex;t.next();for(var a=e.values={};t.nextCalc();){var n,o,s=r[t.calcId()];s&&((o=a[n=i[s.columnIndex]])||(o=a[n]={},0<n&&(o.valueSourceIndex=n)),this.readNodeValueCalc(o,t.calcValue(),s))}},e.prototype.createColumnHierarchyForNoGroupings=function(){var e=[],t={};return 0<this.valueSources.length&&(e=[this.createColumnHierarchyMeasuresLevel()],this.createColumnHierarchyMeasuresNodes(t)),{levels:e,root:t}},e.prototype.createColumnHierarchyMeasuresLevel=function(){for(var e=this.valueSources.length,t=new Array(e),r=0;r<e;r++)t[r]=this.valueSources[r];return{sources:t}},e.prototype.createColumnHierarchyMeasuresNodes=function(e){for(var t=null==e.level?0:this.context.maxSecondaryDepth,r=this.valueSources.length,i=e.children=new Array(r),a=e.isSubtotal,n=0;n<r;n++){var o=i[n]={level:t};0<n&&(o.levelSourceIndex=n),a&&(o.isSubtotal=!0)}},e.prototype.readValueSources=function(e){var t=this.context,r=t.selects,i=t.measureSelectIndices,a=i.length,n=t.selectIndexToColumn,o=t.selectIndexToColumnIndex,s=this.columnIndexToZoneIndex;this.valueSources=[],this.measuresGroupingScopeBySelectIndex={};var u={};if(0<e.calcCount()){for(;e.nextCalc();)u[e.calcId()]=!0;e.restartCalcs()}for(var c=0;c<a;c++){var l=i[c],p=r[l];p.Kind,N.SelectKind.Measure,p.Value;var d,h,m=o[l],f=this.measuresGroupingScopeBySelectIndex[l]=this.getMeasureGroupingScope(p,u[p.Value]);f&&(h=f.primary,d=f.secondary,f=void 0,f=(h!==this.context.maxPrimaryDepth||d!==this.context.maxSecondaryDepth)&&this.scopedMeasuresEnabled?(this.primaryHierarchyLevels.length,(h=this.primaryHierarchyLevels[h-1]).valueSources||(h.valueSources={0:[]}),h.valueSources[0]):this.valueSources,l=n[l],s[m]=f.length,f.push(l),p.DynamicFormat&&p.DynamicFormat.Format&&(l=l.formatSource&&l.formatSource.formatString,s[m+1]=f.length,f.push(l)))}},e.prototype.getMeasureGroupingScope=function(e,t){return null==e.Depth&&null==e.SecondaryDepth?t?null:{primary:this.context.maxPrimaryDepth,secondary:this.context.maxSecondaryDepth}:{primary:null!=e.Depth?e.Depth+1:0,secondary:null!=e.SecondaryDepth?e.SecondaryDepth+1:0}},e.prototype.ensureRowNodeSynchronization=function(e,t){if(this.isRowLeaf(e),!this.isRowLeaf(e)){var r=this.primarySynchronizedGroupByLevel[t];if(r)this.synchronizeNodeChildren(e,r.root);else for(var e=e.children,i=t+1,a=0,n=e;a<n.length;a++){var o=n[a];this.ensureRowNodeSynchronization(o,i)}}},e.prototype.synchronizeNodeChildren=function(e,t){if(!this.isRowLeaf(e)){var r=e.level+1,i=t.children;if(_.isEmpty(i))this.ensureRowNodeSynchronization(e,r);else{var a=i.length,n=e.children||[],o=new Array(a);e.children=o;for(var s=0,u=s<n.length?n[s]:void 0,c=null==u?void 0:u.synchronizationIndex,l=0;l<a;l++){var p=i[l],d=p.synchronizationIndex,h=this.copyFromMasterNode(p);h.level=r,o[l]=h,u&&c===d?(u.level,this.copyFromExistingNode(u,h),this.synchronizeNodeChildren(h,p),c=null==(u=++s<n.length?n[s]:void 0)?void 0:u.synchronizationIndex):(void 0===c||d<c)&&(this.isRowLeaf(h)||(h.children=[],this.synchronizeNodeChildren(h,p)))}}}},e.prototype.copyFromMasterNode=function(e){var t={};if(t.synchronizationIndex=e.synchronizationIndex,e.identity&&(t.identity=e.identity),void 0!==e.value&&(t.value=e.value),void 0!==e.isSubtotal&&(t.isSubtotal=e.isSubtotal),e.levelValues){var r=e.levelValues.length;t.levelValues=new Array(r);for(var i=0;i<r;i++){var a=e.levelValues[i];t.levelValues[i]={value:a.value,levelSourceIndex:a.levelSourceIndex}}}return void 0!==e.restartKind&&(t.restartKind=e.restartKind),void 0!==e.restartValues&&(t.restartValues=e.restartValues),t},e.prototype.copyFromExistingNode=function(e,t){e.aggregateValues&&(t.aggregateValues=e.aggregateValues),e.values&&(t.values=e.values),e.nodeValues&&(t.nodeValues=e.nodeValues),_.isEmpty(e.children)&&_.isEmpty(t.children),e.children&&(t.children=e.children),e.childIdentityFields&&!t.childIdentityFields&&(t.childIdentityFields=e.childIdentityFields)},e.prototype.isRowLeaf=function(e){return!(e.level!==this.context.maxPrimaryDepth-1&&!e.isSubtotal)&&(_.isEmpty(e.children),!0)},e);function e(e,t,r,i,a,n){this.context=e,this.dsrParser=t,this.metadata=r,this.synchronizedGroupsEnabled=a,this.scopedMeasuresEnabled=n,r.columns,this.aggregator=new N.Aggregator(e),this.scopedAggregatesEnabled=i}}()}(powerbi=powerbi||{}),function(e){var D;e=e.data||(e.data={}),D=e.dsr||(e.dsr={}),function(){(D.converters||(D.converters={})).createTable=function(e,t,r){return new i(e,t,r).run()};var i=(e.prototype.run=function(){if(this.isCompatible()){var e={columns:this.metadata.columns},t=this.dsrParser;t.reset();var r=t.dataShapes(),t=(r.next(),this.aggregator);t.read(r);r=r.primaryHierarchy();return 1===this.context.maxPrimaryDepth?this.readRows(e,r):0===this.context.maxPrimaryDepth&&this.readRowWithoutGrouping(e,r),t.copyToColumns(),e}},e.prototype.readRows=function(e,t){var r,i=this.context,a=this.getRowCellsCount(t);for(t.reset();t.next();){var n=t.id(),o=i.dataMemberIdToMetadata[n];if(o){var s=o.kind,u=t.instances(),c=[];if(1===s){for(var l=(l=i.dataMemberIdToIdentityBuilder[n])||(i.dataMemberIdToIdentityBuilder[n]=new D.IdentityBuilder(i,n)),p=o.axisGrouping,o=u.count(),d=new Array(o),h=new Array(o),m=0;u.next();m++)1===u.restartFlagKind()&&(r=m),l.reset(),d[m]=this.readRow(u,p,c,a,l,!1),h[m]=l.getIdentity();_.isEmpty(h)||(e.identity=h),e.identityFields=l.getIdentityFields()}else if(2===s){if(0===a)continue;for(;u.next();){e.totals;for(var f=this.readRow(u,null,c,a,null,!0),y=f.length,m=0;m<y;m++)void 0===f[m]&&(f[m]=null);e.totals=f}}e.rows=d,void 0!==r&&(e.lastMergeIndex=r)}}},e.prototype.readRow=function(e,t,r,i,a,n){var o,s=this.aggregator,u=new Array(i),c=0===r.length;c&&t&&(e.calcCount(),o=this.createCalcIdToGroupingIdentityIndexMap(t),r.length=e.calcCount());for(var l=this.context,p=l.aggregateCalcMetadata,d=0;e.nextCalc();d++){var h,m,f,y=e.calcId();c&&(h=o&&o[y],f=(m=l.calcInfo[y])&&m.columnIndex,g=m&&m.selectIdx,!m||3!==m.calcKind&&6!==m.calcKind&&9!==m.calcKind||(f=null),r[d]={axisGroupingIndex:h,columnIndex:f,hasDuplicateColumnIndices:m&&m.hasDuplicateColumnIndices,isGroupKeyOnly:null!=h&&null==f,selectIndex:g,aggregateMetadata:p[y]});var g=r[d];if(null!=g.columnIndex){var v=e.calcValue();if(u[g.columnIndex]=v,n?D.DataShapeUtility.fillMetadataColumnAggregate(v,g.aggregateMetadata):s.update(v,g.selectIndex),g.hasDuplicateColumnIndices)for(var S=0,x=l.calcIdToColumnIndices[y];S<x.length;S++){var C=x[S];void 0===u[C]&&(u[C]=v)}}a&&a.addExpr(y,e.calcValueAsExpr())}return u},e.prototype.readRowWithoutGrouping=function(e,t){if(t.count(),t.next()){var r=t.instances(),t=[];if(r.count(),r.next()){for(var i=[];r.nextCalc();){var a=r.calcId(),a=this.context.calcInfo[a];a&&3!==a.calcKind&&(i[a.columnIndex]=r.calcValue())}t.push(i)}e.rows=t}},e.prototype.getRowCellsCount=function(e){for(e.reset();e.next();){var t=e.id(),t=this.context.dataMemberIdToMetadata[t];if(t&&1===t.kind){var r=e.instances();if(r.next()){for(var i=0;r.nextCalc();){var a=r.calcId(),n=this.context.calcInfo[a];!n||1!==n.calcKind&&2!==n.calcKind||(n.hasDuplicateColumnIndices?i+=_.size(this.context.calcIdToColumnIndices[a]):i++)}return i}}}return 0},e.prototype.createCalcIdToGroupingIdentityIndexMap=function(e){for(var t={},r=e.Keys,i=this.context.selects,a=r.length,n=0;n<a;n++){var o=r[n];t[o.Calc||i[o.Select].Value]=n}return t},e.prototype.isCompatible=function(){var e=this.context;return 0===e.maxSecondaryDepth&&e.maxPrimaryDepth<=1},e);function e(e,t,r){this.context=e,this.dsrParser=t,this.metadata=r,this.aggregator=new D.Aggregator(e)}}()}(powerbi=powerbi||{}),function(e){var E;e=e.data||(e.data={}),E=e.dsr||(e.dsr={}),function(){(E.converters||(E.converters={})).createTree=function(e,t){return new r(e,t).run()};var r=(e.prototype.run=function(){if(this.isCompatible()){var e={};return this.parseTree(e),{root:e}}},e.prototype.parseTree=function(e){var t=this.dsrParser;t.reset();var r=t.dataShapes(),t=(r.next(),this.context.maxPrimaryDepth);this.aggregator.read(r,1===t),0===t?this.parseDataMembersWithNoGrouping(e,r.primaryHierarchy()):this.parseDataMembers(e,r.primaryHierarchy(),0),this.parseAggregates(e)},e.prototype.parseDataMembers=function(e,t,r){for(;t.next();){var i=this.context,a=t.id(),n=i.dataMemberIdToMetadata[a];if(n){var o=t.instances(),s=this.calcIndexToCalcMetadataDictionary[a];switch(s||(this.calcIndexToCalcMetadataDictionary[a]=s=[]),n.kind){case 1:var u=i.dataMemberIdToIdentityBuilder[a];u||(u=new E.IdentityBuilder(i,a),i.dataMemberIdToIdentityBuilder[a]=u);var c=u.getIdentityFields();c&&(e.childIdentityFields=c),this.parseInstances(e,o,s,u,!1,r);break;case 2:this.parseInstances(e,o,s,null,!0,r)}}}},e.prototype.parseInstances=function(e,t,r,i,a,n){var o=this.context,s=this.aggregator,u=o.aggregateCalcMetadata,c=e.children;for(a||!c&&0<t.count()&&(c=e.children=new Array(t.count()));t.next();){var l=void 0,p=void 0,d=void 0;a||i.reset();var h=0===r.length;h&&(r.length=t.calcCount());for(var m,f,y=0;t.nextCalc();y++){var l=(l=a?e.values:l)||{},g=t.calcId();h&&(C=o.calcInfo[g],r[y]=C);var v,S,x,C,D=r[y];D&&(v=t.calcValue(),S=D.calcKind,x=D.kind,C=D.selectIdx,a?(E.SelectKind.Group,this.addTreeNodeMeasureValues(l,C,S,v),0===n&&E.DataShapeUtility.fillMetadataColumnAggregate(v,u[g])):((D=D.isGroupKeyButNotSelect)||this.addTreeNodeMeasureValues(l,C,S,v),x===E.SelectKind.Group?(D||(d=v),i.addExpr(g,t.calcValueAsExpr())):x===E.SelectKind.Measure&&1===S&&s.update(p=v,C)))}a?(e.values=l,1===t.restartFlagKind()&&(e.isMerge=!0)):(m={values:l,identity:i.getIdentity()},void 0!==d&&(m.name=d),void 0!==p&&(m.value=p),1===t.restartFlagKind()&&(m.isMerge=!0),(f=t.members())&&this.parseDataMembers(m,f,n+1),c[t.currentIndex()]=m)}},e.prototype.addTreeNodeMeasureValues=function(e,t,r,i){var a=e[t];switch(!a&&this.isSupportedMeasureType(r)&&(a=e[t]={}),r){case 1:a.value=i;break;case 2:a.subtotal=i;break;case 3:a.highlight=i}},e.prototype.isSupportedMeasureType=function(e){return 1===e||2===e||3===e},e.prototype.parseDataMembersWithNoGrouping=function(e,t){t.count(),t.next();var r,i=t.instances();i.count(),i.next();for(var a=this.context.calcInfo;i.nextCalc();){e.values||(e.values=r={});var n,o,s=a[i.calcId()];s&&(n=s.calcKind,o=i.calcValue(),this.addTreeNodeMeasureValues(r,s.selectIdx,n,o),1===n&&(e.value=o))}},e.prototype.isCompatible=function(){return 0===_.size(this.context.secondaryAxisGroupings)},e.prototype.parseAggregates=function(e){var t=this.context;this.aggregator.copyToColumns();for(var r=t.measureSelectIndices,i=r.length,a=0;a<i;a++){var n,o=r[a],s=t.selectIndexToColumn[o].aggregates,u=e.values;s&&(n=(n=(u=u||(e.values={}))[o])||(u[o]={}),E.DataShapeUtility.copyAggregates(s,n))}},e);function e(e,t){this.context=e,this.dsrParser=t,this.calcIndexToCalcMetadataDictionary={},this.aggregator=new E.Aggregator(e)}}()}(powerbi=powerbi||{}),function(e){var c;e=e.data||(e.data={}),c=e.dsr||(e.dsr={}),function(){(c.converters||(c.converters={})).createSingle=function(e,t){if(r.isCompatible(e))return new r(e,t).run()};var r=(e.prototype.run=function(){return this.parseSingle()},e.prototype.parseSingle=function(){var e=this.dsrParser;e.reset();e=e.dataShapes(),e.next();return this.aggregator.read(e,!1),this.aggregator.copyToColumns(),0===this.context.maxPrimaryDepth?this.parseMeasureValue(e.primaryHierarchy()):this.parseSubtotal(e.primaryHierarchy())},e.prototype.parseMeasureValue=function(e){if(e.count(),e.next())return this.parseInstance(e.instances())},e.prototype.parseSubtotal=function(e){for(;e.next();)if(2===this.context.dataMemberIdToMetadata[e.id()].kind)return this.parseInstance(e.instances())},e.prototype.parseInstance=function(e){for(var t,r,i=this.context,a=i.calcInfo;e.next();)for(;e.nextCalc();){var n,o,s=e.calcId(),u=a[s];u&&(o=2===(n=u.calcKind),1!==n&&!o||(t=e.calcValue(),r=u.selectIdx,o&&(i.aggregateCalcMetadata[s],c.DataShapeUtility.fillMetadataColumnAggregate(t,i.aggregateCalcMetadata[s]))))}if(void 0!==t)return{column:i.selectIndexToColumn[r],value:t}},e.isCompatible=function(e){return 0===e.maxSecondaryDepth&&1===e.measureSelectIndices.length},e);function e(e,t){this.context=e,this.dsrParser=t,this.aggregator=new c.Aggregator(e)}}()}(powerbi=powerbi||{}),function(T){var P,s,A,e;P=T.data||(T.data={}),A=s=P.dsr||(P.dsr={}),function(e){var h,t=jsCommon.EnumExtensions,S=jsCommon.PerfTimer;function d(e,t){var r;e.metadata.dataReduction={},e.categorical&&(r=e.metadata.dataReduction.categorical={},t.Primary&&(r.categories=i(t.Primary)),t.Secondary&&(r.values=i(t.Secondary)),t.Intersection&&(r.metadata=i(t.Intersection))),e.matrix&&(r=e.metadata.dataReduction.matrix={},t.Primary&&(r.rows=i(t.Primary)))}function i(e){switch(e.Type){case 3:return{binnedLineSample:{}};case 4:return{overlappingPointsSample:{}};default:return{}}}function m(e,t){var r=e.values;return(r=r||(e.values={}))[t]||(r[t]={})}function f(e){for(var t={sources:[]},r=0,i=e.length;r<i;r++)t.sources.push(e[r]);return t}function y(e){return e.isSubtotal?e.level:e.level+1}function c(e){return e&&e.Groupings?e.Groupings.length:0}function l(e,t,r,i){e.children=[];for(var a=0;a<t;a++){var n={level:r};0<a&&(n.levelSourceIndex=a),e.children.push(n),i&&(n.isSubtotal=!0)}}function p(e,t,r,i,a){var n={};return function e(t,r,i,a,n,o,s){if(!a)return;var u=t.selects;var c=x(r,o);for(var l=0,p=a.length;l<p;l++)for(var d=a[l],h=0,m=0,f=d.Instances.length;m<f;m++){var y=d.Instances[m];if(0===h&&4===(h=D(u,n,o,d,y)))break;var g,v={level:o};i.children||(i.children=[]),i.children.push(v),1===h?(g=C(u,y.Calculations,c),_.isEmpty(g)||(v.levelValues=g,S=_.last(g),v.value=S.value,0<S.levelSourceIndex&&(v.levelSourceIndex=S.levelSourceIndex))):3===h&&(v.isSubtotal=!0),y.RestartFlag&&1===y.RestartFlag&&(v.isMerge=!0),n&&1===h&&(i.childIdentityFields=t.readKeys(n,o),v.identity=t.readIdentity(n,y,o));var S=y.Members;S&&0<S.length?e(t,r,v,S,n,o+1,s):s&&s(t,h,y,v,o+1)}}(e,t,n,r,i,0,a),n}function x(e,t){var r=[],i=e&&e[t]&&e[t].sources;if(!_.isEmpty(i))for(var a=0,n=i.length;a<n;a++){var o=i[a];o.index,r[o.index]=a}return r}function C(e,t,r){for(var i,a=0,n=e.length;a<n;a++){var o=e[a];o&&o.Value&&o.Kind===A.SelectKind.Group&&(void 0!==(o=A.DataShapeUtility.findAndParseCalculation(t,o.Value))&&(i=i||[]).push({levelSourceIndex:r[a],value:o}))}return i}function D(e,t,r,i,a){if(t&&t.length>r&&null!=i.Id){r=t[r];if(i.Id===r.Member)return 1;if(i.Id===r.SubtotalMember)return 3}var n=a.Calculations;if(n){for(var o=!1,s=0,u=e.length;s<u;s++){var c=e[s];if(c&&A.DataShapeUtility.findCalculation(n,c.Value)){if(c.Kind===A.SelectKind.Group)return 1;o||c.Kind!==A.SelectKind.Measure||(o=!0)}}if(o)return 2}return 4}function g(e,t,r,i,a,n,o,s){if(r)for(var u={index:0},c=0,l=t.length;c<l;c++){var p=t[c];p.Kind,A.SelectKind.Measure;var d=p.Highlight,h=d&&d.Value,d=d&&d.DynamicFormat&&d.DynamicFormat.Format;v(e,r,i,a,u,n,o,s,0,p.Value,h,p.Subtotal),p.DynamicFormat&&p.DynamicFormat.Format&&(h=_.map(p.SubtotalDynamicFormat,function(e){return e&&e.Format}),v(e,r,i,a,u,n,o,s,0,p.DynamicFormat.Format,d,h))}}function v(e,t,r,i,a,n,o,s,u,c,l,p){var d=m(r,i.index),h=null;null!=(h=3!==e?A.DataShapeUtility.findAndParseCalculation(t,c):h)||void 0!==(s=function(e,t,r,i,a,n){if(t){n=A.DataShapeUtility.computeAggIdx(r,i,a,n);if(n<t.length)return A.DataShapeUtility.findAndParseCalculation(e,t[n])}return}(t,p,y(r),n,o,s))&&(h=s),l&&(d.highlight=A.DataShapeUtility.findAndParseCalculation(t,l)),d.value=h,0<a.index&&(d.valueSourceIndex=a.index),i.index++,a.index++}e.read=function(e,t,r,i,a,n,o){if(!(s=r)||1!==_.size(s.DataShapes))return null;var s=r.DataShapes[0];if(s["odata.error"]){r=new T.DsrClientError(s["odata.error"]);return a&&(r.requestId=a),{error:r}}var o=new b(e,t,o,new M(t,s)),u={dataView:i=function(e){if(null!=e.scriptVisualBinding)return new E(e);for(var t=0,r=0,i=e.selects,a=0,n=i.length;a<n;a++){var o=i[a];o&&(null!=o.Depth&&(t=Math.max(t,o.Depth+1)),null!=o.SecondaryDepth&&(r=Math.max(r,o.SecondaryDepth+1)))}return new(1<=r&&1===t?I:w)(e)}(o).read(t.Expressions,s,i)};if(s.RestartTokens&&(u.restartToken=s.RestartTokens),s.DataLimitsExceeded&&0<s.DataLimitsExceeded.length&&(u.warnings||(u.warnings=[]),t=new A.DsrLimitsWarning(t,s.DataLimitsExceeded,s.Calculations),u.warnings.push(t),d(i,t.limits)),s.DataShapeMessages&&0<s.DataShapeMessages.length)for(var c=0,l=s.DataShapeMessages;c<l.length;c++){var p=l[c];A.KnownDsrMessages[p.Code]&&p.Severity===P.dsr.getDsrMessageSeverityValue(0)&&(u.warnings||(u.warnings=[]),u.warnings.push(new A.DsrMessage(p)))}return u.dataView&&!_.isEmpty(n)&&(P.ClientSideFilter.applyClientSideFilters(u.dataView,n),u.disallowPersisting=!0),o.stats,u},e.applyReductionMetadata=d,(h||(h={})).parse=function(e,t,r,i){e.includes(2);var a=S.start("DSR.matrix("+e.perfId+")"),n=[],o=[];!function(e,t,r,i,a){for(var n=e.selects,o=0,s=n.length;o<s;o++){var u,c,l=n[o];l&&(u=function(e,t,r){for(var i=0,a=t.length;i<a;i++){var n=t[i];if(n&&n.index===r&&void 0===n.groupName)return n}return e.createColumns(t,r)}(e,a,o),l.Kind===A.SelectKind.Measure?i.push(u):null!=l.Depth?null!=(c=t[l.Depth])?c.sources.push(u):t[l.Depth]=f([u]):null!=l.SecondaryDepth&&(null!=(c=r[l.SecondaryDepth])?c.sources.push(u):r[l.SecondaryDepth]=f([u])),l.DynamicFormat&&l.DynamicFormat.Format&&(u.formatSource&&u.formatSource.formatString,i.push(u.formatSource.formatString)))}var p=i.length;(1<p||0<p&&(0===t.length||0===r.length))&&r.push(f(i))}(e,n,o,u=[],i.columns);var s=[],i=function(s,u,e,t,r,c){if(!r.SecondaryHierarchy||0===r.SecondaryHierarchy.length){var i={};return l(i,e,0,!1),i}var a;t&&t.Secondary&&(a=t.Secondary.Groupings);return p(s,u,r.SecondaryHierarchy,a,function(e,t,r,i,a){var n,o;a<u.length&&(i.isSubtotal?(n=u.length-1,1<(o=u[n].sources.length)&&l(i,o,n,!0)):(u.length,l(i,u[a].sources.length,a,!1))),c.push(y(i)),s.stats.secondary++})}(e,o,u.length,t,r,s),u={rows:{root:function(e,t,r,i,n){if(i.PrimaryHierarchy&&0!==i.PrimaryHierarchy.length){var a;r&&r.Primary&&(a=r.Primary.Groupings);var o=0,s=0;r&&(o=c(r.Primary),s=c(r.Secondary));var u=_.filter(e.selects,function(e){return e&&e.Kind===A.SelectKind.Measure});return p(e,t,i.PrimaryHierarchy,a,function(e,t,r,i,a){!function(e,t,r,i,a,n,o){var s=r.Intersections,u={index:0};if(s)for(var c,l=0,p=s.length;l<p;l++)s[l].Calculations&&(c=a[l],g(e,t,s[l].Calculations,i,u,c,n,o));else g(e,t,r.Calculations,i,u,0,n,o)}(t,u,r,i,n,o,s),e.stats.primary++})}}(e,n,t,r,s),levels:n},columns:{root:i,levels:o},valueSources:u};return a(),u};var E=(r.prototype.read=function(e,r,t){var i=this,a={metadata:{columns:[]}};return t.script=S.logTime(function(){var e,t;r.PrimaryHierarchy&&0<r.PrimaryHierarchy.length&&((t=r.PrimaryHierarchy[0])&&0<t.Instances.length&&(e=t.Instances[0].Calculations,t=i._context.scriptVisualBinding.PayloadCalculationId||i._context.scriptVisualBinding.ImageCalculationId,(t=A.DataShapeUtility.findCalculation(e,t))&&(t=t.Value,(t=P.PrimitiveValueEncoding.parseBinary(t))&&(a.scriptResult={payloadBase64:t}))))}),a},r);function r(e){this._context=e}var w=(u.prototype.read=function(t,r,e){var i,a,n=this,o=this.context,s=this.readMetadata(r.IsComplete),u={metadata:s},c=o.includes(16),l=o.includes(1),p=o.includes(4),d=o.includes(8);return(c||l||p||d)&&(a=S.logTime(function(){i=n.parseTree(s.columns,t,r)}),c&&(e.tree=a+S.logTime(function(){var e=n.createTree(s,i);e&&(u.tree=e)})),l&&(e.categorical=a+S.logTime(function(){var e=n.categorize(s,i);e&&(u.categorical=e)})),p&&(e.single=a+S.logTime(function(){var e=n.createSingleValue(s,i);e&&(u.single=e)})),d&&(e.table=a+S.logTime(function(){var e=n.createTable(s,i);e&&(u.table=e)}))),o.includes(2)&&(e.matrix=S.logTime(function(){var e=h.parse(n.context,t,r,u.metadata);e&&(u.matrix=e)})),u},u.prototype.readMetadata=function(e){for(var t={columns:[]},r=this.context,i=r.selects,a=0,n=i.length;a<n;a++)i[a]?r.createColumns(t.columns,a):r.actionHistory|=1;return e||(t.segment={}),t},u.prototype.parseTree=function(e,t,r){var i=S.start("DSR.tree("+this.context.perfId+")"),a={},n=this.context.selects;this.parseRootAggregates(e,a);var o,s=A.DataShapeUtility.getTopLevelPrimaryDynamicMember(r,t,!0);return s?(s!==(o=r.PrimaryHierarchy[0])&&this.parseValues(n,a,u.getFirstInstanceCalcs(o)),o=void 0,t&&t.Primary&&(o=t.Primary.Groupings),this.parseRecursive(a,s,o,0,e)):_.isEmpty(r.PrimaryHierarchy)||this.parseValues(n,a,u.getFirstInstanceCalcs(r.PrimaryHierarchy[0])),i(),a},u.prototype.parseRecursive=function(e,t,r,i,a){var n,o=this.context,s=t.Instances,u=s.length;u&&(e.children=[],0===i&&(n=V.create(e,o))),r&&(e.childIdentityFields=o.readKeys(r,i));for(var c=0;c<u;c++){var l=s[c],p={};e.children.push(p),l.RestartFlag&&1===l.RestartFlag&&(p.isMerge=!0),this.parseValues(o.selects,p,l.Calculations,n),r&&(p.identity=o.readIdentity(r,l,i));var d=l.Members;this.parseAggregates(o.selects,p,l.Calculations,d,i+1),_.isEmpty(d)||(d=A.DataShapeUtility.getDynamicMember(d,r,i+1))&&this.parseRecursive(p,d,r,i+1)}n&&n.complete(a)},u.getFirstInstanceCalcs=function(e){e=e.Instances;return 0<e.length?e[0].Calculations:null},u.prototype.parseRootAggregates=function(e,t){for(var r=0,i=e.length;r<i;r++){var a=e[r].aggregates;a&&A.DataShapeUtility.copyAggregates(a,m(t,r))}},u.prototype.parseAggregates=function(e,t,r,i,a){for(var n=0,o=e.length;n<o;n++){var s,u=e[n];u&&((s=M.parseAggregates(u,r,i,a))&&(u=this.context.selectIndexToColumnIndexMap[n],A.DataShapeUtility.copyAggregates(s,m(t,u))))}},u.prototype.parseValues=function(e,t,r,i){if(!_.isEmpty(r))for(var a=0,n=0,o=e.length;a<o;a++){var s,u,c=e[a];c&&(c.Value&&void 0!==(u=A.DataShapeUtility.findAndParseCalculation(r,c.Value))&&(c.Kind===A.SelectKind.Group?t.name=u:(t.value=u,i&&i.add(n,u)),m(t,n).value=u),!c.Highlight||void 0!==(s=A.DataShapeUtility.findAndParseCalculation(r,c.Highlight.Value))&&(m(t,n).highlight=s),n++,c.DynamicFormat&&c.DynamicFormat.Format&&(u=A.DataShapeUtility.findAndParseCalculation(r,c.DynamicFormat.Format),m(t,n).value=u,n++))}},u.prototype.categorize=function(e,t){if(!this.canCategorize())return null;for(var r,i=S.start("DSR.categorical("+this.context.perfId+")"),a={},n=0,o=e.columns.length;n<o;n++){var s,u,c=e.columns[n];void 0!==c.index&&(c.isMeasure?(s={source:c,values:[]},(u=c.aggregates)&&A.DataShapeUtility.copyAggregates(u,s),a.values||(a.values=P.DataViewTransform.createValueColumns()),a.values.push(s)):(r=r||[]).push({columnIndex:n,metadataColumn:c}))}if(r){a.categories=[];for(var l=void 0,p=0,d=r.length;p<d;p++){var h=r[p],m=t.children,f={source:h.metadataColumn,values:[]};if(m)for(var y=0,g=m.length;y<g;y++){var v=m[y];f.values.push(v.values[h.columnIndex].value),0===p&&(this.writeCategoricalValues(e,v,a.values),v.identity&&(l=l||[]).push(v.identity)),v.isMerge&&(a.lastMergeIndex=y)}l&&(f.identity=l),t.childIdentityFields&&(f.identityFields=t.childIdentityFields),a.categories.push(f)}}else this.writeCategoricalValues(e,t,a.values);return i(),a},u.prototype.canCategorize=function(){for(var e=this.context.selects,t=0,r=e.length;t<r;t++){var i=e[t];if(i&&0<i.Depth)return!1}return!0},u.prototype.createTree=function(e,t){var r=this.context;if(!(2&r.actionHistory||1&r.actionHistory))return{root:t};var r=T.Prototype.inherit(t),i=e.columns,a=t.values;if(a){for(var n={},o=0;o<i.length;o++){var s=i[o];void 0!==s.index&&void 0!==a[o]&&(n[s.index]=a[o])}r.values=n}t=t.children;return t&&(r.children=this.removeFormatSourceFromTreeChildren(i,t)),{root:r}},u.prototype.removeFormatSourceFromTreeChildren=function(e,t){for(var r=t.length,i=_.map(t,function(e){return e}),a=0;a<r;a++){var n=T.Prototype.inherit(i[a]);i[a]=n;for(var o={},s=0;s<e.length;s++){var u=e[s];void 0!==u.index&&void 0!==i[a].values[s]&&(o[u.index]=i[a].values[s])}i[a].values=o;n=i[a].children;n&&(i[a].children=this.removeFormatSourceFromTreeChildren(e,n))}return i},u.prototype.createTable=function(e,t){for(var r,i,a=this.context.selects,n=0,o=a.length;n<o;n++)a[n]&&(0<=(i=a[n].Depth)&&(r=Math.max(i,r||0)));if(0<r)return null;var s,u,c=S.start("DSR.table("+this.context.perfId+")"),l=[],p=e.columns.length;if(0<=r){var d=t.children;if(d)for(var n=0,h=d.length;n<h;n++){var m=d[n];this.toTableRow(m,p,l),m.isMerge&&(s=n),m.identity&&(u=u||[]).push(m.identity)}}else T.DataViewAnalysis.countGroups(e.columns),this.toTableRow(t,p,l);var f=this.toTotals(t,p),e={rows:l,columns:e.columns};return u&&(e.identity=u),t.childIdentityFields&&(e.identityFields=t.childIdentityFields),f&&(e.totals=f),0<=s&&(e.lastMergeIndex=s),c(),e},u.prototype.toTableRow=function(e,t,r){for(var i=[],a=0;a<t;a++){var n=e.values[a];n&&i.push(n.value)}r.push(i)},u.prototype.toTotals=function(e,t){var r=[],i=e.values,a=!1;if(i)for(var n=0;n<t;n++){var o=i[n],o=o?o.subtotal:null,a=a||null!=o;r.push(o)}return a?r:null},u.prototype.writeCategoricalValues=function(e,t,r){for(var i=e.columns,a=0,n=0,o=i.length;n<o;n++){var s,u=i[n];u.isMeasure&&(void 0===u.index||(s=t.values[n])&&((u=r[a++]).values.push(s.value),void 0!==s.highlight&&(u.highlights||(u.highlights=[]),u.highlights.push(s.highlight))))}},u.prototype.createSingleValue=function(e,t){if(t.values){for(var r=e.columns,i=null,a=void 0,n=0,o=r.length;n<o;n++)if(r[n].isMeasure&&null!=r[n].index){if(i)return null;i=r[n],a=n}if(!i)return null;t=t.values[a];if(!t)return null;t=0===T.DataViewAnalysis.countGroups(e.columns)?t.value:t.subtotal;return void 0===t?null:{column:i,value:t}}return null},u);function u(e){this.context=e}var I=(a.prototype.read=function(t,r,e){var i=this,a=this._context,n={metadata:this.readMetadata(r.IsComplete)};return a.includes(1)&&(e.categorical=S.logTime(function(){var e=i.categorize(r,n.metadata,t);e&&(n.categorical=e)})),a.includes(2)&&(e.matrix=S.logTime(function(){var e=h.parse(i._context,t,r,n.metadata);e&&(n.matrix=e)})),n},a.prototype.readMetadata=function(e){for(var t={columns:[]},r=this._context,i=r.selects,a=0,n=i.length;a<n;a++){var o,s=i[a];s&&(s.Kind!==A.SelectKind.Measure?(s.Kind,A.SelectKind.Group,o=r.createColumns(t.columns,a),0<=s.SecondaryDepth?(this._secondarySelects.push(s),this._secondaryDepth=Math.max(this._secondaryDepth||0,s.SecondaryDepth),this._seriesColumn=o):0===s.Depth&&this._categoriesMetadata.push({select:s,column:o})):(0===s.Depth?this._primaryMeasureSelects:this._measureSelects).push(s))}return e||(t.segment={}),t},a.prototype.categorize=function(e,t,r){if(0!==this._secondaryDepth||0===this._categoriesMetadata.length)return null;var i=S.start("DSR.categorical("+this._context.perfId+", secondary)");r&&(r.Primary&&(o=r.Primary.Groupings),r.Secondary&&(n=r.Secondary.Groupings));var a=A.DataShapeUtility.getTopLevelSecondaryDynamicMember(e,r),n=this.readColumnsFromSecondary(a,t,n,e.Calculations),r=A.DataShapeUtility.getTopLevelPrimaryDynamicMember(e,r),o=this.readCategoriesAndValues(r,t,n,o),n={categories:o.categories,values:n};return void 0!==o.lastMergeIndex&&(n.lastMergeIndex=o.lastMergeIndex),i(),n},a.prototype.readColumnsFromSecondary=function(e,t,r,i){var a=this._context;r&&(M=a.readKeys(r,0));var n=[],o=a.selects,s=this._measureSelects.length,u=[],c=e.Instances,l=c.length;if(l)for(var p=0;p<l;p++){var d=c[p],h=d.Calculations,m=void 0;r&&(m=a.readIdentity(r,d,0));for(var f=0,y=this._secondarySelects.length;f<y;f++){for(var g=this._secondarySelects[f],v=A.DataShapeUtility.findAndParseCalculation(h,g.Value),S=[],x=0;x<s;x++){var C=this._measureSelects[x],D=o.indexOf(C),E=a.createColumns(t.columns,D,!0);void 0!==v&&(E.groupName=v);var w={source:E,values:[]};m&&(w.identity=m),this.addColumnAggregates(i,C,w),n.push(w),S.push(w)}u.push({identity:m,name:v,values:S})}}else{for(x=0;x<s;x++){C=this._measureSelects[x],D=o.indexOf(C),w={source:E=a.createColumns(t.columns,D),values:[]};this.addColumnAggregates(i,C,w),n.push(w)}u.push({values:__spreadArray([],n||[])})}for(var x=0,I=this._primaryMeasureSelects.length;x<I;x++){var b=this._primaryMeasureSelects[x],D=o.indexOf(b),w={source:E=a.createColumns(t.columns,D),values:[]};n.push(w)}M&&(n.identityFields=M);var M=this._seriesColumn;return M&&(n.source=M),n.grouped=function(){return u},n},a.prototype.addColumnAggregates=function(e,t,r){e&&(t.Max&&(r.max=A.DataShapeUtility.findAndParseCalculation(e,t.Max[0])),t.Min&&(r.min=A.DataShapeUtility.findAndParseCalculation(e,t.Min[0])))},a.prototype.readCategoriesAndValues=function(e,t,r,i){for(var a,n=[],o=this._categoriesMetadata,s=o.length,u=this._context,c=0;c<s;c++){var l={source:o[c].column,values:[]};n.push(l),i&&(l.identity=a=a||[],l.identityFields=u.readKeys(i,0))}for(var p,d=e.Instances,h=this._primaryMeasureSelects,c=0,m=d.length;c<m;c++){var f=d[c];1===f.RestartFlag&&(p=c);for(var y=0;y<s;y++)(l=n[y]).values.push(A.DataShapeUtility.findAndParseCalculation(f.Calculations,o[y].select.Value));a&&a.push(u.readIdentity(i,f,0));for(var g=f.Intersections,v=0,S=0,x=g.length;S<x;S++)for(var C=g[S].Calculations,D=0,E=this._measureSelects.length;D<E;D++){var w,I=this._measureSelects[D];void 0!==(_=A.DataShapeUtility.findAndParseCalculation(C,I.Value))&&((b=r[v++]).values.push(_),I.Highlight&&(b.highlights||(b.highlights=[]),w=A.DataShapeUtility.findAndParseCalculation(C,I.Highlight.Value),b.highlights.push(w)))}for(S=0,x=h.length;S<x;S++){var b,M,I=h[S],C=f.Calculations,_=A.DataShapeUtility.findAndParseCalculation(C,I.Value);(b=r[v++]).values.push(_),I.Highlight&&(b.highlights||(b.highlights=[]),M=A.DataShapeUtility.findAndParseCalculation(C,I.Highlight.Value),b.highlights.push(M))}}return{categories:n,lastMergeIndex:p}},a);function a(e){this._context=e,this._categoriesMetadata=[],this._primaryMeasureSelects=[],this._measureSelects=[],this._secondarySelects=[],this._seriesColumn=null}var b=(n.prototype.createColumns=function(e,t,r){var i=e.length,i=this.columnMetadata(t,i,r);e.push(i);r=e.length,r=this.tryCreatingDynamicFormatColumnMetadata(t,r,i);return r&&e.push(r),i},n.prototype.columnMetadata=function(e,t,r){var i=this.selects[e],a={displayName:"",index:e};i.Format&&(a.format=i.Format),a.type=A.DataShapeUtility.describeDataType(i.Type,i.DataCategory),i.Kind===A.SelectKind.Measure&&(a.isMeasure=!0),r||(r=this.aggregateReader.compute(i,t))&&(a.aggregates=r);i=i.GroupKeys;if(i)for(var n=a.identityExprs=[],o=0,s=i;o<s.length;o++){var u=s[o],u=this.convertKey(u);n.push(u)}return this.selectIndexToColumnIndexMap[e]=t,a},n.prototype.tryCreatingDynamicFormatColumnMetadata=function(e,t,r,i){var a=this.selects[e];if(a.DynamicFormat&&a.DynamicFormat.Format){e={displayName:"",isMeasure:!0};r.formatSource={formatString:e};a={Kind:A.SelectKind.Measure,Subtotal:_.map(a.SubtotalDynamicFormat,function(e){return e&&e.Format})};return i||(t=this.aggregateReader.compute(a,t))&&(e.aggregates=t),this.actionHistory|=2,e}},n.prototype.readIdentity=function(e,t,r){for(var i=this.readKeys(e,r),a=e[r].Keys,n=0,o=a.length;n<o;n++)var s=a[n],s=s.Calc||this.selects[s.Select].Value,s=A.DataShapeUtility.findAndParseCalculationToSQExpr(t.Calculations,s),s=P.SQExprBuilder.equal(i[n],s),u=P.SQExprBuilder.and(u,s);return P.createDataViewScopeIdentity(u)},n.prototype.readKeys=function(e,t){var r=this.getAxisCache(e);if(void 0===(i=r.exprs[t]))for(var i=r.exprs[t]=[],a=e[t].Keys,n=0,o=a.length;n<o;n++)i.push(this.convertKey(a[n]));return i},n.prototype.includes=function(e){return t.hasFlag(this.targets,e)},n.prototype.getAxisCache=function(e){for(var t=this.cacheItems,r=0,i=t.length;r<i;r++){var a=t[r];if(a.axisGroupings===e)return a}var n={axisGroupings:e,exprs:[]};return t.push(n),n},n.prototype.convertKey=function(e){e=e.Source;return P.SQExprBuilder.columnRef(P.SQExprBuilder.entity(s.schemaName(e),e.Entity||e.EntitySet),e.Property)},n);function n(e,t,r,i){null!=t.Select||t.ScriptVisualBinding,this.targets=e,this.selects=t.Select,this.scriptVisualBinding=t.ScriptVisualBinding,this.perfId=r||"",this.stats={id:r||void 0,primary:0,secondary:0},this.aggregateReader=i,this.cacheItems=[],this.selectIndexToColumnIndexMap={}}var M=(o.prototype.compute=function(e,t,r){var i=this.cache;if(i){var a=i[t];if(a)return a}if(e){i||(this.cache=i={});a=this.dataShape,a=o.parseAggregates(e,a.Calculations,a.PrimaryHierarchy,0);return i[t]=a=r&&!a?{}:a}},o.prototype.updateAggregates=function(e,t,r,i){t=this.compute(e,t,!0);if(t)return t[r]=i,t},o);function o(e,t){null!=e.Select||e.ScriptVisualBinding,this.dataShape=t}(M||(M={})).parseAggregates=function(e,t,r,i){if(r=!_.isEmpty(r)&&w.getFirstInstanceCalcs(r[0]),!_.isEmpty(t)||!_.isEmpty(r)){if(_.isEmpty(r)||e.Subtotal&&(o=e.Subtotal[i])&&void 0!==(s=A.DataShapeUtility.findAndParseCalculation(r,o))&&((c=c||{}).subtotal=s),!_.isEmpty(t)){e.Max&&(o=e.Max[i])&&void 0!==(s=A.DataShapeUtility.findAndParseCalculation(t,o))&&((c=c||{}).max=s),e.Min&&(o=e.Min[i])&&void 0!==(s=A.DataShapeUtility.findAndParseCalculation(t,o))&&((c=c||{}).min=s),e.Count&&(o=e.Count[i])&&void 0!==(s=A.DataShapeUtility.findAndParseCalculation(t,o))&&((c=c||{}).count=s);r=e.Aggregates;if(r)for(var a=0,n=r;a<n.length;a++){var o,s,u,c,l=n[a],p=l.Aggregate;(o=l.Ids[i])&&void 0!==(s=A.DataShapeUtility.findAndParseCalculation(t,o))&&((u=p.Percentile)?(l={k:u.K,value:s},u.Exclusive&&(l.exclusive=u.Exclusive),((c=c||{}).percentiles||(c.percentiles=[])).push(l)):p.Average?(c=c||{}).average=s:p.Median&&((c=c||{}).median=s))}0===i&&(o=e.Value)&&void 0!==(s=A.DataShapeUtility.findAndParseCalculation(t,o))&&((c=c||{}).single=s)}return c}};var V=(R.create=function(e,t){for(var r=e.values,i=t.selects,a=!1,n={},o=0,s=0,u=i.length;o<u;o++){var c=i[o];if(c)if(c.Kind===A.SelectKind.Measure){var l=void 0,p=void 0;if(r&&(p=r[s])){if(l=[],void 0===p.min&&l.push(new A.MinValueAggregator),void 0===p.max&&l.push(new A.MaxValueAggregator),0===l.length){s++;continue}}else l=[new A.MinValueAggregator,new A.MaxValueAggregator];n[s]=l,a=!0,s++,c.DynamicFormat&&c.DynamicFormat.Format&&s++}else s++}if(a)return new R(e,t.aggregateReader,t.selects,n)},R.prototype.add=function(e,t){var r=this.aggregators[e];if(r)for(var i=0,a=r.length;i<a;i++)r[i].update(t)},R.prototype.complete=function(e){for(var t=this.aggregators,r=this.node,i=this.aggregateReader,a=0,n=0,o=this.selects.length;a<o;a++){var s=this.selects[a];if(s){var u=t[n];if(u){for(var c=0,l=u.length;c<l;c++){var p=u[c],d=p.value();void 0!==d&&(p=p.name,m(r,n)[p]=d,e[n].aggregates=i.updateAggregates(s,n,p,d))}n++,s&&s.DynamicFormat&&s.DynamicFormat.Format&&n++}else n++}}},R);function R(e,t,r,i){this.node=e,this.aggregateReader=t,this.selects=r,this.aggregators=i}}((e=A.reader||(A.reader={})).V1||(e.V1={}))}(powerbi=powerbi||{}),function(e){var R,T,P;R=e.data||(e.data={}),T=R.dsr||(R.dsr={}),function(e){e.createDsrParser=function(e,t){return new r(e,t)};var r=(t.prototype.dataShapes=function(){return this.parser},t.prototype.reset=function(){this.parser.reset()},t.prototype.lockCache=function(){this.dsrParserContext.locked||(this.dsrParserContext.locked=!0)},t);function t(e,t){this.dsrParserContext=t,this.parser=new u(e.DS,this.dsrParserContext)}var i=(a.prototype.initialize=function(e,t){this.lastContainerCalculations=t,this.repeatedValuesHandler.initialize(e&&e.R,t),this.nullValuesHandler.initialize(e&&e.Ø)},a.prototype.getCurrentCalc=function(e,t,r,i){if(!r)return this.calculationContainerKind,null;var a=this.repeatedValuesHandler.tryRead(e);return void 0!==a||(void 0!==(a=this.nullValuesHandler.tryRead(e))?this.lastContainerCalculations[e]=null:t?t.next()&&(a=t.current(),this.lastContainerCalculations[e]=a):(a=r[i],this.lastContainerCalculations[e]=a=void 0===a?null:a)),a},a);function a(e){this.calculationContainerKind=e,this.nullValuesHandler=new E,this.repeatedValuesHandler=new I}var n=(o.prototype.setCalculations=function(e){this.calculationContainer=e;var t,r,i=this.context;i&&(t=this.calcMetadataCacheKey,(r=e.S)&&(this.metadata=r,t&&!i.locked&&(i.memberInstanceCalcMetadataCache[t]=r),this.lastContainerCalculations||(this.lastContainerCalculations=new Array(r.length))),i.instancesCalcCache[t]&&(this.lastContainerCalculations=i.instancesCalcCache[t]),this.baseCalculationParser.initialize(e,this.lastContainerCalculations),e=e.C,(r=this.getCalcMetadata())?this.calcMetadataIt=new P.Iterator(r):this.calcMetadataIt&&this.calcMetadataIt.reset(),0<_.size(e)?this.calcIt=new P.Iterator(e):this.calcIt=void 0)},o.prototype.restartCalcs=function(){this.calcMetadataIt,this.calcIt,this.calcIt&&this.calcIt.reset(),this.calcMetadataIt.reset(),delete this.dsrCalcValue},o.prototype.nextCalc=function(){var e=!1,t=this.calcMetadataIt;return t&&((e=t.next()||e)&&(this.dsrCalcValue=this.baseCalculationParser.getCurrentCalc(t.index(),this.calcIt,this.calculationContainer,this.calcId())),t.done()&&(this.context.instancesCalcCache[this.calcMetadataCacheKey]=this.lastContainerCalculations)),e||!1},o.prototype.calcId=function(){return this.metadata[this.calcMetadataIt.index()].N},o.prototype.getCalcMetadata=function(){return this.metadata||(this.metadata=this.context.memberInstanceCalcMetadataCache[this.calcMetadataCacheKey])},o.prototype.calcValue=function(){var e=this.metadata[this.calcMetadataIt.index()],t=this.context.valueDictionaryHandler.getCalcValue(this.dsrCalcValue,e.DN,e.T);return t=void 0===t?R.PrimitiveValueEncoding.parseOptimizedValue(this.dsrCalcValue,e.T):t},o.prototype.calcValueAsExpr=function(){this.dsrCalcValue;var e=this.calcMetadataIt.current(),t=this.calcValue();return this.context.valueDictionaryHandler.getCalcValueExpr(t,this.dsrCalcValue,e.DN,e.T)||R.PrimitiveValueEncoding.parseOptimizedValueToSQExpr(t,this.dsrCalcValue,e.T)},o.prototype.calcCount=function(){return this.calcMetadataIt?this.calcMetadataIt.count():this.calcIt?this.calcIt.count():0},o);function o(e,t,r){this.context=e,this.calcMetadataCacheKey=r,this.baseCalculationParser=new i(t)}var s,u=(__extends(c,s=n),c.prototype.reset=function(){this.it.reset()},c.prototype.index=function(){return this.it.index()},c.prototype.count=function(){return this.it.count()},c.prototype.next=function(){this.primaryHierarchyParser=this.secondaryHierarchyParser=this.messageParser=void 0;var e,t=this.it.next();return t&&(e=this.it.current(),this.setCalculations(e),this.context&&(this.context.valueDictionaryHandler=new T.ValueDictionaryHandler(e.ValueDicts||(null===(e=this.rootDataShape)||void 0===e?void 0:e.ValueDicts)))),t},c.prototype.id=function(){return this.it.current().N},c.prototype.nestedDataShapes=function(){this.context.primarySynchronizedGroups;var r=this.it.current(),i=r.DS;if(!_.isArray(i)||i.length<1)return{};for(var a={},n=this,e=0,t=this.context.primarySynchronizedGroups;e<t.length;e++)!function(t){var e=_.find(i,function(e){return e.N===t.dataShapeId});t.dataShapeId,e&&(a[e.N]=new c([e],t.context,n.rootDataShape||r))}(t[e]);return a},c.prototype.primaryHierarchy=function(){var e;return this.parserContext,!this.primaryHierarchyParser&&this.parserContext&&(e=this.it.current().PH,this.primaryHierarchyParser=e&&new m(e,this.parserContext,0,0)),this.primaryHierarchyParser},c.prototype.secondaryHierarchy=function(){var e;return this.parserContext,!this.secondaryHierarchyParser&&this.parserContext&&(e=this.it.current().SH,this.secondaryHierarchyParser=e&&new m(e,this.parserContext,1,0)),this.secondaryHierarchyParser},c.prototype.messages=function(){return!this.messageParser&&0<_.size(this.it.current().Msg)&&(this.messageParser=new d(this.it.current().Msg)),this.messageParser},c.prototype.hasRestartTokens=function(){return 0<_.size(this.restartTokens())},c.prototype.restartTokens=function(){var e=this.it.current(),t=e.DW;return _.isEmpty(t)?e.RT:(t.length,t[0].RT)},c.prototype.complete=function(){var e=this.it.current(),t=e.DW;return _.isEmpty(t)?e.IC:(t.length,t[0].IC)},c.prototype.hasAllData=function(){return this.it.current().HAD},c.prototype.limitsExceeded=function(){return 0<_.size(this.it.current().DLEx)},c.prototype.limits=function(){return this.limitsParser||(this.limitsParser=new l(this.it.current().DLEx)),this.limitsParser},c);function c(e,t,r){var i=s.call(this,t,1)||this;return i.parserContext=t,i.rootDataShape=r,i.it=new P.Iterator(e),i}var l=(p.prototype.next=function(){return this.it.next()},p.prototype.id=function(){return this.it.current().N},p.prototype.count=function(){return this.it.count()},p);function p(e){this.it=new P.Iterator(e)}var d=(h.prototype.next=function(){return this.it.next()},h.prototype.code=function(){return this.it.current().Code},h.prototype.severity=function(){return this.it.current().Severity},h.prototype.dsrMessage=function(){return new T.DsrMessage(this.it.current())},h);function h(e){this.it=new P.Iterator(e)}var m=(f.prototype.count=function(){return this.it.count()},f.prototype.reset=function(){this.it.reset(),this.dataMemberId=void 0},f.prototype.next=function(){this.instancesParser&&(this.instancesParser=void 0),this.dataMemberId&&(this.dataMemberId=void 0);var e=this.it.next();if(e){var t=this.dataMemberIdCache();if(0<_.size(t))for(var r=this.it.current(),i=0,a=t[this.depth];i<a.length;i++){var n=a[i];r[n]&&(this.dataMemberId=n)}void 0===this.dataMemberId&&(t=Object.keys(this.it.current()),1===_.size(t)&&(this.dataMemberId=t[0]))}return e},f.prototype.id=function(){return this.dataMemberId},f.prototype.dataMemberIdCache=function(){return 0===this.hierarchy?this.context.primaryDataMemberIdCache:this.context.secondaryDataMemberIdCache},f.prototype.instances=function(){var e;return this.instancesParser||(e=this.it.current()[this.dataMemberId],this.instancesParser=e&&new g(e,this.context,this.id(),this.hierarchy,this.depth)),this.instancesParser},f);function f(e,t,r,i){this.context=t,this.hierarchy=r,this.depth=i,this.it=new P.Iterator(e)}var y,g=(__extends(v,y=n),v.prototype.next=function(){var e,t=this.it.next();return t&&(e=this.it.current(),this.context.locked||e.M||1!==this.hierarchy||this.context.secondaryLeafDataMemberId.push(this.parentDataMemberId),this.setCalculations(e),this.dataMemberIt=void 0,this.intersectionParserDirty=!0,1!==this.hierarchy||e.Intersections),t},v.prototype.count=function(){return this.it.count()},v.prototype.currentIndex=function(){return this.it.index()},v.prototype.intersections=function(){if(this.intersectionParser)return this.intersectionParserDirty&&(this.intersectionParserDirty=!1,this.intersectionParser.reset(this.it.current().X)),this.intersectionParser;this.intersectionParserDirty=!1;var e=this.it.current().X;return this.intersectionParser=e&&new S(e,this.context,this.parentDataMemberId)},v.prototype.restartFlagKind=function(){return this.it.current().RF},v.prototype.restartKind=function(){return this.it.current().RK},v.prototype.members=function(){var e;return this.dataMemberIt||(e=this.it.current().M,this.dataMemberIt=e&&new m(e,this.context,this.hierarchy,this.depth+1)),this.dataMemberIt},v);function v(e,t,r,i,a){t=y.call(this,t,2,r)||this;return t.parentDataMemberId=r,t.hierarchy=i,t.depth=a,t.it=new P.Iterator(e),t}var S=(x.prototype.reset=function(e){this.it.reset(e),this.logicalIntersectionIndex=-1,this.physicalIntersectionIndex=-1,this.hasIntersectionElements=0<e.length},x.prototype.next=function(){if(this.resetCalcIt(),this.logicalIntersectionIndex++,this.logicalIntersectionIndex>=this.expectedIntersectionCount)return!1;if(this.setIntersectionId(),this.it.count()===this.expectedIntersectionCount){var e=this.it.next();return e&&this.initialize(this.it.current()),e}if(this.hasIntersectionElements){e=void 0;if((0===this.logicalIntersectionIndex||this.physicalIntersectionIndex<this.logicalIntersectionIndex)&&this.it.next()&&((e=this.it.current()).I||0===this.logicalIntersectionIndex?this.physicalIntersectionIndex=e.I||0:this.physicalIntersectionIndex++),this.physicalIntersectionIndex===this.logicalIntersectionIndex)return e=e||this.it.current(),this.initialize(e),!0}return this.initialize(),!0},x.prototype.setIntersectionId=function(){this.intersectionId=this.parentDataMemberId+this.context.secondaryLeafDataMemberId[this.logicalIntersectionIndex]},x.prototype.resetCalcIt=function(e){e=e&&e.C;this.currentCalcIndex=-1,this.currentCalc=void 0,this.calcIt=e?new P.Iterator(e):void 0},x.prototype.initialize=function(e){if(this.logicalIntersectionIndex,this.resetCalcIt(e),e){var t=e.S;if(t&&!this.context.locked){void 0===this.intersectionCalcCount&&(this.intersectionCalcCount=t.length),this.calcMetadataCache[this.logicalIntersectionIndex],this.calcMetadataCache[this.logicalIntersectionIndex]=t;for(var r=this.context.calcIdToCalcMetadata,i=0,a=t;i<a.length;i++)r[a[i].N]=t}}this.calculationContainer=e;var n=this.context.lastIntersectionCalcCache[this.intersectionId];!n&&this.intersectionId&&(n=this.context.lastIntersectionCalcCache[this.intersectionId]=new Array(this.intersectionCalcCount)),this.baseCalculationParser.initialize(e,n);n=this.getCalcMetadata();n&&(this.currentCalcMetadata=n,void 0===this.intersectionCalcCount&&(0<this.intersectionMeasureCount?this.intersectionCalcCount=this.currentCalcMetadata.length:this.intersectionCalcCount=0))},x.prototype.restartCalcs=function(){this.calcIt&&this.calcIt.reset(),this.currentCalcIndex=-1,delete this.currentCalc},x.prototype.nextCalc=function(){var e=++this.currentCalcIndex;return e<this.intersectionCalcCount?(this.currentCalc=this.baseCalculationParser.getCurrentCalc(e,this.calcIt,this.calculationContainer,this.calcId()),!0):(this.currentCalc=void 0,!1)},x.prototype.calcId=function(){return this.currentCalcMetadata[this.currentCalcIndex].N},x.prototype.getCalcMetadata=function(){this.logicalIntersectionIndex;var e,t=this.calcMetadataCache[this.logicalIntersectionIndex];return t||this.context.locked||(e=this.getExpectedCalcId())&&(t=this.calcMetadataCache[this.logicalIntersectionIndex]=this.context.calcIdToCalcMetadata[e]),t},x.prototype.getExpectedCalcId=function(){if(0!==this.intersectionMeasureCount){var e=this.context,t=e.dataMemberIdToMetadata[e.secondaryLeafDataMemberId[this.logicalIntersectionIndex]],r=1===t.kind,i=this.currentCalcIndex<0?e.intersectionMeasureToSelectIndex[0]:e.intersectionMeasureToSelectIndex[this.currentCalcIndex],i=e.selects[i];if(r&&this.primaryMemberIsGroupMember)return i.Value;if(i.Subtotal){e=T.DataShapeUtility.computeAggIdx(this.primaryDataMemberDepth,t.depth,e.maxPrimaryDepth,e.maxSecondaryDepth);return i.Subtotal.length>e&&i.Subtotal[e]}}},x.prototype.calcValue=function(){return void 0!==this.currentCalc&&null!==this.currentCalc?this.parseCalcValue(this.currentCalc):null},x.prototype.parseCalcValue=function(e){var t=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],r=this.context.valueDictionaryHandler.getCalcValue(e,t.DN,t.T);return r=void 0===r?R.PrimitiveValueEncoding.parseOptimizedValue(e,t.T):r},x.prototype.calcValueAsExpr=function(){if(void 0!==this.currentCalc)return this.parseCalcValueExpr(this.currentCalc,this.calcValue());if(this.it.index()!==this.logicalIntersectionIndex)return R.SQExprBuilder.nullConstant();var e=this.calcValue();return null===e?R.SQExprBuilder.nullConstant():this.parseCalcValueExpr(this.it.current()[this.calcId()],e)},x.prototype.parseCalcValueExpr=function(e,t){var r=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],i=this.context.valueDictionaryHandler.getCalcValueExpr(t,e,r.DN,r.T);return i=void 0===i?R.PrimitiveValueEncoding.parseOptimizedValueToSQExpr(t,e,r.T):i},x.prototype.calcCount=function(){return this.calcIt?this.calcIt.count():0},x);function x(e,t,r){this.context=t,this.parentDataMemberId=r,this.it=new P.Iterator(null),this.reset(e),this.baseCalculationParser=new i(3),this.intersectionMeasureCount=_.size(this.context.intersectionMeasureToSelectIndex),this.expectedIntersectionCount=_.size(this.context.secondaryLeafDataMemberId);e=t.dataMemberIdToMetadata[r];this.primaryMemberIsGroupMember=1===e.kind,this.primaryDataMemberDepth=e.depth,t.intersectionCalcMetadataCache,this.calcMetadataCache=t.intersectionCalcMetadataCache[r],this.calcMetadataCache||t.locked||(this.calcMetadataCache=t.intersectionCalcMetadataCache[r]=new Array(this.expectedIntersectionCount))}var C=(D.prototype.initialize=function(e){this.value=e,this.overflowValue=D.MaxSignedNumberFor32Bits<e?V(e):0},D.prototype.hasBitAtPosition=function(e){if(52<e)return!1;if(0<this.value){var t=0,r=this.value;return e<31?t=1<<e:(t=1<<e-31,r=this.overflowValue),0<(r&t)}},D.MaxSignedNumberFor32Bits=Math.pow(2,31)-1,D);function D(){}e.BitSequenceHandler=C;var E=(w.prototype.initialize=function(e){this.bitSequenceHandler.initialize(e)},w.prototype.tryRead=function(e){if(this.bitSequenceHandler.hasBitAtPosition(e))return null},w);function w(){this.bitSequenceHandler=new C}var I=(b.prototype.initialize=function(e,t){this.bitSequenceHandler.initialize(e),this.lastContainerCalculations=t},b.prototype.tryRead=function(e){if(this.bitSequenceHandler.hasBitAtPosition(e))return this.lastContainerCalculations[e]},b);function b(){this.bitSequenceHandler=new C}var M=31;function V(e){e=e.toString(2),e=e.substr(0,e.length-M);return parseInt(e,2)}e.getLast33BitsIn64Bits=V}((P=T.reader||(T.reader={})).V2||(P.V2={}))}(powerbi=powerbi||{}),function(i){var e;(function(d){var o=jsCommon.JsonComparer;d.http2MaxConnections=20;var e=(t.prototype.enqueue=function(e){var t,r=this;if(!function(e,t){var r=t.options;if(1===r.executionType){r.queryId;t=_.findIndex(e,function(e){return e.options.queryId===r.queryId});if(-1<t)return e[t].execution.rejected(),!0}return!1}(this.pending,e))return this.pending.push(e),this.currentBatchDeferred||(this.currentBatchDeferred=e.options.telemetryV2Enabled?new i.PbiDeferred(!0):$.Deferred(),t=this.immediateQuery?-1:0,this.timeoutService.setTimeout(t,this.telemetryV2Enabled).promise.then(function(){var e=r.createBatches();r.clearPending(),r.queryExecuteCallback(e),r.currentBatchDeferred.resolve(),r.currentBatchDeferred=void 0})),e.options.telemetryV2Enabled?this.currentBatchDeferred.promise:this.currentBatchDeferred.promise()},t.prototype.clearPending=function(){this.pending=[]},t.prototype.setMaxBatches=function(e){this.maxBatches=e,this.preferredMaxBatchesConfigured=0<e},t.prototype.createBatches=function(){var e=[],t=this.sortQueriesByDataSource(),r=this.maxBatches,i=!1;if(!this.preferredMaxBatchesConfigured&&this.useHttp2QueryDataEnabled&&(_.some(t,function(e){return _.some(e.dataSources,function(e){return e.isLimitedParallelQueryModel})})||(r=d.http2MaxConnections,i=!0)),t.length>=r)for(var a=0,n=t.length;a<n;++a)e.push(this.createBatchFromDataSourceGroup(t[a]));else e=this.splitDataSourcesIntoBatches(t,r);return i&&_.forEach(e,function(e){return e.useSynchronous=!0}),e},t.prototype.sortQueriesByDataSource=function(){var e,i=this;e=this.addVisualIdToQueryDataAsHttpBodyId?_.groupBy(this.pending,function(e){return null===(e=null===(e=null===(e=null==(e=e.options)?void 0:e.applicationContext)||void 0===e?void 0:e.Sources)||void 0===e?void 0:e[0])||void 0===e?void 0:e.VisualId}):{"":this.pending};var t=[];return _.forEach(e,function(e){var r=[];_.forEach(e,function(e){var t;!function(e){if(d.isRejectableQueuedExecution(e))return e.execution.rejected();return!1}(e)&&((t=i.findDataSourceGroup(e.options.dataSources,r,e.options.cacheResponseOnServer))?t.queuedExecutions.push(e):(e={dataSources:e.options.dataSources,queuedExecutions:[e],cacheResponseOnServer:e.options.cacheResponseOnServer,cacheOptions:e.options.cacheOptions},r.push(e)))}),t.push.apply(t,r)}),t},t.prototype.findDataSourceGroup=function(e,t,r){for(var i=0,a=t.length;i<a;++i){var n=t[i];if(o.equals(e,n.dataSources)&&n.cacheResponseOnServer===r)return n}return null},t.prototype.createBatchFromDataSourceGroup=function(e){for(var t=[],r=[],i=[],a=e.queuedExecutions,n=[],o=[],s=0,u=a.length;s<u;++s){var c=a[s],l=a[s].options,p=a[s].enqueueActivity;d.isRejectableQueuedExecution(c)?(t.push(l),i.push(c.deferred),p&&n.push(p),a[s].queryActivity&&o.push(a[s].queryActivity)):(l.executionType,r.push(l))}return{dataSources:e.dataSources,queryOptions:t,cancelQueryOptions:r,promises:i,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,enqueueActivities:n,queryActivities:o}},t.prototype.splitDataSourcesIntoBatches=function(e,t){for(var r=[],i=0,a=e.length;i<a;++i)r.push(this.createBatchFromDataSourceGroup(e[i]));return r=this.splitBatches(r,t)},t.prototype.splitBatches=function(e,t){for(var r=e.slice();r.length<t;){for(var i=void 0,a=0,n=r.length;a<n;++a){var o=r[a];1<o.queryOptions.length&&(!i||i.queryOptions.length<o.queryOptions.length)&&(i=o)}if(!i)return r;r.push(this.splitBatch(i)),i=null}return r},t.prototype.splitBatch=function(e){var t=e.queryOptions.length,r=e.queryOptions.splice(t/2),i=e.promises.splice(t/2),a=e.enqueueActivities.splice(t/2),n=e.queryActivities.splice(t/2),o=e.cancelQueryOptions.length,t=[];return o&&(t=e.cancelQueryOptions.splice(o/2)),{dataSources:e.dataSources,queryOptions:r,promises:i,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,cancelQueryOptions:t,enqueueActivities:a,queryActivities:n}},t);function t(e,t,r,i,a,n){this.addVisualIdToQueryDataAsHttpBodyId=a,this.immediateQuery=n,this.preferredMaxBatchesConfigured=0<e,this.maxBatches=this.preferredMaxBatchesConfigured?e:4,this.queryExecuteCallback=t,this.pending=[],this.timeoutService=r,this.telemetryV2Enabled=i,this.useHttp2QueryDataEnabled=jsCommon.BrowserUtils.browserSupportsHttp2()}d.ExecuteSemanticQueryBatcher=e,d.createBatchFromQueries=function(e,t,r,i,a){return{queryOptions:_.map(e,function(e){return{command:e,dataSources:t}}),cancelQueryOptions:[],cacheOptions:r,dataSources:t,cacheResponseOnServer:i,promises:[],enqueueActivities:[],queryActivities:[],useSynchronous:a}}})((e=i.data||(i.data={})).dsr||(e.dsr={}))}(powerbi=powerbi||{}),function(v){var e;(function(y){var t=v.ClientErrorStrings,e=v.telemetry.DataQueryDataEventName,i=jsCommon.HttpUtils;y.createExecuteSemanticQueryProxyHttpCommunication=function(e,t,r,i,a,n,o,s,u){return new c(e,t,r,i,a,n,o,s)},y.executeSemanticQueryRequestVersion1="1.0.0";var c=(r.prototype.execute=function(e){for(var t=this.httpService.powerbiRequestOptions(null,"ExecuteSemanticQuery",void 0,!0),r=y.generateSemanticQueryRequest(e,this.localeProvider,this.impersonationStateProvider),i=0,a=e.enqueueActivities;i<a.length;i++)a[i].resolve();var n=this.featureSwitches&&this.featureSwitches().telemetryV2,o=this.featureSwitches&&this.featureSwitches().addVisualIdToQueryDataAsHttpBodyId,s=this.promiseFactory.defer(n),u=e.cacheOptions,c=e.useSynchronous,l=e.dataSources[0].dbName,p=!1;(!l||1<e.dataSources.length)&&(this.telemetryService.logEvent(v.telemetry.Error,{message:"A direct to MWC request was missing a dbName or more then one source was used in this request. This will cause issues routing with AutoPremium"}),p=!0);n=this.uri;(c||o)&&(f={},c&&(f.synchronous="true"),!o||(m=null===(h=null===(m=null===(h=null===(m=null===(h=e.queryOptions)||void 0===h?void 0:h[0])||void 0===m?void 0:m.applicationContext)||void 0===h?void 0:h.Sources)||void 0===m?void 0:m[0])||void 0===h?void 0:h.VisualId)&&(f.$httpBodyId=m),n=jsCommon.UrlUtils.setQueryParameters(n,f,!0));var d,h=n,m=t.authorizationHeaderOverride,f=r.modelId;return!(this.featureSwitches&&this.featureSwitches().directToMwc&&this.directToMwcConnectionInfoService)||!(d=this.directToMwcConnectionInfoService.checkModelConnectionInfo(f))||this.impersonationStateProvider&&this.impersonationStateProvider.impersonating||p?this.sendHttpRequest(n,r,t,s,u,e.queryActivities,c):this.sendDirectToMwcRequestWithFallbackOnFailure(d,n,r,t,s,f,h,m,u,l,e.queryActivities,c),s.promise},r.prototype.sendDirectToMwcRequestWithFallbackOnFailure=function(e,a,n,o,s,u,c,l,p,t,d,h){var m=this;a=e.capacityUri+"query",o.mwcTokenAuthorizationModelId=u,o.authorizationHeaderOverride=e.mwcToken;var f=this.telemetryService.startEvent(v.telemetry.DataQueryData,{endPoint:this.uri,clientAndServerRequestIdMatch:!0,synchronous:h,cacheOptions:p});o.headers["x-ms-root-activity-id"]=o.headers.RequestId,o.headers["x-ms-parent-activity-id"]=o.headers.RequestId,o.headers["x-ms-workload-resource-moniker"]=t;for(var y=[],r=0,i=d;r<i.length;r++){var g=i[r].createChildActivity({name:"Query Executing"});g&&y.push(g)}this.httpService.post(a,n,o).then(function(e){m.attachHttpMetadataToTelemetry(f.event,e,a),m.attachCacheMetadataToTelemetryDirectToMwc(f.event,e);for(var t=0,r=y;t<r.length;t++){var i=r[t];m.attachHttpMetadataToContextActivity(i,e),i.resolve()}f.resolve(),s.resolve(m.attachHttpMetadataToResult(e))},function(e){m.attachHttpMetadataToTelemetry(f.event,e,a),m.attachCacheMetadataToTelemetryDirectToMwc(f.event,e);for(var t=0,r=y;t<r.length;t++){var i=r[t];m.attachHttpMetadataToContextActivity(i,e),i.reject()}f.reject(v.errorDetailsHelper.getTelemetryErrorDetails(e.error,e.status)),m.directToMwcConnectionInfoService.removeModelConnectionInfo(u),o.authorizationHeaderOverride=l,o.mwcTokenAuthorizationModelId=null,m.sendHttpRequest(c,n,o,s,p,d,h)})},r.prototype.sendHttpRequest=function(a,e,t,n,r,i,o){for(var s=this,u=this.telemetryService.startEvent(v.telemetry.DataQueryData,{endPoint:this.uri,clientAndServerRequestIdMatch:!0,synchronous:o,cacheOptions:r}),c=[],l=0,p=i;l<p.length;l++){var d=p[l].createChildActivity({name:"Query Executing"});d&&c.push(d)}this.httpService.post(a,e,t).then(function(e){s.attachHttpMetadataToTelemetry(u.event,e,a);for(var t=0,r=c;t<r.length;t++){var i=r[t];s.attachHttpMetadataToContextActivity(i,e),i.resolve()}u.resolve(),n.resolve(s.attachHttpMetadataToResult(e))},function(e){s.attachHttpMetadataToTelemetry(u.event,e,a);for(var t=0,r=c;t<r.length;t++){var i=r[t];s.attachHttpMetadataToContextActivity(i,e),i.reject()}u.reject(v.errorDetailsHelper.getTelemetryErrorDetails(e.error,e.status)),n.reject(s.attachHttpMetadataToResult(e))})},r.prototype.attachHttpMetadataToContextActivity=function(e,t){var r;t.performanceTimings&&(e.setProperty("transferSize",null===(r=t.performanceTimings)||void 0===r?void 0:r.transferSize),e.setProperty("contentType",t.headers("content-type")),e.setProperty("httpStatus",t.status.toString()),e.setProperty("requestId",t.requestId),e.setProperty("requestStart",null===(r=t.performanceTimings)||void 0===r?void 0:r.requestStart),e.setProperty("responseStart",null===(r=t.performanceTimings)||void 0===r?void 0:r.responseStart),e.setProperty("start",t.performanceTimings.startTime),e.setProperty("end",t.performanceTimings.responseEnd))},r.prototype.attachHttpMetadataToTelemetry=function(e,t,r){e.info.endPoint=r,e.info.clientAndServerRequestIdMatch=i.clientAndServerRequestIdMatch(t),e.info.responseRequestId=i.getResponseRequestId(t),e.info.requestId=t.requestId,e.info.cacheOptions=t.headers("cache-control"),e.info.status=t.status,t.performanceTimings&&(e.info.contentLength=t.performanceTimings.transferSize,e.info.startTime=t.performanceTimings.startTime,e.info.requestStart=t.performanceTimings.requestStart,e.info.responseStart=t.performanceTimings.responseStart,e.info.responseEnd=t.performanceTimings.responseEnd)},r.prototype.attachCacheMetadataToTelemetryDirectToMwc=function(e,t){t.data.results&&(e.info.fromCache=_.reduce(t.data.results,function(e,t){return t.fromCache?++e:e},0),e.info.resultCount=t.data.results.length)},r.prototype.attachHttpMetadataToResult=function(e){if(e&&e.data){var t=e.data;return t.requestId=e.responseRequestId||e.requestId,t.httpStatusCode=e.status,t}return{jobIds:null,results:null,requestId:e.responseRequestId||e.requestId,httpStatusCode:e.status}},__decorate([v.MonitorWith(e)],r.prototype,"execute",null),r);function r(e,t,r,i,a,n,o,s){this.httpService=e,this.impersonationStateProvider=n,this.promiseFactory=i,this.telemetryService=t,this.localeProvider=r,this.uri=a,this.featureSwitches=o,this.directToMwcConnectionInfoService=s}a.prototype.setQueryContext=function(i){var a;return __awaiter(this,void 0,v.Promise,function(){var t,r;return __generator(this,function(e){switch(e.label){case 0:if(null===(a=this.featureSwitches)||void 0===a||!a.queryContext)return[2];if(!this.queryContextProvider||!i.options.applicationContext)return[2];_.size(i.options.applicationContext.Sources),t=i.options.applicationContext.Sources[0],e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.queryContextProvider.generateQueryContext()];case 2:return(r=e.sent())?(t.CustomProperties=__assign(__assign({},t.CustomProperties),r),[3,4]):[2];case 3:return e.sent(),[2];case 4:return[2]}})})},a.prototype.enqueueExecution=function(e){this.isCommunicationStopped?(this.pausedQueries=this.pausedQueries||[],this.pausedQueries.push(e)):this.batcher.enqueue(e)},a.prototype.execute=function(e){if(!_.isEmpty(e.dataSources))return this.queryCache.ensure(e);var t=this.promiseFactory.defer(e.telemetryV2Enabled),r=v.createRejectablePromise2(t);return t.resolve(e.command),r},a.prototype.stopCommunication=function(){this.isCommunicationStopped=!0},a.prototype.resumeCommunication=function(){this.isCommunicationStopped=!1;var e=this.pausedQueries;if(e){for(var t=0,r=e.length;t<r;t++){var i=e[t];!function(e){if(m(e))return e.execution.pending();return!1}(i)||this.batcher.enqueue(i)}this.pausedQueries=void 0}},a.prototype.cache=function(){return this.queryCache},a.prototype.setLocalCacheResult=function(e,t){this.queryCache.put(e.dataSources,e.command,t)},a.prototype.setPreferredMaxConnections=function(e){this.batcher.setMaxBatches(e)},a.prototype.executeBatch=function(e){var t=this;e.queryOptions.length,e.promises.length;var r=e.promises;this.communication.execute(e).then(function(e){return t.onSuccess(e,r)},function(e){return t.onError(e,r)})},a.prototype.onSuccess=function(e,t){this.rejectExecutionsForMissingJobs(e,t);for(var r=e.jobIds,i={},a=0,n=t.length;a<n;++a)i[r[a]]=t[a];for(var o=e.results,a=0,n=o.length;a<n;++a){var s=o[a],u=s.result,c=i[h=s.jobId];delete i[h];var l,p=u.data,d=u.error;p?(l={descriptor:p.descriptor,dsr:p.dsr,metrics:p.metrics,requestId:e.requestId,timestamp:p.timestamp,fromCache:p.fromCache},c.resolve(l)):d?((l=new v.ServiceErrorToClientError(d)).requestId=e.requestId,c.reject(l)):u.asyncResult&&this.delayedQueryResultResolver.resolveDelayedQuery(s.jobId,e.requestId,c)}if(!_.isEmpty(Object.keys(i))){var h,d=new y.ExecuteSemanticQueryProxyError(e.requestId,"MissingJobResult");for(h in i)i[h].reject(d)}},a.prototype.rejectExecutionsForMissingJobs=function(e,t){var r=e.jobIds.length,i=t.length;if(r<i)for(var a=new y.ExecuteSemanticQueryProxyError(e.requestId,"MissingJobId"),n=r;n<i;n++)t[n].reject(a)},a.prototype.onError=function(e,t){var r,i,a,n,o;(r=e&&e.requestError?new v.ServiceErrorToClientError(e.requestError):r)?r.requestId=e.requestId:(i=n=a=void 0,(o=e.error)&&(a=o.message,n=o.code,null!=(o=o["pbi.error"]&&o["pbi.error"].exceptionCulprit)&&(i=v.errorDetailsHelper.getErrorSource(o))),r=e&&null!=e.httpStatusCode&&e.requestId?new v.HttpClientError(e.httpStatusCode,e.requestId,n,a,i):new p(e.requestId));for(var s=0,u=t.length;s<u;s++)t[s].reject(r)},e=a;function a(e,t,r,i,a,n,o,s){var u=this;this.communication=t,this.telemetryService=i,this.featureSwitches=o,this.queryContextProvider=s,this.promiseFactory=e.promiseFactory(),this.delayedQueryResultResolver=a||new l,this.batcher=new y.ExecuteSemanticQueryBatcher(null==n?0:n,function(e){for(var t=0,r=e.length;t<r;++t)u.executeBatch(e[t])},r,o&&o.telemetryV2,o&&o.addVisualIdToQueryDataAsHttpBodyId,o&&o.immediateQuery),this.queryCache=y.createQueryCache(this.promiseFactory,this.telemetryService,function(e,t){var r={options:e,deferred:t.deferred,execution:t.promise,enqueueActivity:e.performanceActivity&&e.performanceActivity.isRunning()&&e.performanceActivity.createChildActivity({name:"Query Pending"}),queryActivity:e.performanceActivity};null!==(e=u.featureSwitches)&&void 0!==e&&e.queryContext?u.setQueryContext(r).then(function(){return u.enqueueExecution(r)}):u.enqueueExecution(r)},function(e,t){u.telemetryService.logEvent(v.telemetry.DataQueryCancellation,{source:t}),u.enqueueExecution({options:e,enqueueActivity:e.performanceActivity&&e.performanceActivity.isRunning()&&e.performanceActivity.createChildActivity({name:"Query Pending"}),queryActivity:e.performanceActivity})},o)}y.ExecuteSemanticQueryProxy=e;var l=(n.prototype.resolveDelayedQuery=function(e,t,r){r.reject(new d(e))},n);function n(){}var o,p=(o=v.UnknownClientError,__extends(s,o),Object.defineProperty(s.prototype,"requestId",{get:function(){return this.httpRequestId},enumerable:!1,configurable:!0}),s.prototype.getDetails=function(e){e=o.prototype.getDetails.call(this,e);return e.debugErrorInfo=e.debugErrorInfo||[],e.debugErrorInfo.push({errorInfoKey:t.HttpRequestId,errorInfoValue:this.httpRequestId}),e},s);function s(e){var t=this;return(t=o.call(this,"ExecuteSemanticQueryUnknownError")||this).httpRequestId=e,t}var u,d=(u=v.UnknownClientError,__extends(h,u),h.prototype.getDetails=function(e){e=u.prototype.getDetails.call(this,e);return e.debugErrorInfo=e.debugErrorInfo||[],e.debugErrorInfo.push({errorInfoKey:t.JobId,errorInfoValue:this.jobId}),e},h);function h(e){var t=this;return(t=u.call(this,"DelayedQueryTimeoutError")||this).jobId=e,t}function m(e){return null!=e&&void 0!==e.deferred&&void 0!==e.execution}y.single=function(e){return e.length,_.head(e)},y.isRejectableQueuedExecution=m})((e=v.data||(v.data={})).dsr||(e.dsr={}))}(powerbi=powerbi||{}),function(r){!function(e){function t(e,t){this.requestId=e,this.errorCode=t}e=e.dsr||(e.dsr={}),Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("ServiceError_ExecuteSemanticQueryErrorValue")},{errorInfoKey:e.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:this.code}],debugErrorInfo:[{errorInfoKey:r.ClientErrorStrings.ClientErrorCode,errorInfoValue:this.code}]}},e.ExecuteSemanticQueryProxyError=t}(r.data||(r.data={}))}(powerbi=powerbi||{}),function(e){var u;e=(e=e.data||(e.data={})).dsr||(e.dsr={}),u=jsCommon.DateExtensions,e.parseExecutionEvents=function(e,t){for(var r=[],i={},a=0,n=e;a<n.length;a++){var o=n[a],s={id:o.Id,name:o.Name,component:o.Component,pageHidden:void 0,start:u.parseIsoDate(o.Start).valueOf(),end:o.End?u.parseIsoDate(o.End).valueOf():void 0,metrics:o.Metrics,status:1,rootId:t,parentId:o.ParentId};o.ParentId?(i[o.ParentId]||(i[o.ParentId]=[]),i[o.ParentId].push(s)):r.push(s)}return function e(t,r){for(var i=0,a=t;i<a.length;i++){var n=a[i];r[n.id]&&(n.children=r[n.id],e(n.children,r))}}(r,i),r}}(powerbi=powerbi||{}),function(e){var o,t,u;function c(e,t){e.query=e.query.addSelect(t);var r=e.query.select(),i=o.SQExprUtils.indexOfNamedExpr(r,t),r=r[i];return(e.additionalProjections||(e.additionalProjections=[])).push({queryName:r.name,selector:null}),{index:i,expr:t,queryName:r.name}}o=e.data||(e.data={}),t=o.dsr||(o.dsr={}),u=e.data.SQExprBuilder,(t.AggregatesQueryRewriter||(t.AggregatesQueryRewriter={})).run=function(e){var t=e.mappings;if(1!==t.length)return e;var r=function(e){var a,n;if(o.CompiledDataViewMapping.visitMapping(e,{visitRole:function(e){if(e.aggregates&&!_.isEmpty(e.items)){a||(a={},n=[]);for(var t=0,r=e.items;t<r.length;t++){var i=r[t];a[i.queryName]=e.aggregates}n.push(e)}}}),a)return{queryNames:a,roles:n}}(t[0]);return r&&(t=(t=e.queryRewrites)||(e.queryRewrites=[]),function(e,t,r){var i,a=e.query.select();for(i in t){var n=a.withName(i).expr,o=t[i],s={};o.min&&(s.min=c(e,u.aggregate(n,3))),o.max&&(s.max=c(e,u.aggregate(n,4))),r.push({aggregatesAdded:{originalQueryRef:i,aggregates:s}})}}(e,r.queryNames,t),function(e){for(var t=e.queryNames,r=0,i=e.roles;r<i.length;r++){var a=i[r];a.items,_.remove(a.items,function(e){return t[e.queryName]})}}(r)),e}}(powerbi=powerbi||{}),function(e){var v,S,o;function x(e,t,r,i){var a=r.queryName,n=(n=e[a])||(e[a]={categoryAndValueGroup:[],categoryOnly:[]}),r={roleName:t,roleItem:r};(i?n.categoryAndValueGroup:n.categoryOnly).push(r)}function C(e,t){for(var r={for:{in:t}},i=0,a=e;i<a.length;i++){var n=a[i];if(o.equals(n,r))return}e.push(r)}v=e.data||(e.data={}),S=v.dsr||(v.dsr={}),o=jsCommon.JsonComparer,(S.MultiMappedQueryRewriter||(S.MultiMappedQueryRewriter={})).run=function(e){var t=e.mappings.length;return 1===t?e:1<t?function(e,t,r){for(var i=[],a=[],n={by:null,select:[]},o={categories:{select:i},values:{group:n,select:a}},s={},u=0,c=t;u<c.length;u++){var l=c[u];if(!l.categorical)return;l=l.categorical;!function(e,n,t,o,s){var u,r=e.values;r&&(v.CompiledDataViewMapping.visitCategoricalCategories(e.categories,{visitRole:function(e){C(t,e)}}),v.CompiledDataViewMapping.visitGrouped(r,{visitRole:function(e){if((s.by=e).items)for(var t=0,r=e.items;t<r.length;t++){var i=r[t];x(n,e.role,i,!0),u=!0}}}),v.CompiledDataViewMapping.visitCategoricalValues(r,{visitRole:function(e,t){if(C("CategoricalValueGroup"===t?s.select:o,e),e.items)for(var r=0,i=e.items;r<i.length;r++){var a=i[r];x(n,e.role,a,u)}}}))}(l,s,i,a,n),null==o.dataVolume||null==l.dataVolume||(l.dataVolume,o.dataVolume),null!=l.dataVolume&&null==o.dataVolume&&(o.dataVolume=l.dataVolume)}var p,d=[];for(p in s){var h=s[p];if(!_.isEmpty(h.categoryAndValueGroup)&&!_.isEmpty(h.categoryOnly))for(var m=0,f=h.categoryAndValueGroup;m<f.length;m++){var y=f[m],g=y.roleItem,y=S.QueryRewriterUtils.duplicateSelect(e,g.queryName,y.roleName);g.queryName=y.newQueryName,e=y.newQuery,d.push.apply(d,y.rewriteRecords)}}return{query:e,mappings:[{metadata:t[0].metadata,categorical:o}],queryRewrites:_.isEmpty(d)?void 0:d,additionalProjections:r}}(e.query,e.mappings,e.additionalProjections):void 0}}(powerbi=powerbi||{}),function(e){var t;e=e.data||(e.data={}),(t=e.dsr||(e.dsr={})).DefaultSchemaName=void 0,t.schemaName=function(e){return e.Schema||t.DefaultSchemaName},(e=t.SelectKind||(t.SelectKind={}))[e.None=0]="None",e[e.Group=1]="Group",e[e.Measure=2]="Measure"}(powerbi=powerbi||{}),function(e){(function(e){function r(e,t,r){if(e){t.visitDescriptor(e,r);var i=e.Select;if(i&&i.length)for(var a=0,n=i.length;a<n;a++)t.visitSelect(i[a],r);e=e.Expressions;e&&function(e,t,r){t.visitExpressions(e,r),e.Primary,o(e.Primary,t,r);e=e.Secondary;e&&o(e,t,r)}(e,t,r)}}function o(e,t,r){t.visitDataShapeExpressionsAxis(e,r);for(var i=e.Groupings,a=0,n=i.length;a<n;a++)!function(e,t,r){t.visitDataShapeExpressionsAxisGrouping(e,r);var i=e.Keys;for(var a=0,n=i.length;a<n;a++)!function(e,t,r){t.visitDataShapeExpressionsAxisGroupingKey(e,r),e.Source,t.visitConceptualPropertyReference(e.Source,r)}(i[a],t,r)}(i[a],t,r)}e.traverseQueryBindingDescriptor=function(e,t){r(e,t,void 0)},e.traverseQueryBindingDescriptorWithArg=r;var t=(i.prototype.visitDescriptor=function(e,t){},i.prototype.visitSelect=function(e,t){},i.prototype.visitExpressions=function(e,t){},i.prototype.visitDataShapeExpressionsAxis=function(e,t){},i.prototype.visitDataShapeExpressionsAxisGrouping=function(e,t){},i.prototype.visitDataShapeExpressionsAxisGroupingKey=function(e,t){},i.prototype.visitConceptualPropertyReference=function(e,t){},i);function i(){}e.DefaultQueryBindingDescriptorVisitorWithArg=t;var a,t=(__extends(n,a=t),n);function n(){return null!==a&&a.apply(this,arguments)||this}e.DefaultQueryBindingDescriptorVisitor=t})((e=e.data||(e.data={})).dsr||(e.dsr={}))}(powerbi=powerbi||{}),function(e){!function(e){var t,u;function r(e,t){e.Select,t.ScriptVisualBinding||(t.Select,e.Select.length,t.Select.length),this._metadata=e,this._binding=t}t=e.dsr||(e.dsr={}),u=jsCommon.ArrayExtensions,r.prototype.getSelectRestatements=function(){return this.getRestatements()},r.prototype.getGroupRestatements=function(){return this.getRestatements(t.SelectKind.Group)},r.prototype.getMeasureRestatements=function(){return this.getRestatements(t.SelectKind.Measure)},r.prototype.getFilterRestatements=function(){var e=this._metadata.Filters;if(_.isEmpty(e))return null;for(var t=[],r=0,i=e.length;r<i;r++){var a=e[r];t.push(a?a.Restatement:"")}return u.emptyToNull(t)},r.prototype.getRestatements=function(e){var t=this._metadata,r=this._binding,i=[];if(!r.ScriptVisualBinding)for(var a=0,n=t.Select.length;a<n;a++){var o=r.Select[a],s=t.Select[a];o&&(void 0!==e&&o.Kind!==e||i.push(s.Restatement||""))}return u.emptyToNull(i)},t.QueryDescription=r}(e.data||(e.data={}))}(powerbi=powerbi||{}),function(v){var w;(function(c){var l=jsCommon.ArrayExtensions,E=v.data.services,a=v.data.FilterKindDetector,i=v.data.dsr.SelectToIdentityExpressionsVisitor,d=v.data.SQExpr;c.createQueryGenerator=function(e){return new t(w.services.SemanticQuerySerializer,e)};var S,t=(e.prototype.execute=function(e){var t=this.executeForQueryOnlyImpl(e);if(!t||!t.dataShapeBinding&&t.mergedQueries&&t.mergedQueries.mapping&&2===t.mergedQueries.mapping.updateType)return{command:void 0};var r=t.mergedQueries,i=t.dataShapeBinding,a=t.query;this.adjustIntersectionDataReduction(i,r.mapping,a,e.highVolumeOverride),_.isEmpty(a.groupBy())||this.applyDataReductionForGroupByQuery(i,a);var n=t.mergedQueries&&t.mergedQueries.mapping&&1===t.mergedQueries.mapping.updateType&&_.isEmpty(e.additionalProjections);return{command:this.createDataQuery(a,t.queryExtensionSchema,e.dataSourceVariables,i,t.compiledDataViewMappings,e.dataWindow,e.executionMetricsKinds,e.anchorTime),splits:r.splits,queryRewrites:t.queryRewrites,deferred:n}},e.prototype.executeForQueryOnly=function(e){e=this.executeForQueryOnlyImpl(e);return e&&e.query},e.prototype.produceIdentities=function(e,t){var r=new i;return e.accept(r,t)},e.prototype.executeForQueryOnlyImpl=function(e){var t,r=this.getQueryableMappings(e.mappings),i=this.prepareQuery(e.query,r,e.additionalProjections),a=i.query,n=i.mappings,o=i.queryRewrites,s=i.additionalProjections,i=S.getIndicesByName(a),r=c.mergeMappings(r,i);w.applyDataReductionDefaults(e.mappings),e.highVolumeOverride&&(t=6),r.mapping.categorical&&S.updateMappingsWithScalarKeys(r.mapping,i);var u,s=c.generateDataShapeBinding(this.serializer,i,r.mapping,a.select(),s,e.highlightFilter,e.restartToken,a.groupBy(),t,e.expansionStates,e.keepProjectionOrder,e.noDefaultProjections,e.windowExpansion,this.featureSwitches);return w.DataViewPivotCategoricalToPrimaryGroups.pivotBinding(s,n,r.mapping,a.select(),3,t),this.queryHasMeasureFilter(a)&&s&&(this.processTargetsForMeasureFilters(a,n,s),a=this.adjustQueryMeasureFilters(a,s)),e.queryExtensionLookup&&(a=(e=e.queryExtensionLookup(a,o)).query,u=e.extensions,o=e.queryRewrites),{query:a,queryExtensionSchema:u,mergedQueries:r,dataShapeBinding:s,compiledDataViewMappings:n,queryRewrites:o}},e.prototype.hasAmbiguousEqualitySemantics=function(e){return d.equals(e,w.SQExprBuilder.boolean(!1))||d.equals(e,w.SQExprBuilder.integer(0))},e.prototype.getQueryableMappings=function(e){return _.filter(e,function(e){return!e.usage||!e.usage.regression})},e.prototype.prepareQuery=function(e,t,r){for(var i=0,a=x(t,e.select());i<a.length;i++){var n=a[i];e=e.rewrite(n)}r=this.rewriteQuery(e,t,r);return r.query=function(e){for(var t,r=e.select(),i=r.length-1;0<=i;i--)d.isConstant(r[i].expr)&&(r.splice(i,1),t=!0);if(t)return e.select(r);return e}(r.query),r},e.prototype.rewriteQuery=function(e,t,r){r={query:e,mappings:t,additionalProjections:r},r=c.MultiMappedQueryRewriter.run(r);return r=c.AggregatesQueryRewriter.run(r),r=this.featureSwitches&&this.featureSwitches.scopedMeasuresEnabled?c.ScopedValuesQueryRewriter.run(r,!0):r},e.prototype.adjustIntersectionDataReduction=function(e,t,r,i){var a,n;!t.categorical||(a=t.categorical).dataReductionAlgorithm&&(e.DataReduction&&e.DataReduction.Intersection?(e.Secondary&&e.Primary,e.Primary&&!e.Secondary&&(e.DataReduction.Primary,e.DataReduction.Primary=e.DataReduction.Intersection,e.DataReduction.Intersection=void 0)):(n=e.Primary&&(!e.DataReduction||!e.DataReduction.Primary),t=e.Secondary&&(!e.DataReduction||!e.DataReduction.Secondary),(n||t)&&(e.DataReduction||(e.DataReduction={DataVolume:a.dataVolume||(i?6:3)}),n&&(e.DataReduction.Primary=w.DataShapeBindingDataReduction.createFrom(a.dataReductionAlgorithm,r.select())),t&&(e.DataReduction.Secondary=w.DataShapeBindingDataReduction.createFrom(a.dataReductionAlgorithm,r.select())))))},e.prototype.applyDataReductionForGroupByQuery=function(e,t){e.DataReduction={},e.DataReduction.Primary=w.DataShapeBindingDataReduction.createFrom({top:{count:1e3}},t.select())},e.prototype.generateScriptVisualCommand=function(e,t){var r=v.ScriptResultUtil.extractScriptResult(e);if(!(r=r||v.ScriptResultUtil.extractScriptResultDefaultFromDataViewMappings(e)))return null;r={Version:0,Script:r.source,RenderingEngine:r.provider,ScriptOutputType:r.outputType};t&&t.height&&t.width&&(r.ViewportWidthPx=t.width,r.ViewportHeightPx=t.height);e=v.ScriptResultUtil.findScriptResultMapping(e);return e&&e.script.scriptInput&&(r.ScriptInput=e.script.scriptInput),{ScriptVisualCommand:r}},e.prototype.queryHasMeasureFilter=function(e){for(var t=0,r=e.where();t<r.length;t++){var i=r[t];if(1===a.runDetector(i.condition))return!0}return!1},e.prototype.removeExprFromTargetExprs=function(e,t){for(var r=0,i=e;r<i.length;r++){var a=i[r].target;if(null!=a)for(var n=0,o=a.length;n<o;n++)d.equals(a[n],t)&&a.splice(n,1)}},e.prototype.processTargetsForMeasureFilters=function(s,e,t){for(var u=this,c=this.getProjectedSelectIndexMap(t),r=0,i=e;r<i.length;r++){var a=i[r];w.CompiledDataViewMapping.visitMapping(a,{visitRole:function(e){var t=e.activeItems,r=e.items;if(t&&!_.isEmpty(t)&&!_.isEmpty(r))for(var i=_.findIndex(r,function(e){return _.includes(t,e.queryName)}),a=0;a<i;a++){var n=r[a].queryName,o=s.select(),n=l.indexWithName(o,n);c[n]||(n=o[n].expr,u.removeExprFromTargetExprs(s.where(),n))}}})}},e.prototype.adjustQueryMeasureFilters=function(e,t){var r=e.where(),i=[],a=[];if(_.isEmpty(t.Primary.Groupings)||_.isEmpty(t.Primary.Groupings[0].Projections)||!_.isEmpty(t.Secondary))return e;for(var n=e.select(),o=0,s=t.Primary.Groupings[0].Projections;o<s.length;o++){var u=n[s[o]];if(!w.SQExprUtils.isMeasure(u.expr))return e}for(var c=0,l=r;c<l.length;c++){var p=l[c];_.isEmpty(p.target)?a.push(p):i.push(p)}if(_.isEmpty(i))return e;r=w.SemanticQuery.createWith({from:e.from(),select:e.select(),orderBy:e.orderBy(),top:e.top(),transforms:e.transforms(),groupBy:e.groupBy(),where:a}),t=w.SemanticFilter.fromMeasureFilters(e,i,t);return r=r.addSemanticFilter(t)},e.prototype.getProjectedSelectIndexMap=function(e){return e?_.chain([e.Primary,e.Secondary]).filter(function(e){return e&&!_.isEmpty(e.Groupings)}).map(function(e){return e.Groupings}).flatten().filter(function(e){return!_.isEmpty(e.Projections)}).map(function(e){return e.Projections}).flatten(!1).reduce(function(e,t){return e[t]=!0,e},{}).value():{}},e.prototype.createDataQuery=function(e,t,r,i,a,n,o,s){s={Query:this.serializer.serializeQuery(e),Binding:i,AnchorTime:s};t&&(s.Extension=t),r&&(s.DataSourceVariables=r),o&&(s.ExecutionMetricsKind=o);s={Commands:[{SemanticQueryDataShapeCommand:s}]},n=this.generateScriptVisualCommand(a,n);return n&&s.Commands.push(n),s},e);function e(e,t){this.serializer=e,this.featureSwitches=t}function x(e,t){return[new n,new m(e,t),new u]}c.generateDataShapeBinding=function(e,t,r,i,a,n,o,s,u,c,l,p,d,h){var m,f=n;if(n)for(var y=0,g=x([r],i);y<g.length;y++)var v=g[y],f=f.rewrite(v);return n&&(m=[e.serializeFilter(f)]),S.generateBaseDataShapeBinding(t,r,i,a,m,o,s,u,c,e,l,p,d,h)},function(e){e.generateBaseDataShapeBinding=function e(t,r,i,a,n,o,s,u,c,l,p,d,h,m){var f,y,g,v,S,x,n=new D(t,i,p,m).withRestartToken(o).withHighlightFilter(n).withAdditionalProjections(a);if(r.table?n=n.withGroupBy(s):_.isEmpty(s),2!==r.updateType)if(r.categorical)v=n,S=r.categorical,x=d,w.CompiledDataViewMapping.visitCategoricalCategories(S.categories,{visitRole:function(e){v.withPrimaryGrouping(e.items,e.activeItems,e.showAll,e.subtotalType,!0,x)},visitReduction:function(e){v.withPrimaryDataReduction(e)}}),w.CompiledDataViewMapping.visitGrouped(S.values,{visitRole:function(e){v.withSecondaryGrouping(e.items,e.activeItems,e.showAll,e.subtotalType,x)},visitReduction:function(e){v.withSecondaryDataReduction(e)}}),w.CompiledDataViewMapping.visitCategoricalValues(S.values,{visitRole:function(e,t){v.withCurrentInnermostPrimaryGrouping(e.items,e.showAll,e.subtotalType,"CategoricalValueGroup"!==t)}}),v.withIntersectionDataReduction(S.dataReductionAlgorithm).withDataVolume(S.dataVolume).withIncludeEmptyGroups(S.includeEmptyGroups);else if(r.table)g=n,S=r.table,w.CompiledDataViewMapping.visitTable(S,{visitRole:function(e){g.withPrimaryGrouping(e.items,e.activeItems,e.showAll,e.subtotalType,!0,!1)},visitReduction:function(e){g.withPrimaryDataReduction(e)}}),g.withDataVolume(S.dataVolume);else if(r.matrix)!function(t,e,r,i,a){var n=new C(t,i);w.CompiledDataViewMapping.visitMatrixRows(e.rows,n),r&&r.length,(r=function(e,t,r,i,a){if(!(_.isEmpty(i)||_.isEmpty(t)&&a||(i=_.find(i,function(e){return _.isEqual(e.roles,r)}),_.isEmpty(i.levels))))return e=_.uniqBy(e,function(e){return e.queryName}),t=_.uniq(t),t=(_.isEmpty(t)?e:t).length-1,E.DataShapeBindingExpansionStateSerializer.serializeExpansionState(i,t)}(n.primaryRoleItems,n.primaryActiveRoleItems,n.primaryRoles,r,i))&&t.withPrimaryExpansion(r),a&&t.withPrimaryWindowExpansion(a),w.CompiledDataViewMapping.visitMatrixColumns(e.columns,{visitRole:function(e){t.withSecondaryGroupingNested(e.items,e.activeItems,e.showAll,e.subtotalType,i)},visitReduction:function(e){t.withSecondaryDataReduction(e)}}),w.CompiledDataViewMapping.visitMatrixValues(e.values,{visitRole:function(e){t.withCurrentInnermostGrouping(e.items,e.showAll,e.subtotalType)}}),t.withDataVolume(e.dataVolume),t.withIncludeEmptyGroups(e.includeEmptyGroups)}(n,r.matrix,c,d,h);else if(r.tree)f=n,h=r.tree,y=d,w.CompiledDataViewMapping.visitTreeNodes(h.nodes,{visitRole:function(e){f.withPrimaryGroupingNested(e.items,e.activeItems,e.showAll,e.subtotalType,y)},visitReduction:function(e){f.withPrimaryDataReduction(e)}}),w.CompiledDataViewMapping.visitTreeValues(h.values,{visitRole:function(e){f.withCurrentInnermostPrimaryGrouping(e.items,e.showAll,e.subtotalType)}}),f.withDataVolume(h.dataVolume);else if(r.scriptResult)return e(t,r.scriptResult.dataInput,i,a);return u&&n.withDataVolume(u),n.withTopLevelAggregates(r.scopedAggregates),n.toBinding(r)};var C=(t.prototype.visitRole=function(e,t){var r;"MatrixRowsScopedValue"===t?this.builder.withCurrentInnermostPrimaryGrouping(e.items,e.showAll,e.subtotalType,!0):this.inComposite?(r=this.startedCompositeNest,this.startedCompositeNest=!0,this.builder.withPrimaryGrouping(e.items,e.activeItems,e.showAll,e.subtotalType,r,this.noDefaultProjections)):this.builder.withPrimaryGroupingNested(e.items,e.activeItems,e.showAll,e.subtotalType,this.noDefaultProjections),this.primaryRoleItems||(this.primaryRoleItems=[]),this.primaryRoles||(this.primaryRoles=[]),this.primaryRoles.push(e.role),(r=this.primaryRoleItems).push.apply(r,e.items||[]),_.isEmpty(e.activeItems)||(this.primaryActiveRoleItems||(this.primaryActiveRoleItems=[]),(r=this.primaryActiveRoleItems).push.apply(r,e.activeItems||[]))},t.prototype.visitReduction=function(e){this.builder.withPrimaryDataReduction(e)},t.prototype.enterComposite=function(e){this.inComposite=!0,this.startedCompositeNest=!1,this.compositeGroupingIndexStart=this.builder.primaryGroupingCount},t.prototype.exitComposite=function(e){var t,r;this.inComposite=!1,this.startedCompositeNest=!1,!e.dataReductionAlgorithm&&!e.synchronized||(t=this.compositeGroupingIndexStart)<(r=this.builder.primaryGroupingCount)&&(r=_.range(t,r),e.synchronized&&this.builder.withPrimarySynchronization({Groupings:r}),e.dataReductionAlgorithm&&this.builder.withScopedDataReduction(e.dataReductionAlgorithm,{Primary:r}))},t);function t(e,t){this.inComposite=!1,this.startedCompositeNest=!1,this.builder=e,this.noDefaultProjections=t}function r(e,t){if(t)for(var r=0,i=t.Groupings;r<i.length;r++){var a=i[r];if(_.includes(a.Projections,e))return!0}}e.getIndicesByName=function(e){for(var t={},r=e.select(),i=e.groupBy(),a=0,n=r.length;a<n;a++)t[r[a].name]=a;for(a=0,n=i.length;a<n;a++)t[i[a].name]=a;return t},e.updateMappingsWithScalarKeys=function(e,t){function r(e){this.indicesByName=e}var i=new(r.prototype.visitRole=function(e,t){if(!_.isEmpty(e.items)){for(var r,i=0,a=e.items;i<a.length;i++){var n=a[i];n.scalarKeyInfo&&null!=n.scalarKeyInfo.scalarKeyQueryName&&(r=n.scalarKeyInfo.scalarKeyQueryName)}r&&(this.primaryScalarKey,this.primaryScalarKey=this.indicesByName[r])}},r)(t);w.CompiledDataViewMapping.visitMapping(e,i),null!=i.primaryScalarKey&&w.CompiledDataViewMapping.visitMapping(e,{visitRole:function(){},visitReduction:function(e){e.binnedLineSample&&(e.binnedLineSample.primaryScalarKey=i.primaryScalarKey)}})};var D=(Object.defineProperty(i.prototype,"primaryGroupingCount",{get:function(){return this.primary&&this.primary.Groupings&&this.primary.Groupings.length||0},enumerable:!1,configurable:!0}),i.prototype.withRestartToken=function(e){return this.restartToken=e,this},i.prototype.withPrimaryWindowExpansion=function(e){return this.reduction.Primary&&this.reduction.Primary.TopNPerLevel&&(this.reduction.Primary.TopNPerLevel.WindowExpansion=E.DataShapeBindingWindowExpansionStateSerializer.serializeWindowExpansionState(e)),this},i.prototype.withDataVolume=function(e){return null==e||(this.reduction.DataVolume=e),this},i.prototype.withIncludeEmptyGroups=function(e){return this.includeEmptyGroups=e,this},i.prototype.withHighlightFilter=function(e){return this.highlightFilter=e,this},i.prototype.withGroupBy=function(e){return _.isEmpty(e)||(this.groupByNames=_.map(e,function(e){return e.name})),this},i.prototype.withPrimaryGrouping=function(e,t,r,i,a,n){if(this.secondary,e=this.filterItems(e,t,n),_.isEmpty(e))return this;var o;this.primary?a?o=_.last(this.primary.Groupings):this.primary.Groupings.push(o={Projections:[]}):this.primary={Groupings:[o={Projections:[]}]},this.updateGrouping(o,e,r,i);e=this.getAggregatesForRoleItems(e);return this.applyTopLevelAggregates(e),this},i.prototype.withPrimaryExpansion=function(e){return this.ensurePrimaryAxis(),this.primary.Expansion=e,this},i.prototype.withPrimarySynchronization=function(e){return this.ensurePrimaryAxis(),this.primary.Synchronization||(this.primary.Synchronization=[]),this.primary.Synchronization.push(e),this},i.prototype.ensurePrimaryAxis=function(){this.primary||(this.primary={Groupings:[]})},i.prototype.ensureSecondaryAxis=function(){this.secondary||(this.secondary={Groupings:[]})},i.prototype.withPrimaryGroupingNested=function(e,t,r,i,a){return this.secondary,e=this.filterItems(e,t,a),_.isEmpty(e)?this:(this.primary||(this.primary={Groupings:[]}),a=this.primary.Groupings,this.withNested(a,e,r,i))},i.prototype.withSecondaryGrouping=function(e,t,r,i,a){if(e=this.filterItems(e,t,a),_.isEmpty(e))return this;var n;this.primary?(a=_.last(this.primary.Groupings),this.containsAll(a,e)?n=a:(this.secondary||(this.secondary={Groupings:[]}),this.secondary.Groupings.push(n={Projections:[]}))):(this.primary={Groupings:[n={Projections:[]}]},this.pivotedSecondaryToPrimary=!0),this.updateGrouping(n,e,r,i);e=this.getAggregatesForRoleItems(e);return this.applyTopLevelAggregates(e),this},i.prototype.withSecondaryExpansion=function(e){return this.ensureSecondaryAxis(),this.secondary.Expansion=e,this},i.prototype.withSecondaryGroupingNested=function(e,t,r,i,a){return e=this.filterItems(e,t,a),_.isEmpty(e)?this:(this.primary?(this.secondary||(this.secondary={Groupings:[]}),n=this.secondary.Groupings):(this.primary={Groupings:n=[]},this.pivotedSecondaryToPrimary=!0),this.withNested(n,e,r,i));var n},i.prototype.withCurrentInnermostGrouping=function(e,t,r){return e=this.filterItems(e,null,!1),_.isEmpty(e)||(this.secondary&&(i=_.last(this.secondary.Groupings)),this.addValuesToGrouping(e,t,r,i)),this;var i},i.prototype.withCurrentInnermostPrimaryGrouping=function(e,t,r,i){if(e=this.filterItems(e,null,!1),_.isEmpty(e))return this;if(this.addValuesToGrouping(e,t,r),i){this.primaryOnlyProjections=this.primaryOnlyProjections||[];for(var a=0,n=e;a<n.length;a++){var o=n[a];this.primaryOnlyProjections.push(this.indicesByName[o.queryName])}}return this},i.prototype.addValuesToGrouping=function(e,t,r,i){i=i||this.ensureInnermostPrimaryGrouping(),this.updateGrouping(i,e,t,r);e=this.getAggregatesForRoleItems(e);this.applyTopLevelAggregates(e)},i.prototype.ensureInnermostPrimaryGrouping=function(){var e;return this.primary?e=_.last(this.primary.Groupings):this.primary={Groupings:[e={Projections:[]}]},e},i.prototype.withPrimaryDataReduction=function(e){return e&&this.primary&&(this.reduction.Primary=w.DataShapeBindingDataReduction.createFrom(e,this.querySelects)),this},i.prototype.withScopedDataReduction=function(e,t){return e&&(this.reduction.Scoped||(this.reduction.Scoped=[]),this.reduction.Scoped.push({Scope:t,Algorithm:w.DataShapeBindingDataReduction.createFrom(e,this.querySelects)})),this},i.prototype.withSecondaryDataReduction=function(e){if(this.pivotedSecondaryToPrimary)return this.withPrimaryDataReduction(e);if(!e||!this.secondary)return this;if(!this.reduction.Scoped||_.isEmpty(this.secondary.Groupings))return this.reduction.Secondary=w.DataShapeBindingDataReduction.createFrom(e,this.querySelects),this;var t=this.secondary.Groupings.length,t=_.range(0,t);return this.withScopedDataReduction(e,{Secondary:t}),this},i.prototype.withIntersectionDataReduction=function(e){return e&&(this.reduction.Primary||this.reduction.Secondary||e.binnedLineSample&&(this.reduction.Intersection=w.DataShapeBindingDataReduction.createFrom(e,this.querySelects))),this},i.prototype.withTopLevelAggregates=function(e){var t=this;if(!this.featureSwitches.scopedAggregates)return this;if(_.isEmpty(e))return this;e=this.convertDataViewMappingAggregate(e,function(e){return t.toAggregateScope(e,t.primary.Groupings,0)}),e=this.getDataShapeBindingAggregates(e);return this.applyTopLevelAggregates(e),this},i.prototype.toAggregateScope=function(r,e,i){for(var a=0,n=this.querySelects,t=0,o=e;t<o.length;t++){var s=o[t];if(!_.isEmpty(s.ShowItemsWithNoData))return;for(var u=0,c=s.Projections;u<c.length;u++){var l=function(e){e=n[e];if(w.SQExprUtils.isMeasure(e.expr))return"continue";var t=e.name;return r.some(function(e){return e===t})?void 0:i<a?{value:{PrimaryDepth:a}}:{value:void 0}}(c[u]);if("object"==typeof l)return l.value}a++}return i<a?{PrimaryDepth:a}:void 0},i.prototype.updateScopeAggregatesForGroupings=function(t,e){var r=this,i=this.featureSwitches;if(i.scopedAggregates&&e&&t)for(var a=0,n=0,o=e;n<o.length;n++){var s=o[n],s=s.aggregates&&s.aggregates.filter(w.CompiledDataViewMapping.isCompiledDataViewMappingScopedAggregate);_.isEmpty(s)||(s=this.convertDataViewMappingAggregate(s,function(e){return r.toAggregateScope(e,t,a+1)}),s=this.getDataShapeBindingAggregates(s),_.isEmpty(s)||(t[a].Aggregates=s),a++)}},i.prototype.getDataShapeBindingAggregates=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n={},r=0,i=e;r<i.length;r++){var a=i[r];_.forEach(a,function(e,t){for(var r=n[t]=n[t]||[],i=0,a=e;i<a.length;i++)!function(t){r.some(function(e){return _.isEqual(e,t)})||r.push(t)}(a[i])})}return _.map(n,function(e,t){return{Select:+t,Aggregations:e}})},i.prototype.updateGrouping=function(e,t,r,i){this.addProjections(e.Projections,t);var a=this.indicesByName;if(r){e.ShowItemsWithNoData||(e.ShowItemsWithNoData=[]);for(var n=0,o=t;n<o.length;n++){var s=o[n];this.insertProjection(e.ShowItemsWithNoData,a[s.queryName])}}for(var u=t[0].subtotalType,c=1,l=t.length;c<l;c++)if(t[c].subtotalType!==u){u=void 0;break}i=function(e){switch(e){case 1:return 1;case 2:return 2;case 0:return}}(null!=u?u:i);null!=i&&(e.Subtotal=i);i=this.groupByNames;i&&(e.GroupBy=_.map(i,function(e){return a[e]}))},i.prototype.withNested=function(e,t,r,i){for(var a=0,n=t;a<n.length;a++){var o=n[a],s={Projections:[]};this.updateGrouping(s,[o],r,i),e.push(s)}this.updateScopeAggregatesForGroupings(e,t);t=this.getAggregatesForRoleItems(t);return this.applyTopLevelAggregates(t),this},i.prototype.filterItems=function(e,t,r){if(!_.isEmpty(e)){e=_.uniqBy(e,function(e){return e.queryName});var i,a=this.indicesByName;t&&(i=[]);for(var n=0,o=e.length;n<o;n++){var s=e[n],u=null,c=t&&!_.isEmpty(t)&&!_.includes(t,s.queryName);null==a[s.queryName]?u=n-1:(c||this.isReferenced(s))&&(u=n),null==u?i&&i.push(s):i=i||(u<0?[]:l.range(e,0,u))}return i||(r?[]:e)}},i.prototype.isReferenced=function(e){e=this.indicesByName[e.queryName];return r(e,this.primary)||r(e,this.secondary)||_.includes(this.projections,e)},i.prototype.containsAll=function(e,t){for(var r=e.Projections,i=this.indicesByName,a=0,n=t;a<n.length;a++){var o=n[a];if(!_.includes(r,i[o.queryName]))return!1}return!0},i.prototype.addProjections=function(e,t){for(var r=this.indicesByName,i=0,a=t;i<a.length;i++){var n=a[i],o=r[n.queryName];this.insertProjection(e,o),this.addJoinPredicateBehavior(o,n.joinPredicate)}},i.prototype.addJoinPredicateBehavior=function(e,t){this.joinPredicateBehaviors[e]?void 0===t&&(this.joinPredicateBehaviors[e].behavior=t):this.joinPredicateBehaviors[e]={behavior:t}},i.prototype.withAdditionalProjections=function(){}