!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/build/",n(n.s="Rqvd")}({"+Cf+":function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n("wRt+")),r(n("NzWK")),r(n("wWBD")),r(n("u+8Z")),r(n("YEUo")),r(n("ZHhi")),r(n("vRB5")),r(n("ss3j")),r(n("HFQ4"))},"+Vc9":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("LQDk"),o=n("G1Go"),i=n("YEUo"),s=n("btq9"),a=function(){function e(){}return e.encode=function(e,t){var n,o,i="";return e=r.SemanticPreEncoder.process(e,t),(o=Array.isArray(null===(n=t)||void 0===n?void 0:n.segments)?t.segments:new r.SegmentSequence(e,t)[""+e.version]).forEach((function(t,n){var s="";n<o.length-1&&(s="."),i+=r.SegmentEncoder.encode(e,t)+s})),i},e.decode=function(e,t){var n=e.split("."),a=n.length;t||(t=new s.TCModel);for(var c=0;c<a;c++){var l=n[c],u=r.Base64Url.decode(l.charAt(0)).substr(0,r.BitLength.segmentType),d=o.SegmentIDs.ID_TO_KEY[i.IntEncoder.decode(u,r.BitLength.segmentType).toString()];r.SegmentEncoder.decode(l,t,d)}return t},e}();t.TCString=a},"0/Wv":function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){var r,o,i;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var s=JSON.stringify(n);/^[\{\[]/.test(s)&&(n=s)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in i)i[c]&&(a+="; "+c,!0!==i[c]&&(a+="="+i[c].split(";")[0]));return document.cookie=t+"="+n+a}}function s(e,n){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],s=0;s<i.length;s++){var a=i[s].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(a[0]);if(c=(r.read||r)(c,l)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(o[l]=c,e===l)break}catch(e){}}return e?o[e]:o}}return o.set=i,o.get=function(e){return s(e,!1)},o.getJSON=function(e){return s(e,!0)},o.remove=function(t,n){i(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))},void 0===(o="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=o),e.exports=i()},function(e,t,n){(function(n){var r;!function(n,o){e.exports=function(n){"use strict";var o,i=(n=n||{}).Base64,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(s),c=String.fromCharCode,l=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},u=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,d=function(e){return e.replace(u,l)},p=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[s.charAt(n>>>18),s.charAt(n>>>12&63),t>=2?"=":s.charAt(n>>>6&63),t>=1?"=":s.charAt(63&n)].join("")},f=n.btoa&&"function"==typeof n.btoa?function(e){return n.btoa(e)}:function(e){if(e.match(/[^\x00-\xFF]/))throw new RangeError("The string contains invalid characters.");return e.replace(/[\s\S]{1,3}/g,p)},h=function(e){return f(d(String(e)))},g=function(e){return e.replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,"")},m=function(e,t){return t?g(h(e)):h(e)};n.Uint8Array&&(o=function(e,t){for(var n="",r=0,o=e.length;r<o;r+=3){var i=e[r],a=e[r+1],c=e[r+2],l=i<<16|a<<8|c;n+=s.charAt(l>>>18)+s.charAt(l>>>12&63)+(void 0!==a?s.charAt(l>>>6&63):"=")+(void 0!==c?s.charAt(63&l):"=")}return t?g(n):n});var v,b=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,y=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return c(55296+(t>>>10))+c(56320+(1023&t));case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},w=function(e){return e.replace(b,y)},_=function(e){var t=e.length,n=t%4,r=(t>0?a[e.charAt(0)]<<18:0)|(t>1?a[e.charAt(1)]<<12:0)|(t>2?a[e.charAt(2)]<<6:0)|(t>3?a[e.charAt(3)]:0),o=[c(r>>>16),c(r>>>8&255),c(255&r)];return o.length-=[0,0,2,1][n],o.join("")},C=n.atob&&"function"==typeof n.atob?function(e){return n.atob(e)}:function(e){return e.replace(/\S{1,4}/g,_)},E=function(e){return C(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},k=function(e){return String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,"")},O=function(e){return function(e){return w(C(e))}(k(e))};if(n.Uint8Array&&(v=function(e){return Uint8Array.from(E(k(e)),(function(e){return e.charCodeAt(0)}))}),n.Base64={VERSION:"2.6.4",atob:E,btoa:f,fromBase64:O,toBase64:m,utob:d,encode:m,encodeURI:function(e){return m(e,!0)},btou:w,decode:O,noConflict:function(){var e=n.Base64;return n.Base64=i,e},fromUint8Array:o,toUint8Array:v},"function"==typeof Object.defineProperty){var S=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};n.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",S((function(){return O(this)}))),Object.defineProperty(String.prototype,"toBase64",S((function(e){return m(this,e)}))),Object.defineProperty(String.prototype,"toBase64URI",S((function(){return m(this,!0)})))}}return n.Meteor&&(Base64=n.Base64),e.exports?e.exports.Base64=n.Base64:void 0===(r=function(){return n.Base64}.apply(t,[]))||(e.exports=r),{Base64:n.Base64}}(n)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:this)}).call(this,n(3))},function(e,t,n){"use strict";var r;e.exports.timeout=function(e,t){var n,o=new r;return Promise.race([e,new Promise((function(e,r){n=setTimeout((function(){r(o)}),t)}))]).then((function(e){return clearTimeout(n),e}),(function(e){throw clearTimeout(n),e}))},(r=e.exports.TimeoutError=function(){Error.call(this),this.stack=Error().stack,this.message="Timeout"}).prototype=Object.create(Error.prototype),r.prototype.name="TimeoutError"},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t),n.d(t,"Central",(function(){return Y})),n.d(t,"User",(function(){return c})),n.d(t,"ConsoleLogger",(function(){return Z})),n.d(t,"UserData",(function(){return R}));var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="CentralError",r}return o(t,e),t}(Error),s=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="InvalidRoleError",r}return s(t,e),t}(i),c=function(){function e(e,t,n,r,o){this._email=null,this._confirmed=null,this._postInbox=null,this._subscriptionRoles=new Map,this._id=e,this._email=t,this._confirmed=n,this._postInbox=r,this._subscriptionRoles=o}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"email",{get:function(){return this._email},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"confirmed",{get:function(){return this._confirmed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"postInbox",{get:function(){return this._postInbox},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscriptionRoles",{get:function(){return this._subscriptionRoles},enumerable:!1,configurable:!0}),e.prototype.hasSubscriptionRole=function(e){return this.subscriptionRoles.has(e)},e.prototype.hasActiveSubscriptionRole=function(e){if(!this.hasSubscriptionRole(e))return!1;var t=this.getSubscriptionRole(e);return!t.isExpired()&&!t.deviceLimitReached},e.prototype.hasActiveSubscriptionRoles=function(e){var t=this;return e.every((function(e){return t.hasActiveSubscriptionRole(e)}))},e.prototype.getSubscriptionRole=function(e){if(!this.hasSubscriptionRole(e))throw new a('Subscription role with name "'+e+'" does not exist.');return this.subscriptionRoles.get(e)},e}(),l=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r._apiResponse=null,r.stack=new Error(t[0]).stack,r.name="TokenLoadFailedError",r}return l(t,e),Object.defineProperty(t.prototype,"apiResponse",{get:function(){return this._apiResponse},set:function(e){this._apiResponse=e},enumerable:!1,configurable:!0}),t}(i),d=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="InvalidJsonError",r}return d(t,e),t}(u),f=function(){function e(){}return e.toInt=function(e){if(/^[-+]?(\d+|Infinity)$/.test(e)){var t=Number(e);if(isNaN(t))throw new i('"'+e+'" is not valid integer.');return t}throw new i('"'+e+'" is not valid integer.')},e.isInt=function(t){try{return e.toInt(t),!0}catch(e){return!1}},e.parseJson=function(e){try{return JSON.parse(e)}catch(e){throw new p(e.message)}},e}(),h=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="TokenUpdateTimeoutError",r}return h(t,e),t}(u),m=function(){function e(e,t,n){void 0===n&&(n=!1),this._deviceLimitReached=!1,this._name=e,this._expireAt=t,this._deviceLimitReached=n}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"expireAt",{get:function(){return this._expireAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceLimitReached",{get:function(){return this._deviceLimitReached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ttl",{get:function(){var e=new Date,t=Math.floor((this._expireAt.getTime()-e.getTime())/1e3);return 0>t?0:t},enumerable:!1,configurable:!0}),e.prototype.isExpired=function(){return this.ttl<=0},e}(),v=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="TokenInvalidError",r}return v(t,e),t}(u),y=function(){function e(e,t,n,r,o,i,s,a,c){this._email=null,this._confirmed=null,this._postInbox=null,this._subscriptionRoles=new Map,this._id=e,this._subject=t,this._issuedAt=n,this._expireAt=r,this._audience=o,this._email=i,this._confirmed=s,this._postInbox=a,this._subscriptionRoles=c}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subject",{get:function(){return this._subject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"issuedAt",{get:function(){return this._issuedAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"expireAt",{get:function(){return this._expireAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audience",{get:function(){return this._audience},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"email",{get:function(){return this._email},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"confirmed",{get:function(){return this._confirmed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"postInbox",{get:function(){return this._postInbox},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscriptionRoles",{get:function(){return this._subscriptionRoles},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ttl",{get:function(){var e=new Date,t=Math.floor((this.expireAt.getTime()-e.getTime())/1e3);return 0>t?0:t},enumerable:!1,configurable:!0}),e.createFromUserJwtPayload=function(t){e.checkJwtPayload(t);var n=null;Object.prototype.hasOwnProperty.call(t,"eml")&&t.eml&&(n=t.eml);var r=null;Object.prototype.hasOwnProperty.call(t,"cnf")&&(r=t.cnf);var o=null;Object.prototype.hasOwnProperty.call(t,"pst")&&t.pst&&(o=t.pst);var i=new Map;return Object.prototype.hasOwnProperty.call(t,"sbr")&&t.sbr&&Object.keys(t.sbr).forEach((function(e){if(t.sbr){var n=t.sbr[e],r=!1;Object.prototype.hasOwnProperty.call(n,"dlr")&&n.dlr&&(r=n.dlr),i.set(e,new m(e,new Date(1e3*n.exp),r))}})),new e(t.jti,t.sub,new Date(1e3*t.iat),new Date(1e3*t.exp),t.aud,n,r,o,i)},e.checkJwtPayload=function(e){["sub","iat","exp","jti","aud"].forEach((function(t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new b('The JWT token is invalid. Claim "'+t+'" is missing.')}))},e.prototype.isFresh=function(){return this.ttl>0},e}(),w=n(1),_=function(){function e(){this.logger=null}return e.prototype.setLogger=function(e){this.logger=e},e.prototype.tokenToUserPayload=function(e){this.log("parsing...",e);var t=y.createFromUserJwtPayload(this.parseJwt(e));return this.log("UserPayload from parsed JWT created",t),t},e.prototype.parseJwt=function(e){return this.parseJson(this.base64UrlDecode(e))},e.prototype.base64UrlDecode=function(e){var t=e.split(".");if(2!==t.length)throw new b("JWT token should contain header and payload separated with dot. But "+(t.length-1)+" dots found.");try{return w.Base64.decode(t[1])}catch(e){throw new b("JWT Payload base64url decode failed with error: "+e.message)}},e.prototype.parseJson=function(e){try{return f.parseJson(e)}catch(e){throw new b("JWT Payload JSON decode failed with error: "+e.message)}},e.prototype.log=function(e,t){null!==this.logger&&this.logger.debug("JwtParser",e,t)},e}(),C=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="UserNotLoggedInError",r}return C(t,e),t}(u),k=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),O=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="TokenUpdateRefusedError",r}return k(t,e),t}(u),S=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),P=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="TokenAlreadyUpdatingError",r}return S(t,e),t}(u),A=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n={}),this._result=e,this._message=t,this._data=n}return Object.defineProperty(e.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),e}(),T=n(0),I=function(){function e(e){this.userPayloadCache=null,this.userPayloadRawCache=null,this.status="init",this.plannerId=null,this.reloadPromise=null,this.lastApiCallAt=null,this.logger=null,this.config=e}return e.prototype.setLogger=function(e){this.logger=e},e.prototype.refreshTokenAfter=function(e){var t=this;this.log("refreshTokenAfter("+e+")");var n=1e3*e,r=this.generateRandomInt(n,n+500);return this.log("randomize setTimeout("+r+")"),new Promise((function(e,n){null!==t.plannerId&&(t.log("clearing previous timeout"),clearTimeout(t.plannerId),t.plannerId=null),t.plannerId=setTimeout((function(){t.onPlannedTimeRefresh(e,n)}),r)}))},e.prototype.loadToken=function(){var e=this;return this.log("loadToken()"),new Promise((function(t,n){var r=e.parseFromCookie();r?t(r):"updating"!==e.status||null===e.reloadPromise?e.reload().then((function(e){return t(e)})).catch((function(e){return n(e)})):e.reloadPromise.then((function(n){t(n),e.reloadPromise=null})).catch((function(e){return n(e)}))}))},e.prototype.refreshToken=function(){return this.log("refreshToken()"),this.reload()},e.prototype.clearCache=function(){this.log("clearCache()"),this.userPayloadCache=null,this.userPayloadRawCache=null,this.lastApiCallAt=null},e.prototype.parseFromCookie=function(){this.log("_parseFromCookie()");var e=T.get("ppp");if(null!==this.userPayloadRawCache&&null!==this.userPayloadCache&&e===this.userPayloadRawCache&&this.userPayloadCache.isFresh())return this.log("Found userPayload in cookie, but used from inmemory cache because it`s the same and fresh"),this.userPayloadCache;if(e){if(this.userPayloadRawCache=e,!this.userPayloadRawCache)throw new i("Invalid state.");var t=new _;return t.setLogger(this.logger),this.userPayloadCache=t.tokenToUserPayload(this.userPayloadRawCache),this.userPayloadCache.isFresh()?(this.log("UserPayload in cookie accepted"),this.userPayloadCache):(this.log("UserPayload in cookie is not fresh"),null)}return this.log("No UserPayload in cookies found"),null},e.prototype.reload=function(){var e=this;return this.log("reload()"),this.reloadPromise=new Promise((function(t,n){try{e.validate(),e.status="updating";var r=new XMLHttpRequest;r.ontimeout=function(){return e.onTimeout(n)},r.onerror=function(){return e.onError(r,n)},r.onload=function(){200===r.status?e.onSuccess(r,t,n):e.onError(r,n)},e.lastApiCallAt=new Date,r.open("POST",e.config.tokenUpdateUrl+"?url="+encodeURIComponent(window.location.href),!0),r.timeout=7e3,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-Type","application/json"),r.withCredentials=!0,r.send(),e.log("Ajax request to "+e.config.tokenUpdateUrl)}catch(e){n(e)}})),this.reloadPromise},e.prototype.onPlannedTimeRefresh=function(e,t){var n=this;if(this.log("Running planned refreshToken() in specific time"),this.plannerId=null,"updating"===this.status&&null!==this.reloadPromise)return this.log("token is already updating, wait for the result"),void this.reloadPromise.then((function(t){e(t),n.reloadPromise=null})).catch((function(e){return t(e)}));this.log("Refreshing token in specific time"),this.refreshToken().then((function(t){return e(t)})).catch((function(e){return t(e)}))},e.prototype.onSuccess=function(e,t,n){var r=this;this.log("Ajax success");var o=e.responseText;o&&this.log("Ajax response: ",o);var i=this.parseFromCookie();if(i)return this.status="success",void t(i);this.log("JWT Cookies not found. We will try to check it again after some time to make sure."),setTimeout((function(){var e=r.parseFromCookie();if(e)return r.status="success",void t(e);r.log("JWT Cookies in response missing or were not accepted by browser."),r.status="error",n(new u("No fresh user payload found."))}),1)},e.prototype.onTimeout=function(e){this.log("Ajax failed with timeout."),this.status="timeout",e(new g("HTTP API timeout."))},e.prototype.onError=function(e,t){this.log("Ajax error. Response status code: "+e.status),this.status="error";var n=new u("HTTP API Error."),r=this.responseToApiResponse(e.responseText);r&&(n.apiResponse=r),t(n)},e.prototype.validate=function(){this.log("validating...");var e=T.get("ppu");if(!(e&&"1"===e||T.get("ppi")))throw new E("User is not logged in.");if("error"===this.status&&null!==this.lastApiCallAt){var t=new Date,n=Math.round((t.getTime()-this.lastApiCallAt.getTime())/1e3);if(this.config.waitTimeInCaseOfApiError>n)throw new O("Last API call ended with error. New API call can be done after "+(this.config.waitTimeInCaseOfApiError-n)+" seconds.")}if("timeout"===this.status&&null!==this.lastApiCallAt&&(t=new Date,n=Math.round((t.getTime()-this.lastApiCallAt.getTime())/1e3),this.config.waitTimeInCaseOfApiTimeout>n))throw new O("Last API call ended with timeout. New API call can be done after "+(this.config.waitTimeInCaseOfApiTimeout-n)+" seconds.");if("updating"===this.status)throw new P("The token is already updating.");this.log("passed")},e.prototype.responseToApiResponse=function(e){this.log("responseToApiResponse()");try{var t=this.parseJson(e);if(!Object.prototype.hasOwnProperty.call(t,"status"))throw new u('Response json does not contain expected field "status".');var n=t.status,r=null,o={};return Object.prototype.hasOwnProperty.call(t,"message")&&(r=t.message),Object.prototype.hasOwnProperty.call(t,"data")&&(o=t.data),new A(n,r,o)}catch(e){return this.log("Error: Response converting to ApiResponse failed with error:"+e.message),null}},e.prototype.parseJson=function(e){try{return f.parseJson(e)}catch(e){throw new b("Response JSON decode failed with error: "+e.message)}},e.prototype.generateRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.prototype.log=function(e,t){null!==this.logger&&this.logger.debug("TokenLoader",e,t)},e}(),D=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),L=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="ConfigInvalidError",r}return D(t,e),t}(i),x=function(){function e(e){this._refreshBeforeExpire=!1,this._waitTimeInCaseOfApiError=120,this._waitTimeInCaseOfApiTimeout=1800,this._refreshTokenPeriodBeforeExpire=180,this._refreshOnFocus=!1,this._shareTokenLoader=!0,this._sharedIframeUrl=null,this._userDataFetchUrl=null,this._tokenUpdateUrl=e.tokenUpdateUrl,this.configureTokenLoader(e),this.configureUserDataLoader(e)}return e.prototype.configureTokenLoader=function(e){if(Object.prototype.hasOwnProperty.call(e,"waitTimeInCaseOfApiError")&&void 0!==e.waitTimeInCaseOfApiError&&(this._waitTimeInCaseOfApiError=e.waitTimeInCaseOfApiError),Object.prototype.hasOwnProperty.call(e,"waitTimeInCaseOfApiTimeout")&&void 0!==e.waitTimeInCaseOfApiTimeout&&(this._waitTimeInCaseOfApiTimeout=e.waitTimeInCaseOfApiTimeout),Object.prototype.hasOwnProperty.call(e,"refreshTokenPeriodBeforeExpire")&&void 0!==e.refreshTokenPeriodBeforeExpire){if(e.refreshTokenPeriodBeforeExpire<10)throw new L('Min config value for "refreshTokenPeriodBeforeExpire" should be 10, but '+e.refreshTokenPeriodBeforeExpire+" provided.");this._refreshTokenPeriodBeforeExpire=e.refreshTokenPeriodBeforeExpire}Object.prototype.hasOwnProperty.call(e,"refreshBeforeExpire")&&void 0!==e.refreshBeforeExpire&&(this._refreshBeforeExpire=e.refreshBeforeExpire),Object.prototype.hasOwnProperty.call(e,"refreshOnFocus")&&void 0!==e.refreshOnFocus&&(this._refreshOnFocus=e.refreshOnFocus),Object.prototype.hasOwnProperty.call(e,"shareTokenLoader")&&void 0!==e.shareTokenLoader&&(this._shareTokenLoader=e.shareTokenLoader)},e.prototype.configureUserDataLoader=function(e){Object.prototype.hasOwnProperty.call(e,"sharedIframeUrl")&&void 0!==e.sharedIframeUrl&&(this._sharedIframeUrl=e.sharedIframeUrl),Object.prototype.hasOwnProperty.call(e,"userDataFetchUrl")&&void 0!==e.userDataFetchUrl&&(this._userDataFetchUrl=e.userDataFetchUrl)},Object.defineProperty(e.prototype,"tokenUpdateUrl",{get:function(){return this._tokenUpdateUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waitTimeInCaseOfApiError",{get:function(){return this._waitTimeInCaseOfApiError},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waitTimeInCaseOfApiTimeout",{get:function(){return this._waitTimeInCaseOfApiTimeout},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshBeforeExpire",{get:function(){return this._refreshBeforeExpire},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenPeriodBeforeExpire",{get:function(){return this._refreshTokenPeriodBeforeExpire},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshOnFocus",{get:function(){return this._refreshOnFocus},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shareTokenLoader",{get:function(){return this._shareTokenLoader},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sharedIframeUrl",{get:function(){return this._sharedIframeUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userDataFetchUrl",{get:function(){return this._userDataFetchUrl},enumerable:!1,configurable:!0}),e}(),R=function(){function e(){this._id=null,this._createdAt=null,this._email=null,this._hashedEmail=null,this._phone=null,this._subscribedNewslettersVariants=null,this._rawData=null}return e.createFromRawData=function(t){var n=new e;return n.initWithRawData(t),n},e.prototype.initWithRawData=function(e){Object.prototype.hasOwnProperty.call(e,"central_user_id")&&(this._id=e.central_user_id),Object.prototype.hasOwnProperty.call(e,"user_created_at")&&(this._createdAt=new Date(e.user_created_at)),Object.prototype.hasOwnProperty.call(e,"email")&&(this._email=e.email),Object.prototype.hasOwnProperty.call(e,"hashed_email")&&(this._hashedEmail=e.hashed_email),Object.prototype.hasOwnProperty.call(e,"phone")&&(this._phone=e.phone),Object.prototype.hasOwnProperty.call(e,"subscribed_newsletters_variants")&&(this._subscribedNewslettersVariants=e.subscribed_newsletters_variants),this._rawData=e},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"email",{get:function(){return this._email},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hashedEmail",{get:function(){return this._hashedEmail},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"phone",{get:function(){return this._phone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscribedNewsletters",{get:function(){return null===this._subscribedNewslettersVariants?[]:Object.keys(this._subscribedNewslettersVariants)},enumerable:!1,configurable:!0}),e.prototype.isSubscribedToNewsletter=function(e){return null!==this._subscribedNewslettersVariants&&Object.prototype.hasOwnProperty.call(this._subscribedNewslettersVariants,e)},e.prototype.isSubscribedToNewsletterVariantId=function(e,t){return null!==this._subscribedNewslettersVariants&&Object.prototype.hasOwnProperty.call(this._subscribedNewslettersVariants,e)&&Object.prototype.hasOwnProperty.call(this._subscribedNewslettersVariants[e],t)},Object.defineProperty(e.prototype,"rawData",{get:function(){return this._rawData},enumerable:!1,configurable:!0}),e}(),M=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),j=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="InvalidCacheItemError",r}return M(t,e),t}(i),F=function(){function e(e,t,n,r){this._fresh=null,this._key=e,this._value=t,this._createdAt=r||new Date,this._expireAt=n}return Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"createdAtTimestamp",{get:function(){return Math.round(this._createdAt.getTime()/1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"expireAt",{get:function(){return this._expireAt},set:function(e){this._expireAt=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fresh",{set:function(e){this._fresh=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ttl",{get:function(){var e=new Date,t=Math.floor((this.expireAt.getTime()-e.getTime())/1e3);return 0>t?0:t},enumerable:!1,configurable:!0}),e.createFromJson=function(t,n){var r;try{r=f.parseJson(n)}catch(e){throw new j("JSON decode failed with error: "+e.message)}if(!Object.prototype.hasOwnProperty.call(r,"value")||!Object.prototype.hasOwnProperty.call(r,"ttl")||!Object.prototype.hasOwnProperty.call(r,"created_at"))throw new j('Cache item "'+n+"\" doesn't have expected structure.");if(!f.isInt(r.created_at)||!f.isInt(r.ttl))throw new j('Cache item "'+n+'" is invalid.');return new e(t,r.value,new Date(1e3*r.ttl),new Date(1e3*r.created_at))},e.prototype.toJson=function(){var e={created_at:this.createdAtTimestamp,ttl:Math.round(this._expireAt.getTime()/1e3),value:this._value};return JSON.stringify(e)},e.prototype.isFresh=function(){return null!==this._fresh?this._fresh:this.ttl>0},e}(),U=function(){function e(){this.logger=null}return e.prototype.setLogger=function(e){this.logger=e},e.prototype.getCacheItem=function(e,t){void 0===t&&(t=null),this.log('getCacheItem("'+e+'")');try{var n=localStorage.getItem(e);if(!n)return this.log('Cache item "'+e+'" not found in localStorage.'),t;var r=F.createFromJson(e,n);return this.log("cacheItem loaded",F),r}catch(n){return this.log('Loading cache item "'+e+'" failed with error: '+n.message),localStorage.removeItem(e),t}},e.prototype.setCacheItem=function(e){this.log("setCacheItem()",e),localStorage.setItem(e.key,e.toJson())},e.prototype.get=function(e,t){void 0===t&&(t=null),this.log('get("'+e+'")');var n=this.getCacheItem(e,t);return null===n?t:n.isFresh()?n.value:(this.log('cache with key "'+e+'" is not fresh'),t)},e.prototype.set=function(e,t,n){this.log('set("'+e+'", ttl: '+n+")",t);var r=new Date,o=new F(e,t,new Date(r.getTime()+1e3*n),r);this.setCacheItem(o)},e.prototype.log=function(e,t){null!==this.logger&&this.logger.debug("LocalStorageCache",e,t)},e}(),N=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),V=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="IframeError",r}return N(t,e),t}(i),G=n(2),B=function(){function e(e,t){this._response=null,this._messageId=e,this._resolvePromise=t}return Object.defineProperty(e.prototype,"messageId",{get:function(){return this._messageId},enumerable:!1,configurable:!0}),e.prototype.resolveResponse=function(e){this._response=e,this._resolvePromise(e)},Object.defineProperty(e.prototype,"response",{get:function(){return this._response},enumerable:!1,configurable:!0}),e}(),W=function(){function e(e){this.iframeIdentity="",this.iframeElement=null,this.logger=null,this.iframeUrl=e,this.messages=new Map}return e.prototype.setLogger=function(e){this.logger=e},e.prototype.destroy=function(){this.messages=new Map,this.iframeElement&&this.iframeElement.parentNode&&this.iframeElement.parentNode.removeChild(this.iframeElement),this.iframeElement=null},e.prototype.lazyDestroy=function(){var e=this;0===this.messages.size&&setTimeout((function(){e.destroy()}),600)},e.prototype.sendMessage=function(e,t){var n=this;return this.log('sendMessage("'+e+'", '+t+")"),Object(G.timeout)(new Promise((function(t,r){n.initIframe().then((function(){if(n.log("iframe ready"),!n.iframeElement||!n.iframeElement.contentWindow)throw new V("Invalid state - the iframe should be initialized.");n.log('sending message: "'+e+'"');var r=new B(e,t);n.messages.set(e,r),n.iframeElement.contentWindow.postMessage(e,n.getIframeIdentity()),n.log("waiting for response")})).catch((function(e){n.log("rejected",e),r(e)}))})),t)},e.prototype.getIframeIdentity=function(){if(this.iframeIdentity)return this.iframeIdentity;var e=this.iframeUrl.match(/https?:\/\/[^/]+/);return null!==e&&(this.iframeIdentity=e[0]),this.iframeIdentity},e.prototype.initIframe=function(){var e=this;return this.log("initIframe()"),new Promise((function(t,n){if(null===e.iframeElement)try{e.log("Creating iframe in DOM with url: "+e.iframeUrl),e.iframeElement=document.createElement("iframe"),e.iframeElement.setAttribute("style","width:0; height:0; border:0; border:none; visibility: hidden; display: none;"),e.iframeElement.setAttribute("src",e.iframeUrl),e.iframeElement.addEventListener("load",(function(){t()})),window.addEventListener("message",e.onReceiveMessage.bind(e),!1),document.body.appendChild(e.iframeElement),e.log("Creating iframe in DOM done")}catch(t){e.log("Creating iframe in DOM failed with message: "+t.message),n(t)}else t()}))},e.prototype.onReceiveMessage=function(e){if(this.log("onReceiveMessage()",e),e.origin===this.getIframeIdentity()){var t,n=e.data.indexOf(":"),r=null;n<=0?t=e.data:(t=e.data.substr(0,n),r=e.data.substr(n+1));var o=this.messages.get(t);o?(this.messages.delete(t),o.resolveResponse(r),this.log('messageId resolved with data "'+r+'"')):this.log('Unknown messageId "'+t)}else this.log('Message ignored, unknown identity "'+e.origin+'", "'+this.getIframeIdentity()+'" expected')},e.prototype.log=function(e,t){null!==this.logger&&this.logger.debug("SharedLocalStorage",e,t)},e}(),H=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),J=function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t)||this;return r.stack=new Error(t[0]).stack,r.name="UserDataLoadFailedError",r}return H(t,e),t}(u),z=function(){function e(e){this.reloadPromiseStatus="init",this.reloadPromise=null,this.logger=null,this.sharedLs=null,this.localCacheItem=null,this.sharedCacheItem=null,this.user=null,this.config=e,this.lsCache=new U}return e.prototype.setLogger=function(e){this.logger=e},e.prototype.loadUserData=function(e){var t=this;if(this.log("loadUserData()"),this.user=e,!this.config.userDataFetchUrl)throw new i('To load user data, please, specify "userDataFetchUrl" in config.');return this.reloadPromise&&this.isReloadPromiseUsable()?this.reloadPromise:new Promise((function(e,n){t.load(e,n)}))},e.prototype.reloadUserData=function(e){var t=this;return this.log("reloadUserData()"),this.user=e,this.localCacheItem=null,this.sharedCacheItem=null,new Promise((function(e,n){t.requestUserData(e,n)}))},e.prototype.isReloadPromiseUsable=function(){return"updating"===this.reloadPromiseStatus||"success"===this.reloadPromiseStatus&&!(!this.localCacheItem||!this.localCacheItem.isFresh())},e.prototype.load=function(e,t){var n=null;if(this.localCacheItem=this.lsCache.getCacheItem("sme_cl_user",null),this.localCacheItem&&this.localCacheItem.value&&this.isCacheItemFresh(this.localCacheItem)){var r=this.localCacheItem.value;if(this.log("Data in local storage found",r),n=R.createFromRawData(r),this.isValid(n))return this.log("Data in local storage accepted, resolved",r),this.pushToSharedLocalStorage(this.localCacheItem),void e(n);this.log("Data in local storage invalid")}else this.log("No fresh data found in local storage");this.config.sharedIframeUrl?this.processSharedIframeCache(e,t):this.requestUserData(e,t)},e.prototype.processSharedIframeCache=function(e,t){var n=this;this.log("try to find data in shared storage"),this.getSharedLs().sendMessage("sme_cl.getUserData",1e3).then((function(r){try{if(n.sharedCacheItem=F.createFromJson("sme_cl_user",r),n.isCacheItemFresh(n.sharedCacheItem)){var o=R.createFromRawData(n.sharedCacheItem.value);if(n.isValid(o))return n.log("Data from shared local storage accepted, resolved",n.sharedCacheItem.value),n.localCacheItem=n.sharedCacheItem,n.lsCache.setCacheItem(n.sharedCacheItem),void e(o)}}catch(r){return n.log("Creating cache item from shared ls data failed with error: "+r.message),void n.requestUserData(e,t)}})).catch((function(r){n.log("shared local storage failed with error: "+r.message),n.requestUserData(e,t)}))},e.prototype.requestUserData=function(e,t){var n=this;this.reloadPromiseStatus="updating",this.reloadPromise=this.fetchFromServer(),this.reloadPromise.then((function(t){n.reloadPromiseStatus="success",n.localCacheItem=new F("sme_cl_user",t.rawData,n.getCurrentExpireAt(1800)),n.lsCache.setCacheItem(n.localCacheItem),n.pushToSharedLocalStorage(n.localCacheItem),e(t)})).catch((function(r){if(n.reloadPromiseStatus="error",n.sharedCacheItem){var o=R.createFromRawData(n.sharedCacheItem.value);if(n.isValid(o))return n.log("Outdated data from shared local storage accepted, resolved",o),n.sharedCacheItem.expireAt=n.getCurrentExpireAt(3600),n.localCacheItem=n.sharedCacheItem,n.lsCache.setCacheItem(n.sharedCacheItem),n.pushToSharedLocalStorage(n.sharedCacheItem),void e(o)}if(n.localCacheItem&&(o=R.createFromRawData(n.localCacheItem.value),n.isValid(o)))return n.log("Outdated data from local storage accepted, resolved",o),n.localCacheItem.expireAt=n.getCurrentExpireAt(3600),n.lsCache.setCacheItem(n.localCacheItem),n.pushToSharedLocalStorage(n.localCacheItem),void e(o);t(new J('Loading UserData failed with error "'+r.message+'".'))}))},e.prototype.isValid=function(e){return e.id?!this.user||this.user.id===e.id||(this.log('Data in local storage belongs to user "'+e.id+'", but currently logged in user is "'+this.user.id+'".'),!1):(this.log("Data in local storage are invalid"),!1)},e.prototype.getSharedLs=function(){if(!this.config.sharedIframeUrl)throw new i("Invalid state, sharedIframeUrl should be defined in config");return null===this.sharedLs&&(this.sharedLs=new W(this.config.sharedIframeUrl)),this.logger&&this.sharedLs.setLogger(this.logger),this.sharedLs},e.prototype.pushToSharedLocalStorage=function(e){var t=this;this.config.sharedIframeUrl&&this.getSharedLs().sendMessage("sme_cl.setUserData:"+e.toJson(),2e3).then((function(){t.log("sharedLs success")})).catch((function(){t.log("sharedLs error")}))},e.prototype.getCurrentExpireAt=function(e){var t=new Date;return new Date(t.getTime()+1e3*e)},e.prototype.fetchFromServer=function(){var e=this;if(this.log("fetchFromServer()"),!this.config.userDataFetchUrl)throw new i('Invalid state. "userDataFetchUrl" should be configured.');return new Promise((function(t,n){if(!e.user)throw new i("Invalid state. Unknown user.");if(!e.config.userDataFetchUrl)throw new i('Invalid state. "userDataFetchUrl" should be configured.');try{var r=new XMLHttpRequest;r.ontimeout=function(){return e.onTimeout(n)},r.onerror=function(){return e.onError(r,n)},r.onload=function(){200===r.status?e.onSuccess(r,t,n):e.onError(r,n)};var o=e.config.userDataFetchUrl.replace("{userId}",e.user.id.toString());r.open("GET",o,!0),r.timeout=7e3,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-Type","application/json"),r.withCredentials=!0,r.send(),e.log("Ajax request to "+o)}catch(e){n(e)}}))},e.prototype.onSuccess=function(e,t,n){this.log("Ajax success",e);var r=e.responseText;if(r){var o=R.createFromRawData(this.parseJson(r));if(this.isValid(o))return this.log("Data from ajax accepted, resolved",o),void t(o)}this.log("Invalid data in json response."),n(new J("Invalid response from server: "+r))},e.prototype.onTimeout=function(e){this.log("Ajax failed with timeout."),e(new J("HTTP API timeout"))},e.prototype.onError=function(e,t){this.log("Ajax error. Response status code: "+e.status),t(new J("HTTP API Error"))},e.prototype.parseJson=function(e){try{return f.parseJson(e)}catch(e){throw new J("JSON parsing failed with error: "+e.message)}},e.prototype.isCacheItemFresh=function(e){if(!e.isFresh())return!1;if(this.user){if(this.isChangeCookieAccepted(e,"pwall_change"))return e.fresh=!1,!1;if(this.isChangeCookieAccepted(e,"sme_nl_change"))return e.fresh=!1,!1}return!0},e.prototype.isChangeCookieAccepted=function(e,t){if(!this.user)return!1;var n=T.get(t);if(n)try{var r=n.split("_"),o=f.toInt(r[0]),i=f.toInt(r[1]);if(i&&this.user.id===o&&e.createdAtTimestamp<=i+10)return this.log('Cookie "'+t+'" accepted. User data changed, should be refreshed.'),!0}catch(e){this.log('Error occurred during resolving value of "'+t+'" cookie: '+e.message)}return!1},e.prototype.log=function(e,t){null!==this.logger&&this.logger.debug("UserDataLoader",e,t)},e}(),Y=function(){function e(e){this.loader=null,this.logger=null,this.userPayload=null,this.user=null,this.userDataLoader=null,this.config=new x(e),this.log("Central instance created",this.config),this.config.refreshOnFocus&&(this.log("add window.onFocus() listener"),window.addEventListener("focus",this.onWindowFocus.bind(this)))}return e.prototype.setLogger=function(e){this.logger=e},e.prototype.getUser=function(){var e=this;return this.log("getUser()"),new Promise((function(t,n){null!==e.user&&null!==e.userPayload&&e.userPayload.isFresh()&&(e.log("resolved from local cache"),t(e.user)),e.log("calling loader"),e.getLoader().loadToken().then((function(n){if(e.loadUserFromUserPayload(n),null===e.user)throw new i("Unexpected state - User should be converted from userPayload");e.log("resolved",e.user),e.planToRefreshToken(),t(e.user)})).catch((function(t){e.log("rejected",t),n(t)}))}))},e.prototype.refreshUser=function(){var e=this;return this.log("refreshUser()"),new Promise((function(t,n){e.getLoader().refreshToken().then((function(n){if(e.log("resolved",n),e.loadUserFromUserPayload(n),null===e.user)throw new i("Unexpected state - User should be converted from userPayload");e.log("created user",e.user),e.planToRefreshToken(),t(e.user)})).catch((function(t){e.log("rejected",t),n(t)}))}))},e.prototype.getUserData=function(){var e=this.getUserDataLoader();if(!this.user)throw new i("No user found. Call `getUser()` first.");return e.loadUserData(this.user)},e.prototype.refreshUserData=function(){var e=this.getUserDataLoader();if(!this.user)throw new i("No user found. Call `getUser()` first.");return e.reloadUserData(this.user)},e.prototype.onWindowFocus=function(){var e=this;this.log("onWindowFocus()"),this.config.refreshOnFocus?null!==this.userPayload?this.userPayload.isFresh()?this.log("userPayload in cache is fresh",this.userPayload):(this.log("calling loader"),this.getLoader().loadToken().then((function(t){if(e.loadUserFromUserPayload(t),null===e.user)throw new i("Unexpected state - User should be converted from userPayload");e.log("user loaded successfully",e.user),e.planToRefreshToken()})).catch((function(t){e.log("error loading user",t)}))):this.log("no userPayload, onWindowFocus() ignored",this.userPayload):this.log("refreshBeforeExpire disabled, onWindowFocus() ignored")},e.prototype.clearCache=function(){this.log("clearCache()"),this.user=null,this.userPayload=null,this.getLoader().clearCache()},e.prototype.getLoader=function(){return null!==this.loader?this.loader:this.config.shareTokenLoader&&Object.prototype.hasOwnProperty.call(window,"_smeCentralTokenLoader_v0_5")&&window._smeCentralTokenLoader_v0_5?(this.log("Used tokenLoader from other Central instance"),this.loader=window._smeCentralTokenLoader_v0_5,this.loader):(this.log("Creating instance of TokenLoader"),this.loader=new I(this.config),null!==this.logger&&this.loader.setLogger(this.logger),this.config.shareTokenLoader&&(window._smeCentralTokenLoader_v0_5=this.loader,this.log("Publish TokenLoader to be used by other Central lib instances")),this.loader)},e.prototype.getUserDataLoader=function(){return this.userDataLoader||(this.userDataLoader=new z(this.config)),this.userDataLoader},e.prototype.log=function(e,t){null!==this.logger&&this.logger.debug("Main",e,t)},e.prototype.planToRefreshToken=function(){var e=this;if(this.log("planToRefreshToken()"),this.config.refreshBeforeExpire)if(null!==this.userPayload){var t,n=this.userPayload.ttl;this.log("token ttl: "+n),n>this.config.refreshTokenPeriodBeforeExpire?(t=n-this.config.refreshTokenPeriodBeforeExpire,this.log("token will expire in the future, refresh it after "+t+" seconds")):(this.log("token will expire soon, refresh it ASAP"),t=0),this.getLoader().refreshTokenAfter(t).then((function(t){e.loadUserFromUserPayload(t),e.planToRefreshToken(),e.log("resolved",e.user)}))}else this.log("no userPayload, ignored",this.userPayload);else this.log("refreshBeforeExpire disabled, planToRefreshToken() ignored")},e.prototype.loadUserFromUserPayload=function(e){this.userPayload=e,this.user=new c(f.toInt(this.userPayload.subject),this.userPayload.email,this.userPayload.confirmed,this.userPayload.postInbox,this.userPayload.subscriptionRoles)},e}(),Z=function(){function e(e){e||(e="Central_"+Math.random().toString(36).substr(2,5)),this.instanceId=e}return e.prototype.debug=function(e,t,n){this.log("debug",e,t,n)},e.prototype.log=function(e,t,n,r){if(n="["+this.instanceId+"] [Sme/Central/"+t+"] "+n,r)switch(e){case"error":console.error(n,r);break;case"warn":console.warn(n,r);break;case"info":console.info(n,r);break;case"debug":default:console.debug(n,r)}else switch(e){case"error":console.error(n);break;case"warn":console.warn(n);break;case"info":console.info(n);break;case"debug":default:console.debug(n)}},e}()}])},"0Rdr":function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.smeCnstGfcDplmnt=window.smeCnstGfcDplmnt||function(){(function(){"use strict";var e=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},t=this||self,r=/^[\w+/_-]+[=]{0,2}$/,o=null,i=function(){},s=function(e){var t=n(e);if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var r=Object.prototype.toString.call(e);if("[object Window]"==r)return"object";if("[object Array]"==r||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==r||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t},a=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},c=function(e,t){this.b=e===u&&t||"",this.a=l},l={},u={},d=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^+new Date).toString(36)},p=function(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)},f=function(e){this.a=e||t.document||document};f.prototype.appendChild=function(e,t){e.appendChild(t)};var h=function e(n,i,s,a,u,d){try{var f=n.a,h=p(n.a,"SCRIPT");h.async=!0,function(e,n){e.src=n instanceof c&&n.constructor===c&&n.a===l?n.b:"type_error:TrustedResourceUrl",null===o&&(o=(n=(n=t.document).querySelector&&n.querySelector("script[nonce]"))&&(n=n.nonce||n.getAttribute("nonce"))&&r.test(n)?n:""),(n=o)&&e.setAttribute("nonce",n)}(h,i),f.head.appendChild(h),h.addEventListener("load",(function(){u(),a&&f.head.removeChild(h)})),h.addEventListener("error",(function(){}