(self.webpackChunkdesktop=self.webpackChunkdesktop||[]).push([[179],{12077:(Ue,K,o)=>{"use strict";o.d(K,{q:()=>c});const c="2022.9.2".replace("-X-REPLACE-KEY","")},7022:(Ue,K,o)=>{"use strict";o.d(K,{I:()=>c});var c=(()=>{return(v=c||(c={})).Locate="button_locate",v.LegendOpen="button_legend_open",v.LegendClose="button_legend_close",v.LoopStart="button_loop_start",v.LoopStop="button_loop_stop",v.TimeStepLeft="button_time_step_left",v.TimeStepRight="button_time_step_right",v.TimeSlider="button_time_slider",v.Search="button_search",v.Share="button_share",v.Screenshot="tool_screenshot",c;var v})()},98452:(Ue,K,o)=>{"use strict";o.d(K,{d:()=>c});let c=(()=>{class v{}return v.TILE_SIZE=512,v.CITY_LOC_SIZE=5,v})()},84183:(Ue,K,o)=>{"use strict";o.d(K,{U:()=>v});var c=o(3184);let v=(()=>{class R{constructor(){this.allowed={wr:"WetterRadar",rr:"RegenRadar",temp:"Temperature",gust:"Gust",lightning:"Lightning",WetterRadar:"WetterRadar",RegenRadar:"RegenRadar",TemperaturRadar:"Temperature",WindRadar:"Gust"}}isAllowed(M){return M in this.allowed}convertToName(M){return this.allowed[M]}}return R.\u0275fac=function(M){return new(M||R)},R.\u0275prov=c.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})()},13496:(Ue,K,o)=>{"use strict";o.d(K,{R:()=>O});var c=o(26067),v=o(67725),R=o(81177),E=o(3184),M=o(55343);let O=(()=>{class w{constructor(S,L){this.errorHandler=S,this.webGLRenderingError$=new c.t,this.alreadySentWebGLErrors=new Set,this.networkErrors$=new c.t,this.networkTimout$=new c.t,this.lastTimeChecked=0,L.webGLLogger={log(z,...B){(0,v.kg)().info("[WebGL-Lib]",z,...B)},warn(z,...B){(0,v.kg)().warn("[WebGL-Lib]",z,...B)},error(z,...B){const j="[WebGL-Lib] "+JSON.stringify(z)+" "+JSON.stringify(B);(0,v.kg)().error(j),this.errorHandler.handleError(j)}}}init(){}checkForError(S){if(Date.now()-this.lastTimeChecked>w.PERIOD_IN_MS){this.lastTimeChecked=Date.now();const L=this.translateWebGlErrorCode(S);L&&!this.alreadySentWebGLErrors.has(L)&&(this.alreadySentWebGLErrors.add(L),this.errorHandler.handleError(L))}}translateWebGlErrorCode(S){switch(S.getError()){case S.NO_ERROR:return;case S.INVALID_ENUM:return"[webGL] An unacceptable value has         been specified for an enumerated argument.The command is ignored and the error flag is set.";case S.INVALID_VALUE:return"[webGL] A numeric argument is out of range.The command is ignored and the error flag is set.";case S.INVALID_OPERATION:return"[webGL] The specified command is not allowed for the current state. The command is ignored and the error flag is set.";case S.INVALID_FRAMEBUFFER_OPERATION:return"[webGL] The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case S.OUT_OF_MEMORY:return"[webGL] Not enough memory is left to execute the command.";case S.CONTEXT_LOST_WEBGL:return"[webGL] If the WebGL context is lost, this error is returned on the first call to getError. Afterwards and until the context has been restored, it returns gl.NO_ERROR.";default:return"[webGL] Unknown"}}}return w.PERIOD_IN_MS=1e4,w.\u0275fac=function(S){return new(S||w)(E.LFG(M.d),E.LFG(R.m))},w.\u0275prov=E.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},85470:(Ue,K,o)=>{"use strict";o.d(K,{Y:()=>W});var c=o(71670),v=o(26067),R=o(80228),E=o(54363),M=o(39051),O=o(7022),w=o(67725),T=o(37656),S=o(69545),L=o(23576),z=o(81177),B=o(52019),j=o(3184);let W=(()=>{class F extends L.I{constructor(G){if(super(),this.tag="[tracking-queue.service]",this.pageLoadTime=(new Date).getTime(),this.activeLayerGroupShortKey$=new v.t(1),this.activePeriod$=new v.t(1),this.activePosition$=new v.t(1),this.buffer$=new Map,this.w=G,this.buffer$.set(O.I.TimeSlider,new R.x),!(0,S.Z)()){for(const[de,xe]of this.buffer$.entries())xe.pipe((0,M.f)(xe.pipe((0,T.Zf)(300)))).subscribe(Ne=>{this.addElasticAPMEvent(de)});this.activePosition$.subscribe(de=>{this.addLabel("wetterradar.geo_coordinate",de)})}}addLabel(G,de){this.w.elasticApm&&this.w.elasticApm.addLabels({[G]:de})}sendPageLoadEvent(){var G=this;return(0,c.Z)(function*(){if(yield G.w.elasticLoaded,G.w.elasticApm){const de=Object.assign(Object.assign({},G.getSyncLabels()),yield G.getAsyncLabels());(0,w.kg)().debug("sendPageLoadEvent"),G.w.elasticApm._sendPageLoadMetrics(),G.w.elasticApm.startTransaction(void 0,"page-load",{managed:!0,canReuse:!0}).addLabels(de)}})()}getTarget(G){let de="main";return"desktop"===G&&(de=window.location.pathname.includes("/interactive")?"interactive":window.location.pathname.includes("/embedded")?"embedded":window.location.pathname.includes("/compact")?"compact":"unknown"),de}getSyncLabels(){const G=this.getMeta("wo-platform");return{"wetterradar.target":this.getTarget(G)}}getAsyncLabels(){var G=this;return(0,c.Z)(function*(){return{"wetterradar.layer":yield(0,E.z)(G.activeLayerGroupShortKey$),"wetterradar.renderer":B.g.SelectedRenderer}})()}getMeta(G){var de;const xe=document.getElementsByTagName("meta");for(let Ne=0;Ne<xe.length;Ne++){const Ie=xe.item(Ne);if((null==Ie?void 0:Ie.getAttribute("name"))===G)return null!==(de=Ie.getAttribute("content"))&&void 0!==de?de:""}return""}trackClickEvent(G,de){var xe;switch((0,w.kg)().debug(this.tag,"trackClickEvent",G),G){case O.I.LegendOpen:case O.I.LegendClose:(0,w.kg)().error(this.tag,"this event should be tracked by tracking-legend service",G);break;case O.I.Locate:this.addElasticAPMEvent(G);break;case O.I.LoopStart:case O.I.LoopStop:this.addElasticAPMEvent(G,de);break;case O.I.Search:this.addElasticAPMEvent(G);break;case O.I.TimeStepLeft:case O.I.TimeStepRight:this.addElasticAPMEvent(G,de);break;case O.I.TimeSlider:null===(xe=this.buffer$.get(G))||void 0===xe||xe.next(null);break;default:this.addElasticAPMEvent(G,de)}}trackToolOpen(G,de){this.trackClickEvent(`tool_${G}`,de)}trackZoomEvent(G){(0,w.kg)().debug(this.tag,"trackZoomEvent",G),this.addElasticAPMEvent("button_zoom",{"wetterradar.data":G})}addElasticAPMEvent(G,de,xe={durationInSeconds:.1}){var Ne=this;return(0,c.Z)(function*(){const Ie=Object.assign(Object.assign(Object.assign({},Ne.getSyncLabels()),yield Ne.getAsyncLabels()),de);if((0,w.kg)().debug(Ne.tag,"addElasticAPMEvent",G,Ie),Ne.w.elasticApm){const Me=xe.startTime?xe.startTime:(new Date).getTime()-Ne.pageLoadTime,We=Me+1e3*xe.durationInSeconds;(0,w.kg)().debug(Ne.tag,`creating transaction for '${G}' - duration: ${xe.durationInSeconds} - startTime: ${Me} - endTime: ${We}`);const rt=Ne.w.elasticApm.startTransaction(G,"custom",{startTime:Me});return rt.addLabels({"interaction.from":"","interaction.to":""}),rt.addLabels(Ie),rt.end(We),rt}(0,w.kg)().debug(Ne.tag,"elasticApm is not available")})()}rapidTransaction(G){if(this.w.elasticApm){const de=Object.assign({},this.getSyncLabels()),Ne=this.w.elasticApm.startTransaction(G,"custom",{startTime:this.pageLoadTime});return Ne.addLabels(de),Ne}return null}flush(){var G=this;return(0,c.Z)(function*(){if(G.w.elasticApm){const de=G.w.elasticApm.serviceFactory.instances.ApmServer.queue.items;if((null==de?void 0:de.length)>0)return G.w.elasticApm.serviceFactory.instances.ApmServer.sendEvents(de).catch(()=>{(0,w.kg)().debug(G.tag,"Successfully send data to server")});(0,w.kg)().warn(G.tag,"no new transactions found!")}})()}sendTransactionManually(G,de){return G.duration=Math.round(1e3*de),G.trace_id=G.traceId,G.span_count={started:0},delete G.traceId,delete G.context,delete G.options,delete G.breakdownTimings,delete G.captureTimings,delete G.blocked,delete G._start,delete G._activeTasks,delete G._activeSpans,delete G.ended,console.log(JSON.stringify(G)),this.w.elasticApm.serviceFactory.instances.ApmServer.sendEvents([{transactions:G}]).catch(()=>{(0,w.kg)().debug(this.tag,"Successfully send data to server")})}}return F.\u0275fac=function(G){return new(G||F)(j.LFG(z.m))},F.\u0275prov=j.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})()},39698:(Ue,K,o)=>{"use strict";o.d(K,{e:()=>qe});var c=o(71670),v=o(49914),R=o(80228),E=o(78947),M=o(23280),O=o(41944),w=o(93945),T=o(54987),S=o(99635),z=o(26078),B=o(39663),j=o(95044),W=o(10420),F=o(1817),G=o(60116),de=o(80155),xe=o(98977),Ne=o(87260),Ie=o(71989),Me=o(32673),We=o(50635),rt=o(70679),pe=o(12077),Y=o(28863),Q=o(52019),X=o(19634),ie=o(67725),ue=o(23576),Ce=o(26309),Ee=o(81177),Pe=o(3184),st=o(95088),Oe=o(55504),Ge=o(9407),Ke=o(13496),Ct=o(20777),gt=o(85470),Ot=o(80584);let qe=(()=>{class Tt extends ue.I{constructor(ee,me,Ve,a,x,se,ye,De,Fe){var Se;let et;super(),Se=this,this.ngZone=a,this.layerGroupService=x,this.supportedRendererService=ye,this.trackingQueueService=De,this.startTime=performance.now(),this.grafanaAnalyticsEvents$=new R.x,this.tag="[tracking.service]",this.rounding=.025,this.timers=new Map,(0,ie.kg)().debug(`${this.tag} environment.production`,Y.N.production),this.w=ee,this.w.healthTest=()=>this.runHealthTest(),Fe.radarReady.then(()=>{(0,ie.kg)().debug(this.tag,"Radar fully loaded"),this.trackTimeSinceNavigationStart(),this.trackingQueueService.sendPageLoadEvent()}),Ve.slowCenterAndZoom$.pipe((0,G.h)(ze=>0!==ze.center.lat&&0!==ze.center.lng),(0,de.P)()).subscribe(ze=>{et=ze}),Ve.slowCenterAndZoom$.pipe((0,G.h)(ze=>0!==ze.center.lat&&0!==ze.center.lng&&0!==ze.zoom),(0,xe.x)((ze,tt)=>ze.center.equals(tt.center,0)&&ze.zoom===tt.zoom),(0,Ne.T)(1),(0,Ie.b)(2e3)).subscribe(ze=>{const tt=this.roundHalf(et.zoom),ve=this.roundHalf(ze.zoom),te=this.roundedDegrees(et.center.lat),oe=this.roundedDegrees(et.center.lng),Re=this.roundedDegrees(ze.center.lat),he=this.roundedDegrees(ze.center.lng);(te!==Re||oe!==he)&&this.trackingQueueService.addElasticAPMEvent("pan",{"interaction.from_geo_point":`${te},${oe}`,"interaction.to_geo_point":`${Re},${he}`}),tt!==ve&&this.trackingQueueService.addElasticAPMEvent("zoom",{"interaction.from":tt,"interaction.to":ve}),et=ze}),this.layerGroupService.active$.subscribe(ze=>{this.trackingQueueService.activeLayerGroupShortKey$.next(ze.radar.shortKey)}),me.period$.subscribe(ze=>{this.trackingQueueService.activePeriod$.next(ze.id)}),Ve.slowCenter$.subscribe(ze=>{const tt=`${this.roundedDegrees(ze.lat)},${this.roundedDegrees(ze.lng)}`;this.trackingQueueService.activePosition$.next(tt)}),this.layerGroupService.active$.pipe((0,Me.w)(ze=>me.period$.pipe((0,We.U)(tt=>({lg:ze.radar.shortKey,periodKey:tt.id})),(0,xe.x)((tt,ve)=>tt.lg===ve.lg&&tt.periodKey===ve.periodKey),(0,rt.G)(),function L(Tt){return(0,O.e)((V,ee)=>{let me=!1;const Ve=(0,w.x)(ee,()=>{null==Ve||Ve.unsubscribe(),me=!0},S.Z);(0,T.Xf)(Tt).subscribe(Ve),V.subscribe((0,w.x)(ee,a=>me&&ee.next(a)))})}((0,E.H)(500))))).subscribe(([ze,tt])=>{(0,ie.kg)().debug(`${this.tag} Period changed (${ze.periodKey} -> ${tt.periodKey})`);const ve=this.timer("button_period_switched");this.trackingQueueService.addElasticAPMEvent("button_period_switched",{layer:tt.lg,"interaction.from":ze.periodKey,"interaction.to":tt.periodKey},ve)}),this.layerGroupService.active$.pipe((0,rt.G)()).subscribe(([ze,tt])=>{(0,ie.kg)().debug(`${this.tag} User switched layer to: ${tt.radar.shortKey}`);const ve=this.timer("button_layer_switched");this.trackingQueueService.addElasticAPMEvent("button_layer_switched",{"interaction.from":ze.radar.shortKey,"interaction.to":tt.radar.shortKey},ve)}),this.ngZone.runOutsideAngular(()=>{this.grafanaAnalyticsEvents$.pipe(function ne(Tt,...V){var ee,me;const Ve=null!==(ee=(0,W.yG)(V))&&void 0!==ee?ee:j.z,a=null!==(me=V[0])&&void 0!==me?me:null,x=V[1]||1/0;return(0,O.e)((se,ye)=>{let De=[],Fe=!1;const Se=Xe=>{const{buffer:ze,subs:tt}=Xe;tt.unsubscribe(),(0,B.P)(De,Xe),ye.next(ze),Fe&&et()},et=()=>{if(De){const Xe=new z.w0;ye.add(Xe);const tt={buffer:[],subs:Xe};De.push(tt),(0,F.f)(Xe,Ve,()=>Se(tt),Tt)}};null!==a&&a>=0?(0,F.f)(ye,Ve,et,a,!0):Fe=!0,et();const Be=(0,w.x)(ye,Xe=>{const ze=De.slice();for(const tt of ze){const{buffer:ve}=tt;ve.push(Xe),x<=ve.length&&Se(tt)}},()=>{for(;null==De?void 0:De.length;)ye.next(De.shift().buffer);null==Be||Be.unsubscribe(),ye.complete(),ye.unsubscribe()},void 0,()=>De=null);se.subscribe(Be)})}(2500),(0,G.h)(ze=>ze.length>0),this.takeUntilDestroy()).subscribe(ze=>{this.sendBeacon(ze),Y.N.production||(0,ie.kg)().debug(`${this.tag} beacon`,ze)})}),se.networkErrors$.pipe(this.takeUntilDestroy()).subscribe(ze=>{this.w.error_network_generic=(this.w.error_network_generic||0)+1}),se.networkTimout$.pipe(this.takeUntilDestroy()).subscribe(ze=>{this.w.error_network_timeout=(this.w.error_network_timeout||0)+1});let Be=(new Date).getTime();const Xe=function(){var ze=(0,c.Z)(function*(){const ve=((new Date).getTime()-Be)/1e3-.1;(0,ie.kg)().debug(`page was visible for ${ve} seconds`);const te=Se.trackingQueueService.rapidTransaction("page-visible");te&&Se.trackingQueueService.sendTransactionManually(te,ve)});return function(){return ze.apply(this,arguments)}}();(0,M.R)(document,"visibilitychange",{passive:!0}).subscribe((0,c.Z)(function*(){document.hidden?((0,ie.kg)().debug("page is hidden now!"),yield Xe()):((0,ie.kg)().debug("page is visible again"),Be=(new Date).getTime())}))}timer(ee){var me;const Ve=null!==(me=this.timers.get(ee))&&void 0!==me?me:this.startTime,a=performance.now(),x=(a-Ve)/1e3;return this.timers.set(ee,a),{startTime:a,durationInSeconds:x}}roundHalf(ee){return Math.round(2*ee)/2}roundedDegrees(ee){const me=Math.round(ee/this.rounding)*this.rounding;return String(Math.round(1e3*me)/1e3)}calculate_load_times(){console.log(performance.getEntriesByType("navigation")),console.log(performance.getEntriesByType("resource").filter(ee=>ee.name.includes("dynamic")))}sendBeacon(ee){const me=this.getSessionProps();me.events=ee;const Ve=JSON.stringify(me);"boolean"==typeof this.w.NO_TRACKING&&!0===this.w.NO_TRACKING?(0,ie.kg)().debug(`${this.tag} Tracking is disabled`):((0,ie.kg)().debug(`${this.tag} Sending beacon to Grafana`),this.w.navigator.sendBeacon&&Y.N.production&&this.w.navigator.sendBeacon("https://tiles.wo-cloud.com/analytics",Ve))}trackTimeSinceNavigationStart(){const ee=Math.ceil(performance.now())/1e3,me=Math.ceil(performance.now()-this.startTime)/1e3;this.trackGrafanaEvent({type:"onload",ttft:me,tsns:ee})}getSessionProps(){let ee="dev";return"WO-INT-DEV"===pe.q?ee="dev":"master"===pe.q&&(ee="master"),{application:this.trackingQueueService.getMeta("wo-platform"),environment:ee,renderer:Q.g.SelectedRenderer,version:pe.q,browser:(0,X.getBrowser)(),resolution:`${window.screen.availWidth}x${window.screen.availHeight}`,events:[]}}trackGrafanaEvent(ee){this.grafanaAnalyticsEvents$.next(ee)}runHealthTest(){var ee=this;return(0,c.Z)(function*(){const me=yield ee.getInfo(),Ve=yield ee.runIFrameWebGLTest(),a=yield ee.getUserAgentData(),x=[];if(x.push("##################################"),x.push("WETTERONLINE HEALTH CHECK"),x.push("##################################"),ee.supportedRendererService.logs.forEach(se=>x.push(se)),x.push("----------------------------------"),Ve.forEach(se=>x.push(se)),x.push("----------------------------------"),Object.keys(me).forEach(se=>x.push(`${se}: ${me[se]}`)),x.push("----------------------------------"),Object.keys(a).forEach(se=>x.push(`${se}: ${a[se]}`)),x.push("----------------------------------"),x.push(...ee.supportedRendererService.printMapping().map(se=>JSON.stringify(se))),x.push("##################################"),x.push("WETTERONLINE HEALTH CHECK FINISHED"),x.push("##################################"),ee.supportedRendererService.allLayersSupported())x.push(ee.tag,"All layers are supported");else{x.push(ee.tag,"NOT all layers are supported");let se="";v.c.isWebGLSupported()?se+="webgl-version: "+(v.c.isWebGL2()?"webgl2":"webgl1"):se+="no-webgl",x.push(se)}x.forEach(se=>(0,ie.kg)().info(ee.tag,se))})()}runIFrameWebGLTest(){return(0,c.Z)(function*(){return new Promise((ee,me)=>{const Ve=document.createElement("iframe");Ve.className="webgl-iframe",Ve.src="./assets/shared/webgl-test/index.html",Ve.style.visibility="hidden",Ve.onload=()=>{var a,x,se;const ye=null===(a=Ve.contentDocument)||void 0===a?void 0:a.getElementsByTagName("div");if(!ye)throw new Ce.Z("[DeveloperError] [runIFrameWebGLTest] tracking.service");const De=[];for(let Fe=0;Fe<ye.length;Fe++)De.push(null!==(se=null===(x=ye.item(Fe))||void 0===x?void 0:x.textContent)&&void 0!==se?se:"");document.body.removeChild(Ve),0===De.length&&De.push("looks like this browser is not capable of running a webgl test... (probably webGL is not supported)"),ee(De)},Ve.onerror=a=>{(0,ie.kg)().error(a),me(a)},document.body.appendChild(Ve)})})()}getUserAgentData(){return(0,c.Z)(function*(){try{return navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion"])}catch(ee){return Promise.resolve({})}})()}getInfo(){return(0,c.Z)(function*(){var ee,me,Ve,a;return{timeOpened:new Date,timezone:(new Date).getTimezoneOffset()/60,pageon:window.location.pathname,referrer:document.referrer,browserName:navigator.appName,browserEngine:navigator.product,browserVersion1a:navigator.appVersion,browserVersion1b:navigator.userAgent,browserLanguage:navigator.language,browserOnline:navigator.onLine,browserPlatform:navigator.platform,dataCookiesEnabled:navigator.cookieEnabled,dataCookies1:document.cookie,dataStorage:JSON.stringify(localStorage),sizeScreenW:screen.width,sizeScreenH:screen.height,sizeInW:innerWidth,sizeInH:innerHeight,sizeAvailW:screen.availWidth,sizeAvailH:screen.availHeight,scrColorDepth:screen.colorDepth,scrPixelDepth:screen.pixelDepth,devicePixelRatio:window.devicePixelRatio,wrVersion:pe.q,online:window.navigator.onLine,deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency,networkEffectiveType:null===(ee=navigator.connection)||void 0===ee?void 0:ee.effectiveType,networkRtt:null===(me=navigator.connection)||void 0===me?void 0:me.rtt,networkDownlink:null===(Ve=navigator.connection)||void 0===Ve?void 0:Ve.downlink,networkSaveData:null===(a=navigator.connection)||void 0===a?void 0:a.saveData}})()}}return Tt.\u0275fac=function(ee){return new(ee||Tt)(Pe.LFG(Ee.m),Pe.LFG(st.Y),Pe.LFG(Oe.b),Pe.LFG(Pe.R0b),Pe.LFG(Ge.z),Pe.LFG(Ke.R),Pe.LFG(Ct.S),Pe.LFG(gt.Y),Pe.LFG(Ot.e))},Tt.\u0275prov=Pe.Yz7({token:Tt,factory:Tt.\u0275fac,providedIn:"root"}),Tt})()},99744:(Ue,K,o)=>{"use strict";o.d(K,{Z:()=>R});var c=o(76317),v=o(3184);let R=(()=>{class E{constructor(){this._currentOpenSheet$=new c.X(null),this.currentOpenSheet$=this._currentOpenSheet$.asObservable()}openSheet(O,w=32){this._currentOpenSheet$.next(Object.assign(Object.assign({},O),{percent:w}))}closeSheet(){this._currentOpenSheet$.next(null)}isOpen(){return null!==this._currentOpenSheet$.value}}return E.\u0275fac=function(O){return new(O||E)},E.\u0275prov=v.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()},78367:(Ue,K,o)=>{"use strict";o.d(K,{t:()=>E});var c=o(36362),v=o(3184);let R=(()=>{class M{}return M.\u0275fac=function(w){return new(w||M)},M.\u0275mod=v.oAB({type:M}),M.\u0275inj=v.cJS({imports:[[c.ez]]}),M})(),E=(()=>{class M{}return M.\u0275fac=function(w){return new(w||M)},M.\u0275mod=v.oAB({type:M}),M.\u0275inj=v.cJS({imports:[[c.ez,R]]}),M})()},40246:(Ue,K,o)=>{"use strict";o.d(K,{r:()=>We,J:()=>Me});var c=o(71670),v=o(76317),R=o(98977),E=o(60116),M=o(34351),O=o(89196),w=o(98452),T=o(99744),S=o(71318),L=o(78992),z=o(67725),B=o(69545),j=o(3893),W=o(3184),F=o(36362);function ne(rt,pe){if(1&rt&&W._UZ(0,"div",5),2&rt){const Y=pe.$implicit;W.Udp("background-color",Y.color)("--histogram-value",100*Y.value+"%")}}let G=(()=>{class rt{static normalize(Y){const Q=Math.max(...Y.map(X=>X.value));for(const X of Y)X.value=X.value/Q;return Y}setData(Y){this.pixels=Y.pixels,this.bluePixels=Y.bluePixels,this.edgePixels=Y.edgePixels,this.bluePixelsPercentage=(100*Y.bluePixels/Y.pixels).toFixed(1),this.edgePixelsPercentage=(100*Y.edgePixels/Y.bluePixels).toFixed(1),this.url=Y.url,this.histogram=rt.normalize(Y.histogram)}}return rt.\u0275fac=function(Y){return new(Y||rt)},rt.\u0275cmp=W.Xpm({type:rt,selectors:[["wo-xrain-debug"]],decls:11,vars:8,consts:[[1,"general"],["target","_blank",3,"href"],[1,"preview",3,"src"],[1,"histogram"],["class","item",3,"backgroundColor","--histogram-value",4,"ngFor","ngForOf"],[1,"item"]],template:function(Y,Q){1&Y&&(W.TgZ(0,"div",0)(1,"div"),W._uU(2),W.qZA(),W.TgZ(3,"div"),W._uU(4),W.qZA(),W.TgZ(5,"div"),W._uU(6),W.qZA()(),W.TgZ(7,"a",1),W._UZ(8,"img",2),W.qZA(),W.TgZ(9,"div",3),W.YNc(10,ne,1,4,"div",4),W.qZA()),2&Y&&(W.xp6(2),W.hij("Pixels: ",Q.pixels,""),W.xp6(2),W.AsE("Blue Pixels: ",Q.bluePixels," (",Q.bluePixelsPercentage,"%)"),W.xp6(2),W.AsE("Edge Pixels: ",Q.edgePixels," (",Q.edgePixelsPercentage,"%)"),W.xp6(1),W.Q6J("href",Q.url,W.LSH),W.xp6(1),W.Q6J("src",Q.url,W.LSH),W.xp6(2),W.Q6J("ngForOf",Q.histogram))},directives:[F.sg],styles:[".btn[_ngcontent-%COMP%]{display:block;cursor:pointer;background-color:#10658e;-webkit-appearance:none;outline:0;border:0;padding:12px;font-size:16px;border-radius:4px;margin:16px auto;text-decoration:none;color:#fff}.btn[_ngcontent-%COMP%]:hover{background:#003366}.btn[_ngcontent-%COMP%]:active{background:#00537f}.btn.disabled[_ngcontent-%COMP%]{color:#10658e;background:#e6eff3}.btn.secondary[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e6eff3;color:#10658e}.btn.secondary[_ngcontent-%COMP%]:active{background-color:#e6eff3;border:1px solid #10658e}.btn.secondary[_ngcontent-%COMP%]:hover{background:#e6eff3}.btn.secondary.disabled[_ngcontent-%COMP%]{border:1px solid #e6eff3;color:#a0a0a0}.btn.quarterly[_ngcontent-%COMP%]{background-color:#fff;color:#10658e;border:1px solid #e6eff3;border-radius:4px}.btn.quarterly[_ngcontent-%COMP%]:hover{background-color:#f2f7f9;color:#003959}.btn.quarterly[_ngcontent-%COMP%]:active{background-color:#f2f7f9;color:#00537f}  wo-bottom-sheet{position:absolute;left:0;bottom:0;width:256px;height:256px;z-index:9}  .bottom-sheet-container{height:100%!important}.general[_ngcontent-%COMP%]{font-size:11px;color:#3c3c3c}.preview[_ngcontent-%COMP%]{position:absolute;right:4px;top:4px;width:64px}.histogram[_ngcontent-%COMP%]{width:100%;align-items:flex-end;display:flex;border:1px solid rgba(0,0,0,.1);height:190px}.histogram[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{height:var(--histogram-value);display:flex;flex-direction:column;justify-content:flex-end;flex:1;align-items:center}.histogram[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:var(--histogram-value);width:100%;display:flex;justify-content:center;align-items:center}"]}),rt})();var de=o(81735),xe=o(55504),Ne=o(87163),Ie=o(28784);class Me{constructor(){this.layer={background:!0,composite:!0,geo:!0,lightning:!0,particles:!0,cityLocations:!0,names:!0,annotation:!0,positionMarker:!0,bars:!0,contentMarker:!0,markerClusterAmount:!0},this.debug={wind:!1,tileBoundaries:"troubleshooting"===de._.platform,mapcenter:!1,picking:!1}}}class We{constructor(pe,Y,Q,X,ie){if(this.mapView=pe,this.mapClickService=Y,this.bottomSheetService=Q,this.httpClient=ie,this.debug$=new v.X(!1),this.maxLogEventHistory=100,!(0,B.Z)()){window.openDebug=()=>this.showDebugUI();const ue="true"===(0,j._K)(window.location.href,"tiledebug","false"),Ce="true"===(0,j._K)(window.location.href,"pickingdebug","false");We.renderDebug.debug=Object.assign(Object.assign({},We.renderDebug.debug),{tileBoundaries:We.renderDebug.debug.tileBoundaries||ue,picking:We.renderDebug.debug.tileBoundaries||Ce}),ue&&this.mapClickService.click$.pipe((0,R.x)(),(0,E.h)(()=>this.mapView.renderer instanceof S.a)).subscribe(Ee=>{const Pe=this.mapView.containerToGeo(Ee),st=this.mapView.geoToTile(Pe,w.d.TILE_SIZE),Oe=this.mapView.renderer.containers.get("composite");if(void 0!==Oe){let Ge;for(const Ke of Oe.meshes.keys())if(Ke.startsWith(st.x+":"+st.y)){Ge=Ke;break}if(Ge){const Ke=Oe.getMesh(Ge);Ke instanceof L.c&&this.httpClient.get(Ke.getCurrentUrl()+"&debug=true",{observe:"response",responseType:"arraybuffer"}).subscribe(Ct=>{const gt=Ct.headers.get("x-rain");let Ot;gt&&(Ot=(gt.match(/blueHistogram/g)||[]).length?JSON.parse("["+gt+"]")[0]:JSON.parse(gt),Ot.url=Ke.getCurrentUrl(),this.bottomSheetService.openSheet({component:G,data:Ot}))})}}})}this.logEvents$=(0,z.kg)().logs$.pipe((0,M.R)((ue,Ce)=>{for(ue.push(Ce);ue.length>this.maxLogEventHistory;)ue.shift();return ue},[]),(0,O.d)(1)),X.runOutsideAngular(()=>{this.logEvents$.subscribe(()=>{})})}registerContainer(pe){this.container=pe}showDebugUI(){var pe=this;return(0,c.Z)(function*(){if(pe.componentRef)return pe.componentRef.instance.toggle();const Y=pe.container;if(!Y)throw new Error("No debug view container was set, include a <wo-debug-wrapper> element in your app");const Q=yield o.e(656).then(o.bind(o,60656));pe.componentRef=Y.createComponent(Q.DebugComponent)})()}}We.renderDebug=new Me,We.\u0275fac=function(pe){return new(pe||We)(W.LFG(xe.b),W.LFG(Ne.k),W.LFG(T.Z),W.LFG(W.R0b),W.LFG(Ie.eN))},We.\u0275prov=W.Yz7({token:We,factory:We.\u0275fac,providedIn:"root"})},3745:(Ue,K,o)=>{"use strict";o.d(K,{c:()=>v});const v=new(o(3184).OlP)("LAYER_CONFIG")},87163:(Ue,K,o)=>{"use strict";o.d(K,{k:()=>R});var c=o(80228),v=o(3184);let R=(()=>{class E{constructor(){this.click$=new c.x}}return E.\u0275fac=function(O){return new(O||E)},E.\u0275prov=v.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()},55504:(Ue,K,o)=>{"use strict";o.d(K,{b:()=>We});var c=o(10149),v=o(76317),R=o(80228),E=o(26562),M=o(50635),O=o(60116),w=o(19337),T=o(89196),S=o(81735),L=o(1251);class z{constructor(pe,Y,Q,X){this.view=pe,this.fixedPoint=Y,this.callback=X,this.startZoom=pe.zoom,this.zoomOffset=Q-this.startZoom}runFrame(pe){const Y=this.startZoom+pe*this.zoomOffset,Q=this.view.getZoomScale(Y),X=this.view.size._divideBy(2),ie=this.fixedPoint.subtract(X)._multiplyBy(1-1/Q),ue=this.view.containerToGeo(X.add(ie));this.callback(ue,Y)}}class B{constructor(pe,Y,Q,X){this.callback=X,this.startZoom=pe.zoom,this.zoomOffset=Q-this.startZoom,this.startCenter=pe.center,this.centerOffset=new c.MP(Y.lat-this.startCenter.lat,Y.lng-this.startCenter.lng)}runFrame(pe){const Y=this.startZoom+pe*this.zoomOffset,Q=new c.MP(this.startCenter.lat+pe*this.centerOffset.lat,this.startCenter.lng+pe*this.centerOffset.lng);this.callback(Q,Y)}}var j=o(45275),W=o(26309),F=o(67725),ne=o(37656),G=o(69545),de=o(23576),xe=o(81177),Ne=o(3184);let Ie=(()=>{class rt{