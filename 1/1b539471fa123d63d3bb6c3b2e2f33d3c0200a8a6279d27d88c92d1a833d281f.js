(self.webpackChunkmoovit_wtp_next=self.webpackChunkmoovit_wtp_next||[]).push([["client_app_map_map_module_ts"],{33249:function(t,e,r){"use strict";r.r(e),r.d(e,{MapModule:function(){return Do}});var n={};r.r(n),r.d(n,{LAT_MAX:function(){return Y},LAT_MIN:function(){return q},LAT_RENDERED_MAX:function(){return X},LAT_RENDERED_MIN:function(){return V},LNG_MAX:function(){return H},LNG_MIN:function(){return Z},activeStates:function(){return U},classes:function(){return D},cursors:function(){return N},events:function(){return F},geojsonTypes:function(){return z},interactions:function(){return G},meta:function(){return j},modes:function(){return R},sources:function(){return O},types:function(){return k},updateActions:function(){return B}});var i=r(3786),o=r(88620),a=r.n(o),s=r(2316),u=r(14474),l=r(94354);class c extends l.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(t){const{hasError:e,_hasValue:r,_value:n,thrownError:i,isStopped:o,_isComplete:a}=this;e?t.error(i):(o||a)&&(r&&t.next(n),t.complete())}next(t){this.isStopped||(this._value=t,this._hasValue=!0)}complete(){const{_hasValue:t,_value:e,_isComplete:r}=this;r||(this._isComplete=!0,t&&super.next(e),super.complete())}}var h=r(35533),p=r(39754),f=r(2122),d=r(3593),g=r(75485),m=r(87272);function y(t){return(0,d.e)((e,r)=>{let n=[];return e.subscribe(new m.Q(r,t=>n.push(t),()=>{r.next(n),r.complete()})),t.subscribe(new m.Q(r,()=>{const t=n;n=[],r.next(t)},g.Z)),()=>{n=null}})}var v=r(53399),_=r(65110),x=r(21186),b=r(74007),w=r.n(b),E=r(55082),M=r(2339),C=r(89067),S=r.n(C),L=r(45788),I=r(34297),T=r(81182),A=function(t,e){const r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on(t,e,n){if(void 0===r[t])throw new Error(`Invalid event type: ${t}`);r[t].push({selector:e,fn:n})},render(t){e.store.featureChanged(t)}},i=function(t,i){const o=r[t];let a=o.length;for(;a--;){const t=o[a];if(t.selector(i)){t.fn.call(n,i),e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(n),{render:t.render,stop(){t.stop&&t.stop()},trash(){t.trash&&(t.trash(),e.store.render())},combineFeatures(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures(){t.uncombineFeatures&&t.uncombineFeatures()},drag(t){i("drag",t)},click(t){i("click",t)},mousemove(t){i("mousemove",t)},mousedown(t){i("mousedown",t)},mouseup(t){i("mouseup",t)},mouseout(t){i("mouseout",t)},keydown(t){i("keydown",t)},keyup(t){i("keyup",t)},touchstart(t){i("touchstart",t)},touchmove(t){i("touchmove",t)},touchend(t){i("touchend",t)},tap(t){i("tap",t)}}},P=r(53041);const D={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},O={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},N={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},k={POLYGON:"polygon",LINE:"line_string",POINT:"point"},z={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},R={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},F={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},B={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},j={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},U={ACTIVE:"true",INACTIVE:"false"},G=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],q=-90,V=-85,Y=90,X=85,Z=-270,H=270,W={Point:0,LineString:1,Polygon:2};function J(t,e){const r=W[t.geometry.type]-W[e.geometry.type];return 0===r&&t.geometry.type===z.POLYGON?t.area-e.area:r}function Q(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(let e=0,r=t.length;e<r;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}Q.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},Q.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},Q.prototype.has=function(t){return!("string"!=typeof t&&"number"!=typeof t||void 0===this._items[t]&&void 0===this._nums[t])},Q.prototype.values=function(){const t=[];return Object.keys(this._items).forEach(e=>{t.push({k:e,v:this._items[e]})}),Object.keys(this._nums).forEach(e=>{t.push({k:JSON.parse(e),v:this._nums[e]})}),t.sort((t,e)=>t.v-e.v).map(t=>t.k)},Q.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var K=Q;const $=[j.FEATURE,j.MIDPOINT,j.VERTEX];var tt={click:function(t,e,r){return et(t,e,r,r.options.clickBuffer)},touch:function(t,e,r){return et(t,e,r,r.options.touchBuffer)}};function et(t,e,r,n){if(null===r.map)return[];const i=t?function(t,e=0){return[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}(t,n):e,o={};r.options.styles&&(o.layers=r.options.styles.map(t=>t.id));const a=r.map.queryRenderedFeatures(i,o).filter(t=>-1!==$.indexOf(t.properties.meta)),s=new K,u=[];return a.forEach(t=>{const e=t.properties.id;s.has(e)||(s.add(e),u.push(t))}),function(t){return t.map(t=>(t.geometry.type===z.POLYGON&&(t.area=P.geometry({type:z.FEATURE,property:{},geometry:t.geometry})),t)).sort(J).map(t=>(delete t.area,t))}(u)}function rt(t,e){const r=tt.click(t,null,e),n={mouse:N.NONE};return r[0]&&(n.mouse=r[0].properties.active===U.ACTIVE?N.MOVE:N.POINTER,n.feature=r[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(n.mouse=N.ADD),e.ui.queueMapClasses(n),e.ui.updateMapClasses(),r[0]}function nt(t,e){const r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function it(t,e,r={}){const n=null!=r.fineTolerance?r.fineTolerance:4,i=null!=r.grossTolerance?r.grossTolerance:12,o=null!=r.interval?r.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;const a=nt(t.point,e.point);return a<n||a<i&&e.time-t.time<o}function ot(t,e,r={}){const n=null!=r.tolerance?r.tolerance:25,i=null!=r.interval?r.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,nt(t.point,e.point)<n&&e.time-t.time<i}var at=r(89300),st=r.n(at);const ut=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||st()(),this.type=e.geometry.type};ut.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ut.prototype.incomingCoords=function(t){this.setCoordinates(t)},ut.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},ut.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ut.prototype.setProperty=function(t,e){this.properties[t]=e},ut.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:z.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ut.prototype.internal=function(t){const e={id:this.id,meta:j.FEATURE,"meta:type":this.type,active:U.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(const r in this.properties)e[`user_${r}`]=this.properties[r];return{type:z.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var lt=ut;const ct=function(t,e){lt.call(this,t,e)};(ct.prototype=Object.create(lt.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},ct.prototype.updateCoordinate=function(t,e,r){this.coordinates=3===arguments.length?[e,r]:[t,e],this.changed()},ct.prototype.getCoordinate=function(){return this.getCoordinates()};var ht=ct;const pt=function(t,e){lt.call(this,t,e)};(pt.prototype=Object.create(lt.prototype)).isValid=function(){return this.coordinates.length>1},pt.prototype.addCoordinate=function(t,e,r){this.changed();const n=parseInt(t,10);this.coordinates.splice(n,0,[e,r])},pt.prototype.getCoordinate=function(t){const e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},pt.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},pt.prototype.updateCoordinate=function(t,e,r){const n=parseInt(t,10);this.coordinates[n]=[e,r],this.changed()};var ft=pt;const dt=function(t,e){lt.call(this,t,e),this.coordinates=this.coordinates.map(t=>t.slice(0,-1))};(dt.prototype=Object.create(lt.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(t=>t.length>2)},dt.prototype.incomingCoords=function(t){this.coordinates=t.map(t=>t.slice(0,-1)),this.changed()},dt.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},dt.prototype.addCoordinate=function(t,e,r){this.changed();const n=t.split(".").map(t=>parseInt(t,10));this.coordinates[n[0]].splice(n[1],0,[e,r])},dt.prototype.removeCoordinate=function(t){this.changed();const e=t.split(".").map(t=>parseInt(t,10)),r=this.coordinates[e[0]];r&&(r.splice(e[1],1),r.length<3&&this.coordinates.splice(e[0],1))},dt.prototype.getCoordinate=function(t){const e=t.split(".").map(t=>parseInt(t,10));return JSON.parse(JSON.stringify(this.coordinates[e[0]][e[1]]))},dt.prototype.getCoordinates=function(){return this.coordinates.map(t=>t.concat([t[0]]))},dt.prototype.updateCoordinate=function(t,e,r){this.changed();const n=t.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10);void 0===this.coordinates[i]&&(this.coordinates[i]=[]),this.coordinates[i][o]=[e,r]};var gt=dt;const mt={MultiPoint:ht,MultiLineString:ft,MultiPolygon:gt},yt=(t,e,r,n,i)=>{const o=r.split("."),a=parseInt(o[0],10),s=o[1]?o.slice(1).join("."):null;return t[a][e](s,n,i)},vt=function(t,e){if(lt.call(this,t,e),delete this.coordinates,this.model=mt[e.geometry.type],void 0===this.model)throw new TypeError(`${e.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(e.geometry.coordinates)};(vt.prototype=Object.create(lt.prototype))._coordinatesToFeatures=function(t){const e=this.model.bind(this);return t.map(t=>new e(this.ctx,{id:st()(),type:z.FEATURE,properties:{},geometry:{coordinates:t,type:this.type.replace("Multi","")}}))},vt.prototype.isValid=function(){return this.features.every(t=>t.isValid())},vt.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},vt.prototype.getCoordinate=function(t){return yt(this.features,"getCoordinate",t)},vt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(t=>t.type===z.POLYGON?t.getCoordinates():t.coordinates)))},vt.prototype.updateCoordinate=function(t,e,r){yt(this.features,"updateCoordinate",t,e,r),this.changed()},vt.prototype.addCoordinate=function(t,e,r){yt(this.features,"addCoordinate",t,e,r),this.changed()},vt.prototype.removeCoordinate=function(t){yt(this.features,"removeCoordinate",t),this.changed()},vt.prototype.getFeatures=function(){return this.features};var _t=vt;function xt(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}xt.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},xt.prototype.setSelectedCoordinates=function(t){this._ctx.store.setSelectedCoordinates(t),t.reduce((t,e)=>(void 0===t[e.feature_id]&&(t[e.feature_id]=!0,this._ctx.store.get(e.feature_id).changed()),t),{})},xt.prototype.getSelected=function(){return this._ctx.store.getSelected()},xt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},xt.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},xt.prototype.getFeature=function(t){return this._ctx.store.get(t)},xt.prototype.select=function(t){return this._ctx.store.select(t)},xt.prototype.deselect=function(t){return this._ctx.store.deselect(t)},xt.prototype.deleteFeature=function(t,e={}){return this._ctx.store.delete(t,e)},xt.prototype.addFeature=function(t){return this._ctx.store.add(t)},xt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},xt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},xt.prototype.setActionableState=function(t={}){return this._ctx.events.actionable({trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1})},xt.prototype.changeMode=function(t,e={},r={}){return this._ctx.events.changeMode(t,e,r)},xt.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},xt.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},xt.prototype.featuresAt=function(t,e,r="click"){if("click"!==r&&"touch"!==r)throw new Error("invalid buffer type");return tt[r](t,e,this._ctx)},xt.prototype.newFeature=function(t){const e=t.geometry.type;return e===z.POINT?new ht(this._ctx,t):e===z.LINE_STRING?new ft(this._ctx,t):e===z.POLYGON?new gt(this._ctx,t):new _t(this._ctx,t)},xt.prototype.isInstanceOf=function(t,e){if(t===z.POINT)return e instanceof ht;if(t===z.LINE_STRING)return e instanceof ft;if(t===z.POLYGON)return e instanceof gt;if("MultiFeature"===t)return e instanceof _t;throw new Error(`Unknown feature class: ${t}`)},xt.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)};var bt=xt;xt.prototype.onSetup=function(){},xt.prototype.onDrag=function(){},xt.prototype.onClick=function(){},xt.prototype.onMouseMove=function(){},xt.prototype.onMouseDown=function(){},xt.prototype.onMouseUp=function(){},xt.prototype.onMouseOut=function(){},xt.prototype.onKeyUp=function(){},xt.prototype.onKeyDown=function(){},xt.prototype.onTouchStart=function(){},xt.prototype.onTouchMove=function(){},xt.prototype.onTouchEnd=function(){},xt.prototype.onTap=function(){},xt.prototype.onStop=function(){},xt.prototype.onTrash=function(){},xt.prototype.onCombineFeature=function(){},xt.prototype.onUncombineFeature=function(){},xt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const wt={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Et=Object.keys(wt);var Mt=function(t){return[].concat(t).filter(t=>void 0!==t)};function Ct(){const t=this;if(!t.ctx.map||void 0===t.ctx.map.getSource(O.HOT))return s();const e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});let r=[],n=[];t.isDirty?n=t.getAllIds():(r=t.getChangedIds().filter(e=>void 0!==t.get(e)),n=t.sources.hot.filter(e=>e.properties.id&&-1===r.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)).map(t=>t.properties.id)),t.sources.hot=[];const i=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(t=>-1===r.indexOf(t.properties.id||t.properties.parent));const o=i!==t.sources.cold.length||n.length>0;function a(r,n){const i=t.get(r).internal(e);t.ctx.events.currentModeRender(i,e=>{t.sources[n].push(e)})}if(r.forEach(t=>a(t,"hot")),n.forEach(t=>a(t,"cold")),o&&t.ctx.map.getSource(O.COLD).setData({type:z.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(O.HOT).setData({type:z.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(F.SELECTION_CHANGE,{features:t.getSelected().map(t=>t.toGeoJSON()),points:t.getSelectedCoordinates().map(t=>({type:z.FEATURE,properties:{},geometry:{type:z.POINT,coordinates:t.coordinates}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){const e=t._deletedFeaturesToEmit.map(t=>t.toGeoJSON());t._deletedFeaturesToEmit=[],t.ctx.map.fire(F.DELETE,{features:e})}function s(){t.isDirty=!1,t.clearChangedIds()}s(),t.ctx.map.fire(F.RENDER,{})}function St(t){let e;this._features={},this._featureIds=new K,this._selectedFeatureIds=new K,this._selectedCoordinates=[],this._changedFeatureIds=new K,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=()=>{e||(e=requestAnimationFrame(()=>{e=null,Ct.call(this)}))},this.isDirty=!1}function Lt(t,e){const r=t._selectedCoordinates.filter(e=>t._selectedFeatureIds.has(e.feature_id));t._selectedCoordinates.length!==r.length&&!e.silent&&(t._emitSelectionChange=!0),t._selectedCoordinates=r}St.prototype.createRenderBatch=function(){const t=this.render;let e=0;return this.render=function(){e++},()=>{this.render=t,e>0&&this.render()}},St.prototype.setDirty=function(){return this.isDirty=!0,this},St.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},St.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},St.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},St.prototype.getAllIds=function(){return this._featureIds.values()},St.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},St.prototype.delete=function(t,e={}){return Mt(t).forEach(t=>{!this._featureIds.has(t)||(this._featureIds.delete(t),this._selectedFeatureIds.delete(t),e.silent||-1===this._deletedFeaturesToEmit.indexOf(this._features[t])&&this._deletedFeaturesToEmit.push(this._features[t]),delete this._features[t],this.isDirty=!0)}),Lt(this,e),this},St.prototype.get=function(t){return this._features[t]},St.prototype.getAll=function(){return Object.keys(this._features).map(t=>this._features[t])},St.prototype.select=function(t,e={}){return Mt(t).forEach(t=>{this._selectedFeatureIds.has(t)||(this._selectedFeatureIds.add(t),this._changedFeatureIds.add(t),e.silent||(this._emitSelectionChange=!0))}),this},St.prototype.deselect=function(t,e={}){return Mt(t).forEach(t=>{!this._selectedFeatureIds.has(t)||(this._selectedFeatureIds.delete(t),this._changedFeatureIds.add(t),e.silent||(this._emitSelectionChange=!0))}),Lt(this,e),this},St.prototype.clearSelected=function(t={}){return this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},St.prototype.setSelected=function(t,e={}){return t=Mt(t),this.deselect(this._selectedFeatureIds.values().filter(e=>-1===t.indexOf(e)),{silent:e.silent}),this.select(t.filter(t=>!this._selectedFeatureIds.has(t)),{silent:e.silent}),this},St.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},St.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},St.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},St.prototype.getSelected=function(){return this._selectedFeatureIds.values().map(t=>this.get(t))},St.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))},St.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},St.prototype.setFeatureProperty=function(t,e,r){this.get(t).setProperty(e,r),this.featureChanged(t)},St.prototype.storeMapConfig=function(){G.forEach(t=>{this.ctx.map[t]&&(this._mapInitialConfig[t]=this.ctx.map[t].isEnabled())})},St.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(t=>{this._mapInitialConfig[t]?this.ctx.map[t].enable():this.ctx.map[t].disable()})},St.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]};var It=r(15317),Tt=r.n(It);const At=["mode","feature","mouse"];function Pt(t){let e=null,r=null;const n={onRemove(){return t.map.off("load",n.connect),clearInterval(r),n.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},connect(){t.map.off("load",n.connect),clearInterval(r),n.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd(i){{const t=i.fire;i.fire=function(e,r){let n=arguments;return 1===t.length&&1!==arguments.length&&(n=[Tt()({},{type:e},r)]),t.apply(i,n)}}return t.map=i,t.events=function(t){const e=Object.keys(t.options.modes).reduce((e,r)=>(e[r]=function(t){const e=Object.keys(t);return function(r,n={}){let i={};const o=e.reduce((e,r)=>(e[r]=t[r],e),new bt(r));return{start(){i=o.onSetup(n),Et.forEach(e=>{const r=wt[e];let n=()=>!1;t[r]&&(n=()=>!0),this.on(e,n,function(t){return function(e){o[t](i,e)}}(r))})},stop(){o.onStop(i)},trash(){o.onTrash(i)},combineFeatures(){o.onCombineFeatures(i)},uncombineFeatures(){o.onUncombineFeatures(i)},render(t,e){o.toDisplayFeatures(i,t,e)}}}}(t.options.modes[r]),e),{});let r={},n={};const i={};let o=null,a=null;i.drag=function(e,r){r({point:e.point,time:(new Date).getTime()})?(t.ui.queueMapClasses({mouse:N.DRAG}),a.drag(e)):e.originalEvent.stopPropagation()},i.mousedrag=function(t){i.drag(t,t=>!it(r,t))},i.touchdrag=function(t){i.drag(t,t=>!ot(n,t))},i.mousemove=function(e){if(1===(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which))return i.mousedrag(e);const r=rt(e,t);e.featureTarget=r,a.mousemove(e)},i.mousedown=function(e){r={time:(new Date).getTime(),point:e.point};const n=rt(e,t);e.featureTarget=n,a.mousedown(e)},i.mouseup=function(e){const n=rt(e,t);e.featureTarget=n,it(r,{point:e.point,time:(new Date).getTime()})?a.click(e):a.mouseup(e)},i.mouseout=function(t){a.mouseout(t)},i.touchstart=function(e){if(e.originalEvent.preventDefault(),!t.options.touchEnabled)return;n={time:(new Date).getTime(),point:e.point};const r=tt.touch(e,null,t)[0];e.featureTarget=r,a.touchstart(e)},i.touchmove=function(e){if(e.originalEvent.preventDefault(),t.options.touchEnabled)return a.touchmove(e),i.touchdrag(e)},i.touchend=function(e){if(e.originalEvent.preventDefault(),!t.options.touchEnabled)return;const r=tt.touch(e,null,t)[0];e.featureTarget=r,ot(n,{time:(new Date).getTime(),point:e.point})?a.tap(e):a.touchend(e)};const s=t=>!(8===t||46===t||t>=48&&t<=57);function u(r,n,i={}){a.stop();const s=e[r];if(void 0===s)throw new Error(`${r} is not valid`);o=r;const u=s(t,n);a=A(u,t),i.silent||t.map.fire(F.MODE_CHANGE,{mode:r}),t.store.setDirty(),t.store.render()}i.keydown=function(e){"mapboxgl-canvas"===(e.srcElement||e.target).classList[0]&&(8!==e.keyCode&&46!==e.keyCode||!t.options.controls.trash?s(e.keyCode)?a.keydown(e):49===e.keyCode&&t.options.controls.point?u(R.DRAW_POINT):50===e.keyCode&&t.options.controls.line_string?u(R.DRAW_LINE_STRING):51===e.keyCode&&t.options.controls.polygon&&u(R.DRAW_POLYGON):(e.preventDefault(),a.trash()))},i.keyup=function(t){s(t.keyCode)&&a.keyup(t)},i.zoomend=function(){t.store.changeZoom()},i.data=function(e){if("style"===e.dataType){const{setup:e,map:r,options:n,store:i}=t;n.styles.some(t=>r.getLayer(t.id))||(e.addLayers(),i.setDirty(),i.render())}};const l={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start(){o=t.options.defaultMode,a=A(e[o](t),t)},changeMode:u,actionable:function(e){let r=!1;Object.keys(e).forEach(t=>{if(void 0===l[t])throw new Error("Invalid action type");l[t]!==e[t]&&(r=!0),l[t]=e[t]}),r&&t.map.fire(F.ACTIONABLE,{actions:l})},currentModeName:()=>o,currentModeRender:(t,e)=>a.render(t,e),fire(t,e){i[t]&&i[t](e)},addEventListeners(){t.map.on("mousemove",i.mousemove),t.map.on("mousedown",i.mousedown),t.map.on("mouseup",i.mouseup),t.map.on("data",i.data),t.map.on("touchmove",i.touchmove),t.map.on("touchstart",i.touchstart),t.map.on("touchend",i.touchend),t.container.addEventListener("mouseout",i.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",i.keydown),t.container.addEventListener("keyup",i.keyup))},removeEventListeners(){t.map.off("mousemove",i.mousemove),t.map.off("mousedown",i.mousedown),t.map.off("mouseup",i.mouseup),t.map.off("data",i.data),t.map.off("touchmove",i.touchmove),t.map.off("touchstart",i.touchstart),t.map.off("touchend",i.touchend),t.container.removeEventListener("mouseout",i.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",i.keydown),t.container.removeEventListener("keyup",i.keyup))},trash(t){a.trash(t)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode:()=>o}}(t),t.ui=function(t){const e={};let r=null,n={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null};function o(t){i=Tt()(i,t)}function a(){if(!t.container)return;const e=[],r=[];At.forEach(t=>{i[t]!==n[t]&&(e.push(`${t}-${n[t]}`),null!==i[t]&&r.push(`${t}-${i[t]}`))}),e.length>0&&t.container.classList.remove(...e),r.length>0&&t.container.classList.add(...r),n=Tt()(n,i)}function s(t,e={}){const n=document.createElement("button");return n.className=`${D.CONTROL_BUTTON} ${e.className}`,n.setAttribute("title",e.title),e.container.appendChild(n),n.addEventListener("click",n=>{if(n.preventDefault(),n.stopPropagation(),n.target===r)return u(),void e.onDeactivate();l(t),e.onActivate()},!0),n}function u(){!r||(r.classList.remove(D.ACTIVE_BUTTON),r=null)}function l(t){u();const n=e[t];!n||n&&"trash"!==t&&(n.classList.add(D.ACTIVE_BUTTON),r=n)}return{setActiveButton:l,queueMapClasses:o,updateMapClasses:a,clearMapClasses:function(){o({mode:null,feature:null,mouse:null}),a()},addButtons:function(){const r=t.options.controls,n=document.createElement("div");return n.className=`${D.CONTROL_GROUP} ${D.CONTROL_BASE}`,r&&(r[k.LINE]&&(e[k.LINE]=s(k.LINE,{container:n,className:D.CONTROL_BUTTON_LINE,title:"LineString tool "+(t.options.keybindings?"(l)":""),onActivate:()=>t.events.changeMode(R.DRAW_LINE_STRING),onDeactivate:()=>t.events.trash()})),r[k.POLYGON]&&(e[k.POLYGON]=s(k.POLYGON,{container:n,className:D.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(t.options.keybindings?"(p)":""),onActivate:()=>t.events.changeMode(R.DRAW_POLYGON),onDeactivate:()=>t.events.trash()})),r[k.POINT]&&(e[k.POINT]=s(k.POINT,{container:n,className:D.CONTROL_BUTTON_POINT,title:"Marker tool "+(t.options.keybindings?"(m)":""),onActivate:()=>t.events.changeMode(R.DRAW_POINT),onDeactivate:()=>t.events.trash()})),r.trash&&(e.trash=s("trash",{container:n,className:D.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{t.events.trash()}})),r.combine_features&&(e.combine_features=s("combineFeatures",{container:n,className:D.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{t.events.combineFeatures()}})),r.uncombine_features&&(e.uncombine_features=s("uncombineFeatures",{container:n,className:D.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{t.events.uncombineFeatures()}}))),n},removeButtons:function(){Object.keys(e).forEach(t=>{const r=e[t];r.parentNode&&r.parentNode.removeChild(r),delete e[t]})}}}(t),t.container=i.getContainer(),t.store=new St(t),e=t.ui.addButtons(),t.options.boxSelect&&(i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded()?n.connect():(i.on("load",n.connect),r=setInterval(()=>{i.loaded()&&n.connect()},16)),t.events.start(),e},addLayers(){t.map.addSource(O.COLD,{data:{type:z.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(O.HOT,{data:{type:z.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(e=>{t.map.addLayer(e)}),t.store.setDirty(!0),t.store.render()},removeLayers(){t.options.styles.forEach(e=>{t.map.getLayer(e.id)&&t.map.removeLayer(e.id)}),t.map.getSource(O.COLD)&&t.map.removeSource(O.COLD),t.map.getSource(O.HOT)&&t.map.removeSource(O.HOT)}};return t.setup=n,n}var Dt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Ot(t){return function(e){const r=e.featureTarget;return!(!r||!r.properties)&&r.properties.meta===t}}function Nt(t){return!(!t.featureTarget||!t.featureTarget.properties)&&t.featureTarget.properties.active===U.ACTIVE&&t.featureTarget.properties.meta===j.FEATURE}function kt(t){return!(!t.featureTarget||!t.featureTarget.properties)&&t.featureTarget.properties.active===U.INACTIVE&&t.featureTarget.properties.meta===j.FEATURE}function zt(t){return void 0===t.featureTarget}function Rt(t){const e=t.featureTarget;return!(!e||!e.properties)&&e.properties.meta===j.VERTEX}function Ft(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function Bt(t){return 27===t.keyCode}function jt(t){return 13===t.keyCode}var Ut=r(83708),Gt=r.n(Ut),qt=function(t,e){const r=e.getBoundingClientRect();return new(Gt())(t.clientX-r.left-(e.clientLeft||0),t.clientY-r.top-(e.clientTop||0))};function Vt(t,e,r,n){return{type:z.FEATURE,properties:{meta:j.VERTEX,parent:t,coord_path:r,active:n?U.ACTIVE:U.INACTIVE},geometry:{type:z.POINT,coordinates:e}}}var Yt=function t(e,r={},n=null){const{type:i,coordinates:o}=e.geometry,a=e.properties&&e.properties.id;let s=[];function u(t,e){let n="",i=null;t.forEach((t,o)=>{const u=null!=e?`${e}.${o}`:String(o),c=Vt(a,t,u,l(u));if(r.midpoints&&i){const t=function(t,e,r,n){const i=e.geometry.coordinates,o=r.geometry.coordinates;if(i[1]>X||i[1]<V||o[1]>X||o[1]<V)return null;const a=n.project([i[0],i[1]]),s=n.project([o[0],o[1]]),u=n.unproject([(a.x+s.x)/2,(a.y+s.y)/2]);return{type:z.FEATURE,properties:{meta:j.MIDPOINT,parent:t,lng:u.lng,lat:u.lat,coord_path:r.properties.coord_path},geometry:{type:z.POINT,coordinates:[u.lng,u.lat]}}}(a,i,c,r.map);t&&s.push(t)}i=c;const h=JSON.stringify(t);n!==h&&s.push(c),0===o&&(n=h)})}function l(t){return!!r.selectedPaths&&-1!==r.selectedPaths.indexOf(t)}return i===z.POINT?s.push(Vt(a,o,n,l(n))):i===z.POLYGON?o.forEach((t,e)=>{u(t,null!==n?`${n}.${e}`:String(e))}):i===z.LINE_STRING?u(o,n):0===i.indexOf(z.MULTI_PREFIX)&&function(){const n=i.replace(z.MULTI_PREFIX,"");o.forEach((i,o)=>{s=s.concat(t({type:z.FEATURE,properties:e.properties,geometry:{type:n,coordinates:i}},r,o))})}(),s},Xt={enable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||!t._ctx.store.getInitialConfigValue("doubleClickZoom")||t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}},Zt=r(47279),Ht=r.n(Zt);const{LAT_MIN:Wt,LAT_MAX:Jt,LAT_RENDERED_MIN:Qt,LAT_RENDERED_MAX:Kt,LNG_MIN:$t,LNG_MAX:te}=n;function ee(t,e){let r=Wt,n=Jt,i=Wt,o=Jt,a=te,s=$t;t.forEach(t=>{const e=Ht()(t),u=e[1],l=e[3],c=e[0],h=e[2];u>r&&(r=u),l<n&&(n=l),l>i&&(i=l),u<o&&(o=u),c<a&&(a=c),h>s&&(s=h)});const u=e;return r+u.lat>Kt&&(u.lat=Kt-r),i+u.lat>Jt&&(u.lat=Jt-i),n+u.lat<Qt&&(u.lat=Qt-n),o+u.lat<Wt&&(u.lat=Wt-o),a+u.lng<=$t&&(u.lng+=360*Math.ceil(Math.abs(u.lng)/360)),s+u.lng>=te&&(u.lng-=360*Math.ceil(Math.abs(u.lng)/360)),u}function re(t,e){const r=ee(t.map(t=>t.toGeoJSON()),e);t.forEach(t=>{const e=t.getCoordinates(),n=t=>{const e={lng:t[0]+r.lng,lat:t[1]+r.lat};return[e.lng,e.lat]},i=t=>t.map(t=>n(t));let o;t.type===z.POINT?o=n(e):t.type===z.LINE_STRING||t.type===z.MULTI_POINT?o=e.map(n):t.type===z.POLYGON||t.type===z.MULTI_LINE_STRING?o=e.map(i):t.type===z.MULTI_POLYGON&&(o=e.map(t=>t.map(t=>i(t)))),t.incomingCoords(o)})}const ne={onSetup:function(t){const e={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(e.initiallySelectedFeatureIds.filter(t=>void 0!==this.getFeature(t))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),e},fireUpdate:function(){this.map.fire(F.UPDATE,{action:B.MOVE,features:this.getSelected().map(t=>t.toGeoJSON())})},fireActionable:function(){const t=this.getSelected(),e=t.filter(t=>this.isInstanceOf("MultiFeature",t));let r=!1;if(t.length>1){r=!0;const e=t[0].type.replace("Multi","");t.forEach(t=>{t.type.replace("Multi","")!==e&&(r=!1)})}this.setActionableState({combineFeatures:r,uncombineFeatures:e.length>0,trash:t.length>0})},getUniqueIds:function(t){return t.length?t.map(t=>t.properties.id).filter(t=>void 0!==t).reduce((t,e)=>(t.add(e),t),new K).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){Xt.enable(this)},onMouseMove:function(t){return this.stopExtendedInteractions(t)},onMouseOut:function(t){if(t.dragMoving)return this.fireUpdate()}};ne.onTap=ne.onClick=function(t,e){return zt(e)?this.clickAnywhere(t,e):Ot(j.VERTEX)(e)?this.clickOnVertex(t,e):function(t){return!(!t.featureTarget||!t.featureTarget.properties)&&t.featureTarget.properties.meta===j.FEATURE}(e)?this.clickOnFeature(t,e):void 0},ne.clickAnywhere=function(t){const e=this.getSelectedIds();e.length&&(this.clearSelectedFeatures(),e.forEach(t=>this.doRender(t))),Xt.enable(this),this.stopExtendedInteractions(t)},ne.clickOnVertex=function(t,e){this.changeMode(R.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:N.MOVE})},ne.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},ne.clickOnFeature=function(t,e){Xt.disable(this),this.stopExtendedInteractions(t);const r=Ft(e),n=this.getSelectedIds(),i=e.featureTarget.properties.id,o=this.isSelected(i);if(!r&&o&&this.getFeature(i).type!==z.POINT)return this.changeMode(R.DIRECT_SELECT,{featureId:i});o&&r?(this.deselect(i),this.updateUIClasses({mouse:N.POINTER}),1===n.length&&Xt.enable(this)):!o&&r?(this.select(i),this.updateUIClasses({mouse:N.MOVE})):!o&&!r&&(n.forEach(t=>this.doRender(t)),this.setSelected(i),this.updateUIClasses({mouse:N.MOVE})),this.doRender(i)},ne.onMouseDown=function(t,e){return Nt(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&function(t){return!(!t.originalEvent||!t.originalEvent.shiftKey)&&0===t.originalEvent.button}(e)?this.startBoxSelect(t,e):void 0},ne.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=qt(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},ne.onTouchStart=function(t,e){if(Nt(e))return this.startOnActiveFeature(t,e)},ne.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},ne.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:N.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(D.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));const r=qt(e.originalEvent,this.map.getContainer()),n=Math.min(t.boxSelectStartLocation.x,r.x),i=Math.max(t.boxSelectStartLocation.x,r.x),o=Math.min(t.boxSelectStartLocation.y,r.y),a=Math.max(t.boxSelectStartLocation.y,r.y),s=`translate(${n}px, ${o}px)`;t.boxSelectElement.style.transform=s,t.boxSelectElement.style.WebkitTransform=s,t.boxSelectElement.style.width=i-n+"px",t.boxSelectElement.style.height=a-o+"px"},ne.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();const r={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};re(this.getSelected(),r),t.dragMoveLocation=e.lngLat},ne.onMouseUp=function(t,e){if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){const r=[t.boxSelectStartLocation,qt(e.originalEvent,this.map.getContainer())],n=this.featuresAt(null,r,"click"),i=this.getUniqueIds(n).filter(t=>!this.isSelected(t));i.length&&(this.select(i),i.forEach(t=>this.doRender(t)),this.updateUIClasses({mouse:N.MOVE}))}this.stopExtendedInteractions(t)},ne.toDisplayFeatures=function(t,e,r){e.properties.active=this.isSelected(e.properties.id)?U.ACTIVE:U.INACTIVE,r(e),this.fireActionable(),e.properties.active===U.ACTIVE&&e.geometry.type!==z.POINT&&Yt(e).forEach(r)},ne.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},ne.onCombineFeatures=function(){const t=this.getSelected();if(0===t.length||t.length<2)return;const e=[],r=[],n=t[0].type.replace("Multi","");for(let i=0;i<t.length;i++){const o=t[i];if(o.type.replace("Multi","")!==n)return;o.type.includes("Multi")?o.getCoordinates().forEach(t=>{e.push(t)}):e.push(o.getCoordinates()),r.push(o.toGeoJSON())}if(r.length>1){const t=this.newFeature({type:z.FEATURE,properties:r[0].properties,geometry:{type:`Multi${n}`,coordinates:e}});this.addFeature(t),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([t.id]),this.map.fire(F.COMBINE_FEATURES,{createdFeatures:[t.toGeoJSON()],deletedFeatures:r})}this.fireActionable()},ne.onUncombineFeatures=function(){const t=this.getSelected();if(0===t.length)return;const e=[],r=[];for(let n=0;n<t.length;n++){const i=t[n];this.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach(t=>{this.addFeature(t),t.properties=i.properties,e.push(t.toGeoJSON()),this.select([t.id])}),this.deleteFeature(i.id,{silent:!0}),r.push(i.toGeoJSON()))}e.length>1&&this.map.fire(F.UNCOMBINE_FEATURES,{createdFeatures:e,deletedFeatures:r}),this.fireActionable()};var ie=ne;const oe=Ot(j.VERTEX),ae=Ot(j.MIDPOINT),se={fireUpdate:function(){this.map.fire(F.UPDATE,{action:B.CHANGE_COORDINATES,features:this.getSelected().map(t=>t.toGeoJSON())})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);const r=e.featureTarget.properties,n=t.selectedCoordPaths.indexOf(r.coord_path);Ft(e)||-1!==n?Ft(e)&&-1===n&&t.selectedCoordPaths.push(r.coord_path):t.selectedCoordPaths=[r.coord_path];const i=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(i)},onMidpoint:function(t,e){this.startDragging(t,e);const r=e.featureTarget.properties;t.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),t.selectedCoordPaths=[r.coord_path]},pathsToCoordinates:function(t,e){return e.map(e=>({feature_id:t,coord_path:e}))},onFeature:function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,r){re(this.getSelected(),r),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,r){const n=t.selectedCoordPaths.map(e=>t.feature.getCoordinate(e)),i=ee(n.map(t=>({type:z.FEATURE,properties:{},geometry:{type:z.POINT,coordinates:t}})),r);for(let o=0;o<n.length;o++){const e=n[o];t.feature.updateCoordinate(t.selectedCoordPaths[o],e[0]+i.lng,e[1]+i.lat)}},clickNoTarget:function(){this.changeMode(R.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(R.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){const e=t.featureId,r=this.getFeature(e);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===z.POINT)throw new TypeError("direct_select mode doesn't handle point features");const n={featureId:e,feature:r,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,n.selectedCoordPaths)),this.setSelected(e),Xt.disable(this),this.setActionableState({trash:!0}),n},onStop:function(){Xt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,r){t.featureId===e.properties.id?(e.properties.active=U.ACTIVE,r(e),Yt(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(r)):(e.properties.active=U.INACTIVE,r(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort((t,e)=>e.localeCompare(t,"en",{numeric:!0})).forEach(e=>t.feature.removeCoordinate(e)),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(R.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){const r=Nt(e),n=oe(e),i=0===t.selectedCoordPaths.length;this.updateUIClasses(r&&i||n&&!i?{mouse:N.MOVE}:{mouse:N.NONE}),this.stopDragging(t)},onMouseOut:function(t){t.dragMoving&&this.fireUpdate()}};se.onTouchStart=se.onMouseDown=function(t,e){return oe(e)?this.onVertex(t,e):Nt(e)?this.onFeature(t,e):ae(e)?this.onMidpoint(t,e):void 0},se.onDrag=function(t,e){if(!0!==t.canDragMove)return;t.dragMoving=!0,e.originalEvent.stopPropagation();const r={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,r):this.dragFeature(t,e,r),t.dragMoveLocation=e.lngLat},se.onClick=function(t,e){return zt(e)?this.clickNoTarget(t,e):Nt(e)?this.clickActiveFeature(t,e):kt(e)?this.clickInactive(t,e):void this.stopDragging(t)},se.onTap=function(t,e){return zt(e)?this.clickNoTarget(t,e):Nt(e)?this.clickActiveFeature(t,e):kt(e)?this.clickInactive(t,e):void 0},se.onTouchEnd=se.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var ue=se;const le={onSetup:function(){const t=this.newFeature({type:z.FEATURE,properties:{},geometry:{type:z.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:N.ADD}),this.activateUIButton(k.POINT),this.setActionableState({trash:!0}),{point:t}},stopDrawingAndRemove:function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(R.SIMPLE_SELECT)}};le.onTap=le.onClick=function(t,e){this.updateUIClasses({mouse:N.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(F.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(R.SIMPLE_SELECT,{featureIds:[t.point.id]})},le.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},le.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.point.id;if(e.properties.active=n?U.ACTIVE:U.INACTIVE,!n)return r(e)},le.onTrash=le.stopDrawingAndRemove,le.onKeyUp=function(t,e){if(Bt(e)||jt(e))return this.stopDrawingAndRemove(t,e)};var ce=le,he=function(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]};const pe={onSetup:function(){const t=this.newFeature({type:z.FEATURE,properties:{},geometry:{type:z.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),Xt.disable(this),this.updateUIClasses({mouse:N.ADD}),this.activateUIButton(k.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&he(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(R.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:N.ADD}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(R.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),Rt(e)&&this.updateUIClasses({mouse:N.POINTER})}};pe.onTap=pe.onClick=function(t,e){return Rt(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},pe.onKeyUp=function(t,e){Bt(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(R.SIMPLE_SELECT)):jt(e)&&this.changeMode(R.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},pe.onStop=function(t){this.updateUIClasses({mouse:N.NONE}),Xt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.map.fire(F.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(R.SIMPLE_SELECT,{},{silent:!0})))},pe.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.polygon.id;if(e.properties.active=n?U.ACTIVE:U.INACTIVE,!n)return r(e);if(0===e.geometry.coordinates.length)return;const i=e.geometry.coordinates[0].length;if(!(i<3)){if(e.properties.meta=j.FEATURE,r(Vt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),i>3){const n=e.geometry.coordinates[0].length-3;r(Vt(t.polygon.id,e.geometry.coordinates[0][n],`0.${n}`,!1))}if(i<=4&&(r({type:z.FEATURE,properties:e.properties,geometry:{coordinates:[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]],type:z.LINE_STRING}}),3===i))return;return r(e)}},pe.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(R.SIMPLE_SELECT)};var fe=pe;const de={onSetup:function(t){const e=(t=t||{}).featureId;let r,n,i="forward";if(e){if(r=this.getFeature(e),!r)throw new Error("Could not find a feature with the provided featureId");let o=t.from;if(o&&"Feature"===o.type&&o.geometry&&"Point"===o.geometry.type&&(o=o.geometry),o&&"Point"===o.type&&o.coordinates&&2===o.coordinates.length&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===o[0]&&r.coordinates[a][1]===o[1])n=a+1,r.addCoordinate(n,...r.coordinates[a]);else{if(r.coordinates[0][0]!==o[0]||r.coordinates[0][1]!==o[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");i="backwards",n=0,r.addCoordinate(n,...r.coordinates[0])}}else r=this.newFeature({type:z.FEATURE,properties:{},geometry:{type:z.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),Xt.disable(this),this.updateUIClasses({mouse:N.ADD}),this.activateUIButton(k.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:i}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&he(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&he(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(R.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:N.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(R.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Rt(e)&&this.updateUIClasses({mouse:N.POINTER})}};de.onTap=de.onClick=function(t,e){if(Rt(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},de.onKeyUp=function(t,e){jt(e)?this.changeMode(R.SIMPLE_SELECT,{featureIds:[t.line.id]}):Bt(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(R.SIMPLE_SELECT))},de.onStop=function(t){Xt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.map.fire(F.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(R.SIMPLE_SELECT,{},{silent:!0})))},de.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(R.SIMPLE_SELECT)},de.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.line.id;if(e.properties.active=n?U.ACTIVE:U.INACTIVE,!n)return r(e);e.geometry.coordinates.length<2||(e.properties.meta=j.FEATURE,r(Vt(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),r(e))};var ge={simple_select:ie,direct_select:ue,draw_point:ce,draw_polygon:fe,draw_line_string:de};const me={defaultMode:R.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Dt,modes:ge,controls:{},userProperties:!1},ye={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ve={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function _e(t,e){return t.map(t=>t.source?t:Tt()(t,{id:`${t.id}.${e}`,source:"hot"===e?O.HOT:O.COLD}))}var xe=r(44128),be=r.n(xe),we=r(89239),Ee=r.n(we),Me=r(11764);const Ce={Polygon:gt,LineString:ft,Point:ht,MultiPolygon:_t,MultiLineString:_t,MultiPoint:_t};const Se=function(t,e){const r={options:t=function(t={}){let e=Tt()(t);return t.controls||(e.controls={}),e.controls=!1===t.displayControlsDefault?Tt()(ve,t.controls):Tt()(ye,t.controls),e=Tt()(me,e),e.styles=_e(e.styles,"cold").concat(_e(e.styles,"hot")),e}(t)};e=function(t,e){return e.modes=R,e.getFeatureIdsAt=function(e){return tt.click({point:e},null,t).map(t=>t.properties.id)},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:z.FEATURE_COLLECTION,features:t.store.getSelectedIds().map(e=>t.store.get(e)).map(t=>t.toGeoJSON())}},e.getSelectedPoints=function(){return{type:z.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map(t=>({type:z.FEATURE,properties:{},geometry:{type:z.POINT,coordinates:t.coordinates}}))}},e.set=function(r){if(void 0===r.type||r.type!==z.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");const n=t.store.createRenderBatch();let i=t.store.getAllIds().slice();const o=e.add(r),a=new K(o);return i=i.filter(t=>!a.has(t)),i.length&&e.delete(i),n(),o},e.add=function(e){if(!Me.valid(e))throw new Error("Invalid GeoJSON: "+e.toString());const r=JSON.parse(JSON.stringify(Ee()(e))).features.map(e=>{if(e.id=e.id||st()(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===t.store.get(e.id)||t.store.get(e.id).type!==e.geometry.type){const r=Ce[e.geometry.type];if(void 0===r)throw new Error(`Invalid geometry type: ${e.geometry.type}.`);const n=new r(t,e);t.store.add(n)}else{const r=t.store.get(e.id);r.properties=e.properties,be()(r.getCoordinates(),e.geometry.coordinates)||r.incomingCoords(e.geometry.coordinates)}return e.id});return t.store.render(),r},e.get=function(e){const r=t.store.get(e);if(r)return r.toGeoJSON()},e.getAll=function(){return{type:z.FEATURE_COLLECTION,features:t.store.getAll().map(t=>t.toGeoJSON())}},e.delete=function(r){return t.store.delete(r,{silent:!0}),e.getMode()!==R.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(R.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===R.DIRECT_SELECT?t.events.changeMode(R.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(r,n={}){return r===R.SIMPLE_SELECT&&e.getMode()===R.SIMPLE_SELECT?(function(t,e){return t.length===e.length&&JSON.stringify(t.map(t=>t).sort())===JSON.stringify(e.map(t=>t).sort())}(n.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(n.featureIds,{silent:!0}),t.store.render()),e):(r===R.DIRECT_SELECT&&e.getMode()===R.DIRECT_SELECT&&n.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(r,n,{silent:!0}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(r,n,i){return t.store.setFeatureProperty(r,n,i),e},e}(r,e),r.api=e;const n=Pt(r);return e.onAdd=n.onAdd,e.onRemove=n.onRemove,e.types=k,e.options=t,e};function Le(t){Se(t,this)}Le.modes=ge;var Ie=Le,Te=r(54364),Ae=r(53448),Pe=r(53882),De=r(49476),Oe=r(38240),Ne=r(17241),ke=r(22235),ze=r(78136),Re=r.n(ze),Fe=r(71570);function Be(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",2),s.NdJ("click",function(){return s.CHM(t),s.oxw().toggle()}),s.qZA()}}function je(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"input",10),s.NdJ("ngModelChange",function(e){s.CHM(t);const r=s.oxw().$implicit;return s.oxw(2).onLayerParamChange(e,r)}),s.qZA()}if(2&t){const t=s.oxw().$implicit,e=s.oxw(2);s.Q6J("ngModel",t.extraParam),s.uIk("type",e.getParamType(t))}}function Ue(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"li"),s.TgZ(1,"input",7),s.NdJ("ngModelChange",function(){const e=s.CHM(t).$implicit;return s.oxw(2).onLayerChange(e)}),s.qZA(),s.TgZ(2,"label",8),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.YNc(5,je,1,2,"input",9),s.qZA()}if(2&t){const t=e.$implicit,r=s.oxw(2);s.xp6(1),s.s9C("id",t.id),s.Q6J("ngModel",t.isVisible),s.xp6(1),s.s9C("for",t.id),s.xp6(1),s.Oqu(s.lcZ(4,5,t.title)),s.xp6(2),s.Q6J("ngIf",r.hasExtraInput(t))}}function Ge(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"li",12),s.NdJ("click",function(){const e=s.CHM(t).$implicit;return s.oxw(3).onStyleChange(e)}),s.TgZ(1,"input",13),s.NdJ("ngModelChange",function(e){return s.CHM(t),s.oxw(3).selectedStyleId=e}),s.qZA(),s.TgZ(2,"label",14),s._uU(3),s.ALo(4,"translate"),s.qZA(),s.qZA()}if(2&t){const t=e.$implicit,r=s.oxw(3);s.xp6(1),s.s9C("id",t.id),s.Q6J("ngModel",r.selectedStyleId)("value",t.id),s.xp6(1),s.s9C("for",t.id),s.xp6(1),s.Oqu(s.lcZ(4,5,t.title))}}function qe(t,e){if(1&t&&(s.TgZ(0,"ul",4),s.YNc(1,Ge,5,7,"li",11),s.qZA()),2&t){const t=s.oxw(2);s.xp6(1),s.Q6J("ngForOf",t.styles)("ngForTrackBy",t.trackByStyle)}}function Ve(t,e){if(1&t&&(s.TgZ(0,"div",3),s.TgZ(1,"ul",4),s.YNc(2,Ue,6,7,"li",5),s.qZA(),s.YNc(3,qe,2,2,"ul",6),s.qZA()),2&t){const t=s.oxw();s.xp6(2),s.Q6J("ngForOf",t.layersToShow)("ngForTrackBy",t.trackByLayer),s.xp6(1),s.Q6J("ngIf",(null==t.styles?null:t.styles.length)>1&&t.showStylesToggler)}}const Ye=["map"],Xe=["mapLayersEl"];function Ze(t,e){if(1&t&&(s.TgZ(0,"div",12),s.TgZ(1,"div",13),s._uU(2),s.qZA(),s._UZ(3,"div",14),s.qZA()),2&t){const t=s.oxw();s.xp6(2),s.Oqu(t.mapError)}}function He(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"map-layers",15),s.NdJ("layerChange",function(e){return s.CHM(t),s.oxw().onLayerChange(e)})("layerParamChange",function(e){return s.CHM(t),s.oxw().onLayerParamChange(e)})("styleChange",function(e){return s.CHM(t),s.oxw().onStyleChange(e)}),s.ALo(1,"translate"),s.qZA()}if(2&t){const t=s.oxw();s.Q6J("layers",t.mapLayers)("mapStyle",t.mapStyle)("styles",t.mapStyles)("showStylesToggler",t.showStylesToggler),s.uIk("title",s.lcZ(1,5,"moovit_map_layers_tooltip"))}}function We(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"map-distance",16),s.NdJ("toggleButton",function(e){return s.CHM(t),s.oxw().onDistanceButtonToggle(e)}),s.qZA()}if(2&t){const t=s.oxw();s.Q6J("map",t.getMap())("shouldUseUnitType",t.shouldUseUnitType)}}function Je(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"map-search",17),s.NdJ("searchCleared",function(){return s.CHM(t),s.oxw().onSearchCleared()})("searchResultSelected",function(e){return s.CHM(t),s.oxw().onSearchResultSelected(e)}),s.qZA()}if(2&t){const t=s.oxw();s.Q6J("metroId",t.searchConfig.metroId)("langId",t.searchConfig.langId)("mapCenter",t.mapCenter)("externalSearchFunction",t.searchConfig.externalSearchFunction)}}function Qe(t,e){if(1&t&&(s._UZ(0,"map-streetview-control",18),s.ALo(1,"translate")),2&t){const t=s.oxw();s.Q6J("mapService",t.mapService)("tooltip",s.lcZ(1,2,"moovit_map_streeview_tooltip"))}}function Ke(t,e){1&t&&(s.ynx(0),s._uU(1,"\xa9"),s.BQk())}function $e(t,e){if(1&t&&(s.TgZ(0,"a",24),s._uU(1),s.qZA()),2&t){const t=s.oxw().$implicit;s.s9C("href",t.link,s.LSH),s.xp6(1),s.Oqu(t.text)}}function tr(t,e){if(1&t&&(s.ynx(0),s._uU(1),s.BQk()),2&t){const t=s.oxw().$implicit;s.xp6(1),s.Oqu(t.text)}}function er(t,e){if(1&t&&(s.TgZ(0,"div",21),s.YNc(1,Ke,2,0,"ng-container",22),s.YNc(2,$e,2,2,"a",23),s.YNc(3,tr,2,1,"ng-container",22),s.qZA()),2&t){const t=e.$implicit;s.xp6(1),s.Q6J("ngIf",t.hasCopyright),s.xp6(1),s.Q6J("ngIf",t.link),s.xp6(1),s.Q6J("ngIf",!t.link)}}function rr(t,e){if(1&t&&(s.TgZ(0,"div",19),s.YNc(1,er,4,3,"div",20),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Q6J("ngForOf",t.attributionConfig.credits)("ngForTrackBy",t.trackByCredits)}}function nr(t,e){if(1&t&&s._UZ(0,"moovit-map-marker",25),2&t){const t=s.oxw();s.Q6J("id",t.searchResultMarker.id)("layer",t.searchResultMarker.layer)("latlng",t.searchResultMarker.latlng)("outerCssClass",t.searchResultMarker.outerCssClass)("cssClass",t.searchResultMarker.cssClass)}}function ir(t,e){if(1&t&&(s.TgZ(0,"moovit-map-popup",26),s._uU(1),s.qZA()),2&t){const t=e.$implicit;s.Q6J("entity",t)("className","polygon-label")("closeButton",!1)("anchor","center"),s.xp6(1),s.hij(" ",t.label,"\n")}}function or(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"moovit-map-context-menu",27),s.NdJ("shouldClose",function(){return s.CHM(t),s.oxw().closeContextMenu()}),s.qZA()}if(2&t){const t=s.oxw();s.Q6J("latLng",t.contextMenuLocation)("zoom",t.currentZoomLevelRounded)}}const ar=["content"],sr=["*"];function ur(t,e){1&t&&s.GkF(0)}const lr=function(t){return{$implicit:t}};function cr(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"moovit-map-marker",1),s.NdJ("markerClick",function(e){return s.CHM(t),s.oxw().markerClick.emit(e)})("markerRightClick",function(e){return s.CHM(t),s.oxw().markerRightClick.emit(e)})("markerDoubleClick",function(e){return s.CHM(t),s.oxw().markerDoubleClick.emit(e)})("markerMouseEnter",function(e){return s.CHM(t),s.oxw().markerMouseEnter.emit(e)})("markerMouseLeave",function(e){return s.CHM(t),s.oxw().markerMouseLeave.emit(e)})("markerDrag",function(e){return s.CHM(t),s.oxw().markerDrag.emit(e)})("markerDragStart",function(e){return s.CHM(t),s.oxw().markerDragStart.emit(e)})("markerDragEnd",function(e){return s.CHM(t),s.oxw().markerDragEnd.emit(e)}),s.YNc(1,ur,1,0,"ng-container",2),s.qZA()}if(2&t){const t=e.$implicit,r=s.oxw();s.Q6J("id",t.id)("latlng",t.latlng)("layer",t.layer)("outerCssClass",t.outerCssClass)("cssClass",t.cssClass)("alignPitchToMap",t.alignPitchToMap)("alignRotationToMap",t.alignRotationToMap)("isHidden",t.isHidden)("zIndexOffset",t.zIndexOffset)("opacity",t.opacity)("tooltip",t.tooltip)("isInteractive",t.isInteractive)("rotationAngle",t.rotationAngle)("preventClickThrough",t.preventClickThrough)("isDraggable",t.isDraggable),s.xp6(1),s.Q6J("ngTemplateOutlet",r.markerTemplate)("ngTemplateOutletContext",s.VKq(17,lr,t))}}function hr(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",7),s.NdJ("click",function(e){return s.CHM(t),s.oxw().deactivate(e)}),s._uU(1,"\xd7"),s.qZA()}}function pr(t,e){1&t&&(s.TgZ(0,"div",8),s._UZ(1,"div",9),s._UZ(2,"div",10),s._UZ(3,"div",11),s._UZ(4,"div",12),s._UZ(5,"div",13),s._UZ(6,"div",14),s._UZ(7,"div",15),s._UZ(8,"div",16),s._UZ(9,"div",17),s._UZ(10,"div",18),s._UZ(11,"div",19),s._UZ(12,"div",20),s.qZA())}function fr(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"li"),s.TgZ(1,"a",23),s.NdJ("click",function(){const e=s.CHM(t).$implicit;return s.oxw(2).selectResult(e)}),s._UZ(2,"span",24),s.TgZ(3,"span",25),s._uU(4),s.qZA(),s.qZA(),s.qZA()}if(2&t){const t=e.$implicit,r=s.oxw(2);s.xp6(1),s.ekj("last-external",r.isLastResult(t)),s.xp6(1),s.Q6J("innerHTML",r.highlight(t.title),s.oJD),s.xp6(2),s.Oqu(r.getItemSubtitle(t))}}function dr(t,e){if(1&t&&(s.TgZ(0,"ul",21),s.YNc(1,fr,5,4,"li",22),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Q6J("ngForOf",t.results)("ngForTrackBy",t.trackByResults)}}function gr(t,e){1&t&&(s.TgZ(0,"div",26),s._uU(1),s.ALo(2,"translate"),s.qZA()),2&t&&(s.xp6(1),s.hij(" ",s.lcZ(2,1,"moovit_map_search_not_found")," "))}function mr(t,e){if(1&t&&(s.TgZ(0,"div",3),s._uU(1),s.qZA()),2&t){const t=s.oxw();s.xp6(1),s.Oqu(t.distanceLabel)}}function yr(t){return t?"string"==typeof t?t:t.filter(t=>""!==t.trim()).join(" "):""}var vr=(()=>{return(t=vr||(vr={})).MARKER="MARKER",t.POINT="POINT",t.POLYLINE="POLYLINE",t.POLYLINE_STOP="POLYLINE-STOP",t.POLYGON="POLYGON",t.POLYGON_OUTLINE="POLYGON_OUTLINE",vr;var t})(),_r=(()=>{return(t=_r||(_r={})).KM="km",t.MI="mi",t.FT="ft",_r;var t})();let xr=(()=>{class t{}return t.BlackAndWhite={id:"black-and-white",title:"Street Light",tileServer:"mapbox://styles/hadas/ckc4ql7tn0ykr1ioe1v4oinzs"},t.Colorful={id:"colorful",title:"Street Colors",tileServer:"mapbox://styles/hadas/cjxd54nln0o031cqpp3aerz0j"},t.Satellite={id:"satellite",title:"Street Satellite",tileServer:"mapbox://styles/hadas/cjxd59qto0ktw1cpx6dvh1427"},t})();var br=(()=>{return(t=br||(br={}))[t.NONE=0]="NONE",t[t.SMALL=1]="SMALL",t[t.MEDIUM=2]="MEDIUM",t[t.LARGE=3]="LARGE",br;var t})(),wr=(()=>{return(t=wr||(wr={})).POINT="is-point",t.POLYLINE="is-polyline",t.POLYLINE_STOP="is-line-stop",t.POLYLINE_ARROW="is-arrow",t.POLYLINE_ARROW_CIRCLE="is-arrow-circle",t.POLYGON="is-polygon",wr;var t})();const Er=[{eventName:"dragstart",configEventName:"markerDragStart",isMapboxEvent:!0},{eventName:"dragend",configEventName:"markerDragEnd",isMapboxEvent:!0},{eventName:"drag",configEventName:"markerDragEnd",isMapboxEvent:!0},{eventName:"click",configEventName:"markerClick",isClickEvent:!0},{eventName:"dblclick",configEventName:"markerDoubleClick",isClickEvent:!0},{eventName:"contextmenu",configEventName:"markerRightClick"},{eventName:"mouseover",configEventName:"markerMouseEnter"},{eventName:"mouseout",configEventName:"markerMouseLeave"}];function Mr(t){return{originalEvent:t,latlng:t.lngLat}}function Cr(t,e){return{isManual:!!t.originalEvent,originalEvent:t,zoomLevel:e.getZoom()}}function Sr(t,e){return{isManual:!!t.originalEvent,originalEvent:t,center:e.getCenter()}}function Lr(t,e){return{originalEvent:t,point:e,latlng:t.lngLat}}function Ir(t,e){return{originalEvent:t,polyline:e,latlng:t.lngLat}}function Tr(t,e,r){return{originalEvent:t,polyline:e,index:r,latlng:t.lngLat}}function Ar(t,e){return{originalEvent:t,polygon:e,latlng:t.lngLat}}const Pr={id:"*",title:"default",isVisible:!0,hideToggle:!0},Dr="add-3d-buildings",Or="search-results",Nr="search-result";function kr(t){return new Promise(e=>setTimeout(e,t))}function zr(t,e,r){console.warn(`[moovit-vector-map]: ${t}: ${e} is deprecated, please use ${r} instead.`)}function Rr(t,e,r){let n=129600,i=t,o=0,a=0;const s=e.length;for(o=a;o<s-1;o++){const s=Ur(t,e[o],e[o+1],r);s.dist<n&&(i=s.point,n=s.dist,a=o)}return i}function Fr(t){return t*t}function Br(t,e,r){return Fr((t.lng-e.lng)*r)+Fr(t.lat-e.lat)}function jr(t){return void 0!==t.lat}function Ur(t,e,r,n){const i=jr(e)?e:qr(e),o=jr(r)?r:qr(r),a=Br(i,o,n);if(0==a)return{dist:Br(t,i,n),point:i};let s=((t.lng-i.lng)*n*(o.lng-i.lng)*n+(t.lat-i.lat)*(o.lat-i.lat))/a;s=Math.max(0,Math.min(1,s));const u={lat:i.lat+s*(o.lat-i.lat),lng:i.lng+s*(o.lng-i.lng)};return{dist:Br(t,u,n),point:u}}function Gr(t){let e=S().decode(t).map();return e=e.filter(t=>t[0]&&t[1]),e}function qr(t){return{lng:t[0],lat:t[1]}}function Vr(t){return[t.lng,t.lat]}function Yr(t){return Array.isArray(t)?{type:"Polygon",coordinates:[t.map(t=>[t.lng,t.lat])]}:t}var Xr=a();function Zr(t,e,r){t.run(()=>{e.emit(r)})}function Hr(t,e=5){return[[t.x-e,t.y-e],[t.x+e,t.y+e]]}function Wr(t){const e=t.geometry;switch(e.type){case"Point":return[e.coordinates];case"MultiPoint":case"LineString":return e.coordinates;case"Polygon":return Jr(e.coordinates);case"MultiPolygon":return e.coordinates.reduce((t,e)=>[...t,...Jr(e)],[])}}function Jr(t){return t.reduce((t,e)=>[...t,...e],[])}function Qr(t,e=""){return{id:e,shape:t.geometry.coordinates.map(qr)}}function Kr(t,e="",r=""){return{id:e,title:r,shape:t.geometry}}function $r(t){const e=function(t){var e;if("string"==typeof t)return Gr(t);if(Array.isArray(t)&&(null===(e=t[0])||void 0===e?void 0:e.lat))return t.map(t=>[t.lng,t.lat]);if(Array.isArray(t)){const e=[];return t.forEach(t=>{const r=Gr(t);r&&e.push(...r)}),e}return t.coordinates[0]}(t);return Array.isArray(e[0][0][0])?e.map(t=>t.map(qr)):e.map(qr)}const tn={[vr.MARKER]:t=>`marker-${t}`,[vr.POINT]:t=>`point-${t}`,[vr.POLYLINE]:t=>`polyline-${t}`,[vr.POLYLINE_STOP]:t=>`polyline-${t}-stop`,[vr.POLYGON]:t=>`polygon-${t}`,[vr.POLYGON_OUTLINE]:t=>`polygon-${t}-outline`};function en(t,e,r){const n=void 0!==r?`-${r}`:"";return`${tn[e]("string"==typeof t?t:t.id)}${n}`}function rn(t,e,r){const n=void 0!==r?`-${r}`:"";return`${tn[e]("string"==typeof t?t:t.id)}${n}`}function nn(t){return{type:"FeatureCollection",features:t}}function on(t){return Array.isArray(t)?{top:t[0],bottom:t[0],left:t[1],right:t[1]}:t}function an(t){return function(t){return Array.isArray(t[0])}(t)?[[t[0][1],t[0][0]],[t[1][1],t[1][0]]]:[[t[0].lng,t[0].lat],[t[1].lng,t[1].lat]]}function sn(t){var e;return t.isExternalRasterTileset?{version:8,sources:{"raster-tiles":{type:"raster",tiles:[t.tileServer],tileSize:null!==(e=t.tileSize)&&void 0!==e?e:256}},layers:[{id:t.id.toString(),type:"raster",source:"raster-tiles",minzoom:0,maxzoom:22}]}:t.tileServer}class un{constructor(t,e,r,n){this.id=t,this.sources=e,this.type=r,this.extra=n}getSources(){return this.sources}getCoordinates(){return this.sources.reduce((t,e)=>{if(!e)return t;const r=Wr(e).map(t=>({lat:t[1],lng:t[0]}));return[...t,...r]},[])}}class ln{constructor(t){this.layerId=t,this.features={[vr.POINT]:{},[vr.POLYLINE]:{},[vr.POLYGON]:{}},this.entities={[vr.MARKER]:{},[vr.POINT]:{},[vr.POLYLINE]:{},[vr.POLYGON]:{}},this.areAllShown=!1,this.areAllHidden=!1,this.allSourcesCache=[],this.allEntitiesCache=[]}hideMarkers(t){this.getFeatures(vr.MARKER,t).forEach(t=>function(t){const e=t.getElement();t.zIndex=t.zIndex||window.getComputedStyle(e).zIndex,e.style.visibility="hidden",e.style.zIndex="-1"}(t)),this.areAllShown=!1}showMarkers(t){this.getFeatures(vr.MARKER,t).forEach(t=>function(t){const e=t.getElement();e.style.visibility="visible",e.style.zIndex=t.zIndex}(t)),this.areAllHidden=!1}removeMarkersNotInList(t){const e=new Set([...t]);this.getFeatures(vr.MARKER).forEach(t=>{const r=t.id;if(!e.has(r)){try{t.remove()}catch(n){console.error(n)}this.removeFeatureReference(r,vr.MARKER)}})}showAll(){this.areAllShown||(this.showMarkers(),this.areAllShown=!0)}hideAll(){this.areAllHidden||(this.hideMarkers(),this.areAllHidden=!0)}setFeatures(t,e){if(t==vr.MARKER){const t=Object.values(e).map(t=>t.id);this.removeMarkersNotInList(t)}this.features[t.toString()]=e,this.invalidateFeaturesCache()}setEntities(t,e){this.entities[t.toString()]=(0,x.Z)(e),this.invalidateEntitiesCache()}setEntity(t,e){this.entities[t.toString()][e.id]=e,this.invalidateEntitiesCache()}removeEntity(t,e){delete this.entities[t.toString()][e],this.invalidateEntitiesCache()}getFeatures(t,e){return e?e.map(e=>this.features[t.toString()][e]):Object.values(this.features[t.toString()])}getEntity(t,e){return this.entities[t][e]}getFeature(t,e){return this.features[t][e]}getAllSources(){if(this.allSourcesCache)return this.allSourcesCache;const t=[vr.POINT,vr.POLYLINE,vr.POLYGON].reduce((t,e)=>(Object.values(this.features[e]).forEach(e=>{t.push(...e.getSources())}),t),[]);return this.allSourcesCache=t,t}getAllEntities(){if(this.allEntitiesCache)return this.allEntitiesCache;const t=Object.keys(this.entities).reduce((t,e)=>(t.push(...Object.values(this.entities[e])),t),[]);return this.allEntitiesCache=t,t}getAllCoordinates(){return[vr.POLYLINE,vr.POLYGON].reduce((t,e)=>(t.push(...this.features[e].getCoordinates()),t),[])}removeFeatureReference(t,e){delete this.features[e][t],this.invalidateFeaturesCache()}invalidateFeaturesCache(){this.allSourcesCache=void 0}invalidateEntitiesCache(){this.allEntitiesCache=void 0}}var cn=o;const hn=new s.OlP("MapboxApiKey"),pn={[vr.POINT]:[wr.POINT],[vr.POLYLINE]:[wr.POLYLINE],[vr.POLYGON]:[wr.POLYGON]},fn=[{outputEventName:"resize",mapboxEventName:"resize"},{outputEventName:"remove",mapboxEventName:"remove"},{outputEventName:"mouseDown",mapboxEventName:"mousedown"},{outputEventName:"mouseUp",mapboxEventName:"mouseup"},{outputEventName:"mouseMove",mapboxEventName:"mousemove"},{outputEventName:"click",mapboxEventName:"click"},{outputEventName:"dblClick",mapboxEventName:"dblclick"},{outputEventName:"mouseOver",mapboxEventName:"mouseover"},{outputEventName:"mouseOut",mapboxEventName:"mouseout"},{outputEventName:"contextMenu",mapboxEventName:"contextmenu"},{outputEventName:"touchStart",mapboxEventName:"touchstart"},{outputEventName:"touchEnd",mapboxEventName:"touchend"},{outputEventName:"touchMove",mapboxEventName:"touchmove"},{outputEventName:"touchCancel",mapboxEventName:"touchcancel"},{outputEventName:"wheel",mapboxEventName:"wheel"},{outputEventName:"moveStart",mapboxEventName:"movestart"},{outputEventName:"move",mapboxEventName:"move"},{outputEventName:"moveEnd",mapboxEventName:"moveend"},{outputEventName:"dragStart",mapboxEventName:"dragstart"},{outputEventName:"drag",mapboxEventName:"drag"},{outputEventName:"dragEnd",mapboxEventName:"dragend"},{outputEventName:"zoomStart",mapboxEventName:"zoomstart"},{outputEventName:"zoomEvt",mapboxEventName:"zoom"},{outputEventName:"zoomEnd",mapboxEventName:"zoomend"},{outputEventName:"rotateStart",mapboxEventName:"rotatestart"},{outputEventName:"rotate",mapboxEventName:"rotate"},{outputEventName:"rotateEnd",mapboxEventName:"rotateend"},{outputEventName:"pitchStart",mapboxEventName:"pitchstart"},{outputEventName:"pitchEvt",mapboxEventName:"pitch"},{outputEventName:"pitchEnd",mapboxEventName:"pitchend"},{outputEventName:"boxZoomStart",mapboxEventName:"boxzoomstart"},{outputEventName:"boxZoomEnd",mapboxEventName:"boxzoomend"},{outputEventName:"boxZoomCancel",mapboxEventName:"boxzoomcancel"},{outputEventName:"webGlContextLost",mapboxEventName:"webglcontextlost"},{outputEventName:"webGlContextRestored",mapboxEventName:"webglcontextrestored"},{outputEventName:"render",mapboxEventName:"render"},{outputEventName:"error",mapboxEventName:"error"},{outputEventName:"data",mapboxEventName:"data"},{outputEventName:"styleData",mapboxEventName:"styledata"},{outputEventName:"styleLoad",mapboxEventName:"style.load"},{outputEventName:"sourceData",mapboxEventName:"sourcedata"},{outputEventName:"dataLoading",mapboxEventName:"dataloading"},{outputEventName:"styleDataLoading",mapboxEventName:"styledataloading"},{outputEventName:"sourceDataLoading",mapboxEventName:"sourcedataloading"},{outputEventName:"styleImageMissing",mapboxEventName:"styleimagemissing"},{outputEventName:"idle",mapboxEventName:"idle"}];let dn=(()=>{class t{constructor(t,e){this.zone=t,this.mapboxAPIKey=e,this.mapLayerDataChanged$=new l.x,this.mapCreated=new c,this.mapLoaded=new c,this.mapDataInitialized=new c,this.imageIdsToRemove=[],this.layerContentsPerLayer={},this.subscription=new h.w0,this.isIdle=!1,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable(),this.mapDataInitialized$=this.mapDataInitialized.asObservable()}setup(t){return this.zone.onStable.pipe((0,_.P)()).subscribe(()=>this._setup(t)),this.mapLoaded$}_setup(t){var e;t.customMapboxApiUrl&&this.assign(o,"config.API_URL",t.customMapboxApiUrl);try{this.createMap(t.mapOptions)}catch(r){const t=null!==(e=r.message)&&void 0!==e?e:r;return this.mapCreated.error(t),void this.mapLoaded.error(t)}this.hookEvents(t.mapEvents),this.mapEvents=t.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete()}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateMinZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(t)})}updateMaxZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(t)})}updateMinPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(t)})}updateMaxPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(t)})}updateRenderWorldCopies(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(t)})}updateScrollZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateDoubleClickZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(t){return this.zone.runOutsideAngular(()=>this.smartUpdateStyle(t))}smartUpdateStyle(t){var e;return(0,i.mG)(this,void 0,void 0,function*(){yield this.waitForMapLoad();const r=this.mapInstance.getStyle();let n;"string"==typeof t?(t=t.replace("mapbox://styles/",""),n=yield fetch(`https://api.mapbox.com/styles/v1/${t}?access_token=${cn.accessToken}`,{method:"GET",headers:{Accept:"application/json"}}).then(t=>t.json())):n=t;const i=this.mapInstance.getLayer(Dr);n.sources=Object.assign({},r.sources,n.sources);const o=r.layers.filter(t=>t.source&&"mapbox://mapbox.satellite"!=t.source&&"mapbox"!=t.source&&"composite"!=t.source);n.layers=[...null!==(e=n.layers)&&void 0!==e?e:[],...o],this.mapInstance.setStyle(n),i&&setTimeout(()=>{this.addBuildingsLayer()},2e3)})}updateMaxBounds(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(t)})}getCanvasContainer(){return this.mapInstance.getCanvasContainer()}changeCanvasCursor(t){this.mapInstance.getCanvasContainer().style.cursor=t}queryRenderedFeatures(t,e){return this.mapInstance.queryRenderedFeatures(t,e)}setZoom(t){return(0,i.mG)(this,void 0,void 0,function*(){return yield this.waitForMapLoad(),this.mapInstance.setZoom(t)})}setCenter(t){return(0,i.mG)(this,void 0,void 0,function*(){return yield this.waitForMapLoad(),this.mapInstance.setCenter(t)})}setBearing(t){return(0,i.mG)(this,void 0,void 0,function*(){return yield this.waitForMapLoad(),this.mapInstance.setBearing(t)})}panTo(t,e){return(0,i.mG)(this,void 0,void 0,function*(){return yield this.waitForMapLoad(),this.zone.runOutsideAngular(()=>(this.mapInstance.panTo(t,e),new Promise(t=>{setTimeout(t,(null==e?void 0:e.duration)||0)})))})}move(t){const{movingMethod:e,movingOptions:r,zoom:n,center:o,bearing:a,pitch:s}=t;if(void 0!==n||o||void 0!==a||void 0!==s)return this.zone.runOutsideAngular(()=>(0,i.mG)(this,void 0,void 0,function*(){yield this.waitForMapLoad(),this.mapInstance[e](Object.assign(Object.assign({},r),{zoom:null!=n?n:this.mapInstance.getZoom(),center:null!=o?o:this.mapInstance.getCenter(),bearing:null!=a?a:this.mapInstance.getBearing(),pitch:null!=s?s:this.mapInstance.getPitch()}))}))}addControl(t,e){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(t,e)})}removeControl(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(t)})}loadAndAddImage(t,e,r){return(0,i.mG)(this,void 0,void 0,function*(){return this.zone.runOutsideAngular(()=>new Promise((n,i)=>{this.mapInstance.loadImage(e,(e,o)=>{e?i(e):(this.addImage(t,o,r),n())})}))})}addImage(t,e,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(t,e,r)})}removeImage(t){this.imageIdsToRemove.push(t)}addSource(t,e){return this.zone.runOutsideAngular(()=>{Object.keys(e).forEach(t=>void 0===e[t]&&delete e[t]),this.mapInstance.addSource(t,e)})}getSource(t){return this.mapInstance.getSource(t)}removeSource(t){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(t).forEach(t=>this.mapInstance.removeLayer(t.id)),this.mapInstance.removeSource(t)})}addOrUpdateSource(t,e){return this.zone.runOutsideAngular(()=>(0,i.mG)(this,void 0,void 0,function*(){yield this.waitForMapDataInitialized();const r=this.mapInstance.getSource(t);r?r.setData(e):this.mapInstance.addSource(t,{type:"geojson",data:e})}))}setAllLayerPaintProperty(t,e){return this.zone.runOutsideAngular(()=>{Object.keys(e).forEach(r=>{this.mapInstance.setPaintProperty(t,r,e[r])})})}setAllLayerLayoutProperty(t,e){return this.zone.runOutsideAngular(()=>{Object.keys(e).forEach(r=>{this.mapInstance.setLayoutProperty(t,r,e[r])})})}setLayerFilter(t,e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(t,e)})}setLayerBefore(t,e){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(t,e)})}setLayerZoomRange(t,e,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(t,e||0,r||20)})}fitBounds(t,e){return(0,i.mG)(this,void 0,void 0,function*(){return yield this.waitForMapLoad(),this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(t,e)})})}fitToBoundsByPoints(t,e,r=20){if(!t.length)return;const n=function(t,e){return e=e||new Xr.LngLatBounds,t.reduce((t,e)=>t.extend([e.lng,e.lat]),e)}(t);return this.fitBounds(n,{padding:on(r),animate:e})}fitMapToFeatures(t,e,r,n){const i=e.reduce((t,e)=>[...t,...Wr(e)],[]);return this.fitToBoundsByPoints(i.map(qr),r,n)}fitScreenCoordinates(t,e,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(t[0],t[1],e,r)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeImages()})}createMap(t){s.R0b.assertNotInAngularZone(),Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),this.mapInstance=new cn.Map(t),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(t.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeImages(){for(const t of this.imageIdsToRemove)this.mapInstance.removeImage(t);this.imageIdsToRemove=[]}findLayersBySourceId(t){const e=this.mapInstance.getStyle().layers;return null==e?[]:e.filter(e=>"source"in e&&e.source===t)}hookGeneralEvents(){this.mapInstance.on("idle",()=>{this.setMapIdle()}),this.mapInstance.on("movestart",()=>{this.setMapNotIdle()}),this.mapInstance.on("zoomstart",()=>{this.setMapNotIdle()})}hookLoadEvent(t){this.mapInstance.on("load",e=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),t&&this.zone.run(()=>{t.emit()})})}hookEvents(t){this.hookGeneralEvents(),this.hookLoadEvent(t.load),fn.forEach(e=>{var r;(null===(r=t[e.outputEventName])||void 0===r?void 0:r.observers.length)&&this.mapInstance.on(e.mapboxEventName,r=>this.zone.run(()=>{t[e.mapboxEventName].emit(r)}))})}setMapInitialized(){this.mapDataInitialized.next(void 0),this.mapDataInitialized.complete()}setMapNotIdle(){this.isIdle=!0}setMapIdle(){this.isIdle=!0}assign(t,e,r){if("string"==typeof e&&(e=e.split(".")),e.length>1){const n=e.shift();this.assign(t[n]="[object Object]"===Object.prototype.toString.call(t[n])?t[n]:{},e,r)}else t[e[0]]=r}resize(){return(0,i.mG)(this,void 0,void 0,function*(){yield this.waitForMapLoad(),this.mapInstance.resize()})}waitForMapLoad(){return this.mapLoaded$.toPromise()}waitForMapDataInitialized(){return this.mapDataInitialized$.toPromise()}waitForMapIdle(){return this.isIdle?Promise.resolve():new Promise(t=>{this.mapInstance.once("idle",()=>{this.isIdle=!0,t()})})}getEntityById(t,e,r){var n;let i;for(e=[...e];e.length&&!i;){let o=e.pop();i=null===(n=this.layerContentsPerLayer[o])||void 0===n?void 0:n.getEntity(t,r)}return i}getEntityForEvent(t,e,r,n){const i=(null==n?void 0:n.features)||this.mapInstance.queryRenderedFeatures(Hr(n.point),{layers:[r]}),o=pn[t],a=i.find(t=>t.properties[o]);return this.layerContentsPerLayer[e].getEntity(t,null==a?void 0:a.properties["entity-id"])}getLineEntityForLineStopEvent(t,e,r){const n=((null==r?void 0:r.features)||this.mapInstance.queryRenderedFeatures(Hr(r.point),{layers:[e]})).find(t=>t.properties[wr.POLYLINE_STOP]),i=null==n?void 0:n.properties.id,o=null==n?void 0:n.properties.lineId,a=this.layerContentsPerLayer[t],s=a.getEntity(vr.POLYLINE,o),u=a.getFeature(vr.POLYLINE,o);return{polyline:s,markerIndex:null==u?void 0:u.extra[i]}}getPointsForEntities(t){let e=(t.markers||[]).map(t=>t.getLngLat());return e=(t.vectorEntities||[]).reduce((t,e)=>{const r=e.layer||"*",n=this.layerContentsPerLayer[r].getFeature(vr.POINT,e.id)||this.layerContentsPerLayer[r].getFeature(vr.POLYLINE,e.id)||this.layerContentsPerLayer[r].getFeature(vr.POLYGON,e.id);return n&&t.push(...n.getCoordinates()),t},e),e}initLayerContents(t){this.layerContentsPerLayer[t]=new ln(t)}setLayerContents(t,e,r,n){this.layerContentsPerLayer[t].setFeatures(e,r),this.layerContentsPerLayer[t].setEntities(e,n),this.onLayerContentsChanged(t)}getAllSourcesForLayer(t){return this.layerContentsPerLayer[t].getAllSources()}getLayer(t){return this.mapInstance.getLayer(t)}addLayer(t,e){this.mapInstance.addLayer(t,e)}removeLayer(t){if(this.mapInstance.getLayer(t))return this.mapInstance.removeLayer(t)}addToSubscription(t){this.subscription.add(t)}doesLayerHaveContents(t){var e;return!!(null===(e=this.layerContentsPerLayer[t])||void 0===e?void 0:e.getAllEntities().length)}addMarker(t,e){var r;const n=t.markersOptions.layer;e.addTo(this.mapInstance),e.id=t.markersOptions.id,e.layer=n,e.isHidden=t.markersOptions.isHidden||0==t.markersOptions.opacity,null===(r=this.layerContentsPerLayer[n])||void 0===r||r.setEntity(vr.MARKER,e),this.onLayerContentsChanged(n)}onMarkerRemoved(t){var e;const r=t.layer;null===(e=this.layerContentsPerLayer[r])||void 0===e||e.removeEntity(vr.MARKER,t.id),this.onLayerContentsChanged(r)}onLayerContentsChanged(t){this.mapLayerDataChanged$.next(t)}setupRTL(){if("loaded"!==o.getRTLTextPluginStatus()&&"loading"!==o.getRTLTextPluginStatus())try{o.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",null,!1)}catch(t){console.warn("Tried to load Mapbbox RTL plugin twice.",t)}}getFirstSymbolLayer(t=this.mapInstance.getStyle()){const e=t.layers;let r,n;for(let i=0;i<e.length;i++)if("symbol"===e[i].type&&e[i].layout["text-field"]){r=e[i].id,n=i;break}return{id:r,index:n}}addBuildingsLayer(){const t=this.getFirstSymbolLayer().id;this.mapInstance.addLayer({id:Dr,source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.6}},t)}removeBuildingsLayer(){this.removeLayer(Dr)}addSkyLayer(){this.mapInstance.addLayer({id:"sky",type:"sky",paint:{"sky-type":"gradient","sky-gradient":["interpolate",["linear"],["sky-radial-progress"],.8,"rgba(135, 206, 235, 1.0)",1,"rgba(135, 206, 235, 0.35)"],"sky-gradient-center":[0,0],"sky-gradient-radius":90,"sky-opacity":["interpolate",["exponential",.1],["zoom"],5,0,22,1]}})}removeSkyLayer(){this.removeLayer("sky")}pointLikeToLatLng(t){return this.mapInstance.unproject(t)}pointBoundingBoxToLatLngBounds(t){return an([this.pointLikeToLatLng(t[0]),this.pointLikeToLatLng(t[1])])}isDragPanEnabled(){return this.mapInstance.dragPan.isEnabled()}isDragRotateEnabled(){return this.mapInstance.dragRotate.isEnabled()}isBoxZoomEnabled(){return this.mapInstance.boxZoom.isEnabled()}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(s.R0b),s.LFG(hn,8))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac}),t})();var gn=a();const mn={closeButton:!1,closeOnClick:!1,className:"map-tooltip"};let yn=(()=>{class t{constructor(t){this.mapService=t,this.isOverTooltip=!1,this.isOverEntity=!1,this.tooltip=new gn.Popup(Object.assign({},mn)),this.listeners={},this.mapboxLayerIds={[vr.POINT]:{},[vr.POLYLINE]:{},[vr.POLYGON]:{}}}get map(){return this.mapService.mapInstance}setMapboxLayerIds(t,e){this.mapboxLayerIds[t]=e}addTooltipsToLayer(t,e,r){this.listeners[e]&&this.stopTooltipListenerForLayer(e,r);const n=this.getMoveListener(t,r),i=this.getLeaveListener();this.map.on("mouseenter",e,n),this.map.on("mousemove",e,n),this.map.on("mouseleave",e,i),this.listeners[e]=this.listeners[e]||{},this.listeners[e][r]=this.listeners[e][r]||[],this.listeners[e][r].push(n,i)}stopTooltipListenerForLayer(t,e){var r,n;null===(n=null===(r=this.listeners[t])||void 0===r?void 0:r[e])||void 0===n||n.forEach(e=>{this.map.off("mouseenter",t,e),this.map.off("mousemove",t,e),this.map.off("mouseleave",t,e)})}getTooltipCoordinates(t,e){return t.properties.tooltipFollowMouse?e.toArray():function(t){return Array.isArray(t.geometry.coordinates[0])?L.centroid(t).geometry.coordinates:t.geometry.coordinates.slice()}(t)}setTooltipToShow(t,e,r,n){var i;clearTimeout(this.currentTimeout),this.currentFeature=t;const o=this.getAnchorDirection(n);let a=1e3*(null!==(i=t.properties.tooltipShowDelay)&&void 0!==i?i:2);const s=t.properties.tooltipClassName||"";this.map.getCanvas().style.cursor="pointer",this.currentTimeout=setTimeout(()=>this.showTooltip(r,e,s,o),a)}