log=function(){};log.error=log.warn=log.debug=log;defined=function(a){return a===undefined?false:true};exists=function(a){return(a===undefined||a===null)?false:true};finite=function(a){return isFinite(a)?a:0};finiteInt=function(a,b){return finite(parseInt(a,b))};finiteFloat=function(a){return finite(parseFloat(a))};max=function(){var b=arguments;var d=b[0];for(var c=1;c<b.length;c++){if(b[c]>d){d=b[c]}}return d};min=function(){var b=arguments;var d=b[0];for(var c=1;c<b.length;c++){if(b[c]<d){d=b[c]}}return d};Try={these:function(){for(var a=0;a<arguments.length;a++){try{return arguments[a]()}catch(b){}}return undefined}};Unique={length:0,id:function(){return ++this.length}};if(!defined(window.Event)){Event={}}Event.stop=function(a){a=a||this;if(a===Event){a=window.event}if(a.preventDefault){a.preventDefault()}if(a.stopPropagation){a.stopPropagation()}try{a.cancelBubble=true;a.returnValue=false}catch(b){}return false};Event.prep=function(a){a=a||window.event;if(!defined(a.stop)){a.stop=this.stop}if(!defined(a.target)){a.target=a.srcElement}if(!defined(a.relatedTarget)){a.relatedTarget=a.toElement}return a};try{Event.prototype.stop=Event.stop}catch(e){}Function.stub=function(){};if(!Object.prototype.hasOwnProperty){Object.prototype.hasOwnProperty=function(b){if(!(b in this)){return false}try{var c=this.constructor.prototype;while(c){if(c[b]===this[b]){return false}if(c===c.constructor.prototype){break}c=c.constructor.prototype}}catch(a){}return true}}if(!defined(window.OBJ)){OBJ={}}OBJ.extend=function(h){var b=arguments;for(var c=0;c<b.length;c++){var g=b[c];for(var f in g){try{if(!h[f]&&(!g.hasOwnProperty||g.hasOwnProperty(f))){h[f]=g[f]}}catch(d){}}}return h};OBJ.override=function(h){var b=arguments;for(var c=0;c<b.length;c++){var g=b[c];for(var f in g){try{if(!g.hasOwnProperty||g.hasOwnProperty(f)){h[f]=g[f]}}catch(d){}}}return h};OBJ.extend(Function.prototype,{bind:function(a){var b=this;return function(){return b.apply(a,arguments)}},bindEventListener:function(a){var b=this;return function(c){try{c=Event.prep(c)}catch(d){}return b.call(a,c)}}});indirectObjects=[];Class=function(c){var b=function(){if(arguments.length&&this.init){this.init.apply(this,arguments)}};OBJ.override(b,Class);c=c||Object;OBJ.override(b,c);b.superClass=c.prototype;b.prototype=new c();b.prototype.constructor=b;OBJ.extend(b.prototype,Class.prototype);for(var a=1;a<arguments.length;a++){OBJ.override(b.prototype,arguments[a])}return b};OBJ.extend(Class,{initSingleton:function(){if(this.singleton){return this.singleton}this.singleton=this.singletonConstructor?new this.singletonConstructor():new this();if(this.singleton.init){this.singleton.init.apply(this.singleton,arguments)}return this.singleton}});Class.prototype={destroy:function(){try{if(this.indirectIndex){indirectObjects[this.indirectIndex]=undefined}delete this.indirectIndex}catch(b){}for(var a in this){try{if(this.hasOwnProperty(a)){delete this[a]}}catch(b){}}},getBoundMethod:function(a){return this[name].bind(this)},getEventListener:function(a){return this[a].bindEventListener(this)},getIndirectIndex:function(){if(!defined(this.indirectIndex)){this.indirectIndex=indirectObjects.length;indirectObjects.push(this)}return this.indirectIndex},getIndirectMethod:function(a){if(!this.indirectMethods){this.indirectMethods={}}var c=this[a];if(typeof c!="function"){return undefined}var b=this.getIndirectIndex();if(!this.indirectMethods[a]){this.indirectMethods[a]=new Function("var o = indirectObjects["+b+"];return o."+a+".apply( o, arguments );")}return this.indirectMethods[a]},getIndirectEventListener:function(a){if(!this.indirectEventListeners){this.indirectEventListeners={}}var c=this[a];if(typeof c!="function"){return undefined}var b=this.getIndirectIndex();if(!this.indirectEventListeners[a]){this.indirectEventListeners[a]=new Function("event","try { event = Event.prep( event ); } catch( e ) {}var o = indirectObjects["+b+"];return o."+a+".call( o, event );")}return this.indirectEventListeners[a]}};OBJ.extend(String,{escapeJSChar:function(a){switch(a){case"\\":return"\\\\";case'"':return'\\"';case"'":return"\\'";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t"}if(a>=" "){return a}a=a.charCodeAt(0).toString(16);switch(a.length){case 1:return"\\u000"+a;case 2:return"\\u00"+a;case 3:return"\\u0"+a;case 4:return"\\u"+a}return""},encodeEntity:function(a){switch(a){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;";case"'":return"&apos;"}return a},decodeEntity:function(b){switch(b){case"amp":return"&";case"quot":return'"';case"gt":return">";case"lt":return"<"}var a=b.match(/^#(\d+)$/);if(a&&defined(a[1])){return String.fromCharCode(a[1])}a=b.match(/^#x([0-9a-f]+)$/i);if(a&&defined(a[1])){return String.fromCharCode(parseInt(hex,a[1]))}return b}});OBJ.extend(String.prototype,{escapeJS:function(){return this.replace(/([^ -!#-\[\]-~])/g,function(a,b){return String.escapeJSChar(b)})},escapeJS2:function(){return this.replace(/([\u0000-\u0031'"\\])/g,function(a,b){return String.escapeJSChar(b)})},escapeJS3:function(){return this.replace(/[\u0000-\u0031'"\\]/g,function(a){return String.escapeJSChar(a)})},escapeJS4:function(){return this.replace(/./g,function(a){return String.escapeJSChar(a)})},encodeHTML:function(){return this.replace(/([<>&"])/g,function(a,b){return String.encodeEntity(b)})},decodeHTML:function(){return this.replace(/&(.*?);/g,function(a,b){return String.decodeEntity(b)})},cssToJS:function(){return this.replace(/-([a-z])/g,function(a,b){return b.toUpperCase()})},jsToCSS:function(){return this.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()})},firstToLowerCase:function(){return this.replace(/^(.)/,function(a,b){return b.toLowerCase()})},rgbToHex:function(){var a=this.match(/(\d+)\D+(\d+)\D+(\d+)/);if(!a){return undefined}return"#"+finiteInt(a[1]).toString(16).pad(2,"0")+finiteInt(a[2]).toString(16).pad(2,"0")+finiteInt(a[3]).toString(16).pad(2,"0")},pad:function(c,f){var d=c-this.length;if(d<=0){return this}if(!defined(f)){f=" "}var a=[];for(var b=0;b<d;b++){a.push(f)}a.push(this);return a.join("")},trim:function(){return this.replace(/^\s+|\s+$/g,"")}});OBJ.extend(Array,{fromPseudo:function(b){var a=[];for(var c=0;c<b.length;c++){a.push(b[c])}return a}});OBJ.extend(Array.prototype,{copy:function(){var a=[];for(var b=0;b<this.length;b++){a[b]=this[b]}return a},first:function(f,b){var d=this.length;for(var c=0;c<d;c++){var a=b?f.call(b,this[c],c,this):f(this[c],c,this);if(a){return this[c]}}return null},fitIndex:function(a,b){if(!defined(a)||a==null){a=b}else{if(a<0){a=this.length+a;if(a<0){a=0}}else{if(a>=this.length){a=this.length-1}}}return a},scramble:function(){for(var c=0;c<this.length;c++){var b=Math.floor(Math.random()*this.length);var a=this[c];this[c]=this[b];this[b]=a}},add:function(){var b=arguments;for(var d=0;d<b.length;d++){var c=this.indexOf(b[d]);if(c<0){this.push(arguments[d])}}return this.length},remove:function(){var b=arguments;for(var d=0;d<b.length;d++){var c=this.indexOf(b[d]);if(c>=0){this.splice(c,1)}}return this.length},every:function(f,b){var d=this.length;for(var c=0;c<d;c++){var a=b?f.call(b,this[c],c,this):f(this[c],c,this);if(!a){return false}}return true},filter:function(g,c){var b=[];var f=this.length;for(var d=0;d<f;d++){var a=c?g.call(c,this[d],d,this):g(this[d],d,this);if(a){b.push(this[d])}}return b},forEach:function(d,a){var c=this.length;for(var b=0;b<c;b++){a?d.call(a,this[b],b,this):d(this[b],b,this)}},indexOf:function(c,b){b=this.fitIndex(b,0);for(var a=0;a<this.length;a++){if(this[a]===c){return a}}return -1},lastIndexOf:function(c,b){b=this.fitIndex(b,this.length-1);for(var a=b;a>=0;a--){if(this[a]==c){return a}}return -1},some:function(f,b){var d=this.length;for(var c=0;c<d;c++){var a=b?f.call(b,this[c],c,this):f(this[c],c,this);if(a){return true}}return false},concat:function(){var d=arguments;var f=this.copy();for(i=0;i<d.length;i++){var c=d[i];for(j=0;j<c.length;j++){f.push(c[j])}}return f},push:function(){var b=arguments;for(var c=0;c<b.length;c++){this[this.length]=b[c]}return this.length},pop:function(){if(this.length==0){return undefined}var a=this[this.length-1];this.length--;return a},unshift:function(){var b=arguments;for(var c=0;c<b.length;c++){this[c+b.length]=this[c];this[c]=b[c]}return this.length},shift:function(){if(this.length==0){return undefined}var a=this[0];for(var b=1;b<this.length;b++){this[b-1]=this[b]}this.length--;return a}});OBJ.extend(Date,{matchISOString:new RegExp("^([0-9]{4})(?:-(?=0[1-9]|1[0-2])|$)(..)?(?:-(?=0[1-9]|[12][0-9]|3[01])|$)([0-9]{2})?(?:T(?=[01][0-9]|2[0-4])|$)T?([0-9]{2})?(?::(?=[0-5][0-9])|\\+|-|Z|$)([0-9]{2})?(?::(?=[0-5][0-9]|60$|60[+|-|Z]|60.0+)|\\+|-|Z|$):?([0-9]{2})?(.[0-9]+)?(Z|\\+[01][0-9]|\\+2[0-4]|-[01][0-9]|-2[0-4])?:?([0-5][0-9]|60)?$"),fromISOString:function(g){var p=this.matchISOString.exec(g);if(!p){return undefined}var k=finiteInt(p[1],10);var h=finiteInt(p[2],10)-1;var l=finiteInt(p[3],10);var m=finiteInt(p[4],10);var d=finiteInt(p[5],10);var n=finiteInt(p[6],10);var c=finiteInt(Math.round(parseFloat(p[7])*1000));var o=finiteInt(p[8],10);var a=finiteInt(p[9],10);var b=new this(0);if(defined(p[8])){b.setUTCFullYear(k,h,l);b.setUTCHours(m,d,n,c);var f=(o*60+a)*60000;if(f){b=new this(b-f)}}else{b.setFullYear(k,h,l);b.setHours(m,d,n,c)}return b}});OBJ.extend(Date.prototype,{getISOTimezoneOffset:function(){var d=-this.getTimezoneOffset();var b=false;if(d<0){b=true;d*=-1}var a=Math.floor(d/60).toString().pad(2,"0");var c=Math.floor(d%60).toString().pad(2,"0");return(b?"-":"+")+a+":"+c},toISODateString:function(){var b=this.getFullYear();var c=(this.getMonth()+1).toString().pad(2,"0");var a=this.getDate().toString().pad(2,"0");return b+"-"+c+"-"+a},toUTCISODateString:function(){var b=this.getUTCFullYear();var c=(this.getUTCMonth()+1).toString().pad(2,"0");var a=this.getUTCDate().toString().pad(2,"0");return b+"-"+c+"-"+a},toISOTimeString:function(){var a=this.getHours().toString().pad(2,"0");var c=this.getMinutes().toString().pad(2,"0");var f=this.getSeconds().toString().pad(2,"0");var b=this.getMilliseconds().toString().pad(3,"0");var d=this.getISOTimezoneOffset();return a+":"+c+":"+f+"."+b+d},toUTCISOTimeString:function(){var a=this.getUTCHours().toString().pad(2,"0");var c=this.getUTCMinutes().toString().pad(2,"0");var d=this.getUTCSeconds().toString().pad(2,"0");var b=this.getUTCMilliseconds().toString().pad(3,"0");return a+":"+c+":"+d+"."+b+"Z"},toISOString:function(){return this.toISODateString()+"T"+this.toISOTimeString()},toUTCISOString:function(){return this.toUTCISODateString()+"T"+this.toUTCISOTimeString()}});if(!defined(window.XMLHttpRequest)){window.XMLHttpRequest=function(){var b=["Microsoft.XMLHTTP","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"];for(var a=0;a<b.length;a++){try{return new ActiveXObject(b[a])}catch(c){}}return undefined}};
if(!defined(window.Node)){Node={}}try{OBJ.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11})}catch(e){}if(!defined(window.DOM)){DOM={}}OBJ.extend(DOM,{getElement:function(a){return(typeof a=="string"||typeof a=="number")?document.getElementById(a):a},addEventListener:function(d,b,c,a){try{if(d.addEventListener){d.addEventListener(b,c,a)}else{if(d.attachEvent){d.attachEvent("on"+b,c)}else{d["on"+b]=c}}}catch(d){}},removeEventListener:function(d,b,c,a){try{if(d.removeEventListener){d.removeEventListener(b,c,a)}else{if(d.detachEvent){d.detachEvent("on"+b,c)}else{d["on"+b]=undefined}}}catch(d){}},focus:function(a){try{a=DOM.getElement(a);a.focus()}catch(a){}},blur:function(a){try{a=DOM.getElement(a);a.blur()}catch(a){}},getComputedStyle:function(c){if(c.currentStyle){return c.currentStyle}var b={};var a=DOM.getOwnerDocument(c);if(a&&a.defaultView&&a.defaultView.getComputedStyle){try{b=a.defaultView.getComputedStyle(c,null)}catch(c){}}return b},getStyle:function(c,b){var a=DOM.getComputedStyle(c);return a[b]},getClientDimensions:function(a){if(!a){a=window}var b={};if(a.innerHeight){b.x=a.innerWidth;b.y=a.innerHeight;return b}var c=a.document.documentElement;if(c&&c.clientHeight){b.x=c.clientWidth;b.y=c.clientHeight;return b}if(document.body){b.x=document.body.clientWidth;b.y=document.body.clientHeight;return b}return undefined},getDimensions:function(b){if(!b){return undefined}var a=DOM.getComputedStyle(b);return{offsetLeft:b.offsetLeft,offsetTop:b.offsetTop,offsetWidth:b.offsetWidth,offsetHeight:b.offsetHeight,clientWidth:b.clientWidth,clientHeight:b.clientHeight,offsetRight:b.offsetLeft+b.offsetWidth,offsetBottom:b.offsetTop+b.offsetHeight,clientLeft:finiteInt(a.borderLeftWidth)+finiteInt(a.paddingLeft),clientTop:finiteInt(a.borderTopWidth)+finiteInt(a.paddingTop),clientRight:b.clientLeft+b.clientWidth,clientBottom:b.clientTop+b.clientHeight}},getAbsoluteDimensions:function(b){var f=DOM.getDimensions(b);if(!f){return f}f.absoluteLeft=f.offsetLeft;f.absoluteTop=f.offsetTop;f.absoluteRight=f.offsetRight;f.absoluteBottom=f.offsetBottom;var c=0;while(b){try{b=b.offsetParent}catch(a){log("In DOM.getAbsoluteDimensions: "+a.message);if(++c>25){return null}}if(!b){return f}f.absoluteLeft+=b.offsetLeft;f.absoluteTop+=b.offsetTop;f.absoluteRight+=b.offsetLeft;f.absoluteBottom+=b.offsetTop}return f},getIframeAbsoluteDimensions:function(h){var i=DOM.getAbsoluteDimensions(h);if(!i){return i}var b=DOM.getOwnerIframe(h);if(!defined(b)){return i}var c=DOM.getIframeAbsoluteDimensions(b);var a=DOM.getWindowScroll(b.contentWindow);var g=c.absoluteLeft-a.left;var f=c.absoluteTop-a.top;i.absoluteLeft+=g;i.absoluteTop+=f;i.absoluteRight+=g;i.absoluteBottom+=f;return i},setLeft:function(b,a){b.style.left=finiteInt(a)+"px"},setTop:function(b,a){b.style.top=finiteInt(a)+"px"},setRight:function(b,a){b.style.right=finiteInt(a)+"px"},setBottom:function(b,a){b.style.bottom=finiteInt(a)+"px"},setWidth:function(b,a){b.style.width=max(0,finiteInt(a))+"px"},setHeight:function(b,a){b.style.height=max(0,finiteInt(a))+"px"},setZIndex:function(b,a){b.style.zIndex=finiteInt(a)},getWindowScroll:function(a){var b={left:0,top:0};if(!a){a=window}var c=a.document;var f=c.documentElement;if(defined(a.pageXOffset)){b.left=a.pageXOffset;b.top=a.pageYOffset}else{if(f&&defined(f.scrollLeft)){b.left=f.scrollLeft;b.top=f.scrollTop}else{if(defined(a.scrollX)){b.left=a.scrollX;b.top=a.scrollY}else{if(c.body&&defined(c.body.scrollLeft)){b.left=c.body.scrollLeft;b.top=c.body.scrollTop}}}}return b},getAbsoluteCursorPosition:function(b){b=b||window.event;var a=DOM.getWindowScroll(window);return{x:a.left+b.clientX,y:a.top+b.clientY}},invisibleStyle:{display:"block",position:"absolute",left:0,top:0,width:0,height:0,margin:0,border:0,padding:0,fontSize:"0.1px",lineHeight:0,opacity:0,MozOpacity:0,filter:"alpha(opacity=0)"},makeInvisible:function(b){for(var a in this.invisibleStyle){if(this.invisibleStyle.hasOwnProperty(a)){b.style[a]=this.invisibleStyle[a]}}},mergeTextNodes:function(b){var a=0;while(b){if(b.nodeType==Node.TEXT_NODE&&b.nextSibling&&b.nextSibling.nodeType==Node.TEXT_NODE){b.nodeValue+=b.nextSibling.nodeValue;b.parentNode.removeChild(b.nextSibling);a++}else{if(b.firstChild){a+=DOM.mergeTextNodes(b.firstChild)}b=b.nextSibling}}return a},selectElement:function(b){var c=b.ownerDocument;if(c.body.createControlRange){var a=c.body.createControlRange();a.addElement(b);a.select()}},isImmutable:function(b){try{if(b.getAttribute("contenteditable")=="false"){return true}}catch(a){}return false},getImmutable:function(b){var a=null;while(b){if(DOM.isImmutable(b)){a=b}b=b.parentNode}return a},getOwnerDocument:function(a){if(!a){return document}if(a.ownerDocument){return a.ownerDocument}if(a.getElementById){return a}return document},getOwnerWindow:function(b){if(!b){return window}if(b.parentWindow){return b.parentWindow}var a=DOM.getOwnerDocument(b);if(a&&a.defaultView){return a.defaultView}return window},getOwnerIframe:function(a){if(!a){return undefined}var g=DOM.getOwnerWindow(a);var c=DOM.getOwnerDocument(a);var l=g.parent||g.parentWindow;if(!l){return undefined}var m=l.document;var k=m.getElementsByTagName("iframe");for(var f=0;f<k.length;f++){var h=k[f];try{var j=h.contentDocument||h.contentWindow.document;if(j===c){return h}}catch(b){}}return undefined},filterElementsByClassName:function(f,c){var a=[];for(var b=0;b<f.length;b++){var d=f[b];if(DOM.hasClassName(d,c)){a[a.length]=d}}return a},filterElementsByAttribute:function(f,a){if(!f){return[]}if(!defined(a)||a==null||a==""){return f}var b=[];for(var d=0;d<f.length;d++){var c=f[d];if(!c){continue}if(c.getAttribute&&(c.getAttribute(a))){b[b.length]=c}}return b},filterElementsByTagName:function(f,c){if(c=="*"){return f}var a=[];c=c.toLowerCase();for(var b=0;b<f.length;b++){var d=f[b];if(d.tagName&&d.tagName.toLowerCase()==c){a[a.length]=d}}return a},getElementsByTagAndAttribute:function(b,c,a){if(!b){b=document}var d=b.getElementsByTagName(c);return DOM.filterElementsByAttribute(d,a)},getElementsByAttribute:function(b,a){return DOM.getElementsByTagAndAttribute(b,"*",a)},getElementsByAttributeAndValue:function(b,a,f){var g=DOM.getElementsByTagAndAttribute(b,"*",a);var c=[];for(var d=0;d<g.length;d++){if(g[d].getAttribute(a)==f){c.push(g[d])}}return c},getElementsByTagAndClassName:function(a,b,c){if(!a){a=document}var d=a.getElementsByTagName(b);return DOM.filterElementsByClassName(d,c)},getElementsByClassName:function(a,b){return DOM.getElementsByTagAndClassName(a,"*",b)},getAncestors:function(c,b){if(!c){return[]}var a=b?[c]:[];c=c.parentNode;while(c){a.push(c);c=c.parentNode}return a},getAncestorsByTagName:function(d,b,a){var c=DOM.getAncestors(d,a);return DOM.filterElementsByTagName(c,b)},getFirstAncestorByTagName:function(c,b,a){return DOM.getAncestorsByTagName(c,b,a)[0]},getAncestorsByClassName:function(d,b,a){var c=DOM.getAncestors(d,a);return DOM.filterElementsByClassName(c,b)},getFirstAncestorByClassName:function(c,b,a){return DOM.getAncestorsByClassName(c,b,a)[0]},getAncestorsByTagAndClassName:function(f,b,c,a){var d=DOM.getAncestorsByTagName(f,b,a);return DOM.filterElementsByClassName(d,c)},getFirstAncestorByTagAndClassName:function(d,b,c,a){return DOM.getAncestorsByTagAndClassName(d,b,c,a)[0]},getPreviousElement:function(a){a=a.previousSibling;while(a){if(a.nodeType==Node.ELEMENT_NODE){return a}a=a.previousSibling}return null},getNextElement:function(a){a=a.nextSibling;while(a){if(a.nodeType==Node.ELEMENT_NODE){return a}a=a.nextSibling}return null},isInlineNode:function(b){if(b.nodeType==Node.TEXT_NODE){return b}if(b.nodeType==Node.DOCUMENT_NODE){return false}if(b.nodeType!=Node.ELEMENT_NODE){return b}if(b.tagName&&b.tagName.toLowerCase()=="br"){return false}var a=DOM.getStyle(b,"display");if(a&&a.indexOf("inline")>=0){return b}},isTextNode:function(a){if(a.nodeType==Node.TEXT_NODE){return a}},isInlineTextNode:function(a){if(a.nodeType==Node.TEXT_NODE){return a}if(!DOM.isInlineNode(a)){return null}},getClassNames:function(a){if(!a||!a.className){return[]}return a.className.split(/\s+/g)},hasClassName:function(d,c){if(!d||!d.className){return false}var b=DOM.getClassNames(d);for(var a=0;a<b.length;a++){if(b[a]==c){return true}}return false},addClassName:function(d,c){if(!d||!c){return false}var b=DOM.getClassNames(d);for(var a=0;a<b.length;a++){if(b[a]==c){return true}}b.push(c);d.className=b.join(" ");return false},removeClassName:function(g,d){var f=false;if(!g||!g.className||!d){return f}var c=(g.className&&g.className.length)?g.className.split(/\s+/g):[];var b=[];for(var a=0;a<c.length;a++){if(c[a]==d){f=true;continue}b.push(c[a])}if(f){g.className=b.join(" ")}return f},replaceWithChildNodes:function(c){var b=c.firstChild;var a=c.parentNode;while(c.firstChild){a.insertBefore(c.removeChild(c.firstChild),c)}a.removeChild(c);return b},createInvisibleInput:function(b){if(!b){b=window.document}var a=document.createElement("input");a.setAttribute("autocomplete","off");a.autocomplete="off";DOM.makeInvisible(a);return a},getMouseEventAttribute:function(f,b){if(!b){return}var h=DOM.getAncestors(f.target,true);for(var d=0;d<h.length;d++){try{var g=h[d];var c=g.getAttribute?g.getAttribute(b):null;if(c){f.attributeElement=g;f.attribute=c;return c}}catch(g){}}},setElementAttribute:function(g,c,d){if(navigator.userAgent.toLowerCase().match(/webkit/)){var b=g.attributes;for(var f=0;f<b.length;f++){if(b[f].name==c){return b[f].nodeValue=d}}}else{g.setAttribute(c,d)}},swapAttributes:function(f,d,a){var c=f.getAttribute(d);if(!c){return false}if(f.tagName.toLowerCase()=="script"){var b=f.cloneNode(true);if(!b){return false}DOM.setElementAttribute(b,a,c);b.removeAttribute(d);return f.parentNode.replaceChild(b,f)}else{DOM.setElementAttribute(f,a,c);f.removeAttribute(d)}},findPosX:function(a){var b=0;if(a.offsetParent){while(1){b+=a.offsetLeft;if(!a.offsetParent){break}a=a.offsetParent}}else{if(a.x){b+=a.x}}return b},findPosY:function(b){var a=0;if(b.offsetParent){while(1){a+=b.offsetTop;if(!b.offsetParent){break}b=b.offsetParent}}else{if(b.y){a+=b.y}}return a}});$=DOM.getElement;
var HTTPReq=new Object;HTTPReq.create=function(){var a;var b;if(typeof(XMLHttpRequest)!="undefined"){a=new XMLHttpRequest()}else{try{a=new ActiveXObject("Msxml2.XMLHTTP.4.0")}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){}}}try{if(a&&!a.setRequestHeader){a=null}}catch(b){}return a};HTTPReq.getJSON=function(opts){var req=HTTPReq.create();if(!req){if(opts.onError){opts.onError("noxmlhttprequest")}return}var state_callback=function(){if(req.readyState!=4){return}if(req.status!=200){if(opts.onError){opts.onError(req.status?"status: "+req.status:"no data")}return}var resObj;var e;try{eval("resObj = "+req.responseText+";")}catch(e){}if(e||!resObj){if(opts.onError){opts.onError('Error parsing response: "'+req.responseText+'"')}return}if(opts.onData){opts.onData(resObj)}};req.onreadystatechange=state_callback;var method=opts.method||"GET";var data=opts.data||null;var url=opts.url;if(opts.method=="GET"&&opts.data){url+=url.match(/\?/)?"&":"?";url+=opts.data}url+=url.match(/\?/)?"&":"?";url+="_rand="+Math.random();req.open(method,url,true);var to_send=null;if(method.toUpperCase()=="POST"){req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");to_send=data}req.send(to_send)};HTTPReq.formEncoded=function(d){var a=[];var c;for(var b in d){try{if(!d.hasOwnProperty(b)){continue}a.push(encodeURIComponent(b)+"="+encodeURIComponent(d[b]))}catch(c){}}return a.join("&")};
var LiveJournal=new Object;LiveJournal.hooks={};LiveJournal.register_hook=function(b,a){if(!LiveJournal.hooks[b]){LiveJournal.hooks[b]=[]}LiveJournal.hooks[b].push(a)};LiveJournal.run_hook=function(){var b=arguments;var e=LiveJournal.hooks[b[0]];if(!e||!e.length){return}var d=[];for(var c=1;c<b.length;c++){d.push(b[c])}var f=null;e.forEach(function(a){f=a.apply(null,d)});return f};LiveJournal.pageLoaded=false;LiveJournal.initPage=function(){if(LiveJournal.pageLoaded){return}LiveJournal.pageLoaded=1;LiveJournal.initPagePlaceholders();LiveJournal.initInboxUpdate();LiveJournal.initPolls();LiveJournal.run_hook("page_load")};DOM.addEventListener(window,"DOMContentLoaded",LiveJournal.initPage);LiveJournal.initInboxUpdate=function(){if(!Site||!Site.has_remote||!Site.inbox_update_poll){return}var a=$("Inbox_Unread_Count");var b=$("Inbox_Unread_Count_Menu");if(!a&&!b){return}window.setInterval(LiveJournal.updateInbox,1000*60*5)};LiveJournal.updateInbox=function(){var a={action:"get_unread_items"};var b={data:HTTPReq.formEncoded(a),method:"POST",onData:LiveJournal.gotInboxUpdate};b.url=Site.currentJournal?"/"+Site.currentJournal+"/__rpc_esn_inbox":"/__rpc_esn_inbox";HTTPReq.getJSON(b)};LiveJournal.gotInboxUpdate=function(d){if(!d||d.error){return}var a=$("Inbox_Unread_Count");var c=$("Inbox_Unread_Count_Menu");if(!a&&!c){return}var b=d.unread_count?" ("+d.unread_count+")":"";if(a){a.innerHTML=b}if(c){c.innerHTML=b}};LiveJournal.initPagePlaceholders=function(){LiveJournal.initPlaceholders(document)};LiveJournal.initPlaceholders=function(b){var a=DOM.getElementsByTagAndClassName(b,"img","LJ_Placeholder")||[];Array.prototype.forEach.call(a,function(h){var g=DOM.getFirstAncestorByClassName(h,"LJ_Placeholder_Container",false);if(!g){return}var c=DOM.filterElementsByClassName(g.getElementsByTagName("div"),"LJ_Container")[0];if(!c){return}var e=DOM.filterElementsByClassName(g.getElementsByTagName("div"),"LJ_Placeholder_HTML")[0];if(!e){return}var f=unescape(e.innerHTML);var d=function(i){Event.stop(i);c.innerHTML="<span>"+f+"</span>";DOM.makeInvisible(h)};DOM.addEventListener(h,"click",d);return false})};function _textSpan(){return _textElements("span",arguments)}function _textDiv(){return _textElements("div",arguments)}function _textElements(e,a){var d=[];for(var b=0;b<a.length;b++){var c=document.createElement(e);c.innerHTML=a[b];d.push(c)}return d.length==1?d[0]:d}var PollPages={hourglass:null};LiveJournal.initPolls=function(c){var i=c||document;var g=DOM.getElementsByTagAndClassName(i,"a","LJ_PollAnswerLink")||[];Array.prototype.forEach.call(g,function(k){DOM.addEventListener(k,"click",LiveJournal.pollAnswerLinkClicked.bindEventListener(k))});var b=DOM.getElementsByTagAndClassName(i,"a","LJ_PollClearLink")||[];Array.prototype.forEach.call(b,function(k){DOM.addEventListener(k,"click",LiveJournal.pollClearLinkClicked.bindEventListener(k))});var f=DOM.getElementsByTagAndClassName(i,"input","LJ_PollSubmit")||[];Array.prototype.forEach.call(f,function(k){DOM.addEventListener(k,"click",LiveJournal.pollButtonClicked.bindEventListener(k))});var a=DOM.getElementsByTagAndClassName(i,"a","LJ_PollChangeLink")||[];Array.prototype.forEach.call(a,function(k){DOM.addEventListener(k,"click",LiveJournal.pollChangeClicked.bindEventListener(k))});var j=DOM.getElementsByTagAndClassName(i,"a","LJ_PollDisplayLink")||[];Array.prototype.forEach.call(j,function(k){DOM.addEventListener(k,"click",LiveJournal.pollDisplayClicked.bindEventListener(k))});var h=DOM.getElementsByTagAndClassName(i,"form","LJ_PollForm")||[];Array.prototype.forEach.call(h,function(k){DOM.addEventListener(k,"submit",LiveJournal.pollFormSubmitted.bindEventListener(k))});var d=DOM.getElementsByTagAndClassName(document,"a","LJ_PollRespondentsLink")||[];Array.prototype.forEach.call(d,function(k){DOM.addEventListener(k,"click",LiveJournal.pollRespondentsLinkClicked.bindEventListener(k))});var e=DOM.getElementsByTagAndClassName(document,"a","LJ_PollUserAnswerLink")||[];Array.prototype.forEach.call(e,function(k){DOM.addEventListener(k,"click",LiveJournal.pollUserAnswerLinkClicked.bindEventListener(k))})};LiveJournal.pollButtonClicked=function(b){if(!PollPages.hourglass){var a=DOM.getAbsoluteCursorPosition(b);PollPages.hourglass=new Hourglass();PollPages.hourglass.init();PollPages.hourglass.hourglass_at(a.x,a.y+25);PollPages.e=b}return true};LiveJournal.pollFormSubmitted=function(b){Event.stop(b);var c=LiveJournal.getFormObject(this);var a={url:LiveJournal.getAjaxUrl("pollvote"),method:"POST",data:"action=vote&"+HTTPReq.formEncoded(c),onData:LiveJournal.pollUpdateContainer,onError:LiveJournal.pollUpdateContainer};HTTPReq.getJSON(a);return false};LiveJournal.pollChangeClicked=function(b){Event.stop(b);var a={url:LiveJournal.getAjaxUrl("pollvote"),method:"POST",data:"action=change&pollid="+this.getAttribute("lj_pollid"),onData:LiveJournal.pollUpdateContainer,onError:LiveJournal.pollUpdateContainer};HTTPReq.getJSON(a);return false};LiveJournal.pollDisplayClicked=function(b){Event.stop(b);var a={url:LiveJournal.getAjaxUrl("pollvote"),method:"POST",data:"action=display&pollid="+this.getAttribute("lj_pollid"),onData:LiveJournal.pollUpdateContainer,onError:LiveJournal.pollUpdateContainer};HTTPReq.getJSON(a);return false};LiveJournal.pollUpdateContainer=function(a){if(!a){return false}if(PollPages.hourglass){PollPages.hourglass.hide();PollPages.hourglass=null}if(a.error){return LiveJournal.ajaxError(a.error)}resultsDiv=document.getElementById("poll-"+a.pollid+"-container");resultsDiv.innerHTML=a.results_html;LiveJournal.initPolls()};LiveJournal.getFormObject=function(d){var a=d.getElementsByTagName("input");var g=new Object();for(var c=0;c<a.length;c++){var f=a[c];if(f.type=="checkbox"){if(!g[f.name]){g[f.name]=new Array()}if(f.checked){g[f.name].push(f.value)}}else{if(f.type=="radio"){if(f.checked){g[f.name]=f.value}}else{g[f.name]=f.value}}}var b=d.getElementsByTagName("select");for(var c=0;c<b.length;c++){var e=b[c];g[e.name]=e.options[e.selectedIndex].value}return g};LiveJournal.pollClearLinkClicked=function(f){Event.stop(f);var d=this.getAttribute("lj_pollid");var b=DOM.getElementsByTagAndClassName(document,"input","poll-"+d)||[];var g;for(var a=0;a<b.length;a++){g=b[a];if(g.type=="text"){g.value=""}else{b[a].checked=false}}var c=DOM.getElementsByTagAndClassName(document,"select","poll-"+d)||[];for(var a=0;a<c.length;a++){c[a].selectedIndex=0}};LiveJournal.pollAnswerLinkClicked=function(g){Event.stop(g);if(!this||!this.tagName||this.tagName.toLowerCase()!="a"){return true}var b=this.getAttribute("lj_pollid");if(!b){return true}var j=this.getAttribute("lj_qid");if(!j){return true}var h=this.getAttribute("lj_page");var f=this.getAttribute("lj_pagesize");var d="get_answers";var c={pollid:b,pollqid:j,page:h,pagesize:f,action:d};var a={url:LiveJournal.getAjaxUrl("poll"),method:"POST",data:HTTPReq.formEncoded(c),onData:LiveJournal.pollAnswersReceived,onError:LiveJournal.ajaxError};HTTPReq.getJSON(a);if(!PollPages.hourglass){var i=DOM.getAbsoluteCursorPosition(g);PollPages.hourglass=new Hourglass();PollPages.hourglass.init();PollPages.hourglass.hourglass_at(i.x,i.y);PollPages.e=g}return false};LiveJournal.pollAnswersReceived=function(g){if(!g){return false}if(PollPages.hourglass){PollPages.hourglass.hide();PollPages.hourglass=null}if(g.error){return LiveJournal.ajaxError(g.error)}var f=g.pollid;var a=g.pollqid;if(!f||!a){return false}var e=g.page;var d;var b;if(e){d=DOM.getElementsByTagAndClassName(document,"div","lj_pollanswer_paging")[0];b=DOM.getElementsByTagAndClassName(document,"div","lj_pollanswer")[0]}else{var c=$("LJ_PollAnswerLink_"+f+"_"+a);if(!c){return false}d=document.createElement("div");DOM.addClassName(d,"lj_pollanswer_paging");b=document.createElement("div");DOM.addClassName(b,"lj_pollanswer");c.parentNode.insertBefore(b,c);c.parentNode.insertBefore(d,c);c.parentNode.removeChild(c)}d.innerHTML=g.paging_html?g.paging_html:"";b.innerHTML=g.answer_html?g.answer_html:"(No answers)";if(typeof ContextualPopup!="undefined"){ContextualPopup.setup()}LiveJournal.initPolls()};LiveJournal.pollRespondentsLinkClicked=function(f){Event.stop(f);if(!this||!this.tagName||this.tagName.toLowerCase()!="a"){return true}var d=this.getAttribute("lj_pollid");if(!d){return true}var c="get_respondents";answerEle=$("LJ_PollRespondentsLink_"+d);if(!answerEle){return false}var g={pollid:d,action:c};var a={url:LiveJournal.getAjaxUrl("poll"),method:"POST",data:HTTPReq.formEncoded(g),onData:LiveJournal.pollRespondentsReceived,onError:LiveJournal.ajaxError};HTTPReq.getJSON(a);if(!PollPages.hourglass){var b=DOM.getAbsoluteCursorPosition(f);PollPages.hourglass=new Hourglass();PollPages.hourglass.init();PollPages.hourglass.hourglass_at(b.x,b.y);PollPages.e=f}return false};LiveJournal.pollRespondentsReceived=function(c){if(!c){return false}if(PollPages.hourglass){PollPages.hourglass.hide();PollPages.hourglass=null}if(c.error){return LiveJournal.ajaxError(c.error)}var b=c.pollid;if(!b){return false}answerEle=$("LJ_PollRespondentsLink_"+b);if(!answerEle){return false}var a=c.answer_html?c.answer_html:"(No answers)";var d=document.createElement("span");d.innerHTML=a;answerEle.parentNode.replaceChild(d,answerEle);if(typeof ContextualPopup!="undefined"){ContextualPopup.setup()}LiveJournal.initPolls()};LiveJournal.pollUserAnswerLinkClicked=function(g){Event.stop(g);if(!this||!this.tagName||this.tagName.toLowerCase()!="a"){return true}var f=this.getAttribute("lj_pollid");if(!f){return true}var a=this.getAttribute("lj_userid");if(!a){return true}var d="get_user_answers";answerEle=$("LJ_PollUserAnswerLink_"+f+"_"+a);if(!answerEle){return false}var h={pollid:f,userid:a,action:d};var b={url:LiveJournal.getAjaxUrl("poll"),method:"POST",data:HTTPReq.formEncoded(h),onData:LiveJournal.pollUserAnswersReceived,onError:LiveJournal.ajaxError};HTTPReq.getJSON(b);if(!PollPages.hourglass){var c=DOM.getAbsoluteCursorPosition(g);PollPages.hourglass=new Hourglass();PollPages.hourglass.init();PollPages.hourglass.hourglass_at(c.x,c.y);PollPages.e=g}return false};LiveJournal.pollUserAnswersReceived=function(d){if(!d){return false}if(PollPages.hourglass){PollPages.hourglass.hide();PollPages.hourglass=null}if(d.error){return LiveJournal.ajaxError(d.error)}var c=d.pollid;var a=d.userid;if(!c||!a){return false}var b=$("LJ_PollUserAnswerLink_"+c+"_"+a);if(!b){return false}answerEle=$("LJ_PollUserAnswerRes_"+c+"_"+a);if(!answerEle){return false}answerEle.innerHTML=d.answer_html?d.answer_html:"(No answers)";b.innerHTML="";answerEle.style.display="block";if(typeof ContextualPopup!="undefined"){ContextualPopup.setup()}};LiveJournal.getAjaxUrl=function(a){return Site.currentJournal?"/"+Site.currentJournal+"/__rpc_"+a:"/__rpc_"+a};LiveJournal.ajaxError=function(a){if(LJ_IPPU){LJ_IPPU.showNote("Error: "+a)}else{alert("Error: "+a)}};LiveJournal.getDocumentElementsByClassName=function(c){var a=document.getElementsByTagName("*");var b=DOM.filterElementsByClassName(a,c)||[];return b};LiveJournal.addClickHandlerToElementsWithClassName=function(c,b){var a=LiveJournal.getDocumentElementsByClassName(b);a.forEach(function(d){DOM.addEventListener(d,"click",c)})};LiveJournal.parseGetArgs=function(b){var c={};var f=b.split("?");if(!f[1]){return c}var d=f[1].split("&");for(var a in d){if(!d.hasOwnProperty(a)){continue}var e=d[a].split("=");c[e[0]]=e[1]}return c};
var ESN=new Object();LiveJournal.register_hook("page_load",function(){ESN.initCheckAllBtns();ESN.initEventCheckBtns();ESN.initTrackBtns()});ESN.initCheckAllBtns=function(){var a=$("ntypeids");var b=$("catids");if(!a||!b){return}ntidList=a.value;catidList=b.value;if(!ntidList||!catidList){return}a=ntidList.split(",");b=catidList.split(",");b.forEach(function(c){a.forEach(function(f){var d="SubscribeCheckbox-"+c+"-"+f;var e=new CheckallButton();e.init({"class":d,button:$("CheckAll-"+c+"-"+f),parent:$("CategoryRow-"+c)})})})};ESN.initEventCheckBtns=function(){var b=document.getElementsByTagName("*");var a=DOM.filterElementsByClassName(b,"SubscriptionInboxCheck")||[];a.forEach(function(c){DOM.addEventListener(c,"click",ESN.eventChecked.bindEventListener())})};ESN.eventChecked=function(a){var e=a.target;if(!e){return}var d=DOM.getFirstAncestorByTagName(e,"tr",false);var c=d.getElementsByTagName("*");var b=DOM.filterElementsByClassName(c,"NotificationOptions")||[];b.forEach(function(f){f.style.visibility=e.checked?"visible":"hidden"})};ESN.initTrackBtns=function(){if(!Site||!Site.has_remote){return}var a=DOM.getElementsByTagAndClassName(document,"a","TrackButton");Array.prototype.forEach.call(a,function(b){if(!b||!b.getAttribute){return}if(!b.getAttribute("lj_subid")&&!b.getAttribute("lj_journalid")){return}DOM.addEventListener(b,"click",ESN.trackBtnClickHandler.bindEventListener(b))})};ESN.trackBtnClickHandler=function(k){var c=k.target;if(!c){return true}if(k&&(k.ctrlKey||k.metaKey)){return false}c.isIcon=false;if(c.tagName.toLowerCase()=="img"){c=c.parentNode;c.isIcon=true}Event.stop(k);var j={};["arg1","arg2","etypeid","newentry_etypeid","newentry_token","newentry_subid","journalid","subid","auth_token"].forEach(function(o){j[o]=c.getAttribute("lj_"+o)});var f=document.createElement("div");var h=_textDiv("Email me when");DOM.addClassName(h,"track_title");f.appendChild(h);var m=function(s,q){var p=document.createElement("div");var o=document.createElement("input");o.type="checkbox";o.id="newentrytrack"+Unique.id();var r=document.createElement("label");r.setAttribute("for",o.id);r.innerHTML=s;p.appendChild(o);p.appendChild(r);f.appendChild(p);o.checked=q?true:false;return o};if(ESN.trackPopup){ESN.trackPopup.hide();ESN.trackPopup=null}var i=document.createElement("input");i.type="button";i.value="Save Changes";DOM.addClassName(i,"track_savechanges");var n=Number(j.newentry_subid)?1:0;var l=Number(j.subid)?1:0;var b;var e;if(Number(c.getAttribute("lj_dtalkid"))){e=m("someone replies in this comment thread",1)}else{var a;if(typeof LJ_cmtinfo!=="undefined"){a=LJ_cmtinfo.journal}else{if(typeof c.getAttribute("journal")!="undefined"){a=c.getAttribute("journal")}else{if(typeof Site!=="undefined"){a=Site.currentJournal}}}if(a){b=m(a+" posts a new entry",n)}e=m("someone comments on this post",l)}DOM.addEventListener(i,"click",function(){ESN.toggleSubscriptions(j,k,c,{newEntry:b?b.checked:false,newComments:e.checked});if(ESN.trackPopup){ESN.trackPopup.hide()}});var g=document.createElement("div");DOM.addClassName(g,"track_btncontainer");f.appendChild(g);g.appendChild(i);var d=document.createElement("a");d.href=c.href;g.appendChild(d);d.innerHTML="More Options";DOM.addClassName(d,"track_moreopts");ESN.trackPopup=new LJ_IPPU.showNoteElement(f,c,0);DOM.addEventListener(d,"click",function(o){Event.stop(o);document.location.href=c.href;if(ESN.trackPopup){ESN.trackPopup.hide()}return false});return false};ESN.toggleSubscriptions=function(b,a,d,c){b.subid=Number(b.subid);if((b.subid&&!c.newComments)||(!b.subid&&c.newComments)){ESN.toggleSubscription(b,a,d,"newComments")}b.newentry_subid=Number(b.newentry_subid);if((b.newentry_subid&&!c.newEntry)||(!b.newentry_subid&&c.newEntry)){var e=new Object(b);e.subid=Number(d.getAttribute("lj_newentry_subid"));ESN.toggleSubscription(e,a,d,"newEntry")}};ESN.toggleSubscription=function(f,i,b,a){var d="";var c={auth_token:a=="newEntry"?f.newentry_token:f.auth_token};if(Number(f.subid)){d="delsub";c.subid=f.subid}else{d="addsub";var e;if(a=="newEntry"){c.etypeid=f.newentry_etypeid;e=["journalid"]}else{e=["journalid","arg1","arg2","etypeid"]}e.forEach(function(j){if(Number(f[j])){c[j]=parseInt(f[j],10)}})}c.action=d;var g={method:"POST",url:LiveJournal.getAjaxUrl("esn_subs"),data:HTTPReq.formEncoded(c)};var h=function(o){if(!o){return LJ_IPPU.showNote("Error changing subscription",b)}if(o.error){return LJ_IPPU.showNote(o.error,b)}if(o.success){if(o.msg){LJ_IPPU.showNote(o.msg,b)}if(o.subscribed){if(o.subid){DOM.setElementAttribute(b,"lj_subid",o.subid)}if(o.newentry_subid){DOM.setElementAttribute(b,"lj_newentry_subid",o.newentry_subid)}DOM.setElementAttribute(b,"title","Untrack This");var n=b.getAttribute("lj_dtalkid");if(n){ESN.updateThreadIcons(n,"on")}else{if(!b.isIcon){var j=b.innerHTML;b.innerHTML=b.getAttribute("js_swapname");DOM.setElementAttribute(b,"js_swapname",j)}else{b.firstChild.src=Site.imgprefix+"/silk/entry/untrack.png"}}}else{if(o.event_class=="LJ::Event::JournalNewComment"){DOM.setElementAttribute(b,"lj_subid",0)}else{if(o.event_class=="LJ::Event::JournalNewEntry"){DOM.setElementAttribute(b,"lj_newentry_subid",0)}}DOM.setElementAttribute(b,"title","Track This");var n=b.getAttribute("lj_dtalkid");if(n){var m="off";var k;var l=n;while(k=ESN.getThreadParentBtn(l)){l=k.getAttribute("lj_dtalkid");if(!l){log("could not find parent_dtalkid");break}if(!Number(k.getAttribute("lj_subid"))){continue}m="parent";break}ESN.updateThreadIcons(n,m)}else{if(!b.isIcon){var j=b.innerHTML;b.innerHTML=b.getAttribute("js_swapname");DOM.setElementAttribute(b,"js_swapname",j)}else{b.firstChild.src=Site.imgprefix+"/silk/entry/track.png"}}}if(o.auth_token){DOM.setElementAttribute(b,"lj_auth_token",o.auth_token)}if(o.newentry_token){DOM.setElementAttribute(b,"lj_newentry_token",o.newentry_token)}}};g.onData=h;g.onError=function(j){LJ_IPPU.showNote("Error: "+j)};HTTPReq.getJSON(g)};ESN.getThreadParentBtn=function(c){var b=LJ_cmtinfo[c+""];if(!b){log("no comment info");return null}var a=b.parent;if(!a){return null}return $("lj_track_btn_"+a)};ESN.updateThreadIcons=function(e,f){var b=$("lj_track_btn_"+e);if(!b){log("no button");return}var c=LJ_cmtinfo[e+""];if(!c){log("no comment info");return}if(Number(b.getAttribute("lj_subid"))&&f!="on"){return}if(c.rc&&c.rc.length){c.rc.forEach(function(g){window.setTimeout(function(){var h;switch(f){case"on":h="parent";break;case"off":h="off";break;case"parent":h="parent";break;default:alert("Unknown tracking state "+f);break}ESN.updateThreadIcons(g,h)},300)})}var d;switch(f){case"on":d="/silk/entry/untrack.png";break;case"off":d="/silk/entry/track.png";break;case"parent":d="/silk/entry/untrack.png";break;default:alert("Unknown tracking state "+f);break}if(typeof b.firstChild.tagName!="undefined"&&b.firstChild.tagName.toLowerCase()=="img"){b.firstChild.src=Site.imgprefix+d}else{var a=b.innerHTML;b.innerHTML=b.getAttribute("js_swapname");DOM.setElementAttribute(b,"js_swapname",a)}};
function changeOpac(d,b){var c=$(d);if(c&&c.style){var a=c.style;if(a){if(IPPU.isSafari()&&b>=100){b=99.99}if(a.filters){a.filters.alpha.opacity=b*100}a.opacity=b}}}IPPU=new Class(Object,{setFixedPosition:function(a){if(IPPU.isIE()){return}this.fixedPosition=a;this.updateContent()},clickHandler:function(a){if(!this.clickToClose){return}if(!this.visible()){return}a=Event.prep(a);var b=a.target;if(DOM.getAncestorsByClassName(b,"ippu",true).length>0){return}this.cancel()},setCancelledCallback:function(a){this.cancelledCallback=a},cancel:function(){if(this.cancelledCallback){this.cancelledCallback()}this.hide()},setHiddenCallback:function(a){this.hiddenCallback=a},setupClickCapture:function(){if(!this.visible()||this.clickHandlerSetup){return}if(!this.clickToClose&&!this.modal){return}this.clickHandlerFunc=this.clickHandler.bindEventListener(this);if(this.modal){if(this.overlay){return}this.overlay=document.createElement("div");this.overlay.style.left="0px";this.overlay.style.top="0px";this.overlay.style.margin="0px";this.overlay.style.padding="0px";this.overlay.style.backgroundColor="#000000";this.overlay.style.zIndex="900";if(IPPU.isIE()){this.overlay.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";this.overlay.style.position="absolute";this.overlay.style.width=document.body.scrollWidth;this.overlay.style.height=document.body.scrollHeight}else{this.overlay.style.position="fixed"}this.ele.parentNode.insertBefore(this.overlay,this.ele);this.updateOverlay();DOM.addEventListener(this.overlay,"click",this.clickHandlerFunc)}else{DOM.addEventListener(document,"click",this.clickHandlerFunc)}this.clickHandlerSetup=true},updateOverlay:function(){if(this.overlay){var a=DOM.getClientDimensions();this.overlay.style.width=(a.x-1)+"px";if(!IPPU.isIE()){this.overlay.style.height=(a.y-1)+"px"}if(this.visibleOverlay){this.overlay.backgroundColor="#000000";changeOpac(this.overlay,0.5)}else{this.overlay.backgroundColor="#FFFFFF";changeOpac(this.overlay,0)}}},resizeHandler:function(a){this.updateContent()},removeClickHandlers:function(){if(!this.clickHandlerSetup){return}var a=this;var b=function(c){a.clickHandler(c)};DOM.removeEventListener(document,"click",this.clickHandlerFunc,false);if(this.overlay){DOM.removeEventListener(this.overlay,"click",this.clickHandlerFunc,true);this.overlay.parentNode.removeChild(this.overlay);this.overlay=undefined}this.clickHandlerFunc=undefined;this.clickHandlerSetup=false},setClickToClose:function(b){this.clickToClose=b;if(!this.clickHandlerSetup&&b&&this.visible()){var a=this.setupClickCapture.bind(this);window.setTimeout(a,100)}else{if(!b&&this.clickHandlerSetup){this.removeClickHandlers()}}this.updateContent()},setModal:function(a){var b=(this.modal==a);if(a){this.setClickToClose(false)}this.modal=a;if(b){this.removeClickHandlers();this.updateContent()}},setOverlayVisible:function(a){this.visibleOverlay=a;this.updateContent()},updateContent:function(){this.autoCenter();this.updateTitlebar();this.updateOverlay();if(this.titlebar){this.setTitlebarClass(this.titlebar.className)}var a=this.setupClickCapture.bind(this);window.setTimeout(a,100);if(this.fixedPosition&&this.ele.style.position!="fixed"){this.ele.style.position="fixed"}else{if(!this.fixedPosition&&this.ele.style.position=="fixed"){this.ele.style.position="absolute"}}},getTitlebarElement:function(){return this.titlebar},setTitlebarClass:function(a){if(this.titlebar){this.titlebar.className=a}},setOverflow:function(a){if(this.ele){this.ele.style.overflow=a}},visible:function(){return this.shown},setTitlebar:function(a){this.showTitlebar=a;if(a){if(!this.titlebar){var b=document.createElement("div");if(!b){return}b.style.width="100%";if(this.title){b.innerHTML=this.title}this.ele.insertBefore(b,this.content);this.titlebar=b}}else{if(this.titlebar){this.ele.removeChild(this.titlebar);this.titlebar=false}}},setTitle:function(a){this.title=a;this.updateTitlebar()},updateTitlebar:function(){if(this.showTitlebar&&this.titlebar&&this.title!=this.titlebar.innerHTML){this.titlebar.innerHTML=this.title}},addClass:function(a){DOM.addClassName(this.ele,a)},removeClass:function(a){DOM.removeClassName(this.ele,a)},setAutoCenterCallback:function(a){this.autoCenterCallback=a},autoCenter:function(){if(!this.visible||!this.visible()){return}if(this.autoCenterCallback){this.autoCenterCallback(this);return}if(this.autoCenterX){this.centerX()}if(this.autoCenterY){this.centerY()}},center:function(){this.centerX();this.centerY()},centerOnWidget:function(f,c,e){c=c||0;e=e||0;this.setAutoCenter(false,false);this.setAutoCenterCallback(null);var b=DOM.getAbsoluteDimensions(f);var a=DOM.getAbsoluteDimensions(this.ele);var g=(b.absoluteRight-b.offsetWidth/2-a.offsetWidth/2)+e;var d=(b.absoluteBottom-b.offsetHeight/2-a.offsetHeight/2)+c;g=g<0?0:g;d=d<0?0:d;DOM.setLeft(this.ele,g);DOM.setTop(this.ele,d)},centerX:function(){if(!this.visible||!this.visible()){return}var c=DOM.getClientDimensions();var b=c.x/2-DOM.getDimensions(this.ele).offsetWidth/2;if(!this.fixedPosition){var a=DOM.getWindowScroll();b+=a.left}DOM.setLeft(this.ele,b)},centerY:function(){if(!this.visible||!this.visible()){return}var c=DOM.getClientDimensions();var b=c.y/2-DOM.getDimensions(this.ele).offsetHeight/2;if(!this.fixedPosition){var a=DOM.getWindowScroll();b+=a.top}DOM.setTop(this.ele,b)},setAutoCenter:function(b,a){this.autoCenterX=b||false;this.autoCenterY=a||false;if(!b&&!a){this.setAutoCenterCallback(null);return}this.autoCenter()},setDimensions:function(b,a){b=b+"";a=a+"";if(b.match(/^\d+$/)){b+="px"}if(a.match(/^\d+$/)){a+="px"}this.ele.style.width=b;this.ele.style.height=a},moveForward:function(a){if(!a){a=1}if(!this.ele){return}this.ele.style.zIndex+=a},moveBackward:function(a){if(!a){a=1}if(!this.ele){return}this.ele.style.zIndex-=a},setLocation:function(b,a){this.setLeft(b);this.setTop(a)},setTop:function(a){a=a+"";if(a.match(/^\d+$/)){a+="px"}this.ele.style.top=a},setLeft:function(a){a=a+"";if(a.match(/^\d+$/)){a+="px"}this.ele.style.left=a},getElement:function(){return this.ele},setContent:function(a){this.content.innerHTML=a},setContentElement:function(a){while(this.content.firstChild){this.content.removeChild(this.content.firstChild)}this.content.appendChild(a)},setFadeIn:function(a){this.fadeIn=a},setFadeOut:function(a){this.fadeOut=a},setFadeSpeed:function(a){this.fadeSpeed=a},show:function(){this.shown=true;if(this.fadeIn){var a=0.01;changeOpac(this.ele,a)}document.body.appendChild(this.ele);this.ele.style.position="absolute";if(this.autoCenterX||this.autoCenterY){this.center()}this.updateContent();if(!this.resizeHandlerFunc){this.resizeHandlerFunc=this.resizeHandler.bindEventListener(this);DOM.addEventListener(window,"resize",this.resizeHandlerFunc,false)}if(this.fadeIn){this.fade("in")}this.hideSelects()},fade:function(c,g){var b;var f;var e=10;if(c=="in"){f=1/e;b=0.1}else{if(this.ele.style.opacity){b=finiteFloat(this.ele.style.opacity)}else{b=0.99}f=-1/e}var h=this.fadeSpeed;if(!h){h=1}var d=e/h*5;this.fadeMode=c;var i=this;var a=function(){b+=f;if(i.fadeMode&&i.fadeMode!=c){if(g){g.call(i,[])}return}if(b<=0.1){if(g){g.call(i,[])}i.fadeMode=null;return}else{if(b>=1){if(g){g.call(i,[])}i.fadeMode=null;return}else{changeOpac(i.ele,b);window.setTimeout(a,d)}}};a()},hide:function(){if(!this.visible()){return}if(this.fadeOut&&this.ele){this.fade("out",this._hide.bind(this))}else{this._hide()}},_hide:function(){if(this.hiddenCallback){this.hiddenCallback()}this.shown=false;this.removeClickHandlers();if(this.ele){document.body.removeChild(this.ele)}if(this.resizeHandlerFunc){DOM.removeEventListener(window,"resize",this.resizeHandlerFunc)}this.showSelects()},setAutoHideSelects:function(a){this.autoHideSelects=a;this.updateContent()},hideSelects:function(){if(!this.autoHideSelects||!IPPU.isIE()){return}var a=document.getElementsByTagName("select");var c;for(var b=0;b<a.length;b++){c=a[b];if(!c){continue}if(DOM.getAncestorsByClassName(c,"ippu",true).length>0){continue}if(c.style.visibility!="hidden"){c.style.visibility="hidden";this.hiddenSelects.push(c)}}},showSelects:function(){if(!this.autoHideSelects){return}var a;while(a=this.hiddenSelects.pop()){a.style.visibility=""}},init:function(a){var b=document.createElement("div");this.ele=b;this.shown=false;this.autoCenterX=false;this.autoCenterY=false;this.titlebar=null;this.title="";this.showTitlebar=false;this.clickToClose=false;this.modal=false;this.clickHandlerSetup=false;this.docOverlay=false;this.visibleOverlay=false;this.clickHandlerFunc=false;this.resizeHandlerFunc=false;this.fixedPosition=false;this.autoCenterCallback=null;this.cancelledCallback=null;this.autoHideSelects=false;this.hiddenCallback=null;this.fadeOut=false;this.fadeIn=false;this.hiddenSelects=[];this.fadeMode=null;b.style.position="absolute";b.style.zIndex="1000";DOM.addClassName(b,"ippu");this.content=document.createElement("div");this.content.innerHTML=a;this.ele.appendChild(this.content)}});IPPU.center=function(a){a.centerX();a.centerY()};IPPU.centerX=function(a){a.centerX()};IPPU.centerY=function(a){a.centerY()};IPPU.isIE=function(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("msie")!=-1){return true}return false};IPPU.isSafari=function(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("safari")!=-1){return true}return false};
LJ_IPPU=new Class(IPPU,{init:function(a){if(!a){a=""}if(LJ_IPPU.superClass.init){LJ_IPPU.superClass.init.apply(this,[])}this.uniqId=this.generateUniqId();this.cancelThisFunc=this.cancel.bind(this);this.setTitle(a);this.setTitlebar(true);this.setTitlebarClass("lj_ippu_titlebar");this.addClass("lj_ippu");this.setAutoCenterCallback(IPPU.center);this.setDimensions(400,"auto");this.setFixedPosition(true);this.setClickToClose(true);this.setAutoHideSelects(true)},setTitle:function(b){var a="      <div style='float:right; padding-right: 8px'><img src='"+Site.imgprefix+"/CloseButton.gif' width='15' height='15' id='"+this.uniqId+"_cancel' /></div>"+b;LJ_IPPU.superClass.setTitle.apply(this,[a])},generateUniqId:function(){}