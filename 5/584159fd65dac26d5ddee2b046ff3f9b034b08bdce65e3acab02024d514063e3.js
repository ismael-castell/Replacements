!function(){var n={279:function(t,e,n){t.exports=n(8)},8:function(t){window,t.exports=function(n){var r={};function o(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=n,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=19)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(t)for(var n in t)hasOwnProperty.call(t,n)&&e(t[n],n)},t.exports=e.default},function(t,e,n){"use strict";t.exports={Platform:n(29),ThriftTransport:n(34),thrift:n(35),crouton_thrift:n(36)}},function(t,n,e){"use strict";function r(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0});var o=e(22);n.BinaryCarrier=o.default;var i=e(23);n.Tags=i;o=e(8),i=e(13);n.Reference=i.default;i=e(4);n.Span=i.default;i=e(10);n.SpanContext=i.default;i=e(9);n.Tracer=i.Tracer;i=e(24);n.MockTracer=i.MockTracer,r(e(27)),r(e(12)),r(e(11)),o.initialize()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toString=function(t){return""+t},e.toNumber=function(t){return Number(t)},e.toBoolean=function(t){return!!t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),n=(o.prototype.context=function(){return this._context()},o.prototype.tracer=function(){return this._tracer()},o.prototype.setOperationName=function(t){return this._setOperationName(t),this},o.prototype.setBaggageItem=function(t,e){return this._setBaggageItem(t,e),this},o.prototype.getBaggageItem=function(t){return this._getBaggageItem(t)},o.prototype.setTag=function(t,e){var n;return this._addTags(((n={})[t]=e,n)),this},o.prototype.addTags=function(t){return this._addTags(t),this},o.prototype.log=function(t,e){return this._log(t,e),this},o.prototype.logEvent=function(t,e){return this._log({event:t,payload:e})},o.prototype.finish=function(t){this._finish(t)},o.prototype._context=function(){return r.spanContext},o.prototype._tracer=function(){return r.tracer},o.prototype._setOperationName=function(t){},o.prototype._setBaggageItem=function(t,e){},o.prototype._getBaggageItem=function(t){},o.prototype._addTags=function(t){},o.prototype._log=function(t,e){},o.prototype._finish=function(t){},o);function o(){}e.Span=n,e.default=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t},o=(n=n(0))&&n.__esModule?n:{default:n};function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}r(s,[{key:"setBaggageItem",value:function(t,e){this._baggage[t]=e}},{key:"getBaggageItem",value:function(t){return this._baggage[t]}},{key:"forEachBaggageItem",value:function(n){(0,o.default)(this._baggage,function(t,e){n(e,t)})}},{key:"traceGUID",value:function(){return""+this._upperTraceGUID+this._traceGUID}}]),r=s;function s(t,e,n){!function(t){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}(this),this._baggage={},this._guid=t,!(this._sampled=!0)===n&&(this._sampled=n),this._upperTraceGUID="0000000000000000",this._traceGUID=e,this._traceGUID&&32===this._traceGUID.length&&(this._upperTraceGUID=e.substr(0,16),this._traceGUID=e.substr(16))}e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.LOG_INFO=0,e.LOG_WARN=1,e.LOG_ERROR=2,e.LOG_FATAL=3;e.LOG_LEVEL_TO_STRING={LOG_INFO:"I",LOG_WARN:"W",LOG_ERROR:"E",LOG_FATAL:"F"},e.LOG_STRING_TO_LEVEL={I:0,W:1,E:2,F:3},e.CLOCK_STATE_REFRESH_INTERVAL_MS=350,e.LIGHTSTEP_APP_URL_PREFIX="https://app.lightstep.com",e.JOIN_ID_PREFIX="join:",e.LS_META_EVENT_KEY="lightstep.meta_event",e.LS_META_PROPAGATION_KEY="lightstep.propagation_format",e.LS_META_TRACE_KEY="lightstep.trace_id",e.LS_META_SPAN_KEY="lightstep.span_id",e.LS_META_TRACER_GUID_KEY="lightstep.tracer_guid",e.LS_META_EXTRACT="lightstep.extract_span",e.LS_META_INJECT="lightstep.inject_span",e.LS_META_SP_START="lightstep.span_start",e.LS_META_SP_FINISH="lightstep.span_finish",e.LS_META_TRACER_CREATE="lightstep.tracer_create",e.FORMAT_B3="format.b3"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t},u=i(n(0)),c=i(n(5));function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t){return t&&t.__esModule?t:{default:t}}var s="ot-tracer-",a="ot-baggage-",r=(r(l,[{key:"inject",value:function(t,n){var r=this;if(n){if("object"==typeof n)return n[this._carrierPrefix+"spanid"]=t._guid,n[this._carrierPrefix+"traceid"]=t._traceGUID,n[this._carrierPrefix+"sampled"]="true",t.forEachBaggageItem(function(t,e){n[""+r._baggagePrefix+t]=e}),n;this._tracer._error("Unexpected '"+typeof n+"' FORMAT_TEXT_MAP carrier in call to inject")}else this._tracer._error("Unexpected null carrier in call to inject")}},{key:"extract",value:function(t){var n=this,r=0,o=null,i=null,s=!0;if((0,u.default)(t,function(t,e){if((e=e.toLowerCase()).substr(0,n._carrierPrefix.length)===n._carrierPrefix)switch(e.substr(n._carrierPrefix.length)){case"traceid":r++,i=t;break;case"spanid":r++,o=t;break;case"sampled":switch(t){case 0:case"0":case!1:case"false":s=!1;break;default:s=!0}break;default:n._tracer._error("Unrecognized carrier key '"+e+"' with recognized prefix. Ignoring.")}}),0===r)return null;if(r<2)return this._tracer._error("Only found a partial SpanContext: "+t),null;var a=new c.default(o,i,s);return(0,u.default)(t,function(t,e){(e=e.toLowerCase()).substr(0,n._baggagePrefix.length)===n._baggagePrefix&&(e=e.substr(n._baggagePrefix.length),a.setBaggageItem(e,t))}),a}}]),l);function l(t){!function(t){if(!(t instanceof l))throw new TypeError("Cannot call a class as a function")}(this),this._tracer=t,this._carrierPrefix=s,this._baggagePrefix=a}e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),o=n(10),i=n(9);e.tracer=null,e.spanContext=null,e.span=null,e.initialize=function(){e.tracer=new i.default,e.span=new r.default,e.spanContext=new o.default}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(11),o=n(8),i=n(4),n=(s.prototype.startSpan=function(t,e){var n;return void 0===e&&(e={}),e.childOf&&(n=r.childOf(e.childOf),e.references?e.references.push(n):e.references=[n],delete e.childOf),this._startSpan(t,e)},s.prototype.inject=function(t,e,n){return t instanceof i.default&&(t=t.context()),this._inject(t,e,n)},s.prototype.extract=function(t,e){return this._extract(t,e)},s.prototype._startSpan=function(t,e){return o.span},s.prototype._inject=function(t,e,n){},s.prototype._extract=function(t,e){return o.spanContext},s);function s(){}e.Tracer=n,e.default=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(o.prototype.toTraceId=function(){return""},o.prototype.toSpanId=function(){return""},o);function o(){}e.SpanContext=r,e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(12),o=n(13),i=n(4);e.childOf=function(t){return t instanceof i.default&&(t=t.context()),new o.default(r.REFERENCE_CHILD_OF,t)},e.followsFrom=function(t){return t instanceof i.default&&(t=t.context()),new o.default(r.REFERENCE_FOLLOWS_FROM,t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FORMAT_BINARY="binary",e.FORMAT_TEXT_MAP="text_map",e.FORMAT_HTTP_HEADERS="http_headers",e.REFERENCE_CHILD_OF="child_of",e.REFERENCE_FOLLOWS_FROM="follows_from"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),n=(o.prototype.type=function(){return this._type},o.prototype.referencedContext=function(){return this._referencedContext},o);function o(t,e){this._type=t,this._referencedContext=e instanceof r.default?e.context():e}e.default=n},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i,o=(i=n(2).SpanContext,o(s,i),s.prototype.span=function(){return this._span},s);function s(t){var e=i.call(this)||this;return e._span=t,e}e.MockContext=o,e.default=o},function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i,s=n(2),a=n(14),o=(i=s.Span,o(u,i),u.prototype._context=function(){return new a.default(this)},u.prototype._setOperationName=function(t){this._operationName=t},u.prototype._addTags=function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e];this._tags[r]=t[r]}},u.prototype._log=function(t,e){this._logs.push({fields:t,timestamp:e})},u.prototype._finish=function(t){this._finishMs=t||Date.now()},u.prototype.uuid=function(){return this._uuid},u.prototype.operationName=function(){return this._operationName},u.prototype.durationMs=function(){return this._finishMs-this._startMs},u.prototype.tags=function(){return this._tags},u.prototype.tracer=function(){return this._mockTracer},u.prototype._generateUUID=function(){return""+("00000000"+Math.abs(4294967295*Math.random()|0).toString(16)).substr(-8)+("00000000"+Math.abs(4294967295*Math.random()|0).toString(16)).substr(-8)},u.prototype.addReference=function(t){},u.prototype.debug=function(){var t={uuid:this._uuid,operation:this._operationName,millis:[this._finishMs-this._startMs,this._startMs,this._finishMs]};return Object.keys(this._tags).length&&(t.tags=this._tags),t},u);function u(t){var e=i.call(this)||this;return e._mockTracer=t,e._uuid=e._generateUUID(),e._startMs=Date.now(),e._finishMs=0,e._operationName="",e._tags={},e._logs=[],e}e.MockSpan=o,e.default=o},function(t,e,n){"use strict";function r(){return"undefined"!=typeof document}t.exports={cookie:r()?function(t,e,n,r,o,i){if(1<arguments.length){i=t+"="+encodeURIComponent(e)+(n?"; expires="+new Date(+new Date+1e3*n).toUTCString():"")+(r?"; path="+r:"")+(o?"; domain="+o:"")+(i?"; secure":"");return document.cookie=i}return decodeURIComponent((("; "+document.cookie).split("; "+t+"=")[1]||"").split(";")[0])}:function(){return null},isBrowser:r}},function(t,e,n){"use strict";var r,o;r={},void 0===(o={})&&(o={}),o.KeyValue=function(t){if(this.Key=null,this.Value=null,t){if(void 0===t.Key)throw new r.TProtocolException(r.TProtocolExceptionType.UNKNOWN,"Required field Key is unset!");if(this.Key=t.Key,void 0===t.Value)throw new r.TProtocolException(r.TProtocolExceptionType.UNKNOWN,"Required field Value is unset!");this.Value=t.Value}},o.KeyValue.prototype={},o.KeyValue.prototype.read=!1,o.KeyValue.prototype.write=!1,o.NamedCounter=function(t){if(this.Name=null,this.Value=null,t){if(void 0===t.Name)throw new r.TProtocolException(r.TProtocolExceptionType.UNKNOWN,"Required field Name is unset!");if(this.Name=t.Name,void 0===t.Value)throw new r.TProtocolException(r.TProtocolExceptionType.UNKNOWN,"Required field Value is unset!");this.Value=t.Value}},o.NamedCounter.prototype={},o.NamedCounter.prototype.read=!1,o.NamedCounter.prototype.write=!1,o.Runtime=function(t){this.guid=null,this.start_micros=null,this.group_name=null,this.attrs=null,t&&(void 0!==t.guid&&(this.guid=t.guid),void 0!==t.start_micros&&(this.start_micros=t.start_micros),void 0!==t.group_name&&(this.group_name=t.group_name),void 0!==t.attrs&&(this.attrs=t.attrs))},o.Runtime.prototype={},o.Runtime.prototype.read=!1,o.Runtime.prototype.write=!1,o.LogRecord=function(t){this.timestamp_micros=null,this.fields=null,this.runtime_guid=null,this.span_guid=null,this.stable_name=null,this.message=null,this.level=null,this.thread_id=null,this.filename=null,this.line_number=null,this.stack_frames=null,this.payload_json=null,this.error_flag=null,t&&(void 0!==t.timestamp_micros&&(this.timestamp_micros=t.timestamp_micros),void 0!==t.fields&&(this.fields=t.fields),void 0!==t.runtime_guid&&(this.runtime_guid=t.runtime_guid),void 0!==t.span_guid&&(this.span_guid=t.span_guid),void 0!==t.stable_name&&(this.stable_name=t.stable_name),void 0!==t.message&&(this.message=t.message),void 0!==t.level&&(this.level=t.level),void 0!==t.thread_id&&(this.thread_id=t.thread_id),void 0!==t.filename&&(this.filename=t.filename),void 0!==t.line_number&&(this.line_number=t.line_number),void 0!==t.stack_frames&&(this.stack_frames=t.stack_frames),void 0!==t.payload_json&&(this.payload_json=t.payload_json),void 0!==t.error_flag&&(this.error_flag=t.error_flag))},o.LogRecord.prototype={},o.LogRecord.prototype.read=!1,o.LogRecord.prototype.write=!1,o.TraceJoinId=function(t){if(this.TraceKey=null,this.Value=null,t){if(void 0===t.TraceKey)throw new r.TProtocolException(r.TProtocolExceptionType.UNKNOWN,"Required field TraceKey is unset!");if(this.TraceKey=t.TraceKey,void 0===t.Value)throw new r.TProtocolException(r.TProtocolExceptionType.UNKNOWN,"Required field Value is unset!");this.Value=t.Value}},o.TraceJoinId.prototype={},o.TraceJoinId.prototype.read=!1,o.TraceJoinId.prototype.write=!1,o.SpanRecord=function(t){this.span_guid=null,this.trace_guid=null,this.runtime_guid=null,this.span_name=null,this.join_ids=null,this.oldest_micros=null,this.youngest_micros=null,this.attributes=null,this.error_flag=null,this.log_records=null,t&&(void 0!==t.span_guid&&(this.span_guid=t.span_guid),void 0!==t.trace_guid&&(this.trace_guid=t.trace_guid),void 0!==t.runtime_guid&&(this.runtime_guid=t.runtime_guid),void 0!==t.span_name&&(this.span_name=t.span_name),void 0!==t.join_ids&&(this.join_ids=t.join_ids),void 0!==t.oldest_micros&&(this.oldest_micros=t.oldest_micros),void 0!==t.youngest_micros&&(this.youngest_micros=t.youngest_micros),void 0!==t.attributes&&(this.attributes=t.attributes),void 0!==t.error_flag&&(this.error_flag=t.error_flag),void 0!==t.log_records&&(this.log_records=t.log_records))},o.SpanRecord.prototype={},o.SpanRecord.prototype.read=!1,o.SpanRecord.prototype.write=!1,o.Auth=function(t){this.access_token=null,t&&void 0!==t.access_token&&(this.access_token=t.access_token)},o.Auth.prototype={},o.Auth.prototype.read=!1,o.Auth.prototype.write=!1,o.Timing=function(t){this.receive_micros=null,this.transmit_micros=null,t&&(void 0!==t.receive_micros&&(this.receive_micros=t.receive_micros),void 0!==t.transmit_micros&&(this.transmit_micros=t.transmit_micros))},o.Timing.prototype={},o.Timing.prototype.read=!1,o.Timing.prototype.write=!1,o.SampleCount=function(t){this.oldest_micros=null,this.youngest_micros=null,this.count=null,t&&(void 0!==t.oldest_micros&&(this.oldest_micros=t.oldest_micros),void 0!==t.youngest_micros&&(this.youngest_micros=t.youngest_micros),void 0!==t.count&&(this.count=t.count))},o.SampleCount.prototype={},o.SampleCount.prototype.read=!1,o.SampleCount.prototype.write=!1,o.MetricsSample=function(t){if(this.name=null,this.int64_value=null,this.double_value=null,t){if(void 0===t.name)throw new r.TProtocolException(r.TProtocolExceptionType.UNKNOWN,"Required field name is unset!");this.name=t.name,void 0!==t.int64_value&&(this.int64_value=t.int64_value),void 0!==t.double_value&&(this.double_value=t.double_value)}},o.MetricsSample.prototype={},o.MetricsSample.prototype.read=!1,o.MetricsSample.prototype.write=!1,o.Metrics=function(t){this.counts=null,this.gauges=null,t&&(void 0!==t.counts&&(this.counts=t.counts),void 0!==t.gauges&&(this.gauges=t.gauges))},o.Metrics.prototype={},o.Metrics.prototype.read=!1,o.Metrics.prototype.write=!1,o.ReportRequest=function(t){this.runtime=null,this.span_records=null,this.log_records=null,this.timestamp_offset_micros=null,this.oldest_micros=null,this.youngest_micros=null,this.counters=null,this.internal_logs=null,this.internal_metrics=null,t&&(void 0!==t.runtime&&(this.runtime=t.runtime),void 0!==t.span_records&&(this.span_records=t.span_records),void 0!==t.log_records&&(this.log_records=t.log_records),void 0!==t.timestamp_offset_micros&&(this.timestamp_offset_micros=t.timestamp_offset_micros),void 0!==t.oldest_micros&&(this.oldest_micros=t.oldest_micros),void 0!==t.youngest_micros&&(this.youngest_micros=t.youngest_micros),void 0!==t.counters&&(this.counters=t.counters),void 0!==t.internal_logs&&(this.internal_logs=t.internal_logs),void 0!==t.internal_metrics&&(this.internal_metrics=t.internal_metrics))},o.ReportRequest.prototype={},o.ReportRequest.prototype.read=!1,o.ReportRequest.prototype.write=!1,o.Command=function(t){this.disable=null,t&&void 0!==t.disable&&(this.disable=t.disable)},o.Command.prototype={},o.Command.prototype.read=!1,o.Command.prototype.write=!1,o.ReportResponse=function(t){this.commands=null,this.timing=null,t&&(void 0!==t.commands&&(this.commands=t.commands),void 0!==t.timing&&(this.timing=t.timing))},o.ReportResponse.prototype={},o.ReportResponse.prototype.read=!1,o.ReportResponse.prototype.write=!1,t.exports.crouton_thrift=o,t.exports.Thrift={}},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Object.defineProperty(e,"__esModule",{value:!0});var o=(function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}(i,[{key:"detachedTimeout",value:function(t,e){e=setTimeout(t,e);return e.unref&&e.unref(),e}},{key:"shouldSendMetaSpan",value:function(t,e){return!0===t.meta_event_reporting&&!0!==e["lightstep.meta_event"]}}]),i);function i(){!function(t){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this)}e.default=new o,t.exports=e.default},function(t,e,n){"use strict";var r=u(n(20)),o=u(n(7)),i=u(n(47)),s=u(n(48)),a=u(n(5)),n=n(1);function u(t){return t&&t.__esModule?t:{default:t}}a={Tracer:r.default,LightStepPropagator:o.default,B3Propagator:i.default,DDPropagator:s.default,SpanContext:a.default};n.Platform.initLibrary(a),t.exports=a},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n,r=arguments[e];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},n=function(t,e,n){return e&&g(t.prototype,e),n&&g(t,n),t},r=y(o(21)),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(o(2)),p=y(o(5)),_=y(o(28)),f=y(o(0)),a=o(1),u=y(o(38)),c=y(o(39)),d=y(o(40)),l=y(o(41)),h=y(o(7));function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function y(t){return t&&t.__esModule?t:{default:t}}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var m=o(42),b=o(43),T=o(3),O=o(6),E=o(44),S=o(45),w=o(18),R=null,n=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(k,s.Tracer),n(k,[{key:"_delegateEventEmitterMethods",value:function(){var e=this;this._ee=new r.default,(0,f.default)(["addListener","emit","eventNames","getMaxListeners","listenerCount","listeners","on","once","prependListener","prependOnceListener","removeAllListeners","removeListener","setMaxListeners"],function(t){e[t]=function(){e._ee[t]&&e._ee[t].apply(e._ee,arguments)}})}},{key:"_makeOptionsTable",value:function(){this.addOption("verbosity",{type:"int",min:0,max:9,defaultValue:1}),this.addOption("access_token",{type:"string",defaultValue:""}),this.addOption("component_name",{type:"string",defaultValue:""}),this.addOption("collector_host",{type:"string",defaultValue:"collector.lightstep.com"}),this.addOption("collector_port",{type:"int",defaultValue:443}),this.addOption("collector_path",{type:"string",defaultValue:""}),this.addOption("collector_encryption",{type:"string",defaultValue:"tls"}),this.addOption("tags",{type:"any",defaultValue:{}}),this.addOption("max_reporting_interval_millis",{type:"int",defaultValue:2500}),this.addOption("disable_clock_skew_correction",{type:"bool",defaultValue:!1}),this.addOption("transport",{type:"string",defaultValue:"thrift"}),this.addOption("disabled",{type:"bool",defaultValue:!1}),this.addOption("max_span_records",{type:"int",defaultValue:4096}),this.addOption("default_span_tags",{type:"any",defaultValue:{}}),this.addOption("report_timeout_millis",{type:"int",defaultValue:3e4}),this.addOption("gzip_json_requests",{type:"bool",defaultValue:!0}),this.addOption("disable_reporting_loop",{type:"bool",defaultValue:!1}),this.addOption("disable_report_on_exit",{type:"bool",defaultValue:!1}),this.addOption("delay_initial_report_millis",{type:"int",defaultValue:1e3}),this.addOption("error_throttle_millis",{type:"int",defaultValue:6e4}),this.addOption("logger",{type:"function",defaultValue:this._printToConsole.bind(this)}),this.addOption("clear_span_buffer_consecutive_errors",{type:"int",defaultValue:null}),this.addOption("certificate_verification",{type:"bool",defaultValue:!0}),this.addOption("override_transport",{type:"any",defaultValue:null}),this.addOption("silent",{type:"bool",defaultValue:!1}),this.addOption("log_field_key_hard_limit",{type:"int",defaultValue:256}),this.addOption("log_field_value_hard_limit",{type:"int",defaultValue:1024}),this.addOption("disable_meta_event_reporting",{type:"bool",defaultValue:!1})}},{key:"_startSpan",value:function(t,e){var n=this,r=null;if((e=e||{}).references)for(var o=0;o<e.references.length;o++){var i=e.references[o],s=i.type();if(s===this._opentracing.REFERENCE_CHILD_OF||s===this._opentracing.REFERENCE_FOLLOWS_FROM){i=i.referencedContext();if(i){r=i;break}this._error("Span reference has an invalid context",i)}}var a=r?r.traceGUID():this.generateTraceGUIDForRootSpan(),u=!r||r._sampled,c=new p.default(this._platform.generateUUID(),a,u),l=new _.default(this,t,c);return l.addTags(this._options.default_span_tags),(0,f.default)(e,function(t,e){switch(e){case"references":break;case"startTime":l.setBeginMicros(Math.floor(1e3*t));break;case"tags":l.addTags(t);break;default:n._warn("Ignoring unknown field '"+e+"'")}}),null!==r&&(l.setParentGUID(r._guid),r.forEachBaggageItem(function(t,e){return c.setBaggageItem(t,e)})),this.emit("start_span",l),w.shouldSendMetaSpan(this.options(),l.getTags())&&this.startSpan(O.LS_META_SP_START,{tags:(v(t={},O.LS_META_EVENT_KEY,!0),v(t,O.LS_META_TRACE_KEY,l.traceGUID()),v(t,O.LS_META_SPAN_KEY,l.guid()),t)}).finish(),l}},{key:"_inject",value:function(t,e,n){var r;switch(!0===this.options().meta_event_reporting&&this.startSpan(O.LS_META_INJECT,{tags:(v(r={},O.LS_META_EVENT_KEY,!0),v(r,O.LS_META_TRACE_KEY,t._traceGUID),v(r,O.LS_META_SPAN_KEY,t._guid),v(r,O.LS_META_PROPAGATION_KEY,e),r)}).finish(),e){case this._opentracing.FORMAT_HTTP_HEADERS:this._propagators[this._opentracing.FORMAT_HTTP_HEADERS].inject(t,n);break;case this._opentracing.FORMAT_TEXT_MAP:this._propagators[this._opentracing.FORMAT_TEXT_MAP].inject(t,n);break;case this._opentracing.FORMAT_BINARY:this._propagators[this._opentracing.FORMAT_BINARY].inject(t,n);break;default:this._error("Unknown format: "+e)}}},{key:"_extract",value:function(t,e){var n,r=null;switch(t){case this._opentracing.FORMAT_HTTP_HEADERS:r=this._propagators[this._opentracing.FORMAT_HTTP_HEADERS].extract(e);break;case this._opentracing.FORMAT_TEXT_MAP:r=this._propagators[this._opentracing.FORMAT_TEXT_MAP].extract(e);break;case this._opentracing.FORMAT_BINARY:r=this._propagators[this._opentracing.FORMAT_BINARY].extract(e);break;default:return this._error("Unsupported format: "+t),null}return!0===this.options().meta_event_reporting&&r&&this.startSpan(O.LS_META_EXTRACT,{tags:(v(n={},O.LS_META_EVENT_KEY,!0),v(n,O.LS_META_TRACE_KEY,r._traceGUID),v(n,O.LS_META_SPAN_KEY,r._guid),v(n,O.LS_META_PROPAGATION_KEY,t),n)}).finish(),r}},{key:"flush",value:function(t){if(t=t||function(){},this._options.disabled)return this._warn("Manual flush() called in disabled state."),t(null);this._flushReport(!0,!1,t)}},{key:"guid",value:function(){return this._runtimeGUID}},{key:"verbosity",value:function(){var t=this._options.verbosity;return void 0===t?1:t}},{key:"generateTraceGUIDForRootSpan",value:function(){var t=this._platform.generateUUID();return this._activeRootSpan&&(t=this._activeRootSpan.traceGUID()),t}},{key:"setPlatformOptions",value:function(t){var n=this._platform.options(this)||{};(0,f.default)(t,function(t,e){n[e]=t}),this.options(n)}},{key:"addOption",value:function(t,e){e.name=t,this._optionDescs.push(e),this._options[e.name]=e.defaultValue}},{key:"options",value:function(e){var n=this;if(0===arguments.length)return console.assert("object"==typeof this._options,"Internal error: _options field incorrect"),this._options;if("object"!=typeof e)throw new Error("options() must be called with an object: type was "+typeof e);0===e.collector_port&&delete e.collector_port,void 0!==e.collector_encryption&&void 0===e.collector_port&&(e.collector_port="none"!==e.collector_encryption?443:80),this.meta_event_reporting=!1;var r,o,i={},s={};(0,f.default)(this._optionDescs,function(t){n._setOptionInternal(i,s,e,t)}),Object.keys(e).forEach(function(t){void 0===i[t]&&void 0===s[t]&&n._warn("Invalid option "+t+" with value "+e[t])}),this._initReportingDataIfNeeded(i),this._reportingLoopActive||this._startReportingLoop(),3<=this.verbosity()&&(r="",(o=0,f.default)(i,function(t,e){r+="\t"+JSON.stringify(e)+": "+JSON.stringify(t.newValue)+"\n",o++}),0<o&&this._debug("Options modified:\n"+r)),this.emit("options",i,this._options,this)}},{key:"_setOptionInternal",value:function(t,e,n,r){var o=r.name,i=n[o],s=typeof i;if(void 0!==i){switch(r.type){case"any":break;case"bool":if(!0!==i&&!1!==i)return void this._error("Invalid boolean option '"+o+"' '"+i+"'");break;case"function":if("function"!=typeof i)return void this._error("Invalid function option '"+o+"' '"+i+"'");break;case"int":if("number"!=s||Math.floor(i)!==i)return void this._error("Invalid int option '"+o+"' '"+i+"'");if(void 0!==r.min&&void 0!==r.max&&!(i>=r.min&&i<=r.max))return void this._error("Option '"+o+"' out of range '"+i+"' is not between "+r.min+" and "+r.max);break;case"string":switch(s){case"string":break;case"number":i=T.toString(i);break;default:return void this._error("Invalid string option "+o+" "+i)}break;case"array":if("[object Array]"!==Object.prototype.toString.call(i))return void this._error("Invalid type for array option "+o+": found '"+s+"'");break;default:return void this._error("Unknown option type '"+r.type+"'")}n=this._options[o];if(void 0===n)throw new Error("Attempt to set unknown option "+o);"object"==s||n!==i?(t[o]={oldValue:n,newValue:i},this._options[o]=i):e[o]=!0}}},{key:"_initReportingDataIfNeeded",value:function(t){var n=this;if(null===this._auth){this._runtimeGUID=this._platform.runtimeGUID(this._options.component_name),this._auth=new u.default(this._options.access_token);var r={};(0,f.default)(this._options.tags,function(t,e){"string"==typeof t?r[e]=t:n._error("Tracer tag value is not a string: key="+e)}),r["lightstep.tracer_version"]=S.version;var e=this._platform.tracerTags();(0,f.default)(e,function(t,e){r[e]=t}),this._runtime=new c.default(this._runtimeGUID,this._startMicros,this._options.component_name,r),this._info("Initializing reporting data",{component_name:this._options.component_name,access_token:this._auth.getAccessToken()}),this.emit("reporting_initialized")}else{if(!this._runtime)return this._error("Inconsistent state: auth initialized without runtime.");if(t.access_token)throw new Error("Cannot change access_token after it has been set.");if(t.component_name)throw new Error("Cannot change component_name after it has been set.");if(t.collector_host)throw new Error("Cannot change collector_host after the connection is established");if(t.collector_port)throw new Error("Cannot change collector_port after the connection is established");if(t.collector_path)throw new Error("Cannot change collector_path after the connection is established");if(t.collector_encryption)throw new Error("Cannot change collector_encryption after the connection is established")}}},{key:"getLogFieldKeyHardLimit",value:function(){return this._options.log_field_key_hard_limit}},{key:"getLogFieldValueHardLimit",value:function(){return this._options.log_field_value_hard_limit}},{key:"addPlatformPlugins",value:function(t){var e=this,t=this._platform.plugins(t);(0,f.default)(t,function(t){e.addPlugin(t)})}},{key:"addPlugin",value:function(t){var e=t.name();this._plugins[e]||(this._plugins[e]=t).addOptions(this)}},{key:"startPlugins",value:function(){var n=this;(0,f.default)(this._plugins,function(t,e){n._plugins[e].start(n)})}},{key:"addActiveRootSpan",value:function(t){this._activeRootSpanSet[t._guid]=t,this._setActiveRootSpanToYoungest()}},{key:"removeActiveRootSpan",value:function(){}