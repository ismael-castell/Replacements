/* Azure Media Player v2.3.7 | (c) 2016 Microsoft Corporation */
function ObjectIron(a){var b;for(b=[],i=0,len=a.length;i<len;i+=1)b.push(a[i].isRoot?"root":a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):d[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)){if(h=b.indexOf(i),-1!==h)if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=f.childNodes,o=0;o<n.length;o++){var l=n.item(o),m=d(l);if(i.__cnt++,null==i[m])i[m]=h(l),i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m];else{if(null!=i[m]&&!(i[m]instanceof Array)){var p=i[m];i[m]=new Array,i[m][0]=p,i[m+"_asArray"]=i[m]}for(var q=0;null!=i[m][q];)q++;i[m][q]=h(l)}}for(var r=0;r<f.attributes.length;r++){var s=f.attributes.item(r);i.__cnt++;for(var v=s.value,w=0,x=a.length;x>w;w++){var y=a[w];y.test.call(this,s.value)&&(v=y.converter.call(this,s.value),i[b+s.name+y.suffix()]=v,v=null)}v&&(i[b+s.name]=v)}var z=e(f);return null!=z&&""!=z&&(i.__cnt++,i.__prefix=z),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}var AzureHtml5JS;!function(a){!function(a){"use strict";function b(a,b){k(a,3,b)}function c(a,b){k(a,2,b)}function d(a,b){k(a,1,b)}function e(a){n=a}function f(a){void 0===a||null===a?o.forEach(function(a,b,c){c[b]=!0}):o[a]=!0}function g(a){void 0===a||null===a?o.forEach(function(a,b,c){c[b]=!1}):o[a]=!1}function h(a){"undefined"==typeof a&&(a=!0),q=a}function i(a){"undefined"==typeof a&&(a=!0);var b=r;return a&&(r=""),b}function j(a,b){s=a,t=b}function k(a,b,c){if(s&&n>=b)return void s(t,b,m[a]+": "+c);var d=new Date(Date.now());if(n>=b&&o[a]){var e="["+d.getHours()+":"+d.getMinutes()+":"+(d.getSeconds()+d.getMilliseconds()/1e3).toFixed(3)+"] "+l[b]+": "+m[a]+": "+c;q&&(r+="\n"+e)}}!function(a){a[a.none=0]="none",a[a.error=1]="error",a[a.warning=2]="warning",a[a.verbose=3]="verbose"}(a.Level||(a.Level={}));var l=a.Level;!function(a){a[a.workflowSequencer=0]="workflowSequencer",a[a.workflowCoordinator=1]="workflowCoordinator",a[a.htmlAdapter=2]="htmlAdapter",a[a.videoElementAdapter=3]="videoElementAdapter",a[a.manifestParser=4]="manifestParser",a[a.httpDataRetriever=5]="httpDataRetriever",a[a.dashUrlFormatter=6]="dashUrlFormatter",a[a.azureHTML5=7]="azureHTML5",a[a.heuristics=8]="heuristics",a[a.segmentLocator=9]="segmentLocator",a[a.mediaParser=10]="mediaParser",a[a.mp4Parser=11]="mp4Parser",a[a.encrypted=12]="encrypted",a[a.common=13]="common",a[a.functionalTest=14]="functionalTest",a[a.ad=15]="ad",a[a.ttml=16]="ttml",a[a.context=17]="context",a[a.max=18]="max"}(a.Area||(a.Area={}));var m=a.Area;a.verbose=b,a.warning=c,a.error=d,a.setConsoleOutputByLevel=e,a.enableConsoleOutputByArea=f,a.disableConsoleOutputByArea=g,a.enableMemoryLog=h,a.getMemoryLog=i,a.setLoggerFunction=j;for(var n=0,o=[],p=0;18>p;p++)o.push(!1);var q=!1,r="",s=void 0,t=null;a.enableConsoleOutputByArea(),a.setConsoleOutputByLevel(1)}(a.Log||(a.Log={}));a.Log}(AzureHtml5JS||(AzureHtml5JS={})),Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=[{type:"duration",test:function(a){return h.test(a)},converter:function(f){var g=h.exec(f),i=parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0);return i=parseFloat(i.toFixed(9))},suffix:function(){return""}},{type:"datetime",test:function(a){return i.test(a)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)},suffix:function(){return""}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return parseFloat(a)},suffix:function(){return""}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return a},suffix:function(){return"_str"}}],l=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},m=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},o=function(){var a=[];return a.push(l()),a.push(m()),a.push(n()),a},p=function(a,b){var c,d=new X2JS(k,"",!0),e=new ObjectIron(o()),f=new Date,g=null,h=null;try{c=d.xml_str2json(a),g=new Date,c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray[0],0!==c.BaseURL.toString().indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,e.run(c),h=new Date,this.debug.log("Parsing complete: ( xml2json: "+(g.getTime()-f.getTime())+"ms, objectiron: "+(h.getTime()-g.getTime())+"ms, total: "+(h.getTime()-f.getTime())/1e3+"s)")}catch(i){return this.errHandler.manifestError("parsing the manifest failed","parse",a),null}return c};return{debug:void 0,errHandler:void 0,parse:p}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},function(){function a(a){function b(a){if(this.data="",this.read=0,"string"==typeof a)this.data=a;else if(c.isArrayBuffer(a)||c.isArrayBufferView(a)){var d=new Uint8Array(a);try{this.data=String.fromCharCode.apply(null,d)}catch(e){for(var f=0;f<d.length;++f)this.putByte(d[f])}}else(a instanceof b||"object"==typeof a&&"string"==typeof a.data&&"number"==typeof a.read)&&(this.data=a.data,this.read=a.read);this._constructedStringLength=0}var c=a.util=a.util||{};c.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},c.isArrayBuffer=function(a){return"undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer},c.isArrayBufferView=function(a){return a&&c.isArrayBuffer(a.buffer)&&void 0!==a.byteLength},c.ByteBuffer=b,c.ByteStringBuffer=b;var d=4096;c.ByteStringBuffer.prototype._optimizeConstructedString=function(a){this._constructedStringLength+=a,this._constructedStringLength>d&&(this.data.substr(0,1),this._constructedStringLength=0)},c.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},c.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},c.ByteStringBuffer.prototype.putByte=function(a){return this.putBytes(String.fromCharCode(a))},c.ByteStringBuffer.prototype.fillWithByte=function(a,b){a=String.fromCharCode(a);for(var c=this.data;b>0;)1&b&&(c+=a),b>>>=1,b>0&&(a+=a);return this.data=c,this._optimizeConstructedString(b),this},c.ByteStringBuffer.prototype.putBytes=function(a){return this.data+=a,this._optimizeConstructedString(a.length),this},c.ByteStringBuffer.prototype.putString=function(a){return this.putBytes(c.encodeUtf8(a))},c.ByteStringBuffer.prototype.putInt16=function(a){return this.putBytes(String.fromCharCode(a>>8&255)+String.fromCharCode(255&a))},c.ByteStringBuffer.prototype.putInt24=function(a){return this.putBytes(String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(255&a))},c.ByteStringBuffer.prototype.putInt32=function(a){return this.putBytes(String.fromCharCode(a>>24&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(255&a))},c.ByteStringBuffer.prototype.putInt16Le=function(a){return this.putBytes(String.fromCharCode(255&a)+String.fromCharCode(a>>8&255))},c.ByteStringBuffer.prototype.putInt24Le=function(a){return this.putBytes(String.fromCharCode(255&a)+String.fromCharCode(a>>8&255)+String.fromCharCode(a>>16&255))},c.ByteStringBuffer.prototype.putInt32Le=function(a){return this.putBytes(String.fromCharCode(255&a)+String.fromCharCode(a>>8&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>24&255))},c.ByteStringBuffer.prototype.putInt=function(a,b){var c="";do b-=8,c+=String.fromCharCode(a>>b&255);while(b>0);return this.putBytes(c)},c.ByteStringBuffer.prototype.putSignedInt=function(a,b){return 0>a&&(a+=2<<b-1),this.putInt(a,b)},c.ByteStringBuffer.prototype.putBuffer=function(a){return this.putBytes(a.getBytes())},c.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},c.ByteStringBuffer.prototype.getInt16=function(){var a=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,a},c.ByteStringBuffer.prototype.getInt24=function(){var a=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,a},c.ByteStringBuffer.prototype.getInt32=function(){var a=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,a},c.ByteStringBuffer.prototype.getInt16Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,a},c.ByteStringBuffer.prototype.getInt24Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,a},c.ByteStringBuffer.prototype.getInt32Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,a},c.ByteStringBuffer.prototype.getInt=function(a){var b=0;do b=(b<<8)+this.data.charCodeAt(this.read++),a-=8;while(a>0);return b},c.ByteStringBuffer.prototype.getSignedInt=function(a){var b=this.getInt(a),c=2<<a-2;return b>=c&&(b-=c<<1),b},c.ByteStringBuffer.prototype.getBytes=function(a){var b;return a?(a=Math.min(this.length(),a),b=this.data.slice(this.read,this.read+a),this.read+=a):0===a?b="":(b=0===this.read?this.data:this.data.slice(this.read),this.clear()),b},c.ByteStringBuffer.prototype.bytes=function(a){return"undefined"==typeof a?this.data.slice(this.read):this.data.slice(this.read,this.read+a)},c.ByteStringBuffer.prototype.at=function(a){return this.data.charCodeAt(this.read+a)},c.ByteStringBuffer.prototype.setAt=function(a,b){return this.data=this.data.substr(0,this.read+a)+String.fromCharCode(b)+this.data.substr(this.read+a+1),this},c.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},c.ByteStringBuffer.prototype.copy=function(){var a=c.createBuffer(this.data);return a.read=this.read,a},c.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},c.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},c.ByteStringBuffer.prototype.truncate=function(a){var b=Math.max(0,this.length()-a);return this.data=this.data.substr(this.read,b),this.read=0,this},c.ByteStringBuffer.prototype.toHex=function(){for(var a="",b=this.read;b<this.data.length;++b){var c=this.data.charCodeAt(b);16>c&&(a+="0"),a+=c.toString(16)}return a},c.ByteStringBuffer.prototype.toString=function(){return c.decodeUtf8(this.bytes())},c.createBuffer=function(a,b){return b=b||"raw",void 0!==a&&"utf8"===b&&(a=c.encodeUtf8(a)),new c.ByteBuffer(a)},c.encodeUtf8=function(a){return unescape(encodeURIComponent(a))},c.decodeUtf8=function(a){return decodeURIComponent(escape(a))}}return"undefined"==typeof forge&&(forge={}),a(forge)}(),function(){function a(a){a.cipher=a.cipher||{},a.cipher.algorithms=a.cipher.algorithms||{},a.cipher.createDecipher=function(b,c){var d=b;if("string"==typeof d&&(d=a.cipher.getAlgorithm(d),d&&(d=d())),!d)throw new Error("Unsupported algorithm: "+b);return new a.cipher.BlockCipher({algorithm:d,key:c,decrypt:!0})},a.cipher.registerAlgorithm=function(b,c){b=b.toUpperCase(),a.cipher.algorithms[b]=c},a.cipher.getAlgorithm=function(b){return b=b.toUpperCase(),b in a.cipher.algorithms?a.cipher.algorithms[b]:null};var b=a.cipher.BlockCipher=function(a){this.algorithm=a.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=a.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=a.decrypt,this.algorithm.initialize(a)};b.prototype.start=function(b){b=b||{};var c={};for(var d in b)c[d]=b[d];c.decrypt=this._decrypt,this._finish=!1,this._input=a.util.createBuffer(),this.output=b.output||a.util.createBuffer(),this.mode.start(c)},b.prototype.update=function(a){for(a&&this._input.putBuffer(a);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},b.prototype.finish=function(a){!a||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(b){return a(this.blockSize,b,!1)},this.mode.unpad=function(b){return a(this.blockSize,b,!0)});var b={};return b.decrypt=this._decrypt,b.overflow=this._input.length()%this.blockSize,this._decrypt||!this.mode.pad||this.mode.pad(this._input,b)?(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,b)?!1:this.mode.afterFinish&&!this.mode.afterFinish(this.output,b)?!1:!0):!1}}return"undefined"==typeof forge&&(forge={}),a(forge)}(),function(){function a(a){function b(b){if("string"==typeof b&&(b=a.util.createBuffer(b)),a.util.isArray(b)&&b.length>4){var c=b;b=a.util.createBuffer();for(var d=0;d<c.length;++d)b.putByte(c[d])}return a.util.isArray(b)||(b=[b.getInt32(),b.getInt32(),b.getInt32(),b.getInt32()]),b}a.cipher=a.cipher||{};var c=a.cipher.modes=a.cipher.modes||{};c.cbc=function(a){a=a||{},this.name="CBC",this.cipher=a.cipher,this.blockSize=a.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},c.cbc.prototype.start=function(a){if(null===a.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in a))throw new Error("Invalid IV parameter.");this._iv=b(a.iv),this._prev=this._iv.slice(0)}},c.cbc.prototype.encrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&a.length()>0))return!0;for(var d=0;d<this._ints;++d)this._inBlock[d]=this._prev[d]^a.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var d=0;d<this._ints;++d)b.putInt32(this._outBlock[d]);this._prev=this._outBlock},c.cbc.prototype.decrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&a.length()>0))return!0;for(var d=0;d<this._ints;++d)this._inBlock[d]=a.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var d=0;d<this._ints;++d)b.putInt32(this._prev[d]^this._outBlock[d]);this._prev=this._inBlock.slice(0)},c.cbc.prototype.pad=function(a){var b=a.length()===this.blockSize?this.blockSize:this.blockSize-a.length();return a.fillWithByte(b,b),!0},c.cbc.prototype.unpad=function(a,b){if(b.overflow>0)return!1;var c=a.length(),d=a.at(c-1);return d>this.blockSize<<2?!1:(a.truncate(d),!0)}}return"undefined"==typeof forge&&(forge={}),a(forge)}(),function(){function a(a){function b(b,c){var d=function(){return new a.aes.Algorithm(b,c)};a.cipher.registerAlgorithm(b,d)}function c(){k=!0,h=[0,1,2,4,8,16,32,64,128,27,54];for(var a=new Array(256),b=0;128>b;++b)a[b]=b<<1,a[b+128]=b+128<<1^283;f=new Array(256),g=new Array(256),i=new Array(4),j=new Array(4);for(var b=0;4>b;++b)i[b]=new Array(256),j[b]=new Array(256);for(var c,d,e,l,m,n,o,p=0,q=0,b=0;256>b;++b){l=q^q<<1^q<<2^q<<3^q<<4,l=l>>8^255&l^99,f[p]=l,g[l]=p,m=a[l],c=a[p],d=a[c],e=a[d],n=m<<24^l<<16^l<<8^(l^m),o=(c^d^e)<<24^(p^e)<<16^(p^d^e)<<8^(p^c^e);for(var r=0;4>r;++r)i[r][p]=n,j[r][l]=o,n=n<<24|n>>>8,o=o<<24|o>>>8;0===p?p=q=1:(p=c^a[a[a[c^e]]],q^=a[a[q]])}}function d(a,b){for(var c,d=a.slice(0),e=1,g=d.length,i=g+6+1,k=l*i,m=g;k>m;++m)c=d[m-1],m%g===0?(c=f[c>>>16&255]<<24^f[c>>>8&255]<<16^f[255&c]<<8^f[c>>>24]^h[e]<<24,e++):g>6&&m%g===4&&(c=f[c>>>24]<<24^f[c>>>16&255]<<16^f[c>>>8&255]<<8^f[255&c]),d[m]=d[m-g]^c;if(b){var n,o=j[0],p=j[1],q=j[2],r=j[3],s=d.slice(0);k=d.length;for(var m=0,t=k-l;k>m;m+=l,t-=l)if(0===m||m===k-l)s[m]=d[t],s[m+1]=d[t+3],s[m+2]=d[t+2],s[m+3]=d[t+1];else for(var u=0;l>u;++u)n=d[t+u],s[m+(3&-u)]=o[f[n>>>24]]^p[f[n>>>16&255]]^q[f[n>>>8&255]]^r[f[255&n]];d=s}return d}function e(a,b,c,d){var e,h,k,l,m,n=a.length/4-1;d?(e=j[0],h=j[1],k=j[2],l=j[3],m=g):(e=i[0],h=i[1],k=i[2],l=i[3],m=f);var o,p,q,r,s,t,u;o=b[0]^a[0],p=b[d?3:1]^a[1],q=b[2]^a[2],r=b[d?1:3]^a[3];for(var v=3,w=1;n>w;++w)s=e[o>>>24]^h[p>>>16&255]^k[q>>>8&255]^l[255&r]^a[++v],t=e[p>>>24]^h[q>>>16&255]^k[r>>>8&255]^l[255&o]^a[++v],u=e[q>>>24]^h[r>>>16&255]^k[o>>>8&255]^l[255&p]^a[++v],r=e[r>>>24]^h[o>>>16&255]^k[p>>>8&255]^l[255&q]^a[++v],o=s,p=t,q=u;c[0]=m[o>>>24]<<24^m[p>>>16&255]<<16^m[q>>>8&255]<<8^m[255&r]^a[++v],c[d?3:1]=m[p>>>24]<<24^m[q>>>16&255]<<16^m[r>>>8&255]<<8^m[255&o]^a[++v],c[2]=m[q>>>24]<<24^m[r>>>16&255]<<16^m[o>>>8&255]<<8^m[255&p]^a[++v],c[d?1:3]=m[r>>>24]<<24^m[o>>>16&255]<<16^m[p>>>8&255]<<8^m[255&q]^a[++v]}a.aes=a.aes||{},a.aes.Algorithm=function(a,b){k||c();var d=this;d.name=a,d.mode=new b({blockSize:16,cipher:{encrypt:function(a,b){return e(d._w,a,b,!1)},decrypt:function(a,b){return e(d._w,a,b,!0)}}}),d._init=!1},a.aes.Algorithm.prototype.initialize=function(b){if(!this._init){var c,e=b.key;if("string"!=typeof e||16!==e.length&&24!==e.length&&32!==e.length){if(a.util.isArray(e)&&(16===e.length||24===e.length||32===e.length)){c=e,e=a.util.createBuffer();for(var f=0;f<c.length;++f)e.putByte(c[f])}}else e=a.util.createBuffer(e);if(!a.util.isArray(e)){c=e,e=[];var g=c.length();if(16===g||24===g||32===g){g>>>=2;for(var f=0;g>f;++f)e.push(c.getInt32())}}if(!a.util.isArray(e)||4!==e.length&&6!==e.length&&8!==e.length)throw new Error("Invalid key parameter.");var h=this.mode.name,i=-1!==["CFB","OFB","CTR","GCM"].indexOf(h);this._w=d(e,b.decrypt&&!i),this._init=!0}},a.aes._expandKey=function(a,b){return k||c(),d(a,b)},a.aes._updateBlock=e,b("AES-CBC",a.cipher.modes.cbc);var f,g,h,i,j,k=!1,l=4}return"undefined"==typeof forge&&(forge={}),a(forge)}(),!function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(d._eak_seen=e,f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var g,h=e[a],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)k.push("exports"===i[l]?g={}:b(c(i[l])));var n=j.apply(this,k);return f[a]=g||n}}(),a("promise/all",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function d(a){return function(b){f(a,b)}}function f(a,c){h[a]=c,0===--i&&b(h)}var g,h=[],i=a.length;0===i&&b([]);for(var j=0;j<a.length;j++)g=a[j],g&&e(g.then)?g.then(d(j),c):f(j,g)})}var d=a.isArray,e=a.isFunction;b.all=c}),a("promise/asap",["exports"],function(a){"use strict";function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new i(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){j.setTimeout(e,1)}}function e(){for(var a=0;a<k.length;a++){var b=k[a],c=b[0],d=b[1];c(d)}k=[]}function f(a,b){var c=k.push([a,b]);1===c&&g()}var g,h="undefined"!=typeof window?window:{},i=h.MutationObserver||h.WebKitMutationObserver,j="undefined"!=typeof global?global:void 0===this?window:this,k=[];g="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():i?c():d(),a.asap=f}),a("promise/config",["exports"],function(a){"use strict";function b(a,b){return 2!==arguments.length?c[a]:void(c[a]=b)}var c={instrument:!1};a.config=c,a.configure=b}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){"use strict";function d(){var a;a="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var b="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),f(b)}();b||(a.Promise=e)}var e=a.Promise,f=b.isFunction;c.polyfill=d}),a("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){if(!v(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],j(a,this)}function j(a,b){function c(a){o(b,a)}function d(a){q(b,a)}try{a(c,d)}catch(e){d(e)}}function k(a,b,c,d){var e,f,g,h,i=v(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;n(b,e)||(i&&g?o(b,e):h?q(b,f):a===D?o(b,e):a===E&&q(b,e))}function l(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+D]=c,e[f+E]=d}function m(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],k(b,c,d,f);a._subscribers=null}function n(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(u(b)&&(d=b.then,v(d)))return d.call(b,function(d){return c?!0:(c=!0,void(b!==d?o(a,d):p(a,d)))},function(b){return c?!0:(c=!0,void q(a,b))}),!0}catch(e){return c?!0:(q(a,e),!0)}return!1}function o(a,b){a===b?p(a,b):n(a,b)||p(a,b)}function p(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(r,a))}function q(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(s,a))}function r(a){m(a,a._state=D)}function s(a){m(a,a._state=E)}var t=a.config,u=(a.configure,b.objectOrFunction),v=b.isFunction,w=(b.now,c.all),x=d.race,y=e.resolve,z=f.reject,A=g.asap;t.async=A;var B=void 0,C=0,D=1,E=2;i.prototype={constructor:i,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;t.async(function(){k(c._state,d,e[c._state-1],c._detail)})}else l(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}},i.all=w,i.race=x,i.resolve=y,i.reject=z,h.Promise=i}),a("promise/race",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){for(var d,e=0;e<a.length;e++)d=a[e],d&&"function"==typeof d.then?d.then(b,c):b(d)})}var d=a.isArray;b.race=c}),a("promise/reject",["exports"],function(a){"use strict";function b(a){var b=this;return new b(function(b,c){c(a)})}a.reject=b}),a("promise/resolve",["exports"],function(a){"use strict";function b(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=this;return new b(function(b){b(a)})}a.resolve=b}),a("promise/utils",["exports"],function(a){"use strict";function b(a){return c(a)||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}();var Uint8ArrayUtil={};!function(){Uint8ArrayUtil.subarray=function(a,b){return this.slice(a,b)},Uint8ArrayUtil.set_=function(a,b){arguments.length<2&&(b=0);for(var c=0,d=a.length;d>c;++c,++b)this[b]=255&a[c]},Uint8ArrayUtil.TypedArray=function(a){var b;if("number"==typeof a){b=new Array(a);for(var c=0;a>c;++c)b[c]=0}else b=a.slice(0);return b.subarray=Uint8ArrayUtil.subarray,b.buffer=b,b.byteLength=b.length,b.set=Uint8ArrayUtil.set_,"object"==typeof a&&a.buffer&&(b.buffer=a.buffer),b}}(),void 0===window.Uint8Array&&(window.Uint8Array=Uint8ArrayUtil.TypedArray);var AzureHtml5JS;!function(a){"use strict";function b(a,b,c){return new d(a,b,c)}a.CreateAzureHtml5=b,function(a){a[a.internalErrStart=0]="internalErrStart",a[a.internalErrDisposed=0]="internalErrDisposed",a[a.internalErrSegmentNotFound=1]="internalErrSegmentNotFound",a[a.internalErrEnd=1048575]="internalErrEnd"}(a.ErrorCode||(a.ErrorCode={}));var c=(a.ErrorCode,function(){function a(){}return a.exception="exception",a.flushvideo="flushvideo",a.audiocodecchanged="audiocodecchanged",a}());a.InternalEventName=c;var d=function(){function b(b,c,d){this._sessionContext=new a.Context.Session(this,b,c,d),this._playerType=null,this._autoplay=!0,this._type="",this._error=null,this._dispose=!1,this._retryAttempt=!1,this._oldPlaybackRateBeforePlay=null,this._passThroughEventNames=[a.EventName.volumechange,a.EventName.ended,a.EventName.timeupdate,a.EventName.pause,a.EventName.play,a.EventName.playing,a.EventName.seeking,a.EventName.seeked,a.EventName.suspend,a.EventName.loadstart,a.EventName.loadeddata,a.EventName.ratechange],this._conditionalEventNames=[a.EventName.waiting,a.EventName.canplaythrough,a.EventName.error],this._registerVideoTagEvents(!0),this._registerInternalEvents(!0)}return b.prototype.setStaleDataTimeLimit=function(a){this._sessionContext.maxBufferBehindCurrentTimeInSec=a},b.prototype.dispose=function(){this._dispose=!0,this._workflowCoordinator&&(this._workflowCoordinator.dispose(),this._workflowCoordinator=null),this._sessionContext&&(this._registerVideoTagEvents(!1),this._registerInternalEvents(!1),this._sessionContext.dispose(),this._sessionContext=null),this._error=null},Object.defineProperty(b.prototype,"currentVideoStreamList",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.videoStreamList:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentAudioStreamList",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.audioStreamList:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"src",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.src:this._sessionContext.videoTag.src},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentTime",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.currentTime:this._sessionContext.videoTag.currentTime},set:function(b){a.Log.verbose(7,"currentTime: "+b+" sec"),this._workflowCoordinator?this._workflowCoordinator.currentTime=b:this._sessionContext.videoTag.currentTime=b;

},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentAbsoluteTime",{get:function(){return this._sessionContext.videoTag.currentTime},set:function(b){a.Log.verbose(7,"currentAbsoluteTime: "+b+" sec"),this._workflowCoordinator?this._workflowCoordinator.currentPresentationTime=b:this._sessionContext.videoTag.currentTime=b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentMediaTime",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.currentMediaTime:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"presentationTimeOffsetInSec",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.presentationTimeOffsetInSec:null},enumerable:!0,configurable:!0}),b.prototype.presentationTimeFromPercentageOfDvrWindow=function(a){return this._workflowCoordinator?this._workflowCoordinator.presentationTimeFromPercentageOfDvrWindow(a):null},Object.defineProperty(b.prototype,"currentDownloadBitrate",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.downloadBitrate:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentPlaybackBitrate",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.playbackBitrate:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"videoBufferData",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.videoBufferData:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioBufferData",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.audioBufferData:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"volume",{get:function(){return this._sessionContext.videoTag.volume},set:function(b){a.Log.verbose(7,"volume: "+b.toString());var c=b;if(0/0!==b&&void 0!==b&&null!==b){0>b?c=0:b>1&&(c=1);try{this._sessionContext.videoTag.volume=c}catch(d){a.Log.warning(7,"set volume() error: "+d)}}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoplay",{get:function(){return this._autoplay},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"paused",{get:function(){return this._sessionContext.videoTag.paused},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"seeking",{get:function(){return this._sessionContext.videoTag.seeking},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ended",{get:function(){return this._sessionContext.videoTag.ended},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this._sessionContext.videoTag.height},set:function(a){this._sessionContext.videoTag.height=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return this._sessionContext.videoTag.width},set:function(a){this._sessionContext.videoTag.width=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"videoHeight",{get:function(){return this._sessionContext.videoTag.videoHeight},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"videoWidth",{get:function(){return this._sessionContext.videoTag.videoWidth},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isFullScreen",{get:function(){var a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;return a===this._sessionContext.videoTag?document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled:!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isLive",{get:function(){return!!this._sessionContext.commonPresentation&&this._sessionContext.commonPresentation.isLive},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"duration",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.duration:this._sessionContext.videoTag.duration},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buffered",{get:function(){if(this._workflowCoordinator)return this._workflowCoordinator.buffered;try{return this._sessionContext.videoTag.buffered}catch(b){return a.Log.warning(7,"buffered() error: "+b),new a.Common.TimeRangeSet}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"manifestPlayableWindowLength",{get:function(){return this._sessionContext&&this._sessionContext.commonPresentation&&this._sessionContext.commonPresentation.isLive?this._sessionContext.commonPresentation.timeShiftBufferDepth:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentPlayableWindow",{get:function(){return this._sessionContext&&this._sessionContext.commonPresentation&&this._sessionContext.commonPresentation.isLive?new a.Common.TimeRange(this._sessionContext.commonPresentation.playableWindow.startInSec,this._sessionContext.commonPresentation.playableWindow.endInSec):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"playableWindowEndInSec",{get:function(){return this._sessionContext&&this._sessionContext.commonPresentation&&this._sessionContext.commonPresentation.playableWindow?this._sessionContext.commonPresentation.playableWindow.endInSec:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"segmentBoundaries",{get:function(){return this._sessionContext&&this._sessionContext.commonPresentation?this._sessionContext.commonPresentation.segmentBoundaries:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"error",{get:function(){return this._workflowCoordinator&&this._workflowCoordinator.error?this._workflowCoordinator.error:this._error},enumerable:!0,configurable:!0}),b.prototype.getWallClockTime=function(a,b,c,d,e){a=a||this.currentAbsoluteTime,b=b||!1,c=c||0,e=e||!1,(null===d||void 0===d)&&(d=!0);var f=null;if(this._sessionContext.commonPresentation){var g=this._sessionContext.commonPresentation.getWallClockTimeAtPresentationTime(a);if(g){var h=null;if(b===!0)h=this.getDetailsFromDateObject(g,"local",d,e);else{if(0!==c){var i=36e5*c;g=new Date(g.getTime()+i)}h=this.getDetailsFromDateObject(g,"utc",d,e)}if(!h||h.length<7)return null;var j=h[0],k=h[1],l=h[2],m=h[3],n=h[4],o=h[5],p=h[6];f=e?m+":"+n+":"+o+" "+p:b===!1&&0===c?j+"-"+k+"-"+l+"T"+m+":"+n+":"+o+"Z":j+"-"+k+"-"+l+"T"+m+":"+n+":"+o+this.getTimezoneTimeOffset(g,b,c)}}return f},b.prototype.getTimezoneTimeOffset=function(a,b,c){var d=b===!0?-1*a.getTimezoneOffset()/60:c,e=d%1*60;d=Math.floor(d);var f=Math.abs(d)>=10?Math.abs(d).toString():"0"+Math.abs(d).toString(),g=0===e?":00":":"+e.toString();return d>=0?"+"+f+g:"-"+f+g},b.prototype.getDetailsFromDateObject=function(a,b,c,d){if("utc"!==b&&"local"!==b)return null;var e={year:a.getUTCFullYear,month:a.getUTCMonth,day:a.getUTCDate,hours:a.getUTCHours,minutes:a.getUTCMinutes,seconds:a.getUTCSeconds},f={year:a.getFullYear,month:a.getMonth,day:a.getDate,hours:a.getHours,minutes:a.getMinutes,seconds:a.getSeconds},g={utc:e,local:f},h=g[b].year.call(a).toString(),i=(g[b].month.call(a)+1).toString();i=1==i.length?"0"+i:i;var j=g[b].day.call(a).toString();j=1==j.length?"0"+j:j;var k=g[b].hours.call(a).toString();k=1==k.length?"0"+k:k;var l=g[b].minutes.call(a).toString();l=1==l.length?"0"+l:l;var m=g[b].seconds.call(a).toString();m=1==m.length?"0"+m:m;var n="";if(c&&d){var o=parseInt(k);n=12>o?"AM":"PM",k=((o+11)%12+1).toString()}return[h,i,j,k,l,m,n]},b.prototype.canPlayType=function(b){return a.PlayerType.getByPresentationType(b,this._sessionContext.videoTag)?"maybe":""},b.prototype.setSrc=function(a,b){this.setSrcInternal(a,b,!1)},b.prototype.setSrcInternal=function(c,d,e){this._playStarted=!1;var f="",g=0;return e?g=b._dtsOffsetToAddForChrome:(this._src=c,this._options=d?d:null,this._retryAttempt=!1),"https:"===window.location.protocol.toLowerCase()&&0===c.toLowerCase().indexOf("http:")?(f="The page was loaded over HTTPS, but the source was set to serve over HTTP. The content must be served over HTTPS. Source URL: "+c+", Page URL: "+window.location.href,a.Log.error(7,f),void this._handleError(new a.Failure.External(1048578,f))):(this._sessionContext.reset(),this._reset(d),this._playerType=a.PlayerType.getByPresentationType(this._type,this._sessionContext.videoTag),this._playerType||(a.Log.verbose(7,"Unable to determine player type by presentation type. Trying the url method..."),this._playerType=a.PlayerType.getByUrl(c,this._sessionContext.videoTag)),a.Log.verbose(7,"src: "+c+" autoplay: "+this._autoplay+" type: "+(this._type&&this._type.length>0?this._type:"unknown")+" player: "+(null===this._playerType?"unknown":a.PlayerDetector.Type[this._playerType])),this._workflowCoordinator&&(this._workflowCoordinator.dispose(),this._workflowCoordinator=null),void(1===this._playerType?(this._sessionContext.videoTag.autoplay=this._autoplay,this._sessionContext.videoTag.src=c):3===this._playerType?(this._workflowCoordinator=a.Workflow.CreateCoordinator(this._sessionContext),this._workflowCoordinator.dtsOffsetToAdd=g,this._sessionContext.videoTag.autoplay=!1,this._workflowCoordinator.autoplay=this._autoplay,this._workflowCoordinator.src=c):(a.Log.error(7,c+" not supported by AzureHtml5 Video Element"),this._handleError(new a.Failure.External(4194307,c)))))},b.prototype.play=function(){a.Log.verbose(7,"play"),this._oldPlaybackRateBeforePlay=this.playbackRate(),this._workflowCoordinator?this._workflowCoordinator.play():this._sessionContext&&this._sessionContext.videoTag&&a.Common.videoTagPlay(this._sessionContext.videoTag)},b.prototype.pause=function(){a.Log.verbose(7,"pause"),this._workflowCoordinator?this._workflowCoordinator.pause():this._sessionContext&&this._sessionContext.videoTag&&this._sessionContext.videoTag.pause()},b.prototype.requestFullscreen=function(){a.Log.verbose(7,"requestFullscreen");var b=!1;if(!this.isFullScreen){var c=this._sessionContext.videoTag;c.requestFullscreen?(b=!0,c.requestFullscreen()):c.msRequestFullscreen?(b=!0,c.msRequestFullscreen()):c.webkitRequestFullscreen?(b=!0,c.webkitRequestFullscreen()):c.mozRequestFullScreen&&(b=!0,c.mozRequestFullScreen()),b&&this._sessionContext.eventMgr.dispatchEvent(a.EventName.fullscreenchange)}},b.prototype.exitFullscreen=function(){a.Log.verbose(7,"exitFullscreen");var b=!1;this.isFullScreen&&(document.exitFullscreen?(b=!0,document.exitFullscreen()):document.webkitExitFullscreen?(b=!0,document.webkitExitFullscreen()):document.mozCancelFullScreen?(b=!0,document.mozCancelFullScreen()):document.msExitFullscreen&&(b=!0,document.msExitFullscreen()),b&&this._sessionContext.eventMgr.dispatchEvent(a.EventName.fullscreenchange))},b.prototype.playbackRate=function(){return this._sessionContext.videoTag.playbackRate},b.prototype.setPlaybackRate=function(a){this._sessionContext.videoTag.playbackRate=a},b.prototype.addEventListener=function(a,b,c){"undefined"==typeof c&&(c=null),this._sessionContext.eventMgr.addHandler(a,b,c)},b.prototype.removeEventListener=function(a,b){this._sessionContext.eventMgr.removeHandler(a,b)},b.prototype.addKeySystem=function(a){return this._sessionContext.emeManager.addKeySystem(a)},b.prototype.setXmlHttpRequestFactory=function(a){this._sessionContext.setXmlHttpRequestFactory(a)},b.prototype.getAdSignalsAndReset=function(){return this._sessionContext.adManager.getAdSignalsAndReset()},b.prototype.restartCheckMediaWorkflowIfNeeded=function(){this._workflowCoordinator.restartCheckMediaWorkflowIfNeeded()},b.prototype._reset=function(a){function b(a){c._dispose||c._handleError(a)}var c=this;this._playerType=null,this._autoplay=!0,this._type="",this._error=null,a&&(this._type=a.type,"autoPlay"in a&&(this._autoplay=a.autoPlay),"authenticationTokens"in a&&(this._sessionContext.authenticationTokens=a.authenticationTokens),a.userConfig&&this._sessionContext.setUserConfig(a.userConfig),a.headers&&this._sessionContext.setRequestedDownloadHeaders(a.headers)),this._sessionContext.emeManager.setup(b,this._sessionContext.authenticationTokens)},b.prototype._registerVideoTagEvents=function(b){function c(b){f._dispose||f._error||(b.type&&(b.type===a.EventName.play||b.type===a.EventName.playing)&&(f._playStarted=!0,null!==f._oldPlaybackRateBeforePlay&&f._oldPlaybackRateBeforePlay!==f.playbackRate()&&(a.Log.verbose(7,"playback rate changed from: "+f._oldPlaybackRateBeforePlay+" to: "+f.playbackRate()+". Restoring the original playback rate!"),f.setPlaybackRate(f._oldPlaybackRateBeforePlay),f._oldPlaybackRateBeforePlay=null)),b.type===a.EventName.timeupdate&&f._workflowCoordinator&&f._workflowCoordinator.pendingPlay?a.Log.verbose(7,"skip dispatching event: "+b.type+" currentTime: "+f._sessionContext.videoTag.currentTime+" since work flow is in pending play state"):(a.Log.verbose(7,"dispatching event: "+b.type+" currentTime: "+f._sessionContext.videoTag.currentTime),f._sessionContext.eventMgr.dispatchEvent(b.type)))}function d(b){if(!f._dispose&&!f._error)if(a.EventName.error===b.type){if(f._sessionContext.videoTag.readyState===HTMLMediaElement.HAVE_NOTHING)return void a.Log.warning(7,"Ignoring video element error since state is HAVE_NOTHING "+a.Failure.mediaErrorToString(f._sessionContext.videoTag.error));var c=new a.Failure.External;c.translateMediaError(f._sessionContext.videoTag.error),f._handleError(c)}else f._workflowCoordinator||(a.Log.verbose(7,"dispatching event: "+b.type),f._sessionContext.eventMgr.dispatchEvent(b.type))}var e=this,f=this;this._passThroughEventNames.forEach(function(a){b?e._sessionContext.videoTag.addEventListener(a,c):e._sessionContext.videoTag.removeEventListener(a,c)}),this._conditionalEventNames.forEach(function(a){b?e._sessionContext.videoTag.addEventListener(a,d):e._sessionContext.videoTag.removeEventListener(a,d)})},b.prototype._registerInternalEvents=function(b){function d(b){function c(){var c,d=b;throw c=d.message&&d.message.message&&d.message.stack?d.message.message+", "+d.message.stack:d.message,a.Log.error(7,"Throwing error "+c),new Error(c)}e._dispose||b.message&&!e._checkErrorAndRetryPlayback()&&a.Util.setTimeout(c,0)}var e=this;b?this._sessionContext.eventMgr.addHandler(c.exception,d,this):this._sessionContext.eventMgr.removeHandler(c.exception,d)},b.prototype._checkErrorAndRetryPlayback=function(){return this._playStarted||!a.Common.isChrome||this._retryAttempt?!1:(a.Log.verbose(7,"Retrying Playback with Adjusted DTS"),this._retryAttempt=!0,this.setSrcInternal(this._src,this._options,!0),!0)},b.prototype._handleError=function(b){if(!(this._checkErrorAndRetryPlayback()||this._workflowCoordinator&&this._workflowCoordinator.error)){if(this._error=b,this._workflowCoordinator){var c=new Error;a.Log.verbose(7,"Disposing WorkflowCoordinator b/c "+b.toString()+", "+c.stack),this._workflowCoordinator.dispose(),this._workflowCoordinator=null}a.Log.verbose(7,"dispatching event: "+a.EventName.error),this._sessionContext.eventMgr.dispatchEvent(a.EventName.error)}},b._dtsOffsetToAddForChrome=.1,b}()}(AzureHtml5JS||(AzureHtml5JS={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function c(){this._disposed=!1,this._bandwidthTracker=null,this._buffer=null,this._downloadRequested=null,this._downloadCompleted=null,this._downloadDecrypted=null,this._downloadFailed=null,this._downloadTracker=null,this._eventMgr=new a.Events.Manager(null,!1)}return c.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._bandwidthTracker=null,this._buffer=null,this._downloadRequested=null,this._downloadCompleted=null,this._downloadDecrypted=null,this._downloadFailed=null,this._eventMgr&&(this._eventMgr.dispose(),this._eventMgr=null),this._downloadTracker&&(this._downloadTracker.dispose(),this._downloadTracker=null))},Object.defineProperty(c.prototype,"bufferLevel",{get:function(){return this._disposed||!this._buffer?null:this._buffer.getBufferedAheadOfCurrentTimeInSec()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"perceivedBandwidth",{get:function(){return this._disposed||!this._bandwidthTracker?null:this._bandwidthTracker.perceivedBandwidth()},enumerable:!0,configurable:!0}),c.prototype.updateBuffer=function(a){this._buffer=a},c.prototype.updateBandwidthTracker=function(a){this._bandwidthTracker=a,this._downloadTracker&&this._downloadTracker.dispose(),this._downloadTracker=new b.DownloadTracker},c.prototype.getPlaybackBitrate=function(a){return this._disposed||!this._downloadTracker?-1:this._downloadTracker.findBitrate(a)},Object.defineProperty(c.prototype,"downloadRequested",{get:function(){return this._downloadRequested},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"downloadCompleted",{get:function(){return this._downloadCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"downloadDecrypted",{get:function(){return this._downloadDecrypted},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"downloadFailed",{get:function(){return this._downloadFailed},enumerable:!0,configurable:!0}),c.prototype.dispatchDownloadRequested=function(b){this._downloadRequested=b,this._eventMgr.dispatchEvent(a.BufferDataEventName.downloadrequested)},c.prototype.dispatchDownloadCompleted=function(b,c,d){if(this._downloadCompleted=new e(b,c,d),this._eventMgr.dispatchEvent(a.BufferDataEventName.downloadcompleted),this._downloadTracker&&null!=b.mediaTime&&(this._downloadTracker.add(b.mediaTime,b.bitrate),this._buffer.buffered&&this._buffer.buffered.length>0)){var f=this._buffer.buffered.start(0);this._downloadTracker.cleanup(f)}},c.prototype.dispatchDownloadDecrypted=function(b){this._downloadDecrypted=b,this._eventMgr.dispatchEvent(a.BufferDataEventName.downloaddecrypted)},c.prototype.dispatchDownloadFailed=function(b,c,d){"undefined"==typeof d&&(d=""),this._downloadFailed=new f(b,c,d),this._eventMgr.dispatchEvent(a.BufferDataEventName.downloadfailed)},c.prototype.addEventListener=function(a,b,c){this._eventMgr.addHandler(a,b,c)},c.prototype.removeEventListener=function(a,b){this._eventMgr.removeHandler(a,b)},c}();b.BufferData=c;var d=function(){function a(a,b,c,d,e,f,g){this._url=a,this._bitrate=b,this._mediaTime=c,this._data=d,this._presentationTimeOffsetInSec=e,this._timeScale=f,this._durationInSec=g}return Object.defineProperty(a.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bitrate",{get:function(){return this._bitrate},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mediaTime",{get:function(){return this._mediaTime},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"presentationTimeOffsetInSec",{get:function(){return this._presentationTimeOffsetInSec},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"timeScale",{get:function(){return this._timeScale},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"durationInSec",{get:function(){return this._durationInSec},enumerable:!0,configurable:!0}),a}();b.MediaDownload=d;var e=function(){function a(a,b,c){this._mediaDownload=a,this._measuredBw=1e3*b.bandwidth,this._bytes=b.responseLengthInBytes,this._downloadTimeMs=b.totalDownloadTimeMs,this._responseHeaders=c}return Object.defineProperty(a.prototype,"mediaDownload",{get:function(){return this._mediaDownload},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"measuredBandwidth",{get:function(){return this._measuredBw},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"totalBytes",{get:function(){return this._bytes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"totalDownloadMs",{get:function(){return this._downloadTimeMs},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"responseHeaders",{get:function(){return this._responseHeaders},enumerable:!0,configurable:!0}),a}();b.MediaDownloadCompleted=e;var f=function(){function a(a,b,c){this._mediaDownload=a,this._code=b,this._message=c}return Object.defineProperty(a.prototype,"code",{get:function(){return this._code},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mediaDownload",{get:function(){return this._mediaDownload},enumerable:!0,configurable:!0}),a}();b.MediaDownloadFailed=f;var g=function(a){function b(b,c,d,e,f,g,h,i){a.call(this,b,c,d,e,f,g,h),this._decryptionTimeInMS=i}return __extends(b,a),Object.defineProperty(b.prototype,"decryptionTimeInMS",{get:function(){return this._decryptionTimeInMS},enumerable:!0,configurable:!0}),b}(d);b.MediaDecrypted=g}(a.Context||(a.Context={}));a.Context}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";!function(a){a[a.proceed=0]="proceed",a[a.endOfStream=1]="endOfStream",a[a.retry=2]="retry"}(b.RequestState||(b.RequestState={}));b.RequestState;!function(a){a[a.arraybuffer=0]="arraybuffer",a[a.blob=1]="blob",a[a.document=2]="document",a[a.json=3]="json",a[a.text=4]="text"}(b.ResponseType||(b.ResponseType={}));b.ResponseType;!function(a){a[a.manifest=0]="manifest",a[a.mediaSegment=1]="mediaSegment",a[a.initSegment=2]="initSegment",a[a.initBandwidth=3]="initBandwidth"}(b.RequestType||(b.RequestType={}));var c=(b.RequestType,function(){function c(c,d,e,f){this.maxBufferBehindCurrentTimeInSec=-1,this.azureHtml5=c,this.videoTag=d,this.appConfig=f,this.emeManager=new a.KeySystem.EmeManager(d),this.eventMgr=new a.Events.Manager(c,!1),this.emeManager.setEventManager(this.eventMgr),this.adManager=new a.Ad.Manager(this.eventMgr),this.ttmlManager=new a.Ttml.Manager(e),this.workflows=null,this.presentationUrl=null,this.presentationQueryStr=null,this.presentationJson=null,this.commonPresentation=null,this.isLiveToVod=!1,this.videoBufferData=new b.BufferData,this.audioBufferData=new b.BufferData,this.textBufferData=new b.BufferData,this.startPositionInSec=0/0,this.authenticationTokens={},this.heuristicSettings=new a.Settings.Heuristics,this.httpRetryPolicySettings=new a.Settings.HttpRetryPolicy,this.httpDataRetrieverSettings=new a.Settings.HttpDataRetriever,this.decryptionTracker=new a.Heuristics.DecryptionTracker,this._disposed=!1,this._xmlHttpRequestFactory=null}return c.prototype.dispose=function(){this._disposed||(this._disposed=!0,this.videoTag=null,this.appConfig=null,this.workflows&&this.workflows.forEach(function(a){a.dispose()}),this.workflows=null,this.presentationUrl=null,this.presentationQueryStr=null,this.presentationJson=null,this.authenticationTokens=null,this._xmlHttpRequestFactory=null,this.azureHtml5=null,this.emeManager&&(this.emeManager.dispose(),this.emeManager=null),this.eventMgr&&(this.eventMgr.dispose(),this.eventMgr=null),this.adManager&&(this.adManager=null),this.ttmlManager&&(this.ttmlManager=null),this.commonPresentation&&(this.commonPresentation.dispose(),this.commonPresentation=null),this.heuristicSettings=null,this.decryptionTracker=null,this.videoBufferData&&(this.videoBufferData.dispose(),this.videoBufferData=null),this.audioBufferData&&(this.audioBufferData.dispose(),this.audioBufferData=null),this.textBufferData&&(this.textBufferData.dispose(),this.textBufferData=null))},Object.defineProperty(c.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),c.prototype.reset=function(){this.presentationUrl=null,this.presentationQueryStr=null,this.presentationJson=null,this.startPositionInSec=0/0,this.authenticationTokens={},this.commonPresentation&&(this.commonPresentation.dispose(),this.commonPresentation=null),this.emeManager&&this.emeManager.reset(),this.heuristicSettings&&this.heuristicSettings.reset(),this.videoBufferData&&(this.videoBufferData.dispose(),this.videoBufferData=new b.BufferData),this.audioBufferData&&(this.audioBufferData.dispose(),this.audioBufferData=new b.BufferData),this.textBufferData&&(this.textBufferData.dispose(),this.textBufferData=new b.BufferData),this.adManager&&this.adManager.reset(),this.ttmlManager&&this.ttmlManager.reset()},c.prototype.setRequestedDownloadHeaders=function(a){this.headers=a},c.prototype.setUserConfig=function(a){void 0!==a.maxBufferInWallClockSec&&(this.heuristicSettings.buffer.maxBufferInWallClockSec=a.maxBufferInWallClockSec),void 0!==a.prerollPercent&&(this.heuristicSettings.buffer.prerollPercent=a.prerollPercent),void 0!==a.livePlaybackOffsetPercent&&(this.heuristicSettings.buffer.livePlaybackOffsetPercent=a.livePlaybackOffsetPercent),void 0!==a.windowSizeHeuristicsEnabled&&(this.heuristicSettings.windowSizeHeuristicsEnabled=a.windowSizeHeuristicsEnabled),void 0!==a.useBrowserWindowForWindowSizeRule&&(this.heuristicSettings.useBrowserWindowForWindowSizeRule=a.useBrowserWindowForWindowSizeRule),void 0!==a.minFragmentsForBandwidthAverage&&(this.heuristicSettings.bandwidth.minBandwidthHistoryCount=a.minFragmentsForBandwidthAverage),void 0!==a.bandwidthTestWithTimeThresholdDuringLive&&(this.heuristicSettings.bandwidth.bandwidthTestWithTimeThresholdDuringLive=a.bandwidthTestWithTimeThresholdDuringLive),void 0!==a.useVariableFragmentSizeMode&&(this.heuristicSettings.bandwidth.useVariableFragmentSizeMode=a.useVariableFragmentSizeMode),void 0===a.decryptionTimeHeuristicsEnabled||a.decryptionTimeHeuristicsEnabled||(this.decryptionTracker=null),void 0!==a.preFetchDataEnabled&&(this.heuristicSettings.preFetchDataEnabled=a.preFetchDataEnabled),void 0!==a.maxRetryPerSegment&&(this.httpRetryPolicySettings.maxRetryPerSegment=a.maxRetryPerSegment),void 0!==a.maxSkipSegments&&(this.httpRetryPolicySettings.maxSkipSegments=a.maxSkipSegments),void 0!==a.maxTotalRetries&&(this.httpRetryPolicySettings.maxTotalRetries=a.maxTotalRetries),void 0!==a.infiniteSegmentRetryForPreconditionFailed&&(this.httpRetryPolicySettings.infiniteSegmentRetryForPreconditionFailed=a.infiniteSegmentRetryForPreconditionFailed),void 0!==a.maxRetriesForKeyAcquireFailure&&(this.httpRetryPolicySettings.maxRetriesForKeyAcquireFailure=a.maxRetriesForKeyAcquireFailure),void 0!==a.maxWaitTimeBetweenRetriesForKeyAcquireMS&&(this.httpRetryPolicySettings.maxWaitTimeBetweenRetriesForKeyAcquireMS=a.maxWaitTimeBetweenRetriesForKeyAcquireMS)},c.prototype.maxBufferInWallClockSec=function(){return this.appConfig&&this.appConfig.maxBufferInWallClockSec&&"0"!=this.appConfig.maxBufferInWallClockSec?parseInt(this.appConfig.maxBufferInWallClockSec):this.heuristicSettings.buffer.maxBufferInWallClockSec},c.prototype.maxBufferInSec=function(){return this.maxBufferInWallClockSec()*this.playbackRate()},c.prototype.prerollBufferInSec=function(){return this.maxBufferInSec()*this.heuristicSettings.buffer.prerollPercent},c.prototype.lowBufferInSec=function(){return this.maxBufferInSec()*this.heuristicSettings.vodDowngradeBufferLevelPercent*this.heuristicSettings.buffer.lowBufferPercent},c.prototype.liveStartBufferInSec=function(){return this.maxBufferInSec()*(this.heuristicSettings.buffer.prerollPercent+this.heuristicSettings.buffer.livePlaybackOffsetPercent)},c.prototype.updatePresentation=function(b){if(this.commonPresentation){var c=b.isLive&&null!==b.periods[0].streams.findFirst(function(a){return(0===a.type||1===a.type)&&!a.segments});c?a.Log.verbose(17,"New manifest without segments no presentationUpdate was done."):(this.commonPresentation.isLive&&!b.isLive&&(this.isLiveToVod=!0),this.commonPresentation.transferPresentationState(b),this.presentationJson=b.toJson()),b.dispose()}else this.commonPresentation=b,this.presentationJson=b.toJson()},c.prototype.setXmlHttpRequestFactory=function(a){this._xmlHttpRequestFactory=a},c.prototype.createXmlHttpRequest=function(){return this._xmlHttpRequestFactory?this._xmlHttpRequestFactory():new a.HttpRequest.XMLHttpRequestWrapper},c.prototype.playbackRate=function(){return this.azureHtml5.playbackRate()},c}());b.Session=c;var d=function(){function a(a,b){this.workflowType=a,this.sessionContext=b,this.state=0,this.retryWaitTimeMSec=0,this.currentModuleId=null,this.requestedStream=null,this.urlsToRetrieve=[],this.selectedTrack=null,this.selectedSegment=null,this.heuristicData=null,this.externalFailure=null,this.failTracker=new h,this._disposed=!1}return a.prototype.dispose=function(){this._disposed||(this._disposed=!0,this.workflowType=null,this.sessionContext=null,this.state=null,this.currentModuleId=null,this.requestedStream=null,this.urlsToRetrieve.forEach(function(a,b,c){c[b].dispose()}),this.urlsToRetrieve=[],this.selectedTrack=null,this.selectedSegment=null,this.heuristicData&&(this.heuristicData.dispose(),this.heuristicData=null),this.externalFailure&&(this.externalFailure.dispose(),this.externalFailure=null),this.failTracker&&(this.failTracker.dispose(),this.failTracker=null))},a.prototype.reset=function(){this.state=0,this.retryWaitTimeMSec=0,this.currentModuleId=null,this.selectedTrack=null,this.selectedSegment=null,1===this.workflowType&&(this.urlsToRetrieve=[]),this.heuristicData&&this.heuristicData.reset(),this.externalFailure=null},Object.defineProperty(a.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),a}();b.Request=d;var e=function(){function a(a,b,c,d,e,f,g){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=4),"undefined"==typeof d&&(d=""),"undefined"==typeof e&&(e=0/0),"undefined"==typeof f&&(f=0/0),"undefined"==typeof g&&(g=0/0),this.url=a,this.httpResponseCode=-1,this.httpResposeContentType="",this.mediaData=null,this.presentationData=null,this.streamId=d,this.bitrate=e,this.presTimeInSec=f,this.durationInSec=g,this.responseType=c,this.requestType=b}return a.prototype.dispose=function(){this.url=null,this.httpResponseCode=null,this.httpResposeContentType="",this.mediaData=null,this.presentationData=null,this.streamId="",this.bitrate=0/0,this.presTimeInSec=0/0,this.durationInSec=0/0,this.responseType=null},a.prototype.clone=function(){var b=new a(this.url,this.requestType,this.responseType,this.streamId,this.bitrate,this.presTimeInSec,this.durationInSec);return b.httpResponseCode=this.httpResponseCode,b.httpResposeContentType=this.httpResposeContentType,b.mediaData=this.mediaData.slice(0),b.presentationData=this.presentationData,b},a}();b.UrlRequest=e;var f=function(){function a(a){var b=[];a.tracks.forEach(function(a){a.streamingInfo.selectable&&b.push(new g(a))}),this.tracksData=b}return a.prototype.dispose=function(){this.tracksData.forEach(function(a,b,c){c[b].dispose()}),this.tracksData=[]},a.prototype.reset=function(){this.tracksData.forEach(function(a,b,c){c[b].reset()})},a}();b.HeuristicData=f;var g=function(){function a(a){this.trackInfo=a,this.selectable=!0,this.dataRetrieverEstimationInWallClockSec=null}return a.prototype.dispose=function(){this.trackInfo=null,this.selectable=null,this.dataRetrieverEstimationInWallClockSec=null},a.prototype.reset=function(){this.selectable=!0,this.dataRetrieverEstimationInWallClockSec=null},a}();b.TrackData=g;var h=function(){function a(){this.reset()}return a.prototype.dispose=function(){this.lastFailure=null,this.lastTrack=null,this.tracksToTry=[]},a.prototype.reset=function(){this.lastFailure=null,this.lastTrack=null,this.lastStreamType=-1,this.totalRetried=0,this.tracksToTry=[],this.trackToTryIdx=0,this.sameRequestRetried=0,this.segmentsSkipped=0,this.noDataReceivedFailure=!1},a.prototype.resetForSegment=function(){this.sameRequestRetried=0,this.trackToTryIdx=0},a.prototype.log=function(a,b,c){this.lastFailure=a,this.lastTrack=b,this.lastStreamType=c},a.prototype.isNone=function(){return null===this.lastFailure},a.prototype.isLastNetworkFail=function(){return this.lastFailure.code>=2097752&&this.lastFailure.code<3145727},a.prototype.isLastNetworkDown=function(){return 2097753===this.lastFailure.code},a.prototype.isLastNotReady=function(){return 2097564===this.lastFailure.code},a.prototype.isLastServerError=function(){return this.lastFailure.code>=2097652&&this.lastFailure.code<=2097751;

},a.prototype.isLastNotFound=function(){return 2097556===this.lastFailure.code},a.prototype.isSegmentDecryptionError=function(){return 5242885===this.lastFailure.code},a}();b.FailTracker=h}(a.Context||(a.Context={}));a.Context}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._downloads=[]}return b.prototype.dispose=function(){this._downloads=[]},b.prototype.add=function(b,c){if(0===this._downloads.length)return void this._downloads.push({time:b,bitrate:c});var d=this._downloads[this._downloads.length-1];if(b>d.time)return void(c!=d.bitrate&&this._downloads.push({time:b,bitrate:c}));var e=a.Common.binarySearchTimeline(b,this._downloads,this._compareTime);(-1===e||b>this._downloads[e].time)&&e++,this._downloads.splice(e,this._downloads.length-e),this._downloads.push({time:b,bitrate:c})},b.prototype.findBitrate=function(b){var c=a.Common.binarySearchTimeline(b,this._downloads,this._compareTime);return-1===c?-1:this._downloads[c].bitrate},b.prototype.cleanup=function(b){if(!(this._downloads.length>0&&b<=this._downloads[0].time)){var c=a.Common.binarySearchTimeline(b,this._downloads,this._compareTime);c>0&&this._downloads.splice(0,c)}},b.prototype._compareTime=function(a,b,c){var d=0;return c?(a<b.time?d=-1:a>=c.time&&(d=1),d):b.time<=a?0:-1},b}();b.DownloadTracker=c}(a.Context||(a.Context={}));a.Context}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function c(c){var d=this;this._videoElement=c,this._errorHandler=null,this.matchedKeySystem=null,this._audioContentType=null,this._videoContentType=null,this._psshBoxes=[],this._keySystems={},this._laUrls={},this._authenticationTokens={},this._disposed=!1,this._initializedKeySystem=null,this._eventManager=null,this._useEMEv3ForPlayReady="requestMediaKeySystemAccess"in navigator&&a.Common.isChromiumEdge;var e=this._useEMEv3ForPlayReady?new b.PlayReady:new b.PlayReadyLegacy;this.addKeySystem(e);var f=new b.Widevine;this.addKeySystem(f),this._needKeyHandlerWrapper=function(a){d._needKeyHandler(a)},this._encryptedHandlerWrapper=function(a){d._encryptedHandler(a)},this._useEMEv3ForPlayReady||a.EmeUtil.listenToNeedKey(c,this._needKeyHandlerWrapper),a.EmeUtil.listenToEncrypted(c,this._encryptedHandlerWrapper)}return c.prototype.reset=function(){this.matchedKeySystem&&(this.matchedKeySystem.deactivate(),this.matchedKeySystem=null),this._psshBoxes=[],this._laUrls={},this._errorHandler=null,this._audioContentType=null,this._videoContentType=null,this._authenticationTokens={},this._initializedKeySystem=null},c.prototype.dispose=function(){this._disposed||(this._disposed=!0,this.matchedKeySystem&&(this.matchedKeySystem.deactivate(),this.matchedKeySystem=null),a.EmeUtil.unlistenToNeedKey(this._videoElement,this._needKeyHandlerWrapper),a.EmeUtil.unlistenToEncrypted(this._videoElement,this._encryptedHandlerWrapper),this._needKeyHandlerWrapper=null,this._encryptedHandlerWrapper=null,this._psshBoxes=[],this._keySystems={},this._laUrls={},this._videoElement=null,this._errorHandler=null,this._audioContentType=null,this._videoContentType=null,this._authenticationTokens=null,this._initializedKeySystem=null,this._eventManager=null)},c.prototype.setEventManager=function(a){this._eventManager=a},c.prototype.setup=function(a,b){this._errorHandler=a,this._authenticationTokens=b},c.prototype.setContentTypes=function(a,b){this._audioContentType=a,this._videoContentType=b},c.prototype.addKeySystem=function(b){var c=a.Common.uint8ArrayToHexString(b.systemId);return c&&c.length>0?(this._keySystems[c]&&a.Log.warning(12,"Overwriting "+b.name),this._keySystems[c]=b,b):null},c.prototype.addPsshBoxes=function(b){var c=this;b.forEach(function(b){var d=a.Common.uint8ArrayToHexString(b.systemId);a.Log.verbose(12,"Adding pssh box with system ID "+d),c._psshBoxes.push(b)})},c.prototype.addLaUrl=function(b,c){var d=a.Common.uint8ArrayToHexString(b);return this._keySystems[d]?(this._laUrls[d]&&this._laUrls[d]!==c&&a.Log.warning(12,"Overwriting license acquisition URL for "+this._keySystems[d].name),void(this._laUrls[d]=c)):void a.Log.warning(12,"Cannot set license acquisition URL for system ID "+d)},c.prototype._needKeyHandler=function(b){var c=this;if(!this._disposed){if(a.Log.verbose(12,"Got needKey event"),b.initData){var d=new DataView(b.initData.buffer),e=a.Mp4Util.GetPsshBoxes(d);this.addPsshBoxes(e)}this._findMatchedKeySystem().then(function(b){if(!b||null!=c._initializedKeySystem&&c._initializedKeySystem!=b.type)c._reportKeySystemNotFound();else{null==c._initializedKeySystem&&(c._initializedKeySystem=b.type);for(var d=0;d<c._psshBoxes.length;d++)if(c._psshBoxes[d].systemId.isEqual(b.systemId)){var e=new Uint8Array(c._psshBoxes[d].serialize());a.Log.verbose(12,"needKeyHandler: Sending initData to: "+b.name),b.initData(null,e,c._audioContentType,c._videoContentType)}}},function(){c._reportKeySystemNotFound()})}},c.prototype._encryptedHandler=function(b){var c=this;if(!this._disposed){if(a.Log.verbose(12,"Got encrypted event"),b.initData){var d=new DataView(b.initData),e=a.Mp4Util.GetPsshBoxes(d);this.addPsshBoxes(e)}this._findMatchedKeySystem().then(function(d){if(!d||null!=c._initializedKeySystem&&c._initializedKeySystem!=d.type)c._reportKeySystemNotFound();else{null==c._initializedKeySystem&&(c._initializedKeySystem=d.type);for(var e=a.Common.uint8ArrayToHexString(d.systemId),f=0;f<c._psshBoxes.length;f++)if(c._psshBoxes[f].systemId.isEqual(d.systemId)){var g=new Uint8Array(c._psshBoxes[f].serialize());a.Log.verbose(12,"encryptedHandler: Sending initData to: "+d.name),d.initData(b.initData,g,c._audioContentType,c._videoContentType,c._laUrls[e])}}},function(){c._reportKeySystemNotFound()})}},c.prototype._findMatchedKeySystem=function(){var b=this;return new Promise(function(c,d){function e(){if(f>=b._psshBoxes.length)return void d();var g=a.Common.uint8ArrayToHexString(b._psshBoxes[f].systemId);b._keySystems[g]?b._keySystems[g].isSupported(b._psshBoxes[f].systemId,b._audioContentType,b._videoContentType).then(function(){b.matchedKeySystem=b._keySystems[g],b.matchedKeySystem.activate(b._videoElement,b._errorHandler,b._authenticationTokens[b.matchedKeySystem.type]),b._eventManager&&b._eventManager.dispatchEvent("drmselected"),a.Log.verbose(12,"Matched key system found: "+b.matchedKeySystem.name),c(b.matchedKeySystem)},function(){++f,e()}):(++f,e())}if(b.matchedKeySystem)return void c(b.matchedKeySystem);var f=0;e()})},c.prototype._reportKeySystemNotFound=function(){var b=new a.Failure.External(5242881,"no matching keySystem found");this._errorHandler(b)},c}();b.EmeManager=c}(a.KeySystem||(a.KeySystem={}));a.KeySystem}(AzureHtml5JS||(AzureHtml5JS={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this.name="com.microsoft.playready",this.type="PlayReady",this._authenticationToken="",this._errorHandler=null,this._videoElement=null,this._active=!1,b.overrideLicenseAcquisitionUrl=a.KeySystem.PlayReady.overrideLicenseAcquisitionUrl}return Object.defineProperty(b.prototype,"systemId",{get:function(){return b.systemId},enumerable:!0,configurable:!0}),b.prototype.isSupported=function(c,d,e){return c.isEqual(b.systemId)?a.EmeUtil.isTypeSupported(this.name,d,e):new Promise(function(a,b){b()})},b.prototype.activate=function(){},b.prototype.deactivate=function(){},b.prototype.initData=function(){},b.prototype._getPlayReadyLicense=function(c,d){var e=this;return new Promise(function(f,g){var h=null,i=[],j=new DOMParser,k=j.parseFromString(c,"application/xml");if(!k.getElementsByTagName("Challenge")[0])return a.Log.error(12,"Playready: Can not find Challenge in keyMessage"),void g(new a.Failure.External(5242886,"No challenge"));var l=k.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;l&&(h=atob(l));var m=k.getElementsByTagName("name"),n=k.getElementsByTagName("value");if(m.length!=n.length)return a.Log.error(12,"Playready update, invalid header name/value pair in keyMessage"),void g(new a.Failure.External(5242886,"Invalid headers"));for(var o=0;o<m.length;o++)i[o]={name:m[o].childNodes[0].nodeValue,value:n[o].childNodes[0].nodeValue};e._authenticationToken&&e._authenticationToken.length>0&&(i[m.length]={name:a.HttpUtil.authorizationHeader,value:e._authenticationToken}),b.overrideLicenseAcquisitionUrl&&(a.Log.verbose(12,"overriding license acquisition url: "+d+" with: "+b.overrideLicenseAcquisitionUrl),d=b.overrideLicenseAcquisitionUrl),a.HttpUtil.httpRequest(d,"POST","arraybuffer",i,h).then(function(b){a.Log.verbose(12,"Processed license request"),f(new Uint8Array(b))},function(b){var c=new a.Failure.External(5242886,"Http: "+a.Common.toHexString(b.code)+", reponse: "+b.response);g(c)})})},b.prototype._reportError=function(a){this._errorHandler&&this._errorHandler(a)},b.systemId=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),b}();b.PlayReadyBase=c;var d=function(b){function d(){b.call(this),this._laUrl="",this._session=null,this._initialized=!1}return __extends(d,b),d.prototype.activate=function(a,b,c){this._videoElement=a,this._errorHandler=b,this._authenticationToken=c,this._active=!0},d.prototype.deactivate=function(){this._active&&(this._active=!1,this._session&&(a.EmeUtil.unlistenToMessage(this._session,this._messageHandler),this._session.close(),this._session=null),this._videoElement&&(this._videoElement.src="",this._videoElement.setMediaKeys(null),this._videoElement=null),this._errorHandler=null,this._laUrl="",this._authenticationToken="",this._initialized=!1)},d.prototype.initData=function(b,d,e,f){function g(a){return a.createMediaKeys()}function h(b){if(a.Log.verbose(12,"creating media key session for PlayReady"),l._session=b.createSession(),!l._session){a.Log.error(12,l.name+" createSession failed");var c=new a.Failure.External(5242881,l.name+" createSession failed");return void l._reportError(c)}a.EmeUtil.listenToMessage(l._session,i),l._session.generateRequest("cenc",d)["catch"](function(){a.Log.error(12,l.name+" generateRequest failed");var b=new a.Failure.External(5242881,l.name+" generateRequest failed");l._reportError(b)}),l._videoElement.setMediaKeys(b)["catch"](function(){a.Log.error(12,l.name+" setMediaKeys failed");var b=new a.Failure.External(5242881,l.name+" setMediaKeys failed");l._reportError(b)})}function i(a){l._messageHandler(a)}function j(b){var c=new window.URL(b);return c&&"https:"!=c.protocol?(a.Log.verbose(12,"Converting url from http to https."),"https:"+c.href.substring(c.protocol.length)):b}function k(){a.Log.verbose(12,"Ensuring license server url uses https."),l._laUrl=j(l._laUrl),c.overrideLicenseAcquisitionUrl&&(a.Log.verbose(12,"Ensuring license server url override uses https."),c.overrideLicenseAcquisitionUrl=j(c.overrideLicenseAcquisitionUrl))}var l=this;if(!this._initialized){this._initialized=!0;for(var m=new DataView(b),n=a.Mp4Util.GetPsshBoxes(m),o=0;o<n.length;o++)if(a.Common.typedArraysAreEqual(n[o].systemId,c.systemId)){this._laUrl=this.getLicenseServerURL(n[o].specificData.buffer),k();break}a.Log.verbose(12,"laUrl "+(this._laUrl?"received":"not received"));var p=a.EmeUtil.createSupportedKeySystem(this.name,e,f);p["catch"](function(){a.Log.error(12,l.name+" createSupportedKeySystem failed");var b=new a.Failure.External(5242882,l.name+" createSupportedKeySystem failed");l._reportError(b)});var q=p.then(g);q["catch"](function(){a.Log.error(12,l.name+" createMediaKeys failed");var b=new a.Failure.External(5242882,l.name+" createMediaKeys failed");l._reportError(b)}),q.then(h)["catch"](function(){a.Log.error(12,l.name+" createKeySession failed");var b=new a.Failure.External(5242882,l.name+" createKeySession failed");l._reportError(b)})}},d.prototype._messageHandler=function(a){var b=this;if("license-request"===a.messageType){var c=new window.TextDecoder("utf-16").decode(a.message);this._getPlayReadyLicense(c,this._laUrl).then(function(a){b._active&&b._session&&b._session.update(a)},function(a){b._active&&b._reportError(a)})}},d.prototype.getLicenseServerURL=function(a){if(a)for(var b=new DataView(a),c=b.getUint16(4,!0),d=6,e=new DOMParser,f=0;c>f;f++){var g=b.getUint16(d,!0);d+=2;var h=b.getUint16(d,!0);if(d+=2,1===g){var i=a.slice(d,d+h),j=String.fromCharCode.apply(null,new Uint16Array(i)),k=e.parseFromString(j,"application/xml");if(k.getElementsByTagName("LA_URL")[0]){var l=k.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(l)return l}if(k.getElementsByTagName("LUI_URL")[0]){var m=k.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(m)return m}}else d+=h}return null},d}(c);b.PlayReady=d;var e=function(b){function c(){b.call(this),this._session=null}return __extends(c,b),c.prototype.activate=function(a,b,c){this._videoElement=a,this._errorHandler=b,this._authenticationToken=c,this._active=!0},c.prototype.deactivate=function(){this._active&&(this._active=!1,this._session&&(a.EmeUtil.unlistenToKeyMessage(this._session,this._keyMessageHandler),a.EmeUtil.unlistenKeyError(this._session,this._keyErrorHandler),this._session.close(),this._session=null),this._videoElement=null,this._errorHandler=null,this._authenticationToken="")},c.prototype.initData=function(b,c,d,e){function f(a){h._keyMessageHandler(a)}function g(){h._keyErrorHandler()}var h=this;if(!this._session){var i=a.EmeUtil.createMediaKeys(this.name);if(!i){a.Log.error(12,this.name+" createMediaKeys failed");var j=new a.Failure.External(5242881,this.name+" createMediaKeys failed");return void this._reportError(j)}a.EmeUtil.setMediaKeys(this._videoElement,i);var k=e.substr(0,e.length-1);if(d){var l=d.substr(d.indexOf("=")+2);k+=", "+l}if(a.Log.verbose(12,"creating media key session for PlayReady"),this._session=i.createSession(k,c),!this._session){a.Log.error(12,this.name+" createSession failed");var j=new a.Failure.External(5242881,this.name+" createSession failed");return void this._reportError(j)}a.EmeUtil.listenToKeyMessage(this._session,f),a.EmeUtil.listenKeyError(this._session,g)}},c.prototype._keyMessageHandler=function(a){var b=this,c=new Uint16Array(a.message.buffer),d=String.fromCharCode.apply(null,c),e=a.destinationURL;this._getPlayReadyLicense(d,e).then(function(a){b._active&&b._session&&b._session.update(a)},function(a){b._active&&b._reportError(a)})},c.prototype._keyErrorHandler=function(){if(this._active&&this._session.error){var b="MSMediaKeyError code: "+this._session.error.code+", systemCode: "+a.Common.toHexString(this._session.error.systemCode),c=new a.Failure.External(5242880,b);this._reportError(c)}},c}(c);b.PlayReadyLegacy=e}(a.KeySystem||(a.KeySystem={}));a.KeySystem}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";var b=function(){function a(){this.windowSizeHeuristicsEnabled=a._windowSizeHeuristicsEnabledDefault,this.useBrowserWindowForWindowSizeRule=a._useBrowserWindowForWindowSizeRuleDefault,this.preFetchDataEnabled=a._preFetchDataEnabledDefault,this.preFetchDataMiddle=a._preFetchDataMiddleDefault,this.vodStableBufferLevelPercent=a._vodStableBufferLevelPercentDefault,this.vodDowngradeBufferLevelPercent=a._vodDowngradeBufferLevelPercentDefault,this.belowDowngradeBufferLevelDownloadTimeFactor=a._belowDowngradeBufferLevelDownloadTimeFactorDefault,this.bandwidth=null,this.stepRule=null,this.buffer=null,this.bandwidth=new c,this.stepRule=new d,this.buffer=new e}return a.prototype.reset=function(){this.windowSizeHeuristicsEnabled=a._windowSizeHeuristicsEnabledDefault,this.useBrowserWindowForWindowSizeRule=a._useBrowserWindowForWindowSizeRuleDefault,this.preFetchDataEnabled=a._preFetchDataEnabledDefault,this.preFetchDataMiddle=a._preFetchDataMiddleDefault,this.vodStableBufferLevelPercent=a._vodStableBufferLevelPercentDefault,this.vodDowngradeBufferLevelPercent=a._vodDowngradeBufferLevelPercentDefault,this.belowDowngradeBufferLevelDownloadTimeFactor=a._belowDowngradeBufferLevelDownloadTimeFactorDefault,this.bandwidth.reset(),this.stepRule.reset(),this.buffer.reset()},a._windowSizeHeuristicsEnabledDefault=!0,a._useBrowserWindowForWindowSizeRuleDefault=!1,a._preFetchDataEnabledDefault=!0,a._preFetchDataMiddleDefault=!0,a._vodStableBufferLevelPercentDefault=.7,a._vodDowngradeBufferLevelPercentDefault=.15,a._belowDowngradeBufferLevelDownloadTimeFactorDefault=.75,a}();a.Heuristics=b;var c=function(){function a(){this.bandwidthUsabilityPercent=a._bandwidthUsabilityPercentDefault,this.bandwidthDataSizeThresholdInBytes=a._bandwidthDataSizeThresholdInBytesDefault,this.bandwidthEstimationMaxKbps=a._bandwidthEstimationMaxKbpsDefault,this.bandwidthEstimationMinMsec=a._bandwidthEstimationMinMsecDefault,this.maxBandwidthHistoryCount=a._maxBandwidthHistoryCountDefault,this.minBandwidthHistoryCount=a._minBandwidthHistoryCountDefault,this.bandwidthTestWithTimeThresholdDuringLive=a._bandwidthTestWithTimeThresholdDuringLiveDefault,this.useVariableFragmentSizeMode=a._useVariableFragmentSizeModeDefault}return a.prototype.reset=function(){this.bandwidthUsabilityPercent=a._bandwidthUsabilityPercentDefault,this.bandwidthDataSizeThresholdInBytes=a._bandwidthDataSizeThresholdInBytesDefault,this.bandwidthEstimationMaxKbps=a._bandwidthEstimationMaxKbpsDefault,this.bandwidthEstimationMinMsec=a._bandwidthEstimationMinMsecDefault,this.maxBandwidthHistoryCount=a._maxBandwidthHistoryCountDefault,this.minBandwidthHistoryCount=a._minBandwidthHistoryCountDefault,this.bandwidthTestWithTimeThresholdDuringLive=a._bandwidthTestWithTimeThresholdDuringLiveDefault,this.useVariableFragmentSizeMode=a._useVariableFragmentSizeModeDefault},a._bandwidthUsabilityPercentDefault=.85,a._bandwidthDataSizeThresholdInBytesDefault=1e4,a._bandwidthEstimationMaxKbpsDefault=5e5,a._bandwidthEstimationMinMsecDefault=5,a._maxBandwidthHistoryCountDefault=5,a._minBandwidthHistoryCountDefault=1,a._bandwidthTestWithTimeThresholdDuringLiveDefault=!0,a._useVariableFragmentSizeModeDefault=!1,a}();a.Bandwidth=c;var d=function(){function a(){this.minSegmentsBeforeDowngrade=a._minSegmentsBeforeDowngradeDefault,this.minSegmentsBeforeUpgrade=a._minSegmentsBeforeUpgradeDefault,this.maxStepDownInQuality=a._maxStepDownInQualityDefault,this.maxStepUpInQuality=a._maxStepUpInQualityDefault}return a.prototype.reset=function(){this.minSegmentsBeforeDowngrade=a._minSegmentsBeforeDowngradeDefault,this.minSegmentsBeforeUpgrade=a._minSegmentsBeforeUpgradeDefault,this.maxStepDownInQuality=a._maxStepDownInQualityDefault,this.maxStepUpInQuality=a._maxStepUpInQualityDefault},a._minSegmentsBeforeDowngradeDefault=0,a._minSegmentsBeforeUpgradeDefault=1,a._maxStepDownInQualityDefault=10,a._maxStepUpInQualityDefault=3,a}();a.StepRule=d;var e=function(){function a(){this.maxBufferInWallClockSec=a._maxBufferInSecDefault,this.prerollPercent=a._prerollPercentDefault,this.livePlaybackOffsetPercent=a._livePlaybackOffsetPercentDefault,this.leftEdgeBackoffInSec=a._leftEdgeBackoffInSecDefault,this.lowBufferPercent=a._lowBufferPercentDefault}return a.prototype.reset=function(){this.maxBufferInWallClockSec=a._maxBufferInSecDefault,this.prerollPercent=a._prerollPercentDefault,this.lowBufferPercent=a._lowBufferPercentDefault,this.livePlaybackOffsetPercent=a._livePlaybackOffsetPercentDefault,this.leftEdgeBackoffInSec=a._leftEdgeBackoffInSecDefault},a._maxBufferInSecDefault=30,a._prerollPercentDefault=.25,a._lowBufferPercentDefault=.25,a._livePlaybackOffsetPercentDefault=.25,a._leftEdgeBackoffInSecDefault=4,a}();a.Buffer=e;var f=function(){function a(){this.maxTotalRetries=a._maxTotalRetriesDefault,this.maxRetryPerSegment=a._maxRetryPerSegmentDefault,this.maxRetryPresentation=a._maxRetryPresentationDefault,this.maxSkipSegments=a._maxSkipSegmentsDefault,this.retryLowerBitrateOnly=!1,this.retryMediaInMSec=a._retryMediaInMSecDefault,this.retryMediaServerErrorInMSec=a._retryMediaServerErrorInMSecDefault,this.retryPresentationInMSec=a._retryPresentationInMSecDefault,this.retryDueToNetworkErrorInMSec=a._retryDueToNetworkErrorInMSecDefault,this.retryDueTo412InTextTrackInMSecDefault=a._retryDueTo412InTextTrackInMSecDefault,this.infiniteSegmentRetryForPreconditionFailed=!1,this.maxRetriesForKeyAcquireFailure=a._maxRetriesForKeyAcquireFailure,this.maxWaitTimeBetweenRetriesForKeyAcquireMS=a._retryInMSecBetweenKeyAcquireFailures}return a._maxTotalRetriesDefault=50,a._maxRetryPerSegmentDefault=10,a._maxRetryPresentationDefault=5,a._maxSkipSegmentsDefault=30,a._retryMediaInMSecDefault=2e3,a._retryMediaServerErrorInMSecDefault=4e3,a._retryPresentationInMSecDefault=500,a._retryDueToNetworkErrorInMSecDefault=1e3,a._retryDueTo412InTextTrackInMSecDefault=500,a._maxRetriesForKeyAcquireFailure=3,a._retryInMSecBetweenKeyAcquireFailures=500,a}();a.HttpRetryPolicy=f;var g=function(){function a(){this.initBandwidthTimeoutInMSec=a._initBandwidthTimeout,this.noDataTimeoutInMSec=a._noDataTimeoutDefault,this.timeoutInMSec=a._minTimeoutInMSecDefault,this.liveEdgeAdjustmentInSec=a._liveEdgeAdjustmentDefaultInSec}return Object.defineProperty(a.prototype,"maxTimeoutInMSec",{get:function(){return 6e4},enumerable:!0,configurable:!0}),a._minTimeoutInMSecDefault=1e4,a._initBandwidthTimeout=1e3,a._noDataTimeoutDefault=1e3,a._liveEdgeAdjustmentDefaultInSec=-1,a}();a.HttpDataRetriever=g}(a.Settings||(a.Settings={}));a.Settings}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(){return new g}function d(){return window.hasOwnProperty("MediaSource")||window.hasOwnProperty("WebKitMediaSource")?!0:!1}b.CreateAdapter=c,b.supported=d;var e={closed:0,open:1,ended:2},f=function(){function a(a,b,c){this.bufferIndex=a,this.startTime=b,this.endTime=c}return a}(),g=function(){function c(){this._mediaSource=new MediaSource,this._sourceOpenHandler=null,this._adapterSourceBuffers=new h,this._disposed=!1,this._videoTag=null,this._buffered=null}return c.prototype.dispose=function(){if(!this._disposed){if(this._mediaSource){for(var a=this._mediaSource.sourceBuffers.length-1;a>=0;a--)this._mediaSource.removeSourceBuffer(this._mediaSource.sourceBuffers[a]);this._sourceOpenHandler&&(this._mediaSource.removeEventListener("sourceopen",this._sourceOpenHandler),this._sourceOpenHandler=null),this._mediaSource=null}this._adapterSourceBuffers.dispose(),this._adapterSourceBuffers=null,this._videoTag&&(this._videoTag.src&&(URL.revokeObjectURL(this._videoTag.src),this._videoTag.src=null),this._videoTag=null),this._disposed=!0}},Object.defineProperty(c.prototype,"readyState",{get:function(){return this._disposed?0:e[this._mediaSource.readyState]},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"durationInSec",{get:function(){return this._disposed?0/0:this._mediaSource.duration},set:function(a){this._disposed||(this._mediaSource.duration=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"adapterBuffers",{get:function(){return this._disposed?null:this._adapterSourceBuffers.adapterBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"buffered",{get:function(){return this._buffered},enumerable:!0,configurable:!0}),c.prototype.setVideoElementSrcAsync=function(a){var b=this;return this._videoTag=a,new Promise(function(c,d){return b._disposed?void d("VideoElementAdapter already disposed"):(b._sourceOpenHandler=function(){return b._disposed?void d("VideoElementAdapter already disposed"):(b._mediaSource.removeEventListener("sourceopen",b._sourceOpenHandler),b._sourceOpenHandler=null,void c())},b._mediaSource.addEventListener("sourceopen",b._sourceOpenHandler),void(a.src=URL.createObjectURL(b._mediaSource)))})},c.prototype.setStartTime=function(b){function d(){!e._disposed&&e._videoTag&&0===e._videoTag.currentTime&&(e._videoTag.readyState!==HTMLMediaElement.HAVE_NOTHING?(e._videoTag.currentTime=b,a.Log.verbose(3,"StartTime set: "+b)):(a.Log.verbose(3,"Video tag not ready, will retry to set StartTime to "+b),a.Util.setTimeout(d,c._setCurrentTimeTimeoutInMSec)))}var e=this;d()},c.prototype.addAdapterBuffer=function(c,d,e,f,g){function h(){k._updateBuffered()}function i(a){e.call(k,a)}if(this._disposed)return null;var j,k=this,l=null;try{j=this._mediaSource.addSourceBuffer(c),l=new b.VideoElementAdapterBuffer(f,g,d,j,h,i,c),this._adapterSourceBuffers.add(l,j),a.Log.verbose(3,"Adapter buffer added: "+c+" Adapter buffer total: "+this._adapterSourceBuffers.length)}catch(m){a.Log.error(3,"Failed to add SourceBuffer to MediaSource: "+m)}if(null!==l&&null!==j&&"audio"===l.mediaType)try{j.changeType(c),l.hasAudioTypeChangeSupport=!0}catch(n){a.Log.verbose(3,"Adapter buffer added: "+c+" does not support type change: "+n)}return l},c.prototype.isTypeSupported=function(a){return MediaSource.isTypeSupported&&MediaSource.isTypeSupported(a)},c.prototype.removeAdapterBuffer=function(b){if(!this._disposed){var c;c=this._adapterSourceBuffers.find(b),-1!==c?(this._mediaSource.removeSourceBuffer(this._adapterSourceBuffers.sourceBuffers[c]),this._adapterSourceBuffers.remove(c),a.Log.verbose(3,"Adapter buffer removed, remaining: "+this._adapterSourceBuffers.length)):a.Log.error(3,"Failed to remove adapter buffer: instance not found")}},c.prototype.changeAdapterBufferType=function(b,c){if(this._disposed)return!1;var d,e=!1;if(d=this._adapterSourceBuffers.find(b),-1!==d)try{this._adapterSourceBuffers.sourceBuffers[d].updating&&this._adapterSourceBuffers.sourceBuffers[d].abort();var f=this._adapterSourceBuffers.sourceBuffers[d];f.changeType(c),a.Log.verbose(3,"Adapter buffer media type succesfully changed to "+c),e=!0}catch(g){a.Log.error(3,"Failed to change source buffer media type")}else a.Log.error(3,"Failed to find the source buffer to change its media type");return e},c.prototype.endOfStream=function(b){function d(){if(!e._disposed)try{f?e._mediaSource.endOfStream(f):e._mediaSource.endOfStream(),a.Log.verbose(3,"End of stream signaled")}catch(b){if(!(b.code===DOMException.INVALID_STATE_ERR&&g++<10))throw a.Log.error(3,"Failed to set end-of-stream: "+b),b;a.Log.warning(3,"MediaSource not ready, will retry: "+b),a.Util.setTimeout(d,c._retryTimeoutInMSec)}}var e=this,f=b,g=0;d()},c.prototype._updateBuffered=function(){if(!this._disposed){for(var b=this._adapterSourceBuffers.adapterBuffers,c=new a.Common.TimeRangeSet,d=this._findUniqueStartTimes(),e=0;e<d.length;e++){for(var f=d[e].startTime,g=d[e].endTime,h=!0,i=0;i<b.length;i++){var j=b[i].buffered;if(i!==d[e].bufferIndex){for(var k=!1,l=0;l<j.length;l++)if(j.start(l)<=f&&f<=j.end(l)){k=!0,j.end(l)<g&&(g=j.end(l));break}if(!k){h=!1;break}}}h&&(a.Log.verbose(3,"Intersecting buffer found ("+d[e].startTime+", "+g+")"),c.addRange(new a.Common.TimeRange(d[e].startTime,g)))}this._buffered=c}},c.prototype._findUniqueStartTimes=function(){for(var a=[],b=this._adapterSourceBuffers.adapterBuffers,c=0;c<b.length;c++)for(var d=b[c].buffered,e=0;e<d.length;e++)-1===a.findIndexOf(function(a){return a.startTime===d.start(e)})&&a.push(new f(c,d.start(e),d.end(e)));return a.sort(function(a,b){return a.startTime-b.startTime}),a},c._setCurrentTimeTimeoutInMSec=500,c._retryTimeoutInMSec=100,c}(),h=function(){function a(){this.adapterBuffers=[],this.sourceBuffers=[]}return a.prototype.dispose=function(){for(var a=this.adapterBuffers.length-1;a>=0;a--)this.adapterBuffers[a].dispose(),this.adapterBuffers[a]=null;for(var a=this.sourceBuffers.length-1;a>=0;a--)this.sourceBuffers[a]=null},Object.defineProperty(a.prototype,"length",{get:function(){if(this.sourceBuffers.length!==this.adapterBuffers.length)throw new Error("AdapterSourceBuffers in invalid state");return this.sourceBuffers.length},enumerable:!0,configurable:!0}),a.prototype.find=function(a){return this.adapterBuffers.indexOf(a)},a.prototype.add=function(a,b){this.adapterBuffers.push(a),this.sourceBuffers.push(b)},a.prototype.remove=function(a){a>=0&&a<this.sourceBuffers.length&&(this.sourceBuffers.splice(a,1),this.adapterBuffers.splice(a,1))},a}()}(a.VideoElementAdapter||(a.VideoElementAdapter={}));a.VideoElementAdapter}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(b,c,d,e,f,g,h){function i(){j._notifyBufferUpdated(),j._tryInternalRemove(),j._tryInternalAppend()}var j=this;this._disposed=!1,this._pendingBufferRanges=new a.Common.TimeRangeSet,this._sourceBuffer=e,this._maxAdapterBufferAheadInWallClockSec=b,this._maxAdapterBufferBehindCurrentTimeInSec=c,this._playbackPosFn=d,this._notifyBufferUpdated=f,this._pendingBuffer=[],this._pendingRemove=[],this._submittedRemove=null,this._appendErrorHandler=g,this._mediaType=h.split("/")[0],this._hasAudioTypeChangeSupport=!1,this._sourceBufferUpdated=function(){a.Log.verbose(3,j._decorateLogMessage("SourceBuffer 'update' event completed.")),i()},this._sourceBufferError=function(){a.Log.error(3,j._decorateLogMessage("SourceBuffer append failed with 'error' event.")),i()},this._sourceBuffer.addEventListener("update",this._sourceBufferUpdated),this._sourceBuffer.addEventListener("error",this._sourceBufferError)}return Object.defineProperty(b.prototype,"mediaType",{get:function(){return this._mediaType},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasAudioTypeChangeSupport",{get:function(){return this._hasAudioTypeChangeSupport},set:function(a){this._hasAudioTypeChangeSupport=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buffered",{get:function(){var b,c,d=new a.Common.TimeRangeSet;try{d.addRanges(this._sourceBuffer.buffered),c=d.length>0?d.end(d.length-1):0/0;for(var e=0;e<this._pendingBufferRanges.length;e++){var f=this._pendingBufferRanges.start(e),g=this._pendingBufferRanges.end(e);0===a.Common.diffTimes(f,c)?d.extendLast(g):(b=new a.Common.TimeRange(f,g),d.addRange(b)),c=g}for(var e=0;e<this._pendingRemove.length;e++){var h=this._pendingRemove[e].startInSec,i=this._pendingRemove[e].endInSec;d.removeRange(h,i)}if(this._submittedRemove){var h=this._submittedRemove.startInSec,i=this._submittedRemove.endInSec;d.removeRange(h,i)}}catch(j){a.Log.error(3,this._decorateLogMessage("buffered() threw exception "+j))}return d},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"presentationTimeOffsetInSec",{get:function(){return this._sourceBuffer.timestampOffset},set:function(a){this._sourceBuffer.timestampOffset=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTracks",{get:function(){return this._sourceBuffer.audioTracks},enumerable:!0,configurable:!0}),b.prototype.getBufferedAheadOfCurrentTimeInSec=function(){if(this._disposed)return 0;var a=this.buffered,b=this._playbackPosFn(),c=0;if(0===a.length)return 0;for(var d=0;d<a.length;d++)a.start(d)<=b&&b<a.end(d)?c+=a.end(d)-b:b<a.start(d)&&(c+=a.end(d)-a.start(d));return c},b.prototype.bufferFull=function(a){return this.getBufferedAheadOfCurrentTimeInSec()>this._maxAdapterBufferAheadInWallClockSec*a},b.prototype.contains=function(a){for(var b=this.buffered,c=0;c<b.length;c++)if(b.start(c)<=a&&a<b.end(c))return!0;return!1},b.prototype.dispose=function(){if(!this._disposed){this._disposed=!0,this._sourceBuffer.removeEventListener("update",this._sourceBufferUpdated),this._sourceBuffer.removeEventListener("error",this._sourceBufferError),this._notifyBufferUpdated=null,this._playbackPosFn=null,this._appendErrorHandler=null,this._sourceBufferUpdated=null,this._sourceBufferError=null;for(var a=this._pendingBuffer.length-1;a>=0;a--)this._pendingBuffer[a]=null;this._sourceBuffer=null;for(var a=this._pendingRemove.length-1;a>=0;a--)this._pendingRemove[a]=null;this._submittedRemove&&(this._submittedRemove=null),this._pendingBufferRanges&&(this._pendingBufferRanges.dispose(),this._pendingBufferRanges=null)}},b.prototype.flushBufferBehindCurrentTime=function(){if(this._maxAdapterBufferBehindCurrentTimeInSec>0)try{var b=this._playbackPosFn()-this._maxAdapterBufferBehindCurrentTimeInSec,c=this.getStartTimeOfCurrentBuffered();c!=0/0&&c>=0&&b>c&&this.flushUntil(b)}catch(d){a.Log.warning(3,this._decorateLogMessage("Ignoring Exception in flushBufferBehindCurrentTim"));

}},b.prototype.append=function(b,c,d){this.flushBufferBehindCurrentTime();var e,f,g,h;for(h=0;h<this._pendingBuffer.length&&!(c<this._pendingBuffer[h].presTimeInSec);h++);if(d){if(h>0){f=this._pendingBuffer[h-1];var i=a.Common.diffTimes(c,f.presTimeInSec+f.durationInSec);if(i>0)throw new Error(this._decorateLogMessage("append ("+c+","+d+") failed, overlaps with ("+f.presTimeInSec+","+f.durationInSec+")"))}if(h<this._pendingBuffer.length){g=this._pendingBuffer[h];var i=a.Common.diffTimes(g.presTimeInSec,c+d);if(i>0)throw new Error(this._decorateLogMessage("append ("+c+","+d+") failed, overlaps with ("+g.presTimeInSec+","+g.durationInSec+")"))}}e=new a.Common.SegmentData(b,c,d),this._pendingBuffer.splice(h,0,e),this._updatePendingRanges(),a.Log.verbose(3,this._decorateLogMessage("Appending segment: "+c+" sec "+b.byteLength+" bytes")),this._tryInternalAppend(),this._notifyBufferUpdated()},b.prototype.remove=function(b,c){var d;b=Math.max(b,0),d=new a.Common.TimeRange(b,c),this._pendingRemove.push(d),a.Log.verbose(3,this._decorateLogMessage("Added to remove pending list ["+b+","+c+")")),this._tryInternalRemove()},b.prototype.flushFrom=function(a){var b=this._sourceBuffer.buffered;this._sourceBuffer.updating&&this._sourceBuffer.abort();var c=0,d=0;if(b.length>0&&(c=b.start(0)),this._pendingBuffer.length>0&&(c=Math.min(c,this._pendingBuffer[0].presTimeInSec)),this._pendingBuffer.length>0){var e=this._pendingBuffer[this._pendingBuffer.length-1];d=e.presTimeInSec+e.durationInSec}if(b.length>0&&(d=Math.max(d,b.end(b.length-1))),void 0!==a&&(c=a),d>c)this.remove(c,d);else if(0!==c||0!==d)throw new Error(this._decorateLogMessage("flush failed, endTime ("+d+") not greater than startime ("+c+")"))},b.prototype.getStartTimeOfCurrentBuffered=function(){var a=this._sourceBuffer.buffered,b=0/0;return a.length>0&&(b=a.start(0)),this._pendingBuffer.length>0&&(b=Math.min(b,this._pendingBuffer[0].presTimeInSec)),b},b.prototype.flushUntil=function(a){var b=this._sourceBuffer.buffered,c=0,d=0;if(b.length>0&&(c=b.start(0)),this._pendingBuffer.length>0&&(c=Math.min(c,this._pendingBuffer[0].presTimeInSec)),this._pendingBuffer.length>0){var e=this._pendingBuffer[this._pendingBuffer.length-1];d=e.presTimeInSec+e.durationInSec}if(b.length>0&&(d=Math.max(d,b.end(b.length-1))),d=Math.min(d,a),d>c)this.remove(c,d);else if(0!==c||0!==d)throw new Error(this._decorateLogMessage("flush failed, endTime ("+d+") not greater than startime ("+c+")"))},b.prototype._tryInternalAppend=function(){if(this._pendingBuffer&&this._sourceBuffer&&0!==this._pendingBuffer.length&&!this._sourceBuffer.updating)try{this._sourceBuffer.appendBuffer(this._pendingBuffer[0].data),a.Log.verbose(3,this._decorateLogMessage("Appended segment to SourceBuffer: "+this._pendingBuffer[0].presTimeInSec+" sec "+this._pendingBuffer[0].data.byteLength+" bytes")),this._pendingBuffer.splice(0,1),this._updatePendingRanges()}catch(b){switch(b.code){case DOMException.INVALID_STATE_ERR:case DOMException.QUOTA_EXCEEDED_ERR:a.Log.error(3,this._decorateLogMessage("Failed to append segment to SourceBuffer, will retry: "+b)),this._appendErrorHandler&&this._appendErrorHandler(this._sourceBuffer);break;default:throw a.Log.error(3,this._decorateLogMessage("Failed to append segment to SourceBuffer: "+b)),b}}},b.prototype._tryInternalRemove=function(){if(this._sourceBuffer&&(this._sourceBuffer.updating||(this._submittedRemove=null),this._pendingBuffer&&this._pendingRemove))for(;0!==this._pendingRemove.length&&!this._sourceBuffer.updating;){var b;b=this._pendingRemove[0];for(var c=this._pendingBuffer.length-1;c>=0;c--){var d,e,f;d=this._pendingBuffer[c],e=d.presTimeInSec,f=d.durationInSec,e>=b.startInSec&&e<b.endInSec&&(e+f<=b.endInSec?(this._pendingBuffer.splice(c,1),this._updatePendingRanges(),this._notifyBufferUpdated(),a.Log.verbose(3,this._decorateLogMessage("Segment removed: "+b.startInSec))):a.Log.verbose(3,this._decorateLogMessage("Failed to remove range ("+b.startInSec+", "+b.endInSec+") from \r\n                            segment ("+e+", "+(e+f)+") - range ends mid - segment")))}try{this._sourceBuffer.remove(b.startInSec,b.endInSec),this._submittedRemove=this._pendingRemove.splice(0,1)[0],a.Log.verbose(3,this._decorateLogMessage("Removing range from SourceBuffer: ["+b.startInSec+","+b.endInSec+")"))}catch(g){switch(g.code){case DOMException.INVALID_ACCESS_ERR:case DOMException.INVALID_STATE_ERR:a.Log.error(3,this._decorateLogMessage("Failed to remove segment from SourceBuffer, will retry: "+g));break;default:throw a.Log.error(3,this._decorateLogMessage("Failed to remove segment from SourceBuffer: "+g)),g}}}},b.prototype._updatePendingRanges=function(){var b,c=this,d=0/0;this._pendingBufferRanges&&(this._pendingBufferRanges.dispose(),this._pendingBufferRanges=null),this._pendingBufferRanges=new a.Common.TimeRangeSet,this._pendingBuffer.forEach(function(e){0===a.Common.diffTimes(e.presTimeInSec,d)?c._pendingBufferRanges.extendLast(e.endTimestampInSec):(b=new a.Common.TimeRange(e.presTimeInSec,e.endTimestampInSec),c._pendingBufferRanges.addRange(b)),d=e.endTimestampInSec})},b.prototype._decorateLogMessage=function(a){return this._mediaType+": "+a},b}();b.VideoElementAdapterBuffer=c}(a.VideoElementAdapter||(a.VideoElementAdapter={}));a.VideoElementAdapter}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function c(){this.name="com.widevine.alpha",this.type="Widevine",this._videoElement=null,this._errorHandler=null,this._laUrl="",this._session=null,this._active=!1,this._authenticationToken=""}return Object.defineProperty(c.prototype,"systemId",{get:function(){return c.systemId},enumerable:!0,configurable:!0}),c.prototype.isSupported=function(b,d,e){return b.isEqual(c.systemId)?a.EmeUtil.isTypeSupported(this.name,d,e):new Promise(function(a,b){b()})},c.prototype.activate=function(a,b,c){this._videoElement=a,this._errorHandler=b,this._authenticationToken=c,this._active=!0},c.prototype.deactivate=function(){this._active&&(this._active=!1,this._session&&(a.EmeUtil.unlistenToMessage(this._session,this._messageHandler),this._session.close(),this._session=null),this._videoElement&&(this._videoElement.src="",this._videoElement.setMediaKeys(null),this._videoElement=null),this._errorHandler=null,this._laUrl="",this._authenticationToken="")},c.prototype.initData=function(b,c,d,e,f){function g(a){return a.createMediaKeys()}function h(b){if(a.Log.verbose(12,"creating media key session for Widevine"),j._session=b.createSession(),!j._session){a.Log.error(12,j.name+" createSession failed");var d=new a.Failure.External(5242881,j.name+" createSession failed");return void j._reportError(d)}a.EmeUtil.listenToMessage(j._session,i),j._session.generateRequest("cenc",c)["catch"](function(){a.Log.error(12,j.name+" generateRequest failed");var b=new a.Failure.External(5242881,j.name+" generateRequest failed");j._reportError(b)}),j._videoElement.setMediaKeys(b)["catch"](function(){a.Log.error(12,j.name+" setMediaKeys failed");var b=new a.Failure.External(5242881,j.name+" setMediaKeys failed");j._reportError(b)})}function i(a){j._messageHandler(a)}var j=this;if(f&&!this._laUrl){this._laUrl=f;var k=a.EmeUtil.createSupportedKeySystem(this.name,d,e);k["catch"](function(){a.Log.error(12,j.name+" createSupportedKeySystem failed");var b=new a.Failure.External(5242882,j.name+" createSupportedKeySystem failed");j._reportError(b)});var l=k.then(g);l["catch"](function(){a.Log.error(12,j.name+" createMediaKeys failed");var b=new a.Failure.External(5242882,j.name+" createMediaKeys failed");j._reportError(b)}),l.then(h)["catch"](function(){a.Log.error(12,j.name+" createKeySession failed");var b=new a.Failure.External(5242882,j.name+" createKeySession failed");j._reportError(b)})}},c.prototype._messageHandler=function(a){var b=this;"license-request"===a.messageType&&this._getWidevineLicense(a.message,this._laUrl).then(function(a){b._active&&b._session&&b._session.update(a)},function(a){b._active&&b._reportError(a)})},c.prototype._getWidevineLicense=function(d,e){var f=this;return new Promise(function(g,h){var i=[];f._authenticationToken&&f._authenticationToken.length>0&&i.push({name:b.WidevineCustomAuthorizationHeader||a.HttpUtil.authorizationHeader,value:f._authenticationToken}),c.overrideLicenseAcquisitionUrl&&(a.Log.verbose(12,"overriding license acquisition url: "+e+" with: "+c.overrideLicenseAcquisitionUrl),e=c.overrideLicenseAcquisitionUrl),a.HttpUtil.httpRequest(e,"POST","arraybuffer",i,d).then(function(a){g(new Uint8Array(a))},function(b){var c=new a.Failure.External(5242886,"Http: "+a.Common.toHexString(b.code)+", reponse: "+b.response);h(c)})})},c.prototype._reportError=function(a){this._errorHandler&&this._errorHandler(a)},c.systemId=new Uint8Array([237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237]),c}();b.Widevine=c,b.WidevineCustomAuthorizationHeader=""}(a.KeySystem||(a.KeySystem={}));a.KeySystem}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(a){return new d(a)}b.CreateCoordinator=c;var d=function(){function c(d){var e=this;this._sessionContext=d,this._workflowSeq=b.CreateSequencer(this._sessionContext),this._mediaSource=null,this._lastPresentation=new Date(0),this._pendingPresentation=new Date,this._disposed=!1,this._pendingPlay=!0,this._pendingTryMediaRequestCount=0,this._prerollMet=!1,this._error=null,this._playbackPosInSec=null,this._pendingPlaybackPosInSec=null,this._seekingForward=!0,this._lastDuration=0,this._videoStreamList=null,this._audioStreamList=null,this._healthCheckLastTime=0,this._healthCheckPeriodInMSec=c._healthCheckPeriodMinInMSec,this._healthCheckId=a.Util.setTimeout(this._periodicHealthCheck,this._healthCheckPeriodInMSec,this),this._healthCheckRetries=0,this._dtOffsetToAdd=0,this._lastPlaybackBitrate=null,this._lastDownloadBitrate=null,this._manifestRefreshed=!1,this._registerInternalEvents(!0),this.timeBeforeSettingVideoElementSrcInMs=0,this._seekStartTime=0,this._canPlayThroughEvent=function(){e._disposed||e._pendingPlay&&e._buffersAbovePreroll()&&e._startPlayback()},this._durationChangeEvent=function(){if(!e._disposed){var b=e._sessionContext;b.eventMgr.dispatchEvent(a.EventName.durationchange),b.commonPresentation&&b.commonPresentation.isLive&&a.Util.setTimeout(f,c._durationChangeMinIntervalInMSec)}};var f=function(){if(!e._disposed){var b=e._sessionContext;b.commonPresentation&&b.commonPresentation.isLive&&(e._lastDuration!==e.duration?(e._lastDuration=e.duration,b.eventMgr.dispatchEvent(a.EventName.durationchange),a.Util.setTimeout(f,c._durationChangeMinIntervalInMSec)):0===e._lastDuration&&a.Util.setTimeout(f,c._durationChangeMinIntervalInMSec))}};this._resetHealthCheckTimeHandler=function(){e._resetHealthCheckTime()},this._resetSeekStartTimeHandler=function(){e._seekStartTime=0},this._checkPlaybackBitrate=function(){if(!e._disposed){var b=e._sessionContext.videoBufferData,c=b.getPlaybackBitrate(e.currentMediaTime);c!=e._lastPlaybackBitrate&&(e._lastPlaybackBitrate=c,e._sessionContext.eventMgr.dispatchEvent(a.EventName.playbackbitratechanged))}}}return c.prototype.dispose=function(){this._disposed||(this._registerInternalEvents(!1),this._registerVideoTagEvents(!1),this._disposed=!0,this._sessionContext=null,this._lastPresentation=null,this._pendingPresentation=null,this._canPlayThroughEvent=null,this._durationChangeEvent=null,this._resetHealthCheckTimeHandler=null,this._checkPlaybackBitrate=null,this._manifestRefreshed=!1,this._mediaSource&&(this._mediaSource.dispose(),this._mediaSource=null),this._workflowSeq&&(this._workflowSeq.dispose(),this._workflowSeq=null),this._videoStreamList&&(this._videoStreamList.dispose(),this._videoStreamList=null),this._audioStreamList&&(this._audioStreamList.dispose(),this._audioStreamList=null),this.timeBeforeSettingVideoElementSrcInMs=0,a.Util.clearTimeout(this._healthCheckId))},Object.defineProperty(c.prototype,"videoStreamList",{get:function(){return this._videoStreamList},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"audioStreamList",{get:function(){return this._audioStreamList},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"videoBufferData",{get:function(){return this._sessionContext.videoBufferData},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"audioBufferData",{get:function(){return this._sessionContext.audioBufferData},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"src",{get:function(){return this._sessionContext.presentationUrl},set:function(b){function d(b){function d(){return null!==g._playbackPosInSec&&g._sessionContext.videoTag.seeking?g._playbackPosInSec:g._sessionContext.videoTag.currentTime}function e(b){if(this._mediaSource){for(var c=this._mediaSource.sourceBuffers,d=!1,e=0;e<c.length;e++)if(c[e]===b){d=!0;break}d||g._sessionContext.eventMgr.dispatchEvent(a.InternalEventName.exception,"SourceBuffer has been removed from MediaSource")}}function f(){if(a.Log.verbose(1,"_setVideoElementSrcResolved"),g._sessionContext.eventMgr.dispatchEvent(a.EventName.mediaSourceSrcSetResolved),a.Common.isChrome){var f=Date.now();f-g.timeBeforeSettingVideoElementSrcInMs>c._timeSpentSettingVideoElementSrcThresholdInMs&&(a.Log.verbose(1,"Adjusting playable window because we spent too much time setting video element source."),i.adjustPlayableWindowForChromeSourceDelay(f))}if(!g._disposed){var h=!1;i.periods[0].streams.forEach(function(c){if(!h&&c.streamingInfo.selected&&2!==c.type){if(c.streamingInfo.sourceBuffer=g._mediaSource.addAdapterBuffer(c.codec,d,e,b.sessionContext.maxBufferInWallClockSec(),b.sessionContext.maxBufferBehindCurrentTimeInSec),!c.streamingInfo.sourceBuffer){g._error=new a.Failure.External(4194307,"presentationWorkflowResolved: Failed to create source buffer for stream "+a.Presentation.StreamType[c.type]+", codec "+c.codec),b.sessionContext.eventMgr.dispatchEvent(a.EventName.error),h=!0;var f=c.tracks;return void(f&&f.length>0&&f.forEach(function(b){var c='video/mp4;codecs="'+b._codecs+'"';a.Log.verbose(1,"MediaSource.isTypeSupported() for "+c+"= "+g._mediaSource.isTypeSupported(c))}))}0===c.type?g._sessionContext.videoBufferData.updateBuffer(c.streamingInfo.sourceBuffer):1===c.type&&g._sessionContext.audioBufferData.updateBuffer(c.streamingInfo.sourceBuffer),c.streamingInfo.sourceBuffer.presentationTimeOffsetInSec=c.presentationTimeOffsetInSec+g._dtOffsetToAdd}}),h||(g._updateStartPosition(),g._updateDuration(),g._registerVideoDownloadedEvents(),g._registerVideoTagEvents(!0),g._checkMediaWorkflow(),g._tryTimeUpdateEvent()),b.dispose()}}function h(a){throw new Error(a)}if(!g._disposed){var i=null;if(a.Log.verbose(1,"presentationWorkflowResolved"),null===b.sessionContext.commonPresentation)throw new Error("presentationWorkflowResolved: unexpected null values");i=b.sessionContext.commonPresentation,g._videoStreamList=new a.Presentation.VideoStreamList(g._sessionContext,i.periods[0].streams),g._audioStreamList=new a.Presentation.AudioStreamList(g._sessionContext,i.periods[0].streams);var j=null;g._audioStreamList&&g._audioStreamList.streams&&g._audioStreamList.streams.length>0&&g._audioStreamList.enabledIndices.length>0&&(a.assert(1==g._audioStreamList.enabledIndices.length,"Current implementation only allows one enabled stream at a time"),j=g._audioStreamList.streams[g._audioStreamList.enabledIndices[0]].codec);var k=null;g._videoStreamList&&g._videoStreamList.streams&&g._videoStreamList.streams.length>0&&-1!==g._videoStreamList.selectedIndex&&(k=g._videoStreamList.streams[g._videoStreamList.selectedIndex].codec),g._sessionContext.emeManager.setContentTypes(j,k),g._sessionContext.eventMgr.dispatchEvent(a.EventName.loadedmetadata),g._mediaSource=a.VideoElementAdapter.CreateAdapter(),g.timeBeforeSettingVideoElementSrcInMs=Date.now(),g._mediaSource.setVideoElementSrcAsync(b.sessionContext.videoTag).then(f,h)["catch"](function(b){g._sessionContext.eventMgr.dispatchEvent(a.InternalEventName.exception,b)})}}function e(b){g._disposed||(a.Log.error(1,"presentationWorkflowRejected:  module: "+b.currentModuleId),b.externalFailure&&a.Failure.isExternalError(b.externalFailure.code)&&(g._error=new a.Failure.External(b.externalFailure.code,b.externalFailure.message),a.Log.error(1,"Dispatching error: "+g.error.toString()),b.sessionContext.eventMgr.dispatchEvent(a.EventName.error)),b.dispose())}a.Log.verbose(1,"src("+b+")");var f,g=this;this._sessionContext.presentationUrl=b,f=b.indexOf("?"),-1!==f&&(this._sessionContext.presentationQueryStr=b.slice(f)),this._presentationWorkflowAsync(d,e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"dtsOffsetToAdd",{get:function(){return this._dtOffsetToAdd},set:function(a){this._dtOffsetToAdd=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pendingPlay",{get:function(){return this._pendingPlay},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"currentPresentationTime",{set:function(b){a.Log.verbose(1,"currentPresentationTime("+b.toFixed(3)+")"),this.setCurrentTimeInternal(b,!0)},enumerable:!0,configurable:!0}),c.prototype.setCurrentTimeInternal=function(b,c){var d=this._sessionContext,e=d.commonPresentation.periods[0].streams,f=!1,g=0,h=0,i=this.duration;if(d.commonPresentation.isLive){var j=d.commonPresentation.timeShiftBufferDepth||1/0,k=d.heuristicSettings.buffer.leftEdgeBackoffInSec,l=j-k;g=d.liveStartBufferInSec(),h=l>i?0:k}if(c){var m=this._fromPresentationTime(b),n=Math.max(m,h);n=Math.min(n,i-g),m!==n&&(b=this._toPresentationTime(n))}else a.Log.verbose(1,"timeInSec: "+b+", leftEdgeBackoff: "+h),b=Math.max(b,h),a.Log.verbose(1,"timeInSec: "+b+", duration: "+i+", rightEdgeBackoff: "+g),b=Math.min(b,i-g),h>b&&(a.Log.warning(1,"timeInSec: "+b+"is less than leftEdgeBackoff. Seeking to leftEdgeBackoff"),b=h),a.Log.verbose(1,"timeInSec: "+b),b=this._toPresentationTime(b);a.Log.verbose(1,"seeking from presentation time "+d.videoTag.currentTime.toFixed(3)+" to "+b.toFixed(3));for(var o=b,p=0;p<e.length;p++)if(e[p].streamingInfo.selected){var q=e[p].segments.getByInSegmentTimestamp(b);if(q)continue;q=e[p].segments.getByInDiscontinuityTimestamp(b),q&&(o=Math.max(o,q.segmentInfo.presTimeInSec))}o!==b&&(a.Log.verbose(1,"skipping discontinuity from presentation time "+b+" to "+o),b=o),this._seekingForward=b>d.videoTag.currentTime,this._playbackPosInSec=b,d.videoTag.currentTime=b,this._pendingPlaybackPosInSec=null,a.Common.diffTimes(d.videoTag.currentTime,b)&&(a.Log.verbose(1,"set currentTime failed to update videoTag: requested="+b+", actual="+d.videoTag.currentTime),this._pendingPlaybackPosInSec=b);for(var p=0;p<e.length;p++)e[p].streamingInfo.selected&&(e[p].streamingInfo.sourceBuffer?!1===e[p].streamingInfo.sourceBuffer.contains(b)?(e[p].streamingInfo.pendingSeekPositionInSec=b,e[p].streamingInfo.abortCurrentRequest=!0,e[p].streamingInfo.sourceBuffer.flushFrom(),f=!0,2===e[p].streamingInfo.workflowState&&(e[p].streamingInfo.workflowState=0),this._seekStartTime=Date.now(),a.Log.verbose(1,"Seeked position not in current buffers: "+b)):a.Log.verbose(1,"Found seeked position in current buffers"):2===e[p].type&&(e[p].streamingInfo.pendingSeekPositionInSec=b,e[p].streamingInfo.abortCurrentRequest=!0,2===e[p].streamingInfo.workflowState&&(e[p].streamingInfo.workflowState=0)));this._checkMediaWorkflow(),f||this._buffersAbovePreroll()||this._endOfSelectedStreams()||(f=!0),f&&(d.videoTag.paused||(this._pendingPlay=!0,d.eventMgr.dispatchEvent(a.EventName.waiting),d.videoTag.pause()))},c.prototype.presentationTimeFromPercentageOfDvrWindow=function(b){if(!this._sessionContext.commonPresentation)return null;var c=this._sessionContext,d=c.commonPresentation.periods[0].streams,e=0,f=0,g=this.duration;if(c.commonPresentation.isLive){var h=c.commonPresentation.timeShiftBufferDepth||1/0,i=c.heuristicSettings.buffer.leftEdgeBackoffInSec,j=h-i;e=c.liveStartBufferInSec(),f=j>g?0:i}var k=b*g;k=Math.max(k,f),k=Math.min(k,g-e),f>k&&(k=f);for(var l=this._toPresentationTime(k),m=l,n=0;n<d.length;n++)if(d[n].streamingInfo.selected){var o=d[n].segments.getByInSegmentTimestamp(l);if(o)continue;o=d[n].segments.getByInDiscontinuityTimestamp(l),o&&(m=Math.max(m,o.segmentInfo.presTimeInSec))}return m!==l&&(l=m),a.Log.verbose(1,"From percentage of window time "+Math.round(100*b)+"% return presentation time "+l.toFixed(3)+" seconds"),l},Object.defineProperty(c.prototype,"currentTime",{get:function(){var a=this._sessionContext.videoTag,b=0;return this._sessionContext.commonPresentation&&(b=null!==this._pendingPlaybackPosInSec?this._manifestRefreshed?a.currentTime:this._pendingPlaybackPosInSec:a.currentTime,b=Math.max(this._fromPresentationTime(b),0)),b},set:function(b){a.Log.verbose(1,"currentTime("+b.toFixed(3)+")"),this.setCurrentTimeInternal(b,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"presentationTimeOffsetInSec",{get:function(){var a=0;if(this._sessionContext.commonPresentation){var b=this._sessionContext.commonPresentation.periods[0].streams;b&&b[0]&&(a=b[0].presentationTimeOffsetInSec)}return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"currentMediaTime",{get:function(){var a=this._sessionContext.videoTag,b=0;return this._sessionContext.commonPresentation&&(b=null!==this._pendingPlaybackPosInSec?this._pendingPlaybackPosInSec:a.currentTime,b-=this.presentationTimeOffsetInSec),b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"downloadBitrate",{get:function(){return this._lastDownloadBitrate},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"playbackBitrate",{get:function(){return this._lastPlaybackBitrate},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"autoplay",{set:function(b){a.Log.verbose(1,"autoplay("+b+")"),this._pendingPlay=b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){var a=this._sessionContext,b=a.commonPresentation,c=1/0;if(b){var d=b.playableWindow;c=d.endInSec-d.startInSec}return Math.min(a.videoTag.duration||0,c)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"buffered",{get:function(){var b=null;if(this._mediaSource){var c=this._sessionContext.commonPresentation.playableWindow;b=new a.Common.TimeRangeSet,b.addRanges(this._mediaSource.buffered),b.rebase(c.startInSec)}return b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0}),c.prototype.play=function(){a.Log.verbose(1,"play()");var b=this._sessionContext,c=b.heuristicSettings.buffer.leftEdgeBackoffInSec,d=b.videoTag;if(!this._mediaSource)return void(this._pendingPlay=!0);0===this._mediaSource.readyState&&d.load();var e;b.commonPresentation&&b.commonPresentation.isLive&&d.paused&&!d.seeking&&(e=this._fromPresentationTime(d.currentTime))<c&&(a.Log.verbose(1,"play: skipping from "+d.currentTime+"(playable window time: "+e+") to left edge: "+c+", playable window start: "+b.commonPresentation.playableWindow.startInSec),this.currentTime=0),d.paused&&a.Common.diffTimes(d.currentTime,d.duration)<=0&&(this.currentTime=0),this._buffersAbovePreroll()||this._endOfSelectedStreams()?this._startPlayback():(this._pendingPlay=!0,b.eventMgr.dispatchEvent(a.EventName.waiting)),this._resetHealthCheckTime()},c.prototype.pause=function(){var b=this._sessionContext;a.Log.verbose(1,"pause()"),this._pendingPlay&&(this._pendingPlay=!1),b.videoTag.pause(),this._tryTimeUpdateEvent()},c.prototype._presentationWorkflowAsync=function(b,d){function e(){h._disposed||(!h._sessionContext.commonPresentation||h._sessionContext.commonPresentation.isLive)&&h._workflowSeq.presentationRequestAsync().then(f,g)["catch"](function(b){h._sessionContext.eventMgr.dispatchEvent(a.InternalEventName.exception,b)})}function f(f){if(h._disposed)return void(d&&d(f));a.Log.verbose(1,"presentationRequestResolved");var g=f.sessionContext.commonPresentation;if(null===g)throw new Error("presentationRequestResolved: unexpected null values");h._updateDuration();var i=new Date;if(g.isLive&&g.minimumUpdatePeriodInSec>0&&h._pendingPresentation<=i){var j=Math.max(c._minPresentationUpdatePeriodInMSec,1e3*g.minimumUpdatePeriodInSec);h._pendingPresentation.setTime(i.getTime()+j),a.Util.setTimeout(e,j)}h._lastPresentation=i,h._manifestRefreshed=!0,b&&(b(f),b=null)}function g(b){h._disposed||a.Log.error(1,"presentationRequestRejected:  module: "+b.currentModuleId),d&&d(b)}var h=this,i=0,j=Date.now()-h._lastPresentation.getTime();j<c._minPresentationUpdatePeriodInMSec&&(i=c._minPresentationUpdatePeriodInMSec-j),a.Util.setTimeout(e,i)},c.prototype.restartCheckMediaWorkflowIfNeeded=function(){0===this._pendingTryMediaRequestCount?(a.Log.verbose(1,"restartCheckMediaWorkflowIfNeeded: restart needed"),this._checkMediaWorkflow()):a.Log.verbose(1,"restartCheckMediaWorkflowIfNeeded: restart not needed")},c.prototype._checkMediaWorkflow=function(){function b(){if(!f._disposed){a.Log.verbose(1,"_doCheckMediaWorkflow");f._pendingTryMediaRequestCount--,g.videoTag.paused||f._endOfSelectedStreams()||!f._buffersNearEmpty()?f._buffersAbovePreroll()&&(f._dispatchCanPlayThroughEvent(),f._pendingPlay&&(a.Log.verbose(1,"_doCheckMediaWorkflow: we have a pending play. Starting the playback."),f._startPlayback())):(a.Log.verbose(1,"_doCheckMediaWorkflow: pausing play because the buffer is close to empty"),f._pendingPlay=!0,g.videoTag.pause(),g.eventMgr.dispatchEvent(a.EventName.waiting));for(var h=!1,i=0;i<g.commonPresentation.periods[0].streams.length;i++){var j=g.commonPresentation.periods[0].streams[i];if(j.streamingInfo.selected&&0===j.streamingInfo.workflowState){var k=j.streamingInfo.sourceBuffer,l=f._isBufferAheadOtherStreams(j),m=k&&j.streamingInfo.sourceBuffer.bufferFull(f._sessionContext.playbackRate()),n=f._buffersAtLiveEdge(j);k&&!l&&!m&&!n||2===j.type&&!l&&!f._textStreamTooFarAheadOfCurrentTimeDuringLive(j)?(a.Log.verbose(1,"starting media workflow "+a.Presentation.StreamType[j.type]),j.streamingInfo.workflowState=1,f._workflowSeq.mediaRequestAsync(j).then(d,e)["catch"](function(b){g.eventMgr.dispatchEvent(a.InternalEventName.exception,b)})):(a.Log.verbose(1,"_doCheckMediaWorkflow: need to retry. Stream type: "+a.Presentation.StreamType[j.type]+", sourcebuffer:"+k+", buffer is ahead of other streams: "+l+", buffer is full: "+m+", buffer is at live edge: "+n),h=!0)}else a.Log.verbose(1,"_doCheckMediaWorkflow: Stream skipped. Stream type: "+a.Presentation.StreamType[j.type]+", selected: "+j.streamingInfo.selected+", workflowState: "+j.streamingInfo.workflowState)}h&&0===f._pendingTryMediaRequestCount&&(f._pendingTryMediaRequestCount++,a.Log.verbose(1,"_doCheckMediaWorkflow: schedule try again. Pending try count = "+f._pendingTryMediaRequestCount),a.Util.setTimeout(b,c._mediaSegmentTimeoutInMSec))}}function d(b){if(!f._disposed){f._manifestRefreshed=!1;var c=b.requestedStream;c.streamingInfo.workflowState=0,1===b.state&&null===c.streamingInfo.pendingSeekPositionInSec&&(a.Log.verbose(1,"mediaRequestResolved: "+a.Presentation.StreamType[c.type]+" end of stream"),c.streamingInfo.workflowState=2,f._endOfSelectedStreams()&&(a.Log.verbose(1,"End of selected streams"),f._mediaSource.endOfStream(),f._dispatchCanPlayThroughEvent(),f._pendingPlay&&f._startPlayback()));for(var d=0;d<b.urlsToRetrieve.length;d++){if(null===b.urlsToRetrieve[d].mediaData)throw new Error("mediaRequestResolved: data is null url: "+b.urlsToRetrieve[d].url);if(c.streamingInfo){if(!c.streamingInfo.selected||null!==c.streamingInfo.pendingSeekPositionInSec){a.Log.verbose(1,"mediaRequestResolved discarding,"+(c.streamingInfo.selected?"seek in progress":"stream no longer selected ")+"url: "+b.urlsToRetrieve[d].url+"("+b.urlsToRetrieve[d].httpResposeContentType+", "+b.urlsToRetrieve[d].mediaData.byteLength+")");break}var e=b.urlsToRetrieve[d].presTimeInSec+b.urlsToRetrieve[d].durationInSec;a.Log.verbose(1,"mediaRequestResolved appending url: "+b.urlsToRetrieve[d].url+"("+b.urlsToRetrieve[d].httpResposeContentType+", "+b.urlsToRetrieve[d].mediaData.byteLength+" bytes, end time="+e+")"),2!==c.type?c.streamingInfo.sourceBuffer.append(b.urlsToRetrieve[d].mediaData,b.urlsToRetrieve[d].presTimeInSec,b.urlsToRetrieve[d].durationInSec):2===b.urlsToRetrieve[d].requestType?b.sessionContext.ttmlManager.parseInitSegment(b.urlsToRetrieve[d].mediaData)&&(b.sessionContext.ttmlManager.normalizedPresentationTimeInSeconds=c.presentationTimeOffsetInSec):b.sessionContext.ttmlManager.processTtml(c.id,b.urlsToRetrieve[d].mediaData)}}if(null!==f._pendingPlaybackPosInSec){for(var h=g.videoTag.buffered,i=!1,d=0;d<h.length;d++)if(h.start(d)<=f._pendingPlaybackPosInSec&&f._pendingPlaybackPosInSec<h.end(d)){i=!0;break}i&&(g.videoTag.currentTime=f._pendingPlaybackPosInSec,a.Common.diffTimes(g.videoTag.currentTime,f._pendingPlaybackPosInSec)&&(f._pendingPlaybackPosInSec>g.videoTag.currentTime&&f._seekingForward||f._pendingPlaybackPosInSec<g.videoTag.currentTime&&!f._seekingForward)?a.Log.verbose(1,"mediaRequestResolved failed to update videoTag currentTime: pending="+f._pendingPlaybackPosInSec+", actual="+g.videoTag.currentTime+", _seekingForward="+f._seekingForward):f._pendingPlaybackPosInSec=null)}f._checkMediaWorkflow(),b.dispose()}}function e(b){function c(b){if(!f._disposed){if(a.Log.verbose(1,"refreshPresentationWorkflowResolved"),null===b.sessionContext.commonPresentation)throw new Error("refreshPresentationWorkflowResolved: unexpected null values");e.streamingInfo.workflowState=0,f._checkMediaWorkflow(),b.dispose()}}function d(b){f._disposed||(a.Log.error(1,"refreshPresentationWorkflowRejected:  module: "+b.currentModuleId),b.externalFailure&&a.Failure.isExternalError(b.externalFailure.code)&&(f._error=new a.Failure.External(b.externalFailure.code,b.externalFailure.message),a.Log.error(1,"Dispatching error: "+f.error.toString()),b.sessionContext.eventMgr.dispatchEvent(a.EventName.error)),b.dispose())}if(!f._disposed){f._manifestRefreshed=!1;var e=b.requestedStream;if(a.Log.error(1,"mediaRequestRejected: "+a.Presentation.StreamType[b.requestedStream.type]+" module: "+b.currentModuleId),b.externalFailure){if((2097556===b.externalFailure.code||1===b.externalFailure.code||5242885===b.externalFailure.code)&&b.sessionContext.commonPresentation.isLive&&0===b.sessionContext.commonPresentation.minimumUpdatePeriodInSec&&b.failTracker.isNone())return void f._presentationWorkflowAsync(c,d);a.Failure.isExternalError(b.externalFailure.code)&&(f._error=new a.Failure.External(b.externalFailure.code,b.externalFailure.message),a.Log.error(1,"Dispatching error: "+f.error.toString()),g.eventMgr.dispatchEvent(a.EventName.error))}b.dispose()}}var f=this,g=f._sessionContext;this._pendingTryMediaRequestCount++,a.Util.setTimeout(b,0)},c.prototype._updateStartPosition=function(){var a=this._sessionContext,b=a.commonPresentation,c=a.liveStartBufferInSec(),d=1/0;b&&isNaN(a.startPositionInSec)&&(d=b.isLive?Math.max(b.playableWindow.startInSec,b.playableWindow.endInSec-c):b.playableWindow.startInSec,0!==d&&(this._mediaSource.setStartTime(d),a.startPositionInSec=d))},c.prototype._updateDuration=function(){var b,c=this._sessionContext.commonPresentation;if(c&&this._mediaSource){if(c.isLive)b=1/0;else if(this._sessionContext.isLiveToVod){if(b=c.playableWindow.endInSec,a.Common.isChrome){var d=Math.floor(1e6*b)/1e6;b=parseFloat(d.toFixed(6)),a.Log.verbose(1,"newDuration: "+b)}}else b=c.durationInSec;if(this._mediaSource.durationInSec!==b)try{this._mediaSource.durationInSec=b}catch(e){a.Log.warning(1,"ignoring set durationInSec error: "+e)}}},c.prototype._toPresentationTime=function(a){var b=this._sessionContext.commonPresentation.playableWindow.startInSec;return a+b},c.prototype._fromPresentationTime=function(a){var b=this._sessionContext.commonPresentation.playableWindow.startInSec;return a-b},c.prototype._endOfSelectedStreams=function(){if(!this._sessionContext.commonPresentation)return!1;for(var a=this._sessionContext.commonPresentation.periods[0].streams,b=0;b<a.length;b++)if(a[b].streamingInfo.selected&&2!==a[b].streamingInfo.workflowState)return!1;

return!0},c.prototype._buffersAbovePreroll=function(){var a=!0,b=this._sessionContext.videoTag;if(!this._sessionContext.commonPresentation)return!1;var c=this._sessionContext.commonPresentation.periods[0].streams;if(b.readyState<b.HAVE_METADATA)a=!1;else for(var d=0;d<c.length;d++)if(c[d].streamingInfo.selected&&2!==c[d].type&&c[d].streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()<this._sessionContext.prerollBufferInSec()){a=!1;break}return a},c.prototype._buffersNearEmpty=function(){for(var a=this._sessionContext.commonPresentation.periods[0].streams,b=0;b<a.length;b++)if(a[b].streamingInfo.selected&&2!==a[b].type&&a[b].streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()<this._sessionContext.lowBufferInSec())return!0;return!1},c.prototype._isBufferAheadOtherStreams=function(a){for(var b=0,d=1/0,e=null,f=0,g=this._sessionContext.commonPresentation.periods[0].streams,h=0;h<g.length;h++)if(g[h].streamingInfo.selected&&2!==g[h].type&&2!==g[h].streamingInfo.workflowState){b++;var i=g[h].streamingInfo.sourceBuffer.buffered;i.length>0&&i.end(i.length-1)<d&&(d=i.end(i.length-1),e=g[h],f=g[h].streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec())}if(2===a.type){if(a.streamingInfo&&a.streamingInfo.currentSegment){var j=a.streamingInfo.pendingSeekPositionInSec?a.streamingInfo.pendingSeekPositionInSec:a.streamingInfo.currentSegment.segmentInfo.presTimeInSec;return j-d>c._bufferTooFarAheadInSec}return!1}var i=a.streamingInfo.sourceBuffer.buffered;return 1===b||e===a||0===i.length?!1:a.streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()>f&&i.end(i.length-1)-d>c._bufferTooFarAheadInSec},c.prototype._buffersAtLiveEdge=function(a){var b,c,d,e=this._sessionContext.commonPresentation;return a.streamingInfo.currentSegment?(b=a.streamingInfo.currentSegment.segmentInfo,c=b.presTimeInSec+b.durationInSec,d=e.playableWindow.endInSec,e.isLive&&0===e.minimumUpdatePeriodInSec&&c>=d):!1},c.prototype._textStreamTooFarAheadOfCurrentTimeDuringLive=function(a){if(!(this._sessionContext.commonPresentation&&this._sessionContext.commonPresentation.isLive&&2===a.type&&a.streamingInfo.currentSegment&&a.streamingInfo.currentSegment.segmentInfo))return!1;var b=a.streamingInfo.pendingSeekPositionInSec?a.streamingInfo.pendingSeekPositionInSec:a.streamingInfo.currentSegment.segmentInfo.presTimeInSec+a.maxSegmentDuration;return b-this._sessionContext.videoTag.currentTime>c._textStreamTooFarAheadOfCurrentTimeThresholdInSec},c.prototype._startPlayback=function(){var b=this._sessionContext.videoTag,d=this._dtOffsetToAdd;b.buffered&&b.buffered.length>0&&b.currentTime<b.buffered.start(0)&&(a.Common.isSafari&&a.Common.isOSXElCapitanOrEarlier()&&(d+=c._startTimeThresholdInSecForSafari),b.currentTime=b.buffered.start(0)+d,a.Log.verbose(1,"_startPlayback: skipping over missing data at the beginning. currentTime: "+b.currentTime+", buffer start: "+b.buffered.start(0))),this._pendingPlay=!1,a.Common.videoTagPlay(this._sessionContext.videoTag)},c.prototype._dispatchCanPlayThroughEvent=function(){this._prerollMet||(a.Log.verbose(7,"dispatching event: canplaythrough"),this._prerollMet=!0,this._sessionContext.eventMgr.dispatchEvent(a.EventName.canplaythrough))},c.prototype._registerVideoDownloadedEvents=function(){function b(){if(!c._disposed){var b=d.downloadCompleted.mediaDownload.bitrate;b!=this._lastDownloadBitrate&&(this._lastDownloadBitrate=b,this._sessionContext.eventMgr.dispatchEvent(a.EventName.downloadbitratechanged))}}var c=this,d=this._sessionContext.videoBufferData;d.addEventListener(a.BufferDataEventName.downloadcompleted,b,this)},c.prototype._registerVideoTagEvents=function(b){var c=this._sessionContext.videoTag;b?(c.addEventListener(a.EventName.canplaythrough,this._canPlayThroughEvent),c.addEventListener(a.EventName.durationchange,this._durationChangeEvent),c.addEventListener(a.EventName.playing,this._resetHealthCheckTimeHandler),c.addEventListener(a.EventName.seeked,this._resetHealthCheckTimeHandler),c.addEventListener(a.EventName.seeked,this._resetSeekStartTimeHandler),c.addEventListener(a.EventName.timeupdate,this._checkPlaybackBitrate)):(c.removeEventListener(a.EventName.canplaythrough,this._canPlayThroughEvent),c.removeEventListener(a.EventName.durationchange,this._durationChangeEvent),c.removeEventListener(a.EventName.playing,this._resetHealthCheckTimeHandler),c.removeEventListener(a.EventName.seeked,this._resetHealthCheckTimeHandler),c.removeEventListener(a.EventName.seeked,this._resetSeekStartTimeHandler),c.removeEventListener(a.EventName.timeupdate,this._checkPlaybackBitrate))},c.prototype._registerInternalEvents=function(b){b?(this._sessionContext.eventMgr.addHandler(a.InternalEventName.flushvideo,this._flushVideoToPreroll,this),this._sessionContext.eventMgr.addHandler(a.InternalEventName.audiocodecchanged,this._handleAudioCodecChanged,this)):(this._sessionContext.eventMgr.removeHandler(a.InternalEventName.flushvideo,this._flushVideoToPreroll),this._sessionContext.eventMgr.removeHandler(a.InternalEventName.audiocodecchanged,this._handleAudioCodecChanged))},c.prototype._periodicHealthCheck=function(b){if(b._sessionContext&&b._sessionContext.videoTag){var d=b._sessionContext.videoTag;if(b._healthCheckLastTime)if(d.paused||d.seeking||d.ended||b._healthCheckLastTime!==d.currentTime)b._healthCheckRetries=0,b._healthCheckPeriodInMSec=c._healthCheckPeriodMinInMSec;else{a.Log.verbose(1,"Health Check: currentTime stopped"),b._sessionContext.eventMgr.dispatchEvent(a.EventName.playbackstalled);var e,f=d.currentTime,g=-1,h=new a.Common.TimeRangeSet;if(h.addRanges(d.buffered),e=h.getIndexByInRangeTimestamp(f),e>=0&&(h.beforeDiscontinuity(f,e)?(g=h.start(e+1),a.Log.verbose(1,"Health Check: skipping over discontinuity")):h.atOrAfterDiscontinuity(f,e)&&(g=h.start(e),a.Log.verbose(1,"Health Check: resetting on discontinuity"))),0>g&&(g=f+c._healthCheckSkipInSec,a.Log.verbose(1,"Health Check: skipping "+c._healthCheckSkipInSec+" seconds ahead"),b._healthCheckPeriodInMSec+=c._healthCheckPeriodIncrementInMSec,b._healthCheckPeriodInMSec=Math.min(b._healthCheckPeriodInMSec,c._healthCheckPeriodMaxInMSec)),a.Log.verbose(1,"Health Check: seeking from "+f+" to "+g),d.currentTime=g,-2===e){b._healthCheckRetries++;var i=b._sessionContext.commonPresentation.isLive;(!i||i&&b._healthCheckRetries>=c._healthCheckMaxRetries)&&b.pause()}}if(b._healthCheckLastTime=d.currentTime,b._seekStartTime){var j=Date.now()-b._seekStartTime;j>c._timeSpentSeekingThresholdInMs&&(a.Log.warning(1,"Spent too much time in a seek: "+j+"ms.  Trying to get the player to resume playing."),b._seekStartTime=0,b.play())}}b._healthCheckId=a.Util.setTimeout(b._periodicHealthCheck,b._healthCheckPeriodInMSec,b)},c.prototype._resetHealthCheckTime=function(){this._disposed||(this._healthCheckLastTime=0)},c.prototype._flushVideoToPreroll=function(){function b(b,c){var d=c.prerollBufferInSec(),e=c.videoTag.currentTime+Math.max(d,1.5*b.maxSegmentDuration),g=null;f.flushStream=!1;var h=b.segments.getByInSegmentTimestamp(e);h?g=h.segmentInfo.presTimeInSec:(h=b.segments.getByInDiscontinuityTimestamp(e),h&&(g=h.segmentInfo.presTimeInSec)),null!=g&&f.sourceBuffer&&f.sourceBuffer.contains(g)&&(a.Log.verbose(7,"flushing at "+g+" from track selection"),f.sourceBuffer.flushFrom(g),f.pendingSeekPositionInSec=g,2===b.streamingInfo.workflowState&&(b.streamingInfo.workflowState=0))}if(a.Common.isChromiumEdge&&this._sessionContext&&this._sessionContext.emeManager&&this._sessionContext.emeManager.matchedKeySystem&&"PlayReady"===this._sessionContext.emeManager.matchedKeySystem.type)return void a.Log.warning(7,"Ignoring flush video request.  See code comment for the reason.");var c=this._sessionContext.commonPresentation.periods[0].streams,d=c.filter(function(a){return a.streamingInfo.flushStream===!0});0===d.length&&(d=c);for(var e=0;e<d.length;e++){var f=d[e].streamingInfo;0===d[e].type&&f.selected&&b(d[e],this._sessionContext)}this._checkMediaWorkflow()},c.prototype._handleAudioCodecChanged=function(){if(a.Log.verbose(1,"_handleAudioCodecChanged"),this._disposed)return!1;for(var b=(this._sessionContext.commonPresentation,this._sessionContext.commonPresentation.periods[0].streams),c=0;c<b.length;c++)if(b[c].streamingInfo.selected&&b[c].streamingInfo.audioTrackSwitched)return this._mediaSource.changeAdapterBufferType(b[c].streamingInfo.sourceBuffer,b[c].codec);return!1},c.prototype._tryTimeUpdateEvent=function(){function b(){d.disposed||d.videoTag.paused&&d.commonPresentation&&d.commonPresentation.isLive&&(d.eventMgr.dispatchEvent(a.EventName.timeupdate),a.Util.setTimeout(b,c._timeupdateLivePausedIntervalInMSec))}if(!this._disposed){var d=this._sessionContext;b()}},c._mediaSegmentTimeoutInMSec=2e3,c._minPresentationUpdatePeriodInMSec=1e3,c._bufferTooFarAheadInSec=4,c._textStreamTooFarAheadOfCurrentTimeThresholdInSec=2,c._timeupdateLivePausedIntervalInMSec=1e3,c._durationChangeMinIntervalInMSec=1e3,c._healthCheckPeriodMinInMSec=1e3,c._healthCheckPeriodMaxInMSec=5e3,c._healthCheckPeriodIncrementInMSec=2e3,c._healthCheckSkipInSec=.5,c._healthCheckMaxRetries=2,c._startTimeThresholdInSecForSafari=.2,c._timeSpentSettingVideoElementSrcThresholdInMs=100,c._timeSpentSeekingThresholdInMs=8e3,c}()}(a.Workflow||(a.Workflow={}));a.Workflow}(AzureHtml5JS||(AzureHtml5JS={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},AzureHtml5JS;!function(a){!function(b){"use strict";function c(){return new f}function d(){return new g}b.CreatePresentation=c,b.CreateMedia=d;var e=function(){function b(b){this._eventManager=new a.Events.Manager,this._eventsOrdered=b,this._stepList=[]}return b.prototype.dispose=function(){this._eventManager.dispose(),this._eventManager=null,this._eventsOrdered=null,this._stepList=null},b.prototype.addHandler=function(a,b,c){this._eventManager.addHandler(a,b,c)},b.prototype.createSteps=function(){var a=this,b=0;for(var c in this._eventsOrdered){var d=this._eventManager.getHandlers(this._eventsOrdered[c]);d.forEach(function(c){a._stepList[b++]=c})}},Object.defineProperty(b.prototype,"stepList",{get:function(){return this._stepList},enumerable:!0,configurable:!0}),b}(),f=function(a){function b(){var b=[this.stepEvents.requestBegin,this.stepEvents.requestSend,this.stepEvents.dataRetrieved,this.stepEvents.requestEnd];a.call(this,b)}return __extends(b,a),Object.defineProperty(b.prototype,"stepEvents",{get:function(){return{requestBegin:"requestBegin",requestSend:"requestSend",dataRetrieved:"dataRetrieved",requestEnd:"requestEnd"}},enumerable:!0,configurable:!0}),b}(e),g=function(a){function b(){var b=[this.stepEvents.requestBegin,this.stepEvents.requestSend,this.stepEvents.dataRetrieved,this.stepEvents.requestEnd];a.call(this,b)}return __extends(b,a),Object.defineProperty(b.prototype,"stepEvents",{get:function(){return{requestBegin:"requestBegin",requestSend:"requestSend",dataRetrieved:"dataRetrieved",requestEnd:"requestEnd"}},enumerable:!0,configurable:!0}),b}(e)}(a.Workflow||(a.Workflow={}));a.Workflow}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(a){return new d(a)}b.CreateSequencer=c;var d=function(){function c(b){this._disposed=!1,this._sessionContext=b,this._orderedModules=[new a.DataRetriever.HttpRetryPolicy,new a.SegmentLocator.Dash,new a.Heuristics.InitialBandwidthDataUrlFormatter,new a.Heuristics.WindowSizeRule,new a.Heuristics.StepRule,new a.Heuristics.Engine,new a.UrlBuilder.DashUrlFormatter,new a.DataRetriever.HttpDataRetriever(b),new a.DashPresentation.Parser,new a.ContentProtection.PlayReady,new a.ContentProtection.Widevine,new a.ContentProtection.AesHandler,new a.DashMediaSegment.Parser,new a.Presentation.InitialStreamSelector,new a.Ad.AdHandler],this._createWorkflows(b)}return c.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._orderedModules.forEach(function(a){a.dispose()}),this._orderedModules=null,this._sessionContext=null)},c.prototype.presentationRequestAsync=function(){var b=this,c=this;return new Promise(function(d,e){var f=new a.Context.Request(0,c._sessionContext);f.urlsToRetrieve.push(new a.Context.UrlRequest(c._sessionContext.presentationUrl)),b._processSteps(f,d,e)})},c.prototype.mediaRequestAsync=function(b){var c=this;return new Promise(function(d,e){var f=new a.Context.Request(1,c._sessionContext);f.requestedStream=b,f.heuristicData=new a.Context.HeuristicData(b),c._processSteps(f,d,e)})},c.prototype._processSteps=function(b,c,d){function e(){if(h._disposed||b.disposed||b.sessionContext.disposed)return void d();if(i===b.sessionContext.workflows[b.workflowType].stepList.length)return 1===b.workflowType?a.Log.verbose(0,"Finished process steps for "+a.Presentation.StreamType[b.requestedStream.type]+" media workflow"):a.Log.verbose(0,"Finished process steps for presentation workflow"),void c(b);var e=b.sessionContext.workflows[b.workflowType].stepList[i],j=e.functionHandler.call(e.callerInstance,b);i++,j.then(f,g)}function f(){switch(b.state){case 0:a.Util.setTimeout(e,0);break;case 2:i=0,a.Util.setTimeout(e,b.retryWaitTimeMSec),b.reset();break;case 1:c(b);break;default:throw new Error("processSteps unexpected state"+b.state)}}function g(c){if(null===b.externalFailure)return void b.sessionContext.eventMgr.dispatchEvent(a.InternalEventName.exception,c);var e="stepRejected: "+b.externalFailure.toString();c&&(e+="err: "+c),a.Log.error(0,e),d(b)}var h=this;1===b.workflowType?a.Log.verbose(0,"Starting process steps for "+a.Presentation.StreamType[b.requestedStream.type]+" media workflow"):a.Log.verbose(0,"Starting process steps for presentation workflow");var i=0;a.Util.setTimeout(e,0)},c.prototype._createWorkflows=function(a){a.workflows=[b.CreatePresentation(),b.CreateMedia()],this._orderedModules.forEach(function(b){b.init(a)}),this._sessionContext.workflows.forEach(function(a){a.createSteps()})},c}()}(a.Workflow||(a.Workflow={}));a.Workflow}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){"use strict";var b=function(){function a(){}return a.volumechange="volumechange",a.ended="ended",a.timeupdate="timeupdate",a.durationchange="durationchange",a.pause="pause",a.play="play",a.playing="playing",a.seeking="seeking",a.seeked="seeked",a.suspend="suspend",a.loadstart="loadstart",a.loadedmetadata="loadedmetadata",a.loadeddata="loadeddata",a.fullscreenchange="fullscreenchange",a.waiting="waiting",a.canplaythrough="canplaythrough",a.error="error",a.playbackstalled="playbackstalled",a.downloadbitratechanged="downloadbitratechanged",a.playbackbitratechanged="playbackbitratechanged",a.ratechange="ratechange",a.spliceWaiting="splicewaiting",a.emsgAvailable="emsgAvailable",a.decryptorInitialized="decryptorInitialized",a.aesKeyFetchCompleted="aesKeyFetchCompleted",a.decryptionFailed="decryptionFailed",a.manifestFetchCompleted="manifestFetchCompleted",a.initialBandwidthEstimationCompleted="initialBandwidthEstimationCompleted",a.mediaSourceSrcSetResolved="mediaSourceSrcSetResolved",a}();a.EventName=b;var c=function(){function a(){}return a.trackselected="trackselected",a}();a.StreamEventName=c;var d=function(){function a(){}return a.streamselected="streamselected",a.streamindexinvalid="streamindexinvalid",a.streamselectnotsupported="streamselectnotsupported",a}();a.StreamListEventName=d;var e=function(){function a(){}return a.downloadrequested="downloadrequested",a.downloadcompleted="downloadcompleted",a.downloaddecrypted="downloaddecrypted",a.downloadfailed="downloadfailed",a}();a.BufferDataEventName=e,function(a){a[a.abortedErrStart=1048576]="abortedErrStart",a[a.abortedErrUnknown=1048576]="abortedErrUnknown",a[a.abortedErrNotImplemented=1048577]="abortedErrNotImplemented",a[a.abortedErrHttpMixedContentBlocked=1048578]="abortedErrHttpMixedContentBlocked",a[a.abortedErrEnd=2097151]="abortedErrEnd",a[a.networkErrStart=2097152]="networkErrStart",a[a.networkErrUnknown=2097152]="networkErrUnknown",a[a.networkErrHttpResponseBegin=2097552]="networkErrHttpResponseBegin",a[a.networkErrHttpBadUrlFormat=2097552]="networkErrHttpBadUrlFormat",a[a.networkErrHttpUserAuthRequired=2097553]="networkErrHttpUserAuthRequired",a[a.networkErrHttpUserForbidden=2097555]="networkErrHttpUserForbidden",a[a.networkErrHttpUrlNotFound=2097556]="networkErrHttpUrlNotFound",a[a.networkErrHttpNotAllowed=2097557]="networkErrHttpNotAllowed",a[a.networkErrHttpGone=2097562]="networkErrHttpGone",a[a.networkErrHttpPreconditionFailed=2097564]="networkErrHttpPreconditionFailed",a[a.networkErrHttpInternalServerFailure=2097652]="networkErrHttpInternalServerFailure",a[a.networkErrHttpBadGateway=2097654]="networkErrHttpBadGateway",a[a.networkErrHttpServiceUnavailable=2097655]="networkErrHttpServiceUnavailable",a[a.networkErrHttpGatewayTimeout=2097656]="networkErrHttpGatewayTimeout",a[a.networkErrHttpResponseEnd=2097751]="networkErrHttpResponseEnd",a[a.networkErrTimeout=2097752]="networkErrTimeout",a[a.networkErrError=2097753]="networkErrError",a[a.networkErrAbort=2097754]="networkErrAbort",a[a.networkErrNoInternet=2097755]="networkErrNoInternet",a[a.networkErrEnd=3145727]="networkErrEnd",a[a.decodeErrStart=3145728]="decodeErrStart",a[a.decodeErrUnknown=3145728]="decodeErrUnknown",a[a.decodeErrEnd=4194303]="decodeErrEnd",a[a.srcErrStart=4194304]="srcErrStart",a[a.srcErrUnknown=4194304]="srcErrUnknown",a[a.srcErrParsePresentation=4194305]="srcErrParsePresentation",a[a.srcErrParseSegment=4194306]="srcErrParseSegment",a[a.srcErrUnsupportedPresentation=4194307]="srcErrUnsupportedPresentation",a[a.srcErrInvalidSegment=4194308]="srcErrInvalidSegment",a[a.srcErrLiveNoChunks=4194309]="srcErrLiveNoChunks",a[a.srcErrEnd=5242879]="srcErrEnd",a[a.encryptErrStart=5242880]="encryptErrStart",a[a.encryptErrUnknown=5242880]="encryptErrUnknown",a[a.encryptErrDecrypterNotFound=5242881]="encryptErrDecrypterNotFound",a[a.encryptErrDecrypterInit=5242882]="encryptErrDecrypterInit",a[a.encryptErrDecrypterNotSupported=5242883]="encryptErrDecrypterNotSupported",a[a.encryptErrKeyAcquire=5242884]="encryptErrKeyAcquire",a[a.encryptErrDecryption=5242885]="encryptErrDecryption",a[a.encryptErrLicenseAcquire=5242886]="encryptErrLicenseAcquire",a[a.encryptErrCertAcquire=5242887]="encryptErrCertAcquire",a[a.encryptErrEnd=6291455]="encryptErrEnd"}(a.ErrorCode||(a.ErrorCode={}));a.ErrorCode}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";!function(a){a[a.video=0]="video",a[a.audio=1]="audio",a[a.text=2]="text"}(a.StreamType||(a.StreamType={}));a.StreamType;!function(a){a[a.playReadySpecificData=0]="playReadySpecificData",a[a.widevineSpecificData=1]="widevineSpecificData",a[a.seaEncryptionSystemId=2]="seaEncryptionSystemId",a[a.seaKeyUri=3]="seaKeyUri",a[a.seaIV=4]="seaIV"}(a.ContentProtectionDataType||(a.ContentProtectionDataType={}));a.ContentProtectionDataType}(a.Presentation||(a.Presentation={}));a.Presentation}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";!function(a){a[a.closed=0]="closed",a[a.open=1]="open",a[a.ended=2]="ended"}(a.ReadyState||(a.ReadyState={}));a.ReadyState}(a.VideoElementAdapter||(a.VideoElementAdapter={}));a.VideoElementAdapter}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";!function(a){a[a.presentation=0]="presentation",a[a.media=1]="media",a[a.max=2]="max"}(a.Type||(a.Type={}));a.Type}(a.Workflow||(a.Workflow={}));a.Workflow}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="AdHandler"}return b.prototype.dispose=function(){},b.prototype.init=function(a){var b=a.workflows[0],c=a.workflows[1];b.addHandler(b.stepEvents.requestEnd,this.onParseScte35InMpd,this),c.addHandler(c.stepEvents.dataRetrieved,this.onGetMediaData,this)},b.prototype.onParseScte35InMpd=function(a){a.currentModuleId=this._moduleId;var b=this;return new Promise(function(c){var d=a.sessionContext.presentationJson;if(b._adSignaledInMpd=!1,d&&d.Period&&d.Period.EventStream_asArray){var e=[];d.Period.EventStream_asArray.forEach(function(a){var c=b.extractAdSignal(a);e=e.concat(c)}),e.length>0&&(b._adSignaledInMpd=!0,b.sendAdSignals(a.sessionContext,e))}c()})},b.prototype.onGetMediaData=function(c){c.currentModuleId=this._moduleId;var d=this;return new Promise(function(e){var f=c.urlsToRetrieve.findFirst(function(a){return 1===a.requestType});if(!f||!f.mediaData)throw new Error(f.url+": no media segment data found");if(c.sessionContext.commonPresentation.isLive){var g=new DataView(f.mediaData),h=a.Mp4Util.GetEmsgBoxes(g);if(h){var i=[];h.forEach(function(d){if(d.schemeIdUrl===b._schemeIdUriScte35||d.schemeIdUrl===b._schemeIdUriSimple){var e=(d.timescale*f.presTimeInSec+d.presentationTimeDelta+c.requestedStream.rawPresentationTimeOffset)/d.timescale;if(a.Log.verbose(15,"ADSIGNAL: id: "+d.id+", mediaRequest.presTimeInSec: "+f.presTimeInSec+", presentationTimeDelta: "+d.presentationTimeDelta+", rawPresentationTimeOffset: "+c.requestedStream.rawPresentationTimeOffset+", presentationTime = "+e*d.timescale),d.schemeIdUrl===b._schemeIdUriScte35&&d.messageData){for(var g=new DataView(d.messageData.buffer),h="",j=0;j<d.messageData.length;j+=2){var k=g.getUint16(j,!0);if(0==k)break;h+=String.fromCharCode(k)}d.presentationTimeDelta>0?i.push({scteSignal:{signalInString:h,presentationTimeOverride:e}}):a.Log.verbose(15,"ADSIGNAL: skipping this one.")}else d.presentationTimeDelta>0?i.push({simpleSignal:{id:d.id,presentationTime:e,duration:d.eventDuration/d.timescale}}):a.Log.verbose(15,"ADSIGNAL: skipping this one.")}}),i.length>0&&d.sendAdSignals(c.sessionContext,i)}}e()})},b.prototype.extractAdSignal=function(c){var d=[],e=c.timescale;return c.schemeIdUri===b._schemeIdUriScte35?c.Event_asArray.forEach(function(b){var c=b.__text;if(c){var f=b.presentationTime;f&&(f/=e),d.push({scteSignal:{signalInString:c,presentationTimeOverride:f}}),a.Log.verbose(15,"ADSIGNAL mpd: presentationTime: "+f)}}):c.schemeIdUri===b._schemeIdUriSimple&&c.Event_asArray.forEach(function(b){var c=b.presentationTime;c&&(c/=e);var f=b.duration/e,g=b.id;d.push({simpleSignal:{id:g,presentationTime:c,duration:f}}),a.Log.verbose(15,"ADSIGNAL mpd: id: "+g+", presentationTime: "+c+", duration: "+f)}),d},b.prototype.sendAdSignals=function(a,b){a.adManager.addAdSignals(b)},b._schemeIdUriScte35="urn:scte:scte35:2013a:bin",b._schemeIdUriSimple="urn:com:adobe:dpi:simple:2015",b}();b.AdHandler=c}(a.Ad||(a.Ad={}));a.Ad}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="AesHandler",this._disposed=!1,this._decryptor=new a.WebCryptoUtil.Decryptor}return b.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._decryptor&&(this._decryptor.dispose(),this._decryptor=null))},b.prototype.init=function(a){var b=a.workflows[0],c=a.workflows[1];b.addHandler(b.stepEvents.requestEnd,this.onDownloadKey,this),c.addHandler(c.stepEvents.dataRetrieved,this.onDecrypt,this)},b.prototype.onDownloadKey=function(c){var d=this;return c.currentModuleId=this._moduleId,new Promise(function(e,f){function g(){k<j.length?a.Util.setTimeout(h,0,j[k++]):e()}function h(d){if(i._disposed)return a.Failure.attachFailureToRequest(c,c.currentModuleId,0),void f();if(i._decryptor.isInitialized(d.streamingInfo.aes))return void g();var e=b._getAesContentProtectionIndex(d);if(isNaN(e))return void g();var h=d.contentProtections[e],k=h.data(3),l=h.data(4);if(!k||!l)return a.Failure.attachFailureToRequest(c,c.currentModuleId,5242883,"Missing IV or keyUrl"),void f();var m=i._findExistingAesInfo(j,d,k,l);if(m)return d.streamingInfo.aes=m,void g();var n=c.sessionContext.authenticationTokens[b._tokenId];if(!a.AesUtil.verifyKeyUrlWithToken(k,n))return a.Failure.attachFailureToRequest(c,c.currentModuleId,5242883,"verify AMS hostname failed"),void f();var o=[];n&&n.length>0&&(o[0]={name:a.HttpUtil.authorizationHeader,value:n});var p={maxRetries:c.sessionContext.httpRetryPolicySettings.maxRetriesForKeyAcquireFailure,maxWaitTimeBetweenRetriesMS:c.sessionContext.httpRetryPolicySettings.maxWaitTimeBetweenRetriesForKeyAcquireMS},q=Date.now();a.Log.verbose(12,"Starting AES key acquisition"),a.HttpUtil.httpRequestWithRetryConfig(k,"POST","arraybuffer",p,o).then(function(b){c.sessionContext.eventMgr.dispatchEvent(a.EventName.aesKeyFetchCompleted),i._decryptor.initialize(d.streamingInfo.aes,b,a.Common.hexStringToUint8Array(l)).then(function(){a.Log.verbose(12,"AES key acquisition in "+(Date.now()-q)+" ms"),c.sessionContext.eventMgr.dispatchEvent(a.EventName.decryptorInitialized,i._decryptor.type),g()},function(b){a.Log.error(12,"Failed to initialize decryptor: "),a.Failure.attachFailureToRequest(c,c.currentModuleId,5242882,"AES: "+b),f()})},function(b){a.Log.error(12,"Failed to download AES key url: "+k+", "+a.Common.toHexString(b.code)),a.Failure.attachFailureToRequest(c,c.currentModuleId,5242884,"Http: "+a.Common.toHexString(b.code)+", response: "+b.response),f()})}var i=d,j=c.sessionContext.commonPresentation.periods[0].streams,k=0;g()})},b.prototype.onDecrypt=function(b){var c=this;return b.currentModuleId=this._moduleId,new Promise(function(d,e){function f(){i<b.urlsToRetrieve.length?a.Util.setTimeout(g,0,b.urlsToRetrieve[i++]):d()}function g(c){if(h._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void e();if(!c.mediaData)return void f();var g=new DataView(c.mediaData),i=a.Mp4Util.GetBoxByType(g,"moof");i&&a.Log.error(12,"Found moof box in supposedly encrypted fragment: "+c.url);var k=Date.now();h._decryptor.decrypt(j,c.mediaData).then(function(d){var e=Date.now()-k;a.Log.verbose(12,"AES decrypt data in "+e+" ms, bytes: "+c.mediaData.byteLength+" url: "+c.url),c.mediaData=d;var g=a.StreamUtil.getBufferData(b);g.dispatchDownloadDecrypted(h._createMediaDecrypted(b,c,e)),b.sessionContext.decryptionTracker&&b.sessionContext.decryptionTracker.updateDecryptionSpeedInfo(c.mediaData.byteLength,e/1e3),f()},function(e){b.sessionContext.eventMgr.dispatchEvent(a.EventName.decryptionFailed,c.url);var f="Failed to AES decrypt url: "+c.url+" "+JSON.stringify(e);a.Log.error(12,f),b.state=2,b.failTracker.log(new a.Failure.Record(b.currentModuleId,5242885,f),b.selectedTrack),b.failTracker.noDataReceivedFailure=!1,b.retryWaitTimeMSec=0,d()})}var h=c,i=0,j=b.requestedStream.streamingInfo.aes;return h._decryptor.isInitialized(j)?void f():void d()})},b._getAesContentProtectionIndex=function(a){for(var c=a.contentProtections,d=0;d<c.length;d++){var e=c[d].data(2);if(e===b._aesCbc128SystemId)return d}return 0/0},b.prototype._findExistingAesInfo=function(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]!==b)for(var f=a[e].contentProtections,g=0;g<f.length;g++){var h=f[g].data(3),i=f[g].data(4);if(h===c&&i===d&&this._decryptor.isInitialized(a[e].streamingInfo.aes))return a[e].streamingInfo.aes}return null},b.prototype._createMediaDecrypted=function(b,c,d){var e=b.requestedStream.presentationTimeOffsetInSec,f=b.requestedStream.streamingInfo.currentSegment.segmentInfo,g=2===c.requestType?null:f.mediaTimestamp/f.timescale;return new a.Context.MediaDecrypted(c.url,b.selectedTrack.bitrate,g,c.mediaData,e,f.timescale,f.durationInSec,d)},b._aesCbc128SystemId="urn:mpeg:dash:sea:aes128-cbc:2013",b._tokenId="AES",b}();b.AesHandler=c}(a.ContentProtection||(a.ContentProtection={}));a.ContentProtection}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(b,c){this._bandwidthSettings=b,this._decryptionTracker=c,this._averageCalc=new a.Util.AverageCalculator(this._bandwidthSettings.minBandwidthHistoryCount,this._bandwidthSettings.maxBandwidthHistoryCount)}return Object.defineProperty(b.prototype,"averageBandwidthInKbps",{get:function(){return this._averageCalc.average},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"latestInKbps",{get:function(){return this._averageCalc.latest},enumerable:!0,configurable:!0}),b.prototype.perceivedBandwidth=function(){var a=1e3*this._averageCalc.average;return a*this._bandwidthSettings.bandwidthUsabilityPercent},b.prototype.updateBandwidthInfo=function(b,c,d,e){if(a.Log.verbose(5,"updateBandWidthInfo - analyzing bandwidth data: received size="+b.responseLengthInBytes+" bytes, download time="+b.downloadTimeMs+" ms, TOTAL download time="+b.totalDownloadTimeMs+" ms, "+(this._bandwidthSettings.useVariableFragmentSizeMode?"(default mode) ":"")+"bandwidth = "+b.bandwidth+" kbps"),b.responseLengthInBytes<this._bandwidthSettings.bandwidthDataSizeThresholdInBytes)return void a.Log.verbose(5,"Ignoring bandwidth data, retrieved size "+b.responseLengthInBytes+" is less than the limit "+this._bandwidthSettings.bandwidthDataSizeThresholdInBytes+" bytes");if((!c||this._bandwidthSettings.bandwidthTestWithTimeThresholdDuringLive)&&b.downloadTimeMs<this._bandwidthSettings.bandwidthEstimationMinMsec)return a.Log.verbose(5,"Ignoring bandwidth estimation, download time "+Math.floor(b.downloadTimeMs)+" ms is less than configured min "+this._bandwidthSettings.bandwidthEstimationMinMsec+" ms"),void this._averageCalc.dropOldestKeepAtLeastOne();if(b.bandwidth>this._bandwidthSettings.bandwidthEstimationMaxKbps)return a.Log.verbose(5,"Ignoring bandwidth estimation "+Math.floor(b.bandwidth)+" Kbps, greater than configured max "+this._bandwidthSettings.bandwidthEstimationMaxKbps+" Kbps"),void this._averageCalc.dropOldestKeepAtLeastOne();var f;if(this._bandwidthSettings.useVariableFragmentSizeMode){var g=e.requestedStream.streamingInfo.currentSegment?a.StreamUtil.getSegmentDuration(e):d.durationInSec,h=d.bitrate;if(isNaN(h)||0>=h||isNaN(g)||0>=g||b.responseLengthInBytes<=0)return void a.Log.verbose(5,"Ignoring bandwidth estimation, supplied bitrate: "+h+", supplied chunk duration: "+g+", downloaded fragment size: "+b.responseLengthInBytes);var i=h*g,j=b.totalDownloadTimeMs-b.downloadTimeMs,k=j+i/(8*b.responseLengthInBytes)*b.downloadTimeMs;f=i/k,a.Log.verbose(5,"updateBandWidthInfo - vfsMode On, vfs bandwidth="+f+"kbps")}else f=b.bandwidth;var l=b.totalDownloadTimeMs;this._averageCalc.addValue(f),a.Log.verbose(5,"updateBandWidthInfo -  currentBw: "+Math.floor(this._averageCalc.latest)+" Kbps averageBw: "+Math.floor(this._averageCalc.average)+" Kbps size: "+b.responseLengthInBytes+" bytes time-taken: "+l+" ms")},b.prototype.reportHeuristicsData=function(b,c){var d=this.perceivedBandwidth(),e=this._decryptionTracker?this._decryptionTracker.averageDecryptionSpeed:1/0;if(a.Log.verbose(5,"averageBW reporting: "+Math.round(d/1e3)+" Kbps decryptionBW: "+Math.round(e/1e3)+" Kbps, chunk duration: "+c),!c)throw new Error("reportHeuristicsData failed, invalid chunkDuration");for(var f=0;f<b.tracksData.length;f++)if(b.tracksData[f].selectable){var g=b.tracksData[f].trackInfo.bitrate*c;if(d){var h=g/d,i=e?g/e:0;b.tracksData[f].dataRetrieverEstimationInWallClockSec=h+i,a.Log.verbose(5,"Estimated time to download "+g+" bits = "+b.tracksData[f].dataRetrieverEstimationInWallClockSec+" s")}else b.tracksData[f].dataRetrieverEstimationInWallClockSec=1/0}},b}();b.BandwidthTracker=c;var d=function(){function b(){this.requestStartTimeInMS=(new Date).getTime(),this.responseStartTimeInMS=null,this.responseEndTimeInMS=null,this.responseLengthInBytes=0}return Object.defineProperty(b.prototype,"totalDownloadTimeMs",{get:function(){return a.assert(this.responseEndTimeInMS>=this.requestStartTimeInMS,"BandwidthInfo.totalDownloadTimeMs: unexpected values:"+this.responseEndTimeInMS+" should not be < "+this.requestStartTimeInMS),this.responseEndTimeInMS-this.requestStartTimeInMS||1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"latencyTimeMs",{get:function(){return a.assert(this.responseStartTimeInMS>=this.requestStartTimeInMS,"BandwidthInfo.latencyTimeMs: unexpected values:"+this.responseStartTimeInMS+" should not be < "+this.requestStartTimeInMS),this.responseStartTimeInMS-this.requestStartTimeInMS||1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"downloadTimeMs",{
get:function(){return a.assert(this.responseEndTimeInMS>=this.responseStartTimeInMS,"BandwidthInfo.downloadTimeMs: unexpected values:"+this.responseEndTimeInMS+" should not be < "+this.responseStartTimeInMS),this.responseEndTimeInMS-this.responseStartTimeInMS||1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bandwidth",{get:function(){return a.assert(this.totalDownloadTimeMs>0,"BandwidthInfo.bandwidth: unexpected value:"+this.totalDownloadTimeMs+" should be > 0"),8*this.responseLengthInBytes/this.totalDownloadTimeMs},enumerable:!0,configurable:!0}),b}();b.BandwidthInfo=d}(a.Heuristics||(a.Heuristics={}));a.Heuristics}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="playReady",this._disposed=!1,this._initial=!0}return b.prototype.dispose=function(){this._disposed=!0},b.prototype.init=function(a){var b=a.workflows[0];b.addHandler(b.stepEvents.requestEnd,this.onContentProtected,this)},b.prototype.onContentProtected=function(b){var c=this;return b.currentModuleId=this._moduleId,new Promise(function(d,e){var f=[],g=b.sessionContext.commonPresentation;if(c._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void e("Disposed");if(!c._initial)return void d();if(!g)throw new Error("CommonPresentation is empty");g.periods[0].streams.forEach(function(b){for(var c=0;c<b.contentProtections.length;c++){var d=b.contentProtections[c].data(0);if(d){var e=new a.Mp4Util.PsshBox;e.systemId=a.KeySystem.PlayReadyBase.systemId,e.specificData=a.Common.stringToUint8Array(atob(d)),f.push(e)}}}),f.length>0&&b.sessionContext.emeManager.addPsshBoxes(f),c._initial=!1,d()})},b}();b.PlayReady=c}(a.ContentProtection||(a.ContentProtection={}));a.ContentProtection}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="widevine",this._disposed=!1,this._initial=!0}return b.prototype.dispose=function(){this._disposed=!0},b.prototype.init=function(a){var b=a.workflows[0];b.addHandler(b.stepEvents.requestEnd,this.onContentProtected,this)},b.prototype.onContentProtected=function(b){var c=this;return b.currentModuleId=this._moduleId,new Promise(function(d,e){var f=[],g=b.sessionContext.commonPresentation;if(c._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void e("Disposed");if(!c._initial)return void d();if(!g)throw new Error("CommonPresentation is empty");g.periods[0].streams.forEach(function(c){for(var d=0;d<c.contentProtections.length;d++){var e=c.contentProtections[d].data(1);if(e){var g=a.Common.stringToUint8Array(atob(e)),h=new DataView(g.buffer),i=a.Mp4Util.GetPsshBoxes(h);if(1!=i.length)throw new Error("Each cenc:pssh element should contain a 'pssh' box");f.push(i[0])}c.contentProtections[d].laUrl&&b.sessionContext.emeManager.addLaUrl(a.KeySystem.Widevine.systemId,c.contentProtections[d].laUrl)}}),f.length>0&&b.sessionContext.emeManager.addPsshBoxes(f),c._initial=!1,d()})},b}();b.Widevine=c}(a.ContentProtection||(a.ContentProtection={}));a.ContentProtection}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="DashMediaSegmentParser"}return b.prototype.dispose=function(){},b.prototype.init=function(a){var b=a.workflows[1];b.addHandler(b.stepEvents.dataRetrieved,this.onGetData,this)},b.prototype.onGetData=function(b){function c(b){var c=b.urlsToRetrieve.findFirst(function(a){return 1===a.requestType});if(c&&c.mediaData){var d=new DataView(c.mediaData),e=a.Mp4Util.GetEmsgBoxes(d);e&&e.length>0&&b.sessionContext.eventMgr.dispatchEvent(a.EventName.emsgAvailable,null,e)}}function e(){var c,e,g,h,i,j,k,l;l=b.requestedStream.streamingInfo.currentSegment;var m=b.urlsToRetrieve.findFirst(function(a){return 1===a.requestType});if(!m||!m.mediaData)throw new Error(m.url+": no media segment data found");if(c=new DataView(m.mediaData),e=a.Mp4Util.GetBoxByType(c,"moof"),!e)return new d(4194306,"moof not found");if(g=a.Mp4Util.GetBoxByType(e.data,"traf"),!g)return new d(4194306,"traf not found");if(h=a.Mp4Util.GetTfhdBox(g.data),!h)return new d(4194306,"tfhd not found");if(i=a.Mp4Util.GetTrunBox(g.data),!i)return new d(4194306,"trun not found");if(j=a.Mp4Util.GetTfdtBox(g.data),!j)return new d(4194306,"tfdt not found");if(a.Common.diffTimes(j.baseMediaDecodeTime,l.segmentInfo.mediaTimestamp))throw new Error("Segment mismatch, requested: "+l.segmentInfo.mediaTimestamp+" got: "+j.baseMediaDecodeTime);if(k=f(h,i),0===k)return new d(4194308,"failed to derive segment duration");a.Log.verbose(10,"Segment duration: "+k);var n=b.requestedStream.segments.updateSegmentDuration(l.segmentInfo.presTimeInSec,k);return n?(l.segmentInfo.mediaDuration=k,m.durationInSec=l.segmentInfo.durationInSec,null):new d(4194308,"failed to update segment duration in container")}function f(b,c){var d=0;return c.flags&a.Mp4Util.TrunBox.flags_sampleDurationPresent?c.sampleInfoArray.forEach(function(a){d+=a.sampleDuration}):b.defaultSampleDuration?d=b.defaultSampleDuration*c.sampleCount:a.Log.warning(10,"Cannot calculate segment duration from 'tfhd' and 'trun'"),d}function g(){var c=b.requestedStream,d=c.streamingInfo.currentSegment,e=d.segmentInfo,f=c.segments;e.mediaDuration&&f.addMediaSegmentInfo(e.index+1,a.Timestamp.add(e.mediaTimestampStr,e.mediaDuration),0/0,e.presentationOffset,e.timescale)}return b.currentModuleId=this._moduleId,new Promise(function(d,f){c(b);var h;if(h=b.requestedStream.streamingInfo.currentSegment,!b.sessionContext.commonPresentation.isLive||b.sessionContext.commonPresentation.minimumUpdatePeriodInSec||h.next)return void d();if(!h.segmentInfo.mediaDuration){var i=e();if(i)return a.Failure.attachFailureToRequest(b,b.currentModuleId,i.errorCode,i.message),void f()}g(),d()})},b}();b.Parser=c;var d=function(){function a(a,b){this.errorCode=a,this.message=b}return a}()}(a.DashMediaSegment||(a.DashMediaSegment={}));a.DashMediaSegment}(AzureHtml5JS||(AzureHtml5JS={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},AzureHtml5JS;!function(a){!function(b){"use strict";function c(a){var b;if(!("schemeIdUri"in a))throw new Error("ContentProtection missing @schemeIdUri");return b=a.schemeIdUri,b.toLowerCase()===k.schemeIdUri?new k(a):b.toLowerCase()===l.schemeIdUri?new l(a):b.toLowerCase()===m.schemeIdUri?new m(a):new n(a)}var d=function(){function b(){this._moduleId="DashPresentationParser"}return b.prototype.dispose=function(){},b.prototype.init=function(a){var b=a.workflows[0];b.addHandler(b.stepEvents.dataRetrieved,this.onParse,this)},b.prototype.onParse=function(c){return c.currentModuleId=this._moduleId,new Promise(function(d,f){var g,h,i;if(!c.urlsToRetrieve[0].presentationData)throw new Error(c.urlsToRetrieve[0].url+": no presentation data found");g=c.sessionContext;var j=b._getPublishTime(c.urlsToRetrieve[0].presentationData);if(j&&g.commonPresentation&&g.commonPresentation.publishTime&&g.commonPresentation.publishTime.getTime()>=Date.parse(j))return a.Log.verbose(4,"skipping MPD parse, not newer than last parsed: "+c.urlsToRetrieve[0].url),void d();if(h=b._getBaseURL(g.presentationUrl),i=new e(c.urlsToRetrieve[0].presentationData,h),!i||!i.periods)return a.Failure.attachFailureToRequest(c,c.currentModuleId,4194305,c.urlsToRetrieve[0].url+": failed to generate DASH presentation"),void f("failed to generate DASH presentation");if(!b._validPresentation(i))return a.Failure.attachFailureToRequest(c,c.currentModuleId,4194307,c.urlsToRetrieve[0].url+": unsupported presentation"),void f("unsupported presentation");for(var k=i.periods[0].streams,l=0;l<i.periods[0].streams.length;l++)2!==k[l].type||k[l].segments||(k.splice(l,1),a.Log.warning(4,"Text stream "+l+" has empty segments.  Ignoring the text stream."));var m=i.isLive,n=m&&null!==i.periods[0].streams.findFirst(function(a){return(0===a.type||1===a.type)&&!a.segments});return g.updatePresentation(i),a.Log.verbose(4,"MPD updated. Streaming type: "+(m?"Live":"VOD")),n?(a.Failure.attachFailureToRequest(c,c.currentModuleId,4194309,c.urlsToRetrieve[0].url+": no chunks in the live manifest"),void f("no chunks in this presentation")):void d()})},b._removeAudioOrVideoTracks=function(a,b){var c;do c=a.periods[0].streams.findIndexOf(function(a){return a.type===b}),-1!==c&&a.periods[0].streams.splice(c,1);while(-1!==c);return a},b._validPresentation=function(b){if(0===b.periods.length||b.periods.length>1)return a.Log.error(4,"invalid period count: "+(b.periods?b.periods.length.toString():"undefined")),!1;if(!b.periods[0].streams)return a.Log.error(4,"no streams found"),!1;for(var c=0;c<b.periods[0].streams.length;c++)a.Log.verbose(4,"Stream: "+b.periods[0].streams[c].codec);return!0},b._getPublishTime=function(a){var b,c,d="";return a&&(b=a.match(/<MPD[^>]*>/i),b&&b.length>0&&(c=b[0].match(/publishTime="[^"]*/i),c&&c.length>0&&(d=c[0].slice(13)))),d},b._getBaseURL=function(a){var b,c=a;if(b=c.indexOf("?"),-1!==b&&(c=c.slice(0,b)),b=c.lastIndexOf("/"),-1===b)throw new Error(a+": could not derive base URL");return c=c.slice(0,b+1)},b}();b.Parser=d;var e=function(){function b(a,b){var c,d=this,e=[];if(this._lastRetrievalTime=new Date,c=Dash.dependencies.DashParser(),c.debug=new p,c.errHandler=new q,this._manifest=c.parse(a,b),this._manifest){if("Period_asArray"in this._manifest&&this._manifest.Period_asArray.length>0&&this._manifest.Period_asArray.forEach(function(a){e.push(new f(a,d.publishTime,d.isLive))}),this._periods=e,e.length>1)throw new Error("Error parsing MPD: multiple periods not supported");"dynamic"===this._manifest.type&&0===this._manifest.minimumUpdatePeriod&&(this._timeShiftTracker=new o(e,this._manifest.timeShiftBufferDepth))}}return Object.defineProperty(b.prototype,"segmentBoundaries",{get:function(){var a=[];if(this.periods&&this.periods.length>0&&this.periods[0].streams&&this.periods[0].streams.length>0)for(var b=0;b<this.periods[0].streams.length;b++)if(0===this.periods[0].streams[b].type&&this.periods[0].streams[b].segments){for(var c=this.periods[0].streams[b].segments.first;c;)a.push(c.segmentInfo.presTimeInSec),c=c.next;break}return a},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this._periods&&(this._periods.forEach(function(a){a.dispose()}),this._periods=[]),this._manifest=null,this._lastRetrievalTime=null},Object.defineProperty(b.prototype,"startTime",{get:function(){var a=null;return"availabilityStartTime"in this._manifest&&(a=new Date(this._manifest.availabilityStartTime)),a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"publishTime",{get:function(){var a;return a="publishTime"in this._manifest?new Date(this._manifest.publishTime):this._lastRetrievalTime},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isLive",{get:function(){return"dynamic"===this._manifest.type},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"minimumUpdatePeriodInSec",{get:function(){return this._manifest.minimumUpdatePeriod},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"durationInSec",{get:function(){var a=0;return"mediaPresentationDuration"in this._manifest&&(a=this._manifest.mediaPresentationDuration),a},enumerable:!0,configurable:!0}),b.prototype.getWallClockTimeAtPresentationTime=function(a){var b=null;if(this._periods&&this._periods.length>0&&this._periods[0].streams&&this._periods[0].streams.length>0&&this._periods[0].streams[0].segments&&this._periods[0].streams[0].segments.first&&this._periods[0].streams[0].producerReferenceTime){var c=this._periods[0].streams[0],d=c.segments.first.segmentInfo.timescale,e=0;if(this.isLive){var f=c.producerReferenceTime.presentationTime/d,g=c.rawPresentationTimeOffset/d;e=a+g-f}else{var h=c.segments.first.segmentInfo.presTimeInSec;e=a-h}var i=c.producerReferenceTime.wallClockTime,b=new Date(i.getTime()+1e3*e)}return b},Object.defineProperty(b.prototype,"timeShiftBufferDepth",{get:function(){return this._manifest.timeShiftBufferDepth},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"playableWindow",{get:function(){return new a.Common.TimeRange(this._playWindowLeftEdge(),this._playWindowLiveEdge())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxSegmentDuration",{get:function(){var a=0;return this._periods.forEach(function(b){a=Math.max(a,b.maxSegmentDuration)}),a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"periods",{get:function(){return this._periods},enumerable:!0,configurable:!0}),b.prototype.toJson=function(){return this._manifest},b.prototype.transferPresentationState=function(b){var c=b,d=[],e=[];this._manifest=c._manifest,this._lastRetrievalTime=c._lastRetrievalTime,this._timeShiftTracker=c._timeShiftTracker,this.periods.forEach(function(a){d.push(a)}),c.periods.forEach(function(a){e.push(a)});for(var f=0;f<e.length;f++)for(var g=0;g<d.length;g++)if(d[g]&&e[f].startInSec===d[g].startInSec){d[g].transferPeriodState(e[f]),e[f]=null,d[g]=null;break}d=d.filter(function(a){return!!a}),e=e.filter(function(a){return!!a}),d.length>0&&a.Log.verbose(4,"Periods removed from MPD: "+d.length),e.length>0&&a.Log.verbose(4,"Periods added to MPD: "+e.length)},b.prototype.adjustPlayableWindow=function(a){this._timeShiftTracker&&this._timeShiftTracker.adjust(a)},b.prototype.adjustPlayableWindowForChromeSourceDelay=function(a){this._timeShiftTracker&&this._timeShiftTracker.adjustForChromeSourceDelay(a)},b.prototype._playWindowLeftEdge=function(){var a,b=0;return this._timeShiftTracker?this._timeShiftTracker.leftEdge:this._periods&&this._periods.length?(a=this._periods[0].streams,a&&a.length?(a.forEach(function(a){2!==a.type&&a.segments&&a.segments.first&&(b=Math.max(b,a.segments.first.segmentInfo.presTimeInSec))}),b):0):0},b.prototype._playWindowLiveEdge=function(){var a,b=1/0;return this._timeShiftTracker?this._timeShiftTracker.liveEdge:this._periods&&this._periods.length?(a=this._periods[0].streams,a&&a.length?(a.forEach(function(a){if(2!==a.type&&a.segments&&a.segments.last){var c=a.segments.last.segmentInfo;b=Math.min(b,c.presTimeInSec+(c.durationInSec||0))}}),b):0):0},b}();b.Mpd=e;var f=function(){function b(a,b,c){var d=this,e=[];this.startInSec="start"in a?a.start:0,"AdaptationSet_asArray"in a&&a.AdaptationSet_asArray.length>0&&a.AdaptationSet_asArray.forEach(function(a){e.push(new g(a,b,c,d.startInSec))}),this._streams=e}return Object.defineProperty(b.prototype,"streams",{get:function(){return this._streams},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxSegmentDuration",{get:function(){var a=0;return this._streams.forEach(function(b){a=Math.max(a,b.maxSegmentDuration)}),a},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this._streams&&(this._streams.forEach(function(a){a.dispose()}),this._streams=[])},b.prototype.transferPeriodState=function(b){var c=[],d=[];this.streams.forEach(function(a){c.push(a)}),b.streams.forEach(function(a){d.push(a)});for(var e=0;e<d.length;e++)for(var f=0;f<c.length;f++)if(c[f]&&d[e].id===c[f].id){c[f].transferStreamState(d[e]),d[e]=null,c[f]=null;break}c=c.filter(function(a){return!!a}),d=d.filter(function(a){return!!a}),c.length>0&&a.Log.verbose(4,"Adaptation Sets removed from period: "+c.length),d.length>0&&a.Log.verbose(4,"Adaptation Sets added to period: "+d.length)},b}();b.Period=f;var g=function(){function b(b,d,e,f){var g=[],j=[];if(this._adaptationSet=b,this.streamingInfo=new a.Presentation.MediaStreamStreamingInfo,"SegmentTemplate"in b&&(this._segmentTemplate=b.SegmentTemplate,"SegmentTimeline"in this._segmentTemplate)){var k,l,m,n;if(k=this._segmentTemplate.SegmentTimeline,l=this._segmentTemplate.timescale?this._segmentTemplate.timescale:1,m=f*l,this._rawPresentationTimeOffset=this._segmentTemplate.presentationTimeOffset?this._segmentTemplate.presentationTimeOffset:0,m-=this._rawPresentationTimeOffset,this._normalizedPtoInSec=m/l,n=new a.Presentation.MediaSegmentInfoContainer(l,m,d,e),"S_asArray"in k){var o,p="0";o=this._segmentTemplate.startNumber?this._segmentTemplate.startNumber:0;for(var q=0;q<k.S_asArray.length;q++){var r,s,t,u;r=k.S_asArray[q],s="t"in r?r.t_str:p,t="r"in r?r.r:0,u=new a.Presentation.SegmentRunEntry(o,s,r.d,m,l,t);var v=n.addMediaSegmentRun(u);o+=v,p=a.Timestamp.add(s,r.d*v)}this.segments=n}}"Representation"in b&&b.Representation_asArray.forEach(function(a){g.push(new h(a))}),this._tracks=g.sort(function(a,b){return a.bitrate-b.bitrate}),"ContentProtection"in b&&b.ContentProtection_asArray.forEach(function(a){j.push(c(a))}),this._contentProtections=j,"ProducerReferenceTime"in b&&(this._producerReferenceTime=new i(b.ProducerReferenceTime))}return b.prototype.dispose=function(){this._tracks&&(this._tracks.forEach(function(a){a.dispose()}),this._tracks=[]),this._contentProtections&&(this._contentProtections.forEach(function(a){a.dispose()}),this._contentProtections=[]),this.segments&&(this.segments.dispose(),this.segments=null),this.streamingInfo&&(this.streamingInfo.dispose(),this.streamingInfo=null),this._adaptationSet=null,this._segmentTemplate=null},Object.defineProperty(b.prototype,"codec",{get:function(){function a(){var a=b.codecs;if(!a)for(var c=0;c<b.Representation_asArray.length;c++)if(b.Representation_asArray[c].codecs){a=b.Representation_asArray[c].codecs;break}return a}var b=this._adaptationSet;return b.mimeType+';codecs="'+a()+'"'},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"type",{get:function(){var b;switch(this._adaptationSet.contentType){case"video":b=0;break;case"audio":b=1;break;case"text":b=2;break;default:a.Log.error(4,"Stream type not supported: "+this._adaptationSet.contentType)}return b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"id",{get:function(){var a=null;return"id"in this._adaptationSet?a=this._adaptationSet.id.toString():(a=this._adaptationSet.codecs,"lang"in this._adaptationSet&&(a+=this._adaptationSet.lang)),a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"language",{get:function(){var a=null;return"lang"in this._adaptationSet&&(a=this._adaptationSet.lang),a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"initUrlTemplate",{get:function(){var a=null;return"initialization"in this._segmentTemplate&&(a=this._adaptationSet.BaseURL+this._segmentTemplate.initialization),a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"mediaUrlTemplate",{get:function(){var a=null;return"media"in this._segmentTemplate&&(a=this._adaptationSet.BaseURL+this._segmentTemplate.media),a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"presentationTimeOffsetInSec",{get:function(){return this._normalizedPtoInSec},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rawPresentationTimeOffset",{get:function(){return this._rawPresentationTimeOffset},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"tracks",{get:function(){return this._tracks},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"contentProtections",{get:function(){return this._contentProtections},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"producerReferenceTime",{get:function(){return this._producerReferenceTime},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxSegmentDuration",{get:function(){return this.segments.maxSegmentDuration},enumerable:!0,configurable:!0}),b.prototype.transferStreamState=function(b){var c=[],d=[];this.tracks.forEach(function(a){c.push(a)}),b.tracks.forEach(function(a){d.push(a)});for(var e=0;e<d.length;e++)for(var f=0;f<c.length;f++)if(c[f]&&d[e].id===c[f].id){d[e]=null,c[f]=null;break}c=c.filter(function(a){return!!a}),d=d.filter(function(a){return!!a}),c.length>0&&a.Log.verbose(4,"Representations removed from MPD: "+c.length),d.length>0&&a.Log.verbose(4,"Representations added to MPD: "+d.length),this.segments.update(b.segments)},b}();b.AdaptationSet=g;var h=function(){function b(b){if(!("id"in b))throw new Error("Representation missing @id");if(this._id=b.id,!("bandwidth"in b))throw new Error("Representation missing @bandwidth");this._bitrate=b.bandwidth,this._height=b.height,this._width=b.width,this._codecs=b.codecs,this.streamingInfo=new a.Presentation.MediaTrackStreamingInfo}return Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bitrate",{get:function(){return this._bitrate},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"codecs",{get:function(){return this._codecs},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectable",{get:function(){return this.streamingInfo.selectable},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){},b}();b.Representation=h;var i=function(){function a(a){if(!("id"in a))throw new Error("ProducerReferenceTime missing @id");if(this._id=a.id,!("presentationTime"in a))throw new Error("ProducerReferenceTime missing @presentationTime");if(this._presentationTime=a.presentationTime,!("type"in a))throw new Error("ProducerReferenceTime missing @type");if(this._type=a.type,!("wallClockTime"in a))throw new Error("ProducerReferenceTime missing @wallClockTime");this._wallClockTime=a.wallClockTime}return Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"presentationTime",{get:function(){return this._presentationTime},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"wallClockTime",{get:function(){return this._wallClockTime},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){},a}();b.ProducerReferenceTime=i;var j=function(){function a(a){if(!("schemeIdUri"in a))throw new Error("ContentProtection missing @schemeIdUri");this.schemeIdUri=a.schemeIdUri,"value_str"in a?this._value=a.value_str:"value"in a&&(this._value=a.value),"id"in a&&(this._id=a.id)}return Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){},a}();b.BaseContentProtection=j;var k=function(a){function b(b){a.call(this,b),"pro"in b&&(this._specificData=b.pro.__text)}return __extends(b,a),b.prototype.data=function(a){return 0===a?this._specificData:null},b.prototype.dispose=function(){},b.schemeIdUri="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",b}(j);b.PlayReadyContentProtection=k;var l=function(a){function b(b){a.call(this,b),"pssh"in b&&(this._specificData=b.pssh.__text),"laurl"in b&&(this._laUrl=b.laurl.licenseUrl)}return __extends(b,a),Object.defineProperty(b.prototype,"laUrl",{get:function(){return this._laUrl},enumerable:!0,configurable:!0}),b.prototype.data=function(a){return 1===a?this._specificData:null},b.prototype.dispose=function(){},b.schemeIdUri="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",b}(j);b.WidevineContentProtection=l;var m=function(a){function b(b){if(a.call(this,b),"SegmentEncryption"in b&&(this._seaEncryptionSystemId=b.SegmentEncryption.schemeIdUri,"CryptoPeriod"in b)){var c=b.CryptoPeriod;"keyUriTemplate"in c&&(this._keyUri=c.keyUriTemplate),"IV"in c&&(this._iv=c.IV)}}return __extends(b,a),b.prototype.data=function(a){switch(a){case 2:return this._seaEncryptionSystemId;case 3:return this._keyUri;case 4:return this._iv;default:return null}},b.prototype.dispose=function(){},b.schemeIdUri="urn:mpeg:dash:sea:2012",b}(j);b.SegmentEncryptionContentProtection=m;var n=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.prototype.data=function(){return null},b.prototype.dispose=function(){},b}(j);b.GenericContentProtection=n;var o=function(){function b(b,c){var d,e=0,f=1/0;b.length&&(d=b[0].streams,d&&d.length&&(d.forEach(function(a){2!==a.type&&a.segments&&a.segments.first&&a.segments.last&&(e=Math.max(e,a.segments.first.segmentInfo.presTimeInSec),f=Math.min(f,a.segments.last.segmentInfo.presTimeInSec+a.segments.last.segmentInfo.durationInSec))}),a.Log.verbose(4,"TimeShiftBufferTracker: leftEdge: "+e+" liveEdge: "+f+" duration: "+(f-e)),this._dvrWindowLenInSec=c?c:1/0,this._leftEdgeReferenceInPresentation=e,this._liveEdgeReferenceInPresentation=f,this._liveEdgeReferenceLocalTime=Date.now()))}return Object.defineProperty(b.prototype,"liveEdge",{get:function(){var a=(Date.now()-this._liveEdgeReferenceLocalTime)/1e3;return this._liveEdgeReferenceInPresentation+a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"leftEdge",{get:function(){var a=(Date.now()-this._liveEdgeReferenceLocalTime)/1e3,b=this._liveEdgeReferenceInPresentation+a;return b-this._leftEdgeReferenceInPresentation<this._dvrWindowLenInSec?this._leftEdgeReferenceInPresentation:b-this._dvrWindowLenInSec},enumerable:!0,configurable:!0}),b.prototype.adjust=function(b){var c=this._liveEdgeReferenceInPresentation+b;return 0>=c?void a.Log.warning(4,"TimeShiftBufferTracker error, ignoring invalid adjustment: "+b):(a.Log.verbose(4,"Adjusting TimeShiftBufferTracker: "+b),void(this._liveEdgeReferenceInPresentation=c))},b.prototype.adjustForChromeSourceDelay=function(b){this._liveEdgeReferenceLocalTime=b,a.Log.verbose(4,"Adjusting TimeShiftBufferTracker: _liveEdgeReferenceLocalTime to "+b)},b}(),p=function(){function b(){this.log=function(b){a.Log.verbose(4,b)}}return b}(),q=function(){function b(){this.manifestError=function(b){a.Log.error(4,b)}}return b}()}(a.DashPresentation||(a.DashPresentation={}));a.DashPresentation}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="DashUrlFormatter"}return b.prototype.init=function(a){var b=a.workflows[1];b.addHandler(b.stepEvents.requestSend,this.onUrlFormat,this)},b.prototype.dispose=function(){},b.prototype.onUrlFormat=function(b){return b.currentModuleId=this._moduleId,new Promise(function(c){if(!b.selectedTrack)throw new Error("Selected Track not set");var d=b.requestedStream.id;if(!d)throw new Error("stream id not set");var e=b.selectedTrack.bitrate;if(null===e||void 0===e)throw new Error("incorrect bitrate");var f=b.requestedStream.streamingInfo.currentSegment;if(!f)throw new Error("current segment not selected.");var g=f.segmentInfo.presTimeInSec;if(b.requestedStream.streamingInfo.fetchInitSegment){var h=b.requestedStream.initUrlTemplate;if(!h)throw new Error("initialization url template is not set for the stream");var i=a.Util.UrlFormatter.FormatDashInitUrl(h,e.toString(),b.sessionContext.presentationQueryStr);b.requestedStream.streamingInfo.fetchInitSegment=!1;var j=new a.Context.UrlRequest(i,2,0,d,e,g);b.urlsToRetrieve.push(j)}var k=b.requestedStream.mediaUrlTemplate;if(!k)throw new Error("media url template is not set for the stream");var l=f.segmentInfo.mediaTimestampStr,m=a.Util.UrlFormatter.FormatDashMediaUrl(k,e.toString(),l,b.sessionContext.presentationQueryStr);b.urlsToRetrieve.push(new a.Context.UrlRequest(m,1,0,d,e,g,f.segmentInfo.durationInSec)),c()})},b}();b.DashUrlFormatter=c}(a.UrlBuilder||(a.UrlBuilder={}));a.UrlBuilder}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._averageCalc=new a.Util.AverageCalculator(0,b._maxHistoryCount)}return Object.defineProperty(b.prototype,"averageDecryptionSpeed",{get:function(){return this._averageCalc.average},enumerable:!0,configurable:!0}),b.prototype.updateDecryptionSpeedInfo=function(a,b){var c=8*a/b;this._averageCalc.addValue(c)},b._maxHistoryCount=3,b}();b.DecryptionTracker=c}(a.Heuristics||(a.Heuristics={}));a.Heuristics}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="heuristics.Engine",this._disposed=!1}return b.prototype.dispose=function(){this._disposed=!0},b.prototype.init=function(a){var b=a.workflows[1];b.addHandler(b.stepEvents.requestSend,this.onGetIndex,this)},b.prototype.onGetIndex=function(b){function c(){b.selectedTrack!==b.requestedStream.streamingInfo.lastDownloadedTrack&&(b.requestedStream.streamingInfo.fetchInitSegment=!0)}function d(c){var d=b.heuristicData.tracksData;if(!c)throw new Error("findHighestTrack failed, invalid timeEstimationThresholdInSec");a.Log.verbose(8,"Time we have for fragment download: "+c+"s");for(var e=d.length-1;e>=0;e--)if(d[e].selectable&&d[e].dataRetrieverEstimationInWallClockSec*b.sessionContext.playbackRate()<c)return d[e].trackInfo;return null}function e(){for(var a=b.heuristicData.tracksData,c=1/0,d=a.length-1;d>=0;d--){var e=a[d];e.selectable&&(c=Math.min(c,e.dataRetrieverEstimationInWallClockSec))}return c}function f(a){for(var c=b.heuristicData.tracksData,d=null,e=c.length-1;e>=0;e--){var f=c[e];f.selectable&&f.trackInfo.bitrate>a&&(!d||f.trackInfo.bitrate<d.bitrate)&&(d=f.trackInfo)}return d}var g=this;a.Log.verbose(8,"OnGetIndex"),b.currentModuleId=this._moduleId;return new Promise(function(h,i){function j(){c(),h()}if(g._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void i("object is already disposed.");if(b.selectedTrack)return void j();if(0!==b.requestedStream.type)return b.selectedTrack=b.requestedStream.tracks[0],void j();var k=b.heuristicData.tracksData.findFirst(function(a){return a.selectable===!0});if(!k)return b.selectedTrack=b.heuristicData.tracksData[0].trackInfo,void j();b.selectedTrack=k.trackInfo;var l=b.requestedStream.streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec(),m=5*b.sessionContext.playbackRate();if(!b.requestedStream.streamingInfo.currentSegment)return void j();m=a.StreamUtil.getSegmentDuration(b);var n=b.sessionContext.maxBufferInSec()*b.sessionContext.heuristicSettings.vodStableBufferLevelPercent,o=b.sessionContext.maxBufferInSec()*b.sessionContext.heuristicSettings.vodDowngradeBufferLevelPercent;o>l&&!b.sessionContext.videoTag.paused&&(m*=b.sessionContext.heuristicSettings.belowDowngradeBufferLevelDownloadTimeFactor);var p=d(m);!p&&e()===1/0&&b.requestedStream.streamingInfo.lastDownloadedTrack&&(p=f(b.requestedStream.streamingInfo.lastDownloadedTrack.bitrate)),(!p||l>n&&p.bitrate<b.requestedStream.streamingInfo.lastDownloadedTrack.bitrate)&&b.heuristicData.tracksData.findFirst(function(a){return a.trackInfo===b.requestedStream.streamingInfo.lastDownloadedTrack&&a.selectable})&&(p=b.requestedStream.streamingInfo.lastDownloadedTrack),p&&(a.Log.verbose(8,"Selected bitrate: "+p.bitrate),b.selectedTrack=p),j()})},b}();b.Engine=c}(a.Heuristics||(a.Heuristics={}));a.Heuristics}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="stepRule",this._disposed=!1,this._currentTrackSegmentCount=0,this._previousTrackSelected=null,this._currentSelectedVideoStream=null}return b.prototype.dispose=function(){this._disposed=!0,this._previousTrackSelected=null,this._currentSelectedVideoStream=null},b.prototype.init=function(a){var b=a.workflows[1];b.addHandler(b.stepEvents.requestBegin,this.onRunStepRule,this)},b.prototype.onRunStepRule=function(b){var c=this;a.Log.verbose(8,"onRunStepRule"),b.currentModuleId=this._moduleId;var d=this;return new Promise(function(e,f){if(d._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void f("object is already disposed.");if(b.selectedTrack||null===b.requestedStream.streamingInfo.lastDownloadedTrack||0!==b.requestedStream.type)return void e();b.requestedStream!==c._currentSelectedVideoStream&&(d._currentSelectedVideoStream=b.requestedStream,d._previousTrackSelected=null),
b.requestedStream.streamingInfo.lastDownloadedTrack===d._previousTrackSelected?d._currentTrackSegmentCount++:(d._previousTrackSelected=b.requestedStream.streamingInfo.lastDownloadedTrack,d._currentTrackSegmentCount=1);var g=d._currentTrackSegmentCount>=b.sessionContext.heuristicSettings.stepRule.minSegmentsBeforeDowngrade,h=d._currentTrackSegmentCount>=b.sessionContext.heuristicSettings.stepRule.minSegmentsBeforeUpgrade,i=b.requestedStream.tracks.indexOf(d._previousTrackSelected),j=i,k=i;g&&b.sessionContext.heuristicSettings.stepRule.maxStepDownInQuality>0&&(j=Math.max(0,i-b.sessionContext.heuristicSettings.stepRule.maxStepDownInQuality)),h&&b.sessionContext.heuristicSettings.stepRule.maxStepUpInQuality>0&&(k=Math.min(b.heuristicData.tracksData.length-1,i+b.sessionContext.heuristicSettings.stepRule.maxStepUpInQuality));for(var l=0;l<b.heuristicData.tracksData.length;l++)(l>k||j>l)&&(b.heuristicData.tracksData[l].selectable=!1);e()})},b}();b.StepRule=c}(a.Heuristics||(a.Heuristics={}));a.Heuristics}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="windowSizeRule",this._disposed=!1,this._windowHeight=0,this._windowWidth=0,this._highestTrackIndexAllowed=0,this._currentSelectedVideoStream=null}return b.prototype.dispose=function(){this._disposed=!0,this._currentSelectedVideoStream=null},b.prototype.init=function(a){var b=a.workflows[1];b.addHandler(b.stepEvents.requestBegin,this.onRunWindowSizeRule,this)},b.prototype.onRunWindowSizeRule=function(b){a.Log.verbose(8,"onRunWindowSizeRule"),b.currentModuleId=this._moduleId;var c=!1,d=this;return new Promise(function(e,f){if(d._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void f("object is already disposed.");if(b.selectedTrack||!b.sessionContext.heuristicSettings.windowSizeHeuristicsEnabled||0!==b.requestedStream.type)return void e();b.requestedStream!==d._currentSelectedVideoStream&&(d._currentSelectedVideoStream=b.requestedStream,d._highestTrackIndexAllowed=0);var g,h;if(b.sessionContext.heuristicSettings.useBrowserWindowForWindowSizeRule?(g=window.innerWidth,h=window.innerHeight):(g=Math.max(b.sessionContext.videoTag.scrollWidth,b.sessionContext.videoTag.width),h=Math.max(b.sessionContext.videoTag.scrollHeight,b.sessionContext.videoTag.height)),0===h||0===g)return a.Log.warning(8,"Ignoring window size heuristic rule, as one of the window dimensions is 0."),void e();(d._windowWidth!==g||d._windowHeight!==h)&&((d._windowWidth<g||d._windowHeight<h)&&(c=!0),d._windowWidth=g,d._windowHeight=h,d._highestTrackIndexAllowed=0);for(var i=b.heuristicData.tracksData,j=!1,k=0,l=0,m=d._highestTrackIndexAllowed;m<i.length;m++)i[m].selectable&&i[m].trackInfo.width>g&&i[m].trackInfo.height>h&&(j?i[m].trackInfo.width==k&&i[m].trackInfo.height==l?d._highestTrackIndexAllowed=m:i[m].selectable=!1:(j=!0,d._highestTrackIndexAllowed=m,k=i[m].trackInfo.width,l=i[m].trackInfo.height));j||(d._highestTrackIndexAllowed=i.length-1),c&&b.requestedStream.streamingInfo.lastDownloadedTrack&&i[d._highestTrackIndexAllowed].trackInfo.bitrate>b.requestedStream.streamingInfo.lastDownloadedTrack.bitrate&&b.sessionContext.eventMgr.dispatchEvent(a.InternalEventName.flushvideo),e()})},b}();b.WindowSizeRule=c}(a.Heuristics||(a.Heuristics={}));a.Heuristics}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c;!function(a){a[a.success=200]="success",a[a.notFound=404]="notFound",a[a.badGateway=502]="badGateway"}(c||(c={}));var d=function(){function b(b){this._moduleId="httpDataRetriever",this._requestList=[],this._disposed=!1,this._bandwidthRequest=null,this._bandwidthData=new a.Heuristics.BandwidthTracker(b.heuristicSettings.bandwidth,b.decryptionTracker),b.videoBufferData.updateBandwidthTracker(this._bandwidthData)}return b.prototype.dispose=function(){for(;this._requestList.length>0;){var a=this._requestList.pop();a.request=null,a=null}this._bandwidthRequest=null,this._disposed=!0},b.prototype.init=function(a){var b=a.workflows[0],c=a.workflows[1];b.addHandler(b.stepEvents.requestBegin,this.onGetData,this),b.addHandler(b.stepEvents.requestEnd,this.onGetData,this),c.addHandler(c.stepEvents.requestBegin,this.onReportHeuristicData,this),c.addHandler(c.stepEvents.requestSend,this.onGetData,this)},b.prototype.onReportHeuristicData=function(b){a.Log.verbose(5,"onReportHeuristicData"),b.currentModuleId=this._moduleId;var c=this;return new Promise(function(d,e){return c._disposed?(a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void e("object is already disposed.")):0!==b.requestedStream.type?void d():(c._bandwidthData.reportHeuristicsData(b.heuristicData,a.StreamUtil.getSegmentDuration(b)),void d())})},b.prototype.getResponseHeaders=function(a,b){for(var c=b.sessionContext.headers||[],d={},e=0;e<c.length;e++)d[c[e]]=a.getResponseHeader(c[e]);return d},b.prototype.onGetData=function(c){a.Log.verbose(5,"onGetData"),c.currentModuleId=this._moduleId;var d=this;return new Promise(function(g,h){function i(){if(a.assert(null!=c.urlsToRetrieve[s],"Failed to start the download as urlToRetrieve at index "+s+" is null"),a.assert(null!=c.urlsToRetrieve[s].url&&c.urlsToRetrieve[s].url.length>0,"Failed to start the download as urlToRetrieve at index "+s+" is empty"),c.requestedStream&&(c.requestedStream.streamingInfo.abortCurrentRequest=!1),d._bandwidthRequest&&d._bandwidthRequest.req.streamId===c.urlsToRetrieve[s].streamId&&d._bandwidthRequest.req.presTimeInSec===c.urlsToRetrieve[s].presTimeInSec){var e=c.heuristicData.tracksData.findFirst(function(a){return a.trackInfo.bitrate===d._bandwidthRequest.req.bitrate});e&&d._bandwidthRequest.req.bitrate>=c.urlsToRetrieve[s].bitrate?2===c.urlsToRetrieve[s].requestType?d._bandwidthRequest.req.bitrate!==c.urlsToRetrieve[s].bitrate&&(a.Log.verbose(5,"Switching init segment request "+c.urlsToRetrieve[s].url+" to "+d._bandwidthRequest.req.bitrate),c.urlsToRetrieve[s].bitrate=d._bandwidthRequest.req.bitrate,c.urlsToRetrieve[s].url=a.Util.UrlFormatter.FormatDashInitUrl(c.requestedStream.initUrlTemplate,d._bandwidthRequest.req.bitrate.toString(),c.sessionContext.presentationQueryStr),c.selectedTrack=e.trackInfo):(a.Log.verbose(5,"Reusing bandwidth request "+d._bandwidthRequest.req.url),c.urlsToRetrieve[s].dispose(),c.urlsToRetrieve[s]=d._bandwidthRequest.req,1===c.workflowType&&a.StreamUtil.getBufferData(c).dispatchDownloadCompleted(p(s),d._bandwidthRequest.info,d._bandwidthRequest.headers),d._bandwidthRequest=null):(d._bandwidthRequest.req.dispose(),d._bandwidthRequest=null)}if(0===c.urlsToRetrieve[s].responseType&&null!=c.urlsToRetrieve[s].mediaData||4===c.urlsToRetrieve[s].responseType&&null!=c.urlsToRetrieve[s].presentationData){if(4===c.urlsToRetrieve[s].responseType&&null!=c.sessionContext.commonPresentation){var g=c.sessionContext.httpDataRetrieverSettings,h=1e3*c.sessionContext.commonPresentation.maxSegmentDuration;g.timeoutInMSec=Math.max(g.timeoutInMSec,2*h),g.timeoutInMSec=Math.min(g.timeoutInMSec,g.maxTimeoutInMSec),a.Log.verbose(5,"Setting data retriever timeout: "+g.timeoutInMSec+" ms")}s++,s>=c.urlsToRetrieve.length?q(null):i()}else{1===c.workflowType&&a.StreamUtil.getBufferData(c).dispatchDownloadRequested(p(s));var o=c.sessionContext.createXmlHttpRequest();o.open("GET",c.urlsToRetrieve[s].url),o.onreadystatechange=j,o.onprogress=k,o.onload=l,o.onerror=m,o.ontimeout=n,o.onabort=m,0===c.urlsToRetrieve[s].responseType&&(o.responseType=a.Context.ResponseType[0]),o.msCaching&&(o.msCaching="disabled"),o.timeout=c.sessionContext.httpDataRetrieverSettings.timeoutInMSec;var r=new f(c.urlsToRetrieve[s],o);if(c.requestedStream&&0==c.requestedStream.type&&c.selectedTrack?a.Log.verbose(5,"HeuristicInfo: SuggestedBr: "+c.selectedTrack.bitrate+" CurrentBw: "+Math.floor(1e3*d._bandwidthData.latestInKbps)+" AverageBw: "+Math.floor(1e3*d._bandwidthData.averageBandwidthInKbps)+" BufferSize: "+c.requestedStream.streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()+" StreamType: "+a.Presentation.StreamType[c.requestedStream.type]+" StreamName: "+c.requestedStream.language+" Index: "+c.requestedStream.streamingInfo.currentSegment.segmentInfo.index+" TimeInMS: "+c.requestedStream.streamingInfo.currentSegment.segmentInfo.presTimeInSec+" MediaTimeStamp: "+c.requestedStream.streamingInfo.currentSegment.segmentInfo.mediaTimestamp+" Index: "+c.requestedStream.streamingInfo.currentSegment.segmentInfo.index+" Duration: "+(c.requestedStream.streamingInfo.currentSegment.segmentInfo.durationInSec||0)+" Url: "+c.urlsToRetrieve[s].url+" TimeoutInMS: "+c.sessionContext.httpDataRetrieverSettings.timeoutInMSec):0===c.workflowType&&a.Log.verbose(5,"Getting "+c.urlsToRetrieve[s].url),d._requestList.push(r),a.Common.isEdge){var t=function(c){if(!d._disposed&&c.urlRequest.url){var e=Date.now();a.Log.verbose(5,"Network req check: time since last progress: "+(e-c.lastProgressTimestamp)+" ,"+c.networkRequestCheckTimerId+", "+c.urlRequest.url),e-c.lastProgressTimestamp>o.timeout?(a.Log.verbose(5,"Stale http request with failed timeout. Aborting request: "+c.networkRequestCheckTimerId+", "+c.urlRequest.url),c.abortRequest()):c.networkRequestCheckTimerId=a.Util.setTimeout(t,b._networkRequestCheckPeriodInMSec,c)}};1===c.workflowType&&(r.networkRequestCheckTimerId=a.Util.setTimeout(t,b._networkRequestCheckPeriodInMSec,r))}o.send()}}function j(){var b=this;if(!d._disposed){var c=d._requestList.findFirst(function(a){return a.request===b});a.assert(null!=c,"cannot find the request in the request queue"),c.request.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!c.bandwidthInfo.responseStartTimeInMS&&(c.bandwidthInfo.responseStartTimeInMS=Date.now(),c.request.onreadystatechange=null)}}function k(b){var e=this;if(!d._disposed){var f=Date.now(),g=d._requestList.findFirst(function(a){return a.request===e});if(a.assert(null!=g,"cannot find the request in the request queue"),g.lastProgressTimestamp=f,!(a.Common.isSafari&&a.Common.isOSXElCapitanOrEarlier()&&g.getIsAbortInProgress())){if(g.request.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!g.bandwidthInfo.responseStartTimeInMS&&(g.bandwidthInfo.responseStartTimeInMS=f),c.requestedStream&&c.requestedStream.streamingInfo.abortCurrentRequest&&g.request.readyState<4)return g.abortRequest(),void a.Log.verbose(5,"Aborting request: "+g.urlRequest.url);if(0===b.loaded){var h=g.bandwidthInfo.responseStartTimeInMS,i=c.sessionContext.httpDataRetrieverSettings.noDataTimeoutInMSec;if(f-h>i)return g.abortRequest(),void a.Log.verbose(5,"Aborting request after timeout with no data received: "+g.urlRequest.url)}if(3===g.urlRequest.requestType){var h=g.bandwidthInfo.responseStartTimeInMS,i=c.sessionContext.httpDataRetrieverSettings.initBandwidthTimeoutInMSec;if(f-h>i){g.bandwidthInfo.responseLengthInBytes=b.loaded,g.bandwidthInfo.responseEndTimeInMS=f;var j=c.sessionContext&&c.sessionContext.commonPresentation&&c.sessionContext.commonPresentation.isLive;d._bandwidthData.updateBandwidthInfo(g.bandwidthInfo,j,g.urlRequest,c),g.abortRequest(),a.Log.verbose(5,"Aborting init bandwidth request due to timeout: "+g.urlRequest.url)}}}}}function l(){var b=this;if(!d._disposed){var f=d._requestList.findFirst(function(a){return a.request===b});a.assert(null!=f,"cannot find the request in the request queue"),f.bandwidthInfo.responseEndTimeInMS=Date.now(),d.stopNetworkRequestCheck(f);var g=c.urlsToRetrieve.indexOf(f.urlRequest);if(c.urlsToRetrieve[g].httpResposeContentType=this.getResponseHeader("Content-Type"),c.urlsToRetrieve[g].httpResponseCode=this.status,200===this.status){switch(d._requestList.removeFirst(function(a){return a.request===b}),f.urlRequest.responseType){case 0:c.urlsToRetrieve[g].mediaData=this.response,f.bandwidthInfo.responseLengthInBytes=c.urlsToRetrieve[g].mediaData.byteLength;var h=d.getResponseHeaders(this,c);1===c.workflowType?a.StreamUtil.getBufferData(c).dispatchDownloadCompleted(p(g),f.bandwidthInfo,h):(d._bandwidthRequest=new e(c.urlsToRetrieve[g].clone(),f.bandwidthInfo,h),d._bandwidthRequest.req.requestType=1,c.sessionContext.eventMgr.dispatchEvent(a.EventName.initialBandwidthEstimationCompleted));break;case 4:c.urlsToRetrieve[g].presentationData=this.response,f.bandwidthInfo.responseLengthInBytes=c.urlsToRetrieve[g].presentationData.length,c.sessionContext.eventMgr.dispatchEvent(a.EventName.manifestFetchCompleted);break;default:a.assert(!1,"Unexpected response Type in the request Context")}var j=this.getResponseHeader("Content-Length");if(null===j&&(j="unknown"),a.Log.verbose(5,"Download Finished for : "+f.urlRequest.url+" with bytes: "+f.bandwidthInfo.responseLengthInBytes+", contentLength: "+j),c.requestedStream){var k=c.sessionContext&&c.sessionContext.commonPresentation&&c.sessionContext.commonPresentation.isLive;d._bandwidthData&&0===c.requestedStream.type&&d._bandwidthData.updateBandwidthInfo(f.bandwidthInfo,k,f.urlRequest,c),c.requestedStream.streamingInfo.lastDownloadedTrack=c.selectedTrack}if(s++,a.Log.verbose(5,"index="+s+", urlsToRetrieve.length="+c.urlsToRetrieve.length),s>=c.urlsToRetrieve.length)return void q(f);a.Log.verbose(5,"Next request to process: "+c.urlsToRetrieve[s].url),i()}else a.Log.error(5,f.urlRequest.url+" failed, httpStatus: "+this.status),o.call(this,a.Failure.translateHttpStatusToCode(this.status))}}function m(b){if(!d._disposed){var c=2097152;"error"===b.type?c=a.Common.clientIsOffline()?2097755:2097753:"abort"===b.type&&(c=2097754),o.call(this,c,"http: "+b.type)}}function n(b){var e=this;if(!d._disposed){var f=d._requestList.findFirst(function(a){return a.request===e});if(a.assert(null!=f,"cannot find the request in the request queue"),b.loaded&&1===f.urlRequest.requestType){var g=c.sessionContext&&c.sessionContext.commonPresentation&&c.sessionContext.commonPresentation.isLive;f.bandwidthInfo.responseLengthInBytes=b.loaded,f.bandwidthInfo.responseEndTimeInMS=Date.now(),d._bandwidthData.updateBandwidthInfo(f.bandwidthInfo,g,f.urlRequest,c)}o.call(this,2097752,"http timed out")}}function o(b,e){var f=this,g=d._requestList.removeFirst(function(a){return a.request===f});!a.Common.isFirefox&&a.Common.isSafari&&a.Common.isOSXElCapitanOrEarlier()||a.assert(null!=g,"cannot find the request in the request queue");var h=!1;c.requestedStream&&c.requestedStream.streamingInfo.abortCurrentRequest&&(c.requestedStream.streamingInfo.abortCurrentRequest=!1,h=!0);var i=null!=g?g.urlRequest.url:"no details info";e&&(i+=", "+e);var j=new a.Failure.Record(c.currentModuleId,b,i);if(a.Log.error(5,j.toString()),null!=g)if(c.requestedStream){-1!==c.urlsToRetrieve.findIndexOf(function(a){return 2===a.requestType})&&(c.requestedStream.streamingInfo.fetchInitSegment=!0);var k=c.urlsToRetrieve.indexOf(g.urlRequest);if(1===c.workflowType&&a.StreamUtil.getBufferData(c).dispatchDownloadFailed(p(k),b,e),2097556===b&&c.sessionContext.commonPresentation.isLive&&c.requestedStream.streamingInfo&&c.requestedStream.streamingInfo.currentSegment&&!c.requestedStream.streamingInfo.currentSegment.next){var l=c.requestedStream.streamingInfo.currentSegment.segmentInfo,m=l?l.presTimeInSec:null;c.requestedStream.streamingInfo.currentSegment=c.requestedStream.streamingInfo.currentSegment.prev,c.failTracker.reset(),a.Log.verbose(5,"hit past live edge with 404: "+(e?e+", ":"")+"presTimeInSec: "+m+" "+g.urlRequest.url),c.externalFailure=j,r(g)}else if(2097564===b&&c.sessionContext.commonPresentation.isLive&&c.requestedStream.streamingInfo&&c.requestedStream.streamingInfo.currentSegment&&!c.requestedStream.streamingInfo.currentSegment.next){if(c.state=2,c.retryWaitTimeMSec=c.sessionContext.httpRetryPolicySettings.retryMediaInMSec,c.failTracker.log(j,c.selectedTrack,c.requestedStream.type),2!==c.requestedStream.type){var n=c.sessionContext.httpDataRetrieverSettings.liveEdgeAdjustmentInSec;c.sessionContext.commonPresentation.adjustPlayableWindow(n)}else c.retryWaitTimeMSec=c.sessionContext.httpRetryPolicySettings.retryDueTo412InTextTrackInMSecDefault;var l=c.requestedStream.streamingInfo.currentSegment.segmentInfo,m=l?l.presTimeInSec:null;a.Log.verbose(5,"hit past live edge with 412: "+(e?e+", ":"")+"presTimeInSec: "+m+" "+g.urlRequest.url),q(g)}else 0!==c.workflowType&&g&&g.urlRequest&&3!==g.urlRequest.requestType&&(c.state=2,c.failTracker.log(j,c.selectedTrack),c.failTracker.noDataReceivedFailure=!g.bandwidthInfo.responseLengthInBytes,c.retryWaitTimeMSec=c.failTracker.isLastServerError()?c.sessionContext.httpRetryPolicySettings.retryMediaServerErrorInMSec:2097753===b||2097755===b?c.sessionContext.httpRetryPolicySettings.retryDueToNetworkErrorInMSec:0),a.Log.error(5,"failed to download: "+(e?e+", ":"")+g.urlRequest.url),q(g)}else 0!==c.workflowType||2097556!==b&&2097752!==b&&2097753!==b&&2097755!==b?(c.externalFailure=j,a.Log.error(5,"failed to download: "+(e?e+", ":"")+g.urlRequest.url),r(g)):(c.state=2,c.retryWaitTimeMSec=2097556===b?c.sessionContext.httpRetryPolicySettings.retryPresentationInMSec:2097753===b||2097755===b?c.sessionContext.httpRetryPolicySettings.retryDueToNetworkErrorInMSec:0,c.failTracker.log(j),a.Log.error(5,"failed to download: "+(e?e+", ":"")+g.urlRequest.url),q(g));h&&c.failTracker.reset()}function p(b){var d=c.urlsToRetrieve[b],e=c.requestedStream.presentationTimeOffsetInSec,f=c.requestedStream.streamingInfo.currentSegment.segmentInfo,g=2===d.requestType?null:f.mediaTimestamp/f.timescale;return new a.Context.MediaDownload(d.url,c.selectedTrack.bitrate,g,d.mediaData,e,f.timescale,f.durationInSec)}function q(a){a&&d.stopNetworkRequestCheck(a),g()}function r(a,b){a&&d.stopNetworkRequestCheck(a),b?h(b):h()}if(d._disposed)return a.Failure.attachFailureToRequest(c,c.currentModuleId,0),void r(null,"object is already disposed.");a.assert(0!==c.urlsToRetrieve.length,"Failed to start the download as urlsToRetrieve is empty.");var s=0;i()})},b.prototype.stopNetworkRequestCheck=function(b){b.networkRequestCheckTimerId&&(a.Util.clearTimeout(b.networkRequestCheckTimerId),b.networkRequestCheckTimerId=0)},b._networkRequestCheckPeriodInMSec=2e3,b}();b.HttpDataRetriever=d;var e=function(){function a(a,b,c){this.req=a,this.info=b,this.headers=c}return a}(),f=function(){function b(b,c){this.urlRequest=b,this.request=c,this.bandwidthInfo=new a.Heuristics.BandwidthInfo,this.abortStarted=!1,this.lastProgressTimestamp=Date.now(),this.networkRequestCheckTimerId=0}return b.prototype.abortRequest=function(){this.abortStarted=!0,this.request.abort()},b.prototype.getIsAbortInProgress=function(){return this.abortStarted},b}()}(a.DataRetriever||(a.DataRetriever={}));a.DataRetriever}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c;!function(a){a[a.noRetry=0]="noRetry",a[a.nextTrack=1]="nextTrack",a[a.nextTrackDown=2]="nextTrackDown",a[a.nextSegment=3]="nextSegment",a[a.same=4]="same"}(c||(c={}));var d=function(){function b(){this._moduleId="httpRetryPolicy",this._disposed=!1}return b.prototype.dispose=function(){this._disposed||(this._disposed=!0)},b.prototype.init=function(a){var b=a.workflows[0],c=a.workflows[1];b.addHandler(c.stepEvents.requestBegin,this.onPresentationRetry,this),c.addHandler(c.stepEvents.requestBegin,this.onMediaRetry,this)},b.prototype.onPresentationRetry=function(b){var d=this;return a.Log.verbose(5,"onPresentationRetry"),b.currentModuleId=this._moduleId,new Promise(function(e,f){if(d._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void f("object is already disposed.");var g=b.failTracker,h=b.sessionContext.httpRetryPolicySettings;if(g.isNone())return void e();var i=d._getAction(0,h,b);switch(i){case 0:return b.externalFailure=g.lastFailure,a.Log.verbose(5,"onPresentationRetry: noRetry, "+b.urlsToRetrieve[0].url),void f();case 4:g.sameRequestRetried++;break;default:throw new Error("unexpected retry action: "+i)}g.totalRetried++,a.Log.verbose(5,"onPresentationRetry: "+c[i]+" URL: "+b.urlsToRetrieve[0].url),e()})},b.prototype.onMediaRetry=function(b){var d=this;return a.Log.verbose(5,"onMediaRetry"),b.currentModuleId=this._moduleId,new Promise(function(e,f){if(d._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void f("object is already disposed.");if(!b.requestedStream)return void e();var g=b.failTracker,h=b.requestedStream.streamingInfo,i=b.sessionContext.httpRetryPolicySettings;if(g.isNone()||null!==h.pendingSeekPositionInSec)return void e();0===g.totalRetried&&(g.tracksToTry=d._createTrackToTry(i,b.requestedStream,g.lastTrack));var j=d._getAction(1,i,b);switch(j){case 0:return b.externalFailure=g.lastFailure,a.Log.verbose(5,"onMediaRetry: noRetry,mediaTimestamp: "+h.currentSegment.segmentInfo.mediaTimestamp),void f();case 1:case 2:var k,l;g.sameRequestRetried++,b.selectedSegment=h.currentSegment,l=g.trackToTryIdx<g.tracksToTry.length-1?g.trackToTryIdx+1:0,k=g.tracksToTry[l],(1===j||k.bitrate<g.lastTrack.bitrate)&&(g.trackToTryIdx=l),b.selectedTrack=g.tracksToTry[g.trackToTryIdx];break;case 3:if(!h.currentSegment.next)return b.externalFailure=g.lastFailure,b.sessionContext&&b.sessionContext.commonPresentation&&b.sessionContext.commonPresentation.isLive?g.reset():a.Log.verbose(5,"onRetry: noRetry, EOS mediaTimestamp: "+h.currentSegment.segmentInfo.mediaTimestamp),void f();h.currentSegment=h.currentSegment.next,g.segmentsSkipped++,g.resetForSegment(),b.selectedSegment=h.currentSegment,b.selectedTrack=g.tracksToTry[0];break;case 4:g.sameRequestRetried++,b.selectedSegment=h.currentSegment,b.selectedTrack=g.tracksToTry[0];break;default:throw new Error("unexpected retry action: "+j)}g.totalRetried++,a.Log.verbose(5,"onRetry: "+c[j]+" bitrate: "+b.selectedTrack.bitrate+" mediaTimestamp: "+b.selectedSegment.segmentInfo.mediaTimestamp),e()})},b.prototype._getAction=function(a,b,c){var d=0,e=!1,f=c.failTracker;if(c.sessionContext&&c.sessionContext.commonPresentation&&(e=c.sessionContext.commonPresentation.isLive),0===a)d=f.sameRequestRetried>=b.maxRetryPresentation?0:4;else if(f.totalRetried>=b.maxTotalRetries&&2!==f.lastStreamType||f.segmentsSkipped>=b.maxSkipSegments&&(f.trackToTryIdx>=f.tracksToTry.length-1||f.sameRequestRetried>=b.maxRetryPerSegment))d=b.infiniteSegmentRetryForPreconditionFailed&&e&&this._isLiveEdge(c)&&f.isLastNotReady()?4:0;else if(f.isSegmentDecryptionError()||f.isLastNotFound()||f.isLastNotReady()&&e&&!this._isLiveEdge(c))d=f.trackToTryIdx<f.tracksToTry.length-1&&f.sameRequestRetried<b.maxRetryPerSegment?1:3;else if(e&&this._isLiveEdge(c)&&f.isLastNotReady())d=4,f.sameRequestRetried>=b.maxRetryPerSegment&&2!==f.lastStreamType&&!b.infiniteSegmentRetryForPreconditionFailed&&(d=0);else if(f.isLastServerError())d=1;else if(f.isLastNetworkFail()){var g=e&&this._isLiveEdge(c)&&f.isLastNetworkDown()?3*b.maxRetryPerSegment:b.maxRetryPerSegment;d=f.sameRequestRetried<g?f.noDataReceivedFailure?4:2:3}else d=0;return d},b.prototype._isLiveEdge=function(a){var b=!1;if(!a.requestedStream||!a.requestedStream.streamingInfo)return b;var c=a.requestedStream.streamingInfo.currentSegment;return b=c&&!c.next?!0:!1},b.prototype._createTrackToTry=function(a,b,c){var d=[],e=b.tracks.indexOf(c),f=b.tracks.length;d.push(b.tracks[e]);for(var g=e-1;g>=0;g--)b.tracks[g].streamingInfo.selectable&&d.push(b.tracks[g]);if(!a.retryLowerBitrateOnly)for(var g=e+1;f>g;g++)b.tracks[g].streamingInfo.selectable&&d.push(b.tracks[g]);return d},b}();b.HttpRetryPolicy=d}(a.DataRetriever||(a.DataRetriever={}));a.DataRetriever}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c;!function(a){a[a.success=200]="success",a[a.notFound=404]="notFound",a[a.badGateway=502]="badGateway"}(c||(c={}));var d=function(){function b(){this._moduleId="InitialBandwidthDataUrlFormatter",this._disposed=!1}return b.prototype.dispose=function(){this._disposed=!0},b.prototype.init=function(a){var b=a.workflows[0];b.addHandler(b.stepEvents.requestEnd,this.onPreFetchUrlFormat,this)},b.prototype.onPreFetchUrlFormat=function(b){a.Log.verbose(6,"OnPreFetchUrlFormat"),b.currentModuleId=this._moduleId;var c=this;return new Promise(function(d,e){if(c._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void e("object is already disposed.");if(!b.sessionContext.heuristicSettings.preFetchDataEnabled)return void d();var f=b.sessionContext.commonPresentation.periods[0].streams,g=f.findFirst(function(a){return 0===a.type});if(b.requestedStream=g,!b.requestedStream)return void d();var h=c.getBitrate(b);if(!h)throw new Error("bitrate of video track not set in presentation");var i=b.requestedStream.mediaUrlTemplate;if(!i)throw new Error("media url template is not set for the video stream");var j,k=g.segments;j=b.sessionContext.commonPresentation.isLive?k.last.segmentInfo:k.first.segmentInfo;var l=a.Util.UrlFormatter.FormatDashMediaUrl(i,h.toString(),j.mediaTimestampStr,b.sessionContext.presentationQueryStr),m=new a.Context.UrlRequest(l,3,0,g.id,h,j.presTimeInSec,j.durationInSec);b.urlsToRetrieve.push(m),b.sessionContext.heuristicSettings.preFetchDataEnabled=!1,d()})},b.prototype.getBitrate=function(a){var b=Math.max(a.sessionContext.videoTag.scrollWidth,a.sessionContext.videoTag.width),c=Math.max(a.sessionContext.videoTag.scrollHeight,a.sessionContext.videoTag.height),d=0;if(c>0&&b>0){for(var e=a.requestedStream.tracks,f=0,g=0,h=0;h<e.length;h++)if(e[h].selectable&&(!d&&e[h].width>b&&e[h].height>c||d&&f===e[h].width&&g===e[h].height))d=e[h].bitrate,f=e[h].width,g=e[h].height;else if(d)break;if(0==d){for(var h=e.length-1;h>=0&&(e[h].selectable&&(e[h].width>b||e[h].height>c));h--)d=e[h].bitrate;0==d&&e.length>0&&(d=e[e.length-1].bitrate)}}if(0==d)if(a.sessionContext.heuristicSettings.preFetchDataMiddle){var i;i=Math.round(a.requestedStream.tracks.length/2)-1,d=a.requestedStream.tracks[i].bitrate}else d=a.requestedStream.tracks[0].bitrate;return d},b}();b.InitialBandwidthDataUrlFormatter=d}(a.Heuristics||(a.Heuristics={}));a.Heuristics}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="streamSelector",this._disposed=!1,this._initial=!0}return b.prototype.dispose=function(){this._disposed=!0},b.prototype.init=function(a){var b=a.workflows[0];b.addHandler(b.stepEvents.requestEnd,this.onSelectStreams,this)},b.prototype.onSelectStreams=function(b){var c=this;return b.currentModuleId=this._moduleId,new Promise(function(d,e){var f=!1,g=!1,h=!1,i=null,j=!1,k=b.sessionContext.commonPresentation;if(c._disposed)return a.Failure.attachFailureToRequest(b,b.currentModuleId,0),void e("Disposed");if(!c._initial)return void d();if(!k)throw new Error("CommonPresentation is empty");k.periods[0].streams.forEach(function(a){a.streamingInfo.selected=!1});for(var l=k.periods[0].streams.length-1;l>=0;l--)0!==k.periods[0].streams[l].type||f?1===k.periods[0].streams[l].type?(k.periods[0].streams[l].streamingInfo.supported=MediaSource.isTypeSupported&&MediaSource.isTypeSupported(k.periods[0].streams[l].codec)||k.periods[0].streams[l].codec.indexOf("aac")>-1||k.periods[0].streams[l].codec.indexOf("mp4a")>-1,g&&h||!k.periods[0].streams[l].streamingInfo.supported||(g?!h&&k.periods[0].streams[l].codec.indexOf("ec-3")>-1&&(h=!0,null!==i&&(i.streamingInfo.selected=!1),k.periods[0].streams[l].streamingInfo.selected=!0):(g=!0,k.periods[0].streams[l].streamingInfo.selected=!0,i=k.periods[0].streams[l],k.periods[0].streams[l].codec.indexOf("ec-3")>-1&&(h=!0)))):2!==k.periods[0].streams[l].type||j||(j=!0,k.periods[0].streams[l].streamingInfo.selected=!0):(f=!0,k.periods[0].streams[l].streamingInfo.selected=!0);return f||g?(c._initial=!1,void d()):(a.Failure.attachFailureToRequest(b,b.currentModuleId,4194307),void e("Neither video nor audio streams are found"))})},b}();b.InitialStreamSelector=c}(a.Presentation||(a.Presentation={}));a.Presentation}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function a(a,b,c,d,e){this.index=a,this._timescale=e,this._presentationOffset=d,this._mediaTimestampStr=b,this._mediaTimestamp=parseInt(b),this._presTimeInSec=(this._mediaTimestamp+d)/e,c&&(this._mediaDuration=c,this._durationInSec=c/e)}return Object.defineProperty(a.prototype,"timescale",{get:function(){return this._timescale},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"presentationOffset",{get:function(){return this._presentationOffset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mediaTimestampStr",{get:function(){return this._mediaTimestampStr},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mediaTimestamp",{get:function(){return this._mediaTimestamp},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mediaDuration",{get:function(){return this._mediaDuration},set:function(a){this._mediaDuration=a,this._durationInSec=a/this._timescale},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"presTimeInSec",{get:function(){return this._presTimeInSec},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"durationInSec",{get:function(){return this._durationInSec},enumerable:!0,configurable:!0}),a.prototype.update=function(a,b){a&&(this.index+=a),this._presentationOffset!==b&&(this._presentationOffset=b,this._presTimeInSec=(this._mediaTimestamp+b)/this._timescale)},a}();b.MediaSegmentInfo=c;var d=function(){function a(a,b,d,e,f,g){this.firstSegment=new c(a,b,d,e,f),this.repeat=g,this.containerIndex=0/0}return a}();b.SegmentRunEntry=d;var e=function(){function b(b,d,e){this._container=b,this._pubTime=b.pubTime,this._runEntry=d,this._runEntryRepeatPosition=e;var f=d.firstSegment.mediaTimestampStr;e&&(f=a.Timestamp.add(f,e*d.firstSegment.mediaDuration)),this.segmentInfo=new c(d.firstSegment.index+e,f,d.firstSegment.mediaDuration,b.presentationTimeOffset,b.timescale)}return b.prototype.dispose=function(){this.segmentInfo=null,this._container=null,this._pubTime=null,this._runEntry=null,this._runEntryRepeatPosition=0/0},Object.defineProperty(b.prototype,"next",{get:function(){if(this._updateIterator(),isNaN(this._runEntryRepeatPosition))return null;var c=this._runEntry,d=0;if(this._runEntryRepeatPosition+1>this._runEntry.repeat){var e=this._runEntry.containerIndex+1;if(!(e<this._container.segmentTable.length))return a.Log.verbose(4,"Cannot get next iterator"),null;c=this._container.segmentTable[e]}else d=this._runEntryRepeatPosition+1;return new b(this._container,c,d)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"prev",{get:function(){if(this._updateIterator(),isNaN(this._runEntryRepeatPosition))return null;var c,d=this._runEntry;if(0===this._runEntryRepeatPosition){var e=this._runEntry.containerIndex-1;if(!(e>=0&&e<this._container.segmentTable.length))return a.Log.warning(4,"Cannot get previous iterator"),null;d=this._container.segmentTable[e],c=d.repeat}else c=this._runEntryRepeatPosition-1;return new b(this._container,d,c)},enumerable:!0,configurable:!0}),b.prototype._updateIterator=function(){if(this._container.pubTime.getTime()>this._pubTime.getTime()){this._pubTime=this._container.pubTime;for(var b=this._runEntry.containerIndex,c=this._container.segmentTable[b];!c&&b>0;)b--,c=this._container.segmentTable[b];if(c){if(c.firstSegment.index<=this.segmentInfo.index&&this.segmentInfo.index<=c.firstSegment.index+c.repeat)return this._runEntry=c,this._runEntryRepeatPosition=this.segmentInfo.index-c.firstSegment.index,void this._updateInfo();if(this.segmentInfo.index>c.firstSegment.index+c.repeat&&this._container.segmentTable.length>b+1){var d=this._container.segmentTable[b+1];if(this.segmentInfo.index<=d.firstSegment.index+d.repeat)return this._runEntry=d,this._runEntryRepeatPosition=this.segmentInfo.index-d.firstSegment.index,void this._updateInfo()}}var e=this._container.getByIndex(this.segmentInfo.index);if(!e)return a.Log.warning(4,"Referenced segment not found in presentation, disposing iterator"),void this.dispose();this._runEntry=e._runEntry,this._runEntryRepeatPosition=e._runEntryRepeatPosition,this._updateInfo()}},b.prototype._updateInfo=function(){var a=this._container.getByIndex(this.segmentInfo.index);

if(a){var b=a.segmentInfo;(this.segmentInfo.mediaTimestampStr!==b.mediaTimestampStr||this.segmentInfo.mediaDuration!==b.mediaDuration)&&(this.segmentInfo=new c(b.index,b.mediaTimestampStr,b.mediaDuration,b.presentationOffset,b.timescale))}},b}();b.MediaSegmentInfoIterator=e;var f=function(){function c(a,b,c,d){this.maxSegmentDuration=0,this.timescale=a,this.presentationTimeOffset=b,this.pubTime=c,this.segmentTable=[],this._isLive=d}return c.prototype.dispose=function(){this.segmentTable.length=0},Object.defineProperty(c.prototype,"first",{get:function(){var a=null;return this.segmentTable.length>0&&(a=new e(this,this.segmentTable[0],0)),a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"last",{get:function(){var a,b=null;return this.segmentTable.length>0&&(a=this.segmentTable[this.segmentTable.length-1],b=new e(this,a,a.repeat)),b},enumerable:!0,configurable:!0}),c.prototype.addMediaSegmentRun=function(b){var c=null,e=0;if(this.segmentTable.length>0){c=this.segmentTable[this.segmentTable.length-1],e=c.firstSegment.mediaTimestamp+c.firstSegment.mediaDuration*(c.repeat+1);var f=a.Common.timestampDeltaThreshold*this.timescale;if(e-b.firstSegment.mediaTimestamp>f)if(0===b.repeat)a.Log.warning(4,"Discontinuities detected at: "+b.firstSegment.mediaTimestamp);else{var g,h=b.firstSegment;for(g=1;g<=b.repeat;g++){var i=h.mediaTimestamp+h.mediaDuration*g;if(!(e>i)){var j=new d(h.index,i.toString(),h.mediaDuration,h.presentationOffset,h.timescale,b.repeat-g);b=j;break}}}}return b?(b.containerIndex=this.segmentTable.length,this.segmentTable.push(b),this.maxSegmentDuration=Math.max(this.maxSegmentDuration,b.firstSegment.durationInSec||0),a.Log.verbose(4,"Added segment with idx="+b.firstSegment.index+" mt="+b.firstSegment.mediaTimestamp+" pt="+b.firstSegment.presTimeInSec.toFixed(7)+" r="+b.repeat+(b.firstSegment.durationInSec?" d="+b.firstSegment.durationInSec.toFixed(7):"")),b.repeat+1):0},c.prototype.addMediaSegmentInfo=function(a,c,d,e,f){var g;if(this.segmentTable.length>0&&0/0===this.segmentTable[this.segmentTable.length-1].firstSegment.mediaDuration)throw new Error("Failed to add segment: previous entry doesn't have duration");g=new b.SegmentRunEntry(a,c,d,e,f,0),this.addMediaSegmentRun(g)},c.prototype.updateSegmentDuration=function(b,c){var d,e;if(0===this.segmentTable.length)return!1;if(d=this.segmentTable[this.segmentTable.length-1],d.firstSegment.presTimeInSec!==b){if(e=a.Common.binarySearch(b,this.segmentTable,this._compareTimestampInSec),-1===e)return a.Log.verbose(4,"Failed to update segment duration, run entry with presentation time "+b+" not found"),!1;d=this.segmentTable[e]}return d.firstSegment.mediaDuration!==c&&(a.assert(!d.firstSegment.mediaDuration&&0===d.repeat,"Failed to update segment duration, run entry (s:"+d.firstSegment.presTimeInSec+" d:"+d.firstSegment.durationInSec+" r:"+d.repeat+") cannot be overwritten by segment (s:"+b+" d:"+c/this.timescale+")"),d.firstSegment.mediaDuration=c),this.maxSegmentDuration=Math.max(this.maxSegmentDuration,d.firstSegment.durationInSec||0),!0},c.prototype.getByIndex=function(b){var c,d=null;if(0===this.segmentTable.length)return null;if(c=a.Common.binarySearch(b,this.segmentTable,this._compareIndex),-1!==c){var f=this.segmentTable[c],g=b-f.firstSegment.index;d=new e(this,f,g)}return d||a.Log.verbose(4,"Entry with index "+b+" not found"),d},c.prototype.getBySegmentStartTime=function(b,c){var d,f=null;if(0===this.segmentTable.length)return null;if(c||(c=a.Common.timestampDeltaThreshold),Math.abs(b-this.segmentTable[0].firstSegment.presTimeInSec)<c)return this.first;if(d=a.Common.binarySearch(b,this.segmentTable,this._compareTimestampInSec),-1!==d){var g=this.segmentTable[d],h=0;if(a.Common.diffTimes(b,g.firstSegment.presTimeInSec)&&(h=Math.round((b-g.firstSegment.presTimeInSec)/g.firstSegment.durationInSec)||0),h>g.repeat){if(!(d+1<this.segmentTable.length))return a.Log.verbose(4,"Cannot find match for "+b),null;g=this.segmentTable[d+1],h=0}var i=g.firstSegment.presTimeInSec+h*g.firstSegment.durationInSec;if(Math.abs(b-i)>c)return a.Log.verbose(4,"Cannot find match within error range for "+b),null;f=new e(this,g,h)}return f},c.prototype.getByInSegmentTimestamp=function(b){var c,d=null;if(0===this.segmentTable.length)return null;if(c=a.Common.binarySearch(b,this.segmentTable,this._compareTimestampInSec),-1===c&&this._isLive&&b<this.segmentTable[0].firstSegment.presTimeInSec&&(a.Log.verbose(4,"Live presentation requested time "+b+" is ahead of the first segment time "+this.segmentTable[0].firstSegment.presTimeInSec+" seeking to the first segment!"),c=0),-1!==c){var f,g=this.segmentTable[c];f=Math.floor(Math.abs(b-g.firstSegment.presTimeInSec)/g.firstSegment.durationInSec),d=new e(this,g,f)}return d||a.Log.verbose(4,"Entry including timestamp "+b+" not found"),d},c.prototype.getByInDiscontinuityTimestamp=function(b){var c,d=null;return 0===this.segmentTable.length?null:(c=a.Common.binarySearchInGaps(b,this.segmentTable,this._compareTimestampInSecInGaps),-1!==c&&(d=new e(this,this.segmentTable[c],0)),d||a.Log.verbose(4,"Discontinuity including timestamp "+b+" not found"),d)},c.prototype.update=function(b){var c=this,d=b,e=null,f=0;if(!(d.pubTime.getTime()<=this.pubTime.getTime())){if(this.pubTime=d.pubTime,e=this.getBySegmentStartTime(d.first.segmentInfo.presTimeInSec),e&&e.segmentInfo.index!==d.first.segmentInfo.index){if(f=e.segmentInfo.index,a.Common.diffTimes(d.first.segmentInfo.presTimeInSec,e.segmentInfo.presTimeInSec))throw new Error("Segment mismatch during container update");a.Log.verbose(4,"Segment index offset="+f)}if(d._isLive){var g=d.last.segmentInfo,h=g.index,i=g.mediaTimestamp+g.mediaDuration;for(e=this.getBySegmentStartTime(g.presTimeInSec);i&&e&&e.next&&(e=e.next,!(e.segmentInfo.mediaTimestamp<i));)g=e.segmentInfo,i=g.mediaTimestamp+g.mediaDuration,d.addMediaSegmentInfo(++h,g.mediaTimestampStr,g.mediaDuration,g.presentationOffset,g.timescale)}this._isLive=d._isLive,this.segmentTable.length=0,d.segmentTable.forEach(function(a){a.firstSegment.update(f,c.presentationTimeOffset),c.segmentTable.push(a)}),this.maxSegmentDuration=d.maxSegmentDuration}},c.prototype._compareTimestampInSec=function(b,c){var d=0;return a.Common.diffTimes(b,c.firstSegment.presTimeInSec)>0?d=-1:a.Common.diffTimes(b,c.firstSegment.presTimeInSec)&&a.Common.diffTimes(b,c.firstSegment.presTimeInSec+(c.repeat+1)*(c.firstSegment.durationInSec||0))<=0&&(d=1),d},c.prototype._compareIndex=function(a,b){var c=0;return a<b.firstSegment.index?c=-1:a>=b.firstSegment.index+(b.repeat+1)&&(c=1),c},c.prototype._compareTimestampInSecInGaps=function(a,b,c){var d=0,e=b.firstSegment.presTimeInSec+(b.repeat+1)*(b.firstSegment.durationInSec||0),f=c.firstSegment.presTimeInSec;return e>a?d=-1:a>=f&&(d=1),d},c}();b.MediaSegmentInfoContainer=f,function(a){a[a.needsToBeScheduled=0]="needsToBeScheduled",a[a.inProgress=1]="inProgress",a[a.endOfStream=2]="endOfStream"}(b.WorkflowState||(b.WorkflowState={}));var g=(b.WorkflowState,function(){function a(){this.forge=null,this.webCrypto=null}return a.prototype.dispose=function(){this.forge=null,this.webCrypto=null},a}());b.AesInfo=g;var h=function(){function a(){this.selected=!1,this.supported=!0,this.fetchInitSegment=!0,this.currentSegment=null,this.pendingSeekPositionInSec=null,this.abortCurrentRequest=!1,this.workflowState=0,this.sourceBuffer=null,this.lastDownloadedTrack=null,this.aes=new g,this.flushStream=!1}return a.prototype.dispose=function(){this.currentSegment=null,this.sourceBuffer&&(this.sourceBuffer.dispose(),this.sourceBuffer=null),this.lastDownloadedTrack=null,this.aes&&(this.aes.dispose(),this.aes=null)},a}();b.MediaStreamStreamingInfo=h;var i=function(){function a(){this.selectable=!0}return a}();b.MediaTrackStreamingInfo=i;var j=function(){function a(a,b){this._streams=[];for(var c=0;c<b.length;c++)if(0==b[c].type){var d=new k(a,b[c]);this._streams.push(d)}}return a.prototype.dispose=function(){for(var a=0;a<this._streams.length;a++)this._streams[a].dispose();this._streams=[]},Object.defineProperty(a.prototype,"streams",{get:function(){return this._streams},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"selectedIndex",{get:function(){for(var a=-1,b=0;b<this._streams.length;b++)if(this._streams[b].commonStream.streamingInfo.selected){a=b;break}return a},enumerable:!0,configurable:!0}),a}();b.VideoStreamList=j;var k=function(){function b(b,c){this._commonStream=c,this._eventMgr=new a.Events.Manager(b.azureHtml5,!1),this._sessionContext=b}return b.prototype.dispose=function(){this._commonStream=null,this._sessionContext=null,this._eventMgr&&(this._eventMgr.dispose(),this._eventMgr=null)},Object.defineProperty(b.prototype,"codec",{get:function(){return this._commonStream.codec},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"name",{get:function(){return this._commonStream.id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"tracks",{get:function(){return this._commonStream.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"commonStream",{get:function(){return this._commonStream},enumerable:!0,configurable:!0}),b.prototype.selectTrackByIndex=function(b){var c=!1;(-1>b||b>=this._commonStream.tracks.length)&&(a.Log.warning(7,"selectTrackByIndex: "+b+" switching back to auto track selection"),b=-1),a.Log.verbose(7,"selectTrackByIndex: "+b);for(var d=0;d<this._commonStream.tracks.length;d++){var e=this._commonStream.tracks[d].streamingInfo.selectable;this._commonStream.tracks[d].streamingInfo.selectable=-1===b||d===b?!0:!1,e!=this._commonStream.tracks[d].streamingInfo.selectable&&(c=!0)}c&&(this.commonStream.streamingInfo.flushStream=!0,this._eventMgr.dispatchEvent(a.StreamEventName.trackselected),this._sessionContext.eventMgr.dispatchEvent(a.InternalEventName.flushvideo))},b.prototype.addEventListener=function(a,b,c){this._eventMgr.addHandler(a,b,c)},b.prototype.removeEventListener=function(a,b){this._eventMgr.removeHandler(a,b)},b}(),l=function(){function b(b,c){this._streams=[];for(var d=0;d<c.length;d++)if(1==c[d].type){var e=new m(b,c[d]);this._streams.push(e)}this._eventMgr=new a.Events.Manager(b.azureHtml5,!1),this._sessionContext=b}return b.prototype.dispose=function(){for(var a=0;a<this._streams.length;a++)this._streams[a].dispose();this._sessionContext=null,this._eventMgr&&(this._eventMgr.dispose(),this._eventMgr=null),this._streams=[]},Object.defineProperty(b.prototype,"streams",{get:function(){return this._streams},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"enabledIndices",{get:function(){for(var a=[],b=0;b<this._streams.length;b++)if(this._streams[b].enabled){a.push(b);break}return a},enumerable:!0,configurable:!0}),b.prototype.switchIndex=function(b){if(1!=this.enabledIndices.length)return a.Log.error(7,"switchIndex failed - only single stream supported: "+this.enabledIndices.length+" streams enabled"),this._eventMgr.dispatchEvent(a.StreamListEventName.streamselectnotsupported),!1;if(b>=this.streams.length||0>b)return a.Log.error(7,"switchIndex failed - tried to enable invalid index: "+b),this._eventMgr.dispatchEvent(a.StreamListEventName.streamindexinvalid),!1;var c=this._streams[this.enabledIndices[0]],d=this._streams[b];if(b===this.enabledIndices[0])return a.Log.verbose(7,"switchIndex failed - current stream selected"),this._eventMgr.dispatchEvent(a.StreamListEventName.streamselected),!1;if(d.codec!==c.codec&&!c.hasAudioTypeChangeSupport())return a.Log.verbose(7,"switchIndex failed - switch involves codec change but no changeType support"),this._eventMgr.dispatchEvent(a.StreamListEventName.streamselectnotsupported),!1;this._switchEnabledIndex(b);var e=this._sessionContext.videoTag.currentTime,f=this._sessionContext.prerollBufferInSec();return d.swapBuffersAndCleanUp(c,e,f),d.codec!==c.codec&&(this._sessionContext.eventMgr.dispatchEvent(a.InternalEventName.audiocodecchanged)||a.Log.verbose(7,"switchIndex failed - audiocodecchanged event handler failed")),this._eventMgr.dispatchEvent(a.StreamListEventName.streamselected),!0},b.prototype.addEventListener=function(a,b,c){this._eventMgr.addHandler(a,b,c)},b.prototype.removeEventListener=function(a,b){this._eventMgr.removeHandler(a,b)},b.prototype._switchEnabledIndex=function(b){a.assert(1==this.enabledIndices.length,"Current implementation only allows one enabled stream at a time");var c=this.enabledIndices[0];this._streams[c].enabled=!1,this._streams[b].enabled=!0},b}();b.AudioStreamList=l;var m=function(){function b(a,b){this._commonStream=b}return b.prototype.dispose=function(){this._commonStream=null},Object.defineProperty(b.prototype,"enabled",{get:function(){return this._commonStream.streamingInfo.selected},set:function(a){this._commonStream.streamingInfo.selected=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"supported",{get:function(){return this._commonStream.streamingInfo.supported},set:function(a){this._commonStream.streamingInfo.supported=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"name",{get:function(){var b=this._commonStream.mediaUrlTemplate.toLowerCase(),c="fragments(",d=b.indexOf(c),e=b.indexOf("=",d);return a.assert(e>d+c.length,"mediaUrlTemplate ("+b+") did not follow expected schema"),this._commonStream.mediaUrlTemplate.substring(d+c.length,e)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"language",{get:function(){return this._commonStream.language},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"codec",{get:function(){return this._commonStream.codec},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bitrate",{get:function(){return this._commonStream.tracks[0].bitrate},enumerable:!0,configurable:!0}),b.prototype.hasAudioTypeChangeSupport=function(){return null!==this._commonStream.streamingInfo.sourceBuffer?a.Common.isSafari?!1:this._commonStream.streamingInfo.sourceBuffer.hasAudioTypeChangeSupport:!0},b.prototype.swapBuffersAndCleanUp=function(b,c,d){if(b._commonStream.streamingInfo.sourceBuffer){this._commonStream.streamingInfo.sourceBuffer||(this._commonStream.streamingInfo.sourceBuffer=b._commonStream.streamingInfo.sourceBuffer);var e=this._commonStream.streamingInfo.sourceBuffer;this._commonStream.streamingInfo.workflowState=0,b._commonStream.streamingInfo.workflowState=2,this._commonStream.streamingInfo.pendingSeekPositionInSec=c,this._commonStream.streamingInfo.audioTrackSwitched=!0,e.buffered.length>0&&e.buffered.end(e.buffered.length-1)>c+d&&e.flushFrom(c+d);try{e.flushUntil(c)}catch(f){a.Log.error(7,f)}}},b}()}(a.Presentation||(a.Presentation={}));a.Presentation}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){this._moduleId="SegmentLocator.Dash",this._disposed=!1}return b.prototype.init=function(a){var b=a.workflows[1];b.addHandler(b.stepEvents.requestBegin,this.onFindSegment,this)},b.prototype.dispose=function(){this._disposed=!0},b.prototype.onFindSegment=function(c){var d="unknown";c.requestedStream&&(d=0===c.requestedStream.type?"video":1===c.requestedStream.type?"audio":"text"),a.Log.verbose(9,"onFindSegment:"+d),c.currentModuleId=this._moduleId;var e=this;return new Promise(function(f,g){if(e._disposed)return a.Failure.attachFailureToRequest(c,c.currentModuleId,0),void g("object is already disposed.");var h=c.requestedStream,i=h.streamingInfo.currentSegment,j=h.segments;if(c.selectedSegment)return void f();if(null!==h.streamingInfo.pendingSeekPositionInSec)a.Log.verbose(9,"onFindSegment("+d+"): pendingSeekPositionInSec "+h.streamingInfo.pendingSeekPositionInSec),h.streamingInfo.currentSegment=j.getByInSegmentTimestamp(h.streamingInfo.pendingSeekPositionInSec),h.streamingInfo.currentSegment?(a.Log.verbose(9,"found segment "+h.streamingInfo.currentSegment.segmentInfo.presTimeInSec+" for seek position "+h.streamingInfo.pendingSeekPositionInSec),h.streamingInfo.pendingSeekPositionInSec=null,c.requestedStream.streamingInfo.fetchInitSegment=!0):(a.Log.verbose(9,"onFindSegment: didn't find the segment in container. Trying other methods."),c.sessionContext.isLiveToVod&&(h.streamingInfo.pendingSeekPositionInSec=c.sessionContext.commonPresentation.playableWindow.endInSec-.01));else if(i)h.streamingInfo.currentSegment=i.next;else{var k=c.sessionContext;isNaN(k.startPositionInSec)?h.streamingInfo.currentSegment=j.first:(h.streamingInfo.currentSegment=j.getByInSegmentTimestamp(k.startPositionInSec),h.streamingInfo.currentSegment||(h.streamingInfo.currentSegment=k.startPositionInSec<j.first.segmentInfo.presTimeInSec?j.first:j.getByInDiscontinuityTimestamp(k.startPositionInSec)),!h.streamingInfo.currentSegment&&c.sessionContext.commonPresentation.isLive&&2===h.type&&k.startPositionInSec>j.last.segmentInfo.presTimeInSec&&(h.streamingInfo.currentSegment=j.last))}if(null===h.streamingInfo.currentSegment)if(c.sessionContext.commonPresentation.isLive&&i&&i.segmentInfo&&(i.segmentInfo.mediaTimestamp>=j.last.segmentInfo.mediaTimestamp||h.streamingInfo.pendingSeekPositionInSec)){if(a.Log.warning(9,"Unable to find a segment"),h.streamingInfo.currentSegment=i,!c.sessionContext.commonPresentation.minimumUpdatePeriodInSec)return h.streamingInfo.audioTrackSwitched=!1,a.Failure.attachFailureToRequest(c,c.currentModuleId,1),void g();c.state=2,c.retryWaitTimeMSec=b._retryWaitTimeMSec,a.Log.verbose(9,"Reverting to previous segment")}else{if((h.streamingInfo.audioTrackSwitched||i&&!i.segmentInfo)&&c.sessionContext.commonPresentation.isLive)return h.streamingInfo.audioTrackSwitched=!1,a.Failure.attachFailureToRequest(c,c.currentModuleId,1),void g();c.state=1}f()})},b._retryWaitTimeMSec=2e3,b}();b.Dash=c}(a.SegmentLocator||(a.SegmentLocator={}));a.SegmentLocator}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(a){this._adSignals=[],this._adSignalsSeen={},this._eventManager=a}return b.prototype.reset=function(){this._adSignals=[],this._adSignalsSeen={}},b.prototype.getAdSignalsAndReset=function(){var a=this._adSignals;return this._adSignals=[],a},b.prototype.addAdSignals=function(b){for(var c=b&&b.length>0&&!!b[0].simpleSignal,d=[],e=0;e<b.length;e++)if(!this.checkSignalHasBeenSeenBefore(b[e])){if(!c){var f=window.atob(b[e].scteSignal.signalInString),g=a.Common.stringToUint8Array(f);b[e].scteSignal.signalInBinary=g}d.push(b[e])}d.length>0&&(this._adSignals=this._adSignals.concat(d),this._eventManager.dispatchEvent(a.EventName.spliceWaiting))},b.prototype.checkSignalHasBeenSeenBefore=function(b){var c;return c=b.simpleSignal?b.simpleSignal.id+","+b.simpleSignal.duration+","+b.simpleSignal.presentationTime:b.scteSignal.signalInString+(b.scteSignal.presentationTimeOverride?b.scteSignal.presentationTimeOverride:0),this._adSignalsSeen[c]?(a.Log.verbose(15,"ADSIGNAL: Redundant ad signal: "+c+", ignoring..."),!0):(this._adSignalsSeen[c]=!0,!1)},b}();b.Manager=c}(a.Ad||(a.Ad={}));a.Ad}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){function c(b,c){if(!c||0===c.length)return!0;try{var d=decodeURIComponent(c)}catch(e){return a.Log.error(12,e),!1}var f="urn:microsoft:azure:mediaservices:keyacquisitionhostname",g=d.indexOf(f);if(-1===g)return!0;var h=d.indexOf("&",g);-1===h&&(h=d.length);var i=d.substring(g,h),j=i.split("=");if(2!=j.length)return a.Log.error(12,"AMS hostname token is malformed: "+i),!1;var k=document.createElement("a");return k.href=b,j[1].toLowerCase()!=k.hostname.toLowerCase()?(a.Log.error(12,"AMS hostname mismatch: "+j[1].toLowerCase()+", "+k.hostname.toLowerCase()),!1):!0}b.verifyKeyUrlWithToken=c}(a.AesUtil||(a.AesUtil={}));a.AesUtil}(AzureHtml5JS||(AzureHtml5JS={})),Object.defineProperty(Array.prototype,"findFirst",{value:function(a){for(var b=0;b<this.length;b++){var c=this[b];if(a.call(this,c,b,Object(this)))return c}return null},enumerable:!1,configurable:!0}),Object.defineProperty(Array.prototype,"findLast",{value:function(a){for(var b=this.length-1;b>=0;b--){var c=this[b];if(a.call(this,c,b,Object(this)))return c}return null},enumerable:!1,configurable:!0}),Object.defineProperty(Array.prototype,"findIndexOf",{value:function(a){for(var b=0;b<this.length;b++){var c=this[b];if(a.call(this,c,b,Object(this)))return b}return-1},enumerable:!1,configurable:!0}),Object.defineProperty(Array.prototype,"removeFirst",{value:function(a){var b=this.findIndexOf(a),c=null;return-1!==b&&(c=this.splice(b,1)[0]),c},enumerable:!1,configurable:!0}),Object.defineProperty(Uint8Array.prototype,"isEqual",{value:function(a){if(this.length===a.length){for(var b=0;b<this.length;b++)if(this[b]!==a[b])return!1;return!0}return!1},enumerable:!1,configurable:!0}),window.ArrayBuffer&&(ArrayBuffer.prototype.polyfill_slice=function(a,b){b=b||this.byteLength;for(var c=new Uint8Array(this),d=new Uint8Array(b-a),e=a;b>e;e++)d[e-a]=c[e];return d.buffer},ArrayBuffer.prototype.slice=ArrayBuffer.prototype.slice||ArrayBuffer.prototype.polyfill_slice);var AzureHtml5JS;!function(a){"use strict";function b(a,b){if(!a)throw new Error(b)}a.assert=b}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";var b=function(){function a(a,b){if(this.dropOldestKeepAtLeastOne=function(){this._slidingWindow.length>1&&this.dropOldest()},this._slidingWindow=[],this._sum=0,this._minWindowLength=a,this._maxWindowLength=b,0>a||1>b||a>b)throw new Error("window length for average class should be greater than 0")}return a.prototype.dispose=function(){this._slidingWindow=null},Object.defineProperty(a.prototype,"average",{get:function(){return 0===this._slidingWindow.length||this._slidingWindow.length<this._minWindowLength?0:this._sum/this._slidingWindow.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"latest",{get:function(){return 0===this._slidingWindow.length?0:this._slidingWindow[this._slidingWindow.length-1]},enumerable:!0,configurable:!0}),a.prototype.addValue=function(a){this._slidingWindow.length>=this._maxWindowLength&&this.dropOldest(),this._slidingWindow.push(a),this._sum+=a},a.prototype.dropOldest=function(){if(this._slidingWindow.length>0){var a=this._slidingWindow.splice(0,1);a[0]!=1/0?this._sum-=a[0]:this._sum=this._slidingWindow.reduce(function(a,b){return a+b})}},a}();a.AverageCalculator=b}(a.Util||(a.Util={}));a.Util}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(){var a=/.*Mac OS X (\d+)_(\d+)_*.*\).*/.exec(navigator.userAgent);if(a&&3===a.length){var b=parseInt(a[1],10),c=parseInt(a[2],10);return 10==b&&11>=c||10>b}return!1}function d(a,c,d){"undefined"==typeof d&&(d=b.timestampDeltaThreshold);var e=c-a;return Math.abs(e)<d&&(e=0),e}function e(a,b,c){for(var d=0,e=b.length-1,f=0;e>=d;){f=Math.floor((d+e)/2);var g=c(a,b[f]);if(0>g)e=f-1;else{if(!(g>0))return f;d=f+1}}return-1}function f(a,b,c){var d=0,e=b.length-1,f=0;if(0>=e)return-1;for(;e>=d;){if(f=Math.floor((d+e)/2),0===f)return c(a,b[d],b[e])?-1:1;var g=c(a,b[f-1],b[f]);if(0>g)e=f-1;else{if(!(g>0))return f;d=f+1}}return-1}function g(a,b,c){var d=0,e=b.length-1,f=0;if(0>e)return-1;if(0===e)return c(a,b[0]);for(;e>=d;){if(f=Math.floor((d+e)/2),0===f)return c(a,b[d],b[e]);var g=c(a,b[f-1],b[f]);if(0>g)e=f-1;else{if(!(g>0))return f-1;d=f+1}}return b.length-1}function h(a){for(var b="",c=0;c<a.length;c++){var d=a[c].toString(16);b+=d.length<2?"0"+d:d}return b}function i(a){if(a.length<=2||"0x"!=a.substr(0,2).toLowerCase())throw new Error("Invalid hexString");var b=a.substr(2);a.length%2!=0&&(b="0"+b);for(var c=new Uint8Array(b.length/2),d=0;d<b.length;d+=2){var e=parseInt(b.substr(d,2),16);if(isNaN(e))throw new Error("Invalid hexString");c[d/2]=e}return c}function j(a){return 0>a&&(a=4294967295+a+1),"0x"+("00000000"+a.toString(16).toUpperCase()).substr(-8)}function k(a){for(var b="",c=0;c<a.byteLength;c++)b+=String.fromCharCode(a[c]);return b}function l(a){for(var b=new Uint8Array(a.length),c=0;c<b.byteLength;c++)b[c]=a.charCodeAt(c);return b}function m(a,b){return a.byteLength!==b.byteLength?!1:a.every(function(a,c){return a===b[c]})}function n(c){if(b.isChrome||b.isSafari){var d=c.play();void 0!==d?d.then(function(){a.Log.verbose(7,"videoTag.play() executed successfullly.")})["catch"](function(b){a.Log.warning(7,"videoTag.play() failed: "+b)}):a.Log.warning(7,"play() promise undefined.")}else c.play()}function o(){return window&&window.navigator&&!window.navigator.onLine}b.timestampDeltaThreshold=5e-4,b.nearDiscontinuityThreshold=2,b.isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),b.isEdge=/Edge/i.test(navigator.userAgent),b.isChromiumEdge=!b.isEdge&&/Chrome/i.test(navigator.userAgent)&&/Edg/i.test(navigator.userAgent),b.isIEMobile=/IEMobile\/([0-9.]*)/.test(navigator.userAgent),b.isSafari=/Safari/i.test(navigator.userAgent)&&!b.isChrome&&!b.isEdge&&!b.isIEMobile,b.isFirefox=/Firefox/i.test(navigator.userAgent)&&!b.isChrome&&!b.isEdge&&!b.isIEMobile&&!b.isSafari,b.isMobile=/android|webos|windows phone|iphone|ipad|ipod|blackBerry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),b.isOSXElCapitanOrEarlier=c,b.diffTimes=d;var p=function(){function a(a,b){this.startInSec=a,this.endInSec=b}return a}();b.TimeRange=p;var q=function(){function a(){this._timeRanges=[]}return a.prototype.dispose=function(){this._timeRanges=null},Object.defineProperty(a.prototype,"length",{get:function(){return this._timeRanges.length},enumerable:!0,configurable:!0}),a.prototype.start=function(a){return this._timeRanges[a].startInSec},a.prototype.end=function(a){return this._timeRanges[a].endInSec},a.prototype.duration=function(a){return this._timeRanges[a].endInSec-this._timeRanges[a].startInSec},a.prototype.extendLast=function(a){this._timeRanges[this._timeRanges.length-1].endInSec=a},a.prototype.addRange=function(a){this._timeRanges.push(a)},a.prototype.addRanges=function(a){if(a)for(var b=0;b<a.length;b++)this.addRange(new p(a.start(b),a.end(b)))},a.prototype.removeRange=function(a,c){if(c>a)for(var d=0;d<this._timeRanges.length;d++){var e=this._timeRanges[d].startInSec,f=this._timeRanges[d].endInSec;b.diffTimes(f,a)>=0||b.diffTimes(c,e)>=0||(b.diffTimes(e,a)>=0&&b.diffTimes(a,f)>=0&&b.diffTimes(f,c)>=0?this._timeRanges[d].endInSec=a:b.diffTimes(e,a)>=0&&b.diffTimes(c,f)>=0?(this._timeRanges[d].endInSec=a,this._timeRanges.splice(d+1,0,new p(c,f))):b.diffTimes(a,e)>=0&&b.diffTimes(f,c)>=0?(this._timeRanges.splice(d,1),--d):b.diffTimes(a,e)>=0&&b.diffTimes(e,c)>=0&&b.diffTimes(c,f)>=0&&(this._timeRanges[d].startInSec=c),b.diffTimes(this._timeRanges[d].endInSec,this._timeRanges[d].startInSec)>=0&&(this._timeRanges.splice(d,1),--d))}},a.prototype.rebase=function(a){this._timeRanges.forEach(function(b){b.startInSec-=a,b.endInSec-=a})},a.prototype.removeGaps=function(a){for(var b=0;b+1<this._timeRanges.length;)this._timeRanges[b+1].startInSec-this._timeRanges[b].endInSec<a?(this._timeRanges[b].endInSec=this._timeRanges[b+1].endInSec,this._timeRanges.splice(b+1,1)):b++},a.prototype.getIndexByInRangeTimestamp=function(a){for(var b=0;b<this._timeRanges.length;b++){var c=this._timeRanges[b];if(a<c.startInSec)return-1;if(c.startInSec<=a&&a<c.endInSec)return b;if(b+1>=this._timeRanges.length)return-2;var d=this._timeRanges[b+1];if(c.endInSec<=a&&a<=d.startInSec)return b+1}return-1},a.prototype.beforeDiscontinuity=function(a,c){return 0>c||c+1>=this._timeRanges.length||this._timeRanges[c].startInSec>a||a>=this._timeRanges[c].endInSec?!1:0!==d(this._timeRanges[c].endInSec,this._timeRanges[c+1].startInSec)&&this._timeRanges[c].endInSec-a<b.nearDiscontinuityThreshold},a.prototype.atOrAfterDiscontinuity=function(a,c){return 0>=c||c>=this._timeRanges.length||this._timeRanges[c-1].endInSec>a||a>=this._timeRanges[c].endInSec?!1:0!==d(this._timeRanges[c-1].endInSec,this._timeRanges[c].startInSec)&&(a<this._timeRanges[c].startInSec||a-this._timeRanges[c].startInSec<b.nearDiscontinuityThreshold)},a}();b.TimeRangeSet=q;var r=function(){function a(a,b,c){this.presTimeInSec=b,this.durationInSec=c,this.data=a}return Object.defineProperty(a.prototype,"endTimestampInSec",{get:function(){return this.presTimeInSec+this.durationInSec},enumerable:!0,configurable:!0}),a}();b.SegmentData=r,b.binarySearch=e,b.binarySearchInGaps=f,b.binarySearchTimeline=g,b.uint8ArrayToHexString=h,b.hexStringToUint8Array=i,b.toHexString=j,b.uint8ArrayToString=k,b.stringToUint8Array=l,b.typedArraysAreEqual=m,b.videoTagPlay=n,b.clientIsOffline=o}(a.Common||(a.Common={}));a.Common}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";var b=function(){function a(a,b){"undefined"==typeof b&&(b=0),this.data=a,this.readPos=b}return a.prototype.getUint8=function(){return this.data.getUint8(this.readPos++)},a.prototype.getUint32=function(){var a=this.data.getUint32(this.readPos);return this.readPos+=4,a},a.prototype.getInt32=function(){var a=this.data.getInt32(this.readPos);return this.readPos+=4,a},a.prototype.getBytes=function(a){for(var b=new Uint8Array(a),c=0;a>c;c++)b[c]=this.getUint8();return b},a.prototype.readString=function(a){for(var b="",c=0;a>c;c++)b+=String.fromCharCode(this.getUint8());return b},a.prototype.readStringUntilEnd=function(){for(var a="",b=0;this.readPos<this.data.byteLength;b++)a+=String.fromCharCode(this.getUint8());return a},a.prototype.readUTF8StringUntilEnd=function(){for(var a="",b=[];this.readPos<this.data.byteLength;)b.push(this.getUint8());for(var c=0;c<b.length;){var d=b[c++];128>d||(224>d?(d=(31&d)<<6,d|=63&b[c++]):240>d?(d=(15&d)<<12,d|=(63&b[c++])<<6,d|=63&b[c++]):(d=(7&d)<<18,d|=(63&b[c++])<<12,d|=(63&b[c++])<<6,d|=63&b[c++])),a+=String.fromCharCode(d)}return a},a.prototype.readTerminatedString=function(){for(var a="",b=this.getUint8();b;b=this.getUint8())a+=String.fromCharCode(b);return a},a}();a.Reader=b;var c=function(){function a(a,b){"undefined"==typeof b&&(b=0),this.data=a,this.writePos=b}return a.prototype.setUint8=function(a){this.data.setUint8(this.writePos++,a)},a.prototype.setUint32=function(a){this.data.setUint32(this.writePos,a),this.writePos+=4},a.prototype.setInt32=function(a){this.data.setInt32(this.writePos,a),this.writePos+=4},a.prototype.setString=function(a){for(var b=0;b<a.length;b++)this.setUint8(a.charCodeAt(b))},a.prototype.setBytes=function(a){for(var b=0;b<a.length;b++)this.setUint8(a[b])},a}();a.Writer=c}(a.DataViewReaderWriter||(a.DataViewReaderWriter={}));a.DataViewReaderWriter}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(a,b,c){var d="WebKitMediaKeys"in window,e="MSMediaKeys"in window,f="requestMediaKeySystemAccess"in navigator;if(f){var g=[];b&&g.push(new t(b));var h=[];c&&h.push(new t(c));var i=new s(["cenc"],g,h);return navigator.requestMediaKeySystemAccess(a,[i])}return new Promise(function(b,c){var f="video/mp4";return d?void(window.WebKitMediaKeys.isTypeSupported(a,f)?b():c()):e?void(window.MSMediaKeys.isTypeSupported(a,f)?b():c()):void c()})}function d(a,b,c){var d={initDataTypes:["cenc"],videoCapabilities:[new t(c)],audioCapabilities:[new t(b)]};b||delete d.audioCapabilities,c||delete d.videoCapabilities;var e=[d];return navigator.requestMediaKeySystemAccess(a,e)}function e(a){var b="WebKitMediaKeys"in window,c="MSMediaKeys"in window;if(b)return new window.WebKitMediaKeys(a);if(c)return new window.MSMediaKeys(a);throw new Error("create MediaKeys not supported")}function f(a,b){var c="WebKitSetMediaKeys"in a,d="msSetMediaKeys"in a;if(c)a.WebKitSetMediaKeys(b);else{if(!d)throw new Error("setMediaKeys not supported");a.msSetMediaKeys(b)}}function g(a,b){a.addEventListener("webkitneedkey",b),a.addEventListener("msneedkey",b)}function h(a,b){a.addEventListener("encrypted",b)}function i(a,b){a.addEventListener("message",b)}function j(a,b){a.addEventListener("webkitkeymessage",b),a.addEventListener("mskeymessage",b)}function k(a,b){a.addEventListener("webkitkeyadded",b),a.addEventListener("mskeyadded",b)}function l(a,b){a.addEventListener("webkitkeyerror",b),a.addEventListener("mskeyerror",b)}function m(a,b){a.removeEventListener("webkitneedkey",b),
a.removeEventListener("msneedkey",b)}function n(a,b){a.removeEventListener("encrypted",b)}function o(a,b){a.removeEventListener("message",b)}function p(a,b){a.removeEventListener("webkitkeymessage",b),a.removeEventListener("mskeymessage",b)}function q(a,b){a.removeEventListener("webkitkeyadded",b),a.removeEventListener("mskeyadded",b)}function r(a,b){a.removeEventListener("webkitkeyerror",b),a.removeEventListener("mskeyerror",b)}var s=function(){function a(a,b,c){this.initDataTypes=a,this.audioCapabilities=b,this.videoCapabilities=c}return a}(),t=function(){function b(b){this.contentType=b,this.robustness=a.Common.isChrome?"SW_SECURE_CRYPTO":""}return b}();b.isTypeSupported=c,b.createSupportedKeySystem=d,b.createMediaKeys=e,b.setMediaKeys=f,b.listenToNeedKey=g,b.listenToEncrypted=h,b.listenToMessage=i,b.listenToKeyMessage=j,b.listenToKeyAdded=k,b.listenKeyError=l,b.unlistenToNeedKey=m,b.unlistenToEncrypted=n,b.unlistenToMessage=o,b.unlistenToKeyMessage=p,b.unlistenToKeyAdded=q,b.unlistenKeyError=r}(a.EmeUtil||(a.EmeUtil={}));a.EmeUtil}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";var b=function(){function a(a,b){"undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=!0),this._azureHtml5=a,this._allowDuplicateHandlers=b,this._registrations={}}return a.prototype.dispose=function(){this._registrations=null},a.prototype.getHandlers=function(a){return a in this._registrations||(this._registrations[a]=[]),this._registrations[a]},a.prototype.addHandler=function(a,b,c){var e=this.getHandlers(a);if(this._allowDuplicateHandlers||-1===this._findHandlerByFunction(e,b)){var f=new d(c,b);e[e.length]=f}},a.prototype.removeHandler=function(a,b){for(var c=this.getHandlers(a),d=this._findHandlerByFunction(c,b);-1!==d;)c.splice(d,1),d=this._findHandlerByFunction(c,b)},a.prototype.dispatchEvent=function(a,b,d){for(var e=this,f=0,g=this.getHandlers(a).slice(),f=0;f<g.length;f++){var h=new c(a,e._azureHtml5,b,d);g[f].functionHandler.call(g[f].callerInstance,h)}},a.prototype._findHandlerByFunction=function(a,b){for(var c=-1,d=0;d<a.length;d++)if(a[d].functionHandler===b){c=d;break}return c},a}();a.Manager=b;var c=function(){function a(a,b,c,d){this.type=a,this.currentDate=new Date,this.azureHtml5=b,this.presentationTimeInSec=b?b.currentTime:0,this.message=c,this.data=d}return a}();a.EventInfo=c;var d=function(){function a(a,b){this.callerInstance=a,this.functionHandler=b}return a}();a.Handler=d}(a.Events||(a.Events={}));a.Events}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(a){return a>=400&&600>a?2097152|a:2097152}function d(a){var b="";return a.filename&&(b+=" file: "+a.filename),a.lineno&&(b+=" line: "+a.lineno),a.colno&&(b+=" colno: "+a.colno),a.error&&(b+="error: "+a.error),a.message&&(b+="msg: "+a.message),b}function e(b){if(void 0===b||null===b)return"undefined";var c=g(b.code);return b.msExtendedCode&&(c+=", msErrorCode: "+a.Common.toHexString(b.msExtendedCode)),c}function f(a,b,c,d){var e=new i(b,c,d);null!=a&&(a.externalFailure=e)}function g(a){switch(a){case MediaError.MEDIA_ERR_ABORTED:return"MEDIA_ERR_ABORTED";case MediaError.MEDIA_ERR_NETWORK:return"MEDIA_ERR_NETWORK";case MediaError.MEDIA_ERR_DECODE:return"MEDIA_ERR_DECODE";case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return a.toString()}}function h(a){return a>1048575}var i=function(){function b(a,b,c){this.originModuleId=a,this.code=b,this.message=c}return b.prototype.dispose=function(){this.originModuleId=null,this.code=null,this.message=null},b.prototype.toString=function(){var b;return b="Module = "+this.originModuleId+" FailureCode = "+a.Common.toHexString(this.code),this.message&&(b+=" "+this.message),b},b}();b.Record=i,b.translateHttpStatusToCode=c,b.errorEventToString=d,b.mediaErrorToString=e,b.attachFailureToRequest=f,b.isExternalError=h;var j=function(){function b(a,b){a?(this.code=a,this.message=b):(this.code=0,this.message=null)}return b.prototype.translateMediaError=function(b){this.code=b.code<<20,b.msExtendedCode&&(this.message="msErrorCode: "+a.Common.toHexString(b.msExtendedCode));var c=b.message;c&&c.length&&(this.message=this.message?this.message+" "+c:c)},b.prototype.toString=function(){var b="code: "+a.Common.toHexString(this.code);return this.message&&(b+=", msg: "+this.message),b},b}();b.External=j}(a.Failure||(a.Failure={}));a.Failure}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";a.forgeScript='(function(){function n(n){function i(n){var r,u;if(this.data="",this.read=0,typeof n=="string")this.data=n;else if(t.isArrayBuffer(n)||t.isArrayBufferView(n)){r=new Uint8Array(n);try{this.data=String.fromCharCode.apply(null,r)}catch(f){for(u=0;u<r.length;++u)this.putByte(r[u])}}else(n instanceof i||typeof n=="object"&&typeof n.data=="string"&&typeof n.read=="number")&&(this.data=n.data,this.read=n.read);this._constructedStringLength=0}var t=n.util=n.util||{},r;t.isArray=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};t.isArrayBuffer=function(n){return typeof ArrayBuffer!="undefined"&&n instanceof ArrayBuffer};t.isArrayBufferView=function(n){return n&&t.isArrayBuffer(n.buffer)&&n.byteLength!==undefined};t.ByteBuffer=i;t.ByteStringBuffer=i;r=4096;t.ByteStringBuffer.prototype._optimizeConstructedString=function(n){this._constructedStringLength+=n;this._constructedStringLength>r&&(this.data.substr(0,1),this._constructedStringLength=0)};t.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};t.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};t.ByteStringBuffer.prototype.putByte=function(n){return this.putBytes(String.fromCharCode(n))};t.ByteStringBuffer.prototype.fillWithByte=function(n,t){n=String.fromCharCode(n);for(var i=this.data;t>0;)t&1&&(i+=n),t>>>=1,t>0&&(n+=n);return this.data=i,this._optimizeConstructedString(t),this};t.ByteStringBuffer.prototype.putBytes=function(n){return this.data+=n,this._optimizeConstructedString(n.length),this};t.ByteStringBuffer.prototype.putString=function(n){return this.putBytes(t.encodeUtf8(n))};t.ByteStringBuffer.prototype.putInt16=function(n){return this.putBytes(String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};t.ByteStringBuffer.prototype.putInt24=function(n){return this.putBytes(String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};t.ByteStringBuffer.prototype.putInt32=function(n){return this.putBytes(String.fromCharCode(n>>24&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};t.ByteStringBuffer.prototype.putInt16Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255))};t.ByteStringBuffer.prototype.putInt24Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n>>16&255))};t.ByteStringBuffer.prototype.putInt32Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>24&255))};t.ByteStringBuffer.prototype.putInt=function(n,t){var i="";do t-=8,i+=String.fromCharCode(n>>t&255);while(t>0);return this.putBytes(i)};t.ByteStringBuffer.prototype.putSignedInt=function(n,t){return n<0&&(n+=2<<t-1),this.putInt(n,t)};t.ByteStringBuffer.prototype.putBuffer=function(n){return this.putBytes(n.getBytes())};t.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};t.ByteStringBuffer.prototype.getInt16=function(){var n=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,n};t.ByteStringBuffer.prototype.getInt24=function(){var n=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,n};t.ByteStringBuffer.prototype.getInt32=function(){var n=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,n};t.ByteStringBuffer.prototype.getInt16Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,n};t.ByteStringBuffer.prototype.getInt24Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,n};t.ByteStringBuffer.prototype.getInt32Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,n};t.ByteStringBuffer.prototype.getInt=function(n){var t=0;do t=(t<<8)+this.data.charCodeAt(this.read++),n-=8;while(n>0);return t};t.ByteStringBuffer.prototype.getSignedInt=function(n){var t=this.getInt(n),i=2<<n-2;return t>=i&&(t-=i<<1),t};t.ByteStringBuffer.prototype.getBytes=function(n){var t;return n?(n=Math.min(this.length(),n),t=this.data.slice(this.read,this.read+n),this.read+=n):n===0?t="":(t=this.read===0?this.data:this.data.slice(this.read),this.clear()),t};t.ByteStringBuffer.prototype.bytes=function(n){return typeof n=="undefined"?this.data.slice(this.read):this.data.slice(this.read,this.read+n)};t.ByteStringBuffer.prototype.at=function(n){return this.data.charCodeAt(this.read+n)};t.ByteStringBuffer.prototype.setAt=function(n,t){return this.data=this.data.substr(0,this.read+n)+String.fromCharCode(t)+this.data.substr(this.read+n+1),this};t.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};t.ByteStringBuffer.prototype.copy=function(){var n=t.createBuffer(this.data);return n.read=this.read,n};t.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};t.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};t.ByteStringBuffer.prototype.truncate=function(n){var t=Math.max(0,this.length()-n);return this.data=this.data.substr(this.read,t),this.read=0,this};t.ByteStringBuffer.prototype.toHex=function(){for(var i,n="",t=this.read;t<this.data.length;++t)i=this.data.charCodeAt(t),i<16&&(n+="0"),n+=i.toString(16);return n};t.ByteStringBuffer.prototype.toString=function(){return t.decodeUtf8(this.bytes())};t.createBuffer=function(n,i){return i=i||"raw",n!==undefined&&i==="utf8"&&(n=t.encodeUtf8(n)),new t.ByteBuffer(n)};t.encodeUtf8=function(n){return unescape(encodeURIComponent(n))};t.decodeUtf8=function(n){return decodeURIComponent(escape(n))}}return typeof forge=="undefined"&&(forge={}),n(forge)})(),function(){function n(n){n.cipher=n.cipher||{};n.cipher.algorithms=n.cipher.algorithms||{};n.cipher.createDecipher=function(t,i){var r=t;if(typeof r=="string"&&(r=n.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new n.cipher.BlockCipher({algorithm:r,key:i,decrypt:!0})};n.cipher.registerAlgorithm=function(t,i){t=t.toUpperCase();n.cipher.algorithms[t]=i};n.cipher.getAlgorithm=function(t){return(t=t.toUpperCase(),t in n.cipher.algorithms)?n.cipher.algorithms[t]:null};var t=n.cipher.BlockCipher=function(n){this.algorithm=n.algorithm;this.mode=this.algorithm.mode;this.blockSize=this.mode.blockSize;this._finish=!1;this._input=null;this.output=null;this._op=n.decrypt?this.mode.decrypt:this.mode.encrypt;this._decrypt=n.decrypt;this.algorithm.initialize(n)};t.prototype.start=function(t){var i,r;t=t||{};i={};for(r in t)i[r]=t[r];i.decrypt=this._decrypt;this._finish=!1;this._input=n.util.createBuffer();this.output=t.output||n.util.createBuffer();this.mode.start(i)};t.prototype.update=function(n){for(n&&this._input.putBuffer(n);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};t.prototype.finish=function(n){n&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return n(this.blockSize,t,!1)},this.mode.unpad=function(t){return n(this.blockSize,t,!0)});var t={};return(t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))?!1:(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))?!1:this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)?!1:!0}}return typeof forge=="undefined"&&(forge={}),n(forge)}(),function(){function n(n){function i(t){var r,i;if(typeof t=="string"&&(t=n.util.createBuffer(t)),n.util.isArray(t)&&t.length>4)for(r=t,t=n.util.createBuffer(),i=0;i<r.length;++i)t.putByte(r[i]);return n.util.isArray(t)||(t=[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()]),t}n.cipher=n.cipher||{};var t=n.cipher.modes=n.cipher.modes||{};t.cbc=function(n){n=n||{};this.name="CBC";this.cipher=n.cipher;this.blockSize=n.blockSize||16;this._ints=this.blockSize/4;this._inBlock=new Array(this._ints);this._outBlock=new Array(this._ints)};t.cbc.prototype.start=function(n){if(n.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in n)this._iv=i(n.iv),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.");};t.cbc.prototype.encrypt=function(n,t,i){var r;if(n.length()<this.blockSize&&!(i&&n.length()>0))return!0;for(r=0;r<this._ints;++r)this._inBlock[r]=this._prev[r]^n.getInt32();for(this.cipher.encrypt(this._inBlock,this._outBlock),r=0;r<this._ints;++r)t.putInt32(this._outBlock[r]);this._prev=this._outBlock};t.cbc.prototype.decrypt=function(n,t,i){var r;if(n.length()<this.blockSize&&!(i&&n.length()>0))return!0;for(r=0;r<this._ints;++r)this._inBlock[r]=n.getInt32();for(this.cipher.decrypt(this._inBlock,this._outBlock),r=0;r<this._ints;++r)t.putInt32(this._prev[r]^this._outBlock[r]);this._prev=this._inBlock.slice(0)};t.cbc.prototype.pad=function(n){var t=n.length()===this.blockSize?this.blockSize:this.blockSize-n.length();return n.fillWithByte(t,t),!0};t.cbc.prototype.unpad=function(n,t){if(t.overflow>0)return!1;var r=n.length(),i=n.at(r-1);return i>this.blockSize<<2?!1:(n.truncate(i),!0)}}return typeof forge=="undefined"&&(forge={}),n(forge)}(),function(){function n(n){function l(t,i){var r=function(){return new n.aes.Algorithm(t,i)};n.cipher.registerAlgorithm(t,r)}function h(){var u,o,c,l,w,a,h,b,v,y,n,p;for(f=!0,s=[0,1,2,4,8,16,32,64,128,27,54],u=new Array(256),n=0;n<128;++n)u[n]=n<<1,u[n+128]=n+128<<1^283;for(t=new Array(256),e=new Array(256),r=new Array(4),i=new Array(4),n=0;n<4;++n)r[n]=new Array(256),i[n]=new Array(256);for(o=0,c=0,n=0;n<256;++n){for(h=c^c<<1^c<<2^c<<3^c<<4,h=h>>8^h&255^99,t[o]=h,e[h]=o,b=u[h],l=u[o],w=u[l],a=u[w],v=b<<24^h<<16^h<<8^h^b,y=(l^w^a)<<24^(o^a)<<16^(o^w^a)<<8^o^l^a,p=0;p<4;++p)r[p][o]=v,i[p][h]=y,v=v<<24|v>>>8,y=y<<24|y>>>8;o===0?o=c=1:(o=l^u[u[u[l^a]]],c^=u[u[c]])}}function c(n,r){for(var h,y,e=n.slice(0),o,p=1,c=e.length,w=c+6+1,a=u*w,f=c;f<a;++f)o=e[f-1],f%c==0?(o=t[o>>>16&255]<<24^t[o>>>8&255]<<16^t[o&255]<<8^t[o>>>24]^s[p]<<24,p++):c>6&&f%c==4&&(o=t[o>>>24]<<24^t[o>>>16&255]<<16^t[o>>>8&255]<<8^t[o&255]),e[f]=e[f-c]^o;if(r){var v,b=i[0],k=i[1],d=i[2],g=i[3],l=e.slice(0);for(a=e.length,f=0,h=a-u;f<a;f+=u,h-=u)if(f===0||f===a-u)l[f]=e[h],l[f+1]=e[h+3],l[f+2]=e[h+2],l[f+3]=e[h+1];else for(y=0;y<u;++y)v=e[h+y],l[f+(3&-y)]=b[t[v>>>24]]^k[t[v>>>16&255]]^d[t[v>>>8&255]]^g[t[v&255]];e=l}return e}function o(n,u,f,o){var tt=n.length/4-1,y,p,w,b,s,h,c,l,a,d,g,nt,v,k;for(o?(y=i[0],p=i[1],w=i[2],b=i[3],s=e):(y=r[0],p=r[1],w=r[2],b=r[3],s=t),h=u[0]^n[0],c=u[o?3:1]^n[1],l=u[2]^n[2],a=u[o?1:3]^n[3],v=3,k=1;k<tt;++k)d=y[h>>>24]^p[c>>>16&255]^w[l>>>8&255]^b[a&255]^n[++v],g=y[c>>>24]^p[l>>>16&255]^w[a>>>8&255]^b[h&255]^n[++v],nt=y[l>>>24]^p[a>>>16&255]^w[h>>>8&255]^b[c&255]^n[++v],a=y[a>>>24]^p[h>>>16&255]^w[c>>>8&255]^b[l&255]^n[++v],h=d,c=g,l=nt;f[0]=s[h>>>24]<<24^s[c>>>16&255]<<16^s[l>>>8&255]<<8^s[a&255]^n[++v];f[o?3:1]=s[c>>>24]<<24^s[l>>>16&255]<<16^s[a>>>8&255]<<8^s[h&255]^n[++v];f[2]=s[l>>>24]<<24^s[a>>>16&255]<<16^s[h>>>8&255]<<8^s[c&255]^n[++v];f[o?1:3]=s[a>>>24]<<24^s[h>>>16&255]<<16^s[c>>>8&255]<<8^s[l&255]^n[++v]}n.aes=n.aes||{};n.aes.Algorithm=function(n,t){f||h();var i=this;i.name=n;i.mode=new t({blockSize:16,cipher:{encrypt:function(n,t){return o(i._w,n,t,!1)},decrypt:function(n,t){return o(i._w,n,t,!0)}}});i._init=!1};n.aes.Algorithm.prototype.initialize=function(t){var i,f,u,r,e,o;if(!this._init){if(i=t.key,typeof i=="string"&&(i.length===16||i.length===24||i.length===32))i=n.util.createBuffer(i);else if(n.util.isArray(i)&&(i.length===16||i.length===24||i.length===32))for(f=i,i=n.util.createBuffer(),r=0;r<f.length;++r)i.putByte(f[r]);if(!n.util.isArray(i)&&(f=i,i=[],u=f.length(),u===16||u===24||u===32))for(u=u>>>2,r=0;r<u;++r)i.push(f.getInt32());if(!n.util.isArray(i)||!(i.length===4||i.length===6||i.length===8))throw new Error("Invalid key parameter.");e=this.mode.name;o=["CFB","OFB","CTR","GCM"].indexOf(e)!==-1;this._w=c(i,t.decrypt&&!o);this._init=!0}};n.aes._expandKey=function(n,t){return f||h(),c(n,t)};n.aes._updateBlock=o;l("AES-CBC",n.cipher.modes.cbc);var f=!1,u=4,t,e,s,r,i}return typeof forge=="undefined"&&(forge={}),n(forge)}(),function(){function n(n){for(var i=new Uint8Array(n.length),t=0;t<i.byteLength;t++)i[t]=n.charCodeAt(t);return i}onmessage=function(t){if(t.data.keyStr&&t.data.ivStr&&t.data.encrypted){var i=forge.cipher.createDecipher("AES-CBC",t.data.keyStr);i.start({iv:t.data.ivStr});i.update(new forge.util.ByteBuffer(t.data.encrypted));i.finish();postMessage({decrypted:n(i.output.bytes())})}}}();'}(a.Forge||(a.Forge={}));a.Forge}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";if(b.decrypt,b.decrypt=function(b,c,d){var e=forge.cipher.createDecipher("AES-CBC",c.keyStr);e.start({iv:c.ivStr}),e.update(new forge.util.ByteBuffer(d)),e.finish();var f=a.Common.stringToUint8Array(e.output.bytes());return b.apply(null,[f]),!0},!(window.Worker&&Blob&&window.URL&&window.URL.createObjectURL))return void a.Log.verbose(7,"AzureHtml5JS.Forge: cannot start worker for Forge");var c=null;try{var d=new Blob(["'use strict';var forge;"+b.forgeScript],{type:"text/javascript"}),e=new Worker(window.URL.createObjectURL(d));b.decrypt=function(a,b,d){return null===c?(c=a,e.postMessage({keyStr:b.keyStr,ivStr:b.ivStr,encrypted:d}),!0):!1},e.onmessage=function(a){a.data.decrypted&&(c.apply(null,[a.data.decrypted]),c=null)}}catch(f){a.Log.verbose(7,"AzureHtml5JS.Forge: Forge worker setup failed: "+f)}}(a.Forge||(a.Forge={}));a.Forge}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(b,c,e,f,g){return new Promise(function(h,i){function j(){d(b,c,e,g).then(k,l)}function k(a){h(a)}function l(b){f.maxRetries>m&&b.code&&b.code>=a.Failure.translateHttpStatusToCode(500)?(m++,a.Log.warning(13,"Request failed error: "+a.Common.toHexString(b.code)+", number of times tried: "+m+" , retrying the request"),setTimeout(function(){j()},Math.pow(2,m)*f.maxWaitTimeBetweenRetriesMS)):i(b)}var m=0;j()})}function d(b,c,d,e,f){return new Promise(function(g,h){function i(){if(200==k.status)g(k.response);else{var d="";if(null!==k.response){var e=new a.DataViewReaderWriter.Reader(new DataView(k.response));d=e.readStringUntilEnd()}a.Log.error(13,"XHR load failed status:"+k.statusText+"("+k.status+"), expected to be 200, readyState:"+k.readyState+" ("+c+" "+b+"), response:"+d),h({code:a.Failure.translateHttpStatusToCode(k.status),response:d})}}function j(){a.Log.error(13,"XHR failed status: "+k.statusText+" ("+k.status+"), readyState: "+k.readyState),h({code:2097753,response:""})}var k=new a.HttpRequest.XMLHttpRequestWrapper;k.onload=i,k.onerror=j,k.open(c,b),k.responseType=d,e&&e.forEach(function(a){k.setRequestHeader(a.name,a.value)}),f?k.send(f):k.send()})}b.authorizationHeader="Authorization",b.httpRequestWithRetryConfig=c,b.httpRequest=d}(a.HttpUtil||(a.HttpUtil={}));a.HttpUtil}(AzureHtml5JS||(AzureHtml5JS={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},AzureHtml5JS;!function(a){!function(b){"use strict";function c(b,c,d){"undefined"==typeof d&&(d=0);var f,g=d;if(!c||4!==c.length)return a.Log.error(11,"Parameter error, box type must have four characters"),null;if(!b||b.byteLength<8)return a.Log.error(11,"Parameter error, not enough data"),null;for(;g<b.byteLength&&(f=e(b,g));){if(f.type===c)return f;g+=f.size}return null}function d(b,c){if(!c||4!==c.length)return a.Log.error(11,"Parameter error, box type must have four characters"),null;if(!b||!b.data||b.data.byteLength<8)return a.Log.error(11,"Parameter error, not enough data"),null;for(var d=b.getUint32(),f=4;d>0&&f<b.data.byteLength&&(b=e(b.data,f));){if(b.type===c)return b;f+=b.size,d--}return null}function e(b,c){if(!b||b.byteLength-c<8)return a.Log.error(11,"MP4 box parsing error, not enough data for box header"),null;var d=new k(b,c);if(d.size=d.getUint32(),d.type=d.readString(4),1===d.size){if(b.byteLength-c<16)return a.Log.error(11,"MP4 box parsing error, not enough data for largesize"),null;if(d.size=d.getUint32()<<32,d.size+=d.getUint32(),d.size>9007199254740991)return a.Log.error(11,"Box size too big for precise representation as Javascript number"),null}else 0===d.size&&(d.size=b.byteLength);if(d.size>b.byteLength-c)return null;if("uuid"===d.type){if(b.byteLength-d.readPosition<16)return a.Log.error(11,"MP4 box parsing error, not enough data for usertype"),null;d.usertype=d.readString(16)}return d.data=new DataView(b.buffer,b.byteOffset+d.readPosition,b.byteLength-d.readPosition),d}function f(b){var d,e=null;return(d=c(b,"tfhd"))?(e=m.parse(d),e||a.Log.warning(11,"Parsing of tfhd failed"),e):(a.Log.warning(11,"tfhd not found"),null)}function g(b){var d,e=null;return(d=c(b,"trun"))?(e=n.parse(d),e||a.Log.warning(11,"Parsing of trun failed"),e):(a.Log.warning(11,"trun not found"),null)}function h(b){var d,e=null;return(d=c(b,"tfdt"))?(e=p.parse(d),e||a.Log.warning(11,"Parsing of tfdt failed"),e):(a.Log.warning(11,"tfdt not found"),null)}function i(b){for(var d,e=[],f=0;f<b.byteLength;){if(d=c(b,q.typeStr,f),!d)return a.Log.warning(11,"pssh not found"),e;var g=q.parse(d);g?e.push(g):a.Log.warning(11,"Parsing of pssh failed"),f+=d.size}return e}function j(b){for(var d,e=[],f=0;f<b.byteLength;){if(d=c(b,r.typeStr,f),!d)return e;var g=r.parse(d);g?e.push(g):a.Log.warning(11,"Parsing of emsg failed"),f+=d.size}return e.length>0&&a.Log.verbose(11,"emsg boxes found: "+e.length),e}var k=function(){function b(b,c){b&&"undefined"!=typeof c&&(this.data=b,this.reader=new a.DataViewReaderWriter.Reader(b,c))}return b.prototype.getUint32=function(){return this.reader.getUint32()},b.prototype.getInt32=function(){return this.reader.getInt32()},b.prototype.getUint8=function(){return this.reader.getUint8()},b.prototype.getBytes=function(a){return this.reader.getBytes(a)},b.prototype.getRemainingBytes=function(){return this.reader.getBytes(this.size-this.readPosition)},b.prototype.readString=function(a){return this.reader.readString(a)},b.prototype.readStringUntilEnd=function(){return this.reader.readStringUntilEnd()},b.prototype.readUTF8StringUntilEnd=function(){return this.reader.readUTF8StringUntilEnd()},b.prototype.readTerminatedString=function(){return this.reader.readTerminatedString()},Object.defineProperty(b.prototype,"readPosition",{get:function(){return this.reader.readPos},enumerable:!0,configurable:!0}),b}();b.Mp4Box=k;var l=function(b){function c(c){b.call(this),c&&(this.size=c.size,this.type=c.type,this.usertype=c.usertype,this.data=c.data,this.reader=new a.DataViewReaderWriter.Reader(this.data),this._versionFlags=c._versionFlags)}return __extends(c,b),c.parse=function(b){var d=null;return b.data.byteLength<4?(a.Log.error(11,"Full box parsing error, not enough bytes"),null):(d=new c,d.size=b.size,d.type=b.type,d.usertype=b.usertype,d._versionFlags=b.data.getUint32(0),d.data=new DataView(b.data.buffer,b.data.byteOffset+4,b.data.byteLength-4),d.reader=new a.DataViewReaderWriter.Reader(d.data),d)},c.serialize=function(b,c){var d=("uuid"===b.type?16:0)+12,e=c+d,f=new ArrayBuffer(e),g=new DataView(f),h=new a.DataViewReaderWriter.Writer(g);if(e>4294967295)throw new Error("Mp4FullBox::serialize, large size is not supported");if(h.setUint32(e),h.setString(b.type),"uuid"===b.type&&h.setString(b.usertype),h.setUint32(b._versionFlags),h.writePos!==d)throw new Error("Mp4FullBox::serialize, inconsistent bytes written");return h},Object.defineProperty(c.prototype,"version",{get:function(){return this._versionFlags>>24},set:function(a){this._versionFlags&=16777215,this._versionFlags|=a<<24},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"flags",{get:function(){return 16777215&this._versionFlags},set:function(a){this._versionFlags&=4278190080,this._versionFlags|=16777215&a},enumerable:!0,configurable:!0}),c.prototype.getUint32Cond=function(a){var b;return a&this.flags&&(b=this.reader.getUint32()),b},c}(k);b.Mp4FullBox=l;var m=function(b){function c(a){b.call(this,a)}return __extends(c,b),c.parse=function(b){var d=null,e=null;return(e=l.parse(b))?(d=new c(e),e.data.byteLength<d._calculatedSize()?(a.Log.error(11,"tfhd box parsing error, not enough data"),null):(d.trackId=d.getUint32(),d.baseDataOffsetHi=d.getUint32Cond(c.flags_baseDataOffsetPresent),d.baseDataOffsetLo=d.getUint32Cond(c.flags_baseDataOffsetPresent),d.sampleDescriptionIndex=d.getUint32Cond(c.flags_sampleDescriptionIndexPresent),d.defaultSampleDuration=d.getUint32Cond(c.flags_defaultSampleDurationPresent),d.defaultSampleSize=d.getUint32Cond(c.flags_defaultSampleSizePresent),d.defaultSampleFlags=d.getUint32Cond(c.flags_defaultSampleFlagsPresent),d)):null},c.prototype._calculatedSize=function(){var a=4;return a+=this.flags&c.flags_baseDataOffsetPresent?8:0,a+=this.flags&c.flags_sampleDescriptionIndexPresent?4:0,a+=this.flags&c.flags_defaultSampleDurationPresent?4:0,a+=this.flags&c.flags_defaultSampleSizePresent?4:0,a+=this.flags&c.flags_defaultSampleFlagsPresent?4:0},c.typeStr="tfhd",c.flags_baseDataOffsetPresent=1,c.flags_sampleDescriptionIndexPresent=2,c.flags_defaultSampleDurationPresent=8,c.flags_defaultSampleSizePresent=16,c.flags_defaultSampleFlagsPresent=32,c.flags_durationIsEmpty=65536,c.flags_defaultBaseIsMoof=131072,c}(l);b.TfhdBox=m;var n=function(b){function c(a){b.call(this,a)}return __extends(c,b),c.parse=function(b){var d=null,e=null;if(e=l.parse(b),!e)return null;if(d=new c(e),e.data.byteLength<4)return a.Log.error(11,"trun box parsing error, not enough data"),null;if(d.sampleCount=d.getUint32(),e.data.byteLength<d._calculatedSize())return a.Log.error(11,"trun box parsing error, not enough data"),null;d.dataOffset=d.getUint32Cond(c.flags_dataOffsetPresent),d.firstSampleFlags=d.getUint32Cond(c.flags_firstSampleFlagsPresent),d.sampleInfoArray=[];for(var f=0;f<d.sampleCount;f++){var g=new o;g.sampleDuration=d.getUint32Cond(c.flags_sampleDurationPresent),g.sampleSize=d.getUint32Cond(c.flags_sampleSizePresent),g.sampleFlags=d.getUint32Cond(c.flags_sampleFlagsPresent),d.flags&c.flags_sampleCompositionTimeOffsetsPresent&&(g.sampleCompositionTimeOffset=0===d.version?d.getUint32():d.getInt32()),d.sampleInfoArray.push(g)}return d},c.prototype._calculatedSize=function(){var a,b=4;return b+=this.flags&c.flags_dataOffsetPresent?4:0,b+=this.flags&c.flags_firstSampleFlagsPresent?4:0,a=this.flags&c.flags_sampleDurationPresent?4:0,a+=this.flags&c.flags_sampleSizePresent?4:0,a+=this.flags&c.flags_sampleFlagsPresent?4:0,a+=this.flags&c.flags_sampleCompositionTimeOffsetsPresent?4:0,b+=this.sampleCount*a},c.typeStr="trun",c.flags_dataOffsetPresent=1,c.flags_firstSampleFlagsPresent=4,c.flags_sampleDurationPresent=256,c.flags_sampleSizePresent=512,c.flags_sampleFlagsPresent=1024,c.flags_sampleCompositionTimeOffsetsPresent=2048,c}(l);b.TrunBox=n;var o=function(){function a(){}return a}();b.TrunSampleInfo=o;var p=function(b){function c(a){b.call(this,a),this.baseMediaDecodeTime=0}return __extends(c,b),c.parse=function(b){var d=null,e=null;return(e=l.parse(b))?(d=new c(e),e.data.byteLength<d._calculatedSize()?(a.Log.error(11,"tfdt box parsing error, not enough data"),null):(1===d.version&&(d.baseMediaDecodeTime=4294967296*d.getUint32()),d.baseMediaDecodeTime+=d.getUint32(),d.baseMediaDecodeTime>=9007199254740992&&a.Log.warning(11,"tfdt timestamp greater than 53 bits, possible precision loss"),d)):null},c.prototype._calculatedSize=function(){return 1===this.version?8:4},c.typeStr="tfdt",c}(l);b.TfdtBox=p;var q=function(b){function c(a){a?b.call(this,a):this.type=c.typeStr,this._keyIds=[]}return __extends(c,b),c.parse=function(b){var d=null,e=null;if(e=l.parse(b),!e)return null;if(d=new c(e),e.data.byteLength<d._calculatedSize())return a.Log.error(11,"pssh box parsing error, not enough data"),null;d.systemId=d.getBytes(16);var f=0;if(d.version>0){if(f=d.getUint32(),d._keyIds.length=f,e.data.byteLength<d._calculatedSize())return a.Log.error(11,"pssh box parsing error, not enough data"),null;for(var g=0;f>g;g++){var h=d.getBytes(16);d._keyIds[g]=h}}var i=d.getUint32();return e.data.byteLength<d._calculatedSize(i)?(a.Log.error(11,"pssh box parsing error, not enough data"),null):(d.specificData=d.getBytes(i),d)},c.prototype.addKeyId=function(a){if(16!==a.length)throw new Error("keyId must be 16 bytes");this.version=1,this._keyIds.push(a)},Object.defineProperty(c.prototype,"keyIds",{get:function(){return this._keyIds},enumerable:!0,configurable:!0}),c.prototype._calculatedSize=function(a){"undefined"==typeof a&&(a=0);var b=20+a;return this.version>0&&(b+=4+16*this._keyIds.length),b},c.prototype.serialize=function(){var a=l.serialize(this,this._calculatedSize(this.specificData.byteLength));if(!this.systemId)throw new Error("systemId is not set");if(a.setBytes(this.systemId),this.version>0&&(a.setUint32(this._keyIds.length),this._keyIds.forEach(function(b){a.setBytes(b)})),!this.specificData)throw new Error("specificData is not set");if(a.setUint32(this.specificData.byteLength),a.setBytes(this.specificData),a.writePos!=a.data.buffer.byteLength)throw new Error("Failed to write to end of buffer");return a.data.buffer},c.typeStr="pssh",c}(l);b.PsshBox=q;var r=function(a){function b(c){c?a.call(this,c):this.type=b.typeStr}return __extends(b,a),b.parse=function(a){var c=null,d=null;if(d=l.parse(a),!d)return null;if(c=new b(d),0===c.version)c.schemeIdUrl=c.readTerminatedString(),c.value=c.readTerminatedString(),c.timescale=c.getUint32(),c.presentationTimeDelta=c.getUint32(),c.eventDuration=c.getUint32(),c.id=c.getUint32();else{if(1!=c.version)return null;c.timescale=c.getUint32(),c.presentationTimePartA=c.getUint32(),c.presentationTimePartB=c.getUint32(),c.eventDuration=c.getUint32(),c.id=c.getUint32(),c.schemeIdUrl=c.readTerminatedString(),c.value=c.readTerminatedString()}return c.messageData=c.getRemainingBytes(),c},b.typeStr="emsg",b}(l);b.EmsgBox=r,b.GetBoxByType=c,b.GetBoxByTypeFromFixedChildren=d,b.GetTfhdBox=f,b.GetTrunBox=g,b.GetTfdtBox=h,b.GetPsshBoxes=i,b.GetEmsgBoxes=j}(a.Mp4Util||(a.Mp4Util={}));a.Mp4Util}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(){return a.VideoElementAdapter.supported()}function d(a){var b=!1;if(a&&a.canPlayType){var c=a.canPlayType("application/vnd.apple.mpegurl");("maybe"===c||"probably"===c)&&(b=!0)}return b}function e(a){var b=!1;if(a&&a.canPlayType){var c=a.canPlayType("video/mp4");("maybe"===c||"probably"===c)&&(b=!0)}return b}!function(a){a[a.type1=1]="type1",a[a.type2=2]="type2",a[a.type3=3]="type3"}(b.Type||(b.Type={}));b.Type;b.MseSupported=c,b.HlsType1Supported=d,b.Mp4Type1Supported=e}(a.PlayerDetector||(a.PlayerDetector={}));a.PlayerDetector}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(a,b){if(a&&a.length>0){var c=a.trim().toLowerCase();if(j[c])return g(j[c],b)}}function d(a,b){var c=a.trim().toLowerCase();if(c.lastIndexOf(".ism/")>-1){var d=f(c);if(h[d])return g(h[d],b)}var j=e(c);return i[j]?g(i[j],b):null;

}function e(a){var b=null,c=a.lastIndexOf("."),d=a.indexOf("/",c);return c>-1&&(b=a.substring(c+1,-1!==d?d:a.length)),b}function f(a){var b=null,c=a,d="(format=",e=a.lastIndexOf("?");e>-1&&(c=a.substring(0,e));var f=c.lastIndexOf(d);if(f>-1){var g=c.lastIndexOf(")");if(g>f){b=c.substring(f+d.length,g);var h=b.indexOf(",");h>-1&&(b=b.substring(0,h))}}return b}function g(b,c){a.Log.verbose(7,"Using format "+b+" to get player type.");var d=null;switch(b){case 1:a.PlayerDetector.HlsType1Supported(c)?d=1:a.Log.warning(7,"HLS type1 is not supported.");break;case 2:a.PlayerDetector.Mp4Type1Supported(c)?d=1:a.Log.warning(7,"MP4 type1 is not supported.");break;case 3:a.PlayerDetector.MseSupported(c)?d=3:a.Log.warning(7,"MSE is not supported.")}return d}!function(a){a[a.hls=1]="hls",a[a.mp4=2]="mp4",a[a.dash=3]="dash"}(b.Format||(b.Format={}));var h=(b.Format,{"m3u8-aapl-v3":1,"m3u8-aapl-v4":1,"mpd-time-csf":3,"mpd-time-cmaf":3}),i={mp4:2,m3u8:1},j={"video/mp4":2,"application/dash+xml":3,"application/vnd.apple.mpegurl":1};b.getByPresentationType=c,b.getByUrl=d,b._getFileExtension=e,b._getAzureMediaFormatTag=f,b._getPlayerTypeByFormat=g}(a.PlayerType||(a.PlayerType={}));a.PlayerType}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(a){for(var b=0;b<e.length;b++)if(e[b]&&e[b].id&&e[b].id==a){var c=e.splice(b,1);return 1===c.length?c[0]:null}return null}if(b.setTimeout=window.setTimeout.bind(window),b.clearTimeout=window.clearTimeout.bind(window),!(window.Worker&&Blob&&window.URL&&window.URL.createObjectURL&&-1==navigator.userAgent.indexOf("MSAppHost")))return void a.Log.verbose(7,"AzureHtml5JS.Util: cannot override setTimeout/clearTimeout");var d=0,e=[];try{var f=new Blob(["'use strict';(function () {var timers = [];onmessage = function (event) {if (!event.data.id) {return;}if (event.data.start) {if (event.data.ms) {var internalId = setTimeout(function () {var expiredId = removeTimer(event.data.id);if (expiredId && expiredId.external) {postMessage({ type: 'timeout', id: expiredId.external });}}, event.data.ms);timers.push({ external: event.data.id, internal: internalId });postMessage({ type: 'started', id: event.data.id });}else {postMessage({ type: 'timeout', id: event.data.id });}}else if (event.data.stop) {var removedId = removeTimer(event.data.id);if (removedId && removedId.internal) {clearTimeout(removedId.internal);}postMessage({ type: 'cancelled', id: event.data.id });}};function removeTimer(timerId) {for (var i = 0; i < timers.length; i++) {if (timers[i] && timers[i].external && timers[i].external == timerId) {var removed = timers.splice(i, 1);return removed.length === 1 ? removed[0] : null;}}return null;}})();"],{type:"text/javascript"}),g=new Worker(window.URL.createObjectURL(f));g.onmessage=function(a){if("timeout"===a.data.type){var b=c(a.data.id);b&&b.callback&&b.callback.apply(b.ctx,b.args)}else"cancelled"===a.data.type&&c(a.data.id)},b.setTimeout=function(a,b){for(var c=[],f=0;f<arguments.length-2;f++)c[f]=arguments[f+2];return d++,e.push({id:d,ctx:this,callback:a,args:c}),g.postMessage({start:!0,id:d,ms:b}),d},b.clearTimeout=function(a){g.postMessage({stop:!0,id:a})}}catch(h){a.Log.verbose(7,"AzureHtml5JS.Util: setTimeout/clearTimeout override failed: "+h)}}(a.Util||(a.Util={}));a.Util}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";function c(a){var b=a.requestedStream.streamingInfo.currentSegment,c=b.segmentInfo.durationInSec;return!c&&a.sessionContext.commonPresentation.isLive&&b.prev&&(c=b.prev.segmentInfo.durationInSec),c}function d(b){return a.assert(0===b.requestedStream.type||1===b.requestedStream.type||2===b.requestedStream.type,"getBufferData: unexpected type"),0===b.requestedStream.type?b.sessionContext.videoBufferData:1===b.requestedStream.type?b.sessionContext.audioBufferData:b.sessionContext.textBufferData}b.getSegmentDuration=c,b.getBufferData=d}(a.StreamUtil||(a.StreamUtil={}));a.StreamUtil}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";function b(a,b){var e,f,g="";if(a.length>c?(e=parseInt(a.slice(0,a.length-c),10),f=parseInt(a.slice(a.length-c),10)):(e=0,f=parseInt(a,10)),f+=b,f>=d){var h=Math.floor(f/d);e+=h,f%=d}var i=f.toString();if(e){g=e.toString();for(var j=0;j<c-i.length;j++)g+="0"}return g+=i}var c=6,d=Math.pow(10,c);a.add=b}(a.Timestamp||(a.Timestamp={}));a.Timestamp}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(a){this.imsc1Disabled=!1,this.imsc1TrackPreviouslySelected=!1,this.ttmlTrackIsValid=!1,this.cueDownloadCount=0,this.consecutiveEmptyTtmlsLookup={},this.playerId=a,this.domParser=new DOMParser}return b.prototype.reset=function(){this.ttmlTrackIsValid=!1,this.consecutiveEmptyTtmlsLookup={}},b.prototype.parseInitSegment=function(b){if(!b)return a.Log.warning(16,"Init segment: no media data for TTML"),!1;var c,d,e,f,g,h,i,j=new DataView(b);return(c=a.Mp4Util.GetBoxByType(j,"moov"))?(d=a.Mp4Util.GetBoxByType(c.data,"trak"))?(e=a.Mp4Util.GetBoxByType(d.data,"mdia"))?(f=a.Mp4Util.GetBoxByType(e.data,"minf"))?(g=a.Mp4Util.GetBoxByType(f.data,"stbl"))?(h=a.Mp4Util.GetBoxByType(g.data,"stsd"))?(h=a.Mp4Util.Mp4FullBox.parse(h),i=a.Mp4Util.GetBoxByTypeFromFixedChildren(h,"stpp"),i?(this.ttmlTrackIsValid=!0,a.Log.warning(16,"The ttml track is valid.")):a.Log.warning(16,"The ttml track is invalid."),this.ttmlTrackIsValid):(a.Log.warning(16,"stsd not found"),!1):(a.Log.warning(16,"stbl not found"),!1):(a.Log.warning(16,"minf not found"),!1):(a.Log.warning(16,"mdia not found"),!1):(a.Log.warning(16,"trak not found"),!1):(a.Log.warning(16,"moov not found"),!1)},Object.defineProperty(b.prototype,"normalizedPresentationTimeInSeconds",{set:function(a){this.normalizedPresentationTimeInSecs=a},enumerable:!0,configurable:!0}),b.prototype.processTtml=function(c,d){a.Log.verbose(16,"Processing ttml data");var e=this;if(this.ttmlTrackIsValid){var f=this.extractTtml(d);if(f){var g=this.ttmlToCue(f);if(g.cues.length>0){var h=window.amp.getPlayers(),i=null;if(h&&(i=h[this.playerId])){for(var j=!0,k=g.cues.length-1;k>=0;k--)if(g.cues[k].text){j=!1;break}!j&&this.imsc1Disabled&&(a.Log.verbose(16,"Restarting IMSC1 captions."),i.prepareForImsc1Captions(this.imsc1TrackPreviouslySelected),this.imsc1Disabled=!1);for(var l=1===i.options_.imsc1CaptionsSettings.length,m=i.textTracks(),k=0;k<m.length;k++){var n=m[k];if(n.isImsc1&&(void 0!==n.language&&n.language.toLowerCase()==g.lang||l)){e.cueDownloadCount%b.cueCleanupFrequency||e.cleanupCues(i,n),n.loaded_=!0,g.cues.forEach(function(a){n.addCue(a)});var o=this.consecutiveEmptyTtmlsLookup[c];if((!o||isNaN(o))&&(o=0),j){if(++o>=b.consecutiveEmptyCaptionsThreshold){var p="Empty IMSC1 captions in stream "+c;a.Log.error(16,p),o=0}Date.now()-this.lastNonEmptyTtmlTimestamp>b.emptyCaptionsTimeThreadhold&&(a.Log.verbose(16,"Turning off IMSC1 captions."),this.imsc1TrackPreviouslySelected="showing"===n.mode,i.removeRemoteTextTrack(n),this.imsc1Disabled=!0)}else o=0,this.lastNonEmptyTtmlTimestamp=Date.now();this.consecutiveEmptyTtmlsLookup[c]=o;break}}e.cueDownloadCount++}}}}else a.Log.error(16,"Skipping ttml data. The ttml track is invalid.")},b.prototype.extractTtml=function(b){if(a.Log.verbose(16,"Extracting ttml data"),!b)return a.Log.warning(16,"Media segment: no media data for TTML"),null;var c,d=new DataView(b);return c=a.Mp4Util.GetBoxByType(d,"mdat"),c?c.readUTF8StringUntilEnd():(a.Log.warning(16,"mdat not found"),null)},b.prototype.ttmlToCue=function(a){var b=this.domParser.parseFromString(a,"text/xml"),c=this.getLanguage(b),d=b.getElementsByTagName("p"),e=[];if(d.length>0)for(var f=0;f<d.length;f++)e=e.concat(this.parseTTMLCue(d[f]));return{lang:c,cues:e}},b.prototype.getLanguage=function(a){var b,c=a.getElementsByTagName("tt");return c&&c.length>0&&(b=c[0].getAttribute("xml:lang")),b=b||"",b.toLowerCase()},b.prototype.parseTTMLCue=function(a){for(var b=a.getAttribute("begin").split(":"),c=a.getAttribute("end").split(":"),d=this.convertTimeToSeconds(b)+this.normalizedPresentationTimeInSecs,e=this.convertTimeToSeconds(c)+this.normalizedPresentationTimeInSecs,f="",g=0;g<a.childNodes.length;g++){var h=a.childNodes[g],i="";3===h.nodeType&&"\n"!==h.nodeValue[0]?i=h.nodeValue:1===h.nodeType&&("br"===h.nodeName?i="\n":"span"===h.nodeName&&""!==h.textContent&&(i=h.textContent)),f+=i}return{startTime:d,endTime:e,text:f,hasBeenReset:!0,align:"middle",line:14,lineAlign:"start",position:50,positionAlign:"middle",size:100,snapToLines:!0,vertical:""}},b.prototype.convertTimeToSeconds=function(a){return 60*(60*parseFloat(a[0])+parseFloat(a[1]))+parseFloat(a[2])},b.prototype.cleanupCues=function(b,c){for(var d=Date.now(),e=b.currentAbsoluteTime()||b.currentTime(),f=c.cues,g=0,h=0;h<f.length;)f[h].endTime<e?(c.removeCue(f[h]),g++):h++;a.Log.verbose(16,"cleanupCues removed "+g+" cues. Spent "+(Date.now()-d)+"ms")},b.prototype.calculateMemorySize=function(b){for(var c=Date.now(),d=b.cues,e=0,f=0,g=function(a){return a?a.length:0};f<d.length;){if(e+=d[f].text.length,d[f].displayState){var h=d[f].displayState;e+=g(h.innerHTML),e+=g(h.innerText),e+=g(h.outerHTML),e+=g(h.outerText),e+=g(h.textContent),e+=g(h.baseURI)}e*=2,f++}a.Log.verbose(16,"calculateMemorySize mem size="+e/1024/1024+" mb. Spent "+(Date.now()-c)+"ms")},b.cueCleanupFrequency=5,b.consecutiveEmptyCaptionsThreshold=10,b.emptyCaptionsTimeThreadhold=3e4,b}();b.Manager=c}(a.Ttml||(a.Ttml={}));a.Ttml}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";var b=function(){function b(){}return b.FormatDashMediaUrl=function(a,b,c,d){if(!a)throw new Error("url Template is not set");if(!b)throw new Error("bitrate is not set");var e=a;return e=e.replace("$Bandwidth$",b),c&&(e=e.replace("$Time$",c)),d&&(e+=d),e},b.FormatDashInitUrl=function(b,c,d){return a.UrlFormatter.FormatDashMediaUrl(b,c,null,d)},b}();a.UrlFormatter=b}(a.Util||(a.Util={}));a.Util}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(b){"use strict";var c=function(){function b(){if(!b.useJavascriptLibrary){var a="msCrypto"in window,c=a?window.msCrypto:window.crypto;this._webCryptor=c.subtle||c.webkitSubtle}}return b.prototype.dispose=function(){this._webCryptor=null},b.prototype.initialize=function(b,c,d){var e=this,f={name:"aes-cbc",iv:d};return new Promise(function(g,h){e._webCryptoImportKey(c,f).then(function(c){b.webCrypto={importedkey:c,algorithm:f},e.type="webcrypto",a.Log.verbose(12,"Using webcrypto"),g()},function(f){return c&&d?(b.forge={keyStr:a.Common.uint8ArrayToString(new Uint8Array(c)),ivStr:a.Common.uint8ArrayToString(new Uint8Array(d))},e.type="forge",a.Log.verbose(12,"Using forge"),void g()):void h(f)})})},b.prototype.isInitialized=function(a){return null!=a.forge||null!=a.webCrypto},b.prototype.decrypt=function(a,b){var c=this;return new Promise(function(d,e){a.webCrypto?c._webCryptoDecrypt(a.webCrypto.algorithm,a.webCrypto.importedkey,b).then(function(a){d(a)},function(a){e(a)}):c._forgeDecrypt(a.forge,b).then(function(a){d(a)},function(a){e(a)})})},b.prototype._webCryptoImportKey=function(a,b){var c=this;return new Promise(function(d,e){function f(a){var b=h.result?h.result:a;d(b)}function g(a){e(a)}if(!c._webCryptor)return void e("Platform doesn't support webCrypto");var h=c._webCryptor.importKey("raw",new Uint8Array(a),b,!1,["decrypt"]);"oncomplete"in h?(h.oncomplete=f,h.onerror=g):h.then(function(a){f(a)},function(a){g(a)})})},b.prototype._forgeDecrypt=function(c,d){return new Promise(function(e,f){function g(){a.Forge.decrypt(h,c,d)||(Date.now()-i<b._maxWorkerWaitMSec?a.Util.setTimeout(g,0):f("The forge worker is too busy, total wait time = "+(Date.now()-i)+"ms"))}function h(a){e(a.buffer)}var i=Date.now();g()})},b.prototype._webCryptoDecrypt=function(a,b,c){var d=this;return new Promise(function(e,f){function g(a){var b=i.result?i.result:a;e(b)}function h(a){f(a)}var i=d._webCryptor.decrypt(a,b,new Uint8Array(c));"oncomplete"in i?(i.oncomplete=g,i.onerror=h,i.onabort=h):i.then(function(a){g(a)},function(a){h(a)})})},b.useJavascriptLibrary=!1,b._maxWorkerWaitMSec=3e4,b}();b.Decryptor=c}(a.WebCryptoUtil||(a.WebCryptoUtil={}));a.WebCryptoUtil}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JS;!function(a){!function(a){"use strict";var b=function(){function a(){this.xmlHttpRequestDelegate=new XMLHttpRequest}return Object.defineProperty(a.prototype,"responseType",{get:function(){return this.xmlHttpRequestDelegate.responseType},set:function(a){this.xmlHttpRequestDelegate.responseType=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"timeout",{get:function(){return this.xmlHttpRequestDelegate.timeout},set:function(a){this.xmlHttpRequestDelegate.timeout=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"msCaching",{get:function(){return this.xmlHttpRequestDelegate.msCaching?this.xmlHttpRequestDelegate.msCaching:void 0},set:function(a){this.xmlHttpRequestDelegate.msCaching&&(this.xmlHttpRequestDelegate.msCaching=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"readyState",{get:function(){return this.xmlHttpRequestDelegate.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"status",{get:function(){return this.xmlHttpRequestDelegate.status},set:function(a){this.xmlHttpRequestDelegate.status=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"response",{get:function(){return this.xmlHttpRequestDelegate.response},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"statusText",{get:function(){return this.xmlHttpRequestDelegate.statusText},enumerable:!0,configurable:!0}),a.prototype.setRequestHeader=function(a,b){this.xmlHttpRequestDelegate.setRequestHeader(a,b)},a.prototype.abort=function(){this.xmlHttpRequestDelegate.abort()},a.prototype.open=function(a,b,c,d,e){this.xmlHttpRequestDelegate.open(a,b,c?c:!0,d,e)},a.prototype.getResponseHeader=function(a){return this.xmlHttpRequestDelegate.getResponseHeader(a)},a.prototype.send=function(a){this.setCallbacksOnDelegate(),this.xmlHttpRequestDelegate.send(a)},a.prototype.setCallbacksOnDelegate=function(){var a=this;this.xmlHttpRequestDelegate.onabort=function(b){a.onabort&&a.onabort(b)},this.xmlHttpRequestDelegate.onerror=function(b){a.onerror&&a.onerror(b)},this.xmlHttpRequestDelegate.onload=function(b){a.onload&&a.onload(b)},this.xmlHttpRequestDelegate.onloadstart=function(b){a.onloadstart&&a.onloadstart(b)},this.xmlHttpRequestDelegate.onloadend=function(b){a.onloadend&&a.onloadend(b)},this.xmlHttpRequestDelegate.onprogress=function(b){a.onprogress&&a.onprogress(b)},this.xmlHttpRequestDelegate.ontimeout=function(b){a.ontimeout&&a.ontimeout(b)},this.xmlHttpRequestDelegate.onreadystatechange=function(b){a.onreadystatechange&&a.onreadystatechange(b)}},a}();a.XMLHttpRequestWrapper=b}(a.HttpRequest||(a.HttpRequest={}));a.HttpRequest}(AzureHtml5JS||(AzureHtml5JS={}));var AzureHtml5JSTech=AzureHtml5JS,silverlightSSLoaded,onSilverlightError,UrlRewriter;!function(a){"use strict";function b(a){d(a)&&(u=a)}function c(){u=n}function d(a){if(a&&a.length>0){for(var b=0;b<a.length;b++)if(-1===n.indexOf(a[b]))throw new Error('Format "'+a[b]+'" not supported');return!0}return!1}function e(a,b){for(var c=[],d=0;d<b.length;d++)-1!==s[a].indexOf(b[d].type)&&c.push(b[d]);return c}function f(a){for(var b,c,d=[],e=[],f=0;a&&f<a.length;f++){var i=a[f].src,j=a[f].src.indexOf("?");-1!==j&&(i=a[f].src.substr(0,j).toLowerCase()),-1===i.toLowerCase().lastIndexOf(".ism/manifest")||a[f].disableUrlRewriter?d.push(a[f]):(c=g(a[f].src),-1===e.indexOf(c)&&(e.push(c),b=h(a[f]),b&&(d=d.concat(b))))}return d.length>0?d:null}function g(a){var b=a.trim(),c=b.search(/\.ism\/manifest/i);return b.substr(0,c+t.length)}function h(a){var b,c=a.src.trim(),f=c.search(/format=/i),h=[],n="",s="",x=c.indexOf("?");if(-1!==x&&(s=c.substr(x),""!==s)){var y=new RegExp("(\\?|&)protectionType=(.[^&]*)","i"),z=new RegExp("(\\?|&)token=(.[^&]*)","i"),A=s.match(y),B=s.match(z);if(A&&3===A.length){var C=new w;C.type=A[2],B&&3===B.length&&(C.authenticationToken=decodeURIComponent(B[2])),a.protectionInfo=[C]}}var D=c.match(/.*\(format=(.*)\)/),E=!1;if(D&&2===D.length){var F=D[1].toLowerCase();(0===F.indexOf(p)||0===F.indexOf(q))&&(E=!0)}f>-1&&(c=c.replace(/format=[^,)]*[ ,]*/i,""),c=c.replace(/\(\s*\)/,"")),b=c.match(/\.ism\/manifest\([^)]*\)/i),b&&b.length>0&&(n=b[0].substr(t.length+1).trim()),c=g(a.src.trim());var G=u;a.streamingFormats&&d(a.streamingFormats)&&(G=a.streamingFormats);for(var H=0;H<G.length;H++){var I,J,K,L="";if(I=G[H],J=r[I],I!==i){var M;M=I==j&&E?p:I!=k&&I!=l&&I!=m||!E?o[I]:q,L="(format="+M,L+=n?","+n:")"}else n&&(L="("+n);if(a.protectionInfo){var N=e(I,a.protectionInfo);if(!N.length)continue;K=new v(c+L,J,N)}else K=new v(c+L,J,null);""!==s&&(K.src+=s),h.push(K)}return h.length>0?h:null}var i="SMOOTH",j="DASH",k="HLS-V3",l="HLS-V4",m="HLS",n=[i,j,l,k,m],o={DASH:"mpd-time-csf","HLS-V3":"m3u8-aapl-v3","HLS-V4":"m3u8-aapl-v4",HLS:"m3u8-aapl"},p="mpd-time-cmaf",q="m3u8-cmaf",r={SMOOTH:"application/vnd.ms-sstr+xml",DASH:"application/dash+xml","HLS-V3":"application/vnd.apple.mpegurl","HLS-V4":"application/vnd.apple.mpegurl",HLS:"application/vnd.apple.mpegurl"},s={SMOOTH:["PlayReady","AES"],DASH:["PlayReady","AES","Widevine"],"HLS-V3":["PlayReady","AES"],"HLS-V4":["PlayReady","AES"],HLS:["PlayReady","AES","FairPlay"]},t=".ism/manifest",u=n,v=function(){function a(a,b,c){this.src=a,this.type=b,this.protectionInfo=c}return a}();a.streamSrc=v;var w=function(){function a(){}return a}();a.protectionInfo=w,a.setStreamingFormats=b,a.resetStreamingFormats=c,a.expandSources=f}(UrlRewriter||(UrlRewriter={}));var AMP;!function(a){!function(a){"use strict";function b(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=[],d=0;d<a.byteLength;){var e=a[d++];c.push(b.charAt(e>>2)),e=(3&e)<<4,d<a.byteLength?(c.push(b.charAt(e|a[d]>>4)),e=(15&a[d++])<<2,d<a.byteLength?(c.push(b.charAt(e|a[d]>>6)),c.push(b.charAt(63&a[d++]))):(c.push(b.charAt(e)),c.push("="))):(c.push(b.charAt(e)),c.push("=="))}return c.join("")}function c(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=new Uint8Array(new ArrayBuffer(3*a.length/4+4)),d=0,e=0;d<a.length;){var f=b.indexOf(a.charAt(d)),g=b.indexOf(a.charAt(d+1));if(c[e++]=f<<2|g>>4,"="!==a.charAt(d+2)){var h=b.indexOf(a.charAt(d+2));if(c[e++]=g<<4|h>>2,"="!==a.charAt(d+3)){var i=b.indexOf(a.charAt(d+3));c[e++]=h<<6|i}}d+=4}return new Uint8Array(c.buffer,0,e)}a.binaryToBase64=b,a.base64ToBinary=c}(a.Base64Utils||(a.Base64Utils={}));a.Base64Utils}(AMP||(AMP={}));var AMP;!function(a){!function(a){"use strict";function b(a,b){o(a,3,b)}function c(a,b){o(a,2,b)}function d(a,b){o(a,1,b)}function e(a,b){o(a,0,b)}function f(a){for(var e=[],f=0;f<arguments.length-1;f++)e[f]=arguments[f+1];if(e&&e.length>0){var g=Array.prototype.slice.call(e[0]);switch(a){case"warn":c(4,g.join(" "));break;case"error":d(4,g.join(" "));break;case null:b(4,g.join(" "));break;default:b(4,g.join(" "))}}}function g(a){u=a}function h(a){void 0===a||null===a?v.forEach(function(a,b,c){c[b]=!0}):v[a]=!0}function i(a){void 0===a||null===a?v.forEach(function(a,b,c){c[b]=!1}):v[a]=!1}function j(a){"undefined"==typeof a&&(a=!0),y=a}function k(a){if(void 0!==a&&a.TraceTargets&&!(a.TraceTargets.length<=0)){y=!1,C=!1,u=a.maxLogLevel;for(var b=0;b<a.TraceTargets.length;b++)"console"===a.TraceTargets[b].target.toLowerCase()?C=!0:"memory"===a.TraceTargets[b].target.toLowerCase()&&(y=!0,A=a.TraceTargets[b].maxMemoryTraceCount?a.TraceTargets[b].maxMemoryTraceCount:x)}}function l(a){"undefined"==typeof a&&(a=!0);var b=z;return a&&(z=[]),b.join("\n")}function m(){B=z.slice()}function n(){return B.join("\n")}function o(a,b,c){var d=new Date(Date.now());if(u>=b&&v[a]){var e="["+("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2)+":"+("0"+(d.getSeconds()+d.getMilliseconds()/1e3).toFixed(3)).slice(-6)+"] "+p[b]+": "+q[a]+": "+c;y&&(z.length>A&&z.shift(),z.push(e)),C&&s.log(e)}}!function(a){a[a.none=0]="none",a[a.error=1]="error",a[a.warning=2]="warning",a[a.verbose=3]="verbose"}(a.Level||(a.Level={}));var p=a.Level;!function(a){a[a.functionalTest=0]="functionalTest",a[a.azureHtml5JS=1]="azureHtml5JS",a[a.flashSS=2]="flashSS",a[a.silverlightSS=3]="silverlightSS",a[a.videojs=4]="videojs",a[a.plugin=5]="plugin",a[a.html5FairplayHLS=6]="html5FairplayHLS",a[a.html5=7]="html5",a[a.scte35=8]="scte35",a[a.scheduler=9]="scheduler",a[a.ad=10]="ad",a[a.ampAPI=11]="ampAPI",a[a.cea608Module=12]="cea608Module",a[a.ttml=13]="ttml",a[a.max=14]="max"}(a.Area||(a.Area={}));var q=a.Area;a.verbose=b,a.warning=c,a.error=d,a.startup=e,a.videoJSLogOverride=f,a.setConsoleOutputByLevel=g,a.enableConsoleOutputByArea=h,a.disableConsoleOutputByArea=i,a.enableMemoryLog=j,a.setLogConfig=k,a.getMemoryLog=l,a.saveMemoryLog=m,a.getSavedMemoryLog=n,a.writeEntry=o;for(var r=function(){},s=window.console||{log:r,warn:r,error:r},t=!1,u=0,v=[],w=0;14>w;w++)v.push(!1);var x=5e4,y=!1,z=[],A=x,B=[],C=!0;a.enableConsoleOutputByArea(),a.setConsoleOutputByLevel(t?3:1)}(a.Logger||(a.Logger={}));a.Logger}(AMP||(AMP={}));var AMP;!function(a){!function(a){"use strict";function b(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];var c=Array.prototype.slice.call(a,1);return a[0].replace(/{(\d+)}/g,function(a,b){return"undefined"!=typeof c[b]?c[b]:a})}a.formatString=b}(a.Misc||(a.Misc={}));a.Misc}(AMP||(AMP={}));var AMP;!function(a){!function(a){"use strict";!function(a){a[a.audio=0]="audio",a[a.video=1]="video"}(a.MediaType||(a.MediaType={}));var b=(a.MediaType,function(){function a(a,b){this._el=a,this._typeStr=0===b?"Audio":"Video",this._bufferLevel=0,this._handlers=new c,this.downloadRequested=null,this.downloadCompleted=null,this.downloadFailed=null}return Object.defineProperty(a.prototype,"bufferLevel",{get:function(){var a="get"+this._typeStr+"BufferLength";return this._el&&this._el[a]?this._el[a]():0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"perceivedBandwidth",{get:function(){return this._el&&this._el.getPerceivedBandwidth?this._el.getPerceivedBandwidth():0},enumerable:!0,configurable:!0}),a.prototype.addEventListener=function(a,b){this._handlers[a]&&this._handlers[a].push(b)},a.prototype.removeEventListener=function(a,b){if(this._handlers[a]){var c=this._handlers[a].indexOf(b);-1!==c&&this._handlers[a].splice(c,1)}},a.prototype.dispatchEvent=function(a){if(this._handlers[a])for(var b={type:a},c=0;c<this._handlers[a].length;c++)this._handlers[a][c].call(this,b)},a}());a.BufferData=b;var c=function(){function a(){this.downloadrequested=[],this.downloadcompleted=[],this.downloaddecrypted=[],this.downloadfailed=[]}return a}()}(a.FlashSS||(a.FlashSS={}));a.FlashSS}(AMP||(AMP={}));var AMP;!function(a){!function(b){"use strict";var c=function(){function b(a){this._streams=[],this._flashElement=a;for(var b=0;b<a.getNumAlternativeAudioStreams();b++){var c=new d(a,b);this._streams.push(c)}this.selectedIndex=this._streams.length>0?a.getCurrentAlternativeAudioStreamIndex():void 0}return Object.defineProperty(b.prototype,"streams",{get:function(){return this._streams},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"enabledIndices",{get:function(){for(var a=[],b=0;b<this._streams.length;b++)if(this._streams[b].enabled){a.push(b);break}return a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(a){0!=this._streams.length&&(void 0!=this._selectedIndex&&(this._streams[this._selectedIndex].enabled=!1),this._streams[a].enabled=!0,this._selectedIndex=a)},enumerable:!0,configurable:!0}),b.prototype.switchIndex=function(b){if(this._flashElement.getHasAlternativeAudio()){if(1!=this.enabledIndices.length)return a.Logger.error(2,"switchIndex failed - only single stream supported: "+this.enabledIndices.length+" streams enabled"),void this._flashElement.tech.trigger(amp.streamListEventName.streamselectnotsupported);if(b>=this.streams.length||0>b)return a.Logger.error(2,"audioChange failed - tried to enable invalid index: "+b),void this._flashElement.tech.trigger(amp.streamListEventName.streamindexinvalid);if(b===this.enabledIndices[0])return a.Logger.verbose(2,"audioChange failed because current stream selected"),void this._flashElement.tech.trigger(amp.streamListEventName.streamselected);this.selectedIndex=b,this._flashElement.switchAlternativeAudioIndex(b),this._flashElement.tech.trigger(amp.streamListEventName.streamselected)}else a.Logger.error(2,"No alternative audio streams found")},b.prototype.addEventListener=function(a,b){this._flashElement.tech.on(a,b)},b.prototype.removeEventListener=function(a,b){this._flashElement.tech.off(a,b)},b}();b.AudioStreamList=c;var d=function(){function a(a,b){this.enabled=!1,this.language=a.getAlternativeAudioItemAt(b).info.attributes.Language,this.codec=a.getAlternativeAudioItemAt(b).info.targetTrack.fourCC,this.bitrate=1e3*a.getAlternativeAudioItemAt(b).bitrate,this.name=this.getName(a,b)}return a.prototype.getName=function(a,b){var c=a.getAlternativeAudioItemAt(b).info.urlTemplate.toLowerCase(),d="fragments(",e=c.indexOf(d),f=c.indexOf("=",e);return a.getAlternativeAudioItemAt(b).info.urlTemplate.substring(e+d.length,f)},a}();b.AudioStream=d}(a.FlashSS||(a.FlashSS={}));a.FlashSS}(AMP||(AMP={}));var AMP;!function(a){!function(a){"use strict";var b=function(){function a(a){if(this.streams=[],a.getIsDynamicStream()){var b=new c(a);this.streams.push(b)}this.selectedIndex=this.streams.length>0?0:void 0}return a}();a.VideoStreamList=b;var c=function(){function a(a){this.name="",this.tracks=[],this._flashElement=a,this._selectedTrack=-1;for(var b=a.getStreamItems(),c=0;c<b.length;c++){var d=new e(b[c]);this.tracks.push(d)}}return a.prototype.selectTrackByIndex=function(a){if(this._selectedTrack!=a){-1==a?this._flashElement.setAutoDynamicStreamSwitch(!0):(this._flashElement.setAutoDynamicStreamSwitch(!1),this._flashElement.switchDynamicStreamIndex(a));for(var b=0;b<this.tracks.length;b++)this.tracks[b].streamingInfo.selectable=-1===a?!0:a===b;this._selectedTrack=a,this._flashElement.tech.trigger(amp.streamEventName.trackselected)}},a.prototype.addEventListener=function(a,b){this._flashElement.tech.on(a,b)},a.prototype.removeEventListener=function(a,b){this._flashElement.tech.off(a,b)},a}();a.VideoStream=c;var d=function(){function a(){this.selectable=!0}return a}();a.MediaTrackStreamingInfo=d;var e=function(){function a(a){this.width=a.width,this.height=a.height,this.bitrate=1e3*a.bitrate,this.streamingInfo=new d}return Object.defineProperty(a.prototype,"selectable",{get:function(){return this.streamingInfo.selectable},enumerable:!0,configurable:!0}),a}();a.VideoTrack=e}(a.FlashSS||(a.FlashSS={}));a.FlashSS}(AMP||(AMP={}));var AMP;!function(a){!function(a){"use strict";var b=function(){function a(a){this._html5Tech=a}return Object.defineProperty(a.prototype,"streams",{get:function(){var a=[],b=this._html5Tech.player().audioTracks();if(b)for(var c=0;c<b.length;c++){var d={name:b[c].label,codec:"aac",language:b[c].language,bitrate:0,enabled:b[c].enabled};a.push(d)}return a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"enabledIndices",{get:function(){var a=[],b=this._html5Tech.player().audioTracks();if(b)for(var c=0;c<b.length;c++)b[c].enabled&&a.push(c);return a},enumerable:!0,configurable:!0}),a.prototype.switchIndex=function(a){var b=this._html5Tech.player().audioTracks();if(b&&a>=0&&a<b.length)for(var c=0;c<b.length;c++)b[c].enabled=c===a,c===a&&this._html5Tech.trigger(amp.streamListEventName.streamselected)},a.prototype.addEventListener=function(a,b){this._html5Tech.on(a,b)},a.prototype.removeEventListener=function(a,b){this._html5Tech.off(a,b)},a}();a.AudioStreamList=b}(a.Html5||(a.Html5={}));a.Html5}(AMP||(AMP={}));var AMP;!function(a){!function(b){"use strict";var c;!function(a){a[a.success=200]="success"}(c||(c={}));var d=function(){function a(a,b,c){this.src=a,this.autoPlay=b,this.fairplayInfo=c}return a}();b.SrcInfo=d;var e=function(){function a(a,b){this.code=a,this.msg=b}return a}(),f=function(){function a(a,b,c,d){this.target=a,this.listener=b,this.eventName=c,this.useCapture=d}return a}(),g=function(){function b(a,b,c,d){this.videoTag=a,this.srcInfo=b,this.onError=c,this.onEvent=d,this.certFecthed=!1,this.certificate=null,this.session=null,this.licenseUrl=null,this.disposed=!1,this.keySessionEventListeners=[],this.init()}return b.prototype.dispose=function(){this.disposed=!0,this.keySessionEventListeners.forEach(function(a){a.target.removeEventListener(a.eventName,a.listener,a.useCapture)}),this.keySessionEventListeners=null,this.videoTag&&(this.videoTag=null),this.srcInfo=null,this.onError=null,this.certificate=null,this.onEvent=null,this.certFecthed=!1,this.session&&this.session.close()},b.prototype.init=function(){function b(){d.certFecthed=!0,d.setSrcOnVideoElement()}function c(){return new Promise(function(b,c){function f(){d.disposed||(a.Logger.verbose(6,"FairPlay certificate fetch completed"),200===this.status?(d.certificate=new Uint8Array(this.response),b()):c(new e(5242887,"Fairplay certificate fetch failed with status ="+this.status)))}function g(){d.disposed||c(new e(5242887,"Error occurred during Fairplay certificate fetch."))}var h=new XMLHttpRequest;h.open("GET",d.srcInfo.fairplayInfo.certificateUrl,!0),h.responseType="arraybuffer",h.onload=f,h.onerror=g,a.Logger.verbose(6,"Fairplay certificate fetch initiated"),h.send()})}if(!this.srcInfo.fairplayInfo||!this.srcInfo.fairplayInfo.type||"FairPlay"!=this.srcInfo.fairplayInfo.type||!this.srcInfo.fairplayInfo.certificateUrl)return void this.onError(4194304,"Initialization Error in FairPlay");var d=this;c().then(b)["catch"](function(b){a.Logger.error(6,b.msg),d.onError(b.code,b.msg)})},b.prototype.play=function(){this.certFecthed?this.videoTag.play():this.pendingPlay=!0},b.prototype.addEventListener=function(a,b,c,d){a.addEventListener(b,c,d),this.keySessionEventListeners.push(new f(a,c,b,d))},b.prototype.setSrcOnVideoElement=function(){function b(a){if(!j.disposed){var b=a.initData,g="com.apple.fps.1_0";j.contentId=f(b),b=j.concatInitDataContentIdAndCertificate(b,i(j.contentId)),j.session=e(b,g),j.session&&(j.addEventListener(j.session,"webkitkeymessage",c,!1),j.addEventListener(j.session,"webkitkeyerror",d,!1))}}function c(b){function c(){if(!j.disposed)try{if(a.Logger.verbose(6,"FairPlay License fetch completed"),200!==this.status)throw Error("License fetch failed with http status = "+this.status);var b=this.responseText.trim(),c=b.indexOf("<ckc>"),d=b.indexOf("</ckc>");if(-1===c||-1===d)throw Error("License data format not as expected, missing or misplaced <ckc> tag");c+=5,b=b.substr(c,d-c);var e=a.Base64Utils.base64ToBinary(b);j.session.update(e)}catch(f){var g=f.message?f.message:"Failed to update MediaKeySession with fetched Fairplay license.";a.Logger.error(6,g),j.onError(5242886,g)}}function d(){if(!j.disposed){var b="Error occurred during Fairplay license fetch.";a.Logger.error(6,b),j.onError(5242886,b)}}if(!j.disposed){var e=new XMLHttpRequest;e.open("POST",j.licenseUrl,!0),e.onload=c,e.onerror=d,e.responseType="text";var f="spc="+a.Base64Utils.binaryToBase64(b.message)+"&assetId="+encodeURIComponent(j.contentId);e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),j.srcInfo.fairplayInfo.authenticationToken&&e.setRequestHeader("Authorization",j.srcInfo.fairplayInfo.authenticationToken),a.Logger.verbose(6,"FairPlay License fetch initiated"),e.send(f)}}function d(){if(!j.disposed){var b="MediaKeyError code: "+j.session.error.code+", systemCode: "+AzureHtml5JS.Common.toHexString(j.session.error.systemCode);a.Logger.error(6,b),j.onError(5242880,b)}}function e(b,c){var d="video/mp4",e="WebKitMediaKeys"in window,f=null;try{if(!e||!window.WebKitMediaKeys.isTypeSupported(c,d))throw new Error("No EME support.");j.videoTag.webkitSetMediaKeys(new window.WebKitMediaKeys(c)),f=j.videoTag.webkitKeys.createSession(d,b);

}catch(g){var h=g.message?g.message:c+" session creation failed";a.Logger.error(6,h),j.onError(5242881,h)}return f}function f(a){var b=h(a);return j.licenseUrl=b.substring(1).replace("skd://","https://"),g(j.licenseUrl)}function g(a){var b=document.createElement("a");return b.href=a,b.hostname}function h(a){var b=new Uint16Array(a.buffer);try{return String.fromCharCode.apply(null,b)}catch(c){for(var d=[],e=0;e<b.byteLength;e++)d.push(String.fromCharCode(b[e]));return d.join("")}}function i(a){for(var b=new ArrayBuffer(2*a.length),c=new Uint16Array(b),d=0,e=a.length;e>d;d++)c[d]=a.charCodeAt(d);return c}if(!this.disposed){this.addEventListener(this.videoTag,"webkitneedkey",b,!1),this.videoTag.autoplay=this.srcInfo.autoPlay,this.videoTag.src=this.srcInfo.src,this.pendingPlay&&this.videoTag.play();var j=this}},b.prototype.concatInitDataContentIdAndCertificate=function(a,b){var c=4,d=a.length+c+b.byteLength+c+this.certificate.byteLength,e=new ArrayBuffer(d),f=new DataView(e),g=0,h=new Uint8Array(e,g,a.byteLength);h.set(a),g+=h.byteLength,f.setUint32(g,b.byteLength,!0),g+=c;var i=new Uint16Array(e,g,b.length);i.set(b),g+=i.byteLength,f.setUint32(g,this.certificate.byteLength,!0),g+=c;var j=new Uint8Array(e,g,this.certificate.byteLength);return j.set(this.certificate),new Uint8Array(e,0,e.byteLength)},b}();b.FairPlay=g}(a.Html5Fairplay||(a.Html5Fairplay={}));a.Html5Fairplay}(AMP||(AMP={}));var AMP;!function(a){!function(b){"use strict";function c(a){var b=null;if(a)try{for(var c=window.atob(a),e=new ArrayBuffer(c.length),f=new Uint8Array(e),g=0;g<c.length;g++)f[g]=c.charCodeAt(g);b=d(f)}catch(h){b=null}return b}function d(b){var c=null;if(b&&b.length>18)try{var d=9e4,e=4294967296,f=67108864,g=16777216;c={id:void 0,startOffset:0};var h=b[4]>>7;if(h)a.Logger.warning(8,"Received encrypted message. Skipping..");else{var i=(127&b[4])*f+(b[5]<<18)+(b[6]<<10)+(b[7]<<2)+(b[8]>>6),j=b[13];if(5!=j)a.Logger.warning(8,"Skipping unsupported splice command: "+j);else if(c.id=b[14]*g+(b[15]<<16)+(b[16]<<8)+b[17],c.cancel=b[18]>>7==1,!c.cancel){c.out=b[19]>>7==1;var k=(64&b[19])>>6==1,l=(32&b[19])>>5==1,m=(16&b[19])>>4==1;if(k)if(m)-1==c.startOffset;else{var n=(128&b[20])>>7==1;if(n){var o=(1&b[20])*e+b[21]*g+(b[22]<<16)+(b[23]<<8)+b[24];c.startOffset=(o+i)/d}if(l){var p=n?25:21,q=(1&b[p],(1&b[p])*e+b[p+1]*g+(b[p+2]<<16)+(b[p+3]<<8)+b[p+4]);c.duration=q/d}}else a.Logger.warning(8,"Component splice mode is not supported.")}}}catch(r){c=null}return c}b.parseBase64EncodedMessage=c,b.parseBinaryMessage=d}(a.Scte35Parser||(a.Scte35Parser={}));a.Scte35Parser}(AMP||(AMP={})),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g||b===l?62:b===h||b===m?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0),l="-".charCodeAt(0),m="_".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],2:[function(){},{}],3:[function(a,b,c){(function(b){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
"use strict";function d(){function a(){}try{var b=new Uint8Array(1);return b.foo=function(){return 42},b.constructor=a,42===b.foo()&&b.constructor===a&&"function"==typeof b.subarray&&0===b.subarray(1,1).byteLength}catch(c){return!1}}function e(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(a){return this instanceof f?(f.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof a?g(this,a):"string"==typeof a?h(this,a,arguments.length>1?arguments[1]:"utf8"):i(this,a)):arguments.length>1?new f(a,arguments[1]):new f(a)}function g(a,b){if(a=p(a,0>b?0:0|q(b)),!f.TYPED_ARRAY_SUPPORT)for(var c=0;b>c;c++)a[c]=0;return a}function h(a,b,c){("string"!=typeof c||""===c)&&(c="utf8");var d=0|s(b,c);return a=p(a,d),a.write(b,c),a}function i(a,b){if(f.isBuffer(b))return j(a,b);if(Y(b))return k(a,b);if(null==b)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(b.buffer instanceof ArrayBuffer)return l(a,b);if(b instanceof ArrayBuffer)return m(a,b)}return b.length?n(a,b):o(a,b)}function j(a,b){var c=0|q(b.length);return a=p(a,c),b.copy(a,0,0,c),a}function k(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function l(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function m(a,b){return f.TYPED_ARRAY_SUPPORT?(b.byteLength,a=f._augment(new Uint8Array(b))):a=l(a,new Uint8Array(b)),a}function n(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function o(a,b){var c,d=0;"Buffer"===b.type&&Y(b.data)&&(c=b.data,d=0|q(c.length)),a=p(a,d);for(var e=0;d>e;e+=1)a[e]=255&c[e];return a}function p(a,b){f.TYPED_ARRAY_SUPPORT?(a=f._augment(new Uint8Array(b)),a.__proto__=f.prototype):(a.length=b,a._isBuffer=!0);var c=0!==b&&b<=f.poolSize>>>1;return c&&(a.parent=Z),a}function q(a){if(a>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|a}function r(a,b){if(!(this instanceof r))return new r(a,b);var c=new f(a,b);return delete c.parent,c}function s(a,b){"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"binary":case"raw":case"raws":return c;case"utf8":case"utf-8":return R(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return U(a).length;default:if(d)return R(a).length;b=(""+b).toLowerCase(),d=!0}}function t(a,b,c){var d=!1;if(b=0|b,c=void 0===c||c===1/0?this.length:0|c,a||(a="utf8"),0>b&&(b=0),c>this.length&&(c=this.length),b>=c)return"";for(;;)switch(a){case"hex":return F(this,b,c);case"utf8":case"utf-8":return B(this,b,c);case"ascii":return D(this,b,c);case"binary":return E(this,b,c);case"base64":return A(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function u(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function v(a,b,c,d){return V(R(b,a.length-c),a,c,d)}function w(a,b,c,d){return V(S(b),a,c,d)}function x(a,b,c,d){return w(a,b,c,d)}function y(a,b,c,d){return V(U(b),a,c,d)}function z(a,b,c,d){return V(T(b,a.length-c),a,c,d)}function A(a,b,c){return W.fromByteArray(0===b&&c===a.length?a:a.slice(b,c))}function B(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;c>e;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(c>=e+h){var i,j,k,l;switch(h){case 1:128>f&&(g=f);break;case 2:i=a[e+1],128===(192&i)&&(l=(31&f)<<6|63&i,l>127&&(g=l));break;case 3:i=a[e+1],j=a[e+2],128===(192&i)&&128===(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j,l>2047&&(55296>l||l>57343)&&(g=l));break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128===(192&i)&&128===(192&j)&&128===(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k,l>65535&&1114112>l&&(g=l))}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return C(d)}function C(a){var b=a.length;if($>=b)return String.fromCharCode.apply(String,a);for(var c="",d=0;b>d;)c+=String.fromCharCode.apply(String,a.slice(d,d+=$));return c}function D(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(127&a[e]);return d}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function F(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=Q(a[f]);return e}function G(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function H(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function I(a,b,c,d,e,g){if(!f.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>e||g>b)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range")}function J(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function K(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function L(a,b,c,d,e,f){if(b>e||f>b)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");if(0>c)throw new RangeError("index out of range")}function M(a,b,c,d,e){return e||L(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(a,b,c,d,23,4),c+4}function N(a,b,c,d,e){return e||L(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(a,b,c,d,52,8),c+8}function O(a){if(a=P(a).replace(aa,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function P(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function Q(a){return 16>a?"0"+a.toString(16):a.toString(16)}function R(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;d>g;g++){if(c=a.charCodeAt(g),c>55295&&57344>c){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(56320>c){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,128>c){if((b-=1)<0)break;f.push(c)}else if(2048>c){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(65536>c){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(1114112>c))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function S(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function T(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);g++)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function U(a){return W.toByteArray(O(a))}function V(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}var W=a("base64-js"),X=a("ieee754"),Y=a("isarray");c.Buffer=f,c.SlowBuffer=r,c.INSPECT_MAX_BYTES=50,f.poolSize=8192;var Z={};f.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:d(),f.TYPED_ARRAY_SUPPORT?(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array):(f.prototype.length=void 0,f.prototype.parent=void 0),f.isBuffer=function(a){return!(null==a||!a._isBuffer)},f.compare=function(a,b){if(!f.isBuffer(a)||!f.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,g=Math.min(c,d);g>e&&a[e]===b[e];)++e;return e!==g&&(c=a[e],d=b[e]),d>c?-1:c>d?1:0},f.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(a,b){if(!Y(a))throw new TypeError("list argument must be an Array of Buffers.");if(0===a.length)return new f(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var d=new f(b),e=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(d,e),e+=g.length}return d},f.byteLength=s,f.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?B(this,0,a):t.apply(this,arguments)},f.prototype.equals=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:0===f.compare(this,a)},f.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},f.prototype.compare=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?0:f.compare(this,a)},f.prototype.indexOf=function(a,b){function c(a,b,c){for(var d=-1,e=0;c+e<a.length;e++)if(a[c+e]===b[-1===d?0:e-d]){if(-1===d&&(d=e),e-d+1===b.length)return c+d}else d=-1;return-1}if(b>2147483647?b=2147483647:-2147483648>b&&(b=-2147483648),b>>=0,0===this.length)return-1;if(b>=this.length)return-1;if(0>b&&(b=Math.max(this.length+b,0)),"string"==typeof a)return 0===a.length?-1:String.prototype.indexOf.call(this,a,b);if(f.isBuffer(a))return c(this,a,b);if("number"==typeof a)return f.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,a,b):c(this,[a],b);throw new TypeError("val must be string, number or Buffer")},f.prototype.get=function(a){return this.readUInt8(a)},f.prototype.set=function(a,b){return this.writeUInt8(a,b)},f.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b=0|b,isFinite(c)?(c=0|c,void 0===d&&(d="utf8")):(d=c,c=void 0);else{var e=d;d=b,b=0|c,c=e}var f=this.length-b;if((void 0===c||c>f)&&(c=f),a.length>0&&(0>c||0>b)||b>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(var g=!1;;)switch(d){case"hex":return u(this,a,b,c);case"utf8":case"utf-8":return v(this,a,b,c);case"ascii":return w(this,a,b,c);case"binary":return x(this,a,b,c);case"base64":return y(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,a,b,c);default:if(g)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),g=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;f.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a);var d;if(f.TYPED_ARRAY_SUPPORT)d=f._augment(this.subarray(a,b));else{var e=b-a;d=new f(e,void 0);for(var g=0;e>g;g++)d[g]=this[g+a]}return d.length&&(d.parent=this.parent||this),d},f.prototype.readUIntLE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},f.prototype.readUIntBE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},f.prototype.readUInt8=function(a,b){return b||H(a,1,this.length),this[a]},f.prototype.readUInt16LE=function(a,b){return b||H(a,2,this.length),this[a]|this[a+1]<<8},f.prototype.readUInt16BE=function(a,b){return b||H(a,2,this.length),this[a]<<8|this[a+1]},f.prototype.readUInt32LE=function(a,b){return b||H(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},f.prototype.readUInt32BE=function(a,b){return b||H(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},f.prototype.readIntLE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},f.prototype.readIntBE=function(a,b,c){a=0|a,b=0|b,c||H(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},f.prototype.readInt8=function(a,b){return b||H(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},f.prototype.readInt16LE=function(a,b){b||H(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt16BE=function(a,b){b||H(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt32LE=function(a,b){return b||H(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},f.prototype.readInt32BE=function(a,b){return b||H(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},f.prototype.readFloatLE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!0,23,4)},f.prototype.readFloatBE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!1,23,4)},f.prototype.readDoubleLE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!0,52,8)},f.prototype.readDoubleBE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!1,52,8)},f.prototype.writeUIntLE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},f.prototype.writeUIntBE=function(a,b,c,d){a=+a,b=0|b,c=0|c,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},f.prototype.writeUInt8=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,1,255,0),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},f.prototype.writeUInt16LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeUInt16BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeUInt32LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):K(this,a,b,!0),b+4},f.prototype.writeUInt32BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=0,g=1,h=0>a?1:0;for(this[b]=255&a;++f<c&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0>a?1:0;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeInt8=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,1,127,-128),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=255&a,b+1},f.prototype.writeInt16LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeInt16BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeInt32LE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):K(this,a,b,!0),b+4},f.prototype.writeInt32BE=function(a,b,c){return a=+a,b=0|b,c||I(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeFloatLE=function(a,b,c){return M(this,a,b,!0,c)},f.prototype.writeFloatBE=function(a,b,c){return M(this,a,b,!1,c)},f.prototype.writeDoubleLE=function(a,b,c){return N(this,a,b,!0,c)},f.prototype.writeDoubleBE=function(a,b,c){return N(this,a,b,!1,c)},f.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&c>d&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("sourceStart out of bounds");if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,g=d-c;if(this===a&&b>c&&d>b)for(e=g-1;e>=0;e--)a[e+b]=this[e+c];else if(1e3>g||!f.TYPED_ARRAY_SUPPORT)for(e=0;g>e;e++)a[e+b]=this[e+c];else a._set(this.subarray(c,c+g),b);return g},f.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),b>c)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new RangeError("start out of bounds");if(0>c||c>this.length)throw new RangeError("end out of bounds");var d;if("number"==typeof a)for(d=b;c>d;d++)this[d]=a;else{var e=R(a.toString()),f=e.length;for(d=b;c>d;d++)this[d]=e[d%f]}return this}},f.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(f.TYPED_ARRAY_SUPPORT)return new f(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var _=f.prototype;f._augment=function(a){return a.constructor=f,a._isBuffer=!0,a._set=a.set,a.get=_.get,a.set=_.set,a.write=_.write,a.toString=_.toString,a.toLocaleString=_.toString,a.toJSON=_.toJSON,a.equals=_.equals,a.compare=_.compare,a.indexOf=_.indexOf,a.copy=_.copy,a.slice=_.slice,a.readUIntLE=_.readUIntLE,a.readUIntBE=_.readUIntBE,a.readUInt8=_.readUInt8,a.readUInt16LE=_.readUInt16LE,a.readUInt16BE=_.readUInt16BE,a.readUInt32LE=_.readUInt32LE,a.readUInt32BE=_.readUInt32BE,a.readIntLE=_.readIntLE,a.readIntBE=_.readIntBE,a.readInt8=_.readInt8,a.readInt16LE=_.readInt16LE,a.readInt16BE=_.readInt16BE,a.readInt32LE=_.readInt32LE,a.readInt32BE=_.readInt32BE,a.readFloatLE=_.readFloatLE,a.readFloatBE=_.readFloatBE,a.readDoubleLE=_.readDoubleLE,a.readDoubleBE=_.readDoubleBE,a.writeUInt8=_.writeUInt8,a.writeUIntLE=_.writeUIntLE,a.writeUIntBE=_.writeUIntBE,a.writeUInt16LE=_.writeUInt16LE,a.writeUInt16BE=_.writeUInt16BE,a.writeUInt32LE=_.writeUInt32LE,a.writeUInt32BE=_.writeUInt32BE,a.writeIntLE=_.writeIntLE,a.writeIntBE=_.writeIntBE,a.writeInt8=_.writeInt8,a.writeInt16LE=_.writeInt16LE,a.writeInt16BE=_.writeInt16BE,a.writeInt32LE=_.writeInt32LE,a.writeInt32BE=_.writeInt32BE,a.writeFloatLE=_.writeFloatLE,a.writeFloatBE=_.writeFloatBE,a.writeDoubleLE=_.writeDoubleLE,a.writeDoubleBE=_.writeDoubleBE,a.fill=_.fill,a.inspect=_.inspect,a.toArrayBuffer=_.toArrayBuffer,a};var aa=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:7,isarray:4}],4:[function(a,b){var c={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==c.call(a)}},{}],5:[function(a,b,c){(function(a){function b(a){return Array.isArray?Array.isArray(a):"[object Array]"===q(a)}function d(a){return"boolean"==typeof a}function e(a){return null===a}function f(a){return null==a}function g(a){return"number"==typeof a}function h(a){return"string"==typeof a}function i(a){return"symbol"==typeof a}function j(a){return void 0===a}function k(a){return"[object RegExp]"===q(a)}function l(a){return"object"==typeof a&&null!==a}function m(a){return"[object Date]"===q(a)}function n(a){return"[object Error]"===q(a)||a instanceof Error}function o(a){return"function"==typeof a}function p(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function q(a){return Object.prototype.toString.call(a)}c.isArray=b,c.isBoolean=d,c.isNull=e,c.isNullOrUndefined=f,c.isNumber=g,c.isString=h,c.isSymbol=i,c.isUndefined=j,c.isRegExp=k,c.isObject=l,c.isDate=m,c.isError=n,c.isFunction=o,c.isPrimitive=p,c.isBuffer=a.isBuffer}).call(this,{isBuffer:a("../../is-buffer/index.js")})},{"../../is-buffer/index.js":9}],6:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,"function"==typeof console.trace)}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],7:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?0/0:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],8:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],9:[function(a,b){function c(a){return!!a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}function d(a){return"function"==typeof a.readFloatLE&&"function"==typeof a.slice&&c(a.slice(0,0))}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
b.exports=function(a){return null!=a&&(c(a)||d(a)||!!a._isBuffer)}},{}],10:[function(a,b){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],11:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],12:[function(a,b){b.exports=a("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":13}],13:[function(a,b){(function(c){function d(a){return this instanceof d?(i.call(this,a),j.call(this,a),a&&a.readable===!1&&(this.readable=!1),a&&a.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",e)):new d(a)}function e(){this.allowHalfOpen||this._writableState.ended||c.nextTick(this.end.bind(this))}function f(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}b.exports=d;var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b},h=a("core-util-is");h.inherits=a("inherits");var i=a("./_stream_readable"),j=a("./_stream_writable");h.inherits(d,i),f(g(j.prototype),function(a){d.prototype[a]||(d.prototype[a]=j.prototype[a])})}).call(this,a("_process"))},{"./_stream_readable":15,"./_stream_writable":17,_process:11,"core-util-is":5,inherits:8}],14:[function(a,b){function c(a){return this instanceof c?void d.call(this,a):new c(a)}b.exports=c;var d=a("./_stream_transform"),e=a("core-util-is");e.inherits=a("inherits"),e.inherits(c,d),c.prototype._transform=function(a,b,c){c(null,a)}},{"./_stream_transform":16,"core-util-is":5,inherits:8}],15:[function(a,b){(function(c){function d(b,c){var d=a("./_stream_duplex");b=b||{};var e=b.highWaterMark,f=b.objectMode?16:16384;this.highWaterMark=e||0===e?e:f,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!b.objectMode,c instanceof d&&(this.objectMode=this.objectMode||!!b.readableObjectMode),this.defaultEncoding=b.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(C||(C=a("string_decoder/").StringDecoder),this.decoder=new C(b.encoding),this.encoding=b.encoding)}function e(b){a("./_stream_duplex");return this instanceof e?(this._readableState=new d(b,this),this.readable=!0,void A.call(this)):new e(b)}function f(a,b,c,d,e){var f=j(b,c);if(f)a.emit("error",f);else if(B.isNullOrUndefined(c))b.reading=!1,b.ended||k(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var h=new Error("stream.push() after EOF");a.emit("error",h)}else if(b.endEmitted&&e){var h=new Error("stream.unshift() after end event");a.emit("error",h)}else!b.decoder||e||d||(c=b.decoder.write(c)),e||(b.reading=!1),b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&l(a)),n(a,b);else e||(b.reading=!1);return g(b)}function g(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function h(a){if(a>=E)a=E;else{a--;for(var b=1;32>b;b<<=1)a|=a>>b;a++}return a}function i(a,b){return 0===b.length&&b.ended?0:b.objectMode?0===a?0:1:isNaN(a)||B.isNull(a)?b.flowing&&b.buffer.length?b.buffer[0].length:b.length:0>=a?0:(a>b.highWaterMark&&(b.highWaterMark=h(a)),a>b.length?b.ended?b.length:(b.needReadable=!0,0):a)}function j(a,b){var c=null;return B.isBuffer(b)||B.isString(b)||B.isNullOrUndefined(b)||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function k(a,b){if(b.decoder&&!b.ended){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,l(a)}function l(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(D("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?c.nextTick(function(){m(a)}):m(a))}function m(a){D("emit readable"),a.emit("readable"),s(a)}function n(a,b){b.readingMore||(b.readingMore=!0,c.nextTick(function(){o(a,b)}))}function o(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(D("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function p(a){return function(){var b=a._readableState;D("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&z.listenerCount(a,"data")&&(b.flowing=!0,s(a))}}function q(a,b){b.resumeScheduled||(b.resumeScheduled=!0,c.nextTick(function(){r(a,b)}))}function r(a,b){b.resumeScheduled=!1,a.emit("resume"),s(a),b.flowing&&!b.reading&&a.read(0)}function s(a){var b=a._readableState;if(D("flow",b.flowing),b.flowing)do var c=a.read();while(null!==c&&b.flowing)}function t(a,b){var c,d=b.buffer,e=b.length,f=!!b.decoder,g=!!b.objectMode;if(0===d.length)return null;if(0===e)c=null;else if(g)c=d.shift();else if(!a||a>=e)c=f?d.join(""):y.concat(d,e),d.length=0;else if(a<d[0].length){var h=d[0];c=h.slice(0,a),d[0]=h.slice(a)}else if(a===d[0].length)c=d.shift();else{c=f?"":new y(a);for(var i=0,j=0,k=d.length;k>j&&a>i;j++){var h=d[0],l=Math.min(a-i,h.length);f?c+=h.slice(0,l):h.copy(c,i,0,l),l<h.length?d[0]=h.slice(l):d.shift(),i+=l}}return c}function u(a){var b=a._readableState;if(b.length>0)throw new Error("endReadable called on non-empty stream");b.endEmitted||(b.ended=!0,c.nextTick(function(){b.endEmitted||0!==b.length||(b.endEmitted=!0,a.readable=!1,a.emit("end"))}))}function v(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function w(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}b.exports=e;var x=a("isarray"),y=a("buffer").Buffer;e.ReadableState=d;var z=a("events").EventEmitter;z.listenerCount||(z.listenerCount=function(a,b){return a.listeners(b).length});var A=a("stream"),B=a("core-util-is");B.inherits=a("inherits");var C,D=a("util");D=D&&D.debuglog?D.debuglog("stream"):function(){},B.inherits(e,A),e.prototype.push=function(a,b){var c=this._readableState;return B.isString(a)&&!c.objectMode&&(b=b||c.defaultEncoding,b!==c.encoding&&(a=new y(a,b),b="")),f(this,c,a,b,!1)},e.prototype.unshift=function(a){var b=this._readableState;return f(this,b,a,"",!0)},e.prototype.setEncoding=function(b){return C||(C=a("string_decoder/").StringDecoder),this._readableState.decoder=new C(b),this._readableState.encoding=b,this};var E=8388608;e.prototype.read=function(a){D("read",a);var b=this._readableState,c=a;if((!B.isNumber(a)||a>0)&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return D("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?u(this):l(this),null;if(a=i(a,b),0===a&&b.ended)return 0===b.length&&u(this),null;var d=b.needReadable;D("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,D("length less than watermark",d)),(b.ended||b.reading)&&(d=!1,D("reading or ended",d)),d&&(D("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1),d&&!b.reading&&(a=i(c,b));var e;return e=a>0?t(a,b):null,B.isNull(e)&&(b.needReadable=!0,a=0),b.length-=a,0!==b.length||b.ended||(b.needReadable=!0),c!==a&&b.ended&&0===b.length&&u(this),B.isNull(e)||this.emit("data",e),e},e.prototype._read=function(){this.emit("error",new Error("not implemented"))},e.prototype.pipe=function(a,b){function d(a){D("onunpipe"),a===l&&f()}function e(){D("onend"),a.end()}function f(){D("cleanup"),a.removeListener("close",i),a.removeListener("finish",j),a.removeListener("drain",q),a.removeListener("error",h),a.removeListener("unpipe",d),l.removeListener("end",e),l.removeListener("end",f),l.removeListener("data",g),!m.awaitDrain||a._writableState&&!a._writableState.needDrain||q()}function g(b){D("ondata");var c=a.write(b);!1===c&&(D("false write response, pause",l._readableState.awaitDrain),l._readableState.awaitDrain++,l.pause())}function h(b){D("onerror",b),k(),a.removeListener("error",h),0===z.listenerCount(a,"error")&&a.emit("error",b)}function i(){a.removeListener("finish",j),k()}function j(){D("onfinish"),a.removeListener("close",i),k()}function k(){D("unpipe"),l.unpipe(a)}var l=this,m=this._readableState;switch(m.pipesCount){case 0:m.pipes=a;break;case 1:m.pipes=[m.pipes,a];break;default:m.pipes.push(a)}m.pipesCount+=1,D("pipe count=%d opts=%j",m.pipesCount,b);var n=(!b||b.end!==!1)&&a!==c.stdout&&a!==c.stderr,o=n?e:f;m.endEmitted?c.nextTick(o):l.once("end",o),a.on("unpipe",d);var q=p(l);return a.on("drain",q),l.on("data",g),a._events&&a._events.error?x(a._events.error)?a._events.error.unshift(h):a._events.error=[h,a._events.error]:a.on("error",h),a.once("close",i),a.once("finish",j),a.emit("pipe",l),m.flowing||(D("pipe resume"),l.resume()),a},e.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var e=0;d>e;e++)c[e].emit("unpipe",this);return this}var e=w(b.pipes,a);return-1===e?this:(b.pipes.splice(e,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},e.prototype.on=function(a,b){var d=A.prototype.on.call(this,a,b);if("data"===a&&!1!==this._readableState.flowing&&this.resume(),"readable"===a&&this.readable){var e=this._readableState;if(!e.readableListening)if(e.readableListening=!0,e.emittedReadable=!1,e.needReadable=!0,e.reading)e.length&&l(this,e);else{var f=this;c.nextTick(function(){D("readable nexttick read 0"),f.read(0)})}}return d},e.prototype.addListener=e.prototype.on,e.prototype.resume=function(){var a=this._readableState;return a.flowing||(D("resume"),a.flowing=!0,a.reading||(D("resume read 0"),this.read(0)),q(this,a)),this},e.prototype.pause=function(){return D("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(D("pause"),this._readableState.flowing=!1,this.emit("pause")),this},e.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(D("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(D("wrapped data"),b.decoder&&(e=b.decoder.write(e)),e&&(b.objectMode||e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)B.isFunction(a[e])&&B.isUndefined(this[e])&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));var f=["error","close","destroy","pause","resume"];return v(f,function(b){a.on(b,d.emit.bind(d,b))}),d._read=function(b){D("wrapped _read",b),c&&(c=!1,a.resume())},d},e._fromList=t}).call(this,a("_process"))},{"./_stream_duplex":13,_process:11,buffer:3,"core-util-is":5,events:6,inherits:8,isarray:10,stream:22,"string_decoder/":23,util:2}],16:[function(a,b){function c(a,b){this.afterTransform=function(a,c){return d(b,a,c)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function d(a,b,c){var d=a._transformState;d.transforming=!1;var e=d.writecb;if(!e)return a.emit("error",new Error("no writecb in Transform class"));d.writechunk=null,d.writecb=null,h.isNullOrUndefined(c)||a.push(c),e&&e(b);var f=a._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&a._read(f.highWaterMark)}function e(a){if(!(this instanceof e))return new e(a);g.call(this,a),this._transformState=new c(a,this);var b=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",function(){h.isFunction(this._flush)?this._flush(function(a){f(b,a)}):f(b)})}function f(a,b){if(b)return a.emit("error",b);var c=a._writableState,d=a._transformState;if(c.length)throw new Error("calling transform done when ws.length != 0");if(d.transforming)throw new Error("calling transform done when still transforming");return a.push(null)}b.exports=e;var g=a("./_stream_duplex"),h=a("core-util-is");h.inherits=a("inherits"),h.inherits(e,g),e.prototype.push=function(a,b){return this._transformState.needTransform=!1,g.prototype.push.call(this,a,b)},e.prototype._transform=function(){throw new Error("not implemented")},e.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},e.prototype._read=function(){var a=this._transformState;h.isNull(a.writechunk)||!a.writecb||a.transforming?a.needTransform=!0:(a.transforming=!0,this._transform(a.writechunk,a.writeencoding,a.afterTransform))}},{"./_stream_duplex":13,"core-util-is":5,inherits:8}],17:[function(a,b){(function(c){function d(a,b,c){this.chunk=a,this.encoding=b,this.callback=c}function e(b,c){var d=a("./_stream_duplex");b=b||{};var e=b.highWaterMark,f=b.objectMode?16:16384;this.highWaterMark=e||0===e?e:f,this.objectMode=!!b.objectMode,c instanceof d&&(this.objectMode=this.objectMode||!!b.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var g=b.decodeStrings===!1;this.decodeStrings=!g,this.defaultEncoding=b.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){n(c,a)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function f(b){var c=a("./_stream_duplex");return this instanceof f||this instanceof c?(this._writableState=new e(b,this),this.writable=!0,void x.call(this)):new f(b)}function g(a,b,d){var e=new Error("write after end");a.emit("error",e),c.nextTick(function(){d(e)})}function h(a,b,d,e){var f=!0;if(!(w.isBuffer(d)||w.isString(d)||w.isNullOrUndefined(d)||b.objectMode)){var g=new TypeError("Invalid non-string/buffer chunk");a.emit("error",g),c.nextTick(function(){e(g)}),f=!1}return f}function i(a,b,c){return!a.objectMode&&a.decodeStrings!==!1&&w.isString(b)&&(b=new v(b,c)),b}function j(a,b,c,e,f){c=i(b,c,e),w.isBuffer(c)&&(e="buffer");var g=b.objectMode?1:c.length;b.length+=g;var h=b.length<b.highWaterMark;return h||(b.needDrain=!0),b.writing||b.corked?b.buffer.push(new d(c,e,f)):k(a,b,!1,g,c,e,f),h}function k(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function l(a,b,d,e,f){d?c.nextTick(function(){b.pendingcb--,f(e)}):(b.pendingcb--,f(e)),a._writableState.errorEmitted=!0,a.emit("error",e)}function m(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function n(a,b){var d=a._writableState,e=d.sync,f=d.writecb;if(m(d),b)l(a,d,e,b,f);else{var g=r(a,d);g||d.corked||d.bufferProcessing||!d.buffer.length||q(a,d),e?c.nextTick(function(){o(a,d,g,f)}):o(a,d,g,f)}}function o(a,b,c,d){c||p(a,b),b.pendingcb--,d(),t(a,b)}function p(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function q(a,b){if(b.bufferProcessing=!0,a._writev&&b.buffer.length>1){for(var c=[],d=0;d<b.buffer.length;d++)c.push(b.buffer[d].callback);b.pendingcb++,k(a,b,!0,b.length,b.buffer,"",function(a){for(var d=0;d<c.length;d++)b.pendingcb--,c[d](a)}),b.buffer=[]}else{for(var d=0;d<b.buffer.length;d++){var e=b.buffer[d],f=e.chunk,g=e.encoding,h=e.callback,i=b.objectMode?1:f.length;if(k(a,b,!1,i,f,g,h),b.writing){d++;break}}d<b.buffer.length?b.buffer=b.buffer.slice(d):b.buffer.length=0}b.bufferProcessing=!1}function r(a,b){return b.ending&&0===b.length&&!b.finished&&!b.writing}function s(a,b){b.prefinished||(b.prefinished=!0,a.emit("prefinish"))}function t(a,b){var c=r(a,b);return c&&(0===b.pendingcb?(s(a,b),b.finished=!0,a.emit("finish")):s(a,b)),c}function u(a,b,d){b.ending=!0,t(a,b),d&&(b.finished?c.nextTick(d):a.once("finish",d)),b.ended=!0}b.exports=f;var v=a("buffer").Buffer;f.WritableState=e;var w=a("core-util-is");w.inherits=a("inherits");var x=a("stream");w.inherits(f,x),f.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},f.prototype.write=function(a,b,c){var d=this._writableState,e=!1;return w.isFunction(b)&&(c=b,b=null),w.isBuffer(a)?b="buffer":b||(b=d.defaultEncoding),w.isFunction(c)||(c=function(){}),d.ended?g(this,d,c):h(this,d,a,c)&&(d.pendingcb++,e=j(this,d,a,b,c)),e},f.prototype.cork=function(){var a=this._writableState;a.corked++},f.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.buffer.length||q(this,a))},f.prototype._write=function(a,b,c){c(new Error("not implemented"))},f.prototype._writev=null,f.prototype.end=function(a,b,c){var d=this._writableState;w.isFunction(a)?(c=a,a=null,b=null):w.isFunction(b)&&(c=b,b=null),w.isNullOrUndefined(a)||this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||u(this,d,c)}}).call(this,a("_process"))},{"./_stream_duplex":13,_process:11,buffer:3,"core-util-is":5,inherits:8,stream:22}],18:[function(a,b){b.exports=a("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":14}],19:[function(a,b,c){(function(d){c=b.exports=a("./lib/_stream_readable.js"),c.Stream=a("stream"),c.Readable=c,c.Writable=a("./lib/_stream_writable.js"),c.Duplex=a("./lib/_stream_duplex.js"),c.Transform=a("./lib/_stream_transform.js"),c.PassThrough=a("./lib/_stream_passthrough.js"),d.browser||"disable"!==d.env.READABLE_STREAM||(b.exports=a("stream"))}).call(this,a("_process"))},{"./lib/_stream_duplex.js":13,"./lib/_stream_passthrough.js":14,"./lib/_stream_readable.js":15,"./lib/_stream_transform.js":16,"./lib/_stream_writable.js":17,_process:11,stream:22}],20:[function(a,b){b.exports=a("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":16}],21:[function(a,b){b.exports=a("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":17}],22:[function(a,b){function c(){d.call(this)}b.exports=c;var d=a("events").EventEmitter,e=a("inherits");e(c,d),c.Readable=a("readable-stream/readable.js"),c.Writable=a("readable-stream/writable.js"),c.Duplex=a("readable-stream/duplex.js"),c.Transform=a("readable-stream/transform.js"),c.PassThrough=a("readable-stream/passthrough.js"),c.Stream=c,c.prototype.pipe=function(a,b){function c(b){a.writable&&!1===a.write(b)&&j.pause&&j.pause()}function e(){j.readable&&j.resume&&j.resume()}function f(){k||(k=!0,a.end())}function g(){k||(k=!0,"function"==typeof a.destroy&&a.destroy())}function h(a){if(i(),0===d.listenerCount(this,"error"))throw a}function i(){j.removeListener("data",c),a.removeListener("drain",e),j.removeListener("end",f),j.removeListener("close",g),j.removeListener("error",h),a.removeListener("error",h),j.removeListener("end",i),j.removeListener("close",i),a.removeListener("close",i)}var j=this;j.on("data",c),a.on("drain",e),a._isStdio||b&&b.end===!1||(j.on("end",f),j.on("close",g));var k=!1;return j.on("error",h),a.on("error",h),j.on("end",i),j.on("close",i),a.on("close",i),a.emit("pipe",j),a}},{events:6,inherits:8,"readable-stream/duplex.js":12,"readable-stream/passthrough.js":18,"readable-stream/readable.js":19,"readable-stream/transform.js":20,"readable-stream/writable.js":21}],23:[function(a,b,c){function d(a){if(a&&!i(a))throw new Error("Unknown encoding: "+a)}function e(a){return a.toString(this.encoding)}function f(a){this.charReceived=a.length%2,this.charLength=this.charReceived?2:0}function g(a){this.charReceived=a.length%3,this.charLength=this.charReceived?3:0}var h=a("buffer").Buffer,i=h.isEncoding||function(a){switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},j=c.StringDecoder=function(a){switch(this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,""),d(a),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=f;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=g;break;default:return void(this.write=e)}this.charBuffer=new h(6),this.charReceived=0,this.charLength=0};j.prototype.write=function(a){for(var b="";this.charLength;){var c=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;if(a.copy(this.charBuffer,this.charReceived,0,c),this.charReceived+=c,this.charReceived<this.charLength)return"";a=a.slice(c,a.length),b=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var d=b.charCodeAt(b.length-1);if(!(d>=55296&&56319>=d)){if(this.charReceived=this.charLength=0,0===a.length)return b;break}this.charLength+=this.surrogateSize,b=""}this.detectIncompleteChar(a);var e=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,e),e-=this.charReceived),b+=a.toString(this.encoding,0,e);var e=b.length-1,d=b.charCodeAt(e);if(d>=55296&&56319>=d){var f=this.surrogateSize;return this.charLength+=f,this.charReceived+=f,this.charBuffer.copy(this.charBuffer,f,0,f),a.copy(this.charBuffer,0,0,f),b.substring(0,e)}return b},j.prototype.detectIncompleteChar=function(a){for(var b=a.length>=3?3:a.length;b>0;b--){var c=a[a.length-b];if(1==b&&c>>5==6){this.charLength=2;break}if(2>=b&&c>>4==14){this.charLength=3;break}if(3>=b&&c>>3==30){this.charLength=4;break}}this.charReceived=b},j.prototype.end=function(a){var b="";if(a&&a.length&&(b=this.write(a)),this.charReceived){var c=this.charReceived,d=this.charBuffer,e=this.encoding;b+=d.slice(0,c).toString(e)}return b}},{buffer:3}],24:[function(a,b,c){function d(a,b){this._id=a,this._clearFn=b}var e=a("process/browser.js").nextTick,f=Function.prototype.apply,g=Array.prototype.slice,h={},i=0;c.setTimeout=function(){return new d(f.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new d(f.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(a){a.close()},d.prototype.unref=d.prototype.ref=function(){},d.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(a,b){clearTimeout(a._idleTimeoutId),a._idleTimeout=b},c.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},c._unrefActive=c.active=function(a){clearTimeout(a._idleTimeoutId);var b=a._idleTimeout;b>=0&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},b))},c.setImmediate="function"==typeof setImmediate?setImmediate:function(a){var b=i++,d=arguments.length<2?!1:g.call(arguments,1);return h[b]=!0,e(function(){h[b]&&(d?a.apply(null,d):a.call(null),c.clearImmediate(b))}),b},c.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(a){delete h[a]}},{"process/browser.js":25}],25:[function(a,b){function c(a){if(i===setTimeout)return setTimeout(a,0);try{return i(a,0)}catch(b){try{return i.call(null,a,0)}catch(b){return i.call(this,a,0)}}}function d(a){if(j===clearTimeout)return clearTimeout(a);try{return j(a)}catch(b){try{return j.call(null,a)}catch(b){return j.call(this,a)}}}function e(){n&&l&&(n=!1,l.length?m=l.concat(m):o=-1,m.length&&f())}function f(){if(!n){var a=c(e);n=!0;for(var b=m.length;b;){for(l=m,m=[];++o<b;)l&&l[o].run();o=-1,b=m.length}l=null,n=!1,d(a)}}function g(a,b){this.fun=a,this.array=b}function h(){}var i,j,k=b.exports={};!function(){try{i=setTimeout}catch(a){i=function(){throw new Error("setTimeout is not defined")}}try{j=clearTimeout}catch(a){j=function(){throw new Error("clearTimeout is not defined")}}}();var l,m=[],n=!1,o=-1;k.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var d=1;d<arguments.length;d++)b[d-1]=arguments[d];m.push(new g(a,b)),1!==m.length||n||c(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},k.title="browser",k.browser=!0,k.env={},k.argv=[],k.version="",k.versions={},k.on=h,k.addListener=h,k.once=h,k.off=h,k.removeListener=h,k.removeAllListeners=h,k.emit=h,k.binding=function(){throw new Error("process.binding is not supported")},k.cwd=function(){return"/"},k.chdir=function(){throw new Error("process.chdir is not supported")},k.umask=function(){return 0}},{}],26:[function(a,b){var c=a("../internal/getNative"),d=c(Date,"now"),e=d||function(){return(new Date).getTime()};b.exports=e},{"../internal/getNative":42}],27:[function(a,b){function c(a,b,c){function h(){r&&clearTimeout(r),n&&clearTimeout(n),t=0,n=r=s=void 0}function i(b,c){c&&clearTimeout(c),n=r=s=void 0,b&&(t=e(),o=a.apply(q,m),r||n||(m=q=void 0))}function j(){var a=b-(e()-p);0>=a||a>b?i(s,n):r=setTimeout(j,a)}function k(){i(v,r)}function l(){if(m=arguments,p=e(),q=this,s=v&&(r||!w),u===!1)var c=w&&!r;else{n||w||(t=p);var d=u-(p-t),f=0>=d||d>u;f?(n&&(n=clearTimeout(n)),t=p,o=a.apply(q,m)):n||(n=setTimeout(k,d))}return f&&r?r=clearTimeout(r):r||b===u||(r=setTimeout(j,b)),c&&(f=!0,o=a.apply(q,m)),!f||r||n||(m=q=void 0),o}var m,n,o,p,q,r,s,t=0,u=!1,v=!0;if("function"!=typeof a)throw new TypeError(f);if(b=0>b?0:+b||0,c===!0){var w=!0;v=!1}else d(c)&&(w=!!c.leading,u="maxWait"in c&&g(+c.maxWait||0,b),v="trailing"in c?!!c.trailing:v);return l.cancel=h,l}var d=a("../lang/isObject"),e=a("../date/now"),f="Expected a function",g=Math.max;b.exports=c},{"../date/now":26,"../lang/isObject":55}],28:[function(a,b){function c(a,b){if("function"!=typeof a)throw new TypeError(d);return b=e(void 0===b?a.length-1:+b||0,0),function(){for(var c=arguments,d=-1,f=e(c.length-b,0),g=Array(f);++d<f;)g[d]=c[b+d];switch(b){case 0:return a.call(this,g);case 1:return a.call(this,c[0],g);case 2:return a.call(this,c[0],c[1],g)}var h=Array(b+1);for(d=-1;++d<b;)h[d]=c[d];return h[b]=g,a.apply(this,h)}}var d="Expected a function",e=Math.max;b.exports=c},{}],29:[function(a,b){function c(a,b,c){var g=!0,h=!0;if("function"!=typeof a)throw new TypeError(f);return c===!1?g=!1:e(c)&&(g="leading"in c?!!c.leading:g,h="trailing"in c?!!c.trailing:h),d(a,b,{leading:g,maxWait:+b,trailing:h})}var d=a("./debounce"),e=a("../lang/isObject"),f="Expected a function";b.exports=c},{"../lang/isObject":55,"./debounce":27}],30:[function(a,b){function c(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b}b.exports=c},{}],31:[function(a,b){function c(a,b){for(var c=-1,d=a.length;++c<d&&b(a[c],c,a)!==!1;);return a}b.exports=c},{}],32:[function(a,b){function c(a,b,c){c||(c={});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}b.exports=c},{}],33:[function(a,b){var c=a("./createBaseFor"),d=c();b.exports=d},{"./createBaseFor":40}],34:[function(a,b){function c(a,b){return d(a,b,e)}var d=a("./baseFor"),e=a("../object/keysIn");b.exports=c},{"../object/keysIn":61,"./baseFor":33}],35:[function(a,b){function c(a,b,l,m,n){if(!h(a))return a;var o=g(b)&&(f(b)||j(b)),p=o?void 0:k(b);return d(p||b,function(d,f){if(p&&(f=d,d=b[f]),i(d))m||(m=[]),n||(n=[]),e(a,b,f,c,l,m,n);else{var g=a[f],h=l?l(g,d,f,a,b):void 0,j=void 0===h;j&&(h=d),void 0===h&&(!o||f in a)||!j&&(h===h?h===g:g!==g)||(a[f]=h)}}),a}var d=a("./arrayEach"),e=a("./baseMergeDeep"),f=a("../lang/isArray"),g=a("./isArrayLike"),h=a("../lang/isObject"),i=a("./isObjectLike"),j=a("../lang/isTypedArray"),k=a("../object/keys");b.exports=c},{"../lang/isArray":52,"../lang/isObject":55,"../lang/isTypedArray":58,"../object/keys":60,"./arrayEach":31,"./baseMergeDeep":36,"./isArrayLike":43,"./isObjectLike":48}],36:[function(a,b){function c(a,b,c,k,l,m,n){for(var o=m.length,p=b[c];o--;)if(m[o]==p)return void(a[c]=n[o]);var q=a[c],r=l?l(q,p,c,a,b):void 0,s=void 0===r;s&&(r=p,g(p)&&(f(p)||i(p))?r=f(q)?q:g(q)?d(q):[]:h(p)||e(p)?r=e(q)?j(q):h(q)?q:{}:s=!1),m.push(p),n.push(r),s?a[c]=k(r,p,l,m,n):(r===r?r!==q:q===q)&&(a[c]=r)}var d=a("./arrayCopy"),e=a("../lang/isArguments"),f=a("../lang/isArray"),g=a("./isArrayLike"),h=a("../lang/isPlainObject"),i=a("../lang/isTypedArray"),j=a("../lang/toPlainObject");b.exports=c},{"../lang/isArguments":51,"../lang/isArray":52,"../lang/isPlainObject":56,"../lang/isTypedArray":58,"../lang/toPlainObject":59,"./arrayCopy":30,"./isArrayLike":43}],37:[function(a,b){function c(a){return function(b){return null==b?void 0:d(b)[a]}}var d=a("./toObject");b.exports=c},{"./toObject":50}],38:[function(a,b){function c(a,b,c){if("function"!=typeof a)return d;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}var d=a("../utility/identity");b.exports=c},{"../utility/identity":64}],39:[function(a,b){function c(a){return f(function(b,c){var f=-1,g=null==b?0:c.length,h=g>2?c[g-2]:void 0,i=g>2?c[2]:void 0,j=g>1?c[g-1]:void 0;for("function"==typeof h?(h=d(h,j,5),g-=2):(h="function"==typeof j?j:void 0,g-=h?1:0),i&&e(c[0],c[1],i)&&(h=3>g?void 0:h,g=1);++f<g;){var k=c[f];k&&a(b,k,h)}return b})}var d=a("./bindCallback"),e=a("./isIterateeCall"),f=a("../function/restParam");b.exports=c},{"../function/restParam":28,"./bindCallback":38,"./isIterateeCall":46}],40:[function(a,b){function c(a){return function(b,c,e){for(var f=d(b),g=e(b),h=g.length,i=a?h:-1;a?i--:++i<h;){var j=g[i];if(c(f[j],j,f)===!1)break}return b}}var d=a("./toObject");b.exports=c},{"./toObject":50}],41:[function(a,b){var c=a("./baseProperty"),d=c("length");b.exports=d},{"./baseProperty":37}],42:[function(a,b){function c(a,b){var c=null==a?void 0:a[b];return d(c)?c:void 0}var d=a("../lang/isNative");b.exports=c},{"../lang/isNative":54}],43:[function(a,b){function c(a){return null!=a&&e(d(a))}var d=a("./getLength"),e=a("./isLength");b.exports=c},{"./getLength":41,"./isLength":47}],44:[function(a,b){var c=function(){try{Object({toString:0}+"")}catch(a){return function(){return!1}}return function(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}}();b.exports=c},{}],45:[function(a,b){function c(a,b){return a="number"==typeof a||d.test(a)?+a:-1,b=null==b?e:b,a>-1&&a%1==0&&b>a}var d=/^\d+$/,e=9007199254740991;b.exports=c},{}],46:[function(a,b){function c(a,b,c){if(!f(c))return!1;var g=typeof b;if("number"==g?d(c)&&e(b,c.length):"string"==g&&b in c){var h=c[b];return a===a?a===h:h!==h}return!1}var d=a("./isArrayLike"),e=a("./isIndex"),f=a("../lang/isObject");b.exports=c},{"../lang/isObject":55,"./isArrayLike":43,"./isIndex":45}],47:[function(a,b){function c(a){return"number"==typeof a&&a>-1&&a%1==0&&d>=a}var d=9007199254740991;b.exports=c},{}],48:[function(a,b){function c(a){return!!a&&"object"==typeof a}b.exports=c},{}],49:[function(a,b){function c(a){for(var b=i(a),c=b.length,j=c&&a.length,l=!!j&&g(j)&&(e(a)||d(a)||h(a)),m=-1,n=[];++m<c;){var o=b[m];(l&&f(o,j)||k.call(a,o))&&n.push(o)}return n}var d=a("../lang/isArguments"),e=a("../lang/isArray"),f=a("./isIndex"),g=a("./isLength"),h=a("../lang/isString"),i=a("../object/keysIn"),j=Object.prototype,k=j.hasOwnProperty;b.exports=c},{"../lang/isArguments":51,"../lang/isArray":52,"../lang/isString":57,"../object/keysIn":61,"./isIndex":45,"./isLength":47}],50:[function(a,b){function c(a){if(f.unindexedChars&&e(a)){for(var b=-1,c=a.length,g=Object(a);++b<c;)g[b]=a.charAt(b);return g}return d(a)?a:Object(a)}var d=a("../lang/isObject"),e=a("../lang/isString"),f=a("../support");b.exports=c},{"../lang/isObject":55,"../lang/isString":57,"../support":63}],51:[function(a,b){function c(a){return e(a)&&d(a)&&g.call(a,"callee")&&!h.call(a,"callee")}var d=a("../internal/isArrayLike"),e=a("../internal/isObjectLike"),f=Object.prototype,g=f.hasOwnProperty,h=f.propertyIsEnumerable;b.exports=c},{"../internal/isArrayLike":43,"../internal/isObjectLike":48}],52:[function(a,b){var c=a("../internal/getNative"),d=a("../internal/isLength"),e=a("../internal/isObjectLike"),f="[object Array]",g=Object.prototype,h=g.toString,i=c(Array,"isArray"),j=i||function(a){return e(a)&&d(a.length)&&h.call(a)==f;

};b.exports=j},{"../internal/getNative":42,"../internal/isLength":47,"../internal/isObjectLike":48}],53:[function(a,b){function c(a){return d(a)&&g.call(a)==e}var d=a("./isObject"),e="[object Function]",f=Object.prototype,g=f.toString;b.exports=c},{"./isObject":55}],54:[function(a,b){function c(a){return null==a?!1:d(a)?k.test(i.call(a)):f(a)&&(e(a)?k:g).test(a)}var d=a("./isFunction"),e=a("../internal/isHostObject"),f=a("../internal/isObjectLike"),g=/^\[object .+?Constructor\]$/,h=Object.prototype,i=Function.prototype.toString,j=h.hasOwnProperty,k=RegExp("^"+i.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=c},{"../internal/isHostObject":44,"../internal/isObjectLike":48,"./isFunction":53}],55:[function(a,b){function c(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}b.exports=c},{}],56:[function(a,b){function c(a){var b;if(!g(a)||l.call(a)!=i||f(a)||e(a)||!k.call(a,"constructor")&&(b=a.constructor,"function"==typeof b&&!(b instanceof b)))return!1;var c;return h.ownLast?(d(a,function(a,b,d){return c=k.call(d,b),!1}),c!==!1):(d(a,function(a,b){c=b}),void 0===c||k.call(a,c))}var d=a("../internal/baseForIn"),e=a("./isArguments"),f=a("../internal/isHostObject"),g=a("../internal/isObjectLike"),h=a("../support"),i="[object Object]",j=Object.prototype,k=j.hasOwnProperty,l=j.toString;b.exports=c},{"../internal/baseForIn":34,"../internal/isHostObject":44,"../internal/isObjectLike":48,"../support":63,"./isArguments":51}],57:[function(a,b){function c(a){return"string"==typeof a||d(a)&&g.call(a)==e}var d=a("../internal/isObjectLike"),e="[object String]",f=Object.prototype,g=f.toString;b.exports=c},{"../internal/isObjectLike":48}],58:[function(a,b){function c(a){return e(a)&&d(a.length)&&!!C[E.call(a)]}var d=a("../internal/isLength"),e=a("../internal/isObjectLike"),f="[object Arguments]",g="[object Array]",h="[object Boolean]",i="[object Date]",j="[object Error]",k="[object Function]",l="[object Map]",m="[object Number]",n="[object Object]",o="[object RegExp]",p="[object Set]",q="[object String]",r="[object WeakMap]",s="[object ArrayBuffer]",t="[object Float32Array]",u="[object Float64Array]",v="[object Int8Array]",w="[object Int16Array]",x="[object Int32Array]",y="[object Uint8Array]",z="[object Uint8ClampedArray]",A="[object Uint16Array]",B="[object Uint32Array]",C={};C[t]=C[u]=C[v]=C[w]=C[x]=C[y]=C[z]=C[A]=C[B]=!0,C[f]=C[g]=C[s]=C[h]=C[i]=C[j]=C[k]=C[l]=C[m]=C[n]=C[o]=C[p]=C[q]=C[r]=!1;var D=Object.prototype,E=D.toString;b.exports=c},{"../internal/isLength":47,"../internal/isObjectLike":48}],59:[function(a,b){function c(a){return d(a,e(a))}var d=a("../internal/baseCopy"),e=a("../object/keysIn");b.exports=c},{"../internal/baseCopy":32,"../object/keysIn":61}],60:[function(a,b){var c=a("../internal/getNative"),d=a("../internal/isArrayLike"),e=a("../lang/isObject"),f=a("../internal/shimKeys"),g=a("../support"),h=c(Object,"keys"),i=h?function(a){var b=null==a?void 0:a.constructor;return"function"==typeof b&&b.prototype===a||("function"==typeof a?g.enumPrototypes:d(a))?f(a):e(a)?h(a):[]}:f;b.exports=i},{"../internal/getNative":42,"../internal/isArrayLike":43,"../internal/shimKeys":49,"../lang/isObject":55,"../support":63}],61:[function(a,b){function c(a){if(null==a)return[];j(a)||(a=Object(a));var b=a.length;b=b&&i(b)&&(f(a)||e(a)||k(a))&&b||0;for(var c=a.constructor,d=-1,m=g(c)&&c.prototype||x,n=m===a,o=Array(b),q=b>0,r=l.enumErrorProps&&(a===w||a instanceof Error),t=l.enumPrototypes&&g(a);++d<b;)o[d]=d+"";for(var C in a)t&&"prototype"==C||r&&("message"==C||"name"==C)||q&&h(C,b)||"constructor"==C&&(n||!z.call(a,C))||o.push(C);if(l.nonEnumShadows&&a!==x){var D=a===y?u:a===w?p:A.call(a),E=B[D]||B[s];for(D==s&&(m=x),b=v.length;b--;){C=v[b];var F=E[C];n&&F||(F?!z.call(a,C):a[C]===m[C])||o.push(C)}}return o}var d=a("../internal/arrayEach"),e=a("../lang/isArguments"),f=a("../lang/isArray"),g=a("../lang/isFunction"),h=a("../internal/isIndex"),i=a("../internal/isLength"),j=a("../lang/isObject"),k=a("../lang/isString"),l=a("../support"),m="[object Array]",n="[object Boolean]",o="[object Date]",p="[object Error]",q="[object Function]",r="[object Number]",s="[object Object]",t="[object RegExp]",u="[object String]",v=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],w=Error.prototype,x=Object.prototype,y=String.prototype,z=x.hasOwnProperty,A=x.toString,B={};B[m]=B[o]=B[r]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},B[n]=B[u]={constructor:!0,toString:!0,valueOf:!0},B[p]=B[q]=B[t]={constructor:!0,toString:!0},B[s]={constructor:!0},d(v,function(a){for(var b in B)if(z.call(B,b)){var c=B[b];c[a]=z.call(c,a)}}),b.exports=c},{"../internal/arrayEach":31,"../internal/isIndex":45,"../internal/isLength":47,"../lang/isArguments":51,"../lang/isArray":52,"../lang/isFunction":53,"../lang/isObject":55,"../lang/isString":57,"../support":63}],62:[function(a,b){var c=a("../internal/baseMerge"),d=a("../internal/createAssigner"),e=d(c);b.exports=e},{"../internal/baseMerge":35,"../internal/createAssigner":39}],63:[function(a,b){var c=Array.prototype,d=Error.prototype,e=Object.prototype,f=e.propertyIsEnumerable,g=c.splice,h={};!function(a){var b=function(){this.x=a},c={0:a,length:a},e=[];b.prototype={valueOf:a,y:a};for(var i in new b)e.push(i);h.enumErrorProps=f.call(d,"message")||f.call(d,"name"),h.enumPrototypes=f.call(b,"prototype"),h.nonEnumShadows=!/valueOf/.test(e),h.ownLast="x"!=e[0],h.spliceObjects=(g.call(c,0,1),!c[0]),h.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1,0),b.exports=h},{}],64:[function(a,b){function c(a){return a}b.exports=c},{}],65:[function(a,b){"use strict";var c=a("object-keys"),d=a("foreach"),e="function"==typeof Symbol&&"symbol"==typeof Symbol(),f=Object.prototype.toString,g=function(a){return"function"==typeof a&&"[object Function]"===f.call(a)},h=function(){var a={};try{Object.defineProperty(a,"x",{enumerable:!1,value:a});for(var b in a)return!1;return a.x===a}catch(c){return!1}},i=Object.defineProperty&&h(),j=function(a,b,c,d){(!(b in a)||g(d)&&d())&&(i?Object.defineProperty(a,b,{configurable:!0,enumerable:!1,value:c,writable:!0}):a[b]=c)},k=function(a,b){var f=arguments.length>2?arguments[2]:{},g=c(b);e&&(g=g.concat(Object.getOwnPropertySymbols(b))),d(g,function(c){j(a,c,b[c],f[c])})};k.supportsDescriptors=!!i,b.exports=k},{foreach:66,"object-keys":69}],66:[function(a,b){var c=Object.prototype.hasOwnProperty,d=Object.prototype.toString;b.exports=function(a,b,e){if("[object Function]"!==d.call(b))throw new TypeError("iterator must be a function");var f=a.length;if(f===+f)for(var g=0;f>g;g++)b.call(e,a[g],g,a);else for(var h in a)c.call(a,h)&&b.call(e,a[h],h,a)}},{}],67:[function(a,b){var c="Function.prototype.bind called on incompatible ",d=Array.prototype.slice,e=Object.prototype.toString,f="[object Function]";b.exports=function(a){var b=this;if("function"!=typeof b||e.call(b)!==f)throw new TypeError(c+b);for(var g,h=d.call(arguments,1),i=function(){if(this instanceof g){var c=b.apply(this,h.concat(d.call(arguments)));return Object(c)===c?c:this}return b.apply(a,h.concat(d.call(arguments)))},j=Math.max(0,b.length-h.length),k=[],l=0;j>l;l++)k.push("$"+l);if(g=Function("binder","return function ("+k.join(",")+"){ return binder.apply(this,arguments); }")(i),b.prototype){var m=function(){};m.prototype=b.prototype,g.prototype=new m,m.prototype=null}return g}},{}],68:[function(a,b){var c=a("./implementation");b.exports=Function.prototype.bind||c},{"./implementation":67}],69:[function(a,b){"use strict";var c=Object.prototype.hasOwnProperty,d=Object.prototype.toString,e=Array.prototype.slice,f=a("./isArguments"),g=Object.prototype.propertyIsEnumerable,h=!g.call({toString:null},"toString"),i=g.call(function(){},"prototype"),j=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],k=function(a){var b=a.constructor;return b&&b.prototype===a},l={$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},m=function(){if("undefined"==typeof window)return!1;for(var a in window)try{if(!l["$"+a]&&c.call(window,a)&&null!==window[a]&&"object"==typeof window[a])try{k(window[a])}catch(b){return!0}}catch(b){return!0}return!1}(),n=function(a){if("undefined"==typeof window||!m)return k(a);try{return k(a)}catch(b){return!1}},o=function(a){var b=null!==a&&"object"==typeof a,e="[object Function]"===d.call(a),g=f(a),k=b&&"[object String]"===d.call(a),l=[];if(!b&&!e&&!g)throw new TypeError("Object.keys called on a non-object");var m=i&&e;if(k&&a.length>0&&!c.call(a,0))for(var o=0;o<a.length;++o)l.push(String(o));if(g&&a.length>0)for(var p=0;p<a.length;++p)l.push(String(p));else for(var q in a)m&&"prototype"===q||!c.call(a,q)||l.push(String(q));if(h)for(var r=n(a),s=0;s<j.length;++s)r&&"constructor"===j[s]||!c.call(a,j[s])||l.push(j[s]);return l};o.shim=function(){if(Object.keys){var a=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!a){var b=Object.keys;Object.keys=function(a){return b(f(a)?e.call(a):a)}}}else Object.keys=o;return Object.keys||o},b.exports=o},{"./isArguments":70}],70:[function(a,b){"use strict";var c=Object.prototype.toString;b.exports=function(a){var b=c.call(a),d="[object Arguments]"===b;return d||(d="[object Array]"!==b&&null!==a&&"object"==typeof a&&"number"==typeof a.length&&a.length>=0&&"[object Function]"===c.call(a.callee)),d}},{}],71:[function(a,b){"use strict";var c=a("object-keys");b.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var a={},b=Symbol("test");if("string"==typeof b)return!1;var d=42;a[b]=d;for(b in a)return!1;if(0!==c(a).length)return!1;if("function"==typeof Object.keys&&0!==Object.keys(a).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(a).length)return!1;var e=Object.getOwnPropertySymbols(a);if(1!==e.length||e[0]!==b)return!1;if(!Object.prototype.propertyIsEnumerable.call(a,b))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var f=Object.getOwnPropertyDescriptor(a,b);if(f.value!==d||f.enumerable!==!0)return!1}return!0}},{"object-keys":69}],72:[function(a,b){"use strict";var c=a("object-keys"),d=a("function-bind"),e=function(a){return"undefined"!=typeof a&&null!==a},f=a("./hasSymbols")(),g=Object,h=d.call(Function.call,Array.prototype.push),i=d.call(Function.call,Object.prototype.propertyIsEnumerable);b.exports=function(a){if(!e(a))throw new TypeError("target must be an object");var b,d,j,k,l,m,n,o=g(a);for(b=1;b<arguments.length;++b){if(d=g(arguments[b]),k=c(d),f&&Object.getOwnPropertySymbols)for(l=Object.getOwnPropertySymbols(d),j=0;j<l.length;++j)n=l[j],i(d,n)&&h(k,n);for(j=0;j<k.length;++j)n=k[j],m=d[n],i(d,n)&&(o[n]=m)}return o}},{"./hasSymbols":71,"function-bind":68,"object-keys":69}],73:[function(a,b){"use strict";var c=a("define-properties"),d=a("./implementation"),e=a("./polyfill"),f=a("./shim");c(d,{implementation:d,getPolyfill:e,shim:f}),b.exports=d},{"./implementation":72,"./polyfill":74,"./shim":75,"define-properties":65}],74:[function(a,b){"use strict";var c=a("./implementation"),d=function(){if(!Object.assign)return!1;for(var a="abcdefghijklmnopqrst",b=a.split(""),c={},d=0;d<b.length;++d)c[b[d]]=b[d];var e=Object.assign({},c),f="";for(var g in e)f+=g;return a!==f},e=function(){if(!Object.assign||!Object.preventExtensions)return!1;var a=Object.preventExtensions({1:2});try{Object.assign(a,"xy")}catch(b){return"y"===a[1]}};b.exports=function(){return Object.assign?d()?c:e()?c:Object.assign:c}},{"./implementation":72}],75:[function(a,b){"use strict";var c=a("define-properties"),d=a("./polyfill");b.exports=function(){var a=d();return c(Object,{assign:a},{assign:function(){return Object.assign!==a}}),a}},{"./polyfill":74,"define-properties":65}],76:[function(a,b){function c(a,b){var c,d=null;try{c=JSON.parse(a,b)}catch(e){d=e}return[d,c]}b.exports=c},{}],77:[function(a,b){function c(a){return a.replace(/\n\r?\s*/g,"")}b.exports=function(a){for(var b="",d=0;d<arguments.length;d++)b+=c(a[d])+(arguments[d+1]||"");return b}},{}],78:[function(a,b){function c(a,b,c){if(!g(b))throw new TypeError("iterator must be a function");arguments.length<3&&(c=this),"[object Array]"===h.call(a)?d(a,b,c):"string"==typeof a?e(a,b,c):f(a,b,c)}function d(a,b,c){for(var d=0,e=a.length;e>d;d++)i.call(a,d)&&b.call(c,a[d],d,a)}function e(a,b,c){for(var d=0,e=a.length;e>d;d++)b.call(c,a.charAt(d),d,a)}function f(a,b,c){for(var d in a)i.call(a,d)&&b.call(c,a[d],d,a)}var g=a("is-function");b.exports=c;var h=Object.prototype.toString,i=Object.prototype.hasOwnProperty},{"is-function":81}],79:[function(a,b){(function(c){var d="undefined"!=typeof c?c:"undefined"!=typeof window?window:{},e=a("min-document");if("undefined"!=typeof document)b.exports=document;else{var f=d["__GLOBAL_DOCUMENT_CACHE@4"];f||(f=d["__GLOBAL_DOCUMENT_CACHE@4"]=e),b.exports=f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"min-document":2}],80:[function(a,b){(function(a){b.exports="undefined"!=typeof window?window:"undefined"!=typeof a?a:"undefined"!=typeof self?self:{}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],81:[function(a,b){function c(a){var b=d.call(a);return"[object Function]"===b||"function"==typeof a&&"[object RegExp]"!==b||"undefined"!=typeof window&&(a===window.setTimeout||a===window.alert||a===window.confirm||a===window.prompt)}b.exports=c;var d=Object.prototype.toString},{}],82:[function(a,b){function c(a){var b=!1;return function(){return b?void 0:(b=!0,a.apply(this,arguments))}}b.exports=c,c.proto=c(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return c(this)},configurable:!0})})},{}],83:[function(a,b){var c=a("trim"),d=a("for-each"),e=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.exports=function(a){if(!a)return{};var b={};return d(c(a).split("\n"),function(a){var d=a.indexOf(":"),f=c(a.slice(0,d)).toLowerCase(),g=c(a.slice(d+1));"undefined"==typeof b[f]?b[f]=g:e(b[f])?b[f].push(g):b[f]=[b[f],g]}),b}},{"for-each":78,trim:84}],84:[function(a,b,c){function d(a){return a.replace(/^\s*|\s*$/g,"")}c=b.exports=d,c.left=function(a){return a.replace(/^\s*/,"")},c.right=function(a){return a.replace(/\s*$/,"")}},{}],85:[function(a,b){"use strict";function c(a,b){for(var c=0;c<a.length;c++)b(a[c])}function d(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function e(a,b,c){var d=a;return k(b)?(c=b,"string"==typeof a&&(d={uri:a})):d=m(b,{uri:a}),d.callback=c,d}function f(a,b,c){return b=e(a,b,c),g(b)}function g(a){function b(){4===k.readyState&&g()}function c(){var a=void 0;if(k.response?a=k.response:"text"!==k.responseType&&k.responseType||(a=k.responseText||k.responseXML),u)try{a=JSON.parse(a)}catch(b){}return a}function e(a){clearTimeout(o),a instanceof Error||(a=new Error(""+(a||"Unknown XMLHttpRequest Error"))),a.statusCode=0,h(a,i)}function g(){if(!n){var b;clearTimeout(o),b=a.useXDR&&void 0===k.status?200:1223===k.status?204:k.status;var d=i,e=null;0!==b?(d={body:c(),statusCode:b,method:q,headers:{},url:p,rawRequest:k},k.getAllResponseHeaders&&(d.headers=l(k.getAllResponseHeaders()))):e=new Error("Internal XMLHttpRequest Error"),h(e,d,d.body)}}var h=a.callback;if("undefined"==typeof h)throw new Error("callback argument missing");h=j(h);var i={body:void 0,headers:{},statusCode:0,method:q,url:p,rawRequest:k},k=a.xhr||null;k||(k=a.cors||a.useXDR?new f.XDomainRequest:new f.XMLHttpRequest);var m,n,o,p=k.url=a.uri||a.url,q=k.method=a.method||"GET",r=a.body||a.data||null,s=k.headers=a.headers||{},t=!!a.sync,u=!1;if("json"in a&&(u=!0,s.accept||s.Accept||(s.Accept="application/json"),"GET"!==q&&"HEAD"!==q&&(s["content-type"]||s["Content-Type"]||(s["Content-Type"]="application/json"),r=JSON.stringify(a.json))),k.onreadystatechange=b,k.onload=g,k.onerror=e,k.onprogress=function(){},k.ontimeout=e,k.open(q,p,!t,a.username,a.password),t||(k.withCredentials=!!a.withCredentials),!t&&a.timeout>0&&(o=setTimeout(function(){n=!0,k.abort("timeout");var a=new Error("XMLHttpRequest timeout");a.code="ETIMEDOUT",e(a)},a.timeout)),k.setRequestHeader)for(m in s)s.hasOwnProperty(m)&&k.setRequestHeader(m,s[m]);else if(a.headers&&!d(a.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in a&&(k.responseType=a.responseType),"beforeSend"in a&&"function"==typeof a.beforeSend&&a.beforeSend(k),k.send(r),k}function h(){}var i=a("global/window"),j=a("once"),k=a("is-function"),l=a("parse-headers"),m=a("xtend");b.exports=f,f.XMLHttpRequest=i.XMLHttpRequest||h,f.XDomainRequest="withCredentials"in new f.XMLHttpRequest?f.XMLHttpRequest:i.XDomainRequest,c(["get","put","post","patch","head","delete"],function(a){f["delete"===a?"del":a]=function(b,c,d){return c=e(b,c,d),c.method=a.toUpperCase(),g(c)}})},{"global/window":80,"is-function":81,once:82,"parse-headers":83,xtend:86}],86:[function(a,b){function c(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b];for(var e in c)d.call(c,e)&&(a[e]=c[e])}return a}b.exports=c;var d=Object.prototype.hasOwnProperty},{}],87:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=a("./lib/iso_boxer.js"),g=d(f),h=a("./cea608DataExtractor.js"),i=d(h),j=a("./textTrackManager.js"),k=d(j),l=a("./cueParser.js"),m=d(l),n=a("../ampDefs.js"),o=function(){function a(b){e(this,a),this.player=b,this.isInitialized=!1,this.onDownloadCompleted=this.onDownloadCompleted.bind(this),this.onDownloadDecrypted=this.onDownloadDecrypted.bind(this),this.onSeeking=this.onSeeking.bind(this),this.onLoadedMetadata=this.onLoadedMetadata.bind(this),this.onReady=this.onReady.bind(this)}return a.prototype.init=function(){this.player.options().cea708CaptionsSettings&&this.player.options().cea708CaptionsSettings.enabled&&(this.parsedSequenceNumbers=[],this.cueParser=new m["default"],this.textTrackManager=new k["default"](this.player),this.player.ready(this.onReady))},a.prototype.onReady=function(){this.player.addEventListener(n.eventName.loadedmetadata,this.onLoadedMetadata),this.player.addEventListener(n.eventName.seeking,this.onSeeking)},a.prototype.onSeeking=function(){this.cueParser.reset()},a.prototype.onLoadedMetadata=function(){this.videoBufferData=this.player.videoBufferData(),this.videoBufferData&&(this.videoBufferData.addEventListener(n.bufferDataEventName.downloadcompleted,this.onDownloadCompleted),this.videoBufferData.addEventListener(n.bufferDataEventName.downloaddecrypted,this.onDownloadDecrypted))},a.prototype.onDownloadDecrypted=function(){var a="flashSS"===this.player.currentTechName()?this.videoBufferData.downloadDecrypted.mediaDownload:this.videoBufferData.downloadDecrypted;this.processMediaDownload(a)},a.prototype.onDownloadCompleted=function(){this.processMediaDownload(this.videoBufferData.downloadCompleted.mediaDownload)},a.prototype.processMediaDownload=function(a){var b=a.data;if(b){this.cueParser.presentationTimeOffsetInSec||(this.cueParser.presentationTimeOffsetInSec=a.presentationTimeOffsetInSec);var c=g["default"].parseBuffer(b),d=c.fetch("mfhd"),e=d?d.sequence_number:null;if(-1===this.parsedSequenceNumbers.indexOf(e)){var f=i["default"].extractCea608Data(b,c,a.mediaTime);f&&f.fields&&f.fields[0].length&&(this.isInitialized||(this.isInitialized=!0,this.initializeTextTrack(),this.cueParser.initialize(this.player,this.textTrackManager.getAllTracks()),this.player.trigger(n.eventName.embeddedcaptionsfound)),this.cueParser.addCcDataToFieldParsers(f,c,a.timeScale),this.parsedSequenceNumbers.push(e))}}},a.prototype.initializeTextTrack=function(){var a={justification:"center"};this.player.textTrackSettings.setValues(a);var b=this.player.options().cea708CaptionsSettings,c={label:b.label||"CEA708",lang:b.srclang,channel:"CC1"};this.textTrackManager.addTextTrack(c.label,c.lang,c.channel)},a.prototype.dispose=function(){this.player.removeEventListener(n.eventName.loadedmetadata,this.onLoadedMetadata),this.player.removeEventListener(n.eventName.seeking,this.onSeeking),this.videoBufferData&&(this.videoBufferData.removeEventListener(n.bufferDataEventName.downloadcompleted,this.onDownloadCompleted),this.videoBufferData.removeEventListener(n.bufferDataEventName.downloaddecrypted,this.onDownloadDecrypted)),this.textTrackManager&&(this.textTrackManager.removePreviousEmbeddedTextTracks(),this.textTrackManager=null),this.cueParser=null,this.isInitialized=!1},a}();c["default"]=o,b.exports=c["default"]},{"../ampDefs.js":97,"./cea608DataExtractor.js":88,"./cueParser.js":89,"./lib/iso_boxer.js":92,"./textTrackManager.js":95}],88:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b,c){var d=b.fetch("moof"),e=b.fetch("tfdt"),g=b.fetchAll("trun"),i=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=new DataView(a),p=new j["default"],q=0;if(!g.length)return null;i=g[0],k=d._offset+i.data_offset,l=i.sample_count,m=k,n=e?e.baseMediaDecodeTime:10*c;for(var r=0;l>r;r++){for(var s=i.samples[r],t=n+q+s.sample_composition_time_offset,u=h["default"].findCea608Nalus(o,m,s.sample_size),v=0;v<u.length;v++)for(var w=h["default"].extractCea608DataFromRange(o,u[v]),x=0;2>x;x++)w[x].length>0&&f(p.fields[x],t,w[x]);q+=s.sample_duration,m+=s.sample_size}return p.startTime=n,p.endTime=n+q,p}function f(a,b,c){var d=a.length;if(d>0)if(b>=a[d-1][0])a.push([b,c]);else{for(var e=-1,f=d-1;f>=0&&!(b>a[f][0]);f--)e=f;e>=0&&a.splice(e,0,[b,c])}else a.push([b,c])}c.__esModule=!0;var g=a("./lib/cea608-parser.js"),h=d(g),i=a("./models/ccData.js"),j=d(i),k={extractCea608Data:e};c["default"]=k,b.exports=c["default"]},{"./lib/cea608-parser.js":90,"./models/ccData.js":94}],89:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=a("stream"),g=d(f),h=a("global/window"),i=d(h),j=a("./lib/cea608-parser.js"),k=d(j),l=a("./lib/cea608-towebvtt.js"),m=d(l),n=a("./models/captionsBuffer.js"),o=d(n),p=function(){function a(){e(this,a),this.videoTimeScale=0,this.embeddedCea608FieldParsers=[],this.presentationTimeOffsetInSec=0,this.cueParser=new i["default"].WebVTT.Parser(i["default"],i["default"].vttjs,i["default"].WebVTT.StringDecoder()),this.cueParser.onparsingerror=function(a){return AMP.Logger.error(AMP.Logger.Area.cea608Module,"CEA608 module: an error happened: "+a)}}return a.prototype.reset=function(){this.embeddedCea608FieldParsers.forEach(function(a){return a.reset()})},a.prototype.addCcDataToFieldParsers=function(a,b,c){function d(a){var b=a.fetch("mdhd"),d=1e7;return b?b.timescale:c?c:d}if(a){this.videoTimeScale=this.videoTimeScale||d(b);for(var e=0;e<this.embeddedCea608FieldParsers.length;e++){var f=a.fields[e],g=this.embeddedCea608FieldParsers[e];if(g){for(var h=0;h<f.length;h++)g.addData(f[h][0]/this.videoTimeScale,f[h][1]);a.endTime&&g.cueSplitAtTime(a.endTime/this.videoTimeScale)}}}},a.prototype.initialize=function(a,b){function c(a){switch(a.toLowerCase()){case"cc1":return 1;case"cc3":return 2}return AMP.Logger.error(AMP.Logger.Area.cea608Module,"Channel '"+a+"' is not supported. Supported channels are CC1 and CC3."),null}function d(a,b,c){return function(d,e,g){function h(b){if(b.startTime!==b.endTime){var c=!0;a.cues.cues_.forEach(function(a){a.text===b.text&&a.startTime===b.startTime&&(c=!1)}),c&&a.addCue(b)}}if((0===d||d)&&e&&g){b.newCue(d+f.presentationTimeOffsetInSec,e+f.presentationTimeOffsetInSec,g);var i=c.extract();f.cueParser.oncue=h,f.cueParser.parse(i),f.cueParser.flush()}}}for(var e=this,f=this,h=function(a){var f=c(b[a].channel);if(!f)return"continue";var h=new o["default"],i=new g["default"];i.writable=!0,i.write=function(a){return h.append(a)};var j={newCue:d(b[a],new m["default"](i),h)};e.embeddedCea608FieldParsers[a]=new k["default"].Cea608Parser(f,j,null)},i=0;i<b.length;i++){{h(i)}}},a}();c["default"]=p,b.exports=c["default"]},{"./lib/cea608-parser.js":90,"./lib/cea608-towebvtt.js":91,"./models/captionsBuffer.js":93,"global/window":80,stream:22}],90:[function(a,b,c){"use strict";!function(a){var b={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},c=function(a){var c=a;return b.hasOwnProperty(a)&&(c=b[a]),String.fromCharCode(c)},d=15,e=32,f={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},g={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},i={25:2,26:4,29:6,30:8,31:10,27:13,28:15},j=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],k={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a){var b=this.verboseFilter[a];this.verboseLevel>=b}},l=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},m=function(a,b,c,d,e){this.foreground=a||"white",this.underline=b||!1,this.italics=c||!1,this.background=d||"black",this.flash=e||!1};m.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},copy:function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var n=function(a,b,c,d,e,f){this.uchar=a||" ",this.penState=new m(b,c,d,e,f)};n.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(a,b){this.uchar=a,this.penState.copy(b)},setPenState:function(a){this.penState.copy(a)},equals:function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},copy:function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var o=function(){this.chars=[];for(var a=0;e>a;a++)this.chars.push(new n);this.pos=0,this.currPenState=new m};o.prototype={equals:function(a){for(var b=!0,c=0;e>c;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},copy:function(a){for(var b=0;e>b;b++)this.chars[b].copy(a.chars[b])},isEmpty:function(){for(var a=!0,b=0;e>b;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},setCursor:function(a){this.pos!==a&&(this.pos=a),this.pos<0?(k.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>e&&(k.log("ERROR","Too large cursor position "+this.pos),this.pos=e)},moveCursor:function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;b+1>c&&e>c;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(a){a>=144&&this.backSpace();var b=c(a);return this.pos>=e?void k.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void(this.pos<e-1?this.moveCursor(1):k.log("WARNING: cursor at end of chars. Cannot advance cursor.")))},clearFromPos:function(a){var b;for(b=a;e>b;b++)this.chars[b].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var a=[],b=!0,c=0;e>c;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},setPenStyles:function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)}};var p=function(){this.rows=[];for(var a=0;d>a;a++)this.rows.push(new o);this.currRow=d-1,this.nrRollUpRows=null,this.reset()};p.prototype={reset:function(){for(var a=0;d>a;a++)this.rows[a].clear();this.currRow=d-1},equals:function(a){for(var b=!0,c=0;d>c;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},copy:function(a){for(var b=0;d>b;b++)this.rows[b].copy(a.rows[b])},isEmpty:function(){for(var a=!0,b=0;d>b;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},backSpace:function(){var a=this.rows[this.currRow];a.backSpace()},clearToEndOfRow:function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},insertChar:function(a){var b=this.rows[this.currRow];b.insertChar(a)},setPen:function(a){var b=this.rows[this.currRow];b.setPenStyles(a)},moveCursor:function(a){var b=this.rows[this.currRow];b.moveCursor(a)},setCursor:function(a){k.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)},setPAC:function(a){k.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.currRow=b;var c=this.rows[this.currRow];if(null!==a.indent){var d=a.indent,e=Math.max(d-1,0);c.setCursor(a.indent),a.color=c.chars[e].penState.foreground}var f={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(f)},setBkgData:function(a){k.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},setRollUpRows:function(a){this.nrRollUpRows=a},rollUp:function(){if(null===this.nrRollUpRows)return void k.log("DEBUG","roll_up but nrRollUpRows not set yet");k.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),k.log("INFO","Rolling up")},getDisplayText:function(a){a=a||!1;for(var b=[],c="",e=-1,f=0;d>f;f++){var g=this.rows[f].getTextString();g&&(e=f+1,b.push(a?"Row "+e+': "'+g+'"':g.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},getTextAndFormat:function(){return this.rows}};var q=function(a,b){this.chNr=a,this.outputFilter=b,this.mode=null,this.verbose=0,this.displayedMemory=new p,this.nonDisplayedMemory=new p,this.lastOutputScreen=new p,this.currRollUpRow=this.displayedMemory.rows[d-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};q.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[d-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(a){this.outputFilter=a},setPAC:function(a){this.writeScreen.setPAC(a)},setBkgData:function(a){this.writeScreen.setBkgData(a)},setMode:function(a){a!==this.mode&&(this.mode=a,
k.log("INFO","MODE="+a),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},insertChars:function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";k.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(k.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){k.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){k.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){k.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(a){k.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},cc_FON:function(){k.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){k.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){k.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){k.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){k.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){k.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){k.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(k.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,k.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(a){k.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},cc_MIDROW:function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}k.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},outputDataUpdate:function(){var a=k.time;null!==a&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(a,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))}};var r=function(a,b,c){this.field=a||1,this.outputs=[b,c],this.channels=[new q(1,b),new q(2,c)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}};r.prototype={getHandler:function(a){return this.channels[a].getHandler()},setHandler:function(a,b){this.channels[a].setHandler(b)},addData:function(a,b){var c,d,e,f=!1;this.lastTime=a,k.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(k.log("DATA","["+l([b[g],b[g+1]])+"] -> ("+l([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else k.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,k.log("WARNING","Couldn't parse cleaned data "+l([d,e])+" orig: "+l([b[g],b[g+1]])))}else this.dataCounters.padding+=2},parseCmd:function(a,b){var c=null,d=(20===a||28===a)&&b>=32&&47>=b,e=(23===a||31===a)&&b>=33&&35>=b;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,k.log("DEBUG","Repeated command ("+l([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.cc_RCL():33===b?f.cc_BS():34===b?f.cc_AOF():35===b?f.cc_AON():36===b?f.cc_DER():37===b?f.cc_RU(2):38===b?f.cc_RU(3):39===b?f.cc_RU(4):40===b?f.cc_FON():41===b?f.cc_RDC():42===b?f.cc_TR():43===b?f.cc_RTD():44===b?f.cc_EDM():45===b?f.cc_CR():46===b?f.cc_ENM():47===b&&f.cc_EOC():f.cc_TO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},parseMidrow:function(a,b){var c=null;if((17===a||25===a)&&b>=32&&47>=b){if(c=17===a?1:2,c!==this.currChNr)return k.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.cc_MIDROW(b),k.log("DEBUG","MIDROW ("+l([a,b])+")"),!0}return!1},parsePAC:function(a,b){var c=null,d=null,e=(a>=17&&23>=a||a>=25&&31>=a)&&b>=64&&127>=b,j=(16===a||24===a)&&b>=64&&95>=b;if(!e&&!j)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=23>=a?1:2,d=b>=64&&95>=b?1===c?f[a]:h[a]:1===c?g[a]:i[a];var k=this.interpretPAC(d,b),l=this.channels[c-1];return l.setPAC(k),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},interpretPAC:function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),13>=c?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:15>=c?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},parseChars:function(a,b){var d=null,e=null,f=null;if(a>=25?(d=2,f=a-8):(d=1,f=a),f>=17&&19>=f){var g=b;g=17===f?b+80:18===f?b+112:b+144,k.log("INFO","Special char '"+c(g)+"' in channel "+d),e=[g]}else a>=32&&127>=a&&(e=0===b?[a]:[a,b]);if(e){var h=l(e);k.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return e},parseBackgroundAttributes:function(a,b){var c,d,e,f,g=(16===a||24===a)&&b>=32&&47>=b,h=(23===a||31===a)&&b>=45&&47>=b;return g||h?(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=j[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=24>a?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0):!1},reset:function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)}};var s=function(a,b,c){for(var d=0,e=b,f=0,g=[],h=function(a,b,c,d){if(4!==a||8>b)return null;var e=c.getUint8(d),f=c.getUint16(d+1),g=c.getUint32(d+3),h=c.getUint8(d+7);return 181==e&&49==f&&1195456820==g&&3==h};b+c>e;){if(d=a.getUint32(e),f=31&a.getUint8(e+4),6===f)for(var i=e+5,j=-1;e+4+d-1>i;){j=0;for(var k=255;255===k;)k=a.getUint8(i),j+=k,i++;var l=0;for(k=255;255===k;)k=a.getUint8(i),l+=k,i++;h(j,l,a,i)&&g.push([i,l]),i+=l}e+=d+4}return g},t=function(a,b){var c=b[0],d=[[],[]];c+=8;var e=31&a.getUint8(c);c+=2;for(var f=0;e>f;f++){var g=a.getUint8(c),h=4&g,i=3&g;c++;var j=a.getUint8(c);c++;var k=a.getUint8(c);c++,h&&(127&j)+(127&k)!==0&&(0===i?(d[0].push(j),d[0].push(k)):1===i&&(d[1].push(j),d[1].push(k)))}return d};a.logger=k,a.PenState=m,a.CaptionScreen=p,a.Cea608Parser=r,a.findCea608Nalus=s,a.extractCea608DataFromRange=t}("undefined"==typeof c?(void 0).cea608parser={}:c)},{}],91:[function(a,b,c){"use strict";c.__esModule=!0;var d=a("./cea608-parser.js"),e=function(a,b,c){this.stream=a,this.channelNr=1|b,this.combineConsecutiveRows=c|!0,this.initWritten=!1};e.prototype={newCue:function(a,b,c){this.initWritten||this.writeInit();var d=this.formatTime(a),e=this.formatTime(b);this.writeCue(d,e,c)},writeToStream:function(a){this.stream&&this.stream.write(a)},formatTime:function(a){var b,c,d,e=Math.floor(a),f=a-e,g=function(a){var b=a.toString();return 1===b.length?"0"+b:b},h=function(a){for(var b=a.toString(),c=3-b.length;c>0;)b="0"+b,c--;return b};return b=Math.floor(e/3600),e-=3600*b,c=Math.floor(e/60),e-=60*c,d=Math.floor(1e3*f),g(b)+":"+g(c)+":"+g(e)+"."+h(d)},writeInit:function(a,b){this.writeToStream("WEBVTT\nStyling=CEA608\nKind=Caption\nChannel=CC"+this.channelNr+"\n"),b&&(this.lastScreen.copy(b),this.lastTime=a),this.initWritten=!0},writeCue:function(a,b,c){for(var d=-2,e=0;e<c.rows.length;e++){var f=c.rows[e];if(!f.isEmpty()){if(!this.combineConsecutiveRows||e!==d+1){var g=e+1;this.writeToStream("\n"+a+" --> "+b+" line:"+g+"\n")}this.outputTextRow(f),this.writeToStream("\n"),d=e}}},outputTextRow:function(a){for(var b=new d.PenState,c=null,e=null,f=0;f<a.chars.length;f++){e=a.chars[f];var g=!1;if(c=e.penState,(c.foreground!==b.foreground||c.background!==b.background||c.flash!==b.flash)&&(("white"!==b.foreground||"black"!==b.background||b.flash)&&this.writeToStream("</c>"),g=!0),c.underline!==b.underline&&b.underline&&this.writeToStream("</u>"),c.italics!==b.italics&&b.italics&&this.writeToStream("</i>"),c.italics!==b.italics&&(c.italics&&this.writeToStream("<i>"),b.italics=c.italics),c.underline!==b.underline&&c.underline&&this.writeToStream("<u>"),g&&("white"!==c.foreground||"black"!==c.background||c.flash)){var h=[],i=c.background;if("transparent"===c.background)h.push("transparent");else{var j=i.split("_");2===j.length&&"semi"===j[1]&&h.push("semi-transparent"),"black"!==i&&h.push("bg_"+j[0])}"white"!==c.foreground&&h.push(c.foreground),c.flash&&h.push("blink");var k=h.join(".");this.writeToStream("<c."+k+">")}this.writeToStream(e.uchar),b.copy(c)}("white"!==c.foreground||"black"!==c.background)&&this.writeToStream("</c>"),c.underline&&this.writeToStream("</u>"),c.italics&&this.writeToStream("</i>")},close:function(){this.stream&&(this.stream.end(),this.stream=null)}},c["default"]=e,b.exports=c["default"]},{"./cea608-parser.js":90}],92:[function(a,b,c){/*! codem-isoboxer v0.2.10 https://github.com/madebyhiro/codem-isoboxer/blob/master/LICENSE.txt */
"use strict";var d={};d.parseBuffer=function(a){return new e(a).parse()},d.addBoxParser=function(a,b){"string"==typeof a&&"function"==typeof b&&(f.prototype._boxParsers[a]=b)},d.Utils={},d.Utils.dataViewToString=function(a,b){var c=b||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(c).decode(a);var d=[],e=0;if("utf-8"===c)for(;e<a.byteLength;){var f=a.getUint8(e++);128>f||(224>f?(f=(31&f)<<6,f|=63&a.getUint8(e++)):240>f?(f=(15&f)<<12,f|=(63&a.getUint8(e++))<<6,f|=63&a.getUint8(e++)):(f=(7&f)<<18,f|=(63&a.getUint8(e++))<<12,f|=(63&a.getUint8(e++))<<6,f|=63&a.getUint8(e++))),d.push(String.fromCharCode(f))}else for(;e<a.byteLength;)d.push(String.fromCharCode(a.getUint8(e++)));return d.join("")},"undefined"!=typeof c&&(c.parseBuffer=d.parseBuffer,c.addBoxParser=d.addBoxParser,c.Utils=d.Utils),d.Cursor=function(a){this.offset="undefined"==typeof a?0:a};var e=function(a){this._raw=new DataView(a),this._cursor=new d.Cursor,this.boxes=[]};e.prototype.fetch=function(a){var b=this.fetchAll(a,!0);return b.length?b[0]:null},e.prototype.fetchAll=function(a,b){var c=[];return e._sweep.call(this,a,c,b),c},e.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var a=f.parse(this);if("undefined"==typeof a.type)break;this.boxes.push(a)}return this},e._sweep=function(a,b,c){this.type&&this.type==a&&b.push(this);for(var d in this.boxes){if(b.length&&c)return;e._sweep.call(this.boxes[d],a,b,c)}};var f=function(){this._cursor=new d.Cursor};f.parse=function(a){var b=new f;return b._offset=a._cursor.offset,b._root=a._root?a._root:a,b._raw=a._raw,b._parent=a,b._parseBox(),a._cursor.offset=b._raw.byteOffset+b._raw.byteLength,b},f.prototype._readInt=function(a){var b=null;switch(a){case 8:b=this._raw.getInt8(this._cursor.offset-this._raw.byteOffset);break;case 16:b=this._raw.getInt16(this._cursor.offset-this._raw.byteOffset);break;case 32:b=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset);break;case 64:var c=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset),d=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset+4);b=c*Math.pow(2,32)+d}return this._cursor.offset+=a>>3,b},f.prototype._readUint=function(a){var b,c,d=null;switch(a){case 8:d=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset);break;case 16:d=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset);break;case 24:b=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset),c=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset+2),d=(b<<8)+c;break;case 32:d=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset);break;case 64:b=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset),c=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset+4),d=b*Math.pow(2,32)+c}return this._cursor.offset+=a>>3,d},f.prototype._readString=function(a){for(var b="",c=0;a>c;c++){var d=this._readUint(8);b+=String.fromCharCode(d)}return b},f.prototype._readTerminatedString=function(){for(var a="";this._cursor.offset-this._offset<this._raw.byteLength;){var b=this._readUint(8);if(0===b)break;a+=String.fromCharCode(b)}return a},f.prototype._readTemplate=function(a){var b=this._readUint(a/2),c=this._readUint(a/2);return b+c/Math.pow(2,a/2)},f.prototype._readData=function(a){var b=a>0?a:this._raw.byteLength-(this._cursor.offset-this._offset),c=new DataView(this._raw.buffer,this._cursor.offset,b);return this._cursor.offset+=b,c},f.prototype._parseBox=function(){if(this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)return void(this._root._incomplete=!0);switch(this.size=this._readUint(32),this.type=this._readString(4),1==this.size&&(this.largesize=this._readUint(64)),"uuid"==this.type&&(this.usertype=this._readString(16)),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._boxParsers[this.type]&&this._boxParsers[this.type].call(this))},f.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},f.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(f.parse(this))},f.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc"],f.prototype._boxParsers={},f.prototype._boxParsers.avc1=function(){this.reserved1=[this._readUint(8),this._readUint(8),this._readUint(8),this._readUint(8),this._readUint(8),this._readUint(8)],this.data_reference_index=this._readUint(16),this.pre_defined1=this._readUint(16),this.reserved2=this._readUint(16),this.pre_defined2=[this._readUint(32),this._readUint(32),this._readUint(32)],this.width=this._readUint(16),this.height=this._readUint(16),this.horizresolution=this._readTemplate(32),this.vertresolution=this._readTemplate(32),this.reserved3=this._readUint(32),this.frame_count=this._readUint(16);var a=this._readUint(8);this.compressorname=this._readString(a);for(var b=0;31-a>b;b++)this._readUint(8);this.depth=this._readUint(16),this.pre_defined3=this._readInt(16),this.config=this._readData()},f.prototype._boxParsers.dref=function(){this._parseFullBox(),this.entry_count=this._readUint(32),this.entries=[];for(var a=0;a<this.entry_count;a++)this.entries.push(f.parse(this))},f.prototype._boxParsers.elst=function(){this._parseFullBox(),this.entry_count=this._readUint(32),this.entries=[];for(var a=1;a<=this.entry_count;a++){var b={};1==this.version?(b.segment_duration=this._readUint(64),b.media_time=this._readInt(64)):(b.segment_duration=this._readUint(32),b.media_time=this._readInt(32)),b.media_rate_integer=this._readInt(16),b.media_rate_fraction=this._readInt(16),this.entries.push(b)}},f.prototype._boxParsers.emsg=function(){this._parseFullBox(),this.scheme_id_uri=this._readTerminatedString(),this.value=this._readTerminatedString(),this.timescale=this._readUint(32),this.presentation_time_delta=this._readUint(32),this.event_duration=this._readUint(32),this.id=this._readUint(32),this.message_data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},f.prototype._boxParsers.free=f.prototype._boxParsers.skip=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},f.prototype._boxParsers.ftyp=f.prototype._boxParsers.styp=function(){for(this.major_brand=this._readString(4),this.minor_version=this._readUint(32),this.compatible_brands=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.compatible_brands.push(this._readString(4))},f.prototype._boxParsers.hdlr=function(){this._parseFullBox(),this.pre_defined=this._readUint(32),this.handler_type=this._readString(4),this.reserved=[this._readUint(32),this._readUint(32),this._readUint(32)],this.name=this._readTerminatedString()},f.prototype._boxParsers.mdat=function(){this.data=this._readData()},f.prototype._boxParsers.mdhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32));var a=this._readUint(16);this.pad=a>>15,this.language=String.fromCharCode((a>>10&31)+96,(a>>5&31)+96,(31&a)+96),this.pre_defined=this._readUint(16)},f.prototype._boxParsers.mehd=function(){this._parseFullBox(),this.fragment_duration=this._readUint(1==this.version?64:32)},f.prototype._boxParsers.mfhd=function(){this._parseFullBox(),this.sequence_number=this._readUint(32)},f.prototype._boxParsers.mfro=function(){this._parseFullBox(),this.mfra_size=this._readUint(32)},f.prototype._boxParsers.mp4a=function(){this.reserved1=[this._readUint(8),this._readUint(8),this._readUint(8),this._readUint(8),this._readUint(8),this._readUint(8)],this.data_reference_index=this._readUint(16),this.reserved2=[this._readUint(32),this._readUint(32)],this.channelcount=this._readUint(16),this.samplesize=this._readUint(16),this.pre_defined=this._readUint(16),this.reserved3=this._readUint(16),this.samplerate=this._readTemplate(32),this.esds=this._readData()},f.prototype._boxParsers.mvhd=function(){this._parseFullBox();var a;for(1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32)),this.rate=this._readTemplate(32),this.volume=this._readTemplate(16),this.reserved1=this._readUint(16),this.reserved2=[this._readUint(32),this._readUint(32)],this.matrix=[],a=0;9>a;a++)this.matrix.push(this._readTemplate(32));for(this.pre_defined=[],a=0;6>a;a++)this.pre_defined.push(this._readUint(32));this.next_track_ID=this._readUint(32)},f.prototype._boxParsers.payl=function(){var a=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset));this.cue_text=d.Utils.dataViewToString(a)},f.prototype._boxParsers.sidx=function(){this._parseFullBox(),this.reference_ID=this._readUint(32),this.timescale=this._readUint(32),0===this.version?(this.earliest_presentation_time=this._readUint(32),this.first_offset=this._readUint(32)):(this.earliest_presentation_time=this._readUint(64),this.first_offset=this._readUint(64)),this.reserved=this._readUint(16),this.reference_count=this._readUint(16),this.references=[];for(var a=0;a<this.reference_count;a++){var b={},c=this._readUint(32);b.reference_type=c>>31&1,b.referenced_size=2147483647&c,b.subsegment_duration=this._readUint(32);var d=this._readUint(32);b.starts_with_SAP=d>>31&1,b.SAP_type=d>>28&7,b.SAP_delta_time=268435455&d,this.references.push(b)}},f.prototype._boxParsers.smhd=function(){this._parseFullBox(),this.balance=this._readTemplate(16),this.reserved=this._readUint(16)},f.prototype._boxParsers.ssix=function(){this._parseFullBox(),this.subsegment_count=this._readUint(32),this.subsegments=[];for(var a=0;a<this.subsegment_count;a++){var b={};b.ranges_count=this._readUint(32),b.ranges=[];for(var c=0;c<b.ranges_count;c++){var d={};d.level=this._readUint(8),d.range_size=this._readUint(24),b.ranges.push(d)}this.subsegments.push(b)}},f.prototype._boxParsers.stsd=function(){this._parseFullBox(),this.entry_count=this._readUint(32),this.entries=[];for(var a=0;a<this.entry_count;a++)this.entries.push(f.parse(this))},f.prototype._boxParsers.subs=function(){this._parseFullBox(),this.entry_count=this._readUint(32),this.entries=[];for(var a=0;a<this.entry_count;a++){var b={};b.sample_delta=this._readUint(32),b.subsample_count=this._readUint(16),b.subsamples=[];for(var c=0;c<b.subsample_count;c++){var d={};d.subsample_size=this._readUint(1&this.version?32:16),d.subsample_priority=this._readUint(8),d.discardable=this._readUint(8),d.codec_specific_parameters=this._readUint(32),b.subsamples.push(d)}this.entries.push(b)}},f.prototype._boxParsers.tfdt=function(){this._parseFullBox(),this.baseMediaDecodeTime=this._readUint(1==this.version?64:32)},f.prototype._boxParsers.tfhd=function(){this._parseFullBox(),this.track_ID=this._readUint(32),1&this.flags&&(this.base_data_offset=this._readUint(64)),2&this.flags&&(this.sample_description_offset=this._readUint(32)),8&this.flags&&(this.default_sample_duration=this._readUint(32)),16&this.flags&&(this.default_sample_size=this._readUint(32)),32&this.flags&&(this.default_sample_flags=this._readUint(32))},f.prototype._boxParsers.tfra=function(){this._parseFullBox(),this.track_ID=this._readUint(32),this._packed=this._readUint(32),this.reserved=this._packed>>>6,this.length_size_of_traf_num=(this._packed&&0xffff00000000)>>>4,this.length_size_of_trun_num=(this._packed&&4294901760)>>>2,this.length_size_of_sample_num=this._packed&&255,this.number_of_entry=this._readUint(32),this.entries=[];for(var a=0;a<this.number_of_entry;a++){var b={};1==this.version?(b.time=this._readUint(64),b.moof_offset=this._readUint(64)):(b.time=this._readUint(32),b.moof_offset=this._readUint(32)),b.traf_number=this._readUint(8*(this.length_size_of_traf_num+1)),b.trun_number=this._readUint(8*(this.length_size_of_trun_num+1)),b.sample_number=this._readUint(8*(this.length_size_of_sample_num+1)),this.entries.push(b)}},f.prototype._boxParsers.tkhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(32)),this.reserved2=[this._readUint(32),this._readUint(32)],this.layer=this._readUint(16),this.alternate_group=this._readUint(16),this.volume=this._readTemplate(16),this.reserved3=this._readUint(16),this.matrix=[];for(var a=0;9>a;a++)this.matrix.push(this._readTemplate(32));this.width=this._readTemplate(32),this.height=this._readTemplate(32)},f.prototype._boxParsers.trex=function(){this._parseFullBox(),this.track_ID=this._readUint(32),this.default_sample_description_index=this._readUint(32),this.default_sample_duration=this._readUint(32),this.default_sample_size=this._readUint(32),this.default_sample_flags=this._readUint(32)},f.prototype._boxParsers.trun=function(){this._parseFullBox(),this.sample_count=this._readUint(32),1&this.flags&&(this.data_offset=this._readInt(32)),4&this.flags&&(this.first_sample_flags=this._readUint(32)),this.samples=[];for(var a=0;a<this.sample_count;a++){var b={};256&this.flags&&(b.sample_duration=this._readUint(32)),512&this.flags&&(b.sample_size=this._readUint(32)),1024&this.flags&&(b.sample_flags=this._readUint(32)),2048&this.flags&&(b.sample_composition_time_offset=this._readInt(32)),this.samples.push(b)}},f.prototype._boxParsers["url "]=f.prototype._boxParsers["urn "]=function(){this._parseFullBox(),"urn "===this.type&&(this.name=this._readTerminatedString()),this.location=this._readTerminatedString()},f.prototype._boxParsers.vlab=function(){var a=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset));this.source_label=d.Utils.dataViewToString(a)},f.prototype._boxParsers.vmhd=function(){this._parseFullBox(),this.graphicsmode=this._readUint(16),this.opcolor=[this._readUint(16),this._readUint(16),this._readUint(16)]},f.prototype._boxParsers.vttC=function(){var a=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset));this.config=d.Utils.dataViewToString(a)},f.prototype._boxParsers.vtte=function(){}},{}],93:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0,function(){var a=function(){function a(){d(this,a),this._captions=""}return a.prototype.get=function(){return this._captions},a.prototype.append=function(a){this._captions+=a},a.prototype.clear=function(){this._captions=""},a.prototype.extract=function(){var a=this.get().slice();return this.clear(),a},a}();c["default"]=a}(),b.exports=c["default"]},{}],94:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0,function(){var a=function b(){d(this,b),this.startTime=null,this.endTime=null,this.fields=[[],[]]};c["default"]=a}(),b.exports=c["default"]},{}],95:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=a("../video.js/src/js/tracks/track-enums.js"),g=d(f),h=function(){function a(b){e(this,a),this.cea608TextTracks=[],this.player=b}return a.prototype.getAllTracks=function(){return this.cea608TextTracks},a.prototype.getTrackById=function(a){for(var b=this.player.textTracks(),c=0;c<b.length;c++)if(b[c].id===a)return b[c];return null},a.prototype.addTextTrack=function(a,b,c){var d=this.player.addTextTrack(g["default"].TextTrackKind.captions,a,b);return d.channel=c,this.cea608TextTracks.push(d),d},a.prototype.removePreviousEmbeddedTextTracks=function(){function(){}