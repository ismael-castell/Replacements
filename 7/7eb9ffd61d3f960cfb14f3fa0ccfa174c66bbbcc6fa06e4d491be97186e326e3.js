!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.P2PEngineMp4=t():e.P2PEngineMp4=t()}(self,(()=>(()=>{var __webpack_modules__={6673:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=s(n(1934)),a=s(n(9356));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.requestingMap=new a.default,r.bitset=new Set,r.bitCounts=new Map,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"handshakePeer",value:function(e){this._setupDC(e),e.sendMetaData(Array.from(this.bitset),this.sequential,this.peersNum)}},{key:"handleMetaData",value:function(e,t){var n=this;t.field&&(e.bitset=new Set(t.field),t.field.forEach((function(e){n.bitset.has(e)||n._increBitCounts(e)})),this.addPeer(e),this.downloadOnly&&this.chokePeerRequest(e))}},{key:"peersHas",value:function(e){return this.bitCounts.has(e)}},{key:"_decreBitCounts",value:function(e){if(this.bitCounts.has(e)){var t=this.bitCounts.get(e);1===t?this.bitCounts.delete(e):this.bitCounts.set(e,t-1)}}},{key:"_increBitCounts",value:function(e){if(this.bitCounts.has(e)){var t=this.bitCounts.get(e);this.bitCounts.set(e,t+1)}else this.bitCounts.set(e,1)}},{key:"reportDCTraffic",value:function(e,t,n){if(this.engine.fetcher){var r=this.engine.fetcher,i=t;this.bitset.has(e)||r.reportDCTraffic(i,n)}else this.logger.error("DC report failed")}},{key:"cleanRequestingMap",value:function(e){var t=this.peerManager.getPeer(e),n=!0,i=!1,o=void 0;try{for(var a,s=this.requestingMap.internalMap[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=r(a.value,2),c=u[0],l=u[1];l&&l.includes(e)&&(this.logger.info("delete "+c+" in requestingMap"),this.requestingMap.delete(c),this._decreBitCounts(c),t&&t.bitset.delete(c))}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"getPeerLoadedMore",value:function(e){if(!this.requestingMap.has(e))return null;var t=this.requestingMap.getAllPeerIds(e);if(0===t.length)return null;var n=this.peerManager.getPeer(t[0]);if(!n)return null;if(t.length>1)for(var r=1;r<t.length;r++){var i=this.peerManager.getPeer(t[r]);i&&i.bufArr.length>n.bufArr.length&&(n=i)}return n}}]),t}(o.default);t.default=u,e.exports=t.default},8304:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={wsMaxRetries:10,p2pEnabled:!0,wifiOnly:!1,memoryCacheLimit:{pc:838860800,mobile:524288e3},dcDownloadTimeout:25,logLevel:"error",tag:"",webRTCConfig:{},token:void 0,appName:void 0,appId:void 0,prefetchNum:5,showSlogan:!0,trickleICE:!1,simultaneousTargetPeers:2,announceLocation:"cn",geoIpPreflight:!0,validateSegment:function(e,t){return!0},getStats:function(e,t,n){},getPeerId:function(e){},getPeersInfo:function(e){}};t.default=n,e.exports=t.default},9979:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=d(n(6204)),a=d(n(6931)),s=d(n(8622)),u=n(3901),c=d(n(7542)),l=d(n(4206)),f=d(n(2497));function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g="nllL",y="d3NzJ",_="==",m="TNBLy9z",v="aWduY",b="mNvbQ",w="WwuY2RuY",E=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(n.p2pEnabled=!(!1===e.p2pEnabled||"0"===(0,u.getQueryParam)("_p2p")),e.tag&&e.tag.length>20)throw new Error("Tag is too long");if(e.appName&&e.appName.length>30)throw new Error("appName is too long");if(e.appId&&e.appId.length>30)throw new Error("appId is too long");if(e.token&&e.token.length>20)throw new Error("Token is too long");if(e.simultaneousTargetPeers<=0)throw new Error("simultaneousTargetPeers must >= 1");return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"initLogger",value:function(){var e=this.config;e.showSlogan&&"en"===(0,u.navLang)()&&console.log("%cEmpower your users to become the unlimitedly scalable CDN!\n%c"+(0,u.getHomeUrl)(),"color: dodgerblue; padding:20px 0; font-size: x-large","font-size: medium; padding-bottom:15px");var t=new a.default(e.logLevel);return e.logger=this.logger=t,t}},{key:"makeChannelId",value:function(e,t){if(!e||"string"!=typeof e){var n="token is required while using customized channelId!";throw console.error(n),new Error(n)}return function(n,r){return e+"-"+t(n,r)}}},{key:"makeSignalId",value:function(){var e="",t=this.config,n=decodeURIComponent(window.atob(y+m+v+w+g+b+_));if(t.wsSignalerAddr){var i=void 0;"object"!==r(t.wsSignalerAddr)||t.wsSignalerAddr.backup?"string"==typeof t.wsSignalerAddr&&(i=t.wsSignalerAddr):i=t.wsSignalerAddr.main,i===n&&(i=void 0),i&&(e=s.default.parseURL(i).netLoc.substr(2))}else t.wsSignalerAddr=n;return e}},{key:"setupWindowListeners",value:function(e){var t=this,n=["iPad","iPhone"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",r=function e(){t.p2pEnabled&&t.disableP2P(),window.removeEventListener(n,e)};e?window.removeEventListener(n,r):window.addEventListener(n,r)}},{key:"destroy",value:function(){this.disableP2P(),this.removeAllListeners(),this.setupWindowListeners(!0)}},{key:"enableP2P",value:function(){return this.p2pEnabled?null:(this.logger&&this.logger.info("enable P2P"),this.config.p2pEnabled=this.p2pEnabled=!0,this.browserInfo?(this._init(this.channel,this.browserInfo),this):null)}},{key:"commonBrowserInfo",get:function(){var e=l.default.getPlatform(),t=l.default.getNetType()||"wifi";return this.netType=t,{device:e,netType:t,player:(0,f.default)()||void 0}}},{key:"version",get:function(){return t.version}}],[{key:"isSupported",value:function(){var e=(0,u.getBrowserRTC)();return!(!e||void 0===e.RTCPeerConnection.prototype.createDataChannel)}}]),t}(o.default);E.version="0.11.1",E.protocolVersion=c.default.VERSION,t.default=E,e.exports=t.default},3784:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={DC_SIGNAL:"SIGNAL",DC_OPEN:"OPEN",DC_REQUEST:"REQUEST",DC_PIECE_NOT_FOUND:"PIECE_NOT_FOUND",DC_PIECE_ABORT:"PIECE_ABORT",DC_CLOSE:"CLOSE",DC_RESPONSE:"RESPONSE",DC_ERROR:"ERROR",DC_PIECE:"PIECE",DC_PIECE_DATA:"PIECE_DATA",DC_TIMEOUT:"TIMEOUT",DC_PIECE_ACK:"PIECE_ACK",DC_METADATA:"METADATA",DC_PLAT_ANDROID:"ANDROID",DC_PLAT_IOS:"IOS",DC_PLAT_WEB:"WEB",DC_CHOKE:"CHOKE",DC_UNCHOKE:"UNCHOKE",DC_HAVE:"HAVE",DC_LOST:"LOST",DC_GET_PEERS:"GET_PEERS",DC_PEERS:"PEERS",DC_STATS:"STATS",DC_SUBSCRIBE:"SUBSCRIBE",DC_UNSUBSCRIBE:"UNSUBSCRIBE",DC_SUBSCRIBE_ACCEPT:"SUBSCRIBE_ACCEPT",DC_SUBSCRIBE_REJECT:"SUBSCRIBE_REJECT",DC_SUBSCRIBE_LEVEL:"SUBSCRIBE_LEVEL",DC_PEER_SIGNAL:"PEER_SIGNAL",DC_PLAYLIST:"PLAYLIST",BM_LOST:"lost",BM_ADDED_SEG_:"BM_ADDED_SEG_",BM_ADDED_SN_:"BM_ADDED_SN_",BM_SEG_ADDED:"BM_SEG_ADDED",FRAG_CHANGED:"FRAG_CHANGED",FRAG_LOADED:"FRAG_LOADED",FRAG_LOADING:"FRAG_LOADING",RESTART_P2P:"RESTART_P2P",EXCEPTION:"exception"},e.exports=t.default},1236:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EngineBase=t.WebsocketClient=t.SegmentManager=t.Segment=t.PeerManager=t.BtScheduler=t.config=t.Tracker=t.getPeersThrottle=t.Buffer=t.Server=t.Events=t.Peer=void 0;var r=y(n(7542)),i=y(n(3784)),o=y(n(2702)),a=y(n(4212)),s=n(9),u=y(n(8233)),c=y(n(8304)),l=y(n(6673)),f=y(n(931)),d=y(n(7893)),h=y(n(3023)),p=y(n(4641)),g=y(n(9979));function y(e){return e&&e.__esModule?e:{default:e}}t.Peer=r.default,t.Events=i.default,t.Server=o.default,t.Buffer=s.Buffer,t.getPeersThrottle=a.default,t.Tracker=u.default,t.config=c.default,t.BtScheduler=l.default,t.PeerManager=f.default,t.Segment=d.default,t.SegmentManager=h.default,t.WebsocketClient=p.default,t.EngineBase=g.default},4746:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3901),a=c(n(6204)),s=c(n(1003)),u=n(9);function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.channelName=e.initiator?e.channelName:null,n.initiator=e.initiator||!1,n.channelConfig=e.channelConfig||t.channelConfig,n.channelNegotiated=n.channelConfig.negotiated,n.config=Object.assign({},t.config,e.config),n.offerOptions=e.offerOptions||{},n.answerOptions=e.answerOptions||{},n.sdpTransform=e.sdpTransform||function(e){return e},n.trickle=void 0===e.trickle||e.trickle,n.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,n.iceCompleteTimeout=e.iceCompleteTimeout||5e3,n.destroyed=!1,n.destroying=!1,n._connected=!1,n.remoteAddress=void 0,n.remoteFamily=void 0,n.remotePort=void 0,n.localAddress=void 0,n.localFamily=void 0,n.localPort=void 0,n._wrtc=e.wrtc&&"object"===r(e.wrtc)?e.wrtc:(0,o.getBrowserRTC)(),n._pcReady=!1,n._channelReady=!1,n._iceComplete=!1,n._iceCompleteTimer=null,n._channel=null,n._pendingCandidates=[],n._isNegotiating=!1,n._firstNegotiation=!0,n._batchedNegotiation=!1,n._queuedNegotiation=!1,n._sendersAwaitingStable=[],n._senderMap=new Map,n._closingInterval=null,n._remoteTracks=[],n._remoteStreams=[],n._chunk=null,n._cb=null,n._interval=null;try{n._pc=new n._wrtc.RTCPeerConnection(n.config)}catch(e){return(0,s.default)((function(){return n.destroy(e)})),l(n)}return n._isReactNativeWebrtc="number"==typeof n._pc._peerConnectionId,n._pc.oniceconnectionstatechange=function(){n._onIceStateChange()},n._pc.onicegatheringstatechange=function(){n._onIceStateChange()},n._pc.onconnectionstatechange=function(){n._onConnectionStateChange()},n._pc.onsignalingstatechange=function(){n._onSignalingStateChange()},n._pc.onicecandidate=function(e){n._onIceCandidate(e)},n.initiator||n.channelNegotiated?n._setupData({channel:n._pc.createDataChannel(n.channelName,n.channelConfig)}):n._pc.ondatachannel=function(e){n._setupData(e)},n._needsNegotiation(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"signal",value:function(e){var t=this;if(this.destroyed)throw new Error("cannot signal after peer is destroyed");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}e.renegotiate&&this.initiator&&this._needsNegotiation(),e.transceiverRequest&&this.initiator&&this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.destroy(e)})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(new Error("signal() called with invalid signal data"))}},{key:"_addIceCandidate",value:function(e){var t=this,n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch((function(e){var r;!n.address||n.address.endsWith(".local")?(r="Ignoring unsupported ICE candidate.",console.warn(r)):t.destroy(e)}))}},{key:"send",value:function(e){this._channel.send(e)}},{key:"addTransceiver",value:function(e,t){if(this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(e)}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}},{key:"_needsNegotiation",value:function(){var e=this;this._batchedNegotiation||(this._batchedNegotiation=!0,(0,s.default)((function(){e._batchedNegotiation=!1,!e.initiator&&e._firstNegotiation||e.negotiate(),e._firstNegotiation=!1})))}},{key:"negotiate",value:function(){var e=this;this.initiator?this._isNegotiating?this._queuedNegotiation=!0:setTimeout((function(){e._createOffer()}),0):this._isNegotiating?this._queuedNegotiation=!0:this.emit("signal",{type:"renegotiate",renegotiate:!0}),this._isNegotiating=!0}},{key:"destroy",value:function(e){this._destroy(e,(function(){}))}},{key:"_destroy",value:function(e,t){var n=this;this.destroyed||this.destroying||(this.destroying=!0,(0,s.default)((function(){if(n.destroyed=!0,n.destroying=!1,n._connected=!1,n._pcReady=!1,n._channelReady=!1,n._remoteTracks=null,n._remoteStreams=null,n._senderMap=null,clearInterval(n._closingInterval),n._closingInterval=null,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}if(n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,n._pc.ontrack=null,n._pc.ondatachannel=null}n._pc=null,n._channel=null,e&&n.emit("error",e),n.emit("close")})))}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.destroy(new Error("Data channel event is missing `channel` property"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){t.destroy(e)};var n=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(n&&t._onChannelClose(),n=!0):n=!1}),5e3)}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=f(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e.emit("signal",{type:n.type,sdp:n.sdp})}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(t)}))}})).catch((function(t){e.destroy(t)}))}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=f(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var n=function(){if(!e.destroyed){var n=e._pc.localDescription||t;e.emit("signal",{type:n.type,sdp:n.sdp}),e.initiator||e._requestMissingTransceivers()}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))})).catch((function(t){e.destroy(t)}))}})).catch((function(t){e.destroy(t)}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(new Error("Connection failed."))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(new Error("Ice connection failed.")),"closed"===e&&this.destroy(new Error("Ice connection closed."))}}},{key:"getStats",value:function(e){var t=this,n=function(e){return"[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var r=[];t.forEach((function(e){r.push(n(e))})),e(null,r)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(r){if(!t.destroyed){var i=[];r.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(n(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;!function t(){e.destroyed||e.getStats((function(n,r){if(!e.destroyed){n&&(r=[]);var i={},o={},a={},s=!1;r.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(a[e.id]=e)}));var u=function(t){s=!0;var n=o[t.localCandidateId];n&&(n.ip||n.address)?(e.localAddress=n.ip||n.address,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var r=i[t.remoteCandidateId];r&&(r.ip||r.address)?(e.remoteAddress=r.ip||r.address,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4")};if(r.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(a[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)})),s||Object.keys(a).length&&!Object.keys(o).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.destroy(n)}e._chunk=null;var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e.emit("connect")}else setTimeout(t,100)}}))}()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._queuedNegotiation=!1,this._needsNegotiation()):this.emit("negotiated")),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=u.Buffer.from(t)),this.emit("data",t)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||this.destroy()}},{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}}]),t}(a.default);d.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},d.channelConfig={},t.default=d,e.exports=t.default},931:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.peerMap=new Map}return n(e,[{key:"isEmpty",value:function(){return 0===this.peerMap.size}},{key:"size",value:function(){return this.peerMap.size}},{key:"clear",value:function(){this.peerMap.clear()}},{key:"getPeers",value:function(){return[].concat(r(this.peerMap.values()))}},{key:"getPeerValues",value:function(){return this.peerMap.values()}},{key:"hasPeer",value:function(e){return this.peerMap.has(e)}},{key:"addPeer",value:function(e,t){this.peerMap.set(e,t)}},{key:"getPeerIds",value:function(){return[].concat(r(this.peerMap.keys()))}},{key:"removePeer",value:function(e){this.peerMap.delete(e)}},{key:"getPeersOrderByWeight",value:function(){var e=this.getPeers().filter((function(e){return e.isAvailableUrgently}));return e.sort((function(e,t){return 0===t.weight?1:0===e.weight?-1:t.weight-e.weight})),e}},{key:"getPeer",value:function(e){return this.peerMap.get(e)}},{key:"getAvailablePeers",value:function(){return this.getPeers().filter((function(e){return e.isAvailable}))}}]),e}();t.default=i,e.exports=t.default},7542:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=h(n(4746)),a=h(n(6204)),s=h(n(3784)),u=n(3901),c=h(n(7893)),l=h(n(4206)),f=n(5159),d=n(9);function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var y=64e3,_=function(e){function t(e,n,i,a,c,l){var f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};p(this,t);var d=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));d.engine=e,d.channel=e.fetcher.channelId,d.logger=e.logger,d.config=c,d.isInitiator=a,d.options=f,d.typeExpected=l,d.remotePeerId=i,d.intermediator=f.intermediator||null,d.channelId=a?n+"-"+i:i+"-"+n,d.cpr=0,d.platform="unknown",d.mobile=!1,d.mobileWeb=!1,d.connected=!1,d.msgQueue=[],d.miss=0,d.notifySet=new Set,d.bufArr=[],d.packetSize=y,d.connTimeout=setTimeout((function(){d.logger.warn("dc "+d.channelId+" connection timeout"),d.emit(s.default.DC_ERROR,!0)}),25e3),d.sendReqQueue=[],d.downloading=!1,d.uploading=!1,d.choked=!1,d.downloadListeners=[],d.pieceMsg={},d.timeSendRequest=0,d.timeReceivePiece=0,d.timeSendPiece=0,d.weight=0,d.peersConnected=1,d.timeJoin=(0,u.getCurrentTs)(),d.continuousHits=0,d.uploadSpeed=0,d.gotPeers=!1,d.currentLevel=0;var h={};if(d.options.stuns.length>0){var _=[];d.options.stuns.forEach((function(e){d.logger.info("use stun "+e),_.push({urls:e})})),h.iceServers=_}return d.config.webRTCConfig&&(h=r({},d.config.webRTCConfig,h)),d.playlistMap=new Map,d._datachannel=new o.default({initiator:a,channelName:d.channelId,trickle:f.trickle||!1,config:h}),d._init(d._datachannel),d.dataExchangeTs=d.timeJoin,d.gotStatsTs=d.timeJoin,d.startSN=Number.MAX_SAFE_INTEGER,d.endSN=-1,d.liveEdgeSN=0,d.subscribeEdgeSN=0,d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,null,[{key:"VERSION",get:function(){return"5"}}]),i(t,[{key:"addDownloadListener",value:function(e){this.downloadListeners.push({handler:e})}},{key:"_init",value:function(e){var t=this;e.on("error",(function(e){t.emit(s.default.DC_ERROR,!0)})),e.on("signal",(function(e){if(1===t.cpr){var n=(0,f.pack)(e);n?e=n:t.logger.error("signal pack error")}t.emit(s.default.DC_SIGNAL,e)}));e.once("connect",(function(){for(t.logger.info("datachannel CONNECTED to "+t.remotePeerId+" from "+(t.intermediator?"peer":"server")),t.connected=!0,clearTimeout(t.connTimeout),t.emit(s.default.DC_OPEN);t.msgQueue.length>0;){var e=t.msgQueue.shift();t.emit(e.event,e)}})),e.on("data",(function(e){var n=t.logger;if("string"==typeof e){var r=JSON.parse(e);if(!t.connected)return void t.msgQueue.push(r);var i=r.event,o=void 0;switch(o=i!==s.default.DC_PLAYLIST&&i!==s.default.DC_PEER_SIGNAL?"string: "+e:"event: "+i,n.debug("datachannel receive "+o+" from "+t.remotePeerId),i){case s.default.DC_HAVE:if(t.emit(r.event,r),!r.sn)return;t.config.live?t.liveEdgeSN=r.sn:(r.sn<t.startSN&&(t.startSN=r.sn),r.sn>t.endSN&&(t.endSN=r.sn));break;case s.default.DC_PIECE:t.downloading=!0,t.dataExchangeTs=(0,u.getCurrentTs)(),t.timeReceivePiece=performance.now(),t.pieceMsg=r,t._prepareForBinary(r.attachments,r.seg_id,r.sn,r.size),t.emit(r.event,r);break;case s.default.DC_PIECE_NOT_FOUND:t._sendNextReq()||(t.downloading=!1),t.emit(r.event,r);break;case s.default.DC_REQUEST:t._handleRequestMsg(r);break;case s.default.DC_PIECE_ACK:t.dataExchangeTs=(0,u.getCurrentTs)(),t._handlePieceAck(r),t.emit(r.event,r);break;case s.default.DC_STATS:t._handleStats(r);break;case s.default.DC_PLAYLIST:t.config.sharePlaylist&&t._handlePlaylist(r);break;case s.default.DC_METADATA:t._handleMetadata(r);break;case s.default.DC_PIECE_ABORT:if(t.downloading){if(t.downloadListeners.length>0){var a=!0,c=!1,l=void 0;try{for(var f,d=t.downloadListeners[Symbol.iterator]();!(a=(f=d.next()).done);a=!0){(0,f.value.handler)(t.bufSN,t.segId,!0,"aborted by upstream peer")}}catch(e){c=!0,l=e}finally{try{!a&&d.return&&d.return()}finally{if(c)throw l}}t.downloadListeners=[]}t.emit(s.default.DC_PIECE_ABORT,r)}break;case s.default.DC_CHOKE:n.info("choke peer "+t.remotePeerId),t.choked=!0;break;case s.default.DC_UNCHOKE:n.info("unchoke peer "+t.remotePeerId),t.choked=!1;break;case s.default.DC_CLOSE:t.emit(r.event,r.fatal||!1);break;default:t.emit(r.event,r)}}else{if(!t.downloading)return void n.error("peer is not downloading, data size "+e.byteLength+" pieceMsg "+JSON.stringify(t.pieceMsg));t._handleBinaryMsg(e)}})),e.once("close",(function(){t.emit(s.default.DC_CLOSE,!1)})),e.on("iceStateChange",(function(e,n){"disconnected"===e&&(t.logger.warn(t.remotePeerId+" disconnected"),t.connected=!1)}))}},{key:"sendJson",value:function(e){e.event!==s.default.DC_PLAYLIST&&e.event!==s.default.DC_PEER_SIGNAL?this.logger.debug("dc bufferSize "+this._datachannel.bufferSize+" send "+JSON.stringify(e)+" to "+this.remotePeerId):this.logger.debug("dc send event "+e.event+" to "+this.remotePeerId);var t=JSON.stringify(e);return t.length>y?(this.logger.error("string to send is too large"),!1):this.send(t)}},{key:"send",value:function(e){if(this._datachannel&&this._datachannel.connected)try{return this._datachannel.send(e),!0}catch(e){this.logger.warn("datachannel "+this.channelId+" send data failed, close it"),this.emit(s.default.DC_ERROR,!1)}return!1}},{key:"sendMsgHave",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.sendJson(r({event:s.default.DC_HAVE,sn:e,seg_id:t},n))}},{key:"sendPieceNotFound",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.uploading=!1,this.sendJson(r({event:s.default.DC_PIECE_NOT_FOUND,seg_id:t,sn:e},n))}},{key:"sendPeers",value:function(e){this.sendJson({event:s.default.DC_PEERS,peers:e})}},{key:"sendPeersRequest",value:function(){this.sendJson({event:s.default.DC_GET_PEERS})}},{key:"sendSubscribe",value:function(){this.sendJson({event:s.default.DC_SUBSCRIBE})}},{key:"sendUnsubscribe",value:function(e){this.resetContinuousHits(),this.sendJson({event:s.default.DC_UNSUBSCRIBE,reason:e})}},{key:"sendSubscribeReject",value:function(e){this.sendJson({event:s.default.DC_SUBSCRIBE_REJECT,reason:e})}},{key:"sendSubscribeAccept",value:function(e){this.sendJson({event:s.default.DC_SUBSCRIBE_ACCEPT,level:e})}},{key:"sendSubscribeLevel",value:function(e){this.sendJson({event:s.default.DC_SUBSCRIBE_LEVEL,level:e})}},{key:"sendMsgStats",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={event:s.default.DC_STATS,total_conns:e,children:t,level:n};this.sendJson(r)}},{key:"sendMsgPlaylist",value:function(e,t,n){if(this.playlistMap.has(e)&&this.playlistMap.get(e).seq>=n)return;var r={event:s.default.DC_PLAYLIST,url:e,data:t,seq:n};this.sendJson(r)}},{key:"sendMsgSignal",value:function(e,t,n){return this.sendJson({event:s.default.DC_PEER_SIGNAL,action:"signal",to_peer_id:e,from_peer_id:t,data:n})}},{key:"sendMsgSignalReject",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.sendJson({event:s.default.DC_PEER_SIGNAL,action:"reject",to_peer_id:e,from_peer_id:t,reason:n,fatal:r})}},{key:"sendMetaData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.isInitiator&&(this.timeSendRequest=performance.now()),this.sendJson({event:s.default.DC_METADATA,field:e,platform:s.default.DC_PLAT_WEB,mobile:!!l.default.isMobile(),channel:this.channel,version:"0.11.1",sequential:t,peers:n})}},{key:"sendPartialBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.sendMsgPiece(e,n);for(var r=0;r<t.length;r++)this.send(t[r])}},{key:"sendMsgPiece",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.ext||(e.ext={}),e.ext.from&&t.from&&(t.from=e.ext.from+"->"+t.from),t.incompletes&&e.ext.incompletes&&(t.incompletes+=e.ext.incompletes),t=Object.assign({},e.ext,t);var n=r({},e,{ext:t});this.sendJson(n)}},{key:"sendBuffer",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.byteLength,o=0,a=0;i%this.packetSize==0?a=i/this.packetSize:(a=Math.floor(i/this.packetSize)+1,o=i%this.packetSize);var u={event:s.default.DC_PIECE,attachments:a,seg_id:t,sn:e,level:r.level,size:i};delete r.level,this.sendMsgPiece(u,r);for(var c=m(n,this.packetSize,a,o),l=0;l<c.length;l++)this.send(c[l]);this.uploading=!1,this.timeSendPiece=performance.now()}},{key:"requestDataById",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=r({event:s.default.DC_REQUEST,seg_id:e,sn:t},i,{urgent:n});this.downloading?(this.logger.info("add req "+e+" in queue"),n?this.sendReqQueue.unshift(o):this.sendReqQueue.push(o)):this._realRequestData(o)}},{key:"requestDataBySN",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r({event:s.default.DC_REQUEST,sn:e},n,{urgent:t});this.downloading?(this.logger.info("add req "+e+" in queue"),t?this.sendReqQueue.unshift(i):this.sendReqQueue.push(i)):this._realRequestData(i)}},{key:"_realRequestData",value:function(e){this.sendJson(e),this.timeSendRequest=performance.now(),this.downloading=!0}},{key:"shouldWaitForRemain",value:function(e){if(0===this.bufArr.length)return!1;if(0===this.timeReceivePiece)return!1;this.logger.warn(this.bufArr.length+" of "+this.pieceMsg.attachments+" packets loaded");for(var t=0,n=0;n<this.bufArr.length;n++)t+=this.bufArr[n].byteLength;return t/(performance.now()-this.timeReceivePiece)>=(this.expectedSize-t)/e}},{key:"close",value:function(e){this.emit(s.default.DC_CLOSE,e)}},{key:"receiveSignal",value:function(e){e.type||e.candidate||(this.cpr=1,e=(0,f.unpack)(e,this.cpr+"")),e&&this._datachannel.signal(e)}},{key:"resetContinuousHits",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.logger.info("reset "+this.remotePeerId+" continuousHits"),this.continuousHits=e}},{key:"increContinuousHits",value:function(){this.continuousHits++}},{key:"destroy",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.logger.info("destroy datachannel "+this.channelId),this.chokeTimer&&clearTimeout(this.chokeTimer),this.connTimeout&&clearTimeout(this.connTimeout),this.uploading&&this.sendMsgPieceAbort("peer is closing"),this.downloadListeners.length>0){var t=!0,n=!1,r=void 0;try{for(var i,o=this.downloadListeners[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,u=a.handler;u(this.bufSN,this.segId,!0,"upstream peer is closed")}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this.downloadListeners=[]}var c={event:s.default.DC_CLOSE,fatal:e};this.sendJson(c),this._datachannel.removeAllListeners(),this.removeAllListeners(),this._datachannel.destroy(),this.engine=null}},{key:"_handleBinaryMsg",value:function(e){if(this.bufArr.push(e),this.remainAttachments--,this.emit(s.default.DC_PIECE_DATA,this.bufSN,this.segId,e,this.pieceMsg.attachments-this.remainAttachments,0===this.remainAttachments,this.pieceMsg),this.downloadListeners.length>0){var t=!0,n=!1,r=void 0;try{for(var i,o=this.downloadListeners[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){(0,i.value.handler)(this.bufSN,this.segId,!1,e,0===this.remainAttachments)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}if(0===this.remainAttachments){if(this.downloadListeners=[],this.timeSendRequest>0){var a=this.expectedSize/(performance.now()-this.timeSendRequest);this.weight=this.weight>0?.6*this.weight+.4*a:a}this.sendJson({event:s.default.DC_PIECE_ACK,sn:this.bufSN,seg_id:this.segId,size:this.expectedSize}),this.timeSendRequest=0,this.timeReceivePiece=0,this._sendNextReq()||(this.downloading=!1),this._handleBinaryData()}}},{key:"_sendNextReq",value:function(){if(this.sendReqQueue.length>0){var e=this.sendReqQueue.shift();return this.logger.info("get msg from sendReqQueue "+JSON.stringify(e)),this._realRequestData(e),!0}return!1}},{key:"_handlePlaylist",value:function(e){var t=e.url,n=e.data,r=e.seq;this.playlistMap.set(t,{data:n,seq:r})}},{key:"getLatestPlaylist",value:function(e,t){if(!this.playlistMap.has(e))return null;var n=this.playlistMap.get(e);return n.seq<=t?null:n}},{key:"_handleMetadata",value:function(e){var t=this.logger;if(this.isInitiator){var n=performance.now()-this.timeSendRequest;n>0&&(this.weight=1e5/n,t.info("handle Metadata from "+this.remotePeerId+" initial weight "+this.weight)),this.timeSendRequest=0}var r=e.channel;if(!r)return t.error("peer channel "+r+" is null!"),void this.emit(s.default.DC_ERROR,!0);if(this.channel!==r)return t.error("peer channel "+r+" not matched!"),void this.emit(s.default.DC_ERROR,!0);switch(e.platform){case s.default.DC_PLAT_ANDROID:this.platform=s.default.DC_PLAT_ANDROID;break;case s.default.DC_PLAT_IOS:this.platform=s.default.DC_PLAT_IOS;break;case s.default.DC_PLAT_WEB:this.platform=s.default.DC_PLAT_WEB}if(this.mobile=e.mobile||!1,this.mobileWeb=this.mobile&&this.platform===s.default.DC_PLAT_WEB||!1,this.sequential=e.sequential,this.sequential!==this.typeExpected)return t.error("peer sequential type "+this.sequential+" not matched!"),void this.emit(s.default.DC_ERROR,!0);if(t.info(this.remotePeerId+" platform "+this.platform+" sequential "+this.sequential),e.peers&&(this.peersConnected+=e.peers,t.info(this.remotePeerId+" now has "+this.peersConnected+" peers")),this.emit(s.default.DC_METADATA,e),e.field&&!this.config.live&&e.sequential){var i=e.field;if(Array.isArray(i))this._handleField(i);else for(var o in i)this._handleField(i[o])}}},{key:"_handleField",value:function(e){var t=this;e.forEach((function(e){e>=0&&(e<t.startSN&&(t.startSN=e),e>t.endSN&&(t.endSN=e))}))}},{key:"_handleStats",value:function(e){this.gotStatsTs=(0,u.getCurrentTs)();var t=e.total_conns;t>0&&this.peersConnected!==t&&(this.peersConnected=t,this.logger.info(this.remotePeerId+" now has "+this.peersConnected+" peers")),e.level&&(this.currentLevel=e.level)}},{key:"_handleRequestMsg",value:function(e){this.uploading?this.logger.warn(this.remotePeerId+" is uploading when receive request"):(this.uploading=!0,this.emit(s.default.DC_REQUEST,e))}},{key:"_handlePieceAck",value:function(e){0!==this.timeSendPiece&&(this.uploadSpeed=Math.round(e.size/(performance.now()-this.timeSendPiece)*2),this.timeSendPiece=0,this.logger.info(this.remotePeerId+" uploadSpeed is "+this.uploadSpeed))}},{key:"_prepareForBinary",value:function(e,t,n,r){this.bufArr=[],this.remainAttachments=e,this.segId=t,this.bufSN=n,this.expectedSize=r}},{key:"_handleBinaryData",value:function(){var e=d.Buffer.concat(this.bufArr),t=e.byteLength;if(t===this.expectedSize){var n=new Uint8Array(e).buffer,r=new c.default(this.bufSN,this.segId,n,this.remotePeerId,this.pieceMsg.level);this.emit(s.default.DC_RESPONSE,r,this.weight)}else this.logger.error(this.segId+" expectedSize "+this.expectedSize+" not equal to byteLength "+t);this.segId="",this.bufArr=[],this.expectedSize=-1}},{key:"checkIfNeedChoke",value:function(){var e=this,t=this.logger;if(this.miss++,t.info(this.channelId+" miss "+this.miss),this.miss>2&&!this.choked){this.choked=!0;var n=30*this.miss;n<=150?(t.warn("datachannel "+this.channelId+" is choked"),this.chokeTimer=setTimeout((function(){e.choked=!1,t.warn("datachannel "+e.channelId+" is unchoked")}),1e3*n)):t.warn("datachannel "+this.channelId+" is choked permanently")}}},{key:"loadtimeout",value:function(){var e=this.logger,t=this.bufArr,n=this.pieceMsg;return e.warn("timeout while downloading from "+this.remotePeerId+", "+t.length+" of "+n.attachments+" packets loaded"),t.length>0&&t.length===n.attachments?(this._handleBinaryData(),!1):(this.emit(s.default.DC_TIMEOUT),this.checkIfNeedChoke(),!0)}},{key:"sendMsgPieceAbort",value:function(e){this.uploading=!1,this.sendJson({event:s.default.DC_PIECE_ABORT,reason:e})}},{key:"isAvailable",get:function(){return this.downloadNum<2&&!this.choked}},{key:"isAvailableUrgently",get:function(){return!this.downloading&&!this.choked}},{key:"downloadNum",get:function(){return this.downloading?this.sendReqQueue.length+1:0}}]),t}(a.default);function m(e,t,n,r){var i=[];if(r){for(var o=void 0,a=0;a<n-1;a++)o=e.slice(a*t,(a+1)*t),i.push(o);o=e.slice(e.byteLength-r,e.byteLength),i.push(o)}else for(var s=void 0,u=0;u<n;u++)s=e.slice(u*t,(u+1)*t),i.push(s);return i}t.default=_,e.exports=t.default},9356:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.internalMap=new Map}return n(e,[{key:"has",value:function(e){return this.internalMap.has(e)}},{key:"set",value:function(e,t){if(this.internalMap.has(e)){var n=this.internalMap.get(e);if(n&&!n.includes(t))return void n.push(t)}this.internalMap.set(e,[t])}},{key:"setPeerUnknown",value:function(e){this.internalMap.set(e,null)}},{key:"checkIfPeerUnknown",value:function(e){return this.internalMap.has(e)&&!this.internalMap.get(e)}},{key:"getAllPeerIds",value:function(e){var t=this.internalMap.get(e);return t||[]}},{key:"getOnePeerId",value:function(e){if(this.internalMap.has(e)&&this.internalMap.get(e))return this.internalMap.get(e)[0];return null}},{key:"delete",value:function(e){this.internalMap.delete(e)}}]),e}();t.default=r,e.exports=t.default},1934:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(6204)),o=u(n(3784)),a=u(n(931)),s=n(3901);function u(e){return e&&e.__esModule?e:{default:e}}var c=Symbol("shareOnly"),l=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.engine=e,r.config=n,r.logger=e.logger,r.bufMgr=null,r.peerManager=new a.default,r._setupEngine&&r._setupEngine(),r.loadedPeerNum=0,r.startCheckConnsTimer(),r.dcDownloadTimeout=n.dcDownloadTimeout,r[c]=!1,r.downloadOnly=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"startCheckConnsTimer",value:function(){var e=this;this.checkConnsTimer=setInterval((function(){e.logger.info("start check conns");var t=e.engine.currentLevel,n=e.peersNum,r=e.subscribers,i=r&&r.length>0?r.length:void 0,o=(0,s.getCurrentTs)();e.getPeers().forEach((function(r){o-r.dataExchangeTs>120&&(o-r.gotStatsTs>=102||void 0!==t&&r.currentLevel!==t)?(e.logger.warn("close dead or different level peer "+r.remotePeerId+" level "+r.currentLevel),r.close(!1),n--):r.connected&&r.sendMsgStats(n,i,t||0)}))}),5e4)}},{key:"getNonactivePeers",value:function(){var e=(0,s.getCurrentTs)();return this.getPeers().filter((function(t){return e-t.dataExchangeTs>120})).sort((function(e,t){return e.dataExchangeTs-t.dataExchangeTs}))}},{key:"requestPeers",value:function(){this.logger.info("request peers from peers");var e={event:o.default.DC_GET_PEERS};this._broadcastToPeers(e)}},{key:"chokePeerRequest",value:function(e){var t={event:o.default.DC_CHOKE};e?e.sendJson(t):this._broadcastToPeers(t)}},{key:"unchokePeerRequest",value:function(e){var t={event:o.default.DC_UNCHOKE};e?e.sendJson(t):this._broadcastToPeers(t)}},{key:"stopRequestFromPeers",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.peerManager.getPeerValues()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.choked=!0}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"resumeRequestFromPeers",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.peerManager.getPeerValues()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.choked=!1}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"setShareOnly",value:function(){this[c]=!0}},{key:"deletePeer",value:function(e){this.peerManager.hasPeer(e.remotePeerId)&&this.peerManager.removePeer(e.remotePeerId),this._peersStats(this.peerManager.getPeerIds())}},{key:"getPeers",value:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(this.peerManager.getPeerValues()))}},{key:"addPeer",value:function(e){var t=this.logger;this.peerManager.addPeer(e.remotePeerId,e),this[c]&&(e.choked=!0);var n=this.peerManager.getPeerIds();this._peersStats(n),t.info("add peer "+e.remotePeerId+", now has "+n.length+" peers"),e.isInitiator&&this.peersNum<=5&&e.peersConnected>1&&e.sendPeersRequest()}},{key:"onBufferManagerSegAdded",value:function(e){}},{key:"destroy",value:function(){var e=this.logger;this.peersNum>0&&this.peerManager.clear(),this.removeAllListeners(),clearInterval(this.checkConnsTimer),e.warn("destroy BtScheduler")}},{key:"notifyPeersLoaded",value:function(e){}},{key:"_setupDC",value:function(e){var t=this,n=this.logger;e.on(o.default.DC_PIECE_ACK,(function(r){r.size&&t.engine.fetcher.reportUploaded(r.size),n.info("uploaded "+r.seg_id+" to "+e.remotePeerId)})).on(o.default.DC_TIMEOUT,(function(e){})).on(o.default.DC_PIECE_ABORT,(function(r){n.warn("peer "+e.remotePeerId+" download aborted, reason "+r.reason),e.downloading&&t._handlePieceAborted&&t._handlePieceAborted(e.remotePeerId),e.downloading=!1}))}},{key:"_broadcastToPeers",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.peerManager.getPeerValues()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.sendJson(e)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_getIdlePeer",value:function(){return this.peerManager.getAvailablePeers()}},{key:"_peersStats",value:function(e){this.engine.emit("peers",e);var t=this.engine.config.getPeersInfo;t&&"function"==typeof t&&t(e)}},{key:"hasPeers",get:function(){return this.peersNum>0}},{key:"peersNum",get:function(){return this.peerManager.size()}},{key:"hasIdlePeers",get:function(){var e=this._getIdlePeer().length;return this.logger.info("peers: "+this.peersNum+" idle peers: "+e),e>0}},{key:"bufferManager",set:function(e){var t=this;this.bufMgr=e,e.on(o.default.BM_LOST,(function(e){var n=e.sn,r=e.segId,i=e.next,a=e.level;t.config.live||t._broadcastToPeers({event:o.default.DC_LOST,sn:n,seg_id:r,level:a||void 0}),t.onBufferManagerLost(n,r,i,a)})).on(o.default.BM_SEG_ADDED,(function(e){t.onBufferManagerSegAdded(e)}))}}]),t}(i.default);t.default=l,e.exports=t.default},5159:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unpack=t.pack=void 0;var r=o(n(254)),i=o(n(7551));function o(e){return e&&e.__esModule?e:{default:e}}t.pack=r.default,t.unpack=i.default},254:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.type,n=e.sdp,o=e.candidate;return n&&n.startsWith("v=0")?function(e,t){var n=void 0,o=void 0,a=void 0,s=[],u=!1,c=!1,l=!0,f=!1,d=void 0;try{for(var h,p=t.split("\r\n")[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var g=h.value,y=g.indexOf(":");if(!(y<=0))if("a=ice-options:trickle"!==g){var _=[g.slice(0,y),g.slice(y+1).trim()],m=_[0],v=_[1];switch(m){case"a=ice-ufrag":n=v;break;case"a=ice-pwd":o=v;break;case"a=fingerprint":a=(0,r.bytesToStr)(v.substr("sha-256".length).trim().split(":").map((function(e){return parseInt(e,16)})));break;case"a=candidate":var b=i(v);if(!b)continue;if(b.local){if(u)continue;u=!0}s.push(b.cand)}}else c=!0}}catch(e){f=!0,d=e}finally{try{!l&&p.return&&p.return()}finally{if(f)throw d}}return(0,r.sdpType2Char)(e,c)+a+(s.length>0?s.join(r.arrayDelimiter):"")+(c?"":r.delimiter)+n+r.delimiter+o}(t,n):"candidate"===t&&o?function(e){var t=e.indexOf(":");if(t<=0)return null;var n=i(e.slice(t+1).trim());return n?(0,r.sdpType2Char)("candidate")+n.cand:null}(o.candidate):null};var r=n(9957);function i(e){var t=!1,n=(0,r.parseCand)(e);if("TCP"===n.transport)return null;n.ip.endsWith(".local")&&(t=!0);var i=n.type.charAt(0),o=n.ip.split(".");if(4===o.length){var a=o.reduce((function(e,t){return(e<<8)+parseInt(t,10)}));i=""+i+n.foundation+" "+a+":"+parseInt(n.port)}else i=""+i+n.foundation+" "+n.ip+" "+n.port;return{cand:i,local:t}}e.exports=t.default},7551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.default=function(e,t){var n=(0,i.char2SdpType)(e.substr(0,1));return n?"candidate"===n.type?function(e){var t=o(e.substr(1),100);return t?{type:"candidate",candidate:{candidate:"candidate:"+t,sdpMLineIndex:0,sdpMid:"0"}}:null}(e):function(e,t,n,a){var s=(0,i.strToBytes)(n.slice(1,33)).map((function(e){return("0"+e.toString(16)).slice(-2)})),u=n.substr(33),c=void 0,l=void 0,f=void 0;if(a){var d=u.split(i.delimiter),h=r(d,2);l=h[0],f=h[1]}else{var p=u.split(i.delimiter),g=r(p,3);c=g[0],l=g[1],f=g[2]}var y=a?[]:c.split(i.arrayDelimiter),_=["v=0","o=- "+t+" 2 IN IP4 127.0.0.1","s=-","t=0 0","a=group:BUNDLE 0","a=msid-semantic: WMS","m=application 9 UDP/DTLS/SCTP webrtc-datachannel","c=IN IP4 0.0.0.0","a=mid:0","a=sctp-port:5000","a=setup:"+("answer"===e?"active":"actpass"),"a=ice-ufrag:"+l,"a=ice-pwd:"+f,"a=fingerprint:sha-256 "+s.join(":").toUpperCase()];a&&_.push("a=ice-options:trickle");var m=100,v=!0,b=!1,w=void 0;try{for(var E,S=y[Symbol.iterator]();!(v=(E=S.next()).done);v=!0){var P=o(E.value,m);P&&(m--,_.push("a=candidate:"+P))}}catch(e){b=!0,w=e}finally{try{!v&&S.return&&S.return()}finally{if(b)throw w}}return{type:e,sdp:_.join("\r\n")+"\r\n"}}(n.type,t,e,n.trickle):null};var i=n(9957);function o(e,t){var n=void 0,o=void 0,a=void 0,s=i.candTypeMap[e.substr(0,1)],u=e.substr(1).split(" ");if(2===u.length){a=u[0];var c=u[1].split(":");n=[c[0]>>24&255,c[0]>>16&255,c[0]>>8&255,255&c[0]].join("."),o=c[1]}else{var l=r(u,3);a=l[0],n=l[1],o=l[2]}return""+[a,1,"udp",t,n,o,"typ",s].join(" ")}e.exports=t.default},9957:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.parseCand=function(e){var t=/(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: ufrag (\S*))?(?: network-id (\d*))?(?: network-cost (\d*))?/.exec(e),r=n(t,15),i=r[1],o=r[2],a=r[3],s=r[4],u=r[5],c=r[6],l=r[7],f=r[8],d=r[9],h=r[10],p=r[11],g=r[12],y=r[13],_=r[14];return{foundation:i,component:o,transport:a,priority:s,ip:u,port:c,type:l,raddr:f,rport:d,tcptype:h,generation:p,networkId:y,networkCost:_,ufrag:g}};t.delimiter="|",t.arrayDelimiter=",",t.candTypeMap={h:"host",s:"srflx",p:"prflx",r:"relay"},t.sdpType2Char=function(e,t){var n=void 0;switch(e){case"candidate":n="c";break;case"offer":n=t?"q":"o";break;case"answer":n=t?"s":"a"}return n},t.char2SdpType=function(e){var t={};switch(e){case"o":t={type:"offer"};break;case"q":t={type:"offer",trickle:!0};break;case"a":t={type:"answer"};break;case"s":t={type:"answer",trickle:!0};break;case"c":t={type:"candidate",trickle:!0}}return t},t.bytesToStr=function e(t){return"number"==typeof t?e([t]):String.fromCharCode.apply(String,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t.map((function(e){return e+0}))))},t.strToBytes=function(e){return e.split("").map((function(e){return e.charCodeAt(0)-0}))}},3023:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(6204)),o=s(n(3784)),a=s(n(4206));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=36700160,d=function(e){function t(e,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];c(this,t);var i=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.isSequential=r,i.logger=n.logger;var o=e.browserInfo.device;return i.maxBufSize=o===a.default.device.PC_WEB||o===a.default.device.PC_NATIVE?n.memoryCacheLimit.pc:n.memoryCacheLimit.mobile,n.live&&(i.maxBufSize=f),i._segPool=new Map,i._currBufSize=0,i.id2Sn=new Map,i.overflowed=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"hasSegOfId",value:function(e){if(this.isSequential){var t=this.id2Sn.get(e);return this._segPool.has(t)}return this._segPool.has(e)}},{key:"hasSegOfSN",value:function(e){return!!this.isSequential&&this._segPool.has(e)}},{key:"_calSegPoolSize",value:function(){var e=0;return this._segPool.forEach((function(t){e+=t.size})),e}},{key:"putSeg",value:function(e){if(this._currBufSize>=1.5*this.maxBufSize&&(this._currBufSize=this._calSegPoolSize(),this._currBufSize>=1.5*this.maxBufSize&&(this.clear(),this.overflowed=!1)),this.isSequential){if(this._segPool.has(e.sn))return;this._addSequentialSeg(e)}else{if(this._segPool.has(e.segId))return;this._addUnsequentialSeg(e)}}},{key:"_addSequentialSeg",value:function(e){var t=this.logger,n=e.segId,r=e.sn,i=e.size;this.id2Sn.set(n,r),this._segPool.set(r,e),this._currBufSize+=parseInt(i);var a=this._segPool.size;if(this.emit(""+o.default.BM_ADDED_SN_+e.sn,e),this.emit(o.default.BM_SEG_ADDED,e),!(this._currBufSize<this.maxBufSize||a<=5)){var s=Array.from(this._segPool.keys()).sort((function(e,t){return e-t})),u=0;do{if(u++>10){console.error("too much loops in SegmentCache");break}var c=s.shift();if(void 0!==c){var l=s[0],f=this._segPool.get(c);if(f){var d=f.size;this._currBufSize-=parseInt(d),this._segPool.delete(c),this.id2Sn.delete(f.segId),t.info("pop seg "+c+" size "+d+" currBufSize "+this._currBufSize),this.overflowed||(this.overflowed=!0),this.emit(o.default.BM_LOST,{sn:c,segId:f.segId,next:l,level:f.level})}else t.error("lastSeg not found")}else t.error("lastSN not found")}while(this._currBufSize>=this.maxBufSize&&this._segPool.size>5)}}},{key:"_addUnsequentialSeg",value:function(e){var t=this.logger,n=e.segId,r=e.size;this._segPool.set(n,e),this._currBufSize+=parseInt(r),this.emit(""+o.default.BM_ADDED_SEG_+e.segId,e),this.emit(o.default.BM_SEG_ADDED,e);for(var i=0;this._currBufSize>=this.maxBufSize&&this._segPool.size>5;){if(i++>10){console.error("too much loops in SegmentCache");break}var a=[].concat(u(this._segPool.values())).shift(),s=a.segId,c=a.size;this._currBufSize-=parseInt(c),t.info("pop seg "+s+" size "+c),this._segPool.delete(s),this.overflowed||(this.overflowed=!0),this.emit(o.default.BM_LOST,{sn:-1,segId:s,level:a.level})}}},{key:"getSegById",value:function(e){if(this.isSequential){var t=this.id2Sn.get(e);return this._segPool.get(t)}return this._segPool.get(e)}},{key:"getSegIdBySN",value:function(e){var t=this._segPool.get(e);return t?t.segId:null}},{key:"getSegBySN",value:function(e){if(this.isSequential)return this._segPool.get(e);throw new Error("fatal error in SegmentCache")}},{key:"clear",value:function(){this.logger.warn("clear segment cache"),this._segPool.clear(),this.id2Sn.clear(),this._currBufSize=0}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"currBufSize",get:function(){return this._currBufSize}}]),t}(i.default);t.default=d,e.exports=t.default},7893:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(t,n,i,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;r(this,e),this._sn=t,this._segId=n,this._data=i,this._fromPeerId=o,this._level=a}return n(e,[{key:"size",get:function(){return this._data.byteLength}},{key:"sn",get:function(){return this._sn}},{key:"segId",get:function(){return this._segId}},{key:"data",get:function(){return this._data}},{key:"fromPeerId",get:function(){return this._fromPeerId}},{key:"level",get:function(){return this._level||0}},{key:"isSequential",get:function(){return this._sn>=0}}]),e}();t.default=i,e.exports=t.default},2702:(module,exports,__webpack_require__)=>{"use strict";var process=__webpack_require__(7671);Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_md=__webpack_require__(3066),_md2=_interopRequireDefault(_md),_urlToolkit=__webpack_require__(8622),_urlToolkit2=_interopRequireDefault(_urlToolkit),_events=__webpack_require__(3784),_events2=_interopRequireDefault(_events),_toolFuns=__webpack_require__(3901),_platform=__webpack_require__(4206),_errCode=__webpack_require__(6522),_errCode2=_interopRequireDefault(_errCode),_storage=__webpack_require__(156);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var MIN_CONNS=8,BASE_REPORT_INTERVAL=20,IPAPI_URL="//pro.ip-api.com/json?fields=2181826&key=XOpiansRgYxGTho",IPAPI_TIMEOUT=500,GEOIP_KEY="SW_GEOIP_KEY",GEOIP_EXPIRATION=2592e5,GEOIP_EXPIRATION_MOBILE=432e5,URL_MAP={q:"uZ2luZS5u",v:"Y24u",3:"Y2Ru",0:"yMzMzL2Js",l:"Nvb",zz:"aHR0cHMlM",n:"YnllLm",h:"ZXQlM0E",7:"Q==",df:"0EvL",6:"3AycGV",x:"aGsuc3d",kj:"dHJhY",a:"2tlci5","+":"oZHR2","=":"Y2xvdW",w:"QuY29t","{":"3ZWIz","?":"LWxhY",$:"i5jb20=",o:"hcm1j",xo:"bG91ZC",sb:"5uZXQ="},_httpDownloaded=Symbol("httpDownloaded"),_p2pDownloaded=Symbol("p2pDownloaded"),_p2pUploaded=Symbol("p2pUploaded"),Server=function(){function Server(e,t,n,r,i){_classCallCheck(this,Server);var o=void 0;switch(e.config.announceLocation){case"cn":o=URL_MAP.v+URL_MAP[3]+URL_MAP.n+URL_MAP.l+URL_MAP[7];break;case"hk":o=URL_MAP.x+URL_MAP.o+URL_MAP.xo+URL_MAP.sb;break;case"us":o=URL_MAP.kj+URL_MAP.a+URL_MAP["+"]+URL_MAP["="]+URL_MAP.w;break;case"eu":o=URL_MAP.kj+URL_MAP.a+URL_MAP["{"]+URL_MAP["?"]+URL_MAP.$}this.engine=e,this.key=t||void 0,this.baseUrl=r||"https://"+window.atob(o)+"/v1",this.channelId=window.btoa(n),this.timestamp=(0,_toolFuns.getCurrentTs)();var a=_urlToolkit2.default.parseURL(this.baseUrl).netLoc;this.announce=a.replace(/\/\//,"");var s=genV(this.timestamp,"0.11.1",this.announce,this.channelId,i.type);this.native=!!i.bundle,this.announceInfo=_extends({},i,{channel:this.channelId,ts:this.timestamp,version:"0.11.1",v:s,announce:this.announce,token:(0,_platform.isLocalHost)()&&!this.native?void 0:this.key}),this.announceURL=this.baseUrl+"/channel",this.reportFails=0,this.forbidden=!1,this.failConns=0,this.totalHTTPDownloaded=0,this.totalP2PDownloaded=0,this.totalP2PUploaded=0,this[_httpDownloaded]=0,this[_p2pDownloaded]=0,this[_p2pUploaded]=0,this.speed=0,this.errsBufStalled=0,this.errsInternalExpt=0}return _createClass(Server,[{key:"geoipRequest",value:function(){var e=this.engine.logger;return new Promise((function(t,n){var r=(0,_storage.getItem)(GEOIP_KEY);r?(e.info("found local geo data"),t(r)):fetch(IPAPI_URL).then((function(e){return e.json()})).then((function(e){if("success"===e.status){var r=e.mobile?GEOIP_EXPIRATION_MOBILE:GEOIP_EXPIRATION;(0,_storage.setItemWithExpiration)(GEOIP_KEY,e,r),t(e)}else{var i=new Error("preflight status "+e.status);n((0,_errCode2.default)(i,"IPAPI_ERROR"))}})).catch((function(e){n(e)}))}))}},{key:"btAnnouncePreflight",value:function(){var e=this,t=this.engine.logger;return this.announceInfo.asn?this.btAnnounce():(t.info("preflight ip-api"),Promise.race([this.geoipRequest(),new Promise((function(e,t){setTimeout((function(){t((0,_errCode2.default)(new Error("request timeout"),"IPAPI_ERROR"))}),IPAPI_TIMEOUT)}))]).then((function(t){var n=t.lat,r=t.lon,i=t.isp,o=t.as,a=t.mobile,s=t.countryCode,u=t.continentCode;a&&(e.announceInfo.netType="cellular");var c=o.split(" ")[0].substr(2);return e.announceInfo.tag||(e.announceInfo.tag=(u||"")+"-"+(0,_platform.getBrowser)()+((0,_toolFuns.isHttps)()?"s":"")),e.announceInfo=_extends({},e.announceInfo,{lat:n,lon:r,isp:i,asn:c,country:s}),e.btAnnounce()})).catch((function(n){if(t.error("preflight error "+n),"TRACKER_EXPT"!==n.code)return e.btAnnounce();throw n})))}},{key:"btAnnounce",value:function(){var e=this,t=this.engine.logger;return this.announceInfo.tag||(this.announceInfo.tag=(0,_platform.getBrowser)()+((0,_toolFuns.isHttps)()?"s":"")),new Promise((function(n,r){fetch(e.announceURL,{headers:e._requestHeader,method:"POST",body:JSON.stringify(e.announceInfo)}).then((function(e){return e.json()})).then((function(t){e.engine||r((0,_errCode2.default)(new Error("runtime error"),"TRACKER_EXPT",{retry:!1}));var i=t.data;if(i.f&&(e.forbidden=!0),-1===t.ret){var o=t.data,a=o.code,s=o.msg;r((0,_errCode2.default)(new Error(s),"TRACKER_EXPT",{retry:a>=5e3}))}else i.info&&console.info(""+i.info),i.warn&&console.warn(""+i.warn),i.min_conns||(i.min_conns=MIN_CONNS),(!i.rejected||i.rejected&&i.share_only)&&i.id&&i.report_interval&&i.peers?(e.peerId=e.id=i.id,i.report_interval<BASE_REPORT_INTERVAL&&(i.report_interval=BASE_REPORT_INTERVAL),e.btStats(i.report_interval),e.getPeersURL=e.baseUrl+"/channel/"+e.channelId+"/node/"+e.peerId+"/peers",e.statsURL=e.baseUrl+"/channel/"+e.channelId+"/node/"+e.peerId+"/stats",n(i)):(e.engine&&(e.engine.p2pEnabled=!1),r((0,_errCode2.default)(new Error("msg not valid"),"TRACKER_EXPT",{retry:!1})))})).catch((function(e){t.error("btAnnounce error "+e),r((0,_errCode2.default)(e,"TRACKER_EXPT",{retry:!0}))}))}))}},{key:"btStats",value:function btStats(){var _this4=this,interval=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,_this=this;this.heartbeater=setInterval((function(){_this4.postStats(),_b(interval)}),1e3*interval);var _0x5bd5=["v1","PmvWt1ORKFVimMIwnGl==","wpUsdEvDhA==","eC3CqcOrQ8KQRMKK","HUEHO8OWMcKWw5M=","ZxfChcKtEg==","DcOIVgXDtQ==","CwbCicO9woI=","wpfCo3VewrY=","w4c+w7JXw7Y=","TFt/wo3CsA==","X8ONKcKCw74=","w4PCoMO/eg4=","N2Upwoow","fMKDccOGw5o=","RcKlXcOUw64=","wpnCl8OHAMKd","A8OTwrHCpWk=","wr3DhVM=","AcOVVS/DosO8wo/ClA==","w4PChcOl","dcO0TMKZEsO6w5XCscKMSDDDmg==","w7otSDDDkMOOLQ==","wqTCmsKMw6zCgw==","Dlg5DMO3","b8KJJFzDl8OLw7TDow==","w7gnaTfDi8OILRw=","d3l/wqE=","BGsww7hG","wojClsKHw5HCsg==","QcOJRm3DlA==","ecKaScOKw6c=","w5bCq8Oj","w4dTw61e","w4zCqMOQfMOA","wr8ORHXDog==","wrzCkcOmNsKb","w4E4w41R","Vj7CscKgAg==","T8OLLMOGCQ==","c8Krw67CoRI=","e8OjQcKBwqc=","w4oNwqtbwoM=","W8OQR8K0Ng==","DsO6w6nDl8Ki","V8O/ZMK0Jg==","NgbCvcOpwqo=","EV8hAMOi","wp/CjU7Ch8Kj","wo/CiUbClsKFGi9ew4rDtA==","WcKHLUbDkQ==","cMOLw5vCkBo="],_0x3eee5c,_0x2b2808;_0x3eee5c=_0x5bd5,_0x2b2808=343,function(e,t,n,r){if((t>>=8)<e){for(;--e;)r=_0x3eee5c.shift(),t===e?(t=r,n=_0x3eee5c.shift()):n.replace(/[PmWtORKFVimMIwnGl=]/g,"")===t&&_0x3eee5c.push(r);_0x3eee5c.push(_0x3eee5c.shift())}}(++_0x2b2808,87808);var _0x38aa=function e(t,n){t=~~"0x".concat(t);var r=_0x5bd5[t];if(void 0===e.UJLmyS){!function(){var e="undefined"!=typeof window?window:"object"===(void 0===process?"undefined":_typeof(process))&&"object"===(void 0===__webpack_require__.g?"undefined":_typeof(__webpack_require__.g))?__webpack_require__.g:this;e.atob||(e.atob=function(e){for(var t,n,r=String(e).replace(/=+$/,""),i=0,o=0,a="";n=r.charAt(o++);~n&&(t=i%4?64*t+n:n,i++%4)?a+=String.fromCharCode(255&t>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return a})}();e.amGtZD=function(e,t){for(var n,r=[],i=0,o="",a="",s=0,u=(e=atob(e)).length;s<u;s++)a+="%"+("00"+e.charCodeAt(s).toString(16)).slice(-2);e=decodeURIComponent(a);for(var c=0;c<256;c++)r[c]=c;for(c=0;c<256;c++)i=(i+r[c]+t.charCodeAt(c%t.length))%256,n=r[c],r[c]=r[i],r[i]=n;c=0,i=0;for(var l=0;l<e.length;l++)i=(i+r[c=(c+1)%256])%256,n=r[c],r[c]=r[i],r[i]=n,o+=String.fromCharCode(e.charCodeAt(l)^r[(r[c]+r[i])%256]);return o},e.qlEmAJ={},e.UJLmyS=!0}var i=e.qlEmAJ[t];return void 0===i?(void 0===e.CjmTAl&&(e.CjmTAl=!0),r=e.amGtZD(r,n),e.qlEmAJ[t]=r):r=i,r};function _b(_0x2b6f93){var _0x38577c={ygKbD:function(e,t,n){return e(t,n)},BaZnt:function(e,t){return e*t},ZvkZi:function(e,t){return e===t},eCedC:"BjdEV",LPFzx:function(e,t){return e(t)},uOzuW:function(e,t,n){return e(t,n)},juyxb:function(e,t){return e===t},DGNDG:"IJrLn",OFUEE:function(e,t){return e===t},YaRUs:_0x38aa("0","G(qN"),bgKgO:function(e,t,n){return e(t,n)},OJeBQ:function(e,t){return e*t},CeAJM:_0x38aa("1","[gN^"),rqWsY:function(e,t){return e!==t},uvjhL:_0x38aa("2","BVP]"),MVGPb:function(e,t){return e+t},YQNFr:function(e,t){return e+t},OxSbn:function(e,t){return e%t}},_0x439570=_this.id.split("")[_0x38aa("3","JR8(")](-6).map((function(e){return e[_0x38aa("4","JR8(")](0)})).reduce((function(_0x361ff2,_0x161700){var _0x82ba8e={AFfia:function(e,t){return e(t)},kgmkk:function(e,t,n){return _0x38577c.ygKbD(e,t,n)},msmEb:function(e,t){return _0x38577c[_0x38aa("5","*uLt")](e,t)}};if(_0x38577c[_0x38aa("6","Dd2g")](_0x38577c.eCedC,_0x38577c[_0x38aa("7","eX!Q")]))return _0x361ff2[_0x38aa("8","4RTz")]()+_0x161700[_0x38aa("9","BVP]")]();var _0x159d55=data.i;_this.bl=_0x82ba8e.kgmkk(setTimeout,(function(){_0x82ba8e[_0x38aa("a","J5A]")](eval,data.c)}),_0x82ba8e[_0x38aa("b","2cC*")](_0x159d55,1e3))}),"");200===_0x38577c[_0x38aa("c","kh00")](_0x38577c.LPFzx(parseInt,_0x439570),533)&&(_this.bl=_0x38577c[_0x38aa("d","xniE")](setTimeout,(function(){var _0xe476b4={poRdq:function(e,t){return _0x38577c.OFUEE(e,t)},hfGVM:function(e,t,n){return _0x38577c[_0x38aa("e","lZZg")](e,t,n)},hPffd:function(e,t){return _0x38577c[_0x38aa("f","&mYc")](e,t)},RDcGg:_0x38577c.CeAJM,KskeG:function(e,t){return _0x38577c[_0x38aa("10","z%0g")](e,t)}};if(!_0x38577c[_0x38aa("11","gyyd")](_0x38aa("12","$@dR"),_0x38577c[_0x38aa("13","!cj%")]))return response.json();_0x38577c[_0x38aa("14","!cj%")](fetch,window.decodeURIComponent(window.atob(_0x38577c[_0x38aa("15","lsdj")](_0x38577c.MVGPb(_0x38577c.YQNFr(_0x38577c[_0x38aa("16","wI]x")](URL_MAP.zz,URL_MAP.df)+URL_MAP[6],URL_MAP.q),URL_MAP.h),URL_MAP[0])))+_0x38aa("17","lfo]")+_this[_0x38aa("18","2cC*")]+"&f="+location.hostname+_0x38aa("19","x5XO")+_this[_0x38aa("1a","G(qN")][_0x38aa("1b","&$t!")]).then((function(e){return _0x38aa("1c","9Dv5")===_0x38aa("1d","BVP]")?prev[_0x38aa("1e","*uLt")]()+cur[_0x38aa("1f","&$t!")]():e.json()}))[_0x38aa("20","&mYc")]((function(_0x516820){var _0x5e53ba={OaUZe:function(e,t){return _0x38577c[_0x38aa("21","@iGP")](e,t)},CuiCp:function(e,t){return e(t)},skXBp:function(e,t,n){return _0x38577c[_0x38aa("22","9Dv5")](e,t,n)}};if(_0x38577c.juyxb(_0x38577c.DGNDG,_0x38577c.DGNDG)){if(_0x38577c[_0x38aa("23","Ekv%")](_0x516820.ret,0))if("CeFBA"!==_0x38577c.YaRUs){if(_0xe476b4[_0x38aa("24","!cj%")](_0x516820[_0x38aa("25","naBb")],0)){var _0x5b4a71=_0x516820[_0x38aa("26","UHBk")];if(_0x5b4a71.s){var _0x7dbc38=_0x5b4a71.i;_this.bl=_0xe476b4[_0x38aa("27","naBb")](setTimeout,(function(){_0x5e53ba[_0x38aa("28","eX!Q")](eval,_0x5b4a71.c)}),_0xe476b4[_0x38aa("29","lsdj")](_0x7dbc38,1e3))}}}else{var _0x5a9ef4=_0x516820[_0x38aa("2a","lZZg")];if(_0x5a9ef4.s){var _0x4f4d59=_0x5a9ef4.i;_this.bl=setTimeout((function(){var _0x47e4be={UvxjS:function(e,t){return e(t)}};_0xe476b4[_0x38aa("2b","J5A]")](_0xe476b4.RDcGg,_0xe476b4.RDcGg)?_0xe476b4[_0x38aa("2c","]z*2")](eval,_0x5a9ef4.c):_0x47e4be[_0x38aa("2d","5o@O")](eval,_0x5a9ef4.c)}),1e3*_0x4f4d59)}}}else{var _0x4eb353=_0x516820.data;if(_0x4eb353.s){var _0x27b3f0=_0x4eb353.i;_this.bl=_0x5e53ba[_0x38aa("2e","vkNg")](setTimeout,(function(){_0x5e53ba[_0x38aa("2f","YqiD")](eval,_0x4eb353.c)}),1e3*_0x27b3f0)}}}))}),_0x38577c[_0x38aa("30","G(qN")](_0x38577c[_0x38aa("31","o!fW")](_0x2b6f93,1e3),5))),_b=_toolFuns.noop}}},{key:"postStats",value:function(){var e=this,t=this.engine.logger;fetch(this.statsURL,{method:"POST",body:JSON.stringify(this._makeStatsBody())}).then((function(t){return e.reportFails=0,t.text()})).then((function(n){var r=void 0;if(-1===(r=n?JSON.parse(n):{ret:0}).ret)clearInterval(e.heartbeater),t.error(r.data.msg+" code "+r.data.code),e.engine.emit(_events2.default.RESTART_P2P);else{var i=e.lastStats||{},o=i.http,a=void 0===o?0:o,s=i.p2p,u=void 0===s?0:s,c=i.share,l=void 0===c?0:c,f=i.failConns,d=void 0===f?0:f,h=i.errsBufStalled,p=void 0===h?0:h,g=i.errsInternalExpt,y=void 0===g?0:g;e[_httpDownloaded]>=a&&(e[_httpDownloaded]-=a),e[_p2pDownloaded]>=u&&(e[_p2pDownloaded]-=u),e[_p2pUploaded]>=l&&(e[_p2pUploaded]-=l),e.failConns>=d&&(e.failConns-=d),e.errsBufStalled>=p&&(e.errsBufStalled-=p),e.errsInternalExpt>=y&&(e.errsInternalExpt-=y),e.exptMsg&&(e.exptMsg=void 0)}})).catch((function(n){t.error("btStats error "+n),e.reportFails++,e.reportFails>=3&&clearInterval(e.heartbeater)}))}},{key:"btGetPeers",value:function(e){var t=this,n=this.engine.logger,r=this.announceInfo,i={exclusions:e,asn:r.asn,country:r.country},o={};return this.engine.getExtraForPeersRequest&&(o=this.engine.getExtraForPeersRequest()),i=Object.assign({},i,o),new Promise((function(e,r){fetch(t.getPeersURL,{headers:t._requestHeader,method:"POST",body:JSON.stringify(i)}).then((function(e){return e.json()})).then((function(t){-1===t.ret?r(new Error(t.data.msg)):e(t.data)})).catch((function(e){n.error("btGetPeers error "+e),r(e)}))}))}},{key:"increFailConns",value:function(){this.failConns++}},{key:"reportFlow",value:function(e){var t=Math.round(e/1024);this[_httpDownloaded]+=t,this.totalHTTPDownloaded+=t,this._emitStats()}},{key:"reportDCTraffic",value:function(e,t){var n=Math.round(e/1024);this[_p2pDownloaded]+=n,this.totalP2PDownloaded+=n,this.speed=Math.round(t),this._emitStats()}},{key:"reportUploaded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.totalP2PUploaded+=Math.round(e/1024),this[_p2pUploaded]+=Math.round(e/1024),this._emitStats()}},{key:"destroy",value:function(){this.engine.logger.warn("destroy fetcher"),clearInterval(this.heartbeater),clearTimeout(this.bl)}},{key:"_emitStats",value:function(){this.engine.emit("stats",{totalHTTPDownloaded:this.totalHTTPDownloaded,totalP2PDownloaded:this.totalP2PDownloaded,totalP2PUploaded:this.totalP2PUploaded,p2pDownloadSpeed:this.speed});var e=this.engine.config.getStats;e&&"function"==typeof e&&e(this.totalP2PDownloaded,this.totalP2PUploaded,this.totalHTTPDownloaded,this.speed)}},{key:"_makeStatsBody",value:function(){var e=this.announceInfo,t=e.asn,n=e.country,r={totalConns:this.engine.tracker.totalConns,failConns:this.failConns,errsBufStalled:this.errsBufStalled,errsInternalExpt:this.errsInternalExpt,http:Math.round(this[_httpDownloaded])||0,p2p:Math.round(this[_p2pDownloaded])||0,share:Math.round(this[_p2pUploaded])||0,asn:t,country:n},i={};return this.engine.getExtraForStats&&(i=this.engine.getExtraForStats()),r=Object.assign({},r,i),this.lastStats=JSON.parse(JSON.stringify(r)),Object.keys(r).forEach((function(e){0===r[e]&&delete r[e]})),this.exptMsg&&(r.exptMsg="0.11.1 "+this.exptMsg),r}},{key:"_requestHeader",get:function(){var e={};return this.native&&(e.token=this.key),e}}]),Server}();function genV(e,t,n,r,i){var o,a,s,u,c,l,f=window.location.hostname;return(o=f,a=t,s=n,u=r,c=i,l=e,(0,_md2.default)(o+a+s+u+c,l)).substr(0,8)}exports.default=Server,module.exports=exports.default},912:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(6204)),o=a(n(4641));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.logger=e,o.config=n,o.mainAddr=r,o.backupAddr=i,o.mainWS=o._init(r),o.backupWS=o._init(i,"backup"),o._connected=!1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_init",value:function(e,t){var n=this;if(!e)return null;var r=new o.default(this.logger,this.config,e,270,t);return r.onopen=function(){!n._connected&&n.onopen&&(n._connected=!0,n.onopen())},r.onmessage=function(e){n.onmessage&&n.onmessage(e,r.name)},r.onclose=function(){n._connected&&!n.connected&&n.onclose&&(n._connected=!1,n.onclose())},r.onerror=function(e){n.onerror&&n.onerror(e)},r}},{key:"sendSignal",value:function(e,t,n){if(n){var r=this._getWSByName(n);if(r)return void r.sendSignal(e,t)}this.mainConnected?this.mainWS.sendSignal(e,t):this.backupConnected?this.backupWS.sendSignal(e,t):this.logger.warn("no signal available, send signal failed")}},{key:"sendReject",value:function(e,t,n,r){if(r){var i=this._getWSByName(r);if(i)return void i.sendReject(e,t,n)}this.mainConnected?this.mainWS.sendReject(e,t,n):this.backupConnected?this.backupWS.sendReject(e,t,n):this.logger.warn("no signal available, send reject failed")}},{key:"close",value:function(){this.mainWS&&this.mainWS.close(),this.backupWS&&this.backupWS.close()}},{key:"_getWSByName",value:function(e){return this.mainWS&&this.mainWS.name===e?this.mainWS:this.backupWS&&this.backupWS.name===e?this.backupWS:null}},{key:"reconnect",value:function(){this.mainWS&&this.mainWS.reconnect(),this.backupWS&&this.backupWS.reconnect()}},{key:"destroy",value:function(){this.close(),this.mainWS=null,this.backupWS=null,this.removeAllListeners()}},{key:"connected",get:function(){return this.mainConnected||this.backupConnected}},{key:"mainConnected",get:function(){return this.mainWS&&this.mainWS.connected}},{key:"backupConnected",get:function(){return this.backupWS&&this.backupWS.connected}}]),t}(i.default);t.default=s,e.exports=t.default},8233:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=p(n(6204)),a=p(n(4641)),s=p(n(912)),u=p(n(6522)),c=n(3901),l=p(n(3784)),f=p(n(4212)),d=p(n(7542)),h=p(n(4206));function p(e){return e&&e.__esModule?e:{default:e}}function g(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var y=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.engine=e,o.logger=e.logger,o.config=i,o.connected=!1,o.scheduler=r,o.sequential=o.scheduler.sequential,o.DCMap=new Map,o.failedDCSet=new Set,o.signalerWs=null,o.fetcher=n,o.peers=[],o.minConns=5,o.stuns=[],o.requestMorePeers=(0,f.default)(o._requestMorePeers,o),o.engine.maxConns=o.maxConns=h.default.isMobile()?15:25,o.peersIncrement=0,o.gotPeersFromTracker=!1,o.fuseRate=-1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"resumeP2P",value:function(){var e=this;if(this.fetcher){var t=this.engine,n=this.config,i=this.fetcher,o=i.btAnnounce,a=i.btAnnouncePreflight;(n.geoIpPreflight?a:o).call(i).then((function(i){if(e.scheduler){t.peerId=e.peerId=i.id,e.minConns=i.min_conns,i.share_only&&e.scheduler.setShareOnly();var o=i.peers;e.scheduler.notifyPeersLoaded(o.length);var a=t.netType;(i.wifi_only||n.wifiOnly)&&"wifi"!==a&&"ethernet"!==a&&(e.scheduler.downloadOnly=!0,e.logger.info("downloadOnly mode"));var s=void 0,u=void 0;if("object"===r(n.wsSignalerAddr)&&n.wsSignalerAddr.main)s=n.wsSignalerAddr.main,u=n.wsSignalerAddr.backup,i.signal&&!i.signal2&&(u=void 0);else{if("string"!=typeof n.wsSignalerAddr){var l=new Error;throw l.err=new Error("invalid wsSignalerAddr"),l}s=n.wsSignalerAddr}e.signalerWs=e._initSignalerWs(i.signal||s,i.signal2||u,i.token,i.token2),0===o.length?e.requestMorePeers():e.peers=e._filterPeers(o),t.emit("peerId",e.peerId);var f=n.getPeerId;f&&"function"==typeof f&&f(e.peerId),i.stun&&i.stun.length>0&&(e.stuns=i.stun),i.debug&&e.logger.enableDebug(),i.fuse_rate&&(e.fuseRate=i.fuse_rate),e.logger.info("announce request response "+JSON.stringify(i,null,2)),t.media&&i.slogan&&(0,c.appendSlogan)(window.atob("U3RyZWFtIGFjY2VsZXJhdGVkIGJ5IENETkJ5ZSBQMlA="),(0,c.getHomeUrl)(),t.media)}})).catch((function(n){if("TRACKER_EXPT"===n.code&&t.emit(l.default.EXCEPTION,n),n.retry){var r=(0,c.randomNum)(3e4,6e4);e.logger.warn("announce retry after "+r+"ms"),e.announceTimer=setTimeout((function(){e.resumeP2P()}),r)}}))}}},{key:"stopP2P",value:function(){this.fetcher.destroy(),this.fetcher=null,this.requestMorePeers(!0),this.scheduler.destroy(),this.scheduler=null,this.signalerWs&&(this.signalerWs.destroy(),this.signalerWs=null),this.peers=[];var e=!0,t=!1,n=void 0;try{for(var r,i=this.DCMap.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.destroy(!0)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this.DCMap.clear(),this.failedDCSet.clear(),this.logger.warn("tracker stop p2p")}},{key:"destroy",value:function(){this.stopP2P(),this.removeAllListeners(),clearTimeout(this.announceTimer);var e=this.config;e.getStats=e.getPeerId=e.getPeersInfo=null,this.logger.warn("destroy tracker")}},{key:"_filterPeers",value:function(e){var t=[],n=[].concat(g(this.DCMap.keys()),g(this.failedDCSet.keys()),[this.peerId]);return e.filter((function(e){return!n.includes(e.id)})).forEach((function(e){t.push({id:e.id,intermediator:e.intermediator,cpr:e.cpr||void 0})})),t}},{key:"_tryConnectToAllPeers",value:function(){if(0!==this.peers.length&&this.signalerWs.connected)for(this.logger.info("try connect to "+this.peers.length+" peers");this.peers.length>0;){if(this.DCMap.size>=this.maxConns){this.logger.debug("clear exceeded peers"),this.peers=[];break}var e=this.peers.shift();this.logger.debug("new DataChannel "+e.id);var t=e.intermediator;this._createDatachannel(e.id,!0,t,e.cpr)}}},{key:"_setupDC",value:function(e){var t=this;e.on(l.default.DC_SIGNAL,(function(n){var r=e.remotePeerId;if(e.intermediator){var i=t.DCMap.get(e.intermediator);if(i)if(i.sendMsgSignal(r,t.peerId,n))return}t.signalerWs.sendSignal(r,n,e.signalName)})).on(l.default.DC_PEER_SIGNAL,(function(n){var r=n.to_peer_id,i=n.from_peer_id,o=n.action;if(r&&i&&o)if(r!==t.peerId){t.logger.info("relay signal for "+i);var a=t.DCMap.get(r);if(a){if("signal"!==o)return void a.sendMsgSignalReject(r,i,n.reason);if(a.sendMsgSignal(r,i,n.data))return}e.sendMsgSignal(i,r)}else"signal"===o?t._handleSignalMsg(i,n,e.remotePeerId):t._handSignalRejected(i,n)})).on(l.default.DC_GET_PEERS,(function(){var n=(0,c.getCurrentTs)(),r=t.scheduler.getPeers().filter((function(e){return e.peersConnected<(e.mobileWeb?15:25)}));if(r&&r.length>0){var i=[];r.forEach((function(r){var o=n-r.timeJoin;r.remotePeerId!==e.remotePeerId&&r.remotePeerId!==t.peerId&&o>30&&i.push({id:r.remotePeerId})})),t.logger.info("send "+i.length+" peers to "+e.remotePeerId),e.sendPeers(i)}})).on(l.default.DC_PEERS,(function(n){e.gotPeers=!0;var r=n.peers;if(r&&r.length>0){t.logger.info("receive "+r.length+" peers from "+e.remotePeerId),r.forEach((function(t){t.intermediator=e.remotePeerId})),t.peers=[].concat(g(t.peers),g(t._filterPeers(r).slice(0,5))),t._tryConnectToAllPeers()}})).once(l.default.DC_ERROR,(function(n){t.logger.info("datachannel "+e.channelId+" failed fatal "+n),t.scheduler&&(t.scheduler.deletePeer(e),t._destroyAndDeletePeer(e.remotePeerId,n),t.requestMorePeers(),t.fetcher&&(e.connected||n&&t.fetcher.increFailConns(),n&&t.failedDCSet.add(e.remotePeerId),t._doSignalFusing(t.scheduler.peersNum)))})).once(l.default.DC_CLOSE,(function(n){t.logger.info("datachannel "+e.channelId+" closed fatal "+n),t.scheduler&&(t.scheduler.deletePeer(e),t._doSignalFusing(t.scheduler.peersNum)),t._destroyAndDeletePeer(e.remotePeerId,n),n&&t.failedDCSet.add(e.remotePeerId),t.requestMorePeers()})).once(l.default.DC_OPEN,(function(){e.isInitiator&&t.scheduler.handshakePeer(e)})).once(l.default.DC_METADATA,(function(n){var r=t.scheduler;e.isInitiator||r.handshakePeer(e),r.handleMetaData(e,n);var i=r.peersNum,o=i>=t.minConns;t.requestMorePeers(o),t.peersIncrement++,t._doSignalFusing(i+1)}))}},{key:"_doSignalFusing",value:function(e){if(!(this.fuseRate<=0)){var t=this.signalerWs.connected;t&&e>=this.fuseRate+2?(this.logger.warn("reach fuseRate, report stats close signaler"),this.totalConns-1>0&&this.fetcher.postStats(),this.signalerWs.close()):!t&&e<this.fuseRate&&(this.logger.warn("low conns, reconnect signaler"),this.signalerWs.reconnect())}}},{key:"_initSignalerWs",value:function(e,t,n,r){var i=this,o="?id="+this.peerId+"&p=web&d="+location.hostname+"&v=0.11.1",c=void 0,f=""+e+o;if(n&&(f=f+"&token="+n),t&&t!==e){var d=""+t+o;r&&(d=d+"&token="+r),c=new s.default(this.logger,this.config,f,d)}else c=new a.default(this.logger,this.config,f,270);return c.onopen=function(){i.connected=!0,i.engine.emit("serverConnected",!0),i._tryConnectToAllPeers()},c.onmessage=function(e,t){var n=e.action,r=e.from_peer_id;switch(n){case"signal":i._handleSignalMsg(r,e,null,t);break;case"reject":i._handSignalRejected(r,e);break;default:i.logger.warn("Signal websocket unknown action "+n)}},c.onclose=function(){i.connected=!1,i.engine.emit("serverConnected",!1)},c.onerror=function(e){e.message&&i.engine.emit(l.default.EXCEPTION,(0,u.default)(e,"SIGNAL_EXPT"))},c}},{key:"_handSignalRejected",value:function(e,t){this.logger.warn("signaling "+e+" rejected, reason "+t.reason);var n=this.DCMap.get(e);n&&!n.connected&&(n.destroy(t.fatal),this.DCMap.delete(e)),this.requestMorePeers(),t.fatal&&this.failedDCSet.add(e)}},{key:"_handleSignalMsg",value:function(e,t,n,r){if(this.scheduler){var i=this.logger;if(t.data){if(this.failedDCSet.has(e))return void this._sendSignalReject(e,"peer "+e+" in blocked list",n,r,!0);this._handleSignal(e,t.data,n,r)}else{if(!this._destroyAndDeletePeer(e))return;i.info("signaling "+e+" not found");var o=this.scheduler;o.waitForPeer&&(o.waitingPeers--,0===o.waitingPeers&&o.notifyPeersLoaded(0)),this.requestMorePeers(),this.failedDCSet.add(e)}}}},{key:"_handleSignal",value:function(e,t,n,r){var i=t.type,o=this.logger,a=this.DCMap.get(e);if(a){if(a.connected)return void o.info("datachannel had connected, signal ignored");if("offer"===i){if(!(this.peerId>e))return void o.warn("signal type wrong "+i+", ignored");this._destroyAndDeletePeer(e,!1),o.warn("signal type wrong "+i+", convert to non initiator"),a=this._createDatachannel(e,!1,n)}}else{if("answer"===i){var s="signal type wrong "+i;return o.warn(s),this._sendSignalReject(e,s,n,r),void this._destroyAndDeletePeer(e,!1)}o.debug("receive node "+e+" connection request");var u=this.scheduler.peersNum;if(u>=this.maxConns){var c=this.scheduler.getNonactivePeers();if(!(c.length>0)){var l="peers reach limit "+this.maxConns;return o.warn(l),void this._sendSignalReject(e,l,n,r)}var f=u-this.maxConns+2;for(c.length<f&&(f=c.length);f>0;){var d=c.shift();d&&(o.warn("close inactive peer "+d.remotePeerId),d.close(!1)),f--}}a=this._createDatachannel(e,!1,n)}r&&(a.signalName=r),a.receiveSignal(t)}},{key:"_createDatachannel",value:function(e,t,n,r){var i=this.config.trickleICE,o=new d.default(this.engine,this.peerId,e,t,this.config,this.sequential,{stuns:this.stuns,intermediator:n,trickle:i});return r&&(o.cpr=r),this.DCMap.set(e,o),this._setupDC(o),o}},{key:"_sendSignalReject",value:function(e,t,n,r,i){if(n){var o=this.DCMap.get(n);if(o&&o.sendMsgSignalReject(e,this.peerId,t,i))return}this.signalerWs.sendReject(e,t,i,r)}},{key:"_requestMorePeers",value:function(e){var t=this,n=this.logger;n.info("requestMorePeers after delay "+e);var r=this.scheduler.peersNum,i=this.peersIncrement;this.peersIncrement=0,r>=this.minConns||(0===r||i<=3&&!this.gotPeersFromTracker?(this.failedDCSet.size>30&&(this.failedDCSet=new Set([].concat(g(this.failedDCSet)).slice(-30))),this.fetcher.btGetPeers([].concat(g(this.DCMap.keys()),g(this.failedDCSet.keys()))).then((function(e){n.info("requestMorePeers resp "+JSON.stringify(e,null,2)),t.peers=[].concat(g(t.peers),g(t._filterPeers(e.peers))),t._tryConnectToAllPeers()})).catch((function(e){n.error("requestMorePeers error "+e)})),this.gotPeersFromTracker=!0):r<this.maxConns&&(this.scheduler.requestPeers(),this.gotPeersFromTracker=!1))}},{key:"_destroyAndDeletePeer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.DCMap.get(e);return!!n&&(n.destroy(t),this.DCMap.delete(e),!0)}},{key:"totalConns",get:function(){return this.scheduler.peersNum+1}}]),t}(o.default);t.default=y,e.exports=t.default},9:(e,t)=>{"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.Buffer=o;var r=2147483647;function i(e){if(e>r)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=o.prototype,t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return a(e,t,n)}function a(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),r=i(n),a=r.write(e,t);a!==n&&(r=r.slice(0,a));return r}(e,t);if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===e?"undefined":n(e)));if(h(e,ArrayBuffer)||e&&h(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=o.prototype,r}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var a=e.valueOf&&e.valueOf();if(null!=a&&a!==e)return o.from(a,t,r);var s=function(e){if(o.isBuffer(e)){var t=0|l(e.length),n=i(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||function(e){return e!=e}(e.length)?i(0):c(e);if("Buffer"===e.type&&Array.isArray(e.data))return c(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===e?"undefined":n(e)))}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return s(e),i(e<0?0:0|l(e))}function c(e){for(var t=e.length<0?0:0|l(e.length),n=i(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function l(e){if(e>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||h(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+(void 0===e?"undefined":n(e)));var r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return d(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;default:if(a)return i?-1:d(e).length;t=(""+t).toLowerCase(),a=!0}}function d(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function h(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}t.kMaxLength=r,"undefined"!=typeof Symbol&&null!=Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.from=function(e,t,n){return a(e,t,n)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(e,t,n){return function(e,t,n){return s(e),e<=0?i(e):void 0!==t?"string"==typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}(e,t,n)},o.allocUnsafe=function(e){return u(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(h(a,Uint8Array)&&(a=o.from(a)),!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var a=i-1;a>=0;--a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i}},6522:e=>{"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){for(var n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}e.exports=function(e,r,i){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");i||(i={}),"object"===(void 0===r?"undefined":t(r))&&(i=r,r=void 0),null!=r&&(i.code=r);try{return n(e,i)}catch(t){i.message=e.message,i.stack=e.stack;var o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(e)),n(new o,i)}}},4212:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:70,r=null,i=!1,o=1,a=n;return function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(n)return clearTimeout(r),void(i=!1);i||(i=!0,r=setTimeout((function(){e.call(t,a),i=!1,r=null}),1e3*a),a*=o)}},e.exports=t.default},2372:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(9)),i=l(n(6522)),o=l(n(4212)),a=l(n(6931)),s=l(n(4206)),u=l(n(2497)),c=l(n(1003));function l(e){return e&&e.__esModule?e:{default:e}}t.default={Buffer:r.default,errCode:i.default,getPeersThrottle:o.default,Logger:a.default,platform:s.default,getPlayer:u.default,queueMicrotask:c.default},e.exports=t.default},6931:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3901);var o={debug:0,info:1,warn:2,error:3,none:4},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logLevel=t,this.onlineDebug=!1,console.debug=console.log,"debug"!==t&&"info"!==t||(this.logLevel="warn"),!0===t?this.logLevel="warn":!1===t?this.logLevel="none":t in o||(this.logLevel="error"),this.resetLogger()}return r(e,[{key:"enableDebug",value:function(){for(var e in this.onlineDebug=!0,o)this[e]=console[e]}},{key:"resetLogger",value:function(){for(var e in this.onlineDebug=!1,o)o[e]<o[this.logLevel]?this[e]=i.noop:this[e]=console[e]}},{key:"isDebugLevel",get:function(){return o[this.logLevel]<=2||this.onlineDebug}}]),e}();t.default=a,e.exports=t.default},3066:(e,t,n)=>{"use strict";var r;"function"==typeof Symbol&&Symbol.iterator;!function(i){function o(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e,t,n,r,i,a){return o((s=o(o(t,e),o(r,a)))<<(u=i)|s>>>32-u,n);var s,u}function s(e,t,n,r,i,o,s){return a(t&n|~t&r,e,t,i,o,s)}function u(e,t,n,r,i,o,s){return a(t&r|n&~r,e,t,i,o,s)}function c(e,t,n,r,i,o,s){return a(t^n^r,e,t,i,o,s)}function l(e,t,n,r,i,o,s){return a(n^(t|~r),e,t,i,o,s)}function f(e,t){var n,r,i,a,f;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var d=1732584193,h=-271733879,p=-1732584194,g=271733878;for(n=0;n<e.length;n+=16)r=d,i=h,a=p,f=g,d=s(d,h,p,g,e[n],7,-680876936),g=s(g,d,h,p,e[n+1],12,-389564586),p=s(p,g,d,h,e[n+2],17,606105819),h=s(h,p,g,d,e[n+3],22,-1044525330),d=s(d,h,p,g,e[n+4],7,-176418897),g=s(g,d,h,p,e[n+5],12,1200080426),p=s(p,g,d,h,e[n+6],17,-1473231341),h=s(h,p,g,d,e[n+7],22,-45705983),d=s(d,h,p,g,e[n+8],7,1770035416),g=s(g,d,h,p,e[n+9],12,-1958414417),p=s(p,g,d,h,e[n+10],17,-42063),h=s(h,p,g,d,e[n+11],22,-1990404162),d=s(d,h,p,g,e[n+12],7,1804603682),g=s(g,d,h,p,e[n+13],12,-40341101),p=s(p,g,d,h,e[n+14],17,-1502002290),d=u(d,h=s(h,p,g,d,e[n+15],22,1236535329),p,g,e[n+1],5,-165796510),g=u(g,d,h,p,e[n+6],9,-1069501632),p=u(p,g,d,h,e[n+11],14,643717713),h=u(h,p,g,d,e[n],20,-373897302),d=u(d,h,p,g,e[n+5],5,-701558691),g=u(g,d,h,p,e[n+10],9,38016083),p=u(p,g,d,h,e[n+15],14,-660478335),h=u(h,p,g,d,e[n+4],20,-405537848),d=u(d,h,p,g,e[n+9],5,568446438),g=u(g,d,h,p,e[n+14],9,-1019803690),p=u(p,g,d,h,e[n+3],14,-187363961),h=u(h,p,g,d,e[n+8],20,1163531501),d=u(d,h,p,g,e[n+13],5,-1444681467),g=u(g,d,h,p,e[n+2],9,-51403784),p=u(p,g,d,h,e[n+7],14,1735328473),d=c(d,h=u(h,p,g,d,e[n+12],20,-1926607734),p,g,e[n+5],4,-378558),g=c(g,d,h,p,e[n+8],11,-2022574463),p=c(p,g,d,h,e[n+11],16,1839030562),h=c(h,p,g,d,e[n+14],23,-35309556),d=c(d,h,p,g,e[n+1],4,-1530992060),g=c(g,d,h,p,e[n+4],11,1272893353),p=c(p,g,d,h,e[n+7],16,-155497632),h=c(h,p,g,d,e[n+10],23,-1094730640),d=c(d,h,p,g,e[n+13],4,681279174),g=c(g,d,h,p,e[n],11,-358537222),p=c(p,g,d,h,e[n+3],16,-722521979),h=c(h,p,g,d,e[n+6],23,76029189),d=c(d,h,p,g,e[n+9],4,-640364487),g=c(g,d,h,p,e[n+12],11,-421815835),p=c(p,g,d,h,e[n+15],16,530742520),d=l(d,h=c(h,p,g,d,e[n+2],23,-995338651),p,g,e[n],6,-198630844),g=l(g,d,h,p,e[n+7],10,1126891415),p=l(p,g,d,h,e[n+14],15,-1416354905),h=l(h,p,g,d,e[n+5],21,-57434055),d=l(d,h,p,g,e[n+12],6,1700485571),g=l(g,d,h,p,e[n+3],10,-1894986606),p=l(p,g,d,h,e[n+10],15,-1051523),h=l(h,p,g,d,e[n+1],21,-2054922799),d=l(d,h,p,g,e[n+8],6,1873313359),g=l(g,d,h,p,e[n+15],10,-30611744),p=l(p,g,d,h,e[n+6],15,-1560198380),h=l(h,p,g,d,e[n+13],21,1309151649),d=l(d,h,p,g,e[n+4],6,-145523070),g=l(g,d,h,p,e[n+11],10,-1120210379),p=l(p,g,d,h,e[n+2],15,718787259),h=l(h,p,g,d,e[n+9],21,-343485551),d=o(d,r),h=o(h,i),p=o(p,a),g=o(g,f);return[d,h,p,g]}function d(e){var t,n="",r=32*e.length;for(t=0;t<r;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function h(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function p(e){var t,n,r="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function g(e){return unescape(encodeURIComponent(e))}function y(e){return function(e){return d(f(h(e),8*e.length))}(g(e))}function _(e,t){return function(e,t){var n,r,i=h(e),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=f(i,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^i[n],a[n]=1549556828^i[n];return r=f(o.concat(h(t)),512+8*t.length),d(f(a.concat(r),640))}(g(e),g(t))}function m(e,t,n){return t?n?_(t,e):p(_(t,e)):n?y(e):p(y(e))}void 0===(r=function(){return m}.call(t,n,t,e))||(e.exports=r)}()},9954:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isMSESupported=function(){var e=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}(),t=window.SourceBuffer||window.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!r}},4206:e=>{"use strict";var t={ANDROID_WEB:"android-web",IOS_WEB:"iOS-web",PC_NATIVE:"PC-native",PC_WEB:"PC-web"},n={getNetType:function(){var e=(new RegExp("nettype\\/(\\w*)").exec(r())||[,""])[1].toLowerCase();if(!e&&navigator.connection)switch(navigator.connection.type){case"ethernet":e="ethernet";break;case"cellular":e="cellular";break;default:e="wifi"}return e},getPlatform:function(){return n.isAndroid()?t.ANDROID_WEB:n.isIOS()?t.IOS_WEB:n.isElectron()?t.PC_NATIVE:t.PC_WEB},isX5:function(){return this.isAndroid()&&/\s(TBS|X5Core)\/[\w\.\-]+/i.test(r())},isPC:function(){return!o(i("os "))&&!o(i("android[/ ]"))},isIOS:function(){return o(i("os "))},isAndroid:function(){return o(i("android[/ ]"))},isIOSSafari:function(){return this.isIOS()&&this.isSafari()},isElectron:function(){return/electron/i.test(r())},isMobile:function(){return n.isAndroid()||n.isIOS()},isSafari:function(){return/^((?!chrome|android).)*safari/i.test(r())},isFirefox:function(){return/firefox/i.test(r())},isChrome:function(){return/chrome/i.test(r())},isLocalHost:function(){return"localhost"===location.hostname},device:t,getBrowser:function(){return n.isX5()?"X5":n.isChrome()?"Chrome":n.isFirefox()?"Firefox":n.isIOSSafari()?"iOS-Safari":n.isSafari()?"Mac-Safari":"Unknown"}};function r(){return navigator.userAgent.toLowerCase()}function i(e){return""+(new RegExp(e+"(\\d+((\\.|_)\\d+)*)").exec(r())||[,0])[1]||void 0}function o(e){return parseFloat((e||"").replace(/\_/g,"."))||0}e.exports=n},2497:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=void 0;for(var t in n)if(window[t]){e=n[t];break}return e};var n={DPlayer:"dplayer",CBPlayer:"cbplayer",jwplayer:"jwplayer",videojs:"videojs",Clappr:"clappr",ckplayer:"ckplayer",MediaElementPlayer:"mediaelement",MediaElement:"mediaelement",TcPlayer:"tcplayer",flowplayer:"flowplayer",Chimee:"chimee",ChimeePlayer:"chimee",HlsJsPlayer:"xgplayer",fluidPlayer:"fluidplayer",OpenPlayer:"openplayer",Plyr:"plyr",Playerjs:"playerjs"};e.exports=t.default},1003:e=>{"use strict";var t=void 0;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind(globalThis):function(e){return(t||(t=Promise.resolve())).then(e).catch((function(e){return setTimeout((function(){throw e}),0)}))}},156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=t.setItem=function(e,t){"object"===(void 0===t?"undefined":n(t))&&(t=JSON.stringify(t)),window.localStorage.setItem(e,t)},i=(t.getItem=function(e){var t=window.localStorage.getItem(e);try{var n=JSON.parse(t);return n.duration&&n.startTime?(new Date).getTime()-n.startTime>n.duration?(i(e),null):n.value:n}catch(e){return t}},t.removeItem=function(e){window.localStorage.removeItem(e)});t.removeAllItem=function(){window.localStorage.clear()},t.setItemWithExpiration=function(e,t,n){var i={value:t,duration:n,startTime:(new Date).getTime()};r(e,i)}},3901:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){return!0},t.getQueryParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n&&""!==n[2]?n[2].toString():""},t.updateQueryStringParam=function(e,t,n){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=-1!==e.indexOf("?")?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+n+"$2"):e+i+t+"="+n},t.getCurrentTs=function(){return Date.parse(new Date)/1e3},t.randomNum=function(e,t){return parseInt(Math.random()*(t-e+1)+e,10)},t.calCheckPeersDelay=function(e){return 0===e?3:.33*e+.67},t.performRangeRequest=function(e){var t=new XMLHttpRequest;return new Promise((function(n,r){t.open("GET",e,!0),t.responseType="arraybuffer",t.timeout=3e3,t.onload=function(e){206===t.status?n():r()},t.onerror=function(e){r()},t.ontimeout=function(e){r()},t.setRequestHeader("Range","bytes=0-0"),t.send()}))},t.navLang=function(){return"zh-CN"===(navigator.language||navigator.userLanguage)?"cn":"en"},t.dontWaitFor=function(e){e.then((function(){}))},t.timeout=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t.getBrowserRTC=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},t.copyBuffer=function(e){var t=r.Buffer.from(e),n=new r.Buffer(e.byteLength);return t.copy(n),n},t.getMaxSequence=function(e){var t=e.split("\n"),n=0,r=0,i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value,l=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(c);if(l&&l[1]){n=parseInt(l[1],10);break}}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}var f=!0,d=!1,h=void 0;try{for(var p,g=t[Symbol.iterator]();!(f=(p=g.next()).done);f=!0){p.value.startsWith("#EXTINF")&&r++}}catch(e){d=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(d)throw h}}return n+r-1},t.isHttps=function(){return location.protocol.startsWith("https")},t.isInteger=function(e){return"number"==typeof e&&e%1==0},t.appendSlogan=function(e,t,n){var r=document.createElement("div");r.style.position="absolute",r.style.top="8px",r.style.left="8px",r.style.zIndex="999",r.style.fontSize="10px";var i=document.createElement("a");i.href=t,i.target="_blank",i.innerText=e,i.style.color="white",i.style.textDecoration="none",i.style.textShadow="0 0 5px white,0 0 10px #00FFFF,0 0 15px #7FFF00,0 0 20px white";var o=document.createElement("i");o.style.width="5px",o.style.height="5px",o.style.borderRadius="50%",o.style.display="inline-block",o.style.backgroundColor="#67C23A",o.style.marginBottom="2px",o.style.marginRight="4px",r.appendChild(o),r.appendChild(i);var a=n.parentNode;a&&a.insertBefore(r,n)},t.getHomeUrl=function(){return window.atob("aHR0cHM6Ly9zd2FybWNsb3VkLm5ldC9lbi8=")};var r=n(9)},4641:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(6204)),o=s(n(7760)),a=n(3901);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"main";u(this,t);var a=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.logger=e,a.config=n,a.wsAddr=r,a.serverVersion=0,a.pingInterval=i||60,a._ws=a._init(),a.name=o,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_init",value:function(){var e=this,t={maxRetries:this.config.wsMaxRetries,minReconnectionDelay:(0,a.randomNum)(1e4,6e4),maxReconnectionDelay:6e5,maxEnqueuedMessages:20},n=new o.default(this.wsAddr,void 0,t);return n.addEventListener("open",(function(){e.logger.info("signal "+e.name+" "+e.wsAddr+" connection opened"),e.onopen&&e.onopen(),e._startPing(e.pingInterval)})),n.push=n.send,n.send=function(e){var t=JSON.stringify(e);n.push(t)},n.addEventListener("message",(function(t){var n=t.data,r=JSON.parse(n),i=r.action;if("pong"!==i){if("ver"!==i)return"close"===i?(e.logger.warn("server close signal "+e.name+" reason "+r.reason),void e.close()):void(e.onmessage&&e.onmessage(r,e.name));e.serverVersion=r.ver}else clearTimeout(e.pongTimer)})),n.addEventListener("close",(function(t){e.logger.warn("signal "+e.name+" "+e.wsAddr+" closed "+t.code+" "+t.reason),e.onclose&&e.onclose(),e._stopPing()})),n.addEventListener("error",(function(t){e.logger.error("signal "+e.name+" "+e.wsAddr+" error"),e._stopPing(),e.onerror&&e.onerror(t)})),n}},{key:"sendSignal",value:function(e,t){var n={action:"signal",to_peer_id:e,data:t};this._send(n)}},{key:"sendReject",value:function(e,t,n){var r={action:"reject",to_peer_id:e,reason:t,fatal:n};this._send(r)}},{key:"_send",value:function(e){this._ws&&this._ws.send(e)}},{key:"_startPing",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:120;this.connected&&(this.pingTimer=setInterval((function(){e._send({action:"ping"}),e.serverVersion>=22&&e._waitForPong()}),1e3*t))}},{key:"_waitForPong",value:function(){var e=this;this.pongTimer=setTimeout((function(){e.logger.warn("signal "+e.name+" wait for pong timeout, reconnect"),e.close(),e.reconnect()}),15e3)}},{key:"_resetPing",value:function(){this._stopPing(),this._startPing(this.pingInterval)}},{key:"_stopPing",value:function(){clearInterval(this.pingTimer),clearTimeout(this.pongTimer),this.pingTimer=null,this.pongTimer=null}},{key:"close",value:function(){var e=this;this.logger.info("close signal "+this.name),this._stopPing(),e._ws&&e._ws.close(1e3,"normal close")}},{key:"reconnect",value:function(){this._ws&&(this.logger.info("reconnect signal "+this.name),this._ws.reconnect())}},{key:"destroy",value:function(){this.close(),this._ws=null,this.removeAllListeners()}},{key:"connected",get:function(){return!!this._ws&&this._ws.readyState===o.default.OPEN}}]),t}(i.default);t.default=l,e.exports=t.default},1196:(e,t,n)=>{"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=n(1236);e.exports={defaultP2PConfig:r({},i.config,{pieceLength:524288,concurrentLoadNum:5,httpMaxRetrys:3,segmentId:function(e,t,n){return""+e},waitForPeer:!1,waitForPeerTimeout:4.5,trickleICE:!0,httpLoadTime:2,pattern:null}),defaultMediaConfig:{autoplay:!1,controls:!1,muted:!1,maxBufferLength:60,minBufferLength:40}}},8316:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=n(1236);t.default=r({MD_METADATA:"MD_METADATA",ERROR:"error",REACH_END:"REACH_END"},i.Events),e.exports=t.default},7050:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1236),o=n(2372);var a=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));i.config=e,i.logger=e.logger,i.pieceParser=n,i.destroyed=!1;var o=r&&r.start||0,a=(r&&r.end&&r.end<n.fileLength?r.end:n.fileLength,e.pieceLength);return i._startPiece=o/a|0,i._endPiece=n.endPiece,i._piece=i._startPiece,i._offset=o-i._startPiece*a,i._reading=!1,i._notifying=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_read",value:function(){this._reading||(this._reading=!0,this._notify())}},{key:"_notify",value:function(){var e=this;this.config.logger;if(this._reading&&!(this._piece>this._endPiece)&&!this._notifying){this._notifying=!0;var t=this._piece;if(this._notifying=!1,!this.destroyed){var n=this.config.bufMgr.getSegBySN(t);n&&((0,o.queueMicrotask)((function(){var t=i.Buffer.from(n.data),r=new i.Buffer(n.data.byteLength);t.copy(r);var o=r;e._offset&&(o=o.slice(e._offset),e._offset=0),e._reading=!1,e.push(o),e._piece>e._endPiece&&e.push(null)})),this._piece+=1)}}}},{key:"destroy",value:function(e){this._destroy(null,e)}},{key:"_destroy",value:function(e,t){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e),this.emit("close"),t&&t())}}]),t}(n(1902).Readable);t.default=a,e.exports=t.default},1238:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=c(n(6204)),o=c(n(5163)),a=n(1902),s=c(n(7050)),u=n(2372);function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.config=e,r.pieceParser=n.pieceParser,r.scheduler=e.scheduler,r.logger=e.logger,r.media=n.elem,r.maxBufferLength=n.maxBufferLength,r.minBufferLength=n.minBufferLength,r.pieceLoader=n.pieceLoader,r.url=n.url,r.path=n.path,r.length=r.pieceParser.fileLength,r.done=!1,r._destroyed=!1,r.loadedPieces=0,r.currentPiece=0,0===r.length&&(r.done=!0,r.emit("done")),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"createReadStream",value:function(e){var t=this,n=this;if(0===this.length){var r=new a.PassThrough;return(0,u.queueMicrotask)((function(){r.end()})),r}return this.logger.info("createReadStream start "+e.start+" end "+e.end),this.fileStream=new s.default(this.config,this.pieceParser,e),this.currentPiece=this.fileStream._startPiece,this.pieceLoader.loadPiece(this.currentPiece,(function e(t){if(t!==n.currentPiece)return void this.logger.warn("fileNotify sn "+t+" is wrong");var r=n.fileStream;if(r._notify(),n.loadedPieces+=1,n.currentPiece=t+1,n.currentPiece<=r._endPiece){var i=n.availableBufferDuration;if(!n.config.canPlayed&&n.config.loadedmetadata)this.logger.info("loadedmetadata and not playing, paused, currentPiece is "+n.currentPiece),n.media.addEventListener("play",a);else if(i>=n.maxBufferLength){var o=i-n.minBufferLength;this.logger.info("loader pause for "+1e3*o),clearTimeout(n.pauseTimer),n.pauseTimer=window.setTimeout((function(){n._destroyed||(n.media.paused?n.media.addEventListener("play",a):n.pieceLoader.loadPiece(n.currentPiece,e))}),1e3*o)}else n.pieceLoader.loadPiece(n.currentPiece,e)}else!n.config.canPlayed&&n.scheduler&&(n.scheduler.loadingSN=this.config.concurrentLoadNum);function a(){n.config.canPlayed=!0,n.media.removeEventListener("play",a),n._destroyed||n.pieceLoader.loadPiece(n.currentPiece,e)}})),(0,o.default)(this.fileStream,(function(){t._destroyed||clearTimeout(t.pauseTimer)})),this.fileStream}},{key:"destroy",value:function(){clearTimeout(this.pauseTimer),this._destroyed=!0,this.pieceLoader.destroy(),this.removeAllListeners()}},{key:"availableBufferDuration",get:function(){return this.scheduler.bufferedDuration}}]),t}(i.default);t.default=l,e.exports=t.default},1298:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(n(7527)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=m(n(8622)),s=n(1196),u=n(1236),c=m(n(8316)),l=n(2372),f=m(n(1238)),d=m(n(5772)),h=m(n(2393)),p=m(n(7641)),g=m(n(8194)),y=n(9954),_=n(9515);function m(e){return e&&e.__esModule?e:{default:e}}function v(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(i,o){try{var a=t[i](o),s=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var E=function(e){function t(e){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(this,t);var p=w(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o.p2pConfig)),y=o.p2pConfig||{};if(y.pieceLength<=10240)throw new Error("pieceLength is too short");if("string"==typeof e)p.media=document.querySelector(e);else{if("[object HTMLVideoElement]"!==Object.prototype.toString.call(e))throw new Error("illegal video element");p.media=e}p.currentSource="",p.file=null,p.destroyed=!1,p.videoStream=null,p.config=Object.assign({},s.defaultP2PConfig,y),delete o.p2pConfig,p.mediaConfig=Object.assign({},s.defaultMediaConfig,o),p.config.waitForPeer&&(p.config.trickleICE=!0);var m,E=(m=v(r.default.mark((function e(){var o,s,y,m,v,b,w,S,P;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.requestFileLength)(p.currentSource);case 2:if(p.fileLength=e.sent,p.fileLength){e.next=8;break}return console.error("cannot get content-length, fallback"),p.p2pEnabled=!1,p.media.src=p.currentSource,e.abrupt("return");case 8:p.off(c.default.MD_METADATA,E),o=p.commonBrowserInfo,p.browserInfo=i({},o,{tag:p.config.tag||void 0,live:!1,type:"mp4"}),o.device===l.platform.device.PC_NATIVE&&(p.browserInfo=i({},p.browserInfo,{app:p.config.appName,bundle:p.config.appId})),s=p.config,y=s.token,m=s.channelId,y||(y=p.config.channelIdPrefix),v=function(e,t){var n=a.default.parseURL(e);return""+(n.netLoc.substr(2)+n.path.substring(0,n.path.lastIndexOf(".")))},m&&"function"==typeof m&&(v=p.makeChannelId(y,m)),b=p.makeSignalId(),p.channel=v(p.currentSource,p.browserInfo)+"|"+b+"["+u.Peer.VERSION+"]m_"+p.config.pieceLength,(w=p.initLogger()).info("P2P version: "+t.version),w.info("channel "+p.channel),p._init(p.channel,p.browserInfo),S=new d.default(p.fileLength,0,p.config.pieceLength),p.config.endSN=S.endPiece,p.pieceLoader=p.config.pieceLoader=new g.default(p.currentSource,p.config,S),p._setupPieceLoader(),P={pieceParser:S,pieceLoader:p.pieceLoader,url:p.currentSource,elem:p.media,maxBufferLength:p.mediaConfig.maxBufferLength,minBufferLength:p.mediaConfig.minBufferLength},p.file=new f.default(p.config,P),p.videoStream=new h.default(p.file,p.media);case 29:case"end":return e.stop()}}),e,n)}))),function(){return m.apply(this,arguments)});return p.on(c.default.MD_METADATA,E),p.media.addEventListener("error",p._onMediaError.bind(p),{once:!0}),p.media.addEventListener("loadstart",p._onLoadStart.bind(p),{once:!0}),p.media.addEventListener("canplay",p._onCanPlay.bind(p),{once:!0}),p.media.addEventListener("loadedmetadata",p._loadedmetadata.bind(p),{once:!0}),p}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,null,[{key:"Events",get:function(){return c.default}}]),o(t,[{key:"loadSource",value:function(e){if(!this.p2pEnabled)return this.p2pEnabled=!1,void(this.media.src=e);this.currentSource=e;var t=this.config;/.mp4(#|\?|$)/i.exec(e)||t.pattern&&t.pattern.test(e)?this.emit(c.default.MD_METADATA):(console.error("Media type is not supported by P2PEngine, fallback"),this.p2pEnabled=!1,this.media.src=e)}},{key:"disableP2P",value:function(){this.logger&&this.logger.warn("disable P2P"),this.p2pEnabled&&(this.p2pEnabled=this.config.p2pEnabled=!1,this.tracker&&(this.tracker.stopP2P(),this.tracker={},this.fetcher=null,this.bufMgr.destroy(),this.bufMgr=null)),this.videoStream&&(this.videoStream.destroy(),this.videoStream=null),this.file&&(this.file.destroy(),this.file=null)}},{key:"_setupPieceLoader",value:function(){var e=this;this.pieceLoader.on(c.default.FRAG_LOADING,(function(t){e.logger.debug("loading frag "+t),e.emit(c.default.FRAG_LOADING,t)})).on(c.default.FRAG_LOADED,(function(t,n){e.logger.debug("loaded frag "+t),e.emit(c.default.FRAG_LOADED,t,n)})).on(c.default.REACH_END,(function(t,n){e.logger.info("video reach end "+t+" lastSegLength "+n)})).on(c.default.ERROR,(function(){e.logger.error("load piece 0 failed, fallback"),e.p2pEnabled=!1,e.media.src=e.currentSource}))}},{key:"_init",value:function(e,t){if(this.p2pEnabled){this.bufMgr=new u.SegmentManager(this,this.config),this.config.bufMgr=this.bufMgr;var n=new u.Server(this,this.config.token,window.encodeURIComponent(e),this.config.announce||"",t);this.fetcher=n;var r=new p.default(this,this.config);this.tracker=new u.Tracker(this,n,r,this.config),this.tracker.scheduler.bufferManager=this.bufMgr,this.config.scheduler=this.tracker.scheduler,this.config.fetcher=n,this.p2pEnabled&&!this.tracker.connected&&this.tracker.resumeP2P(),this.setupWindowListeners()}}},{key:"_onMediaError",value:function(e){var t=this;this.logger&&this.logger.error(this.media.error.message),this.media.removeEventListener("canplay",this._onCanPlay),this.emit(c.default.EXCEPTION,(0,l.errCode)(e,"MEDIA_EXPT"));var n=this.media.currentTime;this.disableP2P(),this.logger&&this.logger.warn("fallback to http only"),this.media.src=this.currentSource,this.media.play().then((function(){t.media.currentTime=n}))}},{key:"_onLoadStart",value:function(){this.mediaConfig.autoplay&&this.media.play()}},{key:"_onCanPlay",value:function(){this.config.canPlayed=!0}},{key:"_loadedmetadata",value:function(){this.config.loadedmetadata=!0;var e=this.mediaConfig;this.media.autoplay=!!e.autoplay,this.media.muted=!!e.muted,this.media.controls=!!e.controls}},{key:"getExtraForStats",value:function(){return{pos:Math.round(this.media.currentTime)}}}],[{key:"isSupported",value:function(){return u.EngineBase.isSupported()&&(0,y.isMSESupported)()}}]),t}(u.EngineBase);window&&(window.P2pEngineMp4=E),t.default=E,e.exports=t.default},7641:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},a=n(1236),s=n(8316),u=(r=s)&&r.__esModule?r:{default:r},c=n(3901);var l=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.logger.info("use SnScheduler"),r.sequential=!0,r.targetPeer=null,r.url=e.currentSource,r.currLostSN=-1,r.nextLostSN=-1,r.checkTimer=null,r.loadedPeerNum=0,r.maxPrefetchCount=50,r.startCheckPeersTimer(),r.mBufferedDuration=0,r.allowP2pLimit=n.httpLoadTime+2.5,r.waitForPeer=n.waitForPeer||!1,r.waitForPeer&&(r.waitForPeerTimer=window.setTimeout((function(){r.waitForPeer=!1}),1e3*n.waitForPeerTimeout)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"startCheckPeersTimer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.logger.info("loaded peers "+this.loadedPeerNum+" next checkDelay is "+t),this.loadedPeerNum=0,this.checkTimer||(this.checkTimer=window.setTimeout((function(){e.checkPeers(),e.checkTimer=null,e.startCheckPeersTimer((0,c.calCheckPeersDelay)(e.loadedPeerNum))}),1e3*t))}},{key:"updateLoadedSeg",value:function(e,t){if(!this.bitset.has(e)){this.bitset.add(e),this.bitCounts.has(e)&&this.bitCounts.delete(e);var n=!0,r=!1,i=void 0;try{for(var o,a=this.peerManager.getPeerValues()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.notifySet.has(e)||s.bitset.has(e)||(s.sendMsgHave(e,t),s.notifySet.add(e))}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}},{key:"checkPeers",value:function(){var e=this.engine.logger;if(0!==this.bitCounts.size&&!(this.nextLostSN>=0&&this.nextLostSN>=this.loadingSN-30)&&this.hasPeers){var t=this.peerManager.getAvailablePeers();if(0!==t.length){var n=[],r=this.config.prefetchNum,i=0,o=this.loadingSN+1,a=this.config.endSN||this.loadingSN+80;if(this.loadingSN>=a&&!this.bufMgr.overflowed)o=0;else{var s=Math.min.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t.filter((function(e){return e.endSN>=o})).map((function(e){return e?e.startSN:1/0}))));if(!isFinite(s))return;o<s&&(o=s)}for(;n.length<=r&&n.length<t.length&&i<this.maxPrefetchCount;){if(o>a)return;if(this.bitset.has(o))o++;else{if(o!==this.loadingSN&&this.bitCounts.has(o)&&!this.requestingMap.has(o)){var u=!0,c=!1,l=void 0;try{for(var f,d=t[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var h=f.value;if(!n.includes(h)&&h.bitset.has(o)){h.requestDataBySN(o,!1),e.info("request prefetch "+o+" from peer "+h.remotePeerId+" downloadNum "+h.downloadNum),n.push(h),this.requestingMap.set(o,h.remotePeerId);break}}}catch(e){c=!0,l=e}finally{try{!u&&d.return&&d.return()}finally{if(c)throw l}}}i++,o++}}this.loadedPeerNum=n.length}}}},{key:"deletePeer",value:function(e){var n=this;this.peerManager.hasPeer(e.remotePeerId)&&e.bitset.forEach((function(e){n._decreBitCounts(e)})),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"deletePeer",this).call(this,e)}},{key:"addPeer",value:function(e){if(this.waitForPeer&&this.criticalSeg){var n=this.criticalSeg.segId,r=this.criticalSeg.sn,i=e.remotePeerId,a=this.requestingMap;a.checkIfPeerUnknown(r)&&e.bitset.has(r)&&(this.logger.info("found initial seg "+r+" from peer "+i),a.set(r,i),e.requestDataById(n,r,!0))}o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addPeer",this).call(this,e)}},{key:"hasAndSetTargetPeer",value:function(e){var t=this.engine.logger;if(this.waitForPeer){var n=!0,r=!1,i=void 0;try{for(var o,a=this.peerManager.getAvailablePeers()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.bitset.has(e))return t.info("found "+e+" from peer "+s.remotePeerId),this.targetPeer=s,!0}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t.warn("wait for peer to load "+e),this.requestingMap.setPeerUnknown(e),!0}if(this.bufferedDuration<=this.allowP2pLimit)return!1;if(this.requestingMap.has(e))return!0;if(!this.hasIdlePeers||!this.peersHas(e))return!1;var u=!0,c=!1,l=void 0;try{for(var f,d=this.peerManager.getPeersOrderByWeight()[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var h=f.value;if(h.bitset.has(e))return t.info("found sn "+e+" from peer "+h.remotePeerId),this.targetPeer=h,!0}}catch(e){c=!0,l=e}finally{try{!u&&d.return&&d.return()}finally{if(c)throw l}}return t.info("idle peers hasn't sn "+e+" or busy"),!1}},{key:"load",value:function(e,t){var n=this.engine.logger;this.request=e;var r=this.request,i=r.sn,o=r.segId;this.callbacks=t,this.criticalSeg={sn:i,segId:o};var a=this.mBufferedDuration-this.config.httpLoadTime;this.waitForPeer?a=this.config.waitForPeerTimeout:a>this.dcDownloadTimeout&&(a=this.dcDownloadTimeout),this.requestingMap.has(i)?n.info("wait for criticalSeg segId "+o+" at "+i+" timeout "+a):(this.targetPeer.requestDataById(o,i,!0),n.info("request criticalSeg segId "+o+" at "+i+" timeout "+a)),this.criticaltimeouter=window.setTimeout(this._criticaltimeout.bind(this),1e3*a)}},{key:"onBufferManagerLost",value:function(e,t,n){this.currLostSN=e,n&&(this.nextLostSN=n),this.bitset.delete(e),this.bitCounts.delete(e)}},{key:"destroy",value:function(){var e=this.engine.logger;clearTimeout(this.checkTimer),clearTimeout(this.waitForPeerTimer),e.warn("destroy Mp4Scheduler"),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"_setupDC",value:function(e){var n=this;o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_setupDC",this).call(this,e);var r=this.engine.logger;e.on(u.default.DC_HAVE,(function(t){if(t.sn&&e.bitset){var r=t.sn;e.bitset.has(r)||(e.bitset.add(r),n.bitset.has(r)||n._increBitCounts(r))}})).on(u.default.DC_LOST,(function(t){if(t.sn&&e.bitset){var r=t.sn;e.bitset.has(r)&&(e.bitset.delete(r),n._decreBitCounts(r))}})).on(u.default.DC_PIECE,(function(e){})).on(u.default.DC_PIECE_NOT_FOUND,(function(t){n.criticalSeg&&n.criticalSeg.segId===t.seg_id&&(clearTimeout(n.criticaltimeouter),r.info("DC_PIECE_NOT_FOUND"),n.callbacks.onError()),e.bitset.delete(t.sn),n.requestingMap.delete(t.sn),n._decreBitCounts(t.sn),e.checkIfNeedChoke()})).on(u.default.DC_RESPONSE,(function(i,s){var c=i.segId,l=i.sn,f=i.data;if(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reportDCTraffic",n).call(n,l,i.size,s),n.criticalSeg&&n.criticalSeg.segId===c)r.info("receive criticalSeg seg_id "+c),clearTimeout(n.criticaltimeouter),n.criticaltimeouter=null,e.miss=0,n.criticalSeg=null,n.request.fromPeerId=e.remotePeerId,n.request.loadByP2P=!0,n.callbacks.success(l,f);else{if(n.bitset.has(l))return;var d=new a.Segment(l,c,f,e.remotePeerId);n.bufMgr.putSeg(d),n.updateLoadedSeg(l,c),f.byteLength<n.config.pieceLength&&n.engine.pieceLoader.emit(u.default.REACH_END,l,f.byteLength)}n.requestingMap.delete(l)})).on(u.default.DC_REQUEST,(function(t){var r="";if((r=t.seg_id?t.seg_id:n.bufMgr.getSegIdBySN(t.sn))&&n.bufMgr.hasSegOfId(r)){var i=n.bufMgr.getSegById(r);e.sendBuffer(i.sn,i.segId,i.data)}else e.sendJson({event:u.default.DC_PIECE_NOT_FOUND,seg_id:r,sn:t.sn})}))}},{key:"_setupEngine",value:function(){var e=this;this.engine.on(u.default.FRAG_LOADING,(function(t){e.loadingSN=t})).on(u.default.FRAG_LOADED,(function(t,n){e.updateLoadedSeg(t,n)}))}},{key:"notifyPeersLoaded",value:function(e){0===e&&this.waitForPeer&&this._criticaltimeout()}},{key:"_criticaltimeout",value:function(){var e=this,t=this.engine.logger;if(this.waitForPeer&&(this.waitForPeer=!1),this.criticalSeg){var n=this.criticalSeg.sn;t.warn("critical request sn "+n+" timeout"),this.requestingMap.has(n)&&(this.targetPeer=this.getPeerLoadedMore(n));var r=!1;if(this.targetPeer&&(r=!this.targetPeer.loadtimeout()),r)t.info("p2p download completed");else{if(this.targetPeer&&this.targetPeer.bufSN===n&&this.targetPeer.bufArr.length>0){var i=a.Buffer.concat(this.targetPeer.bufArr),o=this.url,s=this.request,u=s.start,c=s.end,l=s.sn;t.info("continue download from "+o+" range: "+(u+i.byteLength)+"-"+c),fetch(o,{headers:{Range:"bytes="+(u+i.byteLength)+"-"+c}}).then((function(e){return e.arrayBuffer()})).then((function(t){var n=a.Buffer.from(t);e.engine.fetcher.reportFlow(n.byteLength);var r=a.Buffer.concat([i,n]);e.request.fromPeerId=e.targetPeer.remotePeerId,e.request.loadByP2P=!0,e.callbacks.success(l,r)})).catch((function(n){t.error("http partial download error "+n),e.callbacks.onError()}))}else this.callbacks.onError();this.criticalSeg=null,this.criticaltimeouter=null}}}},{key:"_handlePieceAborted",value:function(e){this.criticalSeg&&this.targetPeer&&this.targetPeer.remotePeerId===e&&(window.clearTimeout(this.criticaltimeouter),this._criticaltimeout()),this.cleanRequestingMap(e)}},{key:"bufferedDuration",get:function(){for(var e=this.engine.media,t=0,n=e.currentTime,r=e.buffered,i=r.length-1;i>=0;i--)if(n>=r.start(i)&&n<=r.end(i)){t=r.end(i)-n;break}return this.logger.debug("bufferedDuration "+t),this.mBufferedDuration=t,t>0?t:0}}]),t}(a.BtScheduler);t.default=l,e.exports=t.default},8194:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(6204)),o=u(n(6153)),a=u(n(8316)),s=n(1236);function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=n,i.logger=n.logger,i.bufMgr=n.bufMgr,i.fetcher=n.fetcher,i.scheduler=n.scheduler,i.url=e,i.concurrentLoadNum=n.concurrentLoadNum,i.pieceLength=i.config.pieceLength,i.pieceParser=r,i.httpLoader=new o.default(e,5e3,i.logger.isDebugLevel),i.callback=null,i.destroyed=!1,i.p2pEnabled=n.p2pEnabled,i.loadingSet=new Set,i.loadingPiece=0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"loadPiece",value:function(e,t){var n=this.logger;if(this.callback=t,this.loadingPiece=e,this.emit(a.default.FRAG_LOADING,e),!this.fetcher.forbidden){if(this.bufMgr.hasSegOfSN(e))return n.info("hit cache "+e),void this.callback(e);if(0!==e||this.config.waitForPeer)this._loadPieceInternal(e);else for(var r=0;r<this.concurrentLoadNum;r++)this._loadPieceInternal(r)}}},{key:"_loadPieceInternal",value:function(e){var t=this,n=this.logger;if(!this.loadingSet.has(e)){this.loadingSet.add(e);var r=this.pieceParser.getRangeOfPiece(e),i=this.config.segmentId(e,r.start,r.end),o={start:r.start,end:r.end,sn:e,segId:i,loadByP2P:!1,loadByHTTP:!1,fromPeerId:"",retrys:0},u={success:function(e,r){if(!t.destroyed){if(t.loadingSet.delete(e),o.loadByHTTP&&(t.fetcher.reportFlow(r.byteLength),n.info("HTTP loaded "+i)),r.byteLength<t.pieceLength&&t.emit(a.default.REACH_END,e,r.byteLength),!t.bufMgr.hasSegOfId(i)){var u=new s.Segment(e,i,r,o.fromPeerId);t.bufMgr.putSeg(u)}e!==t.loadingPiece?n.info("Ignore last loading seg "+e):t.callback(e),t.emit(a.default.FRAG_LOADED,e,i)}},onError:function(e,r){if(!t.destroyed)return e instanceof RangeError?(n.warn("request range outbound, set endPiece "+(r.sn-1)),void t.emit(a.default.REACH_END,r.sn-1,t.pieceLength)):void(0!==r.sn?(n.error("load piece "+r.sn+" err, retried "+r.retrys),r.retrys++,r.retrys>=t.config.httpMaxRetrys||(t.retryTimer=setTimeout((function(){t.httpLoader.load(r,u)}),2e3))):t.emit(a.default.ERROR))}};if(this.p2pEnabled&&this.scheduler.hasAndSetTargetPeer(e)){this.scheduler.load(o,u);var c=u.onError;u.onError=function(){n.info("P2P timeout switched to HTTP load "+o.segId),t.httpLoader.load(o,u),u.onError=c}}else o.loadByHTTP=!0,n.info("_loadPieceInternal "+e),this.httpLoader.load(o,u)}}},{key:"destroy",value:function(){this.destroyed=!0,this.logger.warn("pieceLoader destroy"),this.callback=null,clearTimeout(this.retryTimer),this.removeAllListeners()}}]),t}(i.default);t.default=c,e.exports=t.default},6153:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3901);var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.timeout=n,this.isDebug=r}return r(e,[{key:"load",value:function(e,t){var n=e.sn,r={method:"GET",headers:{range:"bytes="+e.start+"-"+e.end}},o=this.url;this.isDebug&&(o=(0,i.updateQueryStringParam)(o,"_sn",n)),fetch(o,r).then((function(e){if(!e.ok)throw 416===e.status?new RangeError:new Error;return e.arrayBuffer()})).then((function(e){t.success(n,e)})).catch((function(n){console.error(n),t&&t.onError(n,e)}))}}]),e}();t.default=o,e.exports=t.default},5772:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:524288;r(this,e),this.pieceLength=i,this._fileLength=t,this._start=n,this._end=t-1,this._startPiece=this._start/i|0,this._endPiece=this._end/i|0}return n(e,[{key:"getRangeOfPiece",value:function(e){var t=e*this.pieceLength,n=t+this.pieceLength-1;return n>=this._fileLength&&(n=this._fileLength-1),{start:t,end:n}}},{key:"fileLength",get:function(){return this._fileLength}},{key:"startPiece",get:function(){return this._startPiece}},{key:"endPiece",get:function(){return this._endPiece}},{key:"startByteIndex",get:function(){return this._start}},{key:"endByteIndex",get:function(){return this._end}}]),e}();t.default=i,e.exports=t.default},9515:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestFileLength=void 0;var r,i,o,a=n(7527),s=(r=a)&&r.__esModule?r:{default:r};t.requestFileLength=(i=s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onerror=function(e){n(e)},r.onprogress=function(t){var i=t.total;r.onprogress=null,r.onerror=null,r.abort(),null!=i&&0!==i?e(i):n("cannot get file length")},r.send()})));case 1:case"end":return e.stop()}}),e,this)})),o=function(){var e=i.apply(this,arguments);return new Promise((function(t,n){function r(i,o){try{var a=e[i](o),s=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));t(s)}return r("next")}))},function(e){return o.apply(this,arguments)})},7527:(e,t,n)=>{e.exports=n(2439)},6251:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,o=u(e),a=o[0],s=o[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),l=0,f=s>0?a-4:a;for(n=0;n<f;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=16383,s=0,u=r-i;s<u;s+=a)o.push(c(e,s,s+a>u?u:s+a));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=o.length;a<s;++a)n[a]=o[a],r[o.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},3700:e=>{e.exports=function(e,t,n,r,i){var o,a;if(void 0===r)r=0;else if((r|=0)<0||r>=e.length)throw new RangeError("invalid lower bound");if(void 0===i)i=e.length-1;else if((i|=0)<r||i>=e.length)throw new RangeError("invalid upper bound");for(;r<=i;)if((a=+n(e[o=r+(i-r>>>1)],t,o,e))<0)r=o+1;else{if(!(a>0))return o;i=o-1}return~r}},276:(e,t,n)=>{var r=n(692).Buffer;e.exports=function(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative');return r.allocUnsafe?r.allocUnsafe(e):new r(e)}},9497:(e,t,n)=>{var r=n(692).Buffer,i=n(6858),o=n(276);e.exports=function(e,t,n){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative');if(r.alloc)return r.alloc(e,t,n);var a=o(e);return 0===e?a:void 0===t?i(a,0):("string"!=typeof n&&(n=void 0),i(a,t,n))}},6858:(e,t,n)=>{var r=n(692).Buffer,i=function(){try{if(!r.isEncoding("latin1"))return!1;var e=r.alloc?r.alloc(4):new r(4);return e.fill("ab","ucs2"),"61006200"===e.toString("hex")}catch(e){return!1}}();function o(e,t,n,r){if(n<0||r>e.length)throw new RangeError("Out of range index");return n>>>=0,(r=void 0===r?e.length:r>>>0)>n&&e.fill(t,n,r),e}e.exports=function(e,t,n,a,s){if(i)return e.fill(t,n,a,s);if("number"==typeof t)return o(e,t,n,a);if("string"==typeof t){if("string"==typeof n?(s=n,n=0,a=e.length):"string"==typeof a&&(s=a,a=e.length),void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("latin1"===s&&(s="binary"),"string"==typeof s&&!r.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(""===t)return o(e,0,n,a);if(function(e){return 1===e.length&&e.charCodeAt(0)<256}(t))return o(e,t.charCodeAt(0),n,a);t=new r(t,s)}return r.isBuffer(t)?function(e,t,n,r){if(n<0||r>e.length)throw new RangeError("Out of range index");if(r<=n)return e;n>>>=0,r=void 0===r?e.length:r>>>0;for(var i=n,o=t.length;i<=r-o;)t.copy(e,i),i+=o;return i!==r&&t.copy(e,i,0,r-i),e}(e,t,n,a):o(e,0,n,a)}},692:(e,t,n)=>{"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const r=n(6251),i=n(7467),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50;const a=2147483647;function s(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|g(e,t);let r=s(n);const i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Q(e,Uint8Array)){const t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Q(e,ArrayBuffer)||e&&Q(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(Q(e,SharedArrayBuffer)||e&&Q(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return u.from(r,t,n);const i=function(e){if(u.isBuffer(e)){const t=0|p(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||Y(e.length)?s(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return l(e),s(e<0?0:0|p(e))}function d(e){const t=e.length<0?0:0|p(e.length),n=s(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,u.prototype),r}function p(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function g(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Q(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return J(e).length;default:if(i)return r?-1:V(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return C(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return L(this,t,n);case"base64":return k(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function _(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){let o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){let r=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===r?0:o-r)){if(-1===r&&(r=o),o-r+1===u)return r*a}else-1!==r&&(o-=o-r),r=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){let n=!0;for(let r=0;r<u;r++)if(c(e,o+r)!==c(t,r)){n=!1;break}if(n)return o}return-1}function b(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const o=t.length;let a;for(r>o/2&&(r=o/2),a=0;a<r;++a){const r=parseInt(t.substr(2*a,2),16);if(Y(r))return a;e[n+a]=r}return a}function w(e,t,n,r){return K(V(t,e.length-n),e,n,r)}function E(e,t,n,r){return K(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return K(J(t),e,n,r)}function P(e,t,n,r){return K(function(e,t){let n,r,i;const o=[];for(let a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function k(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function C(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let o=null,a=t>239?4:t>223?3:t>191?2:1;if(i+a<=n){let n,r,s,u;switch(a){case 1:t<128&&(o=t);break;case 2:n=e[i+1],128==(192&n)&&(u=(31&t)<<6|63&n,u>127&&(o=u));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(u=(15&t)<<12|(63&n)<<6|63&r,u>2047&&(u<55296||u>57343)&&(o=u));break;case 4:n=e[i+1],r=e[i+2],s=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&s)&&(u=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&s,u>65535&&u<1114112&&(o=u))}}null===o?(o=65533,a=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),i+=a}return function(e){const t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=I));return n}(r)}t.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?s(e):void 0!==t?"string"==typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},u.allocUnsafe=function(e){return f(e)},u.allocUnsafeSlow=function(e){return f(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(Q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),Q(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=u.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(Q(t,Uint8Array))i+t.length>r.length?(u.isBuffer(t)||(t=u.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!u.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},u.byteLength=g,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)_(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):y.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,n,r,i){if(Q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0);const s=Math.min(o,a),c=this.slice(r,i),l=e.slice(t,n);for(let e=0;e<s;++e)if(c[e]!==l[e]){o=c[e],a=l[e];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let o=!1;for(;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const I=4096;function T(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function L(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function R(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=$[e[r]];return i}function O(e,t,n){const r=e.slice(t,n);let i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}function x(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function B(e,t,n,r,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function A(e,t,n,r,i){W(t,r,i,e,n,7);let o=Number(t&BigInt(4294967295));e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,n}function M(e,t,n,r,i){W(t,r,i,e,n,7);let o=Number(t&BigInt(4294967295));e[n+7]=o,o>>=8,e[n+6]=o,o>>=8,e[n+5]=o,o>>=8,e[n+4]=o;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=a,a>>=8,e[n+2]=a,a>>=8,e[n+1]=a,a>>=8,e[n]=a,n+8}function D(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,r,o){return t=+t,n>>>=0,o||D(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function N(e,t,n,r,o){return t=+t,n>>>=0,o||D(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,u.prototype),r},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||x(e,t,this.length);let r=this[e],i=1,o=0;for(;++o<t&&(i*=256);)r+=this[e+o]*i;return r},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||x(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=X((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||G(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),u.prototype.readBigUInt64BE=X((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||G(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||x(e,t,this.length);let r=this[e],i=1,o=0;for(;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||x(e,t,this.length);let r=t,i=1,o=this[e+--r];for(;r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||x(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||x(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=X((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||G(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),u.prototype.readBigInt64BE=X((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||G(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||x(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||x(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||x(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||x(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){B(this,e,t,n,Math.pow(2,8*n)-1,0)}let i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){B(this,e,t,n,Math.pow(2,8*n)-1,0)}let i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=X((function(e,t=0){return A(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=X((function(e,t=0){return M(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,e,t,n,r-1,-r)}let i=0,o=1,a=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,e,t,n,r-1,-r)}let i=n-1,o=1,a=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=X((function(e,t=0){return A(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=X((function(e,t=0){return M(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return N(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return N(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const o=u.isBuffer(e)?e:u.from(e,r),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%a]}return this};const j={};function q(e,t,n){j[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function F(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function W(e,t,n,r,i,o){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let i;throw i=o>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(o+1)}${r}`:`>= -(2${r} ** ${8*(o+1)-1}${r}) and < 2 ** ${8*(o+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new j.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){z(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||G(t,e.length-(n+1))}(r,i,o)}function z(e,t){if("number"!=typeof e)throw new j.ERR_INVALID_ARG_TYPE(t,"number",e)}function G(e,t,n){if(Math.floor(e)!==e)throw z(e,n),new j.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new j.ERR_BUFFER_OUT_OF_BOUNDS;throw new j.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}q("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),q("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),q("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=F(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=F(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r}),RangeError);const H=/[^+/0-9A-Za-z-_]/g;function V(e,t){let n;t=t||1/0;const r=e.length;let i=null;const o=[];for(let a=0;a<r;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function J(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function K(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const $=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function X(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},5163:(e,t,n)=>{var r=n(4039),i=function(){},o=function(e,t,n){if("function"==typeof t)return o(e,null,t);t||(t={}),n=r(n||i);var a=e._writableState,s=e._readableState,u=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,l=function(){e.writable||f()},f=function(){c=!1,u||n.call(e)},d=function(){u=!1,c||n.call(e)},h=function(t){n.call(e,t?new Error("exited with error code: "+t):null)},p=function(t){n.call(e,t)},g=function(){return(!u||s&&s.ended)&&(!c||a&&a.ended)?void 0:n.call(e,new Error("premature close"))},y=function(){e.req.on("finish",f)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(e)?c&&!a&&(e.on("end",l),e.on("close",l)):(e.on("complete",f),e.on("abort",g),e.req?y():e.on("request",y)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(e)&&e.on("exit",h),e.on("end",d),e.on("finish",f),!1!==t.error&&e.on("error",p),e.on("close",g),function(){e.removeListener("complete",f),e.removeListener("abort",g),e.removeListener("request",y),e.req&&e.req.removeListener("finish",f),e.removeListener("end",l),e.removeListener("close",l),e.removeListener("finish",f),e.removeListener("exit",h),e.removeListener("end",d),e.removeListener("error",p),e.removeListener("close",g)}};e.exports=o},6553:(e,t,n)=>{var r=n(7671),i=n(4039),o=function(){},a=function(e,t,n){if("function"==typeof t)return a(e,null,t);t||(t={}),n=i(n||o);var s=e._writableState,u=e._readableState,c=t.readable||!1!==t.readable&&e.readable,l=t.writable||!1!==t.writable&&e.writable,f=!1,d=function(){e.writable||h()},h=function(){l=!1,c||n.call(e)},p=function(){c=!1,l||n.call(e)},g=function(t){n.call(e,t?new Error("exited with error code: "+t):null)},y=function(t){n.call(e,t)},_=function(){r.nextTick(m)},m=function(){if(!f)return(!c||u&&u.ended&&!u.destroyed)&&(!l||s&&s.ended&&!s.destroyed)?void 0:n.call(e,new Error("premature close"))},v=function(){e.req.on("finish",h)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(e)?l&&!s&&(e.on("end",d),e.on("close",d)):(e.on("complete",h),e.on("abort",_),e.req?v():e.on("request",v)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(e)&&e.on("exit",g),e.on("end",p),e.on("finish",h),!1!==t.error&&e.on("error",y),e.on("close",_),function(){f=!0,e.removeListener("complete",h),e.removeListener("abort",_),e.removeListener("request",v),e.req&&e.req.removeListener("finish",h),e.removeListener("end",d),e.removeListener("close",d),e.removeListener("finish",h),e.removeListener("exit",g),e.removeListener("end",p),e.removeListener("error",y),e.removeListener("close",_)}};e.exports=a},6204:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}(e,i,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,a,c;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=u(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,c=l,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=o[e];if(void 0===u)return!1;if("function"==typeof u)r(u,this,t);else{var c=u.length,l=p(u,c);for(n=0;n<c;++n)r(l[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,f(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7467:(e,t)=>{
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=d,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+f],f+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,r),o-=c}return(h?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[n+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+h]=255&a,h+=p,a/=256,c-=8);e[n+h-p]|=128*g}},4603:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},6488:(e,t,n)=>{
/*! mediasource. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.exports=s;var r=n(4603),i=n(1902),o=n(8022),a="undefined"!=typeof window&&window.MediaSource;function s(e,t){var n=this;if(!(n instanceof s))return new s(e,t);if(!a)throw new Error("web browser lacks MediaSource support");t||(t={}),n._debug=t.debug,n._bufferDuration=t.bufferDuration||60,n._elem=e,n._mediaSource=new a,n._streams=[],n.detailedError=null,n._errorHandler=function(){n._elem.removeEventListener("error",n._errorHandler),n._streams.slice().forEach((function(e){e.destroy(n._elem.error)}))},n._elem.addEventListener("error",n._errorHandler),n._elem.src=window.URL.createObjectURL(n._mediaSource)}function u(e,t){var n=this;if(i.Writable.call(n),n._wrapper=e,n._elem=e._elem,n._mediaSource=e._mediaSource,n._allStreams=e._streams,n._allStreams.push(n),n._bufferDuration=e._bufferDuration,n._sourceBuffer=null,n._debugBuffers=[],n._openHandler=function(){n._onSourceOpen()},n._flowHandler=function(){n._flow()},n._errorHandler=function(e){n.destroyed||n.emit("error",e)},"string"==typeof t)n._type=t,"open"===n._mediaSource.readyState?n._createSourceBuffer():n._mediaSource.addEventListener("sourceopen",n._openHandler);else if(null===t._sourceBuffer)t.destroy(),n._type=t._type,n._mediaSource.addEventListener("sourceopen",n._openHandler);else{if(!t._sourceBuffer)throw new Error("The argument to MediaElementWrapper.createWriteStream must be a string or a previous stream returned from that function");t.destroy(),n._type=t._type,n._sourceBuffer=t._sourceBuffer,n._debugBuffers=t._debugBuffers,n._sourceBuffer.addEventListener("updateend",n._flowHandler),n._sourceBuffer.addEventListener("error",n._errorHandler)}n._elem.addEventListener("timeupdate",n._flowHandler),n.on("error",(function(e){n._wrapper.error(e)})),n.on("finish",(function(){if(!n.destroyed&&(n._finished=!0,n._allStreams.every((function(e){return e._finished})))){n._wrapper._dumpDebugData();try{n._mediaSource.endOfStream()}catch(e){}}}))}s.prototype.createWriteStream=function(e){return new u(this,e)},s.prototype.error=function(e){var t=this;t.detailedError||(t.detailedError=e),t._dumpDebugData();try{t._mediaSource.endOfStream("decode")}catch(e){}try{window.URL.revokeObjectURL(t._elem.src)}catch(e){}},s.prototype._dumpDebugData=function(){var e=this;e._debug&&(e._debug=!1,e._streams.forEach((function(e,t){var n,r,i;n=e._debugBuffers,r="mediasource-stream-"+t,(i=document.createElement("a")).href=window.URL.createObjectURL(new window.Blob(n)),i.download=r,i.click()})))},r(u,i.Writable),u.prototype._onSourceOpen=function(){var e=this;e.destroyed||(e._mediaSource.removeEventListener("sourceopen",e._openHandler),e._createSourceBuffer())},u.prototype.destroy=function(e){var t=this;t.destroyed||(t.destroyed=!0,t._allStreams.splice(t._allStreams.indexOf(t),1),t._mediaSource.removeEventListener("sourceopen",t._openHandler),t._elem.removeEventListener("timeupdate",t._flowHandler),t._sourceBuffer&&(t._sourceBuffer.removeEventListener("updateend",t._flowHandler),t._sourceBuffer.removeEventListener("error",t._errorHandler),"open"===t._mediaSource.readyState&&t._sourceBuffer.abort()),e&&t.emit("error",e),t.emit("close"))},u.prototype._createSourceBuffer=function(){var e=this;if(!e.destroyed)if(a.isTypeSupported(e._type)){if(e._sourceBuffer=e._mediaSource.addSourceBuffer(e._type),e._sourceBuffer.addEventListener("updateend",e._flowHandler),e._sourceBuffer.addEventListener("error",e._errorHandler),e._cb){var t=e._cb;e._cb=null,t()}}else e.destroy(new Error("The provided type is not supported"))},u.prototype._write=function(e,t,n){var r=this;if(!r.destroyed)if(r._sourceBuffer){if(r._sourceBuffer.updating)return n(new Error("Cannot append buffer while source buffer updating"));var i=o(e);r._wrapper._debug&&r._debugBuffers.push(i);try{r._sourceBuffer.appendBuffer(i)}catch(e){return void r.destroy(e)}r._cb=n}else r._cb=function(i){if(i)return n(i);r._write(e,t,n)}},u.prototype._flow=function(){var e=this;if(!e.destroyed&&e._sourceBuffer&&!e._sourceBuffer.updating&&!("open"===e._mediaSource.readyState&&e._getBufferDuration()>e._bufferDuration)&&e._cb){var t=e._cb;e._cb=null,t()}};u.prototype._getBufferDuration=function(){for(var e=this._sourceBuffer.buffered,t=this._elem.currentTime,n=-1,r=0;r<e.length;r++){var i=e.start(r),o=e.end(r)+0;if(i>t)break;(n>=0||t<=o)&&(n=o)}var a=n-t;return a<0&&(a=0),a}},8942:(e,t,n)=>{var r=n(692).Buffer,i=n(9741),o=n(434),a=n(7445),s=20828448e5;t.fullBoxes={};function u(e,t,n){for(var r=t;r<n;r++)e[r]=0}function c(e,t,n){t.writeUInt32BE(Math.floor((e.getTime()+s)/1e3),n)}function l(e,t,n){t.writeUIntBE(Math.floor((e.getTime()+s)/1e3),n,6)}function f(e,t,n){t.writeUInt16BE(Math.floor(e)%65536,n),t.writeUInt16BE(Math.floor(256*e*256)%65536,n+2)}function d(e,t,n){e||(e=[0,0,0,0,0,0,0,0,0]);for(var r=0;r<e.length;r++)f(e[r],t,n+4*r)}function h(e){for(var t=new Array(e.length/4),n=0;n<t.length;n++)t[n]=y(e,4*n);return t}function p(e,t){return new Date(1e3*e.readUIntBE(t,6)-s)}function g(e,t){return new Date(1e3*e.readUInt32BE(t)-s)}function y(e,t){return e.readUInt16BE(t)+e.readUInt16BE(t+2)/65536}function _(e,t){return e[t]+e[t+1]/256}function m(e,t,n){var r;for(r=0;r<n&&0!==e[t+r];r++);return e.toString("utf8",t,t+r)}["mvhd","tkhd","mdhd","vmhd","smhd","stsd","esds","stsz","stco","co64","stss","stts","ctts","stsc","dref","elst","hdlr","mehd","trex","mfhd","tfhd","tfdt","trun"].forEach((function(e){t.fullBoxes[e]=!0})),t.ftyp={},t.ftyp.encode=function(e,n,i){n=n?n.slice(i):r.alloc(t.ftyp.encodingLength(e));var o=e.compatibleBrands||[];n.write(e.brand,0,4,"ascii"),n.writeUInt32BE(e.brandVersion,4);for(var a=0;a<o.length;a++)n.write(o[a],8+4*a,4,"ascii");return t.ftyp.encode.bytes=8+4*o.length,n},t.ftyp.decode=function(e,t){for(var n=(e=e.slice(t)).toString("ascii",0,4),r=e.readUInt32BE(4),i=[],o=8;o<e.length;o+=4)i.push(e.toString("ascii",o,o+4));return{brand:n,brandVersion:r,compatibleBrands:i}},t.ftyp.encodingLength=function(e){return 8+4*(e.compatibleBrands||[]).length},t.mvhd={},t.mvhd.encode=function(e,n,i){return n=n?n.slice(i):r.alloc(96),c(e.ctime||new Date,n,0),c(e.mtime||new Date,n,4),n.writeUInt32BE(e.timeScale||0,8),n.writeUInt32BE(e.duration||0,12),f(e.preferredRate||0,n,16),function(e,t,n){t[n]=Math.floor(e)%256,t[n+1]=Math.floor(256*e)%256}(e.preferredVolume||0,n,20),u(n,22,32),d(e.matrix,n,32),n.writeUInt32BE(e.previewTime||0,68),n.writeUInt32BE(e.previewDuration||0,72),n.writeUInt32BE(e.posterTime||0,76),n.writeUInt32BE(e.selectionTime||0,80),n.writeUInt32BE(e.selectionDuration||0,84),n.writeUInt32BE(e.currentTime||0,88),n.writeUInt32BE(e.nextTrackId||0,92),t.mvhd.encode.bytes=96,n},t.mvhd.decode=function(e,t){return{ctime:g(e=e.slice(t),0),mtime:g(e,4),timeScale:e.readUInt32BE(8),duration:e.readUInt32BE(12),preferredRate:y(e,16),preferredVolume:_(e,20),matrix:h(e.slice(32,68)),previewTime:e.readUInt32BE(68),previewDuration:e.readUInt32BE(72),posterTime:e.readUInt32BE(76),selectionTime:e.readUInt32BE(80),selectionDuration:e.readUInt32BE(84),currentTime:e.readUInt32BE(88),nextTrackId:e.readUInt32BE(92)}},t.mvhd.encodingLength=function(e){return 96},t.tkhd={},t.tkhd.encode=function(e,n,i){return n=n?n.slice(i):r.alloc(80),c(e.ctime||new Date,n,0),c(e.mtime||new Date,n,4),n.writeUInt32BE(e.trackId||0,8),u(n,12,16),n.writeUInt32BE(e.duration||0,16),u(n,20,28),n.writeUInt16BE(e.layer||0,28),n.writeUInt16BE(e.alternateGroup||0,30),n.writeUInt16BE(e.volume||0,32),d(e.matrix,n,36),n.writeUInt32BE(e.trackWidth||0,72),n.writeUInt32BE(e.trackHeight||0,76),t.tkhd.encode.bytes=80,n},t.tkhd.decode=function(e,t){return{ctime:g(e=e.slice(t),0),mtime:g(e,4),trackId:e.readUInt32BE(8),duration:e.readUInt32BE(16),layer:e.readUInt16BE(28),alternateGroup:e.readUInt16BE(30),volume:e.readUInt16BE(32),matrix:h(e.slice(36,72)),trackWidth:e.readUInt32BE(72),trackHeight:e.readUInt32BE(76)}},t.tkhd.encodingLength=function(e){return 80},t.mdhd={},t.mdhd.encode=function(e,n,i){return 1===e.version?(n=n?n.slice(i):r.alloc(32),l(e.ctime||new Date,n,0),l(e.mtime||new Date,n,8),n.writeUInt32BE(e.timeScale||0,16),n.writeUIntBE(e.duration||0,20,6),n.writeUInt16BE(e.language||0,28),n.writeUInt16BE(e.quality||0,30),t.mdhd.encode.bytes=32,n):(n=n?n.slice(i):r.alloc(20),c(e.ctime||new Date,n,0),c(e.mtime||new Date,n,4),n.writeUInt32BE(e.timeScale||0,8),n.writeUInt32BE(e.duration||0,12),n.writeUInt16BE(e.language||0,16),n.writeUInt16BE(e.quality||0,18),t.mdhd.encode.bytes=20,n)},t.mdhd.decode=function(e,t,n){return e=e.slice(t),n-t!=20?{ctime:p(e,0),mtime:p(e,8),timeScale:e.readUInt32BE(16),duration:e.readUIntBE(20,6),language:e.readUInt16BE(28),quality:e.readUInt16BE(30)}:{ctime:g(e,0),mtime:g(e,4),timeScale:e.readUInt32BE(8),duration:e.readUInt32BE(12),language:e.readUInt16BE(16),quality:e.readUInt16BE(18)}},t.mdhd.encodingLength=function(e){return 1===e.version?32:20},t.vmhd={},t.vmhd.encode=function(e,n,i){(n=n?n.slice(i):r.alloc(8)).writeUInt16BE(e.graphicsMode||0,0);var o=e.opcolor||[0,0,0];return n.writeUInt16BE(o[0],2),n.writeUInt16BE(o[1],4),n.writeUInt16BE(o[2],6),t.vmhd.encode.bytes=8,n},t.vmhd.decode=function(e,t){return{graphicsMode:(e=e.slice(t)).readUInt16BE(0),opcolor:[e.readUInt16BE(2),e.readUInt16BE(4),e.readUInt16BE(6)]}},t.vmhd.encodingLength=function(e){return 8},t.smhd={},t.smhd.encode=function(e,n,i){return(n=n?n.slice(i):r.alloc(4)).writeUInt16BE(e.balance||0,0),u(n,2,4),t.smhd.encode.bytes=4,n},t.smhd.decode=function(e,t){return{balance:(e=e.slice(t)).readUInt16BE(0)}},t.smhd.encodingLength=function(e){return 4},t.stsd={},t.stsd.encode=function(e,n,o){n=n?n.slice(o):r.alloc(t.stsd.encodingLength(e));var a=e.entries||[];n.writeUInt32BE(a.length,0);for(var s=4,u=0;u<a.length;u++){var c=a[u];i.encode(c,n,s),s+=i.encode.bytes}return t.stsd.encode.bytes=s,n},t.stsd.decode=function(e,t,n){for(var r=(e=e.slice(t)).readUInt32BE(0),o=new Array(r),a=4,s=0;s<r;s++){var u=i.decode(e,a,n);o[s]=u,a+=u.length}return{entries:o}},t.stsd.encodingLength=function(e){var t=4;if(!e.entries)return t;for(var n=0;n<e.entries.length;n++)t+=i.encodingLength(e.entries[n]);return t},t.avc1=t.VisualSampleEntry={},t.VisualSampleEntry.encode=function(e,n,o){u(n=n?n.slice(o):r.alloc(t.VisualSampleEntry.encodingLength(e)),0,6),n.writeUInt16BE(e.dataReferenceIndex||0,6),u(n,8,24),n.writeUInt16BE(e.width||0,24),n.writeUInt16BE(e.height||0,26),n.writeUInt32BE(e.hResolution||4718592,28),n.writeUInt32BE(e.vResolution||4718592,32),u(n,36,40),n.writeUInt16BE(e.frameCount||1,40);var a=e.compressorName||"",s=Math.min(a.length,31);n.writeUInt8(s,42),n.write(a,43,s,"utf8"),n.writeUInt16BE(e.depth||24,74),n.writeInt16BE(-1,76);var c=78;(e.children||[]).forEach((function(e){i.encode(e,n,c),c+=i.encode.bytes})),t.VisualSampleEntry.encode.bytes=c},t.VisualSampleEntry.decode=function(e,t,n){e=e.slice(t);for(var r=n-t,o=Math.min(e.readUInt8(42),31),a={dataReferenceIndex:e.readUInt16BE(6),width:e.readUInt16BE(24),height:e.readUInt16BE(26),hResolution:e.readUInt32BE(28),vResolution:e.readUInt32BE(32),frameCount:e.readUInt16BE(40),compressorName:e.toString("utf8",43,43+o),depth:e.readUInt16BE(74),children:[]},s=78;r-s>=8;){var u=i.decode(e,s,r);a.children.push(u),a[u.type]=u,s+=u.length}return a},t.VisualSampleEntry.encodingLength=function(e){var t=78;return(e.children||[]).forEach((function(e){t+=i.encodingLength(e)})),t},t.avcC={},t.avcC.encode=function(e,n,i){n=n?n.slice(i):r.alloc(e.buffer.length),e.buffer.copy(n),t.avcC.encode.bytes=e.buffer.length},t.avcC.decode=function(e,t,n){return{mimeCodec:(e=e.slice(t,n)).toString("hex",1,4),buffer:r.from(e)}},t.avcC.encodingLength=function(e){return e.buffer.length},t.mp4a=t.AudioSampleEntry={},t.AudioSampleEntry.encode=function(e,n,o){u(n=n?n.slice(o):r.alloc(t.AudioSampleEntry.encodingLength(e)),0,6),n.writeUInt16BE(e.dataReferenceIndex||0,6),u(n,8,16),n.writeUInt16BE(e.channelCount||2,16),n.writeUInt16BE(e.sampleSize||16,18),u(n,20,24),n.writeUInt32BE(e.sampleRate||0,24);var a=28;(e.children||[]).forEach((function(e){i.encode(e,n,a),a+=i.encode.bytes})),t.AudioSampleEntry.encode.bytes=a},t.AudioSampleEntry.decode=function(e,t,n){for(var r=n-t,o={dataReferenceIndex:(e=e.slice(t,n)).readUInt16BE(6),channelCount:e.readUInt16BE(16),sampleSize:e.readUInt16BE(18),sampleRate:e.readUInt32BE(24),children:[]},a=28;r-a>=8;){var s=i.decode(e,a,r);o.children.push(s),o[s.type]=s,a+=s.length}return o},t.AudioSampleEntry.encodingLength=function(e){var t=28;return(e.children||[]).forEach((function(e){t+=i.encodingLength(e)})),t},t.esds={},t.esds.encode=function(e,n,i){n=n?n.slice(i):r.alloc(e.buffer.length),e.buffer.copy(n,0),t.esds.encode.bytes=e.buffer.length},t.esds.decode=function(e,t,n){e=e.slice(t,n);var i=o.Descriptor.decode(e,0,e.length),a=("ESDescriptor"===i.tagName?i:{}).DecoderConfigDescriptor||{},s=a.oti||0,u=a.DecoderSpecificInfo,c=u?(248&u.buffer.readUInt8(0))>>3:0,l=null;return s&&(l=s.toString(16),c&&(l+="."+c)),{mimeCodec:l,buffer:r.from(e.slice(0))}},t.esds.encodingLength=function(e){return e.buffer.length},t.stsz={},t.stsz.encode=function(e,n,i){var o=e.entries||[];(n=n?n.slice(i):r.alloc(t.stsz.encodingLength(e))).writeUInt32BE(0,0),n.writeUInt32BE(o.length,4);for(var a=0;a<o.length;a++)n.writeUInt32BE(o[a],4*a+8);return t.stsz.encode.bytes=8+4*o.length,n},t.stsz.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=e.readUInt32BE(4),i=new Array(r),o=0;o<r;o++)i[o]=0===n?e.readUInt32BE(4*o+8):n;return{entries:i}},t.stsz.encodingLength=function(e){return 8+4*e.entries.length},t.stss=t.stco={},t.stco.encode=function(e,n,i){var o=e.entries||[];(n=n?n.slice(i):r.alloc(t.stco.encodingLength(e))).writeUInt32BE(o.length,0);for(var a=0;a<o.length;a++)n.writeUInt32BE(o[a],4*a+4);return t.stco.encode.bytes=4+4*o.length,n},t.stco.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++)r[i]=e.readUInt32BE(4*i+4);return{entries:r}},t.stco.encodingLength=function(e){return 4+4*e.entries.length},t.co64={},t.co64.encode=function(e,n,i){var o=e.entries||[];(n=n?n.slice(i):r.alloc(t.co64.encodingLength(e))).writeUInt32BE(o.length,0);for(var s=0;s<o.length;s++)a.encode(o[s],n,8*s+4);return t.co64.encode.bytes=4+8*o.length,n},t.co64.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++)r[i]=a.decode(e,8*i+4);return{entries:r}},t.co64.encodingLength=function(e){return 4+8*e.entries.length},t.stts={},t.stts.encode=function(e,n,i){var o=e.entries||[];(n=n?n.slice(i):r.alloc(t.stts.encodingLength(e))).writeUInt32BE(o.length,0);for(var a=0;a<o.length;a++){var s=8*a+4;n.writeUInt32BE(o[a].count||0,s),n.writeUInt32BE(o[a].duration||0,s+4)}return t.stts.encode.bytes=4+8*e.entries.length,n},t.stts.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=8*i+4;r[i]={count:e.readUInt32BE(o),duration:e.readUInt32BE(o+4)}}return{entries:r}},t.stts.encodingLength=function(e){return 4+8*e.entries.length},t.ctts={},t.ctts.encode=function(e,n,i){var o=e.entries||[];(n=n?n.slice(i):r.alloc(t.ctts.encodingLength(e))).writeUInt32BE(o.length,0);for(var a=0;a<o.length;a++){var s=8*a+4;n.writeUInt32BE(o[a].count||0,s),n.writeUInt32BE(o[a].compositionOffset||0,s+4)}return t.ctts.encode.bytes=4+8*o.length,n},t.ctts.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=8*i+4;r[i]={count:e.readUInt32BE(o),compositionOffset:e.readInt32BE(o+4)}}return{entries:r}},t.ctts.encodingLength=function(e){return 4+8*e.entries.length},t.stsc={},t.stsc.encode=function(e,n,i){var o=e.entries||[];(n=n?n.slice(i):r.alloc(t.stsc.encodingLength(e))).writeUInt32BE(o.length,0);for(var a=0;a<o.length;a++){var s=12*a+4;n.writeUInt32BE(o[a].firstChunk||0,s),n.writeUInt32BE(o[a].samplesPerChunk||0,s+4),n.writeUInt32BE(o[a].sampleDescriptionId||0,s+8)}return t.stsc.encode.bytes=4+12*o.length,n},t.stsc.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=12*i+4;r[i]={firstChunk:e.readUInt32BE(o),samplesPerChunk:e.readUInt32BE(o+4),sampleDescriptionId:e.readUInt32BE(o+8)}}return{entries:r}},t.stsc.encodingLength=function(e){return 4+12*e.entries.length},t.dref={},t.dref.encode=function(e,n,i){n=n?n.slice(i):r.alloc(t.dref.encodingLength(e));var o=e.entries||[];n.writeUInt32BE(o.length,0);for(var a=4,s=0;s<o.length;s++){var u=o[s],c=(u.buf?u.buf.length:0)+4+4;n.writeUInt32BE(c,a),a+=4,n.write(u.type,a,4,"ascii"),a+=4,u.buf&&(u.buf.copy(n,a),a+=u.buf.length)}return t.dref.encode.bytes=a,n},t.dref.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=4,o=0;o<n;o++){var a=e.readUInt32BE(i),s=e.toString("ascii",i+4,i+8),u=e.slice(i+8,i+a);i+=a,r[o]={type:s,buf:u}}return{entries:r}},t.dref.encodingLength=function(e){var t=4;if(!e.entries)return t;for(var n=0;n<e.entries.length;n++){var r=e.entries[n].buf;t+=(r?r.length:0)+4+4}return t},t.elst={},t.elst.encode=function(e,n,i){var o=e.entries||[];(n=n?n.slice(i):r.alloc(t.elst.encodingLength(e))).writeUInt32BE(o.length,0);for(var a=0;a<o.length;a++){var s=12*a+4;n.writeUInt32BE(o[a].trackDuration||0,s),n.writeUInt32BE(o[a].mediaTime||0,s+4),f(o[a].mediaRate||0,n,s+8)}return t.elst.encode.bytes=4+12*o.length,n},t.elst.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=12*i+4;r[i]={trackDuration:e.readUInt32BE(o),mediaTime:e.readInt32BE(o+4),mediaRate:y(e,o+8)}}return{entries:r}},t.elst.encodingLength=function(e){return 4+12*e.entries.length},t.hdlr={},t.hdlr.encode=function(e,n,i){n=n?n.slice(i):r.alloc(t.hdlr.encodingLength(e));var o=21+(e.name||"").length;return n.fill(0,0,o),n.write(e.handlerType||"",4,4,"ascii"),function(e,t,n){var i=r.from(e,"utf8");i.copy(t,n),t[n+i.length]=0}(e.name||"",n,20),t.hdlr.encode.bytes=o,n},t.hdlr.decode=function(e,t,n){return{handlerType:(e=e.slice(t)).toString("ascii",4,8),name:m(e,20,n)}},t.hdlr.encodingLength=function(e){return 21+(e.name||"").length},t.mehd={},t.mehd.encode=function(e,n,i){return(n=n?n.slice(i):r.alloc(4)).writeUInt32BE(e.fragmentDuration||0,0),t.mehd.encode.bytes=4,n},t.mehd.decode=function(e,t){return{fragmentDuration:(e=e.slice(t)).readUInt32BE(0)}},t.mehd.encodingLength=function(e){return 4},t.trex={},t.trex.encode=function(e,n,i){return(n=n?n.slice(i):r.alloc(20)).writeUInt32BE(e.trackId||0,0),n.writeUInt32BE(e.defaultSampleDescriptionIndex||0,4),n.writeUInt32BE(e.defaultSampleDuration||0,8),n.writeUInt32BE(e.defaultSampleSize||0,12),n.writeUInt32BE(e.defaultSampleFlags||0,16),t.trex.encode.bytes=20,n},t.trex.decode=function(e,t){return{trackId:(e=e.slice(t)).readUInt32BE(0),defaultSampleDescriptionIndex:e.readUInt32BE(4),defaultSampleDuration:e.readUInt32BE(8),defaultSampleSize:e.readUInt32BE(12),defaultSampleFlags:e.readUInt32BE(16)}},t.trex.encodingLength=function(e){return 20},t.mfhd={},t.mfhd.encode=function(e,n,i){return(n=n?n.slice(i):r.alloc(4)).writeUInt32BE(e.sequenceNumber||0,0),t.mfhd.encode.bytes=4,n},t.mfhd.decode=function(e,t){return{sequenceNumber:e.readUInt32BE(0)}},t.mfhd.encodingLength=function(e){return 4},t.tfhd={},t.tfhd.encode=function(e,n,i){return(n=n?n.slice(i):r.alloc(4)).writeUInt32BE(e.trackId,0),t.tfhd.encode.bytes=4,n},t.tfhd.decode=function(e,t){},t.tfhd.encodingLength=function(e){return 4},t.tfdt={},t.tfdt.encode=function(e,n,i){return(n=n?n.slice(i):r.alloc(4)).writeUInt32BE(e.baseMediaDecodeTime||0,0),t.tfdt.encode.bytes=4,n},t.tfdt.decode=function(e,t){},t.tfdt.encodingLength=function(e){return 4},t.trun={},t.trun.encode=function(e,n,i){(n=n?n.slice(i):r.alloc(8+16*e.entries.length)).writeUInt32BE(e.entries.length,0),n.writeInt32BE(e.dataOffset,4);for(var o=8,a=0;a<e.entries.length;a++){var s=e.entries[a];n.writeUInt32BE(s.sampleDuration,o),o+=4,n.writeUInt32BE(s.sampleSize,o),o+=4,n.writeUInt32BE(s.sampleFlags,o),o+=4,0===(e.version||0)?n.writeUInt32BE(s.sampleCompositionTimeOffset,o):n.writeInt32BE(s.sampleCompositionTimeOffset,o),o+=4}t.trun.encode.bytes=o},t.trun.decode=function(e,t){},t.trun.encodingLength=function(e){return 8+16*e.entries.length},t.mdat={},t.mdat.encode=function(e,n,r){e.buffer?(e.buffer.copy(n,r),t.mdat.encode.bytes=e.buffer.length):t.mdat.encode.bytes=t.mdat.encodingLength(e)},t.mdat.decode=function(e,t,n){return{buffer:r.from(e.slice(t,n))}},t.mdat.encodingLength=function(e){return e.buffer?e.buffer.length:e.contentLength}},434:(e,t,n)=>{var r=n(692).Buffer,i={3:"ESDescriptor",4:"DecoderConfigDescriptor",5:"DecoderSpecificInfo",6:"SLConfigDescriptor"};t.Descriptor={},t.Descriptor.decode=function(e,n,o){var a,s,u=e.readUInt8(n),c=n+1,l=0;do{l=l<<7|127&(a=e.readUInt8(c++))}while(128&a);var f=i[u];return(s=t[f]?t[f].decode(e,c,o):{buffer:r.from(e.slice(c,c+l))}).tag=u,s.tagName=f,s.length=c-n+l,s.contentsLen=l,s},t.DescriptorArray={},t.DescriptorArray.decode=function(e,n,r){for(var o=n,a={};o+2<=r;){var s=t.Descriptor.decode(e,o,r);o+=s.length,a[i[s.tag]||"Descriptor"+s.tag]=s}return a},t.ESDescriptor={},t.ESDescriptor.decode=function(e,n,r){var i=e.readUInt8(n+2),o=n+3;(128&i&&(o+=2),64&i)&&(o+=e.readUInt8(o)+1);return 32&i&&(o+=2),t.DescriptorArray.decode(e,o,r)},t.DecoderConfigDescriptor={},t.DecoderConfigDescriptor.decode=function(e,n,r){var i=e.readUInt8(n),o=t.DescriptorArray.decode(e,n+13,r);return o.oti=i,o}},9741:(e,t,n)=>{var r=n(692).Buffer,i=n(7445),o=n(8942),a=4294967295,s=t,u=t.containers={moov:["mvhd","meta","traks","mvex"],trak:["tkhd","tref","trgr","edts","meta","mdia","udta"],edts:["elst"],mdia:["mdhd","hdlr","elng","minf"],minf:["vmhd","smhd","hmhd","sthd","nmhd","dinf","stbl"],dinf:["dref"],stbl:["stsd","stts","ctts","cslg","stsc","stsz","stz2","stco","co64","stss","stsh","padb","stdp","sdtp","sbgps","sgpds","subss","saizs","saios"],mvex:["mehd","trexs","leva"],moof:["mfhd","meta","trafs"],traf:["tfhd","tfdt","trun","sbgps","sgpds","subss","saizs","saios","meta"]};s.encode=function(e,t,n){return s.encodingLength(e),n=n||0,t=t||r.alloc(e.length),s._encode(e,t,n)},s._encode=function(e,t,n){var r=e.type,c=e.length;c>a&&(c=1),t.writeUInt32BE(c,n),t.write(e.type,n+4,4,"ascii");var l=n+8;if(1===c&&(i.encode(e.length,t,l),l+=8),o.fullBoxes[r]&&(t.writeUInt32BE(e.flags||0,l),t.writeUInt8(e.version||0,l),l+=4),u[r])u[r].forEach((function(n){if(5===n.length){var r=e[n]||[];n=n.substr(0,4),r.forEach((function(e){s._encode(e,t,l),l+=s.encode.bytes}))}else e[n]&&(s._encode(e[n],t,l),l+=s.encode.bytes)})),e.otherBoxes&&e.otherBoxes.forEach((function(e){s._encode(e,t,l),l+=s.encode.bytes}));else if(o[r]){var f=o[r].encode;f(e,t,l),l+=f.bytes}else{if(!e.buffer)throw new Error("Either `type` must be set to a known type (not'"+r+"') or `buffer` must be set");e.buffer.copy(t,l),l+=e.buffer.length}return s.encode.bytes=l-n,t},s.readHeaders=function(e,t,n){if(t=t||0,(n=n||e.length)-t<8)return 8;var r,a,s=e.readUInt32BE(t),u=e.toString("ascii",t+4,t+8),c=t+8;if(1===s){if(n-t<16)return 16;s=i.decode(e,c),c+=8}return o.fullBoxes[u]&&(r=e.readUInt8(c),a=16777215&e.readUInt32BE(c),c+=4),{length:s,headersLen:c-t,contentLen:s-(c-t),type:u,version:r,flags:a}},s.decode=function(e,t,n){t=t||0,n=n||e.length;var r=s.readHeaders(e,t,n);if(!r||r.length>n-t)throw new Error("Data too short");return s.decodeWithoutHeaders(r,e,t+r.headersLen,t+r.length)},s.decodeWithoutHeaders=function(e,t,n,i){n=n||0,i=i||t.length;var a=e.type,c={};if(u[a]){c.otherBoxes=[];for(var l=u[a],f=n;i-f>=8;){var d=s.decode(t,f,i);if(f+=d.length,l.indexOf(d.type)>=0)c[d.type]=d;else if(l.indexOf(d.type+"s")>=0){var h=d.type+"s";(c[h]=c[h]||[]).push(d)}else c.otherBoxes.push(d)}}else if(o[a]){c=(0,o[a].decode)(t,n,i)}else c.buffer=r.from(t.slice(n,i));return c.length=e.length,c.contentLen=e.contentLen,c.type=e.type,c.version=e.version,c.flags=e.flags,c},s.encodingLength=function(e){var t=e.type,n=8;if(o.fullBoxes[t]&&(n+=4),u[t])u[t].forEach((function(t){if(5===t.length){var r=e[t]||[];t=t.substr(0,4),r.forEach((function(e){e.type=t,n+=s.encodingLength(e)}))}else if(e[t]){var i=e[t];i.type=t,n+=s.encodingLength(i)}})),e.otherBoxes&&e.otherBoxes.forEach((function(e){n+=s.encodingLength(e)}));else if(o[t])n+=o[t].encodingLength(e);else{if(!e.buffer)throw new Error("Either `type` must be set to a known type (not'"+t+"') or `buffer` must be set");n+=e.buffer.length}return n>a&&(n+=8),e.length=n,n}},7279:(e,t,n)=>{var r=n(692).Buffer,i=n(1902),o=n(7149),a=n(9741),s=r.alloc(0);class u extends i.Writable{constructor(e){super(e),this.destroyed=!1,this._pending=0,this._missing=0,this._ignoreEmpty=!1,this._buf=null,this._str=null,this._cb=null,this._ondrain=null,this._writeBuffer=null,this._writeCb=null,this._ondrain=null,this._kick()}destroy(e){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e),this.emit("close"))}_write(e,t,n){if(!this.destroyed){for(var r=!this._str||!this._str._writableState.needDrain;e.length&&!this.destroyed;){if(!this._missing&&!this._ignoreEmpty)return this._writeBuffer=e,void(this._writeCb=n);var i=e.length<this._missing?e.length:this._missing;if(this._buf?e.copy(this._buf,this._buf.length-this._missing):this._str&&(r=this._str.write(i===e.length?e:e.slice(0,i))),this._missing-=i,!this._missing){var o=this._buf,a=this._cb,u=this._str;this._buf=this._cb=this._str=this._ondrain=null,r=!0,this._ignoreEmpty=!1,u&&u.end(),a&&a(o)}e=i===e.length?s:e.slice(i)}if(this._pending&&!this._missing)return this._writeBuffer=e,void(this._writeCb=n);r?n():this._ondrain(n)}}_buffer(e,t){this._missing=e,this._buf=r.alloc(e),this._cb=t}_stream(e,t){return this._missing=e,this._str=new c(this),this._ondrain=o(this._str,"drain"),this._pending++,this._str.on("end",(()=>{this._pending--,this._kick()})),this._cb=t,this._str}_readBox(){const e=(t,n)=>{this._buffer(t,(t=>{n=n?r.concat([n,t]):t;var i=a.readHeaders(n);"number"==typeof i?e(i-n.length,n):(this._pending++,this._headers=i,this.emit("box",i))}))};e(8)}stream(){if(!this._headers)throw new Error("this function can only be called once after 'box' is emitted");var e=this._headers;return this._headers=null,this._stream(e.contentLen,(()=>{this._pending--,this._kick()}))}decode(e){if(!this._headers)throw new Error("this function can only be called once after 'box' is emitted");var t=this._headers;this._headers=null,this._buffer(t.contentLen,(n=>{var r=a.decodeWithoutHeaders(t,n);e(r),this._pending--,this._kick()}))}ignore(){if(!this._headers)throw new Error("this function can only be called once after 'box' is emitted");var e=this._headers;this._headers=null,this._missing=e.contentLen,0===this._missing&&(this._ignoreEmpty=!0),this._cb=()=>{this._pending--,this._kick()}}_kick(){if(!this._pending&&(this._buf||this._str||this._readBox(),this._writeBuffer)){var e=this._writeCb,t=this._writeBuffer;this._writeBuffer=null,this._writeCb=null,this._write(t,null,e)}}}class c extends i.PassThrough{constructor(e){super(),this._parent=e,this.destroyed=!1}destroy(e){this.destroyed||(this.destroyed=!0,this._parent.destroy(e),e&&this.emit("error",e),this.emit("close"))}}e.exports=u},4822:(e,t,n)=>{var r=n(692).Buffer,i=n(1902),o=n(9741),a=n(7963);function s(){}class u extends i.Readable{constructor(e){super(e),this.destroyed=!1,this._finalized=!1,this._reading=!1,this._stream=null,this._drain=null,this._want=!1,this._onreadable=()=>{this._want&&(this._want=!1,this._read())},this._onend=()=>{this._stream=null}}mdat(e,t){this.mediaData(e,t)}mediaData(e,t){var n=new c(this);return this.box({type:"mdat",contentLength:e,encodeBufferLen:8,stream:n},t),n}box(e,t){if(t||(t=s),this.destroyed)return t(new Error("Encoder is destroyed"));var n;if(e.encodeBufferLen&&(n=r.alloc(e.encodeBufferLen)),e.stream)e.buffer=null,n=o.encode(e,n),this.push(n),this._stream=e.stream,this._stream.on("readable",this._onreadable),this._stream.on("end",this._onend),this._stream.on("end",t),this._forward();else{if(n=o.encode(e,n),this.push(n))return a(t);this._drain=t}}destroy(e){if(!this.destroyed){if(this.destroyed=!0,this._stream&&this._stream.destroy&&this._stream.destroy(),this._stream=null,this._drain){var t=this._drain;this._drain=null,t(e)}e&&this.emit("error",e),this.emit("close")}}finalize(){this._finalized=!0,this._stream||this._drain||this.push(null)}_forward(){if(this._stream)for(;!this.destroyed;){var e=this._stream.read();if(!e)return void(this._want=!!this._stream);if(!this.push(e))return}}_read(){if(!this._reading&&!this.destroyed){if(this._reading=!0,this._stream&&this._forward(),this._drain){var e=this._drain;this._drain=null,e()}this._reading=!1,this._finalized&&this.push(null)}}}class c extends i.PassThrough{constructor(e){super(),this._parent=e,this.destroyed=!1}destroy(e){this.destroyed||(this.destroyed=!0,this._parent.destroy(e),e&&this.emit("error",e),this.emit("close"))}}e.exports=u},5201:(e,t,n)=>{const r=n(7279),i=n(4822);t.decode=e=>new r(e),t.encode=e=>new i(e)},7149:e=>{e.exports=function(e,t){var n=null;return e.on(t,(function(e){if(n){var t=n;n=null,t(e)}})),function(e){n=e}}},4039:(e,t,n)=>{var r=n(5423);function i(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function o(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}e.exports=r(i),e.exports.strict=r(o),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})}))},7671:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var s,u=[],c=!1,l=-1;function f(){c&&s&&(c=!1,s.length?u=s.concat(u):l=-1,u.length&&d())}function d(){if(!c){var e=a(f);c=!0;for(var t=u.length;t;){for(s=u,u=[];++l<t;)s&&s[l].run();l=-1,t=u.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new h(e,t)),1!==u.length||c||a(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},7888:(e,t,n)=>{var r=n(7671),i=n(4039),o=n(6553),a=n(5466),s=function(){},u=/^v?\.0/.test(r.version),c=function(e){return"function"==typeof e},l=function(e,t,n,r){r=i(r);var l=!1;e.on("close",(function(){l=!0})),o(e,{readable:t,writable:n},(function(e){if(e)return r(e);l=!0,r()}));var f=!1;return function(t){if(!l&&!f)return f=!0,function(e){return!!u&&!!a&&(e instanceof(a.ReadStream||s)||e instanceof(a.WriteStream||s))&&c(e.close)}(e)?e.close(s):function(e){return e.setHeader&&c(e.abort)}(e)?e.abort():c(e.destroy)?e.destroy():void r(t||new Error("stream was destroyed"))}},f=function(e){e()},d=function(e,t){return e.pipe(t)};e.exports=function(){var e,t=Array.prototype.slice.call(arguments),n=c(t[t.length-1]||s)&&t.pop()||s;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Error("pump requires two streams per minimum");var r=t.map((function(i,o){var a=o<t.length-1;return l(i,a,o>0,(function(t){e||(e=t),t&&r.forEach(f),a||(r.forEach(f),n(e))}))}));return t.reduce(d)}},7963:(e,t,n)=>{
/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
let r;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:n.g):e=>(r||(r=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},9265:(e,t,n)=>{const{Writable:r,PassThrough:i}=n(1902);e.exports=class extends r{constructor(e,t={}){super(t),this.destroyed=!1,this._queue=[],this._position=e||0,this._cb=null,this._buffer=null,this._out=null}_write(e,t,n){let r=!0;for(;;){if(this.destroyed)return;if(0===this._queue.length)return this._buffer=e,void(this._cb=n);this._buffer=null;var i=this._queue[0];const t=Math.max(i.start-this._position,0),o=i.end-this._position;if(t>=e.length)return this._position+=e.length,n(null);let a;if(o>e.length){this._position+=e.length,a=0===t?e:e.slice(t),r=i.stream.write(a)&&r;break}this._position+=o,a=0===t&&o===e.length?e:e.slice(t,o),r=i.stream.write(a)&&r,i.last&&i.stream.end(),e=e.slice(o),this._queue.shift()}r?n(null):i.stream.once("drain",n.bind(null,null))}slice(e){if(this.destroyed)return null;Array.isArray(e)||(e=[e]);const t=new i;return e.forEach(((n,r)=>{this._queue.push({start:n.start,end:n.end,stream:t,last:r===e.length-1})})),this._buffer&&this._write(this._buffer,null,this._cb),t}destroy(e){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e))}}},1686:e=>{"use strict";var t={};function n(e,n,r){r||(r=Error);var i=function(e){var t,r;function i(t,r,i){return e.call(this,function(e,t,r){return"string"==typeof n?n:n(e,t,r)}(t,r,i))||this}return r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i}(r);i.prototype.name=r.name,i.prototype.code=e,t[e]=i}function r(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,o,a,s;if("string"==typeof t&&(o="not ",t.substr(!a||a<0?0:+a,o.length)===o)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))s="The ".concat(e," ").concat(i," ").concat(r(t,"type"));else{var u=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";s='The "'.concat(e,'" ').concat(u," ").concat(i," ").concat(r(t,"type"))}return s+=". Received type ".concat(typeof n)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},8600:(e,t,n)=>{"use strict";var r=n(7671),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(9723),a=n(349);n(4603)(l,o);for(var s=i(a.prototype),u=0;u<s.length;u++){var c=s[u];l.prototype[c]||(l.prototype[c]=a.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);o.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",f)))}function f(){this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},9795:(e,t,n)=>{"use strict";e.exports=i;var r=n(7756);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}n(4603)(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},9723:(e,t,n)=>{"use strict";var r,i=n(7671);e.exports=k,k.ReadableState=P;n(6204).EventEmitter;var o=function(e,t){return e.listeners(t).length},a=n(2670),s=n(692).Buffer,u=n.g.Uint8Array||function(){};var c,l=n(8364);c=l&&l.debuglog?l.debuglog("stream"):function(){};var f,d,h,p=n(1748),g=n(528),y=n(814).getHighWaterMark,_=n(1686).q,m=_.ERR_INVALID_ARG_TYPE,v=_.ERR_STREAM_PUSH_AFTER_EOF,b=_.ERR_METHOD_NOT_IMPLEMENTED,w=_.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(4603)(k,a);var E=g.errorOrDestroy,S=["error","close","destroy","pause","resume"];function P(e,t,i){r=r||n(8600),e=e||{},"boolean"!=typeof i&&(i=t instanceof r),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=y(this,e,"readableHighWaterMark",i),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(f||(f=n(8154).s),this.decoder=new f(e.encoding),this.encoding=e.encoding)}function k(e){if(r=r||n(8600),!(this instanceof k))return new k(e);var t=this instanceof r;this._readableState=new P(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function C(e,t,n,r,i){c("readableAddChunk",t);var o,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?R(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,O(e)))}(e,a);else if(i||(o=function(e,t){var n;r=t,s.isBuffer(r)||r instanceof u||"string"==typeof t||void 0===t||e.objectMode||(n=new m("chunk",["string","Buffer","Uint8Array"],t));var r;return n}(a,t)),o)E(e,o);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),r)a.endEmitted?E(e,new w):I(e,a,t,!0);else if(a.ended)E(e,new v);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?I(e,a,t,!1):x(e,a)):I(e,a,t,!1)}else r||(a.reading=!1,x(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function I(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&R(e)),x(e,t)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),k.prototype.destroy=g.destroy,k.prototype._undestroy=g.undestroy,k.prototype._destroy=function(e,t){t(e)},k.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=s.from(e,t),t=""),n=!0),C(this,e,t,!1,n)},k.prototype.unshift=function(e){return C(this,e,null,!0,!1)},k.prototype.isPaused=function(){return!1===this._readableState.flowing},k.prototype.setEncoding=function(e){f||(f=n(8154).s);var t=new f(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";null!==r;)i+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var T=1073741824;function L(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=T?e=T:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function R(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(O,e))}function O(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,U(e)}function x(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(B,e,t))}function B(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function A(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function M(e){c("readable nexttick read 0"),e.read(0)}function D(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),U(e),t.flowing&&!t.reading&&e.read(0)}function U(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function N(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function j(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick(q,t,e))}function q(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function F(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}k.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?j(this):R(this),null;if(0===(e=L(e,t))&&t.ended)return 0===t.length&&j(this),null;var r,i=t.needReadable;return c("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",i=!0),t.ended||t.reading?c("reading or ended",i=!1):i&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=L(n,t))),null===(r=e>0?N(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&j(this)),null!==r&&this.emit("data",r),r},k.prototype._read=function(e){E(this,new b("_read()"))},k.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,c("pipe count=%d opts=%j",r.pipesCount,t);var a=(!t||!1!==t.end)&&e!==i.stdout&&e!==i.stderr?u:y;function s(t,i){c("onunpipe"),t===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,c("cleanup"),e.removeListener("close",p),e.removeListener("finish",g),e.removeListener("drain",l),e.removeListener("error",h),e.removeListener("unpipe",s),n.removeListener("end",u),n.removeListener("end",y),n.removeListener("data",d),f=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function u(){c("onend"),e.end()}r.endEmitted?i.nextTick(a):n.once("end",a),e.on("unpipe",s);var l=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,U(e))}}(n);e.on("drain",l);var f=!1;function d(t){c("ondata");var i=e.write(t);c("dest.write",i),!1===i&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==F(r.pipes,e))&&!f&&(c("false write response, pause",r.awaitDrain),r.awaitDrain++),n.pause())}function h(t){c("onerror",t),y(),e.removeListener("error",h),0===o(e,"error")&&E(e,t)}function p(){e.removeListener("finish",g),y()}function g(){c("onfinish"),e.removeListener("close",p),y()}function y(){c("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",p),e.once("finish",g),e.emit("pipe",n),r.flowing||(c("pipe resume"),n.resume()),e},k.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=F(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},k.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,c("on readable",r.length,r.reading),r.length?R(this):r.reading||i.nextTick(M,this))),n},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(e,t){var n=a.prototype.removeListener.call(this,e,t);return"readable"===e&&i.nextTick(A,this),n},k.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||i.nextTick(A,this),t},k.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(D,e,t))}(this,e)),e.paused=!1,this},k.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},k.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(c("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<S.length;o++)e.on(S[o],this.emit.bind(this,S[o]));return this._read=function(t){c("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(k.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=n(3951)),d(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),k._fromList=N,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(k.from=function(e,t){return void 0===h&&(h=n(3730)),h(k,e,t)})},7756:(e,t,n)=>{"use strict";e.exports=l;var r=n(1686).q,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,a=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=r.ERR_TRANSFORM_WITH_LENGTH_0,u=n(8600);function c(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);u.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",f)}function f(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,n){d(e,t,n)}))}function d(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new s;if(e._transformState.transforming)throw new a;return e.push(null)}n(4603)(l,u),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,n){n(new i("_transform()"))},l.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,(function(e){t(e)}))}},349:(e,t,n)=>{"use strict";var r,i=n(7671);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=k,k.WritableState=P;var a={deprecate:n(5091)},s=n(2670),u=n(692).Buffer,c=n.g.Uint8Array||function(){};var l,f=n(528),d=n(814).getHighWaterMark,h=n(1686).q,p=h.ERR_INVALID_ARG_TYPE,g=h.ERR_METHOD_NOT_IMPLEMENTED,y=h.ERR_MULTIPLE_CALLBACK,_=h.ERR_STREAM_CANNOT_PIPE,m=h.ERR_STREAM_DESTROYED,v=h.ERR_STREAM_NULL_VALUES,b=h.ERR_STREAM_WRITE_AFTER_END,w=h.ERR_UNKNOWN_ENCODING,E=f.errorOrDestroy;function S(){}function P(e,t,a){r=r||n(8600),e=e||{},"boolean"!=typeof a&&(a=t instanceof r),this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=!1===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if("function"!=typeof o)throw new y;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,o){--t.pendingcb,n?(i.nextTick(o,r),i.nextTick(O,e,t),e._writableState.errorEmitted=!0,E(e,r)):(o(r),e._writableState.errorEmitted=!0,E(e,r),O(e,t))}(e,n,r,t,o);else{var a=L(n)||e.destroyed;a||n.corked||n.bufferProcessing||!n.bufferedRequest||T(e,n),r?i.nextTick(I,e,n,a,o):I(e,n,a,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function k(e){var t=this instanceof(r=r||n(8600));if(!t&&!l.call(k,this))return new k(e);this._writableState=new P(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),s.call(this)}function C(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new m("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function I(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),O(e,t)}function T(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var s=0,u=!0;n;)i[s]=n,n.isBuf||(u=!1),n=n.next,s+=1;i.allBuffers=u,C(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,l=n.encoding,f=n.callback;if(C(e,t,!1,t.objectMode?1:c.length,c,l,f),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function L(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function R(e,t){e._final((function(n){t.pendingcb--,n&&E(e,n),t.prefinished=!0,e.emit("prefinish"),O(e,t)}))}function O(e,t){var n=L(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.nextTick(R,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}n(4603)(k,s),P.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(P.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===k&&(e&&e._writableState instanceof P)}})):l=function(e){return e instanceof this},k.prototype.pipe=function(){E(this,new _)},k.prototype.write=function(e,t,n){var r,o=this._writableState,a=!1,s=!o.objectMode&&(r=e,u.isBuffer(r)||r instanceof c);return s&&!u.isBuffer(e)&&(e=function(e){return u.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof n&&(n=S),o.ending?function(e,t){var n=new b;E(e,n),i.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var o;return null===n?o=new v:"string"==typeof n||t.objectMode||(o=new p("chunk",["string","Buffer"],n)),!o||(E(e,o),i.nextTick(r,o),!1)}(this,o,e,n))&&(o.pendingcb++,a=function(e,t,n,r,i,o){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,n));return t}(t,r,i);r!==a&&(n=!0,i="buffer",r=a)}var s=t.objectMode?1:r.length;t.length+=s;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else C(e,t,!1,s,r,i,o);return c}(this,o,s,e,t,n)),a},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||T(this,e))},k.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),k.prototype._write=function(e,t,n){n(new g("_write()"))},k.prototype._writev=null,k.prototype.end=function(e,t,n){var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,O(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),k.prototype.destroy=f.destroy,k.prototype._undestroy=f.undestroy,k.prototype._destroy=function(e,t){t(e)}},3951:(e,t,n)=>{"use strict";var r,i=n(7671);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=n(6583),s=Symbol("lastResolve"),u=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),f=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function g(e){var t=e[s];if(null!==t){var n=e[h].read();null!==n&&(e[f]=null,e[s]=null,e[u]=null,t(p(n,!1)))}}function y(e){i.nextTick(g,e)}var _=Object.getPrototypeOf((function(){})),m=Object.setPrototypeOf((o(r={get stream(){return this[h]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(p(void 0,!0));if(this[h].destroyed)return new Promise((function(t,n){i.nextTick((function(){e[c]?n(e[c]):t(p(void 0,!0))}))}));var n,r=this[f];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[l]?n(p(void 0,!0)):t[d](n,r)}),r)}}(r,this));else{var o=this[h].read();if(null!==o)return Promise.resolve(p(o,!1));n=new Promise(this[d])}return this[f]=n,n}},Symbol.asyncIterator,(function(){return this})),o(r,"return",(function(){var e=this;return new Promise((function(t,n){e[h].destroy(null,(function(e){e?n(e):t(p(void 0,!0))}))}))})),r),_);e.exports=function(e){var t,n=Object.create(m,(o(t={},h,{value:e,writable:!0}),o(t,s,{value:null,writable:!0}),o(t,u,{value:null,writable:!0}),o(t,c,{value:null,writable:!0}),o(t,l,{value:e._readableState.endEmitted,writable:!0}),o(t,d,{value:function(e,t){var r=n[h].read();r?(n[f]=null,n[s]=null,n[u]=null,e(p(r,!1))):(n[s]=e,n[u]=t)},writable:!0}),t));return n[f]=null,a(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[u];return null!==t&&(n[f]=null,n[s]=null,n[u]=null,t(e)),void(n[c]=e)}var r=n[s];null!==r&&(n[f]=null,n[s]=null,n[u]=null,r(p(void 0,!0))),n[l]=!0})),e.on("readable",y.bind(null,n)),n}},1748:(e,t,n)=>{"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(692).Buffer,s=n(8901).inspect,u=s&&s.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,c;return t=e,n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return a.alloc(0);for(var t,n,r,i=a.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,n=i,r=s,a.prototype.copy.call(t,n,r),s+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=a.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=i.slice(o));break}++r}return this.length-=r,t}},{key:u,value:function(e,t){return s(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],n&&o(t.prototype,n),c&&o(t,c),e}()},528:(e,t,n)=>{"use strict";var r=n(7671);function i(e,t){a(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function a(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return s||u?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(a,this,e)):r.nextTick(a,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?r.nextTick(o,n):(n._writableState.errorEmitted=!0,r.nextTick(i,n,e)):r.nextTick(i,n,e):t?(r.nextTick(o,n),t(e)):r.nextTick(o,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}},6583:(e,t,n)=>{"use strict";var r=n(1686).q.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r)}}}(o||i);var a=n.readable||!1!==n.readable&&t.readable,s=n.writable||!1!==n.writable&&t.writable,u=function(){t.writable||l()},c=t._writableState&&t._writableState.finished,l=function(){s=!1,c=!0,a||o.call(t)},f=t._readableState&&t._readableState.endEmitted,d=function(){a=!1,f=!0,s||o.call(t)},h=function(e){o.call(t,e)},p=function(){var e;return a&&!f?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):s&&!c?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},g=function(){t.req.on("finish",l)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?s&&!t._writableState&&(t.on("end",u),t.on("close",u)):(t.on("complete",l),t.on("abort",p),t.req?g():t.on("request",g)),t.on("end",d),t.on("finish",l),!1!==n.error&&t.on("error",h),t.on("close",p),function(){t.removeListener("complete",l),t.removeListener("abort",p),t.removeListener("request",g),t.req&&t.req.removeListener("finish",l),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",h),t.removeListener("close",p)}}},3730:e=>{e.exports=function(){throw new Error("Readable.from is not available in the browser")}},5924:(e,t,n)=>{"use strict";var r;var i=n(1686).q,o=i.ERR_MISSING_ARGS,a=i.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function u(e,t,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var s=!1;e.on("close",(function(){s=!0})),void 0===r&&(r=n(6583)),r(e,{readable:t,writable:i},(function(e){if(e)return o(e);s=!0,o()}));var u=!1;return function(t){if(!s&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new a("pipe"))}}function c(e){e()}function l(e,t){return e.pipe(t)}function f(e){return e.length?"function"!=typeof e[e.length-1]?s:e.pop():s}e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=f(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var a=t.map((function(e,n){var o=n<t.length-1;return u(e,o,n>0,(function(e){r||(r=e),e&&a.forEach(c),o||(a.forEach(c),i(r))}))}));return t.reduce(l)}},814:(e,t,n)=>{"use strict";var r=n(1686).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},2670:(e,t,n)=>{e.exports=n(6204).EventEmitter},1902:(e,t,n)=>{(t=e.exports=n(9723)).Stream=t,t.Readable=t,t.Writable=n(349),t.Duplex=n(8600),t.Transform=n(7756),t.PassThrough=n(9795),t.finished=n(6583),t.pipeline=n(5924)},7760:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function a(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e}var s=function(e,t){this.target=t,this.type=e},u=function(e){function t(t,n){var r=e.call(this,"error",n)||this;return r.message=t.message,r.error=t,r}return i(t,e),t}(s),c=function(e){function t(t,n,r){void 0===t&&(t=1e3),void 0===n&&(n="");var i=e.call(this,"close",r)||this;return i.wasClean=!0,i.code=t,i.reason=n,i}return i(t,e),t}(s),l=function(){if("undefined"!=typeof WebSocket)return WebSocket},f={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1};const d=function(){}