mw.loader.implement("ext.gadget.Charts@wz87g",function($,jQuery,require,module){if($('.rsw-chartjs-config').length){mw.loader.load('ext.gadget.Charts-core');}});mw.loader.implement("ext.gadget.GECharts@515a7",function($,jQuery,require,module){if($('.GEdatachart').length){mw.loader.load('ext.gadget.GECharts-core');}});mw.loader.implement("ext.gadget.InstantCollapsible@su2qe",function($,jQuery,require,module){(function($){'use strict';function noFade(){var $toggle=$('th > .mw-collapsible-toggle'),$table=$toggle.parent().parent().parent().parent();$toggle.unbind('click');$table.find('td > table.navbox-subgroup > tbody > tr[style*="display"]').css('display','');$table.find('td > table > tbody > tr[style*="display"] > th.navbox-title').parent().css('display','');$toggle.click(function(e){e.preventDefault();var $this=$(this),$table=$this.parent().parent().parent().parent(),expand=$table.attr('data-expandtext')||mw.msg('collapsible-expand')||'Expand',collapse=$table.attr('data-collapsetext')||mw.msg('collapsible-collapse')||'Collapse',$tr,hasHeader=false;if($table.children('thead').length){$tr=$table.children('tbody').children();hasHeader=true;}else{$tr=$table.children().children();}if($table.hasClass('mw-collapsed')){$table.removeClass('mw-collapsed');$this.children('a').text(collapse);$this.addClass(
'mw-collapsible-toggle-expanded').removeClass('mw-collapsible-toggle-collapsed');$tr.each(function(i){if(hasHeader){$(this).css('display','table-row');}else if(i!==0){$(this).css('display','table-row');}});if($table.find('.mw-kartographer-map').length){mw.hook('wikipage.content').fire($('a.mw-kartographer-map').parent());}}else{$table.addClass('mw-collapsed');if(!$table.hasClass('mw-made-collapsible')){$table.addClass('mw-made-collapsible');}$this.children('a').text(expand);$this.addClass('mw-collapsible-toggle-collapsed').removeClass('mw-collapsible-toggle-expanded');$tr.each(function(i){if(hasHeader){$(this).css('display','none');}else if(i!==0){$(this).css('display','none');}});}});}$(function(){if($('.mw-collapsible').length){mw.hook('wikipage.collapsibleContent').add(noFade);}});}(this.jQuery));});mw.loader.implement("ext.gadget.ReferenceTooltips@1ifwf",function($,jQuery,require,module){;(function($,mw){'use strict';function tooltips(){const COOKIE_NAME='ref-tooltips';var i,settings,timer,$tooltip;function createCookie(){$.cookie(COOKIE_NAME,'on-200-hover',{path:'/',expires:90});return'on-200-hover';}function getCookie(){var cookie=$.cookie(COOKIE_NAME)||createCookie(),storedVars=cookie.split('-'),touchscreen='ontouchstart'in document.documentElement;settings={on:storedVars[0],delay:storedVars[1],delayNo:parseInt(storedVars[1],10),action:storedVars[2]};if(settings.action==='hover'){settings.hover=true;settings.click=false;}if(settings.action==='click'){settings.hover=false;settings.click=true;}if(touchscreen===true){settings.action='click';settings.hover=false;settings.click=true;}mw.log(settings);}function modifyCookie(){var inputs=document.getElementById('rsw-config-action').getElementsByTagName('input');for(var i=0;i<inputs.length;i++){if(inputs[i].checked){settings.action=
inputs[i].value;}}settings.delay=$('#rsw-config-delay input').first().val();if(parseInt(settings.delay,10)>1000){settings.delay='1000';}$.cookie('ref-tooltips',['on',settings.delay,settings.action].join('-'),{path:'/',expires:90});window.location.reload(false);}function disableTooltips(){$.cookie(COOKIE_NAME,'off-200-hover',{path:'/',expires:90});window.location.reload(false);}function removeConfig(){$('#rsw-config').remove();$('#rsw-config-background').remove();}function createConfig(){var body,form,formBackground,formLeft,formTop;body=document.body;formTop=($(window).height()/4)+'px';formLeft=(($(window).width()-425)/2)+'px';form=$('<div/>',{'id':'rsw-config'}).css({'top':formTop,'left':formLeft}).append($('<div/>',{'id':'rsw-config-header'}).append($('<span/>',{'id':'rsw-config-title','html':'Reference Tooltip Settings'}),$('<span/>',{'id':'rsw-config-close','title':'Close settings','click':removeConfig})),$('<div/>',{'id':'rsw-config-body'}).append($('<form/>').append($('<input>',{
'id':'rsw-config-disable','type':'button','value':'Disable reference tooltips','click':disableTooltips}),$('<div/>',{'id':'rsw-config-note','html':'Once disabled, reference tooltips can be re-enabled using the link at the bottom of the page.'}),$('<label/>',{'id':'rsw-config-delay','html':'Delay before the tooltip appears (in milliseconds): '}).append($('<input>',{'type':'number','step':'50','min':'0','max':'1000','value':settings.delay})),$('<br>'),$('<span/>',{'id':'rsw-config-action','html':'Tooltip is activated by: '}).append($('<label/>',{'html':'Hover'}).prepend($('<input>',{'type':'radio','name':'tooltip-action','checked':settings.hover,'value':'hover'})),$('<label/>',{'html':'Click'}).prepend($('<input>',{'type':'radio','name':'tooltip-action','checked':settings.click,'value':'click'}))))),$('<div/>',{'id':'rsw-config-footer'}).append($('<button/>',{'id':'rsw-config-save','type':'button','html':'Save settings','click':modifyCookie})));formBackground=$('<div/>',{'id':
'rsw-config-background','click':removeConfig}).css({'height':body.clientHeight+'px','width':body.clientWidth+'px'});$('body').append(form);$('body').append(formBackground);}function removeTooltip(){if($tooltip){$tooltip.remove();$tooltip=null;}timer=null;}function createTooltip(event){var offset,refId,ref,openSettings,tooltipHeight,tooltipWidth,top,left;removeTooltip();offset=$(event.target).offset();refId=event.target.href.split('#')[1];ref=$('#'+refId).children('.reference-text').clone();openSettings=$('<span/>',{'id':'rsw-tooltip-settings','click':function(){createConfig();}});$tooltip=$('<div/>',{'class':'rsw-tooltip'}).append(openSettings,ref).data('rsw-tooltip-target',event.target);$('body').append($tooltip);tooltipHeight=$tooltip.height();tooltipWidth=$tooltip.width();top=offset.top-tooltipHeight-35;left=offset.left-2;if(top<window.pageYOffset){top=window.pageYOffset;}if((tooltipWidth+left)>$('body').width()){left=$('body').width()-tooltipWidth;}$tooltip.css({'top':top+'px',
'left':left+'px'});}function tooltipHover(){function hide(){timer=window.setTimeout(removeTooltip,500);}function cancelHide(){if(timer){window.clearTimeout(timer);timer=null;}}$('.reference').mouseover(function(event){cancelHide();window.setTimeout(createTooltip,settings.delayNo,event);});$('body').mouseover(function(event){if($tooltip){mw.log(event.target);var hoverTarget=$(event.target);if((hoverTarget.is('.rsw-tooltip, .rsw-tooltip *, .reference, .reference a'))||($tooltip&&$tooltip.data('rsw-tooltip-target')===hoverTarget[0])){cancelHide();return;}hide();}});}function tooltipClick(){$('body').on('click',function(event){var clickTarget=$(event.target);if(clickTarget.is('.reference, .reference a')){event.preventDefault();window.setTimeout(createTooltip,settings.delayNo,event);return;}if($tooltip){if((clickTarget.is('.rsw-tooltip, .rsw-tooltip *'))||($tooltip&&$tooltip.data('rsw-tooltip-target')===clickTarget[0])){return;}removeTooltip();}});}function accessConfig(){$(
'#mw-content-text').append($('<span/>',{'id':'rsw-config-open','title':'Configure reference tooltips'}).append($('<a/>',{'html':'[Reference Tooltip Settings]','click':function(){createConfig();}})));}function tooltipAction(){getCookie();if(settings.on==='off'){return;}if(settings.action==='click'){tooltipClick();}if(settings.action==='hover'){tooltipHover();}}accessConfig();tooltipAction();}$(function(){var namespace=mw.config.get('wgCanonicalNamespace');if(['','RuneScape'].includes(namespace)){if($('.references').length===0){mw.log('no references');return;}if(mw.config.get('wgAction')!=='view'){return;}tooltips();}});}(jQuery,mediaWiki));},{"css":[
"#rsw-config-open{float:right;font-size:smaller} .rsw-tooltip{position:absolute;z-index:5;color:#444e5a;border:1px solid #e4eaee;background:#fff;font-size:0.8em;line-height:1.6em;box-shadow:0 0.3em 0.75em rgba(0,0,0,0.1); padding:1.15em 1.65em;margin:0px;max-width:25em}#rsw-tooltip-settings{float:right;width:16px;height:16px;background-image:url(/images/Cog.svg?81d5d);background-size:contain;margin-right:-5px}#rsw-tooltip-settings:hover{opacity:1} #rsw-config{  z-index:200000002;border:1px solid #e4eaee;background:#fff;font-size:.8em;line-height:1.5em;width:30em;box-shadow:0 1em 3em rgba(0,0,0,0.3);position:fixed}.wgl-darkmode #rsw-config{border-color:#596e96;background:#172136;color:#cbd9f4}#rsw-config-header{font-size:1.5em;padding:1em 1em 0 1em}#rsw-config-title{font-weight:bold}#rsw-config-close{background:#5d6773 url(/images/Close-x-white.svg?52f66) center center no-repeat;float:right;width:1em;height:1em;display:block;cursor:pointer;opacity:0.6}#rsw-config-close:hover{opacity:1}#rsw-config-body{margin:1em 1.5em}#rsw-config-disable{width:100%}#rsw-config-note{color:#949eaa;padding:.5em 0 1em;border-bottom:1px solid #e4eaee;margin-bottom:1em}#rsw-config-footer{border-top:1px solid #e4eaee;background:#f9fafa;text-align:right}.wgl-darkmode #rsw-config-footer{border-top-color:#596e96;background:#313e59}#rsw-config-save{margin:1.5em}#rsw-config-background{display:flex;justify-content:center;align-items:center;top:0;left:0;z-index:200000001;position:fixed;background:rgba(255,255,255,0.6)}"
]});mw.loader.implement("ext.gadget.Username@qpch5",function($,jQuery,require,module){(function($,mw){'use strict';$(function(){var rsn=localStorage.getItem('rsn');var username=mw.config.get('wgUserName');if(rsn){$('.insertrsn').text(rsn);}if(username){$('.insertusername').text(username);}});}(jQuery,mediaWiki));});mw.loader.implement("ext.gadget.VoS@nv64m",function($,jQuery,require,module){if($('.VoS-display').length){mw.loader.load('ext.gadget.VoS-core');}});mw.loader.implement("ext.gadget.archcalc@eh21x",function($,jQuery,require,module){if($('.arch-artefact-calc').length){mw.loader.load('ext.gadget.archcalc-core');}});mw.loader.implement("ext.gadget.armoury@1rt91",function($,jQuery,require,module){if($('#armourySelector').length){mw.loader.load('ext.gadget.armoury-core');}});mw.loader.implement("ext.gadget.audiobutton@14jwk",function($,jQuery,require,module){(function($,mw){if(!$('.ext-audiobutton-container').length){return;}function deactivate(button){var audio=button.previousElementSibling;button.dataset.state='error';button.title='Audio type not supported';button.href=audio.firstElementChild.src;audio.remove();}function updateButtonState(event){var audio=event.currentTarget,button=audio.nextElementSibling;if(audio.paused||audio.ended){button.dataset.state='play';}else{button.dataset.state='pause';}}function playPause(event){var audio=event.currentTarget.previousElementSibling;if(audio.paused||audio.ended){audio.play();}else{audio.pause();}}$('.ext-audiobutton-container').each(function(){var $el=$(this);const source=$el.find('audio > source')[0];const url=source.src;const mimetype=source.type;var output='<audio';output+=' hidden';output+=' class="ext-audiobutton">';output+='<source src="'+url+'" type="'+mimetype+'">';output+='<a href="'+url+'">Link</a>';
output+='</audio>';output+='<a';output+=' class="ext-audiobutton"';output+=' data-state="play">▶️</a>';$(this).html(output);});$(function(){document.querySelectorAll('a.ext-audiobutton').forEach(function(button){button.innerHTML='';var audio=button.previousElementSibling;if(button.dataset.state==='error'){return;}else if(audio.canPlayType(audio.firstElementChild.type)){button.addEventListener('click',playPause);}else{deactivate(button);}});document.querySelectorAll('audio.ext-audiobutton').forEach(function(audio){audio.addEventListener('play',updateButtonState);audio.addEventListener('pause',updateButtonState);audio.addEventListener('ended',updateButtonState);});}());}(jQuery,mediaWiki));},{"css":["a.ext-audiobutton{text-decoration:none}a.ext-audiobutton[data-state='play']:before{content:'▶️'}a.ext-audiobutton[data-state='pause']:before{content:'⏸️'}a.ext-audiobutton[data-state='error']:before{content:'❓️'}"]});mw.loader.implement("ext.gadget.autocollapse@myzpy",function($,jQuery,require,module){(function($,mw){if($(".mw-collapsible-toggle").length)expandMaps();if(!$('.navbox').length||mw.Uri().query.veaction!=undefined)return;mw.hook('wikipage.collapsibleContent').add(init);function init(){var $navboxes=$('.navbox'),maxShow=1,maxHeight=300;function collapseNavbox(i,box){var $box=$(box);if($box.hasClass('navbox-uncollapsed'))return;$box.data('mw-collapsible').collapse();}if($navboxes.length>maxShow){$navboxes.each(collapseNavbox);}$navboxes.each(function(i,e){if($(e).height()>maxHeight){collapseNavbox(i,e);}});}function expandMaps(){$(".mw-collapsible-toggle").on("click keypress",function(){const $this=$(this);if($this.hasClass("mw-collapsible-toggle-expanded")){mw.hook("wikipage.content").fire($("a.mw-kartographer-map",$this.parents(".mw-collapsible").first()).parent());}});}})(jQuery,mediaWiki);});mw.loader.implement("ext.gadget.autocvu@90oue",function($,jQuery,require,module){var autoCvuSubmit=1;$(document).ready(function(){function makeLink(user){var a=document.createElement('a');a.href=mw.config.get('wgScript')+'?title=RuneScape:Counter-Vandalism_Unit&action=edit&section=1&cvuEditor='+encodeURIComponent(user)+'&cvuPage='+encodeURIComponent(mw.config.get('wgPageName'));a.title='Report this edit to the CVU.';a.appendChild(document.createTextNode('report'));return a;}function getParam(name){name=name.replace(/[\[]/,'\\\[').replace(/[\]]/,'\\\]');var regex=new RegExp('[\\?&]'+name+'=([^&#]*)');var results=regex.exec(window.location.href);if(results===null){return'';}else{return decodeURIComponent(results[1].replace(/\+/g,'%20'));}}var cvuEditor=getParam('cvuEditor');var cvuPage=getParam('cvuPage');var action=mw.config.get('wgAction')
if(action=='rollback'){var page=document.getElementById('bodyContent');var p=document.createElement('p');p.style.fontWeight='bold';p.appendChild(document.createTextNode('You can '));p.appendChild(makeLink(getParam('from')));p.appendChild(document.createTextNode(' this user to the CVU.'));page.insertBefore(p,page.firstChild);}else if(action=='history'){var list=document.getElementById('pagehistory');var items=list.getElementsByTagName('li');for(i=0;i<items.length;i++){var user=items[i].getElementsByClassName('mw-userlink')[0].innerText;var undo=items[i].getElementsByClassName('mw-history-undo')[0];if(undo){undo.appendChild(document.createTextNode(' | '));undo.appendChild(makeLink(user));}else{items[i].appendChild(document.createTextNode(' ('));items[i].appendChild(makeLink(user));items[i].appendChild(document.createTextNode(')'));}}}else if(action=='view'&&getParam('diff')){var user=document.getElementById('mw-diff-ntitle2').getElementsByClassName('mw-userlink')[0].innerText;var undo=
document.getElementById('mw-diff-ntitle1').firstChild;undo.appendChild(document.createTextNode(' ('));undo.appendChild(makeLink(user));undo.appendChild(document.createTextNode(')'));}else if(action=='edit'&&cvuEditor&&cvuPage){var lineSep=(navigator.appVersion.indexOf('MSIE')!=-1)?'\r\n':'\n';var obj=document.getElementById('wpTextbox1');var tpl='{'+'{cvuid|'+cvuEditor+'|'+cvuPage.replace(/_/g,' ')+'}'+'}\n';var pos1,pos2;var rteEnabled=(typeof(window.RTEInstanceId)!='undefined');obj.value=obj.value.replace('{{cvuid|insert vandal}}'+lineSep,'');if(rteEnabled){pos1=obj.value.indexOf('type="comment" />'+lineSep+'</p>');}else{pos1=obj.value.indexOf('-->');}if(pos1==-1){alert('Auto CVU was unable to find the reference point.');return;}if(rteEnabled){pos2=obj.value.indexOf('<img',pos1);}else{pos2=obj.value.indexOf('{{cvuid',pos1);}if(pos2==-1){alert('Auto CVU was unable to find the template insertion point.');return;}obj.value=obj.value.substring(0,pos2)+tpl+obj.value.substring(pos2);
document.getElementById('wpSummary').querySelector('input').value='Reported [[Special:Contributions/'+cvuEditor+'|'+cvuEditor+']] using the [[MediaWiki:Gadget-AutoCVU.js|report button]]';if(window.autoCvuSubmit){var save=document.getElementById('wpSave').querySelector('input');$(save).click();}}});});mw.loader.implement("ext.gadget.autosort@nw99e",function($,jQuery,require,module){(function($,mw,rs){var $sortables=$('.sortable[class*="autosort="]');if(!$sortables.length)return;rs.autosort=function(){mw.loader.using('jquery.tablesorter',function(){$sortables.each(function(){var $this=$(this),matched=(' '+$(this).attr('class')+' ').match(/autosort=(\d+)[,-]{1}(a|d)/),$sortCol=$this.find('> thead th:nth-child('+matched[1]+')');if(matched[2]==='d'){$sortCol.click().click();}else{$sortCol.click();}});mw.hook('gadget.autosort.sorted').fire($sortables);});};mw.hook('wikipage.content').add(function init(){if($('.jquery-tablesorter').length){rs.autosort();}else{new MutationObserver(function(muts,obs){if(muts[0].target.classList.contains('jquery-tablesorter')){window.rs.autosort();obs.disconnect();}}).observe($sortables[0],{attributes:true,attributeFilter:['class'],});}mw.hook('wikipage.content').remove(init);});}(jQuery,mediaWiki,rswiki));});mw.loader.implement("ext.gadget.bestiary@leggc",function($,jQuery,require,module){if($('#bestiarySelector').length){mw.loader.load('ext.gadget.bestiary-core');}});mw.loader.implement("ext.gadget.calc@gyga2",function($,jQuery,require,module){if($('.jcConfig').length){mw.loader.load('ext.gadget.calc-core');}});mw.loader.implement("ext.gadget.calc2@ib9zj",function($,jQuery,require,module){if($('.jcInput, [class*="jcPane"]').length){mw.loader.load('ext.gadget.calc2-core');}});mw.loader.implement("ext.gadget.capecustomiser@ameyr",function($,jQuery,require,module){if($('#cape-customizer-app-target').length){mw.loader.load('ext.gadget.capecustomiser-core');}});mw.loader.implement("ext.gadget.charmadd@yz2b5",function($,jQuery,require,module){if($('.charmtable').length){mw.loader.load('ext.gadget.charmadd-core');}});mw.loader.implement("ext.gadget.checkboxList@bq8fc",function($,jQuery,require,module){if($("ul.checklist, div.checklist > ul").length){mw.loader.load('ext.gadget.checkboxList-core');}});mw.loader.implement("ext.gadget.code-snippets@16feb",function($,jQuery,require,module){$(function(){var pagename=mw.config.get('wgTitle');function snippet(label,parts){if(typeof(parts)=='string')parts=[parts];return{label:label,action:{type:'encapsulate',options:{pre:parts[0]||'',peri:parts[1]||'',post:parts[2]||'',}}};}function getLicense(name,chars,param){var label=name;if(name instanceof Array){label=name[1];name=name[0];}return snippet(label,['{{'+name+' license|',pagename.slice(0,-chars),(param||'')+'}}']);}function customizeToolbar(){if(typeof($('#wpTextbox1').wikiEditor)!='function')return console.log($('#wpTextbox1'),$('#wpTextbox1').wikiEditor);var templates={'label':'Template presets','layout':'characters','characters':[snippet('Single {{Map}}',['{{Map|name='+pagename+'|x=3200|y=3200|plane=0|r=4|mapID=0|mtype=','square','}}']),snippet('Multi-pin {{Map}}',['{{Map|name='+pagename+'|','3200,3200|3232,3200','|plane=0|mapID=0|mtype=pin}}']),snippet('{{Object map}}',[
'{{Object map|objectname='+pagename+'|objectid=|x=3200|y=3200','','}}']),snippet('{{NPC map}}',['{{NPC map|npcname='+pagename+'|npcid=|x=3200|y=3200','','}}']),snippet('{{Synced switch}}',['{{Synced switch\n|version1 = ','','\n|version2 = \n|version3 = \n}}\n']),snippet('{{External}}',['{{External|os','|rsc','}}\n']),snippet('{{Otheruses}}',['{{Otheruses|','','}}\n']),snippet('{{Redirect}}',['{{Redirect|','','}}\n']),snippet('{{Clear|left}}',['{{Clear|','','left}}\n']),]};var sections={'label':'Section presets','layout':'characters','characters':[snippet('==References==',['==References==\n{{Reflist','','}}\n']),snippet('==NPC Locations==',['==Locations==\n{{LocTableHead}}\n{{LocLine\n|loc = ','','\n|lvls = \n|mem = \n|mapID = \n|plane = 0\n|x:3200,y:3200\n|x:3232,y:3232\n}}\n{{LocTableBottom}}\n']),snippet('==Object Locations==',['==Locations==\n{{ObjectTableHead}}\n{{ObjectLocLine\n|name = '+pagename+'\n|loc = ','',
'\n|mem = \n|mapID = \n|plane = 0\n|x:3200,y:3200\n|x:3232,y:3232\n|mtype = pin\n}}\n{{ObjectTableBottom}}\n']),snippet('==Monster drops==',['==Drops==\n\n===100%===\n{{DropsTableHead}}\n{{DropsLine|name=','','|quantity=1|rarity=Always}}\n{{DropsTableBottom}}\n']),snippet('==Item creation==',['==Creation==\n{{Databox Recipe\n|name = '+pagename+'\n|ticks = \n|skill = ','','\n|level = \n|skillXP = \n|geValue = \n|members = \n|facility = \n|mat1 = \n|mat1qty = \n|mat1price = \n|mat2 = \n|mat2qty = \n|mat2price = \n}}\n']),snippet('==Item products==',['==Products==\n{{Uses material list|',pagename,'}}\n']),snippet('==Drop sources==',['==Drop sources==\n{{Drop sources|',pagename,'}}\n']),snippet('==Store locations==',['==Store locations==\n{{Store locations list|',pagename,'}}\n']),snippet('==Item spawns==',['==Item spawns==\n{{Item spawns|item='+pagename+'|itemid=','','3200,3200|text=}}\n']),snippet('==Update history==',['==Update history==\n{{UH|\n* {{UL|type=patch|update=','',
'|date=}}\n** Added to game.\n}}\n']),snippet('==Dialogue==',['==Dialogue==\n{{Hasdialogue|','npc','}}\n']),snippet('==Map==',['==Map==\n{{Map:',pagename,'}}\n']),]};var references={'label':'References','layout':'characters','characters':[snippet('Ref section',['==References==\n{{Reflist','','}}\n']),snippet('Ref list',['{{Reflist|group=','','}}\n']),snippet('CiteTwitter',['{{CiteTwitter|author=','','|url=|quote=|date=|archiveurl=|archivedate=|notes=|name=}}']),snippet('CiteReddit',['{{CiteReddit|author=','','|url=|title=|quote=|date=|archiveurl=|archivedate=|notes=|name=}}']),snippet('CiteNews',['{{CiteNews|author=','','|url=|title=|newsdate=|notes=|name=}}']),snippet('CiteNPC',['{{CiteNPC|npc=','','|loc=|quote=|notes=|name=}}']),snippet('NamedRef',['{{CiteNPC|name=','','|group=}}']),]};var transcript={'label':'Transcripts','layout':'characters','characters':[snippet('==Dialogue==',['==Dialogue==\n{{Hasdialogue|','npc','}}\n']),snippet('{{Dialogue}}',['{{Dialogue|','npc',
'}}\n\n==Standard dialogue==\n* ']),snippet('{{RSChat}}',['{{RSChat|','Cor blimey mate, what are ye doing in me pockets?','}}']),snippet('{{RSFont}}',['{{RSFont|','Nothing interesting happens.','}}']),snippet('End of dialogue','{{tact|end}}'),snippet('Interface opens',['{{tact|opens=','Interface','}}']),snippet('Receives item',['{{tact|receives=','[[item]]','}}']),snippet('Shows previous','{{tact|previous}}'),snippet('Shows prev-to-prev','{{tact|previous2}}'),snippet('Shows initial','{{tact|initial}}'),snippet('Shows other options','{{tact|other}}'),snippet('Same as above','{{tact|above}}'),snippet('Same as below','{{tact|below}}'),snippet('See above','{{tact|above2}}'),snippet('See below','{{tact|below2}}'),snippet('Continues below','{{tact|continue}}'),snippet('Continues above','{{tact|continuea}}'),snippet('See transcript',['{{tact|see|','transcript','}}']),snippet('Quest action',['{{Qact|','action','}}']),]};var licenses={'label':'File licenses','layout':'characters','characters':[
snippet('3D model',['{{3D model license|link=','','|author=}}']),getLicense('Ability',4),getLicense('Achievement',21),getLicense('Animation',4),getLicense(['Animation override','Animation override (PvP)'],4,'|type=pvp'),getLicense(['Animation override','Animation override (Rest)'],4,'|type=rest'),getLicense(['Animation override','Animation override (Skill)'],4,'|type=skill'),getLicense(['Animation override','Animation override (Spell)'],4,'|type=spell'),getLicense(['Animation override','Animation override (Walk)'],4,'|type=walk'),getLicense(['Animation override','Animation override (Tool)'],4,'|type=tool'),getLicense(['Chathead','Chathead (Player)'],13,'|type=player'),getLicense(['Chathead','Chathead (Override)'],13,'|type=override'),getLicense(['Chathead','Chathead (NPC)'],13,'|type=npc'),getLicense(['Chathead','Chathead (Pet)'],13,'|type=pet'),getLicense(['Chathead','Chathead (Familiar)'],13,'|type=familiar'),getLicense('Clothing',12),snippet('Concept art',[
'{{Concept art license|link=','','|author=}}']),getLicense(['Construction','Construction (Built)'],4,'|type=built'),getLicense(['Construction','Construction (Hotspot)'],4,'|type=hotspot'),getLicense(['Construction','Construction (Style)'],4,'|type=style'),getLicense(['Construction','Construction (Room)'],4,'|type=room'),getLicense('Cosmetic override',13),getLicense(['DII','Detailed item'],11,'|id='),snippet('Development image',['{{Development image license|link=','','|author=}}']),getLicense('Emote animation',4),getLicense('Emote icon',9),getLicense('Familiar',4),getLicense('Interface',4),getLicense('Inventory',4,'|id='),getLicense('Location',4),getLicense('Map',8),getLicense('Material',4),getLicense('Minimap icon',13),getLicense('Monster',4,'|id='),getLicense('NPC',4,'|id='),getLicense('Perk',4),getLicense('Prayer',4),getLicense('Quest',4),getLicense('Scenery',4,'|id='),getLicense('Emote icon',9),getLicense(['Spell','Spell icon'],9),getLicense('Sprite',11,'|id='),getLicense(
'Status icon',9),snippet('Voice',['{{Voice license|','','}}']),snippet('WIP image',['{{WIP image license|link=','','|author=}}']),getLicense('Worn equipment',13),snippet('Audio','{{Non-free audio}}'),snippet('Fair use','{{Fair use}}'),snippet('CC-BY-SA','{{Cc-by-sa-3.0}}'),snippet('Transparency',['{{trans','','}}']),snippet('Translucency',['{{transl','','}}']),snippet('Historical image',['{{Historical image','','}}']),]};var other={'label':'Other','layout':'characters','characters':[snippet('[[DII]]',['[[File:',pagename+' detail.png','|left|100px]]\n']),]};var feedback={'label':'Missing something?','layout':'table','headings':[{text:'Are you missing a code snippet that would be useful here?'}],'rows':[{text:{html:'You can <a href="https://runescape.wiki/w/RuneScape:Administrator_requests?action=edit&section=new&preloadtitle=Requesting%20new%20code%20snippet%20in%20editor" target="_blank">'+'request a snippet</a> to be added.'+(mw.config.get('wgUserGroups').includes('sysop')?
'<br/>Admins may edit the <a href="/w/MediaWiki:Gadget-code-snippets.js" title="MediaWiki:Gadget-code-snippets.js">code snippets script</a>.':''),},}],};var isRedirect=/^\#REDIRECT\s*\[\[[^\]]+\]\](\n|$)/i.test($('#wpTextbox1').val())&&$('#wikiPreview div').text().length==0;var groups={};groups['section-templates']=templates;if($('body').is('.ns-0'))groups['section-sections']=sections;groups['section-refs']=references;if($('body').is('.ns-120'))groups['section-transcript']=transcript;if($('body').is('.ns-6'))groups['section-licenses']=licenses;if($('body').is('.ns-0'))groups['section-other']=other;groups['section-feedback']=feedback;if(!$('body').is('.ns-8, .ns-112, .ns-828, .ns-talk')){$('#wpTextbox1').wikiEditor('addToToolbar',{'sections':{'snippets':{'type':'booklet','label':'Presets/snippets','pages':groups,}}});}}if(['edit','submit'].indexOf(mw.config.get('wgAction'))!==-1){mw.loader.using('user.options').then(function(){if(mw.user.options.get('usebetatoolbar')==1){$.when(mw.
loader.using('ext.wikiEditor'),$.ready).then(customizeToolbar);}});}});});mw.loader.implement("ext.gadget.compare@z4n4h",function($,jQuery,require,module){if($('.cioCompareLink, .infobox-bonuses').length){mw.loader.load('ext.gadget.compare-core');}});mw.loader.implement("ext.gadget.contributions@pwpgu",function($,jQuery,require,module){(function($,mw,rs){if(mw.config.get('wgNamespaceNumber')===2||mw.config.get('wgNamespaceNumber')===3){mw.util.addPortletLink('p-namespaces',mw.util.getUrl('Special:Contributions/'+mw.config.get('wgRelevantUserName')),'Contributions','ca-nstab-contributions','Click to open the user\'s contributions');}})(jQuery,mediaWiki,rswiki);});mw.loader.implement("ext.gadget.countdown@105ph",function($,jQuery,require,module){;(function(module,mw,$,undefined){'use strict';var translations=$.extend(true,{en:{and:'and',second:'second',seconds:'seconds',minute:'minute',minutes:'minutes',hour:'hour',hours:'hours',day:'day',days:'days'},},module.translations||{}),i18n=translations[mw.config.get('wgContentLanguage')]||translations.en;var countdowns=[];var NO_LEADING_ZEROS=1,SHORT_FORMAT=2,NO_ZEROS=4;function output(i,diff){var delta,result,parts=[];delta=diff%60;result=' '+i18n[delta===1?'second':'seconds'];if(countdowns[i].opts&SHORT_FORMAT)result=result.charAt(1);parts.unshift(delta+result);diff=Math.floor(diff/60);delta=diff%60;result=' '+i18n[delta===1?'minute':'minutes'];if(countdowns[i].opts&SHORT_FORMAT)result=result.charAt(1);parts.unshift(delta+result);diff=Math.floor(diff/60);delta=diff%24;result=' '+i18n[delta===1?'hour':'hours'];if(countdowns[i].opts&SHORT_FORMAT)result=result.charAt(1);parts.unshift(delta+result);diff=
Math.floor(diff/24);result=' '+i18n[diff===1?'day':'days'];if(countdowns[i].opts&SHORT_FORMAT)result=result.charAt(1);parts.unshift(diff+result);result=parts.pop();if(countdowns[i].opts&NO_LEADING_ZEROS){while(parts.length&&parts[0][0]==='0'){parts.shift();}}if(countdowns[i].opts&NO_ZEROS){parts=parts.filter(function(part){return part[0]!=='0';});}if(parts.length){if(countdowns[i].opts&SHORT_FORMAT){result=parts.join(' ')+' '+result;}else{result=parts.join(', ')+' '+i18n.and+' '+result;}}countdowns[i].node.text(result);}function end(i){var c=countdowns[i].node.parent();switch(c.attr('data-end')){case'remove':c.remove();return true;case'stop':output(i,0);return true;case'toggle':var toggle=c.attr('data-toggle');if(toggle&&toggle=='next'){c.next().css('display','inline');c.css('display','none');return true;}if(toggle&&$(toggle).length){$(toggle).css('display','inline');c.css('display','none');return true;}break;case'callback':var callback=c.attr('data-callback');if(callback&&$.isFunction
(module[callback])){output(i,0);module[callback].call(c);return true;}break;}countdowns[i].countup=true;output(i,0);return false;}function update(){var now=Date.now();var countdownsToRemove=[];$.each(countdowns.slice(0),function(i,countdown){var diff=Math.floor((countdown.date-now)/1000);if(diff<=0&&!countdown.countup){if(end(i))countdownsToRemove.push(i);}else{output(i,Math.abs(diff));}});var x;while((x=countdownsToRemove.pop())!==undefined){countdowns.splice(x,1);}if(countdowns.length){window.setTimeout(function(){update();},1000);}}function getOptions(node){var text=node.parent().attr('data-options'),opts=0;if(text){if(/no-leading-zeros/.test(text)){opts|=NO_LEADING_ZEROS;}if(/short-format/.test(text)){opts|=SHORT_FORMAT;}if(/no-zeros/.test(text)){opts|=NO_ZEROS;}}return opts;}function init(){var countdown=$('.countdown:not(.handled)');if(!countdown.length)return;$('.nocountdown').css('display','none');countdown.css('display','inline').find('.countdowndate').each(function(){var $this
=$(this),date=(new Date($this.text())).valueOf();if(isNaN(date)){$this.text('BAD DATE');return;}countdowns.push({node:$this,opts:getOptions($this),date:date,});});countdown.addClass('handled');if(countdowns.length){update();}}mw.hook('wikipage.content').add(init);}(window.countdownTimer=window.countdownTimer||{},mediaWiki,jQuery));});mw.loader.implement("ext.gadget.cvuform@ti800",function($,jQuery,require,module){if(mw.config.get('wgPageName')==='RuneScape:Counter-Vandalism_Unit'){mw.loader.load('ext.gadget.cvuform-core');}});mw.loader.implement("ext.gadget.discalc@or39z",function($,jQuery,require,module){if($('#dis-calc-table').length||$('#dis-calc-settings').length){mw.loader.load('ext.gadget.discalc-core');}});mw.loader.implement("ext.gadget.dropDisplay@beaik",function($,jQuery,require,module){if($('table.item-drops.filterable').length){mw.loader.load('ext.gadget.dropDisplay-core');}});mw.loader.implement("ext.gadget.dropdown@krdey",function($,jQuery,require,module){$(function(){var conf=mw.config.get(['wgPageName','wgNamespaceNumber','wgArticlePath'])
if(conf.wgNamespaceNumber===-1){return;}mw.util.addPortletLink('p-cactions',conf.wgArticlePath.replace('$1',encodeURIComponent(conf.wgPageName)+'?diff=cur'),'Last','ca-diff','Show most recent diff');mw.util.addPortletLink('p-cactions',conf.wgArticlePath.replace('$1','Special:PrefixIndex/'+encodeURIComponent(conf.wgPageName)+'/'),'Subpages','ca-subpages','List this page\'s subpages');});});mw.loader.implement("ext.gadget.dynamicMMG@eg9bh",function($,jQuery,require,module){if($('.mmgtable.mmg-isdynamic').length){mw.loader.load('ext.gadget.dynamicMMG-core');}});mw.loader.implement("ext.gadget.eggs@1ie1o",function($,jQuery,require,module){if($('#rowena').length){mw.loader.load('ext.gadget.eggs-core');}});mw.loader.implement("ext.gadget.events@qmx9w",function($,jQuery,require,module){'use strict';;(function($,mw,rs){var portletLink,$popup,popup,$content,settingsForm,notifsForm,api,et_events,merchstock,notiftimer,notifpopup,$notifs,formConst=false,formMade=false;var localKey='rsw-events-prefs',localLast='rsw-events-last',vosurl='https://api.weirdgloop.org/runescape/vos/history',simplevosurl='https://api.weirdgloop.org/runescape/vos';var simple_dailies=[{name:'Big Chinchompa',id:'bigchin',link:'/w/Big_Chinchompa',length:20,repeat:60,offset:30,from:'hour',img:'/images/6/63/Nyriki%27s_portal.png'},{name:'Guthixian Caches',id:'guthcache',link:'/w/Guthixian_Cache',length:10,repeat:60,offset:0,from:'hour',img:'/images/thumb/2/23/Player_automaton.png/600px-Player_automaton.png'},{name:'Guthixian Caches (boost)',id:'guthcacheb',link:'/w/Guthixian_Cache',length:10,repeat:(60*3),offset:0,from:'day',img:'/images/8/8e/Confused_automaton.png'},{name:'Sinkholes',id:'sinkhole',link:'/w/Sinkholes',
length:25,repeat:60,offset:30,from:'hour',img:'/images/5/5c/Sinkhole_entrance.png'},{name:'Demon Flash Mob',id:'demonmob',link:'/w/Demon_Flash_Mob',length:5,repeat:60,offset:0,from:'hour',img:'/images/1/1f/Agrith_Naar_chathead.png'},{name:'Fish Flingers',id:'fishflin',link:'/w/Fish_Flingers',length:10,repeat:20,offset:0,from:'hour',img:'/images/thumb/c/cb/Fish_Flingers_logo.png/200px-Fish_Flingers_logo.png'},{name:'Supply Run',id:'goebiesup',link:'/w/Supply_run',length:25,repeat:(60*12),offset:0,from:'day',img:'/images/9/9e/Goebie_chathead.png'},{name:'Wilderness Warbands',id:'wildwar',link:'/w/Wilderness_Warbands',length:10,repeat:(60*7),offset:(60*2),from:'isoWeek',img:'/images/5/57/Wilderness_Warbands_emblem.png'},];var voslocs={'Amlodd':['WNW','West-north-west'],'Crwys':['ENE','East-north-east'],'Cadarn':['ESE','East-south-east'],'Hefin':['NNW','North-north-west'],'Iorwerth':['SSW','South-south-west'],'Ithell':['WSW','West-south-west'],'Meilyr':['NNE','North-north-east'],
'Trahaearn':['SSE','South-south-east']};var tmsStock=[{data:'Barrel of bait',label:'Barrel of bait'},{data:'Tangled fishbowl',label:'Tangled fishbowl'},{data:'Broken fishing rod',label:'Broken fishing rod'},{data:'Small goebie burial charm',label:'Small goebie burial charm'},{data:'Goebie burial charm',label:'Goebie burial charm'},{data:'Menaphite gift offering (small)',label:'Menaphite gift offering (small)'},{data:'Menaphite gift offering (medium)',label:'Menaphite gift offering (medium)'},{data:'Unstable air rune',label:'Unstable air rune'},{data:'Anima crystal',label:'Anima crystal'},{data:'Slayer VIP Coupon',label:'Slayer VIP Coupon'},{data:'D&D token (daily)',label:'D&D token (daily)'},{data:'Unfocused damage enhancer',label:'Unfocused damage enhancer'},{data:'Sacred clay',label:'Sacred clay'},{data:'Shattered anima',label:'Shattered anima'},{data:'Advanced pulse core',label:'Advanced pulse core'},{data:'Livid plant',label:'Livid plant'},{data:'Gift for the Reaper',label:
'Gift for the Reaper'},{data:'Silverhawk down',label:'Silverhawk down'},{data:'Large goebie burial charm',label:'Large goebie burial charm'},{data:'Message in a bottle',label:'Message in a bottle'},{data:'Dragonkin lamp',label:'Dragonkin lamp'},{data:'Dungeoneering Wildcard',label:'Dungeoneering Wildcard'},{data:'Menaphite gift offering (large)',label:'Menaphite gift offering (large)'},{data:'Taijitu',label:'Taijitu'},{data:'D&D token (weekly)',label:'D&D token (weekly)'},{data:'D&D token (monthly)',label:'D&D token (monthly)'},{data:'Starved ancient effigy',label:'Starved ancient effigy'},{data:'Harmonic dust',label:'Harmonic dust'},{data:'Crystal triskelion',label:'Crystal triskelion'},{data:'Deathtouched dart',label:'Deathtouched dart'},{data:'Unfocused reward enhancer',label:'Unfocused reward enhancer'}];var pofresets=['Small Buyer','Medium Buyer','Large Buyer','Easy Request','Medium Request','Hard Request'];var dd_spotlights=['Shooting Star','Penguin Hide and Seek','Circus',
'Evil Tree'],mg_spotlights=['Pest Control','Soul Wars','Fist of Guthix','Barbarian Assault','Conquest','Fishing Trawler','The Great Orb Project','Flash Powder Factory','Castle Wars','Stealing Creation','Cabbage Facepunch Bonanza','Heist','Soul Wars','Barbarian Assault','Conquest','Fist of Guthix','Castle Wars','Pest Control','Soul Wars','Fishing Trawler','The Great Orb Project','Flash Powder Factory','Stealing Creation','Cabbage Facepunch Bonanza','Heist','Trouble Brewing','Castle Wars'],ed_spotlights=['Temple of Aminishi','Dragonkin Laboratory','The Shadow Reef'];var rax_array=['Minions','Acid','Darkness'],vorago_rotations=['Ceiling collapse','Scopulus','Vitalis','Green bomb','TeamSplit','The End'],vorago_hm={'Ceiling collapse':{pathTen:'TeamSplit / Green bomb',pathElev:'TeamSplit / Vitalis',unlock:'Torso of Omens'},'Scopulus':{pathTen:'Purple bomb / TeamSplit',pathElev:'Purple bomb / Vitalis',unlock:'Helm of Omens'},'Vitalis':{pathTen:'Vitalis / Purple bomb',pathElev:
'Vitalis / Bleeds',unlock:'Legs of Omens'},'Green bomb':{pathTen:'Green bomb / Vitalis',pathElev:'Green bomb / TeamSplit',unlock:'Boots of Omens'},'TeamSplit':{pathTen:'TeamSplit / TeamSplit',pathElev:'TeamSplit / Purple bomb',unlock:'Maul of Omens'},'The End':{pathTen:'Purple bomb / Bleeds',pathElev:'Purple bomb / Vitalis',unlock:'Gloves of Omens'}},rn={A:'Ahrim',D:'Dharok',G:'Guthan',K:'Karil',T:'Torag',V:'Verac'},rots_rotations=[[[rn.D,rn.T,rn.V],[rn.K,rn.A,rn.G]],[[rn.K,rn.T,rn.G],[rn.A,rn.D,rn.V]],[[rn.K,rn.G,rn.V],[rn.A,rn.T,rn.D]],[[rn.G,rn.T,rn.V],[rn.K,rn.A,rn.D]],[[rn.K,rn.T,rn.V],[rn.A,rn.G,rn.D]],[[rn.A,rn.G,rn.D],[rn.K,rn.T,rn.V]],[[rn.K,rn.A,rn.D],[rn.G,rn.T,rn.V]],[[rn.A,rn.T,rn.D],[rn.K,rn.G,rn.V]],[[rn.A,rn.D,rn.V],[rn.K,rn.T,rn.G]],[[rn.K,rn.A,rn.G],[rn.T,rn.D,rn.V]],[[rn.A,rn.T,rn.G],[rn.K,rn.D,rn.V]],[[rn.A,rn.G,rn.V],[rn.K,rn.T,rn.D]],[[rn.K,rn.A,rn.T],[rn.G,rn.D,rn.V]],[[rn.K,rn.A,rn.V],[rn.D,rn.T,rn.G]],[[rn.A,rn.T,rn.V],[rn.K,rn.D,rn.G]],[[rn.K,rn.D,rn.G],[rn.A,
rn.T,rn.V]],[[rn.D,rn.T,rn.G],[rn.K,rn.A,rn.V]],[[rn.G,rn.D,rn.V],[rn.K,rn.A,rn.T]],[[rn.K,rn.T,rn.D],[rn.A,rn.G,rn.V]],[[rn.K,rn.D,rn.V],[rn.A,rn.T,rn.G]]];var self={settings:{daily_sort:'by time',notifs:false,nobrownotifs:false,notiftype:{},raven:true,et_events:false,num_events:3,spots:true,mg_spotlight:true,dd_spotlight:true,ed_spotlight:true,show_next:false,pvm:false,merch:true,farm:true,dcache:'1970-01-01T01:00:00+00:00',cache:{events:[],tms:{},tmsTom:{}}},swnotif:false,updatetimer:0,nextvos:'1970-01-01T01:00:00+00:00',lastRot:{time:'1970-01-01T01:00:00+00:00',wreset:'1970-01-01T01:00:00+00:00',mreset:'1970-01-01T01:00:00+00:00',vos:'',raven:'',tms:'',vorago:99,araxxor:99,rots:99,mgspot:99,edspot:99,ddspot:99},init:function(){mw.log('Starting Events Interface');api=new mw.Api();moment.locale('en-events',{relativeTime:{parentLocale:"en",future:"in %s",past:"%s ago",s:"secs",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1mth",MM:"%dmths",y:"1yr",yy:"%dyr"}});et_events=[];
merchstock={tod:[],tmr:[]};self.supportNotif=rs.canSendBrowserNotifs();portletLink=mw.util.addPortletLink('p-personal','','','pt-events','Events',null,$('#pt-userpage, #pt-anonuserpage'));$(portletLink).find('a').addClass('oo-ui-icon-calendar').click(function(e){e.preventDefault();var openPopup=function(){mw.log('Open events popup');self.loadSettings().then(self.loadEvents).then(self.updateAll,self.updateAll).then(function(){if(!self.supportNotif){notifsForm.browsnotif.setValue(true);notifsForm.browsnotif.setDisabled(true);}if(typeof ga==='function'){ga('gtag_UA_126479006_1.send','event','Gadget-events','Open','Normal');}$('.rsw-events-popup .events-settings').removeClass('slideout').addClass('oo-ui-element-hidden');popup.toggle();})};if(!formMade&&!formConst){mw.log('Initialise events popup');formConst=true;mw.loader.using(['oojs-ui-core','oojs-ui-windows','oojs-ui-widgets','oojs-ui.styles.icons-interactions']).then(self.initInt).then(openPopup);}else if(!formConst){openPopup();}else{
mw.log('Waiting for initialisation to finish');}});self.loadSettings().then(function(){if(self.settings.notifs&&!self.swnotif){self.notifs();notiftimer=setInterval(self.notifs,300000);}},function(){console.warn('Error loading events settings!');});},initInt:function(){mw.log('Initialising...');return new Promise(function(resolve,reject){self.initPopup();self.initSettingsForm();self.initNotifsForm();$popup=$('<div>').append($content,settingsForm.$form);settingsForm.$form.find('.settings-container').append(notifsForm.$form);popup=new OO.ui.PopupWidget({$content:$popup,$floatableContainer:$('#pt-events'),autoClose:true,classes:['rsw-events-popup'],hideWhenOutOfView:(rs.isUsingStickyHeader()?true:false),invisibleLabel:true,label:'Events',width:700});$('body').append(popup.$element);popup.on('toggle',function(state){clearInterval(self.updatetimer);if(state){self.updatetimer=setInterval(self.update,60000);}});$('body').append($('<div>').attr('id','rsw-notifs-anchor'));var notifclose=new OO.
ui.ButtonWidget({icon:'close',id:'rsw-eventsnotifs-close',invisibleLabel:true,label:'Close',framed:false});notifclose.on('click',function(){notifpopup.toggle(false);});$notifs=$('<div>').addClass('event-notifs-container').append(notifclose.$element,$('<h3>').addClass('oo-ui-element-hidden').text('Event Notifications'),$('<ul>').addClass('event-notifications'));notifpopup=new OO.ui.PopupWidget({$content:$notifs,$floatableContainer:$('#rsw-notifs-anchor'),anchor:false,autoClose:true,classes:['rsw-events-notifs'],hideWhenOutOfView:false,invisibleLabel:true,label:'Events  Notifications',width:450});$('body').append(notifpopup.$element);formMade=true;formConst=false;resolve();});},loadSettings:function(){mw.log('Loading settings');return new Promise(function(resolve,reject){if(!rs.hasLocalStorage()){console.warn('Browser does not support localStorage');reject();}var prefs={};try{prefs=JSON.parse(localStorage.getItem(localKey));}catch(err){prefs={};console.warn(
'Error loading settings (events)');}for(var p in prefs){self.settings[p]=prefs[p];}resolve();});},loadEvents:function(force){mw.log('Loading events, travelling merchant stock');if(moment().isBefore(moment(self.settings.dcache).utc().add(1,'days').startOf('day'))&&!force){mw.log('Less than a day since last lookup');et_events=self.settings.cache.events;merchstock={tod:self.settings.cache.tms,tmr:self.settings.cache.tmsTom};return Promise.resolve();}var etapi=api.get({action:'ask',query:'[[RuneScape:Events Team]]|?Events JSON',maxage:'7200',smaxage:'7200'}).then(function(ret){mw.log('Events team api return:');mw.log(ret);if(ret.query.results&&ret.query.results['RuneScape:Events Team'].printouts['Events JSON']){ret.query.results['RuneScape:Events Team'].printouts['Events JSON'].forEach(function(ev){ev=JSON.parse(ev);et_events.push({name:mw.html.escape(ev.name),date:ev.time,length:Number(ev.length)});});}else{mw.log('No events team events');}self.saveSetting('cache.events',et_events);},
function(err){console.warn('Error getting Events team events');throw err;});var tmsapi=api.get({action:'parse',prop:'text',disablelimitreport:1,contentmodel:'wikitext',text:'{{Travelling_Merchant/api|format=json}}',}).then(function(ret){mw.log('Todays travelling merchant stock from api');mw.log(ret);if(ret.parse&&ret.parse.text){var string=ret.parse.text['*'].replace('<div class=\"mw-parser-output\"><p>','').replace('</p></div>','');var obj=JSON.parse(string);mw.log(obj);merchstock.tod=obj.items;self.saveSetting('cache.tms',obj.items);}else{throw'Could not parse tm data for today';}},function(err){console.warn('Error getting todays travelling merchant stock');console.warn(err);throw err;});var tmsTomapi=api.get({action:'parse',prop:'text',disablelimitreport:1,contentmodel:'wikitext',text:'{{Travelling_Merchant/api|offset=1|format=json}}',}).then(function(ret){mw.log('Tomorrows travelling merchant stock from api');mw.log(ret);if(ret.parse&&ret.parse.text){var string=ret.parse.text['*'].
replace('<div class=\"mw-parser-output\"><p>','').replace('</p></div>','');var obj=JSON.parse(string);mw.log(obj);merchstock.tmr=obj.items;self.saveSetting('cache.tmsTom',obj.items);}else{throw'Could not parse tm data for tomorrow';}},function(err){console.warn('Error getting tomorrows travelling merchant stock');console.warn(err);throw err;});return Promise.all([etapi,tmsapi,tmsTomapi]).then(function(){self.saveSetting('dcache',moment().format());},function(err){throw err;});},saveSetting:function(key,value){mw.log('Saving setting: '+key);if(key.split('.')[0]=='cache'){self.settings.cache[key.split('.')[1]]=value;}else{self.settings[key]=value;}if(!rs.hasLocalStorage()){console.warn('Browser does not support localStorage');return false;}var string=JSON.stringify(self.settings);try{localStorage.setItem(localKey,string);}catch(err){console.warn('Error saving presets to localStorage');return false;}return true;},saveNotif:function(key,value){mw.log('Saving notification setting: '+key);
self.settings.notiftype[key]=value;if(!rs.hasLocalStorage()){console.warn('Browser does not support localStorage');return false;}var string=JSON.stringify(self.settings);try{localStorage.setItem(localKey,string);}catch(err){console.warn('Error saving presets to localStorage');return false;}return true;},initPopup:function(){var closeButton=new OO.ui.ButtonWidget({icon:'close',id:'rsw-events-close',invisibleLabel:true,label:'Close',framed:false});closeButton.on('click',function(){popup.toggle(false);});var settingsButton=new OO.ui.ButtonWidget({icon:'settings',id:'rsw-events-setbut',invisibleLabel:true,label:'Settings',framed:false});settingsButton.on('click',function(){self.openSettings();});var now=moment.utc();$content=$('<div>');$content.addClass('events-popup').append($('<div>').addClass('header').append(closeButton.$element,$('<time>').addClass('cur-utc-time').attr({'title':now.format('HH:mm D/M/Y'),'datetime':now.format()}).text(now.format('HH:mm')+' (UTC)'),settingsButton.
$element),$('<div>').addClass('top').append($('<div>').addClass('col col-l').append($('<div>').addClass('dailies section').append($('<h3>').text('Dailies'),$('<ul>').addClass('events-list daily-list')),$('<div>').addClass('raven section')),$('<div>').addClass('col col-r').append($('<div>').addClass('resets section').append($('<h3>').text('Resets'),$('<div>').addClass('event-boxes').append($('<div>').addClass('day event-box').append($('<label>').addClass('by-line').text('Day'),$('<time>').addClass('event-name countdown-day').text('? hrs')),$('<div>').addClass('week event-box').append($('<label>').addClass('by-line').text('Week'),$('<time>').addClass('event-name countdown-week').text('? days')),$('<div>').addClass('month event-box').append($('<label>').addClass('by-line').text('Month'),$('<time>').addClass('event-name countdown-month').text('? days')))),$('<div>').addClass('voice section').append($('<h3>').html('<a href="/w/Voice_of_Seren" title="Voice of Seren">Voice of Seren</a>'),$(
'<div>').addClass('VoS-time by-line').text('There was an error loading the Voice of Seren. Please try again.<br/>If this issue persists, please <a href="/w/RS:AR">contact an administrator</a>.'),$('<div>').addClass('VoS-container event-boxes'),$('<div>').addClass('by-line').append($('<span>').text('Last districts: '),$('<span>').addClass('VoS-last').text('not found'))))),$('<div>').addClass('middle events-team'),$('<div>').addClass('middle tms-pof'),$('<div>').addClass('middle pvm'),$('<div>').addClass('spotlights').append($('<div>').addClass('spotlight-spacer empty'),$('<div>').addClass('spotlight mg-spotlight'),$('<div>').addClass('spotlight-spacer empty'),$('<div>').addClass('spotlight ed-spotlight'),$('<div>').addClass('spotlight-spacer empty'),$('<div>').addClass('spotlight dd-spotlight'),$('<div>').addClass('spotlight-spacer')));},initSettingsForm:function(){settingsForm={};settingsForm.back=new OO.ui.ButtonWidget({icon:'close',id:'rsw-events-backbut',invisibleLabel:true,label:
'Back',framed:false});var closeset=function(){self.updateTimes();self.updateVos();self.updateSpots();$('.rsw-events-popup .events-settings').addClass('slideout');setTimeout(function(){$('.rsw-events-popup .events-settings').removeClass('slideout').addClass('oo-ui-element-hidden');},500);};settingsForm.back.on('click',closeset);settingsForm.$title=$('<h3>').text('Options');settingsForm.sort=new OO.ui.DropdownInputWidget({classes:'sort-selector',options:[{data:'by time',label:'by time'},{data:'by name',label:'by name'}],});settingsForm.sort.setValue(self.settings.daily_sort);settingsForm.sortLay=new OO.ui.FieldLayout(settingsForm.sort,{label:'Sorting'});settingsForm.sort.on('change',self.saveSetting,['daily_sort']);settingsForm.notifs=new OO.ui.ToggleSwitchWidget({title:'Recieve browser notifications',value:self.settings.notifs});settingsForm.notifs.on('change',function(val){self.saveSetting('notifs',val);if(val&&!self.swnotif){window.clearInterval(notiftimer);self.notifs();notiftimer=
setInterval(self.notifs,300000);}else{window.clearInterval(notiftimer);}});settingsForm.notifSets=new OO.ui.ButtonWidget({icon:'settings',invisibleLabel:true,label:'Notification Settings',framed:false});settingsForm.notifSets.on('click',function(){self.openNotifs();});settingsForm.notifsLay=new OO.ui.ActionFieldLayout(settingsForm.notifs,settingsForm.notifSets,{label:'Notifications',help:'Enable notifications for configured events. Currently in development.'});settingsForm.raven=new OO.ui.ToggleSwitchWidget({title:'Prifddinas Raven',value:self.settings.raven});settingsForm.ravenLay=new OO.ui.FieldLayout(settingsForm.raven,{label:'Raven'});settingsForm.raven.on('change',self.saveSetting,['raven']);settingsForm.events=new OO.ui.ToggleSwitchWidget({title:'Show events team events',value:self.settings.et_events});settingsForm.eventsLay=new OO.ui.FieldLayout(settingsForm.events,{label:'Events Team'});settingsForm.events.on('change',function(val){self.saveSetting('et_events',val);settingsForm
.eventsNum.setDisabled(!val);settingsForm.eventsNumLay.toggle(val);});settingsForm.eventsNum=new OO.ui.NumberInputWidget({min:0,required:true,step:1,validate:'integer',value:self.settings.num_events});settingsForm.eventsNumLay=new OO.ui.FieldLayout(settingsForm.eventsNum,{label:'Number of Events',help:'Number of Events Team events to display, use 0 for infinite'});settingsForm.eventsNum.on('change',function(val){val=parseInt(val,10);if(isNaN(val)){val=1;}self.saveSetting('num_events',val);});if(!self.settings.et_events){settingsForm.eventsNum.setDisabled(true);settingsForm.eventsNumLay.toggle(false);}settingsForm.tms=new OO.ui.ToggleSwitchWidget({title:'Show Travelling Merchant stock',value:self.settings.merch});settingsForm.tmsLay=new OO.ui.FieldLayout(settingsForm.tms,{label:'Travelling Merchant',help:'Display today and tomorrow\'s Travelling Merchant stock'});settingsForm.tms.on('change',self.saveSetting,['merch']);settingsForm.pof=new OO.ui.ToggleSwitchWidget({title:
'Show player-owned farm resets',value:self.settings.farm});settingsForm.pofLay=new OO.ui.FieldLayout(settingsForm.pof,{label:'Player-owned Farm',help:'Display time to next reset for player-owned farm buyers and requesters'});settingsForm.pof.on('change',self.saveSetting,['farm']);settingsForm.spots=new OO.ui.ToggleSwitchWidget({title:'Show D&D, Minigame and ED spotlights',value:self.settings.spots});settingsForm.spotsLay=new OO.ui.FieldLayout(settingsForm.spots,{label:'Spotlights',help:'Show Minigame Spotlight, Featured D&D and Elite Dungeon Spotlight'});settingsForm.spots.on('change',function(){}