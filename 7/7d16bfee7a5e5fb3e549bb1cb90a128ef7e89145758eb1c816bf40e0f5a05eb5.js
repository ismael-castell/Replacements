!function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return o(i?i:t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.exports=function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,o),t&&(this.$elm=t,this.window=e,this.doc=i,this.$elm.classList.add("grid-listing"),this.$elm.classList.add("clearfix"),[].forEach.call(this.$elm.querySelectorAll("li"),function(t){t.classList.add("grid-listing-item")}))}},{}],2:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.$elm=e,this.window=i,this.doc=o,this.createLink(this.$elm.dataset.inContextUri),this.$elm.dataset.isReply&&this.showAsReply("View the full conversation"))}return o(t,[{key:"createLink",value:function(t){if(t&&"string"==typeof t){var e=r.buildElement("a",["annotation-teaser__link"]),i=[].slice.call(this.$elm.childNodes);[].forEach.call(i,function(t){e.appendChild(t)}),e.setAttribute("href",t),this.$elm.appendChild(e)}}},{key:"showAsReply",value:function(t){if(t&&"string"==typeof t){var e=this.$elm.querySelector(".annotation-teaser__reply");r.buildElement("span",["annotation-teaser__reply_cta"],t,e)}}}]),t}()},{"../libs/elife-utils":45}],3:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.window=i,this.doc=o,this.$elm=e,this.$contentHeader=this.doc.querySelector(".content-header-grid__side-popup-block__list"),this.$contentHeader&&(this.$contentHeaderDownloadLink=this.$contentHeader.querySelector(".content-header__download_link"),this.$contentHeaderDownloadLink&&(this.$elm.classList.add("article-download-links-list--js"),this.$elm.classList.add("visuallyhidden"),this.$elm.setAttribute("aria-expanded","false"),this.hideJsExcludes(),this.moveList(),this.$toggler=this.doc.querySelector(".content-header__download_link"),this.$toggler.addEventListener("click",this.toggle.bind(this)))))}return o(t,[{key:"hideJsExcludes",value:function(){[].forEach.call(this.$elm.querySelectorAll(".article-download-links-list__group--js-exclude"),function(t){t.classList.add("visuallyhidden")})}},{key:"moveList",value:function(){var t=this.$contentHeaderDownloadLink.nextElementSibling;this.$elm.parentNode.parentNode.classList.add("visuallyhidden"),this.$contentHeader.insertBefore(this.$elm,t)}},{key:"toggle",value:function(t){t.preventDefault(),t.stopPropagation(),this.isOpen()?this.close():this.open()}},{key:"isOpen",value:function(){return!this.$elm.classList.contains("visuallyhidden")}},{key:"open",value:function(){this.$elm.classList.remove("visuallyhidden"),this.$elm.setAttribute("aria-expanded","true"),this.window.addEventListener("click",this.checkForClose.bind(this))}},{key:"checkForClose",value:function(t){r.areElementsNested(this.$elm,t.target)||this.close()}},{key:"close",value:function(){this.$elm.classList.add("visuallyhidden"),this.$elm.setAttribute("aria-expanded","false"),this.window.removeEventListener("click",this.checkForClose.bind(this))}}]),t}()},{"../libs/elife-utils":45}],4:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e.classList.contains("article-section--first")||(this.$elm=e,this.window=i,this.doc=o,this.viewportWidthSmall=600,this.viewportWidthLarge=1199,this.initialise(this.$elm,o))}return o(t,[{key:"initialise",value:function(t,e){this.$elm.classList.add("article-section--js"),this.$toggle=this.createToggle(t,e),this.$body=t.querySelector(".article-section__body"),this.setInitialState(t,this.$toggle,this.$body),this.$elm.addEventListener("expandsection",this.expand.bind(this)),this.$elm.addEventListener("collapsesection",this.collapse.bind(this))}},{key:"createToggle",value:function(t,e){var i=t.querySelector(".article-section__header"),n=e.createElement("A");return n.setAttribute("href","#"),n.classList.add("article-section__toggle"),n.appendChild(i.firstElementChild),i.appendChild(n),n.addEventListener("click",this.toggleState.bind(this)),n}},{key:"setInitialState",value:function(t,e,i){var n="";this.window.location&&this.window.location.hash&&(n=this.window.location.hash.substring(1)),this.window.navigator.userAgent&&this.window.navigator.userAgent.indexOf("Googlebot/")!==-1?t.dataset.initialState="opened":this.doc.referrer&&this.doc.referrer.indexOf(".google.")!==-1?t.dataset.initialState="opened":n&&r.isIdOfOrWithinSection(n,t,this.doc)?t.dataset.initialState="opened":this.viewportNoWiderThan(this.viewportWidthLarge)?this.viewportNoWiderThan(this.viewportWidthSmall)&&(t.dataset.initialState="closed"):t.dataset.initialState="opened","closed"===t.dataset.initialState?(t.classList.add("article-section--collapsed"),e.classList.add("article-section__toggle--closed"),i.classList.add("visuallyhidden")):(e.classList.remove("article-section__toggle--closed"),i.classList.remove("visuallyhidden"))}},{key:"viewportNoWiderThan",value:function(t){return this.window.matchMedia("(max-width: "+t+"px)").matches}},{key:"toggleState",value:function(t){t.preventDefault(),this.$toggle.classList.contains("article-section__toggle--closed")?this.$elm.dispatchEvent(r.eventCreator("expandsection")):this.$elm.dispatchEvent(r.eventCreator("collapsesection"))}},{key:"collapse",value:function(){this.$toggle.classList.add("article-section__toggle--closed"),this.$elm.classList.add("article-section--collapsed"),this.$body.classList.add("visuallyhidden")}},{key:"expand",value:function(t){this.$toggle.classList.remove("article-section__toggle--closed"),this.$elm.classList.remove("article-section--collapsed"),this.$body.classList.remove("visuallyhidden"),this.window.MathJax&&this.window.MathJax.Hub&&this.window.MathJax.Hub.Queue(["Rerender",this.window.MathJax.Hub,this.$elm.id]);try{if(0!==t.detail.search(/https?:\/\//)){var e=this.doc.getElementById(t.detail);e&&e.scrollIntoView()}}catch(i){}}}]),t}()},{"../libs/elife-utils":45}],5:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;o(this,t),this.$elm=e,this.window=r,this.doc=a,this.assetItems=[];var l=void 0,h=this.$elm.querySelector(".asset-viewer-inline__header_link");l=h?s.remoteDoc(h.href,this.window).then(function(t){var e=t.querySelector("#"+i.$elm.id);if(!e)return[i.$elm];var n=t.querySelectorAll('[data-parent-asset-id="'+i.$elm.id+'"]'),o=e.dataset.behaviour.trim().split(" "),r=o.indexOf("AssetNavigation");o.splice(r,1),e.dataset.behaviour=o.join(" "),i.$elm.parentNode.replaceChild(e,i.$elm),i.$elm=e;var s=[i.$elm],a=!0,l=!1,h=void 0;try{for(var c,d=n[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var u=c.value;s.push(u),i.$elm.parentNode.insertBefore(u,i.$elm.nextSibling)}}catch(p){l=!0,h=p}finally{try{!a&&d["return"]&&d["return"]()}finally{if(l)throw h}}return s}):Promise.resolve().then(function(){return[i.$elm].concat(n(i.findSupplements()))}),l=l.then(function(t){i.assetItems=t,i.assetItems.length>1&&!function(){var t=i.window.location.hash.substring(1),e=0;[].forEach.call(i.assetItems,function(n,o){var r=s.buildElement("div",["asset-viewer-inline__header_navigation"],"",n.querySelector(".asset-viewer-inline__header_panel"),".asset-viewer-inline__header_text");n.id===t&&(e=o),i.addPreviousButton(o,r),i.addNextButton(o,r),n.addEventListener("assetViewerFocus",function(){return i.show(o)})}),i.show(e),i.window.addEventListener("hashchange",i.hashChange.bind(i))}()})}return r(t,[{key:"addPreviousButton",value:function(t,e){var i=this,n=s.buildElement("span",["asset-viewer-inline__previous"],"",e);t>0&&(n.addEventListener("click",function(){i.window.history.pushState(null,"","#"+i.assetItems[t-1].id),i.show(t-1)}),n.classList.add("asset-viewer-inline__previous--active"))}},{key:"addNextButton",value:function(t,e){var i=this,n=s.buildElement("span",["asset-viewer-inline__next"],"",e);t<this.assetItems.length-1&&(n.addEventListener("click",function(){i.window.history.pushState(null,"","#"+i.assetItems[t+1].id),i.show(t+1)}),n.classList.add("asset-viewer-inline__next--active"))}},{key:"hideAll",value:function(){[].forEach.call(this.assetItems,function(t){return t.classList.add("visuallyhidden")})}},{key:"show",value:function(t){this.hideAll(),this.assetItems[t].classList.remove("visuallyhidden")}},{key:"findSupplements",value:function(){return this.doc.querySelectorAll('[data-parent-asset-id="'+this.$elm.id+'"]')}},{key:"hashChange",value:function(t){var e=this,i="";return!!(i=t.newURL?t.newURL.substring(t.newURL.indexOf("#")+1):this.window.location.hash.substring(1))&&void[].forEach.call(this.assetItems,function(t,n){t.id===i&&(e.show(n),t.scrollIntoView())})}}]),t}()},{"../libs/elife-utils":45}],6:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),this.$elm=e,this.window=i,this.doc=o,this.$elm.querySelector(".asset-viewer-inline__open_link")&&this.setup(o)}return o(t,[{key:"handleClick",value:function(t){var e=this;t.preventDefault();var i=[],n=0,o=this.findAssets();[].forEach.call(o,function(t,o){var r=t.querySelector(".caption-text__heading"),s={src:t.dataset.assetViewerUri,w:t.dataset.assetViewerWidth,h:t.dataset.assetViewerHeight};r&&(s.title=r.innerHTML),i.push(s),t.id===e.$elm.id&&(n=o)});var s={index:n,history:!1,shareEl:!1},a=new PhotoSwipe(document.querySelector(".pswp"),PhotoSwipeUI_Default,i,s);a.init(),a.listen("beforeChange",function(){var t=e.findAssets()[a.getCurrentIndex()],i=r.eventCreator("assetViewerFocus");t.dispatchEvent(i)})}},{key:"findAssets",value:function(){return this.doc.querySelectorAll('[data-asset-viewer-group="'+this.$elm.dataset.assetViewerGroup+'"]')}},{key:"setup",value:function(e){var i=this;t.load(e).then(function(){var t=i.$elm.querySelector(".captioned-asset__link"),e=i.$elm.querySelector(".asset-viewer-inline__open_link");t&&t.addEventListener("click",i.handleClick.bind(i)),e&&e.addEventListener("click",i.handleClick.bind(i))})}}],[{key:"load",value:function(t){if(!this.loader){this.loader=Promise.all([r.loadJavaScript("https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js","sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy"),r.loadJavaScript("https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js","sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q"),r.loadStyleSheet("https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css","sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh"),r.loadStyleSheet("https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css","sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R")]);var e=document.createElement("div");e.className="pswp",e.tabIndex="-1",e.setAttribute("role","dialog"),e.setAttribute("aria-hidden","true"),e.innerHTML='\n<div class="pswp__bg"></div>\n<div class="pswp__scroll-wrap">\n    <div class="pswp__container">\n        <div class="pswp__item"></div>\n        <div class="pswp__item"></div>\n        <div class="pswp__item"></div>\n    </div>\n    <div class="pswp__ui pswp__ui--hidden">\n        <div class="pswp__top-bar">\n            <div class="pswp__counter"></div>\n            <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n            <button class="pswp__button pswp__button--share" title="Share"></button>\n            <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n            <div class="pswp__preloader">\n                <div class="pswp__preloader__icn">\n                  <div class="pswp__preloader__cut">\n                    <div class="pswp__preloader__donut"></div>\n                  </div>\n                </div>\n            </div>\n        </div>\n        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n            <div class="pswp__share-tooltip"></div>\n        </div>\n        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>\n        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>\n        <div class="pswp__caption">\n            <div class="pswp__caption__center"></div>\n        </div>\n    </div>\n</div>\n',t.body.appendChild(e)}return this.loader}}]),t}()},{"../libs/elife-utils":45}],7:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;return n(this,t),e?(this.window=o,this.window.HTMLAudioElement?(console.log("Initialising Audio Player..."),this.$elm=e,this.$audioElement=this.$elm.querySelector("audio"),this.$audioElement?(this.uniqueId=r.uniqueIds.get("audio",s),this.$elm.id=this.uniqueId,this.$playButton=t.buildPlayButton(this),this.$title=this.prepare$title(this.$elm.querySelector(".audio-player__header"),s),this.$progressTrack=t.buildProgressIndicator(this),this.$progressBar=this.$progressTrack.querySelector('[class*="progress_bar"]'),this.$timeIndicators=t.buildTimeIndicators(this),this.$currentTime=this.$timeIndicators.querySelector('[class*="current_time"]'),this.$duration=this.$timeIndicators.querySelector('[class*="duration"]'),this.duration=null,this.isPlaying=!1,this.$elm.classList.add("audio-player--js"),this.$playButton.classList.add("loading"),this.isPlayerReady=!1,this.$audioElement.addEventListener("loadedmetadata",function(){i.playerReady(i)}),this.$audioElement.readyState>=2&&this.playerReady(this),this.usingMetadata=!1,void this.loadMetadata(this.$elm.dataset.episodeNumber)):void console.warn("No audio element found")):void console.warn("Audio element not supported")):void console.warn("No element provided")}return o(t,[{key:"playerReady",value:function e(i){if(!this.isPlayerReady){this.isPlayerReady=!0,i.duration=i.$audioElement.duration,i.$duration.innerHTML=t.secondsToMinutes(i.duration),i.$playButton.addEventListener("click",function(){i.togglePlay(i.$audioElement,i.$playButton)},!1),i.$audioElement.addEventListener("timeupdate",i.update.bind(i)),i.window.addEventListener("hashchange",i.seekNewTime.bind(i)),i.window.addEventListener("load",i.seekNewTime.bind(i)),this.$playButton.classList.remove("loading");var e=void 0;try{e=new CustomEvent("playerReady",{detail:this.uniqueId})}catch(n){e=document.createEvent("playerReady"),e.initCustomEvent("playerReady",!0,!0,{detail:this.uniqueId})}i.window.dispatchEvent(e)}}},{key:"prepare$title",value:function(t,e){var i=e.createElement("span");try{i.innerHTML=t.innerHTML}catch(n){return}i.classList.add("audio-player__title"),t.innerHTML="",t.appendChild(i);var o=i.querySelector(".audio-player__header-link");return o?(this.$titleLink=o,o):i}},{key:"togglePlay",value:function(t,e){this.isPlaying?this.pause(t,e):this.play(t,e)}},{key:"play",value:function(t,e){t.play(),e.classList.add("audio-player__toggle_play--pauseable"),e.classList.remove("audio-player__toggle_play--playable"),e.innerHTML="Pause",this.isPlaying=!0}},{key:"pause",value:function(t,e){t.pause(),e.classList.add("audio-player__toggle_play--playable"),e.classList.remove("audio-player__toggle_play--pauseable"),e.innerHTML="Play",this.isPlaying=!1}},{key:"update",value:function(){var e=Math.floor(this.$audioElement.currentTime),i=e/this.duration*100,n=t.secondsToMinutes(e);if(this.$progressBar.style.width=i+"%",this.$currentTime.innerHTML=n,this.$titleLink&&(this.$titleLink.hash=e),this.usingMetadata){var o=this.getCurrentChapterNumber();this.setCurrentChapterMetadata(this.getChapterMetadataAtTime(e,this.chapterMetadata)),this.getCurrentChapterMetadata().number!==o&&this.changeChapter(this.getCurrentChapterNumber(),this.getCurrentChapterMetadata().title,this.$elm)}this.$audioElement.ended&&(this.$playButton.classList.add("audio-player__toggle_play--playable"),this.$playButton.classList.remove("audio-player__toggle_play--pauseable"),this.$playButton.innerHTML="Play",this.isPlaying=!1)}},{key:"changeChapter",value:function(t,e,i){this.setTitle(this.episodeTitle,e);var n=void 0;try{n=new CustomEvent("chapterChanged",{detail:t})}catch(o){n=document.createEvent("chapterChanged"),n.initCustomEvent("chapterChanged",!0,!0,{detail:t})}i.dispatchEvent(n)}},{key:"seekNewTime",value:function(t){var e,i=!1;try{e=t.newURL.substring(t.newURL.indexOf("#")+1),i=!0}catch(t){e=this.window.location.hash.substring(1),i=!1}!isNaN(e)&&e>=0&&(this.seek(e,this.$audioElement),!this.isPlaying&&i&&this.play(this.$audioElement,this.$playButton))}},{key:"handleSeek",value:function(t,e){var i=parseInt(t.offsetX,10),n=e.$progressTrack.clientWidth,o=i/parseInt(n,10);this.seek(o*e.duration,e.$audioElement)}},{key:"seek",value:function(t,e){e.currentTime=t,this.update()}},{key:"setTitle",value:function(t,e){this.title=t,e&&(this.title+=": "+e),this.$title.innerHTML=this.title}},{key:"getCurrentChapterMetadata",value:function(){return this.currentChapterMetadata}},{key:"setCurrentChapterMetadata",value:function(t){this.currentChapterMetadata=t}},{key:"getCurrentChapterNumber",value:function(){return this.getCurrentChapterMetadata().number||0}},{key:"getChapterMetadataAtTime",value:function(t,e){if(!e)return"";var i="",n=0;return e.forEach(function(e,o,r){var s=parseInt(e.time,10),a=o<r.length-1?r[o+1].time:null;t>=s&&(!a||t<a)&&(i=e.title,n=e.number)}),{title:i,number:n}}},{key:"processMetadata",value:function(t){this.episodeTitle="Episode "+t.number,this.setTitle(this.episodeTitle),this.chapterMetadata=this.prepareChapterMetadata(t),this.currentChapterMetadata={number:0,title:""}}},{key:"prepareChapterMetadata",value:function(t){var e=[];return t.chapters.forEach(function(t){e.push({time:t.time,number:t.number,title:t.number+". "+t.title})}),e}},{key:"loadMetadata",value:function(){try{this.processMetadata(JSON.parse(this.$elm.dataset.metadata.replace(/'/g,'"'))),this.usingMetadata=!0}catch(t){console.error(t),this.usingMetadata=!1}}}],[{key:"secondsToMinutes",value:function(t){var e=parseInt(t,10),i=Math.floor(e/60),n=e%60;return n<=9&&(n="0"+n),i+":"+n}},{key:"buildProgressIndicator",value:function(t){var e=r.buildElement("div",["audio-player__progress"],"","#"+t.uniqueId+' [class*="audio-player__container"]');return r.buildElement("div",["audio-player__progress_bar"],"",e),e.addEventListener("click",function(e){t.handleSeek(e,t)},!1),e}},{key:"buildPlayButton",value:function(t){return r.buildElement("button",["audio-player__toggle_play"],"Play","#"+t.uniqueId+' [class*="audio-player"]',!0)}},{key:"buildTimeIndicators",value:function(t){var e=t.uniqueId,i=r.buildElement("div",["audio-player__times"],"","#"+e+" [class*=audio-player__header]",!0);return r.buildElement("span",["audio-player__current_time"],"0:00",i),r.buildElement("span",["audio-player__duration"],"0:00",i),i}}]),t}()},{"../libs/elife-utils":45}],8:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.window=i,this.doc=o,this.$elm=e,this.authors=e.querySelectorAll(".author_list_item"),this.institutions=e.querySelectorAll(".institution_list_item"),this.authors.length>0&&this.authors[this.authors.length-1].classList.add("author_list_item--last"),this.institutions.length>0&&this.institutions[this.institutions.length-1].classList.add("institution_list_item--last"),this.hasToggleAuthor=!1,this.hasToggleInstitution=!1,this.hideAllExcessItems(),this.setupResizeHandler())}return o(t,[{key:"setupResizeHandler",value:function(){var t=this;this.currentClientWidth=document.body.clientWidth,this.window.addEventListener("resize",r.debounce(function(){return t.handleResize()},30))}},{key:"handleResize",value:function(){if(this.currentClientWidth!==document.body.clientWidth){this.currentClientWidth=document.body.clientWidth,this.$elm.querySelector(".author_list--expanded")||this.hideAllExcessItems();var t=this.$elm.querySelectorAll(".item_toggle .author_link_highlight"),e=this.getUpdatedToggleText.bind(this);[].forEach.call(t,function(t){t.innerHTML=e()})}}},{key:"hideExcessItems",value:function(t,e){this.clearExcessMark(e),this.markAsExcess(this.getExcessItems(t,e)),this.toggleExcessItems(e),this.addTrailingText(t,e)}},{key:"getMaxItems",value:function(){return this.window.matchMedia("(min-width: 730px)").matches?9:2===this.authors.length?2:1}},{key:"getExcessItems",value:function(t,e){if("author"!==t&&"institution"!==t)return null;var i=this.getMaxItems();return e.length>i?[].slice.call(e,i):[]}},{key:"markAsExcess",value:function(t){t.forEach(function(t){t.classList.add("excess-item")})}},{key:"clearExcessMark",value:function(t){[].forEach.call(t,function(t){t.classList.remove("excess-item")})}},{key:"toggleExcessItems",value:function(t){[].forEach.call(t,function(t){t.classList.contains("excess-item")?t.classList.add("visuallyhidden"):t.classList.remove("visuallyhidden")})}},{key:"markLastNonExcessItem",value:function(t,e){var i=null,n=!1;if([].forEach.call(e,function(e,o){e.querySelector("."+t)&&(e.querySelector("."+t).classList.remove(t+"--last-non-excess"),e.classList.contains("excess-item")&&!n&&(i=o-1,n=!0))}),null!==i&&i>-1){var o=e[i].querySelector("."+t);o&&o.classList.add(t+"--last-non-excess")}}},{key:"addTrailingText",value:function(t,e){"author"===t&&e.length>this.getMaxItems()&&(this.hasToggleAuthor||(this.buildSeeMoreLessToggle("author"),this.hasToggleAuthor=!0)),"institution"===t&&e.length>this.getMaxItems()&&(this.hasToggleInstitution||(this.buildSeeMoreLessToggle("institution"),this.hasToggleInstitution=!0)),this.markLastNonExcessItem(t,e)}},{key:"getToggleCollapsedText",value:function(){var t='<span class="visuallyhidden"> expand author list</span>';return this.window.matchMedia("(min-width: 730px)").matches?t+'<span aria-hidden="true">see&nbsp;all</span>':"et al."+t}},{key:"getToggleExpandedText",value:function(){var t='<span class="visuallyhidden"> collapse author list</span>';return this.window.matchMedia("(min-width: 730px)").matches?t+'<span aria-hidden="true">see&nbsp;less</span>':t+'<span aria-hidden="true" class="item_toggle_cta">&#171;</span>'}},{key:"getUpdatedToggleText",value:function(t){return"expanded"===t?this.getToggleExpandedText():"collapsed"===t?this.getToggleCollapsedText():this.$elm.querySelector(".item_toggle--expanded")?this.getToggleExpandedText():this.$elm.querySelector(".item_toggle--collapsed")?this.getToggleCollapsedText():void 0}},{key:"updateToggleState",value:function(t,e){var i=this;"expanded"!==t&&"collapsed"!==t||([].forEach.call(e,function(e){e.innerHTML=i.getUpdatedToggleText(t),e.parentNode.classList.toggle("item_toggle--expanded"),e.parentNode.classList.toggle("item_toggle--collapsed")}),"expanded"===t?(this.$elm.querySelector(".author_list").classList.add("author_list--expanded"),this.$elm.querySelector(".institution_list").classList.add("institution_list--expanded")):(this.$elm.querySelector(".author_list").classList.remove("author_list--expanded"),this.$elm.querySelector(".institution_list").classList.remove("institution_list--expanded")))}},{key:"buildSeeMoreLessToggle",value:function(t){var e=this,i=r.buildElement("li",["item_toggle","author_list_item","item_toggle--collapsed","item_toggle--"+t],"",this.$elm.querySelector("."+t+"_list"));i.setAttribute("aria-hidden","true");var n=r.buildElement("button",["author_link_highlight"],this.getUpdatedToggleText("collapsed"),i),o=function(i){i.preventDefault();var n=i.currentTarget.parentNode,o=void 0;n.classList.contains("item_toggle--collapsed")?(e.showAllItems(),o="expanded"):(e.hideAllExcessItems(),o="collapsed"),e.updateToggleState(o,e.$elm.querySelectorAll(".item_toggle .author_link_highlight"),t)};n.addEventListener("click",o)}},{key:"showAllItems",value:function(){this.clearExcessMark(this.authors),this.clearExcessMark(this.institutions),this.toggleExcessItems(this.authors),this.toggleExcessItems(this.institutions)}},{key:"hideAllExcessItems",value:function(){this.markLastNonExcessItem("author",this.authors),this.markLastNonExcessItem("institution",this.institutions),this.hideExcessItems("author",this.authors),this.hideExcessItems("institution",this.institutions)}}]),t}()},{"../libs/elife-utils":45}],9:[function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=t("highcharts"),a=2592e6,l=6048e5,h={chart:{type:"column"},credits:{enabled:!1},title:{text:"Downloads"},subtitle:{text:"(Monthly)"},exporting:!1,xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%m/%y"},tickInterval:a,gridLineWidth:1,labels:{style:{fontWeight:"bold"}}},yAxis:{min:0,title:{text:null},labels:{step:2,style:{fontWeight:"bold"}},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{enabled:!1},tooltip:{shared:!0,crosshairs:!0,backgroundColor:"#000000",borderColor:"#000000",borderRadius:5,useHTML:!0,formatter:function(){return'\n            <div class="chart-tooltip">\n              <div class="chart-tooltip__header">\n                '+this.y+" "+this.points[0].series.chart.options.title.text+'\n              </div>\n              <div class="chart-tooltip__content">\n                '+s.dateFormat("%b %d, %Y",new Date(this.x))+"\n              </div>\n            </div>\n          "}},plotOptions:{column:{states:{hover:{color:"#0088cd"}}}},series:[{name:null,data:[],color:"#000000",lineColor:"#cccccc"}]},c=function(){function t(e){o(this,t),this.target=e,this.chart=s.chart(e,h)}return r(t,[{key:"update",value:function(t,e,i,n,o){var r={title:{text:o},subtitle:{text:n},xAxis:{tickInterval:i,dateTimeLabelFormats:e},series:[{name:null,data:t.periods}]};this.chart.redraw(),this.chart.reflow(),this.chart.update(r)}},{key:"getDateRange",value:function(t){return{dateRange:n({},"monthly"===t?"week":"day","%d/%m/%y"),tick:"monthly"===t?a:l}}},{key:"updateFromJson",value:function(t){var e=t.data,i=t.label,n=t.range,o=t.title,r=this.getDateRange(n),s=r.dateRange,a=r.tick;this.update(e,s,a,o,i)}}]),t}();e.exports=c},{highcharts:138}],10:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,t),e){this.$elm=e,this.window=o,this.doc=s,this.$elm.dataset.resetText=e.innerHTML;var a=r.closest(this.$elm,".modal");a&&a.addEventListener("modalWindowClose",function(){i.reset()}),this.$elm.addEventListener("click",function(){i.copyToClipboard(i.$elm.getAttribute("data-clipboard"),function(){i.$elm.classList.add("button--success"),i.$elm.textContent="Copied!"},function(){i.$elm.classList.add("button--fail"),i.$elm.disabled=!0,i.$elm.textContent="Copy not supported"})})}}return o(t,[{key:"supportsClipboardAPI",value:function(){return!!navigator.clipboard}},{key:"copyToClipboard",value:function(t,e,i){if(this.supportsClipboardAPI())navigator.clipboard.writeText(t).then(e)["catch"](i);else try{this.copyToClipboardFallback(t),e()}catch(n){i()}}},{key:"copyToClipboardFallback",value:function(t){var e=this.doc.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",this.doc.body.appendChild(e),e.focus(),e.select(),this.doc.execCommand("copy"),this.doc.body.removeChild(e)}},{key:"reset",value:function(){this.$elm.classList.remove("button--success","button--fail"),this.$elm.innerHTML=this.$elm.dataset.resetText}}]),t}()},{"../libs/elife-utils":45
}],11:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("./_Dismissible");e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),this.$elm=e,this.window=o,this.doc=s,this.dismissible=new r(this.$elm,".call-to-action",this.doc);var a=this.$elm.querySelector(".call-to-action__button_wrapper");a.addEventListener("click",function(){return i.dismissible.dismiss()}),this.show()}return o(t,[{key:"show",value:function(){this.$elm.classList.add("call-to-action-wrapper--js-shown")}}]),t}()},{"./_Dismissible":44}],12:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.window=i,this.doc=o,this.$elm=e,this.moveableStage=this.$elm.querySelector(".carousel__items"),this.originalSlideWrappers=this.moveableStage.querySelectorAll(".carousel-item"),this.originalSlideCount=this.originalSlideWrappers.length,this.currentSlideCount=this.originalSlideCount,this.originalSlideCount<2||this.init())}return o(t,[{key:"init",value:function(){var t=this;this.currentSlide=1,this.timerInterval=1e4,this.updateButtonAppearance(),this.$elm.appendChild(this.buildVisibleControls()),this.$toggler=this.buildControl$toggle(),this.$elm.insertBefore(this.$toggler,this.$elm.querySelector(".carousel__items")),this.updateWidth(),this.updateControlPanel(this.currentSlide),this.togglePlay(this.$toggler),this.window.addEventListener("keydown",this.handleKey.bind(this)),this.window.addEventListener("blur",this.cancelTimer.bind(this)),this.window.addEventListener("focus",this.setupTimer.bind(this)),this.window.addEventListener("resize",function(){t.updateWidth(),t.adjustTranslateForResize()}),this.makeSingleSlideATVisible(this.currentSlide)}},{key:"updateButtonAppearance",value:function(){var t=this.$elm.querySelectorAll(".carousel-item__cta .button");[].forEach.call(t,function(t){t.classList.add("button--reversed")})}},{key:"atHide",value:function(t){t.setAttribute("tabindex",-1),t.setAttribute("aria-hidden",!0)}},{key:"atShow",value:function(t){t.removeAttribute("tabindex",-1),t.removeAttribute("aria-hidden",!0)}},{key:"setATVisibility",value:function(t,e){var i=this,n=void 0;n=e?this.atShow:this.atHide,n.call(this,t),[].forEach.call(t.childNodes,function(t){t.nodeType===t.ELEMENT_NODE&&(n.call(i,t),t.hasChildNodes()&&i.setATVisibility(t,e))})}},{key:"makeSingleSlideATVisible",value:function(t){var e=this;[].forEach.call(this.moveableStage.querySelectorAll(".carousel-item"),function(t){e.setATVisibility(t,!1)});var i=t||1,n=this.$elm.querySelectorAll(".carousel-item")[i-1];this.setATVisibility(n,!0)}},{key:"buildVisibleControls",value:function(){var t=this.buildControl$traverser("previous"),e=this.buildControl$traverser("next");this.buttons={previous:t,next:e},this.switches=this.buildControl$switches(this.originalSlideCount);var i=r.buildElement("div",["carousel__control_panel"]),n=[t,this.switches,e];return n.forEach(function(t){i.appendChild(t)}),i}},{key:"buildControl$traverser",value:function(t){var e=this,i="previous"===t?"previous":"next",n=t+" item",o=r.buildElement("button",["carousel__control","carousel__control--traverse","carousel__control--"+i]);return o.addEventListener("click",function(){e.userInitiatedProgression(e[i])}),r.buildElement("span",["visuallyhidden"],n,o),o}},{key:"buildControl$toggle",value:function(){var t=this,e=r.buildElement("button",["carousel__control--toggler","visuallyhidden"],"Play carousel");return e.setAttribute("aria-label","The carousel is now paused. Play carousel"),e.addEventListener("click",function(){t.togglePlay(e)}),e}},{key:"buildControl$switches",value:function(t){for(var e=r.buildElement("ol",["carousel__control_switches"]),i=1;i<=t;i+=1)e.appendChild(this.buildControl$switch("Go to item "+i+" of "+this.originalSlideCount,i));return e.addEventListener("click",this.activateSwitch.bind(this)),e}},{key:"buildControl$switch",value:function(t,e){var i=r.buildElement("li",["carousel__control--switch-item"]),n=r.buildElement("button",["carousel__control","carousel__control--switch"],"",i),o=r.buildElement("span",["visuallyhidden"],""+e,n);return o.setAttribute("aria-label",t),i}},{key:"togglePlay",value:function(t){var e=t.innerHTML;"Pause carousel"===e?(t.innerHTML="Play carousel",t.setAttribute("aria-label","The carousel is now paused. Play carousel"),this.timerStopped=!0,this.cancelTimer()):(t.innerHTML="Pause carousel",t.setAttribute("aria-label","The carousel is now playing. Pause carousel"),this.timerStopped=!1,this.setupTimer())}},{key:"cancelTimer",value:function(){this.window.clearInterval(this.timer)}},{key:"setupTimer",value:function(){var t=this;this.cancelTimer(),this.timerStopped=!1,this.timer=this.startNewAdvancementTimer(this.timerInterval),this.$elm.addEventListener("mouseenter",this.cancelTimer.bind(this)),this.$elm.addEventListener("mouseleave",function(){t.cancelTimer(),t.timerStopped||(t.timer=t.startNewAdvancementTimer(t.timerInterval))})}},{key:"startNewAdvancementTimer",value:function(t){var e=this;return this.window.setInterval(function(){e.timerStopped||e.next()},t)}},{key:"handleKey",value:function(t){var e=t.keyCode||t.charCode;37!==e&&39!==e||(this.timerStopped=!0,37===e?this.userInitiatedProgression(this.previous):this.userInitiatedProgression(this.next))}},{key:"userInitiatedProgression",value:function(t){this.timerStopped=!0,t&&"function"==typeof t&&t.call(this,!0)}},{key:"next",value:function(){(this.currentSlide+1)%this.originalSlideCount===0&&this.extendStage(),this.updateSlide(),this.updateControlPanel(this.currentSlide)}},{key:"previous",value:function(){this.currentSlide>1&&(this.updateSlide("previous"),this.updateControlPanel(this.currentSlide))}},{key:"extendStage",value:function(){var t=this;this.currentSlideCount+=this.originalSlideCount,this.updateWidth(),[].forEach.call(this.originalSlideWrappers,function(e){t.moveableStage.appendChild(e.cloneNode(!0))})}},{key:"updateSlide",value:function(t){var e=this.getCurrentOffset(),i=void 0;"previous"===t?(this.currentSlide-=1,i=e+Math.round(this.calcOffset())):(this.currentSlide+=1,i=e-Math.round(this.calcOffset())),r.updateElementTranslate(this.moveableStage,[i+"px",0]),this.makeSingleSlideATVisible(this.currentSlide)}},{key:"calcOffset",value:function(){var t=1114,e=window.innerWidth>=t+r.calcScrollbarWidth();return e?this.$elm.getBoundingClientRect().width:window.innerWidth}},{key:"getCurrentOffset",value:function(){var t=this.moveableStage.style.transform.match(/translate\((.*)px,[^)]+\)/);return t?this.window.parseInt(t[1],10):0}},{key:"updateControlPanel",value:function(t){this.hideInvalidButtonChoice(t),this.updateActiveSwitch(t)}},{key:"hideInvalidButtonChoice",value:function(t){this.buttons.previous.classList.remove("hidden"),this.buttons.next.classList.remove("hidden");var e=this.getLogicalSlideNumber(t);1===e?this.buttons.previous.classList.add("hidden"):e===this.originalSlideCount&&this.buttons.next.classList.add("hidden")}},{key:"updateActiveSwitch",value:function(t){var e=this.getLogicalSlideNumber(t);[].forEach.call(this.switches.querySelectorAll(".carousel__control--switch"),function(t,i){i===e-1?t.classList.add("active"):t.classList.remove("active")})}},{key:"getLogicalSlideNumber",value:function(t){var e=this.originalSlideCount,i=Math.ceil(t/e),n=e*i-(e-1);return t-n+1}},{key:"activateSwitch",value:function(t){var e=this.window.parseInt(t.target.querySelector("span").innerHTML,10),i=this.getLogicalSlideNumber(this.currentSlide),n=e-i;if(e!==i)for(var o=n<0?this.previous:this.next,r=0;r<Math.abs(n);r+=1)this.userInitiatedProgression(o)}},{key:"adjustTranslateForResize",value:function(){var t=Math.round(window.getComputedStyle(this.$elm).width.match(/([0-9.]+)px/)[1]),e=this.currentSlide,i=(e-1)*t*-1;this.moveableStage.style.transform="translate("+i+"px, 0)"}},{key:"updateWidth",value:function(){this.moveableStage.style.width=r.adjustPxString(this.window.getComputedStyle(this.$elm).width,this.currentSlideCount,"multiply")}}]),t}()},{"../libs/elife-utils":45}],13:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.exports=function o(t){n(this,o),t&&(this.$elm=t,this.$elm.insertAdjacentHTML("afterbegin",this.$elm.dataset.image))}},{}],14:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this;n(this,t),this.$elm=e;var o=this.$elm.dataset.checkAvailable,r=this.$elm.dataset.displayOnAvailable;this.checkPMC(o).then(function(t){t?(i.$elm.insertAdjacentHTML("beforebegin",r),i.$elm.remove()):i.$elm.parentNode.remove()})}return o(t,[{key:"checkPMC",value:function(t){return r.loadData(t).then(function(t){return JSON.parse(t)}).then(function(t){return"pmcid"in t.records[0]})}}]),t}()},{"../libs/elife-utils":45}],15:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){n(this,t);var i=e.getAttribute("data-delegate-behaviour"),o=e.querySelectorAll(e.getAttribute("data-selector")),r=e.getAttribute("data-delegate-behaviour-class");[].forEach.call(o,function(e){t.initialiseComponent(e,i),r&&e.classList.add(r)})}return o(t,null,[{key:"setInitialiseComponent",value:function(e){t.initialiseComponent=e}}]),t}()},{}],16:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.$elm=e,this.window=i,this.doc=o,this.$button=e.querySelector("button"),this.$button.form&&(this.$button.classList.add("visuallyhidden"),t.setupEventListeners(t.findFilters(this.$elm))))}return o(t,null,[{key:"setupEventListeners",value:function(t){[].forEach.call(t,function(t){t.form&&t.addEventListener("change",function(){return t.form.submit()})})}},{key:"findFilters",value:function(t){return t.querySelectorAll('input[type="checkbox"]')}}]),t}()},{}],17:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),this.$elm=e,this.window=i,this.doc=o,this.isSingleton=!0,this.window.addEventListener("load",this.handleSectionOpeningViaHash.bind(this)),this.window.addEventListener("hashchange",this.handleSectionOpeningViaHash.bind(this))}return o(t,[{key:"getIdOfCollapsibleSection",value:function(t,e){var i=e.querySelectorAll(".article-section--js");if(!i.length)return null;var n=void 0;return[].forEach.call(i,function(i){n||r.isIdOfOrWithinSection(t,i,e)&&(n=i)}),n?n.id:null}},{key:"handleSectionOpeningViaHash",value:function(t){var e="";if(e=t.newURL?t.newURL.substring(t.newURL.indexOf("#")+1):this.window.location.hash.substring(1),!e)return!1;var i=this.getIdOfCollapsibleSection(e,this.doc);i&&this.doc.getElementById(i).dispatchEvent(r.eventCreator("expandsection",e))}}]),t}()},{"../libs/elife-utils":45}],18:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,t),e){this.$elm=e,this.window=o,this.doc=r;var s=e.getAttribute("data-checkbox-id"),a=void 0;if(s&&this.doc.getElementById(s))a=this.doc.getElementById(s);else{var l=this.buildCheckbox(this.$elm.querySelector("label").textContent,s);this.$elm.parentNode.insertBefore(l,this.$elm),a=l.querySelector("input")}a.addEventListener("change",function(t){i.toggleTextField(i.$elm,a,t)}),this.toggleTextField(this.$elm,a)}}return o(t,[{key:"toggleTextField",value:function(t,e,i){var n=t.querySelector("input");void 0===i&&""!==n.value?e.setAttribute("checked","checked"):void 0!==i&&i.target.checked?(t.classList.remove("visuallyhidden"),""===n.value&&n.focus()):(t.classList.add("visuallyhidden"),n.value="")}},{key:"buildCheckbox",value:function(t,e){var i=r.buildElement("label",["checkbox__item_label","hidden_until_checked__checkbox"]),n=r.buildElement("span",["checkbox__item"],t,i),o=r.buildElement("input",[],"",i,n);return o.setAttribute("type","checkbox"),void 0!==e&&o.setAttribute("id",e),i}}]),t}()},{"../libs/elife-utils":45}],19:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e instanceof HTMLElement&&(this.window=o,this.$elm=e,this.doc=s,this.tabletWidth=900,this.desktopWidth=1200,this.setCurrentSlide(1),this.timerInterval=1e4,this.$prevBtn=e.querySelector(".highlights__control--prev"),this.$nextBtn=e.querySelector(".highlights__control--next"),this.$prevBtn.addEventListener("click",this.previousButton.bind(this)),this.$nextBtn.addEventListener("click",this.nextButton.bind(this)),this.moveableStage=this.$elm.querySelector(".listing-list--highlights"),this.originalSlideWrappers=this.moveableStage.querySelectorAll(".listing-list__item"),this.numSlides=this.originalSlideWrappers.length,this.switchBreakpoint(),this.window.addEventListener("resize",r.debounce(function(){return i.switchBreakpoint()},150)),this.margin=2*this.calculateMargin(),this.$elm.addEventListener("keyup",this.checkTabPress.bind(this)))}return o(t,[{key:"calculateMargin",value:function(){var t=this.originalSlideWrappers[0],e=t.currentStyle||window.getComputedStyle(t);return parseInt(e.marginLeft,10)}},{key:"setCurrentSlide",value:function(t){this.currentSlide=t>this.maxOffset?this.maxOffset:t}},{key:"checkTabPress",value:function(t){if(t&&9===t.keyCode){var e=r.closest(document.activeElement,".listing-list__item");e&&(this.setCurrentSlide(r.getOrdinalAmongstSiblingElements(e)-1),this.renderCurrent())}}},{key:"isFirstSlide",value:function(){return 1===this.currentSlide}},{key:"isLastSlide",value:function(){return this.currentSlide===this.maxOffset}},{key:"previousButton",value:function(t){return t.preventDefault(),this.isFirstSlide()?null:(this.setCurrentSlide(this.currentSlide-1),void this.renderCurrent())}},{key:"nextButton",value:function(t){return t.preventDefault(),this.isLastSlide()?null:(this.setCurrentSlide(this.currentSlide+1),void this.renderCurrent())}},{key:"viewportNoWiderThan",value:function(t){return this.window.matchMedia("(max-width: "+t+"px)").matches}},{key:"onMobile",value:function(){return this.viewportNoWiderThan(this.tabletWidth)}},{key:"onTabletOrMobile",value:function(){return this.viewportNoWiderThan(this.desktopWidth)}},{key:"switchBreakpoint",value:function(){this.onMobile()?this.inView=1:this.onTabletOrMobile()?this.inView=2:this.inView=3,this.maxOffset=this.numSlides-(this.inView-1),this.margin=2*this.calculateMargin(),this.carouselWidth=window.getComputedStyle(this.$elm).width.match(/([0-9\.]+)px/)[1],this.setCurrentSlide(this.currentSlide),this.renderCurrent(),[].forEach.call(this.originalSlideWrappers,function(t){t.style.height="106px"})}},{key:"renderCurrent",value:function(){this.render(this.$elm,this.$nextBtn,this.$prevBtn,this.currentSlide,this.carouselWidth,this.inView)}},{key:"render",value:function(t,e,i,n,o,s){this.isFirstSlide()?i.classList.add("hidden"):i.classList.remove("hidden"),this.isLastSlide()?e.classList.add("hidden"):e.classList.remove("hidden");var a=s-1,l=a*this.margin,h=(o-l)/s,c=h+this.margin,d=c*(n-1)*-1;r.updateElementTranslate(this.moveableStage,[d,0]),t.scrollLeft=0}}]),t}()},{"../libs/elife-utils":45}],20:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,t),e){this.$elm=e,this.window=r,this.doc=s,this.isSingleton=!0;try{this.window.hypothesisConfig=t.assembleHypothesisConfig(this.window)}catch(a){return this.window.console.error(a),void("object"===o(this.window.newrelic)&&this.window.newrelic.noticeError(a))}this.$embedder=this.doc.createElement("script"),this.$embedder.id="hypothesisEmbedder",this.$embedder.addEventListener("load",function(){i.setUpAssetViewerFocus(i.doc)}),this.$embedder.addEventListener("error",function(){i.handleLoadError(i.$embedder)}),this.doc.querySelector("head").appendChild(this.$embedder),this.$embedder.src="https://hypothes.is/embed.js"}}return r(t,[{key:"setUpAssetViewerFocus",value:function(t){t.addEventListener("scrolltorange",function(t){if(t.detail.startContainer){var e=t.detail.startContainer.closest(".asset-viewer-inline");e&&e.dispatchEvent(s.eventCreator("assetViewerFocus"))}})}},{key:"handleLoadError",value:function(t){t.dataset.hypothesisEmbedLoadStatus="failed",t.dispatchEvent(new this.window.ErrorEvent("loaderror",{message:"Hypothesis embed load failed"}))}}],[{key:"assembleHypothesisConfig",value:function(e){var i=e.elifeConfig.hypothesis;t.validateConfig(i);var n={branding:{accentColor:"#087acc",appBackgroundColor:"#fff",ctaBackgroundColor:"#087acc",ctaTextColor:"#fff",selectionFontFamily:"Georgia, Times, serif",annotationFontFamily:"Georgia, Times, serif"},openSidebar:"#annotations"===e.location.hash,disableToolbarCloseBtn:!1,disableToolbarMinimizeBtn:!0,disableToolbarHighlightsBtn:!0,disableToolbarNewNoteBtn:!0,disableBucketBar:!0,enableSidebarDropShadow:!0,enableExperimentalNewNoteButton:!0,enableCleanOnboardingTheme:!0,theme:"clean",showHighlights:!0,onLayoutChange:function(t){t.expanded&&s.expandCollapsedSections(document)}};return function(){return Object.assign({},n,i)}}},{key:"validateConfig",value:function(e){var i=e.services[0];if(t.validateAsUrl("usernameUrl",e.usernameUrl),t.validateAsUrl("apiUrl",i.apiUrl),t.validateAsPopulatedString("authority",i.authority),i.onLoginRequest&&i.onLogoutRequest||!i.onLoginRequest&&!i.onLogoutRequest)throw new Error('Hypothesis config generation failed: couldn\'t find exactly one of the properties "onLoginRequest" and "onLogoutRequest"');if(i.onLoginRequest&&i.onProfileRequest)throw new Error('Hypothesis config generation failed: found both mutually exclusive properties "onLoginRequest" and "onProfileRequest"');if(i.onLoginRequest&&!i.onSignupRequest&&t.failValidationMissingProperty("onSignupRequest"),i.onLoginRequest&&null!==i.grantToken)throw new Error('Hypothesis config generation failed: expected the property "grantToken" to be null, but it was not null');if(i.onLogoutRequest&&!i.onProfileRequest&&t.failValidationMissingProperty("onProfileRequest"),i.onLogoutRequest&&i.onSignupRequest)throw new Error('Hypothesis config generation failed: found both mutually exclusive properties "onLogoutRequest" and "onSignupRequest"');i.onLogoutRequest&&t.validateAsPopulatedString("grantToken",i.grantToken)}},{key:"validateAsUrl",value:function(e,i){t.isProbablyUrl(i)||t.failValidationMissingProperty(e)}},{key:"isProbablyUrl",value:function(t){return"string"==typeof t&&t.match(/^https?:\/\/.*$/)}},{key:"validateAsPopulatedString",value:function(e,i){"string"==typeof i&&i.length||t.failValidationMissingProperty(e)}},{key:"failValidationMissingProperty",value:function(t){throw new Error("Hypothesis config generation failed: couldn't find a valid property with the name \""+t+'"')}}]),t}()},{"../libs/elife-utils":45}],21:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=t("../libs/elife-utils")(),a=t("./SpeechBubble");e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,t),e){this.$elm=e,this.window=i,this.doc=r,this.isWithinContextualData=s.areElementsNested(this.doc.querySelector(".contextual-data"),this.$elm),this.speechBubble=this.setupSpeechBubble(this.isWithinContextualData),this.setupPlacementAndStyles(this.isWithinContextualData);var a=null,l=null;try{l=t.get$hypothesisLoader(this.doc),a=this.setupPreReadyIndicatorsWithTimer(l)}catch(h){return this.window.console.error(h),l&&l instanceof HTMLElement&&l.parentNode.removeChild(l),void("object"===o(this.window.newrelic)&&this.window.newrelic.noticeError(h))}var c="[data-visible-annotation-count]";this.hookUpDataProvider(this.$elm,this.isWithinContextualData,c,a),this.$elm.dataset.hypothesisTrigger=""}}return r(t,[{key:"setupPreReadyIndicatorsWithTimer",value:function(e){var i=this;if(t.hasLoadAlreadyFailed(e))return void this.handleInitFail(null,this.window,!1);var n=12e4,o=this.window.setTimeout(this.handleTimerExpired.bind(this),n);return e.addEventListener("loaderror",function(t){i.handleInitFail(o,i.window,t)}),o}},{key:"handleInitFail",value:function(t,e,i){this.removeHypothesisUI(),this.speechBubble.showFailureState(this.isWithinContextualData);var n=e||this.window;if(n.clearTimeout(t),i!==!1){var r=void 0;r=i&&"string"==typeof i.message?i.message:"Problem loading or interacting with Hypothesis client.";try{throw new Error(r)}catch(s){this.window.console.error(s),"object"===o(this.window.newrelic)&&this.window.newrelic.noticeError(s)}}}},{key:"handleTimerExpired",value:function(){this.handleInitFail(null,this.window,new Error("Hypothesis loading timed out"))}},{key:"removeHypothesisUICounters",value:function(){var t=this.doc.querySelectorAll("[data-visible-annotation-count]");t&&[].forEach.call(t,function(t){var e=t.parentNode.parentNode.querySelector(".visuallyhidden");e.innerHTML="",delete t.dataset.visibleAnnotationCount})}},{key:"removeHypothesisUISidebar",value:function(){var t=this.doc.querySelector(".annotator-frame");t&&t.parentElement.removeChild(t)}},{key:"removeHypothesisUITriggers",value:function(){var t=this.doc.querySelectorAll("[data-hypothesis-trigger]");t&&[].forEach.call(t,function(t){delete t.dataset.hypothesisTrigger})}},{key:"removeHypothesisUIPopupOnSelect",value:function(){var t=this,e=void 0,i=function(i){if("HYPOTHESIS-ADDER"===i.nodeName){var n=t.doc.querySelector("hypothesis-adder");n&&o(n.parentElement)&&(n.parentElement.removeChild(n),e.disconnect())}},n=function(t){var e=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var a=r.value;"childList"===a.type&&a.addedNodes.length&&[].forEach.call(a.addedNodes,i)}}catch(l){n=!0,o=l}finally{try{!e&&s["return"]&&s["return"]()}finally{if(n)throw o}}},r=this.doc.querySelector("hypothesis-adder");r?r.parentElement.removeChild(r):(e=new MutationObserver(n),e.observe(this.doc.querySelector("body"),{childList:!0}))}},{key:"removeHypothesisUI",value:function(){this.removeHypothesisUICounters(),this.removeHypothesisUISidebar(),this.removeHypothesisUITriggers(),this.removeHypothesisUIPopupOnSelect()}},{key:"setupSpeechBubble",value:function(t){var e=new a(this.findElementWithClass("speech-bubble"));return t&&e.showLoadingIndicator(),e}},{key:"setupPlacementAndStyles",value:function(e){t.applyStyleInitial(this.$elm),e||(t.applyStyleArticleBody(this.$elm),this.setInitialDomLocation(this.$elm,s.getItemType(this.doc.querySelector("body"))))}},{key:"findElementWithClass",value:function(t){return this.$elm.querySelector("."+t)?this.$elm.querySelector("."+t):this.$elm.classList.contains(t)?this.$elm:null}},{key:"hookUpDataProvider",value:function(t,e,i,n){var o=this,r=t.querySelector("[data-hypothesis-annotation-count]");if(!r)return void this.handleInitFail(n,this.window);var s=new MutationObserver(function(t){t.forEach(function(t){try{if(!t.addedNodes[0])return;o.updateVisibleCount(t.addedNodes[0].data,i,e),o.speechBubble.removeLoadingIndicator(),o.window.clearTimeout(n)}catch(r){o.handleInitFail(n,o.window,r)}})});s.observe(r,{childList:!0})}},{key:"updateVisibleCount",value:function(t,e,i){var n=parseInt(t);isNaN(n)||n<0||(i?this.$elm.querySelector(e).innerHTML=""+n:this.updateVisibleCountArticleBody(n,e))}},{key:"updateVisibleCountArticleBody",value:function(t,e){t?this.speechBubble.update(t,e):this.speechBubble.showPlaceholder(e)}},{key:"setInitialDomLocation",value:function(e,i){if(i)try{t.findPositioningMethod(i).call(null,e,this.doc.querySelector(".content-container"))}catch(n){this.window.console.error(n)}}}],[{key:"hasLoadAlreadyFailed",value:function(t){return"failed"===t.dataset.hypothesisEmbedLoadStatus}},{key:"get$hypothesisLoader",value:function(t){var e=t.querySelector("#hypothesisEmbedder");if(e)return e;throw new Error("No Hypothesis loading code found")}},{key:"applyStyleInitial",value:function(t){t.classList.add("hypothesis-opener"),t.style.display="inline-block",t.style.cursor="pointer"}},{key:"applyStyleArticleBody",value:function(t){t.style.display="block",t.style["float"]="right",t.style.marginBottom="48px"}},{key:"positionCentrallyInline",value:function(e,i){var n=t.findTarget(i);return n?(e.classList.add("speech-bubble--inline"),n.insertBefore(e,n.firstChild),void t.wrappedInContainer(e)):void i.appendChild(e)}},{key:"positionBySecondSection",value:function(e,i){var n=i.querySelectorAll(".article-section--first");if(n.length)return n[n.length-1].nextElementSibling.querySelector(".article-section__body").appendChild(e),void t.wrappedInContainer(e);throw new Error("Trying to position hypothesis opener in second section, but can't find element with the css class article-section--first.")}},{key:"positionByFirstSection",value:function(e,i){var n=i.querySelectorAll(".article-section--first");if(n.length)return n[n.length-1].classList.contains("article-section--highlighted")?n[n.length-1].parentNode.insertBefore(e,n[n.length-1].nextElementSibling):n[n.length-1].appendChild(e),void t.wrappedInContainer(e);throw new Error("Trying to position hypothesis opener by first section but can't find element with the css class article-section--first.")}},{key:"wrappedInContainer",value:function(t){if(t.classList.contains("speech-bubble--wrapped")){var e=document.createElement("div");e.classList.add("speech-bubble--container"),t.parentNode.insertBefore(e,t),e.appendChild(t)}}},{key:"positionEnd",value:function(e,i){i.appendChild(e),t.wrappedInContainer(e)}},{key:"findPositioningMethod",value:function(e){var i={"blog-article":t.positionEnd,interview:t.positionEnd,"press-package":t.positionEnd,"labs-post":t.positionCentrallyInline,digest:t.positionEnd,insight:t.positionBySecondSection,feature:t.positionBySecondSection,editorial:t.positionBySecondSection,"default":t.positionByFirstSection};return i[e]||i["default"]}},{key:"findTarget",value:function(e){var i=null,n=Math.floor((e.querySelectorAll("p").length-1)/2);return[].forEach.call(e.querySelectorAll("p"),function(e,o){null===i&&o>=n&&!t.targetWithinInLineProfile(e)&&!t.targetWithinBlockquote(e)&&!t.targetBelowSectionHeading(e)&&(i=e)}),i}},{key:"targetWithinInLineProfile",value:function(t){return t.parentNode.parentNode.classList.contains("inline-profile")}},{key:"targetWithinBlockquote",value:function(t){return"BLOCKQUOTE"===t.parentNode.nodeName}},{key:"targetBelowSectionHeading",value:function(t){return 1===s.getOrdinalAmongstSiblingElements(t)&&t.parentNode.parentNode.classList.contains("article-section")}}]),t}()},{"../libs/elife-utils":45,"./SpeechBubble":39}],22:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,t),e){this.$elm=e,this.window=i,this.doc=o;var r=null,s="[data-visible-annotation-count]";this.hookUpDataProvider(this.$elm,s,r),this.$elm.dataset.hypothesisTrigger=""}}return r(t,[{key:"setupPreReadyIndicatorsWithTimer",value:function(e){var i=this;if(t.hasLoadAlreadyFailed(e))return void this.handleInitFail(null,this.window,!1);
var n=12e4,o=this.window.setTimeout(this.handleTimerExpired.bind(this),n);return e.addEventListener("loaderror",function(t){i.handleInitFail(o,i.window,t)}),o}},{key:"handleInitFail",value:function(t,e,i){this.removeHypothesisUI();var n=e||this.window;if(n.clearTimeout(t),i!==!1){var r=void 0;r=i&&"string"==typeof i.message?i.message:"Problem loading or interacting with Hypothesis client.";try{throw new Error(r)}catch(s){this.window.console.error(s),"object"===o(this.window.newrelic)&&this.window.newrelic.noticeError(s)}}}},{key:"handleTimerExpired",value:function(){this.handleInitFail(null,this.window,new Error("Hypothesis loading timed out"))}},{key:"removeHypothesisUICounters",value:function(){var t=this.doc.querySelectorAll("[data-visible-annotation-count]");t&&[].forEach.call(t,function(t){var e=t.parentNode.parentNode.querySelector(".visuallyhidden");e.innerHTML="",delete t.dataset.visibleAnnotationCount})}},{key:"removeHypothesisUISidebar",value:function(){var t=this.doc.querySelector(".annotator-frame");t&&t.parentElement.removeChild(t)}},{key:"removeHypothesisUITriggers",value:function(){var t=this.doc.querySelectorAll("[data-hypothesis-trigger]");t&&[].forEach.call(t,function(t){delete t.dataset.hypothesisTrigger})}},{key:"removeHypothesisUIPopupOnSelect",value:function(){var t=this,e=void 0,i=function(i){if("HYPOTHESIS-ADDER"===i.nodeName){var n=t.doc.querySelector("hypothesis-adder");n&&o(n.parentElement)&&(n.parentElement.removeChild(n),e.disconnect())}},n=function(t){var e=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var a=r.value;"childList"===a.type&&a.addedNodes.length&&[].forEach.call(a.addedNodes,i)}}catch(l){n=!0,o=l}finally{try{!e&&s["return"]&&s["return"]()}finally{if(n)throw o}}},r=this.doc.querySelector("hypothesis-adder");r?r.parentElement.removeChild(r):(e=new MutationObserver(n),e.observe(this.doc.querySelector("body"),{childList:!0}))}},{key:"removeHypothesisUI",value:function(){this.removeHypothesisUICounters(),this.removeHypothesisUISidebar(),this.removeHypothesisUITriggers(),this.removeHypothesisUIPopupOnSelect()}},{key:"hookUpDataProvider",value:function(t,e,i){var n=this,o=t.querySelector("[data-hypothesis-annotation-count]");if(!o)return void this.handleInitFail(i,this.window);var r=new MutationObserver(function(t){t.forEach(function(t){try{if(!t.addedNodes[0])return;n.updateVisibleCount(t.addedNodes[0].data,e),n.window.clearTimeout(i)}catch(o){n.handleInitFail(i,n.window,o)}})});r.observe(o,{childList:!0})}},{key:"updateVisibleCount",value:function(t,e){var i=parseInt(t);isNaN(i)||i<0||this.updateVisibleCountArticleBody(i,e)}},{key:"updateVisibleCountArticleBody",value:function(t,e){var i=this.$elm.querySelector(e);t?i.innerHTML="&nbsp;("+t+")":i.innerHTML=""}}],[{key:"hasLoadAlreadyFailed",value:function(t){return"failed"===t.dataset.hypothesisEmbedLoadStatus}},{key:"get$hypothesisLoader",value:function(t){var e=t.querySelector("#hypothesisEmbedder");if(e)return e;throw new Error("No Hypothesis loading code found")}}]),t}()},{}],23:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=t("./_Dismissible");e.exports=function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,r),this.$elm=t,this.window=e,this.doc=i,this.dismissible=new o(this.$elm,this.$elm.querySelector(".info-bar__container"),this.doc)}},{"./_Dismissible":44}],24:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),this.$elm=e,this.window=i,this.doc=o,this.extraLinksToBuild=null;try{var s=this.$elm.dataset.linkFieldRoots,a=void 0;s&&(a=t.deriveDataAttributeRoots(this.$elm.dataset.linkFieldRoots,this.$elm)),this.setPropertiesFromDataAttributes(a,this.$elm),this.extraLinksToBuild&&(this.$control=this.buildControl(this.extraLinksToBuild,this.$elm,r.buildElement),this.$elm.appendChild(this.$control))}catch(l){this.window.console.log(l)}}return o(t,[{key:"setPropertiesFromDataAttributes",value:function(e,i){this.displayName=i.dataset.displayName,this.defaultUri=i.dataset.defaultUri,e&&(this.extraLinksToBuild=t.deriveLinksToBuild(e,i))}},{key:"buildControl",value:function(t,e,i){var n=i.call(null,"nav");return this.insertToggle(n,e,i),this.$menu=this.buildMenu(t,e,i),n.appendChild(this.$menu),n}},{key:"insertToggle",value:function(t,e,i){var n=i.call(null,"a",["login-control__controls_toggle"],"",t);n.setAttribute("href",this.defaultUri);var o=e.dataset.icon;"string"==typeof o&&o.length&&(n.innerHTML=o),n.addEventListener("click",this.toggle.bind(this))}},{key:"buildMenu",value:function(t,e,i){var n=i.call(null,"ul",["login-control__controls","hidden"]);return this.insertDefaultLink(n,e,i),t&&this.insertExtraLinks(t,n,i),n}},{key:"insertDefaultLink",value:function(t,e,i){var n=i.call(null,"li",["login-control__control"],"",t),o=i.call(null,"a",["login-control__link"],"",n);o.setAttribute("href",this.defaultUri),i.call(null,"div",["login-control__display_name"],this.displayName,o);var r=e.dataset.subsidiaryText;return r&&i.call(null,"div",["login-control__subsidiary_text"],r,o),n}},{key:"insertExtraLinks",value:function(e,i,n){if(!Array.isArray(e)||!e.length)throw new Error("Unable to build extra links, no data supplied");e.forEach(function(e){t.insertLink(e,i,n)})}},{key:"toggle",value:function(t){t.preventDefault(),t.stopPropagation(),this.isOpen()?this.close():this.open()}},{key:"isOpen",value:function(){return!this.$menu.classList.contains("hidden")}},{key:"open",value:function(){this.$menu.classList.remove("hidden"),this.window.addEventListener("click",this.checkForClose.bind(this))}},{key:"checkForClose",value:function(t){r.areElementsNested(this.$menu,t.target)||this.close()}},{key:"close",value:function(){this.$menu.classList.add("hidden"),this.window.removeEventListener("click",this.checkForClose.bind(this))}}],[{key:"deriveDataAttributeRoots",value:function(e,i){if(!t.validateDataAttributeRootsList(e))throw new SyntaxError("invalid roots list supplied");var n=e.split(",").map(function(t){return t.trim()});if(!n[0].length)return[];if(!t.areAllImpliedDataAttributesPresent(n,i))throw new ReferenceError("One or more required data attributes implied by data-link-field-roots are missing");return n}},{key:"areAllImpliedDataAttributesPresent",value:function(e,i){var n=!0;return e.forEach(function(e){i.dataset[t.convertKebabCaseToCamelCase(e+"-uri")]&&i.dataset[t.convertKebabCaseToCamelCase(e+"-text")]||(n=!1)}),n}},{key:"validateDataAttributeRootsList",value:function(t){return"string"==typeof t&&t.search(/^[ \t]*[a-z][a-z-$_]*[^-,][ \t]*(,[ \t]*[a-z][a-z-$_]*[^-,][ \t]*)*$/)>-1}},{key:"deriveLinksToBuild",value:function(e,i){var n=[];return e.forEach(function(e){var o=e+"-text",r=t.convertKebabCaseToCamelCase(o),s=i.dataset[r],a=e+"-uri",l=t.convertKebabCaseToCamelCase(a),h=i.dataset[l];s&&h&&n.push({text:s,uri:h})}),n}},{key:"convertKebabCaseToCamelCase",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t&&"string"==typeof t?t.replace(/\-([a-z])/g,function(t){return t.substring(1).toUpperCase()}):null}},{key:"insertLink",value:function(t,e,i){var n=i.call(null,"li",["login-control__control"],"",e),o=i.call(null,"a",["login-control__link"],t.text,n);o.setAttribute("href",t.uri)}}]),t}()},{"../libs/elife-utils":45}],25:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("./Overlay"),s=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.window=i,this.doc=o,this.$elm=e,this.pageOverlay=new r("body",null,"overlayMainMenu",30),this.closeFn=this.close.bind(this),this.$elm.setAttribute("aria-expanded","false"),this.buildCloseControl())}return o(t,[{key:"moveWithinDom",value:function(){this.$elm.classList.add("main-menu--js");var t=this.doc.querySelector(".wrapper--site-header");t&&t.insertBefore(this.$elm,t.insertAfter)}},{key:"isOpen",value:function(){return this.$elm.classList.contains("main-menu--shown")}},{key:"close",value:function(){this.$elm.classList.remove("main-menu--shown"),this.$elm.setAttribute("aria-expanded","false"),this.pageOverlay.hide(),this.pageOverlay.get$elm().removeEventListener("click",this.closeFn)}},{key:"open",value:function(){this.$elm.classList.add("main-menu--shown"),this.$elm.setAttribute("aria-expanded","true"),this.$elm.focus(),this.pageOverlay.get$elm().addEventListener("click",this.closeFn),this.pageOverlay.show()}},{key:"buildCloseControl",value:function(){var t=void 0;if(!this.$elm.querySelector("#mainMenuCloseControl")){var e=this.$elm.querySelector(".main-menu__container");t=s.buildElement("button",["main-menu__close_control"],"Close",e,e.firstElementChild),t.id="mainMenuCloseControl",t.addEventListener("click",this.close.bind(this))}}}]),t}()},{"../libs/elife-utils":45,"./Overlay":30}],26:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),this.window=i,this.isSingleton=!0,t.init(o)}return o(t,null,[{key:"init",value:function(e){if(t.loadDependencies(e),"MutationObserver"in window&&!t.dependenciesAlreadySetup(e)){var i=new MutationObserver(function(i,n){t.loadDependencies(e),t.dependenciesAlreadySetup(e)&&n.disconnect()});i.observe(e.body,{childList:!0,subtree:!0})}}},{key:"loadDependencies",value:function(e){e.querySelector("math")&&(t.setupProperties(),t.load(e))}},{key:"dependenciesAlreadySetup",value:function(t){return!!t.querySelector('script[src*="mathjax"]')}},{key:"setupProperties",value:function(){window.MathJax={CommonHTML:{linebreaks:{automatic:!0,width:"75% container"}},"fast-preview":{disabled:!0},"HTML-CSS":{linebreaks:{automatic:!0,width:"75% container"}},SVG:{linebreaks:{automatic:!0,width:"75% container"}}}}},{key:"setupResizeHandler",value:function(){window.MathJax.Hub.Config({"HTML-CSS":{linebreaks:{automatic:!0,width:"75% container"},scale:function(){function t(t){var e=function(){return!!navigator.userAgent.match(/iPad|iPhone/)};return!(t.isMSIE||t.isMac&&(t.isSafari||t.isChrome)||e()&&t.isSafari||t.isFirefox&&!t.isMac&&!t.isPC||"Unknown"===t.toString())}var e=90,i=2*e;return t(window.MathJax.Hub.Browser)?i:e}()}}),this.currentClientWidth=document.body.clientWidth;var t=void 0,e=function(){t||(t=setTimeout(function(){t=null,this.window.MathJax&&this.currentClientWidth!==document.body.clientWidth&&(this.currentClientWidth=document.body.clientWidth,this.window.MathJax.Hub.Queue(["Rerender",this.window.MathJax.Hub]))},300))};window.addEventListener("resize",e)}},{key:"load",value:function(e){var i=e.createElement("script");i.type="text/javascript",i.addEventListener("load",t.setupResizeHandler),i.src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=MML_HTMLorMML",i.integrity="sha384-Ra6zh6uYMmH5ydwCqqMoykyf1T/+ZcnOQfFPhDrp2kI4OIxadnhsvvA2vv9A7xYv",i.crossOrigin="anonymous",e.querySelector("body").appendChild(i)}}]),t}()},{}],27:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;return n(this,t),e?(console.log("Initialising Chapter listing item..."),this.$elm=e,this.startTime=e.dataset.startTime,void(!this.startTime||isNaN(this.startTime)||this.startTime<0||(this.window=i,this.document=o,i.addEventListener("playerReady",this.listenForChapterChange.bind(this)),this.$link=this.createLink(o,this.$elm,this.startTime),this.setupEventHandlers(this.$link)))):void console.warn("No element provided")}return o(t,[{key:"listenForChapterChange",value:function(t){var e=this.document.getElementById(t.detail);e&&e.addEventListener("chapterChanged",this.indicateChapterChanged.bind(this))}},{key:"createLink",value:function(t,e,i){var n=e.querySelector(".media-chapter-listing-item__header_text");if(n){var o=void 0,r=void 0;try{r=n.querySelector(".media-chapter-listing-item__header_text_link"),o=r.innerHTML,r.parentNode.removeChild(r)}catch(s){o=n.innerHTML}var a=t.createElement("a");return a.innerHTML=o,a.setAttribute("href","#"+i),a.classList.add("media-chapter-listing-item__header_text_link"),n.innerHTML="",n.appendChild(a),a}}},{key:"indicateChapterChanged",value:function(t){var e=t.detail;e===this.window.parseInt(this.$elm.dataset.chapterNumber)?this.$elm.classList.add("current-chapter"):this.$elm.classList.remove("current-chapter")}},{key:"setupEventHandlers",value:function(t){t.addEventListener("chapterChanged",this.indicateChapterChanged)}}]),t}()},{}],28:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(l){o=!0,r=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=t("../libs/elife-utils")(),a=t("./BarChart"),l=function(){function t(e){var i=this;n(this,t),this.$el=e;var o=s.buildElement("div",["charts"],"",this.$el),r=s.buildElement("div",[],"Loading...",o);r.id=this.$el.dataset.containerId;var l=s.buildElement("p",[],"",o);s.buildElement("span",["visuallyhidden"],"Toggle charts",l),this.$next=this.trigger("prev","Left",l),this.$prev=this.trigger("next","Right",l);var h=s.buildElement("ol",["button-collection","button-collection--centered","button-collection--compact"],"",this.$el);this.$dailyButton=this.groupingButton(h,"Daily"),this.$monthlyButton=this.groupingButton(h,"Monthly"),this.endpoint=e.dataset.apiEndpoint,this.id=e.dataset.id,this.type=e.dataset.type||"article",this.selected=e.dataset.metric||"downloads",this.period=e.dataset.period||"month";var c=s.closest(this.$el,".article-section");c&&c.addEventListener("expandsection",function(){0!==i.getSelectedMetric().page&&i.renderView(e,i.getSelectedMetric())}),this.availableCharts=["page-views","downloads"],this.availablePeriods=["day","month"],this.currentChart=this.availableCharts.indexOf(this.selected),"month"===this.period?(this.$monthlyButton.classList.add("button--default"),this.$monthlyButton.classList.remove("button--outline"),this.$dailyButton.classList.add("button--outline"),this.$dailyButton.classList.remove("button--default")):(this.$monthlyButton.classList.add("button--outline"),this.$monthlyButton.classList.remove("button--default"),this.$dailyButton.classList.add("button--default"),this.$dailyButton.classList.remove("button--outline"));var d=s.flatten(this.availableCharts.map(function(t){return i.availablePeriods.map(function(e){return t+"-by-"+e})}));this.loadMore=this.loadMore.bind(this),this.barChart=new a(e.dataset.containerId),this.metrics=d.map(function(t){return{name:t,page:0,viewPage:1,firstMonth:null,remaining:1,periods:[],selected:!1,loaded:!1,reverse:-1}}),this.$prev.addEventListener("click",this.prevButton.bind(this)),this.$next.addEventListener("click",this.nextButton.bind(this)),this.$dailyButton&&this.$dailyButton.addEventListener("click",this.changePeriod("day").bind(this)),this.$monthlyButton&&this.$monthlyButton.addEventListener("click",this.changePeriod("month").bind(this)),this.updateSelectedMetric(function(t){return Object.assign(t,{selected:!0})}),this.loadMore().then(function(){return this.renderView(e,this.getSelectedMetric())}.bind(this))}return r(t,[{key:"trigger",value:function(t,e,i){var n=s.buildElement("a",["trigger","trigger--"+t],this.chevron(e),i);return n.href="#",n}},{key:"chevron",value:function(t){var e="chevron"+t+"Svg",i="chevron"+t+"Srcset",n="chevron"+t+"Src";return'<picture><source srcset="'+this.$el.dataset[e]+'" type="image/svg+xml"><img srcset="'+this.$el.dataset[i]+'" src="'+this.$el.dataset[n]+'" alt="Navigate '+t.toLowerCase()+' icon"></picture>'}},{key:"groupingButton",value:function(t,e){var i=s.buildElement("li",["button-collection__item"],null,t),n=s.buildElement("a",["button","button--outline","button--small"],e,i);return n.href="#",n}},{key:"changePeriod",value:function(t){var e=this;return function(i){i.preventDefault();var n=e.$el.querySelector(".button--default");return n.classList.add("button--outline"),n.classList.remove("button--default"),i.currentTarget.classList.add("button--default"),i.currentTarget.classList.remove("button--outline"),e.log("changed period to "+t),e.changeMetric(e.selected,t).then(function(){e.renderView(e.$el,e.getSelectedMetric())})}}},{key:"isFirstPage",value:function(){return this.currentChart<=0}},{key:"isLastPage",value:function(){return this.currentChart>=this.availableCharts.length-1}},{key:"nextButton",value:function(t){var e=this;t.preventDefault(),this.$el.classList.add("charts--loading"),this.loadMore().then(function(){e.$el.classList.remove("charts--loading"),e.updateSelectedMetric(function(t){return Object.assign(t,{viewPage:t.viewPage+1})}),e.renderView(e.$el,e.getSelectedMetric())})}},{key:"prevButton",value:function(t){t.preventDefault(),this.updateSelectedMetric(function(t){return Object.assign(t,{viewPage:t.viewPage-1})}),this.renderView(this.$el,this.getSelectedMetric())}},{key:"nextChart",value:function(){var t=this;return this.isLastPage()?null:(this.currentChart=this.currentChart+1,void this.changeMetric(this.availableCharts[this.currentChart],this.period).then(function(){t.renderView(t.$el,t.getSelectedMetric())}))}},{key:"previousChart",value:function(){var t=this;return this.isFirstPage()?null:(this.currentChart=this.currentChart-1,void this.changeMetric(this.availableCharts[this.currentChart],this.period).then(function(){t.renderView(t.$el,t.getSelectedMetric())}))}},{key:"changeMetric",value:function(t,e){var i=this;if(this.$el.classList.add("charts--loading"),this.isLocked)return this.log("Finishing in progress requests first"),this.lock.then(function(){return i.changeMetric(t,e)});this.updateSelectedMetric(function(t){return Object.assign(t,{selected:!1})}),this.selected=t,this.period=e;var n=void 0;return this.updateSelectedMetric(function(t){return n=t.loaded,Object.assign(t,{selected:!0})}),this.log("Changed metric to ",t,e,", loaded: ",n),Promise.resolve(n?null:this.loadMore())}},{key:"getSelectedName",value:function(){return this.log("selected name: ",this.selected+"-by-"+this.period),this.selected+"-by-"+this.period}},{key:"getEndpoint",value:function(t,e,i,n,o,r,s){return t+"/metrics/"+e+"/"+i+"/"+n+"?by="+o+"&per-page="+r+"&page="+s}},{key:"getSelectedMetric",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,o=this.metrics[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value;if(r.name===this.getSelectedName())return r}}catch(s){e=!0,i=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(e)throw i}}}},{key:"getNthPage",value:function(t,e,i,n){var o=e,r=i;for(o+=(t-1)*n;o>12;)o-=12,r+=1;return{month:parseInt(o,10),year:parseInt(r,10)}}},{key:"getJsonPage",value:function(t,e){return s.loadData(this.getEndpoint(this.endpoint,this.type,this.id,this.selected,this.period,e,t))}},{key:"updateSelectedMetric",value:function(t){var e=this;this.metrics=this.metrics.map(function(i){return i.name===e.getSelectedName()?t(i):i})}},{key:"saveResults",value:function(t,e,i){this.log("saving results",t),this.updateSelectedMetric(function(n){return n.periods=n.periods.concat(this.transformPeriods(t.periods)),n.page=e,n.loaded=!0,n.remaining=i,1===e&&(n.firstMonth=[parseInt(n.periods[0].month),parseInt(n.periods[0].year)]),n.periods.length>=2&&this.periodToTimestamp(n.periods[0])<this.periodToTimestamp(n.periods[1])&&(n.reverse=1),n}.bind(this))}},{key:"periodToTimestamp",value:function(t){return Date.UTC(parseInt(t.year,10),parseInt(t.month-1,10),parseInt(t.day?t.day:1,10))}},{key:"transformPeriods",value:function(t){return this.log(t),t.map(function(t){var e=t.value,i=t.period,n=i.split("-"),o=n[0],r=n[1],s={year:o,month:r,value:e};return n[2]&&(s.day=n[2]),s})}},{key:"log",value:function(){}},{key:"filterPeriod",value:function(t,e){return function(i){return parseInt(i.month,10)===t&&parseInt(i.year,10)===e}}},{key:"filterYearPeriod",value:function(t){return function(e){return parseInt(e.year,10)===t}}},{key:"filterMonthPeriod",value:function(t,e,i){return function(n){return parseInt(n.month,10)>=t&&parseInt(n.year,10)===e+(i-1)||parseInt(n.month,10)<=t&&parseInt(n.year,10)===e+i}}},{key:"renderView",value:function(t,e){var i=this,n=void 0,r=void 0,s=o(e.firstMonth,2),a=s[0],l=s[1],h=this.getNthPage(e.viewPage,a,l,e.reverse),c=this.getNthPage(e.viewPage+1,a,l,e.reverse),d="day"===this.period?this.filterPeriod(h.month,h.year):this.filterYearPeriod(l+(e.viewPage-1)*e.reverse),u="day"===this.period?this.filterPeriod(c.month,c.year):this.filterYearPeriod(l+e.viewPage*e.reverse);n=e.periods.filter(d),r=e.periods.filter(u).length>0,e.reverse===-1&&(n=n.reverse()),this.$el.classList.remove("charts--loading"),this.barChart.updateFromJson({data:{totalPeriods:e.totalPeriods,totalValue:e.totalValue,periods:n.map(function(t){return[i.periodToTimestamp(t),t.value]})},range:"month"===this.period?"monthly":"daily",title:"month"===this.period?"(Monthly)":"(Daily)",label:"downloads"===this.selected?"Downloads":"Page Views"}),r?this.$next.classList.remove("hidden"):this.$next.classList.add("hidden"),1===e.viewPage?this.$prev.classList.add("hidden"):this.$prev.classList.remove("hidden"),this.log("Rendering view",t,e)}},{key:"loadMore",value:function(){var t=this,e=this.getSelectedMetric();if(e.remaining<1)return this.log("No more pages, skipping"),Promise.resolve(null);if(this.isLocked)return this.log("Request already in progress"),this.lock=this.lock.then(function(){this.loadMore()}.bind(this)),this.lock;var i=s.defer();this.isLocked=!0,this.lock=i.promise;var n=e.page+1,o="day"===this.period?32:13;return this.currentRrequest=this.getJsonPage(n,o),this.currentRrequest.then(function(t){return JSON.parse(t)}).then(function(e){t.total=e.totalPeriods||0,t.log("parse page ",n);var r=t.total-o*n,s=Math.ceil(r/o);return t.saveResults(e,n,s),t.isLocked=!1,i.resolve(),t.log("resolved,","total",t.total,"remaining requests:",s),e})}}]),t}();e.exports=l},{"../libs/elife-utils":45,"./BarChart":9}],29:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,t),e){this.$elm=e,this.window=o,this.doc=r;var s=this.$elm.getAttribute("data-trigger-id"),a=void 0;a=s&&this.doc.getElementById(s)?this.doc.getElementById(s):this.$elm.querySelector(".modal-click"),this.modalWindow=this.$elm.querySelector(".modal-container"),a.addEventListener("click",function(t){return i.modalToggle(t)}),this.$elm.querySelector(".modal-content__button").addEventListener("click",function(t){return i.modalToggle(t)}),this.window.addEventListener("click",function(t){return i.windowOnClick(t)}),this.window.addEventListener("resize",function(){i.$elm.classList.contains("small-device")&&i.window.innerWidth>=480&&i.modalWindow.classList.remove("modal-content__show")}),this.$elm.classList.remove("modal-nojs")}}return o(t,[{key:"modalToggle",value:function(t){(!this.$elm.classList.contains("small-device")||this.window.innerWidth<480)&&(this.modalWindow.classList.toggle("modal-content__show"),this.modalWindow.classList.contains("modal-content__show")||this.$elm.dispatchEvent(r.eventCreator("modalWindowClose"))),t.preventDefault()}},{key:"windowOnClick",value:function(t){t.target===this.modalWindow&&this.modalToggle(t)}}]),t}()},{"../libs/elife-utils":45}],30:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e,i,o,s){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:window,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:document;n(this,t),this.window=a,this.doc=l,this.$parent=this.find$parent(e),this.$parent&&(this.$elm=r.create$pageOverlay(this.$parent,i,o),this.$elm&&this.assignZIndex(s))}return o(t,[{key:"hide",value:function(){this.$elm.classList.add("hidden")}},{key:"show",value:function(){this.$elm.style.height=this.$parent.getBoundingClientRect().height+"px",this.$elm.classList.remove("hidden")}},{key:"assignZIndex",value:function(t){isNaN(t)||(this.$elm.style?this.$elm.style.zIndex=t:this.$elm.style={zIndex:t})}},{key:"assignTop",value:function(t){isNaN(t)||(this.$elm.style?this.$elm.style.top=t+"px":this.$elm.style={top:t+"px"})}},{key:"find$parent",value:function(t){return t instanceof HTMLElement?t:this.doc.querySelector(t)}},{key:"get$elm",value:function(){return this.$elm}}]),t}()},{"../libs/elife-utils":45}],31:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.$elm=e,this.window=i,this.doc=o,this.$targetEl=this.find$targetEl(),this.$loader=this.find$Loader(),this.$loader&&this.$targetEl&&(this.isCurrentlyLoading=!1,this.timeoutThresholdInMs=1e4,this.loaderLink=this.$loader.getAttribute("href"),this.$loader.addEventListener("click",this.handleLoadRequest.bind(this))))}return o(t,[{key:"createDocFragFromString",value:function(t){if("string"==typeof t){var e=this.doc.createDocumentFragment(),i=this.doc.createElement("div");for(i.innerHTML=t;i.firstElementChild;){var n=i.firstElementChild;e.appendChild(n)}return e}}},{key:"injectNewData",value:function(e){var i=t.normaliseData(e);this.setLoaderLinkFromData(i);var n=/.*<ol[^>]*class="[^"]*(grid-listing|listing-list)[^"]*"[^>]*>(<li>?.*<\/li>)<\/ol>.*/,o=i.match(n);if(!o||!o[2])throw new SyntaxError("Loaded data doesn't match required format");this.$targetEl.appendChild(this.createDocFragFromString(o[2]))}},{key:"redirectToFullResultsPage",value:function(){var t=this.getLoaderLink();t&&(this.window.location.search=t)}},{key:"handleError",value:function(){this.redirectToFullResultsPage()}},{key:"getLoaderLink",value:function(){return this.loaderLink}},{key:"setLoaderLinkFromData",value:function(t){var e=/.*(<div[^>]*class="[^"]*pager[^"]*"[^>]*>.*<\/div>).*/,i=this.createDocFragFromString(t.match(e)[1]);if(!i)return void(this.loaderLink="#");var n=i.querySelector(".button:nth-child(2)");if(!n)return void(this.loaderLink="#");var o=n.href,r=this.window.location;this.loaderLink=o.replace(r.protocol+"//"+r.host,""),this.$loader.setAttribute("href",this.loaderLink)}},{key:"setLoadingState",value:function(){var t=this;this.isCurrentlyLoading=!0,this.$loader.classList.add("button--inactive");var e=this.$loader.querySelector(".pager__text_wrapper");e&&(e.innerHTML="Loading...",e.classList.add("loading")),this.loadingTimer=this.window.setTimeout(function(){t.redirectToFullResultsPage()},this.timeoutThresholdInMs)}},{key:"clearLoadingState",value:function(){this.window.clearTimeout(this.loadingTimer),this.isCurrentlyLoading=!1;var t=this.$loader.querySelector(".pager__text_wrapper");t&&(t.classList.remove("loading"),t.innerHTML=this.$loader.originalText?this.$loader.originalText:"Load more"),this.$loader.classList.remove("button--inactive")}},{key:"updatePager",value:function(e){t.isLastPage(e)?this.$loader.parentNode.removeChild(this.$loader):this.setLoaderLinkFromData(e)}},{key:"updateUrl",value:function(t){t&&this.window.history.pushState(null,"",t)}},{key:"handleLoad",value:function(e){var i=this.loaderLink,n=void 0;try{n=t.normaliseData(e),this.injectNewData(n)}catch(o){return void this.handleError(o)}this.clearLoadingState(),this.updateUrl(i),this.updatePager(n)}},{key:"handleLoadRequest",value:function(t){return t.preventDefault(),this.isCurrentlyLoading?null:(this.loadData(this.getLoaderLink(),this.window.XMLHttpRequest).then(this.handleLoad.bind(this),this.handleError.bind(this)),void this.setLoadingState())}},{key:"loadData",value:function(t,e){return new Promise(function(i,n){var o=new e;o.addEventListener("load",function(){i(o.responseText)}),o.addEventListener("error",n),o.open("GET",t),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.send()})}},{key:"find$Loader",value:function(){var t=this.$elm.querySelector(".button--full:first-child.button--full:last-child");if(t){t.id=r.uniqueIds.get("pager",this.doc),t.originalText=t.innerHTML;var e=this.doc.createElement("span");return e.classList.add("pager__text_wrapper"),e.innerHTML=t.originalText,t.replaceChild(e,t.firstChild),t}}},{key:"find$targetEl",value:function(){return this.doc.getElementById(this.$elm.dataset.targetid)}}],[{key:"normaliseData",value:function(t){var e=t.replace(/^\s+([^\s])/gm,"$1");return e.replace(/\n/g,"")}},{key:"isLastPage",value:function(t){return!t.match(/class="pager".*button--default.*button--default/g)}}]),t}()},{"../libs/elife-utils":45}],32:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function");
}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.$elm=e,this.window=i,this.doc=o,this.groups={},this.init())}return o(t,[{key:"init",value:function(){this.prepareButtons(),this.introduceCheckbox()}},{key:"prepareButtons",value:function(){var t=this,e=this.$elm.querySelectorAll(".list-heading");[].forEach.call(e,function(e){var i=e.innerText,n="button-collection--"+i.toLowerCase().replace(/\s+/g,"");e.classList.add("visuallyhidden"),e.nextElementSibling.classList.add(n),t.groups[n]=i})}},{key:"introduceCheckbox",value:function(){var t=this;if(2===Object.keys(this.groups).length){this.toggleButtons();var e=this.createCheckbox();e.addEventListener("change",function(e){t.toggleButtons(e.target.checked)})}}},{key:"toggleButtons",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=void 0,i=void 0;t?(e=Object.keys(this.groups)[0],i=Object.keys(this.groups)[1]):(e=Object.keys(this.groups)[1],i=Object.keys(this.groups)[0]),this.$elm.querySelector("."+e).classList.add("visuallyhidden"),this.$elm.querySelector("."+i).classList.remove("visuallyhidden")}},{key:"createCheckbox",value:function(){var t=this.groups[Object.keys(this.groups)[0]],e=this.groups[Object.keys(this.groups)[1]],i=this.doc.createElement("div");return i.setAttribute("class","form-item form-item__checkbox"),i.innerHTML='\n    <div for="letter-style" class="checkbox__label selected-model" aria-label="'+t+'">'+t+'</div>\n\n    <label class="form-item__label toggle-checkbox">\n      <input type="checkbox" id="letter-style" class="type-of-model">\n      <span class="toggle-checkbox__slider round"></span>\n    </label>\n\n    <div for="letter-style" class="checkbox__label" aria-label="'+e+'">'+e+"</div>\n    ",this.$elm.insertBefore(i,this.$elm.firstChild),i.querySelector("input")}}]),t}()},{}],33:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t);var a=void 0;e.dataset.popupWrapper?(a=r.buildElement("a"),a.classList.add("popup__wrapper"),a.href="#",e.parentNode.insertBefore(a,e),a.appendChild(e)):a=e,(e.dataset.popupSelf||a.hash&&a.host===o.location.host&&a.hash.match(/^#[a-z]/i))&&(this.$link=a,this.$elm=e,this.isOpen=!1,this.resolver=null,this.window=o,this.doc=s,this.bodyContents=null,this.thresholdWidth=730,this.$link.addEventListener("click",function(t){return i.handleLinkClick(t)}),s.addEventListener("click",function(t){return i.handleDocumentClick(t)}))}return o(t,[{key:"handleLinkClick",value:function(t){var e=this;if(!this.window.matchMedia("(min-width: "+this.thresholdWidth+"px)").matches)return void(t.currentTarget.href.match(/.*#$/)&&(t.stopPropagation(),t.preventDefault()));if(!r.closest(this.$link,"table")){if(!this.$link)return!0;t.preventDefault(),this.isOpen=!this.isOpen,this.render(t).then(function(){if(e.isEmpty){var t=e.$link;e.$link=null,t.click()}})}}},{key:"handleDocumentClick",value:function(t){if(this.window.matchMedia("(min-width: "+this.thresholdWidth+"px)").matches&&r.closest(t.target,"a")!==this.$link){var e=r.closest(t.target,".popup");e&&e===this.popupHitBox||this.isOpen&&(this.isOpen=!1,this.render(t))}}},{key:"getResolver",value:function(t){return this.resolver?this.resolver:(t.hash?this.resolver=r.remoteDoc(t.href,this.window):this.resolver=Promise.resolve(null),this.resolver)}},{key:"getBodyContentsFromNode",value:function(t){if(!t)return this.emptyResponse();if(!t.getAttribute("data-popup-contents"))return this.emptyResponse();if(t.getAttribute("data-popup-label")&&(this.label=t.getAttribute("data-popup-label")),t.getAttribute("data-popup-contents")===t.id)return t.cloneNode(!0);var e=t.getElementById(t.getAttribute("data-popup-contents"));return e?e.cloneNode(!0):this.emptyResponse()}},{key:"emptyResponse",value:function(){return this.isEmpty=!0,null}},{key:"requestContents",value:function(t){var e=this;return this.$elm.dataset.popupSelf?(this.bodyContents=this.$elm.cloneNode(!0),Promise.resolve(this.render(t))):this.getResolver(this.$link).then(function(i){return i?(e.bodyContents=e.getBodyContentsFromNode(i.querySelector(e.$link.hash)),e.render(t)):(e.emptyResponse(),Promise.resolve(e.$link))})}},{key:"createBottomBar",value:function(t,e){var i=r.buildElement("div",["popup__actions","clearfix"]),n=r.buildElement("a",["popup__button","popup__button--right"],t,i);return n.href=e,i}},{key:"createPopupBox",value:function(){for(var t=void 0,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return[].forEach.call(i,function(e){e.classList.contains("popup__content")&&(t=e)}),t instanceof HTMLElement&&!function(){var e=r.buildElement("div",["popup__content__ancillary"]),i=["reference__title","reference__authors_list","reference__authors_list_suffix","author-details__name","about-profile__name","about-profile__role"],n=[];[].forEach.call(t.children,function(t){var e=!1;[].forEach.call(t.classList,function(o){e||i.indexOf(o)!==-1||(n.push(t),e=!0)})}),n.forEach(function(t){e.appendChild(t)}),t.appendChild(e)}(),r.wrapElements(i,"div","popup__window")}},{key:"createPopupHitBox",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return r.wrapElements(e,"div","popup")}},{key:"calcInitialPosition",value:function(t,e){if(t.pageX||t.pageY)return{left:t.pageX-e/2,top:t.pageY+20};var i=t.currentTarget.getBoundingClientRect();return{left:i.left+this.window.scrollX,top:i.bottom-72+this.window.scrollY}}},{key:"setAccessibilityAttributesPopupHitBox",value:function(t){t?(this.popupHitBox.setAttribute("role","alert"),this.popupHitBox.setAttribute("aria-expanded","true"),this.popupHitBox.setAttribute("aria-hidden","false"),this.popupHitBox.blur()):(this.popupHitBox.setAttribute("aria-expanded","false"),this.popupHitBox.setAttribute("aria-hidden","true"),this.popupHitBox.style.display="none")}},{key:"setAttributesForOpenPopupHitBox",value:function(t){this.setAccessibilityAttributesPopupHitBox(!0,t)}},{key:"setAttributesForClosedPopupHitBox",value:function(){this.setAccessibilityAttributesPopupHitBox(!1)}},{key:"positionPopupHitBox",value:function(t){this.popupHitBox.style.display="";var e=this.popupHitBox.offsetWidth,i=this.popupHitBox.offsetHeight,n=this.calcInitialPosition(t,e),o=n.left,r=n.top;o<10&&(o=10),o+e+10>this.window.innerWidth&&(o=this.window.innerWidth-e-10);var s=t.pageY-i-20;r+i+10>this.window.pageYOffset+this.window.innerHeight&&s>=this.window.pageYOffset+10&&(r=s),this.$link.parentNode.insertBefore(this.popupHitBox,this.$link.nextElementSibling),this.popupHitBox.style.left=o+"px",this.popupHitBox.style.top=r+"px",this.setAttributesForOpenPopupHitBox(t)}},{key:"render",value:function(e){var i=this;if(this.isEmpty)return Promise.resolve(this.$link);if(!this.bodyContents)return this.requestContents(e);if(!this.popupHitBox){this.bodyContents.id=r.uniqueIds.get("popupFragment",this.doc),this.bodyContents.classList.add("popup__content");var n=[this.bodyContents];this.label&&n.push(this.createBottomBar(this.label,this.$link.href)),this.popupHitBox=this.createPopupHitBox(this.createPopupBox.apply(this,n)),t.setLinksClasses(this.popupHitBox),this.doc.body.appendChild(this.popupHitBox),this.window.addEventListener("resize",r.debounce(function(){i.window.matchMedia("(min-width: "+i.thresholdWidth+"px)").matches&&(i.isOpen=!1,i.render(e))},150))}return this.isOpen?(this.positionPopupHitBox(e),this.popupHitBox.addEventListener("blur",function(){i.setAttributesForClosedPopupHitBox(),i.isOpen=!1,i.$link.focus()})):(this.popupHitBox.style.display="none",this.setAttributesForClosedPopupHitBox(),this.$link.focus()),Promise.resolve(this.$link)}}],[{key:"setLinksClasses",value:function(t){t instanceof HTMLElement&&[].slice.call(t.querySelectorAll("a")).forEach(function(t){t.classList.add("popup__link")})}}]),t}()},{"../libs/elife-utils":45}],34:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t);try{this.$elm=e,this.$input=this.$elm.querySelector('input[type="search"]')}catch(r){return}this.window=i,this.doc=o,this.$container=e.querySelector("fieldset"),this.$resetButton=e.querySelector('button[type="reset"]'),this.$elm.classList.add("search-box--js"),this.$resetButton.addEventListener("click",this.reset.bind(this)),this.$input.addEventListener("keyup",this.handleInput.bind(this)),this.$input.addEventListener("paste",this.handleInput.bind(this))}return o(t,[{key:"reset",value:function(){this.hideResetButton(),this.$output&&(this.$output.innerHTML=""),this.$input.focus()}},{key:"hideResetButton",value:function(){this.$elm.classList.remove("search-box--populated")}},{key:"showResetButton",value:function(){this.$elm.classList.add("search-box--populated")}},{key:"handleInput",value:function(t){9!==t.keyCode&&(this.$input.value.length>0?this.showResetButton():this.hideResetButton())}}]),t}()},{}],35:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t);try{if(!(e instanceof HTMLElement&&e.href.length&&e.href.indexOf("#")>-1))return}catch(r){return}this.window=i,this.doc=o,this.$elm=e,this.href=this.$elm.href,this.$listing=this.doc.getElementById(this.href.substring(this.href.indexOf("#")+1)),this.$listing?this.init():this.$elm.classList.add("hidden")}return o(t,[{key:"init",value:function(){var t=this;this.$defaultListParent=this.$listing.parentNode,this.$wideViewListParent=this.$elm.parentNode,this.breakpoint=1200,this.handleWidth(),this.window.addEventListener("resize",r.debounce(function(){return t.handleWidth()},10))}},{key:"handleWidth",value:function(){this.updateView(this.$listing,this.$defaultListParent,this.$wideViewListParent,this.breakpoint)}},{key:"updateView",value:function(t,e,i,n){this.window.matchMedia("(min-width: "+n+"px)").matches?this.showWideView(t,i):this.restoreDefaultView(t,e)}},{key:"showWideView",value:function(t,e){t.parentNode!==e&&(e.appendChild(t),this.$elm.classList.add("hidden"))}},{key:"restoreDefaultView",value:function(t,e){t.parentNode!==e&&(e.appendChild(t),this.$elm.classList.remove("hidden"))}}]),t}()},{"../libs/elife-utils":45}],36:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){n(this,t),e&&(this.$elm=e,this.$elm.classList.add("select-nav--js"),this.$elm.querySelector("select").addEventListener("change",this.triggerSubmit.bind(this)))}return o(t,[{key:"triggerSubmit",value:function(){this.$elm.submit()}}]),t}()},{}],37:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e,i,o){var s=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document;n(this,t),e&&(this.window=a,this.doc=l,this.$global=e,this.$header=o,this.eachButHeader=function(t){[].forEach.call(s.$global.childNodes,function(e){e.tagName&&(r.areElementsNested(e,s.$header)||t(e))})},this.src=i)}return o(t,[{key:"open",value:function(){this.saveScrollingPosition(),this.$iframe=this.doc.querySelector(".side-by-side-view__iframe"),this.$iframe?this.$iframe.classList.remove("hidden"):(this.$iframe=t.createIframe(this.src),this.doc.body.appendChild(this.$iframe)),this.$closeBar=this.doc.querySelector(".side-by-side-view__bar"),this.$closeBar?this.$closeBar.classList.remove("hidden"):(this.$closeBar=this.createCloseBar(),this.doc.body.appendChild(this.$closeBar)),this.hideEverythingButHeader()}},{key:"close",value:function(){this.$closeBar.classList.add("hidden"),this.$iframe.classList.add("hidden"),this.showEverything(),this.restoreScrollingPosition()}},{key:"saveScrollingPosition",value:function(){this.currentYScrollPos=this.window.pageYOffset,this.window.scroll(0,0)}},{key:"restoreScrollingPosition",value:function(){this.window.scroll(0,this.currentYScrollPos),this.currentYScrollPos=null}},{key:"hideEverythingButHeader",value:function(){this.eachButHeader(function(t){t.classList.add("hidden")})}},{key:"showEverything",value:function(){this.eachButHeader(function(t){t.classList.remove("hidden")})}},{key:"createCloseBar",value:function(){var t=this,e=r.buildElement("div",["side-by-side-view__bar"]),i=r.buildElement("button",["side-by-side-view__button-close"],'<span class="side-by-side-view__button-close-cross">&#x2715;</span><span class="side-by-side-view__button-close-text">Close side by side view</span>',e);return i.addEventListener("click",function(){t.close()}),e}}],[{key:"createIframe",value:function(t){var e=r.buildElement("iframe",["side-by-side-view__iframe"]);return e.src=t,e}}]),t}()},{"../libs/elife-utils":45}],38:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("./Overlay"),s=t("../libs/elife-utils")();e.exports=function(){function e(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,e),i){this.$elm=i,this.window=o,this.doc=s;var a=t("./SearchBox"),l=i.querySelector('[data-behaviour="SearchBox"]');this.searchBox=new a(l,this.window,s);var h=i.querySelector('[rel="search"]');h&&(this.searchToggle=h.parentNode,this.searchToggle.addEventListener("click",this.toggleSearchBox.bind(this)));var c=this.doc.querySelector(".main");if(c){var d=c.firstElementChild;this.pageOverlay=new r(c,d,"mainMenuOverlay",this.window,this.doc),this.pageOverlay.assignTop(96);var u=s.getElementById("mainMenu");if(u){var p=t("./MainMenu");this.mainMenu=new p(u),this.$mainMenuToggle=this.$elm.querySelector('a[href="#mainMenu"]'),this.$mainMenuToggle&&(this.mainMenu.moveWithinDom(),this.$mainMenuToggle.addEventListener("click",this.toggleMainMenu.bind(this)))}}}}return o(e,[{key:"toggleMainMenu",value:function(t){this.mainMenu.isOpen()?(this.mainMenu.close(),this.window.removeEventListener("keyup",this.checkForMenuClose.bind(this)),this.doc.querySelector(".global-inner").removeEventListener("click",this.checkForMenuClose.bind(this))):(this.mainMenu.open(),this.window.addEventListener("keyup",this.checkForMenuClose.bind(this)),this.doc.querySelector(".global-inner").addEventListener("click",this.checkForMenuClose.bind(this))),t.preventDefault(),t.stopPropagation()}},{key:"checkForMenuClose",value:function(t){27!==t.keyCode&&"click"!==t.type||t.target.classList.contains("main-menu__list_item")||this.mainMenu.close()}},{key:"toggleSearchBox",value:function(t){t.preventDefault(),t.stopPropagation(),this.searchBoxIsOpen()?this.closeSearchBox():this.openSearchBox()}},{key:"searchBoxIsOpen",value:function(){return this.searchBox.$elm.classList.contains("search-box--shown")}},{key:"closeSearchBox",value:function(){this.searchBox.$elm.classList.remove("search-box--shown"),s.updateElementTranslate(this.searchBox.$elm,[0,"-40px"]),this.searchBox.$output&&(this.searchBox.$output.innerHTML=""),this.searchBox.$input.blur(),this.window.removeEventListener("keyup",this.checkForClose.bind(this)),this.window.removeEventListener("click",this.checkForClose.bind(this)),this.pageOverlay.hide()}},{key:"checkForClose",value:function(t){(t.keyCode&&27===t.keyCode||"click"===t.type&&!s.areElementsNested(this.searchBox.$elm,t.target))&&this.closeSearchBox()}},{key:"openSearchBox",value:function(){var t=this,e=this.window.getComputedStyle(this.$elm).height,i=20,n=s.adjustPxString(e,i,"add"),o=150;s.updateElementTranslate(this.searchBox.$elm,[0,n]),s.invertPxString(this.window.getComputedStyle(this.searchBox.$container).height),this.searchBox.$elm.classList.add("search-box--shown"),this.window.addEventListener("keyup",this.checkForClose.bind(this)),this.window.addEventListener("click",this.checkForClose.bind(this)),this.window.setTimeout(function(){t.searchBox.$input.blur(),t.searchBox.$input.focus()},o),this.pageOverlay.show()}}]),e}()},{"../libs/elife-utils":45,"./MainMenu":25,"./Overlay":30,"./SearchBox":34}],39:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),e&&(this.$elm=e,this.window=i,this.doc=o,this.placeholder="+")}return o(t,[{key:"removePlaceholder",value:function(){this.$elm.classList.remove("speech-bubble--has-placeholder");var t="\\"+this.placeholder,e=new RegExp(t,"g");this.$elm.innerHTML=this.$elm.innerHTML.replace(e,"")}},{key:"showPlaceholder",value:function(t){var e=this.$elm.querySelector(t)||this.$elm;e.innerHTML=this.placeholder,this.$elm.classList.add("speech-bubble--has-placeholder")}},{key:"update",value:function(t,e){this.removePlaceholder();var i=this.$elm.querySelector(e)||this.$elm;i.innerHTML=t}},{key:"showLoadingIndicator",value:function(){this.$elm.classList.add("speech-bubble--loading")}},{key:"removeLoadingIndicator",value:function(){this.$elm.classList.remove("speech-bubble--loading")}},{key:"showFailureState",value:function(t){t&&null!==this.$elm.parentNode?this.$elm.parentNode.remove():this.$elm.remove()}}]),t}()},{}],40:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("text-clipper"),s=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),this.window=o,this.doc=r,this.thresholdWidth=e.dataset.thresholdWidth,this.$elm=e,e instanceof HTMLElement&&(this.$caption=this.$elm.querySelector(this.$elm.getAttribute("data-selector")),this.$caption instanceof HTMLElement&&(this.setupToggle(),this.truncatedHtml&&(null!==this.thresholdWidth?(this.toggleToggle(),this.window.addEventListener("resize",s.debounce(function(){return i.toggleToggle()},150))):this.toggleCaption())))}return o(t,[{key:"setupToggle",value:function(){var t='<button class="caption-text__toggle caption-text__toggle--see-more">see more</button>',e='<button class="caption-text__toggle caption-text__toggle--see-less">see less</button>',i=[];[].forEach.call(this.$caption.childNodes,function(t){return i.push(t.outerHTML)}),i=i.filter(function(t){return t}),this.originalHtml=i.join(" "),i.push(e);var n=i;if("P"===this.$caption.firstElementChild.nodeName.toUpperCase()){var o=n[0];try{o=r(n[0],200,{html:!0,maxLines:1})}catch(s){console.log(s)}if(!(o!==n[0]||n.length>3))return;n=[o.replace(/<\/p>/," "+t+"</p>")]}else n=[t];this.fullHtml=i.join(" "),this.truncatedHtml=n.join(" ")}},{key:"toggleCaption",value:function(t){var e=this.$caption.querySelector(".caption-text__toggle");this.$caption.innerHTML="",!e||e.classList.contains("caption-text__toggle--see-less")?(this.$caption.innerHTML=this.truncatedHtml,t&&this.$caption.getBoundingClientRect().top<0&&this.$caption.scrollIntoView()):this.$caption.innerHTML=this.fullHtml,this.window.MathJax&&this.window.MathJax.Hub&&this.window.MathJax.Hub.Queue(["Typeset",this.window.MathJax.Hub,this.$caption]),this.$caption.querySelector(".caption-text__toggle").addEventListener("click",this.toggleCaption.bind(this))}},{key:"toggleToggle",value:function(){this.window.matchMedia("(min-width: "+this.thresholdWidth+"px)").matches?this.removeToggle():this.restoreToggle()}},{key:"removeToggle",value:function(){var t=this.$caption.querySelector(".caption-text__toggle");t&&(this.$caption.innerHTML=this.originalHtml)}},{key:"restoreToggle",value:function(){var t=this.$caption.querySelector(".caption-text__toggle");t||this.toggleCaption()}}]),t}()},{"../libs/elife-utils":45,"text-clipper":139}],41:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;n(this,t),this.window=i,this.isSingleton=!0,t.init(o)}return o(t,null,[{key:"init",value:function(e){if(t.loadDependencies(e),"MutationObserver"in window&&!t.dependenciesAlreadySetup(e)){var i=new MutationObserver(function(i,n){t.loadDependencies(e),t.dependenciesAlreadySetup(e)&&n.disconnect()});i.observe(e.body,{childList:!0,subtree:!0})}}},{key:"loadDependencies",value:function(e){e.querySelector('blockquote[class*="twitter-tweet"]')&&t.load(e)}},{key:"dependenciesAlreadySetup",value:function(t){return!!t.querySelector('script[src*="twitter"]')}},{key:"load",value:function(t){var e=t.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://platform.twitter.com/widgets.js",e.charset="utf-8",t.querySelector("body").appendChild(e)}}]),t}()},{}],42:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("./SideBySideView"),s=t("../libs/elife-utils")();e.exports=function(){function t(e){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;if(n(this,t),e){if(this.window=o,this.doc=a,this.$elm=e,this.$jumpLinksList=this.$elm.querySelector(".view-selector__list"),this.jumpLinks=this.$elm.querySelectorAll(".view-selector__jump_link"),this.cssFixedClassName="view-selector--fixed",this.$navDetect=this.doc.querySelector(".content-container-grid"),this.sideBySideViewAvailable()){var l=this.doc.getElementById("siteHeader");this.$global=this.doc.querySelector(".global-inner"),this.sideBySideView=new r(this.$global,this.$elm.dataset.sideBySideLink,l,this.window,this.doc),this.insertSideBySideListItem()}if(this.mainTarget=this.doc.querySelector(".main"),this.mainTarget){this.collapsibleSectionHeadings=t.getAllCollapsibleSectionHeadings(this.doc),this.isScrollingHandled=!1;var h=s.throttle(function(){i.handleScrolling()},50);this.isViewportWideEnoughForJumpMenu()&&this.startHandlingScrolling(h,this.handleScrolling),this.window.addEventListener("resize",s.throttle(function(){i.handleResize(h,i.handleScrolling)},200))}}}return o(t,[{key:"isViewportWideEnoughForJumpMenu",value:function(){return this.window.matchMedia("(min-width: 1200px)").matches}},{key:"handleResize",value:function(t,e){var i=this.isViewportWideEnoughForJumpMenu();!this.isScrollingHandled&&i?this.startHandlingScrolling(t,e):this.isScrollingHandled&&!i&&this.stopHandlingScrolling(t)}},{key:"startHandlingScrolling",value:function(t,e){this.window.addEventListener("scroll",t),this.isScrollingHandled=!0,e.call(this)}},{key:"stopHandlingScrolling",value:function(t){this.window.removeEventListener("scroll",t),this.isScrollingHandled=!1}},{key:"handleScrolling",value:function(){this.$jumpLinksList&&this.handleHighlighting(s.closest),this.handlePositioning()}},{key:"handleHighlighting",value:function(e){var i=this.findFirstInView(this.collapsibleSectionHeadings,this.doc,this.window),n=this.collapsibleSectionHeadings[0]?this.collapsibleSectionHeadings[0].innerHTML:"",o=t.findSectionForLinkHighlight(i,n,e);if(o&&"string"==typeof o.id){var r=t.findLinkToHighlight(this.$jumpLinksList,'[href="#'+o.id+'"]');r&&t.updateHighlighting(r,this.jumpLinks)}}},{key:"findFirstInView",value:function(t,e,i){var n=[].slice.call(t),o=null;return n.forEach(function(t){o||s.isTopInView(t,e,i)&&(o=t)}),o}},{key:"handlePositioning",value:function(){var t=this.$navDetect.getBoundingClientRect().bottom;if(this.$elm.classList.contains(this.cssFixedClassName)){if(t>0)return void this.$elm.classList.remove(this.cssFixedClassName);var e=this.mainTarget.getBoundingClientRect().bottom;if(e<this.$elm.offsetHeight){var i=e-this.$elm.offsetHeight;return void(this.$elm.style.top=i+"px")}return void(e>=this.window.innerHeight&&(this.$elm.style.top="0px"))}t<0&&(this.$elm.classList.add(this.cssFixedClassName),this.$elm.style.top="0px")}},{key:"sideBySideViewAvailable",value:function(){var t=this,e=this.$elm.dataset.sideBySideLink,i=function(){return!(!e||!e.match(/^https:\/\/.*$/))},n=function(){try{if(!t.window.CSS||!t.window.CSS.supports)return!1}catch(e){return!1}return t.window.CSS.supports("text-orientation","sideways")||t.window.CSS.supports("-webkit-text-orientation","sideways")};return i()&&n()}},{key:"insertSideBySideListItem",value:function(){var t=this,e=this.doc.querySelector(".view-selector__list"),i=this.doc.querySelector(".view-selector__list-item--figures + .view-selector__list-item");if(i){var n=s.buildElement("li",["view-selector__list-item","view-selector__list-item--side-by-side"],"",e,i),o=s.buildElement("a",["view-selector__link","view-selector__link--side-by-side"],"<span>Side by side</span>",n);return o.setAttribute("href",this.$elm.dataset.sideBySideLink),o.addEventListener("click",function(e){e.preventDefault(),t.sideBySideView.open()}),n}}}],[{key:"getAllCollapsibleSectionHeadings",value:function(t){return t.querySelectorAll('[data-behaviour="ArticleSection"] > .article-section__header .article-section__header_text')}},{key:"updateHighlighting",value:function(e,i){t.clearJumpLinkHighlight(i),t.highlightJumpLink(e)}},{key:"findSectionForLinkHighlight",value:function(t,e,i){if(t)return t.innerHTML===e||t.getBoundingClientRect().top<48?i.call(null,t,".article-section"):i.call(null,t,".article-section").previousElementSibling}},{key:"clearJumpLinkHighlight",value:function(t){var e=[].slice.call(t);e.forEach(function(t){t.classList.remove("view-selector__jump_link--active")})}},{key:"findLinkToHighlight",value:function(t,e){return t.querySelector(e)}},{key:"highlightJumpLink",value:function(t){t.classList.add("view-selector__jump_link--active")}}]),t}()},{"../libs/elife-utils":45,"./SideBySideView":37}],43:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(e){n(this,t),this.$elm=e,this.$prev=document.createElement("div"),this.$next=document.createElement("div"),this.build(),this.$prev.addEventListener("click",this.prev),this.$next.addEventListener("click",this.next)}return o(t,[{key:"build",value:function(){}},{key:"prev",value:function(t){t.preventDefault()}},{key:"next",value:function(t){t.preventDefault()}},{key:"close",value:function(){}}]),t}()},{}],44:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("../libs/elife-utils")();e.exports=function(){function t(e,i,o){return n(this,t),this.$toDismiss=e,this.doc=o,this.cookieName=t.deriveCookieName(this.$toDismiss),this.hasCookieName(this.cookieName)&&this.hasPreviouslyBeenDismissed(this.cookieName,this.doc.cookie)?void this.hide():(this.cookieExpiryDate=t.setCookieExpiryDate(this.$toDismiss),void(this.$button=this.buildButton(i)))}return o(t,[{key:"hasPreviouslyBeenDismissed",value:function(t,e){return"true"===r.getCookieValue(t,e)}},{key:"hasCookieName",value:function(t){return t&&t.length}},{key:"buildButton",value:function(t){var e=r.buildElement("button",["dismiss-button"],"",t);return e.setAttribute("aria-label","Dismiss this"),e.addEventListener("click",this.dismiss.bind(this)),e}},{key:"setCookie",value:function(){this.cookieName&&this.cookieName.length&&(this.doc.cookie=this.cookieName+"=true; expires="+this.cookieExpiryDate+"; path=/;")}},{key:"hide",value:function(){this.$toDismiss.classList.add("hidden")}},{key:"dismiss",value:function(){this.hide(),this.setCookie()}}],[{key:"setCookieExpiryDate",value:function(t){if(t.dataset.cookieExpires)return t.dataset.cookieExpires}},{key:"deriveCookieName",value:function(t){var e=t.dataset.cookieNameRoot;return t.id&&t.id.length&&e&&e.length?""+e+t.id:""}}]),t}()},{"../libs/elife-utils":45}],45:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){
return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.exports=function(){function t(t,e,i,n,o){var r=document.createElement(t),s="string"==typeof n?document.querySelector(n):n,a=function(){if(o){if("boolean"==typeof o)return s.firstElementChild instanceof HTMLElement?s.firstElementChild:null;if("string"==typeof o)return s.querySelector(o);if(o instanceof HTMLElement)return o}}();if(Array.isArray(e)&&e.forEach(function(t){r.classList.add(t)}),i&&(r.innerHTML=i),s)if(a){if(a.parentNode!==s)throw new ReferenceError("Trying to attach an element with respect to an element sibling, but the two elements do not share a common parent.");s.insertBefore(r,a)}else s.appendChild(r);return r}function e(t){return new Promise(function(e,i){var n=new XMLHttpRequest;n.addEventListener("load",function(){e(n.responseText)}),n.addEventListener("error",i),n.open("GET",t),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send()})}function i(t,e){function i(t){return t?"number"==typeof t?t+"px":"string"==typeof t?(t+="px",t.replace(/((px)+)$/,"px")):void 0:"0px"}if(!(t instanceof HTMLElement&&Array.isArray(e)))return!1;var n=i(e[0]),o=i(e[1]),r=["webkitTransform","mozTransform","msTransform","oTransform","transform"];r.forEach(function(e){void 0!==t.style[e]&&(t.style[e]="translate("+n+", "+o+")")})}function a(t){if("0"===t)return 0;var e=parseFloat(t);if(isNaN(e))throw new Error("Can't parse argument as a float: "+t);return Math.round(e)}function l(t){return 0===t?""+t:t+"px"}function h(t,e,i){var n=a(t),o=n,r="add";switch(["subtract","multiply","divide"].indexOf(i)>-1&&(r=i),r){case"add":o=n+e;break;case"subtract":o=n-e;break;case"multiply":o=n*e;break;case"divide":o=n/e}return l(o)}function c(t){var e=a(t)*-1;return l(e)}function d(t,e){if(!(t instanceof Node&&e instanceof Node))return!1;var i=t.compareDocumentPosition(e);return!!(i&t.DOCUMENT_POSITION_CONTAINED_BY||0===i)}function u(t,e,i){if(0===t.search(/https?:\/\//))return!1;if(t===e.id)return!0;var n=i.getElementById(t);return d(e,n)}function p(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=null,o=null,r=function(){return t.apply(i,o)};return function(){o=arguments,clearTimeout(n),n=setTimeout(r,e)}}function f(t,e){var i=(t.document||t.ownerDocument).querySelectorAll(e),n=void 0;do for(n=i.length;--n>=0&&i.item(n)!==t;);while(n<0&&(t=t.parentElement));return t}function g(t){if(t instanceof HTMLElement){for(var e=1,i=t.previousElementSibling;i;)e+=1,i=i.previousElementSibling;return e}throw new TypeError("Expected HTMLElement")}function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(i,n){var o=document.createElement("script");o.src=t,e&&(o.integrity=e,o.crossOrigin="anonymous"),o.addEventListener("load",function(){i(o)},!1),o.addEventListener("error",function(){n(o)},!1),document.body.appendChild(o)})}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(i,n){var o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.href=t,e&&(o.integrity=e,o.crossOrigin="anonymous"),o.addEventListener("load",function(){i(o)},!1),o.addEventListener("error",function(){n(o)},!1),document.head.appendChild(o)})}function y(){var t={};return t.promise=new Promise(function(e,i){t.resolve=function(t){e(t)},t.reject=function(t){i(t)}}),t}function(){}