(()=>{window.addEventListener('load',async()=>{if(document.querySelector('.signin-modal')){document.querySelector('.signin-modal').addEventListener('click',(evt)=>{if(evt.target.classList.contains('signin-modal')){evt.target.classList.add('hidden');if(evt.target.classList.contains('reload-on-close')){window.location.reload();}
evt.preventDefault();}});}});async function openSignInModal(returnTo){if(returnTo&&returnTo.startsWith('/')){document.querySelector('.signin-modal').dataset.returnTo=returnTo;document.querySelector('.signup-modal').dataset.returnTo=returnTo;}else{document.querySelector('.signin-modal').dataset.returnTo='';document.querySelector('.signup-modal').dataset.returnTo='';}
document.querySelector('.signin-modal').classList.remove('hidden');document.querySelectorAll('.signin-modal .step').forEach((el)=>(el.classList.add('hidden')));document.querySelector('.signin-modal .step-signin').classList.remove('hidden');}
async function closeSignInModal(returnTo){document.querySelector('.signin-modal').classList.add('hidden');if(returnTo){window.location=returnTo;}else{window.location.reload();}}
window.addEventListener('signin-modal:open',(e)=>{if(document.querySelector('.signup-modal')){document.querySelector('.signup-modal').classList.add('hidden');}
const returnTo=e.detail.returnTo||'';openSignInModal(returnTo);});const linkSignInModals=document.querySelectorAll('.link-open-signin-modal');if(linkSignInModals){linkSignInModals.forEach((linkSignInModal)=>{linkSignInModal.addEventListener('click',async(e)=>{if(document.querySelector('.signup-modal')){document.querySelector('.signup-modal').classList.add('hidden');}
const returnTo=e.currentTarget&&e.currentTarget.dataset&&e.currentTarget.dataset.href?e.currentTarget.dataset.href:'';openSignInModal(returnTo);if(e.target.classList&&e.target.classList.contains('link-signin-text')){if(typeof ga==='function'){console.log('ga send...');ga('send','event',['Links'],['Clicked Login Button'],['Logged In'],['Yes']);}else{console.log('ga undefined...');}}
e.preventDefault();});});}
const linkCloseSignInModal=document.querySelector('.link-close-signin-modal');if(linkCloseSignInModal){linkCloseSignInModal.addEventListener('click',(e)=>{closeSignInModal();e.preventDefault();});}
async function openAuthenticationWindow(url){window.open(url,'LogIn','width=600,height=400,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0');}
const signinTwitterLink=document.querySelector('.signin-twitter-link');if(signinTwitterLink){signinTwitterLink.addEventListener('click',async(e)=>{const{returnTo}=document.querySelector('.signin-modal').dataset;openAuthenticationWindow(`/auth/twitter?returnTo=${returnTo}`);e.preventDefault();});}
const signinFacebookLink=document.querySelector('.signin-facebook-link');if(signinFacebookLink){const{returnTo}=document.querySelector('.signin-modal').dataset;signinFacebookLink.addEventListener('click',async(e)=>{openAuthenticationWindow(`/auth/facebook?returnTo=${returnTo}`);e.preventDefault();});}
const signinGoogleLink=document.querySelector('.signin-google-link');if(signinGoogleLink){const{returnTo}=document.querySelector('.signin-modal').dataset;signinGoogleLink.addEventListener('click',async(e)=>{openAuthenticationWindow(`/auth/google?returnTo=${returnTo}`);e.preventDefault();});}
window.addEventListener('message',async(e)=>{if(!e.data.event||document.querySelector('.signin-modal').classList.contains('hidden')){return;}
if(e.data.user){if(document.querySelector('.nav-top-right .link-signin-text')){document.querySelector('.nav-top-right .link-signin-text').remove();const navTopRight=document.querySelector('.nav-top-right');const accountSpan=document.createElement('span');accountSpan.setAttribute('class','account inline-block ml-4 align-middle cursor-pointer');if(e.data.user.images&&e.data.user.images.profile){const profileImage=document.createElement('img');profileImage.setAttribute('height','22');profileImage.setAttribute('width','22');profileImage.setAttribute('src',e.data.user.images.profile);profileImage.setAttribute('class','profile-image inline-block rounded-full');accountSpan.appendChild(profileImage);}else{accountSpan.innerHTML=`<svg class="rounded-full inline-block " viewBox="0 0 24 24" width="22" height="22" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
            <g data-name="User Circle" id="User_Circle">
              <circle cx="12" cy="9.5" r="5.5" style="fill:#aaa" />
              <path d="M21.39,19.45A12,12,0,1,0,0,12a11.93,11.93,0,0,0,2.61,7.44l0,0a12,12,0,0,0,18.73,0ZM12,2a10,10,0,0,1,8,16,18.83,18.83,0,0,0-8-2,18.83,18.83,0,0,0-8,2A10,10,0,0,1,12,2Z" style="fill:#aaa" />
            </g>
          </svg>`;}
navTopRight.appendChild(accountSpan);}
if(e.data.user.onboarding&&e.data.user.onboarding.is_new){await fetch('/user/api/onboarding/initiate',{method:'POST',headers:{'Content-Type':'application/json; charset=utf-8',},body:JSON.stringify({userId:e.data.user.userid,}),});closeSignInModal(e.data.returnTo);}else{closeSignInModal(e.data.returnTo);}}else{closeSignInModal();}
e.preventDefault();});const completedLinkClose=document.querySelector('.signin-modal .completed-link-close');if(completedLinkClose){completedLinkClose.addEventListener('click',