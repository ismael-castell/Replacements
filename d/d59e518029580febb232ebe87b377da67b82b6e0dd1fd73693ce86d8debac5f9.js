!function(ne,k){var h,I={},e=function(){};"undefined"==typeof console&&(console={log:e,debug:e,error:e,info:e}),I.addEvent=function(e,t,n){return e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},I.removeEvent=function(e,t,n){return e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},I.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},I.onReady=function(e,t){e.document&&"complete"===e.document.readyState?t():e.document&&e.document.addEventListener?e.document.addEventListener("DOMContentLoaded",t,!1):e.attachEvent?e.attachEvent("onload",t):ne.onload=t},I.unescapeHtml=function(e){var t=document.createElement("div");if(t.innerHTML=e,0===t.childNodes.length)return"";var n=t.childNodes[0]?t.childNodes[0].nodeValue:"";return n+=t.childNodes[1]?t.childNodes[1].outerHTML:"",n+=t.childNodes[2]?t.childNodes[2].outerHTML:""},I.insertAfter=function(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)},I.insertBefore=function(e,t){e.parentNode&&e.parentNode.insertBefore(t,e)},I.moveChildren=function(e,t){if(e!==t)for(;e.hasChildNodes();)t.appendChild(e.firstChild)},I.documentFragmentInnerHtml=function(e,t){var n=document.createElement("div");n.innerHTML=t,I.moveChildren(n,e)},I.isDocumentFragment=function(e){return e.nodeType===Node.DOCUMENT_FRAGMENT_NODE},I.containerInnerHtml=function(e,t){I.isDocumentFragment(e)?I.documentFragmentInnerHtml(e,t):e.innerHTML=t},I.executeScriptsForScriptTags=function(e){if(e.length){var n=/^$|\/(?:java|ecma)script/i,r=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;I.each(e,function(e){h.log("_:executeScript",e);var t=e.ownerDocument;n.test(e.type||"")&&(e.src?I.globalEvalScript(e.src,t):I.globalEvalCode(e.textContent.replace(r,""),t))})}},I.executeScripts=function(e){I.executeScriptsForScriptTags(e.querySelectorAll("script"))},I.executeScriptsForNodes=function(e){I.executeScriptsForScriptTags(I.getElementsByTagNameIncludesItself(e,"script"))},I.replaceChildren=function(e,t){I.isElement(t)||I.isDocumentFragment(t)?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},I.getNodesArray=function(e){var t=[];return e.hasChildNodes()&&I.each(e.childNodes,function(e){t.push(e)}),t},I.getElementsByTagNameIncludesItself=function(e,n){n=n.toLowerCase(),Array.isArray(e)||(e=[e]);var r=[];return I.each(e,function(e){if(e&&e.tagName){e.tagName.toLowerCase()===n&&r.push(e);var t=e.getElementsByTagName(n);t.length&&I.each(t,function(e){r.push(e)})}}),r},I.globalEvalCode=function(e,t){var n=(t=t||document).createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)},I.globalEvalScript=function(e,t){var n=(t=t||document).createElement("script");n.src=e,t.head.appendChild(n)},I.inArray=function(e,t,n){var r="";if(!!n){for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return!0}else for(r in t)if(t.hasOwnProperty(r)&&t[r]==e)return!0;return!1},I.isDocumentVisible=function(){}();var c={objects:[],_timerObject:function(e){this.label=e,this.time=(new Date).getTime(),this.getLabel=function(){return this.label},this.getElapsedTime=function(){return(new Date).getTime()-this.time},this.getElapsedTimeString=function(){return this.getElapsedTime()+" ms"},this.getTime=function(){return this.time},this.log=function(){c.log(this)}},create:function(e){var t=new this._timerObject(e);return this.objects[e]=t},get:function(e){return void 0!==e&&e||(e="__main__"),void 0===this.objects[e]&&(this.objects[e]=new this._timerObject(e)),this.objects[e]},log:function(e){h.log('Timer "'+e.getLabel()+'" took '+e.getElapsedTimeString())}},p={_promiseHandlers:{},_persistentPromiseHandlers:{},_emptyElement:document.createDocumentFragment(),encodeString:function(e,t){return"function"==typeof encodeURIComponent?t?encodeURI(e):encodeURIComponent(e):escape(e)},prepareTimeForDate:function(e,t){t=t?new Date(t.getTime()):new Date;var n=e.split(":");return t.setHours(n[0]),t.setMinutes(n[1]),t.setSeconds(n[2]),t},DOMTokenListSupports:function(e,t){if(e&&e.supports)try{return e.supports(t)}catch(e){h.log("The DOMTokenList doesn't have a supported tokens list")}},addStyles:function(n){return new re(function(e,t){if(h.log("Utils:addStyles"),!n)return e(null);Array.isArray(n)||(n=[n]);var r=p.DOMTokenListSupports(document.createElement("link").relList,"preload");I.each(n,function(e){if(r){var t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)}var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(n)}),e(n)})},uniquePromiseHandler:function(t,n){if(p._promiseHandlers[t])return p._promiseHandlers[t];var e=new re(n);return(p._promiseHandlers[t]=e).then(function(){h.log("Utils:uniquePromiseHandler then",t,n),delete p._promiseHandlers[t]}).catch(function(e){h.log("Utils:uniquePromiseHandler catch",t,n,e),delete p._promiseHandlers[t]}),e},persistentPromiseHandler:function(e,t){return p._persistentPromiseHandlers[e]||(p._persistentPromiseHandlers[e]=new re(t)),p._persistentPromiseHandlers[e]},addClass:function(e,t){p.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){p.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("\\b"+t+"\\b","g"),""))},hasClass:function(e,t){return!!e.className.match(new RegExp("\\b"+t+"\\b","g"))},attachHandlerForElements:function(e,n,r,i){h.log("Utils:attachHandlerForElements",e.length,e),0<e.length&&I.each(e,function(t,e){p.addEvent(t,n,function(e){h.log("Utils:attachHandlerForElements on event ",n,e,this,t),!1!==i&&I.preventDefault(e),r(e)})})},attachHandlerByClassName:function(e,t,n,r,i){var o=e.getElementsByClassName(t);p.attachHandlerForElements(o,n,r,i)},attachHandlerByQuerySelectorAll:function(e,t,n,r,i){var o=e.querySelectorAll(t);p.attachHandlerForElements(o,n,r,i)},timer:c,hashString:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t},getBoundingClientRect:function(e){if(e.getBoundingClientRect)return e.getBoundingClientRect();if(document.createRange&&e.nodeType===Node.TEXT_NODE){var t=document.createRange();if(t.selectNodeContents(e),t.getBoundingClientRect)return t.getBoundingClientRect()}return null},isVisibleOnScreen:function(e){var t=p.getWindowHeight();return p.isVisibleOnScreenForViewHeight(e,t)},isVisibleOnScreenForViewHeight:function(e,t){var n=p.getBoundingClientRect(e);return!(!n||0===n.top&&0===n.left&&0===n.width&&0===n.height||n.left<0&&n.right<0)&&!(n.bottom<0||0<=n.top-t)},isVisibleAtLeastOneElementOnScreen:function(e){if(!e)return!1;Array.isArray(e)||(e=[e]);var t=p.getWindowHeight();for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];if(r&&p.isVisibleOnScreenForViewHeight(r,t))return h.info("Utils:isVisibleAtLeastOneElementOnScreen element is visible on screen",r),!0}return!1},getWindowHeight:function(){return Math.max(ne.innerHeight,document.documentElement.clientHeight,0)},getWindowYScroll:function(){return ne.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0},getDocumentHeight:function(){return Math.max(document.body.scrollHeight||0,document.documentElement.scrollHeight||0,document.body.offsetHeight||0,document.documentElement.offsetHeight||0,document.body.clientHeight||0,document.documentElement.clientHeight||0)},getScrollPercentage:function(){return(p.getWindowYScroll()+p.getWindowHeight())/p.getDocumentHeight()*100},debounce:function(r,i,o){var s;return function(){var e=this,t=arguments,n=o&&!s;clearTimeout(s),s=setTimeout(function(){s=null,o||r.apply(e,t)},i),n&&r.apply(e,t)}},escapeHTML:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},generateUUID:function(){var n=(new Date).getTime();return ne.performance&&"function"==typeof ne.performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=function(e){var t=ne.crypto||ne.msCrypto;if(t&&"function"==typeof t.getRandomValues){var n=new Uint32Array(1);return t.getRandomValues(n),(e+n[0])%16|0}return(e+16*Math.random())%16|0}(n);return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},validateUUID:function(e){return RegExp(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i).test(e)},validateSelector:function(e){try{p._emptyElement.querySelector(e)}catch(e){return!1}return!0},addEvent:function(t,e,n){return"click"===e?I.addEvent(t,e,function(e){return f.handleClick(t),n(e)}):I.addEvent(t,e,n)},removeEvent:function(e,t,n){return I.removeEvent(e,t,n)},uint8ArrayToBase64Url:function(e,t,n){return t=t||0,n=n||e.byteLength,ne.btoa(String.fromCharCode.apply(null,e.subarray(t,n))).replace(/\=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},atou:function(e){return decodeURIComponent(escape(ne.atob(e)))},utoa:function(e){return ne.btoa(unescape(encodeURIComponent(e)))}},f={_enabled:!1,_events:[],_startTime:null,_groupUuid:null,_intervalId:null,_delayTimeoutId:null,_maxEventCount:25,_logingConditions:[],LEVEL:{fatal:"fatal",error:"error",info:"info",debug:"debug"},TYPE:{general:"general",request:"request",log:"log",click:"click",lost:"lost"},SCOPE:{inner:"inner",outer:"outer"},init:function(e){e=e||{},f._startTime=e.startTime?e.startTime:(new Date).getTime(),f._groupUuid=p.generateUUID(),f._attachWindowErrorListener(),f._logingConditions=[{level:f.LEVEL.fatal,scope:f.SCOPE.inner},{level:f.LEVEL.error,type:f.TYPE.request,scope:f.SCOPE.inner}],a.init()},setEnabled:function(e){f._enabled=e},callFunctionAndLogError:function(e,t,n){var r,i;for(var o in e.apply(this,t),t)if(t[o]instanceof Error){r=t[o];break}if("string"==typeof t[0]&&(i=t[0]),r){var s=f._prepareEventFromError(r,f.TYPE.general,n);i&&(s.msg=i+" "+s.msg),f.handleEvent(s)}else f.handleError(new Error(i||"Unknown error dump message"),f.TYPE.general,n)},handleError:function(e,t,n,r){f.handleEvent(f._prepareEventFromError(e,t,n,r))},handleClick:function(e){f.handleEvent(f._prepareEventFromElement(e,f.TYPE.click,f.LEVEL.info,f.SCOPE.inner))},handleEvent:function(e){f._checkAndRichEvent(e),f._pushEvent(e)},handleFetch:function(t,e){var n,r=(new Date).getTime();return e.then(function(e){return n=200===e.status||201===e.status||0===e.status?I.extend(f._prepareEventDataFromRequest(t),{level:f.LEVEL.info,type:f.TYPE.request,msg:"Fetch request succeeded",statusCode:e.status}):I.extend(f._prepareEventDataFromRequest(t),{level:f.LEVEL.error,type:f.TYPE.request,name:"Fetch request fail",msg:e.statusText,stack:(new Error).stack,statusCode:e.status}),e}).catch(function(e){return n=I.extend(f._prepareEventDataFromRequest(t),f._prepareEventFromError(e,f.TYPE.request)),re.reject(e)}).finally(function(){n.requestDuration=(new Date).getTime()-r,f.handleEvent(n)})},sendEvents:function(){f._sendEventsToSender(),f._attachDelayAndSendFewEventsAfterTriggered()},_sendEventsToSender:function(){var e=[].concat(f._events);f._enabled&&a.sendEvents(e),f._events=[]},_attachDelayAndSendFewEventsAfterTriggered:function(){f._delayTimeoutId&&(clearTimeout(f._delayTimeoutId),f._delayTimeoutId=null),f._delayTimeoutId=setTimeout(function(){f._sendEventsToSender()},15)},_prepareEventFromElement:function(e,t,n,r){var i=e.nodeName?e.nodeName:null,o=e.className?e.className:null;return{level:n||f.LEVEL.error,type:t||f.TYPE.general,scope:r||f.SCOPE.inner,name:"NodeEvent",msg:'Action on "'+(i||"unknown")+'" node with class name "'+(o||"")+'"',nodeName:"string"==typeof i?i.toLowerCase():null,className:o}},_prepareEventFromError:function(e,t,n,r){var i=e.stack,o=e.toString();return{level:n||f.LEVEL.error,type:t||f.TYPE.general,scope:r||f.SCOPE.inner,name:e.name,msg:o,stack:i}},_prepareEventDataFromRequest:function(e){return{method:e.method,url:e.url,bodyUsed:e.bodyUsed,cache:e.cache,keepalive:e.keepalive}},_pushEvent:function(e){f._applyEventsLimit(),f._events.push(e),f._checkConditionsAndSend(e)},_checkConditionsAndSend:function(e){f._checkConditions(e)&&f.sendEvents()},_checkConditions:function(e){if(e.level===f.LEVEL.error&&e.type===f.TYPE.request&&-1!==(e.url||"").indexOf("web-push/get-public-config"))return!1;for(var t in f._logingConditions)if(f._logingConditions.hasOwnProperty(t)){var n=f._logingConditions[t];if(f._checkCondition(e,n))return!0}return!1},_checkCondition:function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0},_applyEventsLimit:function(){if(f._events.length>=f._maxEventCount){var e=f._events.shift();if(e.type===f.TYPE.lost)f._events.shift(),e.lostCount++,f._events.unshift(e);else{var t=f._checkAndRichEvent({level:f.LEVEL.info,type:f.TYPE.lost,name:"LostEventsLimitAchieved",msg:"First lost event message: "+e.msg,lostCount:1});f._events.splice(0,1,t)}}},_attachWindowErrorListener:function(){p.addEvent(ne,"error",function(e){e.error&&f.handleError(e.error,f.TYPE.general,f.LEVEL.error,f.SCOPE.outer)})},_checkAndRichEvent:function(e){if(!e||!e.level||!e.type)throw new Error("Invalid event to handle by error handler");if(!e.clientUuid){var t=m.getClientFromStore();t&&(e.clientUuid=t.uuid,e.clientPermUuid=t.permUuid)}if(void 0===e.scrollPercentage&&(e.scrollPercentage=p.getScrollPercentage()),!e.time){var n=(new Date).getTime();e.startTime=f._startTime,e.time=n,e.elapsedTime=n-f._startTime}return e.groupUuid||(e.groupUuid=f._groupUuid),e.eventUuid||(e.eventUuid=p.generateUUID()),e.scope||(e.scope=f.SCOPE.inner),e.href||(e.href=ne.location.href),e.source="sdk-js",e.sdkVersion=g.getVersion(),e.sdkModule=g.getModuleName(),e.sdkBuildTime=g.getBuildTime(),e}},a={_logsToSend:[],_eventLost:null,_intervalId:null,_intervalMs:2e3,_timeout:4e3,_localStorageLogsKey:"_snrs_error_logs",_maxLogsCount:100,LEVEL:{fatal:"fatal",error:"error",info:"info",debug:"debug"},TYPE:{general:"general",request:"request",log:"log",click:"click",lost:"lost"},init:function(e){e=e||{},n.init(),a._restoreLogs(),a._attachHandlers(),a._startLogging()},sendEvents:function(e){var t=a._applyLogsLimit(e);a._logsToSend=a._logsToSend.concat(t)},_attachHandlers:function(){ne.onbeforeunload=function(){a._storeLogs()},a._attachLoggingOnMouseExit()},_attachLoggingOnMouseExit:function(){p.addEvent(document,"mouseout",function(e){e.clientY<=0&&setTimeout(function(){a.flush()},10)})},_applyLogsLimit:function(e){var t=e;if(e.length>a._maxLogsCount){t=e.slice(e.length-a._maxLogsCount+1);var n=e.slice(0,e.length-a._maxLogsCount+1),r=a._logsToSend[0]||n[0],i=f._checkAndRichEvent({level:f.LEVEL.info,type:f.TYPE.lost,name:"LostLogsToSendLimitAchieved",msg:"First lost event message: "+r.msg,lostCount:n.length+a._logsToSend.length});a._logsToSend=[i]}else if(a._logsToSend.length+e.length>a._maxLogsCount){var o=a._logsToSend[0];if(o.type===f.TYPE.lost&&"LostLogsToSendLimitAchieved"===o.name){t=e.slice(e.length-a._maxLogsCount+1);var s=a._logsToSend.length+t.length-a._maxLogsCount;a._logsToSend=a._logsToSend.slice(s+1),a._logsToSend.unshift(o),o.lostCount+=s}else{i=f._checkAndRichEvent({level:f.LEVEL.info,type:f.TYPE.lost,name:"LostLogsToSendLimitAchieved",msg:"First lost event message: "+o.msg,lostCount:s}),s=a._logsToSend.length+e.length-a._maxLogsCount;a._logsToSend=a._logsToSend.slice(s+1),a._logsToSend.unshift(i)}}return t},flush:function(){a._logsToSend.length&&d.checkAuth()&&a._requestLogs(function(){})},_requestLogs:function(e){var t=[].concat(a._logsToSend);a._logsToSend=[],a._requestWithLimits(t,e)},_request:function(e,t){var n=U.trackingDomain+U.trackerLogsUrl,r=new XMLHttpRequest;r.open("POST",n,!0),r.withCredentials=!0,r.timeout=a._timeout,r.setRequestHeader(d.getHeaderAuth("key"),d.getHeaderAuth("value")),r.setRequestHeader("Content-type","application/json"),r.ontimeout=function(e){},r.onabort=function(e){},r.onerror=function(e){},r.onreadystatechange=function(){4===r.readyState&&t(r)},r.send(JSON.stringify(e))},_requestWithLimits:function(e,t){n.request(function(){a._request(e,function(e){t(e)})})},_startLogging:function(){a._intervalId=setInterval(function(){a.flush()},a._intervalMs)},_setToLocalStore:function(e){q.setString(a._localStorageLogsKey,JSON.stringify(e))},_getFromLocalStore:function(){var e=q.getString(a._localStorageLogsKey);return e?JSON.parse(e):null},_getAndRemoveFromLocalStore:function(){var e=q.getString(a._localStorageLogsKey);return e?(q.remove(a._localStorageLogsKey),JSON.parse(e)):null},_storeLogs:function(){var e=[].concat(a._logsToSend);if(a._logsToSend=[],e.length){var t=a._getFromLocalStore();t&&t.length,a._setToLocalStore(e)}},_restoreLogs:function(){var e=a._getAndRemoveFromLocalStore();e&&e.length&&a.sendEvents(e)}},n={_locked:!1,_lockedTimeEnd:null,_count:0,_countAll:0,_maxCount:10,_maxCountAll:100,_timeMs:1e4,_localStorageLimitAchievedKey:"_snrs_logs_limit_achieved",_lockForTimeMs:18e4,init:function(e){e=e||{},n._startThrottling()},request:function(e){n._checkAndLock()||(n._count++,n._countAll++,e())},_startThrottling:function(){var e=n._checkAndRemoveLockTimeFromStoreIfExpired();e&&n._lock(e),setInterval(function(){n._count=0},n._timeMs)},_checkAndLock:function(){return!!n._locked||(n._count>n._maxCount||n._countAll>n._maxCountAll)&&(n._lockAndStore(),!0)},_lock:function(e){e=e||(new Date).getTime()+n._lockForTimeMs,n._locked=!0,n._lockedTimeEnd=e,n._setUnlockTimer(n._lockedTimeEnd)},_lockAndStore:function(){n._lock(),n._setTimeToLocalStore(n._lockedTimeEnd)},_unlockAndStore:function(){n._locked=!1,n._lockedTimeEnd=null,n._count=0,n._countAll=0,n._checkAndRemoveLockTimeFromStoreIfExpired()},_checkAndRemoveLockTimeFromStoreIfExpired:function(){var e=n._getTimeFromLocalStore();return e&&e-(new Date).getTime()<=0?(q.remove(q._localStorageLimitAchievedKey),null):e},_setUnlockTimer:function(e){var t=e-(new Date).getTime();0<t?setTimeout(function(){n._unlockAndStore()},t):setTimeout(function(){n._unlockAndStore()},10)},_setTimeToLocalStore:function(e){q.setString(q._localStorageLimitAchievedKey,e+"")},_getTimeFromLocalStore:function(){var e=q.getString(q._localStorageLimitAchievedKey);if(e){var t=parseInt(e,10);return isNaN(t)?null:t}return null}},t=p.timer.get(),r={};(function(){var e,t,n,r,i,o,s,a,c,u,l,d,O=k,A=k,h=k;e=this,t=function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){var t=S.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function t(e){return null==e.passiveListener?void(!e.event.cancelable||(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault())):void("undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener))}function u(e,t){S.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var n,r=Object.keys(t),i=0;i<r.length;++i)(n=r[i])in this||Object.defineProperty(this,n,d(n))}function d(t){return{get:function(){return l(this).event[t]},set:function(e){l(this).event[t]=e},configurable:!0,enumerable:!0}}function h(t){return{value:function(){var e=l(this).event;return e[t].apply(e,arguments)},configurable:!0,enumerable:!0}}function f(e){if(null==e||e===Object.prototype)return u;var t=C.get(e);return null==t&&(t=function(n,e){function t(e,t){n.call(this,e,t)}var r=Object.keys(e);if(0===r.length)return n;t.prototype=Object.create(n.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var i,o=0;o<r.length;++o)if(!((i=r[o])in n.prototype)){var s="function"==typeof Object.getOwnPropertyDescriptor(e,i).value;Object.defineProperty(t.prototype,i,s?h(i):d(i))}return t}(f(Object.getPrototypeOf(e)),e),C.set(e,t)),t}function g(e,t){l(e).passiveListener=t}function p(e){return null!==e&&"object"===n(e)}function m(e){var t=E.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function b(e,t){var o;Object.defineProperty(e,"on".concat(t),(o=t,{get:function(){for(var e=m(this).get(o);null!=e;){if(3===e.listenerType)return e.listener;e=e.next}return null},set:function(e){"function"==typeof e||p(e)||(e=null);for(var t=m(this),n=null,r=t.get(o);null!=r;)3===r.listenerType?null===n?null===r.next?t.delete(o):t.set(o,r.next):n.next=r.next:n=r,r=r.next;if(null!==e){var i={listener:e,listenerType:3,passive:!1,once:!1,next:null};null===n?t.set(o,i):n.next=i}},configurable:!0,enumerable:!0}))}function v(e){function t(){y.call(this)}t.prototype=Object.create(y.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var n=0;n<e.length;++n)b(t.prototype,e[n]);return t}function y(){if(!(this instanceof y)){if(1===arguments.length&&Array.isArray(arguments[0]))return v(arguments[0]);if(0<arguments.length){for(var e=Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return v(e)}throw new TypeError("Cannot call a class as a function")}E.set(this,new Map)}function _(e){var t=k.get(e);if(null==t)throw new TypeError("Expected 'this' to be an 'AbortController' object, but got ".concat(null===e?"null":n(e)));return t}var S=new WeakMap,C=new WeakMap;u.prototype={get type(){return l(this).event.type},get target(){return l(this).eventTarget},get currentTarget(){return l(this).currentTarget},composedPath:function(){var e=l(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return l(this).eventPhase},stopPropagation:function(){var e=l(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=l(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return!!l(this).event.bubbles},get cancelable(){return!!l(this).event.cancelable},preventDefault:function(){t(l(this))},get defaultPrevented(){return l(this).canceled},get composed(){return!!l(this).event.composed},get timeStamp(){return l(this).timeStamp},get srcElement(){return l(this).eventTarget},get cancelBubble(){return l(this).stopped},set cancelBubble(e){if(e){var t=l(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!l(this).canceled},set returnValue(e){e||t(l(this))},initEvent:function(){}},Object.defineProperty(u.prototype,"constructor",{value:u,configurable:!0,writable:!0}),void 0!==ne&&void 0!==ne.Event&&(Object.setPrototypeOf(u.prototype,ne.Event.prototype),C.set(ne.Event.prototype,u));var E=new WeakMap;y.prototype={addEventListener:function(e,t,n){if(null!=t){if("function"!=typeof t&&!p(t))throw new TypeError("'listener' should be a function or an object.");var r=m(this),i=p(n),o=(i?n.capture:n)?1:2,s={listener:t,listenerType:o,passive:i&&!!n.passive,once:i&&!!n.once,next:null},a=r.get(e);if(void 0===a)return void r.set(e,s);for(var c=null;null!=a;){if(a.listener===t&&a.listenerType===o)return;a=(c=a).next}c.next=s}},removeEventListener:function(e,t,n){if(null!=t)for(var r=m(this),i=(p(n)?n.capture:n)?1:2,o=null,s=r.get(e);null!=s;){if(s.listener===t&&s.listenerType===i)return void(null===o?null===s.next?r.delete(e):r.set(e,s.next):o.next=s.next);s=(o=s).next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t,n,r,i,o=m(this),s=e.type,a=o.get(s);if(null==a)return!0;for(var c=(t=this,n=e,new(f(Object.getPrototypeOf(n)))(t,n)),u=null;null!=a;){if(a.once?null===u?null===a.next?o.delete(s):o.set(s,a.next):u.next=a.next:u=a,g(c,a.passive?a.listener:null),"function"==typeof a.listener)try{a.listener.call(this,c)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==a.listenerType&&"function"==typeof a.listener.handleEvent&&a.listener.handleEvent(c);if(l(c).immediateStopped)break;a=a.next}return g(c,null),i=0,l(c).eventPhase=i,r=null,l(c).currentTarget=r,!c.defaultPrevented}},Object.defineProperty(y.prototype,"constructor",{value:y,configurable:!0,writable:!0}),void 0!==ne&&void 0!==ne.EventTarget&&Object.setPrototypeOf(y.prototype,ne.EventTarget.prototype);var w=function(e){function t(){throw r(this,t),c(this,s(t).call(this)),new TypeError("AbortSignal cannot be constructed directly")}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,y),o(t,[{key:"aborted",get:function(){var e=T.get(this);if("boolean"!=typeof e)throw new TypeError("Expected 'this' to be an 'AbortSignal' object, but got ".concat(null===this?"null":n(this)));return e}}]),t}();b(w.prototype,"abort");var T=new WeakMap;Object.defineProperties(w.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===n(Symbol.toStringTag)&&Object.defineProperty(w.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var P=function(){function t(){var e;r(this,t),k.set(this,(e=Object.create(w.prototype),y.call(e),T.set(e,!1),e))}return o(t,[{key:"abort",value:function(){var e;e=_(this),!1!==T.get(e)||(T.set(e,!0),e.dispatchEvent({type:"abort"}))}},{key:"signal",get:function(){return _(this)}}]),t}(),k=new WeakMap;if(Object.defineProperties(P.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===n(Symbol.toStringTag)&&Object.defineProperty(P.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),e.AbortController=P,e.AbortSignal=w,e.default=P,Object.defineProperty(e,"__esModule",{value:!0}),void 0===A&&void 0===O){var I=Function("return this")();void 0===I.AbortController&&(I.AbortController=P,I.AbortSignal=w)}},"object"==typeof h&&void 0!==A?t(h):"function"==typeof O&&O.amd?O(["exports"],t):t((e=e||self).AbortControllerShim={}),n=this,r=function(){"use strict";function r(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function i(e){return"string"!=typeof e&&(e=String(e)),e}function c(t){this.map={},t instanceof c?t.forEach(function(e,t){this.append(t,e)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function o(e){if(e.bodyUsed)return re.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(n){return new re(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function e(e){var t=new FileReader;return t.readAsArrayBuffer(e),s(t)}c.prototype.append=function(e,t){e=r(e),t=i(t);var n=this.map[e];n||(n=[],this.map[e]=n),n.push(t)},c.prototype.delete=function(e){delete this.map[r(e)]},c.prototype.get=function(e){var t=this.map[r(e)];return t?t[0]:null},c.prototype.getAll=function(e){return this.map[r(e)]||[]},c.prototype.has=function(e){return this.map.hasOwnProperty(r(e))},c.prototype.set=function(e,t){this.map[r(e)]=[i(t)]},c.prototype.forEach=function(n,r){Object.getOwnPropertyNames(this.map).forEach(function(t){this.map[t].forEach(function(e){n.call(r,e,t,this)},this)},this)};var u="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),t="FormData"in self,n="ArrayBuffer"in self;function a(){return this.bodyUsed=!1,this._initBody=function(e){if("string"==typeof(this._bodyInit=e))this._bodyText=e;else if(u&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(e){if(!n||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText=""},u?(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return re.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return re.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(e)},this.text=function(){var e,t,n=o(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,(t=new FileReader).readAsText(e),s(t);if(this._bodyFormData)throw new Error("could not read FormData body as text");return re.resolve(this._bodyText)}):this.text=function(){var e=o(this);return e||re.resolve(this._bodyText)},t&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}var l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function d(e,t){var n,r,i=(t=t||{}).body;if(d.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,i||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),-1<l.indexOf(r)?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function h(e){var i=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),n=t.shift().replace(/\+/g," "),r=t.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function f(e,t){t||(t={}),this._initBody(e),this.type="default",this.status=t.status,this.ok=200<=this.status&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof c?t.headers:new c(t.headers),this.url=t.url||""}d.prototype.clone=function(){return new d(this)},a.call(d.prototype),a.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},f.error=function(){var e=new f(null,{status:0,statusText:""});return e.type="error",e};var g=[301,302,303,307,308];return f.redirect=function(e,t){if(-1===g.indexOf(t))throw new RangeError("Invalid status code");return new f(null,{status:t,headers:{location:e}})},f=f,{fetch:ie=function(t,n){return new re(function(o,s){var e;e=d.prototype.isPrototypeOf(t)&&!n?t:new d(t,n);var a=new XMLHttpRequest;a.onload=function(){var e=1223===a.status?204:a.status;if(e<100||599<e)s(new TypeError("Network request failed"));else{var t,i,n={status:e,statusText:a.statusText,headers:(t=a,i=new c,t.getAllResponseHeaders().trim().split("\n").forEach(function(e){var t=e.trim().split(":"),n=t.shift().trim(),r=t.join(":").trim();i.append(n,r)}),i),url:"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0},r="response"in a?a.response:a.responseText;o(new f(r,n))}},a.onerror=function(){s(new TypeError("Network request failed"))},a.open(e.method,e.url,!0),"include"===e.credentials&&(a.withCredentials=!0),"responseType"in a&&u&&(a.responseType="blob"),e.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send(void 0===e._bodyInit?null:e._bodyInit)})},Request:d=d,Headers:c=c}},"object"==typeof h&&void 0!==A?A.exports=r():"function"==typeof O&&O.amd?O(r):n.ES6Fetch=r(),i=this,o=function(){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function g(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=g(e[n],t[n]));return e}var e,t,i,h=(i=Error,n(e=s,t=i),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o),s);function o(){this.constructor=e}function s(e,t){var n=i.call(this,t)||this;return n.code=e,n.name="FirebaseError",Object.setPrototypeOf(n,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,a.prototype.create),n}var a=(c.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=t[0]||{},i=this.service+"/"+e,o=this.errors[e],s=o?function(e,r){return o.replace(f,function(e,t){var n=r[t];return null!=n?n.toString():"<"+t+"?>"})}(0,r):"Error",a=this.serviceName+": "+s+" ("+i+").",c=new h(i,a),u=0,l=Object.keys(r);u<l.length;u++){var d=l[u];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=r[d])}return c},c);function c(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var f=/\{\$([^}]+)}/g;function p(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){var n=new m(e,t);return n.subscribe.bind(n)}var l,d,m=(b.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},b.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},b.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},b.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=v),void 0===r.error&&(r.error=v),void 0===r.complete&&(r.complete=v);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),o},b.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},b.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},b.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},b.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},b);function b(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=re.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function v(){}function y(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString();switch(t){case l.DEBUG:case l.VERBOSE:console.log.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case l.INFO:console.info.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case l.WARN:console.warn.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;case l.ERROR:console.error.apply(console,["["+i+"]  "+e.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}}}(d=l=l||{})[d.DEBUG=0]="DEBUG",d[d.VERBOSE=1]="VERBOSE",d[d.INFO=2]="INFO",d[d.WARN=3]="WARN",d[d.ERROR=4]="ERROR",d[d.SILENT=5]="SILENT";var _,S=l.INFO,C=(Object.defineProperty(E.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),E.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,l.DEBUG].concat(e))},E.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,l.VERBOSE].concat(e))},E.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,l.INFO].concat(e))},E.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,l.WARN].concat(e))},E.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,l.ERROR].concat(e))},E);function E(e){this.name=e,this._logLevel=S,this._logHandler=y}var w=((_={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",_["bad-app-name"]="Illegal App name: '{$appName}",_["duplicate-app"]="Firebase App named '{$appName}' already exists",_["app-deleted"]="Firebase App named '{$appName}' already deleted",_["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",_),T=new a("app","Firebase",w),P="[DEFAULT]",k=[],I=(Object.defineProperty(O.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),O.prototype.delete=function(){var a=this;return new re(function(e){a.checkDestroyed_(),e()}).then(function(){a.firebase_.INTERNAL.removeApp(a.name_);for(var e=[],t=0,n=Object.keys(a.services_);t<n.length;t++)for(var r=n[t],i=0,o=Object.keys(a.services_[r]);i<o.length;i++){var s=o[i];e.push(a.services_[r][s])}return re.all(e.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))}).then(function(){a.isDeleted_=!0,a.services_={}})},O.prototype._getService=function(e,t){if(void 0===t&&(t=P),this.checkDestroyed_(),this.services_[e]||(this.services_[e]={}),!this.services_[e][t]){var n=t!==P?t:void 0,r=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),n);this.services_[e][t]=r}return this.services_[e][t]},O.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=P),this.services_[e]&&this.services_[e][t]&&delete this.services_[e][t]},O.prototype.extendApp=function(e){var t=this;g(this,e),e.INTERNAL&&e.INTERNAL.addAuthTokenListener&&(k.forEach(function(e){t.INTERNAL.addAuthTokenListener(e)}),k=[])},O.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw T.create("app-deleted",{appName:this.name_})},O);function O(e,t,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=g(void 0,e),this.INTERNAL={getUid:function(){return null},getToken:function(){return re.resolve(null)},addAuthTokenListener:function(e){k.push(e),setTimeout(function(){return e(null)},0)},removeAuthTokenListener:function(t){k=k.filter(function(e){return e!==t})}}}I.prototype.name&&I.prototype.options||I.prototype.delete||console.log("dc");var A=new C("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){A.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var R=self.firebase.SDK_VERSION;R&&0<=R.indexOf("LITE")&&A.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var D=function e(){var t=function(s){var o={},a={},c={},u={__esModule:!0,initializeApp:function(e,t){void 0===t&&(t={}),"object"==typeof t&&null!==t||(t={name:t});var n=t;void 0===n.name&&(n.name=P);var r=n.name;if("string"!=typeof r||!r)throw T.create("bad-app-name",{appName:String(r)});if(p(o,r))throw T.create("duplicate-app",{appName:r});var i=new s(e,n,u);return h(o[r]=i,"create"),i},app:l,apps:null,SDK_VERSION:"6.6.2",INTERNAL:{registerService:function(n,e,t,r,i){if(void 0===i&&(i=!1),a[n])return A.debug("There were multiple attempts to register service "+n+"."),u[n];function o(e){if(void 0===e&&(e=l()),"function"!=typeof e[n])throw T.create("invalid-app-argument",{appName:n});return e[n]()}return a[n]=e,r&&(c[n]=r,d().forEach(function(e){r("create",e)})),void 0!==t&&g(o,t),u[n]=o,s.prototype[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,n).apply(this,i?e:[])},o},removeApp:function(e){h(o[e],"delete"),delete o[e]},factories:a,useAsService:f}};function l(e){if(!p(o,e=e||P))throw T.create("no-app",{appName:e});return o[e]}function d(){return Object.keys(o).map(function(e){return o[e]})}function h(e,t){for(var n=0,r=Object.keys(a);n<r.length;n++){var i=f(0,r[n]);if(null===i)return;c[i]&&c[i](t,e)}}function f(e,t){return"serverAuth"===t?null:t}return u.default=u,Object.defineProperty(u,"apps",{get:d}),l.App=s,u}(I);return t.INTERNAL=r({},t.INTERNAL,{createFirebaseNamespace:e,extendNamespace:function(e){g(t,e)},createSubscribe:u,ErrorFactory:a,deepExtend:g}),t}(),N=D.initializeApp;return D.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}()&&A.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),N.apply(void 0,e)},D},"object"==typeof h&&void 0!==A?A.exports=o():"function"==typeof O&&O.amd?O(o):(i=i||self).firebase=o(),s=this,a=function(te){"use strict";try{(function(){te=te&&te.hasOwnProperty("default")?te.default:te;var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function e(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function p(o,s,a,c){return new(a=a||re)(function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,r)}i((c=c.apply(o,s||[])).next())})}function m(n,r){var i,o,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}var o,h=(e(a,o=Error),a);function a(e,t){var n=o.call(this,t)||this;return n.code=e,n.name="FirebaseError",Object.setPrototypeOf(n,a.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,c.prototype.create),n}var c=(t.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=t[0]||{},i=this.service+"/"+e,o=this.errors[e],s=o?function(e,r){return o.replace(f,function(e,t){var n=r[t];return null!=n?n.toString():"<"+t+"?>"})}(0,r):"Error",a=this.serviceName+": "+s+" ("+i+").",c=new h(i,a),u=0,l=Object.keys(r);u<l.length;u++){var d=l[u];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=r[d])}return c},t);function t(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var f=/\{\$([^}]+)}/g;function n(e,t){var n=new l(e,t);return n.subscribe.bind(n)}var u,l=(d.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},d.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},d.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},d.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=g),void 0===r.error&&(r.error=g),void 0===r.complete&&(r.complete=g);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),o},d.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},d.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},d.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},d.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},d);function d(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=re.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function g(){}var b,v,y,_,S=((u={})["only-available-in-window"]="This method is available in a Window context.",u["only-available-in-sw"]="This method is available in a service worker context.",u["should-be-overriden"]="This method should be overriden by extended classes.",u["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",u["permission-default"]="The required permissions were not granted and dismissed instead.",u["permission-blocked"]="The required permissions were not granted and blocked instead.",u["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",u["notifications-blocked"]="Notifications have been blocked.",u["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",u["sw-registration-expected"]="A service worker registration was the expected input.",u["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",u["invalid-saved-token"]="Unable to access details of the saved token.",u["sw-reg-redundant"]="The service worker being used for push was made redundant.",u["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",u["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",u["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",u["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",u["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",u["token-update-no-token"]="FCM returned no token when updating the user to push.",u["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",u["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",u["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",u["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",u["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",u["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",u["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",u["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",u["failed-to-delete-token"]="Unable to delete the currently saved token.",u["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",u["bad-scope"]="The service worker scope must be a string with at least one character.",u["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",u["bad-subscription"]="The subscription must be a valid PushSubscription.",u["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",u["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",u["failed-delete-vapid-key"]="The VAPID key could not be deleted.",u["invalid-public-vapid-key"]="The public VAPID key must be a string.",u["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",u["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",u),C=new c("messaging","Messaging",S),E=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),w="https://fcm.googleapis.com";function T(e,t){if(null==e||null==t)return!1;if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),r=new DataView(t),i=0;i<e.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function P(e){return(t=e,n=new Uint8Array(t),btoa(String.fromCharCode.apply(String,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}(n)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var t,n}(v=b=b||{}).TYPE_OF_MSG="firebase-messaging-msg-type",v.DATA="firebase-messaging-msg-data",(_=y=y||{}).PUSH_MSG_RECEIVED="push-msg-received",_.NOTIFICATION_CLICKED="notification-clicked";var k=(I.prototype.getToken=function(l,d,h){return p(this,void 0,void 0,function(){var t,n,r,i,o,s,a,c,u;return m(this,function(e){switch(e.label){case 0:t=P(d.getKey("p256dh")),n=P(d.getKey("auth")),r="authorized_entity="+l+"&endpoint="+d.endpoint+"&encryption_key="+t+"&encryption_auth="+n,T(h.buffer,E.buffer)||(i=P(h),r+="&application_pub_key="+i),(o=new oe).append("Content-Type","application/x-www-form-urlencoded"),s={method:"POST",headers:o,body:r},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,ie(w+"/fcm/connect/subscribe",s)];case 2:return[4,e.sent().json()];case 3:return a=e.sent(),[3,5];case 4:throw c=e.sent(),C.create("token-subscribe-failed",{errorInfo:c});case 5:if(a.error)throw u=a.error.message,C.create("token-subscribe-failed",{errorInfo:u});if(!a.token)throw C.create("token-subscribe-no-token");if(!a.pushSet)throw C.create("token-subscribe-no-push-set");return[2,{token:a.token,pushSet:a.pushSet}]}})})},I.prototype.updateToken=function(l,d,h,f,g){return p(this,void 0,void 0,function(){var t,n,r,i,o,s,a,c,u;return m(this,function(e){switch(e.label){case 0:t=P(f.getKey("p256dh")),n=P(f.getKey("auth")),r="push_set="+h+"&token="+d+"&authorized_entity="+l+"&endpoint="+f.endpoint+"&encryption_key="+t+"&encryption_auth="+n,T(g.buffer,E.buffer)||(i=P(g),r+="&application_pub_key="+i),(o=new oe).append("Content-Type","application/x-www-form-urlencoded"),s={method:"POST",headers:o,body:r},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,ie(w+"/fcm/connect/subscribe",s)];case 2:return[4,e.sent().json()];case 3:return a=e.sent(),[3,5];case 4:throw c=e.sent(),C.create("token-update-failed",{errorInfo:c});case 5:if(a.error)throw u=a.error.message,C.create("token-update-failed",{errorInfo:u});if(!a.token)throw C.create("token-update-no-token");return[2,a.token]}})})},I.prototype.deleteToken=function(a,c,u){return p(this,void 0,void 0,function(){var t,n,r,i,o,s;return m(this,function(e){switch(e.label){case 0:t="authorized_entity="+a+"&token="+c+"&pushSet="+u,(n=new oe).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:t},e.label=1;case 1:return e.trys.push([1,4,,5]),[4,ie(w+"/fcm/connect/unsubscribe",r)];case 2:return[4,e.sent().json()];case 3:if((i=e.sent()).error)throw o=i.error.message,C.create("token-unsubscribe-failed",{errorInfo:o});return[3,5];case 4:throw s=e.sent(),C.create("token-unsubscribe-failed",{errorInfo:s});case 5:return[2]}})})},I);function I(){}function O(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var A="undefined",R="fcm_token_object_Store",D=(N.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},N.prototype.getIndex=function(t,n){return this.createTransaction(function(e){return e.index(t).get(n)})},N.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},N.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},N.prototype.closeDatabase=function(){return p(this,void 0,void 0,function(){return m(this,function(e){switch(e.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:e.sent().close(),this.dbPromise=null,e.label=2;case 2:return[2]}})})},N.prototype.createTransaction=function(s,a){return void 0===a&&(a="readonly"),p(this,void 0,void 0,function(){var t,r,i,o;return m(this,function(e){switch(e.label){case 0:return[4,this.getDb()];case 1:return t=e.sent(),r=t.transaction(this.objectStoreName,a),i=r.objectStore(this.objectStoreName),[4,(n=s(i),new re(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}}))];case 2:return o=e.sent(),[2,new re(function(e,t){r.oncomplete=function(){e(o)},r.onerror=function(){t(r.error)}})]}var n})})},N.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new re(function(e,t){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){e(n.result)},n.onerror=function(){r.dbPromise=null,t(n.error)},n.onupgradeneeded=function(e){return r.onDbUpgrade(n,e)}})),this.dbPromise},N);function N(){this.dbPromise=null}var M,L=(e(F,M=D),F.prototype.onDbUpgrade=function(e,t){var n,r=e.result;switch(t.oldVersion){case 0:(i=r.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),i.createIndex("fcmToken","fcmToken",{unique:!0});case 1:(n=indexedDB.open(A)).onerror=function(e){},n.onsuccess=function(e){!function(n){if(n.objectStoreNames.contains(R)){var e=n.transaction(R).objectStore(R),r=new k,i=e.openCursor();i.onerror=function(e){console.warn("Unable to cleanup old IDB.",e)},i.onsuccess=function(){var e=i.result;if(e){var t=e.value;r.deleteToken(t.fcmSenderId,t.fcmToken,t.fcmPushSet),e.continue()}else n.close(),indexedDB.deleteDatabase(A)}}}(n.result)};case 2:var i,o=(i=e.transaction.objectStore(this.objectStoreName)).openCursor();o.onsuccess=function(){var e=o.result;if(e){var t=e.value,n=s({},t);t.createTime||(n.createTime=Date.now()),"string"==typeof t.vapidKey&&(n.vapidKey=O(t.vapidKey)),"string"==typeof t.auth&&(n.auth=O(t.auth).buffer),"string"==typeof t.auth&&(n.p256dh=O(t.p256dh).buffer),e.update(n),e.continue()}}}},F.prototype.getTokenDetailsFromToken=function(t){return p(this,void 0,void 0,function(){return m(this,function(e){if(!t)throw C.create("bad-token");return W({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},F.prototype.getTokenDetailsFromSWScope=function(t){return p(this,void 0,void 0,function(){return m(this,function(e){if(!t)throw C.create("bad-scope");return W({swScope:t}),[2,this.get(t)]})})},F.prototype.saveTokenDetails=function(t){return p(this,void 0,void 0,function(){return m(this,function(e){if(!t.swScope)throw C.create("bad-scope");if(!t.vapidKey)throw C.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw C.create("bad-subscription");if(!t.fcmSenderId)throw C.create("bad-sender-id");if(!t.fcmToken)throw C.create("bad-token");if(!t.fcmPushSet)throw C.create("bad-push-set");return W(t),[2,this.put(t)]})})},F.prototype.deleteToken=function(n){return p(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return"string"!=typeof n||0===n.length?[2,re.reject(C.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(t=e.sent()))throw C.create("delete-token-not-found");return[4,this.delete(t.swScope)];case 2:return e.sent(),[2,t]}})})},F);function F(){var e=null!==M&&M.apply(this,arguments)||this;return e.dbName="fcm_token_details_db",e.dbVersion=3,e.objectStoreName="fcm_token_object_Store",e}function W(e){if(e.fcmToken&&("string"!=typeof e.fcmToken||0===e.fcmToken.length))throw C.create("bad-token");if(e.swScope&&("string"!=typeof e.swScope||0===e.swScope.length))throw C.create("bad-scope");if(e.vapidKey&&(!(e.vapidKey instanceof Uint8Array)||65!==e.vapidKey.length))throw C.create("bad-vapid-key");if(e.endpoint&&("string"!=typeof e.endpoint||0===e.endpoint.length))throw C.create("bad-subscription");if(e.auth&&!(e.auth instanceof ArrayBuffer))throw C.create("bad-subscription");if(e.p256dh&&!(e.p256dh instanceof ArrayBuffer))throw C.create("bad-subscription");if(e.fcmSenderId&&("string"!=typeof e.fcmSenderId||0===e.fcmSenderId.length))throw C.create("bad-sender-id");if(e.fcmPushSet&&("string"!=typeof e.fcmPushSet||0===e.fcmPushSet.length))throw C.create("bad-push-set")}var U,x=(e(B,U=D),B.prototype.onDbUpgrade=function(e){e.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},B.prototype.getVapidFromSWScope=function(n){return p(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:if("string"!=typeof n||0===n.length)throw C.create("bad-scope");return[4,this.get(n)];case 1:return[2,(t=e.sent())?t.vapidKey:void 0]}})})},B.prototype.saveVapidDetails=function(n,r){return p(this,void 0,void 0,function(){var t;return m(this,function(e){if("string"!=typeof n||0===n.length)throw C.create("bad-scope");if(null===r||65!==r.length)throw C.create("bad-vapid-key");return t={swScope:n,vapidKey:r},[2,this.put(t)]})})},B.prototype.deleteVapidDetails=function(n){return p(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(t=e.sent()))throw C.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return e.sent(),[2,t]}})})},B);function B(){var e=null!==U&&U.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}var H="messagingSenderId",q=(V.prototype.getToken=function(){return p(this,void 0,void 0,function(){var t,n,r,i,o;return m(this,function(e){switch(e.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw C.create("notifications-blocked");return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return n=e.sent(),[4,this.getPublicVapidKey_()];case 2:return r=e.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=e.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=e.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},V.prototype.manageExistingToken=function(t,n,r,i){return p(this,void 0,void 0,function(){return m(this,function(e){switch(e.label){case 0:return function(e,t,n){if(!n.vapidKey||!T(t.buffer,n.vapidKey.buffer))return!1;var r=e.endpoint===n.endpoint,i=T(e.getKey("auth"),n.auth),o=T(e.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(t,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return e.sent(),[2,this.getNewToken(t,n,r)]}})})},V.prototype.updateToken=function(i,o,s,a){return p(this,void 0,void 0,function(){var t,n,r;return m(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,a.fcmToken,a.fcmPushSet,o,s)];case 1:return t=e.sent(),n={swScope:i.scope,vapidKey:s,fcmSenderId:this.messagingSenderId,fcmToken:t,fcmPushSet:a.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,s)];case 3:return e.sent(),[2,t];case 4:return r=e.sent(),[4,this.deleteToken(a.fcmToken)];case 5:throw e.sent(),r;case 6:return[2]}})})},V.prototype.getNewToken=function(r,i,o){return p(this,void 0,void 0,function(){var t,n;return m(this,function(e){switch(e.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return t=e.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:t.token,fcmPushSet:t.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return e.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return e.sent(),[2,t.token]}})})},V.prototype.deleteToken=function(r){return p(this,void 0,void 0,function(){var t,n;return m(this,function(e){switch(e.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return e.sent(),[4,this.getSWRegistration_()];case 2:return(t=e.sent())?[4,t.pushManager.getSubscription()]:[3,4];case 3:if(n=e.sent())return[2,n.unsubscribe()];e.label=4;case 4:return[2,!0]}})})},V.prototype.deleteTokenFromDB=function(n){return p(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return t=e.sent(),[4,this.iidModel.deleteToken(t.fcmSenderId,t.fcmToken,t.fcmPushSet)];case 2:return e.sent(),[2]}})})},V.prototype.getPushSubscription=function(t,n){return t.pushManager.getSubscription().then(function(e){return e||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},V.prototype.requestPermission=function(){throw C.create("only-available-in-window")},V.prototype.useServiceWorker=function(e){throw C.create("only-available-in-window")},V.prototype.usePublicVapidKey=function(e){throw C.create("only-available-in-window")},V.prototype.onMessage=function(e,t,n){throw C.create("only-available-in-window")},V.prototype.onTokenRefresh=function(e,t,n){throw C.create("only-available-in-window")},V.prototype.setBackgroundMessageHandler=function(e){throw C.create("only-available-in-sw")},V.prototype.delete=function(){return p(this,void 0,void 0,function(){return m(this,function(e){switch(e.label){case 0:return[4,re.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return e.sent(),[2]}})})},V.prototype.getNotificationPermission_=function(){return Notification.permission},V.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},V.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},V.prototype.getIidModel=function(){return this.iidModel},V);function V(e){var t=this;if(!e.options[H]||"string"!=typeof e.options[H])throw C.create("bad-sender-id");this.messagingSenderId=e.options[H],this.tokenDetailsModel=new L,this.vapidDetailsModel=new x,this.iidModel=new k,this.app=e,this.INTERNAL={delete:function(){return t.delete()}}}var j,Y="FCM_MSG",G=(e(K,j=q),K.prototype.onPush=function(e){e.waitUntil(this.onPush_(e))},K.prototype.onSubChange=function(e){e.waitUntil(this.onSubChange_(e))},K.prototype.onNotificationClick=function(e){e.waitUntil(this.onNotificationClick_(e))},K.prototype.onPush_=function(a){return p(this,void 0,void 0,function(){var t,n,r,i,o,s;return m(this,function(e){switch(e.label){case 0:if(!a.data)return[2];try{t=a.data.json()}catch(e){return[2]}return[4,this.hasVisibleClients_()];case 1:return e.sent()?[2,this.sendMessageToWindowClients_(t)]:(n=this.getNotificationData_(t))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=e.sent(),o=n.actions,s=Notification.maxActions,o&&s&&o.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(t)]:[3,5];case 4:return e.sent(),[2];case 5:return[2]}})})},K.prototype.onSubChange_=function(e){return p(this,void 0,void 0,function(){var t,n,r,i;return m(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=e.sent(),[3,3];case 2:throw n=e.sent(),C.create("unable-to-resubscribe",{errorInfo:n});case 3:return e.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return e.sent(),[3,8];case 5:return r=e.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(i=e.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw e.sent(),r;case 8:return[2]}})})},K.prototype.onNotificationClick_=function(o){return p(this,void 0,void 0,function(){var t,n,r,i;return m(this,function(e){switch(e.label){case 0:return o.notification&&o.notification.data&&o.notification.data[Y]?o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(t=o.notification.data[Y]).notification&&(n=t.fcmOptions&&t.fcmOptions.link||t.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=e.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=e.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=e.sent(),e.label=5;case 5:return r?(delete t.notification,delete t.fcmOptions,i=J(y.NOTIFICATION_CLICKED,t),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},K.prototype.getNotificationData_=function(e){var t;if(e&&"object"==typeof e.notification){var n=s({},e.notification);return n.data=s({},e.notification.data,((t={})[Y]=e,t)),n}},K.prototype.setBackgroundMessageHandler=function(e){if(!e||"function"!=typeof e)throw C.create("bg-handler-function-expected");this.bgMessageHandler=e},K.prototype.getWindowClient_=function(o){return p(this,void 0,void 0,function(){var t,n,r,i;return m(this,function(e){switch(e.label){case 0:return t=new URL(o,self.location.href).href,[4,X()];case 1:for(n=e.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===t){r=n[i];break}return[2,r]}})})},K.prototype.attemptToMessageClient_=function(t,n){return p(this,void 0,void 0,function(){return m(this,function(e){if(!t)throw C.create("no-window-client-to-msg");return t.postMessage(n),[2]})})},K.prototype.hasVisibleClients_=function(){return p(this,void 0,void 0,function(){return m(this,function(e){switch(e.label){case 0:return[4,X()];case 1:return[2,e.sent().some(function(e){return"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")})]}})})},K.prototype.sendMessageToWindowClients_=function(i){return p(this,void 0,void 0,function(){var t,n,r=this;return m(this,function(e){switch(e.label){case 0:return[4,X()];case 1:return t=e.sent(),n=J(y.PUSH_MSG_RECEIVED,i),[4,re.all(t.map(function(e){return r.attemptToMessageClient_(e,n)}))];case 2:return e.sent(),[2]}})})},K.prototype.getSWRegistration_=function(){return p(this,void 0,void 0,function(){return m(this,function(e){return[2,self.registration]})})},K.prototype.getPublicVapidKey_=function(){return p(this,void 0,void 0,function(){var t,n;return m(this,function(e){switch(e.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=e.sent()))throw C.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(n=e.sent())?[2,E]:[2,n]}})})},K);function K(e){var t=j.call(this,e)||this;return t.bgMessageHandler=null,self.addEventListener("push",function(e){t.onPush(e)}),self.addEventListener("pushsubscriptionchange",function(e){t.onSubChange(e)}),self.addEventListener("notificationclick",function(e){t.onNotificationClick(e)}),t}function X(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function J(e,t){var n;return(n={})[b.TYPE_OF_MSG]=e,n[b.DATA]=t,n}var z,Q,$=(e(Z,z=q),Z.prototype.requestPermission=function(){return p(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?C.create("permission-blocked"):C.create("permission-default")}})})},Z.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw C.create("sw-registration-expected");if(null!=this.registrationToUse)throw C.create("use-sw-before-get-token");this.registrationToUse=e},Z.prototype.usePublicVapidKey=function(e){if("string"!=typeof e)throw C.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw C.create("use-public-key-before-get-token");var t=O(e);if(65!==t.length)throw C.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=t},Z.prototype.onMessage=function(e,t,n){return"function"==typeof e?this.onMessageInternal(e,t,n):this.onMessageInternal(e)},Z.prototype.onTokenRefresh=function(e,t,n){return"function"==typeof e?this.onTokenRefreshInternal(e,t,n):this.onTokenRefreshInternal(e)},Z.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new re(function(e,t){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)e(r);else{if("redundant"!==i.state)return;t(C.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else t(C.create("sw-reg-redundant"));else e(r);else t(C.create("no-sw-in-reg"))})},Z.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(e){throw C.create("failed-serviceworker-registration",{browserErrorMessage:e.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return(t.registrationToUse=e).update(),e})}))},Z.prototype.getPublicVapidKey_=function(){return p(this,void 0,void 0,function(){return m(this,function(e){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,E]})})},Z.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[b.TYPE_OF_MSG]){var t=e.data;switch(t[b.TYPE_OF_MSG]){case y.PUSH_MSG_RECEIVED:case y.NOTIFICATION_CLICKED:var n=t[b.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},Z);function Z(e){var t=z.call(this,e)||this;return t.registrationToUse=null,t.publicVapidKeyToUse=null,t.messageObserver=null,t.tokenRefreshObserver=null,t.onMessageInternal=n(function(e){t.messageObserver=e}),t.onTokenRefreshInternal=n(function(e){t.tokenRefreshObserver=e}),t.setupSWMessageListener_(),t}function ee(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in ne&&"Notification"in ne&&"fetch"in ne&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}Q={isSupported:ee},te.INTERNAL.registerService("messaging",function(e){if(!ee())throw C.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new G(e):new $(e)},Q)}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-messaging - be sure to load firebase-app.js first.")}},"object"==typeof h&&void 0!==A?a(require("@firebase/app")):"function"==typeof O&&O.amd?O(["@firebase/app"],a):a((s=s||self).firebase),I.cookie=function(){function f(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}return function e(d){function h(e,t,n){var r;if(1<arguments.length){if("number"==typeof(n=f({path:"/"},h.defaults,n)).expires){var i=new Date;i.setMilliseconds(i.getMilliseconds()+864e5*n.expires),n.expires=i}try{r=JSON.stringify(t),/^[\{\[]/.test(r)&&(t=r)}catch(e){}return t=d.write?d.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),void(document.cookie=[e,"=",t,n.expires&&"; expires="+n.expires.toUTCString(),n.path&&"; path="+n.path,n.domain&&"; domain="+n.domain,n.sameSite?"; SameSite="+n.sameSite:"; SameSite=None","; Secure"].join(""))}e||(r={});for(var o=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,a=0;a<o.length;a++){var c=o[a].split("="),u=c[0].replace(s,decodeURIComponent),l=c.slice(1).join("=");'"'===l.charAt(0)&&(l=l.slice(1,-1));try{if(l=d.read?d.read(l,u):d(l,u)||l.replace(s,decodeURIComponent),this.json)try{l=JSON.parse(l)}catch(e){}if(e===u){r=l;break}e||(r[u]=l)}catch(e){}}return r}return h.get=h.set=h,h.getJSON=function(){return h.apply({json:!0},[].slice.call(arguments))},h.defaults={},h.remove=function(e,t){h(e,"",f(t,{expires:-1}))},h.withConverter=e,h}(function(){})}(),c=this,u=function(){"use strict";function c(e){return"function"==typeof e}function t(){var e=setTimeout;return function(){return e(n,1)}}function n(){for(var e=0;e<_;e+=2)(0,O[e])(O[e+1]),O[e]=void 0,O[e+1]=void 0;_=0}function u(e,t){var n=this,r=new this.constructor(d);void 0===r[R]&&b(r);var i=n._state;if(i){var o=arguments[i-1];E(function(){return m(i,r,o,n._result)})}else a(n,r,e,t);return r}function l(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(d);return f(t,e),t}function d(){}function h(e,t,n){var r,i,o,s;t.constructor===e.constructor&&n===u&&t.constructor.resolve===l?(o=e,(s=t)._state===N?g(o,s._result):s._state===M?p(o,s._result):a(s,void 0,function(e){return f(o,e)},function(e){return p(o,e)})):void 0===n?g(e,t):c(n)?(r=t,i=n,E(function(t){var n=!1,e=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(i,r,function(e){n||(n=!0,r!==e?f(t,e):g(t,e))},function(e){n||(n=!0,p(t,e))},t._label);!n&&e&&(n=!0,p(t,e))},e)):g(e,t)}function f(t,e){if(t===e)p(t,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(r=e),null===r||"object"!==i&&"function"!==i)g(t,e);else{var n=void 0;try{n=e.then}catch(e){return void p(t,e)}h(t,e,n)}var r,i}function r(e){e._onerror&&e._onerror(e._result),s(e)}function g(e,t){e._state===D&&(e._result=t,e._state=N,0!==e._subscribers.length&&E(s,e))}function p(e,t){e._state===D&&(e._state=M,e._result=t,E(r,e))}function a(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+N]=n,i[o+M]=r,0===o&&e._state&&E(s,e)}function s(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?m(n,r,i,o):i(o);e._subscribers.length=0}}function m(e,t,n,r){var i=c(n),o=void 0,s=void 0,a=!0;if(i){try{o=n(r)}catch(e){a=!1,s=e}if(t===o)return void p(t,new TypeError("A promises callback cannot return that same promise."))}else o=r;t._state!==D||(i&&a?f(t,o):!1===a?p(t,s):e===N?g(t,o):e===M&&p(t,o))}function b(e){e[R]=L++,e._state=void 0,e._result=void 0,e._subscribers=[]}var e,i,o,v,y=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},_=0,S=void 0,C=void 0,E=function(e,t){O[_]=e,O[_+1]=t,2===(_+=2)&&(C?C(n):A())},w=void 0!==ne?ne:void 0,T=w||{},P=T.MutationObserver||T.WebKitMutationObserver,k="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),I="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,O=new Array(1e3),A=void 0;A=k?function(){return process.nextTick(n)}:P?(i=0,o=new P(n),v=document.createTextNode(""),o.observe(v,{characterData:!0}),function(){v.data=i=++i%2}):I?((e=new MessageChannel).port1.onmessage=n,function(){return e.port2.postMessage(0)}):void 0===w&&"function"==typeof require?function(){try{var e=Function("return this")().require("vertx");return void 0!==(S=e.runOnLoop||e.runOnContext)?function(){S(n)}:t()}catch(e){return t()}}():t();var R=Math.random().toString(36).substring(2),D=void 0,N=1,M=2,L=0,F=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(d),this.promise[R]||b(this.promise),y(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?g(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&g(this.promise,this._result))):p(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===D&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===l){var i=void 0,o=void 0,s=!1;try{i=t.then}catch(e){s=!0,o=e}if(i===u&&t._state!==D)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===W){var a=new n(d);s?p(a,o):h(a,t,i),this._willSettleAt(a,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===D&&(this._remaining--,e===M?p(r,n):this._result[t]=n),0===this._remaining&&g(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;a(e,void 0,function(e){return n._settledAt(N,t,e)},function(e){return n._settledAt(M,t,e)})},e}(),W=function(){function t(e){this[R]=L++,this._result=this._state=void 0,this._subscribers=[],d!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){f(t,e)},function(e){p(t,e)})}catch(e){p(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return c(t)?this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return W.prototype.then=u,W.all=function(e){return new F(this,e).promise},W.race=function(i){var o=this;return new o(y(i)?function(e,t){for(var n=i.length,r=0;r<n;r++)o.resolve(i[r]).then(e,t)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},W.resolve=l,W.reject=function(e){var t=new this(d);return p(t,e),t},W._setScheduler=function(e){C=e},W._setAsap=function(e){E=e},W._asap=E,W.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=W},(W.Promise=W).polyfill(),W},"object"==typeof h&&void 0!==A?A.exports=u():"function"==typeof O&&O.amd?O(u):c.ES6Promise=u(),l=this,d=function(){return function(n,e){var r=this;e===k&&(e=999),r.getOffset=function(e){for(var t=ne.getComputedStyle(e,null),n=["paddingTop","paddingBottom"],r=0,i=0;i<n.length;i++)r+=parseInt(t[n[i]]);return r},r.autogrowFn=function(){var e=0,t=!1;return n.scrollHeight-i>r.maxAllowedHeight?(n.style.overflowY="scroll",e=r.maxAllowedHeight):(n.style.overflowY="hidden",n.style.height="auto",e=n.scrollHeight-i,t=!0),n.style.height=e+"px",t};var i=r.getOffset(n);r.rows=n.rows||1,r.lineHeight=n.scrollHeight/r.rows-i/r.rows,r.maxAllowedHeight=r.lineHeight*e-i,n.addEventListener("input",r.autogrowFn)}},"function"==typeof O&&O.amd?O([],d):"object"==typeof A&&A.exports?A.exports=d():l.Autogrow=d();var f,g=Array.prototype,p=Object.prototype,m=Function.prototype,b=(g.push,g.slice,p.toString),v=(p.hasOwnProperty,Array.isArray),y=Object.keys,_=(m.bind,Object.create,Math.pow(2,53)-1),S=(f="length",function(e){return null==e?void 0:e[f]}),C=function(e){var t=S(e);return"number"==typeof t&&0<=t&&t<=_};I.isEmpty=function(e){return null==e||(C(e)&&(I.isArray(e)||I.isString(e)||I.isArguments(e))?0===e.length:0===I.keys(e).length)},I.isElement=function(e){return!(!e||1!==e.nodeType)},I.isArray=v||function(e){return"[object Array]"===b.call(e)},I.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},I.each=I.forEach=function(e,t,n){var r,i;if(t=function(i,o,e){if(void 0===o)return i;switch(null==e?3:e){case 1:return function(e){return i.call(o,e)};case 3:return function(e,t,n){return i.call(o,e,t,n)};case 4:return function(e,t,n,r){return i.call(o,e,t,n,r)}}return function(){return i.apply(o,arguments)}}(t,n),C(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=I.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e},I.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol"],function(t){I["is"+t]=function(e){return b.call(e)==="[object "+t+"]"}});var E=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],T=function(e,t){var n=w.length,r=e.constructor,i=I.isFunction(r)&&r.prototype||p,o="constructor";for(I.has(e,o)&&!I.contains(t,o)&&t.push(o);n--;)(o=w[n])in e&&e[o]!==i[o]&&!I.contains(t,o)&&t.push(o)};I.allKeys=function(e){if(!I.isObject(e))return[];var t=[];for(var n in e)t.push(n);return E&&T(e,t),t},I.keys=function(e){if(!I.isObject(e))return[];if(y)return y(e);var t=[];for(var n in e)I.has(e,n)&&t.push(n);return E&&T(e,t),t};var P=function(c,u){return function(e){var t=arguments.length;if(u&&(e=Object(e)),t<2||null==e)return e;for(var n=1;n<t;n++)for(var r=arguments[n],i=c(r),o=i.length,s=0;s<o;s++){var a=i[s];u&&void 0!==e[a]||(e[a]=r[a])}return e}};I.extend=P(I.allKeys),I.extendOwn=I.assign=P(I.keys),void 0!==R&&(this.firebase=R),void 0!==I&&(this._=I)}).call(r),r.ES6Promise&&r.ES6Promise.Promise||console.error("Main:init Promise library is required");var R=r.firebase,re=(I=r._,r.ES6Promise.Promise),ie=r.ES6Fetch.fetch,oe=r.ES6Fetch.Headers,l=r.ES6Fetch.Request;if(I.cookie.get("_snrs_sdk_d")){f.setEnabled(!0);var i=function(e,t){var n=new Array(t.length+1);n[0]="SDK ["+c.get().getElapsedTimeString()+"]";for(var r=0;r<t.length;++r)n[r+1]=t[r];e.apply(this,n)};h=I.cookie.get("_snrs_sdk_d_timer")?{debug:function(){i(console.debug,arguments)},log:function(){i(console.log,arguments)},info:function(){i(console.info,arguments)},error:function(){i(console.error,arguments)},fatal:function(){i(console.error,arguments)}}:{debug:console.debug.bind(console),log:console.log.bind(console),info:console.info.bind(console),error:function(){f.callFunctionAndLogError(console.error,arguments)},fatal:function(){f.callFunctionAndLogError(console.error,arguments,f.LEVEL.fatal)}}}else h={debug:e,log:e,info:e,error:function(){f.callFunctionAndLogError(e,arguments)},fatal:function(){f.callFunctionAndLogError(e,arguments,f.LEVEL.fatal)}};h.log("Main:init SyneriseLibraryScope",r);var d={_apiKey:null,_trackerKey:null,apiKey:function(e){return h.error("Api key is no longer supported"),null},trackerKey:function(e){return void 0!==e?"YOUR_TRACKER_KEY"!=e?d._trackerKey=e:null:d._trackerKey},getHeaderAuth:function(e){if(!d.checkAuth())throw new TypeError("TrackerKey is not set");return"key"==e?"Tracker":"value"==e?this.trackerKey():void 0},checkAuth:function(){return!!this.trackerKey()||(h.error("TrackerKey is not set"),!1)},parseToken:function(t){try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(e){return h.error("Auth:parseToken ERROR: could not parse token",t,e),null}}};function o(e){e=e||{},this.uuid=e.uuid||null,this.permUuid=e.permUuid||null,this.customIdentify=e.customIdentify||null,this.accessToken=e.accessToken||null,this.tags=null,this.segments=null,this.params=e.params||null,void 0!==this.params&&null!=this.params&&void 0!==this.params.customIdentify&&(this.customIdentify=this.params.customIdentify,delete this.params.customIdentify)}o.prototype.getTags=function(){h.log("Client:getTag");var e=this;return new re(function(t,n){e.tags?t(e.tags):s(e).then(function(e){h.log("Client:getTag RequestManager.getClientTags then",e),t(e.tags?e.tags:[])}).catch(function(e){n(e)})})},o.prototype.getSegments=function(){h.log("Client:getSegments");var e=this;return new re(function(t,n){e.segments?t(e.segments):s(e).then(function(e){h.log("Client:getTag RequestManager.getSegments then",e),t(e.segments?e.segments:[])}).catch(function(e){n(e)})})};var s=function(r){return h.log("Client:getData"),new re(function(t,n){r.segments&&r.tags?t({tags:r.tags,segments:r.segments}):U.getClientData(r).then(function(e){h.log("Client:getData RequestManager.getClientData then",e),r.segments=e.segments?e.segments:[],r.tags=e.tags?e.tags:[],t(e)}).catch(function(e){n(e)})})};o.prototype.getDynamicContents=function(){h.log("Client:getDynamicContents",this);var n=this;return new re(function(e,t){y.getDynamicContentsForClient(n).then(e).catch(function(e){h.error(e,n),t(new Error("Can not get dynamic contents"))})})},o.prototype.renderDynamicContents=function(){h.log("Client:renderDynamicContents");var r=this;return new re(function(t,n){r.getDynamicContents().then(y.renderBatchDynamicContents).then(function(e){I.each(e,function(e){r.renderDynamicContent(e)}),t(e)}).catch(function(e){h.error(e,r),n(new Error("Can not render dynamic contents"))})})},o.prototype.renderDynamicContent=function(e){return y.renderDynamicContentForClient(e,this)},o.prototype.reRenderDynamicContent=function(e){return y.reRenderDynamicContentForClient(e,this)},o.prototype.getDynamicContentByUuids=function(n){h.log("Client:getDynamicContentByUuids",this);var r=this;return new re(function(e,t){y.getDynamicContentByUuidsForClient(r,n).then(e).catch(function(e){h.error(e,r),t(new Error("Can not get dynamic content"))})})},o.prototype.renderDynamicContentByUuidFromCache=function(n){h.log("Client:renderDynamicContentByUuidFromCache",this);var r=this;return new re(function(e,t){y.findDynamicContenByUuid(n).then(function(e){r.renderDynamicContentByUuids(e)}).catch(function(e){h.error(e,r),t(new Error("Can not find dynamic content"))})})},o.prototype.renderDynamicContentByUuids=function(e){h.log("Client:renderDynamicContentByUuids");var r=this;return new re(function(t,n){r.getDynamicContentByUuids(e).then(function(e){I.each(e,function(e){r.reRenderDynamicContent(e)}),t(e)}).catch(function(e){h.error(e,r),n(new Error("Can not render dynamic content"))})})},o.prototype.getNotifications=function(){h.log("Client:getNotifications");var n=this;return new re(function(t,e){h.log("Client:getNotifications",n),F.getNotificationsForClient(n).then(function(e){h.log("Client:getNotifications NotificationManager.getNotificationsForClient() then check capping",e);var r=[];I.each(e,function(e){if(e.capping&&I.isObject(e.capping)&&e.id){var t=e.capping;switch(t.type){case"count":if(h.log("Client.getNotifications capping count limit",t.count),t.count&&0<t.count){var n=V.getNotificationCapping(e);h.log("Client.getNotifications check capping",e.id,t.count,n,t.count>n),t.count>n&&r.push(e)}else r.push(e)}}else r.push(e)}),t(r)}).catch(function(e){h.error(e),t([])})})},o.prototype.renderNotifications=function(){h.log("Client:renderNotifications");var n=this;return new re(function(t,e){n.getNotifications().then(function(e){return I.each(e,function(e){n.renderNotification(e)}),re.resolve(e)}).then(function(){t()}).catch(function(e){h.error(e),t()})})};var m={currentClient:null,notify:function(t){t=new L(t),m.getCurrentClient().then(function(e){e.renderNotification(t,!0)})},getAndRenderDynamicContentsForClient:function(t){m.getCurrentClient().then(function(e){void 0!==t?e.renderDynamicContentByUuidFromCache(t):e.renderDynamicContents()})},getCurrentClient:function(){return new re(function(t,n){if(h.log("ClientManager:getCurrentClient",m.currentClient),m.currentClient&&m.currentClient.uuid&&m.currentClient.permUuid)t(m.currentClient);else{var e=m.getClientFromStore();if(e)m.currentClient?(m.currentClient.uuid=e.uuid,m.currentClient.permUuid=e.permUuid):m.setCurrentClient(e),h.log("ClientManager:getCurrentClient return:",m.currentClient),t(m.currentClient);else var r=0,i=setInterval(function(){h.log("ClientManager:getCurrentClient try get client again",r,25);var e=m.getClientFromStore();e?(clearInterval(i),i=null,m.currentClient?(m.currentClient.uuid=e.uuid,m.currentClient.permUuid=e.permUuid):m.setCurrentClient(e),h.log("ClientManager:getCurrentClient return:",m.currentClient),t(m.currentClient)):25<=r&&(clearInterval(i),i=null,n(new TypeError("Client has not found"))),r++},50)}})},updateClientParams:function(e,t){void 0===t&&(t=!0),e instanceof o?m.currentClient=e:m.currentClient.params=e,t&&A.clientCreateOrUpdate("Update client data",m.currentClient.params)},setCurrentClient:function(e){m.currentClient=e},getClientFromStore:function(){h.log("ClientManager:getClientFromStore");var e=V.getClientUuid(),t=V.getClientPermUuid(),n=V.getClientToken();if(!e)return h.log("ClientManager:getClientFromStore return:",null),null;if(!t)return h.log("ClientManager:getClientFromStore PermUuid not found"),h.log("ClientManager:getClientFromStore return:",null),null;var r=new o({uuid:e,permUuid:t,accessToken:n});return h.log("ClientManager:getClientFromStore return:",r),r},getAccessToken:function(){return m.currentClient&&m.currentClient.accessToken?m.currentClient.accessToken:null},setAccessToken:function(t){V.setClientToken(t)?m.getCurrentClient().then(function(e){m.currentClient.accessToken=t,h.log("ClientManager:setToken Token stored and set")}).catch(function(e){h.log("ClientManager:setToken Token stored but not set",e)}):h.log("ClientManager:setToken Failed to store token")},clearAccessToken:function(){m.currentClient&&m.currentClient.accessToken&&(m.currentClient.accessToken=null),V.removeClientToken()},getIdentityHash:function(){return SyneriseTC.identityHash},hashIdentity:function(e){return p.hashString(e)},setUuidAndIdentityHash:function(e,t){return SyneriseTC.setNewUUIDAndIdentityHash(e,t)},setUuid:function(n){return h.log("ClientManager:setUuid",n),new re(function(e,t){if(!p.validateUUID(n))return t(new TypeError("Uuid is invalid"));SyneriseTC.setNewUUIDAndIdentityHash("",n),SyneriseTC.pageVisit({}).then(function(){e(!0)}).catch(function(){t(new TypeError("Can't set new uuid"))})})}},g={_options:{notificationNewsletterHandlers:!0,disableNotification:!(o.prototype.renderNotification=function(a,c){var u=this;return new re(function(e,t){c=c||!1;var n=a.conditions&&a.conditions.delay?parseInt(a.conditions.delay,10):0;if(h.log("Client:renderNotification",a,"delay:",n,"forceRender:",c),!c){if(a.additionalParams&&a.additionalParams.popupAtLeave)return h.log("Client:renderNotification atach click handlers for leave popup"),F.attachHandlerForLeavePopup(u,a),void e();a.additionalParams&&a.additionalParams.popupTransparentBackground?F.turnOnPopupTransparentBackground():F.turnOffPopupTransparentBackground();var r=0,i=new Date;if(n){var o,s=B.get("_snrs_notify_delay_"+a.id);if(s?o=new Date(parseInt(s,10)):(o=new Date(i.getTime()+1e3*n),B.set("_snrs_notify_delay_"+a.id,o.getTime(),300)),h.log("Client:renderNotification check end date",o),0<(r=o.getTime()-i.getTime()))return h.log("Client:renderNotification set render timeout",r),setTimeout(function(){u.renderNotification(a,!0)},r),void e(a)}}a.render().then(function(){return B.remove("_snrs_notify_delay_"+a.id),re.resolve(a)}).then(function(e){return h.log("Client:renderNotification then",e,e.isRendered()),e.isRendered()&&V.setNotificationCapping(e),re.resolve(e)}).then(function(t){var e=!(!t.conditions||!t.conditions.trackEventShow);return h.log("Client:renderNotification track",t,e,t.isRendered()),t.isRendered()&&e&&U.track("","dynamicContent.show","",{id:t.id,title:t.name}).then(function(e){h.log("Notification:render show tracked",t)}),re.resolve(t)}).catch(function(e){h.error(e)}),e(a)})}),disableWebPush:!1,webpush:{},dynamicContent:{},lang:k,acceptLangList:k},_profileConfig:null,PROFILE_CONFIG_TYPE_NOTIFICATIONS:"notifications",PROFILE_CONFIG_TYPE_DATA_MARKER:"dataMarker",PROFILE_CONFIG_TYPE_PROVIDERS:"providers",PROFILE_CONFIG_TYPE_PROFILE:"profile",PROFILE_CONFIG_TYPE_WEBPUSH:"webPush",PROFILE_CONFIG_TYPE_COOKIE_MATCHERS:"cookieMatchers",getVersion:function(){return"3.8.7"},getModuleName:function(){return"default"},getBuildTime:function(){return"2022-06-14"},getFullVersion:function(){return g.getModuleName()+":"+g.getVersion()},getBuildHash:function(){return p.hashString(g.getFullVersion()+g.getBuildTime())+""},getOption:function(e){return void 0!==e?g._options[e]:g._options},init:function(r,e){return new re(function(e,t){g._options=I.extend(g._options,r),b.init(),g._options.lang?g._options.acceptLangList=[g._options.lang]:g._options.lang=b.getLanguage(),g._options.acceptLangList||(g._options.acceptLangList=b.getAcceptLanguageList()),h.log('Core:init module name: "'+g.getModuleName()+'", version: "'+g.getVersion()+'", build time: "'+g.getBuildTime()+'"'),h.log("Core:init with options",g._options);var n=B.get("_snrs_token");if(n&&q.isAvailable()&&V.setClientToken(n),g._options.trackerKey&&d.trackerKey(g._options.trackerKey),g._options.apiKey&&d.apiKey(g._options.apiKey),g._options.trackingDomain&&U.utils.setTrackingDomain(g._options.trackingDomain),!d.trackerKey())return t(new TypeError("TrackerKey is not set"));var i=[["setTracker",d.trackerKey()]];g._options.customPageVisit&&i.push(["setCustomPageVisit",g._options.customPageVisit]),g._options.cookieExpiration&&i.push(["setCookieExpiration",g._options.cookieExpiration]),g._options.domain&&i.push(["setDomain",g._options.domain]),void 0!==g._options.clientUuid&&g._options.clientUuid&&p.validateUUID(g._options.clientUuid)&&i.push(["setUuid",[g._options.clientUuid,!0]]),void 0!==g._options.triggerPageVisitOnHashChange&&i.push(["setTriggerPageVisitOnHashChange",g._options.triggerPageVisitOnHashChange]),g.getProfileConfig().then(function(n){return new re(function(e,t){A.init().then(function(){e(n)}).catch(function(e){h.error(e),t(new TypeError("Event list is not defined"))})})}).then(function(r){return new re(function(e,t){h.log("Core:init init tracker",i);var n=r.recognizeBy[0].name;i.push(["setIdentity",n]),SyneriseTC.init(i),e()})}).then(function(){return new re(function(t,n){g.initModulesForClient().then(function(e){h.log("Core:init done for client",e),t()}).catch(function(e){h.error(e),n(new TypeError("Client is not identified"))})})}).then(function(){return e(!0)}).catch(function(e){return t(e)})})},initModulesForClient:function(){return new re(function(t,n){m.getCurrentClient().then(function(n){return new re(function(e,t){if(h.log("Core:init dynamicContents"),g._options.disableDynamicContent||void 0===y)return e(n);y.init(g._options.dynamicContent).then(function(){M.init(),g._options.dynamicContent.virtualPage||n.renderDynamicContents()}).catch(function(e){h.error(e)}),e(n)})}).then(function(n){return new re(function(e,t){h.log("Core:init basic data"),"object"==typeof clientData&&(h.log("Core:init with client data",clientData),m.updateClientParams(clientData)),g._options.disableFormMarker||void 0===D||(D.init().catch(function(e){h.error(e)}),N.init().catch(function(e){h.error(e)})),"object"==typeof g._options.dataLayer&&void 0!==u&&u.init(g._options.dataLayer),e(n)})}).then(function(n){return new re(function(t,e){if(h.log("Core:init webpush"),g._options.disableWebPush||void 0===K)return t(n);K.init(g._options.webpush).then(function(){t(n)}).catch(function(e){t(n)})})}).then(function(n){return new re(function(e,t){if(h.log("Core:init notifications"),g._options.disableNotification||void 0===F)return e(n);F.init().then(function(){M.init(),n.renderNotifications()}).catch(function(e){h.error(e)}),e(n)})}).then(function(e){t(e)}).catch(function(e){n(e)})})},getProfileConfig:function(){return p.uniquePromiseHandler("Core:getProfileConfig",function(t,n){if(V.getProfileConfig()){var e=V.getProfileConfig();return h.log("Core:getProfileConfig RequestManager.getProfileConfig from localStorage",e),g._profileConfig=e,t(e)}if(g._profileConfig)return h.log("Core:getProfileConfig RequestManager.getProfileConfig from cache",g._profileConfig),t(g._profileConfig);U.getProfileConfig().then(function(e){h.log("Core:getProfileConfig RequestManager.getProfileConfig then",e),V.setProfileConfig(e),g._profileConfig=e,t(g._profileConfig)}).catch(function(e){n(e)})})},getProfileConfigByType:function(r){return new re(function(t,n){g.getProfileConfig().then(function(e){if(h.log("Core:getProfileConfigByType for type",r),!e)return t(null);t(e[r]||null)}).catch(function(e){n(e)})})},getWebPushProfileConfig:function(){return new re(function(o,t){var r=g.getOption("acceptLangList")?g.getOption("acceptLangList").join(","):k;g.getProfileConfig().then(function(e){return new re(function(t,n){if(h.log("Core:getWebPushProfileConfig get webpush config",e),g._profileConfig&&g._profileConfig[g.PROFILE_CONFIG_TYPE_WEBPUSH]!==k)return h.log("Core:getWebPushProfileConfig get from cache",g._profileConfig[g.PROFILE_CONFIG_TYPE_WEBPUSH]),t(g._profileConfig);U.getWebPushProfileConfig(r).then(function(e){h.log("Core:getWebPushProfileConfig RequestManager.getWebPushProfileConfig then",e),g._profileConfig[g.PROFILE_CONFIG_TYPE_WEBPUSH]=e,t(g._profileConfig)}).catch(function(e){n(e)})})}).then(function(e){if(h.log("Core:getWebPushProfileConfig",e),!(e&&e[g.PROFILE_CONFIG_TYPE_PROVIDERS]&&e[g.PROFILE_CONFIG_TYPE_PROFILE]&&e[g.PROFILE_CONFIG_TYPE_WEBPUSH]))return h.log("Core:getWebPushProfileConfig configs required for webpush are not defined.",e),h.log("Core:getWebPushProfileConfig configs isProvidersConfig: "+!!e[g.PROFILE_CONFIG_TYPE_PROVIDERS]+" isProfileConfig: "+!!e[g.PROFILE_CONFIG_TYPE_PROFILE]+" isWebPushConfig: "+!!e[g.PROFILE_CONFIG_TYPE_WEBPUSH]),o(null);var t=e[g.PROFILE_CONFIG_TYPE_PROFILE],n=e[g.PROFILE_CONFIG_TYPE_PROVIDERS];if(!n||!n.fcm)return h.log("Core:getWebPushProfileConfig Fcm settings are not configured.",n),o(null);var r={sender_id:n.fcm.sender_id,public_vapid:n.fcm.public_vapid,agreement_page_domain:"https://"+t.subdomain+".snrpush.com"};h.log("Core:getWebPushProfileConfig webpushData",e[g.PROFILE_CONFIG_TYPE_WEBPUSH]),h.log("Core:getWebPushProfileConfig extendData",r);var i=I.extend({},e[g.PROFILE_CONFIG_TYPE_WEBPUSH],r);o(i||null)}).catch(function(e){t(e)})})}},u={_allowDataLayerAction:["add","remove","purchase","refund"],_initObserverPush:!1,_localOrders:[],init:function(t){this.getLocalOrders();try{h.log("DataLayer:init",t),this.validData(t)&&(this.observerPush(t,this.eventData),this.eventsData(t))}catch(e){h.error("DataLayer:init",t,e)}},validData:function(e){return!!Array.isArray&&Array.isArray(e)},eventsData:function(e){var t=this;e.forEach(function(e){t.eventData(t,e)})},eventData:function(t,e){if(h.log("DataLayer:eventData - search ecommerce",e),"object"==typeof e.ecommerce&&null!==e.ecommerce){h.log("DataLayer:eventData - found ecommerce",e);var n=e.ecommerce;t._allowDataLayerAction.forEach(function(e){"object"==typeof n[e]&&"object"==typeof n[e].products&&("purchase"==e?t.trackPurchase(n,e):t.track(n,e))})}return!0},getParamsCookie:function(e){var t={};try{var n=B.getJson(e);if(n)for(var r in n)n.hasOwnProperty(r)&&r.match("(snrs?|utm)_.*")&&(t[r]=n[r])}catch(e){h.log("DataLayer:eventData - parse snrs_params",item)}return t},observerPush:function(e,t){if(!this._initObserverPush)if("function"==typeof e.push){var n=e.push,r=this;e.push=function(){try{h.log("DataLayer:observerPush - callback push",arguments[0]),t(r,arguments[0])}catch(e){try{h.error("DataLayer:observerPush - callback push error E: ",e)}catch(e){}}return n.apply(this,arguments)},this._initObserverPush=!0}else h.log("DataLayer:observerPush - dataLayer.push is not a function",item)},buildRequest:function(e,t){return{label:"datalayer.ecommerce",object:"datalayer."+t,params:{data:e,snrs_params:this.getParamsCookie("_snrs_params"),url:ne.location.href}}},track:function(e,t){var n=this.buildRequest(e,t);return U.trackProxy(n)},trackPurchase:function(e,t){if(e[t].actionField&&e[t].actionField.id){var n=e[t].actionField.id;if(-1<this._localOrders.indexOf(n))return void h.log("DataLayer:trackPurchase - duplicate transaction",n,this._localOrders);this.setLocalOrders(n);var r=this.buildRequest(e,t);return U.trackProxy(r)}},setLocalOrders:function(e){this._localOrders.push(e);var t=((new Date).getTime()+18e5)/1e3;q.setStringWithTtl("_snrs_orders",this._localOrders,t),h.log("DataLayer:setLocalOrders - set orders",e,this._localOrders)},getLocalOrders:function(){var e=q.getStringWithTtl("_snrs_orders");e&&(this._localOrders=e),h.log("DataLayer:getLocalOrders - get orders",this._localOrders)}},b={DEVICE_TYPE_DESKTOP:"desktop",DEVICE_TYPE_MOBILE:"mobile",_screen:null,_isCrawler:null,_canSaveCookies:k,_crawlerExclusionList:null,_crawlerList:["Googlebot","Mediapartners-Google","Web Preview","bot","Applebot","spider","crawler","Feedfetcher","Slurp","Twiceler","Nutch","BecomeBot","bingbot","BingPreview","Google Web Preview","WordPress.com mShots","Seznam","facebookexternalhit","Yandex","Teoma","ThumbSniper","Phantom","Nuhk","DuckDuckBot","sogou","Exabot","facebook","ia_archiver","slack","msnbot","adidxbot","Ask Jeeves"],init:function(){h.log("DeviceManager:init"),b._screen=b.getScreenInfo()},getScreenInfo:function(){var e=null,t=null,n=null,r=[],i=null;if(screen)e=screen.width+"x"+screen.height,t=screen.colorDepth+"-bit";else if(java){var o=java.awt.Toolkit.getDefaultToolkit().getScreenSize();e=o.width+"x"+o.height}navigator.language?n=navigator.language.toLowerCase():navigator.browserLanguage?n=navigator.browserLanguage.toLowerCase():navigator.languages&&navigator.languages.length&&(n=navigator.languages[0].toLowerCase()),navigator.languages&&navigator.languages.length?r=navigator.languages:n&&r.push(n),document.characterSet?i=p.encodeString(document.characterSet):document.charset&&(i=p.encodeString(document.charset));var s=b.DEVICE_TYPE_DESKTOP;if(e){var a=e.split("x");for(var c in s=b.DEVICE_TYPE_MOBILE,a)a.hasOwnProperty(c)&&1024<parseInt(a[c],10)&&(s=b.DEVICE_TYPE_DESKTOP)}return{encoding:i,resolution:e,color:t,language:n,deviceType:s,acceptLanguageList:r,isCrawler:b.isCrawler()}},getProtocol:function(){var e=void 0!==document.location.protocol?document.location.protocol:"https";return(e=e.replace(":","")).match("https?")||(e="https"),e},isCrawler:function(){if(null===b._isCrawler){b._isCrawler=!1;var e=navigator.userAgent||"";if(b._crawlerExclusionList&&(e=e.replace(new RegExp(b._crawlerExclusionList.join("|"),"g"),"").trim()),e){var t=new RegExp(b._crawlerList.join("|"),"g").exec(e);h.log("DeviceManager:isCrawler matches",e,t),t&&t.length&&(b._isCrawler=!0)}h.log("DeviceManager:isCrawler",b._isCrawler)}return!!b._isCrawler},checkDeviceType:function(e){return h.log("DeviceManager:checkDeviceType",e),I.isString(e)&&(e=[e]),I.inArray(b._screen.deviceType,e)},getAcceptLanguageList:function(){return h.log("DeviceManager:getAcceptLanguageList",b._screen.acceptLanguageList),b._screen.acceptLanguageList},getLanguage:function(){return h.log("DeviceManager:getLanguage",b._screen.language),b._screen.language},getOsInfo:function(){var e,t,n,r=navigator.appVersion,i=navigator.userAgent,o=navigator.appName,s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);-1!==(t=i.indexOf("Opera"))?(o="Opera",s=i.substring(t+6),-1!==(t=i.indexOf("Version"))&&(s=i.substring(t+8))):-1!==(t=i.indexOf("OPR/"))?(o="Opera",s=i.substring(t+4)):-1!==(t=i.indexOf("Edge"))?(o="Microsoft Edge",s=i.substring(t+5)):-1!==(t=i.indexOf("MSIE"))?(o="Microsoft Internet Explorer",s=i.substring(t+5)):-1!==(t=i.indexOf("Chrome"))?(o="Chrome",s=i.substring(t+7)):-1!==(t=i.indexOf("Safari"))?(o="Safari",s=i.substring(t+7),-1!==(t=i.indexOf("Version"))&&(s=i.substring(t+8))):-1!==(t=i.indexOf("Firefox"))?(o="Firefox",s=i.substring(t+8)):-1!==i.indexOf("Trident/")?(o="Microsoft Internet Explorer",s=i.substring(i.indexOf("rv:")+3)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(o=i.substring(e,t),s=i.substring(t+1),o.toLowerCase()==o.toUpperCase()&&(o=navigator.appName)),-1!==(n=s.indexOf(";"))&&(s=s.substring(0,n)),-1!==(n=s.indexOf(" "))&&(s=s.substring(0,n)),-1!==(n=s.indexOf(")"))&&(s=s.substring(0,n)),a=parseInt(""+s,10),isNaN(a)&&(s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10));var c=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(r),u=!!navigator.cookieEnabled;void 0!==navigator.cookieEnabled||u||(u=this.canSaveCookies());var l="-",d=[{s:"BOT",r:/(Googlebot|Mediapartners-Google|Web Preview|bot|Applebot|spider|crawler|Feedfetcher|Slurp|Twiceler|Nutch|BecomeBot|bingbot|BingPreview|Google Web Preview|WordPress.com mShots|Seznam|facebookexternalhit|Yandex|Teoma|ThumbSniper|Phantom|Nuhk|DuckDuckBot|sogou|Exabot|facebook|ia_archiver|slack|msnbot|adidxbot|Ask Jeeves)/},{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/}];for(var h in d)if(d.hasOwnProperty(h)){var f=d[h];if(f.r.test(i)){l=f.s;break}}var g="-";switch(/Windows/.test(l)&&(g=/Windows (.*)/.exec(l)[1],l="Windows"),l){case"Mac OS X":var p=/Mac OS X (10[\.\_\d]+)/.exec(i);null!==p&&(g=p[1]);break;case"Android":g=/Android ([\.\_\d]+)/.exec(i)[1];break;case"iOS":g=(g=/OS (\d+)_(\d+)_?(\d+)?/.exec(i))[1]+"."+g[2]+"."+(0|g[3])}return{browser:o,browserVersion:s,mobile:c,os:l,osVersion:g,cookies:u}},canSaveCookies:function(){return this._canSaveCookies===k&&(document.cookie="testcookie=1",this._canSaveCookies=-1!==document.cookie.indexOf("testcookie"),document.cookie="testcookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT"),this._canSaveCookies},isBrowseIE:function(){h.log("DeviceManager:isBrowseIE");var e=b.getOsInfo();return!(!e||"Microsoft Internet Explorer"!=e.browser)}};function v(e,t){if(t=t||!0,(e=e||{}).options=e.options||{},this._container=null,this._nodes=[],this._status=v.STATUS_NEW,this.id=e.id||null,this.subject=e.subject||null,this.displayType=e.displayType||null,this.toReRender=e.containsJinjava||e.isSegment||null,this.experimentVariantId=e.experimentVariantId||null,this.targetRestriction=new E(e.targetRestriction,!1),this.variants=[],Array.isArray(e.variants))for(var n in e.variants)e.variants.hasOwnProperty(n)&&(this.variants[n]=new P(e.variants[n],!1));this.viewsPage=new O({include:e.viewsPageUrl,exclude:e.viewsExcludePageUrl},!1),this.utm=new T(e.options.utm,!1),this.frequency=new S(e.frequency,!1),this.stopDisplay=new C(e.stopDisplay,!1),this.trigger=new w(e.trigger,!1),this.capping=new _(e.capping,!1),t&&this.validate()}v.DISPLAY_TYPE_OPTIONS_LIST=[v.DISPLAY_TYPE_OBJECT="OBJECT",v.DISPLAY_TYPE_LAYER="LAYER"],v.STATUS_RENDERED="RENDERED",v.STATUS_TRIGGERED="TRIGGERED",v.STATUS_WAITING_TO_TRIGGER="WAITING_TO_TRIGGER",v.STATUS_NEW="NEW",v.prototype.validate=function(){if(!this.id)throw new Error("Invalid id");if(!this.displayType||-1===v.DISPLAY_TYPE_OPTIONS_LIST.indexOf(this.displayType))throw new Error('Display type ("'+self.displayType+'") is incorrect, only '+v.DISPLAY_TYPE_OPTIONS_LIST.join(",")+" is allowed");if(!Array.isArray(this.variants)||!this.variants.length)throw new Error("Invalid variants");for(var e=0;e<this.variants.length;e++){var t=this.variants[e];t.validate();var n=t.getTargetSelector();switch(this.displayType){case v.DISPLAY_TYPE_OBJECT:if(!(n=t.getTargetSelector()))throw new Error("Target selector not defined");if(!p.validateSelector(n))throw new Error("Target selector is invalid",this);if(!t.getTargetSelectorPrefix())throw new Error("Target selector prefix not defined")}}return this.targetRestriction.validate(),this.viewsPage.validate(),this.utm.validate(),this.frequency.validate(),this.stopDisplay.validate(),this.trigger.validate(),this.capping.validate(),!0},v.prototype.hasNodes=function(){return!!this._nodes.length},v.prototype.getNodes=function(){return this._nodes},v.prototype.getObservableNodes=function(){var t=[],e=this._nodes;return I.each(e,function(e){1===e.nodeType&&e.nodeName&&!e.nodeName.toLowerCase().match(/style|script|meta|title/)&&t.push(e)}),t},v.prototype.getStatus=function(){return this._status},v.prototype.isToReRender=function(){return this.toReRender},v.prototype.isAbx=function(){return this.abx},v.prototype.getId=function(){return this.id},v.prototype.getSubject=function(){return this.subject},v.prototype.getVariant=function(){return this.variant||(this.variant=this.pickVariant()),this.variant},v.prototype.pickVariant=function(){var e=null;if(1===this.variants.length)e=this.variants[0];else{for(var t=H.getCachedDynamicContentVariantId(this.id),n=!1,r=0;r<this.variants.length;r++)this.variants[r].getId()==t&&(n=!0);if(!n)if(this.experimentVariantId)t=H.cacheDynamicContentVariantId(this.id,this.experimentVariantId);else{var i=this.drawVariant();t=H.cacheDynamicContentVariantId(this.id,i.getId())}for(r=0;r<this.variants.length;r++)if(this.variants[r].getId()==t){e=this.variants[r];break}}return e},v.prototype.drawVariant=function(){for(var e=0,t=0;t<this.variants.length;t++)e+=this.variants[t].getPercentage();var n=Math.ceil(Math.random()*e);for(t=0;t<this.variants.length;t++)if((n-=this.variants[t].getPercentage())<=0)return this.variants[t]},v.prototype.getVariantId=function(){return this.getVariant().getId()},v.prototype.getVariantName=function(){return this.getVariant().getName()},v.prototype.getContent=function(){return this.getVariant().getContent()},v.prototype.getTargetContainer=function(){var e=this.getVariant().getTargetSelector();return e?document.querySelector(e):null},v.prototype.getContentToRender=function(){return this.getVariant().getContentToRender()},v.prototype.isContentHtml=function(){return this.getVariant().isContentHtml()},v.prototype.isContentCss=function(){return this.getVariant().isContentCss()},v.prototype.isContentJs=function(){return this.getVariant().isContentJs()},v.prototype.isTriggerInstant=function(){return this.trigger.isInstant()},v.prototype.isRendered=function(){return this._status===v.STATUS_RENDERED},v.prototype.isDisplayTypeObject=function(){return this.displayType===v.DISPLAY_TYPE_OBJECT},v.prototype.setStatusRendered=function(){return this._status=v.STATUS_RENDERED,h.log("DynamicContent:setStatusRendered",this),this},v.prototype.setStatusWaitingToTrigger=function(){return this._status=v.STATUS_WAITING_TO_TRIGGER,h.log("DynamicContent:setStatusWaitingToTrigger",this),this},v.prototype.setStatusTriggered=function(){return this._status=v.STATUS_TRIGGERED,h.log("DynamicContent:setStatusTriggered",this),this},v.prototype.isStatusReadyToRender=function(){return I.inArray(this.getStatus(),[v.STATUS_NEW,v.STATUS_TRIGGERED])},v.prototype.isStatusNew=function(){return this.getStatus()===v.STATUS_NEW},v.prototype.isVisibleOnScreen=function(){return!!this.isRendered()&&p.isVisibleAtLeastOneElementOnScreen(this.getNodes())},v.prototype.getUtmWithParametersFlatMap=function(){return this.utm.getUtmWithParametersFlatMap()},v.prototype.render=function(){var r=this;return new re(function(e,t){h.log("DynamicContent:render",r);var n=document.createDocumentFragment();(r.displayType===v.DISPLAY_TYPE_LAYER?r.renderLayer(n):r.renderObject(n)).then(e).catch(t)})},v.prototype.renderLayer=function(n){var r=this;return new re(function(e,t){if(M.isShown())return t(new Error("Other layer shown"));I.containerInnerHtml(n,r.getContentToRender()),r._nodes=I.getNodesArray(n),y.attachHandlers(r).then(function(){M.setContent(n),r._container=M._contentCtr,r.isContentJs()&&I.executeScriptsForNodes(r.getNodes()),r.setStatusRendered(),M.show(),e()}).catch(t)})},v.prototype.renderObject=function(r){var i=this;return new re(function(e,t){var n=i.getTargetContainer();I.containerInnerHtml(r,i.getContentToRender()),i._nodes=I.getNodesArray(r),y.attachHandlers(i).then(function(){i.renderObjectForContainerByPrefix(n,r,i.getVariant().getTargetSelectorPrefix()),i._container=n,i.isContentJs()&&I.executeScriptsForNodes(i.getNodes()),i.setStatusRendered(),e()}).catch(t)})},v.prototype.renderObjectForContainerByPrefix=function(e,t,n){switch(n){case P.TARGET_SELECTOR_PREFIX_BEFORE:this.renderObjectForContainerBefore(e,t);break;case P.TARGET_SELECTOR_PREFIX_AFTER:this.renderObjectForContainerAfter(e,t);break;case P.TARGET_SELECTOR_PREFIX_INNER:this.renderObjectForContainerInner(e,t)}},v.prototype.renderObjectForContainerBefore=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw h.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert before",e,e.parentNode,this),new Error("Invalid node to insert before");I.insertBefore(e,t)},v.prototype.renderObjectForContainerAfter=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw h.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert after",e,e.parentNode,this),new Error("Invalid node to insert after");I.insertAfter(e,t)};var y={_virtualPage:!(v.prototype.renderObjectForContainerInner=function(e,t){if("html"===e.nodeName.toLowerCase())throw h.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert inner",e,this),new Error("Invalid node to insert inner");I.replaceChildren(e,t)}),_dynamicContents:null,_stylesUrl:[],_callbackStack:{customVariablesFunction:function(){return{}}},_selectorObservers:{},renderedDynamicContents:[],setCustomVariablesFunction:function(e){y._callbackStack.customVariablesFunction=e},prepareStyles:function(){var e=U.utils.getStyleUrl();return y._stylesUrl.push(e),x.loadStyles(y._stylesUrl)},init:function(n){return new re(function(e,t){y.prepareStyles(),H.clearExpiredKeysFromStore(),!0===n.virtualPage&&(y._virtualPage=!0),e()})},getDynamicContentByUuids:function(n,r){return new re(function(e,t){U.getDynamicContentByUuids(n,r).then(y.parseDataToObjects).then(y.filterUnsupportedDynamicContents).then(e).catch(function(e){t(e)})})},getDynamicContentsFiltered:function(n){return new re(function(e,t){U.getDynamicContentsFiltered(n).then(y.parseDataToObjects).then(y.setDynamicContentsCache).then(y.filterUnsupportedDynamicContents).then(e).catch(function(e){t(e)})})},setDynamicContentsCache:function(n){return new re(function(e,t){e(y._dynamicContents=n)})},findDynamicContenByUuid:function(i){return h.log("DynamicContentManager:findDynamicContenByUuid",i),new re(function(e,t){var n=y._dynamicContents;if(n){var r=[];return I.each(n,function(e){e.getId()==i&&r.push(e)}),e(r)}return t(new Error("Can not find dynamic content"))})},getDynamicContentsForClient:function(n){return h.log("DynamicContentManager:getDynamicContentsForClient",n),new re(function(e,t){y.getDynamicContentsFiltered(n).then(function(e){return h.log("DynamicContentManager:getDynamicContentsFiltered result",n),y.filterDynamicContentsForClient(n,e)}).then(e).catch(t)})},getDynamicContentByUuidsForClient:function(e,r){return h.log("DynamicContentManager:getgetDynamicContentByUuidsForClient",e),new re(function(t,n){y.getDynamicContentByUuids(e,r).then(function(e){t(e)}).catch(function(e){n(e)})})},parseDataToObjects:function(r){return new re(function(e,t){h.log("DynamicContentManager:parseToObjects");var n=[];I.isEmpty(r)||I.each(r,function(t){try{var e=new v(t);n.push(e)}catch(e){h.error("DynamicContentManager:parseToObjects error",e,t)}}),h.log("DynamicContentManager:parseToObjects after parse",n),e(n)})},filterDynamicContentsForClient:function(r,i){return h.log("DynamicContentManager:filterDynamicContentsForClient",r,i),new re(function(e,t){var n=[];if(I.isEmpty(i))return e(n);I.each(i,function(e){y.checkStopDisplay(e,r)&&y.checkFrequency(e,r)&&n.push(e)}),e(n)})},checkFrequency:function(e){if(!e.frequency.isLimited())return!0;var t;e.frequency.isSessionExpiration()&&(h.log("DynamicContentManager:checkFrequency renew session frequency expiration",e),y.renewFrequencyExpiration(e),t=setInterval(function(){h.log("DynamicContentManager:checkFrequency renew session frequency expiration after interval",e),y.renewFrequencyExpiration(e)},1e3*S.EXPIRATION_SESSION/10),setTimeout(function(){t&&(h.log("DynamicContentManager:checkFrequency stop renewing session frequency - timeout",e),clearInterval(t))},1e3*S.EXPIRATION_ON_PAGE_FOR_SESSION));var n=y.getFrequencyValue(e);return h.log("DynamicContentManager:checkFrequency frequencyValueStored",n),!e.frequency.checkFrequencyLimit(n)||(h.info("DynamicContentManager:checkFrequency - invalid",n),!1)},renewFrequencyExpiration:function(e){if(!e.frequency.isLimited())return 0;var t=H.renewFrequencyExpiration(e);return t?t.value:null},incrementFrequencyValue:function(e){return e.frequency.isLimited()?H.incrementFrequency(e).value:0},getFrequencyValue:function(e){if(!e.frequency.isLimited())return 0;var t=H.getFrequencyWithCheckExpiration(e);return t?t.value:null},filterUnsupportedDynamicContents:function(r){return new re(function(e,t){h.log("DynamicContentManager:filterUnsupportedDynamicContents",r);var n=[];if(I.isEmpty(r))return e(n);I.each(r,function(e){y.checkDevices(e)&&y.checkViewsPage(e)&&n.push(e)}),e(n)})},renderBatchDynamicContents:function(i){return new re(function(e,t){h.log("DynamicContentManager:renderBatchDynamicContents",i);var n=[],r=[];if(I.isEmpty(i))return e(n);I.each(i,function(e){if(e.isStatusReadyToRender()&&y.checkViewsPage(e)){if(e.isStatusNew()&&!e.isTriggerInstant());else if(e.isDisplayTypeObject()&&!e.getTargetContainer());else if(e.isToReRender())return void r.push(e)}else;n.push(e)}),h.log("DynamicContentManager:renderBatchDynamicContents::batched",r),0<r.length&&y.reRenderDynamicContents(r),e(n)})},checkDevices:function(e){var t=e.targetRestriction.getDevices();return!(t.length&&!b.checkDeviceType(function(e){var t={};t[E.TARGET_RESTRICTION_DESKTOP]=b.DEVICE_TYPE_DESKTOP,t[E.TARGET_RESTRICTION_MOBILE]=b.DEVICE_TYPE_MOBILE;var n=[];return I.each(e,function(e){n.push(t[e]?t[e]:e)}),n}(t)))||(h.info("DynamicContentManager:validDevices - invalid",t,e),!1)},checkViewsPage:function(e){return!!e.viewsPage.isMatchPageUrl(location.href)||(h.info("DynamicContentManager:checkViewsPage - invalid",location.href,e),!1)},attachTrigger:function(e){if(h.info("DynamicContentManager:attachTrigger",e,e.getStatus()),!e.isStatusNew()||e.isTriggerInstant())return re.resolve();switch(e.setStatusWaitingToTrigger(),e.trigger.getType()){case w.TYPE_ON_LANDING:return y.attachTriggerOnLanding(e);case w.TYPE_ON_EXIT:return y.attachTriggerOnExit(e);case w.TYPE_AFTER_SCROLL:return y.attachTriggerAfterScroll(e)}},attachTriggerOnLanding:function(e){if(h.info("DynamicContentManager:attachTriggerOnLanding",e,e.trigger.isDelay()),!e.trigger.isDelay())return re.resolve();var t=function(){H.removeTimeForDelay(e),y.renderDynamicContentForClientAfterTriggered(e)},n=new Date,r=H.getTimeForDelay(e);h.info("DynamicContentManager:attachTriggerOnLanding stored date time",r,e),null===r?r=H.setTimeForDelay(e,n):H.renewTimeForDelay(e);var i=r.getTime()-n.getTime();return 0<i?(h.log("DynamicContentManager:attachTriggerOnLanding set timeout",i,e),setTimeout(function(){t()},i)):t(),re.resolve()},attachTriggerOnExit:function(n){return h.info("DynamicContentManager:attachTriggerOnExit",n),p.addEvent(document,"mouseout",function e(t){t.clientY<=0&&(p.removeEvent(document,"mouseout",e),I.preventDefault(t),h.info("DynamicContentManager:attachTriggerOnExit mouseOut",t.clientY,n),y.renderDynamicContentForClientAfterTriggered(n))}),re.resolve()},attachTriggerAfterScroll:function(n){var r;function e(e){var t=p.getScrollPercentage();return!!n.trigger.checkScrollingAchieved(t)&&(r&&clearInterval(r),h.info("DynamicContentManager:attachTriggerAfterScroll scrollPercentage achieved",t,n),y.renderDynamicContentForClientAfterTriggered(n),!0)}return h.info("DynamicContentManager:attachTriggerAfterScroll",n,n.trigger.isDelay()),e()||(r=setInterval(e,250)),re.resolve()},attachHandlerForTrackEventShow:function(n){var t,r;function e(e){return!!n.isVisibleOnScreen()&&(t&&clearInterval(t),h.info("DynamicContentManager:attachHandlerForTrackEventShow dc is visible on screen",n),A.trackDynamicContentEventShow(n),!0)}if(h.info("DynamicContentManager:attachHandlerForTrackEventShow",n),"IntersectionObserver"in ne&&"IntersectionObserverEntry"in ne&&"intersectionRatio"in ne.IntersectionObserverEntry.prototype){var i=n.getObservableNodes();0<i.length&&(r=new IntersectionObserver(function(e,t){e[0].isIntersecting&&(h.info("DynamicContentManager:attachHandlerForTrackEventShow dc is visible on screen",n),A.trackDynamicContentEventShow(n),t.disconnect())},{}),I.each(i,function(e){r.observe(e)}))}else e()||(t=setInterval(e,200));return re.resolve()},attachTargetSelectorObserver:function(t){if(h.log("DynamicContentManager:attachTargetSelectorObserver",t),!y._selectorObservers[t.getId()]&&!1===y._virtualPage)try{var e=document.body||document,n=MutationObserver||WebKitMutationObserver||null,r="function"==typeof n,i=p.debounce(function(){t.getTargetContainer()&&(h.log("DynamicContentManager:attachTargetSelectorObserver::findTargetSelector",t),h.log("DynamicContentManager:attachTargetSelectorObserver::stopObserve",t),y._selectorObservers[t.getId()]&&(r?y._selectorObservers[t.getId()].disconnect():clearInterval(y._selectorObservers[t.getId()]),y._selectorObservers[t.getId()]=null),y.renderDynamicContentForClientAfterTriggered(t))},300,!1);r?(y._selectorObservers[t.getId()]=new n(i),y._selectorObservers[t.getId()].observe(e,{childList:!0,subtree:!0,attributes:!0})):y._selectorObservers[t.getId()]=setInterval(i,200)}catch(e){h.error("DynamicContentManager:attachTargetSelectorObserver::catch",e,t)}return re.resolve()},reRenderDynamicContents:function(t){return m.getCurrentClient().then(function(e){e.renderDynamicContentByUuids(t)}),re.resolve()},renderDynamicContentForClientAfterTriggered:function(e){h.info("DynamicContentManager:renderDynamicContentAfterTriggered",e),e.setStatusTriggered(),y.renderDynamicContentForCurrentClient(e)},renderDynamicContentForCurrentClient:function(n){return h.info("DynamicContentManager:renderDynamicContentForCurrentClient",n),new re(function(e,t){m.getCurrentClient().then(function(e){return e.renderDynamicContent(n)}).then(e).catch(t)})},attachHandlers:function(e){return h.info("DynamicContentManager:attachHandlers",e,e.hasNodes()),e.hasNodes()?re.all([y.attachHandlersForStopDisplaySettings(e)]):(h.info("DynamicContentManager:attachHandlers Nodes list empty",e),re.resolve())},attachHandlersForStopDisplaySettings:function(t){if(h.info("DynamicContentManager:attachHandlersForStopDisplaySettings",t,t.stopDisplay.isStopAfterAction()),!t.stopDisplay.isStopAfterAction())return re.resolve();function e(e){h.info("DynamicContentManager:attachHandlersForStopDisplaySettings handler",e,t),y.stopDisplayAnymore(t)}p.attachHandlerForElements(I.getElementsByTagNameIncludesItself(t.getNodes(),"a"),"click",e,!1),p.attachHandlerForElements(I.getElementsByTagNameIncludesItself(t.getNodes(),"button"),"click",e,!1)},stopDisplayAnymore:function(e){return H.stopDisplay(e)},checkStopDisplay:function(e){return h.info("DynamicContentManager:checkStopDisplay",e,e.stopDisplay.isStopDefined()),!e.stopDisplay.isStopDefined()||(!H.checkStopDisplay(e)||(h.info("DynamicContentManager:checkStopDisplay - stopped",e),!1))},incrementViewsForStopDisplay:function(e){if(!e.stopDisplay.isStopAfterShow())return 0;var t=H.incrementViewsForStopDisplay(e),n=y.getViewsForStopDisplay(e);return h.log("DynamicContentManager:incrementViewsForStopDisplay viewsValueStored",n),e.stopDisplay.checkShowTimesLimit(n)&&(h.info("DynamicContentManager:incrementViewsForStopDisplay - views limit achieved",n),y.stopDisplayAnymore(e),H.removeViewsForStopDisplay(e)),t},getViewsForStopDisplay:function(e){return e.stopDisplay.isStopAfterShow()?H.getViewsForStopDisplay(e):0},onAfterDynamicContentRender:function(n,e){return new re(function(e,t){new re(function(e,t){if(h.log("Client:renderDynamicContent increment views",n.isRendered(),n.capping.isLimited(),n),!n.isRendered()||!n.capping.isLimited())return e();U.incrementDynamicContentViews(n),e()}).then(function(){return new re(function(e,t){if(h.log("Client:renderDynamicContent incrementFrequency",n.frequency.isLimited(),n),!n.isRendered()||!n.frequency.isLimited())return e();y.incrementFrequencyValue(n),e()})}).then(function(){return new re(function(e,t){if(h.log("Client:renderDynamicContent incrementFrequency",n.frequency.isLimited(),n),!n.isRendered()||!n.stopDisplay.isStopAfterShow())return e();y.incrementViewsForStopDisplay(n),e()})}).then(function(){return new re(function(e,t){return h.log("Client:renderDynamicContent track show",n.isRendered(),n),n.isRendered()?y.attachHandlerForTrackEventShow(n):e()})}).then(e).catch(t)})},renderDynamicContentForClient:function(n,r){return new re(function(e,t){h.log("DynamicContentManager:renderDynamicContentForClient",r,n.isStatusReadyToRender(),n.getStatus(),n),(n.isStatusReadyToRender()&&y.checkViewsPage(n)?n.isStatusNew()&&!n.isTriggerInstant()?y.attachTrigger(n):n.isDisplayTypeObject()&&!n.getTargetContainer()?y.attachTargetSelectorObserver(n):n.isToReRender()?y.reRenderDynamicContents([n]):n.render().then(function(){return y.renderedDynamicContents.push(n),y.onAfterDynamicContentRender(n,r)}):re.resolve(!1)).then(function(){e(n.isRendered())}).catch(function(e){h.error(e,self,n),t(new Error("Can not render dynamic content"))})})},reRenderDynamicContentForClient:function(n,r){return new re(function(e,t){h.log("DynamicContentManager:reRenderDynamicContentForClient",r,n.isStatusReadyToRender(),n.getStatus(),n),(n.isStatusReadyToRender()?n.render().then(function(){return y.renderedDynamicContents.push(n),y.onAfterDynamicContentRender(n,r)}):re.resolve(!1)).then(function(){e(n.isRendered())}).catch(function(e){h.error(e,self,n),t(new Error("Can not reRender dynamic content"))})})},getRenderedDynamicContent:function(){return y.renderedDynamicContents},getVariables:function(){try{var t=this._callbackStack.customVariablesFunction()}catch(e){h.error("DynamicContentManager:getVariables -> customVariablesFunction error",e),t={}}try{var n=SyneriseTC.getOgTag()}catch(e){h.error("DynamicContentManager:getVariables -> SyneriseTC.getOgTag error",e),n={}}"object"!=typeof n&&(n={}),"object"!=typeof t&&(t={});var e=I.extend({},n,t);for(var r in e)"string"!=typeof e[r]&&delete e[r];return e},getVariants:function(){var e=H.getDynamicContentsVariants();return"object"!=typeof e&&(e={}),I.extend({},e)}};function _(e,t){t=t||!0,e=e||{},this.viewsLimit=null,e.viewsLimit&&(this.viewsLimit=parseInt(e.viewsLimit,10)),t&&this.validate()}function S(e,t){t=t||!0,e=e||{},this._count=null,this._expiration=null,this.type=e.type,this.options=I.extend({count:null,times:null,timesType:null},e.options),this.options.count=this.options.count?parseInt(this.options.count,10):null,this.options.times=this.options.times?parseInt(this.options.times,10):null,this.calculateCountAndExpiration(),t&&this.validate()}function C(e,t){t=t||!0,e=e||{},this._count=null,this._expiration=null,this.type=e.type,this.options=I.extend({times:null},e.options),this.options.times=this.options.times?parseInt(this.options.times,10):null,t&&this.validate()}function E(e,t){t=t||!0,this.options=e||[],t&&this.validate()}function w(e,t){switch(t=t||!0,e=e||{},this._delayInSeconds=null,this.type=e.type,this.options={},this.type){case w.TYPE_ON_LANDING:this.options=I.extend({delayType:null,delayValue:null},e.options),this.options.delayValue=this.options.delayValue?parseInt(this.options.delayValue,10):null,this.calculateDelayInSeconds();break;case w.TYPE_AFTER_SCROLL:this.options=I.extend({scrollingPercentage:null},e.options),this.options.scrollingPercentage=this.options.scrollingPercentage?parseInt(this.options.scrollingPercentage,10):null}t&&this.validate()}function T(e,t){t=t||!0,e=e||{},this.utm={utmCampaign:e.utmCampaign,utmMedium:e.utmMedium,utmSource:e.utmSource},this.parameters=I.extend({},e.parameters),t&&this.validate()}function P(e,t){t=t||!0,this.options=I.extend({id:null,name:null,percentage:null,content:{css:"",html:"",js:"",raw:""},selector:null,selectorPrefix:null},e),t&&this.validate()}function O(e,t){t=t||!0,this.options=I.extend({},{include:[],exclude:[]},e),t&&this.validate()}_.prototype.validate=function(){if(null!==this.viewsLimit&&isNaN(this.viewsLimit))throw new Error("Invalid views limit");return!0},_.prototype.isLimited=function(){return null!==this.viewsLimit},_.prototype.getViewsLimit=function(){return this.viewsLimit},S.TYPE_OPTIONS_LIST=[S.TYPE_ALWAYS="ALWAYS",S.TYPE_ONCE="ONCE",S.TYPE_ONCE_PER_VISIT="ONCE_PER_VISIT",S.TYPE_ONCE_PER_DAY="ONCE_PER_DAY",S.TYPE_MAXIMUM="MAXIMUM"],S.TIME_TYPE_OPTIONS_LIST=[S.TIME_TYPE_HOURS="HOURS",S.TIME_TYPE_DAYS="DAYS",S.TIME_TYPE_WEEKS="WEEKS"],S.EXPIRATION_SESSION=300,S.EXPIRATION_ON_PAGE_FOR_SESSION=1800,S.EXPIRATION_HOUR=3600,S.EXPIRATION_DAY=86400,S.EXPIRATION_WEEK=604800,S.EXPIRATION_MAX_VALUE=2592e3,S.prototype.validate=function(){var e=this.getType();if(!I.inArray(e,S.TYPE_OPTIONS_LIST))throw new Error('Frequency type ("'+e+'") is incorrect, only ['+S.TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(e===S.TYPE_MAXIMUM){if(!I.inArray(this.options.timesType,S.TIME_TYPE_OPTIONS_LIST))throw new Error('Frequency time type ("'+this.options.timesType+'") is incorrect, only ['+S.TIME_TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(null===this.options.count||isNaN(this.options.count))throw new Error("Invalid count limit");if(null===this.options.times||isNaN(this.options.times))throw new Error("Invalid times limit")}return!0},S.prototype.isLimited=function(){return this.getType()!==S.TYPE_ALWAYS},S.prototype.getType=function(){return this.type},S.prototype.getExpiration=function(){return this._expiration},S.prototype.isExpiration=function(){return null!==this._expiration},S.prototype.isSessionExpiration=function(){return this.isExpiration()&&this.getType()===S.TYPE_ONCE_PER_VISIT},S.prototype.getCount=function(){return this._count},S.prototype.isCount=function(){return null!==this._count},S.prototype.calculateCountAndExpiration=function(){switch(this.type){case S.TYPE_ALWAYS:this._count=null,this._expiration=null;break;case S.TYPE_ONCE:this._count=1,this._expiration=S.EXPIRATION_MAX_VALUE;break;case S.TYPE_ONCE_PER_VISIT:this._count=1,this._expiration=S.EXPIRATION_SESSION;break;case S.TYPE_ONCE_PER_DAY:this._count=1,this._expiration=S.EXPIRATION_DAY;break;case S.TYPE_MAXIMUM:if(this._count=isNaN(this.options.count)?null:this.options.count,(this._expiration=null)!==this._count&&!isNaN(this.options.times))switch(this.options.timesType){case S.TIME_TYPE_HOURS:this._expiration=this.options.times*S.EXPIRATION_HOUR;break;case S.TIME_TYPE_DAYS:this._expiration=this.options.times*S.EXPIRATION_DAY;break;case S.TIME_TYPE_WEEKS:this._expiration=this.options.times*S.EXPIRATION_WEEK}}},S.prototype.checkFrequencyLimit=function(e){return h.log("DynamicContentFrequency:checkFrequencyLimit",e,this._count,this),this.isCount()&&this.getCount()<=e},C.TYPE_OPTIONS_LIST=[C.TYPE_NEVER="NEVER",C.TYPE_AFTER_ACTION="AFTER_ACTION",C.TYPE_AFTER_SHOW="AFTER_SHOW"],C.STOP_DISPLAY_EXPIRATION_MAX_VALUE=2592e3,C.prototype.validate=function(){var e=this.getType();if(!I.inArray(e,C.TYPE_OPTIONS_LIST))throw new Error('Stop display type ("'+e+'") is incorrect, only ['+C.TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(e===C.TYPE_AFTER_SHOW&&(null===this.options.times||isNaN(this.options.times)))throw new Error("Invalid times limit");return!0},C.prototype.isStopDefined=function(){return this.getType()!==C.TYPE_NEVER},C.prototype.getType=function(){return this.type},C.prototype.getShowTimes=function(){return this.options.times},C.prototype.isShowTimes=function(){return this.isStopAfterShow()},C.prototype.isStopAfterShow=function(){return this.getType()===C.TYPE_AFTER_SHOW},C.prototype.isStopAfterAction=function(){return this.getType()===C.TYPE_AFTER_ACTION},C.prototype.checkShowTimesLimit=function(e){return h.log("DynamicContentStopDisplay:checkShowTimesLimit",e,this.getShowTimes(),this),this.isShowTimes()&&this.getShowTimes()<=e},E.TARGET_RESTRICTION_OPTIONS_LIST=[E.TARGET_RESTRICTION_MOBILE="MOBILE",E.TARGET_RESTRICTION_DESKTOP="DESKTOP"],E.prototype.validate=function(){if(!Array.isArray(this.options))throw new Error("Invalid target restriction options");var e=this.getDevices();return e.length&&I.each(e,function(e){if(!I.inArray(e,E.TARGET_RESTRICTION_OPTIONS_LIST))throw new Error('Target selector prefix ("'+e+'") is incorrect, only ['+E.TARGET_RESTRICTION_OPTIONS_LIST.join(",")+"] is allowed")}),!0},E.prototype.getDevices=function(){return this.options},w.TYPE_OPTIONS_LIST=[w.TYPE_ON_LANDING="ON_LANDING",w.TYPE_ON_EXIT="ON_EXIT",w.TYPE_AFTER_SCROLL="AFTER_SCROLL"],w.DELAY_TYPE_OPTIONS_LIST=[w.DELAY_TYPE_SECONDS="SECONDS",w.DELAY_TYPE_MINUTES="MINUTES"],w.TRIGGER_DELAY_EXPIRATION_VALUE=300,w.prototype.validate=function(){var e=this.getType();if(!I.inArray(e,w.TYPE_OPTIONS_LIST))throw new Error('Trigger type ("'+e+'") is incorrect, only ['+w.TYPE_OPTIONS_LIST.join(",")+"] is allowed");switch(e){case w.TYPE_ON_LANDING:if(null!==this.options.delayValue){if(isNaN(this.options.delayValue))throw new Error("Invalid delay value");if(!I.inArray(this.options.delayType,w.DELAY_TYPE_OPTIONS_LIST))throw new Error('Delay type ("'+this.options.delayType+'") is incorrect, only ['+w.DELAY_TYPE_OPTIONS_LIST.join(",")+"] is allowed")}break;case w.TYPE_AFTER_SCROLL:if(null===this.options.scrollingPercentage||isNaN(this.options.scrollingPercentage))throw new Error("Invalid scrolling percentage")}return!0},w.prototype.isInstant=function(){return this.getType()===w.TYPE_ON_LANDING&&!this.isDelay()},w.prototype.getType=function(){return this.type},w.prototype.isDelay=function(){return null!==this.options.delayValue},w.prototype.getDelay=function(){return this.options.delayValue},w.prototype.getDelayType=function(){return this.options.delayType},w.prototype.getScrollingPercentage=function(){return this.options.scrollingPercentage},w.prototype.isTypeOnLanging=function(){return this.getType()===w.TYPE_ON_LANDING},w.prototype.isTypeOnExit=function(){return this.getType()===w.TYPE_ON_EXIT},w.prototype.isTypeAfterScroll=function(){return this.getType()===w.TYPE_AFTER_SCROLL},w.prototype.getDelayInSeconds=function(){return this._delayInSeconds},w.prototype.isDelayInSeconds=function(){return null!==this._delayInSeconds},w.prototype.calculateDelayInSeconds=function(){if(null!==this.options.delayValue&&!isNaN(this.options.delayValue))switch(this.options.delayType){case w.DELAY_TYPE_SECONDS:this._delayInSeconds=this.options.delayValue;break;case w.DELAY_TYPE_MINUTES:this._delayInSeconds=60*this.options.delayValue}},w.prototype.checkScrollingAchieved=function(e){return this.isTypeAfterScroll()&&this.getScrollingPercentage()<=e},T.prototype.validate=function(){return!0},T.prototype.getUtm=function(){return this.utm},T.prototype.getUtmCampaign=function(){return this.utm.utmCampaign},T.prototype.getUtmMedium=function(){return this.utm.utmMedium},T.prototype.getUtmSource=function(){return this.utm.utmSource},T.prototype.getParameters=function(){return this.parameters},T.prototype.getUtmWithParametersFlatMap=function(){return I.extend({},this.getParameters(),this.getUtm())},P.TARGET_SELECTOR_PREFIX_OPTIONS_LIST=[P.TARGET_SELECTOR_PREFIX_BEFORE="BEFORE",P.TARGET_SELECTOR_PREFIX_AFTER="AFTER",P.TARGET_SELECTOR_PREFIX_INNER="INNER"],P.prototype.validate=function(){if(!this.getName())throw new Error("Name not defined");var e=this.getTargetSelectorPrefix();if(e&&!I.inArray(e,P.TARGET_SELECTOR_PREFIX_OPTIONS_LIST))throw new Error('Target selector prefix ("'+e+'") is incorrect, only ['+P.TARGET_SELECTOR_PREFIX_OPTIONS_LIST.join(",")+"] is allowed");return!0},P.prototype.getId=function(){return this.options.id},P.prototype.getName=function(){return this.options.name},P.prototype.getPercentage=function(){return this.options.percentage},P.prototype.getContent=function(){return this.options.content},P.prototype.getTargetSelector=function(){return this.options.selector},P.prototype.getTargetSelectorPrefix=function(){return this.options.selectorPrefix},P.prototype.isContent=function(){return this.isContentHtml()||this.isContentCss()||this.isContentJs()},P.prototype.isContentHtml=function(){return!!this.getContent().html},P.prototype.isContentCss=function(){return!!this.getContent().css},P.prototype.isContentJs=function(){return!!this.getContent().js},P.prototype.getContentHtml=function(){return this.getContent().html},P.prototype.getContentCss=function(){return this.getContent().css},P.prototype.getContentJs=function(){return this.getContent().js},P.prototype.getContentToRender=function(){var e="";return this.isContentCss()&&(e+=this.getContentCssToRender()),this.isContentHtml()&&(e+=this.getContentHtmlToRender()),this.isContentJs()&&(e+=this.getContentJsToRender()),e},P.prototype.getContentHtmlToRender=function(){return this.getContentHtml()},P.prototype.getContentCssToRender=function(){return'<style type="text/css">'+this.getContentCss()+"</style>"},P.prototype.getContentJsToRender=function(){return'<script type="application/javascript">'+this.getContentJs()+"<\/script>"},O.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST=[O.VIEWS_PAGE_URL_TYPE_EQUALS="EQUALS",O.VIEWS_PAGE_URL_TYPE_CONTAIN="CONTAIN",O.VIEWS_PAGE_URL_TYPE_REGEXP="REGEXP"],O.prototype.validate=function(){if(!Array.isArray(this.options.include)||!Array.isArray(this.options.exclude))throw new Error("Invalid views page url options");return I.each(this.options,function(e,t){Array.isArray(e)&&I.each(e,function(e){if(!I.inArray(e.type,O.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST))throw new Error('Type of views page url ("'+e.type+'") is incorrect, only ['+O.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST.join(",")+'] is allowed (in "'+t+'" mode)')})}),!0},O.prototype.getIncludePages=function(){return this.options.include},O.prototype.getExcludePages=function(){return this.options.exclude},O.prototype.isIncludePages=function(){return this.options.include&&this.options.include.length},O.prototype.isExcludePages=function(){return this.options.exclude&&this.options.exclude.length};var A={EVENT_LIST_SIGNED_IDENTIFIED:"signedIdentifiedActions",jwtRequired:!0,eventList:{},objectToActionMapping:{"event.track":"event.log","product.add":"product.addToCart","product.remove":"product.removeFromCart","client.data":"client.createOrUpdate","client.logIn":"client.login","client.logOut":"client.logout","custom.event":"customEvent.log"},init:function(){return new re(function(t,n){A.getEventListByType(A.EVENT_LIST_SIGNED_IDENTIFIED).then(function(e){A.jwtRequired=Array.isArray(e)&&0<e.length,t()}).catch(function(e){h.error("EventManager:init EventManager.getEventListByType Error",e),n(e)})})},track:function(e,t){h.log("EventManager:track",e,t);var n={label:e,object:"event.track",params:t=I.extend({url:ne.location.href},t||{})};return U.trackProxy(n)},clientCreateOrUpdate:function(e,t){h.log("EventManager:clientCreateOrUpdate",e,t);var n={label:e,object:"client.data",params:t=I.extend({url:ne.location.href},t||{})};String.prototype.hashCode=function(){var e,t,n=0;if(0===this.length)return n;for(e=0,t=this.length;e<t;e++)n=(n<<5)-n+this.charCodeAt(e),n|=0;return n};var r=JSON.stringify(n).hashCode(),i=localStorage.getItem("snrsClientHashCode");if(h.log("EventManager:clientCreateOrUpdate: currentHashCode & lcHashCode",r,i),typeof i===k||i!=r)return h.log("EventManager:clientCreateOrUpdate: SEND REQUEST:",n),localStorage.setItem("snrsClientHashCode",r),U.trackProxy(n)},sendFormData:function(n,r,i,o,s){return new re(function(e,t){SyneriseTC.sendFormData(n,r,i,o,s).then(e).catch(t)})},pageVisit:function(n){return new re(function(e,t){SyneriseTC.pageVisit(n).then(e).catch(t)})},trackCustomEvent:function(r,i,o){return h.log("EventManager:trackCustomEvent",r,i,o),new re(function(t,n){m.getCurrentClient().then(function(e){return e?e.uuid?r?(i=i||{},void U.track("",r,o,i).then(function(e){h.log("EventManager:trackCustomEvent fetch then",e),t(e)}).catch(function(e){h.error("EventManager:trackCustomEvent fetch error",e),n(e)})):n(new Error("Action is required")):n(new Error("Client is not identified")):n(new Error("Client not exists"))}).catch(function(e){h.error("Can not get current client",e),n(new Error("Client not exists"))})})},trackClientEvent:function(r,i,o){return h.log("EventManager:trackClientEvent",r,i,o),new re(function(t,n){m.getCurrentClient().then(function(e){return e?e.uuid?i?(o=o||{},void U.track(r,i,e.uuid,o).then(function(e){h.log("EventManager:trackClientEvent fetch then",e),t(e)}).catch(function(e){h.error("EventManager:trackClientEvent fetch error",e),n(e)})):n(new Error("Action is required")):n(new Error("Client is not identified")):n(new Error("Client not exists"))}).catch(function(e){h.error("Can not get current client",e),n(new Error("Client not exists"))})})},trackDynamicContentEventShow:function(e){h.log("EventManager:trackDynamicContentEventShow",e);var t={id:e.getId(),title:e.getSubject(),variantId:e.getVariantId(),variantName:e.getVariantName()};e.frequency.isLimited()&&(t.frequencyCounter=y.getFrequencyValue(e),t.frequencyLimitAchieved=!y.checkFrequency(e));var n=e.getUtmWithParametersFlatMap();return t=I.extend({},n||{},t),A.trackClientEvent("","dynamicContent.show",t)},getEventListByType:function(n){return new re(function(t,e){if(A.eventList[n]!==k)return t(A.eventList[n]);g.getProfileConfigByType(n).then(function(e){if(h.log("EventManager:getEventListByType for type",n),!e)throw new Error("EventManager:getEventListByType Failed to fetch config.");return A.eventList[n]=e,t(A.eventList[n])}).catch(function(e){return t(e)})})},requiresAuthorization:function(n){return new re(function(t,e){n||t(!1),A.getEventListByType(A.EVENT_LIST_SIGNED_IDENTIFIED).then(function(e){t(null===e||e.includes(n))}).catch(function(e){h.error("EventManager:isSignedIdentified EventManager.getEventListByType Error",e),t(!0)})})},mapObjectToAction:function(e){return this.objectToActionMapping[e]||e}},D={_dataMarker:null,_blockReloadInitForm:!(O.prototype.isMatchPageUrl=function(e){h.log("DynamicContentViewsPage:isMatchPageUrl",e,this.options,this);var r=this;function i(e,t,n){switch(n){case O.VIEWS_PAGE_URL_TYPE_EQUALS:return e===t;case O.VIEWS_PAGE_URL_TYPE_CONTAIN:return-1!==e.indexOf(t);case O.VIEWS_PAGE_URL_TYPE_REGEXP:try{return new RegExp(t,"m").test(e)}catch(e){throw h.error("DynamicContentViewsPage:isMatchPageUrl RegExp invalid",t,n,e,r),e}}}function t(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(i(e,r.requirement,r.type))return r}return!1}if(this.isIncludePages()){if(!1===(n=t(e,this.getIncludePages())))return h.log("DynamicContentViewsPage:isMatchPageUrl included - not allowed",this.getIncludePages(),this),!1;h.log("DynamicContentViewsPage:isMatchPageUrl included - allowed",n,this)}if(this.isExcludePages()){var n;if(!1!==(n=t(e,this.getExcludePages())))return h.log("DynamicContentViewsPage:isMatchPageUrl excluded - not allowed",n,this.getExcludePages(),this),!1;h.log("DynamicContentViewsPage:isMatchPageUrl excluded - allowed",this)}return!0}),_isInitObserveMarker:!1,init:function(){try{return new re(function(e,t){D.getDataMarker().then(function(e){h.log("FormMarker:init  FormMarker.getDataMarker() then",e),D.marker(e)}).then(function(){D.bindLiveFormMarker()}).catch(function(e){h.error(e),t(e)})})}catch(e){h.error("FormMarker::init",e)}},reloadInitForm:function(){0==D._blockReloadInitForm&&(D._blockReloadInitForm=!0,setTimeout(function(){D._blockReloadInitForm=!1,D.init()},1e3))},getDataMarker:function(){return new re(function(t,n){D._dataMarker?(h.log("FormMarker:getFormMarker RequestManager.getFormMarker from cache",D._dataMarker),t(D._dataMarker)):g.getProfileConfigByType(g.PROFILE_CONFIG_TYPE_DATA_MARKER).then(function(e){return h.log("FormMarker:getFormMarker RequestManager.getFormMarker then",e),re.resolve(e)}).catch(function(e){n(e)}).then(function(e){h.log("FormMarker:getFormMarker RequestManager.getFormMarker then filtered",e),D._dataMarker=e,t(D._dataMarker)}).catch(function(e){n(e)})})},marker:function(t){try{h.log("FormMarker:marker",t),this.validData(t)&&this.markerForm(t)}catch(e){h.error("FormMarker:marker",t,e)}},validData:function(e){return!!Array.isArray&&Array.isArray(e)},addAttribute:function(e,t){h.log("FormMarker:addAttribute",e,t),e.setAttribute("data-synerise",t)},addDataValue:function(e,t){h.log("FormMarker:addDataValue",e,t),e.setAttribute("data-synerise-value",t)},checkCondition:function(e){return!(e.conditions_include_page&&-1==document.URL.indexOf(e.conditions_include_page)||e.conditions_exclude_page&&-1!==document.URL.indexOf(e.conditions_exclude_page))},markerForm:function(e){var n=this,r=[];e.forEach(function(t){if(t.selector&&n.checkCondition(t)){var e=document.querySelectorAll(t.selector);h.log("FormMarker:markerForm search selector: ["+t.selector+"] found: "+e.length),e.forEach(function(e){t.attribute&&!e.hasAttribute("data-synerise")&&(n.addAttribute(e,t.attribute),"form"==e.tagName.toLowerCase()&&r.push(e)),""==t.data_value||e.hasAttribute("data-value")||n.addDataValue(e,t.data_value)})}}),n.tcSyneriseForm(r)},bindLiveFormMarker:function(){if(0==D._isInitObserveMarker)if(h.log("bindLiveFormMarker init!"),D._isInitObserveMarker=!0,"MutationObserver"in ne){var e=document.querySelector("body");new MutationObserver(function(e){var r=new RegExp("<s*form","i");e.forEach(function(e){for(var t=0;t<e.addedNodes.length;++t){var n=e.addedNodes[t].nodeValue?e.addedNodes[t].nodeValue:e.addedNodes[t].outerHTML;r.test(n)&&(h.log("bindLiveFormMarker call reloadInitForm:",e.addedNodes[t]),D.reloadInitForm())}})}).observe(e,{attributes:!1,childList:!0,characterData:!1})}else h.log("[FormMarker] bindLiveFormMarker MutationObserver is not supported by your browser."),setTimeout(D.reloadInitForm(),3e3)},tcSyneriseForm:function(e){h.log("FormMarker:tcSyneriseForm"),e.forEach(function(e){h.log("FormMarker:initFormCatch element: ",e),SyneriseTC.initFormCatch(e)})}},N={init:function(){var n=this;return new re(function(e,t){"#_snrs_tool_marker"==ne.location.hash&&(B.set("_snrs_tool_marker",1),n.removeHashFromUrl()),1==B.get("_snrs_tool_marker")&&n.appendToolMarker()})},appendToolMarker:function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://www.snrcdn.net/tracker-marker/2.0/syneriseToolMarker.min.js",document.body.appendChild(e)},removeHashFromUrl:function(){history.pushState("",document.title,ne.location.pathname+ne.location.search)}},M={_initialized:!1,_html:'<div class="snrs-modal-wrapper"><div class="snrs-modal"><div class="snrs-modal-btn-close"></div><div class="snrs-modal-content"></div><div class="popup-backdrop"></div></div></div>',_container:null,_containerModal:null,_contentCtr:null,_closeBtn:null,_modalShowClass:"snrs-modal-show",_hideClass:"snrs-hide",_transparentModalClass:"snrs-transparent-modal",_cancelBtnClass:"snrs-notify--cancel",_closeBtnClass:"snrs-notify--close",_saveBtnClass:"snrs-notify--allow",_callbackStack:{onCancel:function(){},onClose:function(){},onSave:function(){},onShow:function(){},onHide:function(){}},_attachGeneralActions:function(){h.log("Modal:_attachGeneralActions"),M._closeBtn&&p.addEvent(M._closeBtn,"click",function(e){M.close()})},_modalCloseBtnVisibility:function(e){if(h.log("Modal:_modalCloseBtnVisibility",e),!M._closeBtn)return!1;e?p.removeClass(M._closeBtn,M._hideClass):p.addClass(M._closeBtn,M._hideClass)},_triggerCallback:function(e){if(h.log("Modal:_triggerCallback",e),M._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=M._callbackStack[e];if(I.isFunction(r))if(!1===r.apply(M,t))return!1}},_attachContentActions:function(){h.log("Modal:_attachContentActions");var e=M._contentCtr.getElementsByClassName(M._cancelBtnClass);h.log("Modal:_attachContentActions attach cancel items",e.length,e),0<e.length&&I.each(e,function(e,t){p.addEvent(e,"click",function(e){h.log("Modal:_attachGeneralActions action - on cancel ",e,this),M.cancel()})});var t=M._contentCtr.getElementsByClassName(M._closeBtnClass);h.log("Modal:_attachContentActions attach close items",t.length,t),0<t.length?(M._modalCloseBtnVisibility(!1),I.each(t,function(e,t){p.addEvent(e,"click",function(e){h.log("Modal:_attachGeneralActions action - on close ",e,this),M.close()})})):M._modalCloseBtnVisibility(!0);var n=M._contentCtr.getElementsByClassName(M._saveBtnClass);h.log("Modal:_attachContentActions attach save items",n.length,n),0<n.length&&I.each(n,function(e,t){p.addEvent(e,"click",function(e){h.log("Modal:_attachGeneralActions action - on save ",e,this),M.save()})})},onCancel:function(e){M._callbackStack.onCancel=e},onClose:function(e){M._callbackStack.onClose=e},onSave:function(e){M._callbackStack.onSave=e},onShow:function(e){M._callbackStack.onShow=e},onHide:function(e){M._callbackStack.onHide=e},init:function(){if(h.log("Modal:init - initialized:",M._initialized),!M._initialized){var e=document.createElement("div");e.innerHTML=M._html,M._container=e.childNodes[0],M._contentCtr=M._container.querySelector(".snrs-modal-content"),M._closeBtn=M._container.querySelector(".snrs-modal-btn-close"),M._containerModal=M._container.querySelector(".snrs-modal"),document.body&&(document.body.appendChild(M._container),M._attachGeneralActions()),M._initialized=!0}},setContent:function(e){h.log("Modal:setContent",!!e),I.replaceChildren(M._contentCtr,e),M._attachContentActions()},show:function(){var e=M.isShown();h.log("Modal:show - hasShow",!!e),e||(p.addClass(M._container,M._modalShowClass),M._triggerCallback("onShow"))},hide:function(){var e=M.isShown();h.log("Modal:hide - hasShow",!!e),e&&(p.removeClass(M._container,M._modalShowClass),M._triggerCallback("onHide"))},isShown:function(){return p.hasClass(M._container,M._modalShowClass)},isTransparentModal:function(){return p.hasClass(M._containerModal,M._transparentModalClass)},turnOnTransparentModal:function(){M.isTransparentModal()||p.addClass(M._containerModal,M._transparentModalClass)},turnOffTransparentModal:function(){M.isTransparentModal()&&p.removeClass(M._containerModal,M._transparentModalClass)},isHidden:function(){return!M.isShown()},cancel:function(){M.isShown()&&(!1!==M._triggerCallback("onCancel")&&M.hide())},close:function(){M.isShown()&&(!1!==M._triggerCallback("onClose")&&M.hide())},save:function(){M.isShown()&&(!1!==M._triggerCallback("onSave")&&M.hide())}};function L(e){e=e||{},this._container=null,this._contentCtr=null,this._nativeObject=null,this._status=L.STATUS_NEW,this.id=e.id||null,this.name=e.name||null,this.content=e.content||null,this.conditions=e.conditions||{},this.conditions.includeType=this.conditions.includeType||L.PAGE_URL_MATCH_TYPE_CONTAINS,this.conditions.excludeType=this.conditions.excludeType||L.PAGE_URL_MATCH_TYPE_CONTAINS,this.capping=e.capping||{type:"count",expiration:null,count:null},this.additionalParams=e.additionalParams||{},this.type=e.type||"content",this.template=e.template||"default",this.contentSent=e.contentSent||null,this.contentAlreadyExists=e.contentAlreadyExists||null,this.contentProducts=e.contentProducts||null,this.targetSelector=e.targetSelector||null,this.leavePopupNotOpened=!0,this.isNative="native"===this.type}L.STATUS_RENDERED="RENDERED",L.STATUS_NEW="NEW",L.PAGE_URL_MATCH_TYPE_CONTAINS="contains",L.PAGE_URL_MATCH_TYPE_ALLOWED_LIST=[L.PAGE_URL_MATCH_TYPE_EQUALS="equals",L.PAGE_URL_MATCH_TYPE_CONTAINS],L.prototype.getStatus=function(){return this._status},L.prototype.isPageUrlAllowed=function(u){function e(e){return-1!==L.PAGE_URL_MATCH_TYPE_ALLOWED_LIST.indexOf(e)||(h.error("ContentNotification:isMatchPageUrl invalid type",e,this),!1)}function t(e,t,n){var r,i,o,s=t.split("|");for(var a in s)if(s.hasOwnProperty(a)){var c=s[a];if(r=u,i=c,(o=n)===L.PAGE_URL_MATCH_TYPE_EQUALS?r===i:o===L.PAGE_URL_MATCH_TYPE_CONTAINS?-1!==r.indexOf(i):void 0)return!0}return!1}if(h.log("ContentNotification:isMatchPageUrl",u,this.conditions,this),this.conditions.pageUrl){if(!e(this.conditions.includeType))return!1;if(!(n=t(0,this.conditions.pageUrl,this.conditions.includeType)))return h.log("ContentNotification:isMatchPageUrl included - not allowed",this.conditions.pageUrl,this.conditions.includeType,n,this),!1;h.log("ContentNotification:isMatchPageUrl included",n,this)}if(this.conditions.excludePageUrl){if(!e(this.conditions.excludeType))return!1;var n;if(!(n=!t(0,this.conditions.excludePageUrl,this.conditions.excludeType)))return h.log("ContentNotification:isMatchPageUrl excluded - not allowed",this.conditions.excludePageUrl,this.conditions.excludeType,n,this),!1;h.log("ContentNotification:isMatchPageUrl excluded",!n,this)}return!0},L.prototype.isRendered=function(){return this._status===L.STATUS_RENDERED},L.prototype.setStatusRendered=function(){return this._status=L.STATUS_RENDERED,h.log("ContentNotification:setStatusRendered",this),this},L.prototype.render=function(){var o=this;return new re(function(t,n){if(h.log("ContentNotification:render isNative",o,o.isNative),o.isNative)switch(o.template){case"web_push_agreement":if(K.getMode()!==K.CONFIG_WEBPUSH_MODE_NATIVE)return n(new Error('Web push service mode ("'+K.getMode()+'") does not support auto triggering web push agreement'));var e=K.getBrowserPermissionState();if(h.log("ContentNotification:render check permission",e),e!==J.BROWSER_PERMISSION_DEFAULT)return n(new Error('Auto triggering native web push agreement is disabled if browser permission is "'+e+'"'));h.log("ContentNotification:render subscribe",o),K.subscribe().then(function(e){return h.log("ContentNotification:render subscribe then Notification permission",o,e),(void 0===e||e)&&o.setStatusRendered(),t()}).catch(function(e){h.error("ContentNotification:render subscribe error occurred",e),n(e)});break;default:return n(new Error('Template type ("'+o.template+'") is incorrect for notification, only "web_push_agreement" is allowed for native notification'))}else{var r=document.createElement("div");switch(r.className+=" snrs-notify",r.className+=" snrs-notify-type-"+o.type,r.className+=" snrs-notify-template-"+o.template,r.className+=" snrs-notify-rendered",o.type){case"popup":document.querySelector("snrs-notify-type-popup")?n():(r.innerHTML=I.unescapeHtml(o.content),M.setContent(r),o._container=M._contentCtr,o._contentCtr=r);break;case"content":var i=o.targetSelector?document.querySelector(o.targetSelector):null;if(h.log("ContentNotification:render container",i),!i)return n(new Error("Can not found container("+o.targetSelector+") for notification"));r.innerHTML=I.unescapeHtml(o.content),o._container=i,o._contentCtr=r;break;default:return n(new Error('Notification type ("'+o.type+'") is incorrect, only "popup", "content" is allowed'))}if(!o._container)return n(new Error("ContentNotification container is not defined"));o._contentCtr&&I.executeScripts(o._contentCtr),F.attachHandlers(o).then(function(e){return h.log("ContentNotification:render attachHandlers then",o,e),(void 0===e||e)&&("popup"===o.type?M.show():"content"===o.type&&I.replaceChildren(o._container,o._contentCtr),o.setStatusRendered()),t()}).catch(function(e){h.error("ContentNotification:render attachHandlers error occurred",e),n(e)})}})};var F={_notifications:null,_stylesUrl:[],init:function(e){return new re(function(t,n){F.getNotifications().then(function(e){h.log("NotificationManager:init  NotificationManager.getNotifications() then",e),t(e)}).catch(function(e){h.error(e),n(e)})})},getConnectedSocket:function(){return"undefined"==typeof SocketManager?re.reject(new Error("Socket module not defined")):SocketManager.getConnectedSocket()},initSocketNotification:function(){return new re(function(t,n){h.log("NotificationManager:initSocketNotification"),F.getConnectedSocket().then(function(e){e.on("dynamicContentMessage",function(t){F.renderNotificationForCurrentClient(t).catch(function(e){h.error("Can not render notification for message",t),h.error(e)})}),h.log('NotificationManager:initSocketNotification listening "dynamicContentMessage"',e),t()}).catch(function(e){h.error(e),n(e)})})},renderNotificationForCurrentClient:function(e){return new re(function(n,r){h.log("NotificationManager:renderNotificationForCurrentClient",e),m.getCurrentClient().then(function(t){F.filterUnsupportedNotifications([new L(e)]).then(function(e){e.length&&t.renderNotification(e[0],!0).then(function(e){h.log("NotificationManager:renderNotificationForCurrentClient rendered",e),n()}).catch(r)}).catch(r)}).catch(r)})},prepareStyles:function(){var e=U.utils.getStyleUrl();return F._stylesUrl.push(e),x.loadStyles(F._stylesUrl)},attachHandlers:function(a){return new re(function(e,t){if(!a._contentCtr)return e(!1);switch(a.template){case"newsletter":if(g.getOption("notificationNewsletterHandlers")){var n=a._contentCtr.getElementsByTagName("form");I.each(n,function(o){var s=o.onsubmit;o.onsubmit=function(e){h.log("Notification:render form submit then",o,a),(e=e||ne.event).preventDefault?e.preventDefault():e.returnValue=!1;var t=this,n=function(e){e&&"undefined"!=typeof SyneriseTC&&SyneriseTC.sendFormData(e.type,e.fields,e.fieldsMapping),"function"===(typeof s).toLowerCase()&&s.call(t),a.contentSent&&setTimeout(function(){h.log("Notification:render form submit then saved",o,a),a._contentCtr.innerHTML=I.unescapeHtml(a.contentSent)},1e3),"popup"==a.type&&setTimeout(function(){h.log("Notification:render form submit - close modal",o,a),M.hide()},5e3)};if("undefined"!=typeof SyneriseTC){var r=SyneriseTC.getFormData(o);r.type=o.getAttribute("data-synerise");var i=void 0!==r.fieldsMapping.email?r.fields[r.fieldsMapping.email]:k;h.log("Notification:render form submit then - check email exists:",!!a.contentAlreadyExists,i),a.contentAlreadyExists?U.checkNewsletterSubscription(i).then(function(e){h.log("RequestManager.checkNewsletterSubscription then",e),0==e?n(r):"subscribed"===e||"waiting_for_confirmation"===e?(a._contentCtr.innerHTML=I.unescapeHtml(a.contentAlreadyExists),"popup"==a.type&&setTimeout(function(){h.log("Notification:render form submit - close modal",o,a),M.hide()},4e3)):(h.error("Invalid response. Can not check newsletter subscription"),n(r))}).catch(function(e){h.error("Can not check newsletter subscription",e),n(r)}):n(r)}else h.error("Synerise tracking codes is not defined."),n();return!1}})}else"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(a._contentCtr);return e(!0);case"products":return"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(a._contentCtr),a._container.style.display="none",a.contentProducts&&U.getProductSku(a.contentProducts,V.getClientUuid()).then(function(e){a._container.style.display="block";var t=a._contentCtr.getElementsByClassName("snrs-products");return 0<t.length?(t[0].innerHTML=e,new W({sliderSelector:"ul.snrs-products"}),"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(t[0])):(a._contentCtr.innerHTML=e,"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(a._contentCtr)),re.resolve(e)}),e(!0);case"web_push_agreement":if(void 0===K)return h.info("NotificationManager:attachHandlers Web push module not defined",a),e(!1);if(!K.checkSubscribeRequestNeed())return h.log("NotificationManager:attachHandlers Web push agreement is not needed",a),e(!1);K.isWebPushAppReady().then(function(){"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(a._contentCtr),K.attachHandlers(a._contentCtr),e(!0)}).catch(function(){e(!1)});break;default:return"undefined"!=typeof SyneriseTC&&SyneriseTC.initFormCatch(a._contentCtr),void 0!==K&&K.attachHandlers(a._contentCtr),e(!0)}})},getNotifications:function(){return new re(function(t,n){F._notifications?(h.log("NotificationManager:getNotifications RequestManager.getNotifications from cache",F._notifications),t(F._notifications)):g.getProfileConfigByType(g.PROFILE_CONFIG_TYPE_NOTIFICATIONS).then(F.parseDataToObjects).then(F.filterUnsupportedNotifications).then(function(e){h.log("NotificationManager:getNotifications RequestManager.getNotifications then filtered",e),F._notifications=e,F.prepareStyles(),t(F._notifications)}).catch(function(e){n(e)})})},getNotificationsForClient:function(e){return new re(function(t,n){h.log("NotificationManager:getNotificationsForClient",e),e.getTags().then(function(s){e.getSegments().then(function(e){var o={};o.tags=s,o.segments=e,F.getNotifications().then(function(e){h.log("NotificationManager:getNotificationsForClient NotificationManager.getNotifications() then",e,o);var i=[];I.each(e,function(t){if(t.conditions)if(t.conditions.include){var e=t.conditions.include;switch(e.type){case"segments":e.items&&I.each(e.items,function(e){I.inArray(e,o.segments)&&i.push(t)});break;case"tag":e.items&&I.each(e.items,function(e){I.inArray(e,o.tags)&&i.push(t)});break;case"all":i.push(t)}}else if(t.conditions.exclude){var n=t.conditions.exclude;switch(n.type){case"tag":if(n.items){var r=!0;I.each(n.items,function(e){I.inArray(e,s)&&(r=!1)}),r&&i.push(t)}}}}),t(i)}).catch(n)})})})},parseDataToObjects:function(r){return new re(function(e,t){h.log("NotificationManager:parseToObjects");var n=[];I.isEmpty(r)||I.each(r,function(e,t){n.push(new L(e))}),e(n)})},getUnsupportedModules:function(){return new re(function(e,t){h.log("NotificationManager:getUnsupportedModules");var n={};re.all([new re(function(e,t){if(void 0===K)return h.info("NotificationManager:getUnsupportedModules Web push module not defined"),n.webPush=!0,e();K.isWebPushSupported().then(function(){e()}).catch(function(){n.webPush=!0,e()})})]).then(function(){e(n)}).catch(function(e){t(e)})})},filterUnsupportedNotifications:function(n){return new re(function(e,t){h.log("NotificationManager:filterUnsupportedNotifications",n),F.getUnsupportedModules().then(function(u){h.log("NotificationManager:filterUnsupportedNotifications getUnsupportedModules than",n,u);var l=[];if(!I.isEmpty(n)){var d={};I.each(n,function(e){if("web_push_agreement"===e.template){if(u.webPush)return void h.log("NotificationManager:filterUnsupportedNotifications filtered (unsuported webpush module)",e);if(!K.checkSubscribeRequestNeed())return void h.log("NotificationManager:filterUnsupportedNotifications filtered (Web push agreement is not needed)",e)}if(e.conditions){if(!e.isPageUrlAllowed(location.href))return void h.log("NotificationManager:filterUnsupportedNotifications filtered (wrong current page url)",e);if(e.conditions.deviceType&&!b.checkDeviceType(e.conditions.deviceType))return void h.log("NotificationManager:filterUnsupportedNotifications filtered (wrong current device type)",e);if(e.conditions.timeFrom||e.conditions.timeTo){h.log("NotificationManager:filterUnsupportedNotifications filter for time showing",e.conditions.timeFrom,e.conditions.timeTo,e);var t,n,r=e.conditions.timeFrom,i=e.conditions.timeTo,o=new Date,s=function(e){return e.toISOString().replace(/t/i," ").replace(/\.\d+./,"")};if(null==r){var a=new Date;a.setDate(o.getDate()-7),r=s(a)}if(null==i){var c=new Date;c.setDate(o.getDate()+7),i=s(c)}if(t=r.length<19?p.prepareTimeForDate(r||"00:00:00",o):new Date(r),(n=i.length<19?p.prepareTimeForDate(i||"23:59:59",o):new Date(i)).setTime(n.getTime()-60*n.getTimezoneOffset()*1e3),t.setTime(t.getTime()-60*t.getTimezoneOffset()*1e3),"Invalid Date"===t.toString()||"Invalid Date"===n.toString())return void h.error("NotificationManager:filterUnsupportedNotifications filtered (invalid showing time)",t,n,e);if(o<t||n<o)return void h.log("NotificationManager:filterUnsupportedNotifications filtered (wrong showing time)",o,t,n)}}if("content"===e.type){if(!e.targetSelector)return void h.log("NotificationManager:filterUnsupportedNotifications filtered (empty target selector)",e);if(d[e.targetSelector])return void h.log("NotificationManager:filterUnsupportedNotifications filtered (with same target selector)",e);d[e.targetSelector]=!0}l.push(e)})}return e(l)}).catch(function(e){t(e)})})},leavePopupOpenEventHandler:function(e,t,n){t.leavePopupNotOpened&&n.clientY<=0&&(n.preventDefault(),e.renderNotification(t,!0),t.leavePopupNotOpened=!1)},attachHandlerForLeavePopup:function(e,t){document.addEventListener("mouseout",F.leavePopupOpenEventHandler.bind(this,e,t))},turnOffPopupTransparentBackground:function(){M.turnOffTransparentModal()},turnOnPopupTransparentBackground:function(){M.turnOnTransparentModal()}},W=function(e){for(var t in this.properties={sliderSelector:"ul.snrs-products",slidesTagName:"LI",displayedItemCount:5,slideIntervalMiliseconds:3e3,isResponsive:!0,navigateLeftSelector:".snrs-left-arrow",navigateRightSelector:".snrs-right-arrow",breakingPoints:{small:650,medium:1280}},e)e.hasOwnProperty(t)&&(this.properties[t]=e[t]);this.slider=document.querySelector(this.properties.sliderSelector),null!==this.slider&&(this.slidesCollection=this.slider.getElementsByTagName(this.properties.slidesTagName),this.slideCount=this.slidesCollection.length,this.roundedSlideCount=Math.ceil(this.slideCount/this.properties.displayedItemCount)*this.properties.displayedItemCount,this.sliderPercentWidth=100*Math.ceil(this.roundedSlideCount/this.properties.displayedItemCount),this.position=0,this.init())};W.prototype.init=function(){this.setResponsivity(),this.slider.style.width=this.sliderPercentWidth+"%",this.createNavigation(),this.setSlidesWidth(),this.setInterval=setInterval(this.slideRTL.bind(this),this.properties.slideIntervalMiliseconds),this.attachSlideEvents()},W.prototype.setResponsivity=function(){var e=ne.innerWidth;e>this.properties.breakingPoints.small&&e<this.properties.breakingPoints.medium?this.properties.displayedItemCount=3:e<this.properties.breakingPoints.small&&(this.properties.displayedItemCount=1),this.roundedSlideCount=Math.ceil(this.slideCount/this.properties.displayedItemCount)*this.properties.displayedItemCount,this.sliderPercentWidth=100*Math.ceil(this.roundedSlideCount/this.properties.displayedItemCount)},W.prototype.setSlidesWidth=function(){for(var e=1/this.roundedSlideCount*100+"%",t=0,n=this.slidesCollection.length;t<n;t+=1)this.slidesCollection[t].style.width=e},W.prototype.getSlideDistance=function(){return 100*this.position/Math.ceil(this.slideCount/this.properties.displayedItemCount)},W.prototype.slideRTL=function(){this.position=++this.position<Math.ceil(this.slideCount/this.properties.displayedItemCount)?this.position:0,this.slider.style.transform="translateX(-"+this.getSlideDistance()+"%)"},W.prototype.slideLTR=function(){this.position=0<=--this.position?this.position:Math.ceil(this.slideCount/this.properties.displayedItemCount)-1,this.slider.style.transform="translateX(-"+this.getSlideDistance()+"%)"},W.prototype.createNavigation=function(){var e=document.createElement("DIV"),t=document.createElement("DIV");e.className="snrs-arrow snrs-left-arrow",t.className="snrs-arrow snrs-right-arrow",document.querySelector(".snrs-products-slider").appendChild(e),document.querySelector(".snrs-products-slider").appendChild(t)},W.prototype.attachSlideEvents=function(){var e=this;document.querySelector(this.properties.navigateLeftSelector).addEventListener("click",function(){clearInterval(e.setInterval),e.slideLTR(),e.setInterval=setInterval(e.slideRTL.bind(e),e.properties.slideIntervalMiliseconds)}),document.querySelector(this.properties.navigateRightSelector).addEventListener("click",function(){clearInterval(e.setInterval),e.slideRTL(),e.setInterval=setInterval(e.slideRTL.bind(e),e.properties.slideIntervalMiliseconds)})},W.prototype.off=function(){for(var e=0,t=this.properties.slidesCollection.length;e<t;e+=1)this.properties.slidesCollection[e].style.width="";clearInterval(this.setInterval),this.properties.slider.style.width="",this.properties.slider.style.transform="",document.querySelector(this.properties.navigateRight).remove(),document.querySelector(this.properties.navigateLeft).remove()};var U={trackingDomain:"https://web.snrbox.com",trackUrl:"/tck",trackIGifUrl:"/tck/_i.gif",trackSdkProxyUrl:"/tck/sdk-proxy",rtomUrl:"/rtom",rtomProxyUrl:"/rtom-proxy/rtom",dynamicContentUrl:"/dc/v4",trackerLogsUrl:"/tck/logs",productsRenderBySkuUrl:location.protocol+"//"+location.hostname+"/dynamicblock/products",utils:{setTrackingDomain:function(e){h.log("RequestManager:utils:setTrackingDomain",e),U.trackingDomain=e},setIdentityHash:function(e){if(h.log("RequestManager:utils:setIdentityHash",e),e.extras&&e.extras.identityHash){var t=e.extras.identityHash;SyneriseTC.checkIdentityHashExists()||SyneriseTC.resetUUIDByIdentityHash(t)}return re.resolve(e)},processStatus:function(e){if(h.log("RequestManager:utils:processStatus",e),200===e.status||201===e.status||0===e.status)return re.resolve(e);var t=new Error(e.statusText);return t.status=e.status,re.reject(t)},getStyleUrl:function(){return g.getOption("trackingDomain")?g.getOption("trackingDomain")+"/sdk/3.0/synerise-javascript-sdk.min.css":"https://www.snrcdn.net/sdk/3.0/synerise-javascript-sdk.min.css"},getDataKey:function(e){return void 0!==e.data?re.resolve(e.data):re.reject(new Error("Can no get data from response"))},getDataFromKeyName:function(e,t){return void 0!==e[t]?re.resolve(e[t]):re.reject(new Error("Can no get data from response"))},parseJson:function(e){return e.json()},fetchWithTimeout:function(e,t){void 0!==t&&null!=t||(t=4e3);var n=new AbortController,r=n.signal,i=setTimeout(function(){n.abort()},t);return ie(e,{signal:r}).then(function(e){return clearTimeout(i),i=k,re.resolve(e)}).then(U.utils.processStatus).catch(function(e){return clearTimeout(i),i=k,"AbortError"===e.name?re.reject(new Error("Request Timeout")):re.reject(e)})},fetchWithTimeoutAndLog:function(e,t){return f.handleFetch(e,U.utils.fetchWithTimeout(e,t))},trackEventWithCheckPossibility:function(e){return b.isCrawler()?new Error("Can not track event - crawler detected"):U.utils.fetchWithTimeoutAndLog(e,4e3)},checkMethodLimiter:function(){return b.isBrowseIE()?2e3:1e4}},getProductSku:function(o,e){h.log("RequestManager:getProductSku");var t={"no-buy":"stats/transaction/no-buy-products","last-view":"products/last-view","top-vew":"products/top-vew",recommend:"products/recommend",similar:"products/recommend"},s=null;void 0!==t[o]&&(s=t[o]);var a="";if("similar"==o){sku="";try{sku=document.head.querySelector('meta[property="product:retailer_part_no"]').content}catch(e){}a="sku="+sku}else a="clientUUID="+encodeURIComponent(e);return"function"==typeof srRenderProducts&&(a+="&onlySku=1"),new re(function(n,t){var e={"Content-Type":"application/json"};e[d.getHeaderAuth("key")]=d.getHeaderAuth("value");var r=U.trackingDomain+U.rtomProxyUrl+"/"+s+"?"+a,i=new l(r,{method:"GET",mode:"cors",redirect:"follow",headers:new oe(e)});U.utils.fetchWithTimeoutAndLog(i).then(U.utils.processStatus).then(U.utils.parseJson).then(function(e){if(h.log("RequestManager:getProductSku fetch then",e),I.isEmpty(e)||I.isEmpty(e.items))throw new TypeError("Empty list product to render");var i="";if("function"==typeof srRenderProducts){var t=[];e.items.forEach(function(e){t.push(e.sku)}),srRenderProducts(t,o,function(e){n(e)})}else e.items.forEach(function(e){var t=e.category!==k?'<p class="snrs-product-category">'+e.category+"</p>":"",n=e.sku!==k?'<p class="snrs-product-sku">'+e.sku+"</p>":"",r=e.name!==k?'<p class="snrs-product-title">'+e.name+"</p>":"";i+=i='<li class="snrs-product" ><a  class="snrs-product-href" href="'+e.url+"?snr_medium=synerise_products&snr_source=synerise&snr_campaign="+o+'" ><img  class="snrs-product-image" alt="'+e.name+'" src="'+e.image+'"/></a>'+t+n+r+"</li>"}),n('<div class="snrs-products-slider"><ul class="snrs-products">'+i+"</ul></div>")}).catch(function(e){h.error("RequestManager:getProductSku fetch error",e),t(e)})})},checkNewsletterSubscription:function(i){h.log("RequestManager:checkNewsletterSubscription");var o={"Content-Type":"application/json"};return o[d.getHeaderAuth("key")]=d.getHeaderAuth("value"),new re(function(t,n){var e=U.trackingDomain+U.rtomUrl+"/newsletter/check-subscription?email="+encodeURIComponent(i),r=new l(e,{method:"GET",mode:"cors",redirect:"follow",headers:new oe(o)});U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(U.utils.parseJson).then(function(e){return void 0!==e.status?re.resolve(e.status):re.reject(new Error("Can no get status from response"))}).then(function(e){h.log("RequestManager:checkNewsletterSubscription fetch then",e),t(e)}).catch(function(e){h.error("RequestManager:checkNewsletterSubscription fetch error",e),n(e)})})},getNotifications:function(){return h.log("RequestManager:getNotifications"),new re(function(t,n){var e={"Content-Type":"application/json"};e[d.getHeaderAuth("key")]=d.getHeaderAuth("value");var r=U.trackingDomain+U.rtomProxyUrl+"/clients/notificationTemplates",i=new l(r,{method:"GET",mode:"cors",redirect:"follow",headers:new oe(e)});U.utils.fetchWithTimeoutAndLog(i).then(U.utils.processStatus).then(U.utils.parseJson).then(U.utils.getDataKey).then(function(e){h.log("RequestManager:getNotifications fetch then",e),t(e)}).catch(function(e){h.error("RequestManager:getNotifications fetch error",e),n(e)})})},getDynamicContentsFiltered:function(i){return h.log("RequestManager:getDynamicContentsFiltered"),new re(function(t,n){var e=U.trackingDomain+U.dynamicContentUrl+"/dynamicContent/filtered?code="+d.trackerKey()+"&uuid="+encodeURIComponent(i.uuid),r=new l(e,{method:"GET",mode:"cors",redirect:"follow",headers:new oe({"Content-Type":"text/plain"})});h.log("RequestManager:getDynamicContentsFiltered fetch",e),U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(U.utils.parseJson).then(U.utils.setIdentityHash).then(U.utils.getDataKey).then(function(e){h.log("RequestManager:getDynamicContentsFiltered fetch then",e),t(e)}).catch(function(e){h.error("RequestManager:getDynamicContentsFiltered fetch error",e),n(e)})})},getDynamicContentByUuids:function(a,c){return h.log("RequestManager:getDynamicContentByUuids",c),new re(function(t,n){var e=U.trackingDomain+U.dynamicContentUrl+"/dynamicContent/byUuids?code="+d.trackerKey()+"&uuid="+encodeURIComponent(a.uuid),r=y.getVariables(),i={};I.each(c,function(e){i[e.getId()]=e.getVariantId()||0});var o={variantFilters:i,variables:r,referer:location.href},s=e+"&query="+encodeURIComponent(p.utoa(JSON.stringify(o)));s.length<U.utils.checkMethodLimiter()?U.getDynamicContentByGet(e,s,o).then(function(e){t(e)}).catch(function(e){n(e)}):U.getDynamicContentByPost(e,o).then(function(e){t(e)}).catch(function(e){n(e)})})},getDynamicContentByGet:function(r,i,o){return h.log("RequestManager:getDynamicContentByGet",o),new re(function(t,n){var e=new l(i,{method:"GET",headers:new oe({})});U.utils.fetchWithTimeoutAndLog(e).then(U.utils.processStatus).then(U.utils.parseJson).then(U.utils.setIdentityHash).then(U.utils.getDataKey).then(function(e){h.log("RequestManager:getDynamicContentByGet fetch",e),t(e)}).catch(function(e){h.log("RequestManager:getDynamicContentByGet error",e),e.status&&400===e.status?(h.log("RequestManager:getDynamicContentByPost::fallback",o),U.getDynamicContentByPost(r,o).then(function(e){t(e)}).catch(function(e){n(e)})):n(e)})})},getDynamicContentByPost:function(r,i){return h.log("RequestManager:getDynamicContentByPost"),new re(function(t,n){var e=new l(r,{method:"POST",headers:new oe({"Content-Type":"text/plain"}),body:JSON.stringify(i)});U.utils.fetchWithTimeoutAndLog(e).then(U.utils.processStatus).then(U.utils.parseJson).then(U.utils.setIdentityHash).then(U.utils.getDataKey).then(function(e){h.log("RequestManager:getDynamicContentByPost fetch",e),t(e)}).catch(function(e){h.log("RequestManager:getDynamicContentByPost error",e),n(e)})})},getProfileConfig:function(){return h.log("RequestManager:getProfileConfig"),new re(function(t,n){var e=U.trackingDomain+U.rtomProxyUrl+"/configs/getPublicConfigForContext";e+="?tracker="+d.getHeaderAuth("value");var r=new l(e,{method:"GET",mode:"cors",redirect:"follow",headers:new oe({"Content-Type":"application/json"})});U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(U.utils.parseJson).then(function(e){h.log("RequestManager:getProfileConfig fetch then",e),t(e)}).catch(function(e){h.error("RequestManager:getProfileConfig fetch error",e),n(e)})})},getWebPushProfileConfig:function(i){return h.log("RequestManager:getWebPushProfileConfig"),new re(function(t,n){var e=U.trackingDomain+U.rtomProxyUrl+"/web-push/get-public-config";e+="?tracker="+d.getHeaderAuth("value"),i&&(e+="&acceptLanguage="+encodeURIComponent(i));var r=new l(e,{method:"GET",mode:"cors",redirect:"follow",headers:new oe({"Content-Type":"application/json"})});U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(U.utils.parseJson).then(function(e){h.log("RequestManager:getWebPushProfileConfig fetch then",e),t(e)}).catch(function(e){h.error("RequestManager:getWebPushProfileConfig fetch error",e),n(e)})})},getClientTags:function(i){h.log("RequestManager:getClientTags",i);var o={"Content-Type":"application/json"};return o[d.getHeaderAuth("key")]=d.getHeaderAuth("value"),new re(function(t,n){var e=U.trackingDomain+U.rtomProxyUrl+"/clients/tagsHash?uuid="+encodeURIComponent(i.uuid),r=new l(e,{method:"GET",mode:"cors",redirect:"follow",headers:new oe(o)});U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(U.utils.parseJson).then(U.utils.getDataKey).then(function(e){h.log("RequestManager:getClientTags fetch then",e),t(e)}).catch(function(e){h.error("RequestManager:getClientTags fetch error",e),n(e)})})},getClientData:function(e){h.log("RequestManager:getClientData",e);return{"Content-Type":"application/json"}[d.getHeaderAuth("key")]=d.getHeaderAuth("value"),new re(function(e,t){e({segments:[],tags:[]})})},track:function(t,n,r,u){return h.log("RequestManager:track",t,n,r,u),new re(function(i,o){var s=m.getClientFromStore();if(s){r=r||"",u=u||{};var e={uuid:s.uuid,url:ne.location.href};u=I.extend(e,u);var a={action:n,label:r,params:JSON.stringify(u),uuid:s.uuid,tracker:d.getHeaderAuth("value"),hash:Math.random().toString(36).substring(2,8)};t&&(a.category=t);var c={method:"GET",mode:"cors",redirect:"follow"};A.requiresAuthorization(n).then(function(e){if(e){var t=s.accessToken;t&&(c.headers=new oe({Authorization:"Bearer "+t}))}var n=U.trackingDomain+U.trackIGifUrl+"?"+function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(a),r=new l(n,c);U.utils.trackEventWithCheckPossibility(r).then(function(e){h.log("RequestManager:track fetch then",e),i(e)}).catch(function(e){h.error("RequestManager:track fetch error",e),o(e)})}).catch(function(e){h.error("RequestManager:track EventManager.requiresAuthorization error",e),o(e)})}else o(new Error("Can not track event if client not exists"))})},trackProxy:function(c){return h.log("RequestManager:trackProxy",c),new re(function(r,i){var o=m.getClientFromStore();if(!o)return i(new Error("Can not track event if client not exists"));if(!(c=I.extend({uuid:o.uuid},c)).label)return i(new Error("Can not track unknown event"));if(!c.object)return i(new Error('Can not track event - "object" is required'));var s={"Content-Type":"text/plain"},a=U.trackingDomain+U.trackSdkProxyUrl+"?code="+d.trackerKey(),e=A.mapObjectToAction(c.object);A.requiresAuthorization(e).then(function(e){if(e){var t=o.accessToken;t&&(s.Authorization="Bearer "+t)}var n=new l(a,{method:"POST",mode:"cors",redirect:"follow",headers:new oe(s),body:JSON.stringify(c)});U.utils.trackEventWithCheckPossibility(n).then(function(e){h.log("RequestManager:trackProxy fetch then",e),r(e)}).catch(function(e){h.error("RequestManager:trackProxy fetch error",e),i(e)})})})},subscribeWebPushForClient:function(){return h.log("RequestManager:subscribeWebPushForClient"),new re(function(i,o){m.getCurrentClient().then(function(e){if(!e)return o(new Error("Can not subscribe if client not exists"));if(!e.uuid)return o(new Error("Client is not identified"));var t={"Content-Type":"application/json"};t[d.getHeaderAuth("key")]=d.getHeaderAuth("value");var n=U.trackingDomain+U.rtomUrl+"/web-push/subscribe",r=new l(n,{method:"POST",mode:"cors",redirect:"follow",headers:new oe(t),body:JSON.stringify({uuid:e.uuid,url:location.href})});U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(function(e){h.log("RequestManager:subscribeWebPushForClient fetch then",e),i(e)}).catch(function(e){h.error("RequestManager:subscribeWebPushForClient fetch error",e),o(e)})}).catch(function(){o(new Error("Client is not exists"))})})},unsubscribeWebPushForClient:function(){return h.log("RequestManager:unsubscribeWebPushForClient"),new re(function(i,o){m.getCurrentClient().then(function(e){if(!e)return o(new Error("Can not unsubscribe if client not exists"));if(!e.uuid)return o(new Error("Client is not identified"));var t={"Content-Type":"application/json"};t[d.getHeaderAuth("key")]=d.getHeaderAuth("value");var n=U.trackingDomain+U.rtomUrl+"/web-push/unsubscribe",r=new l(n,{method:"POST",mode:"cors",redirect:"follow",headers:new oe(t),body:JSON.stringify({uuid:e.uuid,url:location.href})});U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(function(e){h.log("RequestManager:unsubscribeWebPushForClient fetch then",e),i(e)}).catch(function(e){h.error("RequestManager:unsubscribeWebPushForClient fetch error",e),o(e)})}).catch(function(){o(new Error("Client is not exists"))})})},addBrowserPermissionWebPushForClient:function(a,c,u){return h.log("RequestManager:addBrowserPermissionWebPushForClient",a),new re(function(o,s){m.getCurrentClient().then(function(e){if(!e)return s(new Error("Can not subscribe if client not exists"));if(!e.uuid)return s(new Error("Client is not identified"));if(!a)return s(new Error("Token is required"));var t={"Content-Type":"application/json"};t[d.getHeaderAuth("key")]=d.getHeaderAuth("value");var n={uuid:e.uuid,token:a,domain:c,url:location.href};u&&(n.subscription=u);var r=U.trackingDomain+U.rtomUrl+"/web-push/add-browser-permission",i=new l(r,{method:"POST",mode:"cors",redirect:"follow",headers:new oe(t),body:JSON.stringify(n)});U.utils.fetchWithTimeoutAndLog(i).then(U.utils.processStatus).then(function(e){h.log("RequestManager:addBrowserPermissionWebPushForClient fetch then",e),o(e)}).catch(function(e){h.error("RequestManager:addBrowserPermissionWebPushForClient fetch error",e),s(e)})}).catch(function(){s(new Error("Client is not exists"))})})},checkWebPushSubscriptionForClient:function(o){return h.log("RequestManager:checkWebPushSubscriptionForClient"),new re(function(r,i){m.getCurrentClient().then(function(e){if(!e)return i(new Error("Can not subscribe if client not exists"));if(!e.uuid)return i(new Error("Client is not identified"));var t=U.trackingDomain+U.rtomUrl+"/web-push/check-subscription";t+="?tracker="+d.getHeaderAuth("value"),t+="&uuid="+encodeURIComponent(e.uuid),t+="&domain="+encodeURIComponent(o||"");var n=new l(t,{method:"GET",mode:"cors",redirect:"follow",headers:new oe({"Content-Type":"application/json"})});U.utils.fetchWithTimeoutAndLog(n).then(U.utils.processStatus).then(U.utils.parseJson).then(function(e){return U.utils.getDataFromKeyName(e,"subscription")}).then(function(e){h.log("RequestManager:addBrowserPermissionWebPushForClient fetch then",e),r(e)}).catch(function(e){h.error("RequestManager:addBrowserPermissionWebPushForClient fetch error",e),i(e)})}).catch(function(e){h.error("RequestManager:checkWebPushSubscriptionForClient error occurred",e),i(new Error("Client is not exists"))})})},incrementDynamicContentViews:function(s){return h.log("RequestManager:incrementDynamicContentViews",s),new re(function(i,o){m.getCurrentClient().then(function(e){var t={"Content-Type":"application/json"};t[d.getHeaderAuth("key")]=d.getHeaderAuth("value");var n=U.trackingDomain+U.dynamicContentUrl+"/dynamicContent/incrementView",r=new l(n,{method:"POST",mode:"cors",redirect:"follow",headers:new oe(t),body:JSON.stringify({uuid:e.uuid,campaignId:s.getId()})});U.utils.fetchWithTimeoutAndLog(r).then(U.utils.processStatus).then(function(e){h.log("RequestManager:incrementDynamicContentViews fetch then",e),i(e)}).catch(function(e){h.error("RequestManager:incrementDynamicContentViews fetch error",e),o(e)})}).catch(function(e){h.error("RequestManager:incrementDynamicContentViews error",e),o(new Error("Client not exists"))})})}},x={_sourcesMap:{},loadStyles:function(n){return new re(function(e,t){if(!(n=x.deduplicateSources(n)).length)return e();p.addStyles(n).then(function(){e()}).catch(function(e){h.error(e),t(e)})})},deduplicateSources:function(e){if(!e)return[];var t=[];return I.each(e,function(e){x._sourcesMap[e]||(t.push(e),x._sourcesMap[e]=!0)}),t}},B={set:function(e,t,n,r,i){I.isObject(t)&&(t=V.prepareObjectToString(t));var o=new Date,s=0;s=void 0!==n?1e3*n:62208e6,o.setTime(o.getTime()+s),B.setForDateExpires(e,t,o,r,i)},setForDateExpires:function(e,t,n,r,i){I.isObject(t)&&(t=V.prepareObjectToString(t)),n||(n=new Date).setTime(n.getTime()+62208e6);var o={path:i||"/"};o.expires=n,void 0!==r&&(o.domain=r),I.cookie.set(e,t,o)},get:function(e){var t=I.cookie.get(e);return h.log("CookieStore:get",e,t),/:/.test(t)&&(t=V.prepareStringToObject(t)),h.log("CookieStore:get return",t),t},getJson:function(e){var t=I.cookie.get(e);h.log("CookieStore:getJson",e,t);try{return t?JSON.parse(t):{}}catch(e){h.error("CookieStore:getJson ERROR: parse json",t)}return null},remove:function(e){I.cookie.remove(e)}},H={FREQUENCY_PREFIX:"_snrs_dc_frq_",STOP_DISPLAY_PREFIX:"_snrs_dc_sd_",VIEWS_FOR_STOP_DISPLAY_PREFIX:"_snrs_dc_views_sd_",DELAY_PREFIX:"_snrs_dc_delay_",CAMPAIGNS:"_snrs_dc_campaigns",EXPIRE:"_snrs_dc_expire",TESTS:"_snrs_dc_tests",getKeyList:function(){return[H.FREQUENCY_PREFIX,H.STOP_DISPLAY_PREFIX,H.VIEWS_FOR_STOP_DISPLAY_PREFIX,H.DELAY_PREFIX,H.CAMPAIGNS,H.EXPIRE,H.TESTS]},clearExpiredKeysFromStore:function(){if(h.log("DynamicContentStore:clearExpiredKeysFromStore"),!q.isAvailable())return!0;var e=H.getKeyList();return I.each(e,function(e){q.clearExpiredKeysFromContainer(e)}),!0},incrementFrequency:function(e){var t=e.frequency.getExpiration();null===t&&(t=S.EXPIRATION_MAX_VALUE);var n=H.getFrequencyWithCheckExpiration(e);n||(n={value:0,expires:new Date((new Date).getTime()+1e3*t).getTime()});if(n.value++,q.isAvailable())q.setToContainer(H.FREQUENCY_PREFIX,e.id,n);else{var r=H.FREQUENCY_PREFIX+e.id;B.setForDateExpires(r,n,new Date(n.expires))}return n},renewFrequencyExpiration:function(e){var t=e.frequency.getExpiration(),n=H.getFrequencyWithCheckExpiration(e);if(h.log("Store:renewFrequencyExpiration",n,e),n){var r=new Date((new Date).getTime()+1e3*t);if(n.expires=r.getTime(),h.log("Store:renewFrequencyExpiration set",n,t,r,e),q.isAvailable())q.setToContainer(H.FREQUENCY_PREFIX,e.id,n);else{var i=H.FREQUENCY_PREFIX+e.id;B.setForDateExpires(i,n,new Date(n.expires))}}return n},getFrequency:function(e){var t;return(t=q.isAvailable()?q.getFromContainer(H.FREQUENCY_PREFIX,e.id):B.get(H.FREQUENCY_PREFIX+e.id))?(t.value=parseInt(t.value,10),t.expires=parseInt(t.expires,10),isNaN(t.value)||isNaN(t.expires)?null:t):null},getFrequencyWithCheckExpiration:function(e){var t=H.getFrequency(e);return H.checkExpirationFrequencyForData(e,t)},checkExpirationFrequencyForData:function(e,t){if(t){var n=new Date;if(t.expires<n.getTime())return H.removeFrequency(e),null}return t},removeFrequency:function(e){q.isAvailable()?q.removeFromContainer(H.FREQUENCY_PREFIX,e.id):B.remove(H.FREQUENCY_PREFIX+e.id)},stopDisplay:function(e){var t=C.STOP_DISPLAY_EXPIRATION_MAX_VALUE;B.set(H.STOP_DISPLAY_PREFIX+e.id,1,t)},checkStopDisplay:function(e){return h.log("Store:checkStopDisplay value",B.get(H.STOP_DISPLAY_PREFIX+e.id)),!!B.get(H.STOP_DISPLAY_PREFIX+e.id)},incrementViewsForStopDisplay:function(e){var t=C.STOP_DISPLAY_EXPIRATION_MAX_VALUE,n=H.getViewsForStopDisplay(e),r=++n;return B.set(H.VIEWS_FOR_STOP_DISPLAY_PREFIX+e.id,r,t),r},getViewsForStopDisplay:function(e){return B.get(H.VIEWS_FOR_STOP_DISPLAY_PREFIX+e.id)||0},removeViewsForStopDisplay:function(e){return B.remove(H.VIEWS_FOR_STOP_DISPLAY_PREFIX+e.id)},setTimeForDelay:function(e,t){t=t||new Date;var n=e.trigger.getDelayInSeconds(),r=new Date(t.getTime()+1e3*n);return H.storeTimeForDelay(e,r),r},renewTimeForDelay:function(e){var t=H.getTimeForDelay(e);return null!==t&&H.storeTimeForDelay(e,t),t},storeTimeForDelay:function(e,t){var n=w.TRIGGER_DELAY_EXPIRATION_VALUE;if(q.isAvailable()){var r=new Date((new Date).getTime()+1e3*n),i={value:t.getTime(),expires:r.getTime()};q.setToContainer(H.DELAY_PREFIX,e.id,i)}else B.set(H.DELAY_PREFIX+e.id,t.getTime(),n)},getTimeForDelay:function(e){var t;if(q.isAvailable()){var n=q.getFromContainer(H.DELAY_PREFIX,e.id);t=n?n.value:null}else t=B.get(H.DELAY_PREFIX+e.id);var r=parseInt(t,10);return isNaN(r)?null:new Date(r)},removeTimeForDelay:function(e){q.isAvailable()?q.removeFromContainer(H.DELAY_PREFIX,e.id):B.remove(H.DELAY_PREFIX+e.id)},cacheDynamicContentVariantId:function(e,t){return q.isAvailable()?q.setToContainer(H.TESTS,e,t):h.error("DynamicContentStore:setDynamicContentVariant error"),t},getCachedDynamicContentVariantId:function(e){var t=null;return q.isAvailable()?t=q.getFromContainer(H.TESTS,e):h.error("DynamicContentStore:getDynamicContentVariant error"),t},getDynamicContentsVariants:function(){var e=null;return q.isAvailable()?e=q.getJson(H.TESTS):h.error("DynamicContentStore:getDynamicContentVariant error"),e}},q={_is_available:null,setJson:function(e,t){if(!q.isAvailable())return!1;var n=V.prepareObjectToJsonString(t);return h.log("LocalStore:set",e,n),localStorage[e]=n,!0},getJson:function(e){if(!q.isAvailable())return!1;var t=void 0!==localStorage[e]?localStorage[e]:k,n=V.prepareJsonStringToObject(t);return h.log("LocalStore:get",e,n),n},saveContainer:function(e,t){return!!q.isAvailable()&&(Object.keys(t).length?q.setJson(e,t):q.removeContainer(e),!0)},getContainer:function(e,t){return!!q.isAvailable()&&(q.getJson(e)||{})},removeContainer:function(e){return!!q.isAvailable()&&(q.remove(e),!0)},getFromContainer:function(e,t){if(!q.isAvailable())return!1;var n=q.getContainer(e);return n[t]!==k?n[t]:null},setToContainer:function(e,t,n){if(!q.isAvailable())return!1;var r=q.getContainer(e);return(r=r||{})[t]=n,q.saveContainer(e,r),!0},removeFromContainer:function(e,t){if(!q.isAvailable())return!1;var n=q.getContainer(e);return delete n[t],q.saveContainer(e,n),!0},clearExpiredKeysFromContainer:function(i,o,s){if(!q.isAvailable())return!1;o=o||new Date,s=s||"expires";var e=q.getContainer(i),a={},c=!1;return I.each(e,function(e,t){var n=parseInt(e[s],10);if(isNaN(n))a[t]=e;else{var r=new Date(n);r<o.getTime()?(h.log("LocalStore:clearExpiredKeysFromContainer key expired",t,r,i,e),q.removeFromContainer(i,t),c=!0):a[t]=e}}),c&&q.saveContainer(i,a),!0},set:function(e,t){return!!q.isAvailable()&&(I.isObject(t)&&(t=V.prepareObjectToString(t)),h.log("LocalStore:set",e,t),localStorage[e]=t,!0)},get:function(e){if(!q.isAvailable())return!1;var t=void 0!==localStorage[e]?localStorage[e]:k;return h.log("LocalStore:get",e,t),t!==k&&/:/.test(t)&&(t=V.prepareStringToObject(t)),h.log("LocalStore:get return",t),t},setString:function(e,t){return!!q.isAvailable()&&(h.log("LocalStore:setString",e,t),localStorage[e]=t,!0)},getString:function(e){if(!q.isAvailable())return!1;var t=void 0!==localStorage[e]?localStorage[e]:k;return h.log("LocalStore:getString",e,t),t},setStringWithTtl:function(e,t,n){return!!q.isAvailable()&&(n=n||(new Date).getTime()/100+43200,h.log("LocalStore:setStringWithTtl",e,t,n),this.setJson(e,{value:t,expires:n}))},getStringWithTtl:function(e){var t=this.getJson(e);return this.isExpired(t.expires)?(h.log("LocalStore:getStringWithTtl key expired",e,t),this.remove(e),null):t.value},remove:function(e){return!!q.isAvailable()&&(h.log("LocalStore:remove",e),void 0!==localStorage[e]&&delete localStorage[e],!0)},isAvailable:function(e){if(null!==q._is_available)return q._is_available;if("undefined"!=typeof Storage&&"undefined"!=typeof localStorage)try{localStorage.setItem("lsCheck",1),localStorage.removeItem("lsCheck"),q._is_available=!0}catch(e){h.log("[LocalStore]:isAvailable Local storage isn't available"),q._is_available=!1}else h.log("[LocalStore]:isAvailable Local storage isn't available"),q._is_available=!1;return q._is_available},isExpired:function(e){var t=parseInt(e,10);return!!(isNaN(t)||t<(new Date).getTime()/1e3)}},V={prepareObjectToJsonString:function(e){return JSON.stringify(e)},prepareJsonStringToObject:function(t){var e={};if("string"===(typeof t).toLowerCase())try{e=JSON.parse(t)}catch(e){h.error("Store:parseJson - Wrong JSON format",t)}return e},prepareObjectToString:function(e){var n="";return I.isObject(e)&&(I.each(e,function(e,t){""!==e&&(n+=t+":"+e+"&")}),n=n.substring(0,n.length-1)),n},prepareStringToObject:function(e){var n={};if(I.isString(e)){var t=e.split("&");I.each(t,function(e){var t=e.split(":");1<t.length&&(n[t[0]]=t[1])})}return n},getClientUuid:function(){h.log("Store:getClientUuid");var e=B.get("_snrs_p"),t=null;return void 0!==e&&void 0!==e.uuid&&"null"!==e.uuid&&(t=e.uuid),h.log("Store:getClientUuid value:",t),t},getClientPermUuid:function(){h.log("Store:getClientPermUuid");var e=B.get("_snrs_p"),t=null;return void 0!==e&&void 0!==e.permUuid&&"null"!==e&&(t=e.permUuid),h.log("Store:getClientPermUuid value:",t),t},getClientToken:function(){h.log("Store:getClientToken");var e=q.getStringWithTtl("snr-token");return e||(e=B.get("_snrs_token")),e},setClientToken:function(e){var t=d.parseToken(e);if(null===t||t.exp==k)return h.error("Store:setClientToken ERROR: invalid token",e),!1;if(q.isExpired(t.exp))return h.error("Store:setClientToken ERROR: token expired",e),!1;var n=t.exp;if(!q.isAvailable()){h.log("Store:setClientToken ERROR: Localstorage unavailable. Setting cookie");var r=new Date(1e3*n);return B.setForDateExpires("_snrs_token",e,r),!0}return q.setStringWithTtl("snr-token",e,n)?(B.remove("_snrs_token"),!0):void 0},removeClientToken:function(){q.remove("snr-token"),B.remove("_snrs_token")},setNotificationCapping:function(e){if(h.log("Store:setNotificationCapping",e),e.capping&&I.isObject(e.capping)&&e.id){var t=e.capping;switch(t.type){case"count":if(t.count&&0<t.count)if(t.expiration){r=(r=B.get("_snrs_notify_capping_"+e.id))||0,B.set("_snrs_notify_capping_"+e.id,++r,t.expiration),h.log("Store:setNotificationCapping done",r,"with expiration",t.expiration)}else{var n=B.get("_snrs_notify_capping");n&&I.isObject(n)||(n={});var r=n[e.id]||0;n[e.id]=++r,B.set("_snrs_notify_capping",n),h.log("Store:setNotificationCapping done",r)}}}},getNotificationCapping:function(e){if(h.log("Store:getNotificationCapping",e),e.id){var t=0;if(e.capping&&e.capping.expiration)t=(t=B.get("_snrs_notify_capping_"+e.id))||0;else{var n=B.get("_snrs_notify_capping");n&&I.isObject(n)&&n[e.id]&&(t=n[e.id])}return h.log("Store:getNotificationCapping value",t),t}},getProfileConfig:function(){var e=q.getContainer("_snrs_profile_config");if(e){var t=e.snrsProfileConfigExpire;return!t||18e4<Date.now()-parseInt(t)?null:e}return null},setProfileConfig:function(e){Array.isArray(e[A.EVENT_LIST_SIGNED_IDENTIFIED])&&(q.saveContainer("_snrs_profile_config",e)&&q.setToContainer("_snrs_profile_config","snrsProfileConfigExpire",Date.now()))}},j={PERMISSION_AGREED:"agreed",PERMISSION_BLOCKED:"blocked",PERMISSION_DEFAULT:"default",_provider:null,init:function(){return h.log("WebPushApp:init"),p.uniquePromiseHandler("WebPushApp.init",function(e,t){if(h.log("WebPushApp:init",K._config.mode),K._config.mode===K.CONFIG_WEBPUSH_MODE_NATIVE)j._provider=X;else{if(K._config.mode!==K.CONFIG_WEBPUSH_MODE_EXTERNAL)return t(new Error("Unable to init web push app"));j._provider=Y}j.initProvider().then(function(){h.log("WebPushApp:init done"),e()}).catch(function(e){h.error("WebPushApp:init error",e),t(e)})})},parseFirebaseErrorCode:function(e){switch(e){case"messaging/permission-blocked":case"messaging/notifications-blocked":return K.EVENT_ERROR_CODE_PERMISSION_BLOCKED;case"messaging/permission-default":case"messaging/notifications-default":return K.EVENT_ERROR_CODE_PERMISSION_DEFAULT;default:return K.EVENT_ERROR_CODE_PERMISSION_UNKNOWN}},initProvider:function(){return h.log("WebPushApp:initProvider",j._provider),j._provider.init()},requestPermission:function(e){return j._provider.requestPermission(e)},getToken:function(){return j._provider.getToken()},deleteToken:function(e){return j._provider.deleteToken(e)},showNotification:function(e){return j._provider.showNotification(e)},getPermission:function(){return j._provider.getPermission()},getDomain:function(){return j._provider.getDomain()}},Y={_iframe:null,init:function(){return new re(function(e,t){return h.log("WebPushExternalApp:init"),K._config.agreement_page_domain?K._config.agreement_page_url?K._config.external_page_iframe_url?void Y.initIframe().then(function(){e()}).catch(function(e){t(e)}):t(new Error("Url for iframe external page is required")):t(new Error("Url for agreement page is required")):t(new Error("Domain for agreement page is required"))})},initIframe:function(){return new re(function(e,t){if(h.log("WebPushExternalApp:initIframe"),Y._iframe)return e();var n=null,r=K._config.agreement_page_domain+K._config.external_page_iframe_url+"?tc="+encodeURIComponent(d.trackerKey());g.getOption("acceptLangList")&&(r+="&lang="+encodeURIComponent(g.getOption("acceptLangList").join(",")));var i=document.createElement("iframe");i.width=0,i.height=0,i.src=r,i.style="display: none; visibility: hidden; height: 0px; width: 0px;",i.onload=function(){h.log("WebPushExternalApp:initIframe iframe loaded"),n&&(clearTimeout(n),n=null,Y._iframe=i,e())},n=setTimeout(function(){t(new Error("Timeout occurred while loading iframe"))},4e3),document.body.appendChild(i)})},getDomain:function(){var e,t=K._config.agreement_page_domain.split("/");return 2<t.length&&(e=t[2]),h.log("WebPushExternalApp:getDomain",e),e},createPromiseWithIframeRequired:function(e){return Y._iframe?new re(e):re.reject(new Error("WebPush external app is not initialized"))},sendAndGetResponseFromIframe:function(s,a){return Y.createPromiseWithIframeRequired(function(n,r){a=void 0!==a?a:1e3,s.payload||(s.payload={}),h.log("WebPushExternalApp:sendAndGetResponseFromIframe with timeout",s,a);var t=Y._iframe.contentWindow,i=null,o=null;K.getMessageChannel().then(function(e){e.port1.onmessage=function(e){if(h.log("WebPushExternalApp:sendAndGetResponseFromIframe onmessage took",o.getElapsedTimeString(),e.data,e),i){if(clearTimeout(i),i=null,!e.data||!e.data.payload||"webpush.success"!==e.data.action){if("webpush.error"===e.data.action&&e.data.payload){var t=new Error(e.data.payload.message||"Unknown error message");return e.data.payload.code&&(t.code=e.data.payload.code),r(t)}return r(new Error("Invalid response"))}n(e.data)}},i=setTimeout(function(){r(new Error("Timeout occurred while waiting for response"))},a),o=c.create("sendAndGetResponseFromIframe"+s.action),t.postMessage(s,K._config.agreement_page_domain,[e.port2])}).catch(function(e){h.error("WebPushExternalApp:sendAndGetResponseFromIframe Can not get message channel",e),r(new Error("Can not get message channel"))})})},onExternalWindowAgreementMessageHandler:function(e){switch(h.log("WebPushExternalApp:onExternalWindowAgreementMessageHandler onmessage",e.data,e),e.data.action){case"webpush.subscribe":case"webpush.subscribeExists":J.setSubscription(J.SUBSCRIPTION_SUBSCRIBE,!0),J.setBrowserPermission(J.BROWSER_PERMISSION_AGREED,!0);break;case"webpush.subscribeBlock":J.setBrowserPermission(J.BROWSER_PERMISSION_BLOCKED,!0)}},requestPermission:function(i){return new re(function(n,r){i=i||{},h.log("WebPushExternalApp:requestPermission",i),Y.getPermission().then(function(e){if(e===j.PERMISSION_AGREED)return n(!1);if(e===j.PERMISSION_BLOCKED){var t=new Error("Unable to request permission - has been blocked");return t.code=K.EVENT_ERROR_CODE_PERMISSION_BLOCKED,r(t)}return Y.requestPermissionByAgreementPage(i)}).catch(function(e){return h.error("WebPushExternalApp:requestPermission Can not get permission",e),Y.requestPermissionByAgreementPage(i)})})},requestPermissionByAgreementPage:function(u){return new re(function(n,r){u=u||{},h.log("WebPushExternalApp:requestPermissionByAgreementPage",u);var e=screen.width/2-240,t=screen.height/2-270,i=K._config.agreement_page_domain+K._config.agreement_page_url+"?tc="+encodeURIComponent(d.trackerKey());g.getOption("acceptLangList")&&(i+="&lang="+encodeURIComponent(g.getOption("acceptLangList").join(",")));var o="width=480, height=540, left="+e+", top= "+t;h.log("WebPushExternalApp:requestPermissionByAgreementPage open window",i,o);var s=ne.open(i,"snrsWebPushWindow",o);h.log("WebPushExternalApp:requestPermissionByAgreementPage webPushWindowHandler",s),s||(h.error("WebPushExternalApp:requestPermissionByAgreementPage Can not open an agreement window - has been blocked by browser"),r(new Error("Can not open an agreement window - has been blocked by browser")));var a,c=(new Date).getTime();a=setInterval(function(){var e=(new Date).getTime(),t=e-c;if(h.log("WebPushExternalApp:requestPermissionByAgreementPage webPushWindowHandler connecting to agreement window (time: %s ms)",t),3e3<=e-c&&a)return clearInterval(a),a=k,s.close(),r(new Error("Can not connect to agreement window - timeout occurred"));K.getMessageChannel().then(function(e){e.port1.onmessage=function(e){h.log("WebPushExternalApp:requestPermissionByAgreementPage agreement window onmessage",e.data,e),"webpush.readyToSendMessage"===e.data.action&&a&&(clearInterval(a),a=k,K.getMessageChannel().then(function(e){e.port1.onmessage=Y.onExternalWindowAgreementMessageHandler,s.postMessage({action:"webpush.readyToReceiveStatus",payload:{}},K._config.agreement_page_domain,[e.port2]),n()}).catch(function(e){h.error("WebPushExternalApp:requestPermissionByAgreementPage onSuccessConnectToWindow Can not get message channel",e),r(new Error("Can not get message channel"))}))},s.postMessage({action:"webpush.readyToReceiveMessage",payload:{}},K._config.agreement_page_domain,[e.port2])}).catch(function(e){a&&(clearInterval(a),a=k),h.error("WebPushExternalApp:requestPermissionByAgreementPage Can not get message channel",e),r(new Error("Can not get message channel"))})},50)})},getPermission:function(){return h.log("WebPushExternalApp:getPermission"),Y.createPromiseWithIframeRequired(function(t,n){Y.sendAndGetResponseFromIframe({action:"webpush.getPermission",payload:{}}).then(function(e){if(h.info("WebPushExternalApp:getPermission then response",e),e.payload.permission===k)return re.reject(new Error("Invalid response from iframe worker"));t(e.payload.permission)}).catch(function(e){h.error("WebPushExternalApp:getPermission Can not get permission",e),n(new Error("Can not get permission"))})})},getToken:function(){return h.log("WebPushExternalApp:getToken"),Y.createPromiseWithIframeRequired(function(t,n){Y.sendAndGetResponseFromIframe({action:"webpush.getToken",payload:{}}).then(function(e){h.info("WebPushExternalApp:getToken then response",e),t(e.payload.token)}).catch(function(e){h.error("WebPushExternalApp:getToken Can not get token",e);var t=j.parseFirebaseErrorCode(e.code);t===K.EVENT_ERROR_CODE_PERMISSION_BLOCKED&&((e=new Error("Can not get token, it has been blocked")).code=t),n(e)})})},deleteToken:function(e){return h.log("WebPushExternalApp:deleteToken"),Y.createPromiseWithIframeRequired(function(e,t){return h.info("WebPushExternalApp:deleteToken This functionality for external mode is not supported yet"),t(new Error("Not supported yet"))})},showNotification:function(e){return h.log("WebPushExternalApp:showNotification",e),Y.createPromiseWithIframeRequired(function(t,n){h.info("WebPushExternalApp:showNotification payload",e),Y.sendAndGetResponseFromIframe({action:"webpush.showNotification",payload:e||{}}).then(function(e){h.info("WebPushExternalApp:showNotification then response",e),t()}).catch(function(e){h.error("WebPushExternalApp:showNotification Can not show notification",e),n(e)})})}},G={_initialized:!1,_html:null,_container:null,_widgetCtr:null,_widgetStateCtr:null,_buttonTriggerCtr:null,_closeBtn:null,_widgetClass:"snrs-webpush--widget",_widgetStateContainerClass:"snrs-webpush--widget-state-container",_buttonTriggerClass:"snrs-webpush--widget-trigger",_triggerWidgetCloseClass:"snrs-webpush--trigger-widget-close",_triggerWidgetOpenClass:"snrs-webpush--trigger-widget-open",_triggerHideClass:"snrs-webpush--trigger-hide",_triggerShowClass:"snrs-webpush--trigger-show",_containerShownClass:"snrs-webpush--shown",_widgetOpenedClass:"snrs-webpush--widget-opened",_statePrefixClass:"snrs-webpush--state-",STATE_SUBSCRIBE:"subscribe",STATE_UNSUBSCRIBE:"unsubscribe",STATE_UNKNOWN:"unknown",_closeBtnClass:"snrs-webpush--close",_options:{},_callbackStack:{onStateContentChange:function(){},onStateChange:function(){},onButtonTriggerClick:function(){},onWidgetClose:function(){},onWidgetOpen:function(){},onShow:function(){},onHide:function(){}},getStateOptionList:function(){return[G.STATE_SUBSCRIBE,G.STATE_UNSUBSCRIBE,G.STATE_UNKNOWN]},init:function(r){return new re(function(e,t){if(h.log("WebPushFloatingButton:init - initialized:",G._initialized,r),G._initialized)return e();if(G._options=I.extend({},r),!G._options)return h.error("WebPushFloatingButton:init - options are not defined",G._options),t(new Error("Options are not defined"));if(G._html=G._options.content,!G._html)return h.error("WebPushFloatingButton:init - Content is not defined",G._options),t(new Error("Content is not defined"));if(G._options.change_state&&I.isEmpty(G._options.state_content))return h.error("WebPushFloatingButton:init - State content options are not defined",G._options),t(new Error("State content options are not defined"));var n=document.createElement("div");if(n.innerHTML=G._html,G._container=n.childNodes[0],G._widgetCtr=G._container.querySelector("."+G._widgetClass),G._widgetStateCtr=G._container.querySelector("."+G._widgetStateContainerClass),G._buttonTriggerCtr=G._container.querySelector("."+G._buttonTriggerClass),!G._widgetCtr||!G._buttonTriggerCtr)return h.error("WebPushFloatingButton:init - Content is invalid",G._widgetCtr,G._buttonTriggerCtr),t(new Error("Content is invalid"));G._options.change_state&&!G._widgetStateCtr&&(h.info("WebPushFloatingButton:init - Widget state container is not defined - used widget container instead"),p.addClass(G._widgetCtr,G._widgetStateContainerClass),G._widgetStateCtr=G._widgetCtr),p.removeClass(G._container,G._containerShownClass),G.updateState(G.STATE_UNKNOWN),document.body&&(document.body.appendChild(G._container),G.attachGeneralActions(ne.document)),G._initialized=!0,e()})},attachGeneralActions:function(e){h.log("WebPushFloatingButton:_attachGeneralActions"),e=e||G._container,p.attachHandlerByClassName(e,G._buttonTriggerClass,"click",G.onButtonTriggerClick.bind(G)),p.attachHandlerByClassName(e,G._triggerWidgetCloseClass,"click",G.closeWidget.bind(G)),p.attachHandlerByClassName(e,G._triggerWidgetOpenClass,"click",G.openWidget.bind(G)),p.attachHandlerByClassName(e,G._triggerHideClass,"click",G.hide.bind(G)),p.attachHandlerByClassName(e,G._triggerShowClass,"click",G.show.bind(G))},updateState:function(e){if(h.log("WebPushFloatingButton:updateState",e,G._options),!I.inArray(e,G.getStateOptionList()))throw new Error('State value "'+e+'" is invalid');p.removeClass(G._container,G._statePrefixClass+G.STATE_UNKNOWN),p.removeClass(G._container,G._statePrefixClass+G.STATE_SUBSCRIBE),p.removeClass(G._container,G._statePrefixClass+G.STATE_UNSUBSCRIBE),p.addClass(G._container,G._statePrefixClass+e),G._triggerCallback("onStateChange",e),G._options.change_state&&G._widgetStateCtr&&(G._options.state_content&&G._options.state_content[e]!==k?(G._widgetStateCtr.innerHTML=G._options.state_content[e],G.attachGeneralActions(G._widgetStateCtr),G._triggerCallback("onStateContentChange",e,G._widgetStateCtr)):h.error("WebPushFloatingButton:updateState Content is not defined for current state",e,G._options.state_content))},_triggerCallback:function(e){if(h.log("WebPushFloatingButton:_triggerCallback",e,G._callbackStack),G._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=G._callbackStack[e];if(I.isFunction(r))if(h.log("WebPushFloatingButton:_triggerCallback call with args",e,t,r),!1===r.apply(G,t))return!1}},onStateContentChangeHandler:function(e){G._callbackStack.onStateContentChange=e},onStateChangeHandler:function(e){G._callbackStack.onStateChange=e},onButtonTriggerClickHandler:function(e){G._callbackStack.onButtonTriggerClick=e},onWidgetCloseHandler:function(e){G._callbackStack.onWidgetClose=e},onWidgetOpenHandler:function(e){G._callbackStack.onWidgetOpen=e},onShowHandler:function(e){G._callbackStack.onShow=e},onHideHandler:function(e){G._callbackStack.onHide=e},show:function(){var e=G.isShown();h.log("WebPushFloatingButton:show - hasShow",!!e),e||(p.addClass(G._container,G._containerShownClass),G._triggerCallback("onShow"))},hide:function(){var e=G.isShown();h.log("WebPushFloatingButton:hide - hasShow",!!e),e&&(p.removeClass(G._container,G._containerShownClass),G._triggerCallback("onHide"))},isShown:function(){return p.hasClass(G._container,G._containerShownClass)},isHidden:function(){return!G.isShown()},isWidgetOpened:function(){return p.hasClass(G._container,G._widgetOpenedClass)},isWidgetClosed:function(){return!G.isWidgetOpened()},onButtonTriggerClick:function(){return!1!==G._triggerCallback("onButtonTriggerClick")&&(G.isWidgetOpened()?G.closeWidget():G.openWidget())},closeWidget:function(){var e=G.isWidgetOpened();h.log("WebPushFloatingButton:closeWidget - isWidgetOpened",!!e),e&&(p.removeClass(G._container,G._widgetOpenedClass),G._triggerCallback("onWidgetClose"))},openWidget:function(){var e=G.isWidgetOpened();h.log("WebPushFloatingButton:closeWidget - isWidgetOpened",!!e),e||(p.addClass(G._container,G._widgetOpenedClass),G._triggerCallback("onWidgetOpen"))}},K={CONFIG_WEBPUSH_MODE_NATIVE:"native",CONFIG_WEBPUSH_MODE_EXTERNAL:"external",EVENT_ERROR_CODE_PERMISSION_BLOCKED:"permission-blocked",EVENT_ERROR_CODE_PERMISSION_DEFAULT:"permission-default",EVENT_ERROR_CODE_PERMISSION_UNKNOWN:"permission-unknown",_stylesUrl:[],_config:{},_appIsReady:k,_callbackStack:{onWebPushSubscribe:function(){},onWebPushSubscribeBlock:function(){},onWebPushSubscribeDiscard:function(){},onWebPushUnsubscribe:function(){},onBrowserPermissionAgree:function(){},onBrowserPermissionBlock:function(){},onBrowserPermissionDiscard:function(){},onMessage:function(){}},onWebPushSubscribe:function(e){K._callbackStack.onWebPushSubscribe=e},onWebPushSubscribeBlock:function(e){K._callbackStack.onWebPushSubscribeBlock=e},onWebPushSubscribeDiscard:function(e){K._callbackStack.onWebPushSubscribeDiscard=e},onWebPushUnsubscribe:function(e){K._callbackStack.onWebPushUnsubscribe=e},onBrowserPermissionAgree:function(e){K._callbackStack.onBrowserPermissionAgree=e},onBrowserPermissionBlock:function(e){K._callbackStack.onBrowserPermissionBlock=e},onBrowserPermissionDiscard:function(e){K._callbackStack.onBrowserPermissionDiscard=e},onMessage:function(e){K._callbackStack.onMessage=e},getConfigWebpushModeSupportedList:function(){return[K.CONFIG_WEBPUSH_MODE_NATIVE,K.CONFIG_WEBPUSH_MODE_EXTERNAL]},init:function(n){return p.uniquePromiseHandler("WebPushManager.init",function(e,t){h.log("WebPushManager:init",n),g.getWebPushProfileConfig().then(function(e){return re.resolve(I.extend(e||{},n||{}))}).then(K.setConfig).then(K.initState).then(K.isWebPushSupported).then(function(){return K.attachHandlers(ne.document)}).then(function(){return K.initApp().then(function(){return K.checkAndSynchronizeStateIfRequired().then(function(e){h.log("WebPushManager:init checkAndSynchronizeStateIfRequired then",e)}).catch(function(e){h.error("WebPushManager:init checkAndSynchronizeStateIfRequired then error",e)}),re.resolve()}).then(function(){return K.initFloatingButton().then(function(){h.log("WebPushManager:init initFloatingButton done")}).catch(function(e){h.error("WebPushManager:init initFloatingButton Can not init floating button - error occurred",e)}),re.resolve()}).catch(function(e){h.error("WebPushManager:init initApp error",e)}),re.resolve()}).then(function(){h.log("WebPushManager:init done"),e()}).catch(function(e){h.error("WebPushManager:init error",e),t(e)})})},getMode:function(){return K._config.mode},getDomain:function(){return j.getDomain()},initFloatingButton:function(){return new re(function(e,t){if(!K._config.floating_button)return h.log("WebPushManager:init Floating button is disabled",K._config),e();var n=K._config.language;return n?(G.onStateContentChangeHandler(K.onFloatingButtonStateContentChange.bind(K)),G.init(n.floating_button).then(function(){K.attachHandlers(G._container),K.updateFloatingButtonState(),G.show(),e()}).catch(t)):(h.error("WebPushManager:init Can not init floating button - language config is not defined",K._config),t(new Error("Language config is not defined")))})},onFloatingButtonStateContentChange:function(e,t){h.log("WebPushManager:onFloatingButtonStateContentChange",e,t),K.attachHandlers(t)},onWebPushStateSubscriptionChange:function(e,t){h.log("WebPushManager:onWebPushStateChange",e,t),h.log("WebPushManager:onWebPushStateChange WebPushFloatingButton._initialized",G._initialized),G._initialized&&K.updateFloatingButtonState()},updateFloatingButtonState:function(){return new re(function(e,t){if(!G._initialized)return h.error("WebPushManager:init Can not update floating button state - module is not initialized",G),t(new Error("Can not update floating button state - module is not initialized"));var n=null;switch(J.getSubscription()){case J.SUBSCRIPTION_UNKNOWN:n=G.STATE_UNKNOWN;break;case J.SUBSCRIPTION_SUBSCRIBE:n=G.STATE_SUBSCRIBE;break;case J.SUBSCRIPTION_UNSUBSCRIBE:n=G.STATE_UNSUBSCRIBE}G.updateState(n),e()})},initApp:function(){return new p.uniquePromiseHandler("WebPushManager.initApp",function(e,t){h.log("WebPushManager:initApp"),j.init().then(function(){var e=J.getSubscription();return h.log("WebPushManager:initApp check subscription",e),e!==J.SUBSCRIPTION_UNKNOWN?re.resolve():(h.log("WebPushManager:initApp 0"),new re(function(t,e){K.sendRequestToCheckSubscription().then(function(e){h.log("WebPushManager:initApp sendRequestToCheckSubscription then",e),J.setSubscription(e,!0),t()}).catch(function(e){h.error("WebPushManager:initApp Can not get subscription",e),t()})}))}).then(function(){var e=J.getBrowserPermission();return h.log("WebPushManager:initApp check browser permission",e),e!==J.BROWSER_PERMISSION_DEFAULT?re.resolve():(h.log("WebPushManager:initApp 0"),new re(function(t,e){K.getBrowserPermission().then(function(e){h.log("WebPushManager:initApp getBrowserPermission then",e),J.setBrowserPermission(e,!1),t()}).catch(function(e){h.error("WebPushManager:initApp Can not get browser permission",e),t()})}))}).then(function(){h.log("WebPushManager:initApp done"),K._appIsReady=!0,e()}).catch(function(e){return h.error("WebPushManager:initApp Can not init web push app",e),K._appIsReady=!1,t(new Error("Can not init web push app"))})})},prepareStyles:function(){return new re(function(e,t){if(h.log("WebPushManager:prepareStyles"),!K._stylesUrl)return e();p.addStyles(K._stylesUrl).then(function(){e()}).catch(function(e){h.error(e),t(e)})})},setConfig:function(r){return new re(function(e,t){r=r||{},h.log("WebPushManager:setConfig",r);var n={service_worker_path:"/snr-sw.js",service_worker_scope:"/",sender_id:null,public_vapid:null,agreement_page_domain:null,agreement_page_url:"/agreement.html",external_page_iframe_url:"/iframeWorker.html",mode:K.CONFIG_WEBPUSH_MODE_NATIVE,enabled:!1};h.log("WebPushManager:setConfig extend",n,K._config,r),K._config=I.extend({},n,K._config,r),K._config.service_worker_path||(K._config.service_worker_path=n.service_worker_path),K._config.service_worker_scope||(K._config.service_worker_scope=n.service_worker_scope),h.log("WebPushManager:setConfig return ",K._config),e()})},initState:function(){return new re(function(t,e){h.log("WebPushManager:initState"),J.init().then(function(){h.log("WebPushManager:initState done"),J.onStateSubscriptionChangeHandler(K.onWebPushStateSubscriptionChange.bind(K)),t()}).catch(function(e){return h.error("WebPushManager:initState Can not restore state from cache",e),t()})})},checkAndSynchronizeStateIfRequired:function(){return new re(function(e,t){h.log("WebPushManager:checkAndSynchronizeStateIfRequired");J.getBrowserPermission(),J.getSubscription();navigator.serviceWorker.getRegistrations().then(function(e){return e[0].pushManager.getSubscription().then(function(e){if(h.log("WebPushManager:checkAndSynchronizeStateIfRequired current subscription",e),e){var t=p.uint8ArrayToBase64Url(new Uint8Array(e.options.applicationServerKey));null!==K._config.public_vapid&&t!==K._config.public_vapid&&(h.log("WebPushManager:checkAndSynchronizeStateIfRequired publicVapid and server keys differ. Unsubscribing."),e.unsubscribe().then(function(){J.setBrowserPermissionSaved(!1),J.setSubscriptionSaved(!1)}))}}).catch(function(e){h.error("WebPushManager:checkAndSynchronizeStateIfRequired could not convert server key to string",e)})}).then(function(){if(J.isSubscriptionSaved()&&J.isBrowserPermissionSaved())return e();re.resolve().then(function(){var e=J.getBrowserPermission();return J.isBrowserPermissionSaved()||e!==J.BROWSER_PERMISSION_AGREED?re.resolve():(h.log("WebPushManager:checkAndSynchronizeStateIfRequired try saving browser permission",e),new re(function(t,e){K.getToken().then(function(e){if(h.log("WebPushManager:checkAndSynchronizeStateIfRequired getToken then",e),!J.isTokenChanged(e))return h.log("WebPushManager:checkAndSynchronizeStateIfRequired getToken token has the same value - do not send request",e),J.setBrowserPermissionSaved(!0),t(e);J.setToken(e),K.sendBrowserPermissionRequest(e,K._config.public_vapid).then(function(){J.setBrowserPermissionSaved(!0)}).catch(function(e){h.error("WebPushManager:checkAndSynchronizeStateIfRequired sendAddBrowserPermissionRequest then error",e)}),t(e)}).catch(function(e){h.error("WebPushManager:checkAndSynchronizeStateIfRequired getToken then error",e),t()})}))}).then(function(e){var n=J.getSubscription();return J.isSubscriptionSaved()||n===J.SUBSCRIPTION_UNKNOWN?re.resolve():(h.log("WebPushManager:checkAndSynchronizeStateIfRequired try saving subscription",n),new re(function(e,t){if(n===J.SUBSCRIPTION_SUBSCRIBE)K.sendSubscribeRequest().then(function(){J.setSubscriptionSaved(!0)}).catch(function(e){h.error("WebPushManager:checkAndSynchronizeStateIfRequired sendSubscribeRequest then error",e)});else{if(n!==J.SUBSCRIPTION_UNSUBSCRIBE)return e();K.sendUnsubscribeRequest().then(function(){J.setSubscriptionSaved(!0)}).catch(function(e){h.error("WebPushManager:checkAndSynchronizeStateIfRequired sendUnsubscribeRequest then error",e)})}e()}))}).then(function(){e()}).catch(function(e){t(e)})}).catch(function(e){return h.error("WebPushManager:checkAndSynchronizeStateIfRequired could not get current subscription",e),t(new Error("Could not get current subscription"))})})},getBrowserPermission:function(){return h.log("WebPushManager:getBrowserPermission"),new re(function(t,e){j.getPermission().then(function(e){h.log("WebPushManager:getBrowserPermission getPermission then",e),t(K.mapAppPermissionToBrowserPermissionValues(e))}).catch(e)})},getSubscription:function(){return h.log("WebPushManager:getSubscription"),K.getSubscriptionState()},mapAppPermissionToBrowserPermissionValues:function(e){switch(e){case j.PERMISSION_DEFAULT:return J.BROWSER_PERMISSION_DEFAULT;case j.PERMISSION_BLOCKED:return J.BROWSER_PERMISSION_BLOCKED;case j.PERMISSION_AGREED:return J.BROWSER_PERMISSION_AGREED}},isWebPushSupported:function(){return new re(function(e,t){return h.log("WebPushManager:isWebPushSupported",K._config,document.location,b.getProtocol()),K._config.enabled?I.inArray(K._config.mode,K.getConfigWebpushModeSupportedList())?K._config.mode===K.CONFIG_WEBPUSH_MODE_NATIVE&&"localhost"!==document.location.hostname&&"https"!==b.getProtocol()?(h.error('WebPushManager:isWebPushSupported WebPush service do not support unsecured protocol "%s"',document.location.protocol),t(new Error("WebPush service do not support unsecured protocol"))):"PushManager"in ne?void e():(h.error("WebPushManager:isWebPushSupported This browser does not support push notification"),t(new Error("This browser does not support push notification"))):(h.error('WebPushManager:isWebPushSupported WebPush mode "%s" is not supported',K._config.mode),t(new Error("WebPush mode is not supported"))):(h.info("WebPushManager:isWebPushSupported WebPush is currently disabled",K._config.enabled),t(new Error("WebPush is currently disabled")))})},isWebPushAppReady:function(){return new re(function(e,t){h.log("WebPushManager:isWebPushAppReady",K._appIsReady),(!0===K._appIsReady?re.resolve():!1===K._appIsReady?re.reject(new Error("App not initialized")):K.initApp()).then(function(){e()}).catch(function(e){return h.error("WebPushManager:isWebPushAppReady WebPush app is currently not available"),t(new Error("WebPush is currently not available"))})})},checkSubscribeRequestNeed:function(){var e=J.getSubscription(),t=J.getBrowserPermission();return h.log("WebPushManager:checkSubscribeRequestNeed",e,t),t===J.BROWSER_PERMISSION_DEFAULT||t===J.BROWSER_PERMISSION_AGREED&&e!==J.SUBSCRIPTION_SUBSCRIBE},getSubscriptionState:function(){return J.getSubscription()},getBrowserPermissionState:function(){return J.getBrowserPermission()},attachHandlers:function(n,r){return new re(function(e,t){h.log("WebPushManager:attachEvents",n,r),p.attachHandlerByClassName(n,"snrs-webpush--trigger-subscribe","click",K.onWebPushTriggerSubscribeHandler,r),p.attachHandlerByClassName(n,"snrs-webpush--trigger-subscribeDiscard","click",K.onWebPushTriggerSubscribeDiscardHandler,r),p.attachHandlerByClassName(n,"snrs-webpush--trigger-unsubscribe","click",K.onWebPushTriggerUnsubscribeHandler,r),e()})},onWebPushTriggerSubscribeHandler:function(){return new re(function(t,n){h.log("WebPushManager:onWebPushTriggerSubscribeHandler"),K.subscribe().then(function(e){return h.log("WebPushManager:onWebPushTriggerSubscribeHandler requestPermission then hasShowed value",e),t(e)}).catch(function(e){h.error("WebPushManager:onWebPushTriggerSubscribeHandler requestPermission error occurred",e),n(e)})})},onWebPushTriggerSubscribeDiscardHandler:function(){return new re(function(e,t){h.log("WebPushManager:onWebPushTriggerSubscribeDiscardHandler"),K.onWebPushSubscribeDiscardHandler().then(function(){e()}).catch(function(e){h.error("WebPushManager:onWebPushTriggerSubscribeDiscardHandler onWebPushSubscribeDiscardHandler error occurred",e),t(e)})})},onWebPushTriggerUnsubscribeHandler:function(){return new re(function(e,t){h.log("WebPushManager:onWebPushTriggerUnsubscribeHandler"),K.unsubscribe().then(function(){h.log("WebPushManager:onWebPushTriggerUnsubscribeHandler requestPermission then"),e()}).catch(function(e){h.error("WebPushManager:onWebPushTriggerUnsubscribeHandler error occurred",e),t(e)})})},getMessageChannel:function(){return new re(function(e,t){if(h.log("WebPushManager:getMessageChannel"),!ne.MessageChannel)return t(new Error("MessageChannel is not supported"));var n=new ne.MessageChannel;h.log("WebPushManager:getMessageChannel result",n),e(n)})},onServiceWorkerMessageHandler:function(e){if(h.log("WebPushManager:onServiceWorkerMessageHandler onmessage",e.data,e),"message.click"===e.data.action){var t=e.data.notificationPayload;K.onMessageClickHandler(t.data)}},onMessageClickHandler:function(n){return new re(function(e,t){h.log("WebPushManager:onMessageClickHandler",n),e()})},onBrowserPermissionAgreeHandler:function(){return new re(function(t,n){h.log("WebPushManager:onBrowserPermissionAgreeHandler"),J.setBrowserPermission(J.BROWSER_PERMISSION_AGREED,!1),K.getToken().then(function(e){h.log("WebPushManager:onBrowserPermissionAgreeHandler getToken then",e),A.trackClientEvent("","webpush.permissionAgree",{token:e}),K._callbackStack.onBrowserPermissionAgree(),K.onWebPushSubscribeHandler(),t()}).catch(function(e){h.error("WebPushManager:onBrowserPermissionAgreeHandler getToken then error",e),n(e)})})},onBrowserPermissionBlockHandler:function(){return new re(function(e,t){h.log("WebPushManager:onBrowserPermissionBlockHandler"),J.setBrowserPermission(J.BROWSER_PERMISSION_BLOCKED,!1),A.trackClientEvent("","webpush.permissionBlock",{}),K._callbackStack.onBrowserPermissionBlock(),K.onWebPushSubscribeBlockHandler(),e()})},onBrowserPermissionDiscardHandler:function(){return new re(function(e,t){h.log("WebPushManager:onBrowserPermissionDiscardHandler"),A.trackClientEvent("","webpush.permissionDiscard",{}),K._callbackStack.onBrowserPermissionDiscard(),K.onWebPushSubscribeDiscardHandler(),e()})},onWebPushSubscribeHandler:function(){return new re(function(e,t){h.log("WebPushManager:onWebPushSubscribeHandler"),J.setSubscription(J.SUBSCRIPTION_SUBSCRIBE,!1),A.trackClientEvent("","webpush.subscribe",{}),K.checkAndSynchronizeStateIfRequired(),K._callbackStack.onWebPushSubscribe(),e()})},onWebPushSubscribeBlockHandler:function(){return new re(function(e,t){h.log("WebPushManager:onWebPushSubscribeBlockHandler"),A.trackClientEvent("","webpush.subscribeBlock",{}),K._callbackStack.onWebPushSubscribeBlock(),e()})},onWebPushSubscribeDiscardHandler:function(){return new re(function(e,t){h.log("WebPushManager:onWebPushSubscribeDiscardHandler"),A.trackClientEvent("","webpush.subscribeDiscard",{}),K._callbackStack.onWebPushSubscribeDiscard(),e()})},onWebPushUnsubscribeHandler:function(){return new re(function(e,t){h.log("WebPushManager:onWebPushUnsubscribeHandler"),J.setSubscription(J.SUBSCRIPTION_UNSUBSCRIBE,!1),A.trackClientEvent("","webpush.unsubscribe",{}),K.checkAndSynchronizeStateIfRequired(),K._callbackStack.onWebPushUnsubscribe(),e()})},requestPermission:function(e){return new re(function(t,n){e=e||{},j.requestPermission(e).then(function(e){h.log("WebPushManager:requestPermission then",e),t(e)}).catch(function(e){h.error("WebPushManager:requestPermission then error",e),n(e)})})},subscribe:function(e){return new re(function(t,n){e=e||{},j.requestPermission(e).then(function(e){if(h.log("WebPushManager:requestPermission then",e),!1===e)return J.setBrowserPermission(J.BROWSER_PERMISSION_AGREED,!1),K.onWebPushSubscribeHandler(),t(e);t(e)}).catch(function(e){h.error("WebPushManager:requestPermission then error",e),e.code===K.EVENT_ERROR_CODE_PERMISSION_BLOCKED&&(J.setBrowserPermission(J.BROWSER_PERMISSION_BLOCKED,!1),K.onWebPushSubscribeBlockHandler()),n(e)})})},unsubscribe:function(n){return new re(function(e,t){n=n||{},h.log("WebPushManager:unsubscribe"),K.onWebPushUnsubscribeHandler().then(function(){h.log("WebPushManager:unsubscribe then"),e()}).catch(function(e){h.error("WebPushManager:unsubscribe then error",e),t(new Error("Unable to unsubscribe webpush notifications"))})})},getToken:function(){return new re(function(t,n){j.getToken().then(function(e){if(e)return h.log("WebPushManager:getToken Token has been received",e),t(e);h.log("WebPushManager:getToken Can not get token, permission required"),t()}).catch(function(e){h.error("WebPushManager:getToken Can not get token, it has been blocked",e),n(e)})})},deleteToken:function(e){return new re(function(t,n){j.deleteToken(e).then(function(e){h.log("WebPushManager:deleteToken Token has been deleted",e),J.setBrowserPermission(J.BROWSER_PERMISSION_AGREED,!1),t()}).catch(function(e){h.error("WebPushManager:deleteToken Can not delete token, error occurred",e),n(new Error("Can not delete token, error occurred"))})})},sendSubscribeRequest:function(){return new re(function(e,t){h.log("WebPushManager:sendSubscribeRequest"),U.subscribeWebPushForClient().then(function(){h.log("WebPushManager:sendSubscribeRequest subscribed"),e()}).catch(function(e){h.error("WebPushManager:sendSubscribeRequest Can not subscribe, error occurred",e),t(new Error("Can not save subscribe status of notifications, error occurred"))})})},sendUnsubscribeRequest:function(){return new re(function(e,t){return h.log("WebPushManager:sendUnsubscribeRequest"),U.unsubscribeWebPushForClient().then(function(){h.log("WebPushManager:sendUnsubscribeRequest unsubscribed"),e()}).catch(function(e){h.error("WebPushManager:sendUnsubscribeRequest Can not unsubscribe web push, error occurred",e),t(new Error("Can not save unsubscribe status of notifications, error occurred"))}),e()})},sendRequestToCheckSubscription:function(){return new re(function(t,n){h.log("WebPushManager:sendRequestToCheckSubscription for domain",K.getDomain()),U.checkWebPushSubscriptionForClient(K.getDomain()).then(function(e){if(h.log("WebPushManager:sendRequestToCheckSubscription subscription",e,K.getDomain()),!I.inArray(e,J.getSubscriptionOptionList()))return re.reject(new Error("Subscription status is invalid"));t(e)}).catch(function(e){h.error("WebPushManager:sendRequestToCheckSubscription Can not get subscription status of notifications, error occurred",e),n(new Error("Can not get subscription status of notifications, error occurred"))})})},sendBrowserPermissionRequest:function(r,i){return new re(function(t,n){h.log("WebPushManager:sendBrowserPermissionRequest for domain",K.getDomain()),navigator.serviceWorker.getRegistrations().then(function(e){return e[0].pushManager.getSubscription().then(function(e){return h.log("WebPushManager:sendBrowserPermissionRequest current subscription",e.toJSON()),i?e.toJSON():null}).catch(function(e){h.error("WebPushManager:sendBrowserPermissionRequest could not get subscription",e)})}).then(function(e){U.addBrowserPermissionWebPushForClient(r,K.getDomain(),e).then(function(){h.log("WebPushManager:sendBrowserPermissionRequest Token has been saved",r,K.getDomain()),t()}).catch(function(e){h.error("WebPushManager:sendBrowserPermissionRequest Can not save token, error occurred",e),n(new Error("Can not save token, error occurred"))})}).catch(function(e){h.error("WebPushManager:sendBrowserPermissionRequest could not get subscription",e)})})},onTokenRefresh:function(){h.log("WebPushManager:onTokenRefresh"),J.setBrowserPermission(J.BROWSER_PERMISSION_AGREED,!1),K.checkAndSynchronizeStateIfRequired()},onMessageHandler:function(e){h.log("WebPushManager:onMessageHandler",e),e&&I.isDocumentVisible()&&(e.notification?K.showNotification(e):e.data&&K.onMessageClickHandler(e.data),K._callbackStack.onMessage(e))},showNotification:function(n){return new re(function(e,t){if(h.log("WebPushManager:showNotification",n),!n||!n.notification)return t(new Error("Payload is empty or it have not notification key"));n.notification=I.extend({},n.data,n.notification),j.showNotification(n).then(function(){h.log("WebPushManager:showNotification then",n)}).catch(function(e){h.error("Can not show notification",e),t(new Error("Can not show notification"))})})}},X={_firebaseAppNamespace:"SyneriseApp",_firebaseApp:null,_firebaseMessangingApp:null,_serviceWorkerRegistration:null,init:function(){return new re(function(e,t){h.log("WebPushNativeApp:init firebase",R),X.initFcmApp().then(X.registerServiceWorker).then(function(){h.log("WebPushNativeApp:init done"),e()}).catch(function(e){h.error("WebPushNativeApp:init error",e),t(e)})})},initFcmApp:function(){return new re(function(e,t){if(h.log("WebPushNativeApp:initFcmApp"),!R)return t(new Error("Firebase Cloud Messaging APP is required"));if(!K._config.sender_id)return t(new Error("Sender id is required for web push"));var n={messagingSenderId:K._config.sender_id};X._firebaseApp=R.initializeApp(n,X._firebaseAppNamespace),X._firebaseMessangingApp=R.messaging(X._firebaseApp),X._firebaseMessangingApp.onTokenRefresh(function(){h.log("WebPushNativeApp:initFcmApp onTokenRefresh"),K.onTokenRefresh()}),X._firebaseMessangingApp.onMessage(function(e){h.log("WebPushNativeApp:initFcmApp onMessage",e),K.onMessageHandler(e)}),K._config.public_vapid&&(h.log("WebPushNativeApp:initFcmApp usePublicVapidKey ",K._config.public_vapid),X._firebaseMessangingApp.usePublicVapidKey(K._config.public_vapid)),e()})},registerServiceWorker:function(){return new re(function(t,n){if(h.log("WebPushNativeApp:registerServiceWorker"),!X._firebaseApp||!X._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));if(!("serviceWorker"in navigator))return n(new Error("Service worker in not supported"));var e=g.getBuildHash();navigator.serviceWorker.register(K._config.service_worker_path+"?hash="+e,{scope:K._config.service_worker_scope}).then(function(e){h.log("WebPushNativeApp:registerServiceWorker Registration succeeded. Scope is "+e.scope),X._serviceWorkerRegistration=e,X._firebaseMessangingApp.useServiceWorker(X._serviceWorkerRegistration),t()}).catch(function(e){h.fatal("WebPushNativeApp:registerServiceWorker Registration failed with ",e),n(new Error("Service worker registration failed"))})})},getDomain:function(){return location.hostname},requestPermission:function(e){return new re(function(t,n){if(e=e||{},h.log("WebPushNativeApp:requestPermission",e),!X._firebaseApp||!X._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));X.getToken().then(function(e){if(h.log("WebPushNativeApp:requestPermission getToken then",e),e)return t(!1);X._firebaseMessangingApp.requestPermission().then(function(e){h.log("WebPushNativeApp:requestPermission Notification permission granted",e),K.onBrowserPermissionAgreeHandler()}).catch(function(e){h.error("WebPushNativeApp:requestPermission Unable to get permission to notify",e);var t=new Error("Unable to get permission to notify");switch(t.code=j.parseFirebaseErrorCode(e.code),t.code){case K.EVENT_ERROR_CODE_PERMISSION_BLOCKED:K.onBrowserPermissionBlockHandler();break;case K.EVENT_ERROR_CODE_PERMISSION_DEFAULT:K.onBrowserPermissionDiscardHandler()}}),t()}).catch(function(e){h.error("WebPushNativeApp:requestPermission getToken then error",e);var t=new Error("Unable to request permission to notify");t.code=e.code,n(t)})})},getPermission:function(){return new re(function(n,r){if(h.log("WebPushNativeApp:getPermission"),!X._firebaseApp||!X._firebaseMessangingApp)return r(new Error("WebPush manager is not initialized"));X.getToken().then(function(e){return h.log("WebPushNativeApp:getPermission getToken then",e),n(e?j.PERMISSION_AGREED:j.PERMISSION_DEFAULT)}).catch(function(e){if(h.error("WebPushNativeApp:getPermission getToken then error",e),e.code===K.EVENT_ERROR_CODE_PERMISSION_BLOCKED)return n(j.PERMISSION_BLOCKED);var t=new Error("Unable to get permission");t.code=e.code,r(t)})})},getToken:function(){return new re(function(t,n){if(h.log("WebPushNativeApp:getToken"),!X._firebaseApp||!X._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));X._firebaseMessangingApp.getToken().then(function(e){h.log("WebPushNativeApp:getToken then",e),t(e)}).catch(function(e){h.error(e),h.error("WebPushNativeApp:getToken Can not get token, it has been blocked",e);var t=new Error("Can not get token, it has been blocked");t.code=j.parseFirebaseErrorCode(e.code),n(t)})})},deleteToken:function(e){return new re(function(t,n){if(h.log("WebPushNativeApp:deleteToken"),!X._firebaseApp||!X._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));X._firebaseMessangingApp.deleteToken(e).then(function(e){t(e)}).catch(function(e){h.error("WebPushNativeApp:deleteToken Can not delete token, error occurred",e),n(new Error("Can not delete token, error occurred"))})})},showNotification:function(o){return new re(function(r,i){h.log("WebPushNativeApp:showNotification",o),navigator.serviceWorker.getRegistrations().then(function(e){h.log("WebPushNativeApp:showNotification serviceWorker getRegistrations",o,e);var t=document.location.origin+K._config.service_worker_scope;[].forEach.call(e,function(n){t==n.scope&&K.getMessageChannel().then(function(e){var t={action:"worker.showNotification",notificationPayload:o};e.port1.onmessage=K.onServiceWorkerMessageHandler,n.active.postMessage(t,[e.port2]),r()}).catch(function(e){h.error("Can not show notification. Can not get message channel",e),i(new Error("Can not show notification. Can not get message channel"))})})}).catch(function(e){h.error("Can not show notification. Service worker is not ready yet",e),i(new Error("Can not show notification. Service worker is not ready yet"))})})}},J={SUBSCRIPTION_SUBSCRIBE:"subscribe",SUBSCRIPTION_UNSUBSCRIBE:"unsubscribe",SUBSCRIPTION_UNKNOWN:"unknown",BROWSER_PERMISSION_AGREED:"agreed",BROWSER_PERMISSION_BLOCKED:"blocked",BROWSER_PERMISSION_DEFAULT:"default",_data:{subscription:"unknown",subscriptionSaved:!1,permission:"default",permissionSaved:!1,tokenTime:null,tokenHash:null},_dataLocalStorageKey:"snr-wp-state",_tokenSavedIntervalRefresh:36e5,_callbackStack:{onStateChange:function(){},onStateSubscriptionChange:function(){}},init:function(){return new re(function(t,e){h.log("WebPushState:init"),J.restoreStateFromLocalCache().then(function(){var e=V.getClientUuid();h.log("WebPushState:init current state",J._data),h.log("WebPushState:init uuids",e,J._data.uuid),h.log("WebPushState:init synchronized",J._data.permissionSaved),J._data.uuid&&e&&e===J._data.uuid?J._data.tokenTime?(new Date).getTime()-J._data.tokenTime>=J._tokenSavedIntervalRefresh&&(h.log("WebPushState:init timeout occurred for token saved status, clear permission saved status"),J._data.permissionSaved=!1):(h.log("WebPushState:init token time is not defined, clear permission saved status"),J._data.permissionSaved=!1):(h.log("WebPushState:init other client uuid, clear state for this client"),J._data.permissionSaved=!1,J._data.subscriptionSaved=!1,J._data.subscription=J.SUBSCRIPTION_UNKNOWN,J._data.tokenHash=null,J._data.tokenTime=null,J.saveStateInLocalCache()),h.log("WebPushState:init done",J._data),t()}).catch(function(){}