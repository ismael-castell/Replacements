var __awaiter,__generator,viewModels,__extends,Bnet;(function(n){var t,i;(function(n){n[n.scrollinmodal=0]="scrollinmodal";n[n.scrolloutsidemodal=1]="scrolloutsidemodal"})(t=n.ModalOverflowTypes||(n.ModalOverflowTypes={}));i=function(){function i(i,r){this.modalId=i;this.content=r;this.closed=!1;this.includeCloseButton=!0;this.preventBodyScroll=!0;this.escKeyClosesModal=!0;this.modalParentSelector="body";this.overflowType=t.scrollinmodal;this.extraModalClass=[];this.beforeOpenCallback=function(){};this.afterOpenCallback=function(){};this.beforeCloseCallback=function(){};this.afterCloseCallback=function(){};this.isInitialized=!1;this.transitionDuration=0;this.modalOpenHtmlClass="modal-open";this.eventBinder=new n.EventBinder("modal-"+i)}return Object.defineProperty(i.prototype,"modalElement",{get:function(){return this.$modal},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"modalContentElement",{get:function(){return this.$modal.find(".modal-content")},enumerable:!0,configurable:!0}),i.prototype.initialize=function(){this.buildModal();this.populateContent(this.content);this.onModalCreated();this.isInitialized=!0},i.prototype.onModalCreated=function(){},i.prototype.addListeners=function(){var n=this;this.eventBinder.for(this.$modalContainer).on("click",function(t){var i=$(t.target);i.closest(".modal").length||n.close()});this.eventBinder.for(this.$modal.find(".button-close")).on("click",function(){n.close()});if(this.overflowType===t.scrollinmodal)this.eventBinder.for(this.$modal.find(".modal-content")).on("touchmove",function(t){n.preventTouchOverscroll(t)});this.eventBinder.for($(document)).on("keydown",function(t){n.onKeyDown(t.which)})},i.prototype.open=function(){var n=this;this.isInitialized||this.initialize();this.beforeOpenCallback();$(this.modalParentSelector).append(this.$modalContainer);this.setHtmlClass(!0);this.preventBodyScroll&&this.stopBodyFromScrolling();setTimeout(function(){n.$modalContainer.addClass("open")},1e3/60);setTimeout(function(){n.afterOpenCallback()},this.transitionDuration);this.addListeners()},i.prototype.close=function(){var t=this;if(!this.closed){if(this.closed=!0,this.$modalContainer.length===0)throw"Modal has not been initialized!";this.determineTransitionDuration();this.beforeCloseCallback();this.$modalContainer.removeClass("open");this.setHtmlClass(!1);setTimeout(function(){t.$modalContainer.remove();t.afterCloseCallback()},this.transitionDuration);this.eventBinder.destroy();this.stopLoading();setTimeout(function(){return n.Utilities.Modals.unlockBodyScroll()},250)}},i.prototype.populateContent=function(n){var t,i;n instanceof jQuery?(i=n,i.is("script[type='text/html']")?(t=i.html(),this.content=$(t)):this.content=i):(t=$.trim(n),t.charAt(0)!=="<"&&(t="<div>"+t+"<\/div>"),this.content=$(t));this.$modal&&this.$modal.find(".modal-content").html(this.content)},i.prototype.addHtmlAfterContent=function(t){var i=typeof t=="string"?t:n.Utilities.Html.getOuterHtml(t),r=this.$modalContainer.find(".modal-after-content");r.html(i)},i.prototype.buildModal=function(){var n=this.includeCloseButton?'<div class="button-close"><i class="material-icons">close<\/i><\/div>':"",i=this.overflowType===t.scrollinmodal?n:"",r=this.overflowType===t.scrolloutsidemodal?n:"",u='\n\t\t\t\t<div class="modal-container flex '+this.overflowType+" "+this.extraModalClass.join(" ")+'" id="modal-'+this.modalId+'" data-overflowtype="'+t[this.overflowType]+'">\n\t\t\t\t\t'+r+'\n\t\t\t\t\t<div class="modal">\n\t\t\t\t\t\t'+i+'\n\t\t\t\t\t\t<div class="modal-content"><\/div>\n\t\t\t\t\t\t<div class="modal-after-content"><\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t';this.$modalContainer=$(u);this.$modal=this.$modalContainer.find(".modal")},i.prototype.setHtmlClass=function(n){var t=this;n?$("html").addClass(this.modalOpenHtmlClass):setTimeout(function(){$("html").removeClass(t.modalOpenHtmlClass)},this.transitionDuration/2)},i.prototype.onKeyDown=function(n){n===27&&this.escKeyClosesModal&&this.close()},i.prototype.determineTransitionDuration=function(){var i=this.$modal.css("transition-duration"),t=i.match(/[0-9\.]+/g),n;t&&(n=0,t.map(function(t){var i=parseFloat(t);n=i>n?i:n}),this.transitionDuration=n*1e3)},i.prototype.stopBodyFromScrolling=function(){$("#modal-open-scrollbar-offset").length||n.Utilities.Modals.lockBodyScroll()},i.prototype.preventTouchOverscroll=function(n){var t=n.currentTarget;t.scrollTop===0?t.scrollTop=1:t.scrollHeight===t.scrollTop+t.offsetHeight&&(t.scrollTop-=1);t.offsetHeight===t.scrollHeight&&n.preventDefault()},i.prototype.startLoading=function(n){n===void 0&&(n=this.modalElement);this.$loadingElement=n;n.destinyLoader({startOnInit:!0,background:!1})},i.prototype.stopLoading=function(){this.$loadingElement?this.$loadingElement.destinyLoader("stop"):n.log("No $loadingElement found")},i}();n.Modal=i})(Bnet||(Bnet={})),function(n){var t;(function(t){function f(n){var t={};n!==undefined&&(t.page=n);window.ga&&window.ga("send","pageview",t)}function u(n,t,i,r,u){var f={};i!==undefined&&(f.eventLabel=i);r!==undefined&&(f.eventValue=r);u=u||{};$.extend(f,u);window.ga&&window.ga("send","event",n,t,f)}function e(n,t,i,r,f){try{if(typeof f!="undefined"&&f!=null){var e=window.location.pathname,o=f.stack;u("Errors",e,o)}ServerVars.ShowErrorsInPage&&$("body").addClass("has-js-error")}catch(s){}}var i,r;(function(n){n[n.GoogleAnalytics=0]="GoogleAnalytics"})(i||(i={}));r=function(){function t(){}return t.prototype.userHasCookieConsent=function(){return typeof n.Utilities.User!="undefined"?n.Utilities.User.ConsentCookieIsEnabled()&&n.Utilities.User.CookieConsentIsCurrent():!1},t.prototype.loadTrackers=function(){},t.prototype.trackSession=function(){var i=n.Site.getPageData("SiteTagging"),r,t;if(i.SessionTracking)if(r=i.SessionTimeoutSeconds||1800,t=n.Utilities.SessionStorage.getItem("Session"),t){var e=moment(),u=JSON.parse(t),f={sessionId:u.sessionId,refreshDate:moment(u.refreshDate)};f.refreshDate.isBefore(e.add(r*-1,"seconds"))?this.createOrUpdateSession():this.createOrUpdateSession(f.sessionId)}else this.createOrUpdateSession()},t.prototype.createOrUpdateSession=function(t){var i={sessionId:t||n.Utilities.String.GenerateGuid(),refreshDate:moment()};n.Utilities.SessionStorage.setItem("Session",JSON.stringify(i))},t.Instance=new t,t}();t.BnetTracking=r;t.trackPageview=f;t.trackEvent=u;t.onError=e;window.onerror=function(t,i,r,u,f){try{n.Analytics.onError(t,i,r,u,f)}catch(e){}}})(t=n.Analytics||(n.Analytics={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){}return t.prototype.initialize=function(){this.consentValidity=n.Utilities.User.CookieConsentValidity();this.consentValidity!==n.Utilities.CookieConsentValidity.Current&&this.renderMessage()},t.prototype.autoSetCookie=function(){this.checkIsInEU()||setTimeout(function(){return n.Utilities.User.SetConsentCookie()},2e3)},t.prototype.checkIsInEU=function(){return inEU()},t.prototype.renderMessage=function(){var t,r;this.autoSetCookie();t=this.checkIsInEU();r=t?"#cookie-consent-template":"#cookie-passive-consent-template";this.consentValidity===n.Utilities.CookieConsentValidity.Expired&&(r=t?"#cookie-consent-update-template":"#cookie-passive-consent-update-template");var u=t?".js-accept-button":".js-close-me",f=$(r).html(),i=$(f);$("body").append(i);setTimeout(function(){return i.addClass("on")},100);$(u,i).on("click",function(){t&&n.Utilities.User.SetConsentCookie();i.remove()})},t.Instance=new t,t}();t.CookieConsent=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){}return t.prototype.initialize=function(){var t=this;if(n.Utilities.User.isAuthenticated)return Promise.all([this.getEmailValidationStatus(),this.getLocalStorageAlertVisibility()]).then(function(){!t.emailIsVerified&&t.localStorageAllows&&t.renderAlert()})},t.prototype.addListeners=function(){var t=this;$(document).on("click",".globalAlertsBar.validate-email",function(){n.Site.PageController.Instance.redirect("/"+Localizer.CurrentCultureName+"/Profile/Settings/254/"+t.userDetail.user.membershipId+"?category=Notifications")});$(document).on("click",".js-remove-email-bar",function(n){n.preventDefault();n.stopImmediatePropagation();t.removeBar();t.updateLocalStorageAlertVisibility(!1)})},t.prototype.getEmailValidationStatus=function(){var n=this;return bungieNetPlatform.userService.GetCurrentUserPromise().then(function(t){n.userDetail=t;n.emailIsVerified=t.emailStatus===9})},t.prototype.getLocalStorageAlertVisibility=function(){return n.Utilities.LocalStorage.getItem("show-email-validation-alert")?this.localStorageAllows=n.Utilities.LocalStorage.getItem("show-email-validation-alert")==="true":(n.Utilities.LocalStorage.setItem("show-email-validation-alert","true"),this.localStorageAllows=!0),Promise.resolve()},t.prototype.updateLocalStorageAlertVisibility=function(t){this.localStorageAllows=t;n.Utilities.LocalStorage.setItem("show-email-validation-alert",t.toString())},t.prototype.renderAlert=function(){var u=$("#alert-validateemail"),n,t,i,r;u.length===0||$("body").hasClass("HasPCMigrationAlert")||(n=$($("#alert-validateemail").html()),n.find("span").text(Localizer.Emails.VerifyYourEmail),t=$(".mainGlobalAlert"),t.length?($(n).insertBefore(t),$("body").addClass("HasTwoGlobalAlerts HasPCMigrationAlert")):($("body").addClass("HasPCMigrationAlert"),i=$("#explore-container"),r=$("#mainContent"),i.length?i.before(n):r.prepend(n)),this.addListeners())},t.prototype.removeBar=function(){$(".js-validate-email-global-alert").remove();$("body").removeClass("HasTwoGlobalAlerts HasPCMigrationAlert")},t.Instance=new t,t}();t.EmailValidationBar=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){this.eventName="fireteamUpdated"}return t.prototype.initialize=function(){this.addEventMuxSubscription();this.addEventListeners()},t.prototype.addEventMuxSubscription=function(){var t=this;n.EventMux.subscribe({eventType:Globals.RealTimeEventType.ClanFireteamUpdate,onUpdate:function(n){console.log(n);var i={fireteamUpdate:{isRemoved:n.update.isRemoved,membershipId:n.update.targetMembershipId,fireteamId:n.update.fireteamId,groupId:n.update.groupId}};$(document).trigger(t.eventName,i)}})},t.prototype.addEventListeners=function(){$(document).on(this.eventName,function(t,i){var r=i.fireteamUpdate;bungieNetPlatform.fireteamService.GetClanFireteam(r.groupId.toString(),r.fireteamId.toString(),function(t){var i=new n.ToastMessages.Client;i.show(n.ToastMessages.ToastMessageType.Info,Localizer.Format(Localizer.Clans.ahreflinkfireteamtitle,{link:"/"+Localizer.CurrentCultureName+"/ClanV2/Fireteam?groupId="+t.Summary.groupId+"&fireteamId="+t.Summary.fireteamId,title:t.Summary.title,action:r.isRemoved?Localizer.Clans.left:Localizer.Clans.joined}))},function(){})})},t}();t.FireteamUpdate=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){this.$footer=$("footer");this.initialize()}return t.prototype.initialize=function(){this.eventBinder=new n.EventBinder("retractableFooter");this.addTheTrigger();this.addListeners()},t.prototype.addTheTrigger=function(){this.$footer.prepend('<div class="js-footer footer-trigger">'+Localizer.Format(Localizer.Globals.copyright,{year:(new Date).getFullYear()})+' <div class="icon button gold small"><i class="material-icons">keyboard_arrow_up<\/i><\/div><\/div>')},t.prototype.addListeners=function(){var t=this;this.eventBinder.forDocument(".js-footer").on("click",function(i){if(i.preventDefault(),t.$footer.hasClass("open"))t.$footer.removeClass("open");else if(t.$footer.outerHeight()+100<$(window).height())t.$footer.addClass("open");else{var r=new n.Modal("footer",t.$footer);r.open()}})},t}();t.RetractableFooter=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(n){var t=function(){function n(){}return n.start=function(){this.$html.addClass("loaderbar-loading")},n.stop=function(){var n=this;this.$html.addClass("loaderbar-loaded");setTimeout(function(){n.$html.removeClass("loaderbar-loading");n.$html.removeClass("loaderbar-loaded")},1e3)},n.$html=$("html"),n}();n.LoaderBar=t})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function i(){this.pausedConversations=[];this.pauseAllConversations=!1}return i.prototype.initialize=function(){this.addEventMuxSubscriptions();this.toastClient=new n.ToastMessages.Client;this.setPausedConversations()},i.prototype.addEventMuxSubscriptions=function(){var t=this;n.EventMux.subscribe({eventType:Globals.RealTimeEventType.ConversationChanged,onUpdate:function(n){var i=n.update,r;i.conversationType==Globals.EventConversationType.Private&&(r=viewModels.loggedInUserModel().pmToastsEnabled(),r&&t.processToastEvent(i,!1));i.conversationType===Globals.EventConversationType.Clan&&t.processToastEvent(i,!0)}})},i.prototype.showToast=function(i,r,u,f,e,o){var c="",s=r.profilePicturePath,h;c=f&&e!=null?'<a href="/'+Localizer.CurrentCultureName+"/ClanV2/Conversation?chatId="+i+'" class="conversationUpdate">\n\t\t\t\t\t\t\t<span class="clanName">'+e.detail.name+": "+o+'<\/span>\n\t\t\t\t\t\t\t<span class="avatar" style="background-image:url('+s+')"><\/span>\n\t\t\t\t\t\t\t<strong>'+Localizer.Format(Localizer.Messages.displaynamesays,{displayName:r.displayName})+"<\/strong>\n\t\t\t\t\t\t\t<p>"+u+"<\/p>\n\t\t\t\t\t\t<\/a>":'<a href="#" data-messageid="'+i+'" class="btn_gotomessage conversationUpdate">\n\t\t\t\t\t\t\t<span class="avatar" style="background-image:url('+s+')"><\/span>\n\t\t\t\t\t\t\t<strong>'+Localizer.Format(Localizer.Messages.displaynamesays,{displayName:r.displayName})+"<\/strong>\n\t\t\t\t\t\t\t<p>"+u+"<\/p>\n\t\t\t\t\t\t<\/a>";this.toastClient.show(n.ToastMessages.ToastMessageType.Info,c);this.toastClient.maxConcurrentMessages=2;"Notification"in window&&Notification.prototype.permission==="granted"&&!document.hasFocus()&&(h=new Notification(Localizer.Messages.browsernewmessagenotificationtitle,{icon:s,body:u}),h.onclick=function(){t.UserNotify.NotificationPane.Instance.showConversation(i,e?t.UserNotify.MessagesType.GroupMessages:t.UserNotify.MessagesType.Messages);h.close()})},i.prototype.processToastEvent=function(t,i){var r=this,u=this.pausedConversations.indexOf(t.conversationId)>-1||this.pauseAllConversations;if(u){n.log("MessageUpdate: Conversation "+t.conversationId+" is paused, ignoring toast");return}t.senderMembershipId!==viewModels.loggedInUserModel().user.membershipId()&&bungieNetPlatform.userService.GetBungieNetUserById(t.senderMembershipId,function(n){i?typeof t.groupId!="undefined"&&t.groupId!=="0"&&bungieNetPlatform.groupV2Service.GetGroup(t.groupId,function(u){r.showToast(t.conversationId,n,t.preview,i,u,t.name)},function(){}):r.showToast(t.conversationId,n,t.preview,i)},function(){})},i.prototype.setPausedConversations=function(){var r=this,t,i;Modernizr.localstorage&&(t=n.Utilities.LocalStorage.getItem("chatToastSettings"),t&&(i=JSON.parse(t),i.length&&i.forEach(function(n){n.showToasts||r.pausedConversations.push(n.conversationId)})))},i.prototype.toggleIgnoreToastsForAllConversations=function(n){this.pauseAllConversations=n},i.prototype.ignoreToastsForConversationId=function(n){this.pausedConversations.push(n)},i.prototype.unignoreToastsForConversationId=function(n){var t=this.pausedConversations.indexOf(n);t>-1&&this.pausedConversations.splice(t,1)},i.prototype.isConversationToastIgnored=function(n){return this.pausedConversations.indexOf(n)>-1},i.Instance=new i,i}();t.MessageUpdate=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){}return t.prototype.initialize=function(){var n=this;viewModels.loggedInUserModelIsLoaded()?this.getMyClans():viewModels.loggedInUserModelIsLoaded.subscribe(function(){n.getMyClans()})},t.prototype.getMyClans=function(){var n=this;bungieNetPlatform.groupV2Service.GetGroupsForMember(Globals.BungieMembershipType.BungieNext,viewModels.loggedInUserModel().user.membershipId(),Globals.GroupsForMemberFilter.All,Globals.GroupType.Clan,function(t){t.results.length>1&&n.addClansToNav(t)},function(){})},t.prototype.addClansToNav=function(t){var r=n.Utilities.Enumerable.unique(t.results.map(function(n){return n.group.groupId})),i;r.length!==1&&(i=$(".nav_top [data-id=clan]"),i.length&&i.replaceWith(this.buildClansNavItems(t)))},t.prototype.buildClansNavItems=function(n){for(var t,u,r="",i=0;i<n.results.length;i++)t=n.results[i],u=this.getCrossSaveStatus(n,t),u==="activeClan"?r=this.buildClanNavItem(t,i+1,this.getCrossSaveStatus(n,t))+r:r+=this.buildClanNavItem(t,i+1,this.getCrossSaveStatus(n,t));return r},t.prototype.getCrossSaveStatus=function(n,t){var i="notCrossSaved";return t.member.destinyUserInfo.crossSaveOverride!=Globals.BungieMembershipType.None&&(i=n.areAllMembershipsInactive[t.group.groupId]?"inactiveClan":"activeClan"),i},t.prototype.buildClanNavItem=function(n,t,i){return i==="activeClan"?'\n\t\t\t\t<a data-id="clan_'+t+'" href= "/'+Localizer.CurrentCultureName+"/ClanV2/Chat?groupid="+n.group.groupId+'" class="cross-save">\n\t\t\t\t\t<img src="/img/theme/bungienet/icons/icon_cross_save_dark.png" alt="cross save icon" class="cross-save-icon icon" />\n\t\t\t\t\t<span>'+n.group.name+"<\/span>\n\t\t\t\t<\/a>":i==="inactiveClan"?'\n\t\t\t\t<a data-id="clan_'+t+'" href= "/'+Localizer.CurrentCultureName+"/ClanV2/Chat?groupid="+n.group.groupId+'" class="cross-save">\n\t\t\t\t\t<img src="/img/theme/bungienet/icons/icon_inactive_clan.png" alt="inactive clan icon" class="inactive-clan-icon icon" />\n\t\t\t\t\t<span style="opacity: 0.6">'+n.group.name+"<\/span>\n\t\t\t\t<\/a>":'\n\t\t\t\t<a data-id="clan_'+t+'" href= "/'+Localizer.CurrentCultureName+"/ClanV2/Chat?groupid="+n.group.groupId+'">\n\t\t\t\t\t<p class="platform-type" data-platform="'+Globals.BungieMembershipType[n.member.destinyUserInfo.membershipType]+'">\n\t\t\t\t\t\t'+Localizer.Shortplatforms[Globals.BungieMembershipType[n.member.destinyUserInfo.membershipType].toLowerCase()]+"\n\t\t\t\t\t<\/p>\n\t\t\t\t\t"+n.group.name+"\n\t\t\t\t<\/a>"},t.Instance=new t,t}();t.MyClan=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var u=function(){function u(n){this.ajaxSectionRegex=n;this.preventAjaxMode=!1;this.allowSamePathname=!1;this.scrollToTopOnAjaxLoad=!0;this.loadContent=!0;this.loadOutsideContent=!0;this.loadSubNav=!0;this.loadMainNavItems=!0;this.loadNavTop=!0;this.loadSidebar=!0;this.useCache=!0;this.beforeOnStateChange=function(){return!0};this.isLoadingPage=!1;this.appendCacheQuerystring="ajax=true";this.url=""+window.location.pathname+window.location.search;this.isSamePathname=!1;this.lastParsedUrl=window.location.pathname+window.location.search+window.location.hash;this.parseUrlTimer=null;this.forceRedirectUrlRegex=/\/Companion/gi;this.disableUiDuringLoad=!1;this.urlParsedCallback=function(){};this.onBeforeUnload=function(){return!1}}return u.prototype.initialize=function(){this.normalizeAjaxSectionRegex();this.unbindAll();this.handleRedirects();this.addListeners()},u.prototype.unbindAll=function(){$("*").unbind(".pagecontrol");$(document).unbind(".pagecontrol");$(window).unbind(".pagecontrol")},u.prototype.addListeners=function(){var n=this;$(document).on("click.pagecontrol","a:not(.exempt)[href]",function(t){return n.handleLinkClicks(t)});$(window).on({"popstate.pagecontrol statechange.pagecontrol":function(t){return n.onStateChange(t)},"hashchange.pagecontrol":function(t){return n.onStateChange(t)}})},u.prototype.onStateChange=function(t){var u=n.Utilities.Url.urlToAnchorElement(location.href),r,f;u.hash==""&&(r=i.doesLinkQualifyForAjax(u,null,this.ajaxSectionRegex),f=this.beforeOnStateChange(t,r),f)&&(r||(location.href=location.href),this.urlParserThrottle(t))},u.prototype.stateChange=function(t,i,r,u){r===void 0&&(r=!0);u===void 0&&(u=!1);var f=n.Utilities.Url.urlToAnchorElement(t);this.stateChangeAnchor(f,i,r,u)},u.prototype.stateChangeAnchor=function(t,r,u,f){var h=this,e,o,c,s,l;u===void 0&&(u=!0);f===void 0&&(f=!1);try{if(this.isLoadingPage=!0,t===undefined||t===null)throw"ERROR: No link specified. Cannot proceed with statechange";if(e=n.Utilities.Url.urlToAnchorElement(t),o=e.pathname,e.pathname.charAt(0)!=="/"&&(o="/"+o),!f&&(c=i.doesLinkQualifyForAjax(e,null,this.ajaxSectionRegex),!c)){n.warn("URL does not qualify for ajax loading. Redirecting...");location.href=e.href;return}s=""+o+e.search+e.hash;l=this.onBeforeUnload();l?n.Utilities.Modals.Confirm(Localizer.Messages.beforeunloadconfirmationmessage,n.ConfirmationReason.Warning,function(){h.processStateChange(r,u,s)},function(){h.isLoadingPage=!1}):this.processStateChange(r,u,s)}catch(a){n.log(a)}},u.prototype.processStateChange=function(n,t,i){n?history.replaceState({url:i},null,i):history.pushState({url:i},null,i);t&&$(window).trigger("statechange.pagecontrol")},u.prototype.redirect=function(t){if(Modernizr.localstorage&&window.history&&document.all){var i=n.Utilities.LocalStorage.getItem("history").toLowerCase()===t.toLowerCase();i?history.go(-1):window.location.href=t}else this.stateChange(t,!0)},u.prototype.replaceQuery=function(t){var i=typeof t=="string"?t:n.Utilities.Url.createQueryFromObject(t),r=location.pathname+i;this.redirect(r)},u.prototype.normalizeAjaxSectionRegex=function(){if(!this.ajaxSectionRegex){this.ajaxSectionRegex=new RegExp("NO AJAX SECTION REGEX DEFINED");return}var n=this.ajaxSectionRegex.source,t=n.replace("{locale}",Localizer.CurrentCultureName);this.ajaxSectionRegex=new RegExp(t)},u.prototype.handleLinkClicks=function(t){var r,u,f;return Modernizr.history?(r=t.currentTarget,u=n.Utilities.Url.urlToAnchorElement(r.href),this.isLoadingPage)?!0:(f=i.doesLinkQualifyForAjax(u,t,this.ajaxSectionRegex),!f)?!0:(t.which!==2&&(t.preventDefault(),r.search.indexOf("?c=")!==-1||r.search.indexOf("&c=")!==-1?window.location.reload():this.stateChangeAnchor(u,!1)),!1):!0},u.prototype.urlParserThrottle=function(t){var i=this;if(this.parseUrlTimer!==null){n.log("Attempted to run URL parse while one was already running");return}this.parseUrlTimer=setTimeout(function(){i.parseUrlTimer=null},100);viewModels.currentUrl(window.location);this.parseUrlAndLoad(t)},u.prototype.parseUrlAndLoad=function(t){var f=this.url,i,r,u;this.url=window.location.pathname+window.location.search;i=n.Utilities.Url.urlToAnchorElement(f);r=n.Utilities.Url.urlToAnchorElement(this.url);this.isSamePathname=i.pathname.toLowerCase()===r.pathname.toLowerCase();u=this.lastParsedUrl===window.location.pathname+window.location.search+window.location.hash;u?this.isLoadingPage=!1:window.location.search.match("_modal")||this.preventAjaxMode?this.isLoadingPage=!1:this.loadUrl(t);this.urlParsedCallback()},u.prototype.reloadPage=function(){this.isSamePathname=!1;this.url=this.lastParsedUrl;this.loadUrl()},u.prototype.loadUrl=function(n){var t=this,i,r;(!this.isSamePathname||this.allowSamePathname)&&(this.lastParsedUrl=window.location.pathname+window.location.search,setTimeout(function(){$("body").addClass("preload")},300),this.startLoading(),this.disableUiDuringLoad&&$("html").addClass("uiDisabled"),i=window.location.search.length?"&":"?",r=this.url+i+this.appendCacheQuerystring,this.onOldPageDestroyed(),$.ajax({url:r,cache:this.useCache,type:"GET",data:null,dataType:"html",success:function(i,r,u){t.processUrl(u);t.replaceContent(i);t.setViewModels();t.onNewPageCreated(n)},error:function(){history.replaceState({},null,"#");location.replace("")},statusCode:{302:function(){alert("302")}}}))},u.prototype.processUrl=function(t){var r=t.getResponseHeader("X-SelfUrl"),s=t.getResponseHeader("X-Error-Code"),i;if(s&&r){window.location.href=r;return}n.Analytics.trackPageview(r);var h=new RegExp("(\\?|\\&)"+this.appendCacheQuerystring,"gi"),c=this.url.replace(h,""),u=n.Utilities.Url.urlToAnchorElement(r),f=n.Utilities.Url.getObjectFromQueryString(u.search);delete f.ajax;var l=n.Utilities.Url.createQueryFromObject(f),a=u.pathname+l,e=n.Utilities.Url.urlToAnchorElement(c),o=n.Utilities.Url.urlToAnchorElement(a);if(r.match(this.forceRedirectUrlRegex)){n.warn("Forced Redirect...");window.location.href=r;return}o.href!==e.href&&(i=o.href+e.hash,i.substr(0,4)!=="http"&&(i+=i.substr(0,1)==="/"?"":"/"),this.ajaxSectionRegex&&!i.match(this.ajaxSectionRegex)&&(window.location.href=i),history.replaceState({},"",i),this.url=i,this.lastParsedUrl=i);successRedirect=encodeURIComponent(this.lastParsedUrl)},u.prototype.replaceContent=function(i){var r=$("<output/>").append($(i)),f=i.match(/<body.*class=['"]([^"']+)['"].*>/),e,u,o;f&&(e=f[1],$("body").attr("class",e+" loadedViaAjax"));u=i.match(/<title>(.*)<\/title>/);u&&(o=$("<div/>").html(u[1]).text(),$("title").text(o));this.replaceElementContent("#ServerVarsPageData",r);this.loadContent&&this.replaceElementContent("#content",r);this.loadOutsideContent&&this.replaceElementContent("#outsideContent",r);this.loadSubNav&&this.replaceElementContent(".Sub_Nav",r);this.loadMainNavItems&&this.replaceElementContent("#nav-items",r);!n.Utilities.User.isAuthenticated&&this.loadNavTop&&this.replaceElementContent(".Nav_Top",r,!0,function(){t.Navigation.NavBar.Instance.initialize()});this.loadSidebar&&this.replaceElementContent("#sidebar",r,!1,function(n){$("body").toggleClass("NoSidebar",!n)});$("#content").removeClass("hide").css("visibility","visible").siblings(".page").addClass("hide")},u.prototype.replaceElementContent=function(n,t,i,r){var e;i===void 0&&(i=!0);r===void 0&&(r=function(){});var f=$(n),u=t.find(n).html(),o=t.find(n).attr("class");i?f.html(u?u:""):f.html(u);f.attr("class",o);e=u?!0:!1;r(e)},u.prototype.setViewModels=function(){var i=[$("#content"),$(".Sub_Nav")],r,u,n,t;for(this.loadSidebar&&i.push($("#sidebar")),r=ko.utils.domNodeDisposal.cleanExternalData,ko.utils.domNodeDisposal.cleanExternalData=function(){},u=i.length,n=0;n<u;n++)t=i[n],typeof t[0]!="undefined"&&(ko.cleanNode(t[0]),ko.applyBindings(viewModels,t[0]));ko.utils.domNodeDisposal.cleanExternalData=r},u.prototype.onNewPageCreated=function(n){t.loadedViaAjax=!0;this.unbindAll();$(document).trigger("newPageCreated");$(window).trigger("load");setTimeout(function(){$("body").removeClass("preload")},200);this.scrollToTopOnAjaxLoad&&(n&&n.type==="popstate"||$(window).scrollTop(0));this.stopLoading();this.initialize();t.Navigation.NavBar.Instance.initialize()},u.prototype.startLoading=function(){t.LoaderBar.start()},u.prototype.stopLoading=function(){t.LoaderBar.stop()},u.prototype.onOldPageDestroyed=function(){$(document).trigger("oldPageDestroyed");this.isLoadingPage=!1;this.disableUiDuringLoad&&$("html").removeClass("uiDisabled")},u.prototype.handleRedirects=function(){if(Modernizr.hashchange&&window.location.search.indexOf("nhc")===-1)if(window.location.hash.indexOf("?lc=")>-1){if(window.location.hash.indexOf("?lc=")>-1){var t=window.location.href.replace("?lc=","&lc=");u.Instance.redirect(t)}}else{$(window).on("beforeunload",function(){try{n.Utilities.LocalStorage.setItem("history",window.location.href)}catch(e){}});$(window).on("hashchange newPageCreated",function(){$("html").removeClass("uiDisabled");$("#btn_signOut").attr("href","/"+Localizer.CurrentCultureName+"/User/SignOut?bru="+encodeURIComponent(window.location.pathname+window.location.search+window.location.hash))})}},u.prototype.loadCustomSection=function(t,i,u,f,e,o,s){f===void 0&&(f=!0);e===void 0&&(e=null);switch(i){case r.PushState:history.pushState({},null,t);break;case r.ReplaceState:history.replaceState({},null,t)}var h=e!=null?e:t;n.Utilities.Ajax.loadUrlGetElement({url:h,elementSelectors:u,changeTitle:!1},function(n){var i=n,s,t,r;if(f)for(i=$(),s=typeof u=="string"?u.split(","):u,t=0,r=s;t<r.length;t++){var e=r[t],h=$(document).find(e),c=n.find(e);h.html(c.html());$.extend(i,$(document).find(e))}o(i)},s)},u.Instance=new u(window.ajaxSectionRegex),u}(),r,i;t.PageController=u,function(n){n[n.None=0]="None";n[n.PushState=1]="PushState";n[n.ReplaceState=2]="ReplaceState"}(r=t.UrlChangeType||(t.UrlChangeType={})),function(n){function i(n,t){if(n.href===window.location.href)return t.preventDefault(),!0}function r(n){return n.pathname===window.location.pathname&&(n.href.match("#")&&n.hash===window.location.hash||n.href.match("\\?")&&n.search===window.location.search)?!0:!1}function u(n){var t=n.host.match(":")?n.host.split(":")[0]:n.host,i=window.location.host.match(":")?window.location.host.split(":")[0]:window.location.host;return t!==i?!0:!1}function f(n){return n.pathname===window.location.pathname&&typeof n.hash!="undefined"&&n.hash!==""?!0:!1}function e(n,t){return typeof t=="undefined"||!n.href.match(t)?!1:!0}function o(n,o,s){return Modernizr.ie?!1:e(n,s)?o&&i(n,o)&&!t.PageController.Instance.allowSamePathname?!1:r(n)&&!t.PageController.Instance.allowSamePathname?!1:u(n)?!1:f(n)?!1:!0:!1}n.doesLinkQualifyForAjax=o}(i||(i={}))})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){this.transferComplete=!1;this.transferInProgress=!1}return t.prototype.initialize=function(){var n=this;$("#alert-pcmigration").length>0&&this.getLocalStorageAlertVisibility().then(function(){n.showAlert()&&n.renderAlert()})},t.prototype.addListeners=function(){var t=this;$(document).on("click",".globalAlertsBar.pcmigration",function(){n.Site.PageController.Instance.redirect("/7/"+Localizer.CurrentCultureName+"/PCMove")});$(document).on("click",".globalAlertsBar.pcmigration .js-remove",function(n){n.stopImmediatePropagation();t.removeAlert()})},t.prototype.removeAlert=function(){$(".js-pcmigration-global-alert").remove();$("body.HasPCMigrationAlert").removeClass("HasPCMigrationAlert");this.updateLocalStorageAlertVisibility(!1)},t.prototype.renderAlert=function(){var t=$("#alert-pcmigration"),n;t.length===0||$("body").hasClass("HasPCMigrationAlert")||(n=$($("#alert-pcmigration").html()),n.find("span").text(this.populateMessage()),this.addClasses(n),this.appendToDom(n),this.addListeners())},t.prototype.populateMessage=function(){var n=Localizer.Pcmigration,t="";return n&&(t=n.OnDecember12020Battle),t},t.prototype.showAlert=function(){return this.localStorageAllows},t.prototype.addClasses=function(n){n.addClass("sunsetting")},t.prototype.appendToDom=function(n){var i=$(".globalAlertsBar"),t,r;i.length?$(".globalBar").length===0&&($(n).insertBefore(i),$("body").addClass("HasTwoGlobalAlerts HasPCMigrationAlert")):($("body").addClass("HasPCMigrationAlert"),t=$("#explore-container"),r=$("#mainContent"),t.length?t.before(n):r.prepend(n))},t.prototype.getLocalStorageAlertVisibility=function(){return(typeof n.Utilities.LocalStorage.getItem("show-pc-migration-sunset-alert")=="undefined"||n.Utilities.LocalStorage.getItem("show-pc-migration-sunset-alert")===null)&&n.Utilities.LocalStorage.setItem("show-pc-migration-sunset-alert","true"),this.localStorageAllows=n.Utilities.LocalStorage.getItem("show-pc-migration-sunset-alert")==="false"?!1:!0,Promise.resolve()},t.prototype.updateLocalStorageAlertVisibility=function(t){this.localStorageAllows=t;n.Utilities.LocalStorage.setItem("show-pc-migration-sunset-alert",t.toString())},t.Instance=new t,t}();t.PCMigrationGlobalAlert=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var i=function(){function t(){}return t.prototype.openModal=function(){return this.getLocalStorage(),this.showToUser?(this.modal=new n.Modal(this.modalId,$("#"+this.modalId).html()),this.addListeners(),this.modal.open(),!0):!1},t.prototype.addListeners=function(){},t.prototype.updateLocalStorage=function(t){n.Utilities.LocalStorage.setItem(this.localStorageKey,t?"true":"false")},t.prototype.getLocalStorage=function(){this.showToUser=!1||n.Utilities.LocalStorage.getItem(this.localStorageKey)!=="false"},t}(),r=function(t){function i(){var r=t.call(this)||this,i=n.Site.getPageData("PCMigration");return i!==null&&typeof i!="undefined"&&typeof i.PCMigrationBlizzardLocalStorageKey!="undefined"&&i.PCMigrationBlizzardLocalStorageKey!==""&&(r.localStorageKey=i.PCMigrationBlizzardLocalStorageKey),r.modalId="blizzardRedirectModal",r}return __extends(i,t),i.prototype.addListeners=function(){var t=this,i=new n.EventBinder(this.modalId);i.forDocument(".js-pc-migration-dismiss").on("click",function(){t.hideBlizzardModal();n.SignInTriggers.showAuthWindow(Globals.BungieCredentialType.BattleNetId)});i.forDocument(".js-pc-migration-learn-more").on("click",function(){t.hideBlizzardModal()})},i.prototype.hideBlizzardModal=function(){this.updateLocalStorage(!1);this.modal.close()},i}(i),u,f;t.BlizzardModal=r;u=function(t){function i(){var r=t.call(this)||this,i=n.Site.getPageData("PCMigration");return i!==null&&typeof i!="undefined"&&typeof i.PCMigrationSteamLocalStorageKey!="undefined"&&i.PCMigrationSteamLocalStorageKey!==""&&(r.localStorageKey=i.PCMigrationSteamLocalStorageKey),r.modalId="steamRedirectModal",r}return __extends(i,t),i.prototype.addListeners=function(){var t=new n.EventBinder(this.modalId)},i}(i);t.SteamModal=u;f=function(t){function i(){var n=t.call(this)||this;return n.modalId="blizzardRedirectModal",n}return __extends(i,t),i.prototype.initialize=function(){var t=this;if(n.Utilities.User.isAuthenticated)return Promise.all([this.getUserCredentials(),this.getLocalStorage(),]).then(function(){t.showToUser&&t.userHasBlizzard&&!t.userIsLinked&&(t.modal=new n.Modal(t.modalId,$("#"+t.modalId).html()),t.addListeners(),t.modal.open(),t.updateLocalStorage(!1))})},i.prototype.getUserCredentials=function(){var n=this;return bungieNetPlatform.userService.GetCredentialTypesForAccountPromise().then(function(t){typeof t.find(function(n){return n.credentialType===Globals.BungieCredentialType.BattleNetId})!="undefined"&&(n.userHasBlizzard=!0);typeof t.find(function(n){return n.credentialType===Globals.BungieCredentialType.SteamId})!="undefined"&&(n.userHasSteam=!0);n.userHasBlizzard&&n.userHasSteam&&(n.userIsLinked=!0)})},i}(r);t.BlizzardModalOpener=f})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){this.eventName="recruitThreadUpdated"}return t.prototype.initialize=function(){this.addEventMuxSubscription();this.addEventListeners()},t.prototype.addEventMuxSubscription=function(){var t=this;n.EventMux.subscribe({eventType:Globals.RealTimeEventType.RecruitThreadUpdate,onUpdate:function(n){var i={recruitThreadUpdate:{conversationId:n.conversationId,topicId:n.topicId,isRemoved:n.isRemoved,membershipId:n.targetMembershipId}};$(document).trigger(t.eventName,i)}})},t.prototype.addEventListeners=function(){$(document).on(this.eventName,function(t,i){var r=i.recruitThreadUpdate,u;typeof r.conversationId!="undefined"&&r.conversationId!==null&&r.conversationId!=="0"&&(u=new n.ToastMessages.Client,u.show(n.ToastMessages.ToastMessageType.Info,Localizer.Format(Localizer.Messages.yourfireteamisreadyadata,{conversationId:r.conversationId})))})},t}();t.RecruitThreadUpdate=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},function(n){var t;(function(t){function u(){h();moment.locale(Localizer.CurrentCultureName);e();t.PageController.Instance.initialize();c();ServerVars.MobileWebView||ServerVars.MinimalLayout||(n.EventMux.initialize(),n.NotificationCount.Manager.Instance.initialize(),t.MessageUpdate.Instance.initialize(),t.recruitThreadUpdate=new t.RecruitThreadUpdate,t.recruitThreadUpdate.initialize(),t.fireteamUpdate=new t.FireteamUpdate,t.fireteamUpdate.initialize(),t.streamingAlerts=new t.StreamingAlerts,t.streamingAlerts.initialize(),t.MyClan.Instance.initialize(),t.LocaleSelector.instance.initialize(),t.Navigation.NavBar.Instance.initialize(),n.NotificationCount.Manager.Instance.start(),n.SignInTriggers.Instance.bind(),t.CookieConsent.Instance.initialize());t.Forms.Instance.initialize();r()}function f(n){t.currentArea=n}function e(){$(window).on("load",function(){return o()})}function o(){$("body").addClass("loaded");Modernizr.generatedcontent||$(".bg_top").append("<span>You are using an unsupported browser, your experience may be less than optimal<\/span>")}function i(){n.UiKit.Base.Instance.initialize();t.PCMigrationGlobalAlert.Instance.initialize();t.EmailValidationBar.Instance.initialize();t.PageDataMembershipProvider.Instance.refresh();t.PageDataBuyButtonProvider.Instance.refresh();t.routeValues=t.getPageData("RouteValues");t.currentArea&&t.currentArea.initialize()}function s(){t.currentArea&&t.currentArea.destroy();n.UiKit.Base.Instance.destroy()}function h(){var f=Modernizr.ie&&!Modernizr.edge,t,i,r,u;f&&Modernizr.localstorage&&(t="seen-browser-support-modal",i=n.Utilities.LocalStorage.getItem(t)==="1",i||(n.Utilities.LocalStorage.setItem(t,"1"),r="\n\t\t\t\t\t"+Localizer.Messages.browsernotsupported+" <a href='"+ServerVars.BrowserSupportHelpArticleLink+"'>"+Localizer.Messages.browsersupportfindoutmore+"<\/a>\n\t\t\t\t",u=new n.Modal("browser-support",r),u.open()))}function c(){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(u){switch(u.label){case 0:if(!n.Utilities.User.isAuthenticated)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,t.GlobalData.getCurrentUser()];case 2:return i=u.sent(),viewModels.loggedInUserModel(ko.mapping.fromJS(i)),viewModels.loggedInUserModelIsLoaded(!0),viewModels.loggedInUserModel().adultMode()&&($(".post_urlLinkOrImage").addClass("deferred"),$(".btn_hideImage").addClass("hide"),$(".ageGatePrompt").addClass("hide"),$(".ageGateContents").removeClass("hide")),[3,4];case 3:return r=u.sent(),n.error(r),[3,4];case 4:return[2]}})})}function l(n,t){return n in ServerVars.PageData?ServerVars.PageData[n]:t}function a(t){return t in ServerVars.PageData?ServerVars.PageData[t]:(n.warn(t+" is not available in PageData"),null)}function r(){$.easing.BnetEasing=function(n){return n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1};n.Utilities.Html.placeholderLocFix()}t.setCurrentArea=f;t.getPageDataOrDefault=l;t.getPageData=a;t.customFixes=r;var v=function(){function n(){}return n.IsWebViewMode=$("html").hasClass("WebViewMode"),n.IsDebug=ServerVars.Environment!=="live"&&ServerVars.Environment!=="beta",n}();t.Flags=v;$(document).ready(function(){typeof viewModels!="undefined"&&ko.applyBindings(viewModels);u();i();$("html").addClass("documentReady")});$(document).on("newPageCreated",function(){i()});$(document).on("oldPageDestroyed",function(){s()})})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var u=function(){function u(){this.isHomepage=$("body").hasClass("Homepage");this.isPubPage=location.href.indexOf(Localizer.CurrentCultureName+"/pub/")!==-1;this.modalSeenStorageKey="StreamingAlerts.HomepageModalSeenTime";this.dontShowModalTimeLimit=864e5;this.modalAutoOpenDelay=1.5*1e3}return Object.defineProperty(u.prototype,"isMobile",{get:function(){return Modernizr.mobile||n.Reactive.mobile.test()},enumerable:!0,configurable:!0}),u.prototype.initialize=function(){t.Flags.IsWebViewMode||this.isPubPage||(this.addListeners(),this.getStreamingAlerts())},u.prototype.addListeners=function(){var n=this;$(document).on("click","#streaming-alerts",function(){i.trackUsabilityEvent("StreamingAlertOpened","Opened Via Click");n.isMobile?window.location.href=n.getChannelLink(!1):n.openTwitchModal({muted:!1,openedAutomatically:!1})})},u.prototype.getChannelLink=function(n){if(!this.streamingAlert)return"";var t=n?"&muted":"&!muted";return location.protocol+"//player.twitch.tv/?channel="+this.streamingAlert.StreamInfo.ChannelName+t+"&volume=0.33"},u.prototype.getStreamingAlerts=function(){var n=this;bungieNetPlatform.coreService.GetGlobalAlerts(!0,function(t){n.processAlerts(t)},function(){})},u.prototype.processAlerts=function(n){for(var i,t=0;t<n.length;t++)if(i=n[t],i.AlertType===Globals.GlobalAlertType.StreamingAlert){this.streamingAlert=i;this.onStreamingAlertExists();continue}},u.prototype.onStreamingAlertExists=function(){var t=this,n=this.checkOrSetHasSeenModal(),i=!this.isHomepage||!n;r.show(i);n&&this.isHomepage&&!this.isMobile&&setTimeout(function(){t.openTwitchModal({muted:!0,openedAutomatically:!0})},this.modalAutoOpenDelay)},u.prototype.openTwitchModal=function(n){this.streamingAlertModal=new f(this);this.streamingAlertModal.open(n)},u.prototype.checkOrSetHasSeenModal=function(){var t=!0,i=n.Utilities.LocalStorage.getItem(this.modalSeenStorageKey),r;return i&&(r=parseInt(i,10),u.timeLimitExceeded(this.dontShowModalTimeLimit,r)||(t=!1)),t&&n.Utilities.LocalStorage.setItem(this.modalSeenStorageKey,performance.now().toString()),t},u.timeLimitExceeded=function(n,t){var i=performance.now(),r=i-t;return r>n},u}(),f,r,i;t.StreamingAlerts=u;f=function(n){function t(t){var i=n.call(this,"streaming-alert",null)||this;return i.streamingAlerts=t,i.maximumModalTrackingTimeout=3e5,i}return __extends(t,n),t.prototype.addListeners=function(){var t=this;n.prototype.addListeners.call(this);$(document).one("oldPageDestroyed",function(){clearTimeout(t.maximumModalTrackingTimer)});$(window).one("beforeUnload",function(){clearTimeout(t.maximumModalTrackingTimer)})},t.prototype.trackAutoModalTimer=function(n){var r=performance.now(),t=n.openedAutomatically?"auto-open":"manual-open";this.afterCloseCallback=function(){var n=(performance.now()-r)/1e3,u;u=n<5?"< 5 seconds":n>=5&&n<20?"5 - 20 seconds":n>=20&&n<60?"20 - 60 seconds":n>60&&n<300?"60 - 300 seconds":"> 300 seconds";i.trackUsabilityEvent("StreamingModalClosed","Modal ("+t+") open time: "+u)};this.maximumModalTrackingTimer=setTimeout(function(){i.trackUsabilityEvent("StreamingModalClosed","Modal ("+t+") open time: > 300 seconds")},this.maximumModalTrackingTimeout)},t.prototype.open=function(t){if(t){var r='\n\t\t\t\t<iframe src="'+this.streamingAlerts.getChannelLink(t.muted)+'" frameborder="0" scrolling="no" height="100%" width="100%" allowfullscreen><\/iframe>\n\t\t\t';this.populateContent(r);this.trackAutoModalTimer(t);i.trackUsabilityEvent("StreamingAlertOpened",t.openedAutomatically?"Opened automatically":"Opened manually");n.prototype.open.call(this)}},t}(n.Modal),function(t){function o(n){n===void 0&&(n=!0);var t=s(),u=h(n),i=u?"streaming-alerts-transition":"";$("html").addClass("streaming-alerts-active "+i);t.addClass(i);setTimeout(function(){t.addClass("on")},r);setTimeout(function(){t.addClass("done")},f)}function s(){var t=$("#streaming-alerts-template").html(),n=$(t);return $("header").append(n),n}function h(n){var t=!0;return n&&(t=c(),t||(r=f=0)),t&&n}function c(){var t=!0,r=n.Utilities.SessionStorage.getItem(i),f;return r&&(f=parseInt(r,10),u.timeLimitExceeded(e,f)||(t=!1)),t&&n.Utilities.SessionStorage.setItem(i,performance.now().toString()),t}var i="StreamingAlerts.LastAnimatedTime",e=18e5,r=500,f=2500;t.show=o}(r||(r={}));i=function(){function t(){}return t.trackUsabilityEvent=function(t,i,r){r=r||null;n.Analytics.trackEvent("Usability",t+"_StreamingAlerts",i,r)},t}()})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(n){var r=function(){function n(n){this.subscriptionConstructor=n;this._subscriptions=[]}return Object.defineProperty(n.prototype,"subscriptions",{get:function(){return this._subscriptions},enumerable:!0,configurable:!0}),n.prototype.subscribe=function(n){var t=new this.subscriptionConstructor(this,n);return this._subscriptions.push(t),t},n.prototype.unsubscribe=function(n){var t=this._subscriptions.indexOf(n);t>-1&&this._subscriptions.splice(t,1)},n.prototype.broadcast=function(){for(var t,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t=this.getPayloadsToUpdate();this.updateSubscriptions(t)},n.prototype.updateSubscriptions=function(n){var t,i,r;if(n&&n.length>0)for(t=0,i=n;t<i.length;t++){r=i[t];r.getSubscription().params.onUpdate(r)}},n}(),t,i;n.Subscribable=r;t=function(){function n(n,t){this.subscribable=n;this.params=t}return n.prototype.unsubscribe=function(){this.subscribable.unsubscribe(this)},n}();n.Subscription=t;i=function(){function n(n){this.subscription=n}return n.prototype.getSubscription=function(){return this.subscription},n}();n.SubscriptionPayload=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function i(t){this.areaName=t;this.eventBinder=new n.EventBinder(t)}return Object.defineProperty(i.prototype,"currentPage",{get:function(){return this.pageInitialization.currentPage},enumerable:!0,configurable:!0}),i.prototype.initialize=function(){this.removeBindings();this.pageInitialization=new t.PageInitialization;this.addPages(this.pageInitialization);this.pageInitialization.initializePages();$("html").addClass("area-initialized")},i.prototype.removeBindings=function(){var n="."+this.areaName;$(window).unbind(n);$(document).unbind(n);$("*").unbind(n)},i.prototype.destroy=function(){this.pageInitialization.destroyPages();this.eventBinder.destroy()},i}();t.Area=i})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var i=function(){function n(t){this.eventNamespace=t;this.allBindings=[];this.countId=n.BinderCount++}return n.prototype.for=function(n,i){var r=typeof n=="string"?$(n):n;return new t(this,r,this.eventNamespace,i)},n.prototype.forDocument=function(n){return this.for($(document),n)},n.prototype.destroy=function(){this._destroy()},n.prototype._destroy=function(){this.allBindings.forEach(function(n){n.delegatedElementSelector?n.element.off(n.namespacedEvent,n.delegatedElementSelector):n.element.off(n.namespacedEvent)});this.allBindings=[]},n.BinderCount=0,n}(),t;n.EventBinder=i;t=function(){function t(n,t,i,r){this.binder=n;this.element=t;this.eventNamespace=i;this.delegatedElementSelector=r}return t.prototype.on=function(n,t){for(var u,r=n.split(" "),i=0,f=r.length;i<f;i++)u=r[i],u!==""&&this._on(r[i],t);return this},t.prototype.off=function(n){var i,t,r,u;for(n===void 0&&(n=""),i=n.split(" "),t=0,r=i.length;t<r;t++)u=i[t],u!==""&&this._off(i[t]);return this},t.prototype._on=function(t,i){var u=this._getNamespacedEventName(t),e={element:this.element,delegatedElementSelector:this.delegatedElementSelector,event:this._getNamespacedEventName(t),namespacedEvent:u,callback:i},f,r;if(n.Site.Flags.IsDebug&&(f=this._checkDuplicate(e),f)){n.error("Duplicate binding detected - rejecting binding for "+this.element.selector+" -> "+t+".",f);return}if(this.binder.allBindings.push(e),this.delegatedElementSelector)this.element.on(u,this.delegatedElementSelector,function(n){t!=="scroll"?i(n):window.requestAnimationFrame(function(){return i(n)})});else{r=!1;this.element.on(u,function(n){t!=="scroll"?i(n):(r||window.requestAnimationFrame(function(){i(n);r=!1}),r=!0)})}},t.prototype._off=function(n){var r=this._getNamespacedEventName(n),t,i;for(this.delegatedElementSelector?this.element.off(r,this.delegatedElementSelector):this.element.off(r),t=this.binder.allBindings.length-1;t>=0;t--)i=this.binder.allBindings[t],i.element[0]===this.element[0]&&i.event.match(r)&&i.delegatedElementSelector===this.delegatedElementSelector&&this.binder.allBindings.splice(t,1)},t.prototype._checkDuplicate=function(n){for(var t,i=0,r=this.binder.allBindings.length;i<r;i++)if(t=this.binder.allBindings[i],n.callback.toString()===t.callback.toString()&&n.element[0]===t.element[0]&&n.event===t.event&&n.delegatedElementSelector===t.delegatedElementSelector)return t;return null},t.prototype._getNamespacedEventName=function(n){return n+"."+this.eventNamespace+".eventBinder"+this.binder.countId},t}()}(Bnet||(Bnet={})),function(n){var t;(function(t){var r=function(){function r(){this.registeredControls=[]}return r.prototype.add=function(n,t){var r=new i(n,t);this.registeredControls.push(r)},r.prototype.initializePages=function(){var i=this;this.createPagesForBody(function(n){n.initialize();n.addListeners();i.currentPage=n});t.currentArea&&!this.currentPage&&n.warn("Area registered but no pages initialized. No pages matched the body selectors specified.")},r.prototype.destroyPages=function(){this.foreachInitializedPage(function(n){n.destroy()})},r.prototype.createPagesForBody=function(n){for(var i,u,t=0,r=this.registeredControls.length;t<r;t++)i=this.registeredControls[t],$("body").is(i.requiredSelector)&&(u=i.initialize(),n(u))},r.prototype.foreachInitializedPage=function(n){for(var i,t=0,r=this.registeredControls.length;t<r;t++)i=this.registeredControls[t],i.initializedPage&&n(i.initializedPage)},r}(),i;t.PageInitialization=r;i=function(){function n(n,t){this.requiredSelector=n;this.pageInitializerClosure=t;this.initialized=null}return n.prototype.initialize=function(){return this.initialized=this.pageInitializerClosure(),this.initialized},Object.defineProperty(n.prototype,"initializedPage",{get:function(){return this.initialized},enumerable:!0,configurable:!0}),n}()})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(n){var t=function(){function t(){}return Object.defineProperty(t.prototype,"eventBinder",{get:function(){return n.currentArea.eventBinder},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){},t}();n.PageInitializer=t})(t=n.Site||(n.Site={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(){this.newMessageBannerVisible=ko.observable(!1);this.gatedMedia=ko.observableArray();this.adultMode=ko.observable(!1);this.loggedInMembershipId=ko.observable("0");this.whoIsTyping=ko.observable("")}return t.prototype.reset=function(){this.newMessageBannerVisible(!1);this.gatedMedia([]);this.whoIsTyping("")},t.prototype.isHidden=function(t){var i=n.Utilities.Enumerable.firstIndexOf(this.gatedMedia(),function(n){return n===t});return i!==-1},t.prototype.hide=function(n){this.isHidden(n)||this.gatedMedia.push(n)},t.prototype.show=function(t){var i=n.Utilities.Enumerable.firstIndexOf(this.gatedMedia(),function(n){return n===t});i>=0&&this.gatedMedia.splice(i,1)},t.prototype.parseSubjectJSON=function(n){var t={};try{t=JSON.parse(n)}catch(i){}return t},t.prototype.isMe=function(t){return t.memberFromId===n.Utilities.User.loggedInUserBnetMembershipId},t.prototype.isConsecutive=function(n,t){var r=t(),u=r.indexOf(n);if(u>0){var i=r[u-1],s=i.memberFromId===n.memberFromId,f=moment(n.dateSent),e=moment(i.dateSent),o=f.add(-5,"m").isBefore(e);if(i.memberFromId===n.memberFromId&&o)return!0}return!1},t.prototype.isLastConsecutive=function(n,t){var f=this.isConsecutive(n,t),i,r,u;if(!f)return!0;if(i=t(),r=i.indexOf(n),i.length>r+1){if(u=i[r+1],u.memberFromId!==n.memberFromId)return!0}else return!0;return!1},t.prototype.getMemberLinkFromSubject=function(t){if(t===void 0&&(t=""),t!=="")try{var i=JSON.parse(t),r=i[0].membershipId,u=i[0].membershipType,f=i[0].displayName;return"/"+Localizer.CurrentCultureName+"/Profile/"+u+"/"+r+"/"+f}catch(e){return n.error("There was an error parsing JSON subject in a message, the offending string is: "+t),t}else return t},t.prototype.getClanLink=function(n){return"/"+Localizer.CurrentCultureName+"/ClanV2/MyFireteams?groupId="+n},t.prototype.formatBody=function(t,i,r,u){return u===void 0&&(u=""),t=n.Utilities.Parse.messageLinks(t,i,this.loggedInMembershipId(),this.adultMode(),r,this.isHidden(i)),t=n.Utilities.Parse.parseBBCode(t,!0,!0),t=bungieNetPlatform.linkHelper.injectLinks(t),this.replaceEmptyUser(t,u)},t.prototype.getDisplayName=function(n){var t=n.displayName;return n.cachedBungieGlobalDisplayNameCode&&(t=t+"#"+n.cachedBungieGlobalDisplayNameCode),t},t.prototype.replaceEmptyUser=function(n,t){var u=n,e=t?this.parseSubjectJSON(t):null,i;if(e&&n.indexOf("[user]")>-1&&(i=e[0],i)){var o=Localizer.Platforms[i.membershipType.ToString()],f=i.displayName?i.displayName:"",s=f&&o?f+" ["+o+"]":"",r=i.bungieGlobalDisplayName,h=f&&r?" (Bnet: "+i.bungieGlobalDisplayName+")":r?r:"";(s||r)&&(u=u.replace("[user]",s+r))}return u},t}(),r;t.UIViewModel=i;r=function(){function t(t,r){var u=this;this.client=t;this.selectors=r;this.autoScrolling=!1;this.stickToBottom=!0;this.canSubmitMessage=!0;this.$textInput=null;this.eventBinder=new n.EventBinder("chatUI");this.viewModel=new i;t.onSubmitStarted=function(){return u.submitStartedEvent()};t.onSubmitStopped=function(n,t){return u.submitStoppedEvent(n,t)};t.onWhoIsTypingChanged=function(n){return u.whoIsTypingChanged(n)};t.onLoadingStarted=function(){return u.handleLoadingState(!0)};t.onLoadingComplete=function(){return u.handleLoadingState(!1)}}return t.prototype.getViewModel=function(){return this.viewModel},t.prototype.reset=function(){this.autoScrolling=!1;this.stickToBottom=!0;this.viewModel.reset()},t.prototype.destroy=function(){this.eventBinder.destroy()},t.prototype.addListeners=function(){var n=this,t;this.setupScrolling();t=$(this.selectors.stableParentElement);this.eventBinder.for($(this.selectors.newMessageBanner)).on("click",function(){return n.scrollToBottom()});if(!Modernizr.mobile)this.eventBinder.for(t,this.selectors.chatMessageEditArea).on("keydown",function(t){if(t.which!==13||t.shiftKey)n.client.sendTyping();else if(t.preventDefault(),n.canSubmitMessage){var i=$(t.currentTarget);i.parent().find(".error").remove();n.validateAndSubmitMessage(i,i.val())}});this.eventBinder.for(t,this.selectors.submitButton).on("click",function(i){i.preventDefault();var r=t.find(n.selectors.chatMessageEditArea);n.validateAndSubmitMessage(r,r.val())});this.eventBinder.for(t,this.selectors.showGatedButton).on("click",function(t){var i=$(t.currentTarget),r=i.closest("[data-messageId]").attr("data-messageId");n.viewModel.hide(r)});this.eventBinder.for(t,this.selectors.hideGatedButton).on("click",function(t){t.preventDefault();t.stopImmediatePropagation();var i=$(t.currentTarget),r=i.attr("data-messageId");n.viewModel.show(r)});this.eventBinder.for(t,this.selectors.lightboxedImageTrigger).on("click",function(n){var t=n.currentTarget;n.preventDefault();n.stopImmediatePropagation();Utility.showMediaLightBox('<img class="img_lightbox" src="'+t.src+'" alt="" /><br /><a class="extraContent" href="'+t.src+'">'+t.src+"<\/a>")})},t.prototype.adjustScrollPositionAfterLoadingNewBatch=function(){this.client.olderMessagesAdded>0?this.scrollToSamePosition():(this.viewModel.newMessageBannerVisible(!this.stickToBottom),this.stickToBottom&&(Modernizr.touch&&$(this.selectors.chatContainer).css("overflow","auto"),this.scrollToBottom()))},t.prototype.handleLoadingState=function(n){n?$(this.selectors.chatContainer).destinyLoader({delayBeforeAppear:100}):($(this.selectors.chatContainer).destinyLoader("stop"),this.adjustScrollPositionAfterLoadingNewBatch())},t.prototype.handleScrolling=function(){var n=$(this.selectors.chatContainer);n.scrollTop()+n.innerHeight()+5>n[0].scrollHeight?(this.stickToBottom=!0,this.viewModel.newMessageBannerVisible(!1)):this.autoScrolling||(this.stickToBottom=!1);this.autoScrolling||n.scrollTop()!==0||this.client.loadMessages(!0,!1);this.autoScrolling=!1},t.prototype.submitStartedEvent=function(){if(this.clearInputArea(this.$textInput),this.canSubmitMessage=!1,this.selectors.chatMessageEditAreaContainer!==undefined&&this.selectors.chatMessageEditAreaContainer!==null){var n=$(this.selectors.chatMessageEditAreaContainer);n.destinyLoader({delayBeforeAppear:300,size:30,startOnInit:!0})}},t.prototype.submitStoppedEvent=function(t,i){if(this.canSubmitMessage=!0,this.selectors.chatMessageEditAreaContainer!==undefined&&this.selectors.chatMessageEditAreaContainer!==null){var r=$(this.selectors.chatMessageEditAreaContainer);r.destinyLoader("stop")}t!==null&&(n.Utilities.Modals.Alert(t),$.trim(this.$textInput.val())===""&&this.$textInput.val(i.body))},t.prototype.clearInputArea=function(n){n.val("");setTimeout(function(){n.focus()},1)},t.prototype.validateAndSubmitMessage=function(n,t){(this.$textInput=n,n.val()!==""&&this.isValidInput(n))&&(this.stickToBottom=!0,this.client.submitMessage(t),this.scrollToBottom())},t.prototype.scrollToBottom=function(){this.autoScrolling=!0;$(this.selectors.chatContainer).scrollTop($(this.selectors.chatMessageList).height()*3)},t.prototype.scrollToSamePosition=function(){for(var i,t=0,r=this.client.viewModel.messages,n=0;n<this.client.olderMessagesAdded;n++)i=$(this.selectors.chatMessageList+" [data-messageId="+r()[n].messageId+"]"),t+=i.outerHeight();this.client.olderMessagesAdded=0;this.autoScrolling=!0;$(this.selectors.chatContainer).scrollTop(t)},t.prototype.isValidInput=function(t){var f=this,i=n.Utilities.Validation.getErrors(t),u,r;if(i.length>0){for(u=function(n){var t=i[n].element,u=t.attr("data-errorMessage-"+i[n].type),e=t.get(0),r;$(".error").filter(function(){return $(f).data("for").get(0)===e}).length<1&&(r=$('<span class="error">'+u+"<\/span>"),t.focus().before(r),r.data("for",t))},r=0;r<i.length;r++)u(r);return!1}return!0},t.prototype.setupScrolling=function(){var t=this,n=$(this.selectors.chatContainer);this.eventBinder.for(n).on("scroll",function(){return t.handleScrolling()});n.customScroll({forcePreventBodyScroll:!0})},t.prototype.whoIsTypingChanged=function(n){viewModels.clanChatViewModel.chatUI().whoIsTyping(this.buildWhoIsTyping(n))},t.prototype.buildWhoIsTyping=function(n){var t="";switch(n.length){case 0:break;case 1:t=Localizer.Format(Localizer.Community.useristyping,{user:n[0].displayName});break;case 2:t=Localizer.Format(Localizer.Community.twousersaretyping,{user1:n[0].displayName,user2:n[1].displayName});break;case 3:t=Localizer.Format(Localizer.Community.threeusersaretyping,{user1:n[0].displayName,user2:n[1].displayName,user3:n[2].displayName});break;default:t=Localizer.Community.moreusersaretyping}return t},t}();t.ChatUI=r})(t=n.Chat||(n.Chat={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function t(t,i){this.client=t;this.params=i;this.eventBinder=new n.EventBinder("chatUI");this.stickToBottom=!0;this.autoScrolling=!1;this.canSubmitMessage=!0;this.messageListHeight=0;this.lastMessageCount=0;this.editorViewModel={textareaValue:"",showEditor:!1};this.chatViewModel={client:this.client.viewModel,newMessageBannerVisible:!1,gatedMedia:[],whoIsTyping:"",selfIsAdmin:!1}}return t.prototype.initialize=function(){this.vueInit();this.addListeners()},t.prototype.destroy=function(){this.eventBinder.destroy()},t.prototype.vueInit=function(){var t=this;this.chatVue=new Vue({data:this.chatViewModel,el:this.params.$conversationContainerElement[0],methods:{toggleGated:function(n){return t.toggleGated(n)},openLightbox:function(n){return t.openLightbox(n)},formatBody:function(n){return t.formatBody(n)},isMe:function(n){return t.isMe(n)},isConsecutive:function(n){return t.isConsecutive(n)},isLastConsecutive:function(n){return t.isLastConsecutive(n)},getUserProfileUrl:function(n){return t.getUserProfileUrl(n)},getTimestamp:function(n){return t.getMessageTimestamp(n)},getTimestampAgo:function(n){return t.getMessageTimestampAgo(n)},isWithinTimeThreshold:function(n){return t.isWithinTimeThreshold(n)},isVideo:function(t){return n.Utilities.Parse.messageIsVideo(t.body)},scrollToBottom:function(){return t.scrollToBottom()},onScroll:function(){return t.handleScrolling()},report:function(n){return t.report(n)},moderate:function(){return t.moderate()}}});this.editVue=new Vue({el:this.params.$editContainerElement[0],data:this.editorViewModel,methods:{onTextareaKeydown:function(n){return t.onTextareaKeydown(n)},submitMessage:function(){return t.submitMessage()}}})},t.prototype.showEditor=function(){this.editorViewModel.showEditor=!0},t.prototype.addListeners=function(){var n=this;this.client.subscribe({updateType:"onSubmitStarted",onUpdate:function(){return n.submitStartedEvent()}});this.client.subscribe({updateType:"onSubmitStopped",onUpdate:function(t){return n.submitStoppedEvent(t)}});this.client.subscribe({updateType:"onWhoIsTypingChanged",onUpdate:function(t){return n.whoIsTypingChanged(t)}});this.client.subscribe({updateType:"onLoadingStarted",onUpdate:function(){return n.handleLoadingState(!0)}});this.client.subscribe({updateType:"onLoadingComplete",onUpdate:function(){return n.handleLoadingState(!1)}})},t.prototype.handleScrolling=function(){var n=$(this.params.chatContainerSelector);n.scrollTop()+n.innerHeight()+5>n[0].scrollHeight?(this.stickToBottom=!0,this.chatViewModel.newMessageBannerVisible=!1):this.autoScrolling||(this.stickToBottom=!1);this.autoScrolling||n.scrollTop()!==0||this.client.loadMessages(!1,!0,!1);this.autoScrolling=!1},t.prototype.validateAndSubmitMessage=function(n){this.isValidInput(n)&&(this.stickToBottom=!0,this.client.submitMessage(this.editorViewModel.textareaValue),this.scrollToBottom())},t.prototype.scrollToBottom=function(){this.autoScrolling=!0;var n=$(this.params.chatContainerSelector);n.scrollTop(n[0].scrollHeight)},t.prototype.isValidInput=function(t){var f=this,i=n.Utilities.Validation.getErrors(t),u,r;if(i.length>0){for(u=function(n){var t=i[n].element,u=t.attr("data-errorMessage-"+i[n].type),e=t.get(0),r;$(".error").filter(function(){return $(f).data("for").get(0)===e}).length<1&&(r=$('<span class="error">'+u+"<\/span>"),t.focus().before(r),r.data("for",t))},r=0;r<i.length;r++)u(r);return!1}return!0},t.prototype.onTextareaKeydown=function(n){if(n.which!==13||n.shiftKey)this.client.sendTyping();else if(n.preventDefault(),this.canSubmitMessage){var t=$(n.currentTarget);t.parent().find(".error").remove();this.submitMessage(t)}},t.prototype.submitMessage=function(n){n===void 0&&(n=null);n=n||$(this.params.$editContainerElement.selector).find(this.params.inputSelector);this.validateAndSubmitMessage(n)},t.prototype.toggleGated=function(t){var i=n.Utilities.Enumerable.firstIndexOf(this.chatViewModel.gatedMedia,function(n){return n===t});i>=0?this.chatViewModel.gatedMedia.splice(i,1):this.chatViewModel.gatedMedia.push(t)},t.prototype.openLightbox=function(n){var t=n.currentTarget;Utility.showMediaLightBox('<img class="img_lightbox" src="'+t.src+'" alt="" /><br /><a class="extraContent" href="'+t.src+'">'+t.src+"<\/a>")},t.prototype.formatBody=function(t){var u=t.body,r=t.messageId,o=t.subject,f=this.client.viewModel.users[t.memberFromId],e=this.chatViewModel.gatedMedia.indexOf(r)>-1,i=n.Utilities.Parse.messageLinks(u,r,n.Utilities.User.loggedInUserBnetMembershipId,!1,f,e);return i=n.Utilities.Parse.parseBBCode(i,!0,!0),n.Utilities.Url.correctExternalLinks(i,!0)},t.prototype.isMe=function(n){return n.memberFromId===this.chatViewModel.client.signedInUser.membershipId},t.prototype.isWithinTimeThreshold=function(n){var t=this.client.viewModel.messages,i=t.indexOf(n);if(i>0){var r=t[i-1],u=moment(n.dateSent),f=moment(r.dateSent);return u.add(-5,"m").isBefore(f)}return!1},t.prototype.isConsecutive=function(n){var t=this.client.viewModel.messages,i=t.indexOf(n),r,u;return i>0&&(r=t[i-1],u=this.isWithinTimeThreshold(n),r.memberFromId===n.memberFromId&&u)?!0:!1},t.prototype.isLastConsecutive=function(n){var t=this.client.viewModel.messages,i=t.indexOf(n),r;if(t.length>i+1){if(r=t[i+1],r.memberFromId!==n.memberFromId)return!0}else return!0;return!1},t.prototype.getMessageTimestamp=function(n){return moment(n.dateSent).local().format("h:mma, ddd MMM Do, YYYY")},t.prototype.getMessageTimestampAgo=function(n){var t=moment(n.dateSent);return moment().subtract("7","days").isBefore(t)?moment(n.dateSent).fromNow():this.getMessageTimestamp(n)},t.prototype.getUserProfileUrl=function(n){return PageUrls.profilePage+"/254/"+n},t.prototype.buildWhoIsTyping=function(n){var t="";switch(n.length){case 0:break;case 1:t=Localizer.Format(Localizer.Community.useristyping,{user:n[0].displayName});break;case 2:t=Localizer.Format(Localizer.Community.twousersaretyping,{user1:n[0].displayName,user2:n[1].displayName});break;case 3:t=Localizer.Format(Localizer.Community.threeusersaretyping,{user1:n[0].displayName,user2:n[1].displayName,user3:n[2].displayName});break;default:t=Localizer.Community.moreusersaretyping}return t},t.prototype.adjustScrollPositionAfterLoadingNewBatch=function(){var n=this;Vue.nextTick(function(){n.client.olderMessagesAdded>0?n.scrollToSamePosition():(n.chatViewModel.newMessageBannerVisible=!n.stickToBottom&&n.lastMessageCount<n.client.viewModel.messages.length,n.stickToBottom&&(Modernizr.touch&&$(n.params.chatContainerSelector).css("overflow","auto"),n.scrollToBottom()))})},t.prototype.scrollToSamePosition=function(){var n=$(this.params.chatContainerSelector),t=this.messageListHeight,i=n[0].scrollHeight,r=i-t;n.scrollTop(r)},t.prototype.submitStartedEvent=function(){this.editorViewModel.textareaValue="";this.canSubmitMessage=!1;$(this.params.messageLoadingElementSelector).destinyLoader({delayBeforeAppear:300,size:30,startOnInit:!0})},t.prototype.submitStoppedEvent=function(t){this.canSubmitMessage=!0;$(this.params.messageLoadingElementSelector).destinyLoader("stop");t.error!==null&&(n.Utilities.Modals.Alert(t.error),t.originalInput&&$.trim(this.editorViewModel.textareaValue)===""&&(this.editorViewModel.textareaValue=t.originalInput.body))},t.prototype.whoIsTypingChanged=function(n){this.chatViewModel.whoIsTyping=this.buildWhoIsTyping(n.typers)},t.prototype.handleLoadingState=function(n){n?$(this.params.chatContainerSelector).destinyLoader({delayBeforeAppear:100}):($(this.params.chatContainerSelector).destinyLoader("stop"),this.adjustScrollPositionAfterLoadingNewBatch());this.messageListHeight=$(this.params.chatContainerSelector)[0].scrollHeight;n||(this.lastMessageCount=this.client.viewModel.messages.length)},t.prototype.report=function(t){n.Utilities.User.reportMessage(t,null)},t.prototype.moderate=function(){},t}();t.ChatUIVue=i})(t=n.Chat||(n.Chat={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function n(n){this.conversationId=n;this.messages=ko.observableArray();this.users={};this.newConversationParticipantsMembershipIds=[];this.userCount=ko.observable(0);this.isLoadingOlder=ko.observable(!1);this.isSending=ko.observable(!1);this.userNotificationPreference=ko.observable(!1)}return n.prototype.reset=function(){this.messages([]);this.users={};this.newConversationParticipantsMembershipIds=[]},n.prototype.updateUserCount=function(){this.userCount(Object.keys(this.users).length)},n.prototype.isConsecutive=function(n){console.log(n)},n}(),r;t.ChatViewModel=i;r=function(){function r(n,r){r===void 0&&(r="-1");var u=this;this.signedInUser=n;this.conversationId=r;this.loading=!1;this.hasMoreOlder=!0;this.reloadWhenDone=!1;this.autoReloadCount=0;this.lastTyping=0;this.PlaceholderMessageID="p";this.whoIsTypingManager=new t.WhoIsTypingManager;this.newMessageLength=0;this.olderMessagesAdded=0;this.onWhoIsTypingChanged=null;this.onConversationCreated=null;this.whoIsTypingManager.whoIsTypingChanged=function(n){if(u.onWhoIsTypingChanged!=null)u.onWhoIsTypingChanged(n)};this.viewModel=new i(this.conversationId)}return Object.defineProperty(r.prototype,"isExistingConversation",{get:function(){return this.conversationId!=="-1"},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.loading=!1;this.hasMoreOlder=!0;this.reloadWhenDone=!1;this.autoReloadCount=0;this.newMessageLength=0;this.olderMessagesAdded=0;this.viewModel.reset()},r.prototype.start=function(){this.addEventMuxSubscriptions();this.viewModel.conversationId&&this.loadMessages(!1,!1)},r.prototype.destroy=function(){n.EventMux.unsubscribe(this.conversationChangeSubscription);n.EventMux.unsubscribe(this.typingSubscription)},r.prototype.addEventMuxSubscriptions=function(){var t=this;this.conversationChangeSubscription=n.EventMux.subscribe({eventType:Globals.RealTimeEventType.ConversationChanged,onUpdate:function(n){var i=n.update;parseInt(t.viewModel.conversationId,10)===parseInt(i.conversationId,10)&&t.loadMessages(!1,!0)}});this.typingSubscription=n.EventMux.subscribe({eventType:Globals.RealTimeEventType.Typing,onUpdate:function(n){var i=n.update;parseInt(t.viewModel.conversationId,10)===parseInt(i.conversationId,10)&&t.whoIsTypingManager.addTyper(i.whoIsTyping)}})},r.prototype.sendTyping=function(){var n=(new Date).getTime(),t;n-this.lastTyping>5e3&&(this.lastTyping=n,t={conversationId:this.conversationId},bungieNetPlatform.messageService.UserIsTyping(t,function(){},function(){}))},r.prototype.onSubmitMessageStarted=function(){this.lastTyping=0;this.viewModel.isSending(!0);this.onSubmitStarted!=null&&this.onSubmitStarted()},r.prototype.onSubmitMessageStopped=function(n,t){if(this.viewModel.isSending(!1),this.onSubmitStopped!=null)this.onSubmitStopped(n,t)},r.prototype.submitMessage=function(n){var i=this,t;if(!this.viewModel.isSending()||n!==""){if(this.onSubmitMessageStarted(),!this.isExistingConversation){this.createConversation(n);return}this.addMessageLocally(n);t={body:n,subject:"",conversationId:this.viewModel.conversationId};bungieNetPlatform.messageService.SaveMessageV4(t,function(){return i.onSubmitMessageStopped(null,null)},function(n){return i.onSubmitMessageStopped(n,t)})}},r.prototype.createConversation=function(t){var i=this;bungieNetPlatform.messageService.CreateConversationV2({body:t,membersToId:this.viewModel.newConversationParticipantsMembershipIds.concat([n.Utilities.User.loggedInUserBnetMembershipId]),subject:""},function(n){return i.onSuccessfulConversationCreation(n)},function(n){return i.onFailureToStartConversation(n)})},r.prototype.onSuccessfulConversationCreation=function(n){this.viewModel.conversationId=n.conversationId;this.onSubmitMessageStopped(null,null);this.onConversationCreated(n);this.reset();this.start()},r.prototype.onFailureToStartConversation=function(n){this.onSubmitMessageStopped(n,null)},r.prototype.addMessageLocally=function(t){this.viewModel.users[this.signedInUser.membershipId]=this.signedInUser;var i={messageId:this.PlaceholderMessageID,conversationId:"0",dateSent:moment().format("YYYY-MM-DDTHH:mm:ssZ"),subject:"",body:n.Utilities.String.htmlEncode(t),isAutoResponse:!1,memberFromId:this.signedInUser.membershipId,isDeleted:!1,fromServer:!1,folderId:null,systemId:null,invitationId:null};this.viewModel.messages.push(i)},r.prototype.startLoading=function(n){this.loading=!0;this.onLoadingStarted&&this.onLoadingStarted();this.viewModel.isLoadingOlder(n)},r.prototype.onLoadingStopped=function(){this.loading=!1;this.viewModel.isLoadingOlder(!1);this.onLoadingComplete&&this.onLoadingComplete()},r.prototype.getOldestMessageId=function(){for(var n="9223372036854775807",i=this.viewModel.messages(),t=0;t<i.length;t++)if(n=i[t].messageId,n!==this.PlaceholderMessageID)break;return n},r.prototype.getNewestMessageId=function(){for(var n="0",i=this.viewModel.messages(),t=i.length-1;t>=0;t--)if(n=i[t].messageId,n!==this.PlaceholderMessageID)break;return n},r.prototype.loadMessages=function(n,t){var u=this,r,i,f;if(this.loading){this.reloadWhenDone=t;return}if(r="9223372036854775807",i="0",n){if(!this.hasMoreOlder)return;r=this.getOldestMessageId()}else i=this.getNewestMessageId();this.startLoading(n);f=this.viewModel.conversationId;bungieNetPlatform.messageService.GetConversationThreadV3(f,1,0,r,i==="p"?"0":i,function(t){return u.onMessagesLoaded(n,i,t)},function(){return u.onLoadingStopped()})},r.prototype.onMessagesLoaded=function(n,t,i){var u,r;if(n&&(this.olderMessagesAdded=i.results.length),this.newMessageLength=this.viewModel.messages().length+i.results.length,this.viewModel.users=$.extend(this.viewModel.users,i.users),this.viewModel.updateUserCount(),this.viewModel.userNotificationPreference(i.userNotificationPreference),u=this.viewModel.messages,n)for(this.hasMoreOlder=i.hasMore,r=0;r<i.results.length;r++)u.unshift(this.markAsFromServer(i.results[r]));else{for(this.removePlaceholderMessages(u),r=i.results.length-1;r>=0;r--)this.removeTyper(i.results[r].memberFromId),u.push(this.markAsFromServer(i.results[r]));i.hasMore&&t!=="0"&&(this.reloadWhenDone=!0)}this.reloadWhenDone?(this.reloadWhenDone=!1,this.autoReloadCount++,this.autoReloadCount<20?this.loadMessages(n,!1):this.autoReloadCount=0):this.autoReloadCount=0;this.onLoadingStopped()},r.prototype.removeTyper=function(n){n!=="0"&&typeof this.viewModel.users[n]!="undefined"&&this.whoIsTypingManager.removeTyper(this.viewModel.users[n].displayName)},r.prototype.markAsFromServer=function(n){return n.fromServer=!0,n},r.prototype.removePlaceholderMessages=function(n){while(n().length>0&&!n()[n().length-1].fromServer)n.pop()},r}();t.Client=r})(t=n.Chat||(n.Chat={}))}(Bnet||(Bnet={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var i=function(n){function t(t,i){var r=n.call(this,t)||this;return r.error=null,r.originalInput=null,r.typers=null,r.result=null,i&&(r.error=i.error||null,r.originalInput=i.originalInput||null,r.typers=i.typers||null,r.result=i.result||null),r}return __extends(t,n),t}(n.Site.SubscriptionPayload),r,u;t.ChatClientPayload=i;r=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t}(n.Site.Subscription);u=function(u){function f(){var n=u.call(this,r)||this;return n._viewModel={messages:[],users:{},newConversationParticipantsMembershipIds:[],isLoadingOlder:!1,isSending:!1,signedInUser:null,userNotificationPreference:!1},n._vmReset=$.extend({},n._viewModel),n.loading=!1,n.hasMoreOlder=!0,n.reloadWhenDone=!1,n.autoReloadCount=0,n.PlaceholderMessageID="p",n.lastTyping=0,n.whoIsTypingManager=new t.WhoIsTypingManager,n.newMessageLength=0,n.olderMessagesAdded=0,n}return __extends(f,u),Object.defineProperty(f.prototype,"viewModel",{get:function(){return this._viewModel},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isExistingConversation",{get:function(){return this.conversationId!==null},enumerable:!0,configurable:!0}),f.prototype.reset=function(){this.destroy();this.loading=!1;this.hasMoreOlder=!0;this.reloadWhenDone=!1;this.autoReloadCount=0;this.newMessageLength=0;this.olderMessagesAdded=0;for(var n in this._viewModel.users)this._viewModel.users.hasOwnProperty(n)&&Vue.delete(this._viewModel.users,n);this._viewModel.messages.splice(0,this._viewModel.messages.length);this._viewModel.newConversationParticipantsMembershipIds.splice(0,this._viewModel.newConversationParticipantsMembershipIds.length);this._viewModel.isLoadingOlder=!1;this._viewModel.isSending=!1;this._viewModel.userNotificationPreference=!1},f.prototype.start=function(n){n===void 0&&(n=null);this.reset();this.viewModel.signedInUser=ko.mapping.toJS(viewModels.loggedInUserModel().user);this.conversationId=n;this.addEventMuxSubscriptions();this.conversationId&&this.loadMessages(!0,!1,!1)},f.prototype.destroy=function(){n.EventMux.unsubscribe(this.conversationChangeSubscription);n.EventMux.unsubscribe(this.typingSubscription)},f.prototype.loadMessages=function(n,t,i){var f=this,u,r;if(this.loading){this.reloadWhenDone=i;return}if(u="9223372036854775807",r="0",!n)if(t){if(!this.hasMoreOlder)return;u=this.getOldestMessageId()}else r=this.getNewestMessageId();this.startLoading(t);bungieNetPlatform.messageService.GetConversationThreadV3(this.conversationId,1,0,u,r==="p"?"0":r,function(n){return f.onMessagesLoaded(t,r,n)},function(){return f.onLoadingStopped()})},f.prototype.submitMessage=function(n){var i=this,t;if(!this.viewModel.isSending||n!==""){if(this.onSubmitMessageStarted(),!this.isExistingConversation){this.createConversation(n);return}this.addMessageLocally(n);t={body:n,subject:"",conversationId:this.conversationId};bungieNetPlatform.messageService.SaveMessageV4(t,function(){return i.onSubmitMessageStopped(null,null)},function(n){return i.onSubmitMessageStopped(n,t)})}},f.prototype.sendTyping=function(){var n=(new Date).getTime(),t;n-this.lastTyping>5e3&&(this.lastTyping=n,t={conversationId:this.conversationId},bungieNetPlatform.messageService.UserIsTyping(t,function(){},function(){}))},f.prototype.addEventMuxSubscriptions=function(){var t=this;this.conversationChangeSubscription=n.EventMux.subscribe({eventType:Globals.RealTimeEventType.ConversationChanged,onUpdate:function(n){var i=n.update;t.conversationId===i.conversationId&&t.loadMessages(!1,!1,!0)}});this.typingSubscription=n.EventMux.subscribe({eventType:Globals.RealTimeEventType.Typing,onUpdate:function(n){var i=n.update;t.conversationId===i.conversationId&&t.whoIsTypingManager.addTyper(i.whoIsTyping)}})},f.prototype.onMessagesLoaded=function(t,i,r){var f,u,o,e;if(t&&(this.olderMessagesAdded=r.results.length),this.newMessageLength=this._viewModel.messages.length+r.results.length,this._viewModel.users=$.extend(this._viewModel.users,r.users),this._viewModel.userNotificationPreference=r.userNotificationPreference,f=this._viewModel.messages,t)for(this.hasMoreOlder=r.hasMore,u=0;u<r.results.length;u++)f.unshift(this.markAsFromServer(r.results[u]));else{for(this.removePlaceholderMessages(f),o=function(){var t=r.results[u],i;e.removeTyper(t.memberFromId);i=n.Utilities.Enumerable.any(f,function(n){return n.messageId===t.messageId});i||f.push(e.markAsFromServer(t))},e=this,u=r.results.length-1;u>=0;u--)o();r.hasMore&&i!=="0"&&(this.reloadWhenDone=!0)}this.reloadWhenDone?(this.reloadWhenDone=!1,this.autoReloadCount++,this.autoReloadCount<20?this.loadMessages(!1,t,!1):this.autoReloadCount=0):this.autoReloadCount=0;this.onLoadingStopped()},f.prototype.addMessageLocally=function(t){this.viewModel.users[this.viewModel.signedInUser.membershipId]=this.viewModel.signedInUser;var i={messageId:this.PlaceholderMessageID,conversationId:"0",dateSent:moment().format("YYYY-MM-DDTHH:mm:ssZ"),subject:"",body:n.Utilities.String.htmlEncode(t),isAutoResponse:!1,memberFromId:this.viewModel.signedInUser.membershipId,isDeleted:!1,fromServer:!1,folderId:null,systemId:null,invitationId:null};this.viewModel.messages.push(i)},f.prototype.startLoading=function(n){this.loading=!0;this.broadcast("onLoadingStarted");this._viewModel.isLoadingOlder=n},f.prototype.onLoadingStopped=function(){this.loading=!1;this._viewModel.isLoadingOlder=!1;this.broadcast("onLoadingComplete")},f.prototype.onSubmitMessageStopped=function(n,t){this.viewModel.isSending=!1;this.broadcast("onSubmitStopped",{error:n,originalInput:t})},f.prototype.onSubmitMessageStarted=function(){this.lastTyping=0;this.viewModel.isSending=!0;this.broadcast("onSubmitStarted")},f.prototype.onSuccessfulConversationCreation=function(n){this.conversationId=n.conversationId;this.onSubmitMessageStopped(null,null);this.broadcast("onConversationCreated",{result:n});this.start(n.conversationId)},f.prototype.onFailureToStartConversation=function(n){this.onSubmitMessageStopped(n,null)},f.prototype.getOldestMessageId=function(){for(var n="9223372036854775807",i=this._viewModel.messages,t=0,r=i.length;t<r;t++)if(n=i[t].messageId,n!==this.PlaceholderMessageID)break;return n},f.prototype.getNewestMessageId=function(){for(var n="0",i=this._viewModel.messages,t=i.length-1;t>=0;t--)if(n=i[t].messageId,n!==this.PlaceholderMessageID)break;return n},f.prototype.removeTyper=function(n){n!=="0"&&typeof this._viewModel.users[n]!="undefined"&&this.whoIsTypingManager.removeTyper(this._viewModel.users[n].displayName)},f.prototype.markAsFromServer=function(n){return n.fromServer=!0,n},f.prototype.removePlaceholderMessages=function(n){while(n.length>0&&!n[n.length-1].fromServer)n.pop()},f.prototype.createConversation=function(t){var i=this;bungieNetPlatform.messageService.CreateConversationV2({body:t,membersToId:this.viewModel.newConversationParticipantsMembershipIds.concat([n.Utilities.User.loggedInUserBnetMembershipId]),subject:""},function(n){return i.onSuccessfulConversationCreation(n)},function(n){return i.onFailureToStartConversation(n)})},f.prototype.getPayloadsToUpdate=function(n,t){for(var u,f=[],r=0,e=this.subscriptions;r<e.length;r++)u=e[r],u.params.updateType===n&&f.push(new i(u,t));return f},f.prototype.broadcast=function(n,t){var i=this.getPayloadsToUpdate(n,t);this.updateSubscriptions(i)},f}(n.Site.Subscribable);t.ClientVue=u})(t=n.Chat||(n.Chat={}))}(Bnet||(Bnet={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var r=function(t){function i(n){var i=t.call(this,"ModerateChatModal",n)||this;return i.isReporter=viewModels.isReporter(),i.includeCloseButton=!1,i}return __extends(i,t),i.openReportModal=function(n,t,i){var f=$("#reportChatModal-template").html(),r;f!=null&&(r=new u(f,n,t,i),r.open(),r.addListenersForModal())},i.openModerateModal=function(n,t){var r=$("#moderateChatModal-template").html(),i;r!=null&&(i=new f(r,n,t),i.open(),i.addListenersForModal())},i.prototype.addListenersForModal=function(){var n=this;this.eventBinder.forDocument(".btn_cancel").on("click",function(){n.close()})},i.prototype.applyBanHistory=function(t,i){var r=this;t.html(Localizer.Helptext.adminloadingdisciplinehistory);bungieNetPlatform.adminService.GetRecentDisciplineAndFlagHistoryForMember(i,7,function(n){for(var i,e,u="",f=0;f<n.results.length;f++)i=n.results[f],e=new Date(i.dateResolved),u+="<strong>"+e.toLocaleDateString()+" "+e.toLocaleTimeString()+"<\/strong>: "+r.getLocalizedReportResult(i.result)+" on a "+r.getLocalizedReportItemType(i.reportedItemType)+" for "+Localizer.Mute[i.reason],u+=i.banDurationInDays>0&&i.banDurationInDays<1e6?" ("+i.banDurationInDays+" day ban).<br />":".<br />";u===""&&(u=Localizer.Helptext.adminnodisciplinehistoryfound);t.html(u)},function(t){n.Utilities.Modals.Alert(Localizer.Helptext.adminerrordisciplinehistory+" "+t.errorMessage)})},i.prototype.getLocalizedReportResult=function(n){var t="";switch(n){case Globals.ReportResolutionStatus.Unresolved:t=Localizer.Helptext.reportresolutionstatusunresolved;break;case Globals.ReportResolutionStatus.Innocent:t=Localizer.Helptext.reportresolutionstatusinnocent;break;case Globals.ReportResolutionStatus.GuiltyBan:t=Localizer.Helptext.reportresolutionstatusguiltyban;break;case Globals.ReportResolutionStatus.GuiltyBlastBan:t=Localizer.Helptext.reportresolutionstatusguiltyblastban;break;case Globals.ReportResolutionStatus.GuiltyWarn:t=Localizer.Helptext.reportresolutionstatusguiltywarn;break;case Globals.ReportResolutionStatus.GuiltyAlias:t=Localizer.Helptext.reportresolutionstatusguiltyalias;break;case Globals.ReportResolutionStatus.ResolveNoAction:t=Localizer.Helptext.reportresolutionstatusresolvenoaction;break;default:t=Localizer.Helptext.reportresolutionstatusunknown}return t},i.prototype.getLocalizedReportItemType=function(n){var t="";switch(n){case Globals.IgnoredItemType.Post:t=Localizer.Helptext.ignoreditemtypepost;break;case Globals.IgnoredItemType.Group:t=Localizer.Helptext.ignoreditemtypegroup;break;case Globals.IgnoredItemType.User:t=Localizer.Helptext.ignoreditemtypeuser;break;case Globals.IgnoredItemType.Tag:t=Localizer.Helptext.ignoreditemtypetag;break;case Globals.IgnoredItemType.GroupProfile:t=Localizer.Helptext.ignoreditemtypegroupprofile;break;case Globals.IgnoredItemType.UserProfile:t=Localizer.Helptext.ignoreditemtypeuserprofile;break;case Globals.IgnoredItemType.UserPrivateMessage:t=Localizer.Helptext.ignoreditemtypeuserprivatemessage;break;case Globals.IgnoredItemType.GroupWallPost:t=Localizer.Helptext.ignoreditemtypegroupwallpost;break;case Globals.IgnoredItemType.PrivateMessage:t=Localizer.Helptext.ignoreditemtypeprivatemessage;break;default:t=Localizer.Helptext.ignoreditemtypeunknown}return t},i}(n.Modal),u,f,i;t.ModerateModal=r;u=function(t){function r(n,i,r,u){var f=t.call(this,n)||this;return f.membershipId=i,f.messageText=r,f.messageId=u,f.setupModalContent(n,i,r,u),f}return __extends(r,t),r.prototype.setupModalContent=function(n,t){this.isReporter&&this.applyBanHistory($(".banHistoryElement"),t)},r.prototype.addListenersForModal=function(){var r=this;t.prototype.addListenersForModal.call(this);this.eventBinder.forDocument(".btn_msgreport").on("click",function(){var t=new n.UiKit.FormKit.DropdownItem("msgreport_reason").val(),u=r.isReporter?new n.UiKit.FormKit.DropdownItem("mod_punishment").val():null;i.report(t,"",u,!1,r.membershipId,r.messageText,r.messageId,function(){});r.close()})},r}(r);t.ReportMessageModal=u;f=function(n){function t(t,i,r){var u=n.call(this,t)||this;return u.groupId=i,u.messageId=r,u.setModalContent(i,r),u}return __extends(t,n),t.prototype.setModalContent=function(){},t.prototype.addListenersForModal=function(){var t=this;n.prototype.addListenersForModal.call(this);this.eventBinder.forDocument(".btn_groupWallModerate").on("click",function(n){n.preventDefault();i.moderate(t.groupId,t.messageId,function(){$("li[data-messageId="+t.messageId+"]").hide()});t.close()})},t}(r);t.ModerateMessageModal=f;i=function(){function t(){}return t.report=function(t,i,r,u,f,e,o,s){var h={ignoredItemId:o,ignoredItemType:Globals.IgnoredItemType.GroupWallPost,comment:i,reason:t,itemContextId:o,itemContextType:Globals.IgnoredItemType.GroupWallPost,requestedPunishment:r,requestedBlastBan:u};bungieNetPlatform.ignoreService.FlagItem(h,function(){n.Utilities.Modals.Alert(Localizer.Community.thankyouforyourwallreport);s()},function(t){n.Utilities.Modals.Alert(t)})},t.moderate=function(t,i,r){bungieNetPlatform.messageService.ModerateGroupWall(t,i,function(){r()},function(t){n.Utilities.Modals.Alert(t)})},t}();t.ModerateModalActions=i})(t=n.Chat||(n.Chat={}))}(Bnet||(Bnet={})),function(n){var t;(function(t){var i=function(){function(){}