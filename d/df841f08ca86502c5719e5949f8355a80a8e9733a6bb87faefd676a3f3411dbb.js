(new R9.logger).time("combined");
(function(a,b){a.createComponentClass("common.results.ScrollSearchBanner",{shownToUser:!1,options:{},cssClass:{bannerShow:"ScrollSearchBanner--showing",bannerHide:"ScrollSearchBanner--hidden",bannerInvisible:"ScrollSearchBanner--invisible"},cachedDomStates:{isBannerVisible:!1},init:function(){this.searchElement=this.getChildElement("bannerSearch");this.closeBannerElement=this.getChildElement("bannerClose")},addEventHandlers:function(){this.subscribe("scrollSearchBanner.toggleVisibility",this.toggleVisibility.bind(this));
this.registerEvent("click",this.searchElement,this.submitSearchForm.bind(this));this.registerEvent("click",this.closeBannerElement,this.dismissBanner.bind(this));this.registerEvent("reset.scrollSearch.banner.shown",this.resetBannerShown.bind(this));a.question.answer("was.user.shown.scrollSearch.banner",this.wasBannerShown.bind(this))},toggleVisibility:function(a){a?this.showBanner():this.closeBanner(!1)},submitSearchForm:function(){this.resetBannerShown();a.events.publish("submit.search.form");this._unbindScrollEvent();
this._trackEvent("scrollFormSubmit","searchFormSubmitFromBanner");this.closeBanner(!1);b(window).scrollTop(0).trigger("scroll")},dismissBanner:function(a){a.stopPropagation();this.closeBanner(!0)},showBanner:function(){this.cachedDomStates.isBannerVisible||(this.shownToUser=!0,this.cachedDomStates.isBannerVisible=!0,this._triggerDialogCloseOnSearchForm(),this.element.removeClass(this.getStlBlock(this.cssClass.bannerInvisible)),this.swapClasses(this.element,this.cssClass.bannerHide,this.cssClass.bannerShow),
this.element.attr("aria-hidden","false"),this._trackEvent("showBanner","makeBannerVisible"))},closeBanner:function(a){this.cachedDomStates.isBannerVisible&&(this.cachedDomStates.isBannerVisible=!1,this.swapClasses(this.element,this.cssClass.bannerShow,this.cssClass.bannerHide),this.element.addClass(this.getStlBlock(this.cssClass.bannerInvisible)),this.element.attr("aria-hidden","true"),a&&(this._unbindScrollEvent(),this._trackEvent("dismissSearchScrollBanner","userClosedBanner",a)))},wasBannerShown:function(){return this.shownToUser},
resetBannerShown:function(){this.shownToUser=!1},_triggerDialogCloseOnSearchForm:function(){a.events.publish("forceDismiss.DatePicker.ifOpen");a.events.publish("smarty.setitem.complete");a.events.publish("common.dropdown.closeAll");a.events.publish("common.widgets.select.close")},_trackEvent:function(b,c,d){a.Analytics.api.trackEvent({category:"scrollSearchBanner",action:b,label:c,value:d})},_unbindScrollEvent:function(){a.events.publish("unbind.scroll.search.event")},destroy:function(){this._unbindScrollEvent()}})})(R9,
jQuery);
(function(b){var e=b.config.getBoolean("ui.flight.prediction.advancedValidation",!1),f=b.config.getInt("ui.flight.prediction.minDaysOut",7);b.createComponentClass("flights.results.FlightQueryPricePrediction",{wrappers:null,adviceText:null,chart:null,info:null,tooltipTrigger:null,advice:null,verboseAdvice:null,moreInfo:null,chartIcon:null,dataCheckPromise:null,searchId:null,ariaLabel:null,hasGraphData:!1,options:{enabledForQuery:!0,controlVisibility:!1,showFullGraph:!1,shruggieEnabled:!0,msg:{LOADING_TEXT:""},
trackingEnabled:!1},init:function(){this.wrappers=this.getChildElement("wrapper");this.adviceText=this.getChildElement("advice");this.chart=this.getChildElement("chart");this.chartIcon=this.getChildElement("chartIcon");this.bannerText=this.getChildElement("bannerText");this.info=this.getChildElement("info");this.tooltipTrigger=this.getChildElement("tooltip-trigger");this.ariaLabel=this.getChildElement("ariaLabel");this.options.showFullGraph&&(this.dialog=$("#"+this.id("graph-dialog")),this.wrappers=
this.wrappers.add($("#"+this.id("graph-dialog-body"))),this.chartIcon=this.chartIcon.add($("#"+this.id("chartIcon-dialog"))),this.bannerText=this.bannerText.add($("#"+this.id("bannerText-dialog"))),this.verboseAdvice=$("#"+this.id("verboseAdvice-dialog")),this.moreInfo=$("#"+this.id("moreInfo-dialog")))},addEventHandlers:function(){var a=this;this.answer("flights.results.prediction.is",function(){return a.advice?{buy:a.advice.buy,advice:a.advice.advice}:null});this.subscribe("resultspage.streaming.done",
function(b){a.options.enabledForQuery&&b.searchId&&0<b.searchId.length&&!b.error&&(a.searchId=b.searchId,a.dataCheckPromise?a.dataCheckPromise.then(a.requestPrediction.bind(a)):a.requestPrediction())});this.subscribe(["search.startSearch","search.searchFailed","resultspage.cleanup"],this.clearPrediction.bind(this,!0));this.options.controlVisibility&&this.subscribe("flights.results.prediction.enabled",this.updateVisibility.bind(this));this.addGraphAndTooltipHandlers()},updateVisibility:function(a){a!==
this.options.enabledForQuery&&(this.options.enabledForQuery=a,this.element.toggleClass("hidden",!a).toggleClass("disabled",!a))},addGraphAndTooltipHandlers:function(){var a=this;this.options.showFullGraph?(this.registerEvent("click",function(){a.hasGraphData&&(a.dialog.getWidget().open(),b.Analytics.api.trackEvent({category:"Price-Prediction",action:"show-graph",label:a.advice||""}))}),this.subscribe("flights.results.prediction.farehistory.fail",function(){a.dialog.addClass("no-graph")})):this.tooltipTrigger.getWidget()&&
"click"===this.tooltipTrigger.getWidget().options.activation?this.registerEvent("click",this.chart,function(){a.tooltipTrigger.attr("aria-hidden")&&setTimeout(function(){a.tooltipTrigger.getWidget().open();a.trackInfoDisplay()},0)}):this.trackingEnabled()&&this.registerEvent("mouseenter",this.tooltipTrigger,function(){a.trackInfoDisplay()})},requestPrediction:function(){b.action.execute("flights/results/FlightPricePredictionAction",{searchId:this.searchId},this.onPredictionCompleted.bind(this))},
onPredictionCompleted:function(a){this.advice=a.advice;this.element.removeClass("loading");this.wrappers.attr("class",a.cssClass);this.updateAdviceHeader(a.adviceText,!1);this.info.html(a.infoText);this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent(a.moreInfoText);"disabled"===a.advice?(this.clearPrediction(!1),this.element.addClass("hidden").addClass("disabled")):"none"!==a.advice?(this.chartIcon.attr("aria-hidden","false"),this.tooltipTrigger.attr("aria-hidden","false")):
this.options.shruggieEnabled||(this.clearPrediction(!1),this.element.addClass("hidden"));a.bannerCta&&this.bannerText.html(a.bannerCta);this.options.showFullGraph&&(this.verboseAdvice&&a.verboseAdviceText&&this.verboseAdvice.html(a.verboseAdviceText),this.moreInfo&&this.moreInfo.html(a.moreInfoText||a.infoText||""),this.validateChartData(a.chartData,a)&&(this.hasGraphData=!0,this.wrappers.addClass("has-data")),b.events.publish("flights.results.priceForecastChart.chartData",{chartData:a.chartData,
prediction:a}));b.events.ready("flights.results.prediction",a);b.Analytics.api.trackEvent({category:"Price-Prediction",action:"read-advice",label:a.advice});this.ariaLabel.html(a.adviceText+"\x3cbr\x3e"+a.infoText+"\x3cbr\x3e"+(a.moreInfoText||""));this.trackPrediction(a)},validateChartData:function(a,b){if(!a||!a.length)return!1;var c=a[0].value,g=a.some(function(a){return a.value!==c}),d=!0;if(e)switch(b.advice){case "buy":case "strong-buy":d=.1>a.filter(function(a){return a.value<c}).length/a.length;
break;case "wait":d=a.some(function(a){return a.value<c})}a="number"===typeof b.departureDaysOut&&b.departureDaysOut>=f;return g&&d&&a},updateAdviceHeader:function(a,b){this.adviceText.html(a);this.adviceText.attr("aria-busy",b)},clearPrediction:function(a){this.searchId=this.advice=null;this.wrappers.attr("class","");a&&this.wrappers.addClass("loading");this.chartIcon.attr("aria-hidden","true");this.bannerText.html("");this.dataCheckPromise=null;this.hasGraphData=this.skipPrediction=!1;this.updateAdviceHeader(a?
this.options.msg.LOADING_TEXT:"",a);this.info.html("");this.tooltipTrigger.attr("aria-hidden","true");this.ariaLabel.html("");this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent("")},trackingEnabled:function(){return this.options.trackingEnabled&&b.Vestigo},trackPrediction:function(a){if(this.trackingEnabled()){var c=b.VestigoType.PredictionType.none;a.buy?c=b.VestigoType.PredictionType.buy:a.wait&&(c=b.VestigoType.PredictionType.wait);b.VestigoEvents.price.predict.show(c,
a.infoText)}},trackInfoDisplay:function(){this.trackingEnabled()&&b.VestigoEvents.price.predict.info()}})})(R9);
(function(c){R9.extend("Widgets",{Checkbox:function(a,b){this.elementNode=a;this.element=c(this.elementNode);this.icon=c(R9.Widgets.Checkbox.findIconNode(this.elementNode));this.validateElement()&&(this.options=c.extend({},this.options,b),this.init())}});R9.extend("Widgets.Checkbox",{isCheckbox:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"checkbox"==a.type.toLowerCase()},isWidgetControlled:function(a){return c(a).hasClass(R9.Widgets.Checkbox.prototype.widgetBaseClass+"-input")},
refresh:function(a,b){b=c(b);b[a.checked?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-checked");b[a.disabled?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-disabled")},findIconNode:function(a){return c(a).closest("[id$\x3d'-icon']")},findElementNode:function(a){return document.getElementById(a.id.substring(0,a.id.lastIndexOf("-icon")))}});R9.extend("Widgets.Checkbox.prototype",{widgetName:"checkbox",widgetBaseClass:"r9-checkbox",elementNode:null,
element:null,icon:null,options:{click:null,change:null},init:function(){this.bindInputClickEvent();this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.element.data(this.widgetName,this)},validateElement:function(){return R9.Widgets.Checkbox.isCheckbox(this.elementNode)&&R9.Widgets.Checkbox.isWidgetControlled(this.elementNode)},bindInputEvent:function(a,b){var c=this;a+="."+
this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,R9.Widgets.Checkbox.findIconNode(this),a)})},bindInputClickEvent:function(){this.bindInputEvent("click",this.handleElementClickEvent)},handleElementClickEvent:function(a,b,c){this.options.click&&this.options.click.apply(this,arguments)},handleElementChangeEvent:function(a,b,c){R9.Widgets.Checkbox.refresh(a,b);this.options.change&&this.options.change.apply(this,arguments)},handleElementFocusEvent:function(a,b,d){a.disabled||(c(b).addClass(this.widgetBaseClass+
"-state-focus"),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,b,d){a.disabled||(c(b).removeClass(this.widgetBaseClass+"-state-focus"),this.options.blur&&this.options.blur.apply(this,arguments))}})})(jq||jQuery);var FOCUSED_CLASS=R9.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");
(function(c){R9.createWidgetClass("checkbox.Checkbox",c.extend({},R9.Widgets.Checkbox.prototype,{isToggle:!1,options:{keydown:c.noop,click:null,change:null},init:function(){this.elementNode=this.element.get(0);this.element.parent().is(".toggle")&&(this.isToggle=!0);this.label=this.getChildElement("label")},addEventHandlers:function(){this.bindInputClickEvent();this.bindInputEvent("change",this._handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",
this.handleElementBlurEvent)},_handleElementChangeEvent:function(a,b,d){this.handleElementChangeEvent(a,b,d);this.options.isToggle&&(b=c(a).prop("checked"),a.setAttribute("aria-checked",b))},setEnabled:function(a){a?this.element.removeAttr("disabled"):this.element.attr("disabled","disabled");this.element.attr("aria-disabled",!a);R9.Widgets.Checkbox.refresh(this.element,this.icon)},getValue:function(){return this.element.prop("checked")},setChecked:function(a){this.element.prop("checked",a);this.isToggle&&
this.elementNode.setAttribute("aria-checked",a)},handleElementFocusEvent:function(){this.base();this.toggleFocusOutline(!0)},handleElementBlurEvent:function(){this.base();this.toggleFocusOutline(!1)},toggleFocusOutline:function(a){this.element.closest(".js-checkbox-container").toggleClass(FOCUSED_CLASS,a)}}))})(jq||jQuery);
(function(b){b.createComponentClass("flights.results.FlightPriceAlertButton",{options:{trackCreateAlertPath:"",useToast:!1,wireButtonStyle:!1,sourceId:null,msg:{priceAlertSaved:"",priceAlertUpdated:"",priceAlertRemoved:""}},alertMode:"",createButton:void 0,init:function(){this.createButton=this.getChildElement("create")},inlineComponentsReady:function(){var a=b.question.ask("flights.results.prediction.is");a&&!this.options.wireButtonStyle&&this.updateButtonColor(a);(a=b.question.ask("flights.results.alerts.existingAlert"))&&
0<a.length&&this.updateButtonVisibility(!0)},openDriveby:function(){this.driveby||b.events.publish("flights.results.alerts.create",{sourceId:this.options.sourceId})},addEventHandlers:function(){var a=this;this.getChildElement("create").off("click.pricealert").on("click.pricealert",function(){a.createButton.hasClass("clickedPriceAlert")||(a.createButton.addClass("clickedPriceAlert"),a.openDriveby())});this.subscribe(["alertsaved.success","flight.results.alerts.driveby.cancel"],function(){a.createButton.removeClass("clickedPriceAlert")});
this.options.useToast&&this.subscribe("alertsaved.success",function(){if("edit"!==a.alertMode)a.updateToastEnabled=!0;else if(!a.updateToastEnabled)return;var d=b.template.render(a.id()+"-successToastContent",{alertUpdated:"edit"===a.alertMode});b.events.publish("resultspage.notify",{content:d});b.Analytics.api.trackEvent({category:"pricealert/managelink/impression",action:"impression"})});this.options.wireButtonStyle||this.subscribe("flights.results.prediction",this.updateButtonColor.bind(this));
this.subscribe("flights.priceAlert.setview",function(b){a.preventDialogClose=!1;a.updateButtonVisibility("edit"===b.view);a.alertMode=b.view});this.subscribe(["flights.results.priceAlert.show","flights.results.prediction"],function(b){a.element.toggleClass("hidden",!1===b)});this.subscribe("resultspage.cleanup",function(){a.updateButtonVisibility(!1);a.driveby&&(a.driveby.destroy(),a.driveby=null)});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setVisible(b.enabled&&b.visible)});
var c=this.getChildElement("alert-created-button");c.length&&(this.subscribe("flights.priceAlert.deleted",function(){a.alertMode="";a.updateButtonVisibility(!1);c.removeClass("clickedPriceAlert");a.options.useToast&&b.events.publish("resultspage.notify",{content:a.options.msg.priceAlertRemoved})}),c.on("click",function(){$(this).hasClass("clickedPriceAlert")||($(this).addClass("clickedPriceAlert"),b.events.publish("flights.results.alerts.delete"))}),this.subscribe("error.alert",function(){c.removeClass("clickedPriceAlert")}));
this.options.useToast&&(this.subscribe(["resultspage.streaming.start","search.startSearch"],function(){a.updateToastEnabled=!1}),this.subscribe("resultspage.streaming.done",function(){a.updateToastEnabled=!0}))},setVisible:function(a){a?this.element.show():this.element.hide()},updateButtonVisibility:function(a){this.element.toggleClass("existing",a)},updateButtonColor:function(a){this.createButton.toggleClass("Button-Grey-Invert",!0===a.buy)},onDrivebyPopover:function(){if(this.driveby)this.driveby.dialog.open();
else{var a=this.getChildElement("dialog").styleJamDropdownDialog({target:this.element.find(".alertButton"),staticPosition:{top:"35px",right:0},container:this.element,alignment:"left",direction:"down"}).getWidget();this.driveby=this.getChildElement("popover").children().eq(0).data("driveby");this.driveby.bindDialog(a)}}})})(R9);
(function(c){c.createComponentClass("flights.results.FlightPriceAlertBanner",{toggle:void 0,tooltipTrigger:void 0,rippleEl:void 0,alertIcon:void 0,alertIconActive:void 0,options:{alwaysShow:!1,visible:!1,economyOnlyAlerts:!1,sourceId:null,trackingEnabled:!1},init:function(){this.toggle=this.getChildElement("toggle");this.rippleEl=this.getChildElement("ripple");this.tooltipTrigger=this.getChildElement("tooltip-trigger");this.alertIcon=this.getChildElement("alertIcon");this.alertIconActive=this.getChildElement("alertIconActive")},
inlineComponentsReady:function(){var a=c.question.ask("flights.results.alerts.existingAlert");a&&0<a.length&&this.setChecked(!0);this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent(this.options.msg.tooltipMsg)},addEventHandlers:function(){var a=this,d=this.toggle.parent().is(".StyleJamCheckbox")?"styleJamCheckbox":"checkbox";this.toggle[d]({change:function(b,d,e){b=b.checked;c.Analytics.api.trackEvent({category:"Price-Alert",action:b?"toggleOn":"toggleOff"});b?(c.events.publish("flights.results.alerts.create",
{sourceId:a.options.sourceId}),a.activateAlertIcon()):(c.events.publish("flights.results.alerts.delete"),a.inActivateAlertIcon());a.trackChange(b)}});this.subscribe(["flights.priceAlert.deleted","flights.results.alerts.delete","flight.results.alerts.driveby.cancel"],this.setChecked.bind(this,!1));this.subscribe(["flights.priceAlert.created","flights.results.alerts.create"],this.setChecked.bind(this,!0));this.subscribe("flights.priceAlert.setview",function(b){a.setChecked("edit"===b.view)});this.subscribe("search.startSearch",
function(b){a.setVisible(a.isEnabledForQuery(b))});this.subscribe("resultspage.cleanup",function(){a.setChecked(!1);a.setCheckboxEnabled(!1)});this.subscribe(["flights.results.priceAlert.show","flights.results.prediction"],function(b){a.setCheckboxEnabled(!!b)});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setCheckboxEnabled(b.enabled);a.setVisible(b.visible)})},activateAlertIcon:function(){this.alertIcon.hide();this.alertIconActive.show();this.rippleEl.addClass("rippleEffect");
this.rippleEl.on(c.Common.Utils.Browsers.ANIMATION_END,function(){this.alertIconActive.removeClass("in-transition").addClass("active")}.bind(this))},inActivateAlertIcon:function(){this.alertIcon.show();this.alertIconActive.hide();this.rippleEl.removeClass("rippleEffect");this.alertIconActive.removeClass("active").addClass("in-transition")},isEnabledForQuery:function(a){return this.options.economyOnlyAlerts&&"e"!==a.cabin?!1:!a.isMulticity&&"openflex"!==a.flex_category&&!a.freeRegionId&&!a.countrySearch&&
(!a.destinationMultiAirports||1< !Object.keys(a.destinationMultiAirports).length)&&(!a.originMultiAirports||1< !Object.keys(a.originMultiAirports).length)},setChecked:function(a){this.toggle.prop("checked",a);a?this.activateAlertIcon():this.inActivateAlertIcon()},setCheckboxEnabled:function(a){this.toggle.getWidget().setEnabled(a)},setVisible:function(a){this.element.toggleClass("hidden",!a).attr("aria-hidden",!a);this.toggle.attr("aria-hidden",!a)},trackChange:function(a){this.options.trackingEnabled&&
c.VestigoEvents&&!1===a&&c.VestigoEvents.price.alert.off()}})})(R9);
(function(d,g){d.createComponentClass("common.results.DisplayCounts",{filteredCount:null,totalCount:null,showAllLink:null,product:null,baseProductString:null,options:{withUnits:!1,horizontalMode:!1,labelMsg:"",pluralProductMsg:"",singleProductMsg:"",ariaLabel:"",wrapperClass:"",filtered:0,total:0},init:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.baseProductString=this.product.html()},
inlineComponentsReady:function(){this.options.total&&this.updateCounts({filtered:this.options.filtered,total:this.options.total})},addEventHandlers:function(){var a=this;this.subscribe("resultspage.results.count.changed",function(c){d.dom.schedule(a.updateCounts.bind(a,c))});this.subscribe(["search.searchFailed","search.startSearch"],function(){d.dom.schedule(a.updateCounts.bind(a,{filtered:0,total:0}))});this.bindShowAll()},bindShowAll:function(){this.filteredCount=this.getChildElement("filteredCount");
this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.showAllLink=this.element.find("a.showAll").eq(0);this.showAllLink.click(function(){g(this).hasClass("disabled")||(d.events.publish("filters.reset",{type:"showAll"}),d.Analytics.api.trackEvent({category:"Filters",action:"see-all-results"}))})},updateCounts:function(a){if(this.options.withUnits){this.filteredCount.text(a.filtered);this.totalCount.text(a.total);this.showAllLink.css("display",a.filtered===
a.total?"none":"inline-block");var c=this.element.children().first();c.removeClass("visible").addClass("visible");c.removeClass("simple").addClass("simple");this.element.removeClass("visible").addClass("visible");this.element.removeClass("simple").addClass("simple")}else{var b="";""!=this.options.ariaLabel&&(b=' aria-label\x3d"'+this.options.ariaLabel+'"');var c="\x3cspan id\x3d"+this.id("filteredCount")+"\x3e"+a.filtered+"\x3c/span\x3e",e="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+b+
"\x3e\x3cspan id\x3d"+this.id("totalCount")+"\x3e"+a.total+"\x3c/span\x3e\x3c/a\x3e",b="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+b+"\x3e\x3cspan id\x3d"+this.id("totalCount")+"\x3e"+a.total+"\x3c/span\x3e\x3cspan class\x3d'product'\x3e "+this.options.pluralProductMsg+"\x3c/span\x3e\x3c/a\x3e",f=this.getChildElement("showLabel"),b=d.Common.Utils.String.formatChoice(this.options.labelMsg,a.filtered,a.filtered,c,e,b,this.options.pluralProductMsg,this.options.singleProductMsg,f.length?f[0].outerHTML:
"");this.options.isHorizontalMode&&(b=this.options.pluralProductMsg,b=b.charAt(0).toUpperCase()+b.slice(1),b=d.Common.Utils.String.formatString(this.options.labelMsg,c,e,b));c="\x3cdiv class\x3d'"+this.options.wrapperClass+" visible'\x3e"+b+"\x3c/div\x3e";this.element.html(c).addClass("visible");d.events.publish("displayCounts.newData",{data:c});this.bindShowAll()}this.element.find("a.showAll").toggleClass("disabled",a.filtered===a.total);a.hasOwnProperty("product")?this.product.html(a.product):this.product.html()!==
this.baseProductString&&this.product.html(this.baseProductString)}})})(R9,jQuery);
(function(a){a.createComponentClass("common.results.filters.placeholders.FilterPlaceholderList",{topFilters:null,moreFilters:null,hasMultipleFilterLists:!1,init:function(){this.topFilters=this.getChildElement("top");(this.moreFilters=this.getChildElement("more"))&&this.moreFilters.length&&(this.hasMultipleFilterLists=!0)},addEventHandlers:function(){this.hasMultipleFilterLists&&(this.subscribe("filterTab.changed",this.switchActiveFilterList.bind(this)),this.subscribe("moreFilters.toggle",this.toggleMoreFilterList.bind(this)))},
switchActiveFilterList:function(){this.topFilters.toggleClass("hidden");this.moreFilters.toggleClass("hidden")},toggleMoreFilterList:function(a){a?this.moreFilters.removeClass("hidden"):this.moreFilters.addClass("hidden")}})})(R9);
(function(c,d){c.createComponentClass("common.results.filters.Filter",{name:null,data:null,title:null,content:null,searchCompleted:!1,options:{name:null,title:null,title2:null,collapsible:!1,collapsed:!1,isDropdown:!1,mobileView:!1,logUserInteraction:!0,logFiltersQuestion:"",loggingType:"ga",loggingPrefix:"filters",loggingAction:null,loggingLabel:null,resetInTitle:!1,triggerFilteredLabel:!1,useFilterLabelHidesReset:!1,refreshFilterPosOnCollapse:!1,hasPlaceholder:!1,infoTooltip:null,infoTooltipExtraClass:null,
showApplyAll:!1,trackEnabled:!1,showOnSearchFailed:!1,useMcFlyStyling:!1,duplicatedFilter:!1},trackingType:null,trackCategory:"filters",dirty:!1,resetButton:null,enabled:null,interactable:null,previousFilters:{},init:function(){this.data={};this.name=this.options.name;this.title=this.getChildElement("title");this.content=this.getChildElement("content");if(void 0===this.name||""===this.name)throw"Error initializing Javascript filter: a filter name was not provided";this.options.infoTooltip&&this.getChildElement("info").toolTip({content:this.options.infoTooltip,
position:"top",showImmediately:!1,extraClass:this.options.infoTooltipExtraClass});this.trackingType=this.getTrackingType();c.question.answer("filters."+this.name+".state",function(){return this.getState()}.bind(this))},inlineComponentsReady:function(){this.options.collapsible&&!this.options.collapsed&&this.element.addClass("open")},addEventHandlers:function(){var a=this;this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));var b=this.reset.bind(this);this.subscribe("filters.reset",
b);this.subscribe("filter.reset",{name:this.name},b);this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed"],function(){a.element.toggleClass("hidden",a.element.hasClass("empty"))});this.subscribe("resultspage.streaming.done",function(){a.searchCompleted=!0});this.subscribe("search.searchFailed",function(){a.options.showOnSearchFailed?a.element.removeClass("hidden"):a.element.addClass("hidden")});this.subscribe("filter.show",{name:this.name},function(){a.element.removeClass("hidden")});
this.subscribe("search.startSearch",this.onSearchStart.bind(this));this.subscribe("train.legChange.reset",function(b){(!b||0>b.indexOf(a.name))&&c.events.publish("filter.reset",{name:a.name})});(b=this.getChildElement("reset"))&&b.length&&(b.click(function(b){b.stopPropagation();a.reset({type:"reset",userClick:!0})}),b.keydown(function(b){switch(b.which){case c.globals.keyCodes.RETURN:case c.globals.keyCodes.SPACE:b.preventDefault(),a.reset({type:"reset",userClick:!0})}}));this.subscribe("filters.selectedprice",
function(){a.reset.apply(a,arguments)});b=this.getChildElement("skip");b.length&&b.click(function(b){b=d("[tabbable]:visible");var c=b.index(a.element)+1;c>=b.length&&(c=0);b.eq(c).get(0).focus()});if(this.options.collapsible){var e=function(b){var f=(b=a.element.hasClass("open"))?"hide":"show";c.Analytics.api.trackEvent({category:"Filter-Collapsible",action:f,label:a.name});a.element.toggleClass("open");a.title.attr("aria-pressed","show"===f);a.title.attr("aria-expanded","show"===f);c.globals.testMode&&
a.title.attr("data-test-filter-collapsed",b);c.events.publish("horizon.filters.opened");!0===a.options.refreshFilterPosOnCollapse&&c.events.publish("horizon.filters.FiltersDialog.itemToggled");a.isMobileView()&&(a.element.parent().addClass("hideNotOpened"),c.events.publish("horizon.mobile.FiltersDialog.itemOpened",{name:a.name,title:a.options.title}));a.options.trackEnabled&&a.trackingType&&(b?c.VestigoEvents.filters.shared.collapse(a.trackingType):c.VestigoEvents.filters.shared.expand(a.trackingType))};
this.title.click(e);this.title.keypress(function(a){if(a.keyCode===c.globals.keyCodes.RETURN||a.keyCode===c.globals.keyCodes.SPACE)return e(),!1})}this.subscribe("filters.disabled",this.setDisabled.bind(this));this.subscribe("filter.disabled",{name:this.name},function(b){a.setDisabled(b.disabled)});this.subscribe("filters.goBack",function(){a.element.removeClass("open");a.element.parent().removeClass("hideNotOpened")});this.options.triggerFilteredLabel&&this.subscribe("resultspage.results.count.changed",
this.onResultsCountChanged.bind(this));c.question.forget("resultspage.filter.%s.history.view".format(this.name));this.answer("resultspage.filter.%s.history.view".format(this.name),this.getHistoryFilterViewState.bind(this));this.subscribe("resultspage.filter.%s.history.apply".format(this.name),this.applyFilterFromHistory.bind(this));this.subscribe("resultspage.filter.%s.history.reset".format(this.name),this.reset.bind(this,{type:"reset"}));this.subscribe("resultspage.filter.%s.history.sync".format(this.name),
this.syncWithHistoryPillState.bind(this));this.subscribe("filters.changed",{name:this.name},function(b){a.toggleDirtyOnAfterFiltersChanged(b)});this.options.hasPlaceholder&&this.subscribe("filters.update.placeholderDisplay",this.updatePlaceholderDisplay.bind(this));this.subscribe("filters."+this.name+".setFromPrevious",this.onSetFromPrevious.bind(this));this.subscribe("filters."+this.name+".applyPreferences",this.onApplyPreferences.bind(this));this.options.showApplyAll&&this.registerEvent("click",
this.getChildElement("applyAll"),function(b){b.stopPropagation();b.stopImmediatePropagation();a.applyAll()})},toggleDirtyOnAfterFiltersChanged:function(a){this.element.is(".Common-Results-Filters-FilterSection")||this.element.toggleClass("isDirty",!a.reset)},onApplyPreferences:function(a){if(a||a.length)this.setStateFromPrevious(a),this.pushStateChange(null,{filterPreferenceChange:!0,changeData:{field:a.key,value:a.value,remove:a.reset}})},onSetFromPrevious:function(a){this.options.duplicatedFilter||
(this.setStateFromPrevious(a),a.silent?this.syncFilterState(a.reset):this.pushStateChange(null,{previousFilterChange:!0,changeData:{field:a.key,value:a.value,remove:a.reset,fromPrevious:!0}}),a.reset?delete this.previousFilters[a.key]:this.previousFilters[a.key]=a.value)},updatePreviousFilters:function(a){},removePreviousFilter:function(a){c.events.publish("filters.myfilters.removeFromPrevious",{name:this.name,key:a});a?delete this.previousFilters[a]:this.previousFilters={}},getResetType:function(){return!1===
this.options.isMultiValueSet?"showAll":!0===this.options.isMultiValueSet?"clearAll":"custom"},pushStateChange:function(a,b,e){a=!0===a?null:e?e:this.getState();b=d.extend({name:this.name,state:a},b,{elemId:this.id()});c.events.publish("filters.changed",b);Object.keys(this.previousFilters).length&&!b.previousFilterChange&&this.updatePreviousFilters(a);b.previousFilterChange||this.trackStateChange(b)},logUserInteraction:function(a){this.trackInteraction(a);if(""===this.options.logFiltersQuestion||this.logViewState(this.element))"ga"===
this.options.loggingType&&"object"===typeof a?c.Analytics.api.trackEvent(a):c.Analytics.api.trackEvent("/"+this.options.loggingPrefix+"/"+this.name+(a?"/"+a:""))},logViewState:function(a){return c.question.ask(this.options.logFiltersQuestion,{filterEl:a})},publishHoverState:function(a,b){a=d.extend({namespace:this._namespace,name:this.name,hover:a},b||{});c.events.publish("filters.%s.hovering".format(this.name),a)},toggleResetLink:function(a){var b=this.getChildElement("reset");a?(0!==b.length&&b.addClass("active"),
this.element.addClass("activeReset")):(0!==b.length&&b.removeClass("active"),this.element.removeClass("activeReset"))},reset:function(a){this.willReset.apply(this,arguments);this.setLastUserInteraction(!0);this.pushStateChange(!0,{reset:!0});a&&a.userClick&&this.logUserInteraction("reset")},updatePlaceholderDisplay:function(a){},filterDataChanged:function(a){this.element.closest(".hfilter").addClass("empty-filter");var b=d.extend({},a[this.name]);if(b.hasOwnProperty("enabled"))b.enabled?this.element.hasClass("inactive")&&
this.element.removeClass("inactive"):this.element.addClass("inactive"),this.setEnabled(b.enabled),delete b.enabled;else if(!a[this.name]){Object.keys(a).length&&(this.setEnabled(!1),this.element.addClass("empty"));return}this.dirty=b.isDirty;delete b.isDirty;this.isUserManipulated=b.isUserManipulated;c.events.publish("filter.dirty",{name:this.name,dirty:this.dirty,isUserManipulated:this.isUserManipulated});this.element.toggleClass("isDirty",this.dirty);this.toggleResetLink(this.dirty);this.options.collapsible&&
!this.options.resetInTitle&&this.dirty&&this.element.addClass("open");this.options.triggerFilteredLabel&&this.lastUserInteraction&&(this.invalidateFilterLabelData?(this.invalidateFilterLabelData=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelCount=!0);this.update(b);this.isUserManipulated&&this.syncFilterState();this.element.toggleClass("empty",!this.shouldBeVisible(b));this.element.closest(".hfilter").toggleClass("empty-filter",!this.shouldBeVisible(b));this.setLastUserInteraction(!1)},
syncFilterState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a?null:this.getState()})},syncWithHistoryPillState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a})},setStateFromPrevious:function(a){},onResultsCountChanged:function(a){!isNaN(this.lastTotalFilteredCount)&&!isNaN(a.filtered)&&0<=a.filtered&&(this.lastFilterCountDiff=a.filtered-this.lastTotalFilteredCount);this.lastTotalFilteredCount=a.filtered;this.invalidateFilterLabelCount?
(this.invalidateFilterLabelCount=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelData=this.lastUserInteraction},updateFilteredLabels:function(a){a=parseInt(a);if(!isNaN(a)){if(this.options.useFilterLabelHidesReset){var b=this.getChildElement("reset");b&&b.length&&b.hasClass("active")&&(this.subscribe("filter.label.cleared."+this.name,this.onFilterLabelCleared.bind(this)),this.toggleResetLink(!1))}c.events.publish("filter.label.update",{name:this.name,diff:a})}},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+
a.name);this.dirty&&this.toggleResetLink(!0)},toggleAttribute:function(a){return"true"===a?"false":"true"},setLastUserInteraction:function(a){this.lastUserInteraction=a},setDisabled:function(a){c.dom.toggleOneClass(this.element,"Disabled",a);this.element.find("[aria-disabled]").attr("aria-disabled",a);this.interactable=!a},cleanupExistingState:function(){},shouldBeVisible:function(a){return!0},willReset:function(a){},update:function(a){},applyAll:function(){},getState:function(){},isMobileView:function(){return this.options.mobileView},
setEnabled:function(a){this.enabled!==a&&(this.enabled=a,c.events.publish("filter.enabled",{name:this.name,enabled:a}))},onSearchStart:function(a){this.element.removeClass("hidden");this.enabled=null;this.searchCompleted=!1;"undefined"!==typeof a&&a.preserveFilters||(this.options.hasPlaceholder||this.element.addClass("empty"),this.cleanupExistingState())},getHistoryFilterViewState:function(){return{}},applyFilterFromHistory:function(a){if(c.config.getBoolean("ui.horizon.filters.history.enabled",!1)){var b=
d.extend({},this.getState(),a);c.Analytics.api.trackEvent({category:"Filter-History",action:"Applying state From History: "+a,label:this.name});c.events.publish("filters.changed",{name:this.name,state:b})}},getStateForFilterHistory:function(){return d.extend({},this.getState(),{displayName:this.options.title})},updateFilterHistory:function(){c.config.getBoolean("ui.horizon.filters.history.enabled",!1)&&(c.Analytics.api.trackEvent({category:"Filter-History",action:"Storing filter state in browser: ",
label:this.name}),c.events.publish("store.filter.history",{name:this.name,state:this.getStateForFilterHistory()}))},getTrackingType:function(){if(this.options.trackEnabled&&c.VestigoType){var a=c.VestigoType.FilterType;switch(this.name){case "equipment":return a.aircraft;case "eqmodel":return a.model;case "neighborhoods":return a.neighbourhood;case "ambiance":return a.style;case "price-options":return a.other;case "providers":return a.provider;case "roomtypes":return a.roomtype;case "propertysubtype":return a.propertytype;
case "boardtypes":return a.board;default:return c.VestigoType.FlightQualityType[this.name]?a.flightquality:a[this.name]}}return""},trackInteraction:function(a){c.VestigoEvents&&this.trackingType&&("reset"!==a&&"showall"!==a||c.VestigoEvents.filters.shared.reset(this.trackingType))},getTrackingAction:function(a){if(c.VestigoType){var b=c.VestigoType.FilterValueAction.select;0===a&&(b=c.VestigoType.FilterValueAction.unselect);2===a&&(b=c.VestigoType.FilterValueAction.only);return b}},trackStateChange:function(a){},
trackStateChangeEnabled:function(a){return this.options.trackEnabled&&a.changeData}})})(R9,jQuery);
(function(c,e){var g=c.config.getBoolean("ui.horizon.fitlers.valueSetFilterItem.clearDisabledPrice",!0),h=c.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");c.createComponentClass("common.results.filters.ValueSetFilterItem",{checkbox:null,options:{name:null,loggingValue:null,group:null,state:{code:null,displayValue:null,pluralDisplayValue:null,minPrice:null,selected:0,info:!1,showAllSate:void 0,resetState:void 0,noSelect:!1,disabled:!1,hideOnly:!1,ignoreOnly:!1,displayOrder:0,
description:null,filtered:!1,partiallyFiltered:!1,resetOnDynamicIconClick:!1,tooltipText:null,href:null,cssClass:null,enableItemActionLogging:!1,enableActionTypeLogging:!0,count:0,showAsNotChecked:null,meta:!1},unrolled:!1,withImage:!1,onlyOnClick:!1,heading:void 0,headingOnlyState:1,onUserChange:e.noop,onRemove:e.noop,countEnabled:!1,allowZeroCount:!1,disableOnZeroCount:!1,messages:{},usePluralDisplayValue:!1,allUncheckedMeansInactive:!1,openMapOnSelection:!1,inModal:!1},events:{only:"filters.valueSetFilterItem.only"},
eventPrefix:"",eventGroupPrefix:"",loggingPrefix:"filters",updateKey:null,state:null,init:function(){this.state=e.extend({},this.options.state||{});this.checkbox=this.getChildElement("check");this.price=this.getChildElement("price");this.only=this.getChildElement("only");this.count=this.getChildElement("count");this.funnel=this.element.find(".funnel");this.innerCount=e("span",this.count);this.eventPrefix="filters.%s.%s.".format(this.options.group,this.options.name);this.eventGroupPrefix="filters.%s.".format(this.options.group);
this.options.onUserChange=this.options.onUserChange.bind(this,this.options.name);this.options.tooltipText&&(this.tooltip=this.getChildElement("tooltip-anchor").toolTip(this.getTooltipOptions({content:this.options.tooltipText})).getWidget());this.update(this.state);var a=this;c.dom.schedule(function(){a.checkbox.prop("checked",0<a.state.selected);"string"===typeof a.state.cssClass&&a.element.addClass(a.state.cssClass);a.options.cssClass&&a.element.addClass(a.options.cssClass);a.state.disabled&&a.setDisabled(!0);
a.state.hasOwnProperty("noSelect")&&(a.element.toggleClass("NoSelect",a.state.noSelect),a.checkbox.attr("aria-disabled",a.state.noSelect))})},addEventHandlers:function(){var a=this;this.registerEvent("click",this.element.find(".FilterCheckbox"),this.checkboxClicked.bind(this));this.registerEvent("keypress",this.element,function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.checkboxClicked(b)});this.registerEvent("click",this.price,this.priceClicked.bind(this));this.registerEvent("click",this.count,
this.countClicked.bind(this));this.registerEvent("click",this.only,this.onlyClicked.bind(this));this.registerEvent("mouseenter",this.element,this.handleOnlyContainerMouseEnter.bind(this));this.registerEvent("mouseenter",this.only,this.handleOnlyMouseEnter.bind(this));this.registerEvent("mouseleave",this.element,this.handleOnlyContainerMouseLeave.bind(this));this.registerEvent("mouseleave",this.only,this.handleOnlyMouseLeave.bind(this));this.registerEvent("focus",this.only,this.handleOnlyFocus.bind(this));
this.options.resetOnDynamicIconClick&&this.registerEvent("click",this.funnel,this.funnelClicked.bind(this));if(this.options.showRemoveIcon){var b=this.getChildElement("remove"),d=null;"function"===typeof this.options.onRemove&&this.registerEvent("click",b,function(b){b.stopPropagation();d&&d.close();a.options.onRemove(a)});b.attr("title")&&(d=b.toolTip().getWidget())}this.registerEvent("keypress",this.only,function(b){switch(b.which){case c.globals.keyCodes.SPACE:case c.globals.keyCodes.RETURN:a.only.click(),
b.stopPropagation()}});this.addSubscriptionHandlers();this.registerEvent("focus",this.checkbox,this.toggleFocusStyle.bind(this,!0));this.registerEvent("blur",this.checkbox,this.toggleFocusStyle.bind(this,!1))},addSubscriptionHandlers:function(){var a=this;this.subscribe(this.eventPrefix+"setchecked",this.setChecked.bind(this));this.only&&this.only.length&&this.subscribe(this.eventPrefix+"onlyclick.force",function(){a.only.click()});this.subscribe(this.eventPrefix+"quickclick.force",function(){a.state.disabled||
a.state.hideOnly||a.state.noSelect||a.setChecked(1,"quickfilter")});this.subscribe(this.eventPrefix+"quickunclick.force",function(){a.state.disabled||a.state.hideOnly||a.state.noSelect||a.setChecked(0,"quickfilter")});this.subscribe(this.eventPrefix+"setchecked.force",function(b){a.setChecked(b.selected,b.changeType||"toggle")});this.subscribe(this.eventPrefix+"resetitem",function(b){a.setChecked(a.state.resetState,b.changeType||"toggle")});this.subscribe(["filters.disabled",this.eventPrefix+"disabled"],
this.setDisabled.bind(this));this.subscribe("resultspage.cleanup",function(b){a.isClean=!0});this.subscribe("filters."+this.options.group+".showAsNotChecked",function(b){a.state.showAsNotChecked=b})},countClicked:function(a){this.state.disabled||this.state.hideOnly||this.state.noSelect||(this.setChecked(1),this.options.onUserChange("count"),this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"count"}))},priceClicked:function(a){if(this.price.attr("href"))window.open(this.price.attr("href"),
"_blank");else{if(this.state.disabled||this.state.hideOnly||this.state.noSelect)return;this.setChecked(1);this.options.onUserChange("price")}this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"price"})},onlyClicked:function(a){a.stopPropagation();this.state.disabled||(this.options.openMapOnSelection&&this.handleItemSelected(!0),this.options.heading?this.setChecked(this.options.headingOnlyState):this.setChecked(2),this.only.addClass("hideOnly"),
this.options.onUserChange("only"))},handleOnlyContainerMouseEnter:function(a){this.only.removeClass("hideOnly");this.only.addClass("hideOnlyDecoration")},handleOnlyContainerMouseLeave:function(a){this.only.addClass("hideOnly")},handleOnlyMouseEnter:function(a){this.only.removeClass("hideOnlyDecoration")},handleOnlyMouseLeave:function(a){this.only.addClass("hideOnlyDecoration")},handleOnlyFocus:function(a){this.only.removeClass("hideOnly");this.only.removeClass("hideOnlyDecoration")},funnelClicked:function(a){a.stopPropagation();
this.funnelTooltipWidget&&this.funnelTooltipWidget.close();c.events.publish("filters.reset",{type:"showAll"})},checkboxClicked:function(a){a.preventDefault();if(!this.state.disabled&&!this.state.noSelect){a=0<this.state.selected?0:1;var b="toggle";this.options.openMapOnSelection&&0<a&&this.handleItemSelected();this.options.enableActionTypeLogging&&(b=0<this.state.selected?"unselect":"select");this.options.onlyOnClick&&2!==this.state.selected&&(a=2,b="only");this.setChecked(a);this.options.onUserChange(b);
a=0<this.state.selected?"show":"hide";this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:a+"-"+this.options.name})}},handleItemSelected:function(a){c.events.publish(this.eventGroupPrefix+"selected",{name:this.options.name,only:a})},setDisabled:function(a){this.state.disabled=a;c.dom.toggleOneClass(this.element,"Disabled",a);this.element.attr("aria-disabled",a);c.dom.toggleOneClass(this.checkbox.parent(),"Disabled",a);c.events.publish(this.eventPrefix+
"state.disabled",a)},setSelectable:function(a){this.state.noSelect=!a;c.dom.toggleOneClass(this.element,"Disabled",!a);this.element.attr("aria-disabled",!a);c.dom.toggleOneClass(this.checkbox.parent(),"Disabled",!a)},setPrice:function(a){a=a||"";this.state.minPrice=a;this.price.text(a)},setCount:function(a){this.state.count=a;this.innerCount.text(a)},setChecked:function(a,b,d){d=this.options.allUncheckedMeansInactive&&this.state.showAsNotChecked?!1:0<a;c.dom.toggleOneClass(this.element,"Checked",
d);this.checkbox.prop("checked",d);this.state.selected=a;c.events.publish(this.eventPrefix+"changed",this.state);if(b)this.options.onUserChange(b)},setDisplayValue:function(a){this.element.find(".label").text(a);this.state.displayValue=a},setDescription:function(a,b){var d=this,e=this.element.find(".description"),f=e.find("span");b&&(e.text(a),this.state.description=a);0<f.length&&d.registerEvent("click",f,function(){c.events.publish(d.eventPrefix+"description.tooltip",{element:f})})},update:function(a){var b=
this;this.options.disableOnZeroCount&&0===a.count&&a.filtered?(a.disabled=!0,this.state.userSelectedDisabled=this.state.selected!==a.resetState):this.state.userSelectedDisabled=!1;a.disabled&&g&&(a.minPrice="");this.state.filtered=a.filtered;this.state.displayOrder=a.displayOrder;this.state.showAllState=a.showAllState;this.state.resetState=a.resetState;this.state.meta=a.meta;var d=this.computeUpdateKey(a);if(!c.config.getBoolean("ui.horizon.filters.updateKey",!0)||d!==this.updateKey||this.isClean)this.isClean=
!1,this.state.selected=a.selected,this.state.disabled=a.disabled,c.dom.schedule(function(){})},updateElement:function(a){a.cssClass&&a.cssClass!==this.state.cssClass&&(this.element.removeClass(this.state.cssClass),this.element.addClass(a.cssClass),this.state.cssClass=a.cssClass);this.setChecked(a.selected,"",!0);this.setPrice(a.minPrice);this.state.displayValue!==a.displayValue&&this.setDisplayValue(a.displayValue);null!=a.description&&this.setDescription(a.description,
a.description!==a.description);(0!==a.count||this.options.allowZeroCount)&&a.count!==this.state.count&&this.options.countEnabled&&this.setCount(a.count);this.updateDynamicFilterTooltip(a);var b=!!a.hideOnly;if(this.state.hideOnly!==b||this.element.hasClass("No-Only")!==b)this.state.hideOnly=b,this.element.toggleClass("No-Only",this.state.hideOnly);b=!!a.noSelect;this.state.noSelect!==b&&(this.state.noSelect=b,this.element.toggleClass("NoSelect",this.state.noSelect));this.setDisabled(!!a.disabled);
this.price.attr("href",a.href||null)},updateDynamicFilterTooltip:function(a){this.element.removeClass("Filtered FilteredOut");if(a.filtered||a.partiallyFiltered){var b=a.filtered?this.options.messages.filtered:this.options.messages.partiallyFiltered;if(b){this.showingTooltip=!0;var d=a.displayValue;this.options.usePluralDisplayValue&&(d=a.pluralDisplayValue);b=c.Common.Utils.String.formatString(b,d);this.element.addClass("Filtered"+(a.filtered?" FilteredOut":""));this.funnel.attr({"data-title":b,
"aria-label":b,"aria-disabled":!this.options.resetOnDynamicIconClick});this.funnel.getWidget()||(this.funnelTooltipWidget=this.funnel.toolTip(this.getTooltipOptions()).getWidget())}}else this.showingTooltip&&(this.funnel.attr({title:"","aria-disabled":!0}),this.showingTooltip=!1)},computeUpdateKey:function(a){var b="selected filtered partiallyFiltered hideOnly noSelect disabled showAsNotChecked".split(" ").reduce(function(b,c){return b+(a[c]?"1":"0")},""),b=b+(this.options.countEnabled?a.count:a.minPrice),
b=b+(a.cssClass?a.cssClass:""),b=b+a.displayValue;a.description&&(b+=a.description);return b+=a.href?a.href:""},getTooltipOptions:function(a){var b=this.options.cssClass&&-1!==this.options.cssClass.indexOf("kayak-flights");return e.extend({},{position:"top",extraClass:"Common-Results-Filters-ValueSetFilterItem__Tooltip "+this.options.cssClass+" "+(b?"uikit ":"")+(this.options.inModal?"modal-layer":""),orientation:b?"start":"middle",size:b?"uikit":"m"},a)},getState:function(){return this.state.disabled&&
!this.state.userSelectedDisabled?null:this.state.selected},toggleFocusStyle:function(a){this.element.toggleClass(h,a)}})})(R9,jQuery);
(function(k,g){k.createComponentClass("common.results.filters.ValueSetFilter","common.results.filters.Filter",{content:null,renderedFilterOptions:null,renderedHeadings:null,options:{isMultiValueSet:!1,isDefaultChecked:!1,showAllNone:!1,onReset:null,sortInPlace:!1,sortInPlaceLazy:!1,flushState:!0,onDeselect:null,confineOnlyToHeading:!1,selectableHeadings:!1,collapsedContent:!0,showHeadingCount:!0,showHeadingOnly:!0,onChange:null,removeExpiredOptions:!0,removeExpiredHeadingsWithOptions:!1,visibleCount:0,
overflowMinimum:0,showOverflowTemplate:"",hideOverflowTemplate:"",alwaysVisibleItems:[],preventNoneChecked:!1,showItemHoverTooltip:!1,includeExcludeItems:null,reverseOptionOrder:!1,countEnabled:!1,allowZeroCount:!1,allowEmptyPrice:!1,disableOnZeroCount:!1,disableOnNoPrice:!1,showOnly:!0,showDescription:!1,resetOnDynamicIconClick:!1,extraCssClass:"",featureClass:"",onlyLinkClass:"",hidePrice:!1,messages:{},itemTooltipTextMap:null,usePluralDisplayValue:!1,onGetState:null,reloadTop:!1,logItemActions:!1,
logActionType:!0,isDropdown:!1,itemTemplateId:"valueSetFilterItem",headingTemplateId:"headingContainerItem",showTooltipForEllipsed:!1,tooltipHoverDelay:1E3,allUncheckedMeansInactive:!1,reverseSortOrder:!1,sortOverflowByCount:null,displayDefaultUnchecked:!1,openMapOnSelection:!1,inModal:!1,useStarRating:!0,useStarTextDisplayValue:!1,discrete:!1},events:{all:"filters.valueSetFilter.showall"},showAllBtn:null,showNoneBtn:null,only:null,showOverflowLink:void 0,overflowVisible:!1,includeExcludeRadios:null,
metaState:null,showAsNotChecked:null,resetState:null,multisetOptions:null,headingValueMap:null,headingsDataMap:null,init:function(){this.base();this.renderedFilterOptions={};this.content=this.getChildElement("options");0<this.options.visibleCount&&(this.showOverflowLink=this.getChildElement("overflow"));this.showAllBtn=this.getChildElement("all");this.showNoneBtn=this.getChildElement("none");this.options.itemTooltipTextMap=this.options.itemTooltipTextMap||{};this.resetState=this.options.isMultiValueSet&&
!this.options.isDefaultChecked?0:1},addEventHandlers:function(){this.base();var a=this;void 0!==this.showOverflowLink&&(this.showOverflowLink.click(function(){a.options.isDropdown?a.getChildElement("dropdown_content").hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0):a.element.hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0)}),this.showOverflowLink.keypress(function(b){switch(b.which){case k.globals.keyCodes.SPACE:case k.globals.keyCodes.RETURN:a.showOverflowLink.click()}}));
this.subscribe("filters.%s.setonly".format(this.name),function(b){b=a.getRenderedFilterOptions()[b];a.options.preventNoneChecked&&(a.only.setSelectable(!0),b.setSelectable(!1));a.only=b});this.subscribe("filters.%s.updateDisplay".format(this.name),this.updateDisplay.bind(this));this.subscribe("filters.%s.setChecked".format(this.name),this.setCheckedItems.bind(this));this.subscribe("filters.%s.setUnChecked".format(this.name),this.setUnCheckedItems.bind(this));this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),
this.onItemHover.bind(this));this.options.showAllNone&&(this.registerEvent("click",this.showAllBtn,function(b){b&&g(b.target).hasClass("disabled")||a.reset({type:"all",userClick:!0,ignoreHideOverflow:!0})}),this.registerEvent("click",this.showNoneBtn,function(b){b&&g(b.target).hasClass("disabled")||a.deselect({type:"none",userClick:!0,ignoreHideOverflow:!0})}));this.options.includeExcludeItems&&(this.includeExcludeRadios=this.getChildElement("vsf-incl-radios").styleJamRadioButtonSet({change:a.onChangedIncludeExcludeRadio.bind(this)}).getWidget());
this.subscribe("search.startSearch",function(){a.showAsNotChecked=null;0<a.options.visibleCount&&a.hideOverflowOptions()});this.subscribe("filters.%s.forceReset".format(this.name),function(){a.reset()});this.options.openMapOnSelection&&this.subscribe("filters.%s.selected".format(this.name),function(){k.events.publish("results.mapToggle.toggle");k.events.publish("results.showMapEvent")})},inlineComponentsReady:function(){this.base();this.options.showTooltipForEllipsed&&!this.options.showItemHoverTooltip&&
this.subscribe("filters.%s.hovering".format(this.name),this.onItemHover.bind(this))},reset:function(a){if(!a||!(a.ignore===this.name||g.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name)))if(this.metaState=null,this.options.allUncheckedMeansInactive&&(this.showAsNotChecked=!0,k.events.publish("filters."+this.name+".showAsNotChecked",!0)),"function"===typeof this.options.onReset)this.options.onReset.apply(this,arguments);else{var b=this.options.flushState,c=this.options.displayDefaultUnchecked;this.forEachItem(function(d,
f){f.state.disabled||f.state.noSelect||(c?(b=!0,f.setChecked(0),f.state.selected=0):void 0!==f.state.showAllState&&a&&a.type&&"reset"!==a.type?(b=!1,f.setChecked(f.state.showAllState)):(d=f.state.resetState,void 0!==d&&void 0!==f.state.defaultSelectedState&&d!==f.state.defaultSelectedState&&(b=!1),f.setChecked(void 0!==d?d:this.resetState)),this.options.preventNoneChecked&&f.setSelectable(!0))});this.options.resetInTitle||!(0<this.options.visibleCount)||a&&a.ignoreHideOverflow||this.hideOverflowOptions();
this.enableShowAllNone(!1,!0);a&&a.silent?this.syncFilterState(b):this.pushStateChange(b,{reset:!0});a&&a.userClick&&(this.setLastUserInteraction(!0),this.logUserInteraction("showall"));this.only=null}},onChangedIncludeExcludeRadio:function(a){a=g(a);var b=a.val();a.is(":checked")&&b&&(this.metaState=b,this.pushStateChange())},enableShowAllNone:function(a,b){this.options.showAllNone&&(this.showAllBtn.toggleClass("disabled",!a),this.showNoneBtn.toggleClass("disabled",!b))},updateShowAllNone:function(a){this.options.showAllNone&&
(a?this.enableShowAllNone(!this.allChecked(a),this.anyChecked(a)):this.enableShowAllNone(!0,!0))},getIgnoreDeselect:function(){return null},getResetType:function(){return this.options.isDefaultChecked?"showAll":this.base()},deselect:function(a){if(!a||!(a.ignore===this.name||g.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name)))if("function"===typeof this.options.onDeselect)this.options.onDeselect.apply(this,arguments);else{var b=this.getIgnoreDeselect();this.forEachItem(function(a,d){d.state.disabled||
d.state.noSelect||b&&0<=b.indexOf(a)||(d.setChecked(0),this.options.preventNoneChecked&&d.setDisabled(!1))});!(0<this.options.visibleCount)||a&&a.ignoreHideOverflow||this.hideOverflowOptions();this.enableShowAllNone(!0,!1);a&&a.silent?this.syncFilterState():this.pushStateChange(!1);a&&a.userClick&&this.logUserInteraction(a.type)}},cleanupExistingState:function(){this.forEachItem(function(a,b){k.ComponentManager.remove(b.id())});this.renderedFilterOptions={};this.multisetOptions=null;this.getOptionsContainer().empty()},
sortRenderedFilterOptions:function(a){if(a.useHeadings)for(var b=Object.keys(a.headingValueMap),c=0;c<b.length;c++){var d=this.getOptionsContainer().find('.heading[data-heading\x3d"%s"]'.format(b[c])).find(".filter-content");this.sortOptionsInPlace(d,a.headingValueMap[b[c]])}else this.sortOptionsInPlace(this.getOptionsContainer(),a.valueMap)},sortOptionsInPlace:function(a,b){var c=a.find(".Common-Results-Filters-ValueSetFilterItem");0!==c.length&&(c=c.toArray().sort(function(a,c){a=b[g(a).data("name")];
c=b[g(c).data("name")];return a&&c?a.displayOrder-c.displayOrder:0}),g(c).detach().appendTo(a))},addOptionToFilterMap:function(a,b,c,d,f){var e=this.id()+"-"+Math.floor(1E4*Math.random())+"-"+a.replace(/\W+/g,""),e=g.extend({id:e,name:a},b,{showCount:this.options.countEnabled,showPrice:!this.options.countEnabled&&!this.options.hidePrice,itemTemplateId:this.options.itemTemplateId,hasCount:this.options.allowZeroCount?0<=b.count:0<b.count,hasPrice:this.options.allowEmptyPrice||b.minPrice,disabled:this.options.disableOnZeroCount?
0===b.count:!1,tooltipText:this.options.itemTooltipTextMap[a],showOnly:this.options.showOnly,showDescription:this.options.showDescription,hideDisplayValue:"stars"===this.options.name&&!this.options.useStarTextDisplayValue,useStarRating:this.options.useStarRating,onlyLinkClass:this.options.onlyLinkClass,optionsContainer:this.getOptionsContainer(),useMcFlyStyling:this.options.useMcFlyStyling?"mcfly-styling":"",featureClass:this.options.featureClass?this.options.featureClass.trim():""},f||{});f&&f.filtersData&&
(e.useStarRating=!f.filtersData.useCircleRatings);f=k.template.renderElement(e.itemTemplateId,e);var m=b.displayOrder,h=function(a,b){return a>b};this.options.reverseSortOrder&&(h=function(a,b){return a<b});var l=null;this.forEachItem(function(a,b){h(b.state.displayOrder,m)&&(null!==l?h(l.state.displayOrder,b.state.displayOrder)&&(l=b):l=b)},d);if(null===l||void 0!==c)if(e=e.optionsContainer,c){var n=e.find('.heading[data-heading\x3d"%s"]'.format(c));n.length||(n=this.makeHeadingContainer(c),e.append(n));
n.find(".filter-content").append(f)}else this.options.reverseOptionOrder?e.prepend(f):(f.insertAfter(l),e.append(f));else f.insertBefore(l.element);b=this.makeFilterOption(f,b,a,c);d[a]=b;b.element.on("mouseenter",this.publishHoverState.bind(this,!0,{item:b.options.name}));b.element.on("mouseleave",this.publishHoverState.bind(this,!1,{item:b.options.name}))},addFilterItem:function(a,b,c,d){this.addOptionToFilterMap(a,b,c,this.getRenderedFilterOptions(),d)},makeFilterOption:function(a,b,c,d,f){var e=
this;return new k.common.results.filters.ValueSetFilterItem(a,g.extend(!0,{},{state:b,name:c,group:this.name,cssClass:this.options.extraCssClass+" "+this.options.featureClass+(f&&f.cssClass?" "+f.cssClass:""),onUserChange:function(){e.filterItemDidChange.apply(e,Array.prototype.slice.call(arguments).concat(this))},heading:d,headingOnlyState:this.options.confineOnlyToHeading?1:2,countEnabled:this.options.countEnabled,allowZeroCount:this.options.allowZeroCount,disableOnZeroCount:this.options.disableOnZeroCount,
resetOnDynamicIconClick:this.options.resetOnDynamicIconClick,messages:this.options.messages,tooltipText:this.options.itemTooltipTextMap[c],enableActionLogging:this.options.logItemActions,enableActionTypeLogging:this.options.logActionType,usePluralDisplayValue:this.options.usePluralDisplayValue,allUncheckedMeansInactive:this.options.allUncheckedMeansInactive,openMapOnSelection:this.options.openMapOnSelection,inModal:this.options.inModal},f||{}))},makeHeading:function(a){var b=this,c=this.id()+"-"+
Math.floor(1E4*Math.random())+"-"+a.replace(/\W+/g,""),d=b.headingsDataMap&&b.headingsDataMap[a],c=k.template.renderElement(b.options.headingTemplateId,{id:c,heading:a,showOnly:b.options.showHeadingOnly,showCount:b.options.showHeadingCount,collapsedContent:b.options.collapsedContent,selectable:b.options.selectableHeadings,selected:d?b.headingsDataMap[a].selected:!1,description:d?b.headingsDataMap[a].description:"",count:d?b.headingsDataMap[a].count:"",useMcFlyStyling:this.options.useMcFlyStyling?
"mcfly-styling":"",featureClass:this.options.featureClass?this.options.featureClass.trim():""});this.renderedHeadings||(this.renderedHeadings={});this.renderedHeadings[a]=c;this.options.selectableHeadings&&(c.find(".HeadingCheckbox").checkbox({change:function(c){if(!g(c).hasClass("Disabled")){var d=g(c).find("input").is(":checked");k.Analytics.api.trackEvent({category:"filters",action:a,label:"click"});b.onHeadingClick(a,g(c).find("input").is(":checked"));b.pushStateChange(null,{changeData:{field:b.headingsDataMap[a].code+
"__ALL",value:d?1:0,displayValue:a}})}}}).getWidget().setChecked(d?b.headingsDataMap[a].selected:!1),this.options.showOnly&&this.registerEvent("click",c.find(".only"),this.onHeadingOnlyClick.bind(this,a,!1)));return c},onHeadingClick:function(a,b){var c=this;Object.keys(this.headingValueMap[a]).forEach(function(a){c.getRenderedFilterOptions()[a].setChecked(b?1:0)})},onHeadingOnlyClick:function(a,b){var c=this;Object.entries(this.renderedHeadings).forEach(function(b){var d=b[0]===a;b[1].find(".HeadingCheckbox").find("input").prop("checked",
d);c.onHeadingClick(b[0],d)});b||(k.Analytics.api.trackEvent({category:"filters",action:a,label:"only"}),this.pushStateChange())},makeHeadingContainer:function(a){var b;this.options.selectableHeadings?b=this.makeHeading(a):(b="\x3cdiv class\x3d'heading' data-heading\x3d\""+a+'"\x3e%s\x3c/div\x3e',a="\x3cdiv class\x3d'title'\x3e%s\x3c/div\x3e\x3cdiv class\x3d'filter-content'\x3e\x3c/div\x3e".format(a),b=g(b.format(a)));return b},shouldBeVisible:function(a){return(a=a.useHeadings?a.headingValueMap:
a.valueMap)&&0<Object.keys(a).length},logUserInteraction:function(a,b){if("ga"===this.options.loggingType){a=a.split("/");var c;a[0]&&(c="reset"===a[0]?"showall":a[0]);var d=this.getRenderedFilterOptions()[a[0]];a[1]&&"toggle"===a[1]&&d&&(a[1]=d.state.selected?"show":"hide");a[1]&&(c=(b?"":a[1]+"-")+c+(b?"-"+a[1]:""));this.base({category:this.trackCategory,action:this.name,label:c})}else this.base(a)},filterItemDidChange:function(a,b,c,d){var f={field:a,value:c&&c.state.selected,displayValue:c&&c.state.displayValue};
if(this.options.allUncheckedMeansInactive){var e=this.getRenderedFilterOptions();null==this.showAsNotChecked&&(this.showAsNotChecked=Object.keys(e).every(function(b){var c=0<e[b].state.selected;return b===a?!c:c}));this.showAsNotChecked?(k.events.publish("filters."+this.name+".showAsNotChecked",!1),this.showAsNotChecked=!1,e[a].setChecked(1),b="only"):0===Object.keys(e).filter(function(a){return 0<e[a].state.selected}).length&&(k.events.publish("filters."+this.name+".showAsNotChecked",!0),this.showAsNotChecked=
!0,this.forEachItem(function(a,b){b.setChecked(1)}),b="showall")}this.multisetOptions&&c&&Object.keys(this.multisetOptions).forEach(function(b){var c=this.multisetOptions[b],d=a===b,f=0<this.getRenderedFilterOptions()[b].getState();d?this.forEachItem(function(a,b){b.state.meta||(a=-1<c.indexOf(a),f?b.setChecked(a?1:0):a||b.setChecked(1))}):-1===c.indexOf(a)&&this.getRenderedFilterOptions()[b].setChecked(0)},this);"only"===b||"price"===b||"count"===b?(this.only=this.getRenderedFilterOptions()[a],this.forEachItem(function(b,
c){c.options.state.ignoreOnly||c&&b!==a&&(this.only.options.heading&&this.options.confineOnlyToHeading?this.only.options.heading===c.options.heading&&c.setChecked(0):c.setChecked(0))}),"price"===b&&k.events.publish("filters.selectedprice",{ignore:this.name})):this.only&&this.unsetOnlyOption(a);"function"===typeof this.options.onChange&&this.options.onChange.call(this,c);d||(this.setLastUserInteraction(!0),this.pushStateChange(null,{changeData:f}),this.updateFilterHistory(),this.options.logUserInteraction&&
(this.logUserInteraction("showall"===b?b:a+"/"+b),c&&c.state.filtered&&k.Analytics.api.trackEvent("filters/filteredItem/"+b)));c&&0!==c.getState()&&k.events.publish("gtm.update",{event:"resultsFilterChange",filterName:this.name,filterValue:a});this.options.reloadTop&&window.scrollTo(0,0)},unsetOnlyOption:function(a){a!==this.only.options.name?(this.only.setChecked(1),this.only=null):a===this.only.options.name&&2!==this.only.state.selected&&(this.only=null)},update:function(a){var b=this,c=!1,d=Object.keys(this.getRenderedFilterOptions()).length;
this.options.collapsedContent&&this.options.showDescription&&this.updateDescriptions(a);this.multisetOptions=a.multisetOptions;a.hasOwnProperty("headingsDataMap")&&(this.headingsDataMap=a.headingsDataMap);var f=g.extend(!0,{},a);if(f.useHeadings){this.headingValueMap=f.headingValueMap;for(var e=Object.keys(this.headingValueMap),m=0;m<e.length;m++){var h=e[m],h=this.updateItems(this.headingValueMap[h],h,f);c||(c=h)}if(f.orderedHeadings){var l=f.orderedHeadings;this.getOptionsContainer().find(".heading").sort(function(a,
b){return l.indexOf(g(a).data("heading"))>l.indexOf(g(b).data("heading"))?1:l.indexOf(g(a).data("heading"))<l.indexOf(g(b).data("heading"))?-1:0}).appendTo(this.getOptionsContainer())}this.options.selectableHeadings&&this.getOptionsContainer().find(".heading").each(function(c,d){var f=!1,e=!0;g(d).find("li").each(function(a,c){a=b.getRenderedFilterOptions()[g(c).data("name")];a.state.selected&&(f=!0);a.state.disabled||(e=!1)});c=g(d).find(".HeadingCheckbox");c.find("input").prop("checked",f);c.toggleClass("Disabled",
e);c.attr("aria-disabled",e);g(d).toggleClass("Disabled",e);c=g(d).data("heading");a.hasOwnProperty("headingsDataMap")&&a.headingsDataMap[c]&&g(d).find(".headingCount").text(a.headingsDataMap[c].count)});this.options.removeExpiredHeadingsWithOptions&&this.getOptionsContainer().find(".heading").each(function(a,c){(a=g(c).data("heading"))&&""!==a&&0>e.indexOf(a)&&(g(c).find("li").each(function(a,c){(a=g(c).data("name"))&&""!==a&&delete b.getRenderedFilterOptions()[a]}),g(c).remove())})}else c=this.updateItems(f.valueMap,
void 0,f);(this.options.sortInPlace||this.options.sortInPlaceLazy&&d!==Object.keys(this.getRenderedFilterOptions()).length)&&this.sortRenderedFilterOptions(f);this.element.hasClass("empty")&&c&&this.element.removeClass("empty");this.options.showAllNone&&this.updateShowAllNone(f.valueMap)},updateItems:function(a,b,c){if(!a)return!1;var d=this.updateMetaItems(a),f=this,e=Object.keys(d);a=0<e.length;var g=!1,e=e.sort(function(a,b){return d[a].displayOrder-d[b].displayOrder});this.options.disableOnNoPrice&&
e.forEach(function(a){a=d[a];a.minPrice||(a.disabled=1,a.selected=0)});this.options.displayDefaultUnchecked?(this.showAsNotChecked=this.allChecked(d))&&e.forEach(function(a){d[a].selected=0;d[a].showAllState=0}):this.options.allUncheckedMeansInactive&&null==this.showAsNotChecked&&(this.showAsNotChecked=this.allChecked(d))&&e.forEach(function(a){d[a].showAsNotChecked=!0});e.filter(function(a){return f.getRenderedFilterOptions().hasOwnProperty(a)}).forEach(function(a){var b=d[a];f.getRenderedFilterOptions()[a].update(b)});
var h={};e.length>this.options.overflowMinimum&&(h=this.getOverflowItems(e,d));e.forEach(function(a){var e=d[a];e.showAsNotChecked=f.showAsNotChecked;f.getRenderedFilterOptions().hasOwnProperty(a)||f.addFilterItem(a,e,b,{filtersData:c});h&&h[a]&&(0===e.selected||f.options.isDefaultChecked)?(f.getRenderedFilterOptions()[a].element.addClass("overflow-item").attr("aria-hidden",!0),g=!0):f.getRenderedFilterOptions()[a].element.removeClass("overflow-item").attr("aria-hidden",!1);2===e.selected&&(f.only=
f.getRenderedFilterOptions()[a])});this.options.preventNoneChecked&&this.disableOnlyOption();if(void 0!==this.showOverflowLink&&!this.element.hasClass("overflow-visible")){this.showOverflowLink.toggleClass("visible",g);this.showOverflowLink.attr("aria-pressed",function(a){return"false"===a?"true":"false"});if(g&&(this.options.showOverflowTemplate||this.options.hideOverflowTemplate)){var e={},l=Object.keys(h).length;this.options.showOverflowTemplate&&(e.more=k.Common.Utils.String.formatChoice(this.options.showOverflowTemplate,
l,l),this.overflowVisible||this.getChildElement("overflow-text").text(e.more));this.options.hideOverflowTemplate&&(e.less=k.Common.Utils.String.formatChoice(this.options.hideOverflowTemplate,l,l),this.overflowVisible&&this.getChildElement("overflow-text").text(e.less));Object.keys(e).length&&this.showOverflowLink.data(e)}this.options.collapsedContent&&(this.element.find(".heading").addClass("collapsed"),this.showOverflowLink.toggleClass("visible",!0))}this.handleExpiredOptions(d,b);return a},updateMetaItems:function(a){if(!a)return a;
var b=this,c=Object.keys(a),d={},f=function(b){return b&&a[b]&&a[b].meta};if(1>c.length||!c.some(f))return a;c.forEach(function(c){var e;f(c)&&g.isArray(b.options.includeExcludeItems)&&0<=b.options.includeExcludeItems.indexOf(c)&&(e=!0,b.includeExcludeRadios&&a[c].selected&&(b.includeExcludeRadios.setButtonCheckedByValue(c),b.metaState=b.metaState&&b.metaState===c?c:null));e||(d[c]=a[c])});return d},updatePlaceholderDisplay:function(a){this.options.isDropdown?this.base(a):a&&(this.getChildElement("placeholder").toggleClass("hidden",
!a.visible),this.getChildElement("options").toggleClass("hidden",!!a.visible))},updateDisplay:function(a){a&&a.hasOwnProperty("visible")&&this.element.toggleClass("programmatically-hidden",!a.visible)},updateDescriptions:function(a){var b=a.valueMap,c=a.descriptions;Object.keys(c).forEach(function(a){var d=b[a];null!=d&&(d.description=c[a])})},allChecked:function(a){var b=Object.keys(a),c=this.getIgnoreDeselect();return b.length?b.every(function(b){return 0<a[b].selected||0<a[b].disabled||c&&0<=c.indexOf(b)}):
null},anyChecked:function(a){var b=Object.keys(a),c=this.getIgnoreDeselect();return b.length?b.some(function(b){return 0<a[b].selected&&!a[b].disabled&&(!c||0>c.indexOf(b))}):null},getOverflowSorter:function(a){return this.options.sortOverflowByCount?function(b,c){b=a.hasOwnProperty(b)?a[b].count:0;return(a.hasOwnProperty(c)?a[c].count:0)-b}:null},getOverflowItems:function(a,b){var c=this;if(0<this.options.visibleCount){var d=a.filter(function(a){return-1===c.options.alwaysVisibleItems.indexOf(a)});
a=this.options.visibleCount-(a.length-d.length);var f=d;b=c.getOverflowSorter(b);"function"===typeof b&&(f=d.sort(b));var e={};f.slice(a).forEach(function(a){e[a]=a});return e}return null},handleExpiredOptions:function(a,b){this.forEachItem(function(c,d){a.hasOwnProperty(c)||d.options.heading!==b||(this.options.removeExpiredOptions?(k.ComponentManager.remove(d.id()),delete this.getRenderedFilterOptions()[c]):d.setChecked(0))})},disableOnlyOption:function(){var a=this.getRenderedFilterOptions();if("object"===
typeof a&&0!==a.length){var b=Object.keys(a),c=b.filter(function(b){return 0<a[b].getState()});b.forEach(function(b){a[b].setSelectable(!0)});1===c.length?a[c[0]].setSelectable(!1):0===c.length&&this.log.console("ValueSetFilter#DisableOnlyOption: No filter options checked while preventNoneChecked is true. \nFilter name: "+this.options.name)}},setCheckedItems:function(a){this.forEachItem(function(b,c){0<=a.items.indexOf(b)?c.setChecked(1):c.setChecked(0)});this.pushStateChange()},setStateFromPrevious:function(a){var b=
this.getRenderedFilterOptions()[a.key];if(b)if(a.reset)2===b.getState()?this.reset({silent:!0}):b.setChecked(void 0!==b.state.resetState?b.state.resetState:this.resetState);else{if(a.hasOwnProperty("value")){var c=parseInt(a.value,10);b.setChecked(c);this.filterItemDidChange(a.key,2===c?"only":null,b,!0)}}else this.options.selectableHeadings&&a.key&&a.key.endsWith("__ALL")&&this.setHeadingFromPrevious(a)},setHeadingFromPrevious:function(a){var b=parseInt(a.value,10),c=this.getHeadingForCode(a.key.replace("__ALL",
""));if(2===b)this.onHeadingOnlyClick(c,!a.reset);else a.reset&&(b=0===b?1:0),this.onHeadingClick(c,0<b)},getHeadingForCode:function(a){for(var b=Object.keys(this.headingsDataMap),c,d=0;d<b.length;d++)if(this.headingsDataMap[b[d]].code===a){c=b[d];break}return c},updatePreviousFilters:function(a){a?Object.keys(this.previousFilters).forEach(function(b){var c=parseInt(this.previousFilters[b],10);if(a&&a.hasOwnProperty(b)){var d=a[b];d===c||2===d&&0<c||this.removePreviousFilter(b)}else this.options.selectableHeadings&&
b.endsWith("__ALL")&&this.updatePreviousFilterHeading(b,a)},this):this.removePreviousFilter()},updatePreviousFilterHeading:function(a,b){var c=b[a],d=this.getHeadingForCode(a.replace("__ALL","")),f=[];Object.entries(this.headingValueMap).forEach(function(a){var e=a[0];a=Object.keys(a[1]).filter(function(a){return void 0!==b[a]});if(2>c||e!==d)f=f.concat(a)});var e=!1;(e=2===c||0===c?f.some(function(a){return 1===b[a]}):f.some(function(a){return 0===b[a]}))&&this.removePreviousFilter(a)},setUnCheckedItems:function(a){this.forEachItem(function(b,
c){0<=a.items.indexOf(b)?c.setChecked(0):c.setChecked(1)});this.pushStateChange()},onItemHover:function(a){if(!a.hasOwnProperty("namespace")||a.namespace===this._namespace){var b=this.renderedFilterOptions[a.item],c=(k.question.ask("hotels.results.filtersPinned")||!1)&&!this.options.inModal;if(this.options.showTooltipForEllipsed&&!0===a.hover){var d=b.element.find("label");if(d.length&&d[0].offsetWidth>=d[0].scrollWidth)return}!0===a.hover?b.element.toolTip({content:b.options.state.displayValue,position:c?
"bottom":"top",showImmediately:!0,delay:this.options.tooltipHoverDelay}):!1===a.hover&&b.element.data("toolTip")&&b.element.data("toolTip").removeWidget()}},showOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").addClass("overflow-visible").attr("aria-expanded",!0),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!1)):(this.element.addClass("overflow-visible").attr("aria-expanded",!0),this.element.find(".overflow-item").attr("aria-hidden",
!1));this.getChildElement("overflow").attr("aria-pressed",!0);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("less"));if(this.options.collapsedContent){var b=document.documentElement.scrollTop||document.body.scrollTop;this.element.find(".heading").removeClass("collapsed");this.element.find(".heading").addClass("expanded");document.documentElement.scrollTop=b}this.overflowVisible=!0;a&&this.logUserInteraction("overflow/showmore",!0);k.events.publish("filter.overflow.toggle")},
hideOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").removeClass("overflow-visible").attr("aria-expanded",!1),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!0)):(this.element.removeClass("overflow-visible").attr("aria-expanded",!1),this.element.find(".overflow-item").attr("aria-hidden",!0));this.showOverflowLink.attr("aria-pressed",!1);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("more"));if(this.options.collapsedContent){var b=
document.documentElement.scrollTop||document.body.scrollTop;this.element.find(".heading").addClass("collapsed");this.element.find(".heading").removeClass("expanded");document.documentElement.scrollTop=b}this.overflowVisible=!1;a&&this.logUserInteraction("overflow/showless",!0);k.events.publish("filter.overflow.toggle")},forEachItem:function(a,b){var c=this,d=b||this.getRenderedFilterOptions();Object.keys(d).forEach(function(b){a.call(c,b,d[b])},this)},getRenderedFilterOptions:function(){return this.renderedFilterOptions},
getOptionsContainer:function(){return this.content},getState:function(){var a={};this.metaState&&(a[this.metaState]=1);this.options.discrete&&(a.discrete=!0);this.forEachItem(function(b,c){var d=c.getState();null!==d&&(a[c.state.code||b]=d)},g.extend({},this.getRenderedFilterOptions()));this.options.onGetState&&(a=this.options.onGetState.call(this,a));return a},getHistoryFilterViewState:function(a){var b={};this.forEachItem(function(a,c){var d=c.getState();b[c.state.code||a]=d},g.extend({},this.getRenderedFilterOptions()));
var c=this.showCheckedFilterHistory()?"1":"0",d={},f=null,e=Object.keys(a).filter(function(b){b=a[b];if(g.isArray(b)){if(b.filter(function(a){return 2===parseInt(a,10)}).length)return!0}else return 2===parseInt(b,10);return!1}),e=e.length?e[0]:null,k=Object.keys(a).filter(function(a){return b.hasOwnProperty(a)}),h=function(a,c){var d=b[a],f={},e=null;g.isArray(d)?(f[a]=[],d.forEach(function(b){b===c?null===e&&(e=!0):e=!1;f[a].push(c)})):(e=c===d,f[a]=c);return{state:f,isAlreadyApplied:e}};return e?
b.hasOwnProperty(e)?g.extend({},h(e,"2"),{only:e}):{disabled:!0}:k.length?(k.forEach(function(a){var b=h(a,c);d[a]=b.state[a];b.isAlreadyApplied?null===f&&(f=b.isAlreadyApplied):f=!1}),{state:d,isAlreadyApplied:f}):{disabled:!0}},getStateForFilterHistory:function(){var a={},b=this;this.forEachItem(function(b,d){var c=d.getState();null!==c&&(a[d.state.code||b]=c)},g.extend({},this.getRenderedFilterOptions()));return g.extend({},{displayName:this.options.title,type:k.question.ask("filters.FilterHistory.type.checkbox"),
inclusive:this.showCheckedFilterHistory(),state:g.extend({},a),displayValue:Object.keys(a).reduce(function(a,d){a[d]=b.getFilterHistoryDisplayValue(d);return a},{})})},getFilterHistoryDisplayValue:function(a){var b=k.config.getBoolean("ui.horizon.filters.history.%s.show.code.only".format(this.name),!1),c=this.getRenderedFilterOptions();return c.hasOwnProperty(a)?b?c[a].state.code:c[a].state.displayValue:null},showCheckedFilterHistory:function(){return k.config.getBoolean("ui.horizon.filters.history.%s.show.checked.items".format(this.name),
!1)},trackStateChange:function(a){if(this.trackStateChangeEnabled(a)&&this.trackingType){var b=k.VestigoType,c=k.VestigoType.FilterType,d=k.VestigoEvents.filters,f=a.changeData.field,e=this.getTrackingAction(a.changeData.value),g="myfilters"===this.trackingType,h=g?{filtertype:this.trackingType}:{};switch(g?a.name:this.trackingType){case c.cabin:a=b.CabinType[f||"m"];d.flights.cabin(a,e,h);break;case c.sameair:d.flights.sameAirport(e,h);break;case c.alliance:a=b.AllianceType[f];d.flights.alliance(a,
e,h);break;case c.layoverair:d.flights.layOverAirport(f,e,h);break;case c.aircraft:a=b.AircraftType[f];d.flights.aircraft(a,e,h);break;case c.model:a=b.AircraftModelType[f];d.flights.model(a,e,h);break;case c.freebies:d.hotels.freebies(b.FreebieOption[f],e,h);break;case c.neighbourhood:d.hotels.neighbourhood(f,a.changeData.displayValue,e,h);break;case c.amenities:d.hotels.amenities(f,e,h);break;case c.style:d.hotels.style(f,e,h);break;case c.property:d.hotels.property(f,e,h);break;case c.other:d.hotels.other(b.PriceOption[f],
e,h);break;case c.provider:d.shared.provider(f,e,h);break;case c.airlines:d.flights.airlines(f,e,h);break;case c.roomtype:d.packages.roomtype(b.RoomType[f],e,h);break;case c.propertytype:d.packages.propertytype(f,e,h);break;case c.board:d.packages.board(b.BoardType[f],e,h);break;case c.stars:d.hotels.stars(f,e,h);break;case c.flightquality:(a=b.FlightQualityType[this.name])&&d.flights.flightquality(a,e,h);break;case c.transportation:d.flights.transportation(f,e,h);break;case c.flexoptions:d.flights.flexOption(e,
h)}}}})})(R9,jQuery);
(function(d,g){var h=/^(left|right)/,k=["stars","extendedrating"];d.createComponentClass("common.results.filters.PreviousFilters","common.results.filters.ValueSetFilter",{options:{removeItemTooltip:null},searchId:null,filtersData:{subs:{}},applyAllLink:null,init:function(){this.base();this.applyAllLink=this.getChildElement("applyAll")},addEventHandlers:function(){this.base();var a=this;this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("resultspage.streaming.firstResults",
this.fetchPreviousFilters.bind(this,!1));this.subscribe("resultspage.streaming.done",this.fetchPreviousFilters.bind(this,!0));this.subscribe("filters.changed",this.checkChangedFilters.bind(this));this.subscribe("filters.myfilters.removeFromPrevious",this.removeFromPrevious.bind(this));this.subscribe("resultspage.preservedFilters.removed",this.reset.bind(this,{silent:!0}))},update:function(a){var b=Object.keys(a),c=this.getRenderedFilterOptions();0<b.length&&(b.filter(function(a){return!c.hasOwnProperty(a)}).forEach(function(b){this.addFilterItem(b,
a[b])},this),this.forEachItem(function(a){0>b.indexOf(a)&&this.removeItem(a)}),this.updateVisibility())},reset:function(a){this.bulkManipulate(0,"reset",a&&a.silent)},removeFromPrevious:function(a){this.filtersData.hasOwnProperty(a.name)&&this.filtersData[a.name].forEach(function(b){a.key&&a.key!==b.key||b.item.setChecked(0)})},addFilterItem:function(a,b){this.base(a,b,void 0,{showRemoveIcon:!0,removeTitle:this.options.removeItemTooltip});b=this.parseFilterCode(a);var c=this.getRenderedFilterOptions()[a];
this.filtersData.hasOwnProperty(b.name)||(this.filtersData[b.name]=[]);this.filtersData[b.name].push({key:b.key,value:b.value,item:c});1===c.getState()&&(b.silent=!0,d.events.publish("filters."+b.name+".setFromPrevious",b));this.options.mirrorDisabled&&(this.filtersData.subs[a]=d.events.subscribe("filters."+b.name+"."+b.key+".state.disabled",function(a){1===c.getState()&&a||c.setDisabled(a)}))},fetchPreviousFilters:function(a){var b=this;d.action.execute("common/results/filters/PreviousFiltersUpdateAction",
{searchId:this.searchId,currentFilters:a?Object.keys(this.getRenderedFilterOptions()).join(","):void 0}).then(function(a){a.personalizedFilterValues&&b.update(a.personalizedFilterValues)})},parseFilterCode:function(a){a=a.split(";");return{name:a[0],key:a[1],value:a[2]}},filterDataChanged:function(){},filterItemDidChange:function(a,b,c){a=this.parseFilterCode(a);0===c.getState()&&(a.reset=!0);c.state&&c.state.displayValue&&(a.display=c.state.displayValue);d.events.publish("filters."+a.name+".setFromPrevious",
a);this.logUserInteraction("selectItem",a.name);this.updateVisibility();a.silent||this.trackFilterChange(a)},trackFilterChange:function(a){a.changeData={value:a.value,name:a.name,field:a.key,displayValue:a.display};this.trackStateChange(a)},makeFilterOption:function(a,b,c,e){return this.base(a,b,c,e,g.extend({},{showRemoveIcon:!0,onRemove:this.onRemoveItem.bind(this)}))},removeItem:function(a){var b=this.getRenderedFilterOptions()[a],c=this.parseFilterCode(a),e=b.options.group;d.ComponentManager.remove(b);
b.element.remove();this.filtersData.hasOwnProperty(e)&&(this.filtersData[e]=this.filtersData[e].filter(function(a){return a.key!==b.option.name}));this.options.mirrorDisabled&&this.filtersData.subs[a]&&d.events.unsubscribe("filters."+c.name+"."+c.key+".state.disabled",this.filtersData.subs[a]);delete this.getRenderedFilterOptions()[a]},onRemoveItem:function(a){var b=a.state.code,c=this.parseFilterCode(b);a=0===a.getState();d.events.publish("filters."+c.name+".setFromPrevious",{key:c.key,value:c.value,
reset:!0,silent:a});a?d.action.execute("common/results/filters/PreviousFiltersDeleteAction",{searchId:this.searchId,name:c.name,field:c.key,value:c.value}):this.trackFilterChange(c);this.removeItem(b);this.logUserInteraction("removeItem",c.name);this.updateVisibility()},updateVisibility:function(){var a=Object.keys(this.getRenderedFilterOptions()).length;if(a){(this.element.hasClass("empty")||this.element.hasClass("hidden"))&&this.logUserInteraction("impression");this.element.removeClass("empty hidden");
var b=0;this.forEachItem(function(a,c){0<c.getState()&&b++});var c=0<b;this.toggleResetLink(c);d.events.publish("filters.myfilters.dirty",{dirty:c});this.applyAllLink.length&&this.applyAllLink.toggleClass("hidden",c||1===a)}else this.element.addClass("empty hidden")},bulkManipulate:function(a,b,c){this.forEachItem(function(b,c){b=this.parseFilterCode(b);b.silent=!0;b.reset=0===a;d.events.publish("filters."+b.name+".setFromPrevious",b);c.setChecked(a)});c||(this.pushStateChange(),this.logUserInteraction(b));
this.updateVisibility()},applyAll:function(){this.bulkManipulate(1,"applyAll")},pushStateChange:function(){d.events.publish("filters.changed",{name:"myfilters"})},logUserInteraction:function(a,b){a={category:this.name,action:a};"undefined"!==typeof b&&(a.value=b);d.Analytics.api.trackEvent(a)},checkChangedFilters:function(a){var b=this.filtersData[a.name];if(b&&b.length&&!a.hasOwnProperty("previousFilterChange")){if(a.hasOwnProperty("changeData")){var c=a.changeData,d=b.filter(function(a){return c.field===
a.key});if(-1<k.indexOf(a.name))b.forEach(function(a){c.field==a.key?a.item.setChecked(c.value):a.item.setChecked(0)});else if(null!==c.field.match(h))d.forEach(function(a){0<a.item.getState()&&parseInt(c.value,10)!==parseInt(a.value,10)&&a.item.setChecked(0)});else{var f=parseInt(c.value,10);2===f?b.forEach(function(a){a.item.setChecked(a.key==c.field?1:0)}):d.forEach(function(a){a.item.setChecked(parseInt(a.value,10)===f)})}}else a.reset&&b.forEach(function(a){a.item.setChecked(0)});this.updateVisibility()}}})})(R9,
jQuery);
(function(c){c.createComponentClass("common.results.filters.FilteredLabel",{options:{targetFilters:null,filterRemovedMessage:"",filterAddedMessage:"",labelTiming:3E3,useFilterLabelCleared:0},clearq:[],addEventHandlers:function(){this.subscribe("filter.label.update",this.onLabelUpdate.bind(this));this.subscribe("filters.changed",this.onLabelClear.bind(this))},onLabelUpdate:function(a){if(this.isMyData(a)){var b=this,d=Math.abs(a.diff),e=c.Common.Utils.String.formatChoice(0>a.diff?this.options.filterRemovedMessage:
this.options.filterAddedMessage,d,d);c.dom.schedule(function(){c.dom.toggleOneClass(b.element,"visible",1);b.getChildElement("filteredLabel").addClass("show").text(e);b.clearq.push(a.name);b.clearLabelID=setTimeout(function(){b.clearLabelID=null;b.clearLabel()},b.options.labelTiming)})}},onLabelClear:function(a){this.isMyData(a)&&this.clearLabel()},isMyData:function(a){return!!(a&&a.name&&this.options.targetFilters&&this.options.targetFilters.indexOf&&0<=this.options.targetFilters.indexOf(a.name)&&
this.options.filterRemovedMessage&&this.options.filterAddedMessage)},clearLabel:function(){this.clearLabelID&&(clearTimeout(this.clearLabelID),this.clearLabelID=null);var a=this,b=this.getChildElement("filteredLabel");b.hasClass("show")&&(b.removeClass("show"),setTimeout(function(){c.dom.toggleOneClass(a.element,"visible",0);if(a.options.useFilterLabelCleared)for(var b=0;b<a.clearq.length;b++)c.events.publish("filter.label.cleared."+a.clearq[b],{name:a.clearq[b]});a.clearq=[]},400))}})})(R9);
(function(c){c.createComponentClass("flights.results.filters.StopsFilter","common.results.filters.ValueSetFilter",{addEventHandlers:function(){this.base();var b=this;this.answer("filters.stops.hasNonStop",function(){var a=b.getRenderedFilterOptions();return a.hasOwnProperty("0")&&!a["0"].state.disabled});c.config.getBoolean("ui.horizontal-filters.stickybar.enabled",!1)&&c.events.subscribe("common.results.filters.StopsFilterExposed.setfilter",this.updateExposedStops.bind(this));c.config.getBoolean("ui.filters.StopsFilterRadioSet.enabled",
!1)&&(b=this,c.events.subscribe("common.results.filters.StopsFilterRadioSet.setfilter",function(a){if(!1!==b.interactable){var d=b.getRenderedFilterOptions();a=a||"";-1<a.indexOf("uptoonestop")&&("undefined"!==typeof d[0].state.disabled&&!0===d[0].state.disabled?d[1].setChecked(2,"only"):(d[0].setChecked(1,"select"),d[1].setChecked(1,"select"),"undefined"!==typeof d[2]&&d[2].setChecked(0,"unselect")));-1<a.indexOf("direct")&&(d[0].setChecked(1,"only"),d[1].setChecked(0,!1),"undefined"!==typeof d[2]&&
d[2].setChecked(0,!1));-1<a.indexOf("any")&&c.events.publish("filter.reset",{name:"stops"})}}))},update:function(b){this.base(b);var a=!1;this.forEachItem(function(b,c){if("0"===b){if(1===c.state.selected||2===c.state.selected)a=!0}else if(1===c.state.selected||2===c.state.selected)a=!1},a);this.disableLayover(a);c.config.getBoolean("ui.horizontal-filters.stickybar.enabled",!1)&&c.events.publish("common.results.filters.StopsFilterExposed.state",this.makeDataFrom(b));c.events.publish("common.results.filters.StopsFilterRadioSet.state",
this.makeDataFrom(b))},disableLayover:function(b){c.events.publish("filter.disabled",{name:"layoverdur",disabled:b})},updateExposedStops:function(b){var a=this.getRenderedFilterOptions();"uptoonestop"===b&&("undefined"!==typeof a[0].state.disabled&&!0===a[0].state.disabled?a[1].setChecked(2,"only"):(a[0].setChecked(1,"select"),a[1].setChecked(1,"select"),"undefined"!==typeof a[2]&&a[2].setChecked(0,!1)),c.Analytics.api.trackEvent("filters/stops/exposed/uptoonestop"));"nonstop"===b&&(a[0].setChecked(1,
"only"),a[1].setChecked(0,!1),"undefined"!==typeof a[2]&&a[2].setChecked(0,!1),c.Analytics.api.trackEvent("filters/stops/exposed/nonstoponly"));"anystops"===b&&(a[0].setChecked(1,"select"),a[1].setChecked(1,"select"),"undefined"!==typeof a[2]&&a[2].setChecked(1,"select"),c.Analytics.api.trackEvent("filters/stops/exposed/anystops"))},makeDataFrom:function(b){var a={},c={},f={};this.forEachItem(function(d,e){a[d]=e.state.selected;c[d]="undefined"!==typeof b.valueMap[d].minPrice&&null!==b.valueMap[d].minPrice?
b.valueMap[d].minPrice:e.state.minPrice;f[d]=e.state.disabled});return{state:a,minPrice:c,disabled:f}},trackStateChange:function(b){this.trackStateChangeEnabled(b)&&c.VestigoEvents.filters.flights.stops(this.resolveVestigoOption(b.changeData.field),this.getTrackingAction(b.changeData.value))},resolveVestigoOption:function(b){var a=c.VestigoType.StopFilterOption.none;1==b&&(a=c.VestigoType.StopFilterOption.one);2==b&&(a=c.VestigoType.StopFilterOption.twoplus);return a}})})(R9);
(function(b,c){b.createWidgetClass("button.StyleJamButton",{options:{inactiveStlBlock:"",activeStlBlock:"",canPulse:!1,showFocusOutlines:!1,activeCssClass:""},init:function(){},addEventHandlers:function(){this.options.inactiveStlBlock&&this.options.activeStlBlock&&(this.subscribe("button.deactivate",{id:this.id()},this.toggleActivation.bind(this,!1)),this.subscribe("button.activate",{id:this.id()},this.toggleActivation.bind(this,!0)));this.options.canPulse&&(this.subscribe("button.pulse",{id:this.id()},
this.pulse.bind(this,!0)),this.subscribe("button.pulse.reset",{id:this.id()},this.pulse.bind(this,!1)));this.options.showFocusOutlines&&(this.element.on("focus",this.toggleFocus.bind(this,!0)),this.element.on("blur",this.toggleFocus.bind(this,!1)))},toggleFocus:function(a){a&&!document.body.classList.contains(this.options.activeCssClass)||this.swapClassesToggle(this.element,"Button--with-focus-outline","Button--no-focus-outline",a)},toggleActivation:function(a){this.swapClassesToggle(this.element,
this.options.inactiveStlBlock,this.options.activeStlBlock,!a)},pulse:function(a){this.swapClassesToggle(this.element,"","Button--pulse",!a)}})})(R9,jQuery);
(function(b){R9.extend("Widgets",{TextInput:function(a,c){this.elementNode=a;this.element=b(this.elementNode);this.validateElement()&&(this.options=b.extend({},this.options,c),this.init())}});R9.extend("Widgets.TextInput",{isTextInput:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"text"==a.type.toLowerCase()},isWidgetControlled:function(a){return"undefined"==typeof document.createElement("input").placeholder}});R9.extend("Widgets.TextInput.prototype",{widgetName:"textinput",
widgetBaseClass:"r9-textinput",widgetPlaceholderClass:"r9-textinput-placeholder-active",elementNode:null,element:null,options:{click:null,change:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("smartyfocus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindFormSubmission();this.element.data(this.widgetName,this);this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode)},validateElement:function(){return R9.Widgets.TextInput.isTextInput(this.elementNode)&&
R9.Widgets.TextInput.isWidgetControlled(this.elementNode)&&void 0===this.element.data(this.widgetName)},bindInputEvent:function(a,b){var c=this;a+="."+this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,a)})},bindFormSubmission:function(){var a=this,b="submit."+a.widgetName+a.element.attr("id"),d="form-pre-submit."+a.widgetName+a.element.attr("id");this.element.parents("form").off(b).on(b,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)});
this.element.parents("form").off(d).on(d,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)})},handleElementFocusEvent:function(a,c){a.disabled||(b(a).val()==b(a).attr("placeholder")&&this.clearPlaceholderText(b(a)),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,c){a.disabled||(0==b.trim(b(a).val()).length&&this.setPlaceholderText(a),this.options.blur&&this.options.blur.apply(this,arguments))},clearPlaceholderText:function(a){a.removeClass(this.widgetPlaceholderClass).val("")},
setPlaceholderText:function(a){b(a).addClass(this.widgetPlaceholderClass).val(b(a).attr("placeholder"))}})})(jq||jQuery);
(function(b){R9.createWidgetClass("text.StyleJamTextInput",b.extend({},R9.Widgets.TextInput.prototype,{widgetPlaceholderClass:"vs-placeholder",inputElement:null,inputState:null,options:{needsPlaceholderSupport:!1,selectOnFocus:!1,inputValidationEnabled:!1,presentationStates:{}},init:function(){this.inputElement=this.inputElement||this.element;this.elementNode=this.inputElement.get(0);this.options.inputValidationEnabled&&(this.inputState=this.getChildElement("inputState"),this.inputError=this.getChildElement("inputError"),
this.inputSuccess=this.getChildElement("inputSuccess"))},addEventHandlers:function(){var a=this;(this.options.needsPlaceholderSupport||this.options.presentationStates)&&this.bindInputEvent("focus",this.handleElementFocusEvent);this.options.needsPlaceholderSupport&&(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));if(this.options.selectOnFocus)a.inputElement.on("focus",
function(){a.inputElement.on("mouseup.a keyup.a",function(b){a.elementNode.setSelectionRange(0,9999);a.inputElement.off("mouseup.a keyup.a").select()})});this.options.inputValidationEnabled&&null!==this.inputState&&this.subscribe("input.validation",a.handleValidation.bind(this));this.options.presentationStates&&this.styleInvalidState()},getValue:function(){return b(this.inputElement).val()},handleElementFocusEvent:function(a,b){this.options.presentationStates&&this.styleInvalidState(!1);R9.Widgets.TextInput.prototype.handleElementFocusEvent.call(this,
a,b)},styleInvalidState:function(a){a?R9.dom.swapClasses(b(this.elementNode),this.options.presentationStates.regular,this.options.presentationStates.invalid):R9.dom.swapClasses(b(this.elementNode),this.options.presentationStates.invalid,this.options.presentationStates.regular)},handleValidation:function(a){a&&a.state&&a.inputEl===this.element.id()&&("error"===a.state&&this.swapClasses(this.inputError,"TextInput__State--hidden","TextInput__State--visible"),"success"===a.state&&this.swapClasses(this.inputSuccess,
"TextInput__State--hidden","TextInput__State--visible"))}}))})(jq||jQuery);
(function(c){R9.extend("Widgets",{NumberBox:function(b,a){this.inputNode=c(b).find("input")[0];this.jqNode=c(b);if(!this.isValidElement())return this;this.options=c.extend({},this.options,a);this.init()}});R9.extend("Widgets.NumberBox.prototype",{widgetName:"r9NumberBox",inputNode:null,jqNode:null,options:{min:0,max:6,defaultValue:0,callback:c.noop,validator:null,onlyDecorateDisabledButtons:!1},boxValue:0,incrButton:null,decrButton:null,styleJamButton:null,isValidElement:function(){return this.jqNode&&
this.jqNode.children().hasClass("incrementor")&&this.jqNode.children().hasClass("decrementor")&&this.jqNode.children().hasClass("numberHolder")},canChange:function(b){return"function"===typeof this.options.validator?this.options.validator.call(this,b,this.boxValue):!0},getStyleJamButton:function(){return R9.stylejam&&R9.stylejam.common&&R9.stylejam.common.widgets&&R9.stylejam.common.widgets.button?R9.stylejam.common.widgets.button.StyleJamButton:null},increment:function(){if(this.boxValue<this.options.max&&
this.canChange(1))return this.boxValue+=1,this.updateView(),this.options.callback.call(this,1,this.boxValue),!0;this.disableButton(this.incrButton);return!1},decrement:function(){if(this.boxValue>this.options.min&&this.canChange(-1))return--this.boxValue,this.updateView(),this.options.callback.call(this,-1,this.boxValue),!0;this.disableButton(this.decrButton);return!1},updateView:function(){c(this.inputNode).val(this.boxValue);c(this.inputNode).trigger("change");c(this.jqNode).attr("aria-valuenow",
this.boxValue);c(this.jqNode).attr("aria-valuemin",this.options.min).attr("aria-valuemax",this.options.max);this.boxValue===this.options.max?(this.enableButton(this.decrButton),this.disableButton(this.incrButton)):(this.boxValue===this.options.min?this.disableButton(this.decrButton):this.enableButton(this.decrButton),this.enableButton(this.incrButton));this.ariaLabel&&this.ariaLabel.length&&this.ariaLabelMessage&&this.updateAriaLabel()},updateAriaLabel:function(){this.ariaLabelUpdateId&&(window.clearTimeout(this.ariaLabelUpdateId),
this.ariaLabelUpdateId=null);this.ariaLabelUpdateId=window.setTimeout(function(){var b;b=-1<this.ariaLabelMessage.indexOf("|")?R9.Common.Utils.String.formatChoice(this.ariaLabelMessage,this.boxValue,this.boxValue):R9.Common.Utils.String.formatString(this.ariaLabelMessage,this.boxValue);this.ariaLabel.html(b)}.bind(this),200)},getValue:function(){return this.boxValue},setValue:function(b,a){b=parseInt(b);if(isNaN(b)||this.boxValue===b)return!1;var c=b-this.boxValue;if(!a&&!this.canChange(c))return!1;
this.boxValue=b;this.updateView();this.options.callback&&this.options.callback.call(this,c);return!0},init:function(){this.styleJamButton=this.getStyleJamButton();this.boxValue=""!=this.inputNode.value?parseInt(this.inputNode.value,10):0;this.incrButton=this.jqNode.find(".incrementor");this.decrButton=this.jqNode.find(".decrementor");this.jqNode.data(this.widgetName,this);0<this.options.defaultValue?this.setValue(this.options.defaultValue):!isNaN(this.options.max)&&this.boxValue>this.options.max&&
(this.boxValue=this.options.max);c(this.inputNode).prop("readonly","readonly");this.inputNode.value=this.boxValue;var b=this;this.incrButton.unbind("click").click(function(a){b.increment();jq(b.jqNode).trigger("increment");return!1});this.decrButton.unbind("click").click(function(a){b.decrement();jq(b.jqNode).trigger("decrement");return!1});this.updateView()},enableButton:function(b){b.removeClass("NumberBox-disabled").prop("disabled",!1).attr("aria-disabled","false");this.styleJamButton&&R9.dom.swapClasses(b,
this.styleJamButton.plusMinusButtonDisabled,this.styleJamButton.plusMinusButtonEnabled)},disableButton:function(b){b.addClass("NumberBox-disabled");this.options.onlyDecorateDisabledButtons||b.prop("disabled",!0).attr("aria-disabled","true");this.styleJamButton&&R9.dom.swapClasses(b,this.styleJamButton.plusMinusButtonEnabled,this.styleJamButton.plusMinusButtonDisabled)},disableDecrement:function(){this.disableButton(this.decrButton)},enableDecrement:function(){this.enableButton(this.decrButton)},disableIncrement:function(){this.disableButton(this.incrButton)},
enableIncrement:function(){this.enableButton(this.incrButton)}})})(jq||jQuery);
(function(c,b){c.createWidgetClass("number.StyleJamNumberBox",b.extend({},c.Widgets.NumberBox.prototype,{init:function(a,c){this.styleJamButton=this.getStyleJamButton();this.inputNode=b(a).find("input")[0];this.jqNode=b(a);this.styleJamButton&&this.jqNode.data("presentation")&&(a=this.jqNode.data("presentation"),this.styleJamButton.hasOwnProperty(a)&&(this.styleJamButton=this.styleJamButton[a]));if(!this.isValidElement())return this;this.inputNode&&(this.boxValue=""!==this.inputNode.value?parseInt(this.inputNode.value,
10):0);this.incrButton=this.jqNode.find(".incrementor-js");this.decrButton=this.jqNode.find(".decrementor-js");this.ariaLabel=this.getChildElement("ariaLabel");this.ariaLabelMessage=this.ariaLabel.data("msg");this.ariaLabel.attr("data-msg",null);0<this.options.defaultValue&&0===this.boxValue&&this.setValue(this.options.defaultValue,!0);this.options.withConstant&&(this.options=b.extend({withConstant:!1,descriptionWords:[]},this.options,c),this.index=0,this.countWord=this.jqNode.find(".count-word-js"),
this.options.min=0,this.options.max=this.options.descriptionWords.length-1,this.updateConstantValue(0));b(this.inputNode).prop("readonly","readonly");this.updateView()},isValidElement:function(){return!0},canChange:function(a){return"function"===typeof this.options.validator?this.options.validator.call(this,a,this.boxValue):!0},addEventHandlers:function(a){var d=this;this.incrButton.unbind("click").click(function(a){d.options.withConstant?(d.updateConstantValue(1),d.options.callback.call(d)):d.increment();
jq(d.jqNode).trigger("increment");c.globals.keyboardNav||b(this).blur();return!1});this.decrButton.unbind("click").click(function(a){d.options.withConstant?(d.updateConstantValue(-1),d.options.callback.call(d)):d.decrement();jq(d.jqNode).trigger("decrement");c.globals.keyboardNav||b(this).blur();return!1});this.element.keyup(function(a){if(a.altKey||a.ctrlKey||a.shiftKey)return!0;switch(a.keyCode){case c.globals.keyCodes.DOWN:case c.globals.keyCodes.LEFT:case c.globals.keyCodes.PAGE_DOWN:return d.decrement(),
jq(d.jqNode).trigger("decrement"),a.preventDefault(),a.stopPropagation(),!1;case c.globals.keyCodes.UP:case c.globals.keyCodes.RIGHT:case c.globals.keyCodes.PAGE_UP:return d.increment(),jq(d.jqNode).trigger("increment"),a.preventDefault(),a.stopPropagation(),!1}});this.element.on("keydown",function(a){if(a.altKey||a.ctrlKey||a.shiftKey)return!0;switch(a.keyCode){case c.globals.keyCodes.PAGE_UP:case c.globals.keyCodes.PAGE_DOWN:case c.globals.keyCodes.HOME:case c.globals.keyCodes.END:case c.globals.keyCodes.LEFT:case c.globals.keyCodes.UP:case c.globals.keyCodes.RIGHT:case c.globals.keyCodes.DOWN:return a.preventDefault(),
a.stopPropagation(),!1}});this.options.showFocusOutlines&&(this.element.on("focus",this.toggleFocus.bind(this,!0)),this.element.on("blur",this.toggleFocus.bind(this,!1)))},toggleFocus:function(a){a&&!document.body.classList.contains(this.options.activeCssClass)||this.swapClassesToggle(this.element,"TravelerDropdown__NumberBox","TravelerDropdown__NumberBox--focus",a)},setValue:function(a,b){a=parseInt(a);if(isNaN(a)||this.boxValue===a)return!1;var c=this.boxValue>a?0===a?a:this.boxValue-a:a-this.boxValue;
if(b||this.canChange(c))this.boxValue=a,this.updateView(),this.options.callback&&!b&&this.options.callback.call(this,c)},getIndex:function(){return this.index},setIndex:function(a,b){a=parseInt(a);if(isNaN(a)||this.index===a)return!1;a-=this.index;b&&(this.updateConstantValue(a),this.options.callback&&!b&&this.options.callback.call(this,a))},updateConstantValue:function(a){a=this.index+a;0<=a&&a<this.options.descriptionWords.length&&(this.index=a,this.countWord.text(this.options.descriptionWords[this.index]));
this.index===this.options.max?(this.enableButton(this.decrButton),this.disableButton(this.incrButton)):(this.index===this.options.min?this.disableButton(this.decrButton):this.enableButton(this.decrButton),this.enableButton(this.incrButton))}}))})(window.R9,window.jQuery);
(function(f,d){var m=f.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");f.createWidgetClass("dropdown.DropdownDialog",{element:null,elementNode:null,content:null,placeholder:null,label:null,value:null,icon:null,isOpen:!1,leftOffset:0,ajaxLoadFailed:!1,eventSuffix:null,openDisabled:!1,subValue:null,animationDuration:200,changePosition:!1,positionCss:{},rtlAlignment:void 0,options:{autoOpen:!1,alignment:null,calculateAlignment:!0,direction:"down",isPopover:!1,showIcon:!0,
matchWidth:!1,isFixedWidth:!1,repositionWithStyle:!1,scrollOffset:157,fixedPositionOffset:45,loadWithAjaxOnInit:!1,ajaxUrl:"",ajaxData:{},iconClass:"",contentClass:"",triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:"",topOffset:0,leftOffset:0,removeZIndex:!1,flippable:!0,delayShowDropdown:d.noop,showDropdownDelay:200,hasSubValue:!1,animateClose:null,expandTo:null,forceTriggerWidth:!1,useCover:!1,closeEvent:null,stopClickPropagation:!1,checkIsOutsideScreen:!1,
tooltipIcon:"",tooltipText:"",showModalBp:-1,rotateArrow:!1},init:function(){!this.options.alignment&&this.element&&this.element.data("alignment")&&(this.options.alignment=this.element.data("alignment"));!this.options.expandTo&&this.element&&this.element.data("expandto")&&(this.options.expandTo=this.element.data("expandto"));this.options.alignment||(this.options.alignment="left");this.eventSuffix=".DropdownDialog."+this.id();this.options.autoOpen&&this.open();if(this.options.onInit)this.options.onInit(this);
this.createContent();this.elementNode=this.element[0];this.createTrigger();this.popoverArrow=this.getChildElement("popover-arrow");this.options.loadWithAjaxOnInit&&this.options.ajaxUrl&&this.loadAjax();this.options.alignment||(this.options.alignment="left");this.options.useCover&&(this.cover=this.getChildElement("cover"),this.coverInner=this.getChildElement("cover-inner"));if(this.options.tooltipIcon){var a=this.getChildElement("tooltip");a.toolTip({content:a.data("message"),extraClass:"halfWidth"})}},
closeOnBodyClick:function(a){this.isOpen&&(!this.content||!this.content[0]||this.content[0]!==a.target&&1>this.content.find(a.target).length)&&(this.close(),f.events.publish("DropdownDialog.clickOutsideClose",{id:this.id()}))},changeDropdownPosition:function(a){this.id()===a.id&&(this.changePosition=a.changePosition,this.positionCss=a.positionCss)},addEventHandlers:function(){var a=this,b;b=this.options.triggerClass?d("."+a.options.triggerClass):d(a.element);f.globals.testMode&&b.attr("data-test-popover-trigger",
"");this.closeOnBodyClick=this.closeOnBodyClick.bind(this);this.handleToggleContent=this.handleToggleContent.bind(this);var c=["authentication.showLogin","trips.menu.open","afterclick.dialog.opened","common.dropdown.closeAll"];this.options.closeEvent&&c.push(this.options.closeEvent);this.subscribe(c,this.close.bind(this,null,!0));this.subscribe("travelers.dropdown.change.position",this.changeDropdownPosition.bind(this));var c="click.dialog"+this.eventSuffix,e=d("body");this.registerEvent("click"+
this.eventSuffix,b,this.handleToggleContent);if(this.isOpen)e.on(c,this.closeOnBodyClick);this.registerEvent("keydown",function(b){var c=f.globals.keyCodes,e=!1;b.which===c.SPACE||b.which===c.RETURN||b.which===c.DOWN?(a.handleToggleContent(b),e=!0):b.which===c.UP&&(a.handleToggleContent(b,{focusLast:!0}),e=!0);e&&(b.preventDefault(),b.stopImmediatePropagation(),b.stopPropagation())});this.registerEvent("focus",function(){a.element.addClass("focus").addClass(m)});this.registerEvent("blur",function(){a.element.removeClass("focus").removeClass(m)})},
handleToggleContent:function(a,b){var c="click.dialog"+this.eventSuffix,e=d("body"),h=this;this.options.stopClickPropagation&&a.stopPropagation();e.off(c,this.closeOnBodyClick);this.toggleContent(b);h.isOpen&&setTimeout(function(){e.on(c,h.closeOnBodyClick)},10)},bindOpenDialogEvents:function(){var a=this;d(document).on("keydown"+this.eventSuffix,function(b){b.which===f.globals.keyCodes.ESC&&a.close(b,null,!0)});d(window).on("resize"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});d(document).on("scroll"+
this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});d(".viewport").on("scroll"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});var b=function(){a.element.is(":visible")&&(f.Common.Utils.Browsers.isIE(11)||setTimeout(function(){a.reposition(!0)},25))};this.registerEvent("click",this.content.find(".close"),this.close.bind(this));this.registerEvent("mouseup touchend",this.content,b);this.subscribe("horizon.dropdownDialog.reposition",b)},destroy:function(){this.base();this.removeOpenDialogEvents()},
removeOpenDialogEvents:function(){d(".viewport").off("scroll"+this.eventSuffix);d(window).off("resize"+this.eventSuffix);d(document).off("scroll"+this.eventSuffix).off("keydown"+this.eventSuffix);d(document.body).off("click"+this.eventSuffix).off("click.dialog"+this.eventSuffix)},createContent:function(){this.content=this.options.content?d(this.options.content):d("#"+this.element.attr("id")+"_content");this.options.isFixedWidth&&this.content.css("width",this.getTriggerWidth()+"px");this.content.hasClass("open")&&
(this.isOpen=!0)},createTrigger:function(){this.element.hasClass("open")&&(this.isOpen=!0);this.label=this.element.find(".label");this.label.length||(this.label=d("\x3cdiv\x3e",{"class":"label"}),this.element.prepend(this.label));this.placeholder=this.element.find(".placeholder");this.placeholder.length||(this.placeholder=d("\x3cdiv\x3e",{"class":"placeholder",text:this.options.placeholder}),this.element.append(this.placeholder));this.options.showIcon&&(this.icon=this.element.find(".icon"),this.icon.length||
(this.icon=d("\x3cdiv\x3e",{"class":"icon "+this.options.iconClass}),this.element.append(this.icon)));this.options.hasSubValue&&(this.value=this.label.find(".value"),this.value.length||(this.value=d("\x3cdiv\x3e",{"class":"value"}),this.label.prepend(this.value)),this.subValue=this.label.find(".subValue"),this.subValue.length||(this.subValue=d("\x3cdiv\x3e",{"class":"subValue"}),this.label.prepend(this.subValue)));if(this.options.text)this[this.options.hasSubValue?"updateValue":"updateLabel"](this.options.text);
else if(!this.options.hasSubValue){var a=this.label.html();a&&a.trim()&&this.updateLabel(a.trim())}},open:function(a){a=a||{};if(!this.openDisabled){this.isOpen=!0;var b;this.options.container&&(b=d(this.options.container));if(!b||1>b.length)b=d(f.config.getString("ui.horizon.output.container","body"));if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.open.bind(this),this.options.showDropdownDelay);
else{null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);this.options.rotateArrow&&this.icon.css("transform","rotate(-180deg)");this.bindOpenDialogEvents();this.options.isPopover&&this.popoverArrow.show();this.content.appendTo(b);if(this.options.onOpen)this.options.onOpen(this);this.repositionWithJS();this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!0);this.element.addClass("open");this.content.addClass("open");this.content.attr("aria-expanded",
!0);this.element.attr("aria-expanded",!0);this.content.data("owner",this.element.attr("id"));f.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);f.events.publish("DropdownDialog.open",{id:this.id()});this.toggleCover(!0);this.setupTabKeyHandling({focusLast:a.focusLast});this.styleForModal(!0);this.changePosition&&this.id()&&this.content.css({top:d(document).scrollTop()+this.positionCss.top+"px",left:this.positionCss.left+"px"});this.options.calculateAlignment||this.content.css({left:this.options.leftOffset})}}},
setupTabKeyHandling:function(a){a=a||{};var b=this,c=this.getFocusableElements();c.length&&(b.content.off("keydown","**"),setTimeout(function(){a.focusLast?d(c[c.length-1]).focus():d(c[0]).focus();b.content.on("mouseover","a, [tabindex]",function(){b.content.find(":focus").trigger("blur")});b.content.on("keydown",function(a){c=b.getFocusableElements();for(var e=-1,d=a.target,g=0;g<c.length;g++)c.get(g)===d&&(e=g);var d=0===e,g=c.length-1,l=e===g,k=!1;if(a.which===f.globals.keyCodes.TAB&&(1===c.length||
d&&a.shiftKey||l&&!a.shiftKey))b.toggleContent(),b.element.focus();else{switch(a.which){case f.globals.keyCodes.RETURN:a.stopPropagation();a.target.click();b.element.focus();break;case f.globals.keyCodes.DOWN:l?c.get(0).focus():c.get(e+1).focus();k=!0;break;case f.globals.keyCodes.UP:d?c.get(g).focus():c.get(e-1).focus();k=!0;break;case f.globals.keyCodes.HOME:c.get(0).focus();k=!0;break;case f.globals.keyCodes.END:c.get(g).focus(),k=!0}k&&(a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault())}})},
25))},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible, a[href]:visible").not("[tabindex\x3d-1],[disabled]")},_close:function(a,b,c){var e=this.isOpen,d=this;this.isOpen=!1;this.options.isPopover&&this.popoverArrow.hide();this.element.removeClass("open");this.content.removeClass("open");this.toggleCover(!1);d.element.after(d.content);c&&setTimeout(function(){d.element.focus()},1);if(this.options.onClose)this.options.onClose(e,this,a);f.events.publish("DropdownDialog.close",
{id:d.id(),silent:!!b});this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!1);this.content.attr("aria-expanded",!1);this.element.attr("aria-expanded",!1);f.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1);this.styleForModal(!1)},close:function(a,b,c){if(!c||"object"!==typeof c||c.avoidElementId!==this.id()){this.options.repositionWithStyle&&this.resetPosition();this.removeOpenDialogEvents();this.options.rotateArrow&&this.icon.css("transform","");
if(this.options.animateClose){var d=this;this.animateClose(function(){d._close(a,b,c)})}else this.isOpen&&this._close(a,b,c);null!=a&&a.stopPropagation()}},toggleContent:function(a){this.isOpen?this.close(null,null,!0):this.open(a)},updateLabel:function(a,b,c){b&&(a+=(c||"")+b);this.label.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},updateValue:function(a){a=a||"";this.value.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},
hasValue:function(){return this.element.hasClass("hasValue")},resetPosition:function(){this.content.css({position:"absolute"})},reposition:function(a){if(this.options.repositionWithStyle){var b;window.scrollY>this.options.scrollOffset?(b={position:"fixed",top:this.options.fixedPositionOffset+"px"},this.content.css(b),this.changePosition&&this.content.css({top:d(document).scrollTop()+this.positionCss.top+"px",left:this.positionCss.left+"px"})):(b={position:"absolute"},this.content.css(b),this.repositionWithJS(a))}else this.repositionWithJS(a)},
repositionForNonModal:function(){var a=this.showInModal();if(this.modalActive()&&a)return!1;this.styleForModal(a);return!a&&!this.modalActive()},repositionWithJS:function(a){if(this.repositionForNonModal()){this.rtlAlignment="rtl"!==document.dir||"left"!==this.options.alignment&&"right"!==this.options.alignment?void 0:"right"===this.options.alignment?"left":"right";var b=this.options.direction,c=this.rtlAlignment||this.options.alignment,e=this.element.offset(),h=d(this.options.container),f=this.options.expandTo?
d("#"+this.options.expandTo):d(),g=f.length&&f.is(":visible"),l=g?f.offset():null;a=a||!1;if(h.length)var k=h.offset(),e={top:e.top-k.top+h.scrollTop(),left:e.left-k.left};else h=d(window);k=e.top+this.element.outerHeight();0===this.element.width()&&0!==this.element.position().top&&(k+=window.scrollY);this.shouldFlipDirection(b)&&(b=this.getReversedDirection(b));this.shouldFlipAlignment(c)&&(c=this.getReversedDirection(c));this.updateAnimationClass(b,c);this.content.toggleClass("noAnimation",a);"up"===
b?(this.content.addClass("up"),k=e.top-this.content.outerHeight()):this.content.removeClass("up");if("left"===b||"right"===b)k="up"===this.options.alignment?e.top-this.element.outerHeight()/2:"down"===this.options.alignment?e.top-this.content.outerHeight()+this.element.outerHeight():e.top+this.element.outerHeight()/2-this.content.outerHeight()/2;a={top:Math.floor(k)+"px"};g?"right"===c?a.right=Math.floor(h.width()-f.width()-l.left)+"px":a.left=Math.floor(l.left)+"px":"left"===b?a.right=Math.floor(h.width()-
e.left)+"px":"right"===b?a.left=Math.floor(e.left+this.element.width())+"px":"right"===c||"window-center-desktop"===c?"window-center-desktop"==c&&768<=window.innerWidth?(a.right="",a.left=Math.floor(window.innerWidth/2-this.content.outerWidth()/2)+"px"):(a.left="",b=this.getTriggerWidth(),38>b&&!this.options.forceTriggerWidth&&(b=38),a.right=Math.floor(h.width()-(e.left+b))+"px"):a.left="center"===c?Math.floor(e.left-this.content.outerWidth()/2)+this.getTriggerWidth()/2+"px":"window-center"===c?Math.floor(window.innerWidth/
2-this.content.outerWidth()/2)+"px":Math.floor(e.left)+"px";this.options.topOffset&&0!==this.options.topOffset&&(a.marginTop=this.options.topOffset+"px");this.options.leftOffset&&0!==this.options.leftOffset&&(a.right?a.right=parseInt(a.right.replace("px",""))-this.options.leftOffset+"px":a.left&&(a.left=parseInt(a.left.replace("px",""))+this.options.leftOffset+"px"));this.leftOffset&&(a.marginLeft=this.leftOffset+"px");this.options.isPopover&&"right"===c&&(a.left=Math.floor(e.left+this.getTriggerWidth()+
22)+"px",a.top=Math.floor(k-45)+"px");c=this.options.isFixedWidth?"width":"minWidth";this.options.matchWidth?a[c]=this.getTriggerWidth()+"px":g?a[c]=f.outerWidth()+"px":a.minWidth="";this.options.removeZIndex||(a.zIndex=this.element.zIndex()+9999);this.options.checkIsOutsideScreen&&(f=this.content.outerWidth(),h=h.outerWidth(),g=!1,f>=h?g=!0:(c=parseInt(a.left,10),e=parseInt(a.right,10),c&&c+f>=h?g=!0:e&&e+f>=h&&(g=!0)),g&&(a.left="0px",a.right="auto",a.maxWidth=h+"px"));this.content.css(a);this.changePosition&&
this.content.css({top:d(document).scrollTop()+this.positionCss.top+"px",left:this.positionCss.left+"px"});this.options.calculateAlignment||this.content.css({left:this.options.leftOffset})}},styleForModal:function(a){a&&this.showInModal()?(this.content.css({top:0,left:0,right:0,maxWidth:"100%",minHeight:"100vh"}),this.content.addClass("modal"),this.content.toggleClass("noAnimation",!0),d("body").addClass("modal-open"),this.addedModalOpen=!0):this.addedModalOpen&&(this.addedModalOpen=!1,this.content.removeClass("modal"),
d("body").removeClass("modal-open"))},modalActive:function(){return this.content.hasClass("modal")},shouldFlipDirection:function(a){if(this.options.flippable){var b=d(window).scrollTop(),c=b+d(window).outerHeight(),e=this.content.outerHeight(),f=this.element.offset().top,c=f+this.element.outerHeight()+e>c,b=f-e<b;if("down"===a)return c&&!b;if("up"===a)return b&&!c}return!1},shouldFlipAlignment:function(a){if(this.options.flippable){var b=d(window).width(),c=this.content.width(),e=this.element.offset().left,
f=this.element.width(),f=0>=e+("left"===a?0:f)-c,b=e+("left"===a?c:0)>=b;if("left"===a)return!f&&b;if("right"===a)return f&&!b}return!1},getReversedDirection:function(a){switch(a){case "down":return"up";case "up":return"down";case "left":return"right";case "right":return"left";case "bottom":return"top";case "top":return"bottom";case "center":return"center"}return a},updateAnimationClass:function(a,b){a=this.getDirectionClass(a,b);this.content.hasClass(a)||this.content.removeClass(function(a,b){return(b.match(/\banimate-\S+/g)||
[]).join(" ")}).addClass(a).removeAttr("style")},getDirectionClass:function(a,b){var c;"left"===a||"right"===a?(c="down"===b?"top":"bottom",a="center"===a?"right":this.getReversedDirection(a)):(c="down"===a?"top":"bottom",a="center"===b?"right":b);return"animate-"+c+"-"+a},loadAjax:function(){var a=this;return f.ajax.execute(this.options.ajaxUrl,{data:this.options.ajaxData,customUpdate:function(b){b.innerHTML&&""!==b.innerHTML?a.content.html(b.innerHTML):(a.element.remove(),a.content.remove(),a.ajaxLoadFailed=
!0);return!0}})},getTriggerWidth:function(){var a=this.elementNode.getBoundingClientRect();return a?a.right-a.left:this.element.outerWidth()},animateClose:function(a){var b=this,c=this.content.attr("class");(c=c&&c.match(/\banimate-\S+/))&&c.length&&(this.content.removeClass(c[0]),window.setTimeout(function(){b.content.addClass(c[0]+" close-animation")},1),window.setTimeout(function(){a();b.content.removeClass("close-animation")},this.animationDuration))},toggleCover:function(a){this.options.useCover&&
(a?this.coverInner.css("transform","scale("+(this.cover.outerWidth()+2)/this.element.outerWidth()+", 1.333)"):this.coverInner.css("transform","scale(1)"))},showInModal:function(){return 0<this.options.showModalBp&&d(window).outerWidth()<this.options.showModalBp&&this.content.hasClass("open")}})})(window.R9,window.jQuery);
(function(d){R9.extend("Widgets",{RadiobuttonSet:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!b||b.dontValidate||this.validateElement())this.options=d.extend({},this.options,b),this.init()}});R9.extend("Widgets.RadiobuttonSet",{isRadiobuttonSet:function(a){return a&&a.nodeName&&"span"===a.nodeName.toLowerCase()},isWidgetControlled:function(a){return d(a).hasClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass)},findLabelNode:function(a){return document.getElementById(a.id+
"-label")},findRadiobuttonSetNode:function(a){return null!=a?a.parentNode:null},refresh:function(a){var b=!1;a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).each(function(){var a=d(R9.Widgets.RadiobuttonSet.findLabelNode(this)),e=d(this);e.prop("checked")?(b=!0,a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked")):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked");e.prop("disabled")?a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+
"-label-disabled"):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-disabled")});b||(a=a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).first(),a.prop("checked",!0),d(R9.Widgets.RadiobuttonSet.findLabelNode(a[0])).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked"))},applyCallback:function(a,b,c,e){a&&(d.isFunction(a)?a.apply(b,c):(a=a[e.target.value],d.isFunction(a)&&a.apply(b,c)))}});R9.extend("Widgets.RadiobuttonSet.prototype",
{widgetName:"radiobuttonset",widgetBaseClass:"r9-radiobuttonset",elementNode:null,element:null,options:{change:null,click:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.handleElementClickEvent);this.element.data(this.widgetName,this);R9.Widgets.RadiobuttonSet.refresh(this.element)},bindInputEvent:function(a,b){var c="input."+
this.widgetBaseClass;a+="."+this.widgetName;var d=this;this.element.off(a,c).on(a,c,function(a){b.call(d,this,R9.Widgets.RadiobuttonSet.findLabelNode(this),a)})},validateElement:function(){return R9.Widgets.RadiobuttonSet.isRadiobuttonSet(this.elementNode)&&R9.Widgets.RadiobuttonSet.isWidgetControlled(this.element)&&void 0===this.element.data(this.widgetName)},handleElementFocusEvent:function(a,b,c){a.disabled||d(b).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementBlurEvent:function(a,
b,c){a.disabled||d(b).removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementChangeEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.change,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))},handleElementClickEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.click,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))}})})(jq||jQuery);
(function(d){R9.createWidgetClass("radio.RadioButtonSet",d.extend({},R9.Widgets.RadiobuttonSet.prototype,{currentRadio:null,isTabList:!1,init:function(a){setTimeout(this.refresh.bind(this),1);this.currentRadio=this._getButtons().filter(":checked").next("label");this.isTabList="tablist"===this.getChildElement("set").attr("role")},refresh:function(){R9.Widgets.RadiobuttonSet.refresh(this.element);var a=this.getEnabledRadios().filter("[aria-checked\x3dtrue]");a.length&&this.element.attr("aria-activedescendant",
a.attr("id"));this.focusRadio();this.isTabList&&window.setTimeout(function(){var a=this.getCheckedButton();this._getButtons().attr("aria-selected",!1);a.attr("aria-selected",!0);this._setActiveTabPanel(a)}.bind(this),1)},addEventHandlers:function(a){this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.onClick);this.element.on("focus",this.onFocus.bind(this));this.element.on("blur",this.onBlur.bind(this));this.element.on("keydown",this.onKeyDown.bind(this))},
onClick:function(a,b,c){this.handleElementClickEvent(a,b,c);this.isTabList&&this._getButtons().each(function(b,c){a===c&&this._setButtonCheckedById(c.id)}.bind(this));this.focusRadio()},focusRadio:function(a){a&&a.length||(a=this._getButtons().filter(":checked").next("label:visible"));a.length&&(this.element.attr("aria-activedescendant",a.attr("id")),this.getEnabledRadios().removeClass("focus").attr("aria-checked",!1),a.addClass("focus"),a.attr("aria-checked","false"!==a.attr("aria-checked")),this.currentRadio=
a)},getEnabledRadios:function(){return this.element.find("label:visible")},focusButtonSet:function(){this.getChildElement("set").focus()},onFocus:function(){var a=this.element.attr("aria-activedescendant");"undefined"===typeof a&&0<this.getEnabledRadios().length&&(a=this.getEnabledRadios().get(0).id);a&&this.focusRadio(d("#"+a));this.element.addClass("focused")},onBlur:function(){this.element.removeClass("focused")},onKeyDown:function(a){switch(a.which){case R9.globals.keyCodes.SPACE:this.checkCurrentRadio();
break;case R9.globals.keyCodes.UP:case R9.globals.keyCodes.LEFT:this.focusPreviousRadio();break;case R9.globals.keyCodes.DOWN:case R9.globals.keyCodes.RIGHT:this.focusNextRadio();break;default:return!0}return!1},checkCurrentRadio:function(){this.currentRadio&&this.checkRadio(this.currentRadio)},focusPreviousRadio:function(){var a=this.currentRadio.prevAll("label:visible"),b=this.getEnabledRadios(),a=a.length?d(a.get(0)):d(b.get(b.length-1));this.checkRadio(a)},focusNextRadio:function(){var a=this.currentRadio.nextAll("label:visible"),
a=a.length?d(a.get(0)):d(this.getEnabledRadios().get(0));this.checkRadio(a)},checkRadio:function(a){a.click();this.currentRadio.attr("aria-checked",!1);this.focusRadio(a);this.currentRadio.attr("aria-checked",!0)},getCheckedButton:function(){var a=this._getButtons().get(0);this._getButtons().get().some(function(b){if(!0===d(b).prop("checked"))return a=b,!0});return d(a)},getCheckedPair:function(){var a=this.getCheckedButton();return{value:a.val(),title:a.next("label").attr("title")}},getValue:function(){return this.getCheckedButton().val()},
setValue:function(a){this._setButtonCheckedById(a)},setButtonCheckedByValue:function(a){this._setButtonChecked(function(b){return b.val()===a})},setButtonEnabledByValue:function(a,b){this._setButtonEnabled(function(b){return b.val()===a},b)},setButtonLabelByValue:function(a,b){this._getButtonByValue(a).next("label").find(".label-text").text(b)},_setButtonCheckedById:function(a){this._setButtonChecked(function(b){return b.attr("id")===a})},_setButtonEnabledById:function(a,b){this._setButtonEnabled(function(b){return b.attr("id")===
a},b)},_setButtonChecked:function(a){this._getButtons().each(function(b,c){b=d(c);c=!!a(b);b.prop("checked",c);b.attr("aria-checked",c)});this.refresh()},_setButtonEnabled:function(a,b){this._getButtons().each(function(){var c=d(this);!0===a(c)&&(c.prop("disabled",!1===b),c.attr("aria-disabled",!1===b))});this.refresh()},_setActiveTabPanel:function(a){a=d("[id\x3d'%s']".format(a.attr("aria-controls")));a.length&&(this._getButtons().get().reduce(function(a,c){c=d(c).attr("aria-controls");return a.add(d("[id\x3d'%s']".format(c)))},
d()).attr("aria-expanded",!1),a.attr("aria-expanded",!0))},_getButtons:function(){return this.element.find("input."+this.widgetBaseClass)},_getButtonByValue:function(a){return this._getButtons().filter("[value\x3d'"+a+"']")}}))})(jQuery);
(function(b,c){b.createComponentClass("flights.results.filters.PaymentMethodsDropdown","flights.results.filters.PaymentFeesFilter",{defaultMethods:null,showSaveDialogDelay:0,options:{onlyNumber:!1,providerShortNames:null,explicitHeader:!1,defaultMethodList:null,trackingEnabled:!1,inline:!1},init:function(){this.base();this.title=this.getChildElement("dialog");this.defaultMethods=this.options.defaultMethods.split(",")},addEventHandlers:function(){this.base();var a=this;a.options.inline&&this.getChildElement("apply-selection").click(function(){a.applyMethodSelection()});
this.saveMethodsPopover.length&&(this.saveMethodsPopover=this.saveMethodsPopover.detach().children().eq(0),c("body").delegate(".PaymentMethods-saveTooltip button","click",function(){b.Analytics.api.trackEvent("filter/paymentfees/makePermanentSelected");b.events.publish("common.widgets.tooltip.closeAll");b.authentication.showSignup({promo:"pfc",promoType:"whisky",success:function(){b.authentication.cached_dialog.dialog.close();a.saveMethodsPopover.remove();a.saveMethodsPopover=c();a.savePaymentMethods().done(function(){b.Analytics.api.trackEvent({subPageId:"filters",
category:"paymentMethods",action:"change"});window.location.reload()}).fail(function(){a.log.error("Save payment method failed")})}})}))},getDialogProperties:function(){var a=this.base()||{};return c.extend(a,{container:"#"+this.id("pfc-dropdown")})},addLinkClicked:function(a){var b=this;b.options.inline||(a.name===this.name?b.scrollToDropdown().then(function(){b.methodsDialog.open()}):this.methodsDialog.close())},scrollToDropdown:function(){var a=this.methodsDialog.options.flippable;this.methodsDialog.setOption("flippable",
!1);var b=c.Deferred(),f=c(window).height(),d=c(window).scrollTop(),e=this.element.offset().top,g=e+this.element.outerHeight()+this.methodsDialog.content.height();e<d+100||g>d+f-100?(f=g>f-100?g-f/2:0,c("html, body").animate({scrollTop:f},"slow",function(){b.resolve()})):b.resolve();this.methodsDialog.setOption("flippable",a);return b.promise()},setLabelText:function(a,c){var f=this,d=f.options;if(d.inline)a&&"none"!==a&&!this.suspendState&&this.title.hide();else{var e=a?a.split(",").filter(function(a){return"none"!==
a}):[];a=e.length;if((e=e.length===this.defaultMethods.length&&!e.filter(function(a){return 0>f.defaultMethods.indexOf(a)}).length)&&d.explicitHeader)c=b.Common.Utils.String.formatString(d.verboseHeaderString,d.defaultMethodList);else{var g=a,h=e?0:a;1===a&&d.singleMethodVerbose&&(g=c,h=1);c=b.Common.Utils.String.formatChoice(d.headerString,h,g)}d.onlyNumber&&(c=e?b.Common.Utils.String.formatChoice(d.headerString,0,0):b.Common.Utils.String.formatString(d.verboseHeaderString,a));a=this.getChildElement("dialog");
a.find(".label").text(c);a.hasClass("iconOnly")&&c&&a.removeClass("iconOnly").addClass("hasValue");d.isRadioButtonSet&&this.disclaimer.text(d.disclaimerMessage.format(c))}},handleMethodsClick:function(a){this.base(a);this.options.inline||this.applyMethodSelection();this.trackChange(a)},applyMethods:function(){this.options.inline&&(b.events.publish("resultspage.filters.pfc.method.unsuspend"),this.methodsDialog.close(),"none"!==this.getMethodString()&&this.getChildElement("dialog").hide());this.refilterResults();
this.showChangeFeedbacks=!0},showSaveDialog:function(){b.events.publish("resultspage.notify",{content:this.saveMethodsPopover})},showFeedbackMessage:function(){b.events.publish("resultspage.notify",{content:this.options.pricesUpdatedMessage})},destroy:function(){this.base();this.saveMethodsPopover=null},trackChange:function(a){this.options.trackingEnabled&&b.VestigoEvents&&b.VestigoEvents.feeassistant.paymentmethod(a.value,a.checked?b.VestigoType.Selectable.select:b.VestigoType.Selectable.unselect)}})})(R9,
jQuery);
(function(g,d,f){g.createComponentClass("flights.results.filters.PaymentFeesFilter","common.results.filters.Filter",{name:"pfc",methodsDialog:null,methodsDialogContent:null,methodsDialogOptions:null,disclaimer:null,startPopover:null,headerTooltip:null,saveMethodsPopover:null,showStartBubble:!0,alertsDialogOpen:!0,displaySaveDialog:!0,showChangeFeedbacks:!1,allMethodsCodes:"",allMethodsNames:"",prevMethodsValue:"none",suspendState:!1,visible:!1,showSaveDialogDelay:1500,clientTemplates:{paymentCheckboxItem:"payment-checkbox-item",
paymentRadioButtonSet:"payment-radiobuttonset",paymentRadioButton:"payment-radiobutton"},options:{multipleWarning:"",singleWarning:"",paymentMethodFilterEmptyLabel:"",unsetWarning:"",disclaimerMessage:"",undoText:"",showChangeFeedback:!1,isRadioButtonSet:!1,carryOnEnabled:!1,standalone:!1,updateManually:!1},init:function(){this.base();this.methodsDialog=this.getChildElement("dialog").dropdownDialog(this.getDialogProperties()).getWidget();this.methodsDialogContent=this.getChildElement("dialog-content");
this.methodsDialogOptions=this.getChildElement("payment-method-options");this.disclaimer=this.getChildElement("disclaimer");this.startPopover=this.getChildElement("StartTooltip");this.headerTooltip=this.getChildElement("filter-header-tooltip").getWidget();this.saveMethodsPopover=this.getChildElement("MethodsSavePopover");this.options.isRadioButtonSet?this.methodsDialogOptions.radioButtonSet({click:this.handleMethodsClick.bind(this)}):this.methodsDialogOptions.find(".method-item").checkbox({click:this.handleMethodsClick.bind(this)})},
addEventHandlers:function(){var a=this,b=this.getChildElement("submit");this.base();this.registerEvent("click",b,function(){a.applyMethodSelection();a.logUserInteraction("submitButton","click",a.getMethodString())});this.subscribe("resultspage.streaming.done",function(){a.initStartPopover()});this.subscribe("resultspage.filters.pfc.method.selected",function(b){a.syncToState(b)});this.subscribe(["search.startSearch","resultspage.filters.pfc.method.unsuspend"],function(){a.suspendState=!1});this.subscribe("frp.alerts.driveby.open",
function(){a.alertsDialogOpen=!0;var b=a.subscribe("dialog.close",function(){setTimeout(function(){a.alertsDialogOpen=!1;g.events.unsubscribe("dialog.close",b)},10)})});this.subscribe("resultspage.flights.feeCalculator.addlink.click",this.addLinkClicked.bind(this));this.subscribe("resultspage.flights.pfc.changelink.click",function(){d("html, body").animate({scrollTop:0},"slow",function(){a.methodsDialog.open()})});this.subscribe("DropdownDialog.open",function(b){b.id===a.methodsDialog.element.attr("id")&&
(a.prevMethodsValue=a.getMethodString())})},getDialogProperties:function(){return{onOpen:function(){this.suspendState=!0;this.logUserInteraction("dialog","open")}.bind(this)}},addLinkClicked:function(a){var b=this;a.name===this.name?(d("html, body").animate({scrollTop:0},"slow",function(){b.headerTooltip&&b.headerTooltip.open()}),this.options.carryOnEnabled&&this.methodsDialog.open()):this.methodsDialog.close()},initStartPopover:function(){if(this.startPopover.length&&this.showStartBubble&&this.enabled){var a=
this.title.length?this.title:d("#"+this.id("title").replace("-"+this.name,""));a.length&&this.renderStartPopover(a)}},renderStartPopover:function(a){var b=this;f.setTimeout(function(){b.positionPopover(a,b.startPopover);b.startPopover.addClass("visible");d("body").append(b.startPopover);b.startPopover.addClass("animateBubbleMove");b.startPopover.data("namespace","startPopover");b.getChildElement("hide").off("click").on("click",function(a){b.saveBubbleHideInfo(a);b.startClose(b.startPopover)});d(document).on("click.startPopover",
function(){b.alertsDialogOpen||b.startClose(b.startPopover)});d(f).on("resize.startPopover",b.positionPopover.bind(b,a,b.startPopover))},1E3)},applyMethods:function(){this.options.updateManually?this.syncFilterState():(this.refilterResults(),this.methodsDialog.close());this.showChangeFeedbacks=!0},applyMethodSelection:function(){f.setMetaCookie&&f.setMetaCookie("DEFAULT_PAYMENT_OPTIONS_SET","false",this.applyMethods.bind(this))},saveBubbleHideInfo:function(){f.setMetaCookie&&f.setMetaCookie("PAYMENT_OPTIONS_HIDE_BUBBLE",
"true")},getCookieDateStamp:function(a){var b=new Date;b.setDate(b.getDate()+a);a=this.padCookieDateStr(b.getDate());var c=this.padCookieDateStr(b.getMonth()+1);return b.getFullYear()+c+a},padCookieDateStr:function(a){return 10>a?"0"+a:""+a},positionPopover:function(a,b){var c=d(a).offset();b.css({top:c.top+10,left:c.left+jq(a).outerWidth()})},positionUnderPopover:function(a,b){var c=d(a).offset();b.css({top:c.top+jq(a).outerHeight(),left:c.left})},startClose:function(a){var b=this;f.setTimeout(function(){a.find(".tooltipClose").hide();
a.removeClass("visible");b.element.append(a)},100);d(document).off("resize.startPopover");d(document).off("click.startPopover");b.showStartBubble=!1},refilterResults:function(a){this.pushStateChange(!1,a)},getMethodString:function(){var a;a=this.options.isRadioButtonSet?(a=this.methodsDialogOptions.getWidget())?a.getValue():"":this.methodsDialogContent.find("input:checked").map(function(){return this.value}).get().join(",");a.length||(a="none");return a},getMethodFullNames:function(){var a="";a=this.options.isRadioButtonSet?
(a=this.methodsDialogOptions.getWidget())?a.getCheckedPair().title:"":this.methodsDialogContent.find("input:checked").siblings(".label").map(function(){return d(this).text()}).get().join(", ");a.length||(a=this.options.paymentMethodFilterEmptyLabel);return a},getState:function(){return{selMethods:this.getMethodString()}},syncToState:function(a){if(a&&this.getState()!==a.selMethods&&"string"===typeof a.selMethods){var b=a.selMethods.split(",");this.options.isRadioButtonSet?(a=this.methodsDialogOptions.getWidget())&&
a.setButtonCheckedByValue(b[0]):(a=this.methodsDialogOptions.find(".paymentMethodCheckbox \x3e input"),a.length&&a.each(function(a,e){a=0<=b.indexOf(e.value);d(e).prop("checked",a).attr("aria-checked",a).change()}));this.setLabelText(this.getMethodString(),this.getMethodFullNames())}},update:function(a){var b=this;this.allMethodsCodes=a.allPaymentMethods;this.allMethodsNames=a.allPmFullNames;var c=this.suspendState?this.getMethodString():a.selPaymentMethods,e=this.suspendState?this.getMethodFullNames():
a.selPmFullNames;this.setupOptionsSelection(a.allPaymentMethods,a.allPmFullNames,c);this.setLabelText(c,e);this.showChangeFeedbacks&&(this.showChangeFeedbacks=!1,0<this.saveMethodsPopover.length&&"none"!==this.getMethodString()?f.setTimeout(function(){b.showSaveDialog()},this.showSaveDialogDelay):this.options.showChangeFeedback&&b.showFeedbackMessage(a.selPmFullNames))},setLabelText:function(a,b){if(a){var c=this.getChildElement("dialog"),e=c.find(".label svg");a="none"!==a&&b?b.replace(/,(\w)/g,
", $1"):this.methodsDialogContent.find("input:hidden[name\x3demptyListText]").val();c.find(".label").text(a).prepend(e);this.options.isRadioButtonSet&&this.disclaimer.text(this.options.disclaimerMessage.format(a))}},setupOptionsSelection:function(a,b,c){var e=this.getChildElement("payment-method-container");a=a.split(",");b=b.split(",");var d=[];c&&0<c.length&&(d=c.split(","));e.empty();if(this.options.isRadioButtonSet)this.addRadioButtonSet(e,a,b,d);else for(c=0;c<a.length;++c)this.addCheckbox(e,
c,a[c],b[c],-1<d.indexOf(a[c]));this.methodsDialogOptions=this.getChildElement("payment-method-options")},addCheckbox:function(a,b,c,e,d){b={id:this.id("-ccFeeMeth"+b),name:c,value:c,label:e,checked:d};b=g.template.renderElement(this.clientTemplates.paymentCheckboxItem,b);b.appendTo(a);b.find(".paymentMethodCheckbox \x3e input").prop("checked",d).attr("aria-checked",d).checkbox({click:this.handleMethodsClick.bind(this)})},addRadioButtonSet:function(a,b,c,e){var f=this,h=g.template.renderElement(this.clientTemplates.paymentRadioButtonSet,
{id:"placeholder",name:"placeholder",label:"placeholder"}),l=d(g.template.getTemplate(this.clientTemplates.paymentRadioButtonSet)).children(0).html();h.children().remove();b.forEach(function(a,b){f.createRadioButtonElement(l,h,b,a,c[b])});h.appendTo(a);a=h.radioButtonSet({click:this.handleMethodsClick.bind(this)}).getWidget();e&&e.length&&a.setButtonCheckedByValue(e[0])},createRadioButtonElement:function(a,b,c,d,f,h){c={id:this.id("-ccFeeMeth"+c),name:d,label:f,checked:h};g.template.renderElementFromString(a,
this.clientTemplates.paymentRadioButton,c).appendTo(b)},setupMethodsForSave:function(){var a=this.methodsDialogContent.find("input:checked").map(function(){return"\x3cli class\x3d'method-item'\x3e"+d("label[for\x3d"+this.id+"]").text()+"\x3c/li\x3e"}).get().sort().join("");this.saveMethodsPopover.find("ul").replaceWith("\x3cul\x3e"+a+"\x3c/ul\x3e")},handleMethodsClick:function(a){this.setLabelText(this.getMethodString(),this.getMethodFullNames());this.options.updateManually&&this.applyMethodSelection();
var b="select";"checkbox"!==a.getAttribute("type")||d(a).prop("checked")||(b="unselect");this.logUserInteraction("paymentOption",b,d(a).attr("name"))},savePaymentMethods:function(){var a=d.Deferred();d.ajax({type:"POST",headers:{"X-CSRF":g.globals.formtoken},url:"/s/myprefs/update/prefs",data:{formtoken:g.globals.formtoken,key:"paymentmethods",value:this.getMethodString()},dataType:"json",error:function(b,c){g.events.publish("error.alert",{messages:c});a.reject()},success:function(){a.resolve()}});
return a},showSaveDialog:function(){var a=this,b=d("body");if(!this.displaySaveDialog)return!1;this.setupMethodsForSave();this.positionUnderPopover(this.getChildElement("dialog"),this.saveMethodsPopover);this.saveMethodsPopover.addClass("visible");b.append(this.saveMethodsPopover);this.saveMethodsPopover.find(".visitButton").off("click").on("click",function(){a.logUserInteraction("saveMethods","visitOnlySelected");a.saveMethodsPopover.removeClass("visible");a.element.append(a.saveMethodsPopover);
f.setMetaCookie&&f.setMetaCookie("PFC_LOGGED_IN_CLOSE","true");a.displaySaveDialog=!1});this.saveMethodsPopover.find(".permButton").off("click").on("click",function(){a.logUserInteraction("saveMethods","makePermanentSelected");a.saveMethodsPopover.removeClass("visible");a.element.append(a.saveMethodsPopover);g.authentication.showSignup({promo:"pfc",promoType:"whisky",success:function(){g.authentication.cached_dialog.close();a.savePaymentMethods();f.setTimeout(function(){f.location.reload()},1E4)}})});
b.off("click.mthSave").on("click.mthSave",function(){a.saveMethodsPopover.hasClass("visible")&&(a.saveMethodsPopover.removeClass("visible"),a.element.append(a.saveMethodsPopover))});return!0},showFeedbackMessage:function(a){var b=this,c=d(".belowSearchContainer .warningsContainer"),e="",k,h="\x3c/span\x3e\x3cspan class\x3d'undoMsg'\x3e"+g.Common.Utils.String.formatString(this.options.undoText)+"\x3c/span\x3e\x3c/div\x3e";this.options.strictFeeDisclosure?e="\x3cdiv\x3e\x3cspan class\x3d'warningMsg'\x3e"+
g.Common.Utils.String.formatString(this.options.strictWarning)+h:(a&&"none"!==a&&(a=a.split(","),e=(e=a.length)?1<e?"\x3cdiv\x3e\x3cspan class\x3d'warningMsg'\x3e"+g.Common.Utils.String.formatString(this.options.multipleWarning,e)+h:"\x3cdiv\x3e\x3cspan class\x3d'warningMsg'\x3e"+g.Common.Utils.String.formatString(this.options.singleWarning,a[0])+h:"\x3cdiv\x3e\x3cspan class\x3d'warningMsg'\x3e"+g.Common.Utils.String.formatString(this.options.unsetWarning)+h),""===e&&(e="\x3cdiv\x3e\x3cspan class\x3d'warningMsg'\x3e"+
g.Common.Utils.String.formatString(this.options.unsetWarning)+h));c.empty();c.append(e);c.find(".undoMsg").one("click",function(){b.setupOptionsSelection(b.allMethodsCodes,b.allMethodsNames,b.prevMethodsValue);b.refilterResults()});c.fadeIn(1E3);k=f.setTimeout(function(){c.fadeOut(500)},3E3);d(document).one("click",function(){b.logUserInteraction("feedbackMessage","closeFeedback");c.find(".undoMsg").off("click");f.clearTimeout(k);c.fadeOut(500)})},logUserInteraction:function(a,b,c){"undefined"===
typeof a||"undefined"===typeof b?this.base():"object"===typeof a?this.base(a):this.base({category:"/"+this.options.loggingPrefix+"/"+this.name+"/"+a,label:"undefined"===typeof c?"":c,action:b})}})})(R9,jQuery,window);
(function(d,g){var h=d.config.getBoolean("ui.horizon.flights.feeAssistant.hideWhenEmpty",!0);d.createComponentClass("flights.results.FlightFeeAssistant",{feesInfo:null,deferRequestId:null,pendingRequest:null,fromFeeCalcAdd:0,avoidScrollTop:0,onboardingTooltip:null,options:{carryOnInit:0,carryOnMax:1,checkedInit:0,checkedMax:1,paymentFeesEnabled:!1,deferRequestMs:1100,useToast:!0,fcFixedToast:"",fcScrollsTop:!1,showOnboarding:!1,collapsible:!1,enabledFilters:[],trackingEnabled:!1},init:function(){this.feesInfo=
{cfc:this.makeFeesInfo(this.options.carryOnInit),bfc:this.makeFeesInfo(this.options.checkedInit)};this.baggageFees=this.getChildElement("bfc").add(this.getChildElement("cfc"));this.perPersonDisclaimer=this.getChildElement("disclaimer")},addEventHandlers:function(){this.subscribe("resultspage.flights.feeCalculator.addlink.click",this.onFeeCalcAdd.bind(this));this.subscribe("resultspage.filtersData.changed",this.onFilterDataChanged.bind(this));var a=this.getStlBlock("hidden");this.subscribe("search.searchFailed",
function(){this.element.addClass(a)}.bind(this));this.subscribe("search.startSearch",function(b){b.isMulticity?this.options.paymentFeesEnabled?(this.swapClasses(this.baggageFees,"FeeBlock--visible","FeeBlock--hidden"),this.element.removeClass(a)):this.element.addClass(a):(this.element.removeClass(a),this.swapClasses(this.baggageFees,"FeeBlock--hidden","FeeBlock--visible"))}.bind(this));this.subscribe("resultspage.cleanup",function(){var a=this.feesInfo.cfc.numberBox&&this.feesInfo.cfc.numberBox.getWidget();
a&&a.setValue(0,!0);(a=this.feesInfo.bfc.numberBox&&this.feesInfo.bfc.numberBox.getWidget())&&a.setValue(0,!0)}.bind(this));this.subscribe("flights.search.travelers.change",function(a){this.perPersonDisclaimer.length&&this.swapClassesToggle(this.perPersonDisclaimer,"Disclaimer--visible","Disclaimer--hidden",a&&a.data&&a.data.travelers&&1<a.data.travelers&&1>a.data.lapInfant)}.bind(this));this.options.collapsible&&this.bindCollapsible()},inlineComponentsReady:function(){var a=this.getChildElement("step-carry-on");
a.length&&(this.feesInfo.cfc.numberBox=a.styleJamNumberBox({defaultValue:this.options.carryOnInit,min:0,max:this.options.carryOnMax,callback:this.onChangedCarryOn.bind(this)}));a=this.getChildElement("step-checked-bag");a.length&&(this.feesInfo.bfc.numberBox=a.styleJamNumberBox({defaultValue:this.options.checkedInit,min:0,max:this.options.checkedMax,callback:this.onChangedCheckedBag.bind(this)}))},destroy:function(){this.deferRequestId&&clearTimeout(this.deferRequestId);this.pendingRequest&&(this.pendingRequest.reject(),
this.pendingRequest=null);Object.values(this.feesInfo).forEach(function(a){a.numberBox=null})},makeFeesInfo:function(a){return{numberBox:null,lastRequest:a,nextRequest:a}},bindCollapsible:function(){var a=this,b=this.getChildElement("filter"),c=this.getChildElement("filter-title"),f=this.getChildElement("filter-content"),e=function(){var e=b.hasClass("open")?"hide":"show";d.Analytics.api.trackEvent({category:"Filter-Collapsible",action:e,label:"feeassistant"});b.toggleClass("open");c.attr("aria-pressed",
"show"===e);f.attr("aria-expanded","show"===e);d.events.publish("horizon.filters.opened");a.trackToggle(e)};this.registerEvent("click",c,e);this.registerEvent("keypress",c,function(a){a.keyCode===d.globals.keyCodes.RETURN&&e()})},onChangedCarryOn:function(a,b){this.setChangedBagCount("cfc",0<a,b)},onChangedCheckedBag:function(a,b){this.setChangedBagCount("bfc",0<a,b)},setChangedBagCount:function(a,b,c){var f=this.feesInfo[a];this.deferRequestId?clearTimeout(this.deferRequestId):this.pendingRequest||
this.checkStartLoadingDisplay();var e=isNaN(this.options.deferRequestMs)?1100:this.options.deferRequestMs;this.fromFeeCalcAdd&&(e=0);f.nextRequest=c;this.syncFilterState(a,c);0<e?this.deferRequestId=setTimeout(this.sendBagCounts.bind(this),e):this.sendBagCounts();d.Analytics.api.trackEvent({category:"FeeAssistant",action:b?"increment":"decrement",label:a+"-"+c});this.trackCountChanges(a,b,c)},sendBagCounts:function(){var a=this;this.deferRequestId&&(clearTimeout(this.deferRequestId),this.deferRequestId=
null);Object.values(this.feesInfo).every(function(a){return a.lastRequest===a.nextRequest})?this.checkResetLoadingDisplay():(this.pendingRequest&&this.pendingRequest.reject(),this.pendingRequest=g.Deferred().done(function(){a.fromFeeCalcAdd&&!a.avoidScrollTop&&a.options.fcScrollsTop&&g(window).scrollTop(0);a.options.useToast&&d.events.publish("resultspage.notify",{content:a.options.toastMessage})}).always(function(){a.fromFeeCalcAdd=0;a.avoidScrollTop=0;a.pendingRequest=null;a.checkResetLoadingDisplay()}),
Object.keys(this.feesInfo).forEach(function(b){var c=a.feesInfo[b];c.lastRequest!==c.nextRequest&&(c.lastRequest=c.nextRequest,a.publishFilterChange(b,c.nextRequest))}))},getFilter:function(a,b){return{name:a,state:0<b?{baggageCount:b}:null}},syncFilterState:function(a,b){d.events.publish("resultspage.filters.sync",this.getFilter(a,b))},publishFilterChange:function(a,b){d.events.publish("filters.changed",this.getFilter(a,b))},onFilterDataChanged:function(a){var b=this;this.pendingRequest?this.pendingRequest.resolve():
a&&Object.keys(this.feesInfo).forEach(function(c){if(c&&a[c]){var d=window.parseInt(a[c].selBaggageCount);!isNaN(d)&&0<=d&&(b.feesInfo[c].numberBox&&b.feesInfo[c].numberBox.getWidget().setValue(d,!0),b.feesInfo[c].lastRequest=b.feesInfo[c].nextRequest=d);a[c].isFiltering&&b.syncFilterState(c,d)}});h&&this.element.toggleClass(this.getStlBlock("hidden"),!this.checkFiltersAvailable(a))},checkFiltersAvailable:function(a){return this.options.enabledFilters.length&&this.options.enabledFilters.some(function(b){return(b=
a[b])&&(!b.hasOwnProperty("valueMap")||0<Object.keys(b.valueMap).length)})},onFeeCalcAdd:function(a){a&&a.name&&this.feesInfo[a.name]&&this.feesInfo[a.name].numberBox&&(this.fromFeeCalcAdd=1,this.avoidScrollTop=a.avoidScrollTop,this.feesInfo[a.name].numberBox.getWidget().increment())},checkStartLoadingDisplay:function(){d.events.publish("fee.assistant.start",{delay:0})},checkResetLoadingDisplay:function(){this.deferRequestId||this.pendingRequest||d.events.publish("fee.assistant.done")},trackToggle:function(a){this.trackingEnabled()&&
("show"===a?d.VestigoEvents.feeassistant.expand():d.VestigoEvents.feeassistant.collapse())},trackCountChanges:function(a,b,c){this.trackingEnabled()&&(b=b?d.VestigoType.Incrementable.increment:d.VestigoType.Incrementable.decrement,"cfc"===a?d.VestigoEvents.feeassistant.cabinbag(c,b):"bfc"===a&&d.VestigoEvents.feeassistant.checkedbag(c,b))},trackingEnabled:function(){return this.options.trackingEnabled&&d.Vestigo}})})(R9,jQuery);
(function(d){R9.extend("Widgets",{RadiobuttonSet:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!b||b.dontValidate||this.validateElement())this.options=d.extend({},this.options,b),this.init()}});R9.extend("Widgets.RadiobuttonSet",{isRadiobuttonSet:function(a){return a&&a.nodeName&&"span"===a.nodeName.toLowerCase()},isWidgetControlled:function(a){return d(a).hasClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass)},findLabelNode:function(a){return document.getElementById(a.id+
"-label")},findRadiobuttonSetNode:function(a){return null!=a?a.parentNode:null},refresh:function(a){var b=!1;a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).each(function(){var a=d(R9.Widgets.RadiobuttonSet.findLabelNode(this)),e=d(this);e.prop("checked")?(b=!0,a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked")):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked");e.prop("disabled")?a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+
"-label-disabled"):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-disabled")});b||(a=a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).first(),a.prop("checked",!0),d(R9.Widgets.RadiobuttonSet.findLabelNode(a[0])).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked"))},applyCallback:function(a,b,c,e){a&&(d.isFunction(a)?a.apply(b,c):(a=a[e.target.value],d.isFunction(a)&&a.apply(b,c)))}});R9.extend("Widgets.RadiobuttonSet.prototype",
{widgetName:"radiobuttonset",widgetBaseClass:"r9-radiobuttonset",elementNode:null,element:null,options:{change:null,click:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.handleElementClickEvent);this.element.data(this.widgetName,this);R9.Widgets.RadiobuttonSet.refresh(this.element)},bindInputEvent:function(a,b){var c="input."+
this.widgetBaseClass;a+="."+this.widgetName;var d=this;this.element.off(a,c).on(a,c,function(a){b.call(d,this,R9.Widgets.RadiobuttonSet.findLabelNode(this),a)})},validateElement:function(){return R9.Widgets.RadiobuttonSet.isRadiobuttonSet(this.elementNode)&&R9.Widgets.RadiobuttonSet.isWidgetControlled(this.element)&&void 0===this.element.data(this.widgetName)},handleElementFocusEvent:function(a,b,c){a.disabled||d(b).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementBlurEvent:function(a,
b,c){a.disabled||d(b).removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementChangeEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.change,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))},handleElementClickEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.click,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))}})})(jq||jQuery);
(function(d){R9.createWidgetClass("radio.StyleJamRadioButtonSet",d.extend({},R9.Widgets.RadiobuttonSet.prototype,{currentRadio:null,isTabList:!1,init:function(){setTimeout(this.refresh.bind(this),1);this.currentRadio=this._getLabelForButton(this._getButtons().filter(":checked"));this.isTabList="tablist"===this.element.attr("role")},refresh:function(){R9.Widgets.RadiobuttonSet.refresh(this.element);var a=this.getEnabledRadios().filter("[aria-checked\x3dtrue]");a.length&&this.element.attr("aria-activedescendant",
a.attr("id"));this.focusRadio();this.isTabList&&window.setTimeout(function(){var a=this.getCheckedButton();this._getButtons().attr("aria-selected",!1);a.attr("aria-selected",!0);this._setActiveTabPanel(a)}.bind(this),1)},addEventHandlers:function(){this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.onClick);this.element.on("focus",this.onFocus.bind(this));this.element.on("blur",this.onBlur.bind(this));this.element.on("keydown",this.onKeyDown.bind(this))},
onClick:function(a,b,c){this.handleElementClickEvent(a,b,c);this.isTabList&&this._getButtons().each(function(b,c){a===c&&this._setButtonCheckedById(c.id)}.bind(this));this.focusRadio()},focusRadio:function(a){a&&a.length||(a=this._getLabelForButton(this._getButtons().filter(":checked")));a.length&&(this.element.attr("aria-activedescendant",a.attr("id")),this.handleActiveLabel(a),this.currentRadio=a)},getAllRadios:function(){return this.element.find("label")},getEnabledRadios:function(){return this.element.find("label").filter('[data-is-label-disabled\x3d"false"]')},
focusButtonSet:function(){this.getChildElement("set").focus()},onFocus:function(){var a=this.element.attr("aria-activedescendant");"undefined"===typeof a&&0<this.getEnabledRadios().length&&(a=this.getEnabledRadios().get(0).id);a&&this.focusRadio(d("#"+a));this.element.addClass("focused")},onBlur:function(){this.element.removeClass("focused")},onKeyDown:function(a){switch(a.which){case R9.globals.keyCodes.SPACE:this._getButtons().filter("#"+this.currentRadio.attr("for")+"[aria-checked\x3dfalse]").click();
this.checkCurrentRadio();break;case R9.globals.keyCodes.UP:case R9.globals.keyCodes.LEFT:this.focusPreviousRadio();break;case R9.globals.keyCodes.DOWN:case R9.globals.keyCodes.RIGHT:this.focusNextRadio();break;default:return!0}return!1},checkCurrentRadio:function(){this.currentRadio&&this.checkRadio(this.currentRadio)},focusPreviousRadio:function(){var a=this.getPrevButtons(),b=this.getEnabledRadios(),a=a&&a.length?d(a.get(0)):d(b.get(b.length-1));this.checkRadio(a)},focusNextRadio:function(){var a=
this.getNextButtons(),a=a&&a.length?d(a.get(0)):d(this.getEnabledRadios().get(0));this.checkRadio(a)},checkRadio:function(a){a&&(a.attr&&a.attr("for")||a.click(),this.currentRadio.attr("aria-checked",!1),this.focusRadio(a),this.currentRadio.attr("aria-checked",!0))},getCheckedButton:function(){var a=this._getButtons().get(0);this._getButtons().get().some(function(b){if(!0===d(b).prop("checked"))return a=b,!0});return d(a)},getPrevButtons:function(){return this.currentRadio.prevAll("label:visible")},
getNextButtons:function(){return this.currentRadio.nextAll("label:visible")},getCheckedPair:function(){var a=this.getCheckedButton();return{value:a.val(),title:this._getLabelForButton(a).attr("title")}},isButtonChecked:function(a){return!0===this._getButtonByValue(a).prop("checked")},isButtonEnabled:function(a){return!1===this._getButtonByValue(a).prop("disabled")},getRadioButtonAmount:function(){return this.element.find("input").length},getValue:function(){return this.getCheckedButton().val()},setValue:function(a){this.setButtonCheckedByValue(a)},
setInnerLabelText:function(a,b){this._getInnerLabelByValue(a).text(b)},setButtonCheckedByValue:function(a){this._setButtonChecked(function(b){return b.val()===a})},setButtonEnabledByValue:function(a,b){this._setButtonEnabled(function(b){return b.val()===a},b)},_setButtonCheckedById:function(a){this._setButtonChecked(function(b){return b.attr("id")===a})},_setButtonEnabledById:function(a,b){this._setButtonEnabled(function(b){return b.attr("id")===a},b)},_setButtonChecked:function(a){var b=this;this._getButtons().each(function(c,
e){c=d(e);e=!!a(c);c.prop("checked",e);c.attr("aria-checked",e);b.handleActiveLabel(b.getAllRadios().filter("[for\x3d'"+c.attr("id")+"']"))});this.refresh()},_setButtonEnabled:function(a,b){var c=this;this._getButtons().each(function(){var e=d(this);!0===a(e)&&(e.prop("disabled",!1===b),e.attr("aria-disabled",!1===b),c.handleDisabledLabel(c.getAllRadios().filter("[for\x3d'"+e.attr("id")+"']"),b))});this.refresh()},_setActiveTabPanel:function(a){a=d("[id\x3d'%s']".format(a.attr("aria-controls")));
a.length&&(this._getButtons().get().reduce(function(a,c){c=d(c).attr("aria-controls");return a.add(d("[id\x3d'%s']".format(c)))},d()).attr("aria-expanded",!1),a.attr("aria-expanded",!0))},_getButtons:function(){return this.element.find("input."+this.widgetBaseClass)},_getButtonByValue:function(a){return this._getButtons().filter('[value\x3d"'+a+'"]')},_getInnerLabelByValue:function(a){return this._getLabelForButton(this._getButtonByValue(a)).find(".js-inner-label")},_getLabelForButton:function(a){return a.next(".js-label")},
handleActiveLabel:function(a){this.getAllRadios().attr("aria-checked",!1);a.attr("aria-checked",!0);R9.dom.swapClasses(this.getAllRadios(),a.data("active-state"),a.data("default-state"));R9.dom.swapClasses(a,a.data("default-state"),a.data("active-state"))},handleDisabledLabel:function(a,b){a.attr("data-is-label-disabled",!b);b?R9.dom.swapClasses(a,a.data("disabled-state"),a.data("default-state")):R9.dom.swapClasses(a,a.data("default-state"),a.data("disabled-state"))},addNewRadioButton:function(a,
b,c,d,g,k,h){if(a){var e=this.element.find("input").first().clone(),f=this.element.find("label").first().clone();e.attr("id",a);f.attr("id",a+"-label");f.attr("for",a);b&&e.attr("value",b);c&&e.attr("name",c);g&&f.attr("title",g);d&&f.find(".label-text").text(d);this.element.append(e,f);h&&this._setButtonEnabledById(a,h);k&&this._setButtonCheckedById(a);this.refresh()}},deleteRadioButtonByValue:function(a){if(a&&(a=this.element.find("input[value\x3d"+a+"]"))){var b=this.element.find("label[id\x3d"+
a.attr("id")+"-label]");d(a).remove();b&&b.remove();this.refresh()}}}))})(jQuery);
(function(d){R9.extend("Widgets",{Slider:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!this.validateElement())return this;this.options=d.extend({},this.options,b);this.init()}});R9.extend("Widgets.Slider.prototype",{elementNode:null,element:null,elementWidth:0,elementPositionLeft:0,activeRange:null,handles:[],activeHandle:null,activeHandleIndex:null,startValues:null,timelineDepPoints:null,timelineDepTimes:null,timelineArrTimes:null,timelineHours:null,timelinePrices:null,timelineLegSignatures:null,
timelineElements:null,timelineLabels:null,mouseMoveDelegate:d.noop,mouseUpDelegate:d.noop,options:{start:d.noop,stop:d.noop,slide:d.noop,min:0,max:100,step:1,values:[],range:!0,logarithmic:!1,snapToValue:!1,timeValueAmount:0,exponent:-1,cutoff:-1,totalRange:-1,totalStepAmount:-1,equalStepAmount:-1,cutoffPercentage:-1,equalStepRange:-1,expStepAmount:-1,useCustomDistribution:!1},init:function(){var a=this.element.data("r9RangeSlider");null!=a&&(this.options.values=a.getValues());this.element.data("r9RangeSlider",
this);var b=this;this.handles=this.element.children(".r9-rangeSlider-handle");this.activeRange=this.element.find(".r9-rangeSlider-activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(a){b.mouseDown(a);a.preventDefault();a.stopPropagation(!0)});a=this.options.values;if(!a||1>a.length)a=this.options.range?[this.options.min,this.options.max]:[this.options.min];this.determineSetValues(a);setTimeout(function(){b.drawActiveRange()},60)},validateElement:function(){return 0<
this.element.length&&this.element.hasClass("r9-rangeSlider")},setStartValues:function(){this.startValues=[];for(var a=0;a<this.options.values.length;a++)this.startValues[a]=this.options.values[a]},setupActiveHandle:function(a){this.activeHandle=a;this.activeHandleIndex=null;this.elementWidth=this.element.outerWidth();this.elementPositionLeft=this.element.offset().left;for(a=0;a<this.handles.length;a++)this.activeHandle==this.handles[a]&&(this.activeHandleIndex=a);d(this.activeHandle).addClass("r9-rangeSlider-handle-active")},
mouseDown:function(a){this.setupActiveHandle(a.target);var b=this;this.mouseMoveDelegate=function(a){b.mouseMove(a)};this.mouseUpDelegate=function(a){a.stopPropagation(!0);b.mouseUp(a)};d(document).bind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).bind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);this.setStartValues();this.options.start(a,this.options.values)},mouseUp:function(a){d(this.activeHandle).removeClass("r9-rangeSlider-handle-active");
this.activeHandleIndex=this.activeHandle=null;d(document).unbind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).unbind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);var b=!1;if(this.startValues)for(var c=0;c<this.options.values.length;c++){if(this.options.values[c]!=this.startValues[c]){b=!0;break}}else b=!0;this.options.stop(a,this.options.values,b)},setActiveHandleValue:function(a){var b=100*this.positionForValue(a);d(this.activeHandle).css("left",
b+"%").css("z-index","3");for(b=0;b<this.handles.length;b++)this.handles[b]==this.activeHandle&&(this.options.values[b]=a,this.setHandleAttribute("valuenow",a,b),1<this.handles.length&&(0===b?this.setHandleAttribute("valuemin",a,1):this.setHandleAttribute("valuemax",a,0)));this.drawActiveRange()},setHandleAttribute:function(a,b,c){void 0!==c?d(this.handles[c]).attr("aria-"+a,b):d(this.handles).attr("aria-"+a,b);R9.globals.testMode&&(void 0!==c?d(this.handles[c]).attr("data-test-sliderhandle-"+a,b):
d(this.handles).attr("data-test-sliderhandle-"+a,b))},mouseMove:function(a){a.preventDefault();a.stopPropagation();var b=a.originalEvent;b.touches&&0<b.touches.length?a.pageX=b.touches[0].pageX:b.changedTouches&&0<b.changedTouches.length&&(a.pageX=b.changedTouches[0].pageX);this.setActiveHandleValue(this.valueForPosition(Math.min(this.elementWidth,Math.max(0,a.pageX-this.elementPositionLeft))/this.elementWidth,this.activeHandleIndex));this.options.slide(a,this.options.values)},getValues:function(){return this.options.values.slice(0)},
getValue:function(){return 0<this.options.values.length?this.options.values[0]:0},setValues:function(a){var b=this;this.options.values=[];for(var c=0;c<a.length;c++){var e=this.trimAlignValue(a[c]),f=100*this.positionForValue(e),g=2;1<a.length&&(0==c&&90<=f||c==a.length-1&&10>=f)&&(g=3);this.options.values.push(e);d(this.handles[c]).css("left",f+"%").css("z-index",g)}setTimeout(function(){b.drawActiveRange()},60);R9.config.getBoolean("ui.slider.nonBlockingDrawActiveRange",!0)?setTimeout(this.drawActiveRange.bind(this),
1):this.drawActiveRange();this.options.slide(null,this.options.values)},determineSetValues:function(a){if(R9.config.getBoolean("ui.slider.safeSetValues",!0))return this.safeSetValues(a);this.setValues(a);return null},safeSetValues:function(a){try{return this.setValues(a),null}catch(b){return b}},errorSetValues:function(a){R9.Widgets.Slider.singleSetValuesError||(R9.Widgets.Slider.singleSetValuesError=1,R9.config.getBoolean("ui.slider.logRollbar",!1)&&window.Rollbar&&Rollbar.error?Rollbar.error("Slider setValues failed",
{error:a&&a.message?a.message:"(unknown error)",winTop:window===window.top,winParent:window.top===window.parent}):R9.config.getBoolean("ui.slider.logVs",!0)&&R9.Analytics.api.trackEvent({category:"slider",action:"error",label:"setvalues",value:(window===window.top)+"-"+(window.top===window.parent)}))},setCustomDistribution:function(a){this.options.exponent=a.exponent;this.options.cutoff=a.cutoff;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=a.ranges.length;
this.options.cutoffPercentage=a.cutoffPercentage;this.options.equalStepAmount=this.options.cutoffPercentage*this.options.totalStepAmount;this.options.equalStepRange=this.options.cutoff-this.options.min;this.options.expStepAmount=this.options.totalStepAmount-this.options.equalStepAmount;this.options.useCustomDistribution=!0},resetCustomDistribution:function(){this.options.exponent=-1;this.options.cutoff=-1;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=-1;this.options.equalStepAmount=
-1;this.options.cutoffPercentage=-1;this.options.equalStepRange=-1;this.options.expStepAmount=-1;this.options.useCustomDistribution=!1},setTimelinePoints:function(a,b,c,d,f,g,h){this.timelineDepPoints=a;this.timelineDepTimes=b;this.timelineArrTimes=c;this.timelineHours=d;this.timelinePrices=f;this.timelineLegSignatures=g;h&&this.clearTimelineValues();this.setTimelineValues()},clearTimelineValues:function(){this.element.find(".timelineValue").remove();this.clearTimelineHours()},setTimelineValues:function(){this.timelineElements=
[];for(var a=0;a<this.timelineDepPoints.length;a++)this.setTimelinePoint(a);this.setTimelineHours()},setTimelinePoint:function(a){var b=d("\x3cspan /\x3e").addClass("timelineValue"),c=d('\x3cdiv class\x3d"times"  /\x3e').text(this.timelineDepTimes[a]+" - "+this.timelineArrTimes[a]),e=d('\x3cdiv class\x3d"priceValue" /\x3e').text(this.timelinePrices[a]),f=d("\x3cdiv /\x3e");b.data("legSig",this.timelineLegSignatures[a]);f.append(c);f.append(e);a=100*this.positionForValue(this.timelineDepPoints[a]);
this.element.append(b);b.css("left",a+"%");b.off("mouseover.r9Timeline").on("mouseover.r9Timeline",function(){d(this).addClass("highlight")});b.off("mouseout.r9Timeline").on("mouseout.r9Timeline",function(){d(this).removeClass("highlight")});this.markFilteredOutTimeLinePoint(b);b.toolTip({delay:0,showImmediately:!1,extraClass:"timelinePoint",content:""+f.html()});this.timelineElements.push(b)},markFilteredOutTimeLinePoint:function(a){if(a&&0!==a.length){var b=this.getPositionLeftValue(this.handles[0],
0),c=this.getPositionLeftValue(this.handles[1],100),d=this.getPositionLeftValue(a,100);b>d||c<d?a.addClass("filteredOut"):a.removeClass("filteredOut")}},markFilteredOutTimeLinePoints:function(){var a=this;this.timelineElements&&0!==this.timelineElements.length&&$.each(this.timelineElements,function(b,c){a.markFilteredOutTimeLinePoint(c)})},clearTimelineHours:function(){this.element.find(".timelineHour").remove()},setTimelineHours:function(){for(var a=0,b=0;24>b;b++){var c=this.options.min+36E5*b;
if(c>this.options.min&&c<this.options.max){var e=d("\x3cspan /\x3e").addClass("timelineHour").text(this.timelineHours[a]);this.element.append(e);c=100*this.positionForValue(c);e.css("left",c+"%");a++}}},getPositionLeftValue:function(a,b){return a?parseFloat($(a)[0].style.left):b},formatHourLabel:function(a){var b=new Date(a);a=b.getUTCHours();10>a&&(a="0"+a);b=b.getUTCMinutes();10>b&&(b="0"+b);return a+":"+b},triggerStop:function(){this.options.stop({},this.options.values,!0)},setValue:function(a){var b=
this.options.values.slice(0);b[0]=a;this.determineSetValues(b)},getOption:function(a){return this.options[a]},setOption:function(a,b){if("object"==typeof a)for(a in b=a,b)b.hasOwnProperty(a)&&(this.options[a]=b[a]);else this.options[a]=b;this.determineSetValues(this.options.values)},positionForValue:function(a){if(this.options.logarithmic){var b=1<=this.options.min?Math.log(this.options.min):0,c=Math.log(this.options.max);a=1<=a?(Math.log(a)-b)/((c-b)/1):0}else a=this.options.useCustomDistribution?
a>this.options.cutoff?Math.log(a-this.options.cutoff)/this.options.exponent/this.options.expStepAmount*(1-this.options.cutoffPercentage)+this.options.cutoffPercentage:(a-this.options.min)/this.options.equalStepRange*this.options.cutoffPercentage:(a-this.options.min)/(this.options.max-this.options.min);return a.toFixed(5)},valueForPosition:function(a,b){if(this.options.logarithmic&&1!==a){var c=1<=this.options.min?Math.log(this.options.min):0;a=Math.exp(c+(Math.log(this.options.max)-c)*a)}else a=this.options.useCustomDistribution&&
1!==a&&0<a?a>this.options.cutoffPercentage?this.options.direction?(a+Math.exp(a-this.options.cutoffPercentage)/this.options.totalStepAmount*this.options.direction)*this.options.max:this.options.cutoff+Math.exp((a*this.options.totalStepAmount-this.options.equalStepAmount)*this.options.exponent):this.options.direction?this.options.values[b]+this.options.max/200*this.options.direction:1/this.options.cutoffPercentage*a*this.options.equalStepRange+this.options.min:this.options.direction?this.options.max*
a:this.options.min+(this.options.max-this.options.min)*a;if(Math.round(a)>=this.options.values[b]&&-1===this.options.direction||Math.round(a)<=this.options.values[b]&&1===this.options.direction)a=0>this.options.direction?this.options.values[b]-Math.max(1,a-this.options.values[b]):this.options.values[b]+Math.max(1,this.options.values[b]-a);this.options.direction=0;a=this.trimAlignValue(a);0<b&&(a=Math.max(a,this.options.values[b-1]));b+1<this.handles.length&&(a=Math.min(a,this.options.values[b+1]));
return a},drawActiveRange:function(){var a=!1,b=0,c=d(this.handles[this.handles.length-1]).css("left"),e=d(this.activeRange);this.options.range&&(b=d(this.handles[0]).css("left"));if(c&&0<=c.indexOf("%")||b&&0<=b.indexOf("%"))a=!0;c=parseInt(c)-parseInt(b);e.css({left:b,width:(c||0)+(a?"%":"")});(1<this.handles.length?this.options.values[0]===this.options.min&&this.options.values[1]===this.options.max:this.options.values[0]===this.options.max)?e.addClass("fullRange"):e.removeClass("fullRange");this.markFilteredOutTimeLinePoints()},
trimAlignValue:function(a){if(a<=this.options.min)return this.options.min;if(a>=this.options.max)return this.options.max;var b;this.options.snapToValue?(b=10<this.options.step?this.options.step:10,b=Math.ceil(Math.pow(b,Math.floor(Math.log(a)/Math.log(b))-1))):b=0<this.options.step?this.options.step:1;var c=a%b;a-=c;2*Math.abs(c)>=b&&(a+=0<c?b:-b);return parseFloat(a.toFixed(5))}})})(jq||jQuery);
(function(d,a){d.createWidgetClass("slider.Slider",a.extend({},d.Widgets.Slider.prototype,{init:function(){var a=this;this.handles=this.element.children(".handle");this.activeRange=this.element.find(".activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(b){a.mouseDown(b);b.preventDefault();b.stopPropagation(!0)});this.handles.off("focus.sliderHandle").on("focus.sliderHandle",function(){a.focusHandler(1)});this.handles.off("blur.sliderHandle").on("blur.sliderHandle",
function(){a.focusHandler(0)});this.setHandleAttribute("valuemin",this.options.min);this.setHandleAttribute("valuemax",this.options.max);setTimeout(function(){var b=a.options.values;if(!b||1>b.length)b=a.options.range?[a.options.min,a.options.max]:[a.options.min];a.options.range?(a.setHandleAttribute("valuenow",b[0],0),a.setHandleAttribute("valuenow",b[1],1)):a.setHandleAttribute("valuenow",b[0]);(b=a.determineSetValues(b))&&a.errorSetValues(b);a.setHandleAttribute("label",a.options.ariaLabel)},1)},
focusHandler:function(a){this.handles.off("keydown.sliderHandle");this.handles.off("keyup.sliderHandle");if(a&&!this.element.hasClass("Disabled")){var b=this;this.handles.on("keydown.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:a.preventDefault();b.keyMoveHandle(a,-1,5);break;case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault();b.keyMoveHandle(a,1,5);break;case 33:a.preventDefault();b.keyMoveHandle(a,1,5);break;case 34:a.preventDefault(),
b.keyMoveHandle(a,-1,5)}});this.handles.on("keyup.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault(),b.mouseUp(a),b.startValues=null}})}},keyMoveHandle:function(a,c,d){this.setupActiveHandle(a.target);this.options.direction=c;var b=(this.options.values[this.activeHandleIndex]-this.options.min)/this.options.totalRange,e=1/((this.options.max-this.options.min)/(null!==this.options.step?
this.options.step:1));this.options.logarithmic&&(e=.01);c=this.valueForPosition(Math.min(this.elementWidth,Math.max(0,b+e*c*d)),this.activeHandleIndex);this.startValues||this.setStartValues();this.setActiveHandleValue(c);this.options.start(a,this.options.values);this.options.slide(a,this.options.values)},mouseDown:function(){this.element.hasClass("Disabled")||d.Widgets.Slider.prototype.mouseDown.apply(this,arguments)},validateElement:function(){return this.element.hasClass("Common-Widgets-Slider-Slider")}}))})(R9,
jQuery);
(function(g,f){g.createComponentClass("common.results.filters.RangeFilterSlider","common.results.filters.Filter",{options:{formatValues:function(a){return a},displayFormat:"%s",min:void 0,max:void 0,snapToValue:!1,step:1,logarithmic:!1,useTextInput:!1,maxValueSlider:!1,onStop:f.noop,onSlide:void 0,onStart:void 0,onValidate:void 0,useAndUp:!1,andUpString:"",andUpMax:null,usesRangeDistribution:!1},minRange:void 0,maxRange:void 0,leftRange:void 0,rightRange:void 0,displayLabel:void 0,leftDisplay:void 0,
separatorDisplay:void 0,rightDisplay:void 0,andUpDisplay:void 0,andUpMin:void 0,textInputForm:void 0,textInputMin:void 0,textInputMax:void 0,textInputOpen:!1,widget:void 0,init:function(){this.displayLabel=this.getChildElement("rangeLabel");this.leftDisplay=this.element.find(".min");this.rightDisplay=this.element.find(".max");this.separatorDisplay=this.element.find(".sep");this.andUpDisplay=this.element.find(".andup");this.andUpMin=this.element.find(".minValue");this.andUpText=this.element.find(".andUpText")},
addEventHandlers:function(){var a=this;this.answer("RangeFilterSlider.init."+this.id(),function(b){for(var c in b)!b.hasOwnProperty(c)||null!==b[c]&&void 0!==b[c]||delete b[c];f.extend(a.options,b);return a});this.widget=this.getChildElement("sliderWidget").slider({range:!this.options.maxValueSlider,min:this.options.min,max:this.options.max,step:this.options.step,snapToValue:this.options.snapToValue,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,usesRangeDistribution:this.options.usesRangeDistribution}).getWidget();
this.minRange=this.options.min;this.maxRange=this.options.max;var c=function(b){a.options.maxValueSlider?a.setRightRange(b[0]):(a.setLeftRange(b[0]),a.setRightRange(b[1]))};this.widget.setOption("stop",function(b,d,e){e&&(a.setLastUserInteraction(!0),c(d));a.options.onStop(b,d,e)});this.widget.setOption("slide",function(b,d){if(b&&(c(d),"function"===typeof a.options.onSlide))a.options.onSlide(b,d)});this.options.useTextInput&&(this.textInputForm=this.getChildElement("textInputForm"),this.textInputMin=
this.getChildElement("minInput").find("input[type\x3dnumber]"),this.textInputMax=this.getChildElement("maxInput").find("input[type\x3dnumber]"),this.addTextInputHandlers());this.widget.setOption("start",function(b,c){if("function"===typeof a.options.onStart)a.options.onStart(b,c)});this.subscribe("results.filter.disablePriceGraph",function(){var b=a.getChildElement("sliderWidget"),c=b.children(".left"),b=b.children(".right");c.css("left","0%");b.css("left","100%");a.leftDisplay.html("---");a.rightDisplay.html("---");
a.leftDisplay.addClass("disabled");a.rightDisplay.addClass("disabled")});this.subscribe("results.filter.enablePriceGraph",function(){a.leftDisplay.removeClass("disabled");a.rightDisplay.removeClass("disabled")})},addTextInputHandlers:function(){var a=this;this.displayLabel.click(a.openTextInput.bind(a));this.textInputForm.submit(a.submitTextInput.bind(a));f("body").on("click.exceptPriceFilter",function(b){!a.textInputOpen||0<f(a.element).find(f(b.target)).length||(a.textInputForm.trigger("submit"),
a.closeTextInput())});var c={9:function(b){b.target&&f(b.target).is(a.textInputMin)?a.textInputMax.focus():a.closeTextInput()},13:function(){a.textInputForm.trigger("submit")},27:function(){a.closeTextInput()}};this.textInputForm.keydown(function(a){"function"===typeof c[a.keyCode]&&(c[a.keyCode](a),a.preventDefault())})},setMinRange:function(a){this.minRange=a;this.options.min=a;this.widget.setOption("min",a);this.widget.setHandleAttribute("valuemin",a,0)},setMaxRange:function(a){this.maxRange=a;
this.options.max=a;this.widget.setOption("max",a);this.widget.setHandleAttribute("valuemax",a,1)},setUsesRangeDistribution:function(a){this.options.usesRangeDistribution=a;this.widget.setOption("usesRangeDistribution",a)},setLeftRange:function(a,c){this.leftRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},setRightRange:function(a,c){this.rightRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},isLeftRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.minRange!==
a[0]},isRightRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.maxRange!==a[1]},reset:function(){this.setLeftRange(this.minRange);this.setRightRange(this.maxRange)},clearState:function(){this.leftRange=this.rightRange=this.minRange=this.maxRange=void 0},validateValues:function(a){if("function"===typeof this.options.onValidate)return this.options.onValidate(a);var c=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!c?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:
!1},updateDisplay:function(a,c){var b=this.options.formatValues([this.leftRange,this.rightRange],this),d=b[0],b=b[1],e=this.options.displayFormat;if("function"===typeof e)d=e(d,!0),b=e(b,!1);else if("string"===typeof e)d=e.format(d),b=e.format(b);else throw"Must pass a valid display formula [function || string]";this.leftDisplay.html(d);this.options.useAndUp&&this.andUpMin.html(d);this.rightDisplay.html(b);this.options.useAndUp&&(this.rightRange==this.maxRange?(this.rightDisplay.hide(),this.separatorDisplay.hide(),
this.leftDisplay.hide(),this.andUpDisplay.show()):(this.andUpDisplay.hide(),this.leftDisplay.show(),this.separatorDisplay.show(),this.rightDisplay.show()),this.options.andUpMax&&(this.leftRange>this.options.andUpMax?this.andUpText.hide():this.andUpText.show()));e=[this.leftRange,this.rightRange];this.options.maxValueSlider&&(e[0]=this.rightRange);this.widget.setHandleAttribute("valuetext",this.options.maxValueSlider?b:d,0);this.widget.setHandleAttribute("valuetext",b,1);a&&(c&&c.useCustomDistribution?
this.widget.setCustomDistribution(c):c&&!1===c.useCustomDistribution&&this.widget.resetCustomDistribution(),this.widget.setValues(e));this.textInputForm&&this.updateTextInput(e)},openTextInput:function(a){if(this.textInputForm&&!(1>this.textInputForm.length)){var c=f(a.target).is(".max")?this.textInputMax:this.textInputMin;this.resetTextInput();this.textInputForm.removeClass("hidden");this.displayLabel.addClass("hidden");this.textInputOpen=!0;setTimeout(function(){c.focus()},10)}},closeTextInput:function(){!this.textInputForm||
1>this.textInputForm.length||(this.displayLabel.removeClass("hidden"),this.textInputForm.addClass("hidden"),this.textInputOpen=!1)},receiveMaxValue:function(a){a=[this.options.min,Math.round(Number(a))];if(!this.validateValues(a))return this.resetTextInput(),!1;this.widget.options.stop(null,a,a[0]!==this.leftRange||a[1]!==this.rightRange)},submitTextInput:function(a){a.preventDefault();var c=Math.round(Number(this.textInputMin.val())),b=Math.round(Number(this.textInputMax.val())),c=[c,b];if(!this.validateValues(c))return this.resetTextInput(),
!1;this.widget.options.stop(a,c,c[0]!==this.leftRange||c[1]!==this.rightRange);this.closeTextInput();return!1},updateTextInput:function(a){this.textInputMin.val(a[0]).attr("min",this.minRange).attr("max",a[1]);this.textInputMax.val(a[1]).attr("min",a[0]).attr("max",this.maxRange)},resetTextInput:function(){this.textInputMin.val(this.leftRange);this.textInputMax.val(this.rightRange)},destroy:function(){this.base();f("body").off("click.exceptPriceFilter")}})})(window.R9,window.jQuery);
(function(g,f){var m=JSON.parse('{"legs":[{"cutoffPercentage":0.7,"leftRange":110,"useCustomDistribution":true,"ranges":[{"min":110,"max":144,"minPrice":128.09,"count":4},{"min":144,"max":178,"minPrice":161.8,"count":15},{"min":178,"max":212,"minPrice":200.59,"count":7},{"min":212,"max":246,"minPrice":232.36,"count":16},{"min":246,"max":280,"minPrice":261.16,"count":17},{"min":280,"max":314,"minPrice":301.32,"count":11},{"min":314,"max":348,"minPrice":322.96,"count":26},{"min":348,"max":382,"minPrice":358.16,"count":36},{"min":382,"max":416,"minPrice":414.54,"count":19},{"min":416,"max":450,"minPrice":432.79,"count":18},{"min":450,"max":484,"minPrice":464.27,"count":7},{"min":484,"max":518,"minPrice":555.09,"count":7},{"min":518,"max":552,"minPrice":594.41,"count":6},{"min":552,"max":556,"minPrice":-1,"count":0},{"min":556,"max":567,"minPrice":661.45,"count":1},{"min":567,"max":612,"minPrice":665.27,"count":5},{"min":612,"max":788,"minPrice":700.47,"count":11},{"min":788,"max":1479,"minPrice":857.45,"count":7}],"isUserManipulated":false,"maxRange":1479,"rightRange":1479,"maxCount":36,"enabled":true,"isDirty":false,"isFiltering":false,"maxIndex":0,"minIndex":0,"maxPrice":857.45,"cutoff":552,"updateTitle":false,"minRange":110,"exponent":1.366390713113171}],"isUserManipulated":false,"maxPrice":[857.45],"filteredResults":213}');
g.createComponentClass("common.results.filters.SimpleRangeGraphFilter","common.results.filters.Filter",{Graph:null,legs:void 0,legCount:1,filteredResults:null,options:{showOutliers:!1,outlierDeviation:18,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",showGraphOverlay:!1,activeLeg:-1,yAxisDisplay:"count",min:void 0,max:void 0,step:1,useTextInput:!1,triggerFilteredLabel:!1,showYLines:!1,graphHeight:72,xAxisSteps:0,yAxisTicks:0,hasCursor:!1,minimumResults:0,forceHideGraph:!1,forceDisableOnSingleResult:!0,
disableOnSingle:!0,usePlaceholderData:!1,showCurrencyCodes:!1,isRtl:!1},textInput:null,init:function(){this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.eventPrefix="filters.%s.".format(this.options.name)},inlineComponentsReady:function(){this.base();var a=this;this.element.find(".graphFilterSection").each(function(b){a.legs[b]={slider:g.question.ask("RangeFilterSlider.init."+
a.id("slider-"+b),{min:a.options.min,max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(c,d){return a.sliderDidStart(b,d)},onSlide:function(c,d){return a.sliderDidSlide(b,d)},onStop:function(c,d,e){a.publishHoverState(!1,{leg:b});d={};var h=a.legs[b].slider;h&&(d.field=(f(c.target).hasClass("left")?"left":"right")+b,d.value=h[-1<d.field.indexOf("left")?
"leftRange":"rightRange"]);return a.sliderDidStop(b,e,{changeData:d})},onValidate:function(b){return a.validateValues(b)}}),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:f(this)}});this.options.usePlaceholderData&&(this.update(m),this.showGraph(0))},addEventHandlers:function(){this.base();this.subscribe(this.eventPrefix+"resetitem",this.reset.bind(this))},formatValues:function(a){var b=this;return a.map(function(a){return"undefined"===typeof a?a:g.Common.Utils.formatOptionalPrice(Math.round(a),
!0,b.options.showCurrencyCodes)})},update:function(a){var b=this;a&&(a.hasOwnProperty("filteredResults")&&(this.filteredResults=a.filteredResults),a.legs?a.legs.forEach(b.updateLeg.bind(b)):this.updateLeg(a,0),a.sectionLabels?a.sectionLabels.forEach(function(a,d){b.legs[d].label.html(a)}):1===b.legs.length&&(b.legs[0].label.html(this.options.title),b.legs[0].label.addClass("only-label")),this.disabledPriceGraphFilter(a))},updateLeg:function(a,b){this.updateLegSlider(a,b);this.legs[b].ranges=a;this.legs[b].graph=
void 0;var c=this.lookupGraphYKeys(this.options.yAxisDisplay);(c=a[c.max])&&c.length?this.legs[b].maxYVal=c[b]:f.isArray(c)||(this.legs[b].maxYVal=c);this.showGraph(b);this.updateGraph(b,[parseInt(a.leftRange),parseInt(a.rightRange)])},validateValues:function(a){var b=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!b?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:!1},willReset:function(){this.legs.forEach(function(a){a.slider.reset()})},lookupGraphYKeys:function(a){var b={count:{value:"count",
max:"maxCount"},price:{value:"minPrice",max:"maxPrice"}};return"string"===typeof a&&b[a]?b[a]:b.count},updateLegSlider:function(a,b){var c=this.legs[b].slider,d=parseInt(a.minRange),e=parseInt(a.maxRange),h=parseInt(a.leftRange),f=parseInt(a.rightRange),n=void 0===c.leftRange||void 0===c.minRange||c.leftRange===c.minRange,p=void 0===c.rightRange||void 0===c.maxRange||c.rightRange===c.maxRange;if(!isNaN(d)&&!isNaN(e)){c.setMinRange(d);c.setMaxRange(e);this.minRange=d;this.maxRange=e;isNaN(h)?n&&c.setLeftRange(c.minRange,
!0):c.setLeftRange(h,!0);isNaN(f)?p&&c.setRightRange(c.maxRange,!0):c.setRightRange(f,!0);c.updateDisplay(!0,a);var l=this;g.dom.schedule(function(){l.getChildElement("section-"+b).removeClass("hidden");l.getChildElement("legToggle").find("[name\x3d%s]".format(b+1)).addClass("active");l.element.removeClass("hidden")})}},getValuesFromRanges:function(a){var b=[];a.forEach(function(a,d,e){b[d]=a.min;e.length===d+1&&(b[d+1]=a.max)});return b},sliderDidStop:function(a,b,c){b&&(c&&(c.activeLegIndex=a),
this.pushStateChange(null,c),this.updateFilterHistory(),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidSlide:function(a,b){void 0!==this.legs[a].graph&&this.updateGraph(a,b)},sliderDidStart:function(a){this.isGraphable(a)&&this.updateGraph(a,this.legs[a].slider.widget.options.values)},getLegResultCount:function(a){var b=0;a.forEach(function(a){b+=a.count});return 1E4<b?null:b},calculateRangeMean:function(a,b){var c=0;a.forEach(function(a){c+=a.max*a.count});return c/b},calculateRangeStdDev:function(a,
b,c){var d=0,e=0;a.forEach(function(a){e=a.max*a.count;d+=(e-c)*(e-c)/b});return Math.sqrt(d/b)},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+a).html(this.generateGraph(a,b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").addClass("open");this.filteredResults>=this.options.minimumResults&&!this.options.forceHideGraph?this.legs[a].graph.removeClass("force-hidden"):this.legs[a].graph.addClass("force-hidden")},
getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};b.min=a.slider.leftRange.toString();b.max=a.slider.rightRange.toString();return b})}},updateGraph:function(a,b){this.legs[a].graph.find(".bars .bar").each(function(){var a=parseInt(f(this).data("boundary"));b[0]>a||b[1]<a?f(this).addClass("inactive"):f(this).removeClass("inactive")})},isGraphable:function(a){if(!this.legs[a]||
!this.legs[a].ranges||!this.legs[a].ranges.ranges)return!1;a=this.legs[a].ranges.ranges;var b=2>a.length,c=!1,d=!1;if(!this.options.showOutliers){var e=this.getLegResultCount(a);e?c=this.getHasOutliers(a,e):d=!0}return!b&&!c&&!d},getHasOutliers:function(a,b){var c=this.calculateRangeMean(a,b);a=this.calculateRangeStdDev(a,b,c);return(this.maxRange-c)/a>this.options.outlierDeviation},generateGraph:function(a,b){return(new this.Graph({minRange:b.minRange,maxRange:b.maxRange,yKey:this.lookupGraphYKeys(this.options.yAxisDisplay).value,
yMax:this.legs[a].maxYVal,ranges:b.ranges,showYLines:this.options.showYLines,height:this.options.graphHeight,xAxisSteps:this.options.xAxisSteps,yAxisTicks:this.options.yAxisTicks,hasCursor:this.options.hasCursor,yMaxPixels:this.options.graphHeight-2,isRtl:this.options.isRtl})).render()},makeGraphClass:function(){var a=function(a){this.options=f.extend(this.options,a);this.init()};a.prototype=f.extend(a.prototype,{xUnitScale:1,yUnitScale:1,xLabelPixels:void 0,yLabelPixels:void 0,xPixelPadding:5,xMaxPixels:g.config.getInt("ui.range.filter.graph.xAxisMax",
179),options:{},init:function(){this.findAxisTextWidths();0<this.xAxisSteps&&this.adjustXAxisSteps();0<this.options.yAxisTicks&&this.adjustYAxisTicks()},formatX:function(a){return g.Common.Utils.formatPrice(Math.round(a),!0)},formatY:function(a){return a},rawX:function(a){return a},rawY:function(a){return a},pixelScaleY:function(a){return 0>a?1:this.options.yMaxPixels/this.options.yMax*a},findAxisTextWidths:function(){if(!(this.xLabelPixels&&this.yLabelPixels||null==this.options.ranges)){var a=this.formatX(this.options.ranges[this.options.ranges.length-
1]&&this.options.ranges[this.options.ranges.length-1].max),c=this.formatY(this.options.yMax),a=f("\x3cspan\x3e").html(a).addClass("xLabel").css("font-size","9px"),c=f("\x3cspan\x3e").html(c).addClass("yLabel").css("font-size","10px");"rtl"===document.dir&&c.css("display","inline-block");var d=f("\x3cdiv\x3e").css("position","absolute").css("left","-9999px").css("top","-9999px").css("opacity","0");d.append(a).append(c);f("body").append(d);this.xLabelPixels=a.outerWidth()+5;this.yLabelPixels=c.outerWidth()+
5;d.remove()}},adjustXAxisSteps:function(){for(;0<this.options.xAxisSteps&&!(this.xMaxPixels/(this.options.xAxisSteps+1)>this.xLabelPixels);this.options.xAxisSteps--);2>=this.options.xAxisSteps&&(this.options.xAxisSteps=2)},adjustYAxisTicks:function(){var a=this.options.yMax,c=Number(this.options.yAxisTicks);if(0!==a%c)for(this.options.yAxisTicks=8>a?a:8;1<this.options.yAxisTicks&&0!==this.options.yMax%this.options.yAxisTicks;this.options.yAxisTicks--)1===this.options.yAxisTicks&&(this.options.yAxisTicks=
8<this.options.yAxisTicks?c:this.options.yMax)},renderYAxis:function(){if(1>this.options.yAxisTicks)return"";var a=this.options.height/this.options.yAxisTicks,c=f("\x3cdiv\x3e");if(0<this.options.yAxisTicks){for(var d=f("\x3cdiv class\x3d'y-axis'\x3e\x3c/div\x3e"),e,h=0;h<this.options.yAxisTicks;h++)e=this.renderYAxisLabel(h).css("height",a+"px").css("width",this.yLabelPixels+"px"),d.append(e);d.css("width",this.yLabelPixels);c.append(d)}if(this.options.showYLines)for(h=0;h<this.options.yAxisTicks;h++)d=
f("\x3cdiv\x3e\x3c/div\x3e").addClass(h+1===this.options.yAxisTicks?"line last":"line").css("top",h*a+"px").css("height",a-1+"px").css("rtl"===document.dir?"right":"left",this.yLabelPixels+this.xPixelPadding+"px"),c.append(d);return c.html()},renderYAxisLabel:function(a){return f("\x3cdiv class\x3d'label'\x3e"+this.formatY(this.options.yMax-this.options.yMax*a/this.options.yAxisTicks)+"\x3c/div\x3e")},renderXAxis:function(){if(0<this.options.xAxisSteps){for(var a=this.rawX(this.options.minRange),
c=this.rawX(this.options.maxRange),d=Math.max(Math.ceil((c-a)/this.options.xAxisSteps),this.xUnitScale),a=Math.min((c-a)/d+1,8),c="",e=0;e<a;e++)c+=this.renderXAxisLabel(e,d);return"\x3cdiv class\x3d'x-axis' style\x3d'"+("rtl"===document.dir?"right":"left")+": "+(this.yLabelPixels+2)+"px'\x3e"+c+"\x3c/div\x3e"}return""},renderXAxisLabel:function(a,c){a=this.rawX(this.options.minRange)+a*c;return"\x3cspan class\x3d'x-label'\x3e"+this.formatX(a)+"\x3c/span\x3e"},renderGraphBars:function(){for(var a=
"",c=40<this.yLabelPixels,d=c?this.yLabelPixels:(this.yLabelPixels+this.xPixelPadding)/2,e=0,f=this.options.ranges.length;e<f;e++)var g=this.options.ranges[e],a=a+("\x3cspan class\x3d'bar' data-boundary\x3d'"+g.min+"' style\x3d'height: "+this.pixelScaleY(g[this.options.yKey])+"px'\x3e\x3c/span\x3e");e=(c?"left:":"right:")+d+"px";"rtl"===document.dir&&(e=(c?"right:":"left:")+d+"px");return this.options.hasCursor?"\x3cdiv class\x3d'bars' style\x3d'"+e+"'\x3e"+a+"\x3cspan class\x3d'cursor'\x3e\x3c/span\x3e\x3c/div\x3e":
"\x3cdiv class\x3d'bars' style\x3d'"+e+";'\x3e"+a+"\x3c/div\x3e"},render:function(){return f("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+this.renderGraphBars()+this.renderXAxis())}});return a},getHistoryFilterViewState:function(a){var b=this,c=this.legCount,d=null,e=null,g=[],k=function(a,b){b()?null===d&&(d=!0):a()&&(null===e&&(e=!0),d=!1)};a.legs.forEach(function(a,d){if(!(d>=c)){var f=b.legs[d].ranges?{min:b.legs[d].ranges.minRange,max:b.legs[d].ranges.maxRange}:{},h=b.legs[d].ranges?
{min:b.legs[d].ranges.leftRange,max:b.legs[d].ranges.rightRange}:{};a.min&&a.max?k(function(){return a.min>f.min&&a.max<f.max},function(){return a.min==h.min&&a.max==h.max}):a.min?k(function(){return a.min<f.max},function(){return a.min==h.min}):a.max?k(function(){return a.max>f.min},function(){return a.max==h.max}):e=!1;g.push(a)}});return f.extend(this.base(),{state:{legs:g},isAlreadyApplied:d,disabled:!e})},getStateForFilterHistory:function(){var a=this,b={legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||
"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};a.slider.isLeftRangeManipulated()&&(b.min=a.slider.leftRange.toString());a.slider.isRightRangeManipulated()&&(b.max=a.slider.rightRange.toString());return b})};return{displayName:this.options.title,state:b,type:g.question.ask("filters.FilterHistory.type.slider"),subtype:this.getFilterHistoryDisplayViewSubtype(),displayValue:b.legs.map(function(b,d){return{displayName:a.getLegDisplayName(d),min:b.min&&a.formatValues([parseInt(b.min)]),
max:b.max&&a.formatValues([parseInt(b.max)])}})}},getLegDisplayName:function(){return null},getFilterHistoryDisplayViewSubtype:function(){return g.question.ask("filters.FilterHistory.type.numeric")},setDisabled:function(a){a=a||this.options.forceDisableOnSingleResult&&this.options.disableOnSingle&&1>=this.filteredResults;this.base(a);this.legs&&this.legs.forEach(function(b){b.slider.element.find(".r9RangeSlider").toggleClass("Disabled",a)})},disabledPriceGraphFilter:function(a){this.setDisabled(0===
a.legs.length);this.element.hasClass("Disabled")?g.events.publish("results.filter.disablePriceGraph"):g.events.publish("results.filter.enablePriceGraph")},setStateFromPrevious:function(a){var b=parseInt(a.key[a.key.length-1]);if(this.legs&&b<this.legs.length){var b=this.legs[b].slider,c=a.key.startsWith("left");a=a.reset?c?b.minRange:b.maxRange:parseInt(a.value);var d=b.widget.getValues();c?(b.setLeftRange(a),d[0]=a):(b.setRightRange(a),d[1]=a);b.widget.setValues(d)}},updatePreviousFilters:function(a){a?
a.legs.forEach(function(a,c){var b="left"+c;c="right"+c;a.hasOwnProperty("min")&&this.previousFilters.hasOwnProperty(b)&&this.previousFilters[b]!==a.min&&this.removePreviousFilter(b);a.hasOwnProperty("max")&&this.previousFilters.hasOwnProperty(c)&&this.previousFilters[c]!==a.max&&this.removePreviousFilter(c)},this):this.removePreviousFilter()},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&(g.VestigoType.FilterType.price===this.name?(a=0<this.legs.length?this.legs[0].slider:null)&&
g.VestigoEvents.filters.shared.priceRange(a.leftRange,a.rightRange,g.VestigoType.PriceType[g.question.ask("results.priceType")]):this.base(a))}})})(R9,jQuery);
(function(g,f){g.createComponentClass("common.results.filters.RangeGraphFilter","common.results.filters.SimpleRangeGraphFilter",{options:{showYLines:!0,xAxisSteps:6,yAxisTicks:4,hasCursor:!0},init:function(){this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.eventPrefix="filters.%s.".format(this.options.name)},inlineComponentsReady:function(){var a=this;this.element.find(".graphFilterSection").each(function(b){var c=
!1;a.legs[b]={slider:g.question.ask("RangeFilterSlider.init."+a.id("slider-"+b),{min:a.options.min,max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(d,e){c=!0;return a.sliderDidStart(b,e)},onSlide:function(d,c){return a.sliderDidSlide(b,c)},onStop:function(d,e,g){c=!1;a.publishHoverState(!1,{leg:b});e={};var h=a.legs[b].slider;h&&(e.field=
(f(d.target).hasClass("left")?"left":"right")+b,e.value=h[-1<e.field.indexOf("left")?"leftRange":"rightRange"]);return a.sliderDidStop(b,g,{changeData:e})},onValidate:function(b){return a.validateValues(b)}}),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:f(this)};a.legs[b].element.on("mouseenter",a.publishHoverState.bind(a,!0,{leg:b}));a.legs[b].element.on("mouseleave",function(){c||a.publishHoverState(!1,{leg:b})})});this.confineDisplayToLeg(this.options.activeLeg)},addEventHandlers:function(){this.base();
var a=this;this.subscribe("common.results.filters.activeLeg.changed",function(b){a.confineDisplayToLeg(b)});this.subscribe("common.results.filters.legCount.set",this.setLegCount.bind(this))},setLegCount:function(a){this.legCount!==a&&"number"===typeof a&&(this.legCount=a,1===this.legCount?this.confineDisplayToLeg(0):2===this.legCount&&this.confineDisplayToLeg(-1))},updateLeg:function(a,b){this.updateLegSlider(a,b);this.hideGraph(b);this.legs[b].ranges=a;this.legs[b].graph=void 0;var c=this.lookupGraphYKeys(this.options.yAxisDisplay);
(a=a[c.max])&&a.length?this.legs[b].maxYVal=a[b]:f.isArray(a)||(this.legs[b].maxYVal=a)},sliderDidStop:function(a,b,c){this.hideGraph(a);b&&(c&&(c.activeLegIndex=a),this.pushStateChange(null,c),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidStart:function(a){this.isGraphable(a)&&(this.showGraph(a),this.updateGraph(a,this.legs[a].slider.widget.options.values))},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+
a).html(this.generateGraph(a,b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").css({display:"block",height:"82px"})},getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};a.slider.isLeftRangeManipulated()&&(b.min=a.slider.leftRange.toString());a.slider.isRightRangeManipulated()&&(b.max=a.slider.rightRange.toString());
return b})}},updateGraph:function(a,b){a=this.legs[a];a.graph.find(".bars .bar").each(function(){var a=parseInt(f(this).data("boundary"));b[0]>a||b[1]<a?f(this).addClass("inactive"):f(this).removeClass("inactive")});var c=a.graph.find(".bars").width(),d=a.slider.minRange,d=c*(b[a.slider.widget.activeHandleIndex]-d)/(a.slider.maxRange-d);d>c-1&&(d=c-1);0>d&&(d=0);a.graph.find(".bars .cursor").css({left:d+"px"})},confineDisplayToLeg:function(a){if(!this.options.isMulticity&&0>a)this.element.find(".graphFilterSection").removeClass("inactive");
else{a=0>a?0:a;for(var b=0;b<this.legs.length;b++)this.legs[b].element.toggleClass("inactive",b!==a)}},shouldBeVisible:function(a){if(a.legs)for(var b=0;b<a.legs.length;b++)if(!isNaN(parseInt(a.legs[b].minRange))&&!isNaN(parseInt(a.legs[b].maxRange)))return!0;return!1},setDisabled:function(a){this.base(a);this.legs.forEach(function(b){g.dom.toggleOneClass(b.slider.widget.element,"Disabled",a)})},cleanupExistingState:function(){this.legs.forEach(function(a){a.slider.clearState();a.ranges=a.graph=a.maxYVal=
void 0})},hideGraph:function(a){void 0!==this.legs[a].graph&&(this.legs[a].graph.find(".filterGraph").css({display:"none",height:"0"}),this.getChildElement("section-"+a).removeClass("showGraph"))}})})(R9,jQuery);
(function(e,f){e.createComponentClass("flights.results.filters.FlightTimesFilter","common.results.filters.RangeGraphFilter",{Graph:null,legs:void 0,legCount:2,legSections:null,isFlexDates:!1,flexRangeLegs:{},hasWeekendDefaultState:!1,options:{canToggleFlexOptIn:!1,flexOptInClientTemplate:"",fullMeridiem:!0,isMulticity:!1,yAxisDisplay:"price",shortHourFormat:"ha"},init:function(){this.base();this.element.data("component",this);this.eventPrefix="filters.%s.".format(this.options.name);this.legSections=
this.element.find(".js-legSection")},addEventHandlers:function(){this.base();var a=this;this.subscribe("flights.filters.multicity.setLeg",function(b){a.confineDisplayToLeg(b)});this.subscribe("train.legChange.change",function(b){a.confineDisplayToLeg(b)});this.subscribe("flights.filters.takeoffLanding.setCategory",this.confineDisplayToTakeoffLanding.bind(this));this.subscribe("search.poll.response",function(b){b.hasOwnProperty("isMulticity")&&(a.options.isMulticity=b.isMulticity)})},confineDisplayToLeg:function(a){if(-1!==
a)this.base(a);else{a=2;for(var b=0;b<this.legs.length;b++)this.legs[b].element.toggleClass("inactive",b>=a)}},confineDisplayToTakeoffLanding:function(a){var b=this;this.element.toggleClass("inactive",{takeoff:0,landing:1}[this.name]!==a&&-1!==a);this.legs.forEach(function(a,d){a.element.removeClass("inactive").toggleClass("hidden",d>=b.legCount)})},cleanupExistingState:function(){this.base();this.options.isMulticity=!1},update:function(a){this.isFlexDates=a.isFlexDates;this.hasWeekendDefaultState=
a.hasWeekendDefaultState;a.legs&&this.setLegCount(a.legs.length);this.base(a);a.hasOwnProperty("airports")&&e.events.publish("flights.filters.%s.airports".format(this.name),{airports:a.airports});a.flexRangeLegs&&(this.flexRangeLegs=a.flexRangeLegs,this.options.canToggleFlexOptIn&&this.updateFlexOptInToggles(a.flexRangeLegs));this.options.isMulticity&&a.sectionLabels&&1===a.sectionLabels.length&&this.legs.forEach(function(b){b.label.html(a.sectionLabels[0])})},updateFlexOptInToggles:function(a){var b=
this.element.find(".js-flexOptIn");this.legSections.each(function(c,d){var g=b.eq(c);"boolean"!==typeof a[c]?g.length&&g.remove():(g.length||(g=this.renderFlexOptInToggle(f(d),c),this.initFlexOptInCheckbox(g,c+"")),g.find('input[type\x3d"checkbox"]').getWidget().setChecked(a[c]))}.bind(this))},renderFlexOptInToggle:function(a,b){b=e.template.renderElement(this.options.flexOptInClientTemplate,{name:this.name,legNumber:b});a.append(b);return b},initFlexOptInCheckbox:function(a,b){a=a.find('input[type\x3d"checkbox"]');
a.length&&a.checkbox({change:this.onFlexOptInChange.bind(this,b)})},onFlexOptInChange:function(a,b){b=f(b).getWidget().getValue();if(this.flexRangeLegs[a]!==b){var c={};c[a]=b;this.flexRangeLegs=f.extend({},this.flexRangeLegs,c);this.pushStateChange();this.setLastUserInteraction(!0)}this.logUserInteraction()},pushStateChange:function(a,b){this.hasWeekendDefaultState&&a?this.base(!1,b,{legs:this.legs.slice(0,this.legCount).map(function(a){return a.slider?{min:a.slider.minRange.toString(),max:a.slider.maxRange.toString()}:
{}}),flexRangeLegs:Object.keys(this.flexRangeLegs).slice(0,this.legCount).reduce(function(a,b){a[b]=!1;return a},{})}):this.base(a,b,null)},willReset:function(){this.flexRangeLegs={}},filterDataChanged:function(a){var b=this.element.hasClass("inactive");this.base(a);this.element.toggleClass("inactive",b)},showGraph:function(a){var b=this.element.find(".timesFilterSection").eq(a),c=b.outerHeight(),d=-24,g=b.find(".js-flexOptIn");g.length&&(c+=6,d+=g.outerHeight()+18);this.base(a);b.css("height",c).find(".timesFilterSectionInner").css("bottom",
d)},hideGraph:function(a){this.base(a);this.element.find(".timesFilterSection").eq(a).css("height","").find(".timesFilterSectionInner").css("bottom","")},getState:function(){return f.extend({},this.base(),{flexRangeLegs:this.flexRangeLegs})},formatValues:function(a,b){var c=this,d=this.spansDays(a);return a.map(function(b,e){var g=c.getSliderHandleDateFormat(b,e,d),f=moment.utc(b);-1!==g.indexOf("d")&&e===a.length-1&&0===f.minute()&&0===f.hour()&&(f.subtract(1,"minutes"),d=c.spansDays([a[0],f.valueOf()]),
g=c.getSliderHandleDateFormat(b,e,d));return c.formatHourTime(f.format(g))})},getSliderHandleDateFormat:function(a,b,c){return 864E5>a||!c&&0!==b?"LT":"ddd LT"},formatHourTime:function(a){return this.options.fullMeridiem?a:this.shortenMeridiem(a)},shortenMeridiem:function(a){var b=/[ ]?([aApP])[mM]$/g,c=b.exec(a);c&&1<c.length&&(a=a.replace(b,c[1].toLowerCase()));return a},spansDays:function(a){return moment.utc(a[0]).day()!==moment.utc(a[1]).day()},makeGraphClass:function(){var a=this.base(),b=this,
c=this.options.shortHourFormat,d=function(b){this.options=f.extend(a.options,b);this.findAxisTextWidths()};d.prototype=f.extend(a.prototype,d.prototype,{xUnitScale:36E5,yUnitScale:1,formatX:function(a){return b.formatHourTime(moment.utc(a).startOf("hour").format(c))},formatY:function(a){return e.Common.Utils.formatPrice(Math.round(a),!0)},rawX:function(a){return moment(a).utc().startOf("hour")._d.getTime()},render:function(){return f("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+
this.renderGraphBars()+this.renderXAxis())}});return d},getFilterHistoryDisplayViewSubtype:function(){return e.question.ask("filters.FilterHistory.type.time")},getLegDisplayName:function(a){return"Leg "+(a+1)},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&(a=a.activeLegIndex+1,this.name===e.VestigoType.FilterType.takeoff&&e.VestigoEvents.filters.flights.times.takeoff(a),this.name===e.VestigoType.FilterType.landing&&e.VestigoEvents.filters.flights.times.landing(a))}})})(R9,jQuery);
(function(b,f){b.createComponentClass("common.results.filters.FilterSection",{filters:void 0,numDirtyFilters:0,options:{name:"",filters:[],collapsible:!1,collapsed:!1,filteredLabelTargets:null,useFilterLabelHidesReset:!1,onFilterDirtySkipNonDirtyCheck:!0,trackEnabled:!1},resetLink:void 0,trackingType:null,init:function(){this.resetLink=this.getChildElement("reset");this.title=this.getChildElement("title");this.content=this.getChildElement("content");this.initCustomTrackingType()},inlineComponentsReady:function(){this.filterDOMIds=
f.map(this.element.find(".Common-Results-Filters-Filter"),function(a){return a.id});this.options.collapsible&&!this.options.collapsed&&this.element.addClass("open")},addEventHandlers:function(){var a=this;this.subscribe("search.startSearch",function(c){"undefined"!==typeof c&&c.preserveFilters||a.element.addClass("inactive")});this.resetLink.click(function(c){c.stopPropagation();a.resetAll()});this.resetLink.keydown(function(c){switch(c.which){case b.globals.keyCodes.RETURN:case b.globals.keyCodes.SPACE:c.preventDefault(),
a.resetLink.click()}});this.dedupeSubscribe("filter.dirty","dirty",function(c){c?(a.element.addClass("open"),a.resetHiddenByLabel||a.resetLink.show(),a.resetWasDirty=!0):(a.resetLink.hide(),a.resetWasDirty=!1)});this.dedupeSubscribe("filter.enabled","enabled",function(c){a.toggleFilterSection({visible:c})});this.subscribe("filters.disabled",function(c){c&&a.resetLink.hide()});this.subscribe("filter.label.update",this.onFilterLabelUpdate.bind(this));var d=this.getChildElement("skip");d.length&&d.click(function(c){c=
f("[tabbable]:visible");var b=c.index(a.element)+1;b>=c.length&&(b=0);c.eq(b).get(0).focus()});this.subscribe("filter.dirty",this.onFilterDirty.bind(this));this.options.filters.forEach(function(c){a.subscribe("filters.changed",{name:c},a.onPushedStateChange.bind(a))});if(this.options.collapsible){var e=function(){var c=a.element.hasClass("open"),d=a.element.hasClass("open")?"hide":"show";b.Analytics.api.trackEvent({category:"Filter-Collapsible",action:d,label:a.options.filters.join(",")});a.element.toggleClass("open");
a.title.attr("aria-pressed","show"===d);a.title.attr("aria-expanded","show"===d);b.globals.testMode&&a.title.attr("data-test-filter-collapsed","show"===d);b.events.publish("horizon.filters.opened");a.options.trackEnabled&&a.trackingType&&(c?b.VestigoEvents.filters.shared.collapse(a.trackingType):b.VestigoEvents.filters.shared.expand(a.trackingType))};this.title.click(e);this.title.keypress(function(a){if(a.keyCode===b.globals.keyCodes.RETURN||a.keyCode===b.globals.keyCodes.SPACE)return e(),!1})}},
resetAll:function(a){var d=this;this.options.filters.forEach(function(e){d.skipFilter(e)||(e={name:e},a&&(e.type="showAll"),b.events.publish("filter.reset",e))});this.resetLink.hide();b.VestigoEvents&&this.trackingType&&b.VestigoEvents.filters.shared.reset(this.trackingType)},onFilterDirty:function(a){!(this.options.onFilterDirtySkipNonDirtyCheck&&a&&a.hasOwnProperty("dirty")&&!1===a.dirty)&&0<=this.options.filters.indexOf(a.name)&&(this.numDirtyFilters+=a.dirty?1:0,this.element.toggleClass("isDirty",
0<this.numDirtyFilters))},onPushedStateChange:function(a){var b=a.elemId;a=a.reset;this.numDirtyFilters=0;0<=this.filterDOMIds.indexOf(b)&&this.element.toggleClass("isDirty",!a)},dedupeSubscribe:function(a,b,e){var c=null,d=null,f=this;this.options.filters.forEach(function(g){f.subscribe(a,{name:g},function(a){f.skipFilter(g)||(!d&&a[b]&&(d=!0),clearTimeout(c),c=setTimeout(function(){e(d);d=null},100))})})},onFilterLabelUpdate:function(a){var b=this.options.filteredLabelTargets&&this.options.filteredLabelTargets.length?
this.options.filteredLabelTargets:this.options.filters;a&&a.name&&b&&b.indexOf&&!(0>b.indexOf(a.name))&&this.options.useFilterLabelHidesReset&&this.resetLink&&this.resetLink.length&&(this.subscribe("filter.label.cleared."+a.name,this.onFilterLabelCleared.bind(this)),this.resetHiddenByLabel=!0,this.resetLink.is(":visible")&&(this.resetWasDirty=!0),this.resetLink.hide())},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.resetHiddenByLabel=!1;this.resetWasDirty&&
(this.resetWasDirty=!1,this.resetLink.show())},toggleFilterSection:function(a){this.element.toggleClass("inactive",!a.visible)},skipFilter:function(a){return!1},initCustomTrackingType:function(){this.options.trackEnabled&&b.VestigoType&&"price-section"===this.options.name&&(this.trackingType=b.VestigoType.FilterType.price)}})})(window.R9,window.jQuery);
(function(c,g){c.createComponentClass("flights.results.filters.TimesFilterSection","common.results.filters.FilterSection",{landingEl:null,legToggleButtonSet:null,setCategoryEvent:"",options:{isMulticity:!1,takeoffLandingTabs:!1,legCount:2},init:function(){this.trackingType=c.VestigoType&&c.VestigoType.FilterType.times;this.base();this.landingEl=this.getChildElement("showLanding");this.legToggleButtonSet=this.getChildElement("legToggle");this.airportsSection=this.getChildElement("airportsSection");
this.setCategoryEvent=this.options.takeoffLandingTabs?"flights.filters.takeoffLanding.setCategory":"flights.filters.multicity.setLeg"},addEventHandlers:function(){this.base();var a=this;this.landingEl.click(this.openLandingSection.bind(this));this.landingEl.keypress(function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.openLandingSection(a)});this.subscribe("resultspage.searchId.changed",function(){a.element.removeClass("expanded");a.landingEl.removeClass("hidden");a.legToggleButtonSet.addClass("hidden")});
this.options.takeoffLandingTabs||this.legToggleButtonSet.radioButtonSet();this.legToggleButtonSet.getWidget().setOption("change",function(b){c.events.publish(a.setCategoryEvent,parseInt(b.value)-1)});this.subscribe("flights.filters.setLeg",function(b){a.legToggleButtonSet.getWidget().setButtonCheckedByValue(b+"")});this.subscribe("search.poll.response",this.handleSearchPollResponse.bind(this))},onPushedStateChange:function(a){var b=a.reset;0<=this.filterDOMIds.indexOf(a.elemId)&&!this.skipFilter(a.name)&&
(this.element.toggleClass("isDirty",!b),this.element.find(".horizontalFilterHead").toggleClass("isDirty",!b))},inlineComponentsReady:function(){this.base();(this.options.isMulticity||this.options.takeoffLandingTabs&&1<this.options.legCount)&&this.setupLegTabs(this.options.legCount)},openLandingSection:function(){this.element.addClass("expanded");this.landingEl.addClass("hidden");c.Analytics.api.trackEvent({category:"Filter",action:"times",label:"show-landing"})},setupLegTabs:function(a){var b=this,
f=this.getChildElement("dropdown_content");this.options.takeoffLandingTabs?1===f.length&&f.addClass("multicity"):this.element.parent().find(".legToggle").addClass("visible");this.legToggleButtonSet.parent().addClass("visible");this.airportsSection.addClass("visible");this.element.addClass("multicity");this.options.isMulticity=!0;this.legCount=a;this.legToggleButtonSet.find("label").each(function(d,e){e=g(e);0===d&&(c.events.publish(b.setCategoryEvent,d),b.legToggleButtonSet.getWidget().setValue(e.prev().val()));
e.toggleClass("active",d<a);b.legToggleButtonSet.getWidget().setButtonEnabledByValue(function(){return d<=b.legCount},d);d===a&&e.addClass("borderless")})},clearMulticityFilters:function(){this.options.isMulticity=!1;this.element.removeClass("multicity");this.legToggleButtonSet.find("label.active").removeClass("active");this.element.parent().find(".legToggle").removeClass("visible");this.airportsSection.removeClass("visible")},clearTakeoffLandingTabs:function(){c.events.publish(this.setCategoryEvent,
-1);this.legToggleButtonSet.parent().removeClass("visible")},handleSearchPollResponse:function(a){a.searchStartedThisPoll&&(this.options.takeoffLandingTabs?a.isOneWay?this.clearTakeoffLandingTabs():this.setupLegTabs(a.legCount):a.isMulticity?this.setupLegTabs(a.legCount):this.clearMulticityFilters(),c.events.publish("flights.filters.multicity",a.isMulticity))},skipFilter:function(a){return!this.element.hasClass("multicity")&&"airports"===a}})})(window.R9,window.jQuery);
(function(d,f){var e=[d.globals.keyCodes.MOUSE_LEFT,d.globals.keyCodes.RETURN,d.globals.keyCodes.SPACE];d.createComponentClass("flights.results.filters.AirlinesFilter","common.results.filters.ValueSetFilter",{appliedFiltersToastShownForSearch:!1,canOpenUserPreferencesPanel:!0,isLoggedIn:null,openUserPreferencesPanelCode:"",userAvoidAirlines:[],options:{addAvoidAirlineUrl:"",isLoggedIn:!1,restoreMultAfterOnly:!1,saveUserPreferencesAvoid:!1,userAvoidAirlines:[],sortOverflowByPrice:!1,messages:{filtersApplied:"",
loginToSavePreferences:"",loginToSavePreferencesSubheading:""}},init:function(){this.base();this.canOpenUserPreferencesPanel=this.options.saveUserPreferencesAvoid;this.isLoggedIn=this.options.isLoggedIn;this.userAvoidAirlines=this.options.userAvoidAirlines},addEventHandlers:function(){this.base();this.options.saveUserPreferencesAvoid&&(this.registerEvent("click keydown","#"+this.id("user-preferences-hide-button"),this.handleUserHideAirlinePanel.bind(this)),this.registerEvent("click keydown","#"+this.id("user-preferences-hide-close"),
this.removeUserHideAirlinePanel.bind(this,!1)),this.registerEvent("click keydown","#"+this.id("user-preferences-account-link"),this.trackEvent.bind(this,"click","p13n-avoid-airline-panel-accountlink")),this.subscribe("search.searchStarted",function(){this.appliedFiltersToastShownForSearch=!1;this.canOpenUserPreferencesPanel=this.options.saveUserPreferencesAvoid}.bind(this)))},update:function(a){this.base(a);var b=this;setTimeout(function(){b.appliedFiltersToastShownForSearch||b.notifyUserAppliedFilters()},
25)},getIgnoreDeselect:function(){return["MULT","flylocal"]},unsetOnlyOption:function(a){this.base(a);null===this.only&&this.options.restoreMultAfterOnly&&(a=this.getRenderedFilterOptions().MULT)&&a.setChecked(1)},notifyUserAppliedFilters:function(){var a=this;this.getState()&&this.userAvoidAirlines&&this.userAvoidAirlines.some(function(b){return 0===a.getState()[b]})&&(d.events.publish("resultspage.notify",{content:a.isLoggedIn?d.template.renderElement("userPreferencesHiddenToast"):this.options.messages.filtersApplied}),
this.appliedFiltersToastShownForSearch=!0)},canAddUserPreferencesPanel:function(a){return this.options.saveUserPreferencesAvoid&&this.canOpenUserPreferencesPanel&&!a.meta&&a.code&&-1===this.userAvoidAirlines.indexOf(a.code)},canRemoveUserPreferencesPanel:function(a){return this.options.saveUserPreferencesAvoid&&!this.canOpenUserPreferencesPanel&&!a.meta&&a.code&&this.openUserPreferencesPanelCode===a.code},addUserHideAirlinePanel:function(a){var b=d.template.renderElement("UserPreferencesHidePanel",
{code:a.state.code,name:a.state.displayValue});a.element.after(b);this.canOpenUserPreferencesPanel=!1;this.openUserPreferencesPanelCode=a.state.code;this.trackEvent("impression","p13n-save-avoid-airline",a.state.code)},removeUserHideAirlinePanel:function(a,b){if(b){if(-1===e.indexOf(b.which))return;this.trackEvent("click","p13n-close-avoid-airline-panel")}this.getChildElement("userPreferencesHidePanel").remove();this.canOpenUserPreferencesPanel=a;this.openUserPreferencesPanelCode=""},filterItemDidChange:function(a,
b,c,d){this.base(a,b,c,d);c&&c.state&&(0===c.state.selected&&this.canAddUserPreferencesPanel(c.state)?this.addUserHideAirlinePanel(c):this.canRemoveUserPreferencesPanel(c.state)&&this.removeUserHideAirlinePanel(!0,null))},getOverflowItems:function(a,b){this.options.sortOverflowByPrice&&a.forEach(function(a){b[a].minPrice&&b[a].minPrice.match(/\d+/g)&&(b[a].minPriceNumeric=parseInt(b[a].minPrice.match(/\d+/g)[0],10))});return this.base(a,b)},getOverflowSorter:function(a){return this.options.sortOverflowByPrice?
function(b,c){b=a[b].minPriceNumeric;c=a[c].minPriceNumeric;return b||c?b&&!c?-1:!b&&c?c:b-c:0}:this.base(a)},handleUserHideAirlinePanel:function(a){if(-1!==e.indexOf(a.which)){var b=this,c=a.currentTarget.dataset;b.isLoggedIn?f.ajax({type:"POST",url:this.options.addAvoidAirlineUrl,data:{code:c.code},headers:{"X-CSRF":d.globals.formtoken}}).then(b.handleUserHideAirlineSuccess.bind(b,a,c.code,c.name)).catch(function(){b.logger.error("Error adding airline to avoid. Airline code: "+c.code);b.trackEvent("failed",
"p13n-save-avoid-airline",c.code)}):(this.trackEvent("opened","p13n-avoid-airline-login-dialog"),d.authentication.showLogin({customHeading:this.options.messages.loginToSavePreferences,customSubheading:this.options.messages.loginToSavePreferencesSubheading,onClose:function(){setTimeout(function(){b.isLoggedIn||b.trackEvent("cancelled-logging-in","p13n-avoid-airline-login-dialog")},1E3);b.removeUserHideAirlinePanel(!0,null)},success:function(){d.events.publish("social.response.loaded",!0);b.isLoggedIn=
!0;b.handleUserHideAirlinePanel(a)}}))}},handleUserHideAirlineSuccess:function(a,b,c){this.removeUserHideAirlinePanel(!0);this.canOpenUserPreferencesPanel=!0;this.userAvoidAirlines.push(b);this.openP13nHiddenToast(c);this.trackEvent("saved","p13n-save-avoid-airline",b)},openP13nHiddenToast:function(a){d.events.publish("resultspage.notify",{content:d.template.renderElement("newUserPreferenceHiddenToast",{name:a})})},trackEvent:function(a,b,c){d.Analytics.api.trackEvent({category:"airlines-filter",
action:a,label:b,value:c})},logUserInteraction:function(a,b){"showall"!==a&&this.base(a,b)},findTrackingResetValue:function(a){return a?!0===a.reset?"all":!a.hasOwnProperty("value")&&!a.hasOwnProperty("reset")&&a.state&&Object.keys(a.state).every(function(b){return 0===a.state[b]||"MULT"===b})?"none":null:null},trackStateChange:function(a){var b=this.findTrackingResetValue(a);b?d.VestigoEvents.filters.flights.airlines(b,d.VestigoType.FilterValueAction.select,{}):this.base(a)}})})(R9,jQuery);
(function(c,d){c.createComponentClass("flights.results.filters.PerLegValueSetFilter","common.results.filters.ValueSetFilter",{activeLegIndex:0,activeLegOverride:null,legsContainer:void 0,legRenderedFilterOptions:void 0,legCount:1,isMulticity:!1,init:function(){this.base();this.legRenderedFilterOptions=[];this.legsContainer=this.getChildElement("legs")},addEventHandlers:function(){var a=this;this.base();this.subscribe(["common.results.filters.activeLeg.changed","flights.filters.multicity.setLeg"],
this.setActiveLegIndex.bind(this));this.subscribe("flights.filters.changeLeg",{id:this.id()},this.changedActiveLegIndex.bind(this));this.subscribe("flights.filters.multicity",function(b){a.isMulticity=b})},inlineComponentsReady:function(){this.isMulticity="m"===c.question.ask("flights.resultspage.oneway")},shouldBeVisible:function(a){return(a=a.legValues)&&a.reduce(function(a,c){return a&&0<Object.keys(c).length},!0)},update:function(a){a=a.legValues;this.legCount=a.length;for(var b=0;b<this.legCount;b++)this.legsContainer.children().length<=
b&&(this.legsContainer.append(d("\x3cdiv class\x3d'leg-%s'/\x3e".format(b))),this.legRenderedFilterOptions.push({})),this.activeLegOverride=b,this.base(a[b]);this.activeLegOverride=null;this.legsContainer.find(".leg-"+this.getActiveLeg()).addClass("active")},cleanupExistingState:function(){this.base();this.legRenderedFilterOptions=[];this.legsContainer.children().remove()},reset:function(a){if(this.isMulticity){a=d.extend({},a,{silent:!0});for(var b=0;b<this.legCount;b++)this.activeLegOverride=b,
this.base(a);this.pushStateChange(null,{reset:!0});c.events.publish("flights.filters.setLeg",1);this.setActiveLegIndex(0)}else this.base(a)},getState:function(){var a={},b=0,c=this.legCount;this.legRenderedFilterOptions.forEach(function(f){b<c&&Object.keys(f).forEach(function(e){var d=f[e].getState();a.hasOwnProperty(e)&&a[e].length===c||(a[e]=Array.apply(null,Array(c)).map(String.prototype.valueOf,"null"));"number"===typeof d&&(a[e][b]=d.toString())});b++});Object.keys(a).forEach(function(b){0===
a[b].filter(function(a){return"null"!==a}).length&&delete a[b]});return 0<Object.keys(a).length?a:null},getOptionsContainer:function(){return this.legsContainer.find(".leg-"+this.getActiveLeg())},getRenderedFilterOptions:function(){var a=this.legRenderedFilterOptions[this.getActiveLeg()];void 0===a&&(a={});return a},getActiveLeg:function(){return null!==this.activeLegOverride?this.activeLegOverride:this.activeLegIndex},changedActiveLegIndex:function(a){a&&this.setActiveLegIndex(a.legIndex)},setActiveLegIndex:function(a){this.activeLegIndex=
-1<a?a:0;this.legsContainer.children().removeClass("active");this.legsContainer.find(".leg-"+this.activeLegIndex).addClass("active")},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&-1<this.name.indexOf(c.VestigoType.FilterType.airports)&&a.changeData&&c.VestigoEvents.filters.flights.airports(this.activeLegIndex,a.changeData.field,this.getTrackingAction(a.changeData.value))}})})(R9,jQuery);
(function(b,d){b.createComponentClass("flights.results.filters.AirportsFilterSection","common.results.filters.FilterSection",{legToggleSetElem:null,legToggleSetWidget:null,lastLegCount:null,enabledForSearch:!1,init:function(){this.trackingType=b.VestigoType&&b.VestigoType.FilterType.airports;this.base();this.legToggleSetElem=this.getChildElement("leg-toggle")},addEventHandlers:function(){this.base();this.subscribe("search.startSearch",this.onSearchStart.bind(this));this.subscribe("flights.filters.setLeg",
this.onSetLegSelection.bind(this));this.subscribe("flights.filters.multicity.setLeg",this.onSetLegSelectionMultiCity.bind(this));this.subscribe("search.poll.response",this.onSearchPollResponse.bind(this))},inlineComponentsReady:function(){this.base();this.legToggleSetElem.length&&(this.legToggleSetWidget=this.legToggleSetElem.styleJamRadioButtonSet({change:this.onChangedLegRadio.bind(this)}).getWidget())},toggleFilterSection:function(a){this.base(a);this.element.closest(".hfilter").toggleClass("inactive",
!a.visible)},onSearchStart:function(){this.enabledForSearch=!1;this.setupLegTabs(0);this.toggleFilterSection({visible:!1})},onChangedLegRadio:function(a){a&&this.triggerChangeLegDisplay(a.value)},onSetLegSelection:function(a){this.legToggleSetWidget&&this.legToggleSetWidget.setButtonCheckedByValue(a+"");this.triggerChangeLegDisplay(a)},onSetLegSelectionMultiCity:function(a){this.legToggleSetWidget&&this.legToggleSetWidget.setButtonCheckedByValue(a+1+"")},triggerChangeLegDisplay:function(a){b.events.publish("flights.filters.changeLeg",
{id:this.id("airports"),legIndex:parseInt(a)-1})},setupLegTabs:function(a){this.lastLegCount=a;if(2>a)this.legToggleSetElem.toggleClass("inactive",!0),this.triggerChangeLegDisplay(0);else if(this.legToggleSetElem.toggleClass("inactive",!1),this.legToggleSetWidget)for(var c=this.legToggleSetWidget.getAllRadios().length,b=0;b<c;b++)this.legToggleSetWidget.setButtonEnabledByValue(b+1+"",b<a)},onSearchPollResponse:function(a){var b=a&&a.isMulticity?parseInt(a.legCount):0;a=!!(a&&a.filtersData&&a.filtersData.airports&&
a.filtersData.airports.enabled);if(this.enabledForSearch!==a||b!==this.lastLegCount)this.enabledForSearch=a,this.setupLegTabs(a&&!isNaN(b)?b:0)}})})(R9,jQuery);
(function(d,n){d.createComponentClass("common.results.filters.SimpleRangeFilter","common.results.filters.Filter",{options:{min:void 0,max:void 0,step:1,snap:!1,maxValueSlider:!1,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",duration:!1,durationFormat:"",logarithmic:!1,useTextInput:!1,isMultiValueSet:null,triggerFilteredLabel:!1,useAndUp:!1,andUpString:""},leftRange:null,rightRange:null,minRange:null,maxRange:null,slider:void 0,sliding:!1,init:function(){this.base();this.eventPrefix=
"filters.%s.".format(this.options.name);this.initSliderComponents()},getFormatFcn:function(){return this.options.duration?this.formatDuration.bind(this):this.formatThousands.bind(this)},initSliderComponents:function(){var a=this,b=this.getFormatFcn();this.slider=d.question.ask("RangeFilterSlider.init."+this.id("slider"),{step:this.options.step,snapToValue:this.options.snap,maxValueSlider:this.options.maxValueSlider,displayFormat:this.options.displayFormat,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,
triggerFilteredLabel:this.options.triggerFilteredLabel,useAndUp:this.options.useAndUp,andUpString:this.options.andUpString,formatValues:function(a){return a.map(b)},onStart:function(){a.sliding=!0},onStop:function(b,e,d){a.logUserInteraction(null,b,d);d&&(b={},a.options.maxValueSlider?(a.rightRange=e[0],b.field="right"):(b.field=a.leftRange!==e[0]?"left":"right",a.leftRange=e[0],a.rightRange=e[1]),b.value=a[-1<b.field.indexOf("left")?"leftRange":"rightRange"],a.setLastUserInteraction(!0),a.pushStateChange(null,
{changeData:b}));a.sliding=!1;a.publishHoverState(!1)}});this.addSliderEventHandlers()},addEventHandlers:function(){this.base();var a=this;this.subscribe(this.eventPrefix+"resetitem",function(a){d.events.publish("filter.reset",{name:a})});this.subscribe(this.eventPrefix+"setMaxValue",function(b){a.receiveMaxValue(b.minValue)});this.subscribe(this.eventPrefix+"updateRange",this.updateRange.bind(this))},receiveMaxValue:function(a){this.slider.receiveMaxValue(a)},updateRange:function(a){if(a){var b=
!1;a.leftRange&&a.leftRange>this.slider.minRange&&(this.leftRange=a.leftRange,b=!0);a.rightRange&&a.rightRange<this.slider.maxRange&&(this.rightRange=a.rightRange,b=!0);b&&this.pushStateChange()}},addSliderEventHandlers:function(){var a=this;this.slider.element.on("mouseenter",this.publishHoverState.bind(this,!0));this.slider.element.on("mouseleave",function(){a.sliding||a.publishHoverState(!1)});this.subscribe("sliders.redraw",function(){d.dom.schedule(function(){a.slider.widget.drawActiveRange()})})},
destroy:function(){this.base();this.slider=void 0},logUserInteraction:function(a,b,c){if("ga"===this.options.loggingType){a="reset"===a?"showall":"";var e=null!=this.options.loggingAction?this.options.loggingAction:this.name;c&&(a=n(b.target).hasClass("right")?"max-adjust":"min-adjust");this.base({category:this.trackCategory,action:e,label:this.options.loggingLabel||a})}else this.base(a)},setDisabled:function(a){this.base(a);d.dom.toggleOneClass(this.slider.widget.element,"Disabled",a)},shouldBeVisible:function(a){return!(isNaN(parseInt(a.minRange))||
isNaN(parseInt(a.maxRange)))},willReset:function(){this.slider.setLeftRange(this.slider.minRange,!0);this.slider.setRightRange(this.slider.maxRange,!0)},cleanupExistingState:function(){this.slider.leftRange=this.slider.rightRange=this.slider.minRange=this.slider.maxRange=void 0},update:function(a){var b=this,c=parseInt(a.minRange),e=parseInt(a.maxRange),g=parseInt(a.leftRange),f=parseInt(a.rightRange),h=null===this.slider.leftRange||void 0===this.slider.leftRange||void 0===this.slider.minRange||this.slider.leftRange===
this.slider.minRange,k=null===this.slider.rightRange||void 0===this.slider.rightRange||void 0===this.slider.maxRange||this.slider.rightRange===this.slider.maxRange,l=!0,m=!0;isNaN(c)||isNaN(e)||(this.options.maxValueSlider&&c!==this.slider.leftRange&&(h=!0),this.options.maxValueSlider&&f!=this.slider.rightRange&&d.config.getBoolean("ui.maxValueSlider.fix",!0)&&(k=!0),this.minRange=c,this.maxRange=e,isNaN(g)?h?this.leftRange=c:l=!1:this.leftRange=g,isNaN(f)?k?this.rightRange=e:m=!1:this.rightRange=
f,d.dom.schedule(function(){b.options.collapsible||(a.updateTitle?b.getChildElement("title").html(b.options.title2):b.getChildElement("title").html(b.options.title));b.slider.setMinRange(b.minRange);b.slider.setMaxRange(b.maxRange);l&&b.slider.setLeftRange(b.leftRange,!0);m&&b.slider.setRightRange(b.rightRange,!0);b.element.removeClass("empty")}))},getState:function(){var a={max:this.rightRange};this.options.maxValueSlider||(a.min=this.leftRange);return a},getStateForFilterHistory:function(){var a=
{};this.slider.isRightRangeManipulated()&&(a.max=this.rightRange);!this.options.maxValueSlider&&this.slider.isLeftRangeManipulated()&&(a.min=this.leftRange);return{displayName:this.options.title,type:d.question.ask("filters.FilterHistory.type.slider"),subType:this.getHistoryFilterViewSubtype(),state:a,displayValue:{min:a.min&&this.formatValues([a.min]),max:a.max&&this.formatValues([a.max])}}},formatThousands:function(a){if("undefined"===typeof a||null===a)return a;var b=this.options.thousandsDelimiter,
c=this.options.decimalDelimiter,e=a.toString().split(".");a=e[0];c=1<e.length?c+e[1]:"";e=/(\d+)(\d{3})/;if(0<b.length)for(;e.test(a);)a=a.replace(e,"$1"+b+"$2");return a+c},formatDuration:function(a){var b=a%60;10>b&&(b="0"+b);return d.Common.Utils.String.replaceArgs(this.options.durationFormat,(a-b)/60,b)},getHistoryFilterViewState:function(a){var b=this.getState(),c=!1,e=!1,d=function(a,b){a()?(null==e&&(e=!0),c=!1):b()&&null==c&&(c=!0)};a.min&&a.max?d(function(){return b.max>a.max&&b.min&&b.min<
a.min},function(){return b.min&&a.min==b.min&&a.max==b.max}):a.min?d(function(){return b.min<a.min&&a.min<b.max},function(){return b.min==a.min}):a.max&&d(function(){return b.max>a.max&&a.max>b.min},function(){return b.max==a.max});return{isAlreadyApplied:c,disabled:!e}},setStateFromPrevious:function(a){var b="left"===a.key;a=a.reset?b?this.slider.minRange:this.slider.maxRange:parseInt(a.value);var c=this.slider.widget.getValues();b?(this.slider.setLeftRange(a),this.leftRange=c[0]=a):(this.slider.setRightRange(a),
this.rightRange=c[1]=a);this.slider.widget.setValues(c)},updatePreviousFilters:function(a){a?(a.hasOwnProperty("min")&&this.previousFilters.hasOwnProperty("left")&&this.previousFilters.left!==a.min&&this.removePreviousFilter("left"),a.hasOwnProperty("max")&&this.previousFilters.hasOwnProperty("right")&&this.previousFilters.right!==a.max&&this.removePreviousFilter("right")):this.removePreviousFilter()},getHistoryFilterViewSubtype:function(){return d.question.ask("filters.FilterHistory.type.numeric")},
formatValues:function(a){var b=this;return a.map(function(a){return b.formatDuration(a)})},trackStateChange:function(a){if(this.trackStateChangeEnabled(a)){var b=d.VestigoType,c=d.VestigoEvents.filters;switch(this.name){case b.FilterType.legdur:case b.FilterType.layoverdur:c.flights.duration(this.slider.leftRange,this.slider.rightRange,b.DurationType[this.name]);break;case b.FilterType.price:c.shared.priceRange(this.slider.leftRange,this.slider.rightRange,d.VestigoType.PriceType[d.question.ask("results.priceType")]);
break;default:this.base(a)}}}})})(R9,jQuery);
(function(a,b){a.createComponentClass("flights.results.filters.FlightQualityFilterSection","common.results.filters.FilterSection",{init:function(){this.trackingType=a.VestigoType&&a.VestigoType.FilterType.flightquality;this.base()}})})(R9,jQuery);
(function(a,b){a.createComponentClass("flights.results.filters.FlightEquipmentSection","common.results.filters.FilterSection",{init:function(){this.trackingType=a.VestigoType&&a.VestigoType.FilterType.aircraft;this.base()}})})(R9,jQuery);
(function(c){c.createComponentClass("flights.results.filters.BookingProvidersFilter","common.results.filters.ValueSetFilter",{options:{directOnlyEnabled:!1,directOnlyKey:"",directBookingToolTipText:"",featureClass:""},addFilterItem:function(b,a,c){this.base(b,a,c);this.options.directOnlyEnabled&&(b=this.getRenderedFilterOptions()[this.options.directOnlyKey])&&(a=0<=this.options.featureClass.indexOf("kayak-flights"),b.element.toolTip({content:this.options.directBookingToolTipText,position:"top",orientation:a?
"start":"middle",showImmediately:!1,extraClass:a?"uikit":"",size:a?"uikit":""}),b.element.addClass("directProvidersOnlyOption"))}})})(R9);
(function(d,e){d.createComponentClass("flights.results.filters.SpecificLegFilter","common.results.filters.Filter",{name:"specificleg",state:null,specificLegs:null,activeLeg:-1,init:function(){this.base();this.specificLegs={};this.state={}},addEventHandlers:function(){this.base();var a=this;this.subscribe("common.results.filters.specificleg.change",this.handleSpecificLegChange.bind(this));this.subscribe("common.results.filters.activeLeg.changed",function(b){a.activeLeg=b})},handleSpecificLegChange:function(a){a.checked?
this.addSpecificLeg(a):this.removeSpecificLeg(a);this.pushStateChange()},addSpecificLeg:function(a){var b=this;a.removeOld&&Object.keys(this.state).forEach(function(c){c=c.split(":");parseInt(c[1])===a.leg&&b.removeSpecificLeg({signature:c[0],leg:c[1]})});this.state[a.signature+":"+a.leg]=!0;this.specificLegs[a.leg]=a.resultId},removeSpecificLeg:function(a){var b=a.signature+":"+a.leg;this.state.hasOwnProperty(b)&&(delete this.state[b],delete this.specificLegs[a.leg])},cleanupExistingState:function(){this.specificLegs=
{};this.state={}},reset:function(a){var b=d.question.ask("flights.resultspage.currentview");a&&"showAll"===a.type&&(-1<this.activeLeg||"segment"===b||"customticket"===b)||this.base(a)},willReset:function(){this.specificLegs={};this.state={};this.activeLeg=-1},update:function(a){a.hasOwnProperty("signatures")&&(this.cleanupExistingState(),Object.keys(a.signatures).forEach(function(b){this.state[a.signatures[b]+":"+b]=!0;a.hasOwnProperty("legs")&&(this.specificLegs[b]=a.legs[b])},this))},getState:function(){var a=
Object.keys(this.state);return 0<a.length?{signatures:a,legs:this.specificLegs}:null}})})(R9,jQuery);
(function(b){b.createComponentClass("common.results.filters.FilterList",{filtersSection:null,filterTabs:null,placeholderList:null,isPlaceholderEnabled:null,filterLayout:{},options:{searchCompleted:!1,primaryFilterList:[],moreFilterList:[],hideDelay:0},init:function(){this.filtersSection=this.getChildElement("filtersSection");this.placeholderList=this.getChildElement("placeholderList");this.filterTabs=this.element.find(".filterTab");this.isPlaceholderEnabled=this.placeholderList&&0<this.placeholderList.length;
this.hideFilterList()},addEventHandlers:function(){var a=this;this.subscribe("resultspage.streaming.done",this.showFilterList.bind(this));this.subscribe(["search.startSearch","resultspage.streaming.start"],this.streamingStarted.bind(this));this.subscribe("resultspage.filtersData.changed",this.handleFilterResponse.bind(this));this.subscribe("search.searchFailed",this.hideAll.bind(this));this.subscribe("resultspage.filterList.show",this.showFilterList.bind(this));this.filterTabs.keydown(this.handleTabKeydown.bind(this));
this.element.on("click",".fullscreen-dialog-header",function(){a.element.toggleClass("active")})},handleFilterResponse:function(a){a&&Object.keys(a).length&&a[Object.keys(a)[0]].enabled&&(this.showFilterList(),b.events.publish("resultspage.filters.show"))},showFilterList:function(){this.element.removeClass("loading");this.filtersSection.removeClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden")},handleTabKeydown:function(a){switch(a.which){case b.globals.keyCodes.RETURN:case b.globals.keyCodes.SPACE:a.currentTarget.click();
break;case b.globals.keyCodes.RIGHT:this.focusNextTab($(a.currentTarget));break;case b.globals.keyCodes.LEFT:this.focusPrevTab($(a.currentTarget))}},focusNextTab:function(a){!a.next().is(a)&&a.next().is(".filterTab")?a.next().click().focus():this.filterTabs.eq(0).click().focus()},focusPrevTab:function(a){!a.prev().is(a)&&a.prev().is(".filterTab")?a.prev().click().focus():this.filterTabs.eq(-1).click().focus()},streamingStarted:function(a){"undefined"!==typeof a&&a.preserveFilters||(this.options.hideDelay?
setTimeout(this.hideFilterList.bind(this),this.options.hideDelay):this.hideFilterList())},hideFilterList:function(){this.element.addClass("loading");this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.removeClass("hidden");b.events.publish("resultspage.filters.hide")},hideAll:function(){this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden");b.events.publish("resultspage.filters.hide")}})})(R9);
(function(b,d){b.config.getBoolean("ui.horizon.flights.filters.cabinHoist.target","times-section");b.createComponentClass("flights.results.filters.FlightFilterList","common.results.filters.FilterList",{searchId:void 0,initialSearchId:null,forceAjaxUpdateInterval:null,priceFilterStub:null,filterWrappers:null,filtersContainer:null,myFilters:null,flexOptions:null,airportsPrevFilter:null,airportsFilterTop:!1,options:{isMulticity:!1,travelers:1,legCount:2,priceTypeEnabled:!1,filterTabView:!1},init:function(){var a=
this;this.base();if(this.options.searchCompleted)var e=b.events.subscribe("resultspage.filtersData.changed",function(){a.showFilterList();b.events.unsubscribe("resultspage.filtersData.changed",e)});this.filterWrappers={};this.element.find(".filterWrapper").each(function(){a.filterWrappers[this.getAttribute("data-name")]=d(this)});this.options.multiAirportFilterTop&&(this.options.displayFlexOptions?this.flexOptions=this.element.find(".flexoptions")[0]:this.options.displayMyFilters?this.myFilters=this.element.find(".myfilters")[0]:
this.filtersContainer=this.element.find(".filterContainer")[0],this.airportsPrevFilter=this.element.find(".filterContainer .filterWrapper:nth-child("+(this.options.isMultiAirport?this.options.airportsFilterPosition+1:this.options.airportsFilterPosition)+")")[0],this.options.isMultiAirport&&(this.airportsFilterTop=!0))},addEventHandlers:function(){this.base();var a=this,e=this.getChildElement("topList"),f=this.getChildElement("moreList");this.subscribe(["search.startSearch","search.searchFailed"],
function(){a.options.searchCompleted=!1});this.options.multiAirportFilterTop&&this.subscribe("resultspage.multiAirport.changed",this.setAirportsFilterTop.bind(this));this.setupPriceFilterPositionHandlers();this.getChildElement("moreToggle").click(function(){a.element.toggleClass("expanded");a.publishMoreFilterToggle(a.element.hasClass("expanded"))});this.getChildElement("filterTabs").on("click",".filterTab",function(){if(!d(this).is(".selectedTab")){var c=d(this).is(".moreListTab");a.element.toggleClass("show-more-tab",
c);a.element.find(".filterTab").toggleClass("selectedTab").attr("aria-selected",function(a,c){return"true"===c?"false":"true"});c&&f.removeClass("hidden").attr("aria-expanded",!0);a.options.filterTabView&&(e.attr("aria-expanded",!c),f.attr("aria-expanded",c));a.publishMoreFilterToggle(c)}});this.getChildElement("airlinefees").click(function(){b.Analytics.api.trackEvent({category:"Filters",action:"airlinefees"})});this.subscribe("search.poll.response",function(c){c.hasOwnProperty("isMulticity")&&a.setMulticityMode(c.isMulticity);
c.hasOwnProperty("showPlusMinusThree")&&a.getChildElement("flexmatrix").parent().toggleClass("hidden",!c.showPlusMinusThree);c.hasOwnProperty("showAirlineMatrix")&&a.getChildElement("airline-matrix").toggleClass("hidden",!c.showAirlineMatrix);c.hasOwnProperty("showAirlineFees")&&a.getChildElement("airlinefees").toggleClass("hidden",!c.showAirlineFees)});this.subscribe("resultspage.searchId.changed",function(c){a.searchId=c.searchId});this.getChildElement("flexmatrix").off("click").click(function(){f.hasClass("Disabled")||
b.events.publish("flights.results.toggle.flex_matrix")});this.getChildElement("airline-matrix").off("click").click(function(){f.hasClass("Disabled")||b.events.publish("flights.results.toggle.airline_matrix")});this.subscribe("filters.disabled",function(a){f.toggleClass("Disabled",a).find("a.matrix, .flex-features \x3e a").attr("disabled","disabled")});this.subscribe("resultspage.streaming.done",function(c){a.element.find(".dispCt").removeClass("hidden")})},handleFilterResponse:function(a){this.options.multiAirportFilterTop&&
this.airportsFilterTop&&!this.options.displayMyFilters?a&&a.airports&&a.airports.enabled&&(this.showFilterList(),b.events.publish("resultspage.filters.show")):this.base(a)},setupPriceFilterPositionHandlers:function(){var a=b.config.getBoolean("ui.non-price-sort-price-filter.enabled",!0),e=this.filterWrappers.price;if((this.options.priceTypeEnabled||a)&&e){e.prev();var f=/duration|depart|arrive/,c=this,g={sortCode:b.question.ask("resultspage.sortMode.get"),travelers:this.options.travelers},d=function(b,
d){d=null;a&&b.hasOwnProperty("sortCode")&&f.test(b.sortCode)?d=c.filterWrappers.stops:c.options.priceTypeEnabled&&b.hasOwnProperty("travelers")&&1<b.travelers&&(d=c.filterWrappers["airlines-section"]);d&&!e.prev().is(d)&&(e.detach().insertAfter(d),e.children().addClass("open"))};this.options.priceTypeEnabled&&this.subscribe("search.startSearch",function(a){g.travelers=a.travelers;d(g)});a&&this.subscribe("resultsHeader.sortType.set",function(a){g.sortCode=a.sortCode;d(g)});d(g)}},streamingStarted:function(a){this.options.searchCompleted||
this.base(a);this.element.find(".dispCt").addClass("hidden")},publishMoreFilterToggle:function(a){b.Analytics.api.trackEvent({category:"Filters",action:"more-filters",label:a?"show":"hide"});window.setMetaCookie("showAllFilters.flight",a?"true":"false");b.events.publish("sliders.redraw");b.events.publish("moreFilters.toggle",a)},setMulticityMode:function(a){a&&this.getChildElement("airports").hide()},setFilterMatrixView:function(a,b){var e=d("#aboveHeaderContainer");d("html, body").animate({scrollTop:0},
500);"plusminusthree"===a?(this.isFlexOpen=b,this.isAirlineMatrixOpen=!b):"airlinestops"===a&&(this.isAirlineMatrixOpen=b,this.isFlexOpen=!b);e.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")});b&&e.addClass("vm-"+a)},toggleAirlineMatrix:function(a){this.setFilterMatrixView("airlinestops",a);this.airlineMatrixLoaded?b.events.publish("flights.results.airlinestops.show",a):b.events.publish("flights.resultspage.getairlinematrix");this.logMatrixInteraction("airlinestops",a)},togglePlusMinusThree:function(a){this.setFilterMatrixView("plusminusthree",
a);this.flexDialogLoaded?b.events.publish("flights.results.flexmatrix.show",a):b.events.publish("flights.resultspage.getflex");this.logMatrixInteraction("plusminusthree",a)},setAirportsFilterTop:function(a){if(a!==this.airportsFilterTop){var b=this.filterWrappers["airports-section"];a?this.options.displayFlexOptions?b.detach().insertAfter(this.flexOptions):this.options.displayMyFilters?b.detach().insertAfter(this.myFilters):b.detach().prependTo(this.filtersContainer):b.detach().insertAfter(this.airportsPrevFilter);
this.airportsFilterTop=a}},logMatrixInteraction:function(a,d){var e=d?"show":"hide",c=a;"plusminusthree"==a&&(c="fleview-plusminus");"airlinestops"==a&&(c="airlinematrix",e=d?"open":"close");b.Analytics.api.trackEvent({category:"Filters",action:c,label:e});b.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:a,value:d?"true":"false"})}})})(R9,jQuery);
(function(b,c){b.createComponentClass("common.kn.Display",{options:{preventRegisterForSmallDevices:!1},addEventHandlers:function(){var a=this;this.subscribe("displayads.register",{type:a.options.type},function(b){a.registerDisplay()});a.options.destroyable&&this.subscribe("displayads.destroy",function(){b.events.publish("displayad.sra.destroy",a.getSlotParams())});b.globals.testMode&&(this.subscribe("displayads.finishloading",this.id(),function(){a.element.attr(a.dataTestTag("display-ad-status-completed"),
!0);a.element.attr(a.dataTestTag("display-ad-status-error"),!1)}),this.subscribe(["displayads.loading","displayad.reset"],this.id(),function(){a.element.attr(a.dataTestTag("display-ad-status-completed"),!1);a.element.attr(a.dataTestTag("display-ad-status-error"),!1);a.element.attr(a.dataTestTag("display-ad-property-hidden"),!0)}),this.subscribe("displayads.error",this.id(),function(){a.element.attr(a.dataTestTag("display-ad-status-completed"),!1);a.element.attr(a.dataTestTag("display-ad-status-error"),
!0)}),this.subscribe("displayads.container.hide",this.id(),function(){a.element.attr(a.dataTestTag("display-ad-property-hidden"),!0)}),this.subscribe("displayads.container.show",this.id(),function(){a.element.attr(a.dataTestTag("display-ad-property-hidden"),!1)}))},inlineComponentsReady:function(){this.options.lazyLoad||this.registerDisplay()},registerDisplay:function(){this.options.preventRegisterForSmallDevices&&window.innerWidth<b.globals.breakPoints.m||b.events.publish("displayad.sra.register",
c.extend(this.getSlotParams(),this.options))},destroy:function(){b.events.publish("displayad.sra.destroy",this.getSlotParams());b.globals.testMode&&b.events.publish("displayad.reset",this.id());this.base()},getSlotParams:function(){return{adDivId:this.id()}}})})(R9,jQuery);
(function(f,c){var h=f.config.getBoolean("ui.horizon.rails.fuzzyComparisons",!0);f.createComponentClass("base.results.Rail",{options:{pinnable:!0,sticky:!1,debug:!1,debounceDelay:5,handleHorizontalScroll:!0,repositionTimeout:200,fixedTopPosition:0,preventDynamicPositioning:!1,defaultRailWidth:300,isBusinessMode:!1,appliedTravelPolicyIds:[],isOneWay:!1},prevScroll:0,upScroll:!1,stickTop:!1,stickBottom:!1,originalNode:null,staticPosition:0,pinnedContentHeight:0,enabled:!0,isFullScreenMapV3:!1,init:c.noop,
addEventHandlers:c.noop,inlineComponentsReady:function(){var a=this;a.originalNode=a.element.get(0);this.bindWindowEvents();this.element.hasClass("fullscreen-drawer")&&(this.isFullScreenMapV3=!0);this.options.pinnable&&this.subscribe("resultspage.streaming.done moreFilters.toggle filterTab.changed filter.overflow.toggle displayad.loaded textad.loaded pinnedContent.heightChanged horizon.filters.opened resultspage.requestResults.completed hotels.results.dualViewMap.finished-closing-animation horizon.filters.FiltersDialog.itemToggled".split(" "),
function(){a.onScroll()});this.subscribe("pinnedContent.enable",function(b){a.enabled=b});this.subscribe(["pinnableBar.pinnedChange","pinnedContent.heightChanged"],function(){a.setPinnedContentHeight()});this.subscribe("pinnedContent.reset",function(){a.resetPosition()});this.subscribe("rail.update.preventDynamicPositioning",this.updatePreventDynamicPositioning.bind(this))},onScroll:function(){!1!==this.enabled&&(this.isRailAttached()?this.handleScroll():this.unbindWindowEvents())},handleScroll:function(){var a=
this.getWindowScroll(),b=this.getParentScroll();this.upScroll=this.prevScroll>a;this.prevScroll=a;(a=this.getPositionCSS(a,b,this.isElementTallerThanScreen()))&&this.element.css(a)},unbindWindowEvents:function(){c(window).off("scroll.pinrails-"+this.id());c(window).off("resize.pinrails-"+this.id())},bindWindowEvents:function(){var a;this.options.pinnable&&(0<this.options.repositionTimeout&&this.element.css("transition","transform %sms ease-in-out".format(this.options.repositionTimeout)),a=0<this.options.debounceDelay?
f.Common.Utils.debounce(this.onScroll.bind(this),this.options.debounceDelay):this.onScroll.bind(this),this.registerEvent("scroll.pinrails-"+this.id(),c(window),a),this.registerEvent("resize.pinrails-"+this.id(),c(window),a))},testBottom:function(a,b){return b?a<this.getParentHeight()-this.getWindowHeight():a+this.getElementHeight()<this.getParentHeight()},testTop:function(a,b){return a>this.getParentTop()-this.pinnedContentHeight-this.options.fixedTopPosition},isElementTallerThanScreen:function(){return this.getElementHeight()>
this.getWindowHeight()},calculateScrollPosition:function(a,b){return!b||this.upScroll&&this.fuzzyCompare(this.getElementTop()-this.getParentTop()-this.pinnedContentHeight,a)?{position:"top"}:!this.upScroll&&this.fuzzyCompare(a+this.getWindowHeight(),this.getElementBottom()-this.getParentTop())?{position:"bottom"}:{translate:this.staticPosition}},fuzzyCompare:function(a,b){if(!h)return a>=b;a-=b;return 0<a||1>=Math.abs(a)},resetPosition:function(){var a=c.extend(!0,{},{position:"relative",left:"unset",
top:"auto",bottom:"auto"},this.makeTransformCSS("translate(0,0)"));this.element.css(a)},getPositionCSS:function(a,b,d){if(!this.isRailSticky()&&!this.isFullScreenMapV3){var g=0,e={position:"relative",top:"auto",left:"unset",bottom:"auto","padding-top":""};a=this.testTop(a,d);var f=this.testBottom(b,d);this.staticPosition=this.getElementTop()-this.getParentTop();if(a&&f)if(b=this.calculateScrollPosition(b,d),b.translate&&(g=b.translate),b.position){if(this.options.preventDynamicPositioning)return;
"top"===b.position?(e={position:"fixed",left:"inherit",top:this.options.fixedTopPosition,bottom:"auto",width:this.getParentWidth()},g=this.pinnedContentHeight):(e={position:"fixed",left:"inherit",bottom:0,top:"auto",width:this.getParentWidth()},g=0)}else e=c.extend({},e);else g=a?this.getParentHeight()-this.getElementHeight():0,e=c.extend({},e);b="translateY(%spx)".format(Math.max(0,g));this.options.handleHorizontalScroll&&"fixed"===e.position&&(d=this.getLeftScroll(),0<d&&(b="translate(-%spx, %spx)".format(d,
g)));return c.extend({},e,this.makeTransformCSS(b))}},getParentWidth:function(){return this.element.parent().width()},makeTransformCSS:function(a){return{msTransform:a,transform:a}},destroy:function(){this.unbindWindowEvents();this.base()},isRailAttached:function(){return this.element&&c.contains(window.document,this.originalNode)},isRailSticky:function(){var a=this.element.css("position");return"sticky"===a||"-webkit-sticky"===a},getElementHeight:function(){return Math.round(this.element.outerHeight())},
getElementBottom:function(){return this.getElementTop()+this.getElementHeight()},getElementTop:function(){return Math.round(this.element.offset().top)},getWindowHeight:function(){return Math.round(c(window).outerHeight())},getWindowScroll:function(){return Math.round(c(window).scrollTop())},getParentHeight:function(){return Math.round(this.element.parent().outerHeight())},getParentTop:function(){return Math.round(this.element.parent().offset().top)},getLeftScroll:function(){return Math.round(c(window).scrollLeft())},
getParentBottom:function(){return this.getParentTop()+this.getParentHeight()},getParentScroll:function(){return this.getWindowScroll()-this.getParentTop()},setPinnedContentHeight:function(){var a=f.question.ask("pinnedContent.height");null!==a?this.pinnedContentHeight=a:0!==this.pinnedContentHeight&&(this.pinnedContentHeight=0)},updatePreventDynamicPositioning:function(a){a&&a.hasOwnProperty("preventDynamicPositioning")&&(this.options.preventDynamicPositioning=a.preventDynamicPositioning)},subscribeForUpdatingPolicyInfo:function(a,
b){if(this.options.isBusinessMode){var d=this,c=this.getChildElement(b);this.subscribe("search.poll.response",function(b){b=d.getNewPolicies(b.appliedTravelPolicyIds);b.length&&(Array.prototype.push.apply(d.options.appliedTravelPolicyIds,b),f.ajax.execute("common/results/mercury/"+a,{data:{appliedTravelPolicyIds:JSON.stringify(d.options.appliedTravelPolicyIds),isOneWay:d.options.isOneWay},appendTo:c,replace:!0,afterScript:function(){c.show()}}))});this.subscribe("search.startSearch",function(a){d.options.appliedTravelPolicyIds=
[];d.options.isOneWay=!!a&&!!a.oneway;c.hide()})}},getNewPolicies:function(a){if(!a)return[];var b=this.options.appliedTravelPolicyIds;if(!b)return a;var c=[];a.forEach(function(a){-1===b.indexOf(a)&&c.push(a)});return c}})})(R9,jQuery);
(function(c,d){c.createComponentClass("flights.results.FlightLeftRail","base.results.Rail",{priceAlertsEnabled:!0,addEventHandlers:function(){var a=this;this.base();this.subscribe("search.searchFailed",function(){a.element.addClass("searchFailed")});this.subscribe("resultspage.refreshed",function(){a.element.removeClass("searchFailed")});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setAlertsEnabled(b.enabled&&b.visible)})},setAlertsEnabled:function(a){this.getChildElement("priceAlertsContainer").css("display",
a?"block":"none");this.priceAlertsEnabled=a}})})(R9,jQuery);
(function(b,c){b.createWidgetClass("loader.AriaLoadMessage",{options:{message:""},init:function(){this.message=this.getChildElement("message")},deactivateLoadMessage:function(a){this.message.text(a);this.message.attr("aria-label",a)},activateLoadMessage:function(a){"undefined"!==typeof a?this.message.text(a):this.message.text(this.options.message);"undefined"!==typeof a?this.message.attr("aria-label",a):this.message.attr("aria-label",this.options.message)}})})(R9,jQuery);
(function(b){b.createComponentClass("common.results.CurrencyConversionInfo",{options:{vertical:null,dialogContainerId:"currencyConversionInfoDialogContent",linkSelector:"a.dialog",collapseButtonEnabled:!1},dialog:null,addEventHandlers:function(){this.base();var a=this;this.element.find(this.options.linkSelector).click(function(b){b.preventDefault();a.showDialog()});this.options.collapseButtonEnabled&&a.getChildElement("expand-disclaimer-trigger").click(function(){a.element.toggleClass("collapsed");
a.getChildElement("read-more").toggleClass("hidden");a.getChildElement("collapse").toggleClass("hidden")})},destroyDialog:function(){this.dialog&&(this.dialog.close(),this.dialog=null)},showDialog:function(){this.destroyDialog();this.dialog=this.getChildElement(this.options.dialogContainerId).dialog({}).getWidget();this.dialog.open()}})})(R9);
(function(a){a.createComponentClass("common.results.UnconfirmedAccountWarning",{init:function(){this.dialog=this.getChildElement("dialog").dialog({}).getWidget();this.footerLink=this.getChildElement("footerLink")},addEventHandlers:function(){this.subscribe("common.results.unconfirmedWarning",this.setUpDialog.bind(this))},setUpDialog:function(a){this.email=a.email;a.sendEmailBeforeOpeningDialog&&this.resendConfirmationEmail();this.dialog.open()},resendConfirmationEmail:function(){a.events.publish("common.results.resendConfirmationEmail",
{email:this.email})}})})(R9);
(function(d,f){d.createComponentClass("flights.results.FlightQueryAlerts",{options:{warnings:[],openCovidBorderModal:!1,covidBorderModalCode:""},dialog:null,addEventHandlers:function(){var a=this;this.registerEvent("click",this.element.find(".js-link"),this.handleLinkClick.bind(this));this.subscribe("resultspage.streaming.done",this.logImpressions.bind(this));this.subscribe("resultspage.cleanup",function(){a.removeDialog();a.element.remove();a.destroy()})},openDialog:function(){this.dialog||(this.dialog=
this.getChildElement("query-alerts-dialog").dialog({renderInline:!0,modal:!0,isAlertDialog:!0}).getWidget());this.dialog&&this.dialog.open()},removeDialog:function(){this.dialog&&(this.dialog.destroy(),this.dialog.element.remove())},getWarning:function(a,b){return(b=f(b.target).closest(".js-warning").data("code"))&&-1!==b.indexOf(a)&&this.options.warnings.find(function(b){return-1!==b.code.indexOf(a)})},handleLinkClick:function(a){if(f(a.target).hasClass("js-modal-trigger"))this.options.openCovidBorderModal&&
f(a.target).closest(".js-warning").data("code")===this.options.covidBorderModalCode?this.openDialog():(d.events.publish("flights.results.flexibleBookingInfo.open"),(a=this.getWarning("flexible",a))&&this.logEvent(a.code,"clicked","modal-trigger"));else{var b=this.getWarning("mixed-cabin",a);if(b){var c=-1<b.code.indexOf("excluded")?1:0;d.events.publish("filters.cabin..setchecked.force",{selected:c});this.logEvent(b.code,"clicked","link")}var e=this.getWarning("beijing",a);if(e){if(b=["PEK","PKX"].find(function(a){return!e.code.includes(a.toLowerCase())}))c=
-1<e.code.indexOf("excluded")?1:0,d.events.publish("filters.airports."+b+".setchecked.force",{selected:c});this.logEvent(e.code,"clicked","link")}(a=this.getWarning("CORONAVIRUS",a)||this.getWarning("COVID",a))&&this.logEvent(a.code,"clicked","link")}},logImpressions:function(){var a=this;this.options.warnings.forEach(function(b){a.logEvent(b.code,"impression")});1<this.options.warnings.length&&this.logEvent("multipleAlerts","impression")},logEvent:function(a,b,c){a={category:"queryAlerts",action:b,
value:a};c&&(a.label=c);d.Analytics.api.trackEvent(a)}})})(R9,jQuery);
(function(b,e){b.createComponentClass("flights.results.scripts.FlightAboveHeaderContent",{options:{searchId:void 0,flexDialogLoaded:!1,airlineMatrixLoaded:!1},flexDialogLoaded:!1,airlineMatrixLoaded:!1,aboveHeadContainer:null,flexMatrixWrapper:null,airlineWrapper:null,init:function(){this.aboveHeadContainer=this.element.closest("#aboveHeaderContainer");this.flexMatrixWrapper=this.element.find(".flexMatrixWrapper");this.airlineWrapper=this.element.find(".airlineWrapper");this.searchId=this.options.searchId;
(this.airlineMatrixLoaded=this.options.airlineMatrixLoaded)&&this.aboveHeadContainer.hasClass("vm-airlinestops")&&this.toggleAirlineMatrix(!0);(this.flexDialogLoaded=this.options.flexDialogLoaded)&&this.aboveHeadContainer.hasClass("vm-plusminusthree")&&this.togglePlusMinusThree(!0)},addEventHandlers:function(){var a=this;this.subscribe("flights.results.flexmatrix.hide",function(){a.togglePlusMinusThree(!1)});this.subscribe("flights.results.airlinestops.hide",function(){a.toggleAirlineMatrix(!1)});
this.subscribe("flights.results.toggle.flex_matrix",function(){a.togglePlusMinusThree()});this.subscribe("flights.results.toggle.airline_matrix",function(){a.toggleAirlineMatrix()});this.subscribe(["search.startSearch","search.searchFailed"],function(){a.flexDialogLoaded=!1;a.airlineMatrixLoaded=!1});this.subscribe("flights.resultspage.flexloaded",function(){a.flexDialogLoaded=!0});this.subscribe("flights.resultspage.airlinestopsloaded",function(){a.airlineMatrixLoaded=!0});this.subscribe("resultspage.searchId.changed",
function(c){a.searchId=c.searchId});this.subscribe("flights.results.aboveResultsContent.toggleHidden",function(c){a.element.toggleClass("hidden",0===c)})},setFilterMatrixView:function(a,c){var b=this.aboveHeadContainer,d="plusminusthree"===a?this.flexMatrixWrapper:"airlinestops"===a?this.airlineWrapper:null;if(!b.hasClass("vm-"+a)||!c)if(e("html, body").animate({scrollTop:0},500),null!=d){if(c){b.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")});d.height(0);b.addClass("vm-"+a);
var f=d.children("div").height();d.animate({height:f},function(){d.height("auto")})}else d.animate({height:0},function(){b.removeClass("vm-"+a)});d.attr("aria-expanded",c)}},toggleAirlineMatrix:function(a){a&&this.aboveHeadContainer.hasClass("vm-airlinestops")||("undefined"===typeof a&&(a=!this.aboveHeadContainer.hasClass("vm-airlinestops")),this.setFilterMatrixView("airlinestops",a),this.airlineMatrixLoaded?(b.events.publish("flights.results.airlinestops.show",a),this.logMatrixInteraction("airlinestops",
a)):b.events.publish("flights.resultspage.getairlinematrix"))},togglePlusMinusThree:function(a){a&&this.aboveHeadContainer.hasClass("vm-plusminusthree")||("undefined"===typeof a&&(a=!this.aboveHeadContainer.hasClass("vm-plusminusthree")),this.setFilterMatrixView("plusminusthree",a),this.flexDialogLoaded?(b.events.publish("flights.results.flexmatrix.show",a),this.logMatrixInteraction("plusminusthree",a)):b.events.publish("flights.resultspage.getflex"))},logMatrixInteraction:function(a,c){b.Analytics.api.trackEvent(a+
"/"+(c?"show":"hide"));b.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:a,value:c?"true":"false"})}})})(R9,jQuery);
(function(c){function k(){var a=c('\x3cdiv class\x3d"scroll-bar"\x3e\x3cdiv class\x3d"gutter"\x3e\x3c/div\x3e\x3cdiv class\x3d"handle"\x3e\x3c/div\x3e\x3c/div\x3e').insertAfter(this);this.data("scrollbar",a);a.find(".handle").height(this[0].offsetHeight/this[0].scrollHeight*100+"%")}function l(){var a=this.data("scrollbar"),b=a.find(".handle");a.find(".gutter");var d=this,g=0;this.on("touchstart",function(a){g=a.touches[0].pageY});this.on("touchmove",function(a){var b=this.scrollTop+10*(0<g-a.touches[0].pageY?
1:-1);e.bind(c(this))(b);a.preventDefault()});this.on("wheel",function(a){var b=a.originalEvent,b=this.scrollTop+10*(0>(-b.deltaY||-b.detail)?1:-1);e.bind(c(this))(b);a.preventDefault()});a.on("click",".gutter",function(a){a=a.pageY||a.clientY;e.bind(d)(h.bind(d)(a),!0)});b.on("mousedown",function(){window.getSelection&&window.getSelection().removeAllRanges();b.addClass("hover");c(document).on("mousemove.scrollhandle",function(a){var b=a.pageY||a.clientY;a.preventDefault();e.bind(d)(h.bind(d)(b))});
c(document).on("mouseup.scrollhandle",function(a){b.removeClass("hover");c(document).off(".scrollhandle")});var a=m();if(a.changeEvt)c(document).on(a.changeEvt,function(){document[a.hiddenProp]&&(b.removeClass("hover"),c(document).off(".scrollhandle"))})})}function m(){var a,b;"undefined"!==typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!==typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange");
return{hiddenProp:a,changeEvt:b}}function h(a){var b=this.data("scrollbar"),d=b.find(".handle"),b=b.find(".gutter");a=a-b.offset().top-d.outerHeight()/2;var c=this[0].scrollHeight-this[0].offsetHeight,d=b.height()-d.outerHeight();return c/d*a}function e(a,b){b?this.animate({scrollTop:a},{duration:100,step:f.bind(this),complete:f.bind(this)}):(this[0].scrollTop=a,f.bind(this)())}function f(){var a=this.data("scrollbar");if(a){var b=a.find(".handle"),a=a.find(".gutter"),c=this[0].scrollTop,e=this[0].scrollHeight-
this[0].offsetHeight,a=(a.height()-b.outerHeight())/e*c+b.outerHeight()/2-b.outerHeight()/2+5;b.css("top",a)}}function n(a){a&&"undefined"!==typeof a.scrollTo&&e.bind(this)(a.scrollTo);a&&a.reset&&e.bind(this)(0)}c.fn.scroller=function(a){var b=this.data("scrollbar");if(b)this[0].offsetHeight>=this[0].scrollHeight?b.hide():b.show();else{if(this[0].offsetHeight>=this[0].scrollHeight)return;k.bind(this)();l.bind(this)()}n.bind(this)(a);return this}})(jQuery);
(function(b,d){var m=b.config.getBoolean("ui.horizon.widgets.styleJamSelect.scrollLock",!1),l=function(){};b.createWidgetClass("select.StyleJamSelect",{input:null,inputStatus:null,display:null,displayStatus:null,content:null,background:null,listWrapper:null,list:null,container:null,inlineElementName:null,isOpen:!1,isOpening:!1,options:{modal:!1,container:"",onOpen:null,onClose:null,change:null,onChange:null,alignment:"left",minWidth:300,modalBelowDisplay:!1,
showLabel:!0,selectOnFocus:!0,focusModeHighlight:"",showInfoItem:!1,infoItemEnabledClass:"",infoItemDisabledClass:"",infoItemOptionValues:null,infoItemOptionTooltips:null,repositionOnScroll:!1,enableFocusAccessibility:!1,useWindowWidth:!1},init:function(){this.input=this.getChildElement("input");this.inputStatus=this.getChildElement("input-status");this.content=this.getChildElement("content");this.list=this.getChildElement("list");this.listWrapper=this.getChildElement("list-wrapper");this.options.container&&
(this.container=d(this.options.container),this.container.length||(this.container=null));this.options.modal?(this.display=this.getChildElement("display"),this.displayStatus=this.getChildElement("display-status"),this.background=this.getChildElement("bg"),this.inlineElementName="display"):this.inlineElementName="input";this.options.showInfoItem&&this.setupInfoOptionItem()},addEventHandlers:function(){var a=this;this.registerEvent("click",this[this.inlineElementName],function(){a.toggleContent()});this.registerEvent("keydown.select",
this[this.inlineElementName],function(c){a.handleKeyboardNavigation(c,a.inlineElementName)});this.registerEvent("focus",this[this.inlineElementName],this.onFocus.bind(this,this.inlineElementName));this.registerEvent("keydown.select",document,function(c){a.handleDocumentKeyboardNavigation(c,a.inlineElementName)});this.inputStatus.on("change",function(c){if(a.options.change){var n,b;b=d(this);n=b.attr("data-value");b=b.html();a.options.change.call(a,c,n,b)}});this.subscribe("select.force.close",this.close.bind(this));
this.list.on("click","li",function(){a.updateValue(d(this),!0);a.close()});m&&(this.registerEvent("mouseenter",this.list,l.bind(window,!0)),this.registerEvent("mouseleave",this.list,l.bind(window,!1)));this.registerEvent("click.select touchstart.select",d(document),function(c){0===d(c.target).closest("#"+a.id("content")+", #"+a.id()).length&&(a.close(),a.onBlur(a.options.modal?"display":"input"))});this.options.repositionOnScroll&&this.registerEvent("scroll",d(window),function(){b.dom.schedule(a.position.bind(a))});
this.registerEvent("resize",d(window),function(){b.dom.schedule(a.position.bind(a))});this.options.enableFocusAccessibility&&(this.element.focusin(function(){b.dom.swapClasses(a[a.inlineElementName],"",a.options.focusModeHighlight)}),this.element.focusout(function(){b.dom.swapClasses(a[a.inlineElementName],a.options.focusModeHighlight,"")}));this.subscribe("common.widgets.select.close",this.close.bind(this))},handleKeyboardNavigation:function(a,c){switch(a.which){case b.globals.keyCodes.SPACE:case b.globals.keyCodes.RETURN:this.isOpen||
(this.isOpening=!0,this.open(),a.preventDefault());break;case b.globals.keyCodes.DOWN:case b.globals.keyCodes.UP:a.preventDefault();this.isOpen||(this.isOpening=!0,this.open());break;case b.globals.keyCodes.TAB:this.isOpen&&this.close(),this.onBlur(c)}},handleDocumentKeyboardNavigation:function(a,c){switch(a.which){case b.globals.keyCodes.SPACE:case b.globals.keyCodes.RETURN:this.isOpen&&!this.isOpening?(this.updateValue(this.getHighlightedItems().first(),!1),this.triggerChange(),this.close(),a.preventDefault()):
this.isOpening&&(this.isOpening=!1);break;case b.globals.keyCodes.DOWN:this.isOpen&&!this.isOpening?(a.preventDefault(),a=this.list.find("li.js-focus").next(),a.length||(a=this.list.children("li[data-selected\x3dtrue]"),a.length||(a=this.list.children().eq(0))),this.focusItem(a)):this.isOpening&&(this.isOpening=!1);break;case b.globals.keyCodes.UP:this.isOpen&&!this.isOpening&&(a.preventDefault(),a=this.list.find("li.js-focus").prev(),a.length||(a=this.list.children("li[data-selected\x3dtrue]"),a.length||
(a=this.list.children().eq(0))),this.focusItem(a));break;case b.globals.keyCodes.TAB:this.isOpen&&(this.close(),this.focusInlineElement(),this.onBlur(c));break;case b.globals.keyCodes.ESC:this.isOpen&&(this.updateSelection(this.getSelectedItem()),this.close(),this.focusInlineElement())}},isValidElement:function(){return!0},focusInlineElement:function(){this[this.inlineElementName].focus()},onFocus:function(a){b.dom.swapChildrenClasses(this[a],this.options.sjstate[a],"blurred","focused")},onBlur:function(a){b.dom.swapChildrenClasses(this[a],
this.options.sjstate[a],"focused","blurred")},toggleContent:function(){this.isOpen?this.close():this.open()},open:function(){if(!this.isOpen){this.position();var a=this;this.isOpen=!0;this.container&&this.content&&this.content.appendTo(this.container);this.list.scroller();setTimeout(function(){a.ensureVisible(a.getSelectedItem(),!0)},200);b.dom.swapChildrenClasses(this.content,this.options.sjstate.content,"closed","open");b.dom.swapChildrenClasses(this.input,this.options.sjstate.input,"closed","open");
b.dom.swapChildrenClasses(this.display,this.options.sjstate.display,"closed","open");if("function"===typeof this.options.onOpen)this.options.onOpen(this);this.display&&this.display.attr("aria-expanded",!0);b.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);b.events.publish("Select.opened",{id:this.id()})}},close:function(){if(this.isOpen){m&&l(!1);var a=this.isOpen;this.isOpen=!1;b.dom.swapChildrenClasses(this.content,this.options.sjstate.content,"open","closed");
b.dom.swapChildrenClasses(this.input,this.options.sjstate.input,"open","closed");b.dom.swapChildrenClasses(this.display,this.options.sjstate.display,"open","closed");if("function"===typeof this.options.onClose)this.options.onClose(a,this);this.display&&this.display.attr("aria-expanded",!1);b.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1);this.options.selectOnFocus&&this.focusInlineElement();b.events.publish("Select.closed",{id:this.id()})}},position:function(){var a=
this.options.useWindowWidth?d(window).width():d(window).outerWidth(),c=this.getPositionElement(),b=c.offset(),h=c.outerWidth(),f={};if(this.options.modal){this.background.css({width:h-16,height:this.display.outerHeight()-16});var e=Math.max(h,this.options.minWidth);this.content.css({minWidth:e>a?a:e,maxWidth:a});c=this.options.modalBelowDisplay?Math.floor(b.top+c.outerHeight()+1):Math.floor(b.top)}else c=Math.floor(b.top+c.outerHeight()),f.minWidth=h;var e=this.content.outerWidth(),g="rtl"===document.dir,
b="right"===this.options.alignment?g?Math.ceil(b.left-(a-e)):Math.ceil(b.left-(e-h)):g?Math.ceil(b.left-(a-h-10)):Math.floor(b.left);b+e>a&&(b=a-e-10,b=0<b?b:0);"rtl"===document.dir&&Math.abs(b)+e>a&&(a=a-e-10,b=0<a?-a:0);this.container||(f.transform="translate("+b+"px, "+c+"px)",f.msTransform=f.transform);this.content.css(f)},getPositionElement:function(){return this.options.modal?this.display:this.input},ensureVisible:function(a,b){if(a.position()){var c=a.position().top;a=a.outerHeight(!0);var d=
this.listWrapper.scrollTop(),f=this.listWrapper.height(),e=this.list.scrollTop();if(b){b=this.list[0].scrollHeight;var g=c+this.list.scrollTop(),k=(f-a)/2;if(g>k&&b-g>k){this.list.scroller({scrollTo:d+e+c-k});return}g<k?this.list.scroller({scrollTo:0}):this.list.scroller({scrollTo:b-f})}0>c?this.list.scroller({scrollTo:d+e+c}):c+a>f&&this.list.scroller({scrollTo:d+e+(c+a-f)})}},getSelectedItem:function(){var a=this.list.find("li"),b=a.filter("[data-value\x3d'"+this.val()+"']");return b.length?b:a.first()},
getHighlightedItems:function(){return this.list.children("li.js-focus")},focusItem:function(a){if(this.options.selectOnFocus)this.updateSelection(a);else{var c=this.list.children(".js-focus");c.removeClass("js-focus").attr("aria-selected",!1);a.addClass("js-focus").attr("aria-selected",!0);var d=this.getStlBlock("item-focused");b.dom.swapClasses(c,d,"");b.dom.swapClasses(a,"",d);(this.display||this.element).attr("aria-activedescendant",a.attr("id"));this.isOpen&&this.ensureVisible(a,!0)}},toggleItemSelection:function(a,
c){a.toggleClass("js-focus",c).attr("aria-selected",c);b.dom.swapChildrenClasses(a,this.options.sjstate.listItem,c?"deselected":"selected",c?"selected":"deselected")},updateSelection:function(a){(this.display||this.element).attr("aria-activedescendant",a.attr("id"));this.toggleItemSelection(this.getHighlightedItems(),!1);this.toggleItemSelection(a,!0);this.options.selectOnFocus&&a.focus()},updateValue:function(a,b){this.isNodeDisabled(a)||(this.isOpen&&this.ensureVisible(a,!0),this.updateSelection(a),
this.setInputValue(a),this.options.showInfoItem&&this.setupInfoOptionItem(),b&&this.triggerChange())},triggerChange:function(){"function"===typeof this.options.change&&this.inputStatus.trigger("change")},setInputValue:function(a){var b=a.attr("data-value");a=a.attr("data-labelText")||a.attr("data-title");this.inputStatus.text(a);this.inputStatus.attr("data-value",b);this.inputStatus.attr("data-title",a);this.options.modal&&this.options.showLabel&&(this.displayStatus.html(a),this.displayStatus.attr("data-value",
b),this.displayStatus.attr("data-title",a));this.options.modal&&this.getChildElement("display-text").attr("aria-label",a);this.element.hasValue=!!b},setupInfoOptionItem:function(){var a=this.options.infoItemOptionValues;if(a&&0<a.length){var c=this.getChildElement("post-info"),a=a.indexOf(this.getValue());-1<a?((a=this.options.infoItemOptionTooltips[a])&&c.toolTip({content:a,extraClass:"halfWidth"}),b.dom.swapClasses(c,this.options.infoItemDisabledClass,this.options.infoItemEnabledClass)):b.dom.swapClasses(c,
this.options.infoItemEnabledClass,this.options.infoItemDisabledClass)}},_getItemByValue:function(a){return this.list.find("li[data-value\x3d'"+a+"']")},val:function(){return this.inputStatus.attr("data-value")},getValue:function(){return this.val()},dataVal:function(){return this.inputStatus.attr("data-value")},getDataValue:function(){return this.dataVal()},getText:function(){return this.inputStatus.html()||this.inputStatus.text()},setText:function(a){this.inputStatus.html(a)},setValue:function(a,
b){a=this._getItemByValue(a);this.updateValue(a,b)},setValueOrDefault:function(a,b){a=this._getItemByValue(a);a.length?this.updateValue(a,b):this.setValue("",b)},getItemText:function(a){a=this._getItemByValue(a);if(a.length)return a.html()},updateItemText:function(a,b){var c=this._getItemByValue(a);c.length&&(c.attr("data-title",b),c.html(b));a===this.getDataValue()&&this.setInputValue(c)},updateItemValue:function(a,b,d){a=this._getItemByValue(a);a.length&&a.attr("data-value",b);d&&(this.setInputValue(a),
this.updateSelection(a))},selectItem:function(a,b){a=this._getItemByValue(a);b&&(this.setInputValue(a),this.updateSelection(a))},isNodeSelected:function(a){return a.length&&"true"===a.attr("data-selected")},isNodeDisabled:function(a){return a.length&&a.attr("disabled")},getNodeDataValue:function(a){return a.length?a.attr("data-value"):""},disableValue:function(a){a=this._getItemByValue(a);a.length&&a.attr("disabled","disabled")},enableValue:function(a){a=this._getItemByValue(a);a.length&&a.removeAttr("disabled")},
hideNode:function(a){a=this._getItemByValue(a);a.length&&(this.swapClasses(a,"","Select__content__list__list-item--hidden"),a.attr("hidden","hidden"))},showNode:function(a){a=this._getItemByValue(a);a.length&&(this.swapClasses(a,"Select__content__list__list-item--hidden",""),a.removeAttr("hidden"))},hasVisibleNodes:function(){var a=this.list.find("li");return a.length>a.filter("[hidden\x3d'hidden']").length}})})(window.R9,window.jq||window.jQuery);
function _slicedToArray(d,e){return _arrayWithHoles(d)||_iterableToArrayLimit(d,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}
function _iterableToArrayLimit(d,e){if(Symbol.iterator in Object(d)||"[object Arguments]"===Object.prototype.toString.call(d)){var a=[],b=!0,c=!1,g=void 0;try{for(var f=d[Symbol.iterator](),h;!(b=(h=f.next()).done)&&(a.push(h.value),!e||a.length!==e);b=!0);}catch(k){c=!0,g=k}finally{try{if(!b&&null!=f["return"])f["return"]()}finally{if(c)throw g;}}return a}}function _arrayWithHoles(d){if(Array.isArray(d))return d}
(function(d,e){d.createComponentClass("common.results.SortDropdown",{sortDropdownWidget:null,placeholderOption:[],unrolledOptions:null,unrolledDropdowns:null,dropdownWidgetType:"dropdown",useDropdownPlaceholderOption:!1,trackInteractions:!1,options:{activeSortType:"rank_a",isSortUnrolled:!1,hasDropdown:!1,hasDropdownSortText:!1,useSelectWidget:!1,styleJamSelect:!1},init:function(){this.options.hasDropdown&&(this.options.styleJamSelect?this.setupStyleJamSelect():this.setupDropdownWidget());this.options.useSelectWidget&&
this.setupSelectWidget();this.options.isSortUnrolled&&this.setupUnrolledOptions();this.options.hasDropdown&&this.options.isSortUnrolled&&(this.options.useSelectWidget||(this.placeholderOption=e(this.sortDropdownWidget.element.find('option[value\x3d""]'))),this.useDropdownPlaceholderOption=!0,this.updatePlaceholderOption())},addEventHandlers:function(){var a=this;this.options.isSortUnrolled&&this.unrolledOptions.click(function(b){a.setSortMode(e(b.currentTarget).attr("data-sort"))});this.subscribe(["resultsHeader.sortType.set",
"resultspage.sortMode.changed"],this.handleSortModeChange.bind(this));this.trackInteractions&&(this.subscribe(["Select.close","Select.closed","Widgets.DropdownDialog.closed"],function(b){b.id===a.id("sorting")&&a.trackToggleAction(!1)}),this.subscribe(["Select.open","Select.opened","Widgets.DropdownDialog.opened"],function(b){b.id===a.id("sorting")&&a.trackToggleAction(!0)}))},trackToggleAction:function(a){d.VestigoEvents&&d.VestigoEvents.sortresults.sort(a?d.VestigoType.Expandable.expand:d.VestigoType.Expandable.collapse)},
setupDropdownWidget:function(){var a=this;this.dropdownWidgetType=this.options.useSelectWidget?"r9Select":this.dropdownWidgetType;(this.sortDropdownWidget=this.getChildElement("sorting")[this.dropdownWidgetType]({change:function(b){return b&&a.setSortMode()}}).getWidget())||this.log.console("SortDropdownWidget is undefined, but hasDropdown is set to true in sortDropdown's velocity template.")},setupStyleJamSelect:function(){var a=this;this.sortDropdownWidget=this.getChildElement("sorting").getWidget();
this.sortDropdownWidget.setOption("change",function(b){return a.setSortMode()})},setupSelectWidget:function(){this.options.isSortUnrolled&&(this.placeholderOption=e(this.sortDropdownWidget.dropdownOptions[0]).detach())},setupUnrolledOptions:function(){this.unrolledOptions=this.getChildElement("sortUnrolled").find("a.sortOption");this.unrolledDropdowns=this.getChildElement("sortUnrolled").find("a.sortDropdown")},setSortMode:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.sortDropdownWidget&&
this.sortDropdownWidget.getValue(),a=e.extend({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{sortCode:a});d.events.publish("resultsHeader.sortType.set",a)},handleSortModeChange:function(a){a.sortCode&&(this.setSelectedDropdownOption(a.sortCode),this.setSelectedUnrolled(a.sortCode),this.updatePlaceholderOption())},setSelectedDropdownOption:function(a){if(this.options.hasDropdown){var b=this.findDropdownSortElement(a),c=b&&0<b.length;c&&(this.sortDropdownWidget.setValue(a),this.sortDropdownWidget.setText(b.attr("title")));
this.sortDropdownWidget.element.toggleClass("selected",c).attr("aria-selected",c)}},setSelectedUnrolled:function(a){var b=this;if(this.options.isSortUnrolled){var c=this.unrolledOptions.add(this.unrolledDropdowns);c.each(function(a,c){return b.resetUnrolledOption(c)});var d=a.split("_")[0],c=c.filter("[data-sort*\x3d".concat(d,"]"));a=this.flipSortCodeDirection(a);c.addClass("selected").attr("aria-selected",!0);c.attr("data-sort",a)}},resetUnrolledOption:function(a){e(a).removeClass("selected").attr("aria-selected",
!1);var b=e(a).attr("data-default-sort");b&&e(a).attr("data-sort",b)},flipSortCodeDirection:function(a){var b=a.split("_"),c=_slicedToArray(b,2),b=c[0];return(c=c[1])?(a="a"===c?"b":"a","".concat(b,"_").concat(a)):a},updatePlaceholderOption:function(){if(this.useDropdownPlaceholderOption){var a=this.placeholderOption.text();this.element.find(".sortOption.selected").length?(this.sortDropdownWidget.setText(a),this.sortDropdownWidget.setValue(this.placeholderOption.val(),!1),this.sortDropdownWidget.element.removeClass("selected").attr("aria-selected",
!1)):(this.placeholderOption.removeAttr("selected").attr("aria-selected",!1),this.sortDropdownWidget.element.addClass("selected").attr("aria-selected",!0));this.placeholderOption({disabled:"disabled","aria-disabled":!0,hidden:"hidden","aria-hidden":!0})}},findDropdownSortElement:function(a){return this.options.useSelectWidget?this.sortDropdownWidget.dropdownOptions.filter(function(b,c){return e(c).attr("data-value")===a}):this.options.styleJamSelect?this.sortDropdownWidget.getSelectedItem(a):this.element.find("option[value\x3d"+
a+"]")}})})(window.R9,window.jq||window.jQuery);
(function(d,f){d.createComponentClass("flights.results.FlightSortDropdown","common.results.SortDropdown",{SEARCHTYPE_ROUNDTRIP:"roundtrip",SEARCHTYPE_MULTI:"multi",SEARCHTYPE_ONEWAY:"oneway",removedSortOptions:f(),options:{isOneWay:!1,isGanttView:!1,numLegs:1,recommendedSortEnabled:!1,styleJamSelect:!1,dynamicSorts:[],oneWaySorts:[]},init:function(){this.base();this.options.styleJamSelect||this.setDropdownSorts()},addEventHandlers:function(){var a=this;this.base();this.subscribe("resultsHeader.sortType.set.no.refresh",
function(b){d.dom.schedule(function(){a.options.styleJamSelect?a.sortDropdownWidget.setValue(b.sortCode,!1):a.sortDropdownWidget.setValue(b.sortCode)})});this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed","filter.show"],this.updateSortsForSearch.bind(this))},updateSortsForSearch:function(){this.flightSearchFormState=d.question.ask("flights.rp.searchform");null!==this.flightSearchFormState&&this.flightSearchFormState.isMulticity?this.updateSorts(this.flightSearchFormState,
this.SEARCHTYPE_MULTI):null!==this.flightSearchFormState&&this.flightSearchFormState.oneway?this.updateSorts(this.flightSearchFormState,this.SEARCHTYPE_ONEWAY):this.updateSorts(this.flightSearchFormState,this.SEARCHTYPE_ROUNDTRIP)},trackToggleAction:function(a){d.VestigoEvents&&d.VestigoEvents.sortresults&&d.VestigoEvents.sortresults.othersort(a?d.VestigoType.Expandable.expand:d.VestigoType.Expandable.collapse)},updateSorts:function(a,b){var e,c=this.dropdownHasVisibleItems();if(this.options.styleJamSelect)if(e=
this.options.dynamicSorts.length,b===this.SEARCHTYPE_MULTI)for(b=0;b<e;b++)this.sortDropdownWidget.hideNode(this.options.dynamicSorts[b]);else if(b===this.SEARCHTYPE_ONEWAY){for(b=0;b<e;b++)this.sortDropdownWidget.hideNode(this.options.dynamicSorts[b]);for(b=0;b<this.options.oneWaySorts.length;b++)this.sortDropdownWidget.showNode(this.options.oneWaySorts[b])}else for(b=0;b<e;b++)this.sortDropdownWidget.showNode(this.options.dynamicSorts[b]);this.updateOptionsWithCode(a);a=this.dropdownHasVisibleItems();
c!==a&&(a?this.element.show():this.element.hide(),d.events.publish("sortDropdown.visibility.change",a))},dropdownHasVisibleItems:function(){return"function"===typeof this.sortDropdownWidget.hasVisibleNodes?this.sortDropdownWidget.hasVisibleNodes():!0},handleSearchSubmit:function(a){this.options.isOneWay=a.oneway;this.options.isGanttView=a.hasOwnProperty("depart_date_flex")&&"exact"!==a.depart_date_flex;this.options.numLegs=a.hasOwnProperty("nrLegs")&&a.nrLegs;this.options.styleJamSelect||this.setDropdownSorts()},
setDropdownSorts:function(){if(this.options.hasDropdown){var a=this.getSortOptionsToDisplay();this.removedSortOptions.length&&this.renderSortOptions(a);a=this.detachUnusedSortOptions(a);this.removedSortOptions.add(a)}},getSortOptionsToDisplay:function(){var a=f.extend({},this.options),b=!a.isOneWay&&!a.isSortUnrolled&&a.isGanttView,e=2>=a.numLegs&&!a.isGanttView,c=2===a.numLegs&&!a.isGanttView;return{airline:!0,price:!a.isSortUnrolled,duration:!a.isSortUnrolled&&!a.isGanttView,firstLegDuration:b,
lastLegDuration:b,depart:e,arrive:e,departReturn:c,arriveReturn:c,bestValue:a.recommendedSortEnabled}},renderSortOptions:function(a){var b=f();this.removedSortOptions.each(function(e,c){e=(f(c).val()||"").split("_")[0];!0===a[e]&&b.add(c)});this.options.useSelectWidget?this.sortDropdownWidget.dropdownOptions.append(b):this.sortDropdownWidget.select.append(b)},detachUnusedSortOptions:function(a){var b=Object.keys(a),e=b.filter(function(b){return!a[b]});if(this.options.useSelectWidget)return this.sortDropdownWidget.dropdownOptions.filter(function(){var a=
f(this).attr("data-value"),a=-1<a.indexOf("_")?a.split("_")[0]:a;return""===a||-1<e.indexOf(a)}).detach();var c=!1===a[b[0]]?"[value^\x3d'%s']".format(b[0]):"null",d=this.options.useSelectWidget?"data-value":"value",b=b.reduce(function(b,c){return!1===a[c]?"%s,[%s^\x3d'%s']".format(b,d,c):b},c);return this.sortDropdownWidget.select.find(b).detach()},setSortMode:function(a){this.base(a)},updateOptionsWithCode:function(a){var b=this;if(null!==a)if(this.options.styleJamSelect)for(var e=this.options.dynamicSorts.length,
c="",d="",d=!1,l=0;l<e;l++){var c=this.options.dynamicSorts[l],d="depart_a"===c||"depart_b"===c||"arriveReturn_a"===c||"arriveReturn_b"===c,n=this.sortDropdownWidget.getItemText(c);n&&(d=this.updateTextWithCode(n,this.getCode(a,d)),this.sortDropdownWidget.updateItemText(c,d))}else{var m=!1,g="",h="",k=f();this.sortDropdownWidget.dropdownOptions.each(function(e,d){k=f(d);g=k.attr("data-title");h=k.text();m="depart_a"===c||"depart_b"===c||"arriveReturn_a"===c||"arriveReturn_b"===c;g=b.updateTextWithCode(g,
b.getCode(a,m));h=b.updateTextWithCode(h,b.getCode(a,m));g&&h&&(k.attr("data-title",g),k.text(h))})}},updateTextWithCode:function(a,b){return a.replace(/\(.+\)|\(\)/,"("+b+")")},getCode:function(a,b){return b?this.getDisplayCode(a.origincode,a.origin_code,a.originLocation):this.getDisplayCode(a.destinationcode,a.destination_code,a.destinationLocation)},getDisplayCode:function(a,b,d){return"string"===typeof a&&0<a.indexOf("/")?a.split("/")[0]:"string"===typeof b&&0<b.indexOf("/")?b.split("/")[0]:/[A-Z]{3}/.test(a)?
a:d&&d.substr?d.substr(0,3):a}})})(window.R9,window.jQuery);
function _typeof(e){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"===typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};return _typeof(e)}function _slicedToArray(e,c){return _arrayWithHoles(e)||_iterableToArrayLimit(e,c)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}
function _iterableToArrayLimit(e,c){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],b=!0,f=!1,d=void 0;try{for(var g=e[Symbol.iterator](),h;!(b=(h=g.next()).done)&&(a.push(h.value),!c||a.length!==c);b=!0);}catch(k){f=!0,d=k}finally{try{if(!b&&null!=g["return"])g["return"]()}finally{if(f)throw d;}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}
(function(e,c){e.createComponentClass("common.results.SortTabContainer",{unrolledTabs:null,rolledTabs:null,moreDropdown:null,slider:null,currentSortState:"",activeTabElement:null,lastUnrolledTab:null,watchListTab:null,watchListCountEl:null,watchListCount:0,unrolledTabsSize:0,watchListAddedMessage:"",firstLoad:!0,watchListMsgTimeoutId:null,distanceTab:null,currentSortBase:"",infoTooltip:null,sortTabSeparator:"_",ascendingDirection:"a",descendingDirection:"b",options:{activeSortTab:"rank_a",showDropdown:!0,
maxUnrolledTabs:3,accountMessage:"",pricePlusMessage:"",priceFromMessage:"",bestValueTabCls:"bestflightTab",formatPrice:!0,watchlistMakeoverEnabled:!1,watchListSortMax:"",watchListAccMsgHide:!1,watchListMsgDuration:2E3,toolTipExtraCssClass:"",customTicketEnabled:!1,customTicketStr:"customTicket_a",showSlideOverlay:!1,sortDirection:"",isRadioTabsWithUnderLine:!1},init:function(){this.unrolledTabs=this.getChildElement("unrolledTabs");this.rolledTabs=this.getChildElement("rolledTabs");this.lastUnrolled=
this.getChildElement("lastUnrolled");this.moreDropdown=this.getChildElement("moreDropdown").getWidget();this.unrolledTabsSize=this.unrolledTabs.attr("data-size");this.options.watchlistMakeoverEnabled&&(this.watchListTab=this.getChildElement("watchlistTab"),this.watchListCountEl=this.getChildElement("watchlistCount"),this.unrolledTabsSize=this.unrolledTabs.attr("data-size"),this.watchListAddedMessage=this.watchListCountEl.parent().attr("data-added"));this.options.showSlideOverlay&&(this.slider=this.getChildElement("slider"));
this.ascendingDirection&&(this.options.sortDirection=this.ascendingDirection)},addEventHandlers:function(){var a=this,b=this;this.subscribe(["resultsHeader.changed","resultspage.sortMode.changed"],this.handleSortModeChange.bind(this));this.subscribe("results.distance.sort.hide",function(){b.element.find("[data-code\x3d'distance']");var a=c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']");c(".rolledTabs").find("[data-code\x3d'distance']");var d=c(".rolledTabs").find("li a:not([data-code\x3d'distance'])").first();
0<a.length&&0<d.length&&b.moveSelectedRolledTab(d);c(".rolledTabs").find("li \x3e a[data-code\x3d'distance']").parent().hide();c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']").parent().addClass("col-hidden");0==c(".rolledTabs").find("li \x3e a:not([data-code\x3d'distance'])").length&&(c(".col-overflow").addClass("col-hidden"),b.element.find(".tabGrid").removeClass("withDropdown"));a=c(".unrolledTabGrid").find("div.col-tab:not('.col-hidden')").length;d=parseInt(b.unrolledTabsSize,
10);b.options.showSlideOverlay&&a!==d&&a<d&&c("div.unrolledTabGrid").removeClass("unrolledCount".concat(d)).addClass("unrolledCount".concat(a))});this.subscribe("results.distance.sort.show",function(){if("distance"==b.getSortTypeAndDirection(b.options.activeSortTab)[0]){var a=c(".rolledTabs").find("[data-code\x3d'distance']").first();1==a.length&&(a.parent().show(),b.moveSelectedRolledTab(a));0==c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']").length&&(a=c(".unrolledTabGrid").find("div.col-hidden \x3e [data-code\x3d'distance']"),
0<a.length&&a.first().parent.removeClass("col-hidden"))}else c(".unrolledTabGrid").find("div.col-hidden \x3e [data-code\x3d'distance']").parent().removeClass("col-hidden"),c(".rolledTabs").find("[data-code\x3d'distance']").first().parent().show();0<c(".rolledTabs").find("li \x3e a").length&&(c(".col-overflow").removeClass("col-hidden"),b.element.find(".tabGrid").addClass("withDropdown"))});this.element.find("a.sortTab").each(function(b,d){c(d).click(function(b){return a.onSortTabClicked(d,b)});c(d).keypress(function(a){a.preventDefault();
switch(a.which){case e.globals.keyCodes.RETURN:case e.globals.keyCodes.SPACE:c(d).click()}});b=c(d).find(".js-infoTooltip");0!==b.length&&b.toolTip({content:b.data("tooltip"),extraClass:"mm-style sortTabInfoTooltip",position:"bottom"})});this.subscribe("resultspage.searchId.changed",function(b){a.setActiveTab()});this.options.watchlistMakeoverEnabled&&this.watchListTab&&this.watchListTab.length&&(this.subscribe("savedItemsListUpdated",this.enableWatchTab.bind(this)),"watchlist_a"===this.options.activeSortTab&&
this.showWatchList());this.subscribe("search.poll.response",this.handleResultsResponse.bind(this))},onSortTabClicked:function(a,b){var f=c(b.currentTarget).attr("data-sort"),d=this.options.activeSortTab,g=this.getSortTypeAndDirection(d),h=_slicedToArray(g,2),g=h[0],h=h[1],k={};this.options.customTicketEnabled&&(k.customTicket=f===this.options.customTicketStr);e.config.getBoolean("ui.horizon.sortTab.arrowFix.enabled",!1)&&"rank"===a.dataset.code&&(f="rank_a");this.updateSortState(this.activeTabElement||
a,this.options.activeSortTab===f&&"watchlist_a"!==f&&f!==this.options.customTicketStr);f=c(b.currentTarget).attr("data-sort");this.fromCustomTicket(a.dataset.code)&&(f=a.dataset.code+("happinessScore"===a.dataset.code?"_".concat(this.descendingDirection):"_".concat(this.ascendingDirection)),k.forceChange=!0);e.config.getBoolean("ui.horizon.sortTab.arrowFix.enabled",!1)&&"rank"===a.dataset.code&&(f="rank_a");this.activeTabElement=a;this.options.activeSortTab=f;this.currentSortBase=c(b.currentTarget).attr("data-code");
c(a).parent().hasClass("rolledContainer")&&this.moveSelectedRolledTab(a);a.dataset.sort===d||a.dataset.code===g&&h!==this.options.sortDirection&&!this.isReverseClickSortEnabled()||this.setSortMode(this.options.activeSortTab,k)},handleSortModeChange:function(a){if(a&&a.sortCode){var b=this.getSortTypeAndDirection(a.sortCode)[0];""!==this.currentSortBase&&b===this.currentSortBase||this.updateSortLayout(b);this.setActiveTab(a.customTicket?this.options.customTicketStr:a.sortCode)}},handleResultsResponse:function(a){if(a=
a.sortTabData){this.element.find(".sortTab:not([data-sub-text])").addClass("hideSubTitle");if(a.cheapestPrice){var b=this.element.find(".priceTab"),c="true"===a.useFromMessage?this.options.priceFromMessage:this.options.pricePlusMessage;b.find(".price").text(this.getFormattedSortTabPrice(a.cheapestPrice,c));b.removeClass("hideSubTitle")}a.cheapestBestFlight&&(b=this.element.find("."+this.options.bestValueTabCls),b.find(".price").text(this.getFormattedSortTabPrice(a.cheapestBestFlight)),b.removeClass("hideSubTitle"));
a.shortestDurationFlightPrice&&(b=this.element.find(".durationTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.shortestDurationFlightPrice)),b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightPrice&&(b=this.element.find(".happinessScoreTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestHappinnessScoreFlightPrice)),b.removeClass("hideSubTitle"));a.highestRankHotel&&(b=this.element.find(".rankTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestRankHotel,
this.options.priceFromMessage)),b.removeClass("hideSubTitle"));a.highestUserRatingHotel&&(b=this.element.find(".userratingTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestUserRatingHotel,this.options.priceFromMessage)),b.removeClass("hideSubTitle"));a.cheapestFlightDuration&&(b=this.element.find(".priceTab"),b.find(".duration").text(a.cheapestFlightDuration),b.removeClass("hideSubTitle"));a.shortestDurationFlightDuration&&(b=this.element.find(".durationTab"),b.find(".duration").text(a.shortestDurationFlightDuration),
b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightDuration&&(b=this.element.find(".durationAndPriceRatioTab"),b.find(".duration").text(a.highestHappinnessScoreFlightDuration),b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightDuration&&(b=this.element.find(".happinessScoreTab"),b.find(".duration").text(a.highestHappinnessScoreFlightDuration),b.removeClass("hideSubTitle"));a.bestflightDuration&&(b=this.element.find("."+this.options.bestValueTabCls),b.find(".duration").text(a.bestflightDuration),
b.removeClass("hideSubTitle"))}},getFormattedSortTabPrice:function(a,b){return!0===this.options.formatPrice?(b&&0!==b.length||(b=this.options.pricePlusMessage),e.Common.Utils.String.formatString(b,a)):a},isWatchListActive:function(){return"watchlist"===this.getSortTypeAndDirection(this.options.activeSortTab)[0]},toggleSavedItems:function(a){a?(this.showNavMenuMessage(),e.events.publish("resultsSavedItems.show")):e.events.publish("resultsSavedItems.hide")},enableWatchTab:function(a){if(a){var b=this.watchListCount;
this.watchListCount=a.listSize;0<this.watchListCount?this.showWatchList(b):this.hideWatchList()}this.firstLoad=!1},showWatchList:function(a){this.watchListTab.hasClass("col-hidden")&&(this.watchListTab.removeClass("col-hidden"),this.unrolledTabs.removeClass("unrolledCount"+this.unrolledTabsSize).addClass("unrolledCount"+(this.unrolledTabsSize+1)));this.watchListCountEl[this.watchListCount?"show":"hide"]();this.watchListCountEl.text(9<this.watchListCount?this.options.watchListSortMax:this.watchListCount);
this.showWatchListMessage(a)},hideWatchList:function(){this.watchListTab.hasClass("col-hidden")||(this.watchListTab.addClass("col-hidden"),this.unrolledTabs.removeClass("unrolledCount"+(this.unrolledTabsSize+1)).addClass("unrolledCount"+this.unrolledTabsSize));this.watchListCountEl.text(0);this.isWatchListActive()&&this.watchListTab.next().children().trigger("click")},showWatchListMessage:function(a){this.removeWatchListMessage();clearTimeout(this.watchListMsgTimeoutId);!this.watchListAddedMessage||
this.firstLoad||a>=this.watchListCount||(this.inViewport()?this.showWatchListToolTip():this.animateInView(this.showWatchListToolTip.bind(this)))},showWatchListToolTip:function(a){var b=this;this.watchListCountEl.toolTip({subNameSpace:"watchListAdded",content:this.watchListAddedMessage,position:"bottom",activation:"click",showImmediately:!0,closeOnBodyClick:!1,offsetAgainstEdge:!1,appendTo:"#"+b.watchListTab.attr("id")});this.watchListMsgTimeoutId=setTimeout(function(){b.removeWatchListMessage();"function"===
typeof a&&a()},this.options.watchListMsgDuration)},showNavMenuMessage:function(){this.options.watchListAccMsgHide||(this.options.watchListAccMsgHide=!0,setMetaCookie("WATCH_LIST_ACC_MSG_HIDE","true"),e.Analytics.api.trackEvent({category:"watchlist",action:"NavMenu-msg-show"}),e.events.publish("NavMenu.showMessage",{id:"profileIcon",text:this.options.accountMessage}))},removeWatchListMessage:function(){this.watchListCountEl.data("toolTip")&&this.watchListCountEl.data("toolTip").removeWidget()},inViewport:function(){var a,
b;a=c(window).scrollTop();b=a+c(window).height();var f,d;f=this.element.offset().top;d=f+this.element.outerHeight();return f<=b&&d>=a},animateInView:function(a){var b=this,f=this.element.children(".tabGrid"),d=this.element.outerHeight();this.element.css("height",d);f.addClass("fixed down");c(window).on("scroll.SortTabContainer",function(){b.inViewport()&&(f.removeClass("fixed down"),c(window).off("scroll.SortTabContainer"))});setTimeout(function(){a(function(){f.removeClass("down");c(window).off("scroll.SortTabContainer");
setTimeout(function(){f.removeClass("fixed");b.element.css("height","")},500)})},500)},updateSortLayout:function(a){a=this.rolledTabs.find("[data-code\x3d'".concat(a,"']"));a.length&&a.attr("data-rank")>this.options.maxUnrolledTabs&&this.moveSelectedRolledTab(a)},moveSelectedRolledTab:function(a){this.lastUnrolledTab=this.lastUnrolled.find(".sortTab");var b=(c(this.lastUnrolledTab).attr("data-rank")||this.options.maxUnrolledTabs)-this.options.maxUnrolledTabs;c(a).detach().appendTo(c(this.lastUnrolled));
a="li:eq("+b+")";c(this.lastUnrolledTab).detach().appendTo(c(this.rolledTabs.find(a)))},setSortMode:function(){var a=c.extend({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{sortCode:0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.activeSortTab});e.events.publish("resultsHeader.sortType.set",a)},setActiveTab:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.activeSortTab;this.options.activeSortTab=b;var f=this.getSortTypeAndDirection(b);
this.element.find("a.sortTab").each(function(b,e){var d=c(e).attr("data-code")===f[0],g="watchlist"===c(e).attr("data-code");c(e).toggleClass("active",d);c(e).attr("aria-selected",d);a.options.showSlideOverlay&&d&&(a.slider.css("transform","translate("+100*b+"%)"),a.options.isRadioTabsWithUnderLine&&(a.slider.css("left","3%"),a.slider.css("width","44%"),1==b?a.slider.css("left","9%"):a.slider.css("left","3%")));d&&a.options.activeSortTab!==c(e).attr("data-sort")&&a.updateSortState(e,!0);a.options.watchlistMakeoverEnabled&&
g&&a.toggleSavedItems(d)})},enableTab:function(a){a&&("object"===_typeof(a)?a.removeClass("disabled"):this.element.find("a.sortTab[data-code\x3d'"+a+"']").removeClass("disabled"))},disableTab:function(a){a&&("object"===_typeof(a)?a.addClass("disabled"):this.element.find("a.sortTab[data-code\x3d'"+a+"']").addClass("disabled"))},isDisabledTab:function(a){return a?this.element.find("a.sortTab[data-code\x3d'"+a+"']").hasClass("disabled"):!1},isReverseClickSortEnabled:function(){return e.config.getBoolean("ui.horizon.sortTab.reverseClickSort.enabled",
!0)},getSortTypeAndDirection:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rank_a").split(this.sortTabSeparator)},updateSortState:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.activeTabElement,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1,e,d;b?(e=this.getSortTypeAndDirection(c(a).attr("data-sort")),d=_slicedToArray(e,2),e=d[0],(d=d[1])&&(d=d===this.ascendingDirection?this.descendingDirection:this.ascendingDirection)):(e=c(a).attr("data-code"),
d=c(a).attr("data-direction"));d&&e&&(c(a).attr("data-sort","".concat(e,"_").concat(d)),c(a).attr("data-direction","".concat(d)),c(a).toggleClass("ascending",b?!c(a).hasClass("ascending"):c(a).attr("data-icon")===this.ascendingDirection),c(a).attr("aria-label","a"===d?c(a).attr("data-lbl-asc"):c(a).attr("data-lbl-dsc")),this.options.sortDirection=d)},fromCustomTicket:function(a){return this.options.customTicketEnabled&&this.options.activeSortTab===this.options.customTicketStr&&a!==this.currentSortBase}})})(window.R9,
window.jq||window.jQuery);
(function(h,d,k){h.createComponentClass("flights.results.FlightSnackshotHeader","common.results.SortTabContainer",{allTabs:null,customizeBestFlightsTooltip:null,moreDropdownElement:null,moreDropdownContainer:null,activeSortType:"",dropdownTabVisible:!1,dropdownTabActive:!1,tabIndicator:null,tabIndicatorId:null,backupTab:null,options:{snackshotData:null,tabIndicatorPadding:!1,customTicketEnabled:!1,vacationOptimizedEnabled:!1,msg:{takeoffTemplate:"",landingTemplate:""}},init:function(){this.unrolledTabs=
this.element.find(".js-sort-tab-unrolled");this.rolledTabs=this.element.find(".js-sort-tab-rolled");this.lastUnrolledTab=d();this.allTabs=this.unrolledTabs.add(this.rolledTabs);this.moreDropdownElement=this.element.find(".js-sort-dropdown-widget");this.moreDropdown=this.moreDropdownElement.parent().getWidget();this.moreDropdownContainer=this.getChildElement("sort-dropdown-container");this.tabIndicator=this.getChildElement("tab-indicator");this.customizeBestFlightsTooltip=this.getChildElement("bestflights-settings-icon").getWidget();
this.activeSortType=this.options.activeSortTab;this.dropdownTabVisible=this.dropdownTabActive=!!this.getTabForType(this.rolledTabs,this.activeSortType).length;this.ascendingDirection&&(this.options.sortDirection=this.ascendingDirection);this.options.vacationOptimizedEnabled&&(this.backupTab=this.getChildElement("backup-tab-container").children().eq(0),this.removeUnrolledTab(this.backupTab))},addEventHandlers:function(){this.base();this.subscribe("flights.sort.handleNewSearch",this.handleNewSearch.bind(this));
this.moreDropdown&&(this.moreDropdown.setOption("onOpen",this.handleDropdownToggle.bind(this,!0)),this.moreDropdown.setOption("onClose",this.handleDropdownToggle.bind(this,!1)),this.subscribe("sortDropdown.visibility.change",this.onSortDropdownVisible.bind(this)));this.customizeBestFlightsTooltip&&(this.registerEvent("click",this.customizeBestFlightsTooltip.element,function(){return!1}),this.customizeBestFlightsTooltip.setOption("onOpen",function(){h.events.publish("flights.resultspage.customizeBestFlights.tooltip.open")}),
this.subscribe("flights.resultspage.customizeBestFlights.tooltip.close",this.customizeBestFlightsTooltip.close.bind(this.customizeBestFlightsTooltip)))},getTabForType:function(a,b){return a.filter("[data-sort\x3d'"+b+"']")},handleNewSearch:function(a){this.updateOriginDestination(a.params);this.resetSnackshotDisplay();this.options.vacationOptimizedEnabled&&this.checkUnrolledCompatability(a.params,a.resetCallback)},checkUnrolledCompatability:function(a,b){var c=!(a.oneway||a.isMulticity);a=this.getTabForType(this.unrolledTabs,
"optimized_a");var e=this.unrolledTabs.length-1;if(c){if(a.length)return;a=this.backupTab.detach();c=this.unrolledTabs.eq(e);a.insertBefore(c);this.swapClasses(a,"SortTab--hidden","SortTab--visible");this.backupTab=c.detach();this.backupTab.appendTo(this.getChildElement("backup-tab-container"));this.removeUnrolledTab(c);this.unrolledTabs=this.unrolledTabs.add(a)}else{if(!a.length)return;this.backupTab.insertBefore(a);a.detach();this.swapClasses(this.backupTab,"SortTab--hidden","SortTab--visible");
this.removeUnrolledTab(a);this.unrolledTabs=this.unrolledTabs.add(this.backupTab);this.backupTab=a}this.backupTab.data("code")+"_"+this.backupTab.data("direction")===this.activeSortType&&b()},updateOriginDestination:function(a){a.origin&&(this.fillAirportCodeLabels(a.origin,"depart",this.options.msg.takeoffTemplate),this.fillAirportCodeLabels(a.origin,"arriveReturn",this.options.msg.landingTemplate));a.destination&&(this.fillAirportCodeLabels(a.destination,"arrive",this.options.msg.landingTemplate),
this.fillAirportCodeLabels(a.destination,"departReturn",this.options.msg.takeoffTemplate))},fillAirportCodeLabels:function(a,b,c){a=h.Common.Utils.String.formatString(c,"string"===typeof a?a.split("/")[0]:"");this.getTabForType(this.rolledTabs,b+"_a").add(this.getTabForType(this.rolledTabs,b+"_b")).find(".js-label").text(a)},onSortDropdownVisible:function(a){this.setDropdownTabVisible(a);a||(this.swapClasses(this.rolledTabs,"SortTab--visible","SortTab--hidden"),this.rolledTabs.attr({"aria-hidden":!0,
"data-hidden":!0}))},handleDropdownToggle:function(a){var b=a&&!this.dropdownTabActive;this.moreDropdownElement.toggleClass(this.getStlBlock("SortDropdown__Trigger--dropdown-tab-hidden--open"),b);this.rolledTabs.filter("[data-hidden\x3d'false']").find(".js-sort-tab-row").toggleClass(this.getStlBlock("SortTab__RowContainer--rolled--open"),a)},handleResultsResponse:function(a){this.base(a);a&&a.sortTabData&&this.updateSnackshotDisplay(a)},updateSnackshotDisplay:function(a){Object.keys(a.sortTabData).forEach(function(b){if(b=
a.sortTabData[b]){var c=this.getTabForType(this.unrolledTabs,b.code);this.renderSnackshotDataForTab(c,b)}}.bind(this));this.resetChangeTabIndicator(this.getTabForType(this.allTabs,this.activeSortType),300)},resetSnackshotDisplay:function(){this.unrolledTabs.each(function(a,b){this.renderSnackshotDataForTab(d(b))}.bind(this));this.backupTab&&this.renderSnackshotDataForTab(this.backupTab);this.tabIndicator.width(0)},renderSnackshotDataForTab:function(a,b){if(a.length){b=b||{price:"--",stops:"",duration:""};
var c=a.find(".js-price"),e=a.find(".js-stops"),f=a.find(".js-subtitle");a=a.find(".js-duration");f&&0<f.length&&"--"===b.price&&(b.price="");c.text(b.price);e.text(b.stops);a.text(b.duration);this.swapClassesToggle(a,"SortTab__SubLabel--SeparatorLeft--present","SortTab__SubLabel--SeparatorLeft--empty",!!b.stops&&!!b.duration)}},handleSortModeChange:function(a){a&&a.sortCode&&(a=a.customTicket?"customTicket"+this.sortTabSeparator+this.ascendingDirection:a.sortCode,this.updateSortLayout(a),this.setActiveTab(a))},
onSortTabClicked:function(a,b){var c=this.options.activeSortTab,e=c&&a.dataset&&a.dataset.sort===c,f=b&&b.target&&d(b.target).parents(".js-dropIcon").length;(this.getTabForType(this.rolledTabs,c).length||f)&&(e||f)&&this.moreDropdown?this.moreDropdown.isOpen?this.moreDropdown.close():h.dom.schedule(function(){this.moreDropdown.open()}.bind(this)):this.base(a,b)},updateSortLayout:function(a){a=this.getTabForType(this.rolledTabs,a);if(this.dropdownTabVisible||a.length)this.dropdownTabActive=!!a.length,
this.addSwapDropdownTab(a),this.setDropdownTabVisible(!this.dropdownTabActive)},setDropdownTabVisible:function(a){this.dropdownTabVisible=a;this.swapClassesToggle(this.moreDropdownContainer,"SortDropdown--dropdown-tab-visible","SortDropdown--dropdown-tab-hidden",a);this.swapClassesToggle(this.moreDropdownElement,"SortDropdown__Trigger--dropdown-tab-visible","SortDropdown__Trigger--dropdown-tab-hidden",a)},addSwapDropdownTab:function(a){var b=this,c=this.rolledTabs.filter("[data-hidden\x3d'false']");
if(this.dropdownTabActive&&!this.dropdownTabVisible&&!c.length&&a.attr("data-hidden"))this.swapClasses(a,"SortTab--hidden","SortTab--visibility--animation"),k.setTimeout(function(){b.swapClasses(a,"SortTab--visibility--animation","SortTab--visible")},0);else if(a.length&&c.length&&!c.is(a))this.swapClasses(a,"SortTab--hidden","SortTab--visible"),this.swapClasses(c,"SortTab--visible","SortTab--hidden");else return;this.rolledTabs.attr({"aria-hidden":!0,"data-hidden":!0});a.attr({"aria-hidden":!1,"data-hidden":!1})},
moveSelectedRolledTab:function(){},setActiveTab:function(a){var b=this.getTabForType(this.allTabs,this.activeSortType);if(a&&a!==this.activeSortType){var c=b.find(".js-border-container"),e=b.find(".js-label"),f=b.find(".js-subLabel"),g=this.getTabForType(this.allTabs,a),d=g.find(".js-border-container"),k=g.find(".js-label"),l=g.find(".js-subLabel");this.swapClasses(b,"SortTab--active","SortTab--inactive");this.swapClasses(c,"SortTab--active__BorderContainerBottom","SortTab--inactive__BorderContainerBottom");
this.swapClasses(e,"SortTab__Label--active","SortTab__Label--inactive");this.swapClasses(f,"SortTab__SubLabel--active","SortTab__SubLabel--inactive");this.swapClasses(g,"SortTab--inactive","SortTab--active");this.swapClasses(d,"SortTab--inactive__BorderContainerBottom","SortTab--active__BorderContainerBottom");this.swapClasses(k,"SortTab__Label--inactive","SortTab__Label--active");this.swapClasses(l,"SortTab__SubLabel--inactive","SortTab__SubLabel--active");b.removeAttr("aria-current");g.attr("aria-current",
"page");this.activeSortType=this.options.activeSortTab=a;this.options.customTicketEnabled&&h.events.publish("flights.results.setView",0===a.indexOf("customTicket")?"customticket":"list");a=0<=this.unrolledTabs.index(g)?50:300;this.resetChangeTabIndicator(g,a)}else 1>this.tabIndicator.width()&&this.resetChangeTabIndicator(b,300)},resetChangeTabIndicator:function(a,b){var c=this;clearTimeout(this.tabIndicatorId);0<b?this.tabIndicatorId=setTimeout(function(){c.changeTabIndicator(a)},b):c.changeTabIndicator(a)},
changeTabIndicator:function(a){var b=a&&a.length&&a.position();this.options.tabIndicatorPadding?b&&this.tabIndicator.width(a.width()-20).css("left",b.left+10+"px"):b&&this.tabIndicator.width(a.width()-2).css("left",b.left+1+"px")},removeUnrolledTab:function(a){var b=d(),c=a.data("code");this.unrolledTabs.each(function(){d(this).data("code")!==c&&(b=b.add(d(this)))});this.unrolledTabs=b},updateSortState:function(){}})})(R9,$,window);
function _slicedToArray(b,c){return _arrayWithHoles(b)||_iterableToArrayLimit(b,c)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}
function _iterableToArrayLimit(b,c){if(Symbol.iterator in Object(b)||"[object Arguments]"===Object.prototype.toString.call(b)){var a=[],d=!0,g=!1,e=void 0;try{for(var f=b[Symbol.iterator](),h;!(d=(h=f.next()).done)&&(a.push(h.value),!c||a.length!==c);d=!0);}catch(k){g=!0,e=k}finally{try{if(!d&&null!=f["return"])f["return"]()}finally{if(g)throw e;}}return a}}function _arrayWithHoles(b){if(Array.isArray(b))return b}
(function(b,c){b.createComponentClass("base.results.ResultsListHeader",{searchId:null,activeSortMode:{sortType:null,ascending:null},overriddenSortMode:null,trackInteractions:b.config.getBoolean("ui.horizon.base.results.ResultsListHeader.track.enabled",!0),options:{sortType:"rank_a",sortUnrolled:!1,quickLinkSort:!1},init:function(){var a=this;this.activeSortMode=this.getSortDataFromString(this.options.sortType);this.answer("resultsHeader.sortMode",function(){return a.activeSortMode})},addEventHandlers:function(){var a=
this;this.subscribe("resultsHeader.changed",function(b){return a.onChange(b)});this.subscribe("resultspage.sortMode.changed",function(b){return a.onChange(b)});this.subscribe("resultsHeader.sortType.set",this.setSortType.bind(this));this.subscribe("resultsHeader.sortType.force",this.forceSortType.bind(this));this.subscribe("resultsHeader.sortType.resetForced",this.resetForcedSortType.bind(this))},onChange:function(a){a.sort?this.activeSortMode=a.sort:a.sortCode&&(this.activeSortMode=this.getSortDataFromString(a.sortCode))},
setSortType:function(a){(a=this.processSortParams(a))&&(a.sortCode!==this.getStringFromSortData(this.activeSortMode)||a.reviewType||a.forceChange)&&(a.isForcedSort||(this.overriddenSortMode=null),a.silent||this.pushSortUpdates(a))},processSortParams:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(a.reviewType)a.sortCode="userrating";else if(!a.sortCode)return this.log.console('missing data sent in "resultsHeader.sortType.set" event.\n                Please publish an object with at least a sortCode or a reviewType property.'),
null;a.sort=this.getSortDataFromString(a.sortCode);"customTicket"===a.sort.sortType&&(a.customTicket=!0);return a},pushSortUpdates:function(a){this.logSortTypeChange(a);b.events.publish("resultsHeader.changed",a)},forceSortType:function(a){if(this.getStringFromSortData(this.activeSortMode)!==a.sortCode){var d=this.activeSortMode;a=c.extend({},a,{isForcedSort:!0});b.events.publish("resultsHeader.sortType.set",a);this.overriddenSortMode=d}},resetForcedSortType:function(){if(this.overriddenSortMode){var a=
{sortCode:this.getStringFromSortData(this.overriddenSortMode)};b.events.publish("resultsHeader.sortType.set",a)}},getSortDataFromString:function(a){a=a.split("_");a=_slicedToArray(a,2);var b=a[1];return{sortType:a[0],ascending:b?"a"===b:null}},getStringFromSortData:function(a){var b=a.sortType;a=a.ascending;return"undefined"===typeof a||null===a?b:"".concat(b,"_").concat(a?"a":"b")},logSortTypeChange:function(a){a.sort&&a.sort.sortType&&(this.trackInteractions&&this.trackSortBy(a.sort.sortType,a.sort.ascending),
a.sort.ascending&&b.Analytics.api.trackEvent({category:"Sort",action:a.sort.sortType,label:this.generateSortLoggingLabel(a.sort.sortType,a.sort.ascending)}))},generateSortLoggingLabel:function(a,b){return"".concat(a,"_").concat(b?"ascending":"descending")},trackSortBy:function(a,d){if(b.VestigoEvents){var c=d?b.VestigoType.Sortable.asc:b.VestigoType.Sortable.desc,e=b.VestigoEvents.sortresults;switch(a){case "price":e.price(c);break;case "distance":e.distance(c);break;case "recommended":case "rank":d&&
e.recommended()}}}})})(window.R9,window.jq||window.jQuery);
(function(c,d){c.createComponentClass("flights.results.FlightResultsListHeader","base.results.ResultsListHeader",{addEventHandlers:function(){this.base();var f=this,a=this.element;a.find(".col-views \x3e a").click(function(){a.find(".active").removeClass("active").attr("aria-selected",!1);d(this).addClass("active").attr("aria-selected",!0);c.events.publish("flights.results.setView",d(this).data("view"))});a.find(".col-views \x3e .switch").click(function(){var b=a.find(".col-views \x3e a"),e=b.filter(".active")[0],
b=b.not(".active")[0];d(e).removeClass("active").attr("aria-selected",!1);d(b).addClass("active").attr("aria-selected",!0);c.events.publish("flights.results.setView",d(b).data("view"))});this.subscribe("flights.results.header.setView",function(b){a.find(".col-views \x3e a").removeClass("active").attr("aria-selected",!1);a.find(".col-views \x3e a[data-view\x3d%s]".format(b)).addClass("active").attr("aria-selected",!0)});this.subscribe("flights.results.aboveResultsContent.toggleHidden",function(a){f.element.toggleClass("hidden",
0===a)})},generateSortLoggingLabel:function(c,a){switch(c){case "price":return a?"cheapest":"mostexpensive";case "recommended":return a?"best":"worst";case "duration":return a?"shortest":"longest";case "airline":return a?"AtoZ":"ZtoA";case "depart-takeoff":return a?"early":"late";case "depart":return a?"early":"late";case "return-takeoff":return a?"early":"late";case "return":return a?"early":"late"}},trackSortBy:function(d,a){if(c.VestigoEvents){var b=a?c.VestigoType.Sortable.asc:c.VestigoType.Sortable.desc,
e=c.VestigoEvents.sortresults;switch(d){case "depart-takeoff":case "depart":e.origintakeoff(b);break;case "return-takeoff":case "return":e.desttakeoff(b);break;case "arriveReturn":e.originlanding(b);break;case "arrive":e.destlanding(b);break;case "duration":e.duration(b);break;case "bestflight":e.recommended();break;default:this.base(d,a)}}}})})(R9,jQuery);
(function(b,d){var c=b.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");b.createWidgetClass("dropdown.Dropdown",{status:null,select:null,selectEl:null,refreshTimer:null,lastSelectedIndex:-1,options:{click:null,change:null,statusClientTemplate:""},init:function(){this.status=this.getChildElement("status");this.status.length||(this.status=this.element.find(".status"));this.select=this.getChildElement("select");this.select.length||(this.select=this.element.find("select"));
this.selectEl=this.select.get(0)},addEventHandlers:function(){this.select.click(this.handleSelectClickEvent.bind(this));this.select.keydown(this.handleSelectKeydownEvent.bind(this));this.select.keyup(this.handleSelectKeyupEvent.bind(this));this.select.focus(this.handleSelectFocusEvent.bind(this));this.select.blur(this.handleSelectBlurEvent.bind(this));this.select.change(this.handleSelectChangeEvent.bind(this))},refresh:function(){this.select.is(":disabled")?this.element.addClass("disabled"):this.element.removeClass("disabled");
var a=this.selectEl.selectedIndex;0>a&&(a=0);a=this.selectEl.options[a];"undefined"!==typeof a&&(this.options.statusClientTemplate?this.status.html(b.template.render(this.options.statusClientTemplate,a)):(this.status.html(b.utils.escapeHTML(a.title||a.text||a.value)),this.selectEl.title=a.title||a.text||a.value))},startRefreshLoop:function(){var a=this;this.lastSelectedIndex=this.selectEl.selectedIndex;this.refreshTimer=setInterval(function(){a.doRefresh()},100)},stopRefreshLoop:function(){null!=
this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null,this.lastSelectedIndex=-1)},doRefresh:function(){this.selectEl.selectedIndex!=this.lastSelectedIndex&&(this.lastSelectedIndex=this.selectEl.selectedIndex,this.refresh())},handleSelectClickEvent:function(){"function"===typeof this.options.click&&this.options.click(this);this.stopRefreshLoop()},handleSelectKeydownEvent:function(){this.startRefreshLoop()},handleSelectKeyupEvent:function(){this.refresh();this.stopRefreshLoop()},
handleSelectFocusEvent:function(){this.selectEl.disabled||this.element.addClass("focused").addClass(c)},handleSelectBlurEvent:function(){this.selectEl.disabled||(this.element.removeClass("focused").removeClass(c),this.refresh(),this.stopRefreshLoop())},handleSelectChangeEvent:function(a){"function"===typeof this.options.change&&this.options.change.call(this,a);this.refresh();this.stopRefreshLoop()},getSelectedElement:function(){return this.selectEl.options[0<=this.selectEl.selectedIndex?this.selectEl.selectedIndex:
0]},getName:function(){return this.selectEl.name},hasOptions:function(){return 0!==this.selectEl.options.length},getValue:function(){return this.hasOptions()?this.getSelectedElement().value:null},val:function(a){if("undefined"!==typeof a)this.setValue(a);else return this.getValue()},getText:function(){return d(this.getSelectedElement()).text()},setText:function(a){this.status.text(a)},setValue:function(a,b){this.select.val(a);b?this.select.trigger("change"):this.refresh()},setOptions:function(a,b){var c=
d("\x3cselect\x3e");d.each(a,function(a,e){e.value===b&&(e.selected=!0);c.append(d("\x3coption\x3e",e))});this.select.html(c.html());this.refresh()}})})(R9,jQuery);
(function(c,f){c.createComponentClass("common.trips.MoveEventDialog",{dialog:null,contentEl:null,loaderEl:null,resultId:null,tripId:null,eventId:null,legNum:-1,templates:{moveEventDialogContent:"moveEventDialogContent",moveEventActionContent:"moveEventSuccessContent",moveErrorContent:"moveEventError"},options:{msg:{upcomingTripsOptionHeader:void 0,pastTripsOptionHeader:void 0,unexpectedErrorMessage:void 0,unexpectedErrorTitle:void 0,accessDeniedTitle:void 0,accessDeniedMessage:void 0}},init:function(){this.contentEl=
this.getChildElement("contentPlaceholder");this.loaderEl=this.getChildElement("loader")},inlineComponentsReady:function(){this.dialog=this.element.getWidget()},addEventHandlers:function(){var a=this;this.subscribe("trips.move.dialog.open",f.proxy(this.processOpenEvent,this));this.subscribe("trips.move.dialog.close",function(){a.dialog.close()})},showGeneralError:function(a,b){var e=this;b=b||this.options.msg.unexpectedErrorMessage;a=a||this.options.msg.unexpectedErrorTitle;this.loaderEl.hide();a=
c.template.renderElement(this.templates.moveErrorContent,{title:a,message:b});this.contentEl.html(a);this.dialog.isOpen()||this.dialog.open();this.getChildElement("closeBtn").on("click",function(){e.dialog.close()})},handleGeneralError:function(a){a=a&&403===a.status;this.showGeneralError(a?this.options.msg.accessDeniedTitle:this.options.msg.unexpectedErrorTitle,a?this.options.msg.accessDeniedMessage:this.options.msg.unexpectedErrorMessage)},processOpenEvent:function(a){this.clearData();if(a.tripId&&
a.eventId&&a.resultId)this.tripId=a.tripId,this.eventId=a.eventId,this.resultId=a.resultId,a.legNum&&(this.legNum=a.legNum),c.action.execute("common.trips.ajax.EventData",{tripId:a.tripId,eventId:a.eventId}).done(f.proxy(this.onEventContentData,this)).fail(f.proxy(this.handleGeneralError,this)),this.contentEl.html(""),this.loaderEl.show(),this.dialog.open();else throw Error("tripId, eventId and resultId are required");},generateDropdownOptions:function(a,b){var e=this,d=[];a=a||[];0<a.length&&(d.push({value:null,
text:c.Common.Utils.String.formatString(b,a.length),checked:!1,disabled:!0}),a.forEach(function(a,b){d.push({value:b.id,text:b.title,checked:b.id===e.tripId,disabled:!1})}));return d},onEventContentData:function(a){this.loaderEl.hide();var b=a.data;a=this.generateDropdownOptions(b.upcomingTrips,this.options.msg.upcomingTripsOptionHeader);var e=this.generateDropdownOptions(b.pastTrips,this.options.msg.pastTripsOptionHeader),d=b.event&&b.event.type||b.legs&&b.legs.length&&b.legs[0].type||"generic",
b=c.template.renderElement(this.templates.moveEventDialogContent,{hasLegs:null!=b.legs,hasTrips:0<b.upcomingTrips.length||0<b.pastTrips.length,legs:b.legs,event:b.event,showLegTabs:0<=this.legNum,oneLeg:0<=this.legNum&&null!=b.legs?b.legs[this.legNum]:null,eventType:d,eventIsHotel:"hotel"===d,eventIsFlight:"flight"===d,eventIsCar:"car"===d,eventIsUnknown:"generic"===d});this.contentEl.html(b);this.dialog.isOpen()||this.dialog.open();this.bindMoveEventDialog(a.concat(e))},bindMoveEventDialog:function(a){var b=
this,e=new c.common.widgets.dropdown.Dropdown(this.id("dropdown"),{change:function(){c.Analytics.api.trackEvent("move-event/trip-picker ")}});0<a.length&&e.setOptions(a);this.setTabs();var d=this.getChildElement("legs"),h=this.getChildElement("trips"),l=this.getChildElement("tripName"),k=this.getChildElement("error"),g=this.getChildElement("moveBtn");h.on("tabs.change",function(){var b=f(this).data("active");0===b&&0===a.length?g.attr("disabled","disabled"):g.removeAttr("disabled");c.Analytics.api.trackEvent(0===
b?"move-event/existing-trip":"move-event/new-trip")});d.on("tabs.change",function(){var a=f(this).data("active");c.Analytics.api.trackEvent(0===a?"move-event/select-all-legs":"move-event/select-one-leg")});g.on("click",function(){c.Analytics.api.trackEvent("move-event/move");b.loaderEl.show();k.hide();var a=1===d.data("active")?b.legNum:null,f=1===h.data("active")?l.val():null,m=0===h.data("active")?e.getValue():null;c.action.execute("common.trips.ajax.MoveEventAction",b.getMoveRequestData(m,f,a)).done(function(a){a.success?
(g.off("click"),e.destroy(),b.onEventMove(a)):(b.loaderEl.hide(),k.text(a.data.errorMsg),k.show())}).fail(function(a){g.off("click");e.destroy();b.handleGeneralError(a);c.events.publish("trips.move.event.failed")})})},onEventMove:function(a){var b=this;c.events.publish("trips.move.event.finished",{oldTripId:this.tripId,newTripId:a.data.newTripId,newTripName:a.data.newTripName,resultId:this.resultId,tripId:a.data.newTripId,tripName:a.data.newTripName,tripUrl:a.data.tripUrl,responseData:a.data});c.events.publish("trips.auto.save.data",
{tripId:a.data.newTripId,tripName:a.data.newTripName});this.loaderEl.hide();a=c.template.renderElement(this.templates.moveEventActionContent,a.data);this.contentEl.html(a);this.dialog.isOpen()||this.dialog.open();this.getChildElement("closeBtn").on("click",function(){b.dialog.close();c.Analytics.api.trackEvent("move-event/success-close")});this.getChildElement("tripLink").on("click",function(){c.Analytics.api.trackEvent("move-event/success-go-to-new")})},clearData:function(){this.eventId=this.tripId=
null;this.legNum=-1},setTabs:function(){function a(a){a.data("active",a.find("li.selected").index())}this.element.find(".tabs").parent().each(function(){var b=f(this),c=b.find(".tabs li");a(b);c.click(function(){var d=f(this);b.data("active")!==d.index()&&(c.removeClass("selected"),d.addClass("selected"),b.find(".tab").hide(),b.find("#"+d.attr("rel")).show(),a(b),b.trigger("tabs.change"))})})},getMoveRequestData:function(a,b,c){a={oldTripId:this.tripId,newTripId:a,newTripName:b,eventId:this.eventId,
legNum:c};for(var d in a)null===a[d]&&delete a[d];return a}})})(window.R9,window.jQuery);
(function(c,e){c.createComponentClass("common.trips.ResultsSavedItems",{savedItemsListContainer:null,savedItemsListEl:null,savedItemsHeader:null,goToTripEl:null,shareToTripsEl:null,compareLink:null,expiryMessageEl:null,headerTitleEl:null,isExpanded:!1,clickElementsToAvoid:null,options:{tripsURL:void 0,globalUrl:null,tripsFullUrl:null,showShareTripIcon:!1,sharingDialogTitle:"",msg:{viewTrip:void 0,viewTrips:void 0,savedToTripItems:void 0,savedToTripsItems:void 0,tripsCounter:void 0},stickyEnabled:!1,
isSaveInPlaceEnabled:void 0,vertical:void 0,searchPollURL:null,extraPollRequest:!0,watchlistMakeoverEnabled:!1,tripToastEnabled:!0},listSize:0,tripsMap:{},searchId:void 0,hasNewSearchId:!1,savedItemsHeaderPlaceholder:null,resultItemClass:c.strings.encodeClassName("Base-Results-HorizonResult"),init:function(){this.goToTripEl=this.getChildElement("tripsLink");this.options.showShareTripIcon&&(this.shareToTripsEl=this.getChildElement("shareTripsLink"));this.savedItemsHeader=this.getChildElement("header");
this.savedItemsHeaderPlaceholder=this.getChildElement("headerPlaceholder");this.tripsToggleEl=this.getChildElement("savedItemsList");this.savedItemsListContainer=this.getChildElement("savedItemsList");this.savedItemsListEl=this.savedItemsListContainer.find(".list");this.compareLink=this.getChildElement("CompareLink");this.expiryMessageEl=this.getChildElement("expiryMessage");this.headerTitleEl=this.getChildElement("headerTitle");this.options.isSaveInPlaceEnabled&&this.savedItemsListContainer.hide()},
inlineComponentsReady:function(){},initSticky:function(){this.options.stickyEnabled&&this.createStickyHeader()},resultsHeaderChanged:function(a){this.hideSavedItemList();var b=!(!a.hasOwnProperty("refreshResults")||!a.refreshResults);this.onSearchPollResponse(a,b)},addEventHandlers:function(){var a=this;this.subscribe("resultItem.saved",e.proxy(this.onItemSaved,this));this.subscribe("resultItem.removed",e.proxy(this.onItemRemoved,this));this.subscribe(["resultspage.streaming.done","resultspage.refreshed"],
e.proxy(this.onSearchPollResponse,this));this.subscribe(this.options.vertical+".results.savedItems.update",this.onSavedResultsUpdate.bind(this));this.subscribe("resultspage.searchId.changed",e.proxy(this.onSearchIdChange,this));this.subscribe("filters.changed",e.proxy(this.onFiltersChange,this));this.subscribe("resultsHeader.changed",e.proxy(this.resultsHeaderChanged,this));this.subscribe("resultspage.streaming.start",e.proxy(this.initSticky,this));this.subscribe("trips.move.event.finished",e.proxy(this.onItemMoved,
this));this.subscribe("trips.move.event.failed",e.proxy(this.onItemMoveFailed,this));this.subscribe("resultsSavedItems.show",e.proxy(this.updateVisibility,this));this.subscribe("resultsSavedItems.hide",e.proxy(this.hideSavedItemList,this));this.savedItemsListEl.on("click",".bookingLink",this.logBookit);this.goToTripEl.on("click",this.logGoToTrip);var b=this.options;if(b.showShareTripIcon)this.shareToTripsEl.on("click",function(d){d.stopPropagation();d.preventDefault();var f=a.getFirstTrip();d=a.savedItemsListContainer.find("div[data-resultid]").data("resultid");
var h=0===f.tripUrl.indexOf("http")?f.tripUrl:a.options.globalUrl+f.tripUrl,f=e("\x3cdiv\x3e").text(f.tripName).html();c.events.publish("share",{page:b.vertical,sourceId:"saveditems-sharetrip",searchId:a.searchId,resultId:d,tripShareUrl:h,tripSourceName:"\x3cdiv\x3e"+f+"\x3c/div\x3e",hideSharingForm:!0,sharingDialogTitle:b.sharingDialogTitle})});e("#"+this.id("expiryMessage")).click(function(){c.events.publish("show.login.options.dialog",{forceLogin:!0,trackingLabel:"urgency-message"})});if(c.config.getBoolean("trips.cleanupAfterSearch",
!0)){var d=this;this.subscribe("resultspage.cleanup",function(a){a===d.searchId&&d.clearState()})}},onItemMoved:function(a){this.addItemToMap(a.newTripId,a.newTripName,a.responseData.tripUrl);this.removeItemFromMap(a.oldTripId);this.updateTripsLinkAndHeader(this.listSize)},onItemMoveFailed:function(){this.updateTripsLinkAndHeader(this.listSize)},logBookit:function(){c.Analytics.api.trackEvent({subPageId:"saved",category:"clickthrough"})},logGoToTrip:function(){c.Analytics.api.trackEvent({subPageId:"saved",
category:"go-to-trip"})},onFiltersChange:function(){this.setShowHideListState(!1,!1)},hideSavedItemList:function(){this.element.removeClass("visible")},onSearchIdChange:function(a){this.searchId!==a.searchId&&this.clearState()},clearState:function(){this.hideSavedItemList();this.listSize=0;this.tripsMap={}},onSearchPollResponse:function(a,b){var d=a.searchId&&0<a.searchId.length&&!a.streaming&&this.searchId!==a.searchId;b=(b||!1)&&this.searchId&&0<this.searchId.length;this.setShowHideListState(this.tripsToggleEl.data("toggle"),
!0);d&&(this.searchId=a.searchId);d||b?(d={searchId:this.searchId},a.hasOwnProperty("priceType")&&e.extend(d,{priceType:a.priceType}),this.ajaxSavedSearchPoll(d)):(this.options.watchlistMakeoverEnabled||this.updateVisibility(),a=this.getFirstTripId(),this.tripsMap.hasOwnProperty(a)&&c.events.publish("trips.auto.save.data",{tripId:a,tripName:this.tripsMap[a].tripName}))},ajaxSavedSearchPoll:function(a){if(this.options.extraPollRequest){var b=this;a&&(a={data:a,beforeScript:function(){b.savedItemsListEl.empty();
b.destroyOldResults.bind(b)},enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.savedSearchPoll",!0),appendTo:this.options.isSaveInPlaceEnabled?e("\x3cdiv\x3e"):b.savedItemsListEl},c.ajax.execute(b.options.searchPollURL,a))}},destroyOldResults:function(){this.savedItemsListEl.find("."+this.resultItemClass).each(function(){c.ComponentManager.remove(e(this).attr("id"))})},onSavedResultsUpdate:function(a){this.listSize=a.listSize;this.tripsMap=a.tripsMap;a.savedSearchId&&this.searchId!==a.savedSearchId&&
(this.searchId=a.savedSearchId);var b=this.getFirstTripId();this.tripsMap.hasOwnProperty(b)&&c.events.publish("trips.auto.save.data",{tripId:b,tripName:this.tripsMap[b].tripName});this.updateTripsLinkAndHeader(this.listSize);c.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.options.stickyEnabled&&c.events.publish("trips.counter.setValue",{id:this.id("TripsCounter"),value:this.listSize});this.updateVisibility();this._toggleCompareLink();var d=this.options.vertical;Object.keys(a.openDetails||
{}).each(function(a){c.events.publish(d+".inline.detail.heightChanged",{resultId:a})});this.setExpiryMessage(a.expiryMessage)},_toggleCompareLink:function(){this.compareLink.toggleClass("visible",1<this.listSize)},updateVisibility:function(){this.element.toggleClass("visible",0<this.listSize);0<this.listSize&&c.events.publish("trips.updateHeader")},setShowHideListState:function(a,b){b&&this.tripsToggleEl.data("toggle",a);this.savedItemsListContainer.toggleClass("visible",a)},showToast:function(a){a=
e.extend({},a);!a.eventId&&a.eventID&&(a.eventId=a.eventID);a=c.template.render("saveToTripToast",a);c.Widgets.Toaster.addToast(a,{button:!1,escaped:!0,theme:"centered"})},onItemSaved:function(a){var b=this,d=e("#"+a.resultItemElId);d.length||(d=e('[data-resultid\x3d"'+a.resultItemId+'"]'));var f=c.question.ask("resultsHeader.sortMode"),g=this.options.watchlistMakeoverEnabled&&"watchlist"!==f.sortType,h=d.hasClass("OpenFlex"),f=function(){var a=g||h?d.clone(!0,!0):d.detach();a.show();a.find(".removeItemOverlay").remove();
g&&a.find(".Common-Trips-ResultItemSaveToTrips").trigger("forceSaved",a);b.savedItemsListEl.append(a);a=b.savedItemsListEl.find("a.save");a.html(a.html());a=b.savedItemsListEl.find("a.share");a.html(a.html())};0!==this.listSize||g||this.element.addClass("visible");this.listSize++;this.options.isSaveInPlaceEnabled?d.find(".removeItemOverlay").remove():g||(h?(f(),c.events.publish("filters.changed",{})):d.fadeOut({duration:100,complete:f}));this.options.stickyEnabled&&(c.events.publish("trips.counter.notification.show",
{id:b.id("TripsCounter")}),c.events.publish("trips.counter.increase",{id:b.id("TripsCounter")}),setTimeout(function(){c.events.publish("trips.counter.notification.clear",{id:b.id("TripsCounter")})},3E3));!b.options.watchlistMakeoverEnabled&&b.options.tripToastEnabled&&this.showToast(a);c.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.addItemToMap(a.tripId,a.tripName,a.tripUrl);this.updateTripsLinkAndHeader(this.listSize);this._toggleCompareLink();this.setExpiryMessage(a.responseData.expiryMessage)},
onItemRemoved:function(a){var b=this.getResultItemElement(a.resultItemId,this.savedItemsListContainer);this.listSize--;0===this.listSize&&this.element.removeClass("visible");c.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.removeItemFromMap(a.tripId);this.updateTripsLinkAndHeader(this.listSize);this.options.isSaveInPlaceEnabled?(b=this.getResultItemElement(a.resultItemId),b.find(".removeItemOverlay").remove(),c.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,
remove:!0})):b.remove();this._toggleCompareLink();this.options.stickyEnabled&&c.events.publish("trips.counter.decrease",{id:this.id("TripsCounter")})},removeItemFromMap:function(a){var b=this.tripsMap[a];b&&(b.savedItemsCounter--,0===b.savedItemsCounter&&delete this.tripsMap[a])},addItemToMap:function(a,b,d){b={tripId:a,savedItemsCounter:1,tripName:b,tripUrl:d};a=a||"idStub";(d=this.tripsMap[a])?d.savedItemsCounter++:this.tripsMap[a]=b},getTripsIds:function(){return Object.keys(this.tripsMap)},getTripsCount:function(){return this.getTripsIds().length},
getFirstTrip:function(){return this.tripsMap[this.getTripsIds()[0]]},getFirstTripId:function(){return this.getTripsIds()[0]||null},updateTripsLinkAndHeader:function(a){var b=this.getTripsIds(),d=b.length;if(d){var e="\x3cstrong\x3e%s\x3c/strong\x3e".format(a),g=this.options.tripsURL;1===d?(b=this.tripsMap[b[0]],d=c.utils.escapeHTML(b.tripName),this.goToTripEl.html(this.options.msg.viewTrip),this.goToTripEl.attr("href",b.tripUrl),this.headerTitleEl.html(c.Common.Utils.String.formatChoice(this.options.msg.savedToTripItems,
a,e,d,b.tripUrl))):(this.goToTripEl.html(this.options.msg.viewTrips),this.goToTripEl.attr("href",g),this.headerTitleEl.html(c.Common.Utils.String.formatChoice(this.options.msg.savedToTripsItems,a,e,d,g)));this.setTripShareUrl(this.getFirstTrip().tripUrl);this.headerTitleEl.find("a").attr("target","_blank");this.goToTripEl.attr("target","_blank")}},setTripShareUrl:function(a){this.options.showShareTripIcon&&this.shareToTripsEl.attr("href",a)},clearSticky:function(){this.savedItemsHeaderPlaceholder.hide();
this.savedItemsHeader.removeClass("sticky layer-sticky")},setSticky:function(){this.savedItemsHeaderPlaceholder.show();this.savedItemsHeader.addClass("sticky layer-sticky");this.savedItemsHeader.css("width",this.element.width())},createStickyHeader:function(a){var b=this,d="function"===typeof a?a:e.noop,c=null;e(document).off("scroll.sticky").on("scroll.sticky",function(){b.savedItemsHeader.is(":visible")&&null===c&&(c=b.savedItemsHeader.offset().top,b.savedItemsHeaderPlaceholder.height(b.savedItemsHeader.outerHeight()));
null!==c&&(e(window).scrollTop()<c?b.clearSticky():b.setSticky())});setTimeout(function(){d()},500)},isSavedItemsOnScreen:function(){return e(window).scrollTop()<this.savedItemsHeader.offset().top+this.savedItemsHeader.outerHeight()},getResultItemElement:function(a,b){a="div[data-resultid\x3d'"+a+"']";return b?b.find(a):e(a)},setExpiryMessage:function(a){this.expiryMessageEl&&(1<this.getTripsCount()?this.expiryMessageEl.hide():a&&(this.expiryMessageEl.text(c.utils.escapeHTML(a)),this.expiryMessageEl.show()))},
avoidElementClick:function(a){return e(a.target).closest(this.clickElementsToAvoid).length}})})(R9,jQuery);
(function(d,e){d.createComponentClass("flights.results.PlaceholderList",{options:{legs:2,classes:null,isExpandable:!1},$results:null,init:function(){this.cards=this.element.find(".js-card")},addEventHandlers:function(){var b=this;this.options.isExpandable||this.subscribe(["searchform.submit","multilocale.search.submit"],function(c){b.morphResults(c.legCount)});this.options.isExpandable&&this.subscribe("placeholderlist.expand",{id:this.id()},this.expandList.bind(this));this.$results=this.element.children()},
expandList:function(){function b(){d.dom.swapClasses(e(c.cards[a]),d.stylejam.flights.results.PlaceholderList.expandingCardHidden,d.stylejam.flights.results.PlaceholderList.expandingCardShown);a++;a<f&&setTimeout(b,10)}var c=this,a=0,f=c.cards.length;b()},morphResults:function(b){var c=this.getStlClasses();c&&this.$results.each(function(){var a=e(this).find(".js-leg").parent(),f=a.children().length;if(f<b)for(var g=a.children().eq(0);f++<b;)g.clone().appendTo(a);a.children().each(function(a){d.dom.swapChildrenClasses(e(this),
c,"solo","default");d.dom.swapChildrenClasses(e(this),c,a>=b?"visible":"hidden",a>=b?"hidden":"visible")});1==b&&d.dom.swapChildrenClasses(a.children().eq(0),c,"default","solo")})}})})(R9,jQuery);
(function(a,c){a.createComponentClass("common.results.BookingLinksExpiredDialog",{expiredResultsDialog:null,options:{redirectUrl:""},addEventHandlers:function(){a.events.subscribe("search.expired",this.showBookingLinksExpiredDialog.bind(this))},showBookingLinksExpiredDialog:function(){var b=this;if(null===this.expiredResultsDialog){this.expiredResultsDialog=this.element.dialog({onClose:function(){a.events.publish("resultspage.transition.remove")}}).getWidget();var d=this.options.redirectUrl?this.options.redirectUrl:
"/";this.getChildElement("home-btn").click(function(){a.Analytics.api.trackEvent("booklinkexpired/homepage");window.location=d});this.getChildElement("refresh-btn").click(function(){c(document.body).css("cursor","wait");a.Analytics.api.trackEvent("booklinkexpired/refresh");a.config.getInt("ui.rp.limitExpiredReload",!0)?(a.events.publish("user.refresh.expired"),b.expiredResultsDialog&&b.expiredResultsDialog.close()):window.location.reload()})}this.expiredResultsDialog.open()}})})(R9,jQuery);
(function(b){window.showUsSanctionedCountriesPopup=function(){window.open("http://www.treasury.gov/resource-center/sanctions/Programs/Pages/Programs.aspx","_blank")};b.createComponentClass("common.results.SearchFailed",{defaultErrorMessage:null,hasUniqueNoResultsMessage:!1,failureTypes:{BAD_QUERY:"query",NO_RESULTS:"noresults",SERVER_ISSUE:"server",TIMEOUT:"timeout"},init:function(){var a=this;this.defaultErrorMessage=this.getChildElement("reason").html();b.events.when(["common.results.NoResults.ready",
"rentals.results.RentalNoResults.ready"],function(){a.hasUniqueNoResultsMessage=!0})},addEventHandlers:function(){var a=this;b.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this));b.events.subscribe("search.startSearch",this.hideSearchFailedView.bind(this));b.events.subscribe("resultspage.requestResults",this.hideSearchFailedView.bind(this));b.question.answer("SearchFailed.isNoResultsStatus",function(b){return a.failureTypes.NO_RESULTS===b})},handleSearchFailure:function(a){this.hasUniqueNoResultsMessage&&
a&&a.type===this.failureTypes.NO_RESULTS?this.hideSearchFailedView():this.showSearchFailedView(a&&a.userDisplayMessage?a.userDisplayMessage:this.defaultErrorMessage)},showSearchFailedView:function(a){this.getChildElement("reason").html(a);this.element.show()},hideSearchFailedView:function(){this.element.hide()}})})(R9);
(function(a){a.createComponentClass("common.results.NoResults","common.results.SearchFailed",{options:{vertical:null},addEventHandlers:function(){this.base();var b=this;a.events.ready("common.results.NoResults.ready",this.element);this.getChildElement("newSearchLink").click(function(c){c.preventDefault();a.events.publish(b.options.vertical+".inline.search.form.show",{focus:!0});return!1});a.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this))},handleSearchFailure:function(a){a&&
a.type===this.failureTypes.NO_RESULTS&&this.showSearchFailedView()}})})(R9);
(function(a,c){a.createComponentClass("flights.results.NoFlightResults","common.results.NoResults",{showNearbyAirportsButton:null,init:function(){this.base();this.showNearbyAirportsButton=this.getChildElement("showNearbyAirports")},addEventHandlers:function(){this.base();this.showNearbyAirportsButton.click(function(b){b.preventDefault();a.events.publish("flights.search.enableNearbyAirports",!0)})},showSearchFailedView:function(){a.question.ask("flights.search.canSuggestNearbyAirports")?this.showNearbyAirportsButton.show():
this.showNearbyAirportsButton.hide();this.element.is(":visible")||a.Analytics.api.trackEvent("flights/noFlightResults");this.element.show()}})})(R9,jQuery);
(function(d,c){d.createComponentClass("common.results.Paginator",{trackCategory:"Pagination",activeIndex:0,pageCount:0,pageNumberTemplateId:"paginatorItem",numbered:!0,loader:null,loading:!1,activeSearch:!1,options:{button:!1,buttonInfinite:!0,infinite:!1,silent:!1,maxPages:5,infiniteScrollingOffset:0,logUserInteraction:!1,disableDuringPolling:!1},init:function(){this.numbered=!this.options.button&&!this.options.infinite;this.numbered||(this.loader=this.getChildElement("loader"))},addEventHandlers:function(){var a=
this;this.subscribe("resultspage.searchId.changed",function(){a.activeSearch=!0});this.subscribe("resultspage.pageNumber.changed",function(b){a.setIndex(b);a.updateDOM()});this.subscribe("paginator.update",function(b){a.setIndex(b.pageNumber);a.updateBounds(b.pageCount);if(a.options.infinite)if(b.pageNumber===b.pageCount)c(window).off("scroll.pagination");else if(1===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));if(a.options.button){if(b.pageNumber>=b.pageCount||1===b.pageNumber||
!a.options.buttonInfinite)c(window).off("scroll.pagination");else if(2===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));b.pageNumber>=b.pageCount||0===b.pageCount?a.element.removeClass("visible"):a.element.addClass("visible")}a.updateDOM();a.getChildElement("loadMore").blur()});this.subscribe("paginator.hide",function(){a.element.removeClass("visible")});this.numbered?(this.element.find("a.page-Previous").click(function(b){1>=a.activeIndex?b.preventDefault():(a.options.logUserInteraction&&
a.logUserInteraction("Prev"),a.userChangedIndex(--a.activeIndex))}),this.element.find("a.page-Next").click(function(b){a.activeIndex>=a.pageCount?b.preventDefault():(a.options.logUserInteraction&&a.logUserInteraction("Next"),a.userChangedIndex(++a.activeIndex))})):this.subscribe("search.poll.response",function(){a.element.removeClass("loading");a.loading=!1});this.options.button&&(this.getChildElement("loadMore").click(function(){a.element.addClass("loading");a.logUserInteraction("More");a.userChangedIndex(++a.activeIndex)}),
this.getChildElement("loadMore").keypress(function(b){switch(b.which){case d.globals.keyCodes.RETURN:case d.globals.keyCodes.SPACE:a.getChildElement("loadMore").click()}}),this.subscribe("paginator.text.set",function(b){a.getChildElement("loadMore").text(b)}));if(this.options.infinite)c(window).on("scroll.pagination",a.scrollPagination.bind(a));this.options.disableDuringPolling&&(this.subscribe("resultspage.streaming.start",this.disablePaginator.bind(this,!0)),this.subscribe("resultspage.streaming.done",
this.disablePaginator.bind(this,!1)))},logUserInteraction:function(a,b){d.Analytics.api.trackEvent({category:this.trackCategory,action:a,label:b})},scrollPagination:function(){!this.loading&&this.activeSearch&&this.element.offset().top<c(window).scrollTop()+(c(window).height()+this.options.infiniteScrollingOffset)&&(this.element.addClass("loading"),this.loading=!0,this.userChangedIndex(++this.activeIndex))},disablePaginator:function(a){this.element.toggleClass("disabled",a)},userChangedIndex:function(a){this.setIndex(a);
d.events.publish("paginator.change",{pageNumber:a,append:this.options.button||this.options.infinite})},setIndex:function(a){this.activeIndex=a},getIndex:function(){return this.activeIndex},updateBounds:function(a){this.pageCount!==a&&(this.pageCount=a)},updateDOM:function(){var a=this;this.numbered&&!this.options.silent&&c("[page-idx]").each(function(){parseInt(c(this).attr("page-idx"))===a.activeIndex?c(this).removeClass("Paginator-Item-Hidden"):c(this).addClass("Paginator-Item-Hidden")});this.options.infinite||
this.options.button||(1<this.pageCount?(this.element.addClass("visible"),this.numbered&&(this.renderDisplayRange(),this.element.find("a.page-Next, a.page-Previous").removeClass("disabled"),this.activeIndex===this.pageCount?this.element.find("a.page-Next").addClass("disabled"):1===this.activeIndex&&this.element.find("a.page-Previous").addClass("disabled"))):this.element.removeClass("visible"))},renderPageLink:function(a){return d.template.render(this.pageNumberTemplateId,{index:a,cssClass:a===this.activeIndex?
"active":""})},renderEllipsis:function(){return"\x3cspan\x3e\x26nbsp;\x26hellip;\x26nbsp;\x3c/span\x3e"},renderDisplayRange:function(){var a=this,b=this.element.find("div.page-Numbers");b.html("");var d=this.renderPageLink(1),e=0<this.activeIndex-1?this.activeIndex-1:1,f=e+this.options.maxPages-1;f>=this.pageCount&&(f=this.pageCount,e=f-this.options.maxPages+1);for(2<e?d+=this.renderEllipsis():2>e?e=2:--f;e<f;e++)d+=this.renderPageLink(e);f<this.pageCount&&(d+=this.renderEllipsis());d+=this.renderPageLink(this.pageCount);
b.html(d).find("a").click(function(){c(this).parent().hasClass("active")||(a.options.logUserInteraction&&a.logUserInteraction("Page",c(this).data("idx")),a.userChangedIndex(c(this).data("idx")),c(this).parent().addClass("active"))})}})})(R9,jQuery);
(function(b,d){b.createComponentClass("flights.results.FlightResultsFooterDisclaimers",{options:{totalPriceEnabled:!1},addEventHandlers:function(){if(this.options.totalPriceEnabled){var c=this.getChildElement("priceDisclaimers");this.subscribe("searchform.submit",function(a){c.toggleClass("fullPrice",0<a.lapInfant)});this.subscribe("resultsHeader.changed",function(a){a.hasOwnProperty("priceType")&&c.toggleClass("fullPrice","totaltaxes"===a.priceType)})}var b=this.getChildElement("hackerFares");this.subscribe("resultspage.streaming.done",
function(){b.removeClass("hidden")})}})})(R9,jQuery);
(function(c,d){c.createComponentClass("common.results.AfterclickContainer",{options:{searchId:"",url:"",alwaysOnTop:!1,rateLimitCount:-1,rateLimitPeriod:864E5,rateLimitStorageKey:"hotel_afterclick_last",inMemory:!1,ignore:!1,rateLimited:!0},memory:[],dialogContent:null,dialog:null,afterClickMetaTestTag:null,init:function(){var b=this,a=b.options;this.dialogContent=this.getChildElement("content");a.rateLimitStorageKey||(a.rateLimitStorageKey="hotel_afterclick_last");c.globals.testMode&&(this.afterClickMetaTestTag=
d("["+this.dataTestTag("afterclick-metadata")+"]"),(a=this.getChildElement("afterclickdialog"))&&a.length&&d.extend(a.getWidget().options,{onClose:function(){c.globals.testMode&&b.afterClickMetaTestTag&&b.afterClickMetaTestTag.length&&(b.afterClickMetaTestTag.attr(b.dataTestTag("afterclick-is-loading"),"true"),b.afterClickMetaTestTag.attr(b.dataTestTag("afterclick-has-error"),"false"))}}))},addEventHandlers:function(){var b=this,a=b.options;b.subscribe("multibook.providerClicked",function(e){e&&e.afterclickIgnore||
a.ignore||b.openAfterclick(e.resultId)});b.subscribe("resultspage.searchId.changed",function(e){var c=a.searchId;e&&c!==e.searchId&&(a.searchId=e.searchId,b.update())})},update:function(){var b=this;c.ajax.execute("common/results/AfterclickContainer",{data:b.options,replace:!0,customUpdate:function(a){b.destroy();b.element.replaceWith(a.innerHTML);return!0}})},rateLimit:function(){var b=this.options,a=b.rateLimitStorageKey;return b.rateLimited?b.inMemory?(a=this.getTimeList(this.memory))?(this.memory=
a,!1):!0:c.storage.isAvailable()&&a?(b=this.getTimeList(c.storage.get(a)))?(c.storage.set(a,b),!1):!0:!1:!1},getTimeList:function(b){var a=new Date,c=this.options,d=isNaN(c.rateLimitCount)?2:c.rateLimitCount,c=isNaN(c.rateLimitPeriod)?864E5:c.rateLimitPeriod;if(0===d)return null;"string"===typeof b&&(b=[]);if(!b||b.length<d)return b?b.concat(a.getTime()):[a.getTime()];for(var f=0;f<d;f++){if(isNaN(b[f]))return[a.getTime()];if(a.getTime()-(new Date(b[f])).getTime()>c)return b[f]=a.getTime(),b}return null},
openAfterclick:function(b){var a=this;a.dialog&&a.dialog.isOpen()||!a.options.url||!a.options.searchId||a.rateLimit()||(a.dialog&&a.dialog.setContentDimensions("auto","auto"),b={resultId:b,searchId:a.options.searchId},c.Analytics.api.trackEvent({category:"AfterClick",action:"request"}),c.ajax.execute(a.options.url,{data:b,appendTo:this.dialogContent,replace:!0}).then(function(){a.dialog=a.getChildElement("afterclickdialog").dialog({extraCssClass:"afterclickModal",isOpenTopZindex:a.options.alwaysOnTop}).getWidget();
var b=a.getChildElement("content").children().eq(0);if(d("#acerror").length){c.globals.testMode&&a.afterClickMetaTestTag&&a.afterClickMetaTestTag.length&&a.afterClickMetaTestTag.attr(a.dataTestTag("afterclick-has-error"),"true");try{c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:d("#acerror").get(0).innerText.trim()})}catch(g){}console.log(d("#acerror").get(0).innerText)}else c.globals.testMode&&a.afterClickMetaTestTag&&a.afterClickMetaTestTag.length&&a.afterClickMetaTestTag.attr(a.dataTestTag("afterclick-has-error"),
"false"),c.Analytics.api.trackEvent({category:"AfterClick",action:"displayed"}),a.options.responsive?(a.dialog.setContentDimensions(b.outerWidth(),b.outerHeight(),"95%"),a.dialog.setViewPortOverflow("hidden")):a.dialog.setContentDimensions(b.outerWidth(),b.outerHeight()),a.dialog.setOption("onClose",function(){c.Analytics.api.trackEvent({category:"AfterClick",action:"closed"})}),a.dialog.open(),c.events.publish("afterclick.dialog.opened")}).fail(function(){c.globals.testMode&&a.afterClickMetaTestTag&&
a.afterClickMetaTestTag.length&&a.afterClickMetaTestTag.attr(a.dataTestTag("afterclick-has-error"),"true");c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:"ajax"})}),c.globals.testMode&&a.afterClickMetaTestTag&&a.afterClickMetaTestTag.length&&a.afterClickMetaTestTag.attr(a.dataTestTag("afterclick-is-loading"),"false"))}})})(window.R9,window.jQuery||window.jq);
(function(d,b){d.createComponentClass("common.results.ResultsPageNotifications",{options:{openDuration:6E3,priceAlertUiUpdate:!1},open:!1,queue:null,showTimeoutId:null,messageContainer:null,init:function(){this.queue=[];this.messageContainer=this.getChildElement("container").detach()},inlineComponentsReady:function(){this.toolTip=this.getChildElement("target").getWidget();this.toolTip.setOption("onClose",this.closeMessage.bind(this));this.toolTip.setOption("keepOpenOnContentHover",!0);this.toolTip.setOption("closeOnBodyClick",
!1);this.toolTip.setOption("fixedPositioning",{bottom:"50px",top:"inherit"})},addEventHandlers:function(){var a=this;this.options.priceAlertUiUpdate||this.subscribe("resultspage.notify",this.queueMessage.bind(this));b(document).on("click.notificationTooltip","#r9-tooltiprpnotify-wrapper .js-close",function(){a.open&&a.toolTip.close()})},destroy:function(){this.base();b(document).off("click.notificationTooltip")},queueMessage:function(a){this.queue.push(a);this.open||this.showNextMessage()},showNextMessage:function(){this.showTimeoutId&&
window.clearTimeout(this.showTimeoutId);this.showTimeoutId=window.setTimeout(this.handleNextMessage.bind(this),100)},handleNextMessage:function(){var a=this.queue.splice(0,1)[0];if(a&&a.content){this.messageContainer.find(".js-content").empty().append(a.content);this.toolTip.setContent(this.messageContainer);this.toolTip.open();this.open=!0;var c="number"===typeof a.openDuration?a.openDuration:this.options.openDuration;if(a.keepOpen||a.openWhileIdle){if(a.openWhileIdle)b(document).one("mousemove scroll click",
function(){this.toolTip.closeAfter(c)}.bind(this))}else this.toolTip.closeAfter(c)}},prepareMessage:function(a){this.messageContainer.find(".js-content").empty().append(a);return this.messageContainer},closeMessage:function(){this.open=!1;this.queue.length&&this.showNextMessage()}})})(R9,jQuery);
(function(a,c){a.createComponentClass("flights.results.FlightRightRail","base.results.Rail",{adsContainer:null,addEventHandlers:function(){this.subscribe("right.rail.hide",c.proxy(this.hide,this));this.subscribe("right.rail.show",c.proxy(this.show,this));if(-1<this.options.components.indexOf("price-prediction")){var a=this;this.subscribe("flights.results.priceAlertEnabled",function(b){a.getChildElement("priceAlertsContainer").css("display",b.enabled&&b.visible?"block":"none")})}this.subscribeForUpdatingPolicyInfo("FlightPolicyInformation",
"flightPolicyInfo")},hide:function(){var d=this,b=c.Deferred(),e=b.promise();this.unbindWindowEvents();this.hasAnimation()?(this.element.on(a.Common.Utils.Browsers.ANIMATION_END,function(){b.resolve();d.element.off(a.Common.Utils.Browsers.ANIMATION_END)}),this.element.addClass("animate")):b.resolve();e.then(function(){d.element.addClass("is-hidden");a.events.publish("right.rail.hideAnimationDone")})},show:function(){this.bindWindowEvents();this.element.removeClass("animate");this.element.removeClass("is-hidden");
this.onScroll()},hasAnimation:function(){return"0s"!==this.element.css("animationDuration")}})})(R9,jQuery);
/*
 @r9/cmp2-ui - 2.6.0 generated: 2021-06-16T14:20:55.313Z */
(function(){function v(f){var b=z[f];if(void 0!==b)return b.exports;b=z[f]={exports:{}};return C[f](b,b.exports,v),b.exports}var C={5232:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(9529);Object.defineProperty(b,"List",{enumerable:!0,get:function(){return k.List}});var l=a(2991);Object.defineProperty(b,"WindowInfo",{enumerable:!0,get:function(){return l.WindowInfo}});var g=a(9873);Object.defineProperty(b,"Settings",{enumerable:!0,get:function(){return g.Settings}})},9529:function(f,
b,a){Object.defineProperty(b,"__esModule",{value:!0});b.List=void 0;var k=a(4549);f=function(){function a(){}return a.getConfig=function(a){return{method:"POST",headers:k.getPostHeader(),url:"/s/horizon/compareTo/list",data:a}},a}();b.List=f},9873:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});b.Settings=void 0;f=function(){function a(){}return a.getConfig=function(){return{method:"GET",url:"/s/horizon/compareTo/config"}},a}();b.Settings=f},4549:function(f,b){Object.defineProperty(b,
"__esModule",{value:!0});b.getPostHeader=void 0;b.getPostHeader=function(){return{"Content-Type":"application/json; charset\x3dUTF-8"}}},2991:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.WindowInfo=void 0;var k=a(4549);f=function(){function a(){}return a.getStoreConfig=function(a,b,c){return void 0===c&&(c={}),{method:"POST",url:"/s/horizon/compareTo/WindowInformation/add",headers:k.getPostHeader(),data:{type:a.type,placement:a.placement,convertUrl:a.convertUrl,url:a.url?a.url:
"",items:b,other:c}}},a.getRetrieveConfig=function(a){return{method:"POST",url:"/s/horizon/compareTo/WindowInformation/list",headers:k.getPostHeader(),data:a}},a}();b.WindowInfo=f},8554:function(f,b,a){function k(a){a=a.split("/");for(var b=a.length,h=[],c=0;c<b;c++){var d=a[c];0!==d.length&&h.push(d)}return h.join("/").replace(/^(https?:)([\/])*/g,"$1//")}Object.defineProperty(b,"__esModule",{value:!0});var l=a(5694);b.updateBasePath=function(a){return b.BASE_PATH=k(a),-1===b.BASE_PATH.indexOf("http")&&
(b.BASE_PATH="/"+b.BASE_PATH),b.BASE_PATH};var g=/#.*$/,d=/\?/,c=/([?&])_=[^&]*/;b.formatUrl=function(a,e,m){void 0===e&&(e="");void 0===m&&(m=!0);a=(a=k(a))?a&&0===a.indexOf("http")?a:b.BASE_PATH.replace(/[\/]$/g,"")+"/"+a:b.BASE_PATH;if(e){var h=m;void 0===a&&(a="");void 0===e&&(e="");void 0===h&&(h=!0);m=a.replace(g,"");a=a.slice(m.length);e&&(e="object"==typeof e?l.param(e):e,m+=(d.test(m)?"\x26":"?")+e);e=(!1===h&&(m=m.replace(c,"$1"),a=(d.test(m)?"\x26":"?")+"_\x3d"+(new Date).getTime()+a),
m+a)}else e=a;return e};b.BASE_PATH=""},8716:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(3615),l=a(3815),g=a(4589);b.isArrayLike=function(a){var b=!!a&&"length"in a&&a.length,h=l.toType(a);return!k.isFunction(a)&&!g.isWindow(a)&&("array"===h||0===b||"number"==typeof b&&0<b&&b-1 in a)}},2038:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(8716);b.each=function(a,b){if(k.isArrayLike(a))for(var d=a.length,c=0;c<d&&!1!==b.call(a[c],c,a[c]);c++);else for(c in a)if(a.hasOwnProperty(c)&&
!1===b.call(a[c],c,a[c]))break;return a}},8293:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(7965),l=a(3615);b.extend=function d(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var e,m,q,t,r,u=a.length,n=a[0]||{},p=1,f=!1;"boolean"==typeof n&&(f=n,n=a[p]||{},p++);"object"==typeof n||l.isFunction(n)||(n={});for(p===u&&(n=this,p--);p<u;p++)if(null!=(b=a[p]))for(e in b)b.hasOwnProperty(e)&&(m=n[e],n!==(q=b[e]))&&(f&&q&&(k.isPlainObject(q)||(t=Array.isArray(q)))?
(t?(t=!1,r=m&&Array.isArray(m)?m:[]):r=m&&k.isPlainObject(m)?m:{},n[e]=d(f,r,q)):void 0!==q&&(n[e]=q));return n}},3615:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});b.isFunction=function(a){return"function"==typeof a&&"number"!=typeof a.nodeType}},7965:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(1394),l=a(5726),g=a(3180),d=a(2954);b.isPlainObject=function(a){var b,e;return!(!a||"[object Object]"!==d.toString.call(a))&&(!(b=Object.getPrototypeOf(a))||"function"==
typeof(e=g.hasOwn.call(b,"constructor")&&b.constructor)&&k.functionToString.call(e)===l.objectFunctionString)}},4589:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});b.isWindow=function(a){return null!=a&&a===a.window}},5694:function(f,b,a){function k(a,b,c,d){var e;if(Array.isArray(b))l.each(b,function(b,e){c||h.test(a)?d(a,e):k(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==g.toType(b))d(a,b);else for(e in b)b.hasOwnProperty(e)&&k(a+"["+e+"]",b[e],c,d)}
Object.defineProperty(b,"__esModule",{value:!0});var l=a(2038),g=a(3815),d=a(7965),c=a(3615),h=/\[\]$/;b.param=function(a,b,h){var e;void 0===b&&(b=!1);void 0===h&&(h="\x26");var m=[],q=function(a,b){b=c.isFunction(b)?b():b;m[m.length]=encodeURIComponent(a)+"\x3d"+encodeURIComponent(null==b?"":b)};if(Array.isArray(a)||!d.isPlainObject(a))l.each(a,function(a,b){q(a,b)});else for(e in a)a.hasOwnProperty(e)&&k(e,a[e],b,q);return m.join(h)}},3815:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});
var k=a(1383),l=a(2954);b.toType=function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?k.class2Type[l.toString.call(a)]||"object":typeof a}},6771:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});b.addEvent=function(a,b,l){void 0===a._eventListeners&&(a._eventListeners=[]);a.addEventListener(b,l,!1);var g=a._eventListeners;g.push({type:b,fn:l});a._eventListeners=g};b.removeEvent=function(a,b,l){if(void 0!==a._eventListeners){a.removeEventListener(b,l);for(var g,d=a._eventListeners,
c=[],h=d.length,e=0;e<h;e++)(g=d[e]).type!==b&&g.fn!==l&&c.push(d[e]);a._eventListeners=d}}},4614:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});var a=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setLogger=function(a){this._method=a},a.prototype.getLogger=function(){return this._method||this._methodPlaceholder()},a.prototype._methodPlaceholder=function(){return{debug:k,error:k,info:k,warn:k}},
a}(),k=function(){console.error("cmp2-ui: You should really consider adding logger")};b.getLogger=function(){return a.getInstance().getLogger()};b.setLogger=function(b){return a.getInstance().setLogger(b)}},726:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});f=function(){function a(){}return a.UUID=function(){var a=(new Date).getTime();return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(b){var g=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?g:3&g|8).toString(16)})},
a.randomString=function(a){void 0===a&&(a=6);for(var b="",g=0;g<a;g++)b+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*Math.random()));return b},a}();b.StringGenerators=f;b.default=f},9993:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});f=a(8577);var k=a(2439);b.Base=k.default;var l=f.default();b.setWorkaround=function(a){return l.setWorkaround(a,!1)};b.getWorkaround=function(){return l.getWorkaround()};f=a(4614);b.getLogger=f.getLogger;b.setLogger=
f.setLogger;f=a(8293);b.extend=f.extend;a=a(8554);b.updateBasePath=a.updateBasePath},5605:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});f=function(){function a(){this.events={}}return a.prototype.on=function(a,b){var g=this.events[a];return g||(this.events[a]=g=[]),g.push(b),this},a.prototype.off=function(a,b){var g=this.events[a];return g?(void 0===b?delete this.events[a]:this.events[a]=g.filter(function(a){if(a!==b)return a}),this):this},a.prototype.subscribe=function(a,b){return this.on(a,
b)},a.prototype.unSubscribe=function(a,b){return this.off(a,b)},a.prototype.publish=function(a,b){a=this.events[a];if(!a)return this;for(var g=0,d;d=a[g];g++)d.apply(this,b||[]);return this},a.prototype.notify=function(a,b){return this.publish(a,b)},a}();b.Observer=f},7868:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});f=function(){function a(a){void 0===a&&(a=3E3);this._index=0;this._defaultDelay=a;this._queue=[]}return a.prototype.add=function(a,b,g,d){void 0===b&&(b=this);void 0===
g&&(g=[]);void 0===d&&(d=this._defaultDelay);this._queue.push({fn:a,caller:b,delay:d,args:g})},a.prototype.run=function(a){void 0===a&&(a=0);this._index=a;this.next()},a.prototype.next=function(){var a=this,b=this._index++,g=this._queue[b],b=this._queue[this.getIndex()];if(g){var g=g.fn.apply(g.caller,g.args),d="boolean"!=typeof g||g;!1===g&&this.onError&&this.onError();b&&d&&setTimeout(function(){a.next()},b.delay)}},a.prototype.setOnError=function(a){this.onError=a},a.prototype.reset=function(){this._index=
0},a.prototype.getDefaultDelay=function(){return this._defaultDelay},a.prototype.getIndex=function(){return this._index},a.prototype.getTotal=function(){return this._queue.length},a.prototype.cleanUp=function(){this._index=0;this._queue=[]},a}();b.TimedQueue=f},1383:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});b.class2Type={}},1394:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});f=a(3180);b.functionToString=f.hasOwn.toString},3180:function(f,b,a){Object.defineProperty(b,
"__esModule",{value:!0});f=a(1383);b.hasOwn=f.class2Type.hasOwnProperty},5726:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});f=a(1394);b.objectFunctionString=f.functionToString.call(Object)},2954:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});f=a(1383);b.toString=f.class2Type.toString},8023:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(5605);var l=a(4614),g=a(1688);a=a(4229);var d=g.default(),c=a.default();a=function(a){function b(b){var e=
a.call(this)||this;return e.windowNamePrefix="",e.windowHandleInformation=b,e.items=b.items,b.resize&&e.resizeHandle(b),b.preOpen&&e.preOpen(b.preOpen),b.postOpen&&e.postOpen(b.postOpen),b.preItemOpen&&e.preItemOpen(b.preItemOpen),b.postItemOpen&&e.postItemOpen(b.postItemOpen),e}return k.__extends(b,a),b.prototype.setWindowNamePrefix=function(a){void 0===a&&(a="");a&&(this.windowNamePrefix=a)},b.prototype.getWindowNamePrefix=function(){return this.windowNamePrefix||(this.windowNamePrefix=c.getWindowNamePrefix()),
this.windowNamePrefix},b.prototype.start=function(a){var b=this.items;this.publish("preOpen",[b]);for(var e=this.getWindowNamePrefix(),c=[],h=[],m=0,p;p=b[m];m++){this.publish("preItemOpen",[p,b]);var f=g.isSystemTargetName(p.name)?p.name:g.getWindowName(e+p.name),w=d.open(p.url,f,p.features),k=this.windowHandleInformation.options;if(k.expectWindowReference)if(w)c.push(f),h.push(w),this.publish("handleCreated",[p,b,w]);else if(!d.getIgnoreWindowErrors()){var D=a?"":" in the RP";l.getLogger().warn("cmp2-workaround: unable to open handle in StandardWindowHandleExecutor"+
D,{workaround:k,name:f,item:p})}this.publish("postItemOpen",[p,b,w])}this.publish("postOpen",[h,c])},b.prototype.handleCreated=function(a){return this.subscribe("handleCreated",a),this},b.prototype.preOpen=function(a){return this.subscribe("preOpen",a),this},b.prototype.postOpen=function(a){return this.subscribe("postOpen",a),this},b.prototype.preItemOpen=function(a){return this.subscribe("preItemOpen",a),this},b.prototype.postItemOpen=function(a){return this.subscribe("postItemOpen",a),this},b.prototype.getItems=
function(){return this.items},b.prototype.resizeHandle=function(a){this.postItemOpen(function(b,e,c){(e=d.getWindowHandle(c))&&b.features&&(b=b.features,a.options.resizeBeforeOpening?d.resizeBeforeMove(e,b):d.moveAccordingFeatures(e,b))})},b}(f.Observer);b.StandardWindowHandleExecutor=a;b.default=a},5293:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655),l=a(4614),g=a(1688);f=a(8023);var d=g.default();f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;
return b.windowHandleNames=[],b.windowHandles=[],b}return k.__extends(b,a),b.prototype.start=function(a){var b=this,e=this.getItems();this.windowHandleNames=[];this.windowHandles=[];this.publish("preOpen",[e]);var c=this.windowHandleInformation.options,d=1;void 0!==c.delay&&(d=c.delay);for(var c=0,h=void 0;h=e[c];c++)this._open(h,a);setTimeout(function(){b.publish("postOpen",[b.windowHandles,b.windowHandleNames])},d)},b.prototype._open=function(a,b){var e=this,c=this.getItems(),h=this.getWindowNamePrefix(),
m=this.windowHandleInformation.options,n=0;void 0!==m.timer&&(n=m.timer);setTimeout(function(){e.publish("preItemOpen",[a,c]);var q=g.isSystemTargetName(a.name)?a.name:g.getWindowName(h+a.name),n=d.open(a.url,q,a.features);if(m.expectWindowReference)if(n)e.addHandleName(q),e.addHandle(n),e.publish("handleCreated",[a,c,n]);else{var t=b?"":" in the RP";l.getLogger().warn("cmp2-workaround: unable to open handle in TimeoutWindowHandleExecutor"+t,{workaround:m,name:q,item:a})}e.publish("postItemOpen",
[a,c,n])},n)},b.prototype.addHandleName=function(a){this.windowHandleNames.push(a)},b.prototype.addHandle=function(a){this.windowHandles.push(a)},b}(f.default);b.TimeoutWindowHandleExecutor=f;b.default=f},2149:function(f,b){Object.defineProperty(b,"__esModule",{value:!0});f=function(a,b){this.items=[];this.options=a;this.items=b;this.resize=a.resizeWindows||!1};b.WindowHandleConstructor=f;b.default=f},8073:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(8293),l=a(4614),g=
{scrollbars:1,location:1,statusbar:1,menubar:0,resizable:1},d=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getWindowHandleInformation=function(a){try{a=a||window;var b=a.document,c=a.screen,d=b.documentElement,h=b.getElementsByTagName("body")[0];return{y:"screenY"in a?a.screenY:a.screenTop,x:"screenX"in a?a.screenX:a.screenLeft,width:a.innerWidth||d.clientWidth||h.clientWidth,height:a.innerHeight||d.clientHeight||
h.clientHeight,screenWidth:c.availWidth,screenHeight:c.availHeight}}catch(r){l.getLogger().error("cmp2-workaround: WindowHandleFeatures unable to access window/handle information",r)}try{return{y:0,x:0,width:window.screen.availWidth,height:window.screen.availHeight,screenWidth:window.screen.availWidth,screenHeight:window.screen.availHeight}}catch(r){l.getLogger().error("cmp2-workaround: WindowHandleFeatures unable to access window information",r)}return{y:0,x:0,width:800,height:600,screenWidth:800,
screenHeight:600}},a.prototype.hidden=function(a,b){var e=Math.min(1024,b.height-20),c=Math.min(1280,b.width-20),d=b.y+10,h=b.x+10;return a&&(e=160,c=160,d=b.y+(b.height-110),h=b.x+(b.width-185)),k.extend({},g,{top:d,left:h,height:e,width:c})},a.prototype.tiled=function(a,b,c){b=Math.floor(c.screenWidth/b-10);return k.extend({},g,{left:Math.floor((b+5)*a),top:-999999999,height:Math.abs(-1*c.screenHeight),width:Math.abs(b)})},a}();b.WindowHandleFeatures=d;b.default=function(){return d.getInstance()}},
4229:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(8554),l=a(8293),g=a(726),d=a(8073).default(),c=function(){function a(){this.windowNamePrefix="k"+(new Date).getTime()+g.default.randomString(8)}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getWindowNamePrefix=function(){return this.windowNamePrefix},a.prototype.hidden=function(a,b){return{url:this.getUrl(a),name:a.code,features:d.hidden(!1,b)}},a.prototype.hiddenSmall=
function(a,b){return{url:this.getUrl(a),name:a.code,features:d.hidden(!0,b)}},a.prototype.tiled=function(a,b,c,h){return{url:this.getUrl(a),name:a.code,features:d.tiled(b,c,h)}},a.prototype.empty=function(a){return{url:this.getUrl(a),name:a.code,features:{}}},a.prototype.forDirect=function(a){for(var b=[],e=d.getWindowHandleInformation(),c=0,h=0,g;g=a[h];h++)g.visible&&c++;for(h=0;g=a[h];h++)g.visible&&b.push(this.tiled(g,h,c,e));return b},a.prototype.forBlank=function(a){return[{url:a||this.getUrl(),
name:"_blank",features:{}}]},a.prototype.forMultiProviderWindow=function(a,b){void 0===a&&(a=[]);void 0===b&&(b={});var c,e=[];if(0<a.length){for(var d=0,h;h=a[d];d++)h.deepLink&&"CLOSE"!==h.deepLink&&(e.push(h.code),c=h.deepLink);if(0<e.length)return 1===e.length&&c?k.formatUrl(c):k.formatUrl("/s/compareresults/multi",l.extend({providerCodes:e.join(",")},b||{}))}return""},a.prototype.forSubmit=function(a,b){void 0===b&&(b=0);for(var c=[],e=d.getWindowHandleInformation(),h=0,g=0,n;n=a[g];g++)n.visible&&
n.checked&&h++;for(g=0;n=a[g];g++)n.visible&&n.checked&&(4===b&&c.push(this.empty(n)),0===b&&c.push(this.tiled(n,g,h,e)),2===b&&c.push(this.hidden(n,e)),3===b&&c.push(this.hiddenSmall(n,e)));return c},a.prototype.getSpinnerPath=function(){return k.formatUrl("/s/compareresults/spinner")},a.prototype.getUrl=function(a){return a?a.deepLink?k.formatUrl(a.deepLink):k.formatUrl("/s/compareresults/spinner",{code:a.code}):this.getSpinnerPath()},a}();b.WindowHandleOptions=c;b.default=function(){return c.getInstance()}},
1688:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(5694),l=a(4614);f=a(6771);b.isSystemTargetName=function(a){return void 0===a&&(a=""),-1!==["_blank","_parent","_self","_top"].indexOf(a)};b.getWindowName=function(a){return void 0===a&&(a=""),b.isSystemTargetName(a)?a:a.replace(/[^a-z0-9]+/gi,"")};"undefined"!=typeof window&&f.addEvent(window,"popstate",function(a){(a=a.originalEvent?a.originalEvent:a)&&a.state&&a.state.hasOwnProperty("cmp2-workaround-back-Key")&&window.location.replace(a.state["cmp2-workaround-back-Key"])});
var g=function(){function a(){this._ignoreWindowErrors=!1;this._topHandle=null}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setTopHandle=function(a){this._topHandle=a},a.prototype.getTopHandle=function(){var a=this._topHandle;return null!==a&&a===a.window?this._topHandle:window},a.prototype.getIgnoreWindowErrors=function(){return this._ignoreWindowErrors},a.prototype.setIgnoreWindowErrors=function(a){this._ignoreWindowErrors=a},a.prototype.open=
function(a,h,e){void 0===h&&(h="");void 0===e&&(e={});"object"==typeof e&&(e=k.param(e,!0,","));var c=this._topHandle;return(a=(null!==c&&c===c.window?c.open:open)(a,b.getWindowName(h),e))&&!a.closed?a:null},a.prototype.getActiveWindowHandles=function(a){for(var b=[],c=0,d;d=a[c];c++)(d=this.getWindowHandle(d))&&b.push(d);return b},a.prototype.getFirstActiveHandle=function(a){for(var b=0,c;c=a[b];b++)if(this.getWindowHandle(c))return c;return null},a.prototype.getLastActiveHandle=function(a){for(var b=
a.length-1,c;c=a[b];b--)if(this.getWindowHandle(c))return c;return null},a.prototype.getWindowHandle=function(a){try{return!a||a.closed?null:a}catch(h){return null}},a.prototype.addHistory=function(a,b){if(a&&b&&void 0!==history.pushState&&void 0!==history.replaceState)try{var c=a.location.href;a.history.replaceState(((d={})["cmp2-workaround-back-Key"]=b,d),"",b);a.history.pushState(((h={})["cmp2-workaround-back-Key"]=c,h),a.document.title,c)}catch(t){l.getLogger().warn("cmp2-workaround: WindowHandle unable to add history",
t)}var d,h},a.prototype.updateHandleName=function(a,b,e){void 0===b&&(b="");void 0===e&&(e=this.getTopHandle());e=this.getWindowHandle(e);if(!e)return l.getLogger().warn("cmp2-workaround: WindowHandle handle is not found",b),!1;try{if(e.name=a,e.name!==a)return l.getLogger().warn("cmp2-workaround: WindowHandle unable to change name",b),!1}catch(m){return l.getLogger().warn("cmp2-workaround: WindowHandle unable to change name",m,b),!1}return!0},a.prototype.resizeBeforeMove=function(a,b){var c=this.getWindowHandle(a);
if(c)try{if(void 0!==b.left&&void 0!==b.top){c.resizeTo(100,100);var d=this.moveToLeftTop(a);c.moveTo(d[0]+b.left,d[1]+b.top)}void 0!==b.width&&void 0!==b.height&&c.resizeTo(b.width,b.height)}catch(q){l.getLogger().warn("cmp2-workaround: WindowHandle unable resize handler in resizeBeforeMove",q,q.stack)}},a.prototype.moveAccordingFeatures=function(a,b){if((a=this.getWindowHandle(a))&&b)try{void 0!==b.left&&void 0!==b.top&&a.moveTo(b.left,b.top),void 0!==b.width&&void 0!==b.height&&a.resizeTo(b.width,
b.height)}catch(e){l.getLogger().warn("cmp2-workaround: WindowHandle unable resize handler in moveAccordingFeatures",e,e.stack)}},a.prototype.moveToLeftTop=function(a){if(a=this.getWindowHandle(a))try{return a.moveTo(-1E7,-1E7),["screenX"in a?a.screenX:a.screenLeft,"screenY"in a?a.screenY:a.screenTop]}catch(h){l.getLogger().warn("cmp2-workaround: WindowHandle unable to move handler in moveToLeftTop",h,h.stack)}return[0,0]},a}();b.WindowHandle=g;b.default=function(){return g.getInstance()}},8577:function(f,
b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(2439),l=a(9143),g=a(8216),d=a(8170),c=a(5607),h=a(7871),e=a(36),m=a(4614),q=a(3448),t=a(3038),r=a(1160),u=a(9633),n=a(4763),p=function(){function a(){}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setWorkaround=function(a,b){switch(b?a.fallbackName:a.name){case "AsyncOpen":this.workaround=new l.default(a);break;case "AsyncOpenMobile":this.workaround=new g.default(a);break;case "ChangeWindowNameLast":this.workaround=
new d.default(a);break;case "ChangeWindowNameSequence":this.workaround=new c.default(a);break;case "DocumentFocus":this.workaround=new h.default(a);break;case "HandleOpen":this.workaround=new e.default(a);break;case "RegularOpenCloseLast":this.workaround=new q.default(a);break;case "Swapper":this.workaround=new t.default(a);break;case "SwapperMultipleWindows":this.workaround=new r.default(a);break;case "SwapperMultipleWindowsNoSpinner":this.workaround=new n.default(a);break;case "SwapperNoSpinner":this.workaround=
new u.default(a);break;default:if(!b&&a.fallbackName)return m.getLogger().warn("cmp2-workaround: unable to find workaround. Trying to fallback",a),void this.setWorkaround(a,!0);m.getLogger().error("cmp2-workaround: unable to find workaround",a.name);this.workaround=new k.default(a)}},a.prototype.getWorkaround=function(){return this.workaround||(m.getLogger().error("cmp2-workaround: workaround is not set"),this.workaround=new k.default({name:""})),this.workaround},a}();b.Workaround=p;b.default=function(){return p.getInstance()}},
8216:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(2149),g=a(4229),d=a(9993),c=a(5293),h=a(1688),e=a(726),m=h.default(),q=g.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onDirectClick=function(a,b){a=q.forDirect(a);a=new l.default(this.options,a);(new c.default(a)).start(!1)},b.prototype.navigateToResults=function(a,b,c){return!(!c||0===c.length)||(d.getLogger().warn("cmp2-workaround: AsyncOpenMobile navigateToResults using fallback. There is no window handles available.",
{workaround:this.options}),!1)},b.prototype.onFormClick=function(a,b,g){var n=this,p=q.forSubmit(b,4),f=p.shift();f?(b=this.getWindowNamePrefix(),m.updateHandleName(h.getWindowName(b+f.name),1),p.push({url:a,name:"k"+e.default.randomString(8),features:{}}),p=new l.default(this.options,p),p.postOpen=function(b,c){var h=m.getActiveWindowHandles(b),q=m.getLastActiveHandle(h);h.length!==b.length&&d.getLogger().warn("cmp2-workaround: AsyncOpenMobile some windows are closed",{workaround:n.options,activeWindowHandlesLength:h.length,
windowHandlesLength:b.length});q&&(m.updateHandleName("k"+e.default.randomString(8),2,q),q.location.href=a);g(b,c)},p=new c.default(p),p.setWindowNamePrefix(b),p.start(!0)):(d.getLogger().error('cmp2-workaround: AsyncOpenMobile "firstItem" is undefined',{workaround:this.options}),g([],[]))},b}(f.default);b.AsyncOpenMobile=a;b.default=a},9143:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(2149),g=a(4229),d=a(9993),c=a(5293),h=g.default();a=function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onDirectClick=function(a,b){a=h.forDirect(a);a=new l.default(this.options,a);(new c.default(a)).start(!1)},b.prototype.onFormClick=function(a,b,e){var g=this;a=h.forSubmit(b);b={url:"",name:"_self",features:{}};delete b.features;a.push(b);a=new l.default(this.options,a);a.postItemOpen=function(a,b,c){a.features||(c&&!c.closed?c.focus():d.getLogger().warn("cmp2-workaround: AsyncOpen unable to focus",{workaround:g.options}))};a.postOpen=
function(a,b){e(a,b)};(new c.default(a)).start(!0)},b}(f.default);b.AsyncOpen=a;b.default=a},2439:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(5605);var l=a(8023),g=a(2149),d=a(4229),c=a(1688).default(),h=d.default();a=function(a){function b(b){var c=a.call(this)||this;return c.options=b,c}return k.__extends(b,a),b.prototype.onDirectClick=function(a,b){a=h.forDirect(a);a=new g.default(this.options,a);(new l.default(a)).start(!1)},b.prototype.onDirectMouseUp=function(a,
b){},b.prototype.onDirectMouseDown=function(a,b){},b.prototype.onItemChange=function(a,b,c){},b.prototype.onItemMouseDown=function(a,b){},b.prototype.onItemMouseUp=function(a,b){},b.prototype.onFormClick=function(a,b,c){c([],[])},b.prototype.onFormButtonMouseDown=function(a){},b.prototype.onFormButtonMouseUp=function(a){},b.prototype.navigateToResults=function(a,b,c){return!1},b.prototype.showRPCompareAll=function(){return!0},b.prototype.pushHandleHistory=function(a,b){b&&c.addHistory(a,b)},b.prototype.getWindowNamePrefix=
function(){return h.getWindowNamePrefix()},b.prototype.onResultPageOpen=function(a,b,c){void 0===c&&(c="");a=new g.default(this.options,h.forSubmit(a));a=new l.default(a);a.setWindowNamePrefix(c);a.start(!0)},b.prototype.setIgnoreWindowErrors=function(a){c.setIgnoreWindowErrors(a)},b.prototype.setTopHandle=function(a){c.setTopHandle(a)},b}(f.Observer);b.Base=a;b.default=a},8170:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(8023),g=a(2149),d=a(1688);
a=a(4229);var c=d.default(),h=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onResultPageOpen=function(a,b,e){void 0===b&&(b={});void 0===e&&(e="");b=this.options;a=new g.default(b,h.forSubmit(a));b.resultPageFocus&&(a.postOpen=function(){c.open("",name)});a=new l.default(a);a.setWindowNamePrefix(e);a.start(!0)},b.prototype.onFormClick=function(a,b,e){a=h.forSubmit(b);var d=this.getWindowNamePrefix();c.updateHandleName(d,1);
a=new g.default(this.options,a);a.postOpen=function(a,b){c.open("",d);e(a,b)};(new l.default(a)).start(!0)},b}(f.default);b.ChangeWindowNameLast=a;b.default=a},5607:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655),l=a(7868);f=a(2439);var g=a(4614),d=a(8023),c=a(726),h=a(2149),e=a(1688),m=a(8073),q=a(4229),t=a(8554),r=e.default(),u=m.default(),n=q.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onDirectClick=
function(a,b){var e=this;void 0===b&&(b={});var g=u.getWindowHandleInformation(),p=c.default.UUID(),g=[{url:n.getSpinnerPath(),name:"provider",features:u.hidden(!1,g)}],g=new h.default(this.options,g);g.postOpen=function(){e.onResultPageOpen(a,b,p)};g=new d.default(g);g.setWindowNamePrefix(p);g.start(!1)},b.prototype.onResultPageOpen=function(a,b,e){void 0===b&&(b={});void 0===e&&(e="");var d=n.forMultiProviderWindow(a,b);if(d){var h=c.default.UUID();r.updateHandleName(h,1);e+="provider";var p=r.open(n.getSpinnerPath(),
e),f=this.options;f.expectWindowReference?p?(r.open("",h),this.createSequence(p,a,d,function(a,b){a=r.getWindowHandle(a);return!!a&&(a.location.href=b,!0)})):r.getIgnoreWindowErrors()||g.getLogger().error("cmp2-workaround: ChangeWindowNameSequence unable to open window",{workaround:f,windowName:e,items:a,extra:b}):g.getLogger().warn("cmp2-workaround: ChangeWindowNameSequence not expecting window reference. Refactor",{workaround:f,windowName:e,items:a,extra:b})}},b.prototype.createSequence=function(a,
b,c,e){var d=this;if(1!==b.length){var h=new l.TimedQueue(this.options.delay);h.setOnError(function(){g.getLogger().error("cmp2-workaround: ChangeWindowNameSequence unable finish sequence",{workaround:d.options,items:b,index:h.getIndex(),total:h.getTotal()})});for(var p=0,f=void 0;f=b[p];p++)h.add(e,d,[a,t.formatUrl(f.deepLink||"")]);h.add(e,d,[a,n.getSpinnerPath()]);h.add(function(a){if(a=r.getWindowHandle(a)){try{var c=u.getWindowHandleInformation(window);r.moveAccordingFeatures(a,u.tiled(0,1,c))}catch(F){g.getLogger().error("cmp2-workaround: ChangeWindowNameSequence unable to change position",
{workaround:d.options,items:b,index:h.getIndex(),total:h.getTotal()},F)}return!0}return!1},d,[a]);h.add(e,d,[a,c,-1]);h.run()}else e.apply(d,[a,c,-1,-1])},b.prototype.onFormClick=function(a,b,e){a=u.getWindowHandleInformation();a=[{url:n.getSpinnerPath(),name:"provider",features:u.hidden(!1,a)}];var g=c.default.UUID();r.updateHandleName(g,1);a=new h.default(this.options,a);a.postOpen=function(a,b){r.open("",g);e(a,b)};(new d.default(a)).start(!0)},b}(f.default);b.ChangeWindowNameSequence=a;b.default=
a},7871:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655),l=a(6771);f=a(2439);var g=a(4614),d=a(8023),c=a(2149),h=a(1688),e=a(4229).default(),m=h.default();a=function(a){function b(b){var c=a.call(this,b)||this;return c.submitEvent=!1,c.opened={},l.addEvent(window,"unload",function(){c.closeAllOpened()}),c}return k.__extends(b,a),b.prototype.showRPCompareAll=function(){return!1},b.prototype.onItemChange=function(a,b,c){var e=this;c.checked?this._openAndFocus([c],function(a){(a=
m.getWindowHandle(a[0]))&&(e.opened[c.code]=a);e.submitEvent=!1}):this.close(c.code,this.opened[c.code]?this.opened[c.code]:null)},b.prototype.onFormClick=function(a,b,c){this._openAndFocus(b,c)},b.prototype._openAndFocus=function(a,b){var g=this,h=e.forSubmit(a,3),h=new c.default(this.options,h);h.postItemOpen=function(a,b,c){return g._windowFocus(c)};h.postOpen=function(c,e){g.submitEvent=!0;g.closeNotActive(a);b(c,e)};(new d.default(h)).start(!0)},b.prototype.closeAllOpened=function(){if(!this.submitEvent){var a=
this.opened,b;for(b in a)a.hasOwnProperty(b)&&this.close(b,a[b])}},b.prototype.closeNotActive=function(a){for(var b=0,c;c=a[b];b++)!c.checked&&this.opened[c.code]&&this.close(c.code,this.opened[c.code])},b.prototype.close=function(a,b){if(b){b=m.getWindowHandle(b);try{b?(b.close(),delete this.opened[a]):g.getLogger().warn("cmp2-workaround: unable to close handle handle is not exists",{workaround:this.options})}catch(n){g.getLogger().warn("cmp2-workaround: error in closing handle",{workaround:this.options})}}},
b.prototype._windowFocus=function(a){var b=this;this.focusInterval&&clearInterval(this.focusInterval);var c=0,e=setInterval(function(){try{var d=m.getWindowHandle(a);d&&(d.blur(),d.opener.focus());window.self.focus();window.focus();document.focus()}catch(w){g.getLogger().warn("cmp2-workaround: DocumentFocus - windowFocus",{workaround:b.options},w)}10<++c&&e&&clearInterval(e)},300);this.focusInterval=e},b}(f.default);b.DocumentFocus=a;b.default=a},36:function(f,b,a){Object.defineProperty(b,"__esModule",
{value:!0});var k=a(655);f=a(2439);var l=a(4614),g=a(8023),d=a(2149),c=a(4229).default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onFormClick=function(a,b,e){var h=this;a=c.forSubmit(b);a=new d.default(this.options,a);a.postItemOpen=function(a,b,e){e&&!e.closed&&((a=e.open(c.getSpinnerPath()))?a.close():l.getLogger().warn("cmp2-workaround: HandleOpen unable to focus",{workaround:h.options}))};a.postOpen=function(a,b){return e(a,
b)};(new g.default(a)).start(!0)},b}(f.default);b.HandleOpen=a;b.default=a},3448:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(4614),g=a(8023),d=a(2149),c=a(1688);a=a(4229);var h=c.default(),e=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onFormClick=function(a,b,c){var f=this;a=e.forSubmit(b);a=new d.default(this.options,a);a.postOpen=function(a,b){var d=h.open(e.getSpinnerPath()),
g=f.options;g.expectWindowReference?d?d.close():l.getLogger().warn("cmp2-workaround: RegularOpenCloseLast unable to focus",{workaround:g}):l.getLogger().warn("cmp2-workaround: RegularOpenCloseLast not expecting window reference. Refactor",{workaround:g});c(a,b)};(new g.default(a)).start(!0)},b}(f.default);b.RegularOpenCloseLast=a;b.default=a},4763:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(4614),g=a(8023),d=a(726),c=a(2149),h=a(1688);a=a(4229);
var e=h.default(),m=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.navigateToResults=function(a,b,c){return!(!c||0===c.length)||(l.getLogger().warn("cmp2-workaround: SwapperMultipleWindowsNoSpinner navigateToResults using fallback. There is no window handles available.",{workaround:this.options}),!1)},b.prototype.onFormClick=function(a,b,f){var p=this,n=m.forSubmit(b,4),k=n.shift();if(!k)return l.getLogger().error('cmp2-workaround: SwapperMultipleWindowsNoSpinner "firstItem" is undefined',
{workaround:this.options}),void f([],[]);b=this.getWindowNamePrefix();e.updateHandleName(h.getWindowName(b+k.name),1);n.push({url:a,name:"k"+d.default.randomString(8),features:{}});n=new c.default(this.options,n);n.postOpen=function(b,c){var g=e.getActiveWindowHandles(b),h=e.getLastActiveHandle(g);g.length!==b.length&&l.getLogger().warn("cmp2-workaround: SwapperMultipleWindowsNoSpinner some windows are closed",{workaround:p.options,activeWindowHandlesLength:g.length,windowHandlesLength:b.length});
h&&(e.updateHandleName("k"+d.default.randomString(8),2,h),h.location.href=a);f(b,c)};n=new g.default(n);n.setWindowNamePrefix(b);n.start(!0)},b}(f.default);b.SwapperMultipleWindowsNoSpinner=a;b.default=a},1160:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(4614),g=a(8023),d=a(726),c=a(2149),h=a(1688);a=a(4229);var e=h.default(),m=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.navigateToResults=
function(a,b,c){b=e.getActiveWindowHandles(c);var g=e.getLastActiveHandle(b);return g?(b.length!==c.length&&l.getLogger().warn("cmp2-workaround: SwapperMultipleWindows some windows are closed",{workaround:this.options,activeWindowHandlesLength:b.length,windowHandlesLength:c.length}),e.updateHandleName("k"+d.default.randomString(8),2,g),g.location.href=a,this.options.method||(window.location.href=m.getSpinnerPath()),!0):(l.getLogger().error("cmp2-workaround: SwapperMultipleWindows unable to found active window",
{workaround:this.options}),!1)},b.prototype.onFormClick=function(a,b,f){b=m.forSubmit(b,4);var n=b.shift();if(!n)return l.getLogger().error('cmp2-workaround: SwapperMultipleWindows "firstItem" is undefined',{workaround:this.options}),void f([],[]);a=this.getWindowNamePrefix();e.updateHandleName(h.getWindowName(a+n.name),1);b.push({url:m.getSpinnerPath(),name:"k"+d.default.randomString(8),features:{}});b=new c.default(this.options,b);b.postOpen=function(a,b){f(a,b)};b=new g.default(b);b.setWindowNamePrefix(a);
b.start(!0)},b}(f.default);b.SwapperMultipleWindows=a;b.default=a},9633:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(4614),g=a(8023),d=a(2149),c=a(1688);a=a(4229);var h=c.default(),e=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onDirectClick=function(a,b){void 0===b&&(b={});a=[{url:e.forMultiProviderWindow(a,b),name:"_blank",features:{}}];a=new d.default(this.options,a);
(new g.default(a)).start(!1)},b.prototype.onResultPageOpen=function(a,b,c){void 0===b&&(b={});void 0===c&&(c="");if(b=e.forMultiProviderWindow(a,b)){var d=this.options,g=h.getWindowHandle(window.opener);if(d.windowLocationHref&&g&&g!==window)try{return d.locationTopHref&&g.top!==g.self?void(g.top.location.href=b):void(g.location.href=b)}catch(L){}g=h.open(b,c);!d.expectWindowReference||h.getIgnoreWindowErrors()||g||l.getLogger().error("cmp2-workaround: SwapperNoSpinner unable to open window",{workaround:d,
items:a,url:b,windowNamePrefix:c})}},b.prototype.navigateToResults=function(a,b,c){return!(!c||0===c.length)||(l.getLogger().warn("cmp2-workaround: SwapperNoSpinner navigateToResults using fallback. There is no window handles available.",{workaround:this.options}),!1)},b.prototype.onFormClick=function(a,b,c){a=e.forBlank(a);h.updateHandleName(this.getWindowNamePrefix(),1);a=new d.default(this.options,a);a.postOpen=function(a,b){return c(a,b)};(new g.default(a)).start(!0)},b}(f.default);b.SwapperNoSpinner=
a;b.default=a},3038:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});var k=a(655);f=a(2439);var l=a(4614),g=a(8023),d=a(2149),c=a(1688);a=a(4229);var h=c.default(),e=a.default();a=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return k.__extends(b,a),b.prototype.onDirectClick=function(a,b){void 0===b&&(b={});a=[{url:e.forMultiProviderWindow(a,b),name:"_blank",features:{}}];a=new d.default(this.options,a);(new g.default(a)).start(!1)},b.prototype.onResultPageOpen=
function(a,b,c){void 0===b&&(b={});void 0===c&&(c="");if(b=e.forMultiProviderWindow(a,b)){var d=this.options,g=h.getWindowHandle(window.opener);if(d.windowLocationHref&&g&&g!==window)try{return d.locationTopHref&&g.top!==g.self?void(g.top.location.href=b):void(g.location.href=b)}catch(L){}g=h.open(b,c);!d.expectWindowReference||h.getIgnoreWindowErrors()||g||l.getLogger().info("cmp2-workaround: Swapper unable to open window",{workaround:d,items:a,url:b,windowNamePrefix:c})}},b.prototype.navigateToResults=
function(a,b,c){return(c=h.getFirstActiveHandle(c))?(c.location.href=a,this.options.method||(window.location.href=e.getSpinnerPath()),!0):(l.getLogger().error("cmp2-workaround: Swapper unable to navigate to RP",{workaround:this.options,items:b,url:a}),!1)},b.prototype.onFormClick=function(a,b,c){a=e.forBlank();h.updateHandleName(this.getWindowNamePrefix(),1);a=new d.default(this.options,a);a.postOpen=function(a,b){return c(a,b)};(new g.default(a)).start(!0)},b}(f.default);b.Swapper=a;b.default=a},
9695:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.CompareToList=b.invokeLoadingTrackingUrl=void 0;var k=a(1530),l=a(9545);b.invokeLoadingTrackingUrl=function(a){(new Image(1,1)).src=a};f=function(){function a(){var a=k.StorageHelper.getInstance().getItem("cmp2.state");this._setCompareToState(a)}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.getImpressionRequestState=function(a){for(var b=[],d=0;d<a.length;d++){var e=
a[d];b.push({checked:e.checked,code:e.code,id:e.id,prechecked:e.prechecked,rank:e.rank,termId:e.termId,visible:e.visible})}return b},a.prototype.getVisibleItem=function(a){var b=[];if(a&&"object"==typeof a&&a.constructor===Array&&0<a.length)for(var d=0;d<a.length;d++){var e=a[d];e.visible&&b.push(e)}return b},a.prototype.getVisibleItemCount=function(a){return this.getVisibleItem(a).length},a.prototype.isCheckedItem=function(a){for(var b=0;b<a.length;b++){var d=a[b];if(d.visible&&d.checked)return!0}return!1},
a.prototype.updateCheckedItemState=function(a,b){if(b.id&&b.idInState)this._compareTosStates[b.id]=b.checked;else{var c=b.code;if(c){var e=this._getMediaAlphaProviderName(c);e&&(c=e);this._compareTosStates[c]=b.checked}}b=k.StorageHelper.getInstance();b.setItem("cmp2.state",this._compareTosStates);var d=0;a.forEach(function(a){a.visible&&a.checked&&d++});0===d?b.setItem("cmp2.check.all","false"):this.getVisibleItemCount(a)===d?b.setItem("cmp2.check.all","true"):b.removeItem("cmp2.check.all")},a.prototype.prepareItemsToDisplay=
function(a){var c=this,d=l.CompareToSettings.getInstance().getSettingsSync();if(!d)return[];var e=[],g=k.StorageHelper.getInstance().getItem("cmp2.check.all"),d=d.rendering,f=d.storeStateSession,t=d.limited,r=d.usePreCheckItems,u=d.maxCheckedItems,n=d.loadTrackingUrl,p=0;return a.forEach(function(a){var d=!1;(!t||p<u)&&(d=c._isItemChecked(a,f,r,g))&&p++;d={name:a.name,code:a.code,id:a.id,visible:a.visible,checked:d,prechecked:r&&a.prechecked,termId:a.termId,idInState:a.idInState,rank:a.rank,logo:a.logo,
logoLarge:a.logoLarge};"deepLink"in a&&(d.deepLink=a.deepLink);"clickToCall"in a&&(d.clickToCall=a.clickToCall);"svgLogo"in a&&(d.svgLogo=a.svgLogo);"phoneNumber"in a&&(d.phoneNumber=a.phoneNumber);n?a.visible&&a.trackingUrl&&b.invokeLoadingTrackingUrl(a.trackingUrl):"trackingUrl"in a&&(d.trackingUrl=a.trackingUrl);e.push(d)}),e},a.prototype.getCompareToItemsFromImpressionState=function(a){var b=[];return a.forEach(function(a){b.push({name:"",logo:"",logoLarge:"",code:a.code,id:a.id,visible:a.visible,
checked:a.checked,prechecked:a.prechecked,idInState:!0,termId:a.termId,rank:a.rank})}),b},a.prototype.impressionItemsToDisplay=function(a,b){var c=[];return a.forEach(function(a){var d={name:"",logo:"",logoLarge:"",code:a.code,id:a.id,visible:a.visible,checked:a.checked,prechecked:a.prechecked,idInState:!0,termId:a.termId,rank:a.rank};(a=b[a.code])&&(d.name=a.name||"",d.logo=a.logo||"",d.logoLarge=a.logoLarge||"",d.svgLogo=(null==a?void 0:a.svgLogo)||"",d.deepLink=(null==a?void 0:a.deepLink)||"",
d.idInState=a.idInState,d.clickToCall=null==a?void 0:a.clickToCall,d.phoneNumber=null==a?void 0:a.phoneNumber,d.trackingUrl=null==a?void 0:a.trackingUrl);c.push(d)}),c},a.prototype.mapDeepLinkToItems=function(a,b){var c=[];return this.getCompareToItemsFromImpressionState(a).forEach(function(a){a.visible&&a.checked&&b[a.code]&&b[a.code].deepLink&&(a.deepLink=b[a.code].deepLink,c.push(a))}),c},a.prototype._getMediaAlphaProviderName=function(a){return(a=/^([a-zA-Z]*-[0-9]*-[0-9]*)/.exec(a))?a[1]:null},
a.prototype._isItemChecked=function(a,b,g,e){if(!a.visible)return!1;if(b){if(null!==e)return!0===e;b=this._compareTosStates;if(a.idInState){if(a.id&&b.hasOwnProperty(a.id))return b[a.id]}else if(e=a.code){var c=this._getMediaAlphaProviderName(e);if(c&&(e=c),b.hasOwnProperty(e))return b[e]}}return a.prechecked&&g},a.prototype._setCompareToState=function(a){this._compareTosStates=a&&"object"==typeof a?a:{}},a}();b.CompareToList=f},9545:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});
b.CompareToSettings=void 0;var k=a(5232),l=a(2684),g=a(9993);f=function(){function a(){this._client="other";this._queue=[];this._isInProgress=!1}return a.getInstance=function(){return this._instance||(this._instance=new this),this._instance},a.prototype.setClient=function(a){this._client=a},a.prototype.getClient=function(){return this._client},a.prototype.setSettings=function(a){this._settings=a;g.setWorkaround(a.workaround)},a.prototype.isSettings=function(){return!!this._settings},a.prototype.getSettings=
function(a,b){var c=this;if(this._settings)a(this._settings);else if(this._queue.push({onSuccess:a,onError:b}),!this._isInProgress){this._isInProgress=!0;a=k.Settings.getConfig();var d=function(){c._isInProgress=!1;c._queue.forEach(function(a){a.onError&&a.onError(void 0)});c._queue=[]};l.Ajax.getInstance().request(a,function(a){if(!a||!a.success)return g.getLogger().error("cmp2-ui: AJAX error on getSettings",a.errors),void d();var b=a.content;c.setSettings(b);c._isInProgress=!1;c._queue.forEach(function(a){a.onSuccess(b)});
c._queue=[]},function(a){g.getLogger().error("cmp2-ui: AJAX error on getSettings",a);d()},d)}},a.prototype.getSettingsSync=function(){if(this.isSettings())return this._settings;g.getLogger().error("cmp2-ui: getSettingsSync failed. Refactor")},a}();b.CompareToSettings=f},2684:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.Ajax=void 0;var k,l=a(655),g=a(9993),d=a(7167);f=function(){function a(){var a=d.StorageSessionHelper.getInstance().getItem("cmp2.headers");a&&(this._headers=
a)}return a.getInstance=function(){return k||(k=new this),k},a.prototype.setMethod=function(a){this._method=a},a.prototype.request=function(a,b,c,f){var e=this;return this._method?(this._headers&&(a.headers=l.__assign(l.__assign({},a.headers),this._headers)),this._method(a,function(a){if(a&&a.headers){var c=a.headers;e._headers=c;d.StorageSessionHelper.getInstance().setItem("cmp2.headers",c)}b&&b(a)},c),!0):(g.getLogger().error("cmp2-ui: Ajax method is not set"),f&&f(),!1)},a}();b.Ajax=f},1530:function(f,
b,a){Object.defineProperty(b,"__esModule",{value:!0});b.StorageHelper=void 0;var k,l=a(9993);f=function(){function a(){this._available=!1;this.setStorage(this._getWindowStorage())}return a.getInstance=function(){return k||(k=new this),k},a.prototype.setStorage=function(a){var b;try{a&&(a.setItem("vendor-support-test","success?"),b=a.getItem("vendor-support-test"),a.removeItem("vendor-support-test"),this._storage=a),"success?"===b&&(this._available=!0)}catch(h){}},a.prototype.getItem=function(a){if(this._available&&
this._storage){var b=this._storage.getItem(a);if(b)try{return JSON.parse(b)}catch(h){return l.getLogger().error("cmp2-ui: StorageHelper unable to parse value",{key:a,value:b,error:h}),b}}return null},a.prototype.setItem=function(a,b){if(this._available&&this._storage)try{null!==b&&"object"==typeof b?this._storage.setItem(a,JSON.stringify(b)):this._storage.setItem(a,b)}catch(h){l.getLogger().error("cmp2-ui: StorageHelper unable to set item",{key:a,data:b})}},a.prototype.removeItem=function(a){try{this._available&&
this._storage&&this._storage.removeItem(a)}catch(c){l.getLogger().error("cmp2-ui: StorageHelper unable to remove item",{key:a})}},a.prototype.clear=function(){if(this._available&&this._storage)try{this._storage.clear()}catch(d){l.getLogger().error("cmp2-ui: StorageHelper unable to clear")}},a.prototype._getWindowStorage=function(){var a;try{a=window.localStorage}catch(c){}return a},a}();b.StorageHelper=f},7167:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.StorageSessionHelper=
void 0;var k,l=a(655);f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return l.__extends(b,a),b.getInstance=function(){return k||(k=new this),k},b.prototype._getWindowStorage=function(){var a;try{a=window.sessionStorage}catch(h){}return a},b}(a(1530).StorageHelper);b.StorageSessionHelper=f},3465:function(f,b,a){Object.defineProperty(b,"__esModule",{value:!0});b.getCompareTo=b.requestCompareTo=b.showMultiActions=b.showRPCompareAll=b.setModuleConfig=b.registerImpression=b.onResultPage=
b.onDirectClick=b.onDirectMouseDown=b.onDirectMouseUp=b.onFormButtonMouseUp=b.onFormButtonMouseDown=b.onFormClick=b.onItemChange=b.onItemMouseDown=b.onItemMouseUp=b.Vertical=b.Type=b.ShowOn=b.DisplayRail=b.Client=b.getWorkaround=b.updateBasePath=void 0;var k=a(655),l=a(5232),g=a(9993),d=a(2684),c=a(9545),h=a(9695),e=a(679),m=a(9993);Object.defineProperty(b,"updateBasePath",{enumerable:!0,get:function(){return m.updateBasePath}});var q=a(9993);Object.defineProperty(b,"getWorkaround",{enumerable:!0,
get:function(){return q.getWorkaround}});var t=a(5232);Object.defineProperty(b,"Client",{enumerable:!0,get:function(){return t.Client}});Object.defineProperty(b,"DisplayRail",{enumerable:!0,get:function(){return t.DisplayRail}});Object.defineProperty(b,"ShowOn",{enumerable:!0,get:function(){return t.ShowOn}});Object.defineProperty(b,"Type",{enumerable:!0,get:function(){return t.Type}});Object.defineProperty(b,"Vertical",{enumerable:!0,get:function(){return t.Vertical}});var r=a(2320);Object.defineProperty(b,
"onItemMouseUp",{enumerable:!0,get:function(){return r.onItemMouseUp}});Object.defineProperty(b,"onItemMouseDown",{enumerable:!0,get:function(){return r.onItemMouseDown}});Object.defineProperty(b,"onItemChange",{enumerable:!0,get:function(){return r.onItemChange}});Object.defineProperty(b,"onFormClick",{enumerable:!0,get:function(){return r.onFormClick}});Object.defineProperty(b,"onFormButtonMouseDown",{enumerable:!0,get:function(){return r.onFormButtonMouseDown}});Object.defineProperty(b,"onFormButtonMouseUp",
{enumerable:!0,get:function(){return r.onFormButtonMouseUp}});var u=a(2258);Object.defineProperty(b,"onDirectMouseUp",{enumerable:!0,get:function(){return u.onDirectMouseUp}});Object.defineProperty(b,"onDirectMouseDown",{enumerable:!0,get:function(){return u.onDirectMouseDown}});Object.defineProperty(b,"onDirectClick",{enumerable:!0,get:function(){return u.onDirectClick}});Object.defineProperty(b,"onResultPage",{enumerable:!0,get:function(){return u.onResultPage}});Object.defineProperty(b,"registerImpression",
{enumerable:!0,get:function(){return u.registerImpression}});b.setModuleConfig=function(a){a.ajax&&d.Ajax.getInstance().setMethod(a.ajax);a.logger&&g.setLogger(a.logger);a.settings&&c.CompareToSettings.getInstance().setSettings(a.settings);a.client&&c.CompareToSettings.getInstance().setClient(a.client);a.windowHandle&&g.getWorkaround().setTopHandle(a.windowHandle)};b.showRPCompareAll=function(a){var b=c.CompareToSettings.getInstance();return b.isSettings()?g.getWorkaround().showRPCompareAll()&&(a=
h.CompareToList.getInstance().getVisibleItemCount(a),(b=b.getSettingsSync())&&a>=b.rendering.minItemsForCompareAll)?!0:!1:(g.getLogger().error("cmp2-ui: settings are not set to execute showRPCompareAll"),!1)};b.showMultiActions=function(a,b){var d=c.CompareToSettings.getInstance();if(!d.isSettings())return g.getLogger().error("cmp2-ui: settings are not set to execute showMultiActions"),!1;if(!g.getWorkaround().showRPCompareAll())return!1;a=h.CompareToList.getInstance().getVisibleItemCount(a);d=d.getSettingsSync();
if(!d)return!1;var e=d.rendering,d=e.minItemsForCompareAll,e=e.placementMinItemsForMultiActions;b=b&&e&&e[b];return void 0!==b?a>=b:a>=d};b.requestCompareTo=function(a,b,f){var p={success:!0,errors:"",items:[]};if(!a.placement)return g.getLogger().error("cmp2-ui: placement information is missing on requestCompareTo",a),void f();if(!a.url)return g.getLogger().error("cmp2-ui: missing url on requestCompareTo",a),void f();var n=c.CompareToSettings.getInstance(),m=n.isSettings();if(m){var q=n.getSettingsSync();
if(!e.isEnabled(a.type,q)||e.excludeRequest(q,n.getClient(),a.placement))return void b(k.__assign(k.__assign({},p),{config:q}))}a.registerImpression=!!a.registerImpression;a.deepLink=!!a.deepLink;a.list=!!a.list;a.config=!m;var r=l.List.getConfig(a);d.Ajax.getInstance().request(r,function(c){if(!c||!c.success)return g.getLogger().error("cmp2-ui: Received an unexpected response on requestCompareTo",r,c.errors,c,a),void f();var d=c||{},l=d.content,d=k.__rest(d,["content"]),d=k.__assign(k.__assign({},
p),d);if(c.config){n.setSettings(c.config);var m=n.getSettingsSync();if(!e.isEnabled(a.type,m)||e.excludeRequest(m,n.getClient(),a.placement))return void b(d)}if(!n.isSettings())return g.getLogger().error("cmp2-ui: expected to have settings after compareTo request on requestCompareTo",r,c,a),void f();d.config=n.getSettingsSync();l&&(d.items=h.CompareToList.getInstance().prepareItemsToDisplay(l));b(d)},function(a){g.getLogger().error("cmp2-ui: AJAX error on requestCompareTo",a,r);f()},f)};b.getCompareTo=
function(a,b,f){if(!a.placement)return b([]),void g.getLogger().error("cmp2-ui: placement information is missing",a);if(!a.url)return b([]),void g.getLogger().error("cmp2-ui: missing url",a);var k=c.CompareToSettings.getInstance();if(k.isSettings()){var p=k.getSettingsSync();if(!e.isEnabled(a.type,p)||e.excludeRequest(p,k.getClient(),a.placement))return void b([])}a.registerImpression=!!a.registerImpression;a.deepLink=!!a.deepLink;a.convertUrl=a.convertUrl;a.list=!0;a.config=!k.isSettings();var m=
l.List.getConfig(a);d.Ajax.getInstance().request(m,function(c){if(!c||!c.success)return g.getLogger().error("cmp2-ui: Received an unexpected response",m,c,a),void f();if(c.config){k.setSettings(c.config);var d=k.getSettingsSync();if(!e.isEnabled(a.type,d)||e.excludeRequest(d,k.getClient(),a.placement))return void b([])}if(!k.isSettings())return g.getLogger().error("cmp2-ui: expected to have settings after getCompareTo request",m,c,a),void b([]);c.content?b(h.CompareToList.getInstance().prepareItemsToDisplay(c.content)):
b([])},function(a){g.getLogger().error("cmp2-ui: AJAX error on getCompareTo",a,m);f()},f)}},2258:function(f,b,a){function k(a,b,c,d,e){var f=t.WindowInfo.getRetrieveConfig(d);r.Ajax.getInstance().request(f,function(h){if(h&&h.success){if((h=h.content||[],"object"==typeof h)&&h.constructor===Array&&0<h.length){var k=h[h.length-1];k&&l(a,c,b,k.items||[],k.other);var p=h.length;h.forEach(function(c,f){g(a,b,f+1!==p,c.items,d,c,e)})}}else m.getLogger().error("cmp2-ui: errors in Storage",h.errors,f)},
function(a){m.getLogger().error("cmp2-ui: AJAX error on Retrieve WindowInfo V3",a,f)})}function l(a,b,c,d,g){d=a.getCompareToItemsFromImpressionState(d||[]);(void 0===b.workaround.updateHistory||b.workaround.updateHistory)&&a.isCheckedItem(d)&&c.pushHandleHistory(window,g.referer||"")}function g(a,b,c,g,e,f,k){var l=e.searchId||f&&f.searchId,p=d(e.type,f&&f.placement||e.placement,l,f&&f.url||e.url,g),n=t.List.getConfig(p);r.Ajax.getInstance().request(n,function(d){if(d&&d.success){var e=a.mapDeepLinkToItems(g||
[],d.content||{});var r=g||[];d=d.content||{};if(k){for(var K=[],G=0;G<e.length;G++){var y=e[G];y.visible&&y.checked&&(y=d[y.code])&&K.push(y.name)}k(K,h.CompareToList.getInstance().impressionItemsToDisplay(r,d))}b.setIgnoreWindowErrors(c);b.onResultPageOpen(e,q.getMultiProviderWindowExtra(p,"fd",l),f.other.windowNamePrefix);b.setIgnoreWindowErrors(!1)}else m.getLogger().error("cmp2-ui: ResultPage error",n,d)},function(a){m.getLogger().error("cmp2-ui: AJAX error on onResultPage",a,n)})}function d(a,
b,c,d,e){return{type:a,placement:b,searchId:c,url:d,compareTos:h.CompareToList.getInstance().getCompareToItemsFromImpressionState(e||[]),registerImpression:!0,includeCloseDeepLinks:!1,deepLink:!0,list:!1}}function c(a){(a=q.extractWindowOpenerResponse(a))&&(window.removeEventListener("message",c,!1),n(a.windowInfo),n=u)}Object.defineProperty(b,"__esModule",{value:!0});b.registerImpression=b.onResultPage=b.onDirectClick=b.onDirectMouseDown=b.onDirectMouseUp=void 0;var h=a(9695),e=a(9545),m=a(9993),
q=a(679),t=a(5232),r=a(2684);b.onDirectMouseUp=function(a,b){e.CompareToSettings.getInstance().isSettings()?m.getWorkaround().onDirectMouseUp(h.CompareToList.getInstance().getVisibleItem(a),q.getMultiProviderWindowExtra(b,"rp")):m.getLogger().error("cmp2-ui: settings are not set to execute direct mouse up")};b.onDirectMouseDown=function(a,b){e.CompareToSettings.getInstance().isSettings()?m.getWorkaround().onDirectMouseDown(h.CompareToList.getInstance().getVisibleItem(a),q.getMultiProviderWindowExtra(b,
"rp")):m.getLogger().error("cmp2-ui: settings are not set to execute direct mouse down")};b.onDirectClick=function(a,b){e.CompareToSettings.getInstance().isSettings()?m.getWorkaround().onDirectClick(h.CompareToList.getInstance().getVisibleItem(a),q.getMultiProviderWindowExtra(b,"rp")):m.getLogger().error("cmp2-ui: settings are not set to execute direct click")};b.onResultPage=function(a,b){var d=e.CompareToSettings.getInstance(),f=d.getSettingsSync();if(f){if(q.isEnabled(a.type,f)&&!q.excludeRequest(f,
d.getClient(),a.placement)){var p=h.CompareToList.getInstance(),r=m.getWorkaround();(d=window.opener)&&d===window&&(f.logSameWindowOpener&&m.getLogger().warn("cmp2-ui: window.opener is the same as window"),f.excludeSameWindowOpener)?k(p,r,f,a,b):f.childWindowOpener&&d?function(a,b,d,e,g){window.removeEventListener("message",c,!1);var f=setTimeout(function(){window.removeEventListener("message",c,!1);g()},d);n=function(b){clearTimeout(f);b?a.type===b.type?e(b):m.getLogger().error("cmp2-ui: window opener returned an unexpected vertical",
b,a):m.getLogger().error("cmp2-ui: Received incomplete information from the parent")};window.addEventListener("message",c,!1);b.postMessage(q.buildWindowOpenerRequest(),"*")}(a,d,f.childWindowOpenerWait||1E3,function(c){var d=c.items||[];l(p,f,r,d,c.other);g(p,r,!1,d,a,c,b)},function(){k(p,r,f,a,b)}):k(p,r,f,a,b)}}else m.getLogger().error("cmp2-ui: errors config is not defined can't make request on ResultPage")};b.registerImpression=function(a,b){var c=e.CompareToSettings.getInstance();c.getSettings(function(e){if(q.isEnabled(a.type,
e)&&!q.excludeRequest(e,c.getClient(),a.placement)){e=d(a.type,a.placement,a.searchId,a.url,b);var g=t.List.getConfig(e);r.Ajax.getInstance().request(g,function(a){a&&a.success||m.getLogger().error("cmp2-ui: Error on registerImpression",g,a)},function(a){m.getLogger().error("cmp2-ui: AJAX error on registerImpression",a,g)})}})};var u=function(a){m.getLogger().error("cmp2-ui: noop was called")},n=u},2320:function(f,b,a){function k(a){h.extractWindowOpenerRequest(a)&&(m||l.getLogger().error("cmp2-ui: Did not expect FD data to be empty"),
a.source.postMessage(h.buildWindowOpenerResponse(m),"*"),m=void 0,window.removeEventListener("message",k,!1))}Object.defineProperty(b,"__esModule",{value:!0});b.onFormButtonMouseUp=b.onFormButtonMouseDown=b.onFormClick=b.onItemChange=b.onItemMouseDown=b.onItemMouseUp=void 0;var l=a(9993),g=a(5232),d=a(9695),c=a(9545),h=a(679),e=a(2684);b.onItemMouseUp=function(a,b){return l.getWorkaround().onItemMouseUp(a,b)};b.onItemMouseDown=function(a,b){return l.getWorkaround().onItemMouseDown(a,b)};b.onItemChange=
function(a,b,c){return d.CompareToList.getInstance().updateCheckedItemState(a,c),l.getWorkaround().onItemChange(a,b,c)};b.onFormClick=function(a,b,f,u){var n=function(){u&&u()};if(!a.placement)return n(),void l.getLogger().error("cmp2-ui: placement information is missing in onFormClick method",a);var p=a.type,q=c.CompareToSettings.getInstance();if(!q.isSettings())return 0<b.length&&l.getLogger().error("cmp2-ui: settings is missing in onFormClick method with items",a,b),void n();var r=q.getSettingsSync();
if(h.isEnabled(p,r)&&!h.excludeRequest(r,q.getClient(),a.placement)){a.url=f;var p=d.CompareToList.getInstance().getImpressionRequestState(b),q={windowNamePrefix:l.getWorkaround().getWindowNamePrefix(),referer:r.uiReferer?window.location.href:""},t=g.WindowInfo.getStoreConfig(a,p,q);a=a.urlPrefix?a.urlPrefix:"";if(d.CompareToList.getInstance().isCheckedItem(b)){var v=r.parentWindowOpener;v&&(A=t.data,window.removeEventListener("message",k,!1),m=A,window.addEventListener("message",k,!1));var x=a+f;
l.getWorkaround().onFormClick(x,b,function(a){v?l.getWorkaround().navigateToResults(x,b,a)||n():e.Ajax.getInstance().request(t,function(c){if(!c||!c.success)return l.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",c.errors),void n();l.getWorkaround().navigateToResults(x,b,a)||n()},function(a){l.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",a);n()},n)})}else{var A;e.Ajax.getInstance().request(t,function(a){a&&a.success||l.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",
a.errors);n()},function(a){l.getLogger().error("cmp2-ui: AJAX error on Store WindowInfo",a);n()},n)}}else n()};b.onFormButtonMouseDown=function(a){d.CompareToList.getInstance().isCheckedItem(a)&&(c.CompareToSettings.getInstance().isSettings()?l.getWorkaround().onFormButtonMouseDown(a):l.getLogger().error("cmp2-ui: settings are not set to execute form mouse down"))};b.onFormButtonMouseUp=function(a){d.CompareToList.getInstance().isCheckedItem(a)&&(c.CompareToSettings.getInstance().isSettings()?l.getWorkaround().onFormButtonMouseUp(a):
l.getLogger().error("cmp2-ui: settings are not set to execute form mouse up"))};var m=void 0},679:function(f,b,a){function k(a){var b=[];if(a.placement){var c=a.placement;b.push(c.vertical?c.vertical:a.type);b.push(c.type||"");b.push(function(a){switch(a){case "fd":case "pn":return"FD";case "bb":case "rr":case "sa":case "pu":case "md":return"RP"}}(c.showOn)||"");b.push(c.page||"");b.push(function(a){switch(a){case "right":return"R";case "top":case "inline":case "panel":case "fdct":return"M";case "bottom":return"B";
case "popup":return"P"}return""}(c.displayRail)+(c.position||0))}return b.join(".")}Object.defineProperty(b,"__esModule",{value:!0});b.WINDOW_OPENER_EVENT=b.WINDOW_OPENER_REQUEST_EVENT=b.getPageOrigin=b.getMultiProviderWindowExtra=b.extractWindowOpenerResponse=b.extractWindowOpenerRequest=b.buildWindowOpenerResponse=b.buildWindowOpenerRequest=b.excludeRequest=b.isEnabled=void 0;var l=a(9545);b.isEnabled=function(a,b){return b&&b.enabled&&(!b.verticals||b.verticals[a])||!1};b.excludeRequest=function(a,
b,c){if(!c)return!1;var d=a.clientDisplayRails;a=a.displayRails;return d&&d[b]&&!1===d[b][c.displayRail]||a&&!1===a[c.displayRail]||!1};b.buildWindowOpenerRequest=function(){return{event:b.WINDOW_OPENER_REQUEST_EVENT}};b.buildWindowOpenerResponse=function(a){return{event:b.WINDOW_OPENER_EVENT,windowInfo:a}};b.extractWindowOpenerRequest=function(a){a=a&&a.data;return!(!a||!a.event||a.event!==b.WINDOW_OPENER_REQUEST_EVENT)&&a};b.extractWindowOpenerResponse=function(a){a=a&&a.data;return!(!a||!a.event||
a.event!==b.WINDOW_OPENER_EVENT)&&a};b.getMultiProviderWindowExtra=function(a,b,c){var d;c={searchId:void 0!==c?c:a.searchId};var e=l.CompareToSettings.getInstance().getSettingsSync();if(!e||!(d="rp"===b?e.multiProviderWindowRP:e.multiProviderWindowFD))return c;b=a.placement;return b&&(d.pageOrigin&&(c.pageOrigin=k(a)),d.showOn&&(c.showOn=b.showOn),d.displayRail&&(c.displayRail=b.displayRail),d.vertical&&(c.vertical=a.type),d.position&&(c.position=b.displayRail)),c};b.getPageOrigin=k;b.WINDOW_OPENER_REQUEST_EVENT=
"FD_CMP2_ITEMS_REQUEST";b.WINDOW_OPENER_EVENT="FD_CMP2_ITEMS"},655:function(f,b,a){function k(a,b){function c(){this.constructor=a}if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");I(a,b);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}function l(a,b){var c={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var e=
0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]])}return c}function g(a,b,c,d){var e,f=arguments.length,g=3>f?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;0<=h;h--)(e=a[h])&&(g=(3>f?e(g):3<f?e(b,c,g):e(b,c))||g);return 3<f&&g&&Object.defineProperty(b,c,g),g}function d(a,b){return function(c,
d){b(c,d,a)}}function c(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function h(a,b,c,d){return new (c||(c=Promise))(function(e,f){function g(a){try{k(d.next(a))}catch(H){f(H)}}function h(a){try{k(d.throw(a))}catch(H){f(H)}}function k(a){var b;a.done?e(a.value):(b=a.value,b instanceof c?b:new c(function(a){a(b)})).then(g,h)}k((d=d.apply(a,b||[])).next())})}function e(a,b){function c(c){return function(g){return function(c){if(d)throw new TypeError("Generator is already executing.");
for(;h;)try{if(d=1,e&&(f=2&c[0]?e.return:c[0]?e.throw||((f=e.return)&&f.call(e),0):e.next)&&!(f=f.call(e,c[1])).done)return f;switch(e=0,f&&(c=[2&c[0],f.value]),c[0]){case 0:case 1:f=c;break;case 4:return h.label++,{value:c[1],done:!1};case 5:h.label++;e=c[1];c=[0];continue;case 7:c=h.ops.pop();h.trys.pop();continue;default:if(!(f=h.trys,(f=0<f.length&&f[f.length-1])||6!==c[0]&&2!==c[0])){h=0;continue}if(3===c[0]&&(!f||c[1]>f[0]&&c[1]<f[3]))h.label=c[1];else if(6===c[0]&&h.label<f[1])h.label=f[1],
f=c;else if(f&&h.label<f[2])h.label=f[2],h.ops.push(c);else{f[2]&&h.ops.pop();h.trys.pop();continue}}c=b.call(a,h)}catch(N){c=[6,N],e=0}finally{d=f=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,g])}}var d,e,f,g,h={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return g={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g}function m(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,
c)||E(b,a,c)}function q(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.");}function t(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e;a=c.call(a);var f=[];try{for(;(void 0===b||0<b--)&&!(d=a.next()).done;)f.push(d.value)}catch(M){e=
{error:M}}finally{try{d&&!d.done&&(c=a.return)&&c.call(a)}finally{if(e)throw e.error;}}return f}function r(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(t(arguments[b]));return a}function u(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var e=arguments[b],f=0,g=e.length;f<g;f++,d++)a[d]=e[f];return a}function n(a,b,c){if(c||2===arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),
d[e]=b[e]);return a.concat(d||b)}function p(a){return this instanceof p?(this.v=a,this):new p(a)}function v(a,b,c){function d(a){l[a]&&(k[a]=function(b){return new Promise(function(c,d){1<m.push([a,b,c,d])||e(a,b)})})}function e(a,b){try{(c=l[a](b)).value instanceof p?Promise.resolve(c.value.v).then(f,g):h(m[0][2],c)}catch(O){h(m[0][3],O)}var c}function f(a){e("next",a)}function g(a){e("throw",a)}function h(a,b){a(b);m.shift();m.length&&e(m[0][0],m[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");
var k,l=c.apply(a,b||[]),m=[];return k={},d("next"),d("throw"),d("return"),k[Symbol.asyncIterator]=function(){return this},k}function w(a){function b(b,e){c[b]=a[b]?function(c){return(d=!d)?{value:p(a[b](c)),done:"return"===b}:e?e(c):c}:e}var c,d;return c={},b("next"),b("throw",function(a){throw a;}),b("return"),c[Symbol.iterator]=function(){return this},c}function z(a){function b(b){c[b]=a[b]&&function(c){return new Promise(function(d,e){(function(a,b,c,d){Promise.resolve(d).then(function(b){a({value:b,
done:c})},b)})(d,e,(c=a[b](c)).done,c.value)})}}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,d=a[Symbol.asyncIterator];return d?d.call(a):(a=q(a),c={},b("next"),b("throw"),b("return"),c[Symbol.asyncIterator]=function(){return this},c)}function D(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function x(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)"default"!==c&&Object.prototype.hasOwnProperty.call(a,
c)&&E(b,a,c);return F(b,a),b}function A(a){return a&&a.__esModule?a:{default:a}}function B(a,b,c,d){if("a"===c&&!d)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}function C(a,b,c,d,e){if("m"===d)throw new TypeError("Private method is not writable");if("a"===d&&!e)throw new TypeError("Private accessor was defined without a setter");
if("function"==typeof b?a!==b||!e:!b.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}a.r(b);a.d(b,{__extends:function(){return k},__assign:function(){return J},__rest:function(){return l},__decorate:function(){return g},__param:function(){return d},__metadata:function(){return c},__awaiter:function(){return h},__generator:function(){return e},__createBinding:function(){return E},__exportStar:function(){return m},
__values:function(){return q},__read:function(){return t},__spread:function(){return r},__spreadArrays:function(){return u},__spreadArray:function(){return n},__await:function(){return p},__asyncGenerator:function(){return v},__asyncDelegator:function(){return w},__asyncValues:function(){return z},__makeTemplateObject:function(){return D},__importStar:function(){return x},__importDefault:function(){return A},__classPrivateFieldGet:function(){return B},__classPrivateFieldSet:function(){return C}});
var I=function(a,b){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},J=function(){return(J=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},E=Object.create?function(a,b,c,d){void 0===d&&(d=c);Object.defineProperty(a,d,{enumerable:!0,
get:function(){return b[c]}})}:function(a,b,c,d){void 0===d&&(d=c);a[d]=b[c]},F=Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b}}},z={};v.d=function(f,b){for(var a in b)v.o(b,a)&&!v.o(f,a)&&Object.defineProperty(f,a,{enumerable:!0,get:b[a]})};v.o=function(f,b){return Object.prototype.hasOwnProperty.call(f,b)};v.r=function(f){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"});
Object.defineProperty(f,"__esModule",{value:!0})};var B;B=v(3465);window["@r9/cmp2-ui"]||(window["@r9/cmp2-ui"]=B)})();
(function(f,g){var h=f.config.getBoolean("ui.common.core.reducedErrorLogging",!1);f.createComponentClass("common.compareto.v3.CompareToModuleSettings",{options:{config:null,prefix:null,addType:!1,advanceError:!1},moduleLoaded:!1,ajaxCall:function(a,b,c){var e=this.options,d=g.extend(!0,{},a.params,a.data);"GET"!==a.method&&(d=JSON.stringify(d));g.ajax({url:a.url,method:a.method,dataType:"json",contentType:"application/json; charset\x3dutf-8",data:d,headers:a.headers,success:function(a){b&&b(a)},error:function(a,
b,d){c&&(e.advanceError?c({jqXHR:a,status:a.status,responseText:a.responseText,textStatus:b,errorThrown:d}):c(a))}})},init:function(){var a=this,b=a.options,c=b.config,e=b.prefix,d=a.log;f.question.answer("cmp2.module.loaded",function(){return a.moduleLoaded});f.question.answer("cmp2.module.config",function(){return c});c?a.setConfig(c):(e={method:"GET",url:e+"compareTo/config",success:function(b){b&&b.content?a.setConfig(b.content):(d.error("cmp2-module: unexpected response in config",b),a.setConfig(null))},
error:function(b){h||d.error("cmp2-module: error loading config",b);a.setConfig(null)}},b.addType&&(e.dataType="json",e.contentType="application/json;charset\x3dutf-8"),g.ajax(e))},setConfig:function(a){var b=this,c=b.getLogger();f.events.publish("cmp2.module.config",a);window["@r9/cmp2-ui"].setModuleConfig({ajax:function(a,d,c){b.ajaxCall(a,d,c)},logger:c,settings:a,client:"desktop"});b.moduleLoaded=!0;f.events.publish("cmp2.module.loaded",!0)},getLogger:function(){if(!h)return this.log;var a=function(){};
return g.extend(!0,{},this.log,{debug:a,error:a,info:a,warn:a})},addEventHandlers:function(){}})})(window.R9,window.jQuery||window.jq);
(function(c){c.createComponentClass("common.compareto.v3.ResultPage",{options:{searchId:"",vertical:""},init:function(){var a=this.options.searchId;if(a)window["@r9/cmp2-ui"].onResultPage({placement:null,requestInformation:null,type:this.getVertical(),searchId:a},function(a,b){c.events.publish("tags.dataLayer.push",{event:"r9",eventName:"adClick",adType:"cmp2",selectedProviders:b.filter(function(a){return a.checked}).map(function(a){return{providerName:a.name,providerCode:a.code}})})})},getVertical:function(){var a=
"";switch(this.options.vertical){case "flights":a="F";break;case "hotels":a="H";break;case "cars":a="C";break;case "packages":a="P";break;case "cruises":a="R";break;case "trains":a="T"}return a},addEventHandlers:function(){var a=this,d=a.options;a.subscribe("resultspage.cleanup",function(){d.searchId=null});a.subscribe("resultspage.searchId.changed",function(b){b&&b.searchId&&b.searchId!==d.searchId&&(c.ComponentManager.removeSingleton(a._namespace),c.ajax.execute("common/compareto/v3/ResultPage",
{data:{searchId:b.searchId,vertical:d.vertical}}))})}})})(window.R9);
(function(b,d){b.createComponentClass("common.booking.SearchIdExpirationChecker","framework.JavaScriptComponent",{options:{},searchId:null,searchIdLikelyValid:!0,checkTimer:null,init:function(){this.options.searchId&&(this.searchId=this.options.searchId)},addEventHandlers:function(){var a=this;this.base();this.subscribe("resultspage.streaming.done",this.searchEnded.bind(this));this.subscribe("resultspage.refreshed",this.searchEndedWait.bind(this));this.subscribe(["search.startSearch","resultspage.searchId.changed",
"search.expired","results.expired"],this.clearCheckTimer.bind(this));d("a.bookingLink").click(function(){return a.interceptClick()})},interceptClick:function(){if(this.searchIdLikelyValid)return!0;b.Analytics.api.trackEvent("searchidexpired/booklink");b.events.publish("results.expired");return!1},clearCheckTimer:function(){this.checkTimer&&(clearTimeout(this.checkTimer),this.checkTimer=null)},searchEndedWait:function(a){var b=this;setTimeout(function(){b.searchEnded(a)},100)},searchEnded:function(a){this.clearCheckTimer();
a&&a.searchId?(this.searchId=a.searchId,this.searchIdLikelyValid=!0,this.startCheckTimer()):a&&"streaming"in a&&!a.streaming?this.startCheckTimer():this.searchId=null},startCheckTimer:function(){if(!this.checkTimer){var a=this;this.checkTimer=setTimeout(function(){a.validateFromServer();a.checkTimer=null},this.options.checkTimeout)}},validateFromServer:function(){if(this.searchId){var a=this;d.ajax({type:"POST",url:"/s/horizon/common/booking/SearchIdValidationAction",headers:{"X-CSRF":b.globals.formtoken},
data:{searchId:this.searchId},success:function(c){c&&(a.searchIdLikelyValid=!c.isExpired,c.isExpired&&b.events.publish("searchid.expiration.check.failed"))}})}}})})(R9,jQuery);
(function(b,k){b.createComponentClass("flights.results.SplitBookingHelper","framework.JavaScriptComponent",{searchId:null,componentPath:"flights/results/FlightResultSplitBookingTable",pendingRequests:{},dialogsOpened:[],addEventHandlers:function(){var a=this;this.base();this.subscribe(["multibook.splitProvider.click","SplitBooking.request"],this.requestSplitBookingDialog.bind(this));this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("filters.changed",
this.onFiltersChanged.bind(this))},onFiltersChanged:function(){this.dialogsOpened.length&&b.dom.schedule(this.clearDialogs.bind(this))},clearDialogs:function(){this.dialogsOpened.length&&(this.dialogsOpened.forEach(function(a){a&&b.events.publish("SplitBookingDialog.remove",{resultId:a})}),this.dialogsOpened=[])},requestSplitBookingDialog:function(a){var l=a.searchId||this.searchId,d=k(a.element),g=!!a.replaceElement,c=a.targetElementId||d.length&&d.attr("id"),h=this;d.length&&!c&&(c="tmp-"+Math.round(1E5*
Math.random()),d.attr("id",c));c||this.log.error("SplitBookingDialog requested, but no target supplied");b.Analytics.api.trackEvent({action:"buttonClick",category:"splitProvider"});var f=c+"_"+a.resultId;if(b.question.ask("SplitBookingDialog.%s.exists".format(a.resultId)))b.events.publish("SplitBookingDialog.open",{targetElementId:c,resultId:a.resultId});else if(!this.pendingRequests[f]){this.pendingRequests[f]=!0;var e=b.question.ask("resultspage.filterState.is");e&&(e=JSON.stringify(e));b.events.publish("SplitBookingDialog.remove",
{resultId:a.resultId});b.ajax.execute(a.splitComponentPath||this.componentPath,{data:{searchId:l,resultId:a.resultId,filterState:e,targetElementId:c,dialogView:!0},handleSearchExpired:!0,replace:g,appendTo:g?d:void 0}).then(function(){b.events.publish("SplitBookingDialog.loaded",{resultId:a.resultId});h.dialogsOpened.push(a.resultId)}).fail(function(){b.events.publish("SplitBookingDialog.error",{resultId:a.resultId})}).always(function(){delete h.pendingRequests[f]})}}})})(R9,jQuery);
(function(c,e){function h(a){return Object.keys(a).map(function(b){return 0<a[b].selected?b:null}).filter(function(a){return null!==a}).join(",")}function f(a,b){return a.hasOwnProperty(b)&&0<a[b].selected}c.publish("flights.results.FlightPriceAlertsUtils",{showEmailAlertError:function(a){c.events.publish("error.alert",{messages:a})},emailAlertSaveSuccess:function(a){c.events.publish("alertsaved.success",{alertid:a})},showDuplicateEmailAlertError:function(a,b){c.events.publish("alertsaved.error",
{errorid:a,error:b})}});c.createComponentClass("flights.results.FlightPriceAlertsController","framework.JavaScriptComponent",{options:{anonUser:!0,showUnconfirmedWarning:!1,alertSavedMessage:null,alertSavedMessageShort:null,alertUpdatedMessage:null,alertManageLinkMessage:null,showManageLink:!1,isPriceAlertsAnon:!1,killWatchlist:!1,priceAlertUiUpdate:!1,initialFormData:null,isAccountWatchListEnabled:!1,showAlertFeedbackMessaging:!0,resendConfirmationEmailUrl:null,reactPriceAlertEnabled:!1,priceAlertOnboardingEnabled:!1},
shortDepartDate:null,shortReturnDate:null,isOneWay:!1,updateSavedAlert:!1,showFeedbackMessage:!1,searchId:null,alertFormData:{ac:null,alertid:null,action:null,alertsrc:null,hsrc:null,code:null,dest:null,desthint:null,destlist:null,depart_date:null,return_date:null,depart_flex:null,return_flex:null,numtrav:null,travadl:null,travsen:null,travyth:null,travchd:null,travsinf:null,travlinf:null,cabin:null,Enonstop:!1,oneway:null,dt:"e",ns:null,"1s":null,"2s":null,depairports:null,retairports:null,airlines:null,
max:null,dtakeoffmin:null,dtakeoffmax:null,atakeoffmin:null,atakeoffmax:null,dlandingmin:null,dlandingmax:null,alandingmin:null,alandingmax:null,removeHistory:null,createFromButton:null},init:function(){window.alerts=this;this.alertFormData=e.extend({},this.alertFormData,this.options.initialFormData);this.options.initialFormData&&(this.shortDepartDate=this.options.initialFormData.shortDepartDate,this.shortReturnDate=this.options.initialFormData.shortReturnDate,this.isOneWay=this.options.initialFormData.isOneWay)},
addEventHandlers:function(){var a=this;this.base();this.subscribe("searchform.submit",function(b){a.syncSearchParams(b)});this.subscribe("resultspage.filtersData.changed",function(b){a.syncFilterState(b);a.updateSavedAlert&&!a.options.anonUser&&(a.alertFormData.removeHistory=!0,a.getShowAlertFiltersUpdate(b)&&(a.showFeedbackMessage=!0),a.saveEmailPriceAlert(),a.updateSavedAlert=!1)});this.subscribe("flights.results.alerts.create",this.onResultsAlertCreate.bind(this));this.subscribe("flights.results.alerts.delete",
this.deletePriceAlert.bind(this));this.subscribe("flights.results.alerts.driveby",this.saveDriveByEmailAlert.bind(this));this.subscribe("flights.results.alerts.multiFlightDriveby",this.saveMultiFlightDriveByEmailAlert.bind(this));this.subscribe("flights.results.existingAlert",function(b){a.alertFormData.alertid=b;c.events.publish("flights.priceAlert.setview",{view:"edit"})});this.subscribe("resultspage.streaming.done",function(){setTimeout(function(){!a.options.anonUser&&a.alertFormData.alertid&&
0<a.alertFormData.alertid.length&&(a.alertFormData.removeHistory=!1,a.saveEmailPriceAlert())},500)});this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("explorepage.flight.changed",function(b){a.searchId=b.searchId;b={code:b.origincode,dest:b.destinationCode,desthint:b.destinationCode,destlist:b.destinationCode,depart_dateISO:b.departureDate,return_dateISO:b.returnDate,shortDepartDate:moment(b.departureDate).format("ddd, MMM D"),shortReturnDate:moment(b.returnDate).format("ddd, MMM D")};
a.alertFormData=e.extend({},a.alertFormData,b,{numtrav:1,travadl:1,hsrc:"y",travsen:0,travyth:0,travchd:0,travsinf:0,travlinf:0,cabin:"e",Enonstop:!1,oneway:"n",dt:"e",ns:"Y","1s":"Y","2s":"Y",airlines:"ALL",dtakeoffmin:"NONE",dtakeoffmax:"NONE",atakeoffmin:"NONE",alandingmax:"NONE"})});this.subscribe("alertauth.show",this.showAlertAuth.bind(this));this.subscribe("alertsaved.success",function(b){a.showPriceAlertSaved(b.alertid)});this.subscribe("alertsaved.error",function(b){a.showPriceAlertSaved(b.errorid,
b.error)});this.subscribe("filters.changed",function(){a.alertFormData.alertid&&a.alertFormData.alertid.length&&(a.updateSavedAlert=!0)});this.subscribe("common.results.resendConfirmationEmail",this.resendConfirmationEmail.bind(this));this.answer("flights.results.alerts.existingAlert",function(){return a.alertFormData.alertid})},onResultsAlertCreate:function(a){var b=this.options.isPriceAlertsAnon&&this.options.anonUser,d=this.options.priceAlertOnboardingEnabled&&!a.userConfirmed&&!this.hasShownPriceAlertModal();
b||d?this.showDriveByEmailAlert(a):this.createPriceAlert(a)},clearFormData:function(){Object.keys(this.alertFormData).forEach(function(a){this.alertFormData[a]=null},this);this.shortDepartDate=this.shortReturnDate=null;this.isOneWay=!1;this.alertFormData.dt="e"},getFlexParam:function(a){return a&&"exact"!==a?a:null},syncSearchParams:function(a){this.clearFormData();this.alertFormData.depart_date=a.depart_date;this.alertFormData.return_date=a.return_date;this.alertFormData.depart_flex=this.getFlexParam(a.depart_date_flex);
this.alertFormData.return_flex=this.getFlexParam(a.return_date_flex);this.alertFormData.code=a.origincode?(a.origincode+"").split("/")[0]:"";this.alertFormData.dest=this.alertFormData.desthint=this.alertFormData.destlist=a.destinationcode?(a.destinationcode+"").split("/")[0]:"";this.alertFormData.numtrav=a.travelers;this.alertFormData.travadl=a.adults;this.alertFormData.travsen=a.seniors;this.alertFormData.travyth=a.youth;this.alertFormData.travchd=a.child;this.alertFormData.travlinf=a.lapInfant;
this.alertFormData.travsinf=a.seatInfant;this.isOneWay=a.oneway;this.alertFormData.cabin=a.cabin;this.alertFormData.oneway=a.oneway?"y":a.isMulticity?"m":"weekend"===a.flex_category?"w":"n";this.shortDepartDate=moment(a.depart_date_canon).format("MMM D");this.isOneWay||(this.shortReturnDate=moment(a.return_date_canon).format("MMM D"))},syncFilterState:function(a){this.alertFormData.dtakeoffmin=this.alertFormData.dtakeoffmax=this.alertFormData.atakeoffmin=this.alertFormData.alandingmax="NONE";this.alertFormData.airlines=
"ALL";this.alertFormData.depairports=this.alertFormData.retairports=this.alertFormData.max=null;this.alertFormData.max=null;a.hasOwnProperty("stops")&&(this.alertFormData.ns=f(a.stops.valueMap,"0")?"Y":"N",this.alertFormData["1s"]=f(a.stops.valueMap,"1")?"Y":"N",this.alertFormData["2s"]=f(a.stops.valueMap,"2")?"Y":"N");if(a.hasOwnProperty("airports")&&a.airports.isDirty){var b=a.airports.legValues[0];this.alertFormData.depairports=h(b.headingValueMap[b.orderedHeadings[0]]);1<b.orderedHeadings.length&&
(this.alertFormData.retairports=h(b.headingValueMap[b.orderedHeadings[1]]))}a.hasOwnProperty("airlines")&&a.airlines.isDirty&&(b=Object.keys(a.airlines.valueMap).filter(function(b){var c=a.airlines.valueMap[b];return 0===c.selected&&!c.disabled&&"MULT"!==b&&"operators"!==b}),this.alertFormData.airlines=0<b.length?b.join(","):"ALL");a.hasOwnProperty("takeoff")&&a.takeoff.isDirty&&(this.alertFormData.dtakeoffmin=a.takeoff.legs[0].leftRange,this.alertFormData.dtakeoffmax=a.takeoff.legs[0].rightRange,
1<a.takeoff.legs.length&&(this.alertFormData.atakeoffmin=a.takeoff.legs[1].leftRange,this.alertFormData.atakeoffmax=a.takeoff.legs[1].rightRange));a.hasOwnProperty("landing")&&a.landing.isDirty&&(this.alertFormData.alandingmin=a.landing.legs[0].leftRange,this.alertFormData.alandingmax=a.landing.legs[0].rightRange,1<a.landing.legs.length&&(this.alertFormData.dlandingmin=a.landing.legs[1].leftRange,this.alertFormData.dlandingmax=a.landing.legs[1].rightRange))},serialize:function(){var a=this;return Object.keys(a.alertFormData).map(function(b){var c=
a.alertFormData[b];return null===c||void 0===c||""===c?"":encodeURIComponent(b)+"\x3d"+encodeURIComponent(c)}).join("\x26")},createPriceAlert:function(a){this.options.anonUser?this.showAlertAuth():this.options.showUnconfirmedWarning?c.events.publish("common.results.unconfirmedWarning",{sendEmailBeforeOpeningDialog:!0}):(this.showFeedbackMessage=!0,this.alertFormData.createFromButton=!0,this.saveEmailPriceAlert());a&&a.vsLog&&c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",
action:"create",value:"new"})},deletePriceAlert:function(a){a&&a.alertId&&!this.alertFormData.alertid&&(this.alertFormData.alertid=a.alertId);this.options.anonUser&&!this.alertFormData.alertid?this.showAlertAuth():(this.showFeedbackMessage=!0,this.deleteEmailPriceAlert(a));a&&a.vsLog&&c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",action:"delete",value:this.alertFormData.alertid})},renderSearchDataForLogin:function(a){var b=e(a.elementNode).find(".flightCities");
a=e(a.elementNode).find(".flightDates");b.empty();a.empty();b.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.alertFormData.code)));b.append(e("\x3cspan class\x3d'%s'/\x3e".format(this.isOneWay?"arrow singleArrow":"arrow doubleArrow")));b.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.alertFormData.dest)));a.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.shortDepartDate)));this.isOneWay||(a.append(e("\x3cspan\x3e - \x3c/span\x3e")),a.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.shortReturnDate))))},
showAlertAuth:function(a,b){var d=this;a=e.extend({},a,{promoType:"alerts"});a={promo:"priceAlert",promoType:a.promoType,username:a.username,aftershow:this.renderSearchDataForLogin.bind(this),success:function(){c.authentication.cached_dialog.dialog.close();d.showFeedbackMessage=!0;d.alertFormData.createFromButton=!0;d.saveEmailPriceAlert().done(function(){window.location.reload()}).fail(function(){d.log.error("Save email price alert failed")})}};b?c.authentication.showLogin(a):c.authentication.showSignup(a)},
saveEmailPriceAlert:function(a){var b=e.Deferred();this.alertFormData.action="save";this.alertFormData.hsrc="y";this.alertFormData.alertsrc=a||"toolbox";e.ajax({type:"POST",headers:{"X-CSRF":c.globals.formtoken},url:"/s/alertajax",data:this.serialize(),dataType:"script",error:function(a,e){c.events.publish("error.alert",{messages:e});b.reject()},success:function(){b.resolve()}});return b},deleteEmailPriceAlert:function(a){var b=this;e.ajax({type:"POST",url:"/h/hermes/prefs/ajax/alert/v1",headers:{"X-CSRF":c.globals.formtoken},
data:{action:"delete",alertid:this.alertFormData.alertid},success:function(){b.alertFormData.alertid="";c.events.publish("flights.priceAlert.deleted");a&&a.success&&a.success()},error:function(a,e){b.options.reactPriceAlertEnabled||c.events.publish("error.alert",{messages:e})}})},showDriveByEmailAlert:function(a){if(this.options.reactPriceAlertEnabled)c.events.publish("flights.results.react.priceAlert.driveBy.setup",{searchId:this.searchId||"",sourceId:a?a.sourceId:void 0,forceShow:!0});else if(!this.openExistingDriveby(a)){var b=
a&&a.popover,d={data:{searchId:this.searchId,forceShow:!0,popover:b},replace:!0};a&&a.hasOwnProperty("sourceId")&&(d.data.sourceId=a.sourceId);b&&(d.appendTo=a.appendTo);c.ajax.execute("flights/results/"+(b?"ForzaFlightPriceAlertDriveBy":"FlightPriceAlertDriveBy"),d).then(function(){a&&a.success&&a.success()})}},openExistingDriveby:function(a){var b=a&&a.popover?"pricealert.driveby.popover":"pricealert.driveby",d=c.question.ask(b);if(null===d)return!1;if(d===this.searchId)return c.events.publish(b+
".show",a),!0;c.events.publish(b+".destroy");return!1},saveDriveByEmailAlert:function(a){var b=this;this.alertFormData.action="driveby";this.alertFormData.alertsrc="driveby";e.ajax({type:"POST",url:"/s/run/drivebyalert/createflightpricealert",headers:{"X-CSRF":c.globals.formtoken},data:{searchid:this.searchId,email:a.email,optin:a.optin,regurl:a.sourceId||"drivebysave",noforcelogin:b.options.isPriceAlertsAnon},success:function(d){d&&d.success?(c.Analytics.api.trackEvent({category:a.vsCategory||"Drive-By",
action:"signup"}),b.alertFormData.alertid=d.alertid,c.events.publish("flights.priceAlert.setview",{view:"edit"}),c.events.publish("flights.priceAlert.created",{alertId:d.alertid,searchId:b.searchId}),"function"===typeof a.success?a.success():b.showAlertCompleteFeedback(!0,!0),c.authentication.needsRefresh=!0):d&&!d.success&&d.existingUser?b.showAlertAuth(null,!0):d&&!d.success&&c.events.publish("flights.priceAlert.failure");d&&(d.showUnconfirmedWarning?c.events.publish("common.results.unconfirmedWarning",
{email:a.email}):c.events.publish("common.results.unconfirmedWarningNotNeeded",{email:a.email}))},cache:!1})},saveMultiFlightDriveByEmailAlert:function(a){var b=this;this.alertFormData.action="driveby";this.alertFormData.alertsrc="driveby";e.ajax({type:"POST",url:"/s/run/drivebyalert/createflightpricealerts",headers:{"X-CSRF":c.globals.formtoken},data:{flights:JSON.stringify(a.flights),email:a.email,optin:a.optin,regurl:a.sourceId||"drivebysave",noforcelogin:b.options.isPriceAlertsAnon},success:function(a){a&&
a.success?(b.alertFormData.alertid=a.alertid,b.showAlertCompleteFeedback(!0,!0),c.Analytics.api.trackEvent({category:"Drive-By",action:"signup"}),c.events.publish("flights.priceAlert.setview",{view:"edit"}),c.authentication.needsRefresh=!0):a&&!a.success&&a.existingUser&&b.showAlertAuth(null,!0)},cache:!1})},showPriceAlertSaved:function(a){c.events.publish("flights.priceAlert.setview",{view:"edit"});c.events.publish("flights.priceAlert.created",{searchId:this.searchId,alertId:a});if(this.alertFormData.alertid&&
0<this.alertFormData.alertid.length)this.showFeedbackMessage&&(this.showAlertCompleteFeedback(!1),this.showFeedbackMessage=!1);else{c.Analytics.api.trackEvent("pricealert/exactdate/create");var b=c.question.ask("flights.results.prediction.is");b&&"none"!==b.advice?c.Analytics.api.trackEvent("pricealert/prediction/"+(b.buy?"buy":"hold")):c.Analytics.api.trackEvent("pricealert/prediction/nodata");this.alertFormData.alertid=a;this.showAlertCompleteFeedback(!0)}},getShowAlertFiltersUpdate:function(a){return a.stops.isDirty||
a.airlines.isDirty||a.airports.isDirty||a.landing.isDirty||a.takeoff.isDirty||a.price.isDirty?!0:!1},showAlertCompleteFeedback:function(a,b){if(this.options.showAlertFeedbackMessaging&&!this.options.killWatchlist&&!this.options.priceAlertUiUpdate){var d=e(".belowSearchContainer .warningsContainer"),g=a?this.options.alertSavedMessage:this.options.alertUpdatedMessage,f=a?"alertSavedWarning":"alertUpdatedWarning";a&&b&&(g=this.options.alertSavedMessageShort);this.options.showManageLink&&(g+=" \x3ca href\x3d'"+
(this.options.isAccountWatchListEnabled?"/watchlist":"/alerts")+"' target\x3d'_blank' class\x3d'manageLink'\x3e"+this.options.alertManageLinkMessage+"\x3c/a\x3e",c.Analytics.api.trackEvent({category:"pricealert/managelink/impression",action:"impression"}));d.empty();d.append("\x3cdiv class\x3d'%s'\x3e\x3cspan\x3e%s\x3c/span\x3e\x3c/div\x3e".format(f,g));e(".manageLink",d).on("click.manageLink",function(){c.Analytics.api.trackEvent({category:"pricealert/managelink/click",action:"click"})});d.addClass("visible");
e(document).one("click",function(){d.removeClass("visible");e(".manageLink",d).off("click.manageLink")});a||setTimeout(function(){d.removeClass("visible")},8E3)}c.events.publish("watching",{searchId:this.searchId})},resendConfirmationEmail:function(a){var b=e.Deferred();a&&a.email&&(this.alertFormData.email=a.email);e.ajax({type:"POST",headers:{"X-CSRF":c.globals.formtoken},url:this.options.resendConfirmationEmailUrl,data:this.serialize(),dataType:"script",error:function(a,e){c.events.publish("error.alert",
{messages:e});b.reject()},success:function(){b.resolve()}})},hasShownPriceAlertModal:function(){var a=c.storage.get("priceAlertModalShown");return!(!a||!a.flight)}})})(R9,jQuery);
(function(e,g){var h=e.config.getBoolean("ui.whisky.modal.enabled",!1);e.createComponentClass("common.booking.ClickoutController","framework.JavaScriptComponent",{options:{postClickDelay:200},resultsOrderLogString:null,searchIdExpirationCheckFailed:!1,addEventHandlers:function(){this.base();var a=this;this.subscribe("clickout.open",function(b){a.searchIdExpirationCheckFailed?(e.Analytics.api.trackEvent("searchidexpired/bestclick"),e.events.publish("results.expired")):a.open(b)});this.subscribe("clickout.resultsOrder.update",
function(b){a.resultsOrderLogString=b});this.subscribe("searchid.expiration.check.failed",function(){a.searchIdExpirationCheckFailed=!0});this.subscribe("resultspage.cleanup",function(){a.searchIdExpirationCheckFailed=!1})},open:function(a){var b=a.data||{},c=g(a.element),d=a.event;a=a.callback||g.noop;var f=d&&(d.metaKey||d.ctrlKey);c.length&&("A"!==c.get(0).nodeName&&(c=c.find("a").eq(0)),b.target=b.target||c.attr("target"),b.url=b.url||c.attr("href"),b.name=b.name||c.data("name"),b.code=b.code||
c.data("code"),b.splitProvider=b.splitProvider||c.data("split-provider"),b.element=c,b.showWhiskyModal=!!b.showWhiskyModal,void 0===b.clickoutWarningDialog&&(b.clickoutWarningDialog=c.data("clickout-warning-dialog")),void 0===b.clickoutAlternateOptionsDialog&&(b.clickoutAlternateOptionsDialog=c.data("clickout-alternate-options-dialog")));d&&d.preventDefault();b.noExternalRedirect=this.isNoExternalRedirect(b);"undefined"===typeof b.showAfterclick&&(b.showAfterclick=!b.noExternalRedirect);b.noExternalRedirect?
this.postClick(b,a,f):(b.target=b.target||"_blank",(c="self"===b.target)&&this.postClick(b,a,f),d=b.url,this.resultsOrderLogString&&(d+=(1>d.indexOf("?")?"?":"\x26")+"resultsOrder\x3d"+encodeURIComponent(this.resultsOrderLogString)),"undefined"===typeof b.code||"BOOKINGDOTCOMPV"!==b.code&&"BOOKINGDOTCOMGENIUS"!==b.code&&"BOOKINGDOTCOMGENIUSCORE"!==b.code||!0!==e.question.ask("hotels_bdc_should_clickout")?(h&&b.showWhiskyModal?e.events.publish("cars.whisky.modal.startWatching",{url:d+"\x26_kw_whiskyModal\x3dtrue",
resultId:b.resultId,code:b.code}):window.open(d,b.target),c||setTimeout(this.postClick.bind(this,b,a,f),this.options.postClickDelay)):e.events.publish("genius.show.interstitial",b))},postClick:function(a,b,c){a.clickoutDetailsDialog||a.clickoutAlternateOptionsDialog||a.clickoutInline||e.events.publish(["multibook.providerClicked","provider.book.click"],g.extend({resultId:a.resultId,uiResultId:a.uiResultId,providerName:a.name,providerCode:a.code,splitProvider:a.splitProvider,clickoutDetailsDialog:a.clickoutDetailsDialog,
clickoutInline:a.clickoutInline,clickoutWarningDialog:a.clickoutWarningDialog,clickoutAlternateOptionsDialog:a.clickoutAlternateOptionsDialog,afterclickIgnore:!a.showAfterclick||c},a.customPostClickData));!this.publishAlternateClickout(a)&&a.splitProvider&&e.events.publish("multibook.splitProvider.click",{resultId:a.resultId,element:a.element});b(a)},publishAlternateClickout:function(a){var b=!1,c,d,f;if(a.splitProvider&&!a.clickoutInline&&!a.clickoutDetailsDialog)return!1;a.clickoutDetailsDialog?
f="multibook.modalDetailsDialog.show":a.clickoutInline?(d={activeTab:"rates",force:!0},f="flightResult.details.clickout.toggleOpen"):a.clickoutAlternateOptionsDialog?f="multibook.clickoutAlternateOptions.show":a.clickoutWarningDialog&&(f="multibook.clickoutWarning.show");if(f){d=g.extend(d||{},a);c=g.extend(d,this.getSubscriptionResetData(function(){b=!0}));e.events.publish(f,d);if(!b)this.onClickoutWarningFailure(c);e.events.publish("track.result.details.open",{resultId:a.resultId,source:"cta"});
return!0}return!1},getSubscriptionResetData:function(a){return{clickoutWarningDialog:!1,clickoutAlternateOptionsDialog:!1,clickoutDetailsDialog:!1,clickoutInline:!1,noExternalRedirect:!1,verifySubscriptionCallback:a}},isNoExternalRedirect:function(a){return a.noExternalRedirect||a.blockClickout||a.splitProvider||a.clickoutWarningDialog||a.clickoutDetailsDialog||a.clickoutInline||a.clickoutAlternateOptionsDialog},onClickoutWarningFailure:function(a){var b=g.extend({},a,this.getSubscriptionResetData(void 0)),
c;try{c=JSON.stringify(a)}finally{this.open({data:b}),this.log.error("Failed to open clickout dialog. Subscription for result "+a.resultId+" not registered.\nPublish data: "+c)}}})})(R9,jQuery);
(function(c,b){c.createComponentClass("common.results.TabUrgency",{originalTitle:void 0,isOn:!1,waitTimeout:void 0,options:{title:void 0,waitTime:5E3,includeCurrentTitle:!0},init:function(){this.originalTitle=document.title},isRP:function(){return 0===b(".vm-fd").length},addEventHandlers:function(){window.onblur=b.proxy(this.turnOn,this);window.onfocus=b.proxy(this.turnOff,this)},turnOn:function(){var a=this;a.isRP()&&!a.isOn&&(a.isOn=!0,a.originalTitle=document.title,a.waitTimeout=setTimeout(function(){document.title=
a.options.includeCurrentTitle?a.options.title+" "+a.originalTitle:a.options.title},a.options.waitTime))},turnOff:function(){this.isRP()&&(this.isOn=!1,clearTimeout(this.waitTimeout),0===document.title.indexOf(this.options.title)?document.title=this.originalTitle:this.originalTitle=document.title)}})})(R9,jQuery);
(function(c,e,f){var g=c.config.getBoolean("ui.horizon.results.searchPoll.includePollNumberInQuery",!0),h={trains:"trains/results/TrainsSearchPoll",flights:"flights/results/FlightSearchPoll",hotels:"hotels/results/HotelSearchPoll",packages:"packages/results/PackageSearchPoll",cars:"cars/results/CarSearchPoll",deals:"deals/results/DealSearchPoll",cruises:"cruises/results/CruiseSearchPoll",rentals:"rentals/results/RentalSearchPoll",activities:"activities/results/ActivitiesSearchPoll",cityhotels:"hotels/cityhotels/CityHotelsPoll",
restaurants:"restaurants/results/RestaurantSearchPoll",essentials:"essentials/results/EssentialsSearchPoll"},k={trains:"trains/results/TrainsResultDetails",flights:"flights/results/FlightResultDetails",hotels:"hotels/results/HotelResultDetails",packages:"packages/results/PackageResultDetails",rentals:"rentals/results/HotelResultDetails",activities:"activities/results/ActivitiesResultDetails"};c.publish("base.results.AjaxSearchPoll",f.extend({searchUrl:null,detailsUrl:null,options:{vertical:null,searchId:null,
appendTo:null},pollNumber:0,searchId:null,constructor:function(a){this.options=e.extend({},this.options,a);if(!a.vertical)throw"AjaxSearchPoll requires a vertical to be properly initialized";this.searchId=this.options.searchId;this.searchUrl=h[this.options.vertical];this.detailsUrl=k[this.options.vertical];"cityhotels"===this.options.vertical&&this.options.citycode&&(this.searchUrl+="?citycode\x3d"+this.options.citycode)},fetchResults:function(a,b){a=e.extend({data:e.extend({searchId:this.searchId,
poll:!0,pollNumber:this.pollNumber},a||{}),appendTo:this.options.appendTo,replace:!1,logServerErrors:c.config.getBoolean("ui.ajax.logServerErrors.searchPoll",!1),enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.searchPoll",!0)},b||{});c.config.getBoolean("ui.ssajax.last.action.abort",!1)&&(a.data.ajaxts=(new Date).getTime());b=this.searchUrl;g&&(b+="?p\x3d"+this.pollNumber);this.searchId=a.data.searchId;this.pollNumber++;return c.ajax.execute(b,a)},fetchDetails:function(a,b){b={data:{resultId:a,
searchId:this.searchId},appendTo:b,enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.inlineDetails",!0)};if(null===b.searchId)throw"Cannot request result details for %s: No searchId tied to this instance of AjaxSaerchPoll.".format(a);return c.ajax.execute(this.detailsUrl,b)}}));c.publish("resultsMetaData",{PROPERTIES:"code selected minPrice count displayValue displayOrder resetState defaultSelectedState dynamicFilteredStatus ignoreOnly hideOnly href noSelect disabled cssClass showAllState noPrice pluralDisplayValue minDuration minDurationValue meta description".split(" "),
publish:function(a){a.hasOwnProperty("filtersData")&&this.remapFilters(a.filtersData);c.events.publish("search.poll.response",a)},remapFilters:function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=a[b[c]];d.valueMap||d.headingValueMap?this.remapValueSetFilter(d):(d.legValues||d.legHeadingValues)&&this.remapPerLegValueSetFilter(d)}},remapValueSetFilter:function(a){if(a.valueMap)Object.values(a.valueMap).forEach(this.remapValueData.bind(this));else if(a.headingValueMap)for(var b in a.headingValueMap)Object.values(a.headingValueMap[b]).forEach(this.remapValueData.bind(this))},
remapPerLegValueSetFilter:function(a){if(a.legValues)Object.values(a.legValues).forEach(this.remapValueSetFilter.bind(this));else if(a.legHeadingValues)for(var b=0;b<a.legHeadingValues.length;b++)Object.values(a.legHeadingValues[b]).forEach(this.remapValueSetFilter.bind(this))},remapValueData:function(a){for(var b=a.rawState?a.rawState.split(";"):[],c=0;c<b.length;c++){var d=b[c];d.length&&(a[this.PROPERTIES[c]]=this.castValue(this.PROPERTIES[c],d))}if(a.hasOwnProperty("dynamicFilteredStatus")){a.filtered=
!1;a.partiallyFiltered=!1;switch(a.dynamicFilteredStatus){case 1:a.filtered=!0;break;case 2:a.partiallyFiltered=!0}delete a.dynamicFilteredStatus}a.hasOwnProperty("noPrice")&&a.noPrice&&(a[a.noPrice]=!0,delete a.noPrice);delete a.rawState},castValue:function(a,b){switch(a){case "code":case "displayValue":case "minPrice":case "pluralDisplayValue":case "cssClass":case "minDuration":case "href":case "noPrice":return b;case "selected":case "count":case "displayOrder":case "showAllState":case "resetState":case "defaultSelectedState":case "minDurationValue":case "dynamicFilteredStatus":return parseInt(b);
case "ignoreOnly":case "hideOnly":case "noSelect":case "disabled":return"1"===b;default:return b}}})})(R9,jQuery,base2.Base);
(function(f,k,l){var m=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDetails",!0),n=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDialogs",!0);f.publish("base.results.ResultsPageDOMUtils",{mergeOpenResults:function(a,d){if(m){var c=a.find(".Base-Results-HorizonResult.DetailOpen");c.length&&this.mergeOpenDetails(c,a)}n&&(c=k(".Common-Widgets-Dropdown-DropdownDialog-Content.open"),c.length&&this.mergeOpenDialogs(c,a,d))},mergeOpenDialogs:function(a,d,c){for(var b=0;b<a.length;b++){var e=
a[b].getAttribute("data-dropdown-owner");if(e&&d.find("#"+e).length){e=c.find("#"+a[b].id);if(e.length){var g=e.attr("id").split("-")[0],h=k("#"+g),g=c.find("#"+g);if(h.length&&g.length&&h.index()===g.index()){a[b].setAttribute("reconcile-ignore","attributes");f.dom.merge(a[b],e[0]);e[0].remove();continue}}a[b].remove()}}},mergeOpenDetails:function(a,d){for(var c=0;c<a.length;c++)if(!d.find("#"+a[c].id).hasClass("DetailOpen")){a[c].setAttribute("reconcile-ignore","attributes");var b=a[c].getElementsByClassName("detailsWrapper");
1===b.length&&(b[0].setAttribute("reconcile-ignore","all"),b=b[0].getElementsByClassName("detailsContent"),b.length&&b[0].children.length&&b[0].children[0].setAttribute("do-not-destroy","true"))}}});f.publish("base.results.AdsHelper",l.extend({adRequestInfo:null,adsResponseDate:null,adUpdateTimerID:null,constructor:function(a){this.adRequestInfo={}},updateAds:function(a){f.config.getBoolean("ui.ads.copyPollAdsData",!0)&&(a=k.extend(!0,{},a));if(f.config.getBoolean("ui.ads.nowAfterResponse",!0)&&this.adRequestInfo)for(var d in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(d)){var c=
this.adRequestInfo[d];if(c)for(var b=0;b<c.length;b++)c[b].now=0}this.adsResponseDate=Date.now();window.clearTimeout(this.adUpdateTimerID);this.adUpdateTimerID=setTimeout(function(){f.events.publish("resultspage.ads.update",a)},f.config.getInt("ui.horizon.resultspage.ads.updateDelay",100))},requiresAdsPoll:function(){if(!f.config.getBoolean("ui.horizon.resultspage.requireAdsPoll",!0)||this.adsResponseDate||!this.adRequestInfo)return!1;for(var a in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(a)){var d=
this.adRequestInfo[a];if(d&&d.pop)for(var c=0;c<d.length;c++)if(d[c].now)return!0}return!1},clearAdRequestInfo:function(a){this.adRequestInfo&&(this.adRequestInfo[a]=[])},onSetupAdsRequest:function(a){if(a&&a.adType&&a.pageLocation){this.adRequestInfo||(this.adRequestInfo={});this.adRequestInfo[a.adType]||(this.adRequestInfo[a.adType]=[]);for(var d=this.adRequestInfo[a.adType],c,b=0;b<d.length;b++)d[b]&&d[b].pageLocation===a.pageLocation&&(c=1,d[b]=a);c||d.push(a)}},setAdRequestSearchOptions:function(a,
d){if(a&&this.adRequestInfo){var c="",b="",e,g,h=function(a){if(!a||!a.length)return"";for(var c="",b,e=0;e<a.length;e++)(b=a[e])&&b.pageLocation&&(!isNaN(b.minRefreshRate)&&(0<b.minRefreshRate||0===b.minRefreshRate)&&(g=void 0===g?b.minRefreshRate:Math.min(g,b.minRefreshRate)),b.now||b.events&&b.events.pop&&"string"===typeof d&&0<=b.events.indexOf(d))&&(f.config.getBoolean("ui.ads.nowAfterResponse",!0)||(b.now=0),c+=b.pageLocation+",");return c};for(e in this.adRequestInfo)this.adRequestInfo.hasOwnProperty(e)&&
("displayAd"===e?c=h(this.adRequestInfo[e]):"textAd"===e&&(b=h(this.adRequestInfo[e])));d&&f.events.publish("resultspage.ads.options");!a.forceRefreshAds&&this.adsResponseDate&&0<g&&Date.now()-this.adsResponseDate<g||(b&&(a.textAdPageLocations=b.substr(0,b.length-1)),c&&(a.displayAdPageLocations=c.substr(0,c.length-1)),a.existingAds=!!this.adsResponseDate)}}}))})(R9,jQuery,base2.Base);
(function(c,e){var l=/attempt=([0-9]+)/,m=/lastms=([0-9]{13})/,p=c.config.getBoolean("ui.ajax.logServerErrors.searchPoll",!1);c.createComponentClass("base.results.ResultsPage",{searchRunner:null,searchId:null,priceType:null,searchStartParams:null,vertical:null,urlSearchStartSupported:!1,loggingPrefix:"resultspage",logger:null,registerInlineDisplayAdTimeout:null,poll:{pollingId:null,sent:0,activeRequest:null,ended:!1,nextPollTimeoutId:null,firstPhaseCompleted:!1,consecutiveEmptyResponses:0,lastPollTotalCount:-1,
started:null,usingPreservedFilters:!1,reason:"POLL"},filterState:null,urlFilterState:null,filtersData:null,useUrlFilterState:!0,useViewStateFilterState:!0,resultsList:e(),listBody:e(),listCol:null,progressBar:null,paginator:null,viewState:null,leftRail:null,rightRail:null,backToTop:null,clientTimeoutId:null,idleTimeoutId:null,secondPhaseTimeoutId:null,frenchWarning:null,ariaResultMsgWidget:null,ajaxAppendTo:null,preserveFilters:!1,preservedFilters:null,adsHelper:null,lastLimitedDateMs:null,lastLimitedMinMS:18E5,
activeRequests:{},options:{displaySpinnerLoader:!1,infinite:!1,button:!1,startSearchImmediately:!1,searchParams:null,ajaxParams:null,poll:!0,pageNumber:1,searchId:null,completed:!1,sortMode:null,quickLinkType:null,ascending:null,priceType:null,useStickyPriceType:!1,centerPointLat:null,centerPointLong:null,urlFilterState:null,pollingTimeout:16E3,exponentialBackoffDelay:!1,pollDelay:250,maxPollDelay:5E3,pollingId:null,windowScroll:"",persistWindowScroll:!1,filtersData:null,quickLinkData:null,useTwoPhasePolling:!1,
visible:!1,useBuzz:!1,fastCover:!1,showExpiredResultsMessage:!0,secondPhaseWait:null,secondPhaseTimeout:null,idleExpireMinutes:120,enforceIdleTimeout:!0,showFilteredButSimilar:!1,scrollTopOnFilterChange:!1,defaultSortType:null,useUrlSortMode:!1,msg:{expired_search:"",filters_removed:""},ariaMsg:{resultsLoading:"",resultsReady:"",noResultsFound:""},nonClearablePreservedFilters:[],forceLoadingTreatmentSkip:!1,placeholderDelay:0,defaultPaddingLeft:30,watchedResultId:"",animateInlineSearch:!0,useActiveRequestsMap:!1,
destroyAdsForForbiddenCountries:!1,inlineResultsDisplayAd:!1,enableResultsPageFullstoryData:!1,logClientTimeoutToKibana:!1},init:function(){this.appendResults=this.options.infinite||this.options.button;this.filterState={};this.viewState={openDetails:{}};this.leftRail=this.getChildElement("leftRail");this.rightRail=this.getChildElement("rightRail");this.backToTop=this.getChildElement("backToTop");this.resultsList=this.getChildElement("list");this.listBody=this.element.find(".listBody");this.listCol=
this.getChildElement("listCol");this.resultsListCover=this.listBody.find(".resultsListCover");this.loadingMessage=this.element.find(".loadingMessage");this.progressBar=this.getChildElement("progress");this.frenchWarning=this.getChildElement("frenchWarning");this.searchId=this.options.searchId;this.priceType=this.options.priceType;this.poll.pollingId=this.options.pollingId;this.urlFilterState=this.options.urlFilterState;this.searchStartParams=this.options.searchStartParams||{};this.ariaResultMsgWidget=
this.getChildElement("aria-result-msg").getWidget();c.events.publish("paginator.hide");this.options.filtersData&&c.resultsMetaData.remapFilters(this.options.filtersData)},addEventHandlers:function(){var a=this,b=null,d=function(){null!==b&&clearTimeout(b);b=setTimeout(function(){c.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:a.searchId,key:"openDetails",value:JSON.stringify(a.viewState.openDetails)})},1E3)};this.subscribe(["searchform.submit","multilocale.search.submit"],
this.startSearchFromSearchForm.bind(this));var f=this.onFilterStateChange.bind(this);f.priority=0;this.subscribe("filters.changed",f);this.subscribe("filters.changed.all",this.onAllFilterStateChange.bind(this));f=this.preprocessResponse.bind(this);f.priority=0;this.subscribe("search.poll.response",f);this.subscribe("resultspage.filters.sync",this.syncFilterState.bind(this));this.subscribe("paginator.change",this.onPaginatorChange.bind(this));this.subscribe("resultsHeader.changed",this.onResultsListHeaderChange.bind(this));
this.subscribe("resultspage.view.setvisible",this.setVisible.bind(this));this.subscribe("resultspage.results.refresh",this.refreshResults.bind(this));this.subscribe("resultspage.transition.remove",this.removeTransitionClass.bind(this));this.subscribe(["result.details.opened","result.details.tab.changed"],function(b){a.viewState.openDetails[b.resultId]=b.activeTab||"overview";d()});this.subscribe("result.details.closed",function(b){delete a.viewState.openDetails[b.resultId];d()});this.subscribe("searchForm.changed",
this.toggleSearchFormChanged.bind(this));this.subscribe("unbind.scroll.search.event",this.toggleSearchFormChanged.bind(this,!1));this.subscribe(["results.expired","user.refresh.expired"],this.reloadExpiredResults.bind(this));this.subscribe("resultspage.showLowest",function(){c.events.publish("filters.reset",{type:"showAll"});c.events.publish("resultsHeader.sortType.set",{sortCode:"price_a"})});this.subscribe("ads.request",function(b){a.getAdsHelper().onSetupAdsRequest(b)});this.subscribe("results.quickLinkType.setDefault",
function(){}