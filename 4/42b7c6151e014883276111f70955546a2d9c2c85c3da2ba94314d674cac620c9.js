!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}function n(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function i(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-->0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}function o(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function a(e){return this instanceof a?(this.v=e,this):new a(e)}function c(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){s.push([e,t,r,n])>1||c(e,t)}))})}function c(e,t){try{(r=i[e](t)).value instanceof a?Promise.resolve(r.value.v).then(u,h):l(s[0][2],r)}catch(e){l(s[0][3],e)}var r}function u(e){c("next",e)}function h(e){c("throw",e)}function l(e,t){e(t),s.shift(),s.length&&c(s[0][0],s[0][1])}}function u(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=i(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}function h(e){return"function"==typeof e}function l(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var d=l((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function p(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var f=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,a;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=i(c),l=u.next();!l.done;l=u.next()){l.value.remove(this)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else c.remove(this);var p=this.initialTeardown;if(h(p))try{p()}catch(e){a=e instanceof d?e.errors:[e]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var v=i(f),g=v.next();!g.done;g=v.next()){var y=g.value;try{m(y)}catch(e){a=null!=a?a:[],e instanceof d?a=o(o([],s(a)),s(e.errors)):a.push(e)}}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}}if(a)throw new d(a)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)m(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&p(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&p(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),v=f.EMPTY;function g(e){return e instanceof f||e&&"closed"in e&&h(e.remove)&&h(e.add)&&h(e.unsubscribe)}function m(e){h(e)?e():e.unsubscribe()}var y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},b={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=b.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,o([e,t],s(r))):setTimeout.apply(void 0,o([e,t],s(r)))},clearTimeout:function(e){var t=b.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function _(e){b.setTimeout((function(){throw e}))}function S(){}var w=k("C",void 0,void 0);function k(e,t,r){return{kind:e,value:t,error:r}}var E=null;function T(e){if(y.useDeprecatedSynchronousErrorHandling){var t=!E;if(t&&(E={errorThrown:!1,error:null}),e(),t){var r=E,n=r.errorThrown,i=r.error;if(E=null,n)throw i}}else e()}var C=function(e){function r(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,g(t)&&t.add(r)):r.destination=R,r}return t(r,e),r.create=function(e,t,r){return new P(e,t,r)},r.prototype.next=function(e){this.isStopped?O(function(e){return k("N",e,void 0)}(e),this):this._next(e)},r.prototype.error=function(e){this.isStopped?O(k("E",void 0,e),this):(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped?O(w,this):(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(f),x=Function.prototype.bind;function I(e,t){return x.call(e,t)}var A=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){N(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){N(e)}else N(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){N(e)}},e}(),P=function(e){function r(t,r,n){var i,s,o=e.call(this)||this;h(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:o&&y.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},i={next:t.next&&I(t.next,s),error:t.error&&I(t.error,s),complete:t.complete&&I(t.complete,s)}):i=t;return o.destination=new A(i),o}return t(r,e),r}(C);function N(e){_(e)}function O(e,t){var r=y.onStoppedNotification;r&&b.setTimeout((function(){return r(e,t)}))}var R={closed:!0,next:S,error:function(e){throw e},complete:S},L="function"==typeof Symbol&&Symbol.observable||"@@observable";function M(e){return e}function B(e){return 0===e.length?M:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var U=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,i=this,s=(n=e)&&n instanceof C||function(e){return e&&h(e.next)&&h(e.error)&&h(e.complete)}(n)&&g(n)?e:new P(e,t,r);return T((function(){var e=i,t=e.operator,r=e.source;s.add(t?t.call(s,r):r?i._subscribe(s):i._trySubscribe(s))})),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=D(t))((function(t,n){var i=new P({next:function(t){try{e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[L]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return B(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=D(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function D(e){var t;return null!==(t=null!=e?e:y.Promise)&&void 0!==t?t:Promise}function j(e){return function(t){if(function(e){return h(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function z(e,t,r,n,i){return new q(e,t,r,n,i)}var q=function(e){function r(t,r,n,i,s,o){var a=e.call(this,t)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return t(r,e),r.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},r}(C),K=l((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),H=function(){}(U),$=function(e){function r(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return t(r,e),r.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},r.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},r.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},r.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:v},r}(H),F=function(e){function r(t){var r=e.call(this)||this;return r._value=t,r}return t(r,e),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),r.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},r.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},r.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},r}(H),V={now:function(){return(V.delegate||Date).now()},delegate:void 0},Y=function(e){function r(t,r,n){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===n&&(n=V);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return t(r,e),r.prototype.next=function(t){var r=this,n=r.isStopped,i=r._buffer,s=r._infiniteTimeWindow,o=r._timestampProvider,a=r._windowTime;n||(i.push(t),!s&&i.push(o.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},r.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,n=this._buffer.slice(),i=0;i<n.length&&!e.closed;i+=r?1:2)e.next(n[i]);return this._checkFinalizedStatuses(e),t},r.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,r=e._timestampProvider,n=e._buffer,i=e._infiniteTimeWindow,s=(i?1:2)*t;if(t<1/0&&s<n.length&&n.splice(0,n.length-s),!i){for(var o=r.now(),a=0,c=1;c<n.length&&n[c]<=o;c+=2)a=c;a&&n.splice(0,a+1)}},r}(H),J=function(e){function r(t,r){return e.call(this)||this}return t(r,e),r.prototype.schedule=function(e,t){return this},r}(f),W={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=W.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,o([e,t],s(r))):setInterval.apply(void 0,o([e,t],s(r)))},clearInterval:function(e){var t=W.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},G=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return t(r,e),r.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},r.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),W.setInterval(e.flush.bind(e,this),r)},r.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;W.clearInterval(t)},r.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},r.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,p(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},r}(J),X=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=V.now,e}(),Z=new(function(e){function r(t,r){void 0===r&&(r=X.now);var n=e.call(this,t,r)||this;return n.actions=[],n._active=!1,n._scheduled=void 0,n}return t(r,e),r.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},r}(X))(G),Q=Z,ee=new U((function(e){return e.complete()}));function te(e){return e&&h(e.schedule)}function re(e){return e[e.length-1]}function ne(e){return h(re(e))?e.pop():void 0}function ie(e){return te(re(e))?e.pop():void 0}function se(e,t){return"number"==typeof re(e)?e.pop():t}var oe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ae(e){return h(null==e?void 0:e.then)}function ce(e){return h(e[L])}function ue(e){return Symbol.asyncIterator&&h(null==e?void 0:e[Symbol.asyncIterator])}function he(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var le="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function de(e){return h(null==e?void 0:e[le])}function pe(e){return c(this,arguments,(function(){var t,r,i;return n(this,(function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,a(t.read())];case 3:return r=n.sent(),i=r.value,r.done?[4,a(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,a(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function fe(e){return h(null==e?void 0:e.getReader)}function ve(e){if(e instanceof U)return e;if(null!=e){if(ce(e))return s=e,new U((function(e){var t=s[L]();if(h(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(oe(e))return n=e,new U((function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()}));if(ae(e))return r=e,new U((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,_)}));if(ue(e))return ge(e);if(de(e))return t=e,new U((function(e){var r,n;try{for(var s=i(t),o=s.next();!o.done;o=s.next()){var a=o.value;if(e.next(a),e.closed)return}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}e.complete()}));if(fe(e))return ge(pe(e))}var t,r,n,s;throw he(e)}function ge(e){return new U((function(t){(function(e,t){var i,s,o,a;return r(this,void 0,void 0,(function(){var r,c;return n(this,(function(n){switch(n.label){case 0:n.trys.push([0,5,6,11]),i=u(e),n.label=1;case 1:return[4,i.next()];case 2:if((s=n.sent()).done)return[3,4];if(r=s.value,t.next(r),t.closed)return[2];n.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=n.sent(),o={error:c},[3,11];case 6:return n.trys.push([6,,9,10]),s&&!s.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function me(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var s=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(s),!i)return s}function ye(e,t){return void 0===t&&(t=0),j((function(r,n){r.subscribe(z(n,(function(r){return me(n,e,(function(){return n.next(r)}),t)}),(function(){return me(n,e,(function(){return n.complete()}),t)}),(function(r){return me(n,e,(function(){return n.error(r)}),t)})))}))}function be(e,t){return void 0===t&&(t=0),j((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function _e(e,t){if(!e)throw new Error("Iterable cannot be null");return new U((function(r){me(r,t,(function(){var n=e[Symbol.asyncIterator]();me(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function Se(e,t){if(null!=e){if(ce(e))return function(e,t){return ve(e).pipe(be(t),ye(t))}(e,t);if(oe(e))return function(e,t){return new U((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}(e,t);if(ae(e))return function(e,t){return ve(e).pipe(be(t),ye(t))}(e,t);if(ue(e))return _e(e,t);if(de(e))return function(e,t){return new U((function(r){var n;return me(r,t,(function(){n=e[le](),me(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){return void r.error(e)}i?r.complete():r.next(t)}),0,!0)})),function(){return h(null==n?void 0:n.return)&&n.return()}}))}(e,t);if(fe(e))return function(e,t){return _e(pe(e),t)}(e,t)}throw he(e)}function we(e,t){return t?Se(e,t):ve(e)}var ke=l((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Ee(e,t){return j((function(r,n){var i=0;r.subscribe(z(n,(function(r){n.next(e.call(t,r,i++))})))}))}var Te=Array.isArray;function Ce(e){return Ee((function(t){return function(e,t){return Te(t)?e.apply(void 0,o([],s(t))):e(t)}(e,t)}))}var xe=Array.isArray,Ie=Object.getPrototypeOf,Ae=Object.prototype,Pe=Object.keys;function Ne(e){if(1===e.length){var t=e[0];if(xe(t))return{args:t,keys:null};if((n=t)&&"object"==typeof n&&Ie(n)===Ae){var r=Pe(t);return{args:r.map((function(e){return t[e]})),keys:r}}}var n;return{args:e,keys:null}}function Oe(e,t){return e.reduce((function(e,r,n){return e[r]=t[n],e}),{})}function Re(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=ie(e),n=ne(e),i=Ne(e),s=i.args,o=i.keys;if(0===s.length)return we([],r);var a=new U(Le(s,r,o?function(e){return Oe(o,e)}:M));return n?a.pipe(Ce(n)):a}function Le(e,t,r){return void 0===r&&(r=M),function(n){Me(t,(function(){for(var i=e.length,s=new Array(i),o=i,a=i,c=function(i){Me(t,(function(){var c=we(e[i],t),u=!1;c.subscribe(z(n,(function(e){s[i]=e,u||(u=!0,a--),a||n.next(r(s.slice()))}),(function(){--o||n.complete()})))}),n)},u=0;u<i;u++)c(u)}),n)}}function Me(e,t,r){e?me(r,e,t):t()}function Be(e,t,r){return void 0===r&&(r=1/0),h(t)?Be((function(r,n){return Ee((function(e,i){return t(r,e,n,i)}))(ve(e(r,n)))}),r):("number"==typeof t&&(r=t),j((function(t,n){return function(e,t,r,n,i,s,o,a){var c=[],u=0,h=0,l=!1,d=function(){!l||c.length||u||t.complete()},p=function(e){return u<n?f(e):c.push(e)},f=function(e){s&&t.next(e),u++;var a=!1;ve(r(e,h++)).subscribe(z(t,(function(e){null==i||i(e),s?p(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();o?me(t,o,(function(){return f(e)})):f(e)};c.length&&u<n;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(z(t,p,(function(){l=!0,d()}))),function(){null==a||a()}}(t,n,e,r)})))}function Ue(e){return void 0===e&&(e=1/0),Be(M,e)}function De(){return Ue(1)}function je(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return De()(we(e,ie(e)))}var ze=["addListener","removeListener"],qe=["addEventListener","removeEventListener"],Ke=["on","off"];function He(e,t,r,n){if(h(r)&&(n=r,r=void 0),n)return He(e,t,r).pipe(Ce(n));var i=s(function(e){return h(e.addEventListener)&&h(e.removeEventListener)}(e)?qe.map((function(n){return function(i){return e[n](t,i,r)}})):function(e){return h(e.addListener)&&h(e.removeListener)}(e)?ze.map($e(e,t)):function(e){return h(e.on)&&h(e.off)}(e)?Ke.map($e(e,t)):[],2),o=i[0],a=i[1];if(!o&&oe(e))return Be((function(e){return He(e,t,r)}))(ve(e));if(!o)throw new TypeError("Invalid event target");return new U((function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return o(t),function(){return a(t)}}))}function $e(e,t){return function(r){return function(n){return e[r](t,n)}}}function Fe(e,t,r){void 0===e&&(e=0),void 0===r&&(r=Q);var n=-1;return null!=t&&(te(t)?r=t:n=t),new U((function(t){var i,s=(i=e)instanceof Date&&!isNaN(i)?+e-r.now():e;s<0&&(s=0);var o=0;return r.schedule((function(){t.closed||(t.next(o++),0<=n?this.schedule(void 0,n):t.complete())}),s)}))}function Ve(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=ie(e),n=se(e,1/0),i=e;return i.length?1===i.length?ve(i[0]):Ue(n)(we(i,r)):ee}function Ye(e,t){return j((function(r,n){var i=0;r.subscribe(z(n,(function(r){return e.call(t,r,i++)&&n.next(r)})))}))}function Je(e,t,r,n,i){return function(s,o){var a=r,c=t,u=0;s.subscribe(z(o,(function(t){var r=u++;c=a?e(c,t,r):(a=!0,t),n&&o.next(c)}),i&&function(){a&&o.next(c),o.complete()}))}}var We,Ge=function(e,t){return e.push(t),e};function Xe(){return j((function(e,t){(function(e,t){return j(Je(e,t,arguments.length>=2,!1,!0))})(Ge,[])(e).subscribe(t)}))}function Ze(e){return j((function(t,r){var n=!1;t.subscribe(z(r,(function(e){n=!0,r.next(e)}),(function(){n||r.next(e),r.complete()})))}))}function Qe(e){return e<=0?function(){return ee}:j((function(t,r){var n=0;t.subscribe(z(r,(function(t){++n<=e&&(r.next(t),e<=n&&r.complete())})))}))}function et(e,t){return t?function(r){return je(t.pipe(Qe(1),j((function(e,t){e.subscribe(z(t,S))}))),r.pipe(et(e)))}:Be((function(t,r){return e(t,r).pipe(Qe(1),function(e){return Ee((function(){return e}))}(t))}))}function tt(e,t){return void 0===t&&(t=M),e=null!=e?e:rt,j((function(r,n){var i,s=!0;r.subscribe(z(n,(function(r){var o=t(r);!s&&e(i,o)||(s=!1,i=o,n.next(r))})))}))}function rt(e,t){return e===t}function nt(e){return void 0===e&&(e=it),j((function(t,r){var n=!1;t.subscribe(z(r,(function(e){n=!0,r.next(e)}),(function(){return n?r.complete():r.error(e())})))}))}function it(){return new ke}function st(e,t){var r=arguments.length>=2;return function(n){return n.pipe(e?Ye((function(t,r){return e(t,r,n)})):M,Qe(1),r?Ze(t):nt((function(){return new ke})))}}function ot(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return!0===t?(e(),null):!1===t?null:t.apply(void 0,o([],s(r))).pipe(Qe(1)).subscribe((function(){return e()}))}function at(e,t,r){var n,i,s,o,a=!1;return e&&"object"==typeof e?(n=e.bufferSize,o=void 0===n?1/0:n,i=e.windowTime,t=void 0===i?1/0:i,a=void 0!==(s=e.refCount)&&s,r=e.scheduler):o=null!=e?e:1/0,function(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new H}:t,n=e.resetOnError,i=void 0===n||n,s=e.resetOnComplete,o=void 0===s||s,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t=null,n=null,s=null,a=0,u=!1,h=!1,l=function(){null==n||n.unsubscribe(),n=null},d=function(){l(),t=s=null,u=h=!1},p=function(){var e=t;d(),null==e||e.unsubscribe()};return j((function(e,f){a++,h||u||l();var v=s=null!=s?s:r();f.add((function(){0!=--a||h||u||(n=ot(p,c))})),v.subscribe(f),t||(t=new P({next:function(e){return v.next(e)},error:function(e){h=!0,l(),n=ot(d,i,e),v.error(e)},complete:function(){u=!0,l(),n=ot(d,o),v.complete()}}),we(e).subscribe(t))}))(e)}}({connector:function(){return new Y(o,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function ct(e,t){return j((function(r,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};r.subscribe(z(n,(function(r){null==i||i.unsubscribe();var o=0,c=s++;ve(e(r,c)).subscribe(i=z(n,(function(e){return n.next(t?t(r,e,c,o++):e)}),(function(){i=null,a()})))}),(function(){o=!0,a()})))}))}class ut{constructor(e,t,r){this.persistentStorage=t,this.env=r,this.messages=new H,this.channelName=`pulse_bc_${e}`,this.init()}postMessage(e){this.nativeChannel?this.nativeChannel.postMessage(e):this.persistentStorage.setJSON(this.channelName,e)}init(){if(this.env.win.BroadcastChannel)return this.nativeChannel=new this.env.win.BroadcastChannel(this.channelName),void this.nativeChannel.addEventListener("message",(e=>{this.messages.next(e.data)}));this.persistentStorage.change(this.channelName,"full","external").subscribe((e=>{const t=JSON.parse(e.value||"null");this.messages.next(t)}))}}class ht{constructor(e,t,r,n){this.oneTrust=e,this.logger=t,this.hashStore=r,this.config=n;const i=this.buildConsentChecks(this.config.consentChecks||[]),s=i.map((e=>e.result.pipe(Ee((t=>({consent:{consent:e.consent,mode:e.mode,report:e.report,type:e.type},result:t}))))));this.consentChanges=Ve(...s),this.trackerConsentStream=this.createTrackerCheckerStream(i)}trackingEnabled(){return this.trackerConsentStream}softChanges(){return this.consentChanges}changes(){return this.consentChanges.pipe(Ye((({consent:e,result:t})=>{const r="string"==typeof e.consent?e.consent:e.consent.name,n=`tracking_consent_${e.type}${r}`;return this.hashStore.changed(n,t)})))}createTrackerCheckerStream(e){const t=e.every((e=>"opt-out"===e.mode)),r=new F(t),n=e.map((e=>e.result.pipe(Ee((t=>{if("tracking"===e.type){if("pending"===t.state)return"opt-out"===e.mode;if("boolean"==typeof t.performance_cookies)return t.performance_cookies}return!0})))));return n.length&&Re(n).pipe(Ee((e=>e.every((e=>!0===e))))).subscribe((e=>r.next(e))),r.asObservable().pipe(tt())}buildConsentChecks(e){var t;const r=[];for(const n of e)if("tracking"===n.type)if("OneTrust"===n.consent){const e=this.oneTrust.changes();r.push({...n,result:e})}else if("object"==typeof n.consent&&"function"==typeof(null===(t=n.consent)||void 0===t?void 0:t.handler)){const e=this.buildFunctionConsentChecker(n);r.push(e)}else this.logger.warn("Consent","Unsupported ConsentChecker!");else this.logger.warn("Consent","Unsupported ConsentCheck type!");return r}buildFunctionConsentChecker(e){var t;const r=new Y;if("object"==typeof e.consent&&"function"==typeof(null===(t=e.consent)||void 0===t?void 0:t.handler)){const t=e.consent.handler(r.next.bind(r));"object"==typeof t&&((n=t)&&(n instanceof U||h(n.lift)&&h(n.subscribe)))?t.subscribe(r):this.isPromise(t)?we(t).subscribe(r):this.isValidResult(t)&&r.next(t)}var n;return{...e,result:r.pipe(Ye((e=>this.isValidResult(e))))}}isPromise(e){return e instanceof Promise||"object"==typeof e&&"function"==typeof(null==e?void 0:e.then)}isValidResult(e){const t=e;return"object"==typeof t&&("pending"===(null==t?void 0:t.state)||"responded"===(null==t?void 0:t.state))}}class lt{constructor(e){this.unPrefixedCookieStorage=e,this.cookieName="OptanonConsent",this.boxCookieName="OptanonAlertBoxClosed"}changes(){const e=this.parseOneTrustCookie(),t=new F(e),r=new H;var n,i;return r.pipe((n=30,void 0===i&&(i=Z),j((function(e,t){var r=null,s=null,o=null,a=function(){if(r){r.unsubscribe(),r=null;var e=s;s=null,t.next(e)}};function c(){var e=o+n,s=i.now();if(s<e)return r=this.schedule(void 0,e-s),void t.add(r);a()}e.subscribe(z(t,(function(e){s=e,o=i.now(),r||(r=i.schedule(c,n),t.add(r))}),(function(){a(),t.complete()}),void 0,(function(){s=r=null})))}))),Ee((()=>this.parseOneTrustCookie()))).subscribe(t),this.unPrefixedCookieStorage.change(this.cookieName,"full","all").subscribe((()=>r.next())),this.unPrefixedCookieStorage.change(this.boxCookieName,"full","all").subscribe((()=>r.next())),t}parseOneTrustCookie(){const e=this.unPrefixedCookieStorage.get(this.cookieName)||"",t=new URLSearchParams(e||""),r=this.parseConsentGroups(t);if(!r)return{state:"pending"};const n=t.get("consentId")||void 0,i=this.getResponseTime(),s=Number.isSafeInteger(i),o="boolean"==typeof r.C0001?r.C0001:void 0,a="boolean"==typeof r.C0002?r.C0002:void 0,c="boolean"==typeof r.C0003?r.C0003:void 0,u="boolean"==typeof r.C0004?r.C0004:void 0;return{state:s?"responded":"pending",response_time:i,provider_consent_id:n,necessary_cookies:o,functional_cookies:c,performance_cookies:a,social_media_cookies:"boolean"==typeof r.C0005?r.C0005:void 0,targeting_cookies:u}}parseConsentGroups(e){const t=(e.get("groups")||"").trim();if(t)return t.split(",").reduce(((e,t)=>{const r=(t||"").split(":").map((e=>e.trim())),n=r[0],i="1"===r[1]||"true"===r[1];return n&&2===r.length&&(e[n]=i),e}),{})}getResponseTime(){const e=this.unPrefixedCookieStorage.get(this.boxCookieName),t=e?new Date(e):void 0;return(null==t?void 0:t.getTime())||void 0}}class dt{unsafeShortHash(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return t>>>=0,t.toString(36)}}class pt{constructor(e,t){this.value=e,this.optimized=t}toString(){return this.value}}class ft{cssPath(e,t=!1){try{if(e.nodeType!==Node.ELEMENT_NODE)return"";const r=[];let n=e;for(;n;){const i=this.createStep(n,!!t,n===e);if(!i)break;if(r.push(i),null==i?void 0:i.optimized)break;n=n.parentNode}return r.reverse(),r.join(" > ")}catch(e){return console.error(e),""}}createStep(e,t,r){var n;if(e.nodeType!==Node.ELEMENT_NODE)return null;const i=e.getAttribute("id");if(t){if(i)return new pt(this.idSelector(i),!0);const t=e.nodeName.toLowerCase();if("body"===t||"head"===t||"html"===t)return new pt(e.nodeName.toLowerCase(),!0)}const s=e.nodeName.toLowerCase();if(i)return new pt(s.toLowerCase()+this.idSelector(i),!0);const o=e.parentNode;if(!o||o.nodeType===Node.DOCUMENT_NODE)return new pt(s.toLowerCase(),!0);const a=this.prefixedElementClassNames(e),c=o.children;let u=!1,h=!1,l=-1;for(let t=0;(-1===l||!h)&&t<c.length;++t){const r=c[t];if(r===e){l=t;continue}if(h)continue;if((null==r?void 0:r.nodeName.toLowerCase())!==s.toLowerCase())continue;u=!0;const n=a;let i=0;for(const e in n)++i;if(0===i){h=!0;continue}const o=this.prefixedElementClassNames(r);for(const e of o)if(!n.indexOf(e)&&(delete n[e],!--i)){h=!0;break}}let d=s.toLowerCase();if(r&&"input"===s.toLowerCase()&&e.getAttribute("type")&&!e.getAttribute("id")&&!e.getAttribute("class")&&(d+='[type="'+e.getAttribute("type")+'"]'),h)d+=":nth-child("+(l+1)+")";else if(u)for(const e in a)d+="."+this.escapeIdentifierIfNeeded((null===(n=a[e])||void 0===n?void 0:n.substr(1))||"");return new pt(d,!1)}prefixedElementClassNames(e){const t=e.getAttribute("class");return t?t.split(/\s+/g).filter(Boolean).map((e=>"$"+e)):[]}idSelector(e){return"#"+this.escapeIdentifierIfNeeded(e)}escapeIdentifierIfNeeded(e){if(this.isCSSIdentifier(e))return e;const t=/^(?:[0-9]|-[0-9-]?)/.test(e),r=e.length-1;return e.replace(/./g,((e,n)=>t&&0===n||!this.isCSSIdentChar(e)?this.escapeAsciiChar(e,n===r):e))}escapeAsciiChar(e,t){return"\\"+this.toHexByte(e)+(t?"":" ")}toHexByte(e){let t=e.charCodeAt(0).toString(16);return 1===t.length&&(t="0"+t),t}isCSSIdentChar(e){return!!/[a-zA-Z0-9_-]/.test(e)||e.charCodeAt(0)>=160}isCSSIdentifier(e){return/^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(e)}}class vt{constructor(e){this.env=e}now(){return this.env.win.Date.now()}hrtTime(){return this.env.win.performance.timeOrigin+this.env.win.performance.now()}hrt(){return this.env.win.performance.now()}hrtOrigin(){return this.env.win.performance.now()}timezoneOffset(){const e=new this.env.win.Date;return e.getTimezoneOffset&&e.getTimezoneOffset()}}class gt{constructor(e,t){this.storage=e,this.KEY_DEBUG="debug",e.change(this.KEY_DEBUG).subscribe((e=>this.getDebugKeys(e.value)));const r=this.getDebugKeys();this.items=new F(r),Array.isArray(t.debug)&&this.enable(...t.debug)}enabled(e){const t=this.getDebugKeys();return t.has(e)||t.has("all")}enable(...e){const t=this.getDebugKeys();let r=!1;for(const n of e)r=r||!t.has(n),t.add(n);r&&this.set(Array.from(t))}disable(...e){const t=this.getDebugKeys();let r=!1;for(const n of e)r=r||t.has(n),t.delete(n);r&&this.set(Array.from(t))}set(e){this.storage.set(this.KEY_DEBUG,JSON.stringify(e)),this.debugItems=new Set(e),this.items.next(this.debugItems)}getDebugKeys(e){if(!this.debugItems||e){let t;try{if(t=JSON.parse(e||this.storage.get(this.KEY_DEBUG)||""),!Array.isArray(t))throw new Error("Failed to parse debug mode!")}catch(e){t=[]}this.debugItems=new Set(t)}return this.debugItems}}class mt{constructor(e,t){this.env=e,this.date=t}getHardwareInfo(){const{navigator:e}=this.env.win,t=this.getGPU();return{device_memory:e.deviceMemory||void 0,hardware_concurrency:e.hardwareConcurrency||void 0,gpu_vendor:null==t?void 0:t.vendor,gpu_renderer:null==t?void 0:t.renderer}}getScreenInfo(){const e=this.env.win,t=e.screen;return{touch:e.navigator.maxTouchPoints>0||e.navigator.msMaxTouchPoints>0||"ontouchstart"in navigator,resolution_x:t.width,resolution_y:t.height,available_resolution_x:t.availWidth,available_resolution_y:t.availHeight,pixel_ratio:e.devicePixelRatio,pixel_depth:t.pixelDepth}}getNavigatorInfo(){const e=this.env.win.navigator;return{language:e.language,languages:e.languages,platform:e.platform,timezone_offset:this.date.timezoneOffset(),user_agent:e.userAgent,vendor:e.vendor}}getGPU(){const e=this.env.win.document.createElement("canvas");try{const t=e.getContext("webgl")||e.getContext("experimental-webgl"),r=null==t?void 0:t.getExtension("WEBGL_debug_renderer_info");if(!r)return;const n=t.getParameter(r.UNMASKED_VENDOR_WEBGL),i=t.getParameter(r.UNMASKED_RENDERER_WEBGL);if(n||i)return{vendor:n,renderer:i}}catch(e){}}}function yt(e,t){return e===t||"object"==typeof e&&"object"==typeof t&&Object.keys({...e,...t}).every((r=>yt(e[r],t[r])))}function bt(e){return"object"==typeof e&&e?Array.isArray(e)?e.map((e=>bt(e))):Object.keys(e).sort().reduce(((t,r)=>(t[r]=bt(e[r]),t)),{}):e}function _t(e){return new Promise((t=>{setTimeout(t,e)}))}function St(e,t,r=!0){var n;return"boolean"==typeof e?e:e&&"boolean"==typeof e[t]&&null!==(n=e[t])&&void 0!==n?n:r}class wt{constructor(e,t,r){this.storage=e,this.crypto=t,this.date=r,this.KEY_ATTR_HASHES="hs",this.hashes=new Map,this.refresh(),this.storage.change(this.KEY_ATTR_HASHES).subscribe((e=>this.refresh(e.value)))}changed(e,t,r){let n=t;"object"==typeof t&&t?n=JSON.stringify(bt(t)):"string"!=typeof t&&(n=JSON.stringify(t),void 0===n&&(n="undefined"));const i=this.date.now(),s=this.crypto.unsafeShortHash(e),o=this.crypto.unsafeShortHash(n),[a,c]=(this.hashes.get(s)||"").split("."),u=parseInt(c||"0",36);return!(a===o&&(!r||u&&!(i-u>r)))&&(this.hashes.set(s,`${o}.${i.toString(36)}`),this.persist(),!0)}refresh(e){let t=e?JSON.parse(e):this.storage.getJSON(this.KEY_ATTR_HASHES);t&&Array.isArray(t.hs)||(t={hs:[]},this.storage.setJSON(this.KEY_ATTR_HASHES,t)),this.hashes=new Map(t.hs)}persist(){const e={hs:Array.from(this.hashes)};this.storage.setJSON(this.KEY_ATTR_HASHES,e)}}class kt{constructor(e,t){this.utmService=e,this.env=t,this.engineList=new RegExp(["google","bing","baidub","yahoo","yandex","ask","duckduckgo","naver","aol","seznam"].join("|"))}getSource(){const e=(this.env.doc.referrer||"").replace(/^https?:\/\//,""),t=this.utmService.getUTMParams();return(null==t?void 0:t.utm_source)?`utm_${t.utm_source}`:e?this.engineList.test(e)?`search_${e}`:`referral_${e}`:"direct"}}class Et{}class Tt{constructor(e){if(this.completed=!1,this.task=new Promise(((e,t)=>{this.resolveTask=e,this.rejectTask=t})),e){const t=setTimeout((()=>{this.reject(new Error(`AsyncTask timeout after ${e}ms!`))}),e);this.waitUntilResolved().then((()=>clearTimeout(t))).catch((()=>clearTimeout(t)))}}resolve(e){this.completed||(this.completed=!0,this.resolveTask(e))}reject(e){this.completed||(this.completed=!0,this.rejectTask(e))}waitUntilResolved(){return this.task}}class Ct{constructor(e,t){this.env=e,this.uuid=t,this.locks=new Map,this.lockManager=e.win.navigator.locks}supported(){var e,t;return"function"==typeof(null===(e=this.lockManager)||void 0===e?void 0:e.request)&&"function"==typeof(null===(t=this.lockManager)||void 0===t?void 0:t.query)&&"function"==typeof this.env.win.AbortController}async locked(e){if(!this.lockManager)throw new Error("Native LockManager not supported!");return(await this.lockManager.query()).held.some((t=>t.name===e))}request(e,t=1e3){if(!this.lockManager)throw new Error("Native LockManager not supported!");const r=new Tt,n=new Tt,i=new AbortController,s={signal:i.signal};let o=!1;return this.lockManager.request(e,s,(()=>{o=!0;const t={name:e,id:this.uuid.generate(),clientId:"",createdDate:0,task:n};return this.locks.set(e,t),r.resolve(t),n.waitUntilResolved()})),_t(t).then((()=>{o||(i.abort(),r.resolve(null))})),r.waitUntilResolved()}async release(e){if(!this.lockManager)throw new Error("Native LockManager not supported!");const t=this.locks.get(e.name);t&&t.id===e.id&&(t.task.resolve(),this.locks.delete(t.name))}}class xt{constructor(e,t,r,n,i){this.storage=e,this.date=t,this.config=r,this.uuid=n,this.id=n.generate(),this.locks=this.syncLocks(),this.storage.change("locks","full","external").subscribe((e=>{this.syncLocks(e.value)})),i.onUnload().subscribe((()=>this.releaseAll()))}async release(e,t=!0){const r=this.locks.get(e.name);r&&r.clientId===this.id&&r.id===e.id&&(this.locks.delete(r.name),t&&this.syncLocks())}async locked(e){return this.locks.has(e)}async request(e,t=100,r=10){const n=this.date.now();for(;;){const i=await this.lock(e),s=this.date.now()-n>t;if(i||s)return i;await _t(r)}}async lock(e){if(this.locks.has(e))return null;{const t={name:e,clientId:this.id,id:this.uuid.generate(),createdDate:this.date.now()};return this.locks.set(e,t),this.syncLocks(),t}}syncLocks(e){if(!this.locks||e){const t=e||this.storage.get("locks"),r=JSON.parse(t||"null"),n=new Map(r||[]),i=this.releaseExpiredLocks(n);this.locks=i,n.size!==i.size&&this.writeLocks(i)}else this.writeLocks(this.locks);return this.locks}writeLocks(e){0===e.size?this.storage.remove("locks"):this.storage.setJSON("locks",Array.from(e))}releaseAll(){for(const[e,t]of this.locks)t.clientId===this.id&&this.release(t,!1);this.syncLocks()}releaseExpiredLocks(e){const t=this.date.now(),r=Array.from(e).filter((([e,r])=>t-r.createdDate<this.config.locksMaxAge));return new Map(r)}}!function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Verbose=4]="Verbose"}(We||(We={}));class It{constructor(e,t){this.storage=e,this.config=t,this.KEY_LOG_LEVEL="log_level"}level(){return"number"!=typeof this.logLevel&&(this.logLevel=+(this.storage.get(this.KEY_LOG_LEVEL)||0)||this.config.logLevel||0),this.logLevel}setLevel(e){this.logLevel=e,this.storage.set(this.KEY_LOG_LEVEL,String(e))}enabled(e){return e<=this.level()}error(e,...t){this.print(e,We.Error,t)}warn(e,...t){this.print(e,We.Warn,t)}info(e,...t){this.print(e,We.Info,t)}verbose(e,...t){this.print(e,We.Verbose,t)}print(e,t,r){if(this.enabled(t))switch(t){case We.Error:console.log(`${e}:`),console.error(...r);break;case We.Warn:console.warn(`${e}: `,...r);break;case We.Info:console.info(`${e}: `,...r);break;case We.Verbose:console.log(`${e}: `,...r)}}}const At=new Set(["plain/text","text/html","text/css","text/xml","text/csv","text/javascript","application/json","application/ld+json","application/xml","application/xhtml+xml","application/atom+xml","application/javascript","application/x-javascript","image/svg+xml"]),Pt=new Set(["font/woff2","font/ttf","image/gif","image/png","image/jpg","image/jpeg","image/webp","image/bmp"]),Nt=new Set([...At.values(),...Pt.values()]);function Ot(e,t){try{return new URL("string"==typeof e?e:e.href,t.win.location.href).href}catch(t){return"string"==typeof e?e:"object"==typeof e&&e.href?e.href:void 0}}function Rt(e){if(e)return e.toLowerCase().split(";").map((e=>e.trim()))[0]}function Lt(e,t){try{if(null==e||""===e)return 0;if("string"==typeof e)return new t.Blob([e]).size;if(e instanceof t.Blob)return e.size;if((e instanceof t.ArrayBuffer||t.ArrayBuffer.isView(e))&&"number"==typeof e.byteLength)return e.byteLength;if(e instanceof t.URLSearchParams)return Lt(e.toString(),t);if("object"==typeof e)return Lt(JSON.stringify(e),t)}catch(e){}}function Mt(e,t,r,n){if((null==t?void 0:t.body)&&(i=t.body,!("ReadableStream"in(s=n.win)&&i instanceof s.ReadableStream))){const r=new Tt;try{const e=Lt(t.body,n.win);r.resolve({size:e,start:-1,end:-1,cancelled:!1})}catch(e){r.reject(e)}return{wrappedRequest:new Request(e,t),bodyStats:r.waitUntilResolved()}}var i,s;if("object"==typeof e&&e.body instanceof ReadableStream){const{wrappedStream:i,complete:s}=function(e,t,r){const n=new Tt,i=new Tt(3e5);let s=-1;const o=new ReadableStream({start(n){s=t.hrt();const o=e.getReader();let a=0;o.read().then((({done:e,value:o})=>{var c;if(e){const e=t.hrt();return i.resolve({start:s,end:e,size:a,cancelled:!1}),void n.close()}try{a+=null!==(c=Lt(o,r))&&void 0!==c?c:0}catch(e){console.error(e)}n.enqueue(o)})).catch((e=>{i.reject(e),n.error(e)}))},cancel(r){e.cancel(r);const n=t.hrt();i.resolve({start:s,end:n,cancelled:!0})}});return{started:n.waitUntilResolved(),complete:i.waitUntilResolved(),wrappedStream:o}}(e.body,r,n.win),o={cache:null==e?void 0:e.cache,credentials:null==e?void 0:e.credentials,headers:null==e?void 0:e.headers,integrity:null==e?void 0:e.integrity,keepalive:null==e?void 0:e.keepalive,method:null==e?void 0:e.method,mode:null==e?void 0:e.mode,redirect:null==e?void 0:e.redirect,referrer:null==e?void 0:e.referrer,referrerPolicy:null==e?void 0:e.referrerPolicy,signal:null==e?void 0:e.signal,...t||{},body:i};return{wrappedRequest:new Request(e,o),bodyStats:s}}return{wrappedRequest:new Request(e,t),bodyStats:Promise.resolve(void 0)}}class Bt{constructor(e,t){this.date=e,this.env=t,this.reportStream=new H,this.patched=!1}requests(){return this.patchFetch(),this.reportStream.asObservable()}supported(){return"ReadableStream"in this.env.win&&"ArrayBuffer"in this.env.win&&"Request"in this.env.win&&"Response"in this.env.win&&"function"==typeof window.fetch}patchFetch(){if(this.patched||!this.supported())return;const e=this.env.win,t=e.fetch.bind(e);this.env.win.fetch=async(e,r)=>this.monitoredFetch(e,r,t),this.patched=!0}async monitoredFetch(e,t,r){var n;const i={url:"",method:"",start:0,fetchEnd:0,end:0,responseStatus:0,initiator:"fetch"};let s,o,a;try{s=Mt(e,t,this.date,this.env),i.url=Ot(s.wrappedRequest.url,this.env)||"",i.method=s.wrappedRequest.method.toUpperCase(),s.bodyStats.then((e=>{i.requestBodySize=null==e?void 0:e.size})),null===(n=s.wrappedRequest.signal)||void 0===n||n.addEventListener("abort",(()=>{i.aborted=!0})),i.start=this.date.hrt(),o=await r(s.wrappedRequest),i.fetchEnd=this.date.hrt();try{i.responseBodySize=o.headers.has("content-length")?+o.headers.get("content-length"):void 0;("basic"===o.type||"cors"===o.type||"default"===o.type)&&i.responseContentType&&!Number.isSafeInteger(i.responseBodySize)&&Nt.has(i.responseContentType)&&(a=o.clone())}catch(e){}return o}finally{i.fetchEnd=o?i.fetchEnd:this.date.hrt(),_t(0).then((()=>this.reportResponse(o,a,i)))}}async reportResponse(e,t,r){var n;if(r){if(e)try{const i=null===(n=e.headers)||void 0===n?void 0:n.get("content-type");if(r.responseContentType=Rt(i),r.redirected=e.redirected,r.responseMode=e.type,r.responseStatus=e.status,!Number.isSafeInteger(r.responseBodySize)&&t)try{const e=await t.blob();r.responseBodySize=e.size}catch(e){}}catch(e){}r.end=this.date.hrt(),this.reportStream.next(r)}}}function Ut(e,t){if(!t||!e)return!1;if(At.has(t))return!0;if(Pt.has(t))try{return e instanceof Blob||e instanceof ArrayBuffer}catch(e){}return!1}class Dt{constructor(e,t){this.date=e,this.env=t}requests(){return this.patchXHR(this.date,this.env)}patchXHR(e,t){if(this.stream)return this.stream;const r=new H;class n extends t.win.XMLHttpRequest{constructor(){super(),this.___pulse={requestHeaders:new Headers};let n=!1;const i=i=>{const s=Rt(this.___pulse.requestHeaders.get("content-type"));let o,a,c;Ut(this.___pulse.requestBody,s)&&(o=Lt(this.___pulse.requestBody,t.win));let u={url:this.___pulse.url,method:this.___pulse.method,start:this.___pulse.start,fetchEnd:this.___pulse.end,end:this.___pulse.end,aborted:!!this.___pulse.aborted,requestBodySize:o,requestContentType:s,responseStatus:this.status,initiator:"xhr"};if(n)r.next(u);else{try{c=Rt(this.getResponseHeader("content-type"))}catch(e){}if(i.lengthComputable&&"number"==typeof i.total)a=i.total;else try{const e=+this.getResponseHeader("content-length");Number.isSafeInteger(e)&&(u.responseBodySize=e)}catch(e){}"number"!=typeof u.responseBodySize&&Ut(this.response,c)&&(a=Lt(this.response,t.win)),u={...u,responseBodySize:a,responseContentType:c,end:e.hrt()},r.next(u)}};this.addEventListener("error",(()=>{n=!0})),this.addEventListener("timeout",(()=>{n=!0,this.___pulse.aborted=!0})),this.addEventListener("loadend",(t=>{this.___pulse.end=e.hrt(),_t(0).then((()=>i(t)))}))}setRequestHeader(e,t){try{this.___pulse.requestHeaders.set(e,t)}catch(e){}super.setRequestHeader(e,t)}open(e,r,n,i,s){super.open(e,r,n,i,s),this.___pulse.method=e,this.___pulse.url=Ot(r,t)||""}send(t){this.___pulse.requestBody,this.___pulse.start=e.hrt(),super.send(t)}abort(){this.___pulse.aborted=!0,super.abort()}}return t.win.XMLHttpRequest=n,this.stream=r.asObservable(),this.stream}}function jt(e,t){const r="string"==typeof t?t:null==t?void 0:t.entryType,n=e.entry_type===r,i=function(e,t){if("string"==typeof t)return!0;if(void 0===t.name)return!0;if(Array.isArray(t.name))return t.name.some((t=>t instanceof RegExp?t.test(e):t===e));return!1}(e.name,t),s="object"!=typeof t||"function"!=typeof t.filter||t.filter(e);return n&&i&&s}class zt{constructor(e,t){this.env=e,this.cssPathService=t}subscribe(e,t=!0){return Ve(...e.filter((e=>this.entrySupported(e))).map((e=>this.getFilterStream(e,t))))}getEntries(e){return Ve(...e.filter((e=>this.entrySupported(e))).map((e=>this.getFilterStream(e,!1,!0))))}getFilterStream(e,t,r){const n=this.env.win;return n.performance.getEntries&&n.performance.getEntriesByType&&n.performance.timeOrigin?r?this.readEntries(e):"function"==typeof n.PerformanceObserver&&n.WeakSet?this.getFilterStreamNative(e,t):this.getFilterStreamLegacy(e,t):we([])}readEntries(e){const t="string"==typeof e?e:e.entryType,r=new WeakSet;return we(this.env.win.performance.getEntriesByType(t)).pipe(Ye((e=>!r.has(e))),(o=h(n=e=>r.add(e))||i||s?{next:n,error:i,complete:s}:n)?j((function(e,t){var r;null===(r=o.subscribe)||void 0===r||r.call(o);var n=!0;e.subscribe(z(t,(function(e){var r;null===(r=o.next)||void 0===r||r.call(o,e),t.next(e)}),(function(){var e;n=!1,null===(e=o.complete)||void 0===e||e.call(o),t.complete()}),(function(e){var r;n=!1,null===(r=o.error)||void 0===r||r.call(o,e),t.error(e)}),(function(){var e,t;n&&(null===(e=o.unsubscribe)||void 0===e||e.call(o)),null===(t=o.finalize)||void 0===t||t.call(o)})))})):M,Ee((e=>this.mapEntry(e))),Ye((t=>jt(t,e))));var n,i,s,o}getFilterStreamNative(e,t){return new U((r=>{const n=new WeakSet,i=new this.env.win.PerformanceObserver((t=>{const i=t.getEntries();for(const t of i){if(n.has(t))continue;n.add(t);const i=this.mapEntry(t);jt(i,e)&&r.next(i)}})),s="string"==typeof e?e:null==e?void 0:e.entryType;return i.observe({type:s,buffered:t}),()=>i.disconnect()}))}getFilterStreamLegacy(e,t){return new U((r=>{const n=this.env.win.performance,i="string"==typeof e?e:null==e?void 0:e.entryType;let s=t?0:n.now();const o=setInterval((()=>{const t=this.env.win.performance.getEntriesByType(i);let n=s;for(const i of t){const t=this.mapEntry(i);n<i.startTime&&(n=i.startTime),i.startTime<s||jt(t,e)&&r.next(t)}s=n}),1e3);return()=>clearInterval(o)}))}mapEntry(e){var t;const r=this.env.win.navigator.connection;let n={time_origin:performance.timeOrigin,details:e.detail,name:e.name,entry_type:e.entryType,type:e.type,protocol:e.nextHopProtocol||void 0,task_duration:e.duration,start_time:e.startTime,end_time:null!==(t=e.responseEnd)&&void 0!==t?t:e.duration?e.startTime+e.duration:void 0,initiator_type:e.initiatorType,worker_start:e.workerStart,redirect_start:e.redirectStart,redirect_end:e.redirectEnd,fetch_start:e.fetchStart,domain_lookup_start:e.domainLookupStart,domain_lookup_end:e.domainLookupEnd,connect_start:e.connectStart,connect_end:e.connectEnd,secure_connection_start:e.secureConnectionStart,request_start:e.requestStart,response_start:e.responseStart,response_end:e.responseEnd,transfer_size:e.transferSize,encoded_body_size:e.encodedBodySize,decoded_body_size:e.decodedBodySize,unload_event_start:e.unloadEventStart,unload_event_end:e.unloadEventEnd,dom_interactive:e.domInteractive,dom_content_loaded_event_start:e.domContentLoadedEventStart,dom_content_loaded_event_end:e.domContentLoadedEventEnd,dom_complete:e.domComplete,load_event_start:e.loadEventStart,load_event_end:e.loadEventEnd,redirect_count:e.redirectCount,processing_start:e.processingStart,processing_end:e.processingEnd,cancelable:e.cancelable,had_recent_input:e.hadRecentInput,last_input_time:e.lastInputTime,cls_value:e.value};return Array.isArray(e.serverTiming)&&e.serverTiming.length&&(n.server_timing=e.serverTiming),Array.isArray(e.workerTiming)&&e.workerTiming.length&&(n.worker_timing=e.workerTiming),!r||"resource"!==n.entry_type&&"navigation"!==n.entry_type||(n={...n,connection_downlink:r.downlink,connection_rtt:r.rtt,connection_type:r.effectiveType,data_saving_mode:r.saveData}),Array.isArray(e.attribution)&&(n.attribution=e.attribution.map((e=>({name:null==e?void 0:e.name,entry_type:null==e?void 0:e.entryType,start_time:null==e?void 0:e.startTime,duration:null==e?void 0:e.duration,container_type:null==e?void 0:e.containerType,container_src:null==e?void 0:e.containerSrc,container_id:null==e?void 0:e.containerId,container_name:null==e?void 0:e.containerName})))),"layout-shift"===n.entry_type&&Array.isArray(e.sources)&&(n.cls_sources=e.sources.map((e=>this.createCLSAttribution(e)))),n}entrySupported(e){var t;const r=(null===(t=this.env.win.PerformanceObserver)||void 0===t?void 0:t.supportedEntryTypes)||[],n="string"==typeof e?e:e.entryType;return r.indexOf(n)>-1}createCLSAttribution(e){if("object"!=typeof e||"object"!=typeof e.node)return null;const t=e.node;return{node:{path:this.cssPathService.cssPath(t)},current_rect:e.currentRect,previous_rect:e.previousRect}}}class qt{constructor(e,t,r,n,i){this.fetchCollector=e,this.xhrCollector=t,this.date=n,this.env=i,this.performanceTimeline=r.subscribe(["resource"]).pipe(at(1e3))}subscribe(e){const t=this.date.hrt(),r=Ve(this.fetchCollector.requests(),this.xhrCollector.requests()).pipe(function(e,t){void 0===t&&(t=Z);var r=Fe(e,t);return et((function(){return r}))}(5),ct((e=>this.findEntry(e)))),n=this.performanceTimeline.pipe(Ye((e=>"fetch"!==e.initiator_type&&"xhr"!==e.initiator_type||e.start_time<=t)),Ee((e=>({entries:[e]}))));return Ve(n,r).pipe(Ee((e=>this.mergeRequestEntry(e))),Ye(Boolean),Ye((t=>!e||e.some((e=>jt(t,e))))))}mergeRequestEntry(e){const t=e.request,r=!!t&&("basic"===t.responseMode||"cors"===t.responseMode||"default"===t.responseMode);let n=this.selectEntry(e);if(n)n.response_entry_matched=!!t;else{if(!t)return null;const e=this.env.win.navigator.connection;n={name:t.url,entry_type:"resource",initiator_type:t.initiator,start_time:t.start,end_time:t.end,task_duration:(t.fetchEnd||t.end)-t.start,time_origin:this.date.hrtOrigin(),response_entry_matched:!1},r&&(n.decoded_body_size=t.responseBodySize,n.transfer_size=t.responseBodySize),e&&(n={...n,connection_downlink:e.downlink,connection_rtt:e.rtt,connection_type:e.effectiveType,data_saving_mode:e.saveData})}return t&&this.enrichWithRequest(n,t,r),n}enrichWithRequest(e,t,r){e.request_method=t.method,e.response_status=t.responseStatus,e.response_mode=t.responseMode,e.request_body_size=t.requestBodySize,e.response_end=e.response_end||t.fetchEnd||t.end,e.end_time=t.end,e.user_duration=t.end-t.start,e.response_content_type=t.responseContentType,e.request_content_type=t.requestContentType,e.redirected=t.redirected,e.aborted=t.aborted,r&&(e.transfer_size=e.transfer_size||t.responseBodySize,e.response_body_size=t.responseBodySize,e.decoded_body_size=t.responseBodySize,e.transfer_size=t.responseBodySize)}selectEntry(e){const[t,r]=e.entries;return t&&r&&this.firstCanBeOptions(e)?r:t}findEntry(e){return this.performanceTimeline.pipe(Ye((t=>this.matchLax(e,t))),Qe(2),(t=Fe(50),j((function(e,r){ve(t).subscribe(z(r,(function(){return r.complete()}),S)),!r.closed&&e.subscribe(r)}))),Xe(),Ee((t=>({entries:t,request:e}))));var t}matchLax(e,t){const r=t.start_time,n=t.task_duration?t.start_time+t.task_duration:t.response_end||0;return r>=e.start-1&&n<=e.end+1&&e.url===t.name}firstCanBeOptions({entries:e,request:t}){const[r,n]=e;if(!r||!n||!t)return!1;const i=r.task_duration?r.start_time+r.task_duration:r.response_end||0,s=n.task_duration?n.start_time+n.task_duration:n.response_end||0;return n.start_time>=r.start_time&&i<s}}class Kt{constructor(e,t){this.timeline=e,this.resource=t}subscribe(e,t){const r=[...e,...t||[]],n=r.some((e=>"resource"===e||"object"==typeof e&&"resource"===e.entryType)),i=Ve(n?this.resource.subscribe(r):we([]),this.timeline.subscribe(r).pipe(Ye((e=>"resource"!==e.entry_type)))),s=i.pipe(Ye((e=>!t||t.every((t=>!jt(e,t))))));return Ve(we(t||[]).pipe(ct((e=>i.pipe(Ye((t=>jt(t,e))),st())))),s).pipe(Ee((e=>this.enrichWithServerAttributes(e))))}enrichWithServerAttributes(e){if(Array.isArray(e.server_timing)){const t=[...e.server_timing],r={};for(const n of e.server_timing){const e=/^pulse\$([^$]+)\$([^$]+)$/.exec(n.name);if(!(null==e?void 0:e.length))continue;const i=(e[1]||"").toLowerCase(),s=(e[2]||"").toLowerCase();r[i]=s,t.splice(t.indexOf(n),1)}e.server_timing=t,e.server_attributes=r}return e}}class Ht{constructor(e,t){this.env=t;const r=this.patchChanges();r.pipe(Ye((e=>!e))).subscribe((()=>{e.postMessage(!0)})),e.messages.pipe(Ee((()=>!0))).subscribe(r)}changes(){return this.patchChanges()}patchChanges(){const e=this.env.doc;let t=Ht.patchedDocuments.get(e);if(t)return t;t=new H,Ht.patchedDocuments.set(e,t);const r=this.env.win.Document.prototype,n=Object.getOwnPropertyDescriptor(r,"cookie");let i=e.cookie;const s={enumerable:!0,configurable:!0,get:()=>e.__native_cookie,set:r=>{e.__native_cookie=r;const n=e.__native_cookie;if(n!==i)try{t.next(!1)}finally{i=n}}};return Object.defineProperty(r,"__native_cookie",n),Object.defineProperty(r,"cookie",s),t}}Ht.patchedDocuments=new Map;class $t{parseCookies(e){const t=[],r=e.split(";");for(const e of r){const r={},n=e.indexOf("=");n>-1?(r.name=e.slice(0,n).trim()||"",r.value=e.slice(n+1).trim()):(r.name="",r.value=e.trim()),r.name&&(r.name=(r.name||"").replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),r.value=(r.value||"").replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),t.push(r))}return t}serializeSetCookie(e){if(!e.name||"string"!=typeof e.name)throw new Error("Invalid cookie name!");const t={...e},r=encodeURIComponent(t.name).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),n=encodeURIComponent(t.value||"").replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),i=this.serializeExpires(t.expires),s=[`${r}=${n}`];if("string"==typeof i&&s.push(`Expires=${i}`),"string"==typeof t.domain&&s.push(`Domain=${t.domain}`),s.push(`Path=${t.path||"/"}`),"string"==typeof e.sameSite){const r=e.sameSite.toUpperCase();"LAX"===r?s.push("SameSite=Lax"):"STRICT"===r?s.push("SameSite=Strict"):"NONE"===r&&(s.push("SameSite=None"),t.secure=!0)}return!0===t.secure&&s.push("Secure"),s.join("; ")}
serializeExpires(e){if(Number.isSafeInteger(e)){const t=new Date(e);if(!isNaN(+t))return t.toUTCString()}}
parseExpires(e){if("string"==typeof e){const t=Date.parse(e);if(Number.isSafeInteger(t))return t}}}class Ft{constructor(e){this.options=e,this.changes=new H}change(e,t="full",r="external"){let n=this.changes.asObservable().pipe(Ye((e=>"all"===r||("external"===r?e.external:!e.external))));if(e)if(t&&"full"!==t){if("start"!==t)throw new Error("Invalid keyMatch value!");n=n.pipe(Ye((t=>t.key.startsWith(e))))}else n=n.pipe(Ye((t=>t.key===e)));return n}getJSON(e){const t=this.get(e);return"string"==typeof t?JSON.parse(t):null}setJSON(e,t){const r=JSON.stringify(t);this.set(e,r)}getStorageKey(e){const t=this.options.storagePrefix;return t?`${t}${e}`:e}revertStorageKey(e){const t=this.options.storagePrefix;return(null==t?void 0:t.length)?e.slice(this.options.storagePrefix.length):e}isStorageKey(e){return!this.options.storagePrefix||e.startsWith(this.options.storagePrefix)}emitChange(e){this.changes.next(e)}}class Vt extends Ft{constructor(e,t,r,n){super(n),this.env=e,this.parser=t,this.changeDetector=r,this.cookies=new Map,this.pull(!1),this.changeDetector.changes().pipe(Ye((e=>e||!n.storagePrefix))).subscribe((()=>this.pull()))}get(e){var t;return null!==(t=this.cookies.get(e))&&void 0!==t?t:null}set(e,t){const r={name:this.getStorageKey(e),value:t};this.cookies.set(e,t);const n=this.parser.serializeSetCookie(r);this.env.doc.cookie=n,this.emitChange({key:e,value:t,external:!1})}keys(){return Array.from(this.cookies.keys())}remove(e){const t={name:this.getStorageKey(e),value:"",expires:0};this.cookies.delete(e);const r=this.parser.serializeSetCookie(t);this.env.doc.cookie=r,this.emitChange({key:e,value:null,external:!1})}clear(){const e=this.keys();for(const t of e)this.remove(t)}all(){return Array.from(this.cookies).reduce(((e,[t,r])=>("string"==typeof r&&(e[t]=r),e)),{})}pull(e=!0){var t;const r=this.cookies,n=this.fetchCookies(),i=new Set([...r.keys(),...n.keys()]);if(this.cookies=n,e)for(const e of i){const i=r.get(e),s=null!==(t=n.get(e))&&void 0!==t?t:null;if(i!==s){const t={key:e,value:s,external:!0};this.emitChange(t)}}}fetchCookies(){const e=this.env.doc,t=this.parser.parseCookies(e.cookie).filter((e=>this.isStorageKey(e.name)));for(const e of t)e.name=this.revertStorageKey(e.name);const r=t.map((e=>[e.name,e.value]));return new Map(r)}}class Yt extends Ft{constructor(e,t,r){super(r),this.storageArea=t,He(e.win,"storage").pipe(Ye((e=>!!e.key&&e.storageArea===t&&this.isStorageKey(e.key))),Ee((e=>({key:this.revertStorageKey(e.key),value:e.newValue,external:!0})))).subscribe((e=>this.emitChange(e)))}get(e){return this.storageArea.getItem(this.getStorageKey(e))}set(e,t){this.storageArea.setItem(this.getStorageKey(e),t),this.emitChange({key:e,value:t,external:!1})}keys(){return Object.keys(this.storageArea).filter((e=>this.isStorageKey(e))).map((e=>this.revertStorageKey(e)))}remove(e){this.storageArea.removeItem(this.getStorageKey(e)),this.emitChange({key:e,value:null,external:!1})}clear(){const e=this.keys();for(const t of e)this.remove(t)}all(){return Object.keys(this.storageArea).filter((e=>this.isStorageKey(e))).reduce(((e,t)=>{const r=this.revertStorageKey(t),n=this.storageArea.getItem(t);return"string"==typeof n&&(e[r]=n),e}),{})}}class Jt extends Yt{constructor(e,t){super(e,e.win.localStorage,t)}}class Wt extends Yt{constructor(e,t){super(e,e.win.sessionStorage,t)}}class Gt extends Ft{constructor(e){super(e),this.db=new Map}get(e){var t;return null!==(t=this.db.get(e))&&void 0!==t?t:null}set(e,t){this.db.set(e,t),this.emitChange({key:e,value:t,external:!1})}keys(){return Array.from(this.db.keys())}remove(e){this.db.delete(e),this.emitChange({key:e,value:null,external:!1})}clear(){this.db=new Map}all(){return Array.from(this.db.entries()).reduce(((e,[t,r])=>(e[t]=r,e)),{})}}class Xt{constructor(e,t,r,n){this.tabStorage=e,this.lockManager=t,this.uuid=r,this.config=n,this.tabIdKey="tab_id",this.enabled=!0,this.navOffset=0,this.enabled=St(this.config.eventEnrichment,"tab_id")}async init(){var e;if(!this.enabled)return;this.tabId=await this.trackTabId();const t=+(null!==(e=this.tabStorage.get("navigation_offset"))&&void 0!==e?e:-1);this.navOffset=t+1,this.tabStorage.set("navigation_offset",this.navOffset.toString())}getTabId(){if(!this.tabId)throw new Error("TabManager is not initialized!");return this.tabId}getNavOffset(){if(!this.tabId)throw new Error("TabManager is not initialized!");return this.navOffset}async trackTabId(){const e=this.tabStorage.get(this.tabIdKey);let t=await this.lockAndUseTabId(e);if(!t){const e=this.uuid.generate();return t=await this.lockAndUseTabId(e),t||console.warn("Failed to lock the tab identifier!"),e}return t}async lockAndUseTabId(e){if(e){const t=`${this.tabIdKey}_${e}`;if(await this.lockManager.request(t))return this.tabStorage.set(this.tabIdKey,e),e;this.tabStorage.clear()}return null}}class Zt{constructor(e,t,r,n){this.utmService=e,this.storage=t,this.hashStore=r,this.env=n}getTrafficSource(){this.storage,this.hashStore;const e=this.utmService.getUTMParams(),t=this.getClickId(),r=this.getReferrer(),n=this.env.landingUrl;return e||t||r?{utmParams:e,clickId:t,referrer:r,landingPageURL:n}:null}getLastTrafficSource(){var e,t;const r=this.storage.getJSON("traffic_source"),n=this.getTrafficSource(),i=null!==(t=null===(e=null==n?void 0:n.referrer)||void 0===e?void 0:e.internal)&&void 0!==t&&t;return this.changed(null==n?void 0:n.clickId,null==r?void 0:r.clickId)||this.changed(null==n?void 0:n.utmParams,null==r?void 0:r.utmParams)||this.changed(null==n?void 0:n.referrer,null==r?void 0:r.referrer)&&!i?(this.storage.setJSON("traffic_source",n),n):r}getClickId(){const{searchParams:e}=new URL(this.env.landingUrl.toLowerCase()),t=e.get("gclid"),r=e.get("gclsrc"),n=e.get("msclkid"),i=e.get("fbclid"),s=e.get("yclid");let o,a;return t?(o=t,a=r?`google.${r}`:"google"):i?(o=i,a="facebook"):n?(o=n,a="microsoft"):s&&(o=s,a="yandex"),o&&a?{value:o,source:a}:void 0}getReferrer(){const e=this.env.doc.referrer||"";if(e)return{url:e,internal:this.isInternalURL(e)}}isInternalURL(e){return new URL(e).host===this.env.win.location.host}changed(e,t){return e&&!yt(e,t)}}class Qt{constructor(e){this.env=e}getUTMParams(){const e=new URL(this.env.landingUrl.toLowerCase()),t=e.searchParams.get("utm_source"),r=e.searchParams.get("utm_medium"),n=e.searchParams.get("utm_campaign"),i=e.searchParams.get("utm_term")||"",s=e.searchParams.get("utm_content")||"";if(t||n)return{utm_source:t||void 0,utm_medium:r||void 0,utm_campaign:n||void 0,utm_term:i||void 0,utm_content:s||void 0}}}var er=function(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};er.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},er.prototype.init_by_array=function(e,t){var r,n,i;for(this.init_seed(19650218),r=1,n=0,i=this.N>t?this.N:t;i;i--){var s=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1664525*((4294901760&s)>>>16)<<16)+1664525*(65535&s))+e[n]+n,this.mt[r]>>>=0,n++,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1),n>=t&&(n=0)}for(i=this.N-1;i;i--){s=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1566083941*((4294901760&s)>>>16)<<16)+1566083941*(65535&s))-r,this.mt[r]>>>=0,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1)}this.mt[0]=2147483648},er.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_seed(5489),r=0;r<this.N-this.M;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^e>>>1^t[1&e];for(;r<this.N-1;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^e>>>1^t[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},er.prototype.random_int31=function(){return this.random_int()>>>1},er.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},er.prototype.random=function(){return this.random_int()*(1/4294967296)},er.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},er.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var tr=er,rr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function nr(e){return"string"==typeof e&&rr.test(e)}for(var ir=[],sr=0;sr<256;++sr)ir.push((sr+256).toString(16).substr(1));class or{constructor(e,t){this.date=e,this.env=t,this.nativePRNG=this.getNativePRNG()}generate(){const e=this.date.now();return`a.${this.nativePRNG?"c":"m"}.${e.toString(36)}.${this.generateV4()}`}generateV4(){const e=this.randomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(ir[e[t+0]]+ir[e[t+1]]+ir[e[t+2]]+ir[e[t+3]]+"-"+ir[e[t+4]]+ir[e[t+5]]+"-"+ir[e[t+6]]+ir[e[t+7]]+"-"+ir[e[t+8]]+ir[e[t+9]]+"-"+ir[e[t+10]]+ir[e[t+11]]+ir[e[t+12]]+ir[e[t+13]]+ir[e[t+14]]+ir[e[t+15]]).toLowerCase();if(!nr(r))throw TypeError("Stringified UUID is invalid");return r}(e)}randomValues(e){if(this.nativePRNG)return this.nativePRNG(e);this.mersenne||(this.mersenne=new tr(this.weakSeed()));let t=e.length;for(;t--;)e[t]=Math.floor(256*this.mersenne.random());return e}weakSeed(){const e=Array(127).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)));return[this.date.now(),...e]}getNativePRNG(){var e,t,r,n;const i=this.env.win;return(null===(t=null===(e=i.crypto)||void 0===e?void 0:e.getRandomValues)||void 0===t?void 0:t.bind(i.crypto))||(null===(n=null===(r=i.msCrypto)||void 0===r?void 0:r.getRandomValues)||void 0===n?void 0:n.bind(i.msCrypto))||void 0}}class ar{}const cr={app:"",mode:"standard",version:"",build:{},logLevel:We.Error,sessionTimeoutMS:18e5,attributeTimeoutMS:6048e5,attributeSyncIntervalMS:864e5,plugins:[],transformPipes:[],enrichmentPipes:[],locksMaxAge:864e5,consentChecks:[{type:"tracking",consent:"OneTrust",mode:"opt-out",report:!0,forceReport:!1}],sessionStorageType:"persistent",hashStoreStorageType:"persistent",attributesStorageType:"persistent",trafficSourceDetectorStorageType:"persistent",tabManagerStorageType:"tab",serverCookies:!0,rumUnsafeRequestBodyMeasure:!0,rumReportOnce:[{entryType:"resource",name:[/t\.picsart\.com/i]}],rumReport:["navigation","paint","largest-contentful-paint","layout-shift","longtask","first-input",{entryType:"resource",name:[/pulse\/pulse.*\.js/i,/settings.picsart.com/i,/api.picsart.com/i]},{entryType:"mark",name:[/^pulse_/i]},{entryType:"measure",name:[/^pulse_/i]}],batchTimeMS:5e3,batchSize:5,serverBaseURL:"https://t.picsart.com/events/v1/web",transportTimeout:6e4,transportRetries:Number.POSITIVE_INFINITY,transportRetryBackoffMS:100,transportRetryBackoffMaxMS:3e4,eventEnrichment:!0,stateEnrichment:!0,attributeHints:!0,storagePrefix:"paa_"};class ur{constructor(){this.providers=new Map,this.store=new Map,this.tasks=new Map,this.register({provide:ur,useValue:this})}register(...e){for(const t of e)this.providers.set(t.provide,t);return this}factory