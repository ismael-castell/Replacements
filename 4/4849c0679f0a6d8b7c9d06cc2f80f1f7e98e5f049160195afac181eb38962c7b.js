/**
 * thumbplayer-h5
 * Update Date: 2022-06-15 18:00:40
 * Author: thumbplayer-h5 team
 * ---
 * Copyright (c) 2022 Tencent
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SuperPlayerExport={})}(this,(function(exports){"use strict";var SET_LEVEL_MODE,PLAY_MODE;Promise.prototype.finally||(Promise.prototype.finally=function(e){var t=this.constructor;return this.then((function(o){return t.resolve(e()).then((function(){return o}))}),(function(o){return t.resolve(e()).then((function(){return t.reject(o)}))}))}),function(e){e.SOFT="soft",e.HARD="hard",e.SMOOTH="smooth"}(SET_LEVEL_MODE||(SET_LEVEL_MODE={})),exports.PLAY_MODE=void 0,PLAY_MODE=exports.PLAY_MODE||(exports.PLAY_MODE={}),PLAY_MODE.VOD="vod",PLAY_MODE.LIVE="live";var CAN_PLAY_ALL=null,VIDEO_CONTAINER_CLASS="txp_videos_container",END_STATE,VIDEO_EVTS,VIDEO_STATE,ERROR_CODE;exports.END_STATE=void 0,END_STATE=exports.END_STATE||(exports.END_STATE={}),END_STATE.NORMAL="normal",END_STATE.INTERRUPT="interrupt",END_STATE.ERROR="error",function(e){e.timeupdate="timeupdate",e.durationchange="durationchange",e.volumechange="volumechange",e.canplay="canplay",e.playing="playing",e.pause="pause",e.waiting="waiting",e.seeking="seeking",e.seeked="seeked",e.loadeddata="loadeddata",e.loadedmetadata="loadedmetadata",e.ended="ended",e.error="error",e.progress="progress",e.ratechange="ratechange",e.resize="resize"}(VIDEO_EVTS||(VIDEO_EVTS={})),exports.VIDEO_STATE=void 0,VIDEO_STATE=exports.VIDEO_STATE||(exports.VIDEO_STATE={}),VIDEO_STATE.IDLE="idle",VIDEO_STATE.LOAD_START="loadStart",VIDEO_STATE.CANPLAY="canplay",VIDEO_STATE.PLAYING="playing",VIDEO_STATE.PAUSE="pause",VIDEO_STATE.SEEKING="seeking",VIDEO_STATE.SEEKED="seeked",VIDEO_STATE.BUFFERING="buffering",VIDEO_STATE.END="end",function(e){e.UNKNOWN_ERR="70011000",e.MEDIA_ERR_ABORTED="70011100",e.MEDIA_ERR_NETWORK="70011101",e.MEDIA_ERR_DECODE="70011102",e.MEDIA_ERR_SRC_NOT_SUPPORTED="70011103",e.ORG_LOAD_TIMEOUT="70011104",e.STATE_STUCK="70011105",e.ORG_PLAY_STUCK_ERR="70011111",e.NULL_URL="70011112",e.MISSING_KERNEL="70011113",e.KERNEL_NOT_SPT="70011114"}(ERROR_CODE||(ERROR_CODE={}));var VIDEO_ELEMENT_ERROR={1:{code:ERROR_CODE.MEDIA_ERR_ABORTED,message:"视频获取被终止"},2:{code:ERROR_CODE.MEDIA_ERR_NETWORK,message:"下载视频发生错误"},3:{code:ERROR_CODE.MEDIA_ERR_DECODE,message:"尝试解码出错"},4:{code:ERROR_CODE.MEDIA_ERR_SRC_NOT_SUPPORTED,message:"浏览器不支持该音视频"}},ERROR_MSG,PLAY_EVENT,VIDEO_NODE_EVENT,MSE_EVENTS,PAUSE_TYPE,PLAYER_LOG_LEVEL,PRELOAD_TYPE,CODEC,VIDEO_ELEMENT_STATE;!function(e){e.UNKNOWN="未知错误",e.XHR_NET="视频获取途中出现问题",e.PRELOAD_VIDEO_TIMEOUT="加载视频超时",e.PLAY_STUCK="视频无法继续播放",e.LOAD_STREAM_FAIL="视频流获取途中出现问题",e.INNER="内部错误",e.NULL_URL="传入的地址为空"}(ERROR_MSG||(ERROR_MSG={})),exports.PLAY_EVENT=void 0,PLAY_EVENT=exports.PLAY_EVENT||(exports.PLAY_EVENT={}),PLAY_EVENT.RESTART="restart",PLAY_EVENT.TIME_UPDATE="timeupdate",PLAY_EVENT.METADATA_CHANGE="metadataChange",PLAY_EVENT.RATE_CHANGE="rateChange",PLAY_EVENT.VOLUME_CHANGE="volumeChange",PLAY_EVENT.DURATION_CHANGE="durationChange",PLAY_EVENT.AUTOPLAY_BLOCKED="autoplayBlocked",PLAY_EVENT.LOAD_PROGRESS="loadProgress",PLAY_EVENT.STATE_CHANGE="stateChange",PLAY_EVENT.FIRST_PLAYING="firstPlaying",PLAY_EVENT.VIDEONODE_PLAY_OVER="videoNodePlayOver",PLAY_EVENT.VIDEONODE_START_PLAY="videoNodeStartPlay",PLAY_EVENT.VIDEONODE_FIRST_PLAYING="videoNodeFirstPlaying",PLAY_EVENT.VIDEONODE_CHANGE="videoNodeChange",PLAY_EVENT.LIST_CHANGE="listChange",PLAY_EVENT.SET_LOADING="setLoading",PLAY_EVENT.PRELOAD_START="preloadStart",PLAY_EVENT.PRELOAD_VIDEONODE_OVER="preloadVideonodeOver",PLAY_EVENT.PRELOAD_VIDEONODE_CLEAR="preloadVideonodeClear",PLAY_EVENT.PRELOAD_VIDEONODE_ERROR="preloadVideonodeError",PLAY_EVENT.VIDEO_BUFFER_CHANGE="videoBufferChange",PLAY_EVENT.SETLEVEL_START="setLevelStart",PLAY_EVENT.SETLEVEL_OVER="setLevelOver",PLAY_EVENT.RESIZE="resize",PLAY_EVENT.STOPED="stoped",PLAY_EVENT.ERROR="error",PLAY_EVENT.RETRY_BACKURL="retryBackUrl",PLAY_EVENT.DECODE_TIME="decodeTime",PLAY_EVENT.ELEMENT_EVTS="elementEvts",PLAY_EVENT.VIDEO_RESIZE="videoResize",function(e){e.TIME_UPDATE="vn_timeupdate",e.METADATA_CHANGE="vn_metadataChange",e.VOLUME_CHANGE="vn_volumeChange",e.DURATION_CHANGE="vn_durationChange",e.PLAY_PROMISE_CATCHED="vn_playPromiseCatched",e.LOAD_PROGRESS="vn_loadProgress",e.RATE_CHANGE="vn_rateChange",e.BUFFER_APPENDED="vn_bufferAppended",e.STATE_CHANGE="vn_stateChange",e.ERROR="vn_error",e.RETRY="vn_retry",e.SET_LOADING="vn_setLoading",e.VIDEO_BUFFER_CHANGE="vn_videoBufferChange",e.SETLEVEL_START="vn_setLevelStart",e.SETLEVEL_OVER="vn_setLevelOver",e.URL_CHANGE="vn_urlChange",e.FIRST_PLAYING="vn_firstPlaying",e.ELEMENT_EVTS="vn_elementEvts",e.PLAY_OVER="vn_playOver",e.VIDEO_RESIZE="vn_videoResize"}(VIDEO_NODE_EVENT||(VIDEO_NODE_EVENT={})),function(e){e.OEPN="open",e.CLOSE="close",e.ERROR="error",e.REINIT="REINIT",e.UPDATE_END="updateend",e.REMOVE_END="removeend"}(MSE_EVENTS||(MSE_EVENTS={})),function(e){e.USER="user",e.INNER="inner",e.SYS="sys"}(PAUSE_TYPE||(PAUSE_TYPE={})),function(e){e[e.NONE=0]="NONE",e[e.CORE=1]="CORE",e[e.KERNEL=2]="KERNEL"}(PLAYER_LOG_LEVEL||(PLAYER_LOG_LEVEL={})),exports.PRELOAD_TYPE=void 0,PRELOAD_TYPE=exports.PRELOAD_TYPE||(exports.PRELOAD_TYPE={}),PRELOAD_TYPE.META_DATA="metadata",PRELOAD_TYPE.AUTO="auto",PRELOAD_TYPE.AUTO_LOAD="autoLoad",function(e){e[e.H264=0]="H264",e[e.H265=1]="H265",e[e.AV1=2]="AV1"}(CODEC||(CODEC={})),function(e){e.FREE="0",e.USED="1"}(VIDEO_ELEMENT_STATE||(VIDEO_ELEMENT_STATE={}));var CDN_PATH_PREFIX="//vm.gtimg.cn/thumbplayer/",CACHE_SIZE_KEY,r$2;function t$1(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))}function e$2(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}function n$2(e,t,o){if(o||2===arguments.length)for(var i,r=0,n=t.length;r<n;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}!function(e){e.DEMUX="demux_cache_size"}(CACHE_SIZE_KEY||(CACHE_SIZE_KEY={})),function(e){e[e.sync=1]="sync",e[e.async=0]="async"}(r$2||(r$2={}));var i$2=function(){function e(){this._hasPriority=!1,this._array=[]}return e.prototype.insert=function(e,t){if(void 0===t&&(t=!1),0!==e.priority&&(this._hasPriority=!0),!this._hasPriority)return t?(this._array.unshift(e),0):(this._array.push(e),this._array.length-1);var o=this._array.findIndex((function(o){return o.priority===e.priority?t:o.priority<e.priority}));return-1===o?(this._array.push(e),this._array.length-1):(this._array.splice(o,0,e),o)},e.prototype.clone=function(){return n$2([],this._array,!0)},e.prototype.getListener=function(e){return this._array[e]},e.prototype.getListeners=function(){return this._array.map((function(e){return e.listener}))},e.prototype.remove=function(e){var t=this._array.findIndex((function(t){return t.listener===e}));-1!==t&&(this._array[t].isRemove=!0,this._array.splice(t,1))},e.prototype.findIdx=function(e){return this._array.findIndex((function(t){return t.listener===e}))},e.prototype.size=function(){return this._array.length},e}(),s$1=function(){function e(e){void 0===e&&(e={}),this._events=Object.create(null),this._cacheEvents=Object.create(null);var t=e.maxListeners,o=void 0===t?10:t,i=e.replayType,r=void 0===i?r$2.sync:i,n=e.isCache,a=void 0!==n&&n;this._isCache=a,this._replayType=r,this._maxListeners=o}return e.prototype.setCacheStatus=function(e){this._isCache=e},e.prototype.setReplayType=function(e){this._replayType=e},e.prototype.getCacheStatus=function(){return this._isCache},e.prototype.clearCache=function(){this._isCache=!1,this._cacheEvents=Object.create(null)},e.prototype.setMaxListeners=function(e){return this._maxListeners=e,this},e.prototype.getMaxListeners=function(){return this._maxListeners},e.prototype.emit=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return this._emit.apply(this,n$2([!1,e],t,!1))},e.prototype.asyncEmit=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return this._emit.apply(this,n$2([!0,e],t,!1))},e.prototype.addListener=function(e,t){return this._addListener(e,{listener:t,priority:0,isOnce:!1})},e.prototype.on=function(e,t,o){return void 0===o&&(o=0),this._addListener(e,{listener:t,priority:o,isOnce:!1})},e.prototype.listeners=function(e){var t=this._events[e];return t?t.getListeners():[]},e.prototype.prependListener=function(e,t){return this._addListener(e,{listener:t,priority:0,isOnce:!1},!0)},e.prototype.once=function(e,t,o){return void 0===o&&(o=0),this._addListener(e,{listener:t,priority:o,isOnce:!0})},e.prototype.removeListener=function(e,t){var o=this._events[e];return o?(o.remove(t),this):this},e.prototype.off=function(e,t){return this.removeListener(e,t)},e.prototype.removeAllListeners=function(e){return void 0===e?(this._events=Object.create(null),this):(this._events[e]&&delete this._events[e],this)},e.prototype.listenerCount=function(e){var t;return(null===(t=this._events[e])||void 0===t?void 0:t.size())||0},e.prototype.eventNames=function(){return Object.getOwnPropertyNames(this._events)},e.prototype._emit=function(t,o){var i=this;void 0===t&&(t=!1);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=[{type:o,target:this,data:1===r.length?r[0]:r}],s=this._events[o],l={stopIndex:-1,onceCount:0,emitData:a};if(this._addCacheEvent(o,l,t),!s)return!!t&&Promise.resolve(!1);var p=Promise.resolve();return s.clone().some((function(o,r){return(o.isOnce||o.isRemove)&&(l.onceCount+=1),!o.isRemove&&(t?(p=p.then((function(){return t$1(i,void 0,void 0,(function(){return e$2(this,(function(t){switch(t.label){case 0:return l.stopIndex>=0||o.isRemove?[2]:(o.isOnce&&s.remove(o.listener),[4,o.listener.apply(this,a)]);case 1:return t.sent()===e.STOP_IMMEDIATE_PROPAGATION&&(l.stopIndex=Math.max(r-l.onceCount,0)),[2]}}))}))})),!1):(o.isOnce&&s.remove(o.listener),o.listener.apply(i,a)===e.STOP_IMMEDIATE_PROPAGATION&&(l.stopIndex=Math.max(r-l.onceCount,0),!0)))})),!t||p.then((function(){return!0}))},e.prototype._addCacheEvent=function(e,t,o){if(this._isCache){var i=o?Promise.resolve(t):t;this._cacheEvents[e]?this._cacheEvents[e].push(i):this._cacheEvents[e]=[i]}},e.prototype._replayCacheEvent=function(t,o,i){var r=this,n=this._cacheEvents[t];if(this._isCache&&n){var a=o.isOnce?1:0;n.some((function(s,l){return s instanceof Promise?(n[l]=s.then((function(n){return t$1(r,void 0,void 0,(function(){var r;return e$2(this,(function(s){switch(s.label){case 0:return n.stopIndex>=0&&i>n.stopIndex?[2,n]:[4,o.listener.apply(this,n.emitData)];case 1:return r=s.sent(),o.isOnce&&this.off(t,o.listener),r===e.STOP_IMMEDIATE_PROPAGATION?n.stopIndex=Math.max(i-a,0):n.stopIndex>=0&&i<=n.stopIndex&&(n.stopIndex=n.stopIndex-a+1),[2,n]}}))}))})),o.isOnce):(s.stopIndex>=0&&i>s.stopIndex||(o.isOnce&&r.off(t,o.listener),o.listener.apply(r,s.emitData)===e.STOP_IMMEDIATE_PROPAGATION?s.stopIndex=Math.max(i-a,0):s.stopIndex>=0&&i<=s.stopIndex&&(s.stopIndex=s.stopIndex-a+1)),o.isOnce)}))}},e.prototype._addListener=function(e,t,o){var i=this;void 0===o&&(o=!1),this._events[e]||(this._events[e]=new i$2);var r=this._events[e].insert(t,o);return this._maxListeners>0&&this._events[e].size()===this._maxListeners&&console.warn("Possible EventEmitter memory leak detected. ".concat(this._events[e].size()," ").concat(String(e)," listeners ")+"added. Use emitter.setMaxListeners() to increase limit"),this._replayType===r$2.async?setTimeout((function(){var o=i._events[e].findIdx(t.listener);-1!==o&&i._replayCacheEvent(e,t,o)})):this._replayCacheEvent(e,t,r),this},e.STOP_IMMEDIATE_PROPAGATION="EventEmitter.STOP_IMMEDIATE_PROPAGATION",e}(),e$1=function(){return(e$1=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function t(e){if("undefined"!=typeof Image){var t=new Image(1,1),o=e$1({attaid:"0f400053130",token:"6552374442",comps:"@tencent/ovb-utils",version:"1.1.4",ua:navigator.userAgent,url:location.href,_dc:Math.random()},e),i=Object.keys(o).map((function(e){return e+"="+encodeURIComponent(o[e])})).join("&");t.src="https://h.trace.qq.com/kv?"+i}}var n$1=function(){function e(){}return e.setDefault=function(t){e.defaultOptions=e$1(e$1({},e.defaultOptions),t)},e.getCookie=function(t){var o=void 0,i=document.cookie?document.cookie.split("; "):[],r={};return i.some((function(i){var n=i.split("="),a=n[0],s=n.slice(1),l=e.decode(a),p=e.parseValue(s.join("="));return l===t?(o=p,!0):(r[l]=p,!1)})),void 0===t?r:o},e.setCookie=function(t,o,i){return void 0===i&&(i={}),e.set(t,o,i)},e.clearCookie=function(t,o,i){void 0===o&&(o=""),void 0===i&&(i=""),e.setCookie(t,"",{domain:o,path:i,expires:-1})},e.clearAllCookies=function(t,o){void 0===t&&(t=""),void 0===o&&(o="");var i=document.cookie?document.cookie.split("; "):[],r={domain:t,path:o,expires:-1};i.forEach((function(t){var o=t.split("=")[0];e.set(o,"",r,!0)}))},e.set=function(t,o,i,r){void 0===r&&(r=!1);var n=e$1(e$1({},e.defaultOptions),i),a=n.domain,s=n.path,l=n.secure,p=n.expires,c=n.sameSite,d=new Date(Date.now()+24*p*60*60*1e3),u=[(r?t:e.encode(t))+"="+e.stringifyValue(o),"; expires="+d.toUTCString(),s?"; path="+s:"",a?"; domain="+a:"",c?"; SameSite="+c:"",l?"; Secure":""].join("");return document.cookie=u,u},e.encode=function(t){return e.raw?t:encodeURIComponent(t)},e.decode=function(t){return e.raw?t:decodeURIComponent(t)},e.stringifyValue=function(t){return e.encode(e.json?JSON.stringify(t):String(t))},e.parseValue=function(t){if(e.raw)return t;var o=t;0===o.indexOf('"')&&(o=o.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return o=decodeURIComponent(o.replace(/\+/g," ")),e.json?JSON.parse(o):o}catch(t){}},e.raw=!1,e.json=!1,e.defaultOptions={domain:"",path:"/",expires:365,secure:!0,sameSite:""},e}(),i$1=function(e,t){var o=""+e;return!o||o.length>=t?o:""+Array(t+1-o.length).join("0")+e},r$1=/\[([^\]]+)]|(Y|y){1,4}|M{1,4}|D{1,2}|d{1,2}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,a$1;function o$2(e,t){void 0===t&&(t="yyyy-MM-DD HH:mm:ss");var o=new Date(e);if(isNaN(o.getTime()))return o.toString();var i=t,r=""+o.getFullYear(),n=r.slice(-2),a=o.getHours(),s=""+(a%12||12),l=""+(o.getMonth()+1),p=""+o.getDate(),c=""+o.getDay(),d=""+o.getMinutes(),u=""+o.getSeconds(),A=""+o.getMilliseconds(),_=15*Math.round(o.getTimezoneOffset()/15),g=Math.abs(_),E=i$1(Math.floor(g/60),2),f=i$1(g%60,2),h=_<=0?"+":"-",v=""+h+E+":"+f,y=""+h+E+f,m={YY:n,YYYY:r,yy:n,yyyy:r,M:l,MM:i$1(l,2),D:p,DD:i$1(p,2),d:c,dd:i$1(p,2),H:""+a,HH:i$1(a,2),h:i$1(s,1),hh:i$1(s,2),a:a<12?"am":"pm",A:a<12?"AM":"PM",m:d,mm:i$1(d,2),s:u,ss:i$1(u,2),SSS:i$1(A,3),Z:v,ZZ:y};return i.replace(r$1,(function(e,t){return t||m[e]||e}))}function g$1(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function m$2(e){var t=e.split("#"),o=t[0],i=t[1],r=void 0===i?"":i,n=o.split("?"),a=n[0],s=n[1],l=void 0===s?"":s,p=g$1(r),c=Object.create(null);return l.split("&").forEach((function(e){var t=e.split("="),o=t[0],i=t[1],r=void 0===i?"":i,n=g$1(o),a=g$1(r);null===n||null===a||""===n&&""===a||c[n]||(c[n]=a)})),{url:a,query:c,hash:p}}function x$1(e,t){var o;if(!t||!document.querySelectorAll("style[data-tag="+t+"]").length){var i=document.createElement("style");i.textContent=e.trim(),t&&(i.dataset.tag=t),null===(o=document.getElementsByTagName("head")[0])||void 0===o||o.appendChild(i)}}function b(e,t){return new Promise((function(o,i){if(t&&document.querySelectorAll("script[data-tag="+t+"]").length)return o();var r=document.createElement("script"),n=e$1({type:"text/javascript",charset:"utf-8"},e);Object.keys(n).forEach((function(e){return M(r,e,n[e])})),t&&(r.dataset.tag=t),r.onload=function(){return o()},r.onreadystatechange=function(){var e=r.readyState;["complete","loaded"].includes(e)&&(r.onreadystatechange=null,o())},r.onerror=i,document.body.appendChild(r)}))}function M(e,t,o){if(e)return void 0===o?e.getAttribute(t):e.setAttribute(t,o)}function q(e,t){return!!(null==e?void 0:e.className)&&-1!==e.getAttribute("class").split(" ").indexOf(t)}function _(e,t){if(e&&!q(e,t)){var o=(e.className+" "+t).trim();e.setAttribute("class",o)}}function E(e,t){if(e){var o=e.className.split(" "),i=o.indexOf(t);-1!==i&&(o.splice(i,1),e.className=o.join(" "))}}function k(e,t,o){if(e&&t)if("string"!=typeof t||void 0===o){if("string"==typeof t&&void 0===o)return(e.currentStyle?e.currentStyle:getComputedStyle(e,null))[t];"object"==typeof t&&Object.keys(t).forEach((function(o){return k(e,o,t[o])}))}else{var i=/width|height|left|right|top|bottom|padding|margin/i.test(t)&&"number"==typeof o;e.style[t]=i?o+"px":o}}function O(e){k(e,{display:"none"})}function j(e,t){void 0===t&&(t="block"),k(e,{display:t})}function C(e,t){if(e)return void 0===t?e.innerText:void(e.innerText=t)}function A(e,t){if(e)return void 0===t?e.innerHTML:void(e.innerHTML=t)}!function(e){e[e.equal=0]="equal",e[e.low=-1]="low",e[e.high=1]="high"}(a$1||(a$1={}));var P=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z-]+(?:\.[\da-z-]+)*)?(?:\+[\da-z-]+(?:\.[\da-z-]+)*)?)?)?$/i;function N(e){var t,o=e.replace(/^v/,"").replace(/\+.*$/,""),i=("-",-1===(t=o).indexOf("-")?t.length:t.indexOf("-")),r=o.substring(0,i).split(".");return r.push(o.substring(i+1)),r}function D(e){return isNaN(Number(e))?e:Number(e)}function I(e){if("string"!=typeof e)throw new TypeError("Invalid argument expected string");if(!P.test(e))throw new Error("Invalid argument not valid semver ('"+e+"' received)")}function T(e,t){[e,t].forEach(I);for(var o=N(e),i=N(t),r=0;r<Math.max(o.length-1,i.length-1);r++){var n=parseInt(o[r]||"0",10),a=parseInt(i[r]||"0",10);if(n>a)return a$1.high;if(a>n)return a$1.low}var s=o[o.length-1],l=i[i.length-1];if(s&&l){var p=s.split(".").map(D),c=l.split(".").map(D);for(r=0;r<Math.max(p.length,c.length);r++){if(void 0===p[r]||"string"==typeof c[r]&&"number"==typeof p[r])return-1;if(void 0===c[r]||"string"==typeof p[r]&&"number"==typeof c[r])return 1;if(p[r]>c[r])return a$1.high;if(c[r]>p[r])return a$1.low}}else if(s||l)return s?a$1.low:a$1.high;return a$1.equal}var B=/</g,H=/>/g,R=/"/g,Q=/'/g,U=/&/g;function V(e){return e?(""+e).replace(U,"&amp;").replace(B,"&lt;").replace(H,"&gt;").replace(R,"&quot;").replace(Q,"&#39;"):""}"undefined"!=typeof document&&"undefined"!=typeof window&&("complete"===document.readyState?t({func:"init",result:1}):window.addEventListener("load",(function(){return t({func:"init",result:1})})));var comTool={isObject:function(e){return"object"==typeof e&&e.constructor===Object},createGUID:function(e){void 0===e&&(e=32);for(var t=e||32,o="",i=1;i<=t;i++){o+=Math.floor(16*Math.random()).toString(16)}return o},xss:V,removeDiscontinuityTimeRangesFromPlayTime:function(e,t){var o=comTool.findDiscontinuityTimeRangeAtPlaytime(e,t);if(o)return o.start;var i=e;return t.forEach((function(t){t.end<e&&(i-=t.end-t.start)})),i},findDiscontinuityTimeRangeAtPlaytime:function(e,t){return comTool.mergeTimeRanges(t).find((function(t){return e>=t.start&&e<=t.end}))},mergeTimeRanges:function(e){var t=-1,o=-1,i=[];return e.forEach((function(e){var r=e.start,n=e.end;t<0&&(t=r),r!==o&&o>=0&&(i.push({start:t,end:o}),t=r),o=n})),t>=0&&o>=0&&i.push({start:t,end:o}),i},compareVersion:T,formatPlayTime:function(e){var t=e;if("string"==typeof t&&(t=parseInt(t,10)),"number"!=typeof t||Number.isNaN(t))return"00:00";var o=function(e){return e<10?"0".concat(e):e},i=Math.floor(t/3600),r=Math.floor((t-3600*i)/60),n=Math.floor(t-3600*i-60*r);return 0===i?[o(r),o(n)].join(":"):[i,o(r),o(n)].join(":")},dateFormat:function(e,t){return void 0===t&&(t=Date.now()),o$2(t,e||"yyyy-MM-dd hh:mm:ss")},base64ToArrayBuffer:function(e){for(var t=window.atob(e),o=t.length,i=new Uint8Array(o),r=0;r<o;r++)i[r]=t.charCodeAt(r);return i},setTimeoutByRAF:function(e,t){var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=+new Date;!function r(){+new Date-i>t?e():o(r)}()}};function uaMatch(e){var t,o,i;e=(e=e||navigator.userAgent).toLowerCase(),this.browser={},this.os={},this.mobile=!1,this.spider=!1,e.indexOf("mobile")>-1&&(this.mobile=!0);/(googlebot|bingbot|yandex|twitterbot|facebookexternalhit|rogerbot|linkedinbot|embedly|quora link preview|showyoubot|outbrain|pinterest\/0\.|pinterestbot|slackbot|vkShare|W3C_Validator|whatsapp|petalbot|applebot|mpcrawler|spider)/i.test(e)&&(this.spider=!0);for(var r,n,a={android_1:/android[\s\/]([\d\.]+)/i,android_2:/android/i,android_3:/MIDP-/i,ipod_1:/iPod\stouch;\sCPU\siPhone\sos\s([\d_]+)/i,ipod_100:/iPod.*os\s?([\d_\.]+)/i,iphone:/iPhone;\sCPU\siPhone\sos\s([\d_]+)/i,iphone_100:/iPhone.*os\s?([\d_\.]+)/i,ipad_1:/ipad;\scpu\sos\s([\d_]+)/i,ipad_2:/ipad([\d]+)?/i,windows:/windows\snt\s([\d\.]+)/i,mac:/Macintosh.*mac\sos\sx\s([\d_\.]+)/i,linux:/Linux/i},s=Object.keys(a),l=0,p=s.length;l<p;l++){var c=s[l];if(r=a[c].exec(e)){n=c.replace(/_\d+/,""),this.os[n]=!0,this.os.osName=n,r[1]&&(this.os.version=r[1].replace(/_/g,"."));break}}(this.os.iphone||this.os.ipad||this.os.ipod)&&(this.os.ios=!0);var d,u,A={wechat:/MicroMessenger\/([\d\.]+)/i,ipadqq:/IPadQQ\/([\d\.]+)/i,mqq:/qq\/([\d\.]+)/i,qzone:/QZONEJSSDK\/([\d\.]+)/i,mqqbrowser:/mqqbrowser\/([\d\.]+)/i,qqbrowser:/[^m]QQBrowser\/([\d\.]+)/i,x5:/tbs\/(\d+)/i,uc:/UCBrowser\/([\d\.]+)/i,safari_1:/Version\/(([\d\.]+))\sSafari\/[\d\.]+/i,safari_2:/Safari\/([\d\.]+)/i,chrome_1:/CriOS\/([\d\.]+)/i,chrome_2:/Chrome\/([\d\.]+)/i,firefox:/Firefox\/([\d\.]+)/i,ie_1:/MSIE\s([\d\.]+)/i,ie_2:/(trident\/\d\.\d)/i,ie_3:/(Edge)\/\d+\.\d+/i,weibo:/weibo__([\d\.]+)/i,qqnews:/qqnews\/([\d\.]+)/i,qqlive_1:/QQLiveBrowser\/([\d\.]+)/i,qqlive_2:/QQLiveHDBrowser\/([\d\.]+)/i,kuaibao:/qnreading\/([\d\.]+)/i,liebao:/LieBaoFast\/([\d\.]+)/i,douban:/com\.douban\.frodo\/([\d\.]+)/i,miuibrowser:/MiuiBrowser/i,baidu:/baiduboxapp/i,browser360:/360browser/i,oppobrowser:/OppoBrowser/i,qqdownloader:/qqdownloader\/([\d\.]+)/i},_=Object.keys(A),g=0;for(p=_.length;g<p;g++){var E=_[g];if(d=A[E].exec(e)){if(u=E.replace(/_\d+/,""),this.browser[u])return this;this.browser[u]={version:d[1]},this.browser.browserName=u,this.browser.version=d[1]}}return this.os.android&&this.browser.safari&&(this.browser.safari=null),this.browser.chrome&&this.browser.safari&&(this.browser.safari=null),(null===(i=null===(o=null===(t=this.browser)||void 0===t?void 0:t.ie)||void 0===o?void 0:o.version)||void 0===i?void 0:i.indexOf("trident"))>-1&&(this.browser.ie.version.indexOf("6.0")>-1?this.browser.ie.version="10":this.browser.ie.version.indexOf("5.0")>-1?this.browser.ie.version="9":this.browser.ie.version.indexOf("4.0")>-1?this.browser.ie.version="8":this.browser.ie.version="11"),this}var uaTool=uaMatch.call({},navigator.userAgent),jsonTool={safelyStringify:function(e){try{return JSON.stringify(e)}catch(e){return"{}"}}},__assign$a=window&&window.__assign||function(){return __assign$a=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$a.apply(this,arguments)},__spreadArray$3=window&&window.__spreadArray||function(e,t,o){if(o||2===arguments.length)for(var i,r=0,n=t.length;r<n;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},LogCacheLimit=4e3,noop=function(){},dummyConsole={trace:noop,debug:noop,info:noop,log:noop,warn:noop,error:noop},PatchedConsole=Object.assign({},dummyConsole),LogMode;function patchConsole(e){(e||Object.keys(dummyConsole)).forEach((function(e){var t;PatchedConsole[e]=(null===(t=self.console)||void 0===t?void 0:t[e])||noop}))}function enableConsoleOutput(e){patchConsole(e);try{PatchedConsole.log()}catch(e){PatchedConsole=dummyConsole}}function logtool(e){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}}!function(e){e[e.console=1]="console",e[e.cache=2]="cache"}(LogMode||(LogMode={}));var Logger=function(){function e(t,o,i){if(this.playerId=t,this.scopeName=o,!this.playerId)throw new Error("Missing logger id");e.cache[t]||(e.cache[t]=[]),this.logModeConfig=__assign$a({trace:LogMode.console,debug:LogMode.console,info:LogMode.console,log:LogMode.cache|LogMode.console,warn:LogMode.cache|LogMode.console,error:LogMode.cache|LogMode.console},i)}return e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.callApi.apply(this,__spreadArray$3(["trace"],e,!1))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.callApi.apply(this,__spreadArray$3(["debug"],e,!1))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.callApi.apply(this,__spreadArray$3(["info"],e,!1))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.callApi.apply(this,__spreadArray$3(["log"],e,!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.callApi.apply(this,__spreadArray$3(["warn"],e,!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.callApi.apply(this,__spreadArray$3(["error"],e,!1))},e.prototype.callApi=function(t){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var r=this,n=r.playerId,a=r.scopeName,s="[".concat(n.slice(-8),"][").concat(getLogTime(),"]").concat(a?"[".concat(a,"]"):"");if(this.logModeConfig[t]&LogMode.cache){var l="[".concat(t,"]").concat(s," ").concat(o.join(","));l.length>=LogCacheLimit&&(PatchedConsole.warn("Logger cache limit exceeded: ".concat(l.length)),l="".concat(l.slice(0,LogCacheLimit),"...")),e.cache[n].push(l)}this.logModeConfig[t]&LogMode.console&&PatchedConsole[t].apply(PatchedConsole,__spreadArray$3([s],o,!1))},e.level=0,e.cache={},e}(),logMethodCallDecoratorCreator=function(e){void 0===e&&(e="");return function(t,o,i){var r=i.value;i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this._logger||this.logger;return"function"==typeof(null==n?void 0:n.log)&&n.log("@".concat(e,".").concat(o,"()"),jsonTool.safelyStringify(t)),r.apply(this,t)}}};function dumpLog(e){var t=document.createElement("a"),o=e.join("\n\n");t.setAttribute("href","data:text/plain;charset=utf-8,".concat(encodeURIComponent(o))),t.setAttribute("download","tp-log-".concat(Date.now(),".txt")),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function getLogTime(){var e=new Date;return"".concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds())+".".concat("0000".concat(e.getMilliseconds()).slice(-3))}var cookieTool={set:function(e,t,o,i,r){var n={domain:o,path:i};return r&&(n.expires=(new Date).getTime()+3600*r*1e3),n$1.setCookie(e,t,n),!0},get:function(e){return n$1.getCookie(e)||""},del:n$1.clearCookie},lsTool={getData:function(e){var t="";try{window.localStorage&&(t=window.localStorage[e])}catch(e){window.console.log(e)}return t},setData:function(e,t){if("undefined"!==e&&void 0!==e)try{window.localStorage&&(window.localStorage[e]=t)}catch(e){window.console.log(e)}},delData:function(e){try{window.localStorage&&window.localStorage.removeItem(e)}catch(e){window.console.log(e)}}},urlTool={object2string:function(e,t){return void 0===t&&(t="&"),this.convertUrlParam(e,t,!1)},convertUrlParam:function(e,t,o){if(void 0===t&&(t="&"),void 0===o&&(o=!0),!e)return"";var i=Object.keys(e);if(i.length<=0)return"";var r=[];return i.forEach((function(t){var i="";i=o?"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t])):"".concat(t,"=").concat(e[t]),r.push(i)})),r.join(t)},getRootDomain:function(){var e=window.location.hostname||window.location.host,t=window.location.host.split(".");return t.length>1&&(e=t.slice(t.length-2).join(".")),e},getTopFrameUrl:function(){var e="";if(window.top!==window)try{e=window.top.location.href}catch(t){e=document.referrer}else e=window.location.href;return e},getDomainOfURL:function(e){if(null==e||""===e)return"";try{return new URL(e).hostname}catch(e){return""}},getUrlParamByKey:function(e,t){return m$2(e||location.href).query[t]||""},getUrlParams:function(e){return m$2(e||location.href).query},updateUrlParam:function(e,t,o){var i=e,r=this.getUrlParamByKey(i,t),n="".concat(t,"=").concat(o);return i=r?i.replace("".concat(t,"=").concat(r),n):i+(-1!==i.indexOf("?")?"&":"?")+n},getFileName:function(e){if(!e)return null;var t=e,o=t.indexOf("?");o>0&&(t=t.slice(0,o));var i=t.lastIndexOf("/");i>0&&(t=t.slice(i+1,t.length));var r=t.lastIndexOf("#");return r>0&&(t=t.slice(0,r)),t},getFileExtension:function(e){if(!e)return null;var t=urlTool.getFileName(e);if(t){var o=t.split(".");if(o&&o.length>1)return o[o.length-1]}return null}},__extends$b=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),SimpleDefer=function(){var e=this;this.promise=new Promise((function(t,o){e.resolve=t,e.reject=o}))},TimeoutDefer=function(e){function t(t){var o=e.call(this)||this;return t.timeoutMS>0&&setTimeout((function(){return o.reject()}),t.timeoutMS),o}return __extends$b(t,e),t}(SimpleDefer),__assign$9=window&&window.__assign||function(){return __assign$9=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$9.apply(this,arguments)},domTool={insertStyle:x$1,loadScript:function(e,t,o,i){var r=new TimeoutDefer({timeoutMS:o});return b(__assign$9(__assign$9({},i),{src:e}),t).then(r.resolve).catch(r.reject),r.promise},attr:M,removeAttr:function(e,t){e&&t&&("src"===t?delete e.src:e.removeAttribute(t))},css:k,append:function(e,t){e&&e.appendChild(t)},prepend:function(e,t){e.children[0]?e.insertBefore(t,e.children[0]):e.appendChild(t)},addClass:_,removeClass:E,hasClass:q,hide:O,show:j,text:C,html:A,creatDom:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},getDomSize:function(e){if(!e)return{width:0,height:0};var t=e.currentStyle?e.currentStyle:window.getComputedStyle(e,null);return{width:parseFloat(t.width),height:parseFloat(t.height)}},createVideoDom:function(e){var t,o;void 0===e&&(e={});var i={playsinline:{playsinline:"isiPhoneShowPlaysinline","webkit-playsinline":"isiPhoneShowPlaysinline"},airplay:{airplay:"allow","x-webkit-airplay":"allow"},crossorigin:{crossOrigin:"anonymous"},"h5-page":{"x5-video-player-type":"h5-page"}},r=__assign$9({playsinline:!0,"h5-page":!0},e),n=Object.keys(r).reduce((function(e,t){return i[t]&&"boolean"==typeof r[t]?e=__assign$9(__assign$9({},e),r[t]?i[t]:{}):e[t]=r[t],e}),{}),a=document.createElement("video");return Object.keys(n).forEach((function(e){a.setAttribute(e,n[e])})),k(a,{position:"absolute",width:null!==(t=null==e?void 0:e.width)&&void 0!==t?t:"100%",height:null!==(o=null==e?void 0:e.height)&&void 0!==o?o:"100%",top:0,left:0}),a},getElementFromConfig:function(e){return"string"==typeof e?document.querySelector(e):e}},e=function(){return(e=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o$1;function v(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function g(e,t){var o=[null,void 0,"",NaN].includes(e);if(t.isSkipEmpty&&o)return null;var i=!t.isSkipEmpty&&o?"":e;try{return t.encode?encodeURIComponent(i):i}catch(e){return null}}function h$1(e){var t=e.split("#"),o=t[0],i=t[1],r=void 0===i?"":i,n=o.split("?"),a=n[0],s=n[1],l=void 0===s?"":s,p=v(r),c=Object.create(null);return l.split("&").forEach((function(e){var t=e.split("="),o=t[0],i=t[1],r=void 0===i?"":i,n=v(o),a=v(r);null===n||null===a||""===n&&""===a||c[n]||(c[n]=a)})),{url:a,query:c,hash:p}}function m$1(t,o){void 0===o&&(o={encode:!0,isSkipEmpty:!1});var i=t.url,r=t.query,n=void 0===r?{}:r,a=t.hash,s=i.split("#"),l=s[0],p=s[1],c=void 0===p?"":p,d=l.split("?")[0],u=[],A=g(a||c,o),_=e(e({},h$1(i).query),n);return Object.keys(_).forEach((function(e){var t=g(e,o),i=g(_[e],o);null!==t&&null!==i&&u.push(t+"="+i)})),d+(u.length?"?"+u.join("&"):"")+(A?"#"+A:"")}function x(t,o){return new Promise((function(i,r){if(o&&document.querySelectorAll("script[data-tag="+o+"]").length)return i();var n=document.createElement("script"),a=e({type:"text/javascript",charset:"utf-8"},t);Object.keys(a).forEach((function(e){return S(n,e,a[e])})),o&&(n.dataset.tag=o),n.onload=function(){return i()},n.onreadystatechange=function(){var e=n.readyState;["complete","loaded"].includes(e)&&(n.onreadystatechange=null,i())},n.onerror=r,document.body.appendChild(n)}))}function S(e,t,o){if(e)return void 0===o?e.getAttribute(t):e.setAttribute(t,o)}!function(e){e[e.equal=0]="equal",e[e.low=-1]="low",e[e.high=1]="high"}(o$1||(o$1={}));var r=function(){return(r=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function n(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))}function o(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}var i=function(){function e(){this.interceptors=[]}return e.prototype.use=function(e,t){return this.interceptors.push({resolved:e,rejected:t}),this.interceptors.length-1},e.prototype.traverse=function(e,t){void 0===t&&(t=!1);var o=Promise.resolve(e);return(t?Array.prototype.reduceRight:Array.prototype.reduce).call(this.interceptors,(function(e,t){if(t){var i=t.resolved,r=t.rejected;o=o.then(i,r)}return e}),""),o},e.prototype.eject=function(e){this.interceptors[e]&&(this.interceptors[e]=null)},e}(),c={defaults:{timeout:0,method:"GET",mode:"cors",redirect:"follow",credentials:"same-origin"},headers:{common:{Accept:"application/json, text/plain, */*"},POST:{"Content-Type":"application/x-www-form-urlencoded"},PUT:{"Content-Type":"application/x-www-form-urlencoded"},PATCH:{"Content-Type":"application/x-www-form-urlencoded"}},baseURL:"",polyfillUrl:"https://vm.gtimg.cn/comps/script/fetch.min.js",interceptors:{request:new i,response:new i}},a=/^([a-z][a-z\d+\-.]*:)?\/\//i,u=Object.prototype.toString;function s(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(o){switch(o.label){case 0:if(window.fetch)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,x({src:e})];case 2:return o.sent(),[3,4];case 3:throw t=o.sent(),function(e){if("undefined"!=typeof Image){var t=new Image(1,1),o=r({attaid:"0f400053130",token:"6552374442",comps:"@tencent/ovb-request",version:"1.1.19",ua:navigator.userAgent,url:location.href,_dc:Math.random()},e),i=Object.keys(o).map((function(e){return e+"="+encodeURIComponent(o[e])})).join("&");t.src="https://h.trace.qq.com/kv?"+i}}({func:"loadPolyfill",result:0,params:e,error_msg:t.message}),new Error("加载 polyfill "+e+" 失败: "+t.message);case 4:return[2]}}))}))}function l(e){return["Accept","Content-Type"].forEach((function(t){return o=t,void((i=e.headers)&&Object.keys(i).forEach((function(e){e!==o&&e.toUpperCase()===o.toUpperCase()&&(i[o]=i[e],delete i[e])})));var o,i})),function(e){if("[object Object]"!==u.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}(e.body)&&(e.body=JSON.stringify(e.body),e.headers&&(e.headers["Content-Type"]="application/json;charset=utf-8")),e}var f=function(){},d=1;function h(e,t){return void 0===t&&(t={}),new Promise((function(o,i){var n,a=t.name,s=t.query,l=void 0===s?{}:s,p=t.param,c=void 0===p?"callback":p,u=t.timeout,A=void 0===u?6e4:u,_=t.prefix,g=void 0===_?"jsonp_":_,E=t.controller,h=t.charset,v=a||""+g+d++,y=document.createElement("script"),m=A?setTimeout((function(){T(!0),i(new Error("jsonp timeout"))}),A):null,T=function(e){var t;void 0===e&&(e=!1),null===(t=y.parentNode)||void 0===t||t.removeChild(y),m&&clearTimeout(m),E&&(E.element=null),window[v]=e?f:null},I=m$1({url:e,query:r(r({},l),(n={},n[c]=v,n))});y.src=I,h&&(y.charset=h),E&&(E.element=y),y.onerror=function(e){T(),i(e)},window[v]=function(e){T(),o(e)},document.body.append(y)}))}function m(e){return n(this,void 0,void 0,(function(){var t,i,n,p,d,u,A,_,g,E,f,h,v,y,m,T,I;return o(this,(function(o){switch(o.label){case 0:return t=c.baseURL,i=c.defaults,n=c.interceptors,[4,s(c.polyfillUrl)];case 1:return o.sent(),(p=r(r({},i),e)).headers||(p.headers=function(e){void 0===e&&(e="GET");var t=c.headers[e]||{};return r(r({},c.headers.common),t)}(p.method)),l(p),[4,n.request.traverse(p,!0)];case 2:if((d=o.sent())instanceof Error)throw d;return d.url=function(e,t){return!e||a.test(t)?t:e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}(t,d.url),u=d.url,A=d.timeout,_=d.params,g=d.method,E=["GET","DELETE","OPTIONS","HEAD"].includes(void 0===g?"GET":g)&&!!_,f=E?m$1({url:u,query:_}):u,h=[],A&&!d.signal&&(m=new Promise((function(e){v=setTimeout((function(){e(new Error("timeout"))}),A)})),h.push(m),y=new AbortController,d.signal=y.signal),h.push(fetch(f,d).catch((function(e){return e}))),[4,Promise.race(h)];case 3:return T=o.sent(),v&&clearTimeout(v),[4,n.response.traverse(T)];case 4:if((I=o.sent())instanceof Error)throw null==y||y.abort(),I;return[2,I]}}))}))}var netTool={jsonp:h,img:function(e){return new window.Promise((function(t,o){(new Image).src=e,t()}))},fetch:function(e,t){return void 0===t&&(t={}),m({url:e,method:t.method,body:t.body}).then((function(e){return e.json()}))},xhr:function(e){var t=e.retryCount||0,o=+new Date,i=0,r=function(n,a){var s=function(e){void 0===e&&(e="xhrNetworkError"),i<t?(i++,r(n,a)):a({error:e,target:l})},l=new XMLHttpRequest;e.timeout&&(l.timeout=e.timeout),e.responseType&&(l.responseType=e.responseType),l.withCredentials=!!e.withCredentials,l.ontimeout=e.ontimeout,l.open(e.method||"get",e.url),e.range&&l.setRequestHeader("Range","bytes=".concat(e.range[0],"-").concat(e.range[1])),e.headers&&Object.keys(e.headers).forEach((function(t){l.setRequestHeader(t,e.headers[t])})),l.onload=function(){200!==l.status&&206!==l.status?s("xhrStatusCodeError"):n({data:l.response,target:l,startTimestamp:o})},l.onerror=function(e){s()},l.onabort=function(){},l.ontimeout=function(){s()},e.body?l.send(e.body):l.send()};return new Promise((function(e,t){r(e,t)}))}},__awaiter$5=window&&window.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},__generator$5=window&&window.__generator||function(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},testVideoElement=document.createElement("video"),videoTool={getBuffered:function(e){for(var t=[],o=e.buffered.length,i=0;i<o;i++)t.push({start:e.buffered.start(i),end:e.buffered.end(i)});return t},checkTimeInBuffer:function(e,t){for(var o=!1,i=t.length,r=0;r<i;r++){var n=t[r].start,a=t[r].end;if(e>=n&&e<=a){o=!0;break}}return o},clear:function(e){(null==e?void 0:e.src)&&(e instanceof HTMLVideoElement?e.removeAttribute("src"):e.src=null,e.load())},destroyElement:function(e){e.destroy?e.destroy():e instanceof HTMLVideoElement&&(videoTool.clear(e),e.remove())},captureVideo:function(e,t){var o=t.dx,i=t.dy,r=t.dw,n=t.dh,a=e.videoWidth,s=e.videoHeight,l=document.createElement("canvas");l.width=a,l.height=s;var p=l.getContext("2d");return p.drawImage(e,0,0,a,s),{captureHeight:n,captureWidth:r,captureX:o,captureY:i,playtime:e.currentTime,data:p.getImageData(o,i,r,n)}},resizeElement:function(e,t){if(t&&e){var o=t.width,i=t.height;e.resize&&"number"==typeof o&&"number"==typeof i?e.resize(o,i):e instanceof HTMLVideoElement&&domTool.css(e,t)}},appendElement:function(e,t){e.appendToParent?e.appendToParent(t):e instanceof HTMLVideoElement&&domTool.append(t,e)},removeElement:function(e,t){e.removeFromParent?e.removeFromParent(t):e instanceof HTMLVideoElement&&e.remove()},setElementFitType:function(e,t){e&&e instanceof HTMLVideoElement&&domTool.css(e,{"object-fit":t})},getDefaultMaxBufferTime:function(){var e=navigator.connection;return e&&"wifi"===e.type?180:e&&"4g"===e.type?120:180},isAutoPlayBlockedMessage:function(e){return e&&/interact|not allowed|user gesture/.test(e)},notSupportLoadBeforeHasUserGestures:function(){return!!(uaTool.browser.x5||uaTool.os.ios&&uaTool.browser.wechat)},supportSameTimePlay:function(){return(!uaTool.browser.x5||-1===["45031","45032"].indexOf("".concat(uaTool.browser.x5.version)))&&(!(uaTool.browser.mqqbrowser&&!(uaTool.browser.qqlive||uaTool.browser.wechat||uaTool.browser.mqq))&&!(uaTool.os.ios&&uaTool.os.version&&comTool.compareVersion(uaTool.os.version,"11.0")<0))},cannotDetectAutoPlayBlock:function(){return uaTool.browser.chrome&&comTool.compareVersion(uaTool.browser.chrome.version,"66.0")<0},supportMediaFragmentsURISpec:function(e){return void 0!==e?!!e:-1===window.navigator.userAgent.indexOf("jsdom")&&(!uaTool.mobile||!!uaTool.os.ios)},getVideoPlaybackQuality:function(e){var t=0,o=0;if(null==e?void 0:e.getVideoPlaybackQuality){var i=e.getVideoPlaybackQuality();o=i.droppedVideoFrames||0,t=i.totalVideoFrames||0}else e&&e.webkitDecodedFrameCount&&(t=e.webkitDecodedFrameCount,o=e.webkitDroppedFrameCount);return{totalVideoFrames:t,droppedVideoFrames:o}},supportMSE:function(){var e=videoTool.getMediaSource();if(!e)return!1;var t=window.SourceBuffer||window.WebKitSourceBuffer,o=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!o&&!!i},supportVideoFormat:function(){var e={mp4:"video/mp4",mov:"video/mp4",hls:"application/x-mpegURL",avi:"video/x-msvideo",mpeg:"video/mpeg",webm:"video/webm",ogg:"video/ogg"},t=[];return Object.keys(e).forEach((function(o){var i=e[o],r=testVideoElement.canPlayType(i);-1!==["maybe","probably"].indexOf(r)&&t.push(o)})),t},supportAV1:function(){var e=videoTool.getMediaSource();return null==e?void 0:e.isTypeSupported("video/mp4;codecs=av01.0.12M.08")},isVideoCanPlayType:function(e){return testVideoElement.canPlayType(e)},isMediaSourceTypeSupported:function(e){try{return videoTool.getMediaSource().isTypeSupported(e)}catch(e){return!1}},isMediaCapabilitiesTypeSupported:function(e){return __awaiter$5(this,void 0,void 0,(function(){var t,o,i,r,n,a,s,l,p,c,d,u;return __generator$5(this,(function(A){switch(A.label){case 0:t=e.type,o=e.mimeType,i=e.resolution,r=void 0===i?"860x480":i,n=e.bitrate,a=void 0===n?800:n,s=e.framerate,l=void 0===s?30:s,A.label=1;case 1:switch(A.trys.push([1,3,,4]),p={type:"media-source"},t){case"audio":p.audio={contentType:o};break;case"audio-spatial":p.audio={contentType:o,spatialRendering:!0};break;case"video":c=r.toLowerCase().split("x"),d=c[0],u=c[1],p.video={contentType:o,bitrate:a,framerate:l,height:+d,width:+u}}return[4,navigator.mediaCapabilities.decodingInfo(p)];case 2:return[2,A.sent().supported];case 3:return A.sent(),[2,!1];case 4:return[2]}}))}))},isHDRSupported:function(){try{return window.matchMedia("(dynamic-range: high)").matches?2:window.matchMedia("(color-gamut: p3)").matches?1:0}catch(e){return 0}},isDolbyVisionSupported:function(){return videoTool.isMediaSourceTypeSupported('video/mp4; codecs="dvhe"')},isDolbyAtomsSupported:function(e){return videoTool.isMediaSourceTypeSupported('audio/mp4; codecs="ec-3"')},getMediaSource:function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource},supportWidevine:function(){return __awaiter$5(this,void 0,void 0,(function(){var e,t;return __generator$5(this,(function(o){switch(o.label){case 0:if(e=[window.MediaKeys,window.WebKitMediaKeys].some((function(e){return e})),!e)return[2,!1];if(!(void 0!==window.navigator.requestMediaKeySystemAccess))return[2,!1];t=[{initDataTypes:["cenc"],audioCapabilities:[{robustness:"SW_SECURE_CRYPTO",contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{robustness:"SW_SECURE_CRYPTO",contentType:'video/mp4;codecs="avc1.42E01E"'}]}],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,window.navigator.requestMediaKeySystemAccess("com.widevine.alpha",t)];case 2:return o.sent(),[2,!0];case 3:return o.sent(),[2,!1];case 4:return[2]}}))}))},supportFairplay:function(){var e,t=KeySystems.FairPlayWebKit;return null===(e=window.WebKitMediaKeys)||void 0===e?void 0:e.isTypeSupported(t,"video/mp4")}},stringTool={arrayToString:function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},base64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(t),i=new Uint8Array(o.length),r=0;r<o.length;++r)i[r]=o.charCodeAt(r);return i},arrayBufferToBase64:function(e){for(var t="",o=new Uint8Array(e),i=o.byteLength,r=0;r<i;r++)t+=String.fromCharCode(o[r]);return window.btoa(t)},stringToArray:function(e){for(var t=e.length,o=new ArrayBuffer(2*t),i=new Uint16Array(o),r=0;r<t;r++)i[r]=e.charCodeAt(r);return i}},DRM_ERR_CODE;function transformInitData(e,t,o){var i=stringTool.stringToArray(t),r=e.byteLength+4+i.byteLength+4+o.byteLength,n=0,a=new ArrayBuffer(r),s=new DataView(a),l=new Uint8Array(a,n,e.byteLength);l.set(e),n+=l.byteLength,s.setUint32(n,i.byteLength,!0),n+=4;var p=new Uint16Array(a,n,i.length);return p.set(i),n+=p.byteLength,s.setUint32(n,o.byteLength,!0),n+=4,new Uint8Array(a,n,o.byteLength).set(o),new Uint8Array(a,0,a.byteLength)}function getContentId(e){var t,o,i;return null===(i=null===(o=null===(t=stringTool.arrayToString(e).split("skd://"))||void 0===t?void 0:t[1])||void 0===o?void 0:o.split("?"))||void 0===i?void 0:i[0]}!function(e){e.UNKNOWN="70090000",e.KEY_SYS_ACCESS_FAILED="70090001",e.KEY_SESSION_CREATION_FAILED="70090002",e.KEY_SYS_NOT_SUPPORTED="70090003",e.KEY_SYS_NOT_REQUESTED="70090004",e.KEY_SESSION_NOT_EXIST="70090005",e.KEY_NOT_EXIST="70090006",e.INIT_DATA_EMPTY="70090007",e.FPS_SET_KEY_FAILED="70090008",e.FPS_CERTIFICATE_NOT_EXIST="7009009",e.HDCP_ERROR="70090010",e.LICENSE_REQUEST_FAILED="70090011",e.LICENSE_NOT_EXIST="70090012",e.KEY_SESSION_REQUEST_FAILED="70090013",e.KEY_SESSION_UPDATE_FAILED="70090014",e.KEY_EXPIRED="70090015",e.KEY_RELEASED="70090016",e.KEY_INTERNAL_ERROR="70090017"}(DRM_ERR_CODE||(DRM_ERR_CODE={}));var __extends$a=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__assign$8=window&&window.__assign||function(){return __assign$8=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$8.apply(this,arguments)},__awaiter$4=window&&window.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},__generator$4=window&&window.__generator||function(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},KeySystems;function getSupportedKeySystemConfig(e){switch(e){case KeySystems.FairPlayWebKit:return null;case KeySystems.Widevine:return{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42E01E"',robustness:"SW_SECURE_CRYPTO"}]};case KeySystems.FairPlay:return{initDataTypes:["skd"],videoCapabilities:[{contentType:"application/vnd.apple.mpegurl",robustness:""}]};default:return null}}!function(e){e.FairPlayWebKit="com.apple.fps.1_0",e.Widevine="com.widevine.alpha",e.FairPlay="com.apple.fps"}(KeySystems||(KeySystems={}));var ERR="error",DRM=function(e){function t(o,i,r){var n=e.call(this)||this;return n.started=!1,n.mediaKeyDescriptor=null,n.mediaKeyPromise=null,n.onVideoEncrypted=function(e){n.mediaKeyPromise?n.mediaKeyPromise.then((function(t){n.mediaKeyDescriptor?n.mediaKeyDescriptor.hasInitialized?n.logger.warn("Media key-session has been initialized but requested again"):n.mediaKeyDescriptor.mediaKeys?(n.media.setMediaKeys(n.mediaKeyDescriptor.mediaKeys),n.mediaKeyDescriptor.mediaKeySession?e.initData?(n.mediaKeyDescriptor.mediaKeySession.generateRequest(e.initDataType,e.initData).catch((function(e){n.emit(ERR,{code:DRM_ERR_CODE.KEY_SESSION_REQUEST_FAILED,message:"视频资源已加密，但CDM Session请求失败"})})),n.mediaKeyDescriptor.initData=e.initData,n.mediaKeyDescriptor.hasInitialized=!0):n.emit(ERR,{code:DRM_ERR_CODE.INIT_DATA_EMPTY,message:"视频资源已加密，但事件信息中没有用于创建请求的initData"}):n.emit(ERR,{code:DRM_ERR_CODE.KEY_SESSION_NOT_EXIST,message:"视频资源已加密，但CDM Session未创建"})):n.emit(ERR,{code:DRM_ERR_CODE.KEY_NOT_EXIST,message:"视频资源已加密，但尚未获取到MediaKey"}):n.emit(ERR,{code:DRM_ERR_CODE.KEY_NOT_EXIST,message:"视频资源已加密，但尚未获取到MediaKey"})})):n.emit(ERR,{code:DRM_ERR_CODE.KEY_SYS_NOT_REQUESTED,message:"视频资源已加密，但尚未请求CDM"})},n.onVideoWebkitneedkey=function(e){var o=n.config.fpsCustomContentId(e.initData),i=t.serverCertificate[KeySystems.FairPlayWebKit];if(i){var r=n.config.fpsCustomTransformInitData(e.initData,o,i);n.mediaKeyDescriptor.initData=r,n.mediaKeyDescriptor.mediaKeySession?n.logger.warn("Media key-session has already been initialized"):(n.mediaKeyDescriptor.mediaKeySession=n.createSessionWithMediaKey(n.mediaKeyDescriptor.mediaKeys,r),n.mediaKeyDescriptor.assetID=o,n.mediaKeyDescriptor.mediaKeySession.onwebkitkeyadded=n.onFPSKeySessionKeyAdded,n.mediaKeyDescriptor.mediaKeySession.onwebkitkeyerror=n.onFPSKeySessionKeyError,n.mediaKeyDescriptor.mediaKeySession.onwebkitkeymessage=function(e){n.onMediaKeySessionMessage(n.mediaKeyDescriptor.mediaKeySession,e)})}else n.emit(ERR,{code:DRM_ERR_CODE.FPS_CERTIFICATE_NOT_EXIST,message:"视频资源已加密，但 Fairplay 服务端证书未配置"})},n.onFPSKeySessionKeyAdded=function(e){},n.onFPSKeySessionKeyError=function(e){var t=n.mediaKeyDescriptor.mediaKeySession.error;if(t.systemCode){var o={1212433232:[DRM_ERR_CODE.HDCP_ERROR,"你可能链接了不支持HDCP标准的显示器"]};o[t.systemCode]&&n.emit(ERR,{code:o[t.systemCode][0],message:o[t.systemCode][1]})}else n.emit(ERR,{code:DRM_ERR_CODE.UNKNOWN,message:"未知错误"})},n.media=o,n.logger=r,n.config=__assign$8({keySystem:null,fpsCustomContentId:getContentId,fpsCustomTransformInitData:transformInitData},i),n}return __extends$a(t,e),Object.defineProperty(t.prototype,"isFairPlay",{get:function(){var e=this.config.keySystem;return e===KeySystems.FairPlay||e===KeySystems.FairPlayWebKit},enumerable:!1,configurable:!0}),t.isKeySystemSupported=function(e){var t,o,i;return null===(i=((t={})[KeySystems.FairPlayWebKit]=[null===(o=self.WebKitMediaKeys)||void 0===o?void 0:o.isTypeSupported(e,"video/mp4")],t[KeySystems.FairPlay]=[uaTool.browser.safari,self.MediaKeys,self.navigator.requestMediaKeySystemAccess],t[KeySystems.Widevine]=[self.MediaKeys,self.navigator.requestMediaKeySystemAccess],t)[e])||void 0===i?void 0:i.every(Boolean)},t.prototype.destroy=function(){this.removeAllListeners(),this.logger=null},t.prototype.configure=function(e){var o=this;this.config=__assign$8(__assign$8({},this.config),e),this.config.certificate&&Object.keys(this.config.certificate).forEach((function(e){t.serverCertificate[e]=o.config.certificate[e]}))},t.prototype.hasStarted=function(){return this.started},t.prototype.init=function(e){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(o){switch(o.label){case 0:return[4,this.reset()];case 1:return o.sent(),e&&this.configure(e),"string"!=typeof t.serverCertificate[this.config.keySystem]?[3,3]:[4,this.requestServerCertificate(this.config.keySystem,t.serverCertificate[this.config.keySystem])];case 2:o.sent(),o.label=3;case 3:return this.bind(),[2]}}))}))},t.prototype.reset=function(){return __awaiter$4(this,void 0,void 0,(function(){var e,t,o;return __generator$4(this,(function(i){switch(i.label){case 0:if(this.started=!1,!this.config.keySystem||!this.mediaKeyDescriptor)return[2];if((o={})[KeySystems.FairPlayWebKit]=this.cleanupFPSSession,o[KeySystems.FairPlay]=this.cleanupMediaKeySession,o[KeySystems.Widevine]=this.cleanupMediaKeySession,e=o,this.videoEncryptedEventPicker(!1),!e[this.config.keySystem])return[3,4];t=this.mediaKeyDescriptor.mediaKeySession,this.mediaKeyPromise=null,this.mediaKeyDescriptor=null,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e[this.config.keySystem].call(this,t)];case 2:case 3:return i.sent(),[3,4];case 4:return[2]}}))}))},t.prototype.bind=function(){var e=this.config.keySystem;e&&(t.isKeySystemSupported(e)?(this.started=!0,this.mediaKeyPromise=this.createKeySystemAccess(e),this.videoEncryptedEventPicker(!0)):this.logger.warn("当前环境不支持 ".concat(e)))},t.prototype.cleanupMediaKeySession=function(e){return this.media&&e?(e.onmessage=null,e.onkeystatuseschange=null,e.close().catch((function(){})),this.media.setMediaKeys(null)):Promise.resolve()},t.prototype.videoEncryptedEventPicker=function(e){var t;void 0===e&&(e=!0);var o=((t={})[KeySystems.FairPlayWebKit]=["webkitneedkey",this.onVideoWebkitneedkey],t[KeySystems.Widevine]=["encrypted",this.onVideoEncrypted],t[KeySystems.FairPlay]=["encrypted",this.onVideoEncrypted],t)[this.config.keySystem],i=o[0],r=o[1];e?this.media.addEventListener(i,r):this.media.removeEventListener(i,r)},t.prototype.createSessionWithMediaKey=function(e,t){var o;return((o={})[KeySystems.FairPlayWebKit]=this.createFPSWebkitSession,o[KeySystems.Widevine]=this.createMediaKeySession,o[KeySystems.FairPlay]=this.createMediaKeySession,o)[this.config.keySystem].call(this,e,t)},t.prototype.createKeySystemAccess=function(e){var t;return((t={})[KeySystems.Widevine]=this.requestKeySystemAccess,t[KeySystems.FairPlay]=this.requestKeySystemAccess,t[KeySystems.FairPlayWebKit]=this.requestFPSMediaKeys,t)[this.config.keySystem].call(this,e)},t.prototype.requestLicense=function(e,t){var o;if(this.config.licenseUrl)return((o={})[KeySystems.FairPlayWebKit]=this.createFPSLicenseRequest,o[KeySystems.Widevine]=this.createWidevineLicenseRequest,o[KeySystems.FairPlay]=this.createFPSLicenseRequest,o)[this.config.keySystem].call(this,e,t);this.emit(ERR,{code:DRM_ERR_CODE.LICENSE_NOT_EXIST,message:"视频资源已加密，但未配置解密证书地址"})},t.prototype.requestServerCertificate=function(e,o){return __awaiter$4(this,void 0,void 0,(function(){var i;return __generator$4(this,(function(r){switch(r.label){case 0:return[4,netTool.xhr({method:"GET",responseType:"arraybuffer",url:o})];case 1:return i=r.sent().data,t.serverCertificate[e]=new Uint8Array(i),[2]}}))}))},t.prototype.requestKeySystemAccess=function(e){return __awaiter$4(this,void 0,void 0,(function(){var t,o;return __generator$4(this,(function(i){switch(i.label){case 0:if(!(t=getSupportedKeySystemConfig(e)))return this.emit(ERR,{code:DRM_ERR_CODE.KEY_SYS_NOT_SUPPORTED,message:"".concat(e," 不支持")}),[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,self.navigator.requestMediaKeySystemAccess(e,[t])];case 2:return o=i.sent(),[2,this.onMediaKeySystemObtained(e,o)];case 3:return i.sent(),this.emit(ERR,{code:DRM_ERR_CODE.KEY_SYS_ACCESS_FAILED,message:"访问CDM失败, keySystem ".concat(e)}),[2];case 4:return[2]}}))}))},t.prototype.onMediaKeySystemObtained=function(e,o){return __awaiter$4(this,void 0,void 0,(function(){var i;return __generator$4(this,(function(r){switch(r.label){case 0:return[4,o.createMediaKeys()];case 1:i=r.sent(),this.mediaKeyDescriptor={hasInitialized:!1,mediaKeySession:null,mediaKeySystemAccess:o,mediaKeys:i},r.label=2;case 2:return r.trys.push([2,5,,6]),e!==KeySystems.FairPlay?[3,4]:[4,i.setServerCertificate(t.serverCertificate[KeySystems.FairPlay])];case 3:r.sent(),r.label=4;case 4:return this.createSessionWithMediaKey(i),[2,i];case 5:return r.sent(),this.emit(ERR,{code:DRM_ERR_CODE.KEY_SESSION_CREATION_FAILED,message:"CDM Session初始化失败"}),[2];case 6:return[2]}}))}))},t.prototype.createMediaKeySession=function(e){var t=this;if(this.mediaKeyDescriptor.mediaKeySession)this.logger.warn("Media key-session has already been initialized");else{var o={"output-restricted":[DRM_ERR_CODE.HDCP_ERROR,"你可能链接了不支持HDCP标准的显示器"],"output-downscaled":[DRM_ERR_CODE.HDCP_ERROR,"你可能链接了不支持HDCP标准的显示器"],"status-pending":null,"internal-error":[DRM_ERR_CODE.KEY_INTERNAL_ERROR,"内部错误"],usable:null,expired:[DRM_ERR_CODE.KEY_EXPIRED,"MediaKey已过期"],released:[DRM_ERR_CODE.KEY_RELEASED,"MediaKey已从CDM中注销"]};this.mediaKeyDescriptor.mediaKeySession=e.createSession(),this.mediaKeyDescriptor.mediaKeySession.onkeystatuseschange=function(e){var i,r,n;null===(n=null===(r=null===(i=e.target)||void 0===i?void 0:i.keyStatuses)||void 0===r?void 0:r.forEach)||void 0===n||n.call(r,(function(e,i){if(t.mediaKeyDescriptor&&o[e]){var r=o[e],n=r[0],a=r[1];t.emit(ERR,{code:n,message:a})}}))},this.mediaKeyDescriptor.mediaKeySession.onmessage=function(e){t.onMediaKeySessionMessage(t.mediaKeyDescriptor.mediaKeySession,e)}}},t.prototype.onMediaKeySessionMessage=function(e,t){var o=this;this.requestLicense(t,(function(t){var i=t.data;if(o.config.licenseResponseSetup&&(i=o.config.licenseResponseSetup(i)||i),i){var r=e.update(i);null==r||r.catch((function(e){o.emit(ERR,{code:DRM_ERR_CODE.KEY_SESSION_UPDATE_FAILED,message:"CDM Session更新失败，请检查证书解析"})}))}else o.emit(ERR,{code:DRM_ERR_CODE.KEY_SESSION_UPDATE_FAILED,message:"CDM Session更新失败，请检查证书解析"})}))},t.prototype.createWidevineLicenseRequest=function(e,t){var o=this,i={method:"POST",responseType:"arraybuffer",body:e.message,url:this.config.licenseUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"}};this.config.licenseRequestSetup&&(i=this.config.licenseRequestSetup(i)),netTool.xhr(i).then((function(e){t(e)})).catch((function(e){o.emit(ERR,{code:DRM_ERR_CODE.LICENSE_REQUEST_FAILED,message:"证书请求失败 ".concat(null==e?void 0:e.message)})}))},t.prototype.createFPSLicenseRequest=function(e,t){var o=this,i=e.message,r=encodeURIComponent(stringTool.arrayBufferToBase64(i)),n={method:"POST",responseType:"arraybuffer",body:"spc=".concat(r,"&assetId=").concat(this.mediaKeyDescriptor.assetID),url:this.config.licenseUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"}};this.config.licenseRequestSetup&&(n=this.config.licenseRequestSetup(n)),netTool.xhr(n).then((function(e){t(e)})).catch((function(e){o.logger.warn("license request error",e),o.emit(ERR,{code:DRM_ERR_CODE.LICENSE_REQUEST_FAILED,message:"证书请求失败"})}))},t.prototype.requestFPSMediaKeys=function(){var e=new window.WebKitMediaKeys(KeySystems.FairPlayWebKit);return this.media.webkitSetMediaKeys(e),this.mediaKeyDescriptor={mediaKeySession:null,initData:null,hasInitialized:!1,mediaKeySystemAccess:null,mediaKeys:this.media.webkitKeys},Promise.resolve(e)},t.prototype.createFPSWebkitSession=function(e,t){if(e){var o=e.createSession("video/mp4",t);if(o)return o;this.emit(ERR,{code:DRM_ERR_CODE.KEY_SESSION_CREATION_FAILED,message:"Webkit CDM Session创建失败"})}else this.emit(ERR,{code:DRM_ERR_CODE.FPS_SET_KEY_FAILED,message:"Webkit MediaKey创建失败"})},t.prototype.cleanupFPSSession=function(e){return e?(this.media.webkitSetMediaKeys(null),e.onwebkitkeyadded=null,e.onwebkitkeyerror=null,e.onwebkitkeymessage=null,Promise.resolve()):Promise.resolve()},t.serverCertificate={},t}(s$1),AutoPlayPolicy=function(){function e(e,t){this._logger=new Logger(t.instanceId,"AutoPlayPolicy"),this._videoElement=e}return e.prototype.userTrigger=function(){var e,t=this;this._triggerDefer=new SimpleDefer,this._logger.log("userTrigger(), start");var o=this._videoElement.play();if(this._videoElement.pause(),0===this._videoElement.readyState)o&&o.catch((function(o){e>0&&(clearTimeout(e),e=0),t._logger.log("userTrigger(), catch: ",o.name,o.message),videoTool.isAutoPlayBlockedMessage(o.message)?t._triggerDefer.reject(o):(t._logger.log("userTrigger() over, catched."),t._triggerDefer.resolve())})),e=window.setTimeout((function(){t._logger.log("userTrigger() over, timeout."),t._triggerDefer.resolve()}),300);else{this._logger.log("userTrigger() over, sync.");var i=uaTool.browser.safari&&!uaTool.mobile?400:0;window.setTimeout((function(){t._triggerDefer.resolve()}),i)}return this._triggerDefer.promise},e.prototype.destroy=function(){this._videoElement=null},e}(),__extends$9=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),CheckHealth=function(e){function t(t){var o=e.call(this)||this;return o.stateStartTimeStamp=0,o.preFramePlaytime=0,o.playtimeStalledFrameCount=0,o.videoNode=t,o.setVideoNodeEvts(!0),o}return __extends$9(t,e),t.prototype.loop=function(){var e=+new Date;this.checkStateStalled(e),this.checkPlaytimeStalled()},t.prototype.destroy=function(){this.setVideoNodeEvts(!1),this.removeAllListeners(),this.stateStartTimeStamp=0,this.videoNode=null,this.videoNodeEvtMap=null,this.preFramePlaytime=0,this.playtimeStalledFrameCount=0},t.prototype.setVideoNodeEvts=function(e){var t,o=this;this.videoNodeEvtMap||(this.videoNodeEvtMap=((t={})[VIDEO_NODE_EVENT.STATE_CHANGE]=this.videoNodeStateChange.bind(this),t)),Object.keys(this.videoNodeEvtMap).forEach((function(t){e?o.videoNode.on(t,o.videoNodeEvtMap[t]):o.videoNode.off(t,o.videoNodeEvtMap[t])}))},t.prototype.videoNodeStateChange=function(e){this.stateStartTimeStamp=+new Date},t.prototype.checkStateStalled=function(e){var t=this.videoNode,o=t.config,i=t.state;-1!==[exports.VIDEO_STATE.BUFFERING,exports.VIDEO_STATE.SEEKING].indexOf(i)&&(this.stateStartTimeStamp<=0||o.maxStateStalledTime<=0||e-this.stateStartTimeStamp>o.maxStateStalledTime&&(this.stateStartTimeStamp=0,this.emit(HEALTH_EVTS.STATE_STUCK,{code:ERROR_CODE.STATE_STUCK,message:ERROR_MSG.PLAY_STUCK,state:i})))},t.prototype.checkPlaytimeStalled=function(){var e=this.videoNode,t=e.config,o=e.state,i=e.videoElement;o!==exports.VIDEO_STATE.PLAYING||i.duration<=0||i.currentTime<=0||t.maxPlaytimeStalledTime<=0||(this.preFramePlaytime>0&&(this.preFramePlaytime!==i.currentTime?this.playtimeStalledFrameCount=0:(this.playtimeStalledFrameCount++,16.7*this.playtimeStalledFrameCount>t.maxPlaytimeStalledTime&&(this.playtimeStalledFrameCount=0,this.emit(HEALTH_EVTS.PLAYTIME_STUCK,{code:ERROR_CODE.ORG_PLAY_STUCK_ERR,message:ERROR_MSG.PLAY_STUCK,state:o})))),this.preFramePlaytime=i.currentTime)},t}(s$1),HEALTH_EVTS;!function(e){e.STATE_STUCK="state-stuck",e.PLAYTIME_STUCK="playtime-stuck"}(HEALTH_EVTS||(HEALTH_EVTS={}));var __decorate$8=window&&window.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__metadata$8=window&&window.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_a$8,VALID_PREVIOUS_STATE_MAP=(_a$8={},_a$8[exports.VIDEO_STATE.LOAD_START]=[exports.VIDEO_STATE.IDLE],_a$8[exports.VIDEO_STATE.CANPLAY]=[exports.VIDEO_STATE.LOAD_START],_a$8[exports.VIDEO_STATE.PLAYING]=[exports.VIDEO_STATE.CANPLAY,exports.VIDEO_STATE.SEEKED,exports.VIDEO_STATE.PAUSE,exports.VIDEO_STATE.BUFFERING],_a$8[exports.VIDEO_STATE.BUFFERING]=[exports.VIDEO_STATE.PLAYING],_a$8[exports.VIDEO_STATE.PAUSE]=[exports.VIDEO_STATE.PLAYING,exports.VIDEO_STATE.BUFFERING],_a$8[exports.VIDEO_STATE.SEEKING]=[exports.VIDEO_STATE.CANPLAY,exports.VIDEO_STATE.PLAYING,exports.VIDEO_STATE.PAUSE,exports.VIDEO_STATE.BUFFERING,exports.VIDEO_STATE.SEEKING],_a$8[exports.VIDEO_STATE.SEEKED]=[exports.VIDEO_STATE.SEEKING],_a$8[exports.VIDEO_STATE.END]=[exports.VIDEO_STATE.LOAD_START,exports.VIDEO_STATE.CANPLAY,exports.VIDEO_STATE.SEEKING,exports.VIDEO_STATE.SEEKED,exports.VIDEO_STATE.BUFFERING,exports.VIDEO_STATE.PLAYING,exports.VIDEO_STATE.PAUSE],_a$8[exports.VIDEO_STATE.IDLE]=[exports.VIDEO_STATE.END],_a$8),VALID_STATE_IN_LEVEL_SWITCHING=[exports.VIDEO_STATE.PAUSE,exports.VIDEO_STATE.PLAYING,exports.VIDEO_STATE.END,exports.VIDEO_STATE.IDLE],logMethodCall$8=logMethodCallDecoratorCreator("StateMgr"),StateMgr=function(){function e(e){var t;this.videoEvtHandler=((t={})[VIDEO_EVTS.canplay]=this.onCanplayEvt.bind(this),t[VIDEO_EVTS.playing]=this.setPlaying.bind(this),t[VIDEO_EVTS.waiting]=this.setWaiting.bind(this),t[VIDEO_EVTS.pause]=this.onPauseEvt.bind(this),t[VIDEO_EVTS.seeking]=this.onSeekingEvt.bind(this),t[VIDEO_EVTS.seeked]=this.onSeekedEvt.bind(this),t),this.videoNode=e,this.logger=new Logger(e.config.instanceId,"StateMgr")}return e.prototype.destroy=function(){this.videoNode=null},e.prototype.validCallState=function(e){var t;return null===(t=VALID_PREVIOUS_STATE_MAP[e])||void 0===t?void 0:t.includes(this.videoNode.state)},e.prototype.setEnded=function(){this.setVideoNodeState(exports.VIDEO_STATE.END),this.setVideoNodeState(exports.VIDEO_STATE.IDLE)},e.prototype.setLoadStart=function(){this.setVideoNodeState(exports.VIDEO_STATE.LOAD_START)},e.prototype.setCanplay=function(){this.setVideoNodeState(exports.VIDEO_STATE.CANPLAY)},e.prototype.setWaiting=function(){this.setVideoNodeState(exports.VIDEO_STATE.BUFFERING)},e.prototype.setPlaying=function(){this.setVideoNodeState(exports.VIDEO_STATE.PLAYING)},e.prototype.onSetLevelOver=function(){this.videoNode.state===exports.VIDEO_STATE.PAUSE&&this.setVideoNodeState(exports.VIDEO_STATE.PLAYING)},e.prototype.receiveVideoEvt=function(e){var t,o;null===(o=(t=this.videoEvtHandler)[e])||void 0===o||o.call(t)},e.prototype.setVideoNodeState=function(e){!this.videoNode.getLevelSwitching()||VALID_STATE_IN_LEVEL_SWITCHING.includes(e)?VALID_PREVIOUS_STATE_MAP[e].includes(this.videoNode.state)?this.videoNode.state=e:this.logger.log("can not set state from ".concat(this.videoNode.state," to ").concat(e)):this.logger.log("can not set state 2 ".concat(e," when level switching"))},e.prototype.onCanplayEvt=function(){(uaTool.os.ios||uaTool.browser.safari)&&this.isVideoElementPlaying()&&this.videoNode.state===exports.VIDEO_STATE.BUFFERING?this.setVideoNodeState(exports.VIDEO_STATE.PLAYING):this.setVideoNodeState(exports.VIDEO_STATE.CANPLAY)},e.prototype.onPauseEvt=function(){this.setVideoNodeState(exports.VIDEO_STATE.PAUSE)},e.prototype.onSeekingEvt=function(){this.setVideoNodeState(exports.VIDEO_STATE.SEEKING)},e.prototype.onSeekedEvt=function(){this.setVideoNodeState(exports.VIDEO_STATE.SEEKED),(uaTool.os.ios||uaTool.browser.safari)&&this.isVideoElementPlaying()&&this.setVideoNodeState(exports.VIDEO_STATE.PLAYING)},e.prototype.isVideoElementPlaying=function(){return!this.videoNode.videoElement.paused&&!this.videoNode.videoElement.ended},__decorate$8([logMethodCall$8,__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[]),__metadata$8("design:returntype",void 0)],e.prototype,"destroy",null),__decorate$8([logMethodCall$8,__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[String]),__metadata$8("design:returntype",void 0)],e.prototype,"validCallState",null),__decorate$8([logMethodCall$8,__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[]),__metadata$8("design:returntype",void 0)],e.prototype,"setEnded",null),__decorate$8([logMethodCall$8,__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[]),__metadata$8("design:returntype",void 0)],e.prototype,"setLoadStart",null),__decorate$8([logMethodCall$8,__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[]),__metadata$8("design:returntype",void 0)],e.prototype,"setCanplay",null),__decorate$8([logMethodCall$8,__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[]),__metadata$8("design:returntype",void 0)],e.prototype,"setWaiting",null),__decorate$8([logMethodCall$8,__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[]),__metadata$8("design:returntype",void 0)],e.prototype,"setPlaying",null),e}(),__extends$8=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__assign$7=window&&window.__assign||function(){return __assign$7=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$7.apply(this,arguments)},__decorate$7=window&&window.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__metadata$7=window&&window.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},logMethodCall$7=logMethodCallDecoratorCreator("BaseVideoNode"),BaseVideoNode=function(e){function t(t){var o,i=e.call(this)||this;i._played=!1,i._evtBlocking=!1,i._pauseCloseToEndStateCheckTimeoutId=0,i._targetSeekTime=-1,i._userStartTime=0,i._isUserSeek=!1,i._setLoadingDelayTimeoutId=0,i.mainLoopEnabled=!1,i.loadTimeoutId=0,i.levelSwitchTargetPlaytime=-1,i.setLevelMode=SET_LEVEL_MODE.SOFT,i._logger=new Logger(t.instanceId,"BaseVideoNode"),i._config=t,i.stateMgr=new StateMgr(i),i.checkPlayHealth=new CheckHealth(i),i.setHealthEvents();var r=i._config.container;return i._video=i.findFreeVideoElement(),i._autoPlayPolicy=new AutoPlayPolicy(i._video,{instanceId:t.instanceId}),i._state=exports.VIDEO_STATE.IDLE,i._playbackRate=1,i._idx=0,i._videoInfo=null,i._pauseType=void 0,i._videoEventMap=((o={})[VIDEO_EVTS.timeupdate]=i.onVideoEventTimeUpdate.bind(i),o[VIDEO_EVTS.durationchange]=i.onVideoEventDurationChange.bind(i),o[VIDEO_EVTS.volumechange]=i.onVideoEventVolumeChange.bind(i),o[VIDEO_EVTS.canplay]=i.onVideoEventCanplay.bind(i),o[VIDEO_EVTS.playing]=i.onVideoEventPlaying.bind(i),o[VIDEO_EVTS.pause]=i.onVideoEventPause.bind(i),o[VIDEO_EVTS.waiting]=i.onVideoEventWaiting.bind(i),o[VIDEO_EVTS.seeking]=i.onVideoEventSeeking.bind(i),o[VIDEO_EVTS.seeked]=i.onVideoEventSeeked.bind(i),o[VIDEO_EVTS.loadeddata]=i.onVideoEventLoadeddata.bind(i),o[VIDEO_EVTS.loadedmetadata]=i.onVideoEventLoadedmetadata.bind(i),o[VIDEO_EVTS.ended]=i.onVideoEventEnded.bind(i),o[VIDEO_EVTS.error]=i.onVideoEventError.bind(i),o[VIDEO_EVTS.progress]=i.onVideoEventProgress.bind(i),o[VIDEO_EVTS.ratechange]=i.onVideoEventRateChange.bind(i),o[VIDEO_EVTS.resize]=i.onVideoEventResize.bind(i),o),i._drm=new DRM(i._video,t.drmConfig,i._logger),i._drm.on("error",i.onDrmError.bind(i)),i._eventMap={video:i.onVideoEvents.bind(i)},i._eventAddedMap={},i._videoElementContainer=domTool.getElementFromConfig(r).querySelector(".".concat(VIDEO_CONTAINER_CLASS)),videoTool.appendElement(i._video,i._videoElementContainer),i.addVideoElementResizeObserver(),i}return __extends$8(t,e),t.prototype.setLevel=function(e){if(void 0===e&&(e=SET_LEVEL_MODE.HARD),!this.checkCanSetLevel())return Promise.reject(new Error("setLevel can't start"));this._logger.log("setLevel(), succ exec: ",this._videoInfo);var t=this._videoInfo.playtime;this.load(this._videoInfo,{startTime:t}),this.play();var o=new SimpleDefer;return this._levelSwitchingDefer=o,this.levelSwitchTargetPlaytime=t,this.setLoading(!0),this.emit(VIDEO_NODE_EVENT.SETLEVEL_START,{videoInfo:this._videoInfo,mode:e}),o.promise},t.prototype.isCurrentContentDRMEncrypted=function(){return this._state!==exports.VIDEO_STATE.IDLE&&this._drm.hasStarted()},t.prototype.getLevelSwitching=function(){return!!this._levelSwitchingDefer},t.prototype.checkSetLevelOver=function(e){if(this.getLevelSwitching()){var t=!1,o=!1,i=!1;this._config.type===exports.PLAY_MODE.LIVE?(t=e===VIDEO_EVTS.playing,i=e===VIDEO_EVTS.timeupdate):(t=e===VIDEO_EVTS.playing&&videoTool.supportMediaFragmentsURISpec(this._config.enableMediaFragmentsURI),o=e===VIDEO_EVTS.seeked&&!videoTool.supportMediaFragmentsURISpec(this._config.enableMediaFragmentsURI),i=e===VIDEO_EVTS.timeupdate&&this._video.currentTime-this.levelSwitchTargetPlaytime>=.3),(t||o||i)&&(this._logger.log("setLevelOver(), reason: "+"succOnPlaying=".concat(t,"/succOnSeeked=").concat(o,"/succOnTimeupdate=").concat(i)),this.setLevelOver())}},t.prototype.setLevelOver=function(){this._levelSwitchingDefer&&(this._levelSwitchingDefer.resolve(),this._levelSwitchingDefer=null,this.levelSwitchTargetPlaytime=-1,this.setLoading(!1),this.stateMgr.onSetLevelOver(),this.emit(VIDEO_NODE_EVENT.SETLEVEL_OVER,{videoInfo:this._videoInfo}))},t.prototype.checkCanSetLevel=function(){return this._played?this.getLevelSwitching()?(this._logger.warn("setLevel(), in progress."),!1):!this._videoInfo||this._videoInfo.playtime<=0?(this._logger.warn("setLevel(), setLevel can't start."),!1):!(this._config.type===exports.PLAY_MODE.VOD&&this._videoInfo.playtime+1>=this._videoInfo.duration)||(this._logger.warn("setLevel(), video is about to end."),!1):(this._logger.warn("setLevel(), play is not triggered."),!1)},t.prototype.checkCanSeek=function(e,t){return void 0===t&&(t=!1),this._videoInfo?this._video.duration<=0?(this._logger.log("seek(), cannot seek when the duration is 0"),!1):e-this._videoInfo.duration>=1?(this._logger.log("seek(), return because too large time, uid=".concat(this._videoInfo.uid,"/idx=").concat(this.idx,"/time=").concat(e)+"/duration=".concat(this._videoInfo.duration)),!1):void 0===this.setLevelMode||this.setLevelMode===SET_LEVEL_MODE.SMOOTH||!this.getLevelSwitching()||!t||(this._logger.log("seek(), cannot seek when hard/soft level switching"),!1):(this._logger.log("seek(), return because null videoInfo, time=".concat(e,"/idx=").concat(this.idx)),!1)},t.prototype.findFreeVideoElement=function(){for(var e=this._config.videoElements,t=null,o=0;o<e.length;o++){var i=e[o];if(void 0===i.dataset.used||i.dataset.used===VIDEO_ELEMENT_STATE.FREE){t=e[o];break}}if(!t)throw new Error("Unable to find free video element!");return t.dataset.used=VIDEO_ELEMENT_STATE.USED,t},t.prototype.setMainLoopEnable=function(e){var t=this;if(this.mainLoopEnabled!==e)if(this.mainLoopEnabled=e,this._logger.log("setMainLoopEnable(), value=".concat(e)),e){var o=function(){t.mainLoopEnabled&&(t.mainLoopInProcess(),t.mainLoopRafId=requestAnimationFrame(o))};this.mainLoopRafId=requestAnimationFrame(o)}else window.cancelAnimationFrame(this.mainLoopRafId)},t.prototype.mainLoopInProcess=function(){this.updateAccuratePlaytime(),this.checkPlayHealth.loop()},t.prototype.updateAccuratePlaytime=function(){var e;this._state!==exports.VIDEO_STATE.PLAYING||this._video.duration<=0||(null===(e=this.onAccurateTimeupdate)||void 0===e||e.call(this,this._video.currentTime,this._video.duration),this.updatePlaytime(this._video.currentTime,!0))},t.prototype.setCheckLoadTimeoutEnable=function(e){var t=this;if(e){if(this._config.maxPreloadTimeout<=0)return;this.loadTimeoutId=window.setTimeout((function(){t.errorHandler({code:ERROR_CODE.ORG_LOAD_TIMEOUT,message:ERROR_MSG.PRELOAD_VIDEO_TIMEOUT})}),this._config.maxPreloadTimeout)}else this.loadTimeoutId>0&&(clearTimeout(this.loadTimeoutId),this.loadTimeoutId=0)},t.prototype.setEndInner=function(){this._state!==exports.VIDEO_STATE.END&&this._state!==exports.VIDEO_STATE.IDLE&&(this._logger.log("setEndInner(), idx=".concat(this._idx,"/uid=").concat(this._videoInfo.uid,"/playtime=").concat(this._videoInfo.playtime)+"/duration=".concat(this._videoInfo.duration,"}")),this.stateMgr.setEnded(),this.emit(VIDEO_NODE_EVENT.PLAY_OVER,{isUserStop:!1,endState:exports.END_STATE.NORMAL,videoInfo:this._videoInfo}))},t.prototype.stopInner=function(e,t){var o;this._video&&this._videoInfo&&(this.setMainLoopEnable(!1),this.setCheckLoadTimeoutEnable(!1),this._isUserSeek=!1,this._logger.log("stopInner(), uid/state/idx: ".concat(null===(o=this._videoInfo)||void 0===o?void 0:o.uid,"/").concat(this.state,"/").concat(this.idx)),this.setVideoEvents(!1),this._config.clearVideoAfterStop?videoTool.clear(this._video):this._video.pause(),this._config.createVideoNodeWhenLoad&&(this._video.dataset.used=VIDEO_ELEMENT_STATE.FREE),this._videoInfo&&(this._videoInfo.extraVars.isLoadstarted=!1,this._videoInfo=null),this._pauseCloseToEndStateCheckTimeoutId>0&&(window.clearTimeout(this._pauseCloseToEndStateCheckTimeoutId),this._pauseCloseToEndStateCheckTimeoutId=0),this.state!==exports.VIDEO_STATE.IDLE&&(e||(this.stateMgr.setEnded(),this._played=!1,this._levelSwitchingDefer=null,(null==t?void 0:t.error)&&this.emit(VIDEO_NODE_EVENT.ERROR,{videoInfo:t}))))},t.prototype.onVideoEventPause=function(){this._pauseType!==PAUSE_TYPE.INNER&&this.stateMgr.receiveVideoEvt(VIDEO_EVTS.pause)},t.prototype.onVideoEventPlaying=function(){this.setCheckLoadTimeoutEnable(!1),this._isUserSeek=!1,this.updateVideoSize(),uaTool.browser.x5&&this.onVideoEventDurationChange(),this._videoInfo.hasFirstPlaying||this.emit(VIDEO_NODE_EVENT.FIRST_PLAYING,{videoInfo:this._videoInfo}),this.stateMgr.receiveVideoEvt(VIDEO_EVTS.playing),this._videoInfo&&(this._videoInfo.hasFirstPlaying=!0),this._userStartTime=0,this.checkSetLevelOver(VIDEO_EVTS.playing)},t.prototype.onVideoEventRateChange=function(){this.emit(VIDEO_NODE_EVENT.RATE_CHANGE,{playbackRate:this.playbackRate,videoInfo:this._videoInfo})},t.prototype.onVideoEventEnded=function(){this._logger.log("setEndInner(), reason=endedEvt"),this.setEndInner()},t.prototype.onVideoEventSeeked=function(){this.stateMgr.receiveVideoEvt(VIDEO_EVTS.seeked),this.checkSetLevelOver(VIDEO_EVTS.seeked),this.resumeAfterSeek(),this._isUserSeek=!1},t.prototype.resumeAfterSeek=function(){this._played&&!this._video.ended&&this._isUserSeek&&(this._video.paused?this._config.remainPauseStateAfterSeek||this.videoplay():this.stateMgr.setPlaying())},t.prototype.onVideoEventCanplay=function(){this.setCheckLoadTimeoutEnable(!1),this._videoInfo&&(this._videoInfo.qualityInfo.canplaytime||(this._videoInfo.qualityInfo.canplaytime=videoTool.getBuffered(this._video)),this.stateMgr.receiveVideoEvt(VIDEO_EVTS.canplay))},t.prototype.onVideoEventResize=function(){this.updateVideoSize()},t.prototype.onVideoEventDurationChange=function(){this._video.duration>0&&this._video.duration!==this._videoInfo.duration&&(this._videoInfo.duration=this._video.duration,this._logger.log("onVideoEventDurationChange(), uid=".concat(this._videoInfo.uid,"/duration=").concat(this._videoInfo.duration,"/")+"idx=".concat(this.idx)),this.emit(VIDEO_NODE_EVENT.DURATION_CHANGE,{videoInfo:this._videoInfo}))},t.prototype.onVideoEventVolumeChange=function(){this.emit(VIDEO_NODE_EVENT.VOLUME_CHANGE,{volume:this.volume,videoInfo:this._videoInfo})},t.prototype.onVideoEventTimeUpdate=function(){0!==this._video.currentTime&&(this.updatePlaytime(this._video.currentTime),this.checkSetLevelOver(VIDEO_EVTS.timeupdate),this._state===exports.VIDEO_STATE.BUFFERING&&this.stateMgr.setPlaying())},t.prototype.onVideoEventWaiting=function(){this.stateMgr.receiveVideoEvt(VIDEO_EVTS.waiting)},t.prototype.onVideoEventSeeking=function(){this.stateMgr.receiveVideoEvt(VIDEO_EVTS.seeking)},t.prototype.onVideoEventProgress=function(){this.emit(VIDEO_NODE_EVENT.VIDEO_BUFFER_CHANGE,{videoInfo:this._videoInfo})},t.prototype.onVideoEventLoadedmetadata=function(){this.updateVideoSize(),this.emit(VIDEO_NODE_EVENT.METADATA_CHANGE,{videoInfo:this._videoInfo})},t.prototype.updateVideoSize=function(){var e=this._video.videoWidth,t=this._video.videoHeight;!this._videoInfo||this._videoInfo.videoWidth===e&&this._videoInfo.videoHeight===t||(this._videoInfo.videoWidth=e,this._videoInfo.videoHeight=t,this.emit(VIDEO_NODE_EVENT.VIDEO_RESIZE,{videoInfo:this._videoInfo}),this.adjustmentVideoSizeIfSmallBorder())},t.prototype.addVideoElementResizeObserver=function(){var e=this;window.ResizeObserver&&this._video instanceof HTMLVideoElement&&(this.videoResizeObserver=new ResizeObserver((function(t){e.adjustmentVideoSizeIfSmallBorder()})),this.videoResizeObserver.observe(this._video))},t.prototype.removeVideoElementResizeObserver=function(){this.videoResizeObserver&&this._video&&this._video instanceof HTMLVideoElement&&(this.videoResizeObserver.disconnect(),this.videoResizeObserver.unobserve(this._video),this.videoResizeObserver=null)},t.prototype.adjustmentVideoSizeIfSmallBorder=function(){if(this._video instanceof HTMLVideoElement&&this._videoInfo&&!(this._config.minFillBlackBorder<=0)){var e=domTool.getDomSize(this._video),t=e.width,o=e.height,i=this._videoInfo.videoWidth*(o/this._videoInfo.videoHeight),r=this._videoInfo.videoHeight*(t/this._videoInfo.videoWidth),n=this._config.minFillBlackBorder;i<t&&i>=t-n||r<o&&r>=o-n?videoTool.setElementFitType(this._video,"cover"):videoTool.setElementFitType(this._video,"contain")}},t.prototype.onVideoEventLoadeddata=function(){this.emit(VIDEO_NODE_EVENT.VIDEO_BUFFER_CHANGE,{videoInfo:this._videoInfo})},t.prototype.onVideoEventError=function(){this.errorHandler()},t.prototype.errorHandler=function(e){var t=this.parseErrorData(e);this._logger.log("errorHandler(), error: ",t),this.retryWhenError(t)},t.prototype.parseErrorData=function(e){var t,o,i;if(e)return{code:void 0===(t=e.code)?ERROR_CODE.UNKNOWN_ERR:t,message:void 0===(o=e.message)?ERROR_MSG.UNKNOWN:o};var r=VIDEO_ELEMENT_ERROR[null===(i=this.videoElement.error)||void 0===i?void 0:i.code]||{code:ERROR_CODE.UNKNOWN_ERR,message:ERROR_MSG.UNKNOWN};return{code:r.code,message:r.message}},t.prototype.retryWhenError=function(e){var t=this._videoInfo,o=this.setRetryUrl(t),i=t.config.expireTimeStamp,r=void 0!==i&&i<+new Date;if(e.fatal||r||!o)this._logger.log("retryOnError(), fatal."),this._videoInfo.error=e,this.stopInner(!1,this._videoInfo);else{var n=t.getRetryCount();this._logger.log("retryOnError(), retryCount=",n),this.emit(VIDEO_NODE_EVENT.RETRY,__assign$7({error:e,retryCount:n,videoInfo:t},o)),this.stopInner(!0),this.stateMgr.setWaiting(),this._state!==exports.VIDEO_STATE.BUFFERING&&this.setLoading(!0);var a=t.playtime,s=this._played?a:this._userStartTime;(this._played?this.play.bind(this):this.load.bind(this))(t,{startTime:s})}},t.prototype.onDrmError=function(e){var t=e.data,o=t.code,i=t.message;this._logger.log("onDrmError(), code=".concat(o,"/msg=").concat(i)),this._videoInfo.error=e.data,this.stopInner(!1,this._videoInfo)},t.prototype.setHealthEvents=function(){var e=this,t=function(t){e._logger.warn("get health evt!!! evt=".concat(t.type,"/uid=").concat(e._videoInfo.uid,"/state=").concat(e._state)),e.retryWhenError(t.data)};this.checkPlayHealth.on(HEALTH_EVTS.STATE_STUCK,t),this.checkPlayHealth.on(HEALTH_EVTS.PLAYTIME_STUCK,t)},t.prototype.setVideoEvents=function(e){var t,o=this;this._eventAddedMap.videoEventAdded!==e&&(this._logger.log("setVideoEvents(), idx=".concat(this._idx,"/value=").concat(e,"/uid=").concat(null===(t=this._videoInfo)||void 0===t?void 0:t.uid)),this._eventAddedMap.videoEventAdded=e,Object.keys(this._videoEventMap).forEach((function(t){e?o._video.addEventListener(t,o._eventMap.video):o._video.removeEventListener(t,o._eventMap.video)})))},t.prototype.setLoading=function(e,t){var o=this;void 0===t&&(t=0),this._setLoadingDelayTimeoutId>0&&(window.clearTimeout(this._setLoadingDelayTimeoutId),this._setLoadingDelayTimeoutId=0),e?t>0?this._setLoadingDelayTimeoutId=window.setTimeout((function(){o.emit(VIDEO_NODE_EVENT.SET_LOADING,{show:!0})}),t):this.emit(VIDEO_NODE_EVENT.SET_LOADING,{show:!0}):this.emit(VIDEO_NODE_EVENT.SET_LOADING,{show:!1})},t.prototype.onVideoEvents=function(e){var t,o=this;if(this.state!==exports.VIDEO_STATE.IDLE&&this._videoInfo&&!this._evtBlocking){"timeupdate"!==e.type&&"progress"!==e.type&&this._logger.log("videoevt, uid=".concat(this._videoInfo.uid,"/idx=").concat(this.idx,"/type=").concat(e.type,"/")+"time=".concat(this._video.currentTime,"/duration=").concat(this._video.duration)),this.emit(VIDEO_NODE_EVENT.ELEMENT_EVTS,{videoInfo:this._videoInfo,elementEvtType:e.type});var i=Math.abs(this._videoInfo.duration-this._videoInfo.playtime)<.1&&this._videoInfo.duration>0;"pause"===e.type&&i?this._pauseCloseToEndStateCheckTimeoutId=window.setTimeout((function(){o._videoEventMap[e.type]&&o._videoEventMap[e.type](e)}),0):("ended"===e.type&&this._pauseCloseToEndStateCheckTimeoutId>0&&(window.clearTimeout(this._pauseCloseToEndStateCheckTimeoutId),this._pauseCloseToEndStateCheckTimeoutId=0),this._videoEventMap[e.type]&&this._videoEventMap[e.type](e))}else this._logger.log("videoevt discard, idx=".concat(this._idx,"/uid=").concat(null===(t=this._videoInfo)||void 0===t?void 0:t.uid,"/evttype=").concat(e.type,"/")+"state=".concat(this.state,"/evtBlocking=").concat(this._evtBlocking))},t.prototype.createStream=function(e){return null},t.prototype.setRetryUrl=function(e){var t=e.loadingUrl;return e.setNextBackUrl()?{prevUrl:t,curUrl:e.loadingUrl}:null},t.prototype.triggerAutoplay=function(){var e=this;return this._evtBlocking=!0,this._autoPlayPolicy.userTrigger().then((function(){return e._evtBlocking=!1})).catch((function(t){throw e._evtBlocking=!1,t}))},Object.defineProperty(t.prototype,"useWorker",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"idx",{get:function(){return this._idx},set:function(e){this._idx=e,this._video.dataset.idx="".concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoElement",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoSize",{get:function(){return{width:this._video.videoWidth,height:this._video.videoHeight}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoBuffered",{get:function(){return videoTool.getBuffered(this._video)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){return this._video.playbackRate},set:function(e){this._playbackRate=e;try{this._video.playbackRate=e}catch(e){this._logger.warn("set playbackRate: ".concat(null==e?void 0:e.message))}},enumerable:!1,configurable:!0}),t.prototype.videoplay=function(){var e,t=this;this._logger.log("videoplay(), uid=".concat(null===(e=this._videoInfo)||void 0===e?void 0:e.uid,"/state=").concat(this.state,"/idx=").concat(this.idx));var o=this._video.play();return o&&o.catch((function(e){t._logger.warn("".concat(t.idx," play() catch: ").concat(e.name,", ").concat(e.message));var o=videoTool.isAutoPlayBlockedMessage(e.message);o&&t.setLoading(!1),t.emit(VIDEO_NODE_EVENT.PLAY_PROMISE_CATCHED,{videoInfo:t._videoInfo,isAutoPlayBlocked:o})})),this._video.playbackRate=this._playbackRate,o},Object.defineProperty(t.prototype,"currentVideoInfo",{get:function(){return this._videoInfo},enumerable:!1,configurable:!0}),t.prototype.pause=function(){this._played?this.stateMgr.validCallState(exports.VIDEO_STATE.PAUSE)?this.pauseInner(PAUSE_TYPE.USER):this._logger.log("call pause in invaild state ".concat(this._state)):this._logger.warn("pause(), VideoNode has not been played")},t.prototype.pauseInner=function(e){var t;void 0===e&&(e=PAUSE_TYPE.INNER),this._logger.log("pause(), uid=".concat(null===(t=this._videoInfo)||void 0===t?void 0:t.uid,"/state=").concat(this.state,"/idx=").concat(this.idx,"/type=").concat(e)),this._pauseType=e,this._video.pause()},t.prototype.resume=function(){throw new Error("not implements")},Object.defineProperty(t.prototype,"supportPlaybackRate",{get:function(){return!uaTool.browser.x5},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=this._videoInfo?this._videoInfo.duration:0;return Number.isNaN(e)?0:e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._video.muted?0:this._video.volume},set:function(e){e<0||e>1?this._logger.warn("The volume value range is [0,1]"):(this._video.volume=e,this._video.muted=e<=0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playtime",{get:function(){return this._videoInfo?this._videoInfo.playtime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){var t;if(this._state!==e){var o=this._state;this._state=e,this._videoInfo&&(this._videoInfo.state=this._state),this._logger.log("set state(), uid=".concat(null===(t=this._videoInfo)||void 0===t?void 0:t.uid,"/idx=").concat(this._idx,"/old=").concat(o,"/new=").concat(e));var i={videoInfo:this._videoInfo,new:e,old:o};e===exports.VIDEO_STATE.PAUSE?(i.pauseType=this._pauseType||PAUSE_TYPE.SYS,this._pauseType=void 0):e===exports.VIDEO_STATE.SEEKING?(i.seekingTime=this._targetSeekTime,i.isUserSeek=this._isUserSeek,this._targetSeekTime=-1):e===exports.VIDEO_STATE.SEEKED&&(i.isUserSeek=this._isUserSeek),this.setLoadingOnStateChange(),this.emit(VIDEO_NODE_EVENT.STATE_CHANGE,i)}},enumerable:!1,configurable:!0}),t.prototype.stop=function(){this.stopInner()},t.prototype.updatePlaytime=function(e,t){if(void 0===t&&(t=!1),this._videoInfo){var o=videoTool.getVideoPlaybackQuality(this._video),i=o.totalVideoFrames,r=o.droppedVideoFrames;this._videoInfo.qualityInfo.totalVideoFrames=i,this._videoInfo.qualityInfo.droppedVideoFrames=r,this._videoInfo.playtime!==e&&(this._videoInfo.playtime=e),t||this.emit(VIDEO_NODE_EVENT.TIME_UPDATE,{videoInfo:this._videoInfo})}},t.prototype.destroy=function(){var e,t,o,i;this.stopInner(),this._video&&(this._eventMap&&(this.setVideoEvents(!1),this._eventMap=null),videoTool.clear(this._video),videoTool.removeElement(this._video,this._videoElementContainer),this._video.dataset.used=VIDEO_ELEMENT_STATE.FREE),null===(e=this._autoPlayPolicy)||void 0===e||e.destroy(),null===(t=this.stateMgr)||void 0===t||t.destroy(),this.removeAllListeners(),this.removeVideoElementResizeObserver(),null===(o=this._drm)||void 0===o||o.destroy(),this._autoPlayPolicy=null,this._video=null,this._videoInfo=null,this._videoElementContainer=null,this._played=!1,this._config=null,null===(i=this.checkPlayHealth)||void 0===i||i.destroy(),this._logger.log("VideoNode has been destroyed!")},t.prototype.setLoadingOnStateChange=function(){if(this._played)if([exports.VIDEO_STATE.BUFFERING,exports.VIDEO_STATE.SEEKING].includes(this._state)){this.setLoading(!0,500)}else(this._config.type===exports.PLAY_MODE.LIVE&&exports.VIDEO_STATE.CANPLAY!==this._state||this._config.type===exports.PLAY_MODE.VOD)&&this.setLoading(!1);else this.setLoading(!1)},__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[String]),__metadata$7("design:returntype",Promise)],t.prototype,"setLevel",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[Boolean]),__metadata$7("design:returntype",void 0)],t.prototype,"setCheckLoadTimeoutEnable",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[]),__metadata$7("design:returntype",void 0)],t.prototype,"setEndInner",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[Boolean,Object]),__metadata$7("design:returntype",void 0)],t.prototype,"stopInner",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[Object]),__metadata$7("design:returntype",void 0)],t.prototype,"retryWhenError",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[]),__metadata$7("design:returntype",void 0)],t.prototype,"pause",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[String]),__metadata$7("design:returntype",void 0)],t.prototype,"pauseInner",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[]),__metadata$7("design:returntype",void 0)],t.prototype,"stop",null),__decorate$7([logMethodCall$7,__metadata$7("design:type",Function),__metadata$7("design:paramtypes",[]),__metadata$7("design:returntype",void 0)],t.prototype,"destroy",null),t}(s$1),__extends$7=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__decorate$6=window&&window.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__metadata$6=window&&window.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},logMethodCall$6=logMethodCallDecoratorCreator("OrgVideoNode"),OrgVideoNode=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$7(t,e),t.prototype.onVideoEventCanplay=function(){var t;null===(t=this._canplayDefer)||void 0===t||t.resolve(),e.prototype.onVideoEventCanplay.call(this)},t.prototype.onVideoEventLoadedmetadata=function(){e.prototype.onVideoEventLoadedmetadata.call(this),(uaTool.os.ios||uaTool.browser.safari)&&[exports.PRELOAD_TYPE.META_DATA,exports.PRELOAD_TYPE.AUTO].includes(this._config.preloadType)&&this.onVideoEventCanplay()},t.prototype.onVideoEventLoadeddata=function(){e.prototype.onVideoEventLoadeddata.call(this),this.checkPlayInitSeek()},t.prototype.onVideoEventTimeUpdate=function(){e.prototype.onVideoEventTimeUpdate.call(this),this.checkPlayInitSeek()},t.prototype.load=function(e,t){var o=this;return!!e.loadingUrl&&(this.stopInner(!0),this._drm.init(e.config.drmConfig),this._videoInfo=e,this._videoInfo.extraVars.isLoadstarted=!0,this.setVideoEvents(!0),this.stateMgr.setLoadStart(),this.assignStartTime((null==t?void 0:t.startTime)||0),this._video.src=this._videoInfo.loadingUrl,this._logger.log("load(), loadingUrl=".concat(this._videoInfo.loadingUrl)),this._config.preloadType===exports.PRELOAD_TYPE.AUTO_LOAD&&this._video.load(),this.setCheckLoadTimeoutEnable(!0),this._canplayDefer=new SimpleDefer,videoTool.notSupportLoadBeforeHasUserGestures()&&(this._logger.log("load(), notSupportLoadBeforeHasUserGestures"),setTimeout((function(){o.onVideoEventCanplay()}))),!0)},t.prototype.play=function(e,t){var o=this;this._logger.log("play(), uid=".concat(null==e?void 0:e.uid,"/idx=").concat(this.idx,"/state=").concat(this.state)),this._played=!0,e&&!e.extraVars.isLoadstarted&&this.load(e,t);var i=null;return uaTool.browser.safari&&this._canplayDefer?this._canplayDefer.promise.then((function(){o.videoplay()})):i=this.videoplay(),this.setMainLoopEnable(!0),i},t.prototype.assignStartTime=function(e){if(this._config.type!==exports.PLAY_MODE.LIVE){this._userStartTime=e;var t=!Number.isNaN(e)&&e>=0?e:0;t<=0||(videoTool.supportMediaFragmentsURISpec(this._config.enableMediaFragmentsURI)&&!this._videoInfo.loadingUrl.startsWith("blob:")?(this._logger.log("assignStartTime by #t"),this._videoInfo.setLoadingUrlStartTime(t)):(this._logger.log("assignStartTime with seek()"),this._needPlaySeektime=t))}},t.prototype.checkPlayInitSeek=function(){this._needPlaySeektime>0&&this._videoInfo&&this._video.duration>0&&(this._logger.log("checkPlayInitSeek(), idx=".concat(this.idx,"/seektime=").concat(this._needPlaySeektime)),this.seek(this._needPlaySeektime),this._needPlaySeektime=0)},t.prototype.stopInner=function(t,o){this._canplayDefer=null,this._needPlaySeektime=0,e.prototype.stopInner.call(this,t,o)},t.prototype.seek=function(e,t){void 0===t&&(t=!1);var o=e;return!!this.checkCanSeek(o,t)&&(Math.abs(o-this._videoInfo.duration)<=1&&(o=this._videoInfo.duration-1),this._isUserSeek=t,this._logger.log("seek(), uid".concat(this._videoInfo.uid,"/idx=").concat(this.idx,"/time=").concat(o,"/duration=").concat(this._video.duration,"/")+"state=".concat(this.state)),this._targetSeekTime=o,this._video.currentTime=o,!0)},t.prototype.updateAccuratePlaytime=function(){e.prototype.updateAccuratePlaytime.call(this);var t=Math.abs(this._video.duration-this._video.currentTime),o=this._config.originKernelConfig.advanceEndTime;o>0&&t<=o&&(this._logger.log("setEndInner(), reason=leftTimeCheck"),this.setEndInner())},t.prototype.setEndInner=function(){this.state!==exports.VIDEO_STATE.END&&this.state!==exports.VIDEO_STATE.IDLE&&(this.onAccurateTimeupdate&&this.onAccurateTimeupdate(0),this.updatePlaytime(this._video.currentTime)),e.prototype.setEndInner.call(this)},__decorate$6([logMethodCall$6,__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[Object,Object]),__metadata$6("design:returntype",void 0)],t.prototype,"load",null),__decorate$6([logMethodCall$6,__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[Object,Object]),__metadata$6("design:returntype",void 0)],t.prototype,"play",null),__decorate$6([logMethodCall$6,__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[Boolean,Object]),__metadata$6("design:returntype",void 0)],t.prototype,"stopInner",null),__decorate$6([logMethodCall$6,__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[Number,Object]),__metadata$6("design:returntype",void 0)],t.prototype,"seek",null),t}(BaseVideoNode);function getEnvVals$1(){var e="npm";try{e="npm"}catch(e){}var t="";try{t="1.4.94"}catch(e){}var o="";try{o=1655287215335}catch(e){}var i=!1;try{i=!1}catch(e){}return{CHANNEL:e,VERSION:t,BUILD_TIME:o,LOCAL_DEV:i}}var _a$7=getEnvVals$1(),CHANNEL$1=_a$7.CHANNEL,BUILD_TIME$2=_a$7.BUILD_TIME,VERSION$3=_a$7.VERSION,LOCAL_DEV=_a$7.LOCAL_DEV,defaultPlayerConfig={type:exports.PLAY_MODE.VOD,interruptPlayNextMinTime:1,backupUrlsMaxRetryCount:5,maxPreloadTimeout:3e4,maxBufferingTimeout:3e4,maxStateStalledTime:3e4,maxPlaytimeStalledTime:1e4,isPlayList:!1,preloadType:exports.PRELOAD_TYPE.AUTO_LOAD,maxVideoNodeCount:1,minFillBlackBorder:10},__extends$6=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__assign$6=window&&window.__assign||function(){return __assign$6=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$6.apply(this,arguments)},__decorate$5=window&&window.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__metadata$5=window&&window.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter$3=window&&window.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},__generator$3=window&&window.__generator||function(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},CHANNEL_MAP;!function(e){e[e.cdn=1]="cdn",e[e.npm=0]="npm"}(CHANNEL_MAP||(CHANNEL_MAP={}));var logMethodCall$5=logMethodCallDecoratorCreator("KernelProxy"),loadKernelDeferMap={},KernelProxy=function(e){function t(t){var o,i,r,n=this;return(n=e.call(this)||this)._volume=1,n._videoElements=[],n._addedEvts=[],void 0===t.instanceId&&(t.instanceId=comTool.createGUID()),n._logger=new Logger(t.instanceId,"KernelProxy"),n._config=__assign$6(__assign$6(__assign$6({},defaultPlayerConfig),t),{maxVideoNodeCount:null!==(r=null!==(o=t.maxVideoNodeCount)&&void 0!==o?o:null===(i=t.originKernelConfig)||void 0===i?void 0:i.maxVideoNodeCount)&&void 0!==r?r:defaultPlayerConfig.maxVideoNodeCount}),t.logLevel>PLAYER_LOG_LEVEL.NONE&&enableConsoleOutput(),n._config.videoElements||(n._config.videoElements=n.createVideoElements()),n.createVideoElementsContainer(),n._kernelEvtHandler=n.kernelEvtHandler.bind(n),n.collectUsage(n.prepareUsageData()),n}return __extends$6(t,e),Object.defineProperty(t.prototype,"isCollected",{get:function(){return t._isCollected},set:function(e){t._isCollected=e},enumerable:!1,configurable:!0}),t.prototype.prepareUsageData=function(){var e=CHANNEL_MAP[CHANNEL$1],t=urlTool.getTopFrameUrl(),o=null==t?void 0:t.split("?")[0],i=urlTool.getDomainOfURL(t);return{attaid:"05700050920",token:"3619167286",topUrl:"".concat(encodeURIComponent(t)),pageUrl:"".concat(encodeURIComponent(o)),domain:"".concat(encodeURIComponent(i)),channel:"".concat(e),from:"".concat(0),version:VERSION$3,_dc:"".concat(Math.random())}},t.prototype.collectUsage=function(e){if(!this.isCollected){this.isCollected=!0;var t=Object.keys(KernelFactory$1.kernelMap).join("$");(new Image).src="https://h.trace.qq.com/kv?".concat(urlTool.object2string(__assign$6(__assign$6({},e),{kernel:t}),"&"))}},Object.defineProperty(t.prototype,"config",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.config)||this._config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useWorker",{get:function(){var e;return!!(null===(e=this._kernel)||void 0===e?void 0:e.useWorker)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernelName",{get:function(){var e;return null===(e=this._kernel)||void 0===e?void 0:e.kernelName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoElements",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.videoElements)||[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoElement",{get:function(){var e;return null===(e=this._kernel)||void 0===e?void 0:e.currentVideoElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPreload",{get:function(){var e;return!!(null===(e=this._kernel)||void 0===e?void 0:e.supportPreload)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.duration)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playtime",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.playtime)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoInfos",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.videoInfos)||[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preloadVideoInfos",{get:function(){var e;return null===(e=this._kernel)||void 0===e?void 0:e.preloadVideoInfos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoInfo",{get:function(){var e;return null===(e=this._kernel)||void 0===e?void 0:e.currentVideoInfo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoInfoIdx",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.currentVideoInfoIdx)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalVideoInfoCount",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.totalVideoInfoCount)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPlaybackRate",{get:function(){var e;return!!(null===(e=this._kernel)||void 0===e?void 0:e.supportPlaybackRate)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"played",{get:function(){var e;return!!(null===(e=this._kernel)||void 0===e?void 0:e.played)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.state)||exports.VIDEO_STATE.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoSize",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.videoSize)||{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoBuffered",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.videoBuffered)||[]},enumerable:!1,configurable:!0}),t.prototype.captureVideo=function(e,t,o,i,r){var n;return null===(n=this._kernel)||void 0===n?void 0:n.captureVideo(e,t,o,i,r)},t.prototype.log=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null===(e=this._logger)||void 0===e||e.log.apply(e,t)},t.prototype.warn=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null===(e=this._logger)||void 0===e||e.warn.apply(e,t)},t.prototype.error=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null===(e=this._logger)||void 0===e||e.error.apply(e,t)},t.prototype.hasAppended=function(e){var t;return!!(null===(t=this._kernel)||void 0===t?void 0:t.hasAppended(e))},t.prototype.hasPreloaded=function(e){var t;return!!(null===(t=this._kernel)||void 0===t?void 0:t.hasPreloaded(e))},Object.defineProperty(t.prototype,"volume",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.volume)||this._volume},set:function(e){this._volume=e,this._kernel?this._kernel.volume=e:this.emit(exports.PLAY_EVENT.VOLUME_CHANGE,{volume:e})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){var e;return(null===(e=this._kernel)||void 0===e?void 0:e.playbackRate)||this._playbackRate},set:function(e){this._playbackRate=e,this._kernel?this._kernel.playbackRate=e:this.emit(exports.PLAY_EVENT.RATE_CHANGE,{playbackRate:e})},enumerable:!1,configurable:!0}),t.prototype.resizeVideoElements=function(e){var t;null===(t=this._kernel)||void 0===t||t.resizeVideoElements(e)},t.prototype.resize=function(e){var t;null===(t=this._kernel)||void 0===t||t.resize(e)},t.prototype.seek=function(e){var t;return null===(t=this._kernel)||void 0===t?void 0:t.seek(e)},t.prototype.play=function(e,t){var o;return __awaiter$3(this,void 0,void 0,(function(){var i;return __generator$3(this,(function(r){switch(r.label){case 0:return e?[4,this.checkWhetherNeedToSwitchKernel(e,t)]:[3,2];case 1:if(i=r.sent().error)return this.emit(exports.PLAY_EVENT.ERROR,{videoInfo:{error:i}}),[2,Promise.reject(i)];r.label=2;case 2:return[2,null===(o=this._kernel)||void 0===o?void 0:o.play(e,t)]}}))}))},t.prototype.load=function(e,t){var o;return __awaiter$3(this,void 0,void 0,(function(){var i;return __generator$3(this,(function(r){switch(r.label){case 0:return e?[4,this.checkWhetherNeedToSwitchKernel(e,t)]:[3,2];case 1:if(i=r.sent().error)return this.emit(exports.PLAY_EVENT.ERROR,{videoInfo:{error:i}}),[2,Promise.reject(i)];r.label=2;case 2:return[2,null===(o=this._kernel)||void 0===o?void 0:o.load(e,t)]}}))}))},t.prototype.playNext=function(e){var t;null===(t=this._kernel)||void 0===t||t.playNext(e)},t.prototype.pause=function(e){var t;null===(t=this._kernel)||void 0===t||t.pause(e)},t.prototype.stop=function(e){var t;null===(t=this._kernel)||void 0===t||t.stop(e)},t.prototype.appendNext=function(e){var t;return!!(null===(t=this._kernel)||void 0===t?void 0:t.appendNext(e))},t.prototype.preloadNext=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return null===(e=this._kernel)||void 0===e?void 0:e.preloadNext.apply(e,t)},t.prototype.clearAllPreload=function(){var e;null===(e=this._kernel)||void 0===e||e.clearAllPreload()},t.prototype.triggerAutoplay=function(){var e,t=this;if(!this._kernel){this._logger.log("triggerAutoplay(), start");var o=this._videoElements.map((function(e){return new AutoPlayPolicy(e,{instanceId:t._config.instanceId}).userTrigger()}));return Promise.all(o)}return null===(e=this._kernel)||void 0===e?void 0:e.triggerAutoplay()},t.prototype.setLevel=function(e,t,o){return __awaiter$3(this,void 0,void 0,(function(){var i,r,n,a,s;return __generator$3(this,(function(l){switch(l.label){case 0:return this._kernel?(i="string"==typeof e?__assign$6(__assign$6({},o),{url:e}):e,r=this.currentVideoInfo,[4,this.checkWhetherNeedToSwitchKernel(i,null,!0)]):[2,Promise.reject("切换清晰度时找不到内核")];case 1:return n=l.sent(),a=n.isKernelSwitched,(null==(s=n.error)?void 0:s.message)?[2,Promise.reject(null==s?void 0:s.message)]:a?[2,this.setLevelWhenKernelSwitched(__assign$6(__assign$6(__assign$6({},i),{backupUrls:t}),o),r)]:"string"==typeof e?[2,this._kernel.setLevel(e,t,o)]:[2,this._kernel.setLevel(e)]}}))}))},t.prototype.destroy=function(){var e,t;this._videoElements&&(this._videoElements.forEach((function(e){videoTool.destroyElement(e)})),this._videoElements=null),(null===(e=this.videoElementsContainer)||void 0===e?void 0:e.parentNode)&&this.videoElementsContainer.remove(),this._kernel&&(this.setKernelEvts(!1),null===(t=this._kernel)||void 0===t||t.destroy(),this._kernel=null),this.removeAllListeners(),this._kernelEvtHandler=null,this._config=null},t.prototype.checkWhetherNeedToSwitchKernel=function(e,t,o){return void 0===o&&(o=!1),__awaiter$3(this,void 0,void 0,(function(){var i,r,n,a,s;return __generator$3(this,(function(l){switch(l.label){case 0:return i=e instanceof Array?e[0]:e,r=i.kernelName||(null==t?void 0:t.kernelName),(n=KernelFactory$1.selectKernel(e,r))?KernelFactory$1.kernelMap[n]?[3,2]:[4,this.loadKernel(n)]:[3,3];case 1:l.sent(),l.label=2;case 2:if(KernelFactory$1.kernelMap[n]&&!KernelFactory$1.kernelMap[n].isEnvSupport)return a=getUrlConfigVideoType(i),[2,{isKernelSwitched:!1,error:{code:ERROR_CODE.KERNEL_NOT_SPT,message:n===exports.KERNEL_NAME.ORIGIN?"无法支持".concat(a,"格式播放"):"".concat(a,"格式需要").concat(n,"内核播放，但当前环境不支持此内核")}}];l.label=3;case 3:return s=KernelFactory$1.kernelMap[n]?n:exports.KERNEL_NAME.ORIGIN,this._kernel&&this._kernel.kernelName!==s&&(this._kernel.played&&!o&&this.emit(exports.PLAY_EVENT.STOPED,{videoInfo:this._kernel.currentVideoInfo,endState:exports.END_STATE.INTERRUPT}),this.setKernelEvts(!1),this._kernel.destroy(),this._kernel=null),this._kernel?[3,5]:[4,this.createKernel(s)];case 4:return l.sent(),[2,{isKernelSwitched:!0,error:null}];case 5:return[2,{isKernelSwitched:!1,error:null}]}}))}))},t.prototype.loadKernel=function(e,t){return void 0===t&&(t=3),__awaiter$3(this,void 0,void 0,(function(){var o,i,r,n;return __generator$3(this,(function(a){switch(a.label){case 0:return(o=KERNEL_NAME_2_CDN_PATH_MAP[e])?loadKernelDeferMap[e]?(this._logger.log("auto download kernel [".concat(o,"] has been started!")),[4,loadKernelDeferMap[e].promise]):[3,2]:[2,!1];case 1:return i=a.sent(),this._logger.log("auto download kernel [".concat(o,"] succ=").concat(i)),[2,i];case 2:loadKernelDeferMap[e]=new SimpleDefer,this._logger.log("auto download kernel [".concat(o,"]")),r=!1,n=0,a.label=3;case 3:if(!(n<t))return[3,9];a.label=4;case 4:return a.trys.push([4,6,,7]),[4,domTool.loadScript(CDN_PATH_PREFIX+o)];case 5:return a.sent(),this._logger.log("auto download kernel [".concat(o,"] succ=true")),r=!0,[3,7];case 6:return a.sent(),r=!1,this._logger.error("auto download kernel [".concat(o,"] failed")),[3,7];case 7:if(r)return[3,9];a.label=8;case 8:return n++,[3,3];case 9:return loadKernelDeferMap[e].resolve(r),[2,r]}}))}))},t.prototype.createKernel=function(e){this._kernel=KernelFactory$1.createKernel(e,this._config),void 0!==this._volume&&(this._kernel.volume=this._volume),void 0!==this._playbackRate&&(this._kernel.playbackRate=this._playbackRate),this.setKernelEvts(!0)},t.prototype.createVideoElements=function(){for(var e=this._config,t=e.instanceId,o=e.videoElementConfig,i=e.maxVideoNodeCount,r=__assign$6(__assign$6({preload:this._config.preloadType===exports.PRELOAD_TYPE.META_DATA?"metadata":"auto"},o),{playerid:t}),n=0;n<i;n++){var a=domTool.createVideoDom(r);this._videoElements.push(a)}return this._videoElements},t.prototype.createVideoElementsContainer=function(){var e=this._config.container,t=domTool.getElementFromConfig(e);this.videoElementsContainer=domTool.creatDom('\n      <div class="'.concat(VIDEO_CONTAINER_CLASS,'" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:0;">\n      </div>\n    ').trim()),domTool.append(t,this.videoElementsContainer)},t.prototype.on=function(t,o,i){return e.prototype.on.call(this,t,o,i),this.proxyEvent(t),this},t.prototype.once=function(t,o,i){return e.prototype.once.call(this,t,o,i),this.proxyEvent(t,!0),this},t.prototype.setKernelEvts=function(e){var t=this;if(this._kernel){e&&this.setKernelEvts(!1);var o=e?this._kernel.on:this._kernel.off;this._addedEvts.forEach((function(e){o.apply(t._kernel,[e,t._kernelEvtHandler])}))}},t.prototype.kernelEvtHandler=function(e){this.setLevelWhenKernelSwitchedDefer?this.checkSetLevelOverWhenKernelSwitched(e)&&(this.setLevelWhenKernelSwitchedDefer=null):this.emit(e.type,e.data)},t.prototype.setLevelWhenKernelSwitched=function(e,t){return this.emit(exports.PLAY_EVENT.SETLEVEL_START,{videoInfo:t,mode:SET_LEVEL_MODE.HARD}),this._kernel.play(e,{startTime:(null==t?void 0:t.playtime)||0}),this.setLevelWhenKernelSwitchedDefer=new SimpleDefer,this.setLevelWhenKernelSwitchedDefer.promise},t.prototype.checkSetLevelOverWhenKernelSwitched=function(e){var t;return e.type===exports.PLAY_EVENT.STATE_CHANGE&&e.data.new===exports.VIDEO_STATE.PLAYING?(this.setLevelWhenKernelSwitchedDefer.resolve(),this.emit(exports.PLAY_EVENT.SETLEVEL_OVER,{videoInfo:this.currentVideoInfo}),!0):e.type===exports.PLAY_EVENT.ERROR&&(this.setLevelWhenKernelSwitchedDefer.reject(null===(t=e.data.videoInfo)||void 0===t?void 0:t.error),this.emit(exports.PLAY_EVENT.SETLEVEL_OVER,{videoInfo:this.currentVideoInfo,fail:!0}),!0)},t.prototype.proxyEvent=function(e,t){void 0===t&&(t=!1),this._addedEvts.includes(e)||(this._addedEvts.push(e),this._kernel&&(t?this._kernel.once(e,this._kernelEvtHandler):this._kernel.on(e,this._kernelEvtHandler)))},t._isCollected=!1,__decorate$5([logMethodCall$5,__metadata$5("design:type",Function),__metadata$5("design:paramtypes",[Object,Object]),__metadata$5("design:returntype",Promise)],t.prototype,"play",null),__decorate$5([logMethodCall$5,__metadata$5("design:type",Function),__metadata$5("design:paramtypes",[Object,Object]),__metadata$5("design:returntype",Promise)],t.prototype,"load",null),__decorate$5([logMethodCall$5,__metadata$5("design:type",Function),__metadata$5("design:paramtypes",[Object,Array,Object]),__metadata$5("design:returntype",Promise)],t.prototype,"setLevel",null),__decorate$5([logMethodCall$5,__metadata$5("design:type",Function),__metadata$5("design:paramtypes",[]),__metadata$5("design:returntype",void 0)],t.prototype,"destroy",null),__decorate$5([logMethodCall$5,__metadata$5("design:type",Function),__metadata$5("design:paramtypes",[Object,Object,Object]),__metadata$5("design:returntype",Promise)],t.prototype,"checkWhetherNeedToSwitchKernel",null),__decorate$5([logMethodCall$5,__metadata$5("design:type",Function),__metadata$5("design:paramtypes",[String]),__metadata$5("design:returntype",void 0)],t.prototype,"createKernel",null),t}(s$1),_a$6,UrlParamKey$1;function assignApiToPrototype(e,t,o){for(var i=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(t),n=0,a=o.length;n<a;n++){var s=o[n];-1!==r.indexOf(s)||"function"!=typeof i[s]||(t[s]=i[s].bind(e))}}!function(e){e.forceKernel="__forceKernel"}(UrlParamKey$1||(UrlParamKey$1={}));var KernelFactory=function(){function e(){}return e.registerKernel=function(e,t){if(this.kernelMap){if(this.kernelMap[e]&&t)throw new Error("".concat(e," has been registered!"));this.kernelMap[e]=t}},e.getKernelByName=function(t){return e.kernelMap[t]},e.create=function(e){return new KernelProxy(e)},e.createKernel=function(t,o){if(t){var i=e.kernelMap[t];if(!i)throw new Error("Can't find [".concat(t,"] kernel"));if(i.isEnvSupport){var r=new i(o);return i.exportApis&&assignApiToPrototype(r,KernelProxy.prototype,i.exportApis),r}window.console.log("Browser does not support kernelName[".concat(t,"]"))}return new e.kernelMap.origin(o)},e.checkKernelIsSupportUrlConfig=function(e,t){var o=getUrlConfigVideoType(t);return!!this.selectKernelWithAssign(e,o)},e.selectKernel=function(e,t){var o=e instanceof Array?e[0]:e,i=getUrlConfigVideoType(o);return this.selectKernelFromUrl()||this.selectKernelWhenDrm(o)||this.selectKernelWithAssign(t,i)||this.selectKernelIfSpecialVideoType(i)||t||this.selectKernelFromInstalledList(i)||this.selectKernelInPresetMap(i)},e.selectKernelFromUrl=function(){return urlTool.getUrlParamByKey(location.href,UrlParamKey$1.forceKernel)},e.selectKernelWhenDrm=function(e){var t;return[KeySystems.FairPlay,KeySystems.FairPlayWebKit].includes(null===(t=e.drmConfig)||void 0===t?void 0:t.keySystem)?exports.KERNEL_NAME.ORIGIN:e.vcodec===CODEC.H264&&e.chachaParam?exports.KERNEL_NAME.HLS_JS:e.vcodec===CODEC.H265&&e.chachaParam?!uaTool.mobile&&uaTool.browser.safari?exports.KERNEL_NAME.HLS_JS:exports.KERNEL_NAME.WASM:null},e.selectKernelWithAssign=function(t,o){var i;if(!t)return null;var r=e.getKernelByName(t);return r&&r.isEnvSupport&&(r.canPlayType===CAN_PLAY_ALL||(null===(i=r.canPlayType)||void 0===i?void 0:i.includes(o)))?t:null},e.selectKernelIfSpecialVideoType=function(t){if("hls"===t&&e.kernelMap[exports.KERNEL_NAME.ORIGIN].canPlayType.includes(t))return exports.KERNEL_NAME.ORIGIN;return null},e.selectKernelFromInstalledList=function(t){for(var o=KERNEL_NAME_BY_PRIORITY.filter((function(t){return!!e.kernelMap[t]})),i=0;i<o.length;i++){var r=this.selectKernelWithAssign(o[i],t);if(r)return r}return null},e.selectKernelInPresetMap=function(e){return VIDEO_TYPE_2_KERNEL_NAME_MAP[e]},e.kernelMap={},e}(),KernelFactory$1=KernelFactory,KERNEL_NAME;exports.KERNEL_NAME=void 0,KERNEL_NAME=exports.KERNEL_NAME||(exports.KERNEL_NAME={}),KERNEL_NAME.ORIGIN="origin",KERNEL_NAME.DEMUX_2_FMP4="demux2fmp4",KERNEL_NAME.FLV_JS="flv.js",KERNEL_NAME.HLS_JS="hls.js",KERNEL_NAME.WASM="wasm";var KERNEL_NAME_BY_PRIORITY=[exports.KERNEL_NAME.HLS_JS,exports.KERNEL_NAME.FLV_JS,exports.KERNEL_NAME.DEMUX_2_FMP4,exports.KERNEL_NAME.WASM,exports.KERNEL_NAME.ORIGIN],VIDEO_TYPE_2_KERNEL_NAME_MAP={flv:exports.KERNEL_NAME.FLV_JS,hls:exports.KERNEL_NAME.HLS_JS},kernelCdnPrefix="core/".concat(LOCAL_DEV?"latest":VERSION$3),KERNEL_NAME_2_CDN_PATH_MAP=(_a$6={},_a$6[exports.KERNEL_NAME.HLS_JS]="".concat(kernelCdnPrefix,"/txhlsjs-kernel.js"),_a$6[exports.KERNEL_NAME.FLV_JS]="".concat(kernelCdnPrefix,"/flvjs-kernel.js"),_a$6[exports.KERNEL_NAME.DEMUX_2_FMP4]="".concat(kernelCdnPrefix,"/demux2fmp4-kernel.js"),_a$6[exports.KERNEL_NAME.WASM]="".concat(kernelCdnPrefix,"/wasm-kernel.js"),_a$6);function compareUrlConfig(e,t){return!(!e||!t)&&(!(!e.uid||!t.uid||e.uid!==t.uid)||e===t)}function fileExtension2VideoType(e){return-1!==["m3u8","m3u"].indexOf(e)?"hls":e}function checkUrlConfigVailed(e,t){var o;if(!e)return{code:ERROR_CODE.NULL_URL,message:ERROR_MSG.NULL_URL,fatal:!0};var i=null===(o=KernelFactory$1.getKernelByName(t))||void 0===o?void 0:o.canPlayType,r=function(e,o){if(!e.url)return{code:ERROR_CODE.NULL_URL,message:ERROR_MSG.NULL_URL,fatal:!0};if(!e.url.startsWith("blob:")){var i=getUrlConfigVideoType(e);if(i&&o&&-1===o.indexOf(i)){var r=VIDEO_TYPE_2_KERNEL_NAME_MAP[i],n="".concat(t!==exports.KERNEL_NAME.ORIGIN?"".concat(t,"内核"):"","无法播放").concat(i,"格式")+"".concat(r?"，需要使用".concat(r,"内核"):"");return{code:ERROR_CODE.MISSING_KERNEL,message:n,fatal:!0}}}};if(!(e instanceof Array))return r(e,i);for(var n=0,a=e.length;n<a;n++){var s=r(e[n],i);if(s)return s}}function getUrlConfigVideoType(e){var t,o=(e||{}).url;return!o||o.startsWith("blob:")?"":null===(t=fileExtension2VideoType(urlTool.getFileExtension(o)))||void 0===t?void 0:t.toLocaleLowerCase()}var __assign$5=window&&window.__assign||function(){return __assign$5=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$5.apply(this,arguments)},GUID_LEN=8,VideoInfo=function(){function e(e,t){this.playtime=0,this.duration=0,this.performance={},this.startTime=0,this.state=exports.VIDEO_STATE.IDLE,this.fileSize=0,this.videoWidth=0,this.videoHeight=0,this.hasFirstPlaying=!1,this.startPts=0,this.discontinuityTimeRanges=[],this._logger=new Logger(t.instanceId,"VideoInfo"),this._extraVars={},this._qualityInfo={},this._uid=comTool.createGUID(GUID_LEN),this._config=e,this._playerConfig=t,this.codecs=this._config.codec?__assign$5({},this._config.codec):{video:"",audio:""},this.reset(),this._logger.log("new VideoInfo(), uid: ".concat(this.uid))}return e.prototype.toJSON=function(){return this.serializedString()},e.prototype.toString=function(){return this.serializedString()},Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"qualityInfo",{get:function(){return this._qualityInfo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadingUrl",{get:function(){return this._loadingUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraVars",{get:function(){return this._extraVars},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._nextBackUrlIdx=0,this._retryCount=0,this.performance={},this._loadingUrl=this._config.url},e.prototype.setLoadingUrlStartTime=function(e){this._loadingUrl&&e>0&&(this._loadingUrl="".concat(this._loadingUrl.split("#t=")[0],"#t=").concat(e))},e.prototype.setDependVideoInfo=function(e){return this.startTime=e?e.startTime+e.duration:0,this._logger.log("setDependVideoInfo succ, uid/starttime: ".concat(this.uid,"/").concat(this.startTime)),!0},e.prototype.setNextBackUrl=function(){return!(!this._config.url||this._retryCount>=this._playerConfig.backupUrlsMaxRetryCount)&&(this._retryCount++,this._config.backupUrls&&this._config.backupUrls.length>0?this._nextBackUrlIdx>=this._config.backupUrls.length?(this._loadingUrl=this._config.url,this._nextBackUrlIdx=0):(this._loadingUrl=this._config.backupUrls[this._nextBackUrlIdx],this._nextBackUrlIdx++):this._loadingUrl=this._config.url,!0)},e.prototype.getRetryCount=function(){return this._retryCount},e.prototype.destroy=function(){this.extraVars.stream=null},e.prototype.serializedString=function(){var e,t;return"VideoInfo{u:".concat(this._loadingUrl,",t:").concat(this.playtime,",s:").concat(this.state,",ec:").concat((null===(e=this.error)||void 0===e?void 0:e.code)||"",",em:").concat((null===(t=this.error)||void 0===t?void 0:t.message)||"",",r:").concat(this._nextBackUrlIdx,"}")},e}(),__extends$5=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__assign$4=window&&window.__assign||function(){return __assign$4=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$4.apply(this,arguments)},__decorate$4=window&&window.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__metadata$4=window&&window.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter$2=window&&window.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},__generator$2=window&&window.__generator||function(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},__spreadArray$2=window&&window.__spreadArray||function(e,t,o){if(o||2===arguments.length)for(var i,r=0,n=t.length;r<n;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},logMethodCall$4=logMethodCallDecoratorCreator("BasePlayer"),BasePlayer=function(e){function t(t){var o,i,r=e.call(this)||this;return r._firstPlaying=!1,r._hasUserGestures=!1,r._volume=1,r._playbackRate=1,r._playBlocking=!1,r._logger=new Logger(t.instanceId,"BasePlayer"),r._config=t,r._videoInfos=[],r._curUrlIdx=-1,r._curVideoNode=null,r._preloaders=[],r._vnList=[],r._eventMap={videonode:r.videonodeEventHandler.bind(r)},r._played=!1,r.videoEvt2PlayerEvtMap=((o={})[VIDEO_NODE_EVENT.DURATION_CHANGE]=exports.PLAY_EVENT.DURATION_CHANGE,o[VIDEO_NODE_EVENT.VOLUME_CHANGE]=exports.PLAY_EVENT.VOLUME_CHANGE,o[VIDEO_NODE_EVENT.ERROR]=exports.PLAY_EVENT.ERROR,o[VIDEO_NODE_EVENT.METADATA_CHANGE]=exports.PLAY_EVENT.METADATA_CHANGE,o[VIDEO_NODE_EVENT.SETLEVEL_OVER]=exports.PLAY_EVENT.SETLEVEL_OVER,o[VIDEO_NODE_EVENT.SETLEVEL_START]=exports.PLAY_EVENT.SETLEVEL_START,o[VIDEO_NODE_EVENT.SET_LOADING]=exports.PLAY_EVENT.SET_LOADING,o[VIDEO_NODE_EVENT.STATE_CHANGE]=exports.PLAY_EVENT.STATE_CHANGE,o[VIDEO_NODE_EVENT.TIME_UPDATE]=exports.PLAY_EVENT.TIME_UPDATE,o[VIDEO_NODE_EVENT.VIDEO_BUFFER_CHANGE]=exports.PLAY_EVENT.VIDEO_BUFFER_CHANGE,o[VIDEO_NODE_EVENT.LOAD_PROGRESS]=exports.PLAY_EVENT.LOAD_PROGRESS,o[VIDEO_NODE_EVENT.FIRST_PLAYING]=exports.PLAY_EVENT.VIDEONODE_FIRST_PLAYING,o[VIDEO_NODE_EVENT.RATE_CHANGE]=exports.PLAY_EVENT.RATE_CHANGE,o[VIDEO_NODE_EVENT.RETRY]=exports.PLAY_EVENT.RETRY_BACKURL,o[VIDEO_NODE_EVENT.ELEMENT_EVTS]=exports.PLAY_EVENT.ELEMENT_EVTS,o[VIDEO_NODE_EVENT.PLAY_OVER]=exports.PLAY_EVENT.STOPED,o[VIDEO_NODE_EVENT.VIDEO_RESIZE]=exports.PLAY_EVENT.VIDEO_RESIZE,o),r.videoEvtHandlerMap=((i={})[VIDEO_NODE_EVENT.STATE_CHANGE]=r.onVideoNodeStateChange.bind(r),i[VIDEO_NODE_EVENT.PLAY_PROMISE_CATCHED]=r.onVideoNodePlayPromiseCatched.bind(r),i[VIDEO_NODE_EVENT.FIRST_PLAYING]=r.onVideoNodeFirstPlaying.bind(r),i[VIDEO_NODE_EVENT.PLAY_OVER]=r.onVideoNodePlayOver.bind(r),i[VIDEO_NODE_EVENT.ERROR]=r.onVideoNodeError.bind(r),i),r._config.createVideoNodeWhenLoad||r.createVideoNodes(r._config.maxVideoNodeCount),r}return __extends$5(t,e),t.prototype.decideSetLevelMode=function(){return this._vnList.length<2?SET_LEVEL_MODE.HARD:SET_LEVEL_MODE.SOFT},t.prototype.createVideoNode=function(e){return new OrgVideoNode(e)},t.prototype.createVideoNodes=function(e){for(var t=0;t<e;t++){var o=this.createVideoNode(this._config);o.idx=t,o.volume=this._volume,o.playbackRate=this._playbackRate,o.videoElement instanceof HTMLElement&&(o.videoElement.dataset.idx="".concat(t)),this._vnList.push(o)}},t.prototype.createStream=function(e){return null},t.prototype.setPlayEvents=function(e,t){var o=this;e&&(t&&this.setPlayEvents(e,!1),this._logger.log("set VideoNode evts, idx=".concat(e.idx,"/value=").concat(t)),Object.keys(VIDEO_NODE_EVENT).forEach((function(i){(t?e.on:e.off).apply(e,[VIDEO_NODE_EVENT[i],o._eventMap.videonode])})))},t.prototype.videonodeEventHandler=function(e){this.logVideoNodeEvts(e);var t=!0;this.videoEvtHandlerMap[e.type]&&(t=this.videoEvtHandlerMap[e.type](e)),t&&e.type in this.videoEvt2PlayerEvtMap&&this.emit(this.videoEvt2PlayerEvtMap[e.type],e.data)},t.prototype.onVideoNodeStateChange=function(e){return e.data.new===exports.VIDEO_STATE.PAUSE&&e.data.pauseType===PAUSE_TYPE.INNER?(this._logger.log("inner pause does not emit event."),!1):(e.data.new===exports.VIDEO_STATE.PLAYING&&(this._checkPlayBlocked=!1),!0)},t.prototype.onVideoNodePlayPromiseCatched=function(e){return this._checkPlayBlocked&&e.data.isAutoPlayBlocked&&(this._checkPlayBlocked=!1,this.playBlocked()),!0},t.prototype.onVideoNodeFirstPlaying=function(e){return this._firstPlaying||(this.emit(exports.PLAY_EVENT.FIRST_PLAYING,{videoInfo:this.currentVideoInfo}),this._firstPlaying=!0,this._hasUserGestures=!0),!0},t.prototype.onVideoNodePlayOver=function(e){if(this._config.isPlayList||this.nextVideoInfo)this.emit(exports.PLAY_EVENT.VIDEONODE_PLAY_OVER,{videoInfo:this.currentVideoInfo}),this.checkPlayNext();else{var t=this.currentVideoInfo;this.stopInner(exports.END_STATE.NORMAL,!0,t),this.emit(exports.PLAY_EVENT.VIDEONODE_PLAY_OVER,{videoInfo:t})}return!1},t.prototype.onVideoNodeError=function(e){var t;return this.stopInner(exports.END_STATE.ERROR,!0,null===(t=e.data)||void 0===t?void 0:t.videoInfo),!1},t.prototype.logVideoNodeEvts=function(e){var t,o;if(e.type!==VIDEO_NODE_EVENT.TIME_UPDATE&&e.type!==VIDEO_NODE_EVENT.VIDEO_BUFFER_CHANGE&&(e.type!==VIDEO_NODE_EVENT.ELEMENT_EVTS||e.data.elementEvtType!==VIDEO_EVTS.timeupdate&&e.data.elementEvtType!==VIDEO_EVTS.progress)){var i=e.data;e.type===VIDEO_NODE_EVENT.STATE_CHANGE?i="[".concat(e.data.old,"->").concat(e.data.new,"]"):e.type===VIDEO_NODE_EVENT.ELEMENT_EVTS&&(i="[elementEvtType=".concat(e.data.elementEvtType,"]")),this._logger.log("get VideoNode evt, type=".concat(e.type,"/uid=").concat(null===(o=null===(t=this._curVideoNode)||void 0===t?void 0:t.currentVideoInfo)||void 0===o?void 0:o.uid,"/data="),i)}},t.prototype.playBlocked=function(){var e=this;this._playBlocking=!0,this._triggerAutoplayPromise=null,setTimeout((function(){e.emit(exports.PLAY_EVENT.AUTOPLAY_BLOCKED,{videoInfo:e.currentVideoInfo})}),0),this.setLoading(!1)},t.prototype.setLoading=function(e){this.emit(exports.PLAY_EVENT.SET_LOADING,{show:e})},t.prototype.captureVideo=function(e,t,o,i,r){var n,a=this.currentVideoElement;if(a){if(a instanceof HTMLVideoElement)try{var s=videoTool.captureVideo(a,{dx:e,dy:t,dw:o,dh:i});return Promise.resolve(s)}catch(e){return Promise.reject(e)}return null===(n=a.captureVideo)||void 0===n?void 0:n.call(a,e,t,o,i)}},t.prototype.triggerAutoplay=function(){var e=this;if(this._triggerAutoplayPromise)return this._triggerAutoplayPromise;this._logger.log("triggerAutoplay(), start");for(var t=[],o=this._vnList.length,i=0;i<o;i++){var r=this._vnList[i].triggerAutoplay();t.push(r)}return this._triggerAutoplayPromise=Promise.all(t),this._triggerAutoplayPromise.catch((function(t){e._logger.log("play() triggerAutoplay catched: ",t),e.playBlocked()})),this._triggerAutoplayPromise},Object.defineProperty(t.prototype,"useWorker",{get:function(){return!!this._curVideoNode&&this._curVideoNode.useWorker},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoElements",{get:function(){var e;return null===(e=this._vnList)||void 0===e?void 0:e.map((function(e){return e.videoElement}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoElement",{get:function(){return this._curVideoNode?this._curVideoNode.videoElement:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoInfos",{get:function(){return this._videoInfos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preloadVideoInfos",{get:function(){return this._preloaders.map((function(e){return e.videoInfo}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoSize",{get:function(){return this._curVideoNode?this._curVideoNode.videoSize:{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoBuffered",{get:function(){return this._curVideoNode?this._curVideoNode.videoBuffered:[{start:0,end:0}]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoInfo",{get:function(){return this._curVideoNode?this._curVideoNode.currentVideoInfo:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextVideoInfo",{get:function(){return this._videoInfos[this._curUrlIdx+1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoInfoIdx",{get:function(){return this._curVideoNode?this._videoInfos.indexOf(this._curVideoNode.currentVideoInfo):-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalVideoInfoCount",{get:function(){return this._videoInfos.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),t.prototype.resizeVideoElements=function(e){var t=this.videoElements;!e||!t||t.length<=0||(t.forEach((function(t){videoTool.resizeElement(t,e)})),this.emit(exports.PLAY_EVENT.RESIZE,e))},t.prototype.resize=function(e){this.resizeVideoElements(e)},t.prototype.hasAppended=function(e){return!!this._videoInfos.find((function(t){return compareUrlConfig(t.config,e)}))},t.prototype.hasPreloaded=function(e){return!!this.preloadVideoInfos.find((function(t){return compareUrlConfig(t.config,e)}))},t.prototype.seek=function(e){var t;return this.state!==exports.VIDEO_STATE.IDLE&&(!(e<0)&&(!!(null===(t=this._curVideoNode)||void 0===t?void 0:t.currentVideoInfo)&&this._curVideoNode.seek(e,!0)))},t.prototype.pause=function(e){this._played?this.pauseInner(e||PAUSE_TYPE.USER):this._logger.warn("pause(), player has not been played")},t.prototype.pauseInner=function(e){void 0===e&&(e=PAUSE_TYPE.INNER),this.state!==exports.VIDEO_STATE.PAUSE&&this._curVideoNode&&this._curVideoNode.pauseInner(e)},Object.defineProperty(t.prototype,"played",{get:function(){return this._played},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._curVideoNode?this._curVideoNode.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playtime",{get:function(){return this._curVideoNode?this._curVideoNode.playtime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._curVideoNode?this._curVideoNode.state:exports.VIDEO_STATE.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e;for(var t=this._vnList.length,o=0;o<t;o++)this._vnList[o].playbackRate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPlaybackRate",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPreload",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e;for(var t=this._vnList.length,o=0;o<t;o++)this._vnList[o].volume=e},enumerable:!1,configurable:!0}),t.prototype.log=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null===(e=this._logger)||void 0===e||e.log.apply(e,t)},t.prototype.resumeInner=function(){var e;this._played&&(null===(e=this._curVideoNode)||void 0===e?void 0:e.currentVideoInfo)&&(0===this._curVideoNode.duration||this._curVideoNode.playtime<this._curVideoNode.duration)&&this._curVideoNode.videoplay()},t.prototype.appendNext=function(e){if(this._config.isPlayList)if(this._played){var t=checkUrlConfigVailed(e,this.kernelName);if(!t){var o=this._videoInfos.find((function(t){return compareUrlConfig(t.config,e)}));if(o)return this._logger.warn("appendNext(), duplicate append! uid[".concat(o.uid,"]")),!1;var i=this.preloadVideoInfos.find((function(t){return compareUrlConfig(t.config,e)}));return i||(i=new VideoInfo(e,this._config)),this.clearAllPreloadInner(i),this._videoInfos=this._videoInfos.slice(0,this._curUrlIdx+1),this._videoInfos=this._videoInfos.concat(i),this._logger.log("appendNext() succ, appendVideoInfo=",i),this.emit(exports.PLAY_EVENT.LIST_CHANGE),this.appendAfter(i),!0}this._logger.warn("appendNext(), urlconfig err=",t)}else this._logger.warn("appendNext(), player has not been played");else this._logger.warn("appendNext() only supported when [isPlayList] is true")},t.prototype.preloadNext=function(){for(var e=this,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];if(this._config.isPlayList)if(this.supportPreload)if(this._played){var i=checkUrlConfigVailed(t,this.kernelName);if(!i){var r=[];t.forEach((function(t){var o=e._videoInfos.findIndex((function(e){return compareUrlConfig(e.config,t)}));-1!==o&&o<=e._curUrlIdx?e._logger.warn("preloadInner() fail, because this videoInfo has been played."):-1!==o&&o>=e._curUrlIdx+1+1?e._logger.warn("preloadInner() fail, can not skip next to preload."):!e.nextVideoInfo||compareUrlConfig(e.nextVideoInfo.config,t)?-1!==e.preloadVideoInfos.findIndex((function(e){return compareUrlConfig(e.config,t)}))?e._logger.warn("preloadInner() fail, the VideoInfo has been preloaded."):e.nextVideoInfo&&compareUrlConfig(t,e.nextVideoInfo.config)?r.push(e.nextVideoInfo):r.push(new VideoInfo(t,e._config)):e._logger.warn("preloadInner() fail, the next has been appended, you only can preload next.")})),this.preloadInner.apply(this,__spreadArray$2([!1,{startTime:0,kernelName:this.kernelName}],r,!1))}}else this._logger.warn("preloadNext() fail, player has not been played.");else this._logger.warn("preloadNext() fail, browser not support preload.");else this._logger.warn("preloadNext() only supported when [isPlayList] is true")},t.prototype.preloadInner=function(e,t){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var r=[],n=o.length;if(!(n<=0)){for(var a=0;a<n;a++)if(o[a]){this.clearPreloader(o[a]);var s=this.preparePreloader(e,o[a]);s&&(o[a].setDependVideoInfo(this.currentVideoInfo),s.load(e,this,o[a],t),r.push(s))}this._preloaders=this._preloaders.concat(r),this._logger.log("preload(), preloader's length: ",this._preloaders.length),r.length>0&&this.emit(exports.PLAY_EVENT.PRELOAD_START,{preloadVideoInfos:r.map((function(e){return e.videoInfo}))})}},t.prototype.checkPlayNext=function(){var e;this._played&&(this._logger.log("checkPlayNext(), curUrlIdx=".concat(this._curUrlIdx,"/urlLength=").concat(this._videoInfos.length,"/")+"nextStartTime: ".concat(null===(e=this.nextVideoInfo)||void 0===e?void 0:e.playtime)),this.nextVideoInfo?this.playNextInner():this._logger.log("playlist over>>>, total len: ",this._videoInfos.length))},t.prototype.playNext=function(e){this._played?this.playNextInner({isInterrupt:!0}):this._logger.warn("playNext(), player has not been played")},t.prototype.playNextInner=function(e){var t=(e||{}).isInterrupt;this._logger.log("playNextInner(), curUrlIdx=".concat(this._curUrlIdx,"/")+"urlLength=".concat(this._videoInfos.length,"/isInterrupt=").concat(t));var o=Math.abs(this.playtime-this.duration)<=this._config.interruptPlayNextMinTime;if(t&&o&&this.state===exports.VIDEO_STATE.PLAYING)this._logger.log("playNextInner(), playNext right now! return!");else if(this._curUrlIdx+1>=this._videoInfos.length)this._logger.warn("There is no next VideoInfo.");else{this._curUrlIdx+=1,this.setPlayEvents(this._curVideoNode,!1),t&&this._curVideoNode.pauseInner();var i=this._videoInfos[this._curUrlIdx];this.clearAllPreloadInner(i),t&&this.emit(exports.PLAY_EVENT.VIDEONODE_PLAY_OVER,{videoInfo:this.currentVideoInfo}),this.playInner()}},t.prototype.play=function(e,t){return __awaiter$2(this,void 0,void 0,(function(){var o,i,r=this;return __generator$2(this,(function(n){return this.state!==exports.VIDEO_STATE.IDLE||e?(o=function(){if(!r._played&&-1===r._curUrlIdx){var e=r._videoInfos[0],t=!r.supportPreload||1!==r.findPreloadIdxByVideoInfo(e);e&&t&&(r._played=!0,r._curUrlIdx=0,r.playInner())}},i=function(){(r._logger.log("triggerAutoplay(), over"),e)?r.loadInner(e,t)&&(r.setLoading(!0),o()):r._played?r._playBlocking||videoTool.cannotDetectAutoPlayBlock()?(r._playBlocking=!1,setTimeout((function(){var e,t;(null===(t=null===(e=r._curVideoNode)||void 0===e?void 0:e.videoBuffered)||void 0===t?void 0:t.length)<=0&&r.setLoading(!0),r.resumeInner()}),0)):-1!==[exports.VIDEO_STATE.PAUSE,exports.VIDEO_STATE.CANPLAY,exports.VIDEO_STATE.SEEKED].indexOf(r.state)?r.resumeInner():r._logger.log("play() has been called, but cannot do nothing."):(r.setLoading(!0),o())},this._checkPlayBlocked=!0,this._vnList.length<=1||this._hasUserGestures?(this._logger.log("play(), skip triggerAutoplay()."),i()):this.triggerAutoplay().then(i).catch((function(){r._config.type===exports.PLAY_MODE.VOD&&e&&!videoTool.notSupportLoadBeforeHasUserGestures()&&r.loadInner(e,t)})),[2]):(this._logger.warn("play(), no urlConfig when idle state"),[2])}))}))},t.prototype.load=function(e,t){return __awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(o){return!e||e instanceof Array&&e.length<=0?(this.clearBeforeLoad(),[2]):(this.loadInner(e,t),[2])}))}))},t.prototype.loadInner=function(e,t){var o=this;this.clearBeforeLoad();var i=checkUrlConfigVailed(e,this.kernelName);if(i)return this.emit(exports.PLAY_EVENT.ERROR,{videoInfo:{error:i}}),!1;this._config.createVideoNodeWhenLoad&&(this._vnList.forEach((function(e){return e.destroy()})),this._vnList.length=0,this.createVideoNodes(this._config.maxVideoNodeCount)),this.emit(exports.PLAY_EVENT.RESTART);var r=(t||{}).startTime,n=void 0===r?0:r;this._firstPlayTimeArg=Math.max(0,n),this._videoInfos=[].concat(e).map((function(e){return new VideoInfo(e,o._config)})),this.emit(exports.PLAY_EVENT.LIST_CHANGE);var a=this._videoInfos[0];return this.preloadInner(!0,__assign$4(__assign$4({},t),{startTime:n,kernelName:this.kernelName}),a),!0},t.prototype.clearBeforeLoad=function(){var e;null===(e=this._vnList)||void 0===e||e.forEach((function(e){videoTool.clear(e.videoElement)})),this.stopInner(this._played?exports.END_STATE.INTERRUPT:exports.END_STATE.NORMAL,this._played,this._played?this.currentVideoInfo:null)},t.prototype.checkAutoPreloadNext=function(e){var t=this.currentVideoInfo.config.autoPreloadLeftTime;t<=0||(t>=this.currentVideoInfo.duration&&this.currentVideoInfo.playtime>0||t>=e)&&this.nextVideoInfo&&-1===this.preloadVideoInfos.indexOf(this.nextVideoInfo)&&this.preloadInner(!1,{startTime:0,kernelName:this.kernelName},this.nextVideoInfo)},t.prototype.clearAllPreload=function(){this.clearAllPreloadInner()},t.prototype.clearAllPreloadInner=function(e){var t=this;!this._preloaders||this._preloaders.length<=0||this._preloaders.filter((function(t){return t.videoInfo!==e})).forEach((function(e){t.clearPreloader(e.videoInfo)}))},t.prototype.findPreloadIdxByVideoInfo=function(e){return e?this._preloaders.findIndex((function(t){return t.videoInfo===e})):-1},t.prototype.clearPreloader=function(e,t){if(this._preloaders&&!(this._preloaders.length<=0)&&e){var o=this.findPreloadIdxByVideoInfo(e);if(-1!==o)if(-1!==o)this._preloaders.splice(o,1)[0].clear(t)}},t.prototype.stop=function(e){void 0===e&&(e=exports.END_STATE.INTERRUPT),this.state!==exports.VIDEO_STATE.IDLE&&this.stopInner(e,!0)},t.prototype.stopInner=function(e,t,o){var i;void 0===e&&(e=exports.END_STATE.NORMAL),void 0===t&&(t=!1),void 0===o&&(o=null),(null===(i=this._config)||void 0===i?void 0:i.type)===exports.PLAY_MODE.VOD&&this.clearAllPreloadInner();var r=this._videoInfos;if(this._videoInfos=[],this._vnList)for(var n=this._vnList.length,a=0;a<n;a++)this._vnList[a].stop(),this.setPlayEvents(this._vnList[a],!1);this._curUrlIdx=-1,r&&r.forEach((function(e){e.destroy()})),this._firstPlaying=!1,this._played=!1,this._curVideoNode=null;var s=null==o?void 0:o.error,l=s?exports.END_STATE.ERROR:e;this._logger.log("stopInner(), endState=".concat(l)),t&&(this.emit(exports.PLAY_EVENT.STOPED,{videoInfo:o,isUserStop:e===exports.END_STATE.INTERRUPT,endState:l}),s&&this.emit(exports.PLAY_EVENT.ERROR,{videoInfo:o}))},t.prototype.checkSetLevelError=function(e){return this._played?e?this.currentVideoInfo?this.currentVideoInfo.playtime<=0?"播放未开始":this._config.type===exports.PLAY_MODE.VOD&&this.currentVideoInfo.playtime+1>=this.currentVideoInfo.duration&&this.currentVideoInfo.duration!==1/0?"播放即将结束":e===this.currentVideoInfo.loadingUrl?"切换的视频地址没有变化":null:"找不到当前播放信息":"切换的视频地址为空":"播放未开始"},t.prototype.setLevel=function(e,t,o){var i;"string"==typeof e?i=e:(i=e.url,t=e.backupUrls,o=e);var r=this.checkSetLevelError(i);return r?(this._logger.warn("setLevel(), ".concat(r)),Promise.reject(new Error(r))):(this._urlBeforeSetLevel={url:i,backupUrls:t},this.currentVideoInfo.config.url=i,t&&(this.currentVideoInfo.config.backupUrls=t),o&&Object.assign(this.currentVideoInfo.config,o),this.currentVideoInfo.reset(),this.setLevelInner(this.currentVideoInfo.config))},t.prototype.setCurVideoNode=function(e,t){void 0===t&&(t=!1),(this._curVideoNode!==e||t)&&(this._curVideoNode&&(this._curVideoNode.onAccurateTimeupdate=null,this.setPlayEvents(this._curVideoNode,!1)),e&&(this._curVideoNode=e,this._curVideoNode.onAccurateTimeupdate=this.checkAccuratePlaytime.bind(this),this.setPlayEvents(this._curVideoNode,!0)))},t.prototype.destroy=function(){if(this.stopInner(),this._vnList)for(var e=this._vnList.length,t=0;t<e;t++)this._vnList[t].destroy();this._preloaders&&(this._preloaders.forEach((function(e){e.clear()})),this._preloaders=null),this.removeAllListeners(),this._videoInfos=null,this._curVideoNode=null,this._vnList=null,this._eventMap=null},__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[]),__metadata$4("design:returntype",void 0)],t.prototype,"playBlocked",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object]),__metadata$4("design:returntype",void 0)],t.prototype,"resizeVideoElements",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Number]),__metadata$4("design:returntype",void 0)],t.prototype,"seek",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[]),__metadata$4("design:returntype",void 0)],t.prototype,"resumeInner",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object]),__metadata$4("design:returntype",void 0)],t.prototype,"appendNext",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object]),__metadata$4("design:returntype",void 0)],t.prototype,"preloadNext",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Boolean,Object,Object]),__metadata$4("design:returntype",void 0)],t.prototype,"preloadInner",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[]),__metadata$4("design:returntype",void 0)],t.prototype,"checkPlayNext",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object]),__metadata$4("design:returntype",void 0)],t.prototype,"playNext",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object]),__metadata$4("design:returntype",void 0)],t.prototype,"playNextInner",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object,Object]),__metadata$4("design:returntype",Promise)],t.prototype,"play",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object,Object]),__metadata$4("design:returntype",Promise)],t.prototype,"load",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[String]),__metadata$4("design:returntype",void 0)],t.prototype,"stop",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[String,Object,Object]),__metadata$4("design:returntype",void 0)],t.prototype,"stopInner",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object,Array,Object]),__metadata$4("design:returntype",Promise)],t.prototype,"setLevel",null),__decorate$4([logMethodCall$4,__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[]),__metadata$4("design:returntype",void 0)],t.prototype,"destroy",null),t}(s$1),__assign$3=window&&window.__assign||function(){return __assign$3=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$3.apply(this,arguments)},defaultOriginKernelConfig={maxVideoNodeCount:1,advanceEndTime:uaTool.browser.x5?.1:0,prePlayNextTime:uaTool.browser.x5?.2:0};function mergeKernelConfig(e){return __assign$3(__assign$3({},e),{originKernelConfig:__assign$3(__assign$3({},defaultOriginKernelConfig),e.originKernelConfig)})}var __decorate$3=window&&window.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__metadata$3=window&&window.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},logMethodCall$3=logMethodCallDecoratorCreator("OrgPreLoader"),OrgPreLoader=function(){function e(e){var t;this.playerConfig=e,this._defer=new SimpleDefer,this._logger=new Logger(e.instanceId,"OrgPreLoader"),this._evtMaps=((t={})[VIDEO_NODE_EVENT.STATE_CHANGE]=this.firstLoadStateChangeHandler.bind(this),t[VIDEO_NODE_EVENT.ERROR]=this.errorHandler.bind(this),t)}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._defer.promise},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoInfo",{get:function(){return this._videoInfo},enumerable:!1,configurable:!0}),e.prototype.getVideoNode=function(){var e;return null===(e=this._videoInfo)||void 0===e?void 0:e.extraVars.preloadVideoNode},e.prototype.errorHandler=function(e){this.preloadFail(e.data.videoInfo.error)},e.prototype.firstLoadStateChangeHandler=function(e){e.data.new===exports.VIDEO_STATE.CANPLAY&&this.preloadSucc()},e.prototype.preloadSucc=function(){this._logger.log("preload url ready>>>>>> uid=".concat(this._videoInfo.uid)),this.clearInner(!0),this._evtDispatcher.emit(exports.PLAY_EVENT.PRELOAD_VIDEONODE_OVER,{videoInfo:this._videoInfo}),this._defer.resolve()},e.prototype.preloadFail=function(e){this._logger.log("preload url fail>>>>>> uid: ".concat(this._videoInfo.uid)),this.clearInner(),this._evtDispatcher.emit(exports.PLAY_EVENT.PRELOAD_VIDEONODE_ERROR,{videoInfo:this._videoInfo}),this._videoInfo.error=e,this._defer.reject(e)},e.prototype.setVideoNodeEvents=function(e){var t=this,o=this.getVideoNode();Object.keys(this._evtMaps).forEach((function(i){e?o.on(i,t._evtMaps[i]):o.off(i,t._evtMaps[i])}))},e.prototype.load=function(e,t,o,i){this._videoInfo=o,this._evtDispatcher=t,this.setVideoNodeEvents(!0),this._logger.log("load(), isFirstLoad=".concat(e)),this.getVideoNode().load(o,i)},e.prototype.clearInner=function(e,t){if(this._videoInfo){var o=this.getVideoNode();o&&(this._logger.log("clear(), uid=".concat(this._videoInfo.uid,"/keep=").concat(e)),this.setVideoNodeEvents(!1),e||(this._videoInfo.extraVars.preloadVideoNode=null,o.stop()),t&&this._evtDispatcher.emit(exports.PLAY_EVENT.PRELOAD_VIDEONODE_CLEAR,{videoInfo:this._videoInfo}))}},e.prototype.clear=function(e){this.clearInner(e,!0)},__decorate$3([logMethodCall$3,__metadata$3("design:type",Function),__metadata$3("design:paramtypes",[Boolean,s$1,Object,Object]),__metadata$3("design:returntype",void 0)],e.prototype,"load",null),__decorate$3([logMethodCall$3,__metadata$3("design:type",Function),__metadata$3("design:paramtypes",[Boolean]),__metadata$3("design:returntype",void 0)],e.prototype,"clear",null),e}(),__extends$4=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__decorate$2=window&&window.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__metadata$2=window&&window.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},logMethodCall$2=logMethodCallDecoratorCreator("MultiPlayer"),MultiPlayer=function(e){function t(t){var o,i=e.call(this,mergeKernelConfig(t))||this;return i._needHideVideoNode=null,i._videonodeEventMap=((o={})[VIDEO_NODE_EVENT.STATE_CHANGE]=i.onCurVideoNodeStateChange.bind(i),o),i}return __extends$4(t,e),Object.defineProperty(t,"canPlayType",{get:function(){return videoTool.supportVideoFormat()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPreload",{get:function(){return videoTool.supportSameTimePlay()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernelName",{get:function(){return exports.KERNEL_NAME.ORIGIN},enumerable:!1,configurable:!0}),t.prototype.seek=function(t){return!this.getLevelSwitching()&&e.prototype.seek.call(this,t)},t.prototype.createVideoNodes=function(t){e.prototype.createVideoNodes.call(this,t);for(var o=0;o<this._vnList.length;o++){var i=this._vnList[o];0===o?this._firstVideoNode=i:this.visibleVideoNode(i,!1)}},t.prototype.videonodeEventHandler=function(t){this._videonodeEventMap[t.type]&&this._videonodeEventMap[t.type](t),e.prototype.videonodeEventHandler.call(this,t)},t.prototype.onCurVideoNodeStateChange=function(e){if(e.data.new===exports.VIDEO_STATE.PLAYING&&(this.switchVideoNode(),!this.currentVideoInfo.extraVars.isStartPlay)){this.currentVideoInfo.extraVars.isStartPlay=!0;var t=this.currentVideoInfo?this.currentVideoInfo.uid:null;this._logger.log("videoNodeStartPlay: uid[".concat(t,"]")),this.emit(exports.PLAY_EVENT.VIDEONODE_START_PLAY,{videoInfo:this.currentVideoInfo})}},t.prototype.onVideoNodeStateChange=function(t){return!(this.getLevelSwitching()&&!VALID_STATE_IN_LEVEL_SWITCHING.includes(t.data.new))&&e.prototype.onVideoNodeStateChange.call(this,t)},t.prototype.pauseInner=function(t){void 0===t&&(t=PAUSE_TYPE.INNER),this._prePlayNext?this._logger.warn("pause when preplaynext, return!!"):e.prototype.pauseInner.call(this,t)},t.prototype.resumeInner=function(){this.getLevelSwitching()?this._setLevelVideoNode.play():e.prototype.resumeInner.call(this)},t.prototype.loadInner=function(t,o){for(var i,r=(null===(i=this._vnList)||void 0===i?void 0:i.length)||0,n=0;n<r;n++)this.visibleVideoNode(this._vnList[n],!1);return e.prototype.loadInner.call(this,t,o)},t.prototype.playInner=function(e){var t=this;if(this.getLevelSwitching())return this._setLevelVideoNode.play(),void this._logger.log("play(), setlevel");if(this._videoInfos.length<=0||!this._videoInfos[this._curUrlIdx])this._logger.warn("play(), !videoInfo");else{var o=this._videoInfos[this._curUrlIdx],i=this._curVideoNode?this._curVideoNode.state:exports.VIDEO_STATE.IDLE,r=this.findPreloadIdxByVideoInfo(o),n=function(n){var a,s,l;t._logger.log("playInner(), playImpl(), preloadSucc=".concat(n));var p,c=!1;((p=-1!==r?null===(s=null===(a=t._preloaders[r])||void 0===a?void 0:a.videoInfo)||void 0===s?void 0:s.extraVars.preloadVideoNode:null)||(p=t.getIdleVideoNode()),!p&&t._curVideoNode&&t._curVideoNode.state===exports.VIDEO_STATE.IDLE&&(p=t._curVideoNode,c=!0),p||t._logger.warn("can not find idle videonode!"),t.setCurVideoNode(p,c),-1!==r)&&t._preloaders.splice(r,1)[0].clear(!0);t._needHideVideoNode?t._needHideVideoNode===t._curVideoNode?(t.visibleVideoNode(t._curVideoNode,!0),t._logger.log("visibleVideoNode, need==current")):n&&t.switchVideoNode():(t.visibleVideoNode(t._curVideoNode,!0),t._logger.log("visibleVideoNode, null need")),t._curVideoNode.state!==exports.VIDEO_STATE.PLAYING&&t._curVideoNode.play(o,{startTime:e}),t.emit(exports.PLAY_EVENT.VIDEONODE_CHANGE,{videoInfo:t.currentVideoInfo}),n&&(0!==t._videoInfos.indexOf(t.currentVideoInfo)&&(t.emit(exports.PLAY_EVENT.DURATION_CHANGE,{videoInfo:t.currentVideoInfo}),t.emit(exports.PLAY_EVENT.STATE_CHANGE,{videoInfo:t.currentVideoInfo,new:t._curVideoNode.state,old:i})),t.currentVideoInfo.extraVars.isStartPlay||(t.currentVideoInfo.extraVars.isStartPlay=!0,t._logger.log("videoNodeStartPlay: uid[".concat(t.currentVideoInfo.uid,"]")),t.emit(exports.PLAY_EVENT.VIDEONODE_START_PLAY,{videoInfo:t.currentVideoInfo}))),t._logger.log("playInner(), playImpl(), uid=".concat(null===(l=t.currentVideoInfo)||void 0===l?void 0:l.uid,"/")+"urlIdx=".concat(t._curUrlIdx,"/state=").concat(t._curVideoNode.state))},a=0;-1!==r?(o.hasFirstPlaying&&(a=window.setTimeout((function(){t.emit(exports.PLAY_EVENT.STATE_CHANGE,{videoInfo:o,new:exports.VIDEO_STATE.BUFFERING,old:i})}),200)),this._preloaders[r].promise.then((function(){clearTimeout(a),t._logger.log("play(), preloadVideoNode succ, uid=".concat(o.uid)),n(!0)})).catch((function(e){t._logger.log("play(), preloadVideoNode error, uid=".concat(o.uid,"/error="),e),e.code in ERROR_CODE&&(clearTimeout(a),o.error=e,t.stopInner(exports.END_STATE.ERROR,!0,o))}))):o.error?(this._logger.log("play(), got preload error"),this.stopInner(exports.END_STATE.ERROR,!0,o)):n(!1)}},t.prototype.visibleVideoNode=function(e,t){var o;e&&e.videoElement&&(this.setVideoElementState(e.videoElement,t),this._logger.log(">>>visibleVideoNode<<<, value=".concat(t,"/uid=").concat(null===(o=e.currentVideoInfo)||void 0===o?void 0:o.uid)))},t.prototype.setVideoElementState=function(e,t){var o=t?this._volume:0;e.volume!==o&&(e.volume=o);var i=this._volume<=0||!t;e.muted!==i&&(e.muted=i),domTool.css(e,"zIndex",t?"0":"-1"),domTool.css(e,"visibility",t?"inherit":"hidden")},t.prototype.switchVideoNode=function(){if(this._needHideVideoNode&&this._curVideoNode!==this._needHideVideoNode){this._logger.log(">>>>>switchVideoNode<<<<<"),this.visibleVideoNode(this._curVideoNode,!0);var e=this._needHideVideoNode;this.visibleVideoNode(e,!1),e&&e.stop(),this._needHideVideoNode=null}},t.prototype.playNextInner=function(t){this._needHideVideoNode=this._curVideoNode,this._prePlayNext=!1,e.prototype.playNextInner.call(this,t)},t.prototype.appendAfter=function(e){var t=!this._curVideoNode||this._curVideoNode.state===exports.VIDEO_STATE.IDLE;this._played&&this._curUrlIdx+1===this._videoInfos.indexOf(e)&&t&&this.playNextInner()},t.prototype.preparePreloader=function(e,t){this._logger.log("preparePreloader(), isFirstLoad=",e);var o=this.getIdleVideoNode();return o?(t.extraVars.preloadVideoNode=o,e&&(this.setCurVideoNode(o),this.visibleVideoNode(o,!0)),new OrgPreLoader(this._config)):null},t.prototype.getIdleVideoNode=function(){if(this._firstVideoNode){var e=this._firstVideoNode;return this._firstVideoNode=null,e}for(var t=null,o=this._vnList.length,i=0;i<o;i++)if(this._vnList[i].state===exports.VIDEO_STATE.IDLE&&this._vnList[i]!==this._curVideoNode){t=this._vnList.splice(i,1)[0];break}return t&&this._vnList.push(t),t},t.prototype.getLevelSwitching=function(){return!!this._setLevelVideoNode},t.prototype.setLevelInner=function(e){var t=this;if(this.decideSetLevelMode()===SET_LEVEL_MODE.HARD)return this._curVideoNode.setLevel();var o=new SimpleDefer,i=this.currentVideoInfo;this._logger.log("setLevelInner(), uid: ".concat(i.uid)),this.pauseInner(),this.setPlayEvents(this._curVideoNode,!1),this.emit(exports.PLAY_EVENT.SETLEVEL_START,{videoInfo:i,mode:SET_LEVEL_MODE.SMOOTH}),this.setLoading(!0);var r=this._curVideoNode.playtime,n=this.getIdleVideoNode();n?this.visibleVideoNode(n,!1):(this._curVideoNode.stop(),n=this._curVideoNode),i.extraVars.isLoadstarted=!1,this._setLevelVideoNode=n,this._setLevelVideoNode.setLevelEvtMap={};var a=this._curVideoNode;this.setCurVideoNode(n,!0);return n.setLevelEvtMap[VIDEO_NODE_EVENT.STATE_CHANGE]=function(e){e.data.new===exports.VIDEO_STATE.PLAYING&&(t._logger.log("setLevel succ>>>>>> uid: ".concat(i.uid),e),t.clearSetLevelThings(!0),t.switchVideoNodeWhenSetLevelSucc(a),o.resolve(),t.emit(exports.PLAY_EVENT.SETLEVEL_OVER,{videoInfo:i}),t.setLoading(!1))},n.setLevelEvtMap[VIDEO_NODE_EVENT.ERROR]=function(e){var r;t._logger.log("setLevel fail>>>>>> uid: ".concat(i.uid),e),t.clearSetLevelThings(),t._logger.log(">>>>>rollbackLevelVideoNode<<<<<"),t._urlBeforeSetLevel&&(Object.assign(t.currentVideoInfo.config,t._urlBeforeSetLevel),t.currentVideoInfo.reset(),t._urlBeforeSetLevel=null),t.setPlayEvents(t._curVideoNode,!0),t.resumeInner(),o.reject(new Error("setLevel failed, ".concat(null===(r=i.error)||void 0===r?void 0:r.message))),t.emit(exports.PLAY_EVENT.SETLEVEL_OVER,{videoInfo:i,fail:!0}),t.setLoading(!1)},n.on(VIDEO_NODE_EVENT.STATE_CHANGE,n.setLevelEvtMap[VIDEO_NODE_EVENT.STATE_CHANGE]),n.on(VIDEO_NODE_EVENT.ERROR,n.setLevelEvtMap[VIDEO_NODE_EVENT.ERROR]),n.play(i,{startTime:r}),o.promise},t.prototype.switchVideoNodeWhenSetLevelSucc=function(e){this._logger.log(">>>>>switchLevelVideoNode<<<<<"),e===this._curVideoNode?this.visibleVideoNode(this._curVideoNode,!0):(this.visibleVideoNode(this._curVideoNode,!0),this.visibleVideoNode(e,!1),null==e||e.stop())},t.prototype.clearSetLevelThings=function(e){if(this.getLevelSwitching()){var t=this._setLevelVideoNode;t.setLevelEvtMap&&(Object.keys(t.setLevelEvtMap).forEach((function(e){t.off(e,t.setLevelEvtMap[e])})),t.setLevelEvtMap=null),e||t.stop(),this.clearAllPreloadInner(),this._setLevelVideoNode=null}},t.prototype.checkAccuratePlaytime=function(e,t){var o,i,r=this._config.originKernelConfig.prePlayNextTime,n=Math.abs(t-e);if(r>0&&n<r&&!this._prePlayNext){this._prePlayNext=!0;var a=this.findPreloadIdxByVideoInfo(this.nextVideoInfo);if(this.nextVideoInfo&&-1!==a){var s=null===(i=null===(o=this._preloaders[a])||void 0===o?void 0:o.videoInfo)||void 0===i?void 0:i.extraVars.preloadVideoNode;s&&(this._logger.log("preplay next!! idx/state: ".concat(s.idx,"/").concat(s.state)),s.play())}}this.checkAutoPreloadNext(n)},t.prototype.stopInner=function(t,o,i){void 0===t&&(t=exports.END_STATE.NORMAL),void 0===o&&(o=!1),void 0===i&&(i=null),this._firstVideoNode=null,this._prePlayNext=!1,this.clearSetLevelThings(!0),e.prototype.stopInner.call(this,t,o,i)},t.prototype.destroy=function(){this._needHideVideoNode=null,this._setLevelVideoNode=null,this._firstVideoNode=null;var t=this.videoElements;e.prototype.destroy.call(this),t.forEach((function(e){e instanceof HTMLVideoElement&&(e.volume=1,e.muted=!1,domTool.css(e,{zIndex:"0",visibility:"inherit"}),e.dataset.idx="0")}))},t.isEnvSupport=!0,__decorate$2([logMethodCall$2,__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[Number]),__metadata$2("design:returntype",void 0)],t.prototype,"playInner",null),__decorate$2([logMethodCall$2,__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[]),__metadata$2("design:returntype",void 0)],t.prototype,"switchVideoNode",null),t}(BasePlayer),__extends$3=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),BaseLivePlayer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends$3(t,e),t.prototype.playInner=function(e){var t=this._videoInfos[0];this.setPlayEvents(this._curVideoNode,!0),this._curVideoNode.play(t),this.emit(exports.PLAY_EVENT.VIDEONODE_CHANGE,{videoInfo:t})},t.prototype.resumeInner=function(){var e;this._played&&(null===(e=this._curVideoNode)||void 0===e?void 0:e.currentVideoInfo)&&this._curVideoNode.videoplay()},t.prototype.loadInner=function(t,o){return!!e.prototype.loadInner.call(this,t,o)&&(this.setCurVideoNode(this._vnList[0]),this._curVideoNode.load(this._videoInfos[0]),!0)},t.prototype.appendAfter=function(e){},t.prototype.checkAccuratePlaytime=function(e,t){},t.prototype.preparePreloader=function(e,t){return null},t.prototype.getIdleVideoNode=function(){return this._vnList[0]},t.prototype.setLevelInner=function(e){return this._curVideoNode.setLevel()},t.prototype.playBlocked=function(){e.prototype.playBlocked.call(this),this.pause()},Object.defineProperty(t.prototype,"supportPreload",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPlaybackRate",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextVideoInfo",{get:function(){return this.currentVideoInfo},enumerable:!1,configurable:!0}),t}(BasePlayer);["seek","hasAppended","hasPreloaded","playNext","appendNext","preloadNext","clearAllPreload","appendAfter","checkPlayNext","playNextInner","checkAutoPreloadNext","clearAllPreloadInner"].forEach((function(e){BaseLivePlayer.prototype[e]=function(){console.warn("[thumbplayer] ".concat(e,"() is not support due to live stream"))}}));var __extends$2=window&&window.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),LivePlayer=function(e){function t(t){return e.call(this,mergeKernelConfig(t))||this}return __extends$2(t,e),Object.defineProperty(t.prototype,"kernelName",{get:function(){return exports.KERNEL_NAME.ORIGIN},enumerable:!1,configurable:!0}),t}(BaseLivePlayer),OrgPlayer=function(){function e(e){return e.type===exports.PLAY_MODE.LIVE?new LivePlayer(e):new MultiPlayer(e)}return Object.defineProperty(e,"canPlayType",{get:function(){return videoTool.supportVideoFormat()},enumerable:!1,configurable:!0}),e.isEnvSupport=!0,e.VERSION=VERSION$3,e.BUILD_TIME=BUILD_TIME$2,e}(),ThumbPlayerCore$1=Object.freeze({__proto__:null,MultiPlayer:MultiPlayer,OrgPlayer:OrgPlayer,OrgVideoNode:OrgVideoNode,OrgPreloader:OrgPreLoader,originDefaultConfig:defaultOriginKernelConfig,VideoInfo:VideoInfo,BaseVideoNode:BaseVideoNode,BasePlayer:BasePlayer,BaseLivePlayer:BaseLivePlayer,defaultPlayerConfig:defaultPlayerConfig,EvtEmitter:s$1,SimpleDefer:SimpleDefer,get DrmKeySystems(){return KeySystems},KernelFactory:KernelFactory$1,get KERNEL_NAME(){return exports.KERNEL_NAME},KernelProxy:KernelProxy,get SET_LEVEL_MODE(){return SET_LEVEL_MODE},get PLAY_MODE(){return exports.PLAY_MODE},CAN_PLAY_ALL:CAN_PLAY_ALL,VIDEO_CONTAINER_CLASS:VIDEO_CONTAINER_CLASS,get END_STATE(){return exports.END_STATE},get VIDEO_EVTS(){return VIDEO_EVTS},get VIDEO_STATE(){return exports.VIDEO_STATE},get ERROR_CODE(){return ERROR_CODE},VIDEO_ELEMENT_ERROR:VIDEO_ELEMENT_ERROR,get ERROR_MSG(){return ERROR_MSG},get PLAY_EVENT(){return exports.PLAY_EVENT},get VIDEO_NODE_EVENT(){return VIDEO_NODE_EVENT},get MSE_EVENTS(){return MSE_EVENTS},get PAUSE_TYPE(){return PAUSE_TYPE},get PLAYER_LOG_LEVEL(){return PLAYER_LOG_LEVEL},get PRELOAD_TYPE(){return exports.PRELOAD_TYPE},get CODEC(){return CODEC},get VIDEO_ELEMENT_STATE(){return VIDEO_ELEMENT_STATE},CDN_PATH_PREFIX:CDN_PATH_PREFIX,get CACHE_SIZE_KEY(){return CACHE_SIZE_KEY},commonTool:comTool,uaTool:uaTool,logTool:logtool,logMethodCallDecoratorCreator:logMethodCallDecoratorCreator,logMethodCallDecoratorCreater:logMethodCallDecoratorCreator,Logger:Logger,enableConsoleOutput:enableConsoleOutput,get LogMode(){return LogMode},dumpLog:dumpLog,cookieTool:cookieTool,lsTool:lsTool,urlTool:urlTool,domTool:domTool,netTool:netTool,videoTool:videoTool,stringTool:stringTool,jsonTool:jsonTool,CHANNEL:CHANNEL$1,BUILD_TIME:BUILD_TIME$2,VERSION:VERSION$3,LOCAL_DEV:LOCAL_DEV});KernelFactory$1.registerKernel(exports.KERNEL_NAME.ORIGIN,OrgPlayer),window.ThumbPlayerCore=ThumbPlayerCore$1;var ThumbPlayerCore=Object.freeze({__proto__:null,MultiPlayer:MultiPlayer,OrgPlayer:OrgPlayer,OrgVideoNode:OrgVideoNode,OrgPreloader:OrgPreLoader,originDefaultConfig:defaultOriginKernelConfig,VideoInfo:VideoInfo,BaseVideoNode:BaseVideoNode,BasePlayer:BasePlayer,BaseLivePlayer:BaseLivePlayer,defaultPlayerConfig:defaultPlayerConfig,EvtEmitter:s$1,SimpleDefer:SimpleDefer,get DrmKeySystems(){return KeySystems},KernelFactory:KernelFactory$1,get KERNEL_NAME(){return exports.KERNEL_NAME},KernelProxy:KernelProxy,get SET_LEVEL_MODE(){return SET_LEVEL_MODE},get PLAY_MODE(){return exports.PLAY_MODE},CAN_PLAY_ALL:CAN_PLAY_ALL,VIDEO_CONTAINER_CLASS:VIDEO_CONTAINER_CLASS,get END_STATE(){return exports.END_STATE},get VIDEO_EVTS(){return VIDEO_EVTS},get VIDEO_STATE(){return exports.VIDEO_STATE},get ERROR_CODE(){return ERROR_CODE},VIDEO_ELEMENT_ERROR:VIDEO_ELEMENT_ERROR,get ERROR_MSG(){return ERROR_MSG},get PLAY_EVENT(){return exports.PLAY_EVENT},get VIDEO_NODE_EVENT(){return VIDEO_NODE_EVENT},get MSE_EVENTS(){return MSE_EVENTS},get PAUSE_TYPE(){return PAUSE_TYPE},get PLAYER_LOG_LEVEL(){return PLAYER_LOG_LEVEL},get PRELOAD_TYPE(){return exports.PRELOAD_TYPE},get CODEC(){return CODEC},get VIDEO_ELEMENT_STATE(){return VIDEO_ELEMENT_STATE},CDN_PATH_PREFIX:CDN_PATH_PREFIX,get CACHE_SIZE_KEY(){return CACHE_SIZE_KEY},commonTool:comTool,uaTool:uaTool,logTool:logtool,logMethodCallDecoratorCreator:logMethodCallDecoratorCreator,logMethodCallDecoratorCreater:logMethodCallDecoratorCreator,Logger:Logger,enableConsoleOutput:enableConsoleOutput,get LogMode(){return LogMode},dumpLog:dumpLog,cookieTool:cookieTool,lsTool:lsTool,urlTool:urlTool,domTool:domTool,netTool:netTool,videoTool:videoTool,stringTool:stringTool,jsonTool:jsonTool,CHANNEL:CHANNEL$1,BUILD_TIME:BUILD_TIME$2,VERSION:VERSION$3,LOCAL_DEV:LOCAL_DEV}),extendStatics$1=function(e,t){return extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},extendStatics$1(e,t)};function __extends$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}extendStatics$1(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var __assign$2=function(){return __assign$2=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$2.apply(this,arguments)};function __decorate$1(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a}function __metadata$1(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter$1(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))}function __generator$1(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}function __spreadArray$1(e,t,o){if(o||2===arguments.length)for(var i,r=0,n=t.length;r<n;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||t)}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},sha256={exports:{}};(function(module){(function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&module.exports,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(o){return new Sha256(t,!0).update(o)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var o=0;o<OUTPUT_TYPES.length;++o){var i=OUTPUT_TYPES[o];t[i]=createOutputMethod(i,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null==e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(o,i){return new HmacSha256(o,t,!0).update(i)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,o){return t.create(e).update(o)};for(var o=0;o<OUTPUT_TYPES.length;++o){var i=OUTPUT_TYPES[o];t[i]=createHmacOutputMethod(i,e)}return t};function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,o){var i,r=typeof e;if("string"===r){var n,a=[],s=e.length,l=0;for(i=0;i<s;++i)(n=e.charCodeAt(i))<128?a[l++]=n:n<2048?(a[l++]=192|n>>6,a[l++]=128|63&n):n<55296||n>=57344?(a[l++]=224|n>>12,a[l++]=128|n>>6&63,a[l++]=128|63&n):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++i)),a[l++]=240|n>>18,a[l++]=128|n>>12&63,a[l++]=128|n>>6&63,a[l++]=128|63&n);e=a}else{if("object"!==r)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var p=[],c=[];for(i=0;i<64;++i){var d=e[i]||0;p[i]=92^d,c[i]=54^d}Sha256.call(this,t,o),this.update(c),this.oKeyPad=p,this.inner=!0,this.sharedMemory=o}Sha256.prototype.update=function(e){if(!this.finalized){var t,o=typeof e;if("string"!==o){if("object"!==o)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var i,r,n=0,a=e.length,s=this.blocks;n<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(r=this.start;n<a&&r<64;++n)s[r>>2]|=e[n]<<SHIFT[3&r++];else for(r=this.start;n<a&&r<64;++n)(i=e.charCodeAt(n))<128?s[r>>2]|=i<<SHIFT[3&r++]:i<2048?(s[r>>2]|=(192|i>>6)<<SHIFT[3&r++],s[r>>2]|=(128|63&i)<<SHIFT[3&r++]):i<55296||i>=57344?(s[r>>2]|=(224|i>>12)<<SHIFT[3&r++],s[r>>2]|=(128|i>>6&63)<<SHIFT[3&r++],s[r>>2]|=(128|63&i)<<SHIFT[3&r++]):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++n)),s[r>>2]|=(240|i>>18)<<SHIFT[3&r++],s[r>>2]|=(128|i>>12&63)<<SHIFT[3&r++],s[r>>2]|=(128|i>>6&63)<<SHIFT[3&r++],s[r>>2]|=(128|63&i)<<SHIFT[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=s[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,o,i,r,n,a,s,l,p=this.h0,c=this.h1,d=this.h2,u=this.h3,A=this.h4,_=this.h5,g=this.h6,E=this.h7,f=this.blocks;for(e=16;e<64;++e)t=((r=f[e-15])>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,o=((r=f[e-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,f[e]=f[e-16]+t+f[e-7]+o<<0;for(l=c&d,e=0;e<64;e+=4)this.first?(this.is224?(n=300032,E=(r=f[0]-1413257819)-150054599<<0,u=r+24177077<<0):(n=704751109,E=(r=f[0]-210244248)-1521486534<<0,u=r+143694565<<0),this.first=!1):(t=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),i=(n=p&c)^p&d^l,E=u+(r=E+(o=(A>>>6|A<<26)^(A>>>11|A<<21)^(A>>>25|A<<7))+(A&_^~A&g)+K[e]+f[e])<<0,u=r+(t+i)<<0),t=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),i=(a=u&p)^u&c^n,g=d+(r=g+(o=(E>>>6|E<<26)^(E>>>11|E<<21)^(E>>>25|E<<7))+(E&A^~E&_)+K[e+1]+f[e+1])<<0,t=((d=r+(t+i)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),i=(s=d&u)^d&p^a,_=c+(r=_+(o=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&E^~g&A)+K[e+2]+f[e+2])<<0,t=((c=r+(t+i)<<0)>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),i=(l=c&d)^c&u^s,A=p+(r=A+(o=(_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7))+(_&g^~_&E)+K[e+3]+f[e+3])<<0,p=r+(t+i)<<0;this.h0=this.h0+p<<0,this.h1=this.h1+c<<0,this.h2=this.h2+d<<0,this.h3=this.h3+u<<0,this.h4=this.h4+A<<0,this.h5=this.h5+_<<0,this.h6=this.h6+g<<0,this.h7=this.h7+E<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,o=this.h2,i=this.h3,r=this.h4,n=this.h5,a=this.h6,s=this.h7,l=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a];return this.is224||(l+=HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]),l},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,o=this.h2,i=this.h3,r=this.h4,n=this.h5,a=this.h6,s=this.h7,l=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,o>>24&255,o>>16&255,o>>8&255,255&o,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,a>>24&255,a>>16&255,a>>8&255,255&a];return this.is224||l.push(s>>24&255,s>>16&255,s>>8&255,255&s),l},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224)})()})(sha256);var adPluginMap={};function setAdPlugin(e,t){adPluginMap[e]=t}function getAdPlugin(e){return adPluginMap[e]}var AdPluginName="__thumbplayer-ad",AD_TYPE,ErrorCode,ErrorMsg,H5_EXT_EVENT,H5_PLAY_EVENT;function isPreOrPostAd(e){return-1!==[exports.AD_TYPE.PRE,exports.AD_TYPE.POST].indexOf(e.adType)}exports.AD_TYPE=void 0,AD_TYPE=exports.AD_TYPE||(exports.AD_TYPE={}),AD_TYPE.PRE="preAd",AD_TYPE.POST="postAd",exports.ErrorCode=void 0,ErrorCode=exports.ErrorCode||(exports.ErrorCode={}),ErrorCode.SUC="0",ErrorCode.UNKNOWN="70040000",ErrorCode.AD_END_DEFAULT_FAIL="70040002",ErrorCode.AD_REQ_INFO_DEFAULT_FAIL="70040003",ErrorCode.GETINFO_PLUGIN_MISSING="70040001",ErrorCode.GETINFO_NET="70014001",ErrorCode.GETINFO_TIMEOUT="70014003",ErrorCode.GETINFO_PARSE="70014004",ErrorCode.GETINFO_INNER="70014005",ErrorCode.GETINFO_SERVER_CODE_PREFIX="70013",ErrorCode.GETINFO_LIVE_SERVER_CODE_PREFIX="70023",ErrorCode.UNPAIED_1080P="70013091.0",exports.ErrorMsg=void 0,ErrorMsg=exports.ErrorMsg||(exports.ErrorMsg={}),ErrorMsg.GETINFO_PLUGIN_MISSING="没有找到获取视频信息插件",ErrorMsg.GETINFO_INNER="获取视频信息内部错误",ErrorMsg.GETINFO_NET="无法获取视频信息",ErrorMsg.GETINFO_TIMEOUT="获取视频信息超时",ErrorMsg.GETINFO_PARSE="视频信息无法解析",ErrorMsg.GETINFO_CODE="播放后台返回错误",exports.PLAY_EVENT_EXT=void 0,H5_EXT_EVENT=exports.PLAY_EVENT_EXT||(exports.PLAY_EVENT_EXT={}),H5_EXT_EVENT.SET_LOADING="SET_LOADING",H5_EXT_EVENT.PROXY_HTTP_START="PROXY_HTTP_START",H5_EXT_EVENT.PROXY_HTTP_END="PROXY_HTTP_END",H5_EXT_EVENT.GETINFO_START="GETINFO_START",H5_EXT_EVENT.GETINFO_OVER="GETINFO_OVER",H5_EXT_EVENT.VID_CHANGE="VID_CHANGE",H5_EXT_EVENT.DESTROY="DESTROY",H5_EXT_EVENT.DATASET_UPDATE="data-set:update",H5_EXT_EVENT.DATASET_STATE_UPDATE="data-set:stateUpdate",H5_EXT_EVENT.RETRY_PLAY="retryPlay",H5_EXT_EVENT.FLOW_NODE_PRELOAD="FLOW_NODE_PRELOAD",H5_EXT_EVENT.FLOW_NODE_START="FLOW_NODE_START",H5_EXT_EVENT.FLOW_NODE_END="FLOW_NODE_END",H5_EXT_EVENT.FLOW_NODE_ABORT="FLOW_NODE_ABORT",exports.H5_PLAY_EVENT=void 0,H5_PLAY_EVENT=exports.H5_PLAY_EVENT||(exports.H5_PLAY_EVENT={}),H5_PLAY_EVENT.PLAY_SESSION_START="PLAY_SESSION_START",H5_PLAY_EVENT.AD_REQ_INFO_START="AD_REQ_INFO_START",H5_PLAY_EVENT.AD_REQ_INFO_END="AD_REQ_INFO_END",H5_PLAY_EVENT.AD_REQ_ASSETS_START="AD_REQ_ASSETS_START",H5_PLAY_EVENT.AD_AUTOPLAY_BLOCKED="AD_AUTOPLAY_BLOCKED",H5_PLAY_EVENT.AD_PLAYING="AD_PLAYING",H5_PLAY_EVENT.AD_VOLUME_CHANGE="AD_VOLUME_CHANGE",H5_PLAY_EVENT.AD_ASSETS_LOADED="AD_ASSETS_LOADED",H5_PLAY_EVENT.AD_PAUSE="AD_PAUSE",H5_PLAY_EVENT.AD_END="AD_END",H5_PLAY_EVENT.AD_TIME_UPDATE="AD_TIME_UPDATE",H5_PLAY_EVENT.VIDEO_REQ_INFO_START="VIDEO_REQ_INFO_START",H5_PLAY_EVENT.VIDEO_REQ_INFO_END="VIDEO_REQ_INFO_END",H5_PLAY_EVENT.VIDEO_LOAD_START="VIDEO_LOAD_START",H5_PLAY_EVENT.VIDEO_LOAD_PROGRESS="VIDEO_LOAD_PROGRESS",H5_PLAY_EVENT.VIDEO_DURATION_CHANGE="VIDEO_DURATION_CHANGE",H5_PLAY_EVENT.VIDEO_METADATA_CHANGE="VIDEO_METADATA_CHANGE",H5_PLAY_EVENT.VIDEO_TIMEUPDATE="VIDEO_TIMEUPDATE",H5_PLAY_EVENT.VIDEO_VOLUME_CHANGE="VIDEO_VOLUME_CHANGE",H5_PLAY_EVENT.VIDEO_RATE_CHANGE="VIDEO_RATE_CHANGE",H5_PLAY_EVENT.VIDEO_CANPLAY="VIDEO_CANPLAY",H5_PLAY_EVENT.VIDEO_PLAYING="VIDEO_PLAYING",H5_PLAY_EVENT.VIDEO_AUTOPLAY_BLOCKED="VIDEO_AUTOPLAY_BLOCKED",H5_PLAY_EVENT.VIDEO_PAUSE="VIDEO_PAUSE",H5_PLAY_EVENT.VIDEO_BUFFERING="VIDEO_BUFFERING",H5_PLAY_EVENT.VIDEO_SEEKING="VIDEO_SEEKING",H5_PLAY_EVENT.VIDEO_SEEKED="VIDEO_SEEKED",H5_PLAY_EVENT.VIDEO_SETLEVEL_START="VIDEO_SETLEVEL_START",H5_PLAY_EVENT.VIDEO_SETLEVEL_END="VIDEO_SETLEVEL_END",H5_PLAY_EVENT.VIDEO_RESIZE="VIDEO_RESIZE",H5_PLAY_EVENT.VIDEO_END="VIDEO_END",H5_PLAY_EVENT.PLAY_SESSION_END="PLAY_SESSION_END";var pluginStorage={},pluginExists=function(e){return Object.prototype.hasOwnProperty.call(pluginStorage,e)},getPlugin=function(e){return pluginExists(e)?pluginStorage[e]:void 0};function registerPlugin(e,t){if("string"!=typeof e)throw new Error('Illegal plugin name, "'+e+'", must be a string, was '+typeof e+".");if("function"!=typeof t)throw new Error('Illegal plugin for "'+e+'", must be a function, was '+typeof t+".");if(!pluginExists(e))return pluginStorage[e]=t,t;console.warn('A plugin named "'+e+'" already exists. You may want to avoid re-registering plugins!')}function deregisterPlugin(e){pluginExists(e)&&delete pluginStorage[e]}function getPlugins(e){var t;return void 0===e&&(e=Object.keys(pluginStorage)),e.forEach((function(e){var o=getPlugin(e);o&&((t=t||{})[e]=o)})),t}var methodPrefix="hook",playHooks=Object.values(exports.H5_PLAY_EVENT),Plugin=function(e){function t(o,i,r){var n=this.constructor,a=e.call(this)||this;if(a.player=o,a.config=i,a.hookMap={},n===t)throw new Error("Plugin must be sub-classed; not directly instantiated.");a.logger_=new Logger(o.config.instanceId,a.constructor.pluginName);var s=(r||{}).msg;return a.msg=s,a.registerHook(),a}return __extends$1(t,e),t.prototype.log=function(){for(var e,t,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null===(t=(e=this.logger_).log)||void 0===t||t.call.apply(t,__spreadArray$1([e],o))},t.prototype.warn=function(){for(var e,t,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null===(t=(e=this.logger_).warn)||void 0===t||t.call.apply(t,__spreadArray$1([e],o))},t.prototype.error=function(){for(var e,t,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null===(t=(e=this.logger_).error)||void 0===t||t.call.apply(t,__spreadArray$1([e],o))},t.prototype.debug=function(){for(var e,t,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null===(t=(e=this.logger_).debug)||void 0===t||t.call.apply(t,__spreadArray$1([e],o))},t.prototype.info=function(){for(var e,t,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null===(t=(e=this.logger_).info)||void 0===t||t.call.apply(t,__spreadArray$1([e],o))},t.prototype.hasPlugin=function(e){return!!pluginExists(e)},t.prototype.destroy=function(){var e,t=this.player,o=this.name;(null===(e=t.plugins)||void 0===e?void 0:e[o])&&delete t.plugins[o],this.unRegisterHook(),this.hookMap=null,this.player=null,this.removeAllListeners()},t.prototype.hookPlaySessionStart=function(e){},t.prototype.hookAdReqInfoStart=function(e){},t.prototype.hookAdReqInfoEnd=function(e){},t.prototype.hookAdReqAssetsStart=function(e){},t.prototype.hookAdAutoplayBlocked=function(e){},t.prototype.hookAdPlaying=function(e){},t.prototype.hookAdVolumeChange=function(e){},t.prototype.hookAdAssetsLoaded=function(e){},t.prototype.hookAdPause=function(e){},t.prototype.hookAdEnd=function(e){},t.prototype.hookAdTimeUpdate=function(e){},t.prototype.hookVideoReqInfoStart=function(e){},t.prototype.hookVideoReqInfoEnd=function(e){},t.prototype.hookVideoLoadStart=function(e){},t.prototype.hookVideoMetadataChange=function(e){},t.prototype.hookVideoLoadProgress=function(e){},t.prototype.hookVideoDurationChange=function(e){},t.prototype.hookVideoTimeupdate=function(e){},t.prototype.hookVideoVolumeChange=function(e){},t.prototype.hookVideoResize=function(e){},t.prototype.hookVideoRateChange=function(e){},t.prototype.hookVideoCanplay=function(e){},t.prototype.hookVideoPlaying=function(e){},t.prototype.hookVideoAutoplayBlocked=function(e){},t.prototype.hookVideoPause=function(e){},t.prototype.hookVideoBuffering=function(e){},t.prototype.hookVideoSeeking=function(e){},t.prototype.hookVideoSeeked=function(e){},t.prototype.hookVideoSetlevelStart=function(e){},t.prototype.hookVideoSetlevelEnd=function(e){},t.prototype.hookVideoEnd=function(e){},t.prototype.hookPlaySessionEnd=function(e){},t.prototype.registerHook=function(){var e=this;playHooks.forEach((function(t){var o=getHookMethodName(t);e.hookMap[t]=function(t){var i;return null===(i=e[o])||void 0===i?void 0:i.call(e,t.data)},e.player.on(t,e.hookMap[t])}))},t.prototype.unRegisterHook=function(){var e=this;playHooks.forEach((function(t){e.hookMap[t]&&e.player.off(t,e.hookMap[t])}))},t.VERSION="",t.pluginName="",t}(s$1);function isFunctionPlugin(e){var t="string"==typeof e?getPlugin(e):e;return"function"==typeof t&&!Object.prototype.isPrototypeOf.call(Plugin.prototype,t.prototype)}function createPluginFactory(e,t){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var r,n=o[0];if(isFunctionPlugin(t))r=t.apply(n,o);else{var a=t;a.prototype.name=e,r=new(a.bind.apply(a,__spreadArray$1([void 0],o)))}return r&&(n.plugins[e]=r),r}function getHookMethodName(e){return methodPrefix+e.toLowerCase().replace(/^[a-z]/,(function(e){return e.toUpperCase()})).replace(/_[a-z]/g,(function(e){return e[1].toUpperCase()}))}var VideoReqInfoPluginName="__thumbplayer-video-request";function isVideoId(e){return"string"==typeof e||"number"==typeof e}var DRM_TYPE={NONE:0,CHACHA:3,FAIR_PLAY:4,WIDEVINE:5,ChinaDRM:6},DRM_VALUE={NONE:0,CHACHA:8,FAIR_PLAY:16,WIDEVINE:32},DATA_EVENTS,DATA_STATE,LOG_TYPE,BUFFER_REASON,PersistedUserSettings;exports.DATA_EVENTS=void 0,DATA_EVENTS=exports.DATA_EVENTS||(exports.DATA_EVENTS={}),DATA_EVENTS.UPDATE="data-set:update",DATA_EVENTS.STATE_UPDATE="data-set:stateUpdate",exports.DATA_STATE=void 0,DATA_STATE=exports.DATA_STATE||(exports.DATA_STATE={}),DATA_STATE.INIT="PLAYER:init",DATA_STATE.SESSION_START="PLAYER:session_start",DATA_STATE.SESSION_END="PLAYER:session_end",DATA_STATE.GET_INFO="PLAYER:getinfo",DATA_STATE.GET_INFO_START="PLAYER:getinfo_start",DATA_STATE.GET_INFO_END="PLAYER:getinfo_end",DATA_STATE.SUBTITLE="PLAYER:subtitle",DATA_STATE.SUBTITLE_START="PLAYER:subtitle_start",DATA_STATE.SUBTITLE_END="PLAYER:subtitle_end",DATA_STATE.LOAD_START="PLAYER:load_start",DATA_STATE.LOAD_END="PLAYER:load_end",DATA_STATE.LOAD="PLAYER:load",DATA_STATE.BUFFER="PLAYER:buffer",DATA_STATE.BUFFER_START="PLAYER:buffer_start",DATA_STATE.BUFFER_END="PLAYER:buffer_end",DATA_STATE.SEEK="PLAYER:seek",DATA_STATE.SEEK_START="PLAYER:seek_start",DATA_STATE.SEEK_END="PLAYER:seek_end",DATA_STATE.USER_SEEK_START="PLAYER:user_seek_start",DATA_STATE.USER_SEEK_END="PLAYER:user_seek_end",DATA_STATE.END="PLAYER:end",DATA_STATE.ERROR="PLAYER:error",DATA_STATE.FATAL_ERROR="PLAYER:fatal_error",DATA_STATE.FIRST_PLAY="PLAYER:firstPlay",DATA_STATE.IDLE="PLAYER:idle",DATA_STATE.PLAYING="PLAYER:playing",DATA_STATE.SET_LEVEL="PLAYER:setLevel",DATA_STATE.SET_LEVEL_START="PLAYER:setLevel_start",DATA_STATE.SET_LEVEL_END="PLAYER:setLevel_end",DATA_STATE.PAUSE="PLAYER:pause",DATA_STATE.PAUSE_START="PLAYER:pause_start",DATA_STATE.PAUSE_END="PLAYER:pause_end",DATA_STATE.SET_RATE="PLAYER:setRate",DATA_STATE.RETRY_BACKURL="PLAYER:retryBackUrl",DATA_STATE.RETRY_PLAY="PLAYER:retryPlay",DATA_STATE.AUTO_PLAY_BLOCKED="PLAYER:autoplayBlocked",exports.LOG_TYPE=void 0,LOG_TYPE=exports.LOG_TYPE||(exports.LOG_TYPE={}),LOG_TYPE.USER_ACTION="log:userAction",LOG_TYPE.PLUGIN_ACTION="log:pluginAction",LOG_TYPE.CORE_EVENT="log:coreEvent",LOG_TYPE.API_INVOKE="log:apiInvoke",LOG_TYPE.UNCATEGORIZED="log:uncategorized",exports.BUFFER_REASON=void 0,BUFFER_REASON=exports.BUFFER_REASON||(exports.BUFFER_REASON={}),BUFFER_REASON[BUFFER_REASON.NETWORK_UNSTABLE=1400027]="NETWORK_UNSTABLE",BUFFER_REASON[BUFFER_REASON.PARALLEL_DOWNLOAD=1400028]="PARALLEL_DOWNLOAD",BUFFER_REASON[BUFFER_REASON.CDN_NO_CONNECTION=1400007]="CDN_NO_CONNECTION",BUFFER_REASON[BUFFER_REASON.CDN_URL_SWITCH_SUCCESS=1400029]="CDN_URL_SWITCH_SUCCESS",BUFFER_REASON[BUFFER_REASON.CDN_SLOW=1400030]="CDN_SLOW",BUFFER_REASON[BUFFER_REASON.CDN_URL_SWITCH_UNSUCCESS=1400031]="CDN_URL_SWITCH_UNSUCCESS",BUFFER_REASON[BUFFER_REASON.CDN_TIMEOUT=1400026]="CDN_TIMEOUT",BUFFER_REASON[BUFFER_REASON.CDN_TIMEOUT_URL_SWITCH=1400032]="CDN_TIMEOUT_URL_SWITCH",BUFFER_REASON[BUFFER_REASON.BYTERATE_ERROR=1400033]="BYTERATE_ERROR",BUFFER_REASON[BUFFER_REASON.DOWNLOAD_TOO_SHORT=1400034]="DOWNLOAD_TOO_SHORT",BUFFER_REASON[BUFFER_REASON.P2P_UPLOAD_SLOW=1400035]="P2P_UPLOAD_SLOW",BUFFER_REASON[BUFFER_REASON.DEFAULT=0]="DEFAULT",exports.LOCAL_KEY=void 0,function(e){e.GUID="thumbplayer-h5-guid",e.VOLUME="thumbplayer-h5-volume"}(exports.LOCAL_KEY||(exports.LOCAL_KEY={})),exports.PersistedUserSettings=void 0,PersistedUserSettings=exports.PersistedUserSettings||(exports.PersistedUserSettings={}),PersistedUserSettings.definition="user-setting:definition",PersistedUserSettings.volume="user-setting:volume",PersistedUserSettings.playbackRate="user-setting:playbackRate",PersistedUserSettings.subtitle="user-setting:subtitle",PersistedUserSettings.audioTrack="user-setting:audioTrack";var DEFAULT_KEY={loginid:"",loginex:"",logintype:"",hh_ip:"",hc_main_login:"",hc_vuserid:"",hc_openid:"",hc_appid:"",hc_access_token:"",hc_vuession:"",vip:0,codec:CODEC.H264,freetype:0,mobile:0,guid:"",ua:"",uip:"",device:"",resolution:"",osver:"",p2pver:"",appVer:"",playerver:"",playertype:0,playercore:"",confid:"",downloadkit:0,online:1,p2p:0,sstrength:0,network:0,testid:0,curcore:"",curcorever:"",speed:0,quic:0,platform:"",flowid:"",vid:"",cid:"",columnId:"",livepid:"",interactid:"",url:"",referrer:"",topUrl:"",drm:0,drmtype:0,fmt:0,cdnid:0,dltype:"",rate:0,clip:0,status:0,duration:0,type:0,cdnuip:"",cdnip:"",ptag:"",sdtfrom:"",authfrom:"",currentDefnList:[],currentDefn:"",currentAudioTrack:0,currentAudioTrackList:[],currentSubtitle:"",currentSubtitleList:[],sessionBufferCount:0,sessionRetryBackUrlCount:0,sessionRetryPlayCount:0},COMMON_DATA_KEY={},_a$1$2;Object.keys(DEFAULT_KEY).forEach((function(e){return COMMON_DATA_KEY[e]=e}));var FreezeKey="thumbplayer-h5-dataset",KeySystemToDrmType=(_a$1$2={},_a$1$2[KeySystems.Widevine]=DRM_TYPE.WIDEVINE,_a$1$2[KeySystems.FairPlay]=DRM_TYPE.FAIR_PLAY,_a$1$2[KeySystems.FairPlayWebKit]=DRM_TYPE.FAIR_PLAY,_a$1$2.none=DRM_TYPE.NONE,_a$1$2),confIdMap={default:0,hlsProgressive:1,hlsFragPrefetch:2},DataSet=function(e){function t(o,i,r){var n=e.call(this,o,i,r)||this;return n.player=o,n.isSeeking=!1,n.isBuffering=!1,n.isSettingLevel=!1,n.isLoading=!1,n.lastPlay=0,n.playDuration=0,n.prevPlayTimeS=0,n.sessionBufferCount=0,n.sessionRetryBackUrlCount=0,n.sessionRetryPlayCount=0,n.commonMapFreeze={},n.stateMapFreeze={},n.isLive=!1,n.evtIdMap={},n.writeCommon=function(e,o,i){var r=n.commonMap[e];return n.commonMap[e]=o,t.canUseProxy||n.emit(exports.DATA_EVENTS.UPDATE,{key:e,oldVal:r,newVal:o}),!!i&&n.freeze("common",e,i)},n.writeState=function(e,o,i){var r=o.type||exports.LOG_TYPE.UNCATEGORIZED,a=n.stateMap[e],s=n.getStartEventData(e);return n.stateMap[e]=__assign$2(__assign$2(__assign$2({},r===exports.LOG_TYPE.CORE_EVENT?n.stats:{}),{type:r,ftime:+new Date,name:e,eventId:n.generateEvtId()}),o),!t.canUseProxy&&n.commonMap[COMMON_DATA_KEY.flowid]&&n.emit(exports.DATA_EVENTS.STATE_UPDATE,{key:e,oldVal:a,newVal:n.stateMap[e],startEvent:s}),!!i&&n.freeze("state",e,i)},n.onClose=function(){var e=+new Date;return{code:exports.ErrorCode.SUC,playDuration:n.playDuration,ftime:e}},n.getStats=function(){return __assign$2(__assign$2({playDuration:n.playDuration},n.stats),n.visualStats)},n.generateFlowId=function(){return comTool.createGUID(32)},n.generateEvtId=function(){return comTool.createGUID(8)},n.getStartEventData=function(e){var t;return((t={})[exports.DATA_STATE.SEEK_END]=n.stateMap[exports.DATA_STATE.SEEK_START],t[exports.DATA_STATE.BUFFER_END]=n.stateMap[exports.DATA_STATE.BUFFER_START],t[exports.DATA_STATE.LOAD_END]=n.stateMap[exports.DATA_STATE.LOAD_START],t[exports.DATA_STATE.SET_LEVEL_END]=n.stateMap[exports.DATA_STATE.SET_LEVEL_START],t[exports.DATA_STATE.PAUSE_END]=n.stateMap[exports.DATA_STATE.PAUSE_START],t[exports.DATA_STATE.GET_INFO_END]=n.stateMap[exports.DATA_STATE.GET_INFO_START],t)[e]},n.resetState=function(){n.isBuffering=!1,n.isSeeking=!1,n.isSettingLevel=!1},n.finalCleanup=function(e,t){var o,i,r=t.error,a=t.loadingUrl,s=t.config,l=null!==(i=null===(o=null==s?void 0:s.backupUrls)||void 0===o?void 0:o.findIndex((function(e){return e===a})))&&void 0!==i?i:-1;n.isSeeking&&(n.writeState(exports.DATA_STATE.SEEK_END,{currentUrl:a,urlIndex:l,type:exports.LOG_TYPE.CORE_EVENT,ftime:e,error:r,code:(null==r?void 0:r.code)||exports.ErrorCode.SUC,name:exports.DATA_STATE.SEEK_END,eventId:n.evtIdMap[exports.DATA_STATE.SEEK_START]}),n.isSeeking=!1),n.isBuffering&&(n.writeState(exports.DATA_STATE.BUFFER_END,{currentUrl:a,urlIndex:l,type:exports.LOG_TYPE.CORE_EVENT,ftime:e,code:(null==r?void 0:r.code)||exports.ErrorCode.SUC,error:r,name:exports.DATA_STATE.BUFFER_END,eventId:n.evtIdMap[exports.DATA_STATE.BUFFER_START]}),n.isBuffering=!1),n.isSettingLevel&&(n.isSettingLevel=!1,n.writeState(exports.DATA_STATE.SET_LEVEL_END,{currentUrl:a,urlIndex:l,type:exports.LOG_TYPE.CORE_EVENT,ftime:e,code:(null==r?void 0:r.code)||exports.ErrorCode.SUC,error:r,name:exports.DATA_STATE.SET_LEVEL_END,eventId:n.evtIdMap[exports.DATA_STATE.SET_LEVEL_START]})),n.isLoading&&(n.isLoading=!1,n.writeState(exports.DATA_STATE.LOAD_END,{type:exports.LOG_TYPE.CORE_EVENT,currentUrl:a,urlIndex:l,ftime:e,error:r,code:(null==r?void 0:r.code)||exports.ErrorCode.SUC,name:exports.DATA_STATE.LOAD_END,eventId:n.evtIdMap[exports.DATA_STATE.LOAD_START]}))},n.onAutoplayBlocked=function(e){n.writeState(exports.DATA_STATE.AUTO_PLAY_BLOCKED,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.AUTO_PLAY_BLOCKED,eventId:n.generateEvtId(),ftime:+new Date})},n.onRetryLoad=function(e){var t=e.data,o=t.prevUrl,i=t.curUrl,r=t.error,a=void 0===r?{}:r;n.writeState(exports.DATA_STATE.RETRY_BACKURL,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.RETRY_BACKURL,eventId:n.generateEvtId(),prevUrl:o,currentUrl:i,ftime:+new Date,error:a,code:null==a?void 0:a.code}),n.sessionRetryBackUrlCount++,n.writeCommon(COMMON_DATA_KEY.sessionRetryBackUrlCount,n.sessionRetryBackUrlCount)},n.onRetryPlay=function(e){var t=e.data.retryTimes;n.writeState(exports.DATA_STATE.RETRY_PLAY,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.RETRY_PLAY,eventId:n.generateEvtId(),ftime:+new Date,ext:{retryTimes:t}}),n.sessionRetryPlayCount++,n.writeCommon(COMMON_DATA_KEY.sessionRetryPlayCount,n.sessionRetryPlayCount)},n.onBuffering=function(e){if(!n.isBuffering){n.isBuffering=!0;var t=n.generateEvtId();n.evtIdMap[exports.DATA_STATE.BUFFER_START]=t,n.writeState(exports.DATA_STATE.BUFFER_START,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.BUFFER_START,eventId:t,prevState:e.old,ftime:+new Date}),n.sessionBufferCount++,n.writeCommon(COMMON_DATA_KEY.sessionBufferCount,n.sessionBufferCount)}},n.onLoadStart=function(e){var t,o,i,r,a,s,l,p;n.resetState();var c=null===(t=e.videoInfo)||void 0===t?void 0:t.config,d=+new Date;n.writeCommon(COMMON_DATA_KEY.curcore,n.player.kernelName);var u=null===(o=KernelFactory$1.getKernelByName(n.player.kernelName))||void 0===o?void 0:o.VERSION;n.writeCommon(COMMON_DATA_KEY.curcorever,u),n.writeCommon(COMMON_DATA_KEY.drmtype,KeySystemToDrmType[(null===(i=c.drmConfig)||void 0===i?void 0:i.keySystem)||"none"]),n.writeCommon(COMMON_DATA_KEY.playertype,n.player.kernelName===exports.KERNEL_NAME.ORIGIN?0:1);var A=null===(a=(r=n.player.corePlayer).getHls)||void 0===a?void 0:a.call(r),_=null===(l=(s=n.player.corePlayer).getP2P)||void 0===l?void 0:l.call(s);if(_&&n.writeCommon(COMMON_DATA_KEY.p2pver,null===(p=_.getVersion)||void 0===p?void 0:p.call(_)),A){var g=A.config||{},E=g.progressive,f=g.startFragPrefetch,h=confIdMap.default;E&&(h+=confIdMap.hlsProgressive),f&&(h+=confIdMap.hlsFragPrefetch),h&&n.writeCommon(COMMON_DATA_KEY.confid,h),A.once("hlsBufferAppended",(function(){var e="TEMPORARY_FRAG_BUFFER_LOG";n.writeState(e,{type:exports.LOG_TYPE.CORE_EVENT,name:e,ext:{cost:+new Date-d}})}))}n.isLoading=!0;var v=n.generateEvtId();n.evtIdMap[exports.DATA_STATE.LOAD_START]=v,n.writeState(exports.DATA_STATE.LOAD_START,{type:exports.LOG_TYPE.CORE_EVENT,eventId:v,name:exports.DATA_STATE.LOAD_START,ftime:d})},n.onEnd=function(e){n.writeState(exports.DATA_STATE.END,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.END,eventId:n.generateEvtId(),ftime:+new Date,ext:{playDuration:n.playDuration},code:exports.ErrorCode.SUC})},n.onIdle=function(e,t){},n.onSeeking=function(e){var t,o,i=+new Date;n.isSeeking&&n.writeState(exports.DATA_STATE.SEEK_END,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.SEEK_END,ftime:i,eventId:n.evtIdMap[exports.DATA_STATE.SEEK_START],ext:{isUserSeek:(null===(o=null===(t=n.stateMap[exports.DATA_STATE.SEEK_START])||void 0===t?void 0:t.ext)||void 0===o?void 0:o.isUserSeek)||!1}}),n.isLive||n.resetState(),n.isSeeking=!0;var r=n.generateEvtId();n.evtIdMap[exports.DATA_STATE.SEEK_START]=r,n.writeState(exports.DATA_STATE.SEEK_START,{type:exports.LOG_TYPE.CORE_EVENT,ftime:i,name:exports.DATA_STATE.SEEK_START,eventId:r,ext:{inBufferedRange:videoTool.checkTimeInBuffer(e.seekingTime,n.player.videoBuffered),isUserSeek:e.isUserSeek}})},n.onSeeked=function(e){n.isSeeking&&(n.isSeeking=!1,n.writeState(exports.DATA_STATE.SEEK_END,{type:exports.LOG_TYPE.CORE_EVENT,eventId:n.evtIdMap[exports.DATA_STATE.SEEK_START],ftime:+new Date,name:exports.DATA_STATE.SEEK_END,ext:{isUserSeek:e.isUserSeek},code:exports.ErrorCode.SUC}))},n.onPause=function(e){var t=e.pauseType,o=n.generateEvtId();n.evtIdMap[exports.DATA_STATE.PAUSE_START]=o,n.writeState(exports.DATA_STATE.PAUSE_START,{type:exports.LOG_TYPE.CORE_EVENT,ftime:+new Date,name:exports.DATA_STATE.PAUSE_START,eventId:o,pauseType:t})},n.onPlaying=function(e){var t=+new Date;n.isBuffering&&(n.writeState(exports.DATA_STATE.BUFFER_END,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.BUFFER_END,ftime:t,eventId:n.evtIdMap[exports.DATA_STATE.BUFFER_START]}),n.isBuffering=!1),n.lastPlay=t,n.evtIdMap[exports.DATA_STATE.PAUSE_START]&&(n.writeState(exports.DATA_STATE.PAUSE_END,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.PAUSE_END,eventId:n.evtIdMap[exports.DATA_STATE.PAUSE_START],ftime:t,code:exports.ErrorCode.SUC}),delete n.evtIdMap[exports.DATA_STATE.PAUSE_START])},n.onCanPlay=function(e){var t=+new Date;n.isLoading&&(n.writeState(exports.DATA_STATE.LOAD_END,{type:exports.LOG_TYPE.CORE_EVENT,ftime:t,name:exports.DATA_STATE.LOAD_END,eventId:n.evtIdMap[exports.DATA_STATE.LOAD_START],code:exports.ErrorCode.SUC}),n.isLoading=!1)},n.onSetLevelStart=function(e){var t=+new Date;n.isSeeking&&(n.isSeeking=!1,n.writeState(exports.DATA_STATE.SEEK_END,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.SEEK_END,ftime:t,eventId:n.evtIdMap[exports.DATA_STATE.SEEK_START]})),n.resetState(),n.isSettingLevel=!0;var o=n.generateEvtId();n.evtIdMap[exports.DATA_STATE.SET_LEVEL_START]=o,n.writeState(exports.DATA_STATE.SET_LEVEL_START,{type:exports.LOG_TYPE.CORE_EVENT,ftime:t,eventId:o,name:exports.DATA_STATE.SET_LEVEL_START,ext:{defn:n.commonMap.currentDefn,mode:e.data.mode}})},n.onSetLevelEnd=function(e){var t=e.data,o=((void 0===t?{}:t).videoInfo||{}).error;n.isSettingLevel=!1,n.writeCommon(COMMON_DATA_KEY.curcore,n.player.kernelName),n.writeState(exports.DATA_STATE.SET_LEVEL_END,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.SET_LEVEL_END,ftime:+new Date,eventId:n.evtIdMap[exports.DATA_STATE.SET_LEVEL_START],error:o,code:(null==o?void 0:o.code)||exports.ErrorCode.SUC})},n.onError=function(e){var t,o,i=(e.data||{}).videoInfo,r=i||{},a=r.error,s=r.state,l=r.currentFragSn,p=r.currentFragUrl,c=r.loadingUrl,d=r.config,u=+new Date;n.writeState(exports.DATA_STATE.ERROR,{currentUrl:c,urlIndex:null!==(o=null===(t=null==d?void 0:d.backupUrls)||void 0===t?void 0:t.findIndex((function(e){return e===c})))&&void 0!==o?o:-1,type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.ERROR,eventId:n.generateEvtId(),fragUrl:p,ext:{fragSn:l},code:a.code,error:a,ftime:u,prevState:s}),n.finalCleanup(u,i)},n.onDurationChange=function(e){var t=e.data,o=((void 0===t?{}:t).videoInfo||{}).duration,i=void 0===o?0:o;n.commonMap.duration=i},n.onFirstPlay=function(e){var t=+new Date;n.writeState(exports.DATA_STATE.FIRST_PLAY,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.FIRST_PLAY,ftime:t,eventId:n.generateEvtId()})},n.onTimeChange=function(e){var t=Math.floor(n.player.playtime);t&&t!==n.prevPlayTimeS&&(n.prevPlayTimeS=t,n.playDuration||(n.playDuration=0),n.playDuration+=1)},n.onStateChange=function(e){var t,o=e.data,i=o.new,r=((t={})[exports.VIDEO_STATE.BUFFERING]=n.onBuffering,t[exports.VIDEO_STATE.LOAD_START]=n.onLoadStart,t[exports.VIDEO_STATE.END]=n.onEnd,t[exports.VIDEO_STATE.IDLE]=n.onIdle,t[exports.VIDEO_STATE.SEEKING]=n.onSeeking,t[exports.VIDEO_STATE.SEEKED]=n.onSeeked,t[exports.VIDEO_STATE.PAUSE]=n.onPause,t[exports.VIDEO_STATE.PLAYING]=n.onPlaying,t[exports.VIDEO_STATE.CANPLAY]=n.onCanPlay,t[exports.VIDEO_STATE.SEEKING]=n.onSeeking,t);r[i]&&r[i](o)},n.onRateChange=function(e){n.writeState(exports.DATA_STATE.SET_RATE,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.SET_RATE,eventId:n.generateEvtId(),ftime:+new Date})},n.onVideoReqInfoStart=function(){var e=n.generateEvtId();n.evtIdMap[exports.DATA_STATE.GET_INFO_START]=e,n.writeState(exports.DATA_STATE.GET_INFO_START,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.GET_INFO_START,eventId:e,ftime:+new Date})},n.onVideoReqInfoEnd=function(e){var t=e.data,o=t.code,i=t.data,r=void 0===i?{}:i;n.sessionRetryBackUrlCount=0,n.evtIdMap[exports.DATA_STATE.GET_INFO_START]&&n.writeState(exports.DATA_STATE.GET_INFO_END,{type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.GET_INFO_END,code:o,ext:{reqBody:urlTool.object2string(r.reqParams||{},"&"),reqPath:r.reqPath||"",retryCount:r.alreadyRetryCount||0},error:r.error||{},eventId:n.evtIdMap[exports.DATA_STATE.GET_INFO_START],ftime:+new Date})},n.onPlaySessionStart=function(e){var t=e.data;n.writeCommon(COMMON_DATA_KEY.flowid,t.flowid),n.emit(exports.DATA_EVENTS.STATE_UPDATE,{key:exports.DATA_STATE.INIT,oldVal:void 0,newVal:n.stateMap[exports.DATA_STATE.INIT],startEvent:void 0}),n.writeState(exports.DATA_STATE.SESSION_START,{eventId:n.generateEvtId(),type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.SESSION_START,ftime:+new Date})},n.onPlaySessionEnd=function(e){var t=e.data.code,o=t===exports.ErrorCode.SUC?__assign$2({},n.stateMap[exports.DATA_STATE.END]):__assign$2({},n.stateMap[exports.DATA_STATE.ERROR]);t!==exports.ErrorCode.SUC&&n.removeUserSetting([exports.PersistedUserSettings.definition,exports.PersistedUserSettings.audioTrack]),n.writeState(exports.DATA_STATE.SESSION_END,__assign$2(__assign$2({},o),{code:t,eventId:n.generateEvtId(),name:exports.DATA_STATE.SESSION_END,type:exports.LOG_TYPE.CORE_EVENT,ftime:+new Date})),n.playDuration=0,n.prevPlayTimeS=0,n.sessionBufferCount=0,n.sessionRetryBackUrlCount=0,n.sessionRetryPlayCount=0},n.getGUID=function(){var e=lsTool.getData(exports.LOCAL_KEY.GUID);if(e)return e;var t=comTool.createGUID(32);return lsTool.setData(exports.LOCAL_KEY.GUID,t),t},n.isTabFocused=function(){var e=["hidden","msHidden","webkitHidden"].find((function(e){return void 0!==document[e]}));return e?document[e]?0:1:-1},n.isPlayerInViewport=function(){var e=n.player.container;if(!e.offsetParent)return 0;var t=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth,r=t.top<=o&&t.top+t.height>=0,a=t.left<=i&&t.left+t.width>=0;return+(r&&a)},n.commonMap=t.canUseProxy?new Proxy({},{get:function(e,t,o){return Reflect.get(e,t,o)},set:function(e,t,o,i){if("string"!=typeof t)return!1;if(n.commonMapFreeze[t])return!1;var r=Reflect.get(e,t,i),a=Reflect.set(e,t,o,i);return r!==o&&n.emit(exports.DATA_EVENTS.UPDATE,{key:t,oldVal:r,newVal:o}),a}}):{},n.stateMap=t.canUseProxy?new Proxy({},{get:function(e,t,o){return Reflect.get(e,t,o)},set:function(e,t,o,i){if("string"!=typeof t)return!1;if(n.stateMapFreeze[t])return!1;var r=Reflect.get(e,t,i),a=Reflect.set(e,t,o,i);return n.commonMap[COMMON_DATA_KEY.flowid]&&n.emit(exports.DATA_EVENTS.STATE_UPDATE,{key:t,oldVal:r,newVal:o,startEvent:n.getStartEventData(t),startEventData:n.getStartEventData(t)}),a}}):{},n.isLive=n.player.config.type===exports.PLAY_MODE.LIVE,n.setEnv(),n.commonInfo(),n.persistUserSetting(),n}return __extends$1(t,e),Object.defineProperty(t.prototype,"stats",{get:function(){var e,t,o,i=this.player,r=i.playbackRate,n=i.volume,a=i.played,s=i.playtime,l=i.currentVideoInfo;return{volume:n,playbackRate:r,played:a,playtime:s,urlIndex:null!==(o=null===(t=null===(e=null==l?void 0:l.config)||void 0===e?void 0:e.backupUrls)||void 0===t?void 0:t.findIndex((function(e){return e===l.loadingUrl})))&&void 0!==o?o:-1,currentUrl:null==l?void 0:l.loadingUrl,paused:this.paused,fragUrl:null==l?void 0:l.currentFragUrl}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualStats",{get:function(){return{isTabFocused:this.isTabFocused(),isPlayerInViewport:this.isPlayerInViewport()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){var e,t;return null===(t=null===(e=this.player)||void 0===e?void 0:e.currentVideoElement)||void 0===t?void 0:t.paused},enumerable:!1,configurable:!0}),t.prototype.defrost=function(e,t,o){switch(void 0===o&&(o="secret"),e){case"state":return this.stateMapFreeze[t]===o&&(delete this.stateMapFreeze[t],!0);case"common":return this.commonMapFreeze[t]===o&&(delete this.commonMapFreeze[t],!0)}},t.prototype.freeze=function(e,t,o){switch(void 0===o&&(o="secret"),e){case"state":return this.stateMapFreeze[t]?(this.player.log(t+"已锁定"),!1):(this.stateMapFreeze[t]=o,!0);case"common":return this.commonMapFreeze[t]?(this.player.log(t+"已锁定"),!1):(this.commonMapFreeze[t]=o,!0);default:return!1}},t.prototype.setEnv=function(){var e=this;this.player.on(exports.PLAY_EVENT.STATE_CHANGE,this.onStateChange),this.player.on(exports.PLAY_EVENT.FIRST_PLAYING,this.onFirstPlay),this.player.on(exports.PLAY_EVENT.TIME_UPDATE,this.onTimeChange),this.player.on(exports.PLAY_EVENT.DURATION_CHANGE,this.onDurationChange),this.player.on(exports.PLAY_EVENT.ERROR,this.onError),this.player.on(exports.PLAY_EVENT.SETLEVEL_START,this.onSetLevelStart),this.player.on(exports.PLAY_EVENT.SETLEVEL_OVER,this.onSetLevelEnd),this.player.on(exports.PLAY_EVENT.RATE_CHANGE,this.onRateChange),this.player.on(exports.PLAY_EVENT.RETRY_BACKURL,this.onRetryLoad),this.player.on(exports.PLAY_EVENT.AUTOPLAY_BLOCKED,this.onAutoplayBlocked),this.player.on(exports.H5_PLAY_EVENT.VIDEO_REQ_INFO_START,this.onVideoReqInfoStart),this.player.on(exports.H5_PLAY_EVENT.VIDEO_REQ_INFO_END,this.onVideoReqInfoEnd),this.player.on(exports.H5_PLAY_EVENT.PLAY_SESSION_START,this.onPlaySessionStart),this.player.on(exports.H5_PLAY_EVENT.PLAY_SESSION_END,this.onPlaySessionEnd),this.player.on(exports.H5_PLAY_EVENT.VIDEO_REQ_INFO_END,(function(t){var o=t.data;if(o.code!==exports.ErrorCode.SUC){var i=o.data,r=((null==i?void 0:i.error)||{}).code;e.writeState(exports.DATA_STATE.ERROR,{eventId:e.generateEvtId(),type:exports.LOG_TYPE.CORE_EVENT,name:exports.DATA_STATE.ERROR,code:r,ftime:+new Date})}})),this.msg.on(exports.PLAY_EVENT_EXT.RETRY_PLAY,this.onRetryPlay)},t.prototype.commonInfo=function(){var e=uaTool.os,t=uaTool.mobile;this.writeCommon(COMMON_DATA_KEY.mobile,t?1:0,FreezeKey),this.writeCommon(COMMON_DATA_KEY.online,1,FreezeKey),this.writeCommon(COMMON_DATA_KEY.resolution,screen.width+"*"+screen.height+"*"+(window.devicePixelRatio||1),FreezeKey),this.writeCommon(COMMON_DATA_KEY.ua,navigator.userAgent.replace(/,/g,"\\,"),FreezeKey),this.writeCommon(COMMON_DATA_KEY.osver,e.osName+" "+e.version,FreezeKey),this.writeCommon(COMMON_DATA_KEY.playertype,0),this.writeCommon(COMMON_DATA_KEY.confid,confIdMap.default),this.writeCommon(COMMON_DATA_KEY.playercore,Object.keys(KernelFactory$1.kernelMap).join(","),FreezeKey),this.writeCommon(COMMON_DATA_KEY.playerver,VERSION$3),this.writeCommon(COMMON_DATA_KEY.speed,0),this.writeCommon(COMMON_DATA_KEY.drm,0),this.writeCommon(COMMON_DATA_KEY.url,location.href,FreezeKey),this.writeCommon(COMMON_DATA_KEY.topUrl,urlTool.getTopFrameUrl(),FreezeKey),this.writeCommon(COMMON_DATA_KEY.referrer,document.referrer,FreezeKey),this.writeCommon(COMMON_DATA_KEY.guid,this.getGUID())},t.prototype.persistUserSetting=function(){var e=this,o={},i=this.player.config,r=i.disableUserSettingCache,n=i.type,a=function(e){var t;return(null===(t=null==r?void 0:r.indexOf)||void 0===t?void 0:t.call(r,e))>-1};t.SETTING_CONFIG.forEach((function(t){var i=t.dsKey,r=t.lsKey,s=t.oldDsKey,l=r+"_"+n;if(!(a(i)||s&&a(s))){o[i]=l;var p=lsTool.getData(l);p&&i&&e.writeCommon(i,p)}})),this.msg.on(exports.PLAY_EVENT_EXT.DATASET_UPDATE,(function(e){var t=e.data,i=t.newVal,r=t.key;o[r]&&lsTool.setData(o[r],i)}))},t.prototype.removeUserSetting=function(e){var t=this;("string"==typeof e?[e]:e).forEach((function(e){t.writeCommon(e,"")}))},t.pluginName="dataset",t.UserSettingKeyPrefix="__thumbplayer_setting_",t.SETTING_CONFIG=[{oldDsKey:COMMON_DATA_KEY.currentDefn,dsKey:exports.PersistedUserSettings.definition,lsKey:t.UserSettingKeyPrefix+"_definition"},{oldDsKey:COMMON_DATA_KEY.currentSubtitle,dsKey:exports.PersistedUserSettings.subtitle,lsKey:t.UserSettingKeyPrefix+"_subtitle"},{oldDsKey:COMMON_DATA_KEY.currentAudioTrack,dsKey:exports.PersistedUserSettings.audioTrack,lsKey:t.UserSettingKeyPrefix+"_audioTrack"},{dsKey:exports.PersistedUserSettings.volume,lsKey:t.UserSettingKeyPrefix+"_volume"},{dsKey:exports.PersistedUserSettings.playbackRate,lsKey:t.UserSettingKeyPrefix+"_playbackRate"}],t.canUseProxy=void 0!==window.Proxy,t}(Plugin),DEFAULT_DETECT_URL="//thumbplayer-76307.gzc.vod.tencent-cloud.com/testvideo/f00364tdl4t_sd_h264_25fps_480x270.mp4",ErrorReportPlugin=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;return r.setEvents(!0),r}return __extends$1(t,e),t.prototype.destroy=function(){this._eventMap=null,this.setEvents(!1),e.prototype.destroy.call(this)},t.prototype.setEvents=function(e){this._eventMap||(this._eventMap={onPlayerSessionEnd:this.onPlayerSessionEnd.bind(this)}),e?this.player.on(exports.H5_PLAY_EVENT.PLAY_SESSION_END,this._eventMap.onPlayerSessionEnd):this.player.off(exports.H5_PLAY_EVENT.PLAY_SESSION_END,this._eventMap.onPlayerSessionEnd)},t.prototype.onPlayerSessionEnd=function(e){var t,o;return __awaiter$1(this,void 0,void 0,(function(){var i,r,n;return __generator$1(this,(function(a){switch(a.label){case 0:return i=e.data.code||exports.ErrorCode.SUC,r=this.player.config.type===exports.PLAY_MODE.VOD,i===exports.ErrorCode.SUC||!r||i.startsWith(exports.ErrorCode.GETINFO_SERVER_CODE_PREFIX)||uaTool.spider?[2]:[4,this.getDetectMp4((null===(o=null===(t=e.data)||void 0===t?void 0:t.videoInfo)||void 0===o?void 0:o.loadingUrl)||DEFAULT_DETECT_URL)];case 1:return n=a.sent(),this.report(e.data.code,e.data.message,n),[2]}}))}))},t.prototype.getDetectMp4=function(e){return __awaiter$1(this,void 0,void 0,(function(){var t,o,i,r,n,a,s,l,p;return __generator$1(this,(function(c){switch(c.label){case 0:t={downloadCode:0,downloadSpeed:0},c.label=1;case 1:return c.trys.push([1,3,,4]),o=+new Date,[4,netTool.xhr({url:e,retryCount:0,responseType:"arraybuffer",range:[0,102400]})];case 2:return i=c.sent(),t.downloadCode=null==i?void 0:i.target.status,r=i.data.byteLength/1024,n=(+new Date-o)/1e3,t.downloadSpeed=Math.floor(r/n),[3,4];case 3:return a=c.sent(),l=(s=a||{}).error,p=s.target,"xhrNetworkError"===l?t.downloadCode=-1:"xhrStatusCodeError"===l&&(t.downloadCode=null==p?void 0:p.status),[3,4];case 4:return[2,t]}}))}))},t.prototype.report=function(e,t,o){var i,r=urlTool.getTopFrameUrl(),n=(null==r?void 0:r.split("?")[0])||"",a=["attaid=09e00059501","token=3157925191","_dc="+Math.random(),"playerver="+this.player.getCommonKv(COMMON_DATA_KEY.playerver),"url="+encodeURIComponent(r),"isvisible="+(null===(i=this.player.dataset.visualStats)||void 0===i?void 0:i.isTabFocused),"ua="+navigator.userAgent,"curl="+n,"os="+(uaTool.os.osName||"")+(uaTool.os.version||""),"errmsg="+(t||""),"errcode="+e,"detcode="+o.downloadCode,"detspeed="+o.downloadSpeed,"platform="+this.player.getCommonKv(COMMON_DATA_KEY.platform),"flowid="+(this.player.getCommonKv(COMMON_DATA_KEY.flowid)||"?"),"guid="+(this.player.getCommonKv(COMMON_DATA_KEY.guid)||"?")];(new Image).src="https://h.trace.qq.com/kv?"+a.join("&")},t.pluginName="errorReport",t}(Plugin);function proxyPlayEvent(e,t){var o,i=((o={})[exports.PLAY_EVENT.DURATION_CHANGE]={evt:exports.H5_PLAY_EVENT.VIDEO_DURATION_CHANGE,getParam:function(e){return{duration:e.videoInfo.duration}}},o[exports.PLAY_EVENT.METADATA_CHANGE]={evt:exports.H5_PLAY_EVENT.VIDEO_METADATA_CHANGE,getParam:function(e){return{width:e.videoInfo.videoWidth,height:e.videoInfo.videoHeight}}},o[exports.PLAY_EVENT.VIDEO_BUFFER_CHANGE]={evt:exports.H5_PLAY_EVENT.VIDEO_LOAD_PROGRESS,getParam:function(){return{bufferRange:e.videoBuffered}}},o[exports.PLAY_EVENT.TIME_UPDATE]={evt:exports.H5_PLAY_EVENT.VIDEO_TIMEUPDATE,getParam:function(e){return{playtime:e.videoInfo.playtime}}},o[exports.PLAY_EVENT.VOLUME_CHANGE]={evt:exports.H5_PLAY_EVENT.VIDEO_VOLUME_CHANGE,getParam:function(){return{volume:e.volume}}},o[exports.PLAY_EVENT.RATE_CHANGE]={evt:exports.H5_PLAY_EVENT.VIDEO_RATE_CHANGE,getParam:function(){return{rate:e.playbackRate}}},o[exports.PLAY_EVENT.VIDEO_RESIZE]={evt:exports.H5_PLAY_EVENT.VIDEO_RESIZE,getParam:function(e){return{videoWidth:e.videoInfo.videoWidth,videoHeight:e.videoInfo.videoHeight}}},o[exports.PLAY_EVENT.AUTOPLAY_BLOCKED]={evt:exports.H5_PLAY_EVENT.VIDEO_AUTOPLAY_BLOCKED,getParam:function(){}},o[exports.PLAY_EVENT.SETLEVEL_OVER]={evt:exports.H5_PLAY_EVENT.VIDEO_SETLEVEL_END,getParam:function(e){var t,o,i,r=null!==(i=null===(o=null===(t=e.videoInfo)||void 0===t?void 0:t.error)||void 0===o?void 0:o.code)&&void 0!==i?i:exports.ErrorCode.UNKNOWN;return{code:e.fail?r:exports.ErrorCode.SUC}}},o);Object.keys(i).forEach((function(o){t.on(o,(function(t){var r=i[o],n=r.evt,a=r.getParam;e.emit(n,a(t.data))}))}))}var adEvents=[exports.H5_PLAY_EVENT.AD_REQ_INFO_START,exports.H5_PLAY_EVENT.AD_REQ_INFO_END,exports.H5_PLAY_EVENT.AD_REQ_ASSETS_START,exports.H5_PLAY_EVENT.AD_ASSETS_LOADED,exports.H5_PLAY_EVENT.AD_END,exports.H5_PLAY_EVENT.AD_PLAYING,exports.H5_PLAY_EVENT.AD_AUTOPLAY_BLOCKED,exports.H5_PLAY_EVENT.AD_PAUSE,exports.H5_PLAY_EVENT.AD_TIME_UPDATE,exports.H5_PLAY_EVENT.AD_VOLUME_CHANGE],BridgeMessageName;function proxyAdEvent(e){var t=getAdPlugin(e.config.instanceId);t&&adEvents.forEach((function(o){t.on(o,(function(t){var i=t.data;e.emit(o,i)}))}))}!function(e){e.STORAGE_INIT_FAILED="storageInitFailed",e.STORAGE_READY="storageReady",e.REQUEST_STORE_LOG="requestStoreLog",e.STORE_LOG_SUCCESS="storeLogSuccess",e.STORE_LOG_FAILED="storeLogFailed",e.REQUEST_REPORT_LOG="requestReportLog",e.REPORT_LOG_SUCCESS="reportLogSuccess",e.REPORT_LOG_FAILED="reportLogFailed"}(BridgeMessageName||(BridgeMessageName={}));var REMOTE_STORAGE_CLASS_NAME="thumbplayer-remote-storage-bridge",DEFAULT_IFRAME_TIMEOUT=1e4,REPORT_TIMEOUT=3e4,MessageBridge=function(){function e(e,t){var o=this;this.sender=e,this.receiver=t,this.callbackMap={},this.hasDestroy=!1,this.onReceiverMessage=function(e){o.receiverMessageHandler(e)},this.sender.addEventListener("message",this.onReceiverMessage)}return e.prototype.postMessage=function(e){if(this.hasDestroy)throw new Error("Cannot exec postMessage after destroy");this.receiver.postMessage(e,"*")},e.prototype.on=function(e,t){this.hasDestroy||(this.callbackMap[e]||(this.callbackMap[e]=[]),this.callbackMap[e].push(t))},e.prototype.off=function(e,t){if(!this.hasDestroy){var o=this.callbackMap[e];if(null==o?void 0:o.length){var i=o.indexOf(t);-1!==i&&o.splice(i,1)}}},e.prototype.destroy=function(){var e;this.hasDestroy=!0,null===(e=this.sender)||void 0===e||e.removeEventListener("message",this.onReceiverMessage),this.sender=null,this.receiver=null,this.callbackMap=null},e.prototype.receiverMessageHandler=function(e){var t,o=this;if(this.isBridgeMessage(e.data)&&!this.hasDestroy){var i=e.data;null===(t=this.callbackMap[i.name])||void 0===t||t.forEach((function(e){e(i,o.postMessage.bind(o))}))}},e.prototype.isBridgeMessage=function(e){return"object"==typeof e&&"string"==typeof(null==e?void 0:e.name)&&"string"==typeof(null==e?void 0:e.instanceId)},e}(),RemoteStorageBridge=function(e){function t(o,i,r){void 0===r&&(r=DEFAULT_IFRAME_TIMEOUT);var n=e.call(this,self,t.getIframe(o,r).contentWindow)||this;return n.instanceId=i,n.timeout=r,t.instanceCount+=1,n}return __extends$1(t,e),t.getIframe=function(e,o){if(void 0===o&&(o=DEFAULT_IFRAME_TIMEOUT),t.iframeEl)return t.iframeEl;var i=document.createElement("iframe");return i.src=e,document.body.append(i),i.style.display="none",i.classList.add(REMOTE_STORAGE_CLASS_NAME),t.iframeEl=i,t.rejectTimeout=window.setTimeout((function(){t.storageDefer.reject(new Error("IFrame wait timeout"))}),o),i},t.prototype.storeLogs=function(e){return __awaiter$1(this,void 0,void 0,(function(){return __generator$1(this,(function(o){switch(o.label){case 0:return[4,t.storageDefer.promise];case 1:return o.sent(),[4,this.postMessagePromise({name:BridgeMessageName.REQUEST_STORE_LOG,instanceId:this.instanceId,data:e},BridgeMessageName.STORE_LOG_SUCCESS,BridgeMessageName.STORE_LOG_FAILED)];case 2:return o.sent(),[2]}}))}))},t.prototype.report=function(e){return __awaiter$1(this,void 0,void 0,(function(){return __generator$1(this,(function(o){switch(o.label){case 0:return[4,t.storageDefer.promise];case 1:return o.sent(),[4,this.postMessagePromise({name:BridgeMessageName.REQUEST_REPORT_LOG,instanceId:this.instanceId,data:e},BridgeMessageName.REPORT_LOG_SUCCESS,BridgeMessageName.REPORT_LOG_FAILED,REPORT_TIMEOUT)];case 2:return o.sent(),[2]}}))}))},t.prototype.postMessagePromise=function(e,t,o,i){var r=this;return void 0===i&&(i=this.timeout),new Promise((function(n,a){var s=e.instanceId,l=setTimeout((function(){a(new Error("PostMessage response timeout: "+e.name+" / "+e.instanceId)),p(!1)}),i),p=function(e){void 0===e&&(e=!1);var i=e?r.on.bind(r):r.off.bind(r);i(o,c),i(t,d),e||clearTimeout(l)},c=function(e){s===e.instanceId&&(a(e.data),p(!1))},d=function(e){s===e.instanceId&&(n(e),p(!1))};p(!0),r.postMessage(e)}))},t.prototype.destroy=function(){var o;t.instanceCount-=1,t.instanceCount<=0&&(clearTimeout(t.rejectTimeout),t.rejectTimeout=null,null===(o=t.iframeEl)||void 0===o||o.remove(),t.iframeEl=null,t.instanceCount=0,t.storageDefer=new SimpleDefer,e.prototype.destroy.call(this))},t.prototype.receiverMessageHandler=function(o){if(this.isBridgeMessage(o.data))return o.data.name===BridgeMessageName.STORAGE_READY?(t.storageDefer.resolve(),void clearTimeout(t.rejectTimeout)):void e.prototype.receiverMessageHandler.call(this,o)},t.storageDefer=new SimpleDefer,t.instanceCount=0,t}(MessageBridge),PageWatcher=function(e){function t(){var o=e.call(this)||this;return o.emitPageLeave=function(){"hidden"===document.visibilityState&&(Date.now()-o.pageLeaveTimeStamp<=t.THROTTLE_GAP||(o.pageLeaveTimeStamp=Date.now(),o.emit(PageWatcherEvent.PageLeave)))},o.emitPageUnload=function(){Date.now()-o.pageUnloadTimeStamp<=t.THROTTLE_GAP||(o.pageUnloadTimeStamp=Date.now(),o.emit(PageWatcherEvent.UNLOAD))},o.setPageLeave(),o.setPageUnload(),o}return __extends$1(t,e),t.prototype.setPageLeave=function(){window.addEventListener("pagehide",this.emitPageLeave),document.addEventListener("visibilitychange",this.emitPageLeave)},t.prototype.setPageUnload=function(){window.addEventListener("beforeunload",this.emitPageUnload),window.addEventListener("unload",this.emitPageUnload)},t.THROTTLE_GAP=10,t}(s$1),PageWatcherEvent;!function(e){e.PageLeave="pageLeave",e.UNLOAD="unload"}(PageWatcherEvent||(PageWatcherEvent={}));var singleton=new PageWatcher,PageWatcher$1={instance:singleton,PageWatcherEvent:PageWatcherEvent};function collectData(){return{vuid:cookieTool.get("vqq_vuserid")||cookieTool.get("vuserid"),openid:cookieTool.get("openid")||cookieTool.get("vqq_openid"),guid:lsTool.getData(exports.LOCAL_KEY.GUID)}}var WHITE_LIST_URL="//v.qq.com/cache/wuji/object?appid=tenvideo_offline_log&schemaid=whileList&schemakey=d5dccc35902346b2bdcbcef774fefe99",cbIndex=0,WhiteListType;function fetchWhiteList(e){var t=encodeURIComponent('projectId="'+e+'"'),o=WHITE_LIST_URL+"&include=encryptValue,type&filter="+t+"&otype=jsonp";return cbIndex+=1,netTool.jsonp(o,{name:"offline_log"+cbIndex%200,timeout:3e3})}function validateWhiteList(e){return __awaiter$1(this,void 0,void 0,(function(){var t,o;return __generator$1(this,(function(i){switch(i.label){case 0:t=collectData(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetchWhiteList(e)];case 2:return o=i.sent(),[2,Object.entries(WhiteListType).some((function(e){var i=e[0],r=e[1],n=t[i];return n&&o.data.some((function(e){return e.type===r&&e.encryptValue===sha256.exports.sha256(n)}))}))];case 3:return i.sent(),[2,!1];case 4:return[2]}}))}))}!function(e){e.vuid="2",e.guid="5",e.openid="6"}(WhiteListType||(WhiteListType={}));var OfflineLogPlugin=function(e){function t(o,i,r){var n=e.call(this,o,i,r)||this;return n.pageWatcher=PageWatcher$1.instance,n.logInfoChange={},n.isDestroy=!1,n.onPageLeave=function(){n.storeLogs()},n.storeLogs=function(e){return __awaiter$1(n,void 0,void 0,(function(){var t,o,i,r,n;return __generator$1(this,(function(a){switch(a.label){case 0:if(!(t=this.instanceId))return[2];if(o=Logger.cache[t],i={logs:o,info:this.logInfoChange,ext:e},r=e||i.logs.length||Boolean(Object.keys(this.logInfoChange).length),Logger.cache[t]=[],this.logInfoChange={},!r)return[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.remoteStorage.storeLogs(i)];case 2:return a.sent(),[3,4];case 3:return n=a.sent(),this.logger.error("Error occur when store offlineLog: "+n),[3,4];case 4:return[2]}}))}))},n.onPlayerError=function(e){var t,o,i;n.logInfoChange.code=null===(i=null===(o=null===(t=e.data)||void 0===t?void 0:t.videoInfo)||void 0===o?void 0:o.error)||void 0===i?void 0:i.code,n.storeLogs()},n.config=__assign$2(__assign$2({},DEFAULT_CONFIG$1),i||{}),n.logger=new Logger(n.instanceId,t.pluginName),n.remoteStorage=new RemoteStorageBridge(RECORDER_DEPLOY_URL,n.instanceId),RemoteStorageBridge.storageDefer.promise.then((function(){n.isDestroy||(n.setPollLogger(),n.setPageWatcher(),n.setPlayerEvt())})).catch((function(e){n.logger.error("Error occur when init DB: "+e)})),n.logEnvInfo(),n.checkWhiteList(),n}return __extends$1(t,e),Object.defineProperty(t,"isEnvSupport",{get:function(){return"function"==typeof window.Proxy},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator$1(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,3,4]),this.isDestroy=!0,this.setPollLogger(!1),this.setPageWatcher(!1),this.setPlayerEvt(!1),[4,this.storeLogs({clearContentCache:!0})];case 1:case 2:return t.sent(),[3,4];case 3:return this.remoteStorage.destroy(),e.prototype.destroy.call(this),[7];case 4:return[2]}}))}))},t.prototype.report=function(e,o){return __awaiter$1(this,void 0,void 0,(function(){return __generator$1(this,(function(i){switch(i.label){case 0:if(!e&&!t.isInWhiteList)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.remoteStorage.report({downloadOnFailed:e,reportSource:o})];case 2:return i.sent(),[2,{status:!0,msg:""}];case 3:return[2,{status:!1,msg:i.sent().message}];case 4:return[2]}}))}))},t.prototype.logEnvInfo=function(){try{this.logger.log("UserAgent: "+navigator.userAgent),this.logger.log("URL: "+location.href),this.logger.log("TOP URL: "+urlTool.getTopFrameUrl()),this.logger.log("instanceId: "+this.player.config.instanceId),this.logger.log("Kernel List: "+Object.keys(KernelFactory$1.kernelMap).join(","))}catch(e){}},t.prototype.checkWhiteList=function(){return __awaiter$1(this,void 0,void 0,(function(){var e,o,i;return __generator$1(this,(function(r){switch(r.label){case 0:return t.hasCheckWhiteList?[2]:(e=this.config.platform,t.hasCheckWhiteList=!0,o=t,[4,validateWhiteList(e)]);case 1:if(o.isInWhiteList=r.sent(),!t.isInWhiteList)return[3,5];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.report(!1)];case 3:return r.sent(),[3,5];case 4:return i=r.sent(),this.logger.error("Error occur when reporting: "+i),[3,5];case 5:return[2]}}))}))},t.prototype.setPollLogger=function(e){void 0===e&&(e=!0);var t=this.config.pollTime,o=void 0===t?3e3:t;clearInterval(this.pollTimer),e&&(this.pollTimer=window.setInterval(this.storeLogs,o))},t.prototype.setPageWatcher=function(e){void 0===e&&(e=!0);var t=this.pageWatcher,o=e?t.on.bind(t):t.off.bind(t);o(PageWatcher$1.PageWatcherEvent.PageLeave,this.onPageLeave),o(PageWatcher$1.PageWatcherEvent.UNLOAD,this.onPageLeave)},t.prototype.setPlayerEvt=function(e){void 0===e&&(e=!0),(e?this.player.on.bind(this.player):this.player.off.bind(this.player))(exports.PLAY_EVENT.ERROR,this.onPlayerError)},t.prototype.hookVideoReqInfoEnd=function(e){var t,o,i=null===(o=null===(t=e.data)||void 0===t?void 0:t.error)||void 0===o?void 0:o.code;i&&(this.logInfoChange.code=i),this.logInfoChange.videoName=this.player.dataset.commonMap.videoName,this.storeLogs()},t.prototype.hookPlaySessionStart=function(){this.logInfoChange=this.collectLogInfo(),this.storeLogs()},t.prototype.hookPlaySessionEnd=function(e){this.logInfoChange.code=e.code,this.storeLogs({clearInfoCache:!0})},t.prototype.collectLogInfo=function(){var e=this.player.dataset.commonMap,t=e.guid,o=e.drm,i=e.videoName,r=e.vid,n=e.hc_vuserid,a=e.flowid,s=e.platform;return{code:"",drm:Boolean(o),startTime:Date.now(),endTime:Date.now(),guid:t,ua:navigator.userAgent,url:location.href,videoName:i,vid:r,platform:s,vuid:n,instanceId:this.instanceId,id:a}},Object.defineProperty(t.prototype,"instanceId",{get:function(){return this.player.config.instanceId},enumerable:!1,configurable:!0}),t.pluginName="offlineLog",t.hasCheckWhiteList=!1,t.isInWhiteList=!1,t}(Plugin),DEFAULT_CONFIG$1={platform:"1",disable:!1,pollTime:3e3},RECORDER_DEPLOY_URL="https://v.qq.com/thumbplayer-offline-log.html",PlayLimitConfigValidateMsg;!function(e){e.EMPTY_CONFIG="配置不能为空",e.POINTS_BOTH_EMPTY="startPoint / endPoint 配置不能同时为空",e.START_TIME_BELOW_ZERO="startPoint.value 值不能小于 0",e.END_TIME_BELOW_START_TIME="endPoint.value 值不能小于 startPoint.value"}(PlayLimitConfigValidateMsg||(PlayLimitConfigValidateMsg={}));var DEFAULT_PRIORITY=0,DEFAULT_END_STATE=exports.END_STATE.NORMAL,DEFAULT_PLAYTIME_BOUNDARY={startTime:0,startPriority:DEFAULT_PRIORITY,endTime:1/0,endPriority:DEFAULT_PRIORITY,endState:exports.END_STATE.NORMAL},ruleValidator={emptyConfigCheck:function(e){if(!e)return PlayLimitConfigValidateMsg.EMPTY_CONFIG},emptyStartAndEndCheck:function(e){var t=e.startPoint,o=e.endPoint;if(!t&&!o)return PlayLimitConfigValidateMsg.POINTS_BOTH_EMPTY},startBelowZero:function(e){var t=e.startPoint;if(t&&t.value<0)return PlayLimitConfigValidateMsg.START_TIME_BELOW_ZERO},endBelowStart:function(e){var t=e.startPoint,o=e.endPoint;if(t&&o&&t.value>=o.value)return PlayLimitConfigValidateMsg.END_TIME_BELOW_START_TIME}},CONFIG_ID_START=0,PlaytimeLimiterPlugin=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configRules=ruleValidator,t.nextId=CONFIG_ID_START,t.limitConfigMap={},t.isCanplayEmitted=!1,t.canplaySeekPos=null,t.hookVideoTimeupdate=function(e){if(!(e.playtime<t.range.endTime))return t.player.corePlayer.stop(t.range.endState),s$1.STOP_IMMEDIATE_PROPAGATION},t.hookPlaySessionEnd=function(){t.isCanplayEmitted=null,t.canplaySeekPos=null},t}return __extends$1(t,e),Object.defineProperty(t.prototype,"range",{get:function(){return this.limitRange||(this.limitRange=this.mergePlaytimeLimitConfigs(Object.values(this.limitConfigMap))),__assign$2({},this.limitRange)},enumerable:!1,configurable:!0}),t.prototype.addLimitConfig=function(e){if(!this.validatePlayTimeConfig(e))return null;var t=this.generateID();return this.limitConfigMap[t]=__assign$2(__assign$2({},e),{vidOrUrl:this.player.vid||this.player.url}),this.onConfigChange(),t},t.prototype.deleteLimitConfig=function(e){delete this.limitConfigMap[e],this.onConfigChange()},t.prototype.clearAllConfig=function(e){var t=this;Object.entries(this.limitConfigMap).forEach((function(o){var i=o[0];o[1].vidOrUrl!==e&&delete t.limitConfigMap[i]})),this.limitRange=null},t.prototype.getLimitConfig=function(e){return this.limitConfigMap[e]},t.prototype.setLimitConfig=function(e,t){return!(!this.getLimitConfig(e)||!this.validatePlayTimeConfig(t))&&(this.limitConfigMap[e]=t,this.onConfigChange(),!0)},t.prototype.generateID=function(){return this.nextId++},t.prototype.validatePlayTimeConfig=function(e){var t=this;return Object.values(this.configRules).every((function(o){var i=o(e);return!i||(t.player.log(i),!1)}))},t.prototype.mergePlaytimeLimitConfigs=function(e){var t=this,o=__assign$2({},DEFAULT_PLAYTIME_BOUNDARY);return e.forEach((function(e){var i=e.startPoint,r=e.endPoint;o=t.mergeStartPoint(o,i),o=t.mergeEndPoint(o,r)})),o},t.prototype.mergeStartPoint=function(e,t){return this.shouldUpdateStartTime(e,t)?__assign$2(__assign$2({},e),{startTime:t.value,startPriority:t.priority||DEFAULT_PRIORITY}):e},t.prototype.shouldUpdateStartTime=function(e,t){if(!t)return!1;var o=t.value,i=t.priority,r=void 0===i?DEFAULT_PRIORITY:i,n=e.startTime,a=e.startPriority;return o<e.endTime&&(r>a||r===a&&o>n)},t.prototype.mergeEndPoint=function(e,t){return this.shouldUpdateEndTime(e,t)?__assign$2(__assign$2({},e),{endTime:t.value,endPriority:t.priority||DEFAULT_PRIORITY,endState:t.endState||DEFAULT_END_STATE}):e},t.prototype.shouldUpdateEndTime=function(e,t){if(!t)return!1;var o=t.value,i=t.priority,r=void 0===i?DEFAULT_PRIORITY:i,n=e.startTime,a=e.endPriority,s=e.endTime;return o>n&&(r>a||r===a&&o<s)},t.prototype.onConfigChange=function(){if(this.limitRange=this.mergePlaytimeLimitConfigs(Object.values(this.limitConfigMap)),!(this.player.playtime>=this.range.startTime))return this.seekPlayer(this.range.startTime),__assign$2({},this.limitRange)},t.prototype.hookVideoCanplay=function(){!this.isCanplayEmitted&&this.canplaySeekPos&&(this.player.seek(this.canplaySeekPos),this.canplaySeekPos=null),this.isCanplayEmitted=!0},t.prototype.seekPlayer=function(e){this.isCanplayEmitted?this.player.seek(this.canplaySeekPos):this.canplaySeekPos=e},t.pluginName="playtimeLimiter",t}(Plugin),report=function(e){var t=e.data,o=void 0===t?{}:t,i=e.url,r=void 0===i?"":i,n=constructPayload(o);n.length>MAX_LENGTH_OF_PAYLOAD?netTool.xhr({method:"POST",url:r,withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n}):(new Image).src=r+"&"+n},constructPayload=function(e){void 0===e&&(e={});var t=Object.keys(e).reduce((function(t,o){var i;return t[o]=encodeURIComponent(null!==(i=e[o])&&void 0!==i?i:""),t}),{_dc:Math.random()});return urlTool.object2string(t,"&")},MAX_LENGTH_OF_PAYLOAD=2048,BaseReporter=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;return r.RELEASE_DELAY=3e5,r.reporter=report,r.reportedEvt={},r.FLOW_DATA_KEY="",r.REPORT_URL="",r.REPORT_KEY="",r.config=o,r}return __extends$1(t,e),t.prototype.saveToLS=function(e,t){var o=this.getPrevData();o[e]={data:t,ts:Date.now()},lsTool.setData(this.FLOW_DATA_KEY,JSON.stringify(o))},t.prototype.removeFromLS=function(e){var t=this.getPrevData();delete t[e],lsTool.setData(this.FLOW_DATA_KEY,JSON.stringify(t))},t.prototype.reportPrev=function(){var e=this,t=this.getPrevData();Object.keys(t).forEach((function(o){t[o].ts+e.RELEASE_DELAY<Date.now()&&(e.report(t[o].data),delete t[o])})),lsTool.setData(this.FLOW_DATA_KEY,JSON.stringify(t))},t.prototype.report=function(e){if(void 0===e&&(e={}),!uaTool.spider){var t=__assign$2(__assign$2({},this.reportHeader),e);this.reporter({data:t,url:this.REPORT_URL,key:this.REPORT_KEY})}},t.prototype.getPrevData=function(){var e,t=lsTool.getData(this.FLOW_DATA_KEY)||"{}";try{e=JSON.parse(t)}catch(t){e={}}return e},t}(Plugin),VodQaReportBeaconAppKey="0WEB0QEJW44KW5A5",LiveQaReportBeaconAppKey="0WEB0CN7W9446C2I",VodQaReportCacheKey="__thumbplayer_vod_qa_report__",BeaconSDKPath="//beacon.cdn.qq.com/sdk/4.5.6/beacon_web.min.js",RequestMaxRetry=3,BeaconRequest=function(){function e(){}return e.loadBeaconSDK=function(){var t=this;return"function"==typeof window.BeaconAction?Promise.resolve():(e.SDKLoadingDefer||(e.SDKLoadingDefer=new Promise((function(e,o){return __awaiter$1(t,void 0,void 0,(function(){var t,i,r;return __generator$1(this,(function(n){switch(n.label){case 0:i=0,n.label=1;case 1:if(!(i<RequestMaxRetry))return[3,6];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,domTool.loadScript(BeaconSDKPath)];case 3:return n.sent(),e(),[3,6];case 4:return r=n.sent(),t=r,[3,5];case 5:return i++,[3,1];case 6:return o(t),[2]}}))}))}))),e.SDKLoadingDefer)},e.flushQueue=function(t){e.queues[t]&&e.instances[t]&&(e.queues[t].forEach((function(t){e.report(t)})),e.queues[t]=[])},e.clear=function(t){e.queues[t]=[]},e.report=function(t){var o=t.data,i=t.key,r=e.instances[i],n=(o||{}).stepname;r?r.onDirectUserAction(n,o):e.queues[i].push(t)},e.register=function(t,o){return __awaiter$1(this,void 0,void 0,(function(){var i;return __generator$1(this,(function(r){switch(r.label){case 0:if(e.queues[t])return[2];e.queues[t]=[],o&&(e.SDKLoadingDefer=o),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.loadBeaconSDK()];case 2:return r.sent(),e.SDKLoadingDefer=null,i=new window.BeaconAction({appkey:t,strictMode:!1,isOversea:!1}),e.instances[t]=i,e.flushQueue(t),[3,4];case 3:return r.sent(),[3,4];case 4:return[2]}}))}))},e.instances={},e.queues={},e}(),getQQFromCookie$1=function(){var e=cookieTool.get("luin")||cookieTool.get("uin");return e&&(e=e.replace(/\D/g,"").replace(/^0+/,"")),e},BufferThresholds=1200,DEFAULT_KEYS$1$1={cdnuip:"",iqq:"",pvid:"",qqopen_id:COMMON_DATA_KEY.hc_openid,playno:COMMON_DATA_KEY.flowid,cdnid:COMMON_DATA_KEY.cdnid,guid:COMMON_DATA_KEY.guid,fplayerver:COMMON_DATA_KEY.playerver,dsip:"",sstrength:"",devtype:"",nettype:"",freetype:"",platform:COMMON_DATA_KEY.platform,codec:COMMON_DATA_KEY.codec,device:COMMON_DATA_KEY.device,resolution:COMMON_DATA_KEY.resolution,osver:COMMON_DATA_KEY.osver,playertype:COMMON_DATA_KEY.playertype,appver:COMMON_DATA_KEY.appVer,use_p2p:COMMON_DATA_KEY.p2p,p2p_play:COMMON_DATA_KEY.p2p,p2pver:COMMON_DATA_KEY.p2pver,playtype:"",scenesid:COMMON_DATA_KEY.sid,sid:COMMON_DATA_KEY.vid,livepid:COMMON_DATA_KEY.livepid,contentid:COMMON_DATA_KEY.cid,drm:COMMON_DATA_KEY.drmtype,playtime:"",isuserpay:"",live_type:"",xserverip:"",durl:"",lookback:"",live_tag:"",extraInfo:"",spanId:"",tuid:"",ext1:"",ext2:"",ext3:""},CMD$1,STEP_NAME$1;!function(e){e[e.START=205]="START",e[e.LOOP=263]="LOOP",e[e.ERROR=150]="ERROR"}(CMD$1||(CMD$1={})),function(e){e.START="live_loading",e.LOOP="live_period",e.ERROR="live_error"}(STEP_NAME$1||(STEP_NAME$1={}));var LiveQaReporterPlugin=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;r.REPORT_KEY=LiveQaReportBeaconAppKey,r.seq=0,r.lastPlayDuration=0,r.bufferHistory=[],r.flowHeader={cnntime:0,maxspeed:0,testspeed:0,downspeed:0,recnncount:0,loadingtime:0,blockcount:0,blocktime:0,errorcode:0,geturltime:0,fullecode:"",prdlength:0,get_stream_data_duration:0,get_sync_frame_duration:0,live_delay:0},r.isSettingLevel=!1,r.setEvtHandler=function(){r.msg.on(exports.PLAY_EVENT_EXT.DATASET_STATE_UPDATE,r.onStateChange),r.player.on(exports.PLAY_EVENT.RETRY_BACKURL,r.onRetryUrl)},r.onRetryUrl=function(){r.flowHeader.recnncount=r.flowHeader.recnncount+1},r.onStateChange=function(e){var t,o=e.data,i=o.key,n=((t={})[exports.DATA_STATE.LOAD_END]=r.onLoad,t[exports.DATA_STATE.BUFFER_END]=r.onBuffer,t[exports.DATA_STATE.GET_INFO_END]=r.onGetinfoEnd,t[exports.DATA_STATE.SET_LEVEL_START]=r.onSetLevel,t[exports.DATA_STATE.SESSION_START]=r.onSessionStart,t[exports.DATA_STATE.SESSION_END]=r.onSessionEnd,t);n[i]&&n[i](o)},r.onSessionStart=function(){r.resetLoopData(),r.seq=0},r.onSessionEnd=function(e){var t=e.newVal,o=(void 0===t?{}:t).code;r.onPeriod({code:o}),r.seq=0,r.endPeriodReport(),r.reportedEvt={}},r.startPeriodReport=function(){r.endPeriodReport(),r.period=setInterval(r.onPeriod,6e4)},r.endPeriodReport=function(){r.period&&(clearInterval(r.period),r.period=null)},r.onSetLevel=function(){r.isSettingLevel=!0,r.onPeriod(),r.endPeriodReport()},r.onBuffer=function(e){var t=e.newVal,o=void 0===t?{}:t,i=e.startEvent,n=void 0===i?{}:i,a=o.ftime,s=n.ftime;a-s<=BufferThresholds||r.bufferHistory.push({stime:s,etime:a})},r.onGetinfoEnd=function(e){var t=e.newVal,o=e.startEvent,i=t.ftime,n=o.ftime;r.flowHeader.geturltime=i-n},r.onLoad=function(e){if(!r.reportedEvt[CMD$1.START]||r.isSettingLevel){r.reportedEvt[CMD$1.START]=!0,r.isSettingLevel=!1;var t=e.startEvent,o=void 0===t?{}:t,i=e.newVal,n=void 0===i?{}:i,a=n.code;a===exports.ErrorCode.SUC&&(r.flowHeader.loadingtime=n.ftime-o.ftime,r.flowHeader.errorcode=a,r.flowHeader.fullecode=a,r.report({step:CMD$1.START,stepname:STEP_NAME$1.START,code:a}),r.startPeriodReport())}},r.onPeriod=function(e){var t=(e||{code:exports.ErrorCode.SUC}).code,o=void 0===t?exports.ErrorCode.SUC:t,i=r.bufferHistory.reduce((function(e,t){return[e[0]+1,e[1]+(t.etime-t.stime)]}),[0,0]),n=i[0],a=i[1],s=r.player.dataset.getStats().playDuration;r.flowHeader.blockcount=n,r.flowHeader.blocktime=a,r.flowHeader.prdlength=s-r.lastPlayDuration,r.flowHeader.errorcode=o,r.flowHeader.fullecode=o;var l={step:o===exports.ErrorCode.SUC?CMD$1.LOOP:CMD$1.ERROR,stepname:o===exports.ErrorCode.SUC?STEP_NAME$1.LOOP:STEP_NAME$1.ERROR,code:o};r.report(l),r.resetLoopData(),r.lastPlayDuration=s},r.resetLoopData=function(){r.bufferHistory=[],r.flowHeader=__assign$2(__assign$2({},r.flowHeader),{blockcount:0,blocktime:0,errorcode:0,loadingtime:0,fullecode:"",prdlength:0,recnncount:0,downspeed:0,live_delay:0})};var n=t.config.liveQaReporterConfig;return r.config={paramsKey:__assign$2(__assign$2({},DEFAULT_KEYS$1$1),(null==n?void 0:n.paramsKey)||{})},r.setEvtHandler(),BeaconRequest.register(r.REPORT_KEY,null==n?void 0:n.externalBeaconDefer),r.reporter=BeaconRequest.report,r}return __extends$1(t,e),Object.defineProperty(t.prototype,"reportHeader",{get:function(){var e,t,o=this.config.paramsKey,i=void 0===o?{}:o,r=this.player.getCommonKv;return __assign$2({cdnuip:r(i.cdnuip)||"",iqq:r(i.iqq)||getQQFromCookie$1(),qqopen_id:r(i.qqopen_id)||"",pvid:cookieTool.get("pgv_pvid")||"",playno:r(i.playno)||"",cdnid:r(i.cdnid)||"",guid:r(i.guid)||"",fplayerver:r(i.fplayerver)||"",dsip:r(i.dsip)||"",sstrength:r(i.sstrength)||0,devtype:r(i.devtype)||0,nettype:r(i.nettype)||100,codec:r(i.codec)||CODEC.H264,freetype:r(i.freetype)||0,platform:r(i.platform)||"",device:r(i.device)||"",resolution:r(i.resolution)||"",osver:r(i.osver)||"",playertype:r(i.playertype)||0,appver:r(i.appver)||"",use_p2p:r(i.use_p2p)||0,p2p_play:r(i.p2p_play)||0,p2pver:r(i.p2pver)||"",playtype:r(i.playtype)||1,scenesid:r(i.scenesid)||0,drm:r(i.drm)||0,sid:r(i.sid)||0,livepid:r(i.livepid)||0,contentid:r(i.contentid)||0,playtime:r(i.playtime)||0,isuerpay:r(i.isuserpay)||0,live_type:r(i.live_type)||0,xserverip:r(i.xserverip)||"",durl:r(i.durl)||(null===(t=null===(e=this.player)||void 0===e?void 0:e.currentVideoInfo)||void 0===t?void 0:t.loadingUrl)||"",lookback:r(i.lookback)||0,live_tag:r(i.live_tag)||0,extraInfo:r(i.extraInfo)||"",spanId:r(i.spanId)||"",tuid:r(i.tuid)||"",kernel:this.player.kernelName,domain:urlTool.getDomainOfURL(urlTool.getTopFrameUrl()),seq:this.seq,ext1:r(i.ext1)||"",ext2:r(i.ext2)||"",ext3:r(i.ext3)||""},this.flowHeader)},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.endPeriodReport(),BeaconRequest.clear(this.REPORT_KEY),e.prototype.destroy.call(this)},t.prototype.report=function(t){e.prototype.report.call(this,t),this.seq=this.seq+1},t.pluginName="live-qa-reporter",t}(BaseReporter),AdReportHelper=function(){function e(e){var t=this;this.reportData={},this.currentBufferHistory=[],this.onStateChange=function(e){var o,i=e.data,r=i.new,n=i.old,a=((o={})[exports.VIDEO_STATE.CANPLAY]=t.onCanPlay,o[exports.VIDEO_STATE.BUFFERING]=t.onBuffering,o[exports.VIDEO_STATE.END]=t.onEnd,o);a[r]&&a[r](e.data.videoInfo,n)},this.onError=function(e){var o,i,r=e.data.videoInfo;if(r){var n=r.uid,a=r.error,s=t.reportData[n];s&&(s.load>=0&&(t.emitToMainReporter({code:a.code,step:"30",stime:s.load,stepname:STEP_NAME.FIRST_LOAD,etime:Date.now(),url:r.loadingUrl,urlIndex:(null===(i=null===(o=r.config)||void 0===o?void 0:o.backupUrls)||void 0===i?void 0:i.findIndex((function(e){return e===r.loadingUrl})))||-1},s),s.load=-1),t.emitToMainReporter({step:"50",playDuration:r.playtime,code:a.code,stepname:STEP_NAME.END,tbcount:0,tbduration:0,scount:0,etime:Date.now(),bcount:t.currentBufferHistory.length,tduration:t.currentBufferHistory.reduce((function(e,t){return e+(t.etime-t.stime)}),0)},s))}},this.onFirstPlaying=function(e){var o=e.data.videoInfo;if(o){var i=t.reportData[o.uid];if(i){i.load>=0&&t.reportFirstLoad(o,i);var r=Date.now(),n={step:"32",stepname:STEP_NAME.FIRST_RENDERING,stime:r,etime:r,code:exports.ErrorCode.SUC};t.emitToMainReporter(n,i)}else;}},this.onVideoNodeChange=function(e){var o=e.data.videoInfo;o&&!t.reportData[o.uid]&&(t.reportData[o.uid]={seq:0,flowidSuffix:"_ad"+t.getAdClipNumber(),load:Date.now()})},this.reportFirstLoad=function(e,o){var i,r,n,a,s,l,p=null!==(a=null===(n=null===(r=null===(i=t.adPlayer.currentVideoInfo)||void 0===i?void 0:i.extraVars)||void 0===r?void 0:r.stream)||void 0===n?void 0:n.cacheSize)&&void 0!==a?a:0,c={step:"30",stepname:STEP_NAME.FIRST_LOAD,stime:o.load,etime:Date.now(),url:e.loadingUrl,urlIndex:(null===(l=null===(s=e.config)||void 0===s?void 0:s.backupUrls)||void 0===l?void 0:l.findIndex((function(t){return t===e.loadingUrl})))||-1,code:exports.ErrorCode.SUC,cachesize:p};t.emitToMainReporter(c,o),o.load=-1},this.onCanPlay=function(e){if(e){var o=t.reportData[e.uid];if(o){if(o.load>=0)return void t.reportFirstLoad(e,o);if(o.buffer>=0){var i=Date.now(),r=o.buffer;if(o.buffer=-1,i-r<=1200)return;t.currentBufferHistory.push({stime:r,etime:Date.now()});var n={step:"35",stime:r,stepname:STEP_NAME.BUFFERING,etime:Date.now(),ptime:t.adPlayer.playtime,code:exports.ErrorCode.SUC};return void t.emitToMainReporter(n,o)}}}},this.onEnd=function(e){if(e){var o=t.reportData[e.uid];if(o){var i={step:"50",playDuration:e.playtime,code:exports.ErrorCode.SUC,stepname:STEP_NAME.END,tbcount:0,tbduration:0,scount:0,etime:Date.now(),bcount:t.currentBufferHistory.length,tduration:t.currentBufferHistory.reduce((function(e,t){return e+(t.etime-t.stime)}),0)};t.emitToMainReporter(i,o)}}},this.onBuffering=function(e){if(e){var o=t.reportData[e.uid];o&&(o.buffer=Date.now())}},this.reporterPlugin=e}return e.prototype.destroy=function(){this.unbindCoreEvents()},e.prototype.init=function(e){this.adPlayer&&this.unbindCoreEvents();var t=e.currentVideoInfo;t&&(this.adPlayer=e,this.bindCoreEvents(),this.reportData={},this.reportData[t.uid]={seq:0,flowidSuffix:"ad"+this.getAdClipNumber(),load:Date.now()})},e.prototype.getAdClipNumber=function(){return Object.keys(this.reportData).length},e.prototype.bindCoreEvents=function(){this.adPlayer.on(exports.PLAY_EVENT.STATE_CHANGE,this.onStateChange),this.adPlayer.on(exports.PLAY_EVENT.ERROR,this.onError),this.adPlayer.on(exports.PLAY_EVENT.VIDEONODE_FIRST_PLAYING,this.onFirstPlaying),this.adPlayer.on(exports.PLAY_EVENT.VIDEONODE_CHANGE,this.onVideoNodeChange)},e.prototype.unbindCoreEvents=function(){this.adPlayer.off(exports.PLAY_EVENT.STATE_CHANGE,this.onStateChange),this.adPlayer.off(exports.PLAY_EVENT.ERROR,this.onError),this.adPlayer.off(exports.PLAY_EVENT.VIDEONODE_FIRST_PLAYING,this.onFirstPlaying),this.adPlayer.off(exports.PLAY_EVENT.VIDEONODE_CHANGE,this.onVideoNodeChange)},e.prototype.emitToMainReporter=function(e,t){var o=__assign$2(__assign$2({code:exports.ErrorCode.SUC},e),{flowid:t.flowidSuffix,seq:t.seq,scenesid:1,duration:this.adPlayer.duration,kernel:this.adPlayer.kernelName,vid:"",fmt:"",rate:"",cdnid:"",cdnip:"",drm:"",definition:"",dltype:""});t.seq+=1,this.reporterPlugin.emit("adReport",o)},e}(),STEP_NAME;!function(e){e.INIT="init_player",e.GETINFO="get_cdn_url",e.FIRST_LOAD="first_load",e.FIRST_RENDERING="first_rendering",e.BUFFERING="second_buffering",e.SEEKING="user_seek",e.END="play_done"}(STEP_NAME||(STEP_NAME={}));var DEFAULT_KEYS$2={platform:COMMON_DATA_KEY.platform,flowid:COMMON_DATA_KEY.flowid,uin:"",QQopenid:COMMON_DATA_KEY.hc_openid,WXopenid:COMMON_DATA_KEY.hc_openid,logintype:COMMON_DATA_KEY.hc_main_login,guid:COMMON_DATA_KEY.guid,uip:"",cdnuip:COMMON_DATA_KEY.cdnuip,codec:COMMON_DATA_KEY.codec,cdnip:COMMON_DATA_KEY.cdnip,online:COMMON_DATA_KEY.online,p2p:COMMON_DATA_KEY.p2p,sstrength:COMMON_DATA_KEY.sstrength,network:COMMON_DATA_KEY.network,speed:COMMON_DATA_KEY.speed,device:COMMON_DATA_KEY.device,resolution:COMMON_DATA_KEY.resolution,testid:COMMON_DATA_KEY.testid,osver:COMMON_DATA_KEY.osver,p2pver:COMMON_DATA_KEY.p2pver,appver:COMMON_DATA_KEY.appVer,playerver:COMMON_DATA_KEY.playerver,playertype:COMMON_DATA_KEY.playertype,confid:COMMON_DATA_KEY.confid,cdnid:COMMON_DATA_KEY.cdnid,drm:COMMON_DATA_KEY.drmtype,scenesid:"",playtype:"",dltype:COMMON_DATA_KEY.dltype,vid:COMMON_DATA_KEY.vid,definition:COMMON_DATA_KEY.currentDefn,fmt:COMMON_DATA_KEY.fmt,rate:COMMON_DATA_KEY.rate,duration:"",kernel:"",ext1:"",ext2:"",ext3:""},VodQaReporterPlugin=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;r.REPORT_KEY=VodQaReportBeaconAppKey,r.FLOW_DATA_KEY=VodQaReportCacheKey,r.seq=0,r.bufferHistory=[],r.seekHistory=[],r.initData={fmt:"",rate:"",cdnid:""},r.bufferCount=0,r.seekCount=0,r.setEvtHandler=function(){r.msg.on(exports.PLAY_EVENT_EXT.DATASET_STATE_UPDATE,r.onStateChange),r.player.on(exports.PLAY_EVENT.SETLEVEL_OVER,(function(){r.bufferCount=0,r.seekCount=0})),document.addEventListener("visibilitychange",r.onVisibilityChange),window.addEventListener("pagehide",r.onPageHide)},r.onPageHide=function(){r.saveData()},r.onVisibilityChange=function(e){"hidden"===document.visibilityState?r.saveData():r.player&&r.removeFromLS(r.player.getCommonKv(COMMON_DATA_KEY.flowid))},r.onStateChange=function(e){var t,o=e.data,i=o.key,n=((t={})[exports.DATA_STATE.INIT]=r.onPlayerInit,t[exports.DATA_STATE.LOAD_END]=r.onLoad,t[exports.DATA_STATE.BUFFER_END]=r.onBuffer,t[exports.DATA_STATE.GET_INFO_END]=r.onGetinfoEnd,t[exports.DATA_STATE.SEEK_END]=r.onSeek,t[exports.DATA_STATE.SESSION_END]=r.onPlaySessionEnd,t[exports.DATA_STATE.FIRST_PLAY]=r.onFirstPlay,t[exports.DATA_STATE.SESSION_START]=r.reset,t[exports.DATA_STATE.RETRY_BACKURL]=function(){r.bufferCount=0,r.seekCount=0},t);n[i]&&n[i](o)},r.onPlayerInit=function(e){var t=e.newVal,o=t.ftime,i=t.ext,n=(void 0===i?{}:i).stime;r.report({stepname:STEP_NAME.INIT,step:"5",stime:n,etime:o,code:exports.ErrorCode.SUC})},r.onGetinfoEnd=function(e){var t=e.newVal,o=e.startEvent,i=t.ftime,n=t.code,a=o.ftime;r.report({stepname:STEP_NAME.GETINFO,step:"15",stime:a,etime:i,code:n})},r.onLoad=function(e){var t=e.newVal,o=void 0===t?{}:t,i=e.startEvent,n=(void 0===i?{}:i).ftime,a=o,s=a.ftime,l=a.currentUrl,p=a.urlIndex,c=a.code;r.report({stepname:STEP_NAME.FIRST_LOAD,step:"30",stime:n,etime:s,url:l||"",urlindex:p+1,fileopenedtime:0,firstpacketreadtime:0,code:c})},r.onFirstPlay=function(){if(!r.reportedEvt[STEP_NAME.FIRST_RENDERING]){r.reportedEvt[STEP_NAME.FIRST_RENDERING]=!0;var e=+new Date;r.report({step:"32",stepname:STEP_NAME.FIRST_RENDERING,stime:e,etime:e,code:exports.ErrorCode.SUC})}},r.onBuffer=function(e){var t=e.newVal,o=void 0===t?{}:t,i=e.startEvent,n=void 0===i?{}:i,a=o.ftime,s=o.playtime,l=o.currentUrl,p=o.code,c=n.ftime,d=n.prevState===exports.VIDEO_STATE.SEEKING?1:0,u=r.player.playbackRate>1?2:1;a-c<=BufferThresholds||(r.bufferHistory.push({stime:c,etime:a}),r.bufferCount<20&&(r.report({step:"35",stepname:STEP_NAME.BUFFERING,ptime:s,levent:d,stime:c,etime:a,scene:u,format:r.player.getCommonKv(r.config.paramsKey.fmt)||0,url:l||"",reason:0,code:p,vt:r.player.getCommonKv(r.config.paramsKey.cdnid)||0}),r.bufferCount+=1))},r.onSeek=function(e){var t=e.newVal,o=void 0===t?{}:t,i=e.startEvent,n=void 0===i?{}:i,a=o.ftime,s=o.playtime,l=o.code,p=o.ext,c=void 0===p?{}:p,d=n.ftime,u=n.playtime;c.isUserSeek&&(r.seekHistory.push({lstime:d,letime:a}),r.seekCount<20&&(r.report({step:"40",stepname:STEP_NAME.SEEKING,lstime:d,letime:a,pstime:u,petime:s,format:r.player.getCommonKv(r.config.paramsKey.fmt)||0,code:l}),r.seekCount+=1))},r.onPlaySessionEnd=function(e){if(!r.reportedEvt[STEP_NAME.END]){r.reportedEvt[STEP_NAME.END]=!0;var t=e.newVal,o=void 0===t?{}:t,i=o.ftime,n=o.code,a=r.player.dataset.getStats().playDuration,s=[0===n.indexOf(exports.ErrorCode.GETINFO_SERVER_CODE_PREFIX),0===n.indexOf("70014"),0===n.indexOf("7004"),"70011112"===n,"70011113"===n].some((function(e){return e})),l=s?exports.ErrorCode.SUC:n;r.report(__assign$2(__assign$2({step:"50",stepname:STEP_NAME.END,etime:i,playduration:a,code:l},r.seekStat),r.bufferStat)),r.removeFromLS(r.player.getCommonKv(COMMON_DATA_KEY.flowid)),r.seq=0}},r.onInit=function(){r.reportPrev()},r.saveData=function(){var e=+new Date,t=r.player.getCommonKv(COMMON_DATA_KEY.flowid);if(t&&!r.reportedEvt[STEP_NAME.END]){var o=r.player.dataset.getStats().playDuration,i=__assign$2(__assign$2({step:"50",stepname:STEP_NAME.END,etime:e,code:exports.ErrorCode.SUC,playduration:o},r.seekStat),r.bufferStat);r.saveToLS(t,__assign$2(__assign$2({},r.reportHeader),i))}},r.reset=function(){r.reportedEvt={},r.initData.fmt="",r.initData.rate="",r.initData.cdnid="",r.bufferHistory=[],r.seekHistory=[],r.bufferCount=0,r.seekCount=0};var n=t.config.vodQaReporterConfig;return r.config={paramsKey:__assign$2(__assign$2({},DEFAULT_KEYS$2),(null==n?void 0:n.paramsKey)||{})},r.setEvtHandler(),BeaconRequest.register(r.REPORT_KEY,null==n?void 0:n.externalBeaconDefer),r.reporter=BeaconRequest.report,r.onInit(),r.adReportHelper=new AdReportHelper(r),r.player.on(exports.H5_PLAY_EVENT.AD_REQ_ASSETS_START,(function(e){var o=e.data;setTimeout((function(){var e=getAdPlugin(null==t?void 0:t.config.instanceId)["ZT"===o.adType?"ztVideoAdPlayer":"videoAdPlayer"];e&&r.adReportHelper.init(e)}))})),r.on("adReport",(function(t){e.prototype.report.call(r,__assign$2(__assign$2({},t.data),{flowid:r.reportHeader.flowid+"_"+t.data.flowid}))})),r}return __extends$1(t,e),Object.defineProperty(t.prototype,"seekStat",{get:function(){var e=this.seekHistory.reduce((function(e,t){var o=e[0],i=e[1],r=t.letime-t.lstime;return r>BufferThresholds?[o+1,i+r]:e}),[0,0]);return{tbcount:e[0],tbduration:e[1],scount:this.seekHistory.length}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferStat",{get:function(){return{tduration:this.bufferHistory.reduce((function(e,t){return e+(t.etime-t.stime)}),0),bcount:this.bufferHistory.length}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reportHeader",{get:function(){var e=this,t=this.config.paramsKey,o=this.player.getCommonKv;return Object.entries(this.initData).forEach((function(i){var r=i[0];i[1]||(e.initData[r]=o(t[r])||"")})),{platform:o(t.platform)||"",flowid:o(t.flowid)||"",uin:o(t.uin)||getQQFromCookie$1(),QQopenid:o(t.QQopenid)||"",WXopenid:o(t.WXopenid)||"",logintype:o(t.logintype)||0,guid:o(t.guid)||"",uip:o(t.uip)||"",cdnuip:o(t.cdnuip)||"",cdnip:o(t.cdnip)||"",online:o(t.online)||1,p2p:o(t.p2p)||0,sstrength:o(t.sstrength)||0,network:o(t.network)||0,speed:o(t.speed)||0,device:o(t.device)||"",resolution:o(t.resolution)||"",testid:o(t.testid)||0,codec:o(t.codec)||CODEC.H264,osver:o(t.osver)||"",p2pver:o(t.p2pver)||"",appver:o(t.appver)||"",playerver:o(t.playerver)||"",confid:o(t.confid)||0,playertype:o(t.playertype)||0,cdnid:this.initData.cdnid,scenesid:o(t.scenesid)||0,playtype:0,dltype:o(t.dltype)||0,vid:o(t.vid)||"",fmt:this.initData.fmt,rate:this.initData.rate,drm:o(t.drm)||0,definition:o(t.definition)||"",duration:Math.round(o(t.duration)||this.player.duration),seq:this.seq,kernel:this.player.kernelName,domain:urlTool.getDomainOfURL(urlTool.getTopFrameUrl()),ext1:o(t.ext1)||"",ext2:o(t.ext2)||"",ext3:o(t.ext3)||""}},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){window.removeEventListener("pagehide",this.onPageHide),document.removeEventListener("visibilitychange",this.onVisibilityChange),BeaconRequest.clear(this.REPORT_KEY),e.prototype.destroy.call(this)},t.prototype.report=function(t){e.prototype.report.call(this,t),this.seq=this.seq+1},t.pluginName="vod-qa-reporter",t}(BaseReporter),OFFICIAL_PLUGIN={VOD_FLOW_REPORTER:"vod-flow-reporter",LIVE_FLOW_REPORTER:"live-flow-reporter",GETINFO_LIVE:"getinfo-live",GETINFO_VOD:"getinfo-vod",GETINFO_VOD_TC:"getinfo-vod-tc",BARRAGE:"barrage",MARKID:"markid",CONTEXT_MENU:"context-menu",WATERMARK:"ui-watermark",UI_PREVIEW:"ui-preview",UI_PREVIEW_LIST:"ui-preview-list",POLL_DURATION:"poll-duration",REPORTERS:"reporters",UI_ROLE_FILTER:"ui-role-filter",SETTING_BTN:"setting-btn",CTRLBAR:"ctrlbar",ERROR_PAGE:"error-page",FULLSCREEN_RATIO:"fullscreen-ratio",INFO_PANEL:"info-panel",LIVE_POLL:"live-poll",POSTER:"poster",SUBTITLE:"subtitle",TIPS:"tips",UI_LOADING:"ui-loading",VR:"vr",UNMUTE_BTN:"unmute-btn"},PLUGIN_MAP={"vod-flow-reporter":{cdnPath:"thumbplayer-plugin-atta-reporter",version:"1.4.104"},"live-flow-reporter":{cdnPath:"thumbplayer-plugin-atta-reporter",version:"1.4.104"},"getinfo-live":{pluginName:"__thumbplayer-video-request",version:"1.4.109"},"getinfo-vod":{pluginName:"__thumbplayer-video-request",version:"1.4.109"},"getinfo-vod-tc":{pluginName:"__thumbplayer-video-request",version:"1.4.110"},barrage:{pluginName:"Barrage",version:"1.4.112"},markid:{pluginName:"ui-markid",version:"1.4.108"},"context-menu":{cdnPath:"thumbplayer-plugin-ui-contextmenu",version:"1.4.107"},"ui-preview-list":{cdnPath:"thumbplayer-plugin-ui-preview",version:"1.4.111"},"ui-preview":{cdnPath:"thumbplayer-plugin-ui-preview",version:"1.4.111"},"ui-watermark":{cdnPath:"thumbplayer-plugin-watermark",version:"1.4.107"},"poll-duration":{version:"1.4.109"},reporters:{version:"1.4.111"},"ui-role-filter":{version:"1.4.104"},"setting-btn":{version:"1.4.104"},ctrlbar:{version:"1.4.111"},"error-page":{version:"1.4.109"},"fullscreen-ratio":{version:"1.4.104"},"info-panel":{version:"1.4.109"},"live-poll":{version:"1.4.104"},poster:{version:"1.4.107"},subtitle:{version:"1.4.104"},tips:{version:"1.4.111"},"ui-loading":{version:"1.4.104"},vr:{version:"1.4.84"},"unmute-btn":{version:"1.4.107"}},H5_PAUSE_TYPE,AUTO_PLAY_POLICY,PictureDirection;exports.H5_PAUSE_TYPE=void 0,H5_PAUSE_TYPE=exports.H5_PAUSE_TYPE||(exports.H5_PAUSE_TYPE={}),H5_PAUSE_TYPE.USER_CLICK="user-click",exports.AUTO_PLAY_POLICY=void 0,AUTO_PLAY_POLICY=exports.AUTO_PLAY_POLICY||(exports.AUTO_PLAY_POLICY={}),AUTO_PLAY_POLICY.IN_MUTED="autoPlayInMuted",AUTO_PLAY_POLICY.USER_GESTURE="autoPlayRequireByUserGesture",exports.PictureDirection=void 0,PictureDirection=exports.PictureDirection||(exports.PictureDirection={}),PictureDirection.NORMAL="normal",PictureDirection.VERTICAL="vertical",PictureDirection.HORIZON="horizon";var PluginablePlayer=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.plugins={},t.pluginMsg=new s$1,t.playerApiProxy={},t.pluginMsgProxy={on:t.pluginMsg.on.bind(t.pluginMsg),off:t.pluginMsg.off.bind(t.pluginMsg),once:t.pluginMsg.once.bind(t.pluginMsg)},t.loadPlugin=function(e){var o=e.config,i=e.timeout,r=e.version,n=e.crossOrigin,a=e.globalName,s=e.pluginName,l=void 0===s?a:s,p=e.insName,c=e.url;if(!c&&!PLUGIN_MAP[l])throw new Error("您所传入的插件不是官方插件，必须提供 url");if(!c&&PLUGIN_MAP[l]){var d=r||PLUGIN_MAP[l].version,u=PLUGIN_MAP[l].cdnPath||"thumbplayer-plugin-"+l;l=PLUGIN_MAP[l].pluginName||l,c="//vm.gtimg.cn/thumbplayer/plugins/"+u+"/"+d+"/index.min.js"}return p=p||l,domTool.loadScript(c,void 0,i,{crossOrigin:n}).then((function(){getPlugin(l)||registerPlugin(l,window[a]),t.plugins[p]||t.createPlugin(p,__assign$2(__assign$2({},o),{pluginName:l}))}))},t}return __extends$1(t,e),t.prototype.createPlugin=function(e,t){void 0===t&&(t={});var o=t.pluginName,i=void 0===o?e:o,r=getPlugin(i);if(!r)throw new Error("cannot find plugin: "+i);this.triggerSetupEvent({name:e,plugin:r,instance:null},!0),createPluginFactory(e,r,this,t,{msg:this.pluginMsgProxy,api:this.playerApiProxy}),i===AdPluginName&&(setAdPlugin(this.config.instanceId,this.plugins[AdPluginName]),delete this.plugins[AdPluginName]),this.triggerSetupEvent({name:e,plugin:r,instance:null})},t.prototype.createPlugins=function(e){var t=this;e.forEach((function(e){try{"string"==typeof e?t.createPlugin(e):t.createPlugin.apply(t,e)}catch(e){console.error(e)}}))},t.prototype.triggerSetupEvent=function(e,t){var o=this;void 0===t&&(t=!1);var i=(t?"before":"")+"pluginsetup";setTimeout((function(){o.pluginMsg.emit(i+":"+e.name,e)}))},t.registerPlugin=registerPlugin,t.deregisterPlugin=deregisterPlugin,t.getPlugins=getPlugins,t.getPlugin=getPlugin,t.isFunctionPlugin=isFunctionPlugin,t.pluginExists=pluginExists,t.isBasicPlugin=isFunctionPlugin,t}(s$1);function definePlugins(e){return e.map((function(e){return[e[0].pluginName,e[1]]}))}function autobind(e){return function(t,o,i){var r=e;if(!r){var n="on".length,a=o.slice(n).toLowerCase(),s=Object.keys(exports.PLAY_EVENT).find((function(e){return exports.PLAY_EVENT[e].toLowerCase()===a}));s?r=exports.PLAY_EVENT[s]:(s=Object.keys(exports.H5_PLAY_EVENT).find((function(e){return exports.H5_PLAY_EVENT[e].toLowerCase()===a})),r=exports.H5_PLAY_EVENT[s])}var l=i.value;i.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r&&this.player?this.player.on(r,l.bind(this)):l.apply(this,e)}}}var logApiInvoke=function(e,t,o){var i=o.value;o.value=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var r="";try{r=JSON.stringify(e)}catch(e){r="parse arg failed"}return this.setStateKv(t,{type:exports.LOG_TYPE.API_INVOKE,ftime:Date.now(),ext:{from:"thumbplayer-h5",args:r}}),i.apply(this,e)}},once=function(e,t,o){var i=o.value;o.value=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];if(!this["__hasRun"+t])return this["__hasRun"+t]=!0,i.apply(this,e)}},BaseFlowNode=function(e){function t(t){var o=e.call(this)||this;return o.flowid=t.flowid,o}return __extends$1(t,e),t.prototype.destroy=function(){this.removeAllListeners()},t.prototype.getName=function(){return""},t.prototype.replay=function(e,t){return Promise.reject("replay not implemented! ("+this.getName()+")")},t}(s$1),FLOW_NODE_EVENT;exports.FLOW_NODE_EVENT=void 0,FLOW_NODE_EVENT=exports.FLOW_NODE_EVENT||(exports.FLOW_NODE_EVENT={}),FLOW_NODE_EVENT.PRELOAD_NEXT="PRELOAD_NEXT",FLOW_NODE_EVENT.PRELOAD="PRELOAD",FLOW_NODE_EVENT.START="START",FLOW_NODE_EVENT.END="END",FLOW_NODE_EVENT.ABORT="ABORT";var AdFlowNode=function(e){function t(t){var o,i=e.call(this,t)||this;return i.config=t,i.onAdEnd=function(e){var t=e.data;t.adType===exports.AD_TYPE.PRE&&(i.config.corePlayer.volume=getAdPlugin(i.config.instanceId).getAdVolume()),i.isInValidAd(t)||i.endFlow()},i.onAdAssetsLoaded=function(e){var t=e.data;i.isInValidAd(t)||i.emit(exports.FLOW_NODE_EVENT.PRELOAD_NEXT,{name:i.getName()})},i.onAdPlayBlocked=function(e){var t=e.data;i.isInValidAd(t)||(i.isPreload=!0)},i.logger=new Logger(t.instanceId,"AdFlowNode"),null===(o=getAdPlugin(t.instanceId))||void 0===o||o.on(exports.H5_PLAY_EVENT.AD_AUTOPLAY_BLOCKED,i.onAdPlayBlocked),i}return __extends$1(t,e),t.prototype.getName=function(){return"AdFlowNode."+this.config.startParam.adType},t.prototype.start=function(){var e=this;return this.logger.log(this.getName()+" exec start"),this.emit(exports.FLOW_NODE_EVENT.START,{name:this.getName()}),this.checkCanPlayAd()?(this.isPreload=!1,this.bindAdEvents(),getAdPlugin(this.config.instanceId).playAd(this.startParam).catch((function(){return e.endFlow()}))):(this.logger.log(this.getName()+" skip exec start"),void this.endFlow())},t.prototype.preload=function(){var e=this;this.logger.log(this.getName()+" exec preload"),this.emit(exports.FLOW_NODE_EVENT.PRELOAD,{name:this.getName()});var t=function(){e.emit(exports.FLOW_NODE_EVENT.PRELOAD_NEXT,{forcePreload:!0,name:e.getName()})};return this.checkCanPlayAd()?(this.isPreload=!0,this.bindAdEvents(),getAdPlugin(this.config.instanceId).loadAd(this.startParam).then((function(e){!1===e&&t()})).catch(t)):(this.logger.log(this.getName()+" skip exec preload"),void t())},t.prototype.destroy=function(){var t=getAdPlugin(this.config.instanceId);t&&(t.off(exports.H5_PLAY_EVENT.AD_END,this.onAdEnd),t.off(exports.H5_PLAY_EVENT.AD_ASSETS_LOADED,this.onAdAssetsLoaded),t.off(exports.H5_PLAY_EVENT.AD_AUTOPLAY_BLOCKED,this.onAdPlayBlocked)),e.prototype.destroy.call(this)},t.prototype.checkCanPlayAd=function(){return getAdPlugin(this.config.instanceId)&&this.startParam},t.prototype.bindAdEvents=function(){var e=getAdPlugin(this.config.instanceId);e.on(exports.H5_PLAY_EVENT.AD_END,this.onAdEnd),e.on(exports.H5_PLAY_EVENT.AD_ASSETS_LOADED,this.onAdAssetsLoaded)},Object.defineProperty(t.prototype,"startParam",{get:function(){return this.config.startParam},enumerable:!1,configurable:!0}),t.prototype.endFlow=function(){this.emit(exports.FLOW_NODE_EVENT.END,{name:this.getName()}),this.destroy()},t.prototype.isInValidAd=function(e){return e.adType!==this.config.startParam.adType},__decorate$1([once,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[]),__metadata$1("design:returntype",void 0)],t.prototype,"bindAdEvents",null),t}(BaseFlowNode),FlowManager=function(){function e(e){this.config=e,this.flowNodeList=[],this.currentFlowNodeIndex=0,this.lastNodeList=[],this.logger=new Logger(e.playerInstanceId,"FlowManager")}return Object.defineProperty(e.prototype,"onFlowEnd",{get:function(){return this.config.onFlowEnd||function(){}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onFlowEvts",{get:function(){return this.config.onFlowEvts||function(){}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFlowNode",{get:function(){return this.flowNodeList[this.currentFlowNodeIndex]},enumerable:!1,configurable:!0}),e.prototype.push=function(){for(var e,t=this,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];o.forEach((function(e){return t.bindNodeEvents(e)})),(e=this.flowNodeList).push.apply(e,o)},e.prototype.setLastNode=function(e){this.lastNodeList.push(e)},e.prototype.clear=function(){this.flowNodeList.forEach((function(e){return e.destroy()})),this.flowNodeList=[],this.lastNodeList=[],this.currentFlowNodeIndex=0},e.prototype.bindNodeEvents=function(e){var t,o=this,i=((t={})[exports.FLOW_NODE_EVENT.PRELOAD_NEXT]=function(t){var i,r=t.data;o.logger.log(e.getName()+" emited: FLOW_NODE_EVENT.PRELOAD_NEXT"),o.config.disablePreload&&!(null==r?void 0:r.forcePreload)||null===(i=o.getNextNode(e))||void 0===i||i.preload()},t[exports.FLOW_NODE_EVENT.END]=function(t){var i=t.data;o.logger.log(e.getName()+" emited: FLOW_NODE_EVENT.END"),i.videoEndState&&(o.videoEndState=i.videoEndState),e.removeAllListeners();var r=o.getNextNode(e);if(!r){var n=e.getName();return o.logger.log("no next node after "+n+", clear"),o.clear(),o.onFlowEnd({code:exports.ErrorCode.SUC,endState:o.videoEndState,curFlowNodeName:n}),void(o.videoEndState="")}if(o.lastNodeList.includes(e)){n=e.getName();return o.logger.log("lastNodeList includes "+n+", end"),o.onFlowEnd({code:exports.ErrorCode.SUC,curFlowNodeName:n})}o.currentFlowNodeIndex+=1,o.logger.log("next node start, current index is "+o.currentFlowNodeIndex),r.start()},t[exports.FLOW_NODE_EVENT.ABORT]=function(t){var i=t.data,r=e.getName();o.logger.log(r+" emited: FLOW_NODE_EVENT.ABORT"),o.clear(),o.onFlowEnd(__assign$2(__assign$2({},i),{endState:i.endState||exports.END_STATE.ERROR,curFlowNodeName:r}))},t);Object.keys(exports.FLOW_NODE_EVENT).forEach((function(t){e.on(t,(function(e){var t=e.type,r=e.data;o.onFlowEvts(t,r),i[t]&&i[t]({data:r})}))}))},e.prototype.getNextNode=function(e){var t=this.flowNodeList.indexOf(e);if(-1!==t)return this.flowNodeList[t+1]},e}(),maxRetryTimes=3,maxRetryTimesInVodSession=10,maxRetryTimesInLiveSession=30,VideoFlowNode=function(e){function t(t){var o,i=e.call(this,t)||this;return i.config=t,i.retryTimes=0,i.retryTimesInSession=0,i.isReplaying=!1,i.isDestroyed=!1,i.onVideoPlayBlocked=function(){return i.isPreload=!0},i.onVideoTimeUpdate=function(){var e;if(!i.isLive){var t=null!==(e=i.startParam.postAdReqLeftTime)&&void 0!==e?e:10;Number.isNaN(t)||i.corePlayer.playtime+t>=i.corePlayer.duration&&i.emitPreloadNext()}},i.onVideoStop=function(e){var t,o=e.data;i.isReplaying?i.isReplaying=!1:(null===(t=o.videoInfo)||void 0===t?void 0:t.error)||(i.flowOverHandler(),i.emit(exports.FLOW_NODE_EVENT.END,{videoEndState:o.endState,name:i.getName()}))},i.onVideoStateChange=function(e){e.data.new===exports.VIDEO_STATE.PLAYING&&(i.retryTimes=0)},i.onVideoError=function(e){var t,o,r=e.data,n=i.isLive?maxRetryTimesInLiveSession:maxRetryTimesInVodSession,a=i.retryTimesInSession>=n,s=null===(t=null==r?void 0:r.videoInfo)||void 0===t?void 0:t.error;if(!i.startParam.vid||i.retryTimes>=maxRetryTimes||a||(null==s?void 0:s.fatal))return i.flowOverHandler(),void i.emit(exports.FLOW_NODE_EVENT.ABORT,__assign$2(__assign$2({},s),{code:(null==s?void 0:s.code)||exports.ErrorCode.UNKNOWN,name:i.getName()}));i.retryTimes+=1,i.retryTimesInSession+=1,i.logger.log("play retry, retryTimes="+i.retryTimes+", retryTimesInSession="+i.retryTimesInSession),i.config.extEvtDispatcher.emit(exports.PLAY_EVENT_EXT.RETRY_PLAY,{retryTimes:i.retryTimes}),i.startParam.videoLoadParam=__assign$2(__assign$2({},i.startParam.videoLoadParam),{startTime:null===(o=r.videoInfo)||void 0===o?void 0:o.playtime}),i.isPreload?i.preload():i.start()},i.logger=new Logger(i.corePlayer.config.instanceId,"VideoFlowNode"),i.evtMap=((o={})[exports.PLAY_EVENT.TIME_UPDATE]=i.onVideoTimeUpdate,o[exports.PLAY_EVENT.STOPED]=i.onVideoStop,o[exports.PLAY_EVENT.ERROR]=i.onVideoError,o[exports.PLAY_EVENT.STATE_CHANGE]=i.onVideoStateChange,o[exports.PLAY_EVENT.AUTOPLAY_BLOCKED]=i.onVideoPlayBlocked,o),i.setPlayerEvents(!0),i}return __extends$1(t,e),Object.defineProperty(t.prototype,"isLive",{get:function(){return this.corePlayer.config.type===exports.PLAY_MODE.LIVE},enumerable:!1,configurable:!0}),t.prototype.getName=function(){return"VideoFlowNode"},t.prototype.start=function(){return __awaiter$1(this,void 0,void 0,(function(){var e,t,o;return __generator$1(this,(function(i){switch(i.label){case 0:return this.logger.log(this.getName()+" exec start"),this.emit(exports.FLOW_NODE_EVENT.START,{name:this.getName()}),this.isPreload?(this.isPreload=!1,this.logger.log(this.getName()+" exec start on preloaded"),[4,this.loadDefer]):[3,2];case 1:return i.sent(),this.isLive&&this.corePlayer.resize({width:"100%"}),this.corePlayer.play(),[2];case 2:return this.isPreload=!1,[4,this.getVideoRsp()];case 3:return e=i.sent(),t=e.urlConfig,(o=e.kernelName)&&(this.startParam.videoLoadParam=__assign$2({kernelName:o},this.startParam.videoLoadParam)),"function"==typeof this.config.videoLoadParamModifier&&(this.startParam.videoLoadParam=this.config.videoLoadParamModifier(this.startParam.videoLoadParam)),this.corePlayer.play(t,this.startParam.videoLoadParam),[2]}}))}))},t.prototype.preload=function(){return __awaiter$1(this,void 0,void 0,(function(){var e,t,o;return __generator$1(this,(function(i){switch(i.label){case 0:return this.logger.log(this.getName()+" exec preload"),this.emit(exports.FLOW_NODE_EVENT.PRELOAD,{name:this.getName()}),this.isPreload=!0,this.loadDefer=this.getVideoRsp(),[4,this.loadDefer];case 1:return e=i.sent(),t=e.urlConfig,(o=e.kernelName)&&(this.startParam.videoLoadParam=__assign$2({kernelName:o},this.startParam.videoLoadParam)),this.isLive?(this.corePlayer.volume=0,[4,this.corePlayer.play(t,this.startParam.videoLoadParam)]):[3,3];case 2:return i.sent(),this.corePlayer.resize({width:0}),[3,4];case 3:this.corePlayer.load(t,this.startParam.videoLoadParam),i.label=4;case 4:return[2]}}))}))},t.prototype.setLevel=function(e){var t;return __awaiter$1(this,void 0,void 0,(function(){var o,i=this;return __generator$1(this,(function(r){switch(r.label){case 0:return this.emitFromVideoNode(exports.H5_PLAY_EVENT.VIDEO_SETLEVEL_START,{level:e}),[4,this.getLevelUrlConfig(e)];case 1:if(!(o=r.sent())||!o.url)throw new Error("setLevel url is empty");return[2,null===(t=this.corePlayer.setLevel(o.url,o.backupUrls,o))||void 0===t?void 0:t.catch((function(t){throw i.emitFromVideoNode(exports.H5_PLAY_EVENT.VIDEO_SETLEVEL_END,{code:(null==t?void 0:t.code)||exports.ErrorCode.UNKNOWN,message:null==t?void 0:t.message,level:e}),t}))]}}))}))},t.prototype.replay=function(e,t){return __awaiter$1(this,void 0,void 0,(function(){var o,i,r,n,a,s;return __generator$1(this,(function(l){switch(l.label){case 0:return o=__assign$2(__assign$2({},this.startParam.videoReqInfoParam),null==t?void 0:t.videoReqInfoParam),i=__assign$2(__assign$2({},this.startParam.videoLoadParam),null==t?void 0:t.videoLoadParam),this.startParam=__assign$2(__assign$2({},this.startParam),{videoReqInfoParam:o,videoLoadParam:i}),isVideoId(e)?(this.logger.log("replay(), start request video info: ",o),[4,this.requestVideoInfo({emitFlowEvent:!1,extraData:o})]):(this.logger.log("replay(), start replay urlConfig: ",e),this.isReplaying=!0,[2,this.corePlayer.play(e,i)]);case 1:if(r=l.sent(),this.isDestroyed)return[2];if(a=(n=r||{}).error,s=n.urlConfig,!r)throw new Error("request video info failed");if(a)throw a;if(!s||!s.url)throw new Error("request video info failed because of empty UrlConfig");return this.isReplaying=!0,[2,this.corePlayer.play(s,i)]}}))}))},t.prototype.destroy=function(){this.isDestroyed=!0,this.setPlayerEvents(!1),e.prototype.destroy.call(this)},t.prototype.emitPreloadNext=function(){this.emit(exports.FLOW_NODE_EVENT.PRELOAD_NEXT,{forcePreload:!0,name:this.getName()})},t.prototype.requestVideoInfo=function(e){var t,o;return void 0===e&&(e={}),__awaiter$1(this,void 0,void 0,(function(){var i,r,n,a,s,l,p,c=this;return __generator$1(this,(function(d){switch(d.label){case 0:return i=this.config.videoReqInfoPlugin,r=e.extraData,n=void 0===r?{}:r,a=e.emitFlowEvent,s=void 0===a||a,i?(s&&this.tryEmit((function(){return c.emitFromVideoNode(exports.H5_PLAY_EVENT.VIDEO_REQ_INFO_START)})),null===(t=i.abort)||void 0===t||t.call(i),this.tryEmit((function(){return c.config.extEvtDispatcher.emit(exports.PLAY_EVENT_EXT.GETINFO_START)})),[4,i.request(this.startParam.vid,__assign$2(__assign$2(__assign$2({},this.startParam.videoReqInfoParam),{flowid:this.flowid}),n))]):[2];case 1:return l=d.sent(),this.tryEmit((function(){return c.config.extEvtDispatcher.emit(exports.PLAY_EVENT_EXT.GETINFO_OVER,l)})),p=(null===(o=l.error)||void 0===o?void 0:o.code)||exports.ErrorCode.SUC,s&&this.tryEmit((function(){return c.emitFromVideoNode(exports.H5_PLAY_EVENT.VIDEO_REQ_INFO_END,{code:p,data:l})})),[2,l]}}))}))},t.prototype.getVideoRsp=function(){return __awaiter$1(this,void 0,void 0,(function(){var e,t,o,i,r,n;return __generator$1(this,(function(a){switch(a.label){case 0:if(e=this.startParam.urlConfig)return[2,{urlConfig:e}];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.requestVideoInfo()];case 2:if(t=a.sent(),i=(o=t||{}).urlConfig,(r=o.error)||!isUrlConfigValid(i))throw r;return[2,t];case 3:return n=a.sent(),this.logger.log(n),this.flowOverHandler(),this.emit(exports.FLOW_NODE_EVENT.ABORT,__assign$2(__assign$2({},n),{code:(null==n?void 0:n.code)||exports.ErrorCode.GETINFO_NET,name:this.getName()})),[2,{urlConfig:null}];case 4:return[2]}}))}))},t.prototype.setPlayerEvents=function(e){var t=this;void 0===e&&(e=!0);var o=e?this.corePlayer.on:this.corePlayer.off;Object.keys(this.evtMap).forEach((function(e){o.call(t.corePlayer,e,t.evtMap[e])}))},t.prototype.flowOverHandler=function(){this.retryTimes=0,this.retryTimesInSession=0},Object.defineProperty(t.prototype,"corePlayer",{get:function(){return this.config.corePlayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startParam",{get:function(){return this.config.startParam},set:function(e){this.config.startParam=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emitFromVideoNode",{get:function(){return this.config.emitFromVideoNode},enumerable:!1,configurable:!0}),t.prototype.getLevelUrlConfig=function(e){var t,o;return __awaiter$1(this,void 0,void 0,(function(){var i,r,n,a;return __generator$1(this,(function(s){switch(s.label){case 0:return isUrlConfig(e)?(i=e,[3,4]):[3,1];case 1:return"string"!=typeof e?[3,2]:(i={url:e},[3,4]);case 2:return r=__assign$2(__assign$2({},this.startParam.videoReqInfoParam),e),this.startParam=__assign$2(__assign$2({},this.startParam),{videoReqInfoParam:r}),[4,this.requestVideoInfo({emitFlowEvent:!1,extraData:r})];case 3:if(!(n=s.sent()))throw new Error;if(i=n.urlConfig,n.error)throw a=null===(o=null===(t=n.error.data)||void 0===t?void 0:t.params)||void 0===o?void 0:o.msg,this.emitFromVideoNode(exports.H5_PLAY_EVENT.VIDEO_SETLEVEL_END,{code:n.error.code||exports.ErrorCode.UNKNOWN,message:a||n.error.message,level:e}),n.error;s.label=4;case 4:return[2,i]}}))}))},t.prototype.tryEmit=function(e){try{e()}catch(e){this.logger.error(e)}},__decorate$1([once,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[]),__metadata$1("design:returntype",void 0)],t.prototype,"emitPreloadNext",null),t}(BaseFlowNode);function isUrlConfigValid(e){return Array.isArray(e)?e.every(isUrlConfig):isUrlConfig(e)}function isUrlConfig(e){return"string"==typeof(null==e?void 0:e.url)}var FlowPlayer=function(e){function t(t){var o=e.call(this)||this;o.isSettingLevel=!1,o.emitFromVideoNode=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];o.emit.apply(o,__spreadArray$1([e],t))},o.onFlowEnd=function(e){var t,i=e.code,r=void 0===i?exports.ErrorCode.SUC:i,n=e.endState,a=void 0===n?exports.END_STATE.NORMAL:n,s=e.curFlowNodeName;o.log("onFlowEnd, code="+r+", endState="+a+", curFlowNodeName="+s),o.config.type===exports.PLAY_MODE.LIVE&&(null===(t=getAdPlugin(o.config.instanceId))||void 0===t||t.stopAd()),o.emit(exports.H5_PLAY_EVENT.PLAY_SESSION_END,__assign$2(__assign$2({},e),{endState:a,code:r,curFlowNodeName:s}))},o.onFlowEvts=function(e,t){var i,r=((i={})[exports.FLOW_NODE_EVENT.PRELOAD]=exports.PLAY_EVENT_EXT.FLOW_NODE_PRELOAD,i[exports.FLOW_NODE_EVENT.START]=exports.PLAY_EVENT_EXT.FLOW_NODE_START,i[exports.FLOW_NODE_EVENT.END]=exports.PLAY_EVENT_EXT.FLOW_NODE_END,i[exports.FLOW_NODE_EVENT.ABORT]=exports.PLAY_EVENT_EXT.FLOW_NODE_ABORT,i);o.pluginMsg.emit(r[e],t)};var i=t.useSingleVideoElement,r=void 0===i?uaTool.mobile:i;return o.corePlayer=new KernelProxy(__assign$2(__assign$2({},t),{maxVideoNodeCount:r?1:null==t?void 0:t.maxVideoNodeCount,createVideoNodeWhenLoad:r})),o.logger=new Logger(o.config.instanceId,"FlowPlayer"),o.flowManager=new FlowManager({playerInstanceId:o.config.instanceId,onFlowEnd:o.onFlowEnd,onFlowEvts:o.onFlowEvts,disablePreload:r}),o.proxyAllPlayEvent(),o.proxyStateChange(),o.proxyVideoStopped(),proxyPlayEvent(o,o.corePlayer),o.on(exports.H5_PLAY_EVENT.PLAY_SESSION_START,(function(){o.isSettingLevel=!1})),o}return __extends$1(t,e),Object.defineProperty(t.prototype,"videoReqInfoPlugin",{get:function(){return null},enumerable:!1,configurable:!0}),t.prototype.load=function(e,t){return __awaiter$1(this,void 0,void 0,(function(){return __generator$1(this,(function(o){return e?(this.createFlowNodes(e,t),[2,this.flowManager.currentFlowNode.preload()]):[2,this.corePlayer.load()]}))}))},t.prototype.play=function(e,t){return __awaiter$1(this,void 0,void 0,(function(){return __generator$1(this,(function(o){return e?(this.createFlowNodes(e,t),[2,this.flowManager.currentFlowNode.start()]):[2,this.resumePlay()]}))}))},t.prototype.setLevel=function(e){return __awaiter$1(this,void 0,void 0,(function(){return __generator$1(this,(function(t){switch(t.label){case 0:if(!this.checkCanSetLevel())throw new Error("setLevel can't start");this.isSettingLevel=!0,t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this.videoNode.setLevel(e)];case 2:return t.sent(),[3,5];case 3:throw t.sent();case 4:return this.isSettingLevel=!1,[7];case 5:return[2]}}))}))},t.prototype.preloadVid=function(e){throw new Error("Method not implemented.")},t.prototype.pause=function(e){return this.corePlayer.pause(e)},t.prototype.seek=function(e){return this.corePlayer.seek(e)},t.prototype.stop=function(e){var t,o,i;if(this.flowManager.currentFlowNode){var r=this.flowManager.currentFlowNode.getName();this.log("stop(), endState="+e+", curFlowNodeName="+r),this.flowManager.clear(),null===(o=getAdPlugin(null===(t=this.config)||void 0===t?void 0:t.instanceId))||void 0===o||o.stopAd(),null===(i=this.videoReqInfoPlugin)||void 0===i||i.abort(),this.corePlayer.stop(e),this.emit(exports.H5_PLAY_EVENT.PLAY_SESSION_END,{curFlowNodeName:r,code:exports.ErrorCode.SUC,endState:e||exports.END_STATE.INTERRUPT})}},t.prototype.destroy=function(){return this.stop(),this.removeAllListeners(),this.corePlayer.destroy()},t.prototype.checkCanSetLevel=function(){return this.videoNode&&!this.isSettingLevel},t.prototype.loadPostAd=function(){this.videoNode&&this.flowManager.currentFlowNode===this.videoNode&&this.videoNode.emitPreloadNext()},t.prototype.prepareUsageData=function(){return this.corePlayer.prepareUsageData()},Object.defineProperty(t.prototype,"nodeBeforePreAd",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeBeforePostAd",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoNode",{get:function(){return this.flowManager.flowNodeList.find((function(e){return e instanceof VideoFlowNode}))},enumerable:!1,configurable:!0}),t.prototype.proxyAllPlayEvent=function(){var e=this;Object.keys(exports.PLAY_EVENT).forEach((function(t){e.corePlayer.on(exports.PLAY_EVENT[t],(function(o){var i=o.data;return e.emit(exports.PLAY_EVENT[t],i)}))}))},t.prototype.proxyStateChange=function(){var e,t=this,o=((e={})[exports.VIDEO_STATE.LOAD_START]=exports.H5_PLAY_EVENT.VIDEO_LOAD_START,e[exports.VIDEO_STATE.CANPLAY]=exports.H5_PLAY_EVENT.VIDEO_CANPLAY,e[exports.VIDEO_STATE.BUFFERING]=exports.H5_PLAY_EVENT.VIDEO_BUFFERING,e[exports.VIDEO_STATE.SEEKING]=exports.H5_PLAY_EVENT.VIDEO_SEEKING,e[exports.VIDEO_STATE.SEEKED]=exports.H5_PLAY_EVENT.VIDEO_SEEKED,e);this.corePlayer.on(exports.PLAY_EVENT.STATE_CHANGE,(function(e){var i=e.data,r=i.new;if(o[r])return t.emit(o[r],{});r!==exports.VIDEO_STATE.PLAYING&&r!==exports.VIDEO_STATE.PAUSE||t.proxyPlayPause(r,i)}))},t.prototype.proxyVideoStopped=function(){var e=this;this.corePlayer.on(exports.PLAY_EVENT.STOPED,(function(t){var o,i=t.data,r=null===(o=null==i?void 0:i.videoInfo)||void 0===o?void 0:o.error,n=__assign$2(__assign$2({},i),{code:(null==r?void 0:r.code)||exports.ErrorCode.SUC});e.emit(exports.H5_PLAY_EVENT.VIDEO_END,n)}))},t.prototype.proxyPlayPause=function(e,t){var o;e===exports.VIDEO_STATE.PLAYING?this.emit(exports.H5_PLAY_EVENT.VIDEO_PLAYING,{isFirst:!(null===(o=t.videoInfo)||void 0===o?void 0:o.hasFirstPlaying)}):e===exports.VIDEO_STATE.PAUSE&&this.emit(exports.H5_PLAY_EVENT.VIDEO_PAUSE,{pauseType:t.pauseType})},t.prototype.resumePlay=function(){var e;(null===(e=this.flowManager.currentFlowNode)||void 0===e?void 0:e.isPreload)?this.flowManager.currentFlowNode.start():this.corePlayer.play()},t.prototype.createFlowNodes=function(e,t){var o;this.flowManager.currentFlowNode&&(this.log("loadItem(), stop because of currentFlowNode is running"),this.stop());var i=comTool.createGUID();this.emit(exports.H5_PLAY_EVENT.PLAY_SESSION_START,{flowid:i});var r=__assign$2({},t);isVideoId(e)?r.vid=e:r.urlConfig=e;var n=this.nodeBeforePreAd,a=this.nodeBeforePostAd;n instanceof BaseFlowNode&&this.flowManager.push(n);var s=new AdFlowNode({flowid:i,instanceId:this.config.instanceId,startParam:__assign$2({adType:exports.AD_TYPE.PRE},r.adParam),corePlayer:this.corePlayer});this.flowManager.push(s);var l=new VideoFlowNode({flowid:i,corePlayer:this.corePlayer,videoReqInfoPlugin:this.videoReqInfoPlugin,startParam:r,extEvtDispatcher:this.pluginMsg,emitFromVideoNode:this.emitFromVideoNode,videoLoadParamModifier:this.videoLoadParamModifier});if(this.flowManager.push(l),this.config.type!==exports.PLAY_MODE.LIVE){a instanceof BaseFlowNode&&this.flowManager.push(a);var p=new AdFlowNode({flowid:i,instanceId:this.config.instanceId,startParam:__assign$2({adType:exports.AD_TYPE.POST},r.adParam),corePlayer:this.corePlayer});this.flowManager.push(p),this.flowManager.setLastNode(p)}this.log("loadItem(), flowNodeList="+(null===(o=this.flowManager.flowNodeList)||void 0===o?void 0:o.map((function(e){return e.getName()}))))},Object.defineProperty(t.prototype,"isCollected",{get:function(){return this.corePlayer._isCollected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_kernel",{get:function(){return this.corePlayer._kernel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this.corePlayer.config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useWorker",{get:function(){return this.corePlayer.useWorker},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernelName",{get:function(){return this.corePlayer.kernelName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoElements",{get:function(){return this.corePlayer.videoElements},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoElement",{get:function(){return this.corePlayer.currentVideoElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPreload",{get:function(){return this.corePlayer.supportPreload},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.corePlayer.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playtime",{get:function(){return this.corePlayer.playtime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoInfos",{get:function(){return this.corePlayer.videoInfos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preloadVideoInfos",{get:function(){return this.corePlayer.preloadVideoInfos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoInfo",{get:function(){return this.corePlayer.currentVideoInfo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVideoInfoIdx",{get:function(){return this.corePlayer.currentVideoInfoIdx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalVideoInfoCount",{get:function(){return this.corePlayer.totalVideoInfoCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportPlaybackRate",{get:function(){return this.corePlayer.supportPlaybackRate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"played",{get:function(){return this.corePlayer.played},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.corePlayer.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoSize",{get:function(){return this.corePlayer.videoSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoBuffered",{get:function(){return this.corePlayer.videoBuffered},enumerable:!1,configurable:!0}),t.prototype.log=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.logger).log.apply(e,t)},t.prototype.hasAppended=function(e){return this.corePlayer.hasAppended(e)},t.prototype.hasPreloaded=function(e){return this.corePlayer.hasPreloaded(e)},Object.defineProperty(t.prototype,"volume",{get:function(){return this.corePlayer.volume},set:function(e){this.corePlayer.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){return this.corePlayer.playbackRate},set:function(e){this.corePlayer.playbackRate=e},enumerable:!1,configurable:!0}),t.prototype.resizeVideoElements=function(e){return this.corePlayer.resizeVideoElements(e)},t.prototype.resize=function(e){return this.corePlayer.resize(e)},t.prototype.playNext=function(e){return this.corePlayer.playNext(e)},t.prototype.captureVideo=function(e,t,o,i,r){return this.corePlayer.captureVideo(e,t,o,i,r)},t.prototype.appendNext=function(e){return this.corePlayer.appendNext(e)},t.prototype.preloadNext=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.corePlayer).preloadNext.apply(e,t)},t.prototype.clearAllPreload=function(){return this.corePlayer.clearAllPreload()},t.prototype.triggerAutoplay=function(){return this.corePlayer.triggerAutoplay()},t._isCollected=!1,t}(PluginablePlayer),_a$5,CHANNEL="npm";try{CHANNEL="npm"}catch(e){}var logMethodCall$1=logMethodCallDecoratorCreator("H5Player"),rotateTransformValue=(_a$5={},_a$5[exports.PictureDirection.VERTICAL]="rotateX(180deg)",_a$5[exports.PictureDirection.HORIZON]="rotateY(180deg)",_a$5[exports.PictureDirection.NORMAL]="none",_a$5),H5Player=function(e){function t(t){var o=e.call(this,__assign$2(__assign$2({},t.coreConfig),t))||this;o.plugins={},o.interactMod=null,o.getCommonKv=function(e){return o.dataset.commonMap[e]},o.getStateKv=function(e){return o.dataset.stateMap[e]},o.mutedVolume=1,o.hasMutePlayed=!1,o.mixin=function(e){var t="function"==typeof e?e():e;Object.keys(t).forEach((function(e){if(e in o)throw new Error("cannot override existing player method: "+e);var i=t[e];"function"==typeof i?o[e]=i:console.error("mixin "+i+" is not a function")}))},o.log("new H5Player(), input config=",jsonTool.safelyStringify(t));var i=Date.now(),r=t.container,n=t.plugins,a=t.mixins,s=t.lazyInitPlugins;if(o.container="string"==typeof r?document.querySelector(r):r,!o.container)throw new Error("cannot find container: "+r);return o.setMaxListeners(100),o.createClickMask(),o.createInnerPlugins(),n instanceof Array&&(s?setTimeout((function(){return o.createPlugins(n)})):o.createPlugins(n)),a instanceof Array&&a.forEach(o.mixin),o.initPluginApis(),o.forwardPluginEvents(),o.initContainerStyle(),o.setupEventFlagData(),o.setupLoopPlay(),o.checkAutoPlayInMute(),o.autoHideMouse(),o.applyStyleOnVideoNodeChange(),o.on(exports.H5_PLAY_EVENT.PLAY_SESSION_START,(function(){o.hasMutePlayed=!1})),o.setStateKv(exports.DATA_STATE.INIT,{type:exports.LOG_TYPE.CORE_EVENT,ftime:Date.now(),ext:{stime:i}}),o}return __extends$1(t,e),t.registerSavedCommonKey=function(e){DataSet.SETTING_CONFIG[e]?console.warn("key "+e+" already registered"):DataSet.SETTING_CONFIG.push({dsKey:e,lsKey:"__thumbplayer_custom_"+e+"__"})},t.prototype.load=function(t,o){return t?(this.cacheLoadParam(t,o),this.corePlayer.load(),e.prototype.load.call(this,t,this.getParamWithStartTime(t,o))):e.prototype.load.call(this)},t.prototype.play=function(t,o){return t?(this.cacheLoadParam(t,o),this.corePlayer.load(),e.prototype.play.call(this,t,this.getParamWithStartTime(t,o))):e.prototype.play.call(this)},t.prototype.createPlugin=function(t,o){void 0===o&&(o={}),e.prototype.createPlugin.call(this,t,o);var i=o.pluginName;(void 0===i?t:i)===AdPluginName&&proxyAdEvent(this)},t.prototype.replay=function(){var e,t,o=this.vid,i=this.playUrl;if(null===(t=null===(e=this.loadParam)||void 0===e?void 0:e.videoLoadParam)||void 0===t||delete t.startTime,o)return this.play(o,this.loadParam);if(i){var r=i.lastIndexOf("#");return r>0&&(i=i.slice(0,r)),this.play({url:i},this.loadParam)}this.log("Current player has no available vid or url to replay")},t.prototype.pause=function(t){return e.prototype.pause.call(this,t)},t.prototype.seek=function(t){var o=this.timeRange,i=o.startTime,r=o.endTime,n=Math.min(r,Math.max(i,t));return e.prototype.seek.call(this,n)},t.prototype.stop=function(t){return e.prototype.stop.call(this,t)},t.prototype.setLevel=function(t){return e.prototype.setLevel.call(this,t)},t.prototype.setPictureImage=function(e){void 0===e&&(e=exports.PictureDirection.NORMAL),this.pictureDirection=e,this.isPlayingAd?this.setAdVideoStyle({transform:rotateTransformValue[e]}):this.setVideoStyle({transform:rotateTransformValue[e]}),e===exports.PictureDirection.NORMAL&&(this.rotateDegree=0)},t.prototype.setRotate=function(e){"number"!=typeof e||Number.isNaN(e)||(this.rotateDegree=e,this.isPlayingAd?this.setAdVideoStyle({transform:"rotate("+e+"deg)"}):this.setVideoStyle({transform:"rotate("+e+"deg)"}))},t.prototype.getRotate=function(){return this.rotateDegree},Object.defineProperty(t.prototype,"volume",{get:function(){return this.corePlayer.volume},set:function(e){var t;this.corePlayer.volume=e,null===(t=getAdPlugin(this.config.instanceId))||void 0===t||t.setAdVolume(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timeRange",{get:function(){return this.playtimeLimiter.range},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e,t,o=this;try{this.stop(),this.pluginMsg.emit(exports.PLAY_EVENT_EXT.DESTROY)}catch(e){this.log(e)}this.plugins&&(Object.keys(this.plugins).forEach((function(e){var t,i;null===(i=null===(t=o.plugins[e])||void 0===t?void 0:t.destroy)||void 0===i||i.call(t)})),delete this.plugins),setAdPlugin(null===(e=this.config)||void 0===e?void 0:e.instanceId,null),this.removeAllListeners(),this.pluginMsg.removeAllListeners(),this.corePlayer.destroy(),this.container.innerHTML="",null===(t=this.interactMod)||void 0===t||t.remove(),this.interactMod=null;var i=this.container.cloneNode();this.container.parentNode.replaceChild(i,this.container),this.container=i,clearTimeout(this.mouseMoveTimer),"none"===this.container.style.cursor&&(this.container.style.cursor="auto")},Object.defineProperty(t.prototype,"offlineLogPlugin",{get:function(){return this.plugins[OfflineLogPlugin.pluginName]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pluginInstances",{get:function(){return this.plugins},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"player",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,PlaytimeLimiterPlugin.pluginName,{get:function(){return this.plugins[PlaytimeLimiterPlugin.pluginName]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,DataSet.pluginName,{get:function(){return this.plugins[DataSet.pluginName]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,OfflineLogPlugin.pluginName,{get:function(){return this.plugins[OfflineLogPlugin.pluginName]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoReqInfoPlugin",{get:function(){return this.plugins[VideoReqInfoPluginName]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vid",{get:function(){return isVideoId(this.currentPlayItem)?this.currentPlayItem:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){var e;return null===(e=this.currentVideoInfo)||void 0===e?void 0:e.loadingUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this.state===exports.VIDEO_STATE.PAUSE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return 0===this.volume},set:function(e){e?(this.mutedVolume=this.volume,this.volume=0):this.muted&&(this.volume=this.mutedVolume)},enumerable:!1,configurable:!0}),t.prototype.setStateKv=function(e,t,o){this.dataset.writeState(e,t,o)},t.prototype.setCommonKv=function(e,t,o){var i=this;"string"==typeof e?this.dataset.writeCommon(e,t,o):Object.keys(e).forEach((function(o){return i.dataset.writeCommon(o,e[o],t)}))},t.prototype.prepareUsageData=function(){return __assign$2(__assign$2({},e.prototype.prepareUsageData.call(this)),{from:"1",channel:CHANNEL})},Object.defineProperty(t.prototype,"videoReqParam",{get:function(){var e;return null===(e=this.loadParam)||void 0===e?void 0:e.videoReqInfoParam},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCollected",{get:function(){return FlowPlayer._isCollected},set:function(e){FlowPlayer._isCollected=e},enumerable:!1,configurable:!0}),t.prototype.getParamWithStartTime=function(e,t){var o;void 0===t&&(t={});var i=this.playtimeLimiter;if(!e)return t;if(null===(o=t.videoLoadParam)||void 0===o?void 0:o.startTime)return t;if("string"==typeof e||"number"==typeof e)i.clearAllConfig(e);else{if(Array.isArray(e))return t;i.clearAllConfig(e.url)}return t.playTimeLimit&&i.addLimitConfig(t.playTimeLimit),__assign$2(__assign$2({},t),{videoLoadParam:__assign$2(__assign$2({},t.videoLoadParam),{startTime:this.timeRange.startTime})})},t.prototype.createClickMask=function(){var e=this,t=this.config,o=t.enableInteractMod,i=void 0===o||o,r=t.type;if(i&&r!==exports.PLAY_MODE.LIVE){var n=document.createElement("div");n.classList.add("thumbplayer-user-mod"),domTool.css(n,{width:"100%",height:"100%",position:"absolute","z-index":1}),domTool.append(this.container,n),n.addEventListener("click",(function(){[exports.VIDEO_STATE.PAUSE,exports.VIDEO_STATE.CANPLAY].includes(e.state)?e.play():[exports.VIDEO_STATE.PLAYING,exports.VIDEO_STATE.BUFFERING].includes(e.state)&&e.pause(exports.H5_PAUSE_TYPE.USER_CLICK)})),this.interactMod=n}},t.prototype.initContainerStyle=function(){var e=this.container;e.style.outline="0 none",e.style.overflow="hidden",e.style.backgroundColor="#000","static"===getComputedStyle(e).position&&(e.style.position="relative")},t.prototype.forwardPluginEvents=function(){var e=this;this[DataSet.pluginName].on(exports.DATA_EVENTS.STATE_UPDATE,(function(t){var o=t.data;e.pluginMsg.emit(exports.PLAY_EVENT_EXT.DATASET_STATE_UPDATE,o)})),this[DataSet.pluginName].on(exports.DATA_EVENTS.UPDATE,(function(t){var o=t.data;e.pluginMsg.emit(exports.PLAY_EVENT_EXT.DATASET_UPDATE,o)})),this.on(exports.PLAY_EVENT.SET_LOADING,(function(t){var o=t.data;e.pluginMsg.emit(exports.PLAY_EVENT_EXT.SET_LOADING,{value:o.show})}))},t.prototype.createInnerPlugins=function(){var e;this.createPlugin(DataSet.pluginName),OfflineLogPlugin.isEnvSupport&&!(null===(e=this.config.offlineConfig)||void 0===e?void 0:e.disable)&&this.createPlugin(OfflineLogPlugin.pluginName),this.createPlugin(PlaytimeLimiterPlugin.pluginName),this.createPlugin(ErrorReportPlugin.pluginName),this.createPlugin(this.config.type===exports.PLAY_MODE.LIVE?LiveQaReporterPlugin.pluginName:VodQaReporterPlugin.pluginName)},t.prototype.cacheLoadParam=function(e,t){e&&(isVideoId(e)&&(this.setCommonKv(COMMON_DATA_KEY.vid,e),this.pluginMsg.emit(exports.PLAY_EVENT_EXT.VID_CHANGE,{oldVal:this.vid,newVal:e})),this.currentPlayItem=e,t&&Object.keys(t).length&&(this.loadParam=t))},t.prototype.setupEventFlagData=function(){var e=this;this.on(exports.H5_PLAY_EVENT.AD_PLAYING,(function(){return e.isPlayingAd=!0})),this.on(exports.H5_PLAY_EVENT.AD_END,(function(){return e.isPlayingAd=!1}))},t.prototype.setupLoopPlay=function(){var e=this;this.on(exports.H5_PLAY_EVENT.PLAY_SESSION_END,(function(t){var o=t.data.endState===exports.END_STATE.NORMAL;e.config.loop&&o&&e.replay()})),this.on(exports.H5_PLAY_EVENT.VIDEO_PLAYING,(function(t){if(t.data.isFirst&&e.config.loop){var o=e.currentVideoElement;if(o instanceof HTMLVideoElement){o.loop=isUrlConfig(e.currentPlayItem)&&"mp4"===urlTool.getFileExtension(e.playUrl)}}}))},Object.defineProperty(t.prototype,"playUrl",{get:function(){var e=this.currentPlayItem;if(!isVideoId(e)&&!Array.isArray(e))return null==e?void 0:e.url},enumerable:!1,configurable:!0}),t.prototype.checkAutoPlayInMute=function(){var e=this;if(this.config.autoPlayInMute||this.config.autoPlayPolicy===exports.AUTO_PLAY_POLICY.IN_MUTED){var t=function(){var t;e.hasMutePlayed||(e.hasMutePlayed=!0,e.muted=!0,null===(t=getAdPlugin(e.config.instanceId))||void 0===t||t.setAdVolume(0),e.play())};this.on(exports.H5_PLAY_EVENT.AD_AUTOPLAY_BLOCKED,(function(){return setTimeout(t)})),this.on(exports.H5_PLAY_EVENT.VIDEO_AUTOPLAY_BLOCKED,t)}},t.prototype.autoHideMouse=function(){var e=this;this.container.addEventListener("mousemove",(function(){"none"===e.container.style.cursor&&(e.container.style.cursor="auto"),clearTimeout(e.mouseMoveTimer),e.mouseMoveTimer=setTimeout(e.hideMouseOnFullscreen.bind(e),5e3)}))},t.prototype.hideMouseOnFullscreen=function(){var e=document,t=e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement;(this.config.autoHideMouse||t)&&this.state===exports.VIDEO_STATE.PLAYING&&(this.container.style.cursor="none")},t.prototype.setVideoStyle=function(e){domTool.css(this.corePlayer.currentVideoElement,e)},t.prototype.setAdVideoStyle=function(e){var t,o,i,r=null===(i=null===(o=getAdPlugin(null===(t=this.config)||void 0===t?void 0:t.instanceId))||void 0===o?void 0:o.videoAdPlayer)||void 0===i?void 0:i.videoElements;r&&r.forEach((function(t){return domTool.css(t,e)}))},t.prototype.applyStyleOnVideoNodeChange=function(){var e=this,t=function(){if(void 0!==e.pictureDirection||void 0!==e.rotateDegree)return rotateTransformValue[e.pictureDirection]||"rotate("+e.rotateDegree+"deg)"};this.corePlayer.on(exports.PLAY_EVENT.VIDEONODE_CHANGE,(function(){var o=t();o&&e.setVideoStyle({transform:o})})),this.on(exports.H5_PLAY_EVENT.AD_REQ_ASSETS_START,(function(o){if(isPreOrPostAd(o.data)){var i=t();i&&e.setAdVideoStyle({transform:i})}})),this.on(exports.H5_PLAY_EVENT.AD_END,(function(o){isPreOrPostAd(o.data)&&(t()&&e.setAdVideoStyle({transform:"none"}))}))},t.prototype.initPluginApis=function(){var e=this;this.playerApiProxy.replayInCurFlowNode=function(t,o){var i;return e.log("replayInCurFlowNode(), vid="+t+", param="+jsonTool.safelyStringify(o)),null===(i=e.flowManager.currentFlowNode)||void 0===i?void 0:i.replay(t,o)}},t.registerKernel=KernelFactory$1.registerKernel,t.KernelFactory=KernelFactory$1,__decorate$1([logMethodCall$1,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[Object,Object]),__metadata$1("design:returntype",void 0)],t.prototype,"load",null),__decorate$1([logMethodCall$1,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[Object,Object]),__metadata$1("design:returntype",void 0)],t.prototype,"play",null),__decorate$1([logMethodCall$1,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[]),__metadata$1("design:returntype",void 0)],t.prototype,"replay",null),__decorate$1([logMethodCall$1,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[String]),__metadata$1("design:returntype",void 0)],t.prototype,"pause",null),__decorate$1([logMethodCall$1,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[Number]),__metadata$1("design:returntype",void 0)],t.prototype,"seek",null),__decorate$1([logMethodCall$1,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[String]),__metadata$1("design:returntype",void 0)],t.prototype,"stop",null),__decorate$1([logMethodCall$1,__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[Object]),__metadata$1("design:returntype",void 0)],t.prototype,"setLevel",null),t}(FlowPlayer);function createH5Player(e){return new H5Player(e)}H5Player.registerPlugin(DataSet.pluginName,DataSet),H5Player.registerPlugin(PlaytimeLimiterPlugin.pluginName,PlaytimeLimiterPlugin),H5Player.registerPlugin(ErrorReportPlugin.pluginName,ErrorReportPlugin),H5Player.registerPlugin(OfflineLogPlugin.pluginName,OfflineLogPlugin),H5Player.registerPlugin(VodQaReporterPlugin.pluginName,VodQaReporterPlugin),H5Player.registerPlugin(LiveQaReporterPlugin.pluginName,LiveQaReporterPlugin);var BUILD_TIME$1=1655287218520,VERSION$2="1.4.94",ThumbPlayerH5=Object.freeze({__proto__:null,createH5Player:createH5Player,EvtEmitter:s$1,PLAY_EVENT:exports.PLAY_EVENT,VIDEO_STATE:exports.VIDEO_STATE,H5Player:H5Player,KERNEL_NAME:exports.KERNEL_NAME,PLAY_MODE:exports.PLAY_MODE,END_STATE:exports.END_STATE,PRELOAD_TYPE:exports.PRELOAD_TYPE,BUILD_TIME:BUILD_TIME$1,VERSION:VERSION$2,BaseReporter:BaseReporter,get ErrorCode(){return exports.ErrorCode},get ErrorMsg(){return exports.ErrorMsg},getAdPlugin:getAdPlugin,adEvents:adEvents,BaseFlowNode:BaseFlowNode,get FLOW_NODE_EVENT(){return exports.FLOW_NODE_EVENT},BeaconRequest:BeaconRequest,ImageRequest:report,definePlugins:definePlugins,autobind:autobind,logApiInvoke:logApiInvoke,once:once,get H5_EXT_EVENT(){return exports.PLAY_EVENT_EXT},get H5_PLAY_EVENT(){return exports.H5_PLAY_EVENT},Plugin:Plugin,isFunctionPlugin:isFunctionPlugin,createPluginFactory:createPluginFactory,getHookMethodName:getHookMethodName,registerPlugin:registerPlugin,deregisterPlugin:deregisterPlugin,getPlugin:getPlugin,getPlugins:getPlugins,pluginExists:pluginExists,AdPluginName:AdPluginName,get AD_TYPE(){return exports.AD_TYPE},isPreOrPostAd:isPreOrPostAd,VideoReqInfoPluginName:VideoReqInfoPluginName,isVideoId:isVideoId,DRM_TYPE:DRM_TYPE,DRM_VALUE:DRM_VALUE,OFFICIAL_PLUGIN:OFFICIAL_PLUGIN,PLUGIN_MAP:PLUGIN_MAP,get H5_PAUSE_TYPE(){return exports.H5_PAUSE_TYPE},get AUTO_PLAY_POLICY(){return exports.AUTO_PLAY_POLICY},get PictureDirection(){return exports.PictureDirection},get DATA_EVENTS(){return exports.DATA_EVENTS},get DATA_STATE(){return exports.DATA_STATE},get LOG_TYPE(){return exports.LOG_TYPE},get BUFFER_REASON(){return exports.BUFFER_REASON},get LOCAL_KEY(){return exports.LOCAL_KEY},get PersistedUserSettings(){return exports.PersistedUserSettings},DEFAULT_KEY:DEFAULT_KEY,COMMON_DATA_KEY:COMMON_DATA_KEY});window.ThumbPlayerH5=ThumbPlayerH5;var ThumbPlayerH5$1=Object.freeze({__proto__:null,get AD_TYPE(){return exports.AD_TYPE},get AUTO_PLAY_POLICY(){return exports.AUTO_PLAY_POLICY},AdPluginName:AdPluginName,get BUFFER_REASON(){return exports.BUFFER_REASON},BUILD_TIME:BUILD_TIME$1,BaseFlowNode:BaseFlowNode,BaseReporter:BaseReporter,BeaconRequest:BeaconRequest,COMMON_DATA_KEY:COMMON_DATA_KEY,get DATA_EVENTS(){return exports.DATA_EVENTS},get DATA_STATE(){return exports.DATA_STATE},DEFAULT_KEY:DEFAULT_KEY,DRM_TYPE:DRM_TYPE,DRM_VALUE:DRM_VALUE,get ErrorCode(){return exports.ErrorCode},get ErrorMsg(){return exports.ErrorMsg},get FLOW_NODE_EVENT(){return exports.FLOW_NODE_EVENT},H5Player:H5Player,get H5_EXT_EVENT(){return exports.PLAY_EVENT_EXT},get H5_PAUSE_TYPE(){return exports.H5_PAUSE_TYPE},get H5_PLAY_EVENT(){return exports.H5_PLAY_EVENT},ImageRequest:report,get LOCAL_KEY(){return exports.LOCAL_KEY},get LOG_TYPE(){return exports.LOG_TYPE},OFFICIAL_PLUGIN:OFFICIAL_PLUGIN,PLUGIN_MAP:PLUGIN_MAP,get PersistedUserSettings(){return exports.PersistedUserSettings},get PictureDirection(){return exports.PictureDirection},Plugin:Plugin,VERSION:VERSION$2,VideoReqInfoPluginName:VideoReqInfoPluginName,adEvents:adEvents,autobind:autobind,createH5Player:createH5Player,createPluginFactory:createPluginFactory,definePlugins:definePlugins,deregisterPlugin:deregisterPlugin,getAdPlugin:getAdPlugin,getHookMethodName:getHookMethodName,getPlugin:getPlugin,getPlugins:getPlugins,isFunctionPlugin:isFunctionPlugin,isPreOrPostAd:isPreOrPostAd,isVideoId:isVideoId,logApiInvoke:logApiInvoke,once:once,pluginExists:pluginExists,registerPlugin:registerPlugin,get END_STATE(){return exports.END_STATE},EvtEmitter:s$1,get KERNEL_NAME(){return exports.KERNEL_NAME},get PLAY_EVENT(){return exports.PLAY_EVENT},get PLAY_MODE(){return exports.PLAY_MODE},get PRELOAD_TYPE(){return exports.PRELOAD_TYPE},get VIDEO_STATE(){return exports.VIDEO_STATE}}),extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var __assign$1=function(){return __assign$1=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign$1.apply(this,arguments)};function __decorate(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,o,i){return new(o||(o=Promise))((function(r,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function s(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))}function __generator(e,t){var o,i,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}function __spreadArray(e,t,o){if(o||2===arguments.length)for(var i,r=0,n=t.length;r<n;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}var isMobile$2=/mobile/i.test(navigator.userAgent),txpHideClass="txp_none";function styleInject$5(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===o&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}var css_248z$6=".txp_video_error{position:absolute;top:0;left:0;width:100%;height:100%;z-index:99;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;background-color:#111;color:#fff}.txp_video_error.txp_none,.txp_video_error .txp_none{display:none!important}.txp_video_error a{color:#fff;text-decoration:none}.txp_video_error .txp_error_title{margin:10px 20px;font-size:18px;line-height:1.6;text-align:center}.txp_video_error .txp_error_title .txp_btn{color:#ff6428;font-size:inherit}.txp_video_error .error-noise-bg{position:absolute;width:100%;height:100%;left:0;top:0;z-index:-1}.txp_video_error .txp_error_code{margin:30px 20px 0;line-height:1.5;color:#666;pointer-events:auto;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.txp_video_error .txp_error_code a{cursor:pointer;color:#666;border-bottom:1px solid}.txp_video_error .txp_error_code a:hover{color:#ff6428}.txp_video_error .txp_error_code::-moz-selection, .txp_video_error .txp_error_code ::-moz-selection{color:#fff;background:#eee}.txp_video_error .txp_error_code::selection,.txp_video_error .txp_error_code ::selection{color:#fff;background:#eee}.txp_video_error .txp_error_code::-moz-selection,.txp_video_error .txp_error_code ::-moz-selection{color:#fff;background:#eee}.txp_video_error .none{display:none}.txp_video_error .txp_link_refresh{color:#fc6526}.txp_video_error .txp_link_btn{display:block;margin-bottom:16px;padding:0 20px;border-radius:15px;background:#26262b;color:#fc6526;font-size:14px;line-height:30px;cursor:pointer}.txp_video_error .txp_link_btn:hover{color:#fff;background-color:#fc6526}.txp_video_error .txp_browser a{text-decoration:underline;cursor:pointer}.txp_video_error .txp_browser a:hover{color:#ff6428}";styleInject$5(css_248z$6);var queue=[],isReq=!1,qqlive=0,getClient=function(e){if(qqlive)e(qqlive);else if(queue.push(e),!isReq){if(isReq=!0,"qq.com"!=document.domain)throw new Error("document.domain is not qq.com");var t=document.createElement("iframe");t.src="javascript:'<script>window.onload=function(){document.write(\\'<script>document.domain=\\\"qq.com\\\";<\\\\/script>\\');document.close();};<\/script>'",t.style.cssText="display:none;",document.body.appendChild(t),t.getClient=function(e){qqlive=e;for(var t=queue.shift();t;)t&&t(e),t=queue.shift()},t.src="//v.qq.com/iframe/client.html"}},ErrorPagePluginName$1="error-page",ErrorPagePluginEvents$1={REPORT_LOG:"error-page:report-log"},defaultErrorText$1="出错啦",dataRoleMap$1={error:"txp-ui-error",errorMsg:"txp-ui-error-msg",errorHandler:"txp-ui-error-handler",errorRefresh:"txp-ui-error-refresh",errorCode:"txp-ui-error-code",background:"txp-ui-error-background",clientBtn:"txp-ui-error-client-btn",browserTip:"txp-ui-error-browser"},ErrMsg;!function(e){e.DEFAULT="这个视频被外星人劫走，暂时看不了了~",e.LIMITED="很遗憾，对此视频的访问暂时受限",e.SENSITIVE="此视频包含敏感信息，已被管理员捉拿~",e.NO_COPYRIGHT="暂时没有获得该视频版权，努力为您争取中~",e.NO_COPYRIGHT_IN_REGION="很抱歉，由于版权限制，您所在的地区暂时无法播放该视频",e.NO_PLAYBACK_COPYRIGHTS="很抱歉，该视频暂无播放版权",e.NOT_SUPPROT_BROWSER="应版权方要求本片采用加密格式，此浏览器暂不支持播放"}(ErrMsg||(ErrMsg={}));var errorCodeMap={default:ErrMsg.DEFAULT};errorCodeMap[70013051]=errorCodeMap[70013052]=errorCodeMap[70013061]=errorCodeMap[70013062]=errorCodeMap[70013063]=errorCodeMap[70013065]=errorCodeMap[70013066]=errorCodeMap[70013069]=errorCodeMap[70013071]=errorCodeMap[70013073]=errorCodeMap[70013074]=errorCodeMap[70013076]=errorCodeMap[70013077]=errorCodeMap[70013081]=errorCodeMap[70013082]=errorCodeMap[70013086]=errorCodeMap[70013094]=ErrMsg.DEFAULT,errorCodeMap[70013064]=errorCodeMap[70013100]=ErrMsg.LIMITED,errorCodeMap[70013080.3]=errorCodeMap["70013080.10"]=errorCodeMap[70013080.11]=errorCodeMap[70013084]=ErrMsg.SENSITIVE,errorCodeMap[70013080]=errorCodeMap[70013080.7]=errorCodeMap[70013080.9]=errorCodeMap[70013083]=ErrMsg.NO_COPYRIGHT,errorCodeMap[70013080.1]=ErrMsg.NO_COPYRIGHT_IN_REGION,errorCodeMap[70013080.2]=ErrMsg.NO_PLAYBACK_COPYRIGHTS,errorCodeMap[70013069.4]=errorCodeMap[70013080.14]=ErrMsg.NOT_SUPPROT_BROWSER;var shouldShowClientBtnErrs=["70013080.14","70013069.4","70013080.2"];function saveChannel(e){var t="qqlivechannel=channel1."+e;if(uaTool.browser.ie){var o=new Date;o.setTime(o.getTime()+864e5),document.cookie=t+";path=/;expires="+o.toUTCString()}else{var i=document.createElement("input");document.querySelector("body").append(i),i.style.position="absolute",i.style.top="-9999px",i.value=t,i.style.top=document.querySelector("body").scrollTop+"px",i.focus(),i.setSelectionRange(0,t.length),document.queryCommandSupported("copy")&&document.execCommand("copy",!0),i.remove()}}function openClient(e){if(e.support&&e.sso){try{saveChannel(e.atag)}catch(e){}try{getClient((function(t){t&&t.exist().done((function(){t.open(e.sso),e.success()})).fail((function(){e.error()}))}))}catch(e){console.log(e)}}}var qqbrowserHelper={exist:!1,isLatestChromeSupportDrm:function(){var e=uaTool.os;if(e.windows)return parseFloat(e.version)>6;if(e.mac){if(uaTool.browser.qqbrowser)return!1;var t=(e.version||"").split(".");return parseFloat((t[0]||"0")+"."+(t[1]||"0"))>10.1}return!e.linux&&void 0},detect:function(){var e=new SimpleDefer,t=document.createElement("meta");return t.name="referrer",t.content="always",document.head.prepend(t),this.isLatestChromeSupportDrm()?fetch("http://127.0.0.1:28653/api/handle",{method:"POST",body:JSON.stringify({action:"GetQBVersion",cmd:""})}).then((function(e){return e.json()})).then((function(o){t.remove();var i=!1,r=o.result||"";r&&(i=-1!==comTool.compareVersion(r,"10.2.2101.400")),i?(qqbrowserHelper.exist=!0,e.resolve({exist:!0})):(qqbrowserHelper.exist=!1,e.resolve({exist:!1}))})).catch((function(){t.remove(),qqbrowserHelper.exist=!1,e.resolve({exist:!1})})):e.reject(),e},download:function(){try{location.assign("http://dldir1.qq.com/invc/tt/QQBrowser_Setup_DRM.exe")}catch(e){}},open:function(e){if(qqbrowserHelper.exist){var t=document.createElement("meta");t.name="referrer",t.content="always",document.head.prepend(t),fetch("http://127.0.0.1:28653/api/handle",{method:"POST",body:JSON.stringify({action:"Open",cmd:encodeURIComponent(e)})}).then((function(){t.remove()})).catch((function(){t.remove()}))}else this.download()}},defaultNoiseConfig={enable:!isMobile$2,interval:150,performanceRatio:5,size:4,opacity:.1},WHITE_RGB_VALUE=16777215,ErrorPagePlugin=function(e){function t(t,o,i){var r,n=e.call(this,t,o,i)||this;return n.innerElements={},n.clientExistDefer=new SimpleDefer,n.noiseAnimation=function(e,t,o,i,r){var n=Math.floor(o/r),a=e.createImageData(t,n),s=new Uint32Array(a.data.buffer);e.clearRect(0,0,t,o);for(var l=0;l<s.length;l++)s[l]=((255*Math.random()*i|0)<<24)+WHITE_RGB_VALUE;for(l=0;l<r;l++)e.putImageData(a,0,n*l)},n.browserTipClick=function(){qqbrowserHelper.open(location.href)},n.config=__assign$1(__assign$1({},t.config.errorPageConfig),o),n.config.noiseConfig=__assign$1(__assign$1({},defaultNoiseConfig),null===(r=n.config)||void 0===r?void 0:r.noiseConfig),n.insertDOM(),n.setupDOMEvents(),n.setupPlayerEvents(),n}return __extends(t,e),t.prototype.show=function(e){void 0===e&&(e=defaultErrorText$1);var t=this.player.getCommonKv(COMMON_DATA_KEY.flowid);if("string"==typeof e)this.innerElements.errorMsg.innerHTML=e,this.innerElements.errorCode.innerHTML=t||"",this.innerElements.background.classList.add(txpHideClass),this.innerElements.errorRefresh.classList.remove(txpHideClass);else{var o=e.text,i=void 0===o?defaultErrorText$1:o,r=e.code,n=void 0===r?"":r,a=e.img,s=void 0===a?"":a,l=e.hideRefresh,p=void 0!==l&&l;this.innerElements.errorMsg.innerHTML=i,this.innerElements.errorCode.innerHTML=n?String(n)+"-"+t:t,this.innerElements.background.src=s,this.innerElements.background.classList.toggle(txpHideClass,!s),this.innerElements.errorRefresh.classList.toggle(txpHideClass,p)}this.rootEl.classList.remove(txpHideClass),this.setNoise(!0)},t.prototype.hide=function(){this.rootEl.classList.add(txpHideClass),this.setNoise(!1),domTool.addClass(this.innerElements.clientBtn,txpHideClass),domTool.addClass(this.innerElements.browserTip,txpHideClass),domTool.addClass(this.innerElements.errorRefresh,txpHideClass)},t.prototype.destroy=function(){var t;this.setNoise(!1),this.rootEl.parentNode&&this.rootEl.remove(),this.innerElements={},null===(t=this.noiseBg)||void 0===t||t.remove(),this.noiseBg=null,this.rootEl=null,e.prototype.destroy.call(this)},t.prototype.insertDOM=function(){var e=this,t=this.player.container,o=this.config.noiseConfig,i='<div data-role="'+dataRoleMap$1.error+'" class="txp_video_error '+txpHideClass+'">\n      '+(o.enable?'<canvas class="error-noise-bg"></canvas>':"")+'\n      <img data-role="'+dataRoleMap$1.background+'" alt="error-background"/>\n      <div data-role="'+dataRoleMap$1.errorMsg+'" class="txp_error_title"></div>\n      <div data-role="'+dataRoleMap$1.errorHandler+'" class="txp_error_desc">\n        <span data-role="'+dataRoleMap$1.errorRefresh+'">\n          你可以 <a href="javascript:;" class="txp_link_refresh">刷新</a> 试试\n        </span>\n      </div>\n      <a data-role="'+dataRoleMap$1.clientBtn+'" class="txp_link_btn '+txpHideClass+'"></a>\n      <div data-role="'+dataRoleMap$1.browserTip+'" class="txp_browser '+txpHideClass+'"></div>\n      <div class="txp_error_code" data-role="'+dataRoleMap$1.errorCode+'"></div>\n    </div>';t.insertAdjacentHTML("beforeend",i),this.rootEl=t.querySelector('[data-role="'+dataRoleMap$1.error+'"]'),this.noiseBg=this.rootEl.querySelector("canvas"),Object.keys(dataRoleMap$1).forEach((function(o){e.innerElements[o]=t.querySelector('[data-role="'+dataRoleMap$1[o]+'"]')}))},t.prototype.setupDOMEvents=function(){var e=this;this.innerElements.errorRefresh.querySelector(".txp_link_refresh").addEventListener("click",(function(){e.config.useReplay?e.player.replay():location.reload()}));var o=0,i=0;this.innerElements.errorCode.addEventListener("click",(function(){(o+=1)>=5&&(o=0,e.emit(t.Events.REPORT_LOG)),i&&clearTimeout(i),i=window.setTimeout((function(){return o=0}),300)})),this.innerElements.clientBtn.addEventListener("click",(function(){e.clientExistDefer.promise.then((function(t){e.clickClientBtnOnExist(t)})).catch((function(){e.clickClientBtnOnNoExist()}))}))},t.prototype.setupPlayerEvents=function(){var e=this,t=this.player;t.on(exports.H5_PLAY_EVENT.PLAY_SESSION_END,(function(o){var i=o.data;if(e.config.showOnError){var r=i.code;if(r!==exports.ErrorCode.SUC){var n=e.config,a=n.hideRefresh,s=n.img,l=i.message;if(t.config.type===exports.PLAY_MODE.LIVE&&i.data){if("setErrorView"!==i.data.name)return;var p=i.data.params,c=p.msg,d=p.showDownLoadClient,u=p.showDownLoadBrowser,A=p.hideRefresh,_=p.hideCode;c&&(l=c),A?domTool.addClass(e.innerElements.errorRefresh,txpHideClass):domTool.removeClass(e.innerElements.errorRefresh,txpHideClass),_?domTool.addClass(e.innerElements.errorCode,txpHideClass):domTool.removeClass(e.innerElements.errorCode,txpHideClass),d&&e.config.useClientBtn&&(e.checkClientExist(),e.setClientBtn()),u&&e.config.useBrowserTip&&e.setBrowserTip()}else r.startsWith(exports.ErrorCode.GETINFO_SERVER_CODE_PREFIX)&&(l=e.getVodErrMsg(r),shouldShowClientBtnErrs.includes(r)&&(e.config.useClientBtn&&(e.checkClientExist(),e.setClientBtn()),e.config.useBrowserTip&&e.setBrowserTip()));e.show({code:r,text:l,hideRefresh:a,img:s})}}})),t.on(exports.PLAY_EVENT.STATE_CHANGE,(function(t){var o=t.data.new;o!==exports.VIDEO_STATE.PLAYING&&o!==exports.VIDEO_STATE.CANPLAY||e.hide()})),t.on(exports.H5_PLAY_EVENT.PLAY_SESSION_START,(function(){return e.hide()}))},t.prototype.getVodErrMsg=function(e){return errorCodeMap[e]||errorCodeMap.default},t.prototype.setClientBtn=function(){var e=this;domTool.addClass(this.innerElements.errorHandler,txpHideClass);var t=uaTool.os.mac?"Mac客户端观看":"PC客户端观看";uaTool.os.mac?this.innerElements.clientBtn.innerHTML="打开"+t:this.clientExistDefer.promise.then((function(){e.innerElements.clientBtn.innerHTML="打开"+t})).catch((function(){e.innerElements.clientBtn.innerHTML="下载"+t})),domTool.removeClass(this.innerElements.clientBtn,txpHideClass)},t.prototype.setNoise=function(e){var t=this;void 0===e&&(e=!0);var o=this.config.noiseConfig,i=o.enable,r=o.performanceRatio,n=o.opacity;if(i&&this.noiseBg&&(clearInterval(this.noiseTimer),e)){var a=this.noiseBg.getContext("2d");this.resizeNoise();var s=this.noiseBg,l=s.width,p=s.height;if(!l||!p)return;this.noiseAnimation(a,l,p,n,r),this.noiseTimer=setInterval((function(){t.noiseAnimation(a,l,p,n,r)}),o.interval)}},t.prototype.resizeNoise=function(){if(this.noiseBg){var e=this.player.container,t=e.clientWidth,o=e.clientHeight,i=this.config.noiseConfig.size;this.noiseBg.width=t/i,this.noiseBg.height=o/i}},t.prototype.checkClientExist=function(){var e=this;try{getClient((function(t){t?t.exist().done((function(){e.clientExistDefer.resolve(t)})).fail((function(){e.clientExistDefer.reject()})):e.clientExistDefer.reject()}))}catch(e){this.clientExistDefer.reject()}},t.prototype.clickClientBtnOnExist=function(e){if(this.player.config.type===exports.PLAY_MODE.LIVE){var t="qqlive://sso/pid="+(this.player.getCommonKv(COMMON_DATA_KEY.livepid)||"")+"&projectid="+(this.player.vid||"");e.open(t)}else{var o=this.player.vid;openClient({support:!0,atag:"playererror",sso:"qqlive://sso/vbarid="+(this.player.getCommonKv(COMMON_DATA_KEY.cid)||"")+"&videoid="+o+"&start="+Math.max(this.player.playtime-5,0)+"&atag=web.playererror",success:function(){},error:function(){this.openDownLoadLink()}})}},t.prototype.clickClientBtnOnNoExist=function(){this.openDownLoadLink()},t.prototype.openDownLoadLink=function(){window.open("https://v.qq.com/download.html#"+(uaTool.os.mac?"Mac":"Windows"),"_blank")},t.prototype.setBrowserTip=function(){var e=this;if(this.innerElements.browserTip.removeEventListener("click",this.browserTipClick),domTool.removeClass(this.innerElements.browserTip,txpHideClass),uaTool.browser.chrome&&comTool.compareVersion(uaTool.browser.chrome.version,"89")<0)this.innerElements.browserTip.innerHTML="或下载最新 Chrome 浏览器(89内核及以上)观看";else if(uaTool.os.mac)this.innerElements.browserTip.innerHTML="或下载最新 Chrome、Safari 浏览器观看";else{var t=!0;qqbrowserHelper.detect().promise.then((function(o){t=o.exist,e.innerElements.browserTip.innerHTML="或"+(t?"使用":"下载")+'最新<a style="display:inline; margin: 16px 0 0 0;text-decoration: underline;">QQ 浏览器</a>、Chrome 浏览器观看',e.innerElements.browserTip.addEventListener("click",e.browserTipClick)})).catch((function(){domTool.addClass(e.innerElements.browserTip,txpHideClass)}))}},t.Events=ErrorPagePluginEvents$1,t.pluginName=ErrorPagePluginName$1,t}(Plugin);H5Player.registerPlugin(ErrorPagePlugin.pluginName,ErrorPagePlugin);var FUNC_ERROR_TEXT="Expected a function",NAN=NaN,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce(e,t,o){var i,r,n,a,s,l,p=0,c=!1,d=!1,u=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function A(t){var o=i,n=r;return i=r=void 0,p=t,a=e.apply(n,o)}function _(e){return p=e,s=setTimeout(E,t),c?A(e):a}function g(e){var o=e-l;return void 0===l||o>=t||o<0||d&&e-p>=n}function E(){var e=now();if(g(e))return f(e);s=setTimeout(E,function(e){var o=t-(e-l);return d?nativeMin(o,n-(e-p)):o}(e))}function f(e){return s=void 0,u&&i?A(e):(i=r=void 0,a)}function h(){var e=now(),o=g(e);if(i=arguments,r=this,l=e,o){if(void 0===s)return _(l);if(d)return s=setTimeout(E,t),A(l)}return void 0===s&&(s=setTimeout(E,t)),a}return t=toNumber(t)||0,isObject(o)&&(c=!!o.leading,n=(d="maxWait"in o)?nativeMax(toNumber(o.maxWait)||0,t):n,u="trailing"in o?!!o.trailing:u),h.cancel=function(){void 0!==s&&clearTimeout(s),p=0,i=l=r=s=void 0},h.flush=function(){return void 0===s?a:f(now())},h}function throttle(e,t,o){var i=!0,r=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return isObject(o)&&(i="leading"in o?!!o.leading:i,r="trailing"in o?!!o.trailing:r),debounce(e,t,{leading:i,maxWait:t,trailing:r})}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var o=reIsBinary.test(e);return o||reIsOctal.test(e)?freeParseInt(e.slice(2),o?2:8):reIsBadHex.test(e)?NAN:+e}var lodash_throttle=throttle,css_248z$1$1='.plugin_ctrl_txp_shadow{position:absolute;z-index:2;left:0;top:0;width:100%;height:100%}.plugin_ctrl_txp_shadow.txp_none{display:none}.plugin_ctrl_airplay_btn{-webkit-transform:scale(.9);transform:scale(.9)}.plugin_ctrl_center_btn{position:absolute;left:0;top:0;width:100%;height:100%;z-index:5;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;pointer-events:none}.plugin_ctrl_center_btn.txp_none{display:none}.plugin_ctrl_center_btn .txp_none{display:none!important}.plugin_ctrl_center_btn .btn_play{width:68px;height:68px;pointer-events:auto;cursor:pointer}.plugin_ctrl_center_btn .btn_play .icon_play{width:100%;height:100%}.plugin_ctrl_center_btn .btn_replay{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:0 22px;line-height:40px;border-radius:99em;color:#fff;font-size:14px;background-color:rgba(59,59,59,.95);pointer-events:auto;cursor:pointer}.plugin_ctrl_center_btn .btn_replay .icon_replay{margin-right:4px;width:15px;height:15px;fill:#fff}.plugin_ctrl_txp_gradient_bottom{position:absolute;z-index:3;left:0;bottom:0;width:100%;height:60px;background-image:-webkit-gradient(linear,left bottom, left top,color-stop(0, rgba(3,0,0,.3)),to(transparent));background-image:linear-gradient(0deg,rgba(3,0,0,.3) 0,transparent);opacity:1;-webkit-transition:opacity .15s ease-out;transition:opacity .15s ease-out;pointer-events:none}.plugin_ctrl_txp_gradient_bottom.txp_none{display:none}.plugin_ctrl_txp_mode_fullscreen{position:fixed!important;z-index:999999;width:100%!important;height:100%!important;padding-bottom:0!important;top:0;right:0;bottom:0;left:0}.plugin_ctrl_fake_fullscreen{overflow:hidden}._mod_thumbplayer_container_:-webkit-full-screen{width:100%!important;height:100%!important}@-webkit-keyframes txp_icon_scale{0%{-webkit-transform:scale(1);transform:scale(1);-webkit-transform-origin:center center;transform-origin:center center}50%{-webkit-transform:scale(1.2);transform:scale(1.2);-webkit-transform-origin:center center;transform-origin:center center}to{-webkit-transform:scale(1);transform:scale(1);-webkit-transform-origin:center center;transform-origin:center center}}@keyframes txp_icon_scale{0%{-webkit-transform:scale(1);transform:scale(1);-webkit-transform-origin:center center;transform-origin:center center}50%{-webkit-transform:scale(1.2);transform:scale(1.2);-webkit-transform-origin:center center;transform-origin:center center}to{-webkit-transform:scale(1);transform:scale(1);-webkit-transform-origin:center center;transform-origin:center center}}.plugin_ctrl_txp_bottom{position:absolute;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:6;bottom:0;left:0;width:100%;height:48px;line-height:1;max-width:100%;max-height:100%;overflow:initial;text-indent:0;text-align:left;white-space:normal;word-break:break-all;color:#fff;font-size:14px;font-family:PingFangSC-Regular,Helvetica Neue,Helvetica,Roboto,Microsoft Yahei,Arial,sans-serif;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-touch-callout:none}.plugin_ctrl_txp_bottom.txp_none{display:none}.plugin_ctrl_txp_bottom .txp_btn{position:relative;cursor:pointer;background:none;border:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-family:inherit}.plugin_ctrl_txp_bottom .txp_btn:hover .txp_icon{fill:#ff6022;cursor:pointer}.plugin_ctrl_txp_bottom .txp_icon_fake,.plugin_ctrl_txp_bottom .txp_icon_fullscreen,.plugin_ctrl_txp_bottom .txp_icon_pip,.plugin_ctrl_txp_bottom .txp_icon_volume,.plugin_ctrl_txp_bottom .txp_icon_volume_mute{stroke:#fff}.plugin_ctrl_txp_bottom .txp_btn:hover .txp_icon_fake,.plugin_ctrl_txp_bottom .txp_btn:hover .txp_icon_fullscreen,.plugin_ctrl_txp_bottom .txp_btn:hover .txp_icon_pip,.plugin_ctrl_txp_bottom .txp_btn:hover .txp_icon_volume,.plugin_ctrl_txp_bottom .txp_btn_fake[data-status=true] .txp_icon_fake{stroke:#ff6022}.plugin_ctrl_txp_bottom .txp_btn_pip[data-status=true] .txp_icon_pip{stroke:#ff6022;fill:#ff6022}.plugin_ctrl_txp_bottom .txp_controls{display:-webkit-box;display:-ms-flexbox;display:flex;position:absolute;bottom:0;left:0;width:100%;height:100%}.plugin_ctrl_txp_bottom *,.plugin_ctrl_txp_bottom :after,.plugin_ctrl_txp_bottom :before{margin:0;padding:0;-webkit-box-sizing:border-box;box-sizing:border-box;text-indent:0}.plugin_ctrl_txp_bottom a,.plugin_ctrl_txp_bottom a:hover,.plugin_ctrl_txp_bottom a:visited{color:#fff;text-decoration:none!important}.plugin_ctrl_txp_bottom :focus,.plugin_ctrl_txp_bottom a:active{outline:0 none}.plugin_ctrl_txp_bottom .txp_left_controls,.plugin_ctrl_txp_bottom .txp_right_controls{position:relative;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.plugin_ctrl_txp_bottom .txp_controls .txp_btn{height:100%;text-align:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.plugin_ctrl_txp_bottom .txp_left_controls .txp_btn{margin-right:16px;text-align:center;-webkit-box-flex:0;-ms-flex:none;flex:none}.plugin_ctrl_txp_bottom .txp_left_controls .txp_btn:first-child{margin-left:16px}.plugin_ctrl_txp_bottom .txp_center_controls{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto}.plugin_ctrl_txp_bottom .txp_right_controls{z-index:8}.plugin_ctrl_txp_bottom .txp_right_controls .txp_btn{margin-right:16px}.plugin_ctrl_txp_bottom .txp_right_controls .txp_btn_definition,.plugin_ctrl_txp_bottom .txp_right_controls .txp_btn_language,.plugin_ctrl_txp_bottom .txp_right_controls .txp_btn_playrate{margin-right:24px}.plugin_ctrl_txp_bottom .txp_left_controls .txp_icon{display:block;margin:auto}.plugin_ctrl_txp_bottom .txp_left_controls .txp_icon_next{pointer-events:none}.plugin_ctrl_txp_bottom .txp_right_controls .txp_icon{display:block}.plugin_ctrl_txp_bottom .txp_controls .txp_tooltip{position:absolute;z-index:14;height:26px;border-radius:16px;font-size:12px;display:none;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;top:-30px;padding:4px 12px;white-space:nowrap;background-color:rgba(0,0,0,.8);left:50%;-webkit-transform:translate(-50%);transform:translate(-50%)}.plugin_ctrl_txp_bottom .txp_controls .txp_btn_fake .txp_tooltip{left:-15px;-webkit-transform:translate(0);transform:translate(0)}.plugin_ctrl_txp_bottom .txp_controls .txp_btn_play .txp_tooltip{left:-6px;-webkit-transform:translate(0);transform:translate(0)}.plugin_ctrl_txp_bottom .txp_controls .txp_btn_next .txp_tooltip{left:-11px;-webkit-transform:translate(0);transform:translate(0)}.plugin_ctrl_txp_bottom .txp_controls .txp_btn_fullscreen .txp_tooltip{left:auto;right:-10px;-webkit-transform:translate(0);transform:translate(0)}.plugin_ctrl_txp_bottom .txp_btn_setting:hover .txp_icon_setting{-webkit-animation:txp_icon_rotate .3s ease both;animation:txp_icon_rotate .3s ease both}.plugin_ctrl_txp_bottom .txp_air_play:hover .txp_icon,.plugin_ctrl_txp_bottom .txp_btn_fake:hover .txp_icon,.plugin_ctrl_txp_bottom .txp_btn_fullscreen:hover .txp_icon,.plugin_ctrl_txp_bottom .txp_btn_pip:hover .txp_icon{-webkit-animation:txp_icon_scale .4s ease both;animation:txp_icon_scale .4s ease both}.plugin_ctrl_txp_bottom .txp_time_display{height:100%;margin-left:8px;white-space:nowrap;font-size:0;-webkit-box-flex:0;-ms-flex:none;flex:none;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_txp_bottom .txp_time_display.reach_hour{margin-left:-8px}.plugin_ctrl_txp_bottom .txp_time_display.reach_hour .txp_time_current,.plugin_ctrl_txp_bottom .txp_time_display.reach_hour .txp_time_duration{width:50px}.plugin_ctrl_txp_bottom .txp_time_display.reach_hour .txp_time_current{text-align:right}.plugin_ctrl_txp_bottom .txp_time_display.reach_hour .txp_time_duration{text-align:left}.plugin_ctrl_txp_bottom .txp_time_display>div{display:inline;font-size:12px}.plugin_ctrl_txp_bottom .txp_time_display .txp_time_separator{margin:0 3px;color:hsla(0,0%,100%,.5)}.plugin_ctrl_txp_bottom .txp_time_display .txp_time_current,.plugin_ctrl_txp_bottom .txp_time_display .txp_time_duration{width:32px;text-align:center}.plugin_ctrl_txp_bottom .txp_time_display .txp_time_duration{color:hsla(0,0%,100%,.5)}.plugin_ctrl_txp_bottom .txp_time_display .txp_live_badge{position:relative;font-size:12px;display:inline;margin-top:-1px;line-height:40px;padding-left:10px;cursor:default}.plugin_ctrl_txp_bottom .txp_time_display .txp_live_badge:before{content:"";position:absolute;left:0;top:17px;display:inline-block;width:6px;height:6px;border-radius:100%;background-color:#ff7000}.plugin_ctrl_txp_bottom .txp_time_display .txp_live_badge_back:before{background-color:#bbb}.plugin_ctrl_txp_bottom .txp_time_display_live{margin-left:0}.plugin_ctrl_txp_bottom .txp_progress_bar_container{position:absolute;z-index:4;left:0;top:-8px;width:100%;height:8px;padding:0;vertical-align:top;cursor:pointer}.plugin_ctrl_txp_bottom .txp_progress_bar_container:after{content:"";display:block;width:100%;height:12px;position:absolute;bottom:-2px;z-index:-1}.plugin_ctrl_txp_bottom .txp_progress_bar_container:hover{z-index:9;cursor:pointer}.plugin_ctrl_txp_bottom .txp_progress_list{position:absolute;left:0;top:0;height:8px;width:100%}.plugin_ctrl_txp_bottom .txp_progress_list:after{content:"";position:absolute;left:0;top:0;width:100%;height:100%;background-color:hsla(0,0%,100%,.35);-webkit-transform:scaleY(.5);transform:scaleY(.5);-webkit-transition:all .15s ease;transition:all .15s ease;z-index:-1}.plugin_ctrl_txp_bottom .txp_progress_load,.plugin_ctrl_txp_bottom .txp_progress_play{position:absolute;left:0;top:0;height:100%;width:2px;background-color:#ff6429;-webkit-transform:scaleY(.5);transform:scaleY(.5);-webkit-transition:all .15s ease;transition:all .15s ease}.plugin_ctrl_txp_bottom .txp_progress_bar_container:hover .txp_progress_hover,.plugin_ctrl_txp_bottom .txp_progress_bar_container:hover .txp_progress_list:after,.plugin_ctrl_txp_bottom .txp_progress_bar_container:hover .txp_progress_load,.plugin_ctrl_txp_bottom .txp_progress_bar_container:hover .txp_progress_play,.plugin_ctrl_txp_bottom .txp_progress_bar_container:hover .txp_progress_role{-webkit-transform:scaleY(1);transform:scaleY(1)}.plugin_ctrl_txp_bottom .txp_progress_load{background-color:hsla(0,0%,100%,.5)}.plugin_ctrl_txp_bottom .txp_progress_hover{position:absolute;width:10px;height:100%;bottom:0;background-color:#fff;border-radius:100%;background-clip:padding-box;opacity:0;-webkit-transform:scaleY(.5);transform:scaleY(.5);-webkit-transition:all .15s ease;transition:all .15s ease}.plugin_ctrl_txp_bottom .txp_progress_role{position:absolute;left:0;top:0;height:100%;width:2px;background-color:rgba(178,250,77,.5);-webkit-transform:scaleY(.5);transform:scaleY(.5);-webkit-transition:all .15s ease;transition:all .15s ease}.plugin_ctrl_txp_bottom .txp_btn_scrubber{position:absolute;width:12px;height:12px;top:-2px;margin-left:-6px;cursor:pointer;-webkit-transform:scale(0);transform:scale(0);-webkit-transition:all .15s ease;transition:all .15s ease}.plugin_ctrl_txp_bottom .txp_scrubber_indicator{position:relative;width:12px;height:12px;border-radius:100%;background-color:#ff6429}.plugin_ctrl_txp_bottom .txp_scrubber_indicator:before{content:"";position:absolute;left:-4px;top:-4px;width:20px;height:20px;border-radius:100%;display:block;background-color:rgba(254,100,41,.3)}.plugin_ctrl_txp_bottom .txp_progress_bar_container:hover .txp_btn_scrubber{-webkit-transform:scale(1);transform:scale(1)}.plugin_ctrl_txp_bottom .txp_btn_scrubber:hover .txp_scrubber_indicator:before{width:24px;height:24px;left:-6px;top:-6px}.plugin_ctrl_txp_bottom .txp_btn_play .txp_svg_symbol{visibility:hidden;opacity:0}.plugin_ctrl_txp_bottom .txp_btn_play[data-status=pause] .txp_svg_pause,.plugin_ctrl_txp_bottom .txp_btn_play[data-status=play] .txp_svg_play,.plugin_ctrl_txp_bottom .txp_btn_play[data-status=replay] .txp_svg_replay,.plugin_ctrl_txp_bottom .txp_btn_play[data-status=stop] .txp_svg_stop{visibility:visible;opacity:1;-webkit-animation:none;animation:none}.plugin_ctrl_txp_bottom .txp_popup{position:absolute;bottom:34px;z-index:20;width:100%;padding-bottom:24px;color:#eee;cursor:default}.plugin_ctrl_txp_bottom .txp_popup_content{background-color:rgba(0,0,0,.8);border-radius:4px}.plugin_ctrl_txp_bottom .txp_popup_audio_track,.plugin_ctrl_txp_bottom .txp_popup_definition,.plugin_ctrl_txp_bottom .txp_popup_language,.plugin_ctrl_txp_bottom .txp_popup_playrate{width:auto;left:50%;-webkit-transform:translate(-50%);transform:translate(-50%);font-size:0}.plugin_ctrl_txp_bottom .txp_popup_audio_track .txp_popup_content,.plugin_ctrl_txp_bottom .txp_popup_definition .txp_popup_content,.plugin_ctrl_txp_bottom .txp_popup_language .txp_popup_content,.plugin_ctrl_txp_bottom .txp_popup_playrate .txp_popup_content{padding-top:10px}.plugin_ctrl_txp_bottom .txp_popup_audio_track .txp_menuitem,.plugin_ctrl_txp_bottom .txp_popup_definition .txp_menuitem,.plugin_ctrl_txp_bottom .txp_popup_language .txp_menuitem,.plugin_ctrl_txp_bottom .txp_popup_playrate .txp_menuitem{min-width:104px;position:relative;padding:10px 22px;font-size:14px;text-align:center;cursor:pointer;white-space:nowrap;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_txp_bottom .txp_popup_audio_track .txp_menuitem:last-of-type,.plugin_ctrl_txp_bottom .txp_popup_definition .txp_menuitem:last-of-type,.plugin_ctrl_txp_bottom .txp_popup_language .txp_menuitem:last-of-type,.plugin_ctrl_txp_bottom .txp_popup_playrate .txp_menuitem:last-of-type{padding-bottom:20px}.plugin_ctrl_txp_bottom .txp_popup_audio_track .txp_menuitem:active,.plugin_ctrl_txp_bottom .txp_popup_audio_track .txp_menuitem:hover,.plugin_ctrl_txp_bottom .txp_popup_definition .txp_menuitem:active,.plugin_ctrl_txp_bottom .txp_popup_definition .txp_menuitem:hover,.plugin_ctrl_txp_bottom .txp_popup_language .txp_menuitem:active,.plugin_ctrl_txp_bottom .txp_popup_language .txp_menuitem:hover,.plugin_ctrl_txp_bottom .txp_popup_playrate .txp_menuitem:active,.plugin_ctrl_txp_bottom .txp_popup_playrate .txp_menuitem:hover{color:#ff6429}.plugin_ctrl_txp_bottom .txp_btn .txp_label{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;padding:1px 4px;cursor:pointer;color:#ececec;white-space:nowrap;border:2px solid #fff;border-radius:4px;font-weight:700}.plugin_ctrl_txp_bottom .txp_btn .txp_label:hover{color:#ff6022;border-color:#ff6022}.plugin_ctrl_txp_bottom .txp_btn_definition{position:relative;height:100%;white-space:nowrap;text-align:center;-webkit-box-flex:0;-ms-flex:none;flex:none}.plugin_ctrl_txp_bottom .txp_volume{position:relative;display:table-cell;width:44px;height:45px;vertical-align:top;color:#fff}.plugin_ctrl_txp_bottom .txp_volume_text{padding-top:8px}.plugin_ctrl_txp_bottom .txp_btn_volume .txp_svg_symbol{display:none}.plugin_ctrl_txp_bottom .txp_btn_volume[data-status=mute] .txp_svg_volume_mute,.plugin_ctrl_txp_bottom .txp_btn_volume[data-status=normal] .txp_svg_volume{display:block}.plugin_ctrl_txp_bottom .txp_popup_volume{width:42px;-webkit-transform:translate(-50%);transform:translate(-50%);left:50%}.plugin_ctrl_txp_bottom .txp_popup_volume .txp_popup_content{overflow:hidden}.plugin_ctrl_txp_bottom .txp_volume_range{position:relative;margin:10px 19px;width:4px;height:90px;background-color:hsla(0,0%,65.1%,.5);border-radius:2px;cursor:pointer}.plugin_ctrl_txp_bottom .txp_volume_range:after{content:"";display:block;width:42px;height:90px;position:absolute;left:-19px;top:0}.plugin_ctrl_txp_bottom .txp_volume_range_current{position:absolute;left:0;bottom:0;width:100%;height:50%;background-color:#ff6429;border-radius:2px;z-index:1}.plugin_ctrl_txp_bottom .txp_volume_handle{position:absolute;top:-4px;left:-2px;width:8px;height:8px;background-color:#fff;border-radius:100%;cursor:pointer}.plugin_ctrl_txp_bottom .txp_volume_handle:before{content:"";display:block;position:absolute;left:-3px;top:-3px;width:14px;height:14px;opacity:0;-webkit-transform:scale(0);transform:scale(0);background-color:hsla(0,0%,100%,.2);border-radius:7px}.plugin_ctrl_txp_bottom .txp_volume_handle:after{content:"";width:32px;height:32px;display:block;position:absolute;left:-12px;top:-12px;z-index:-1;opacity:.5;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAADAUExURQAAAP+ZAP+RAP9/AP+aAP9/AP+OCP//AP9/AP+qAP+QDf+SDP+TDv+TCv+RCP+ZAP+TC/+TCP+QC/+RCv+SCf+SCv+QCv+RCv+TCf+PD/+PCP+RDP+RCf+RCv+PCf+RB/+RCv+RCf6RCv+ZEf+RC/+RCf+RC/+RC/6RCv+OB/+QC/+RC/+RCv+TC/+QC/+SC/+RC/+RCv+RCv+RCv+RC/6RCv6RCv6RCv6SCv6SCv2QC/+RCv+SCv+RC/+RCv2RCn+uAUwAAABAdFJOUwAFBwYIBAsBAgMNExEYOAoWHit4JUtXYhoQHCg1MT4gRmmHD1SlsbaUIi5BIy1DUltIb2VygY+Jm6KYrHyYuqzDURAFAAAB/klEQVQ4y6WVWZeiMBSEhQZmDAgJO7LIIrivuNv2/P9/NTdRp7VlTmfO1BMP36kKl5ui1XrQD9DPm+hzq1lXqn3TlW3mKCXLApMsU7aBpHaUehMlJvGNsq+mzE6mlKEwGZSVX0yZnSBKBkJFoIGCAiFDEgVm+oUDO4Q0FeMOCGNVQ+hq+kAyDuwCFfuE9ECE+FgNwJSRz5yCNMCmdmiCQnsKqIaURxKCKVeone4onMWRDoriWTgiHbWg5D0cDAXRQGqH2GasJ/N0tUrniR6bNpDIEIW7JQtGGnDjKEmdhQtaOGkSjYHU0Gc4GEoowF17rE+c/tKrs6z2ln1noo/tLg6QdLdsyzTYH5nRxHG9bGOBNpnnOpPIHPk0XG5fQUFSNEzCOHHcem1t8/0+31rr2nWSOCRYU6glBekJVX8609O+t37Pd8PTabjL39deP9VnU7CkL85A0SjghGC4zKx8eDiW5fEwzK1sCZZwygKyGSiISgDJ0Xzhbba7Q/mrqs7lYbfdeIt5BNmBAhNiIByx0zMhuQbD47kaDKrzESxryDZ7dELP4MrNrP2prAYfH4OqvOytzF39H/h9NO/LcI/nZeCXS/PAuT8h91Lc1ow0rRl5XDPuxeW+CtyXi/u68hfAn0pRnitFeakU7pJ6rj0E+lvt8RcpfzX/Q9l/8/v4DS6tX+XyhPN2AAAAAElFTkSuQmCC);background-size:32px 32px;pointer-events:none}.plugin_ctrl_txp_bottom .txp_volume_handle:hover:before{opacity:1;-webkit-transform:scale(1);transform:scale(1)}.plugin_ctrl_txp_bottom .txp_volume_handle:hover:after{opacity:1}.plugin_ctrl_txp_bottom .txp_right_controls .txp_btn_popup{width:24px}.plugin_ctrl_txp_bottom .txp_right_controls .txp_icon_popup{width:20px;height:20px;margin-top:0}.plugin_ctrl_txp_bottom .txp_btn_fake .txp_svg_symbol,.plugin_ctrl_txp_bottom .txp_btn_fullscreen .txp_svg_symbol{display:none}.plugin_ctrl_txp_bottom .txp_btn_fake[data-status=false] .txp_svg_fake,.plugin_ctrl_txp_bottom .txp_btn_fake[data-status=true] .txp_svg_fake_true,.plugin_ctrl_txp_bottom .txp_btn_fullscreen[data-status=false] .txp_svg_fullscreen,.plugin_ctrl_txp_bottom .txp_btn_fullscreen[data-status=true] .txp_svg_fullscreen_true{display:block}.plugin_ctrl_txp_bottom .txp_popup .txp_current{color:#ff6429}.plugin_ctrl_txp_bottom .txp_btn_loop .txp_svg_loop,.plugin_ctrl_txp_bottom .txp_btn_loop .txp_svg_loop_off{display:none}.plugin_ctrl_txp_bottom .txp_btn_loop[data-status=false] .txp_svg_loop_off,.plugin_ctrl_txp_bottom .txp_btn_loop[data-status=true] .txp_svg_loop{display:block}.plugin_ctrl_txp_bottom .txp_controls .txp_btn:hover .txp_tooltip{display:-webkit-box;display:-ms-flexbox;display:flex}.plugin_ctrl_txp_bottom .txp_controls .txp_btn:visited .txp_tooltip{display:none}.plugin_ctrl_txp_bottom .txp_popup:hover{display:block}.plugin_ctrl_txp_bottom .txp_icon{position:relative;width:28px;height:28px;fill:#fff}.plugin_ctrl_txp_bottom .txp_icon:after,.plugin_ctrl_txp_bottom .txp_icon:before,.plugin_ctrl_txp_bottom .txp_icon_inner:after,.plugin_ctrl_txp_bottom .txp_icon_inner:before{content:"";position:absolute;-webkit-box-sizing:content-box;box-sizing:content-box}.plugin_ctrl_txp_bottom .txp_icon_inner{position:absolute;width:100%;height:100%}.plugin_ctrl_txp_bottom .txp_controls .txp_disabled{cursor:default;opacity:.5;pointer-events:none}.plugin_ctrl_txp_bottom .txp_gradient_top{display:none}.plugin_ctrl_txp_bottom .txp_btn_scrubber,.plugin_ctrl_txp_bottom .txp_progress_load,.plugin_ctrl_txp_bottom .txp_progress_play{-webkit-transition:-webkit-transform .15s ease;transition:-webkit-transform .15s ease;transition:transform .15s ease;transition:transform .15s ease, -webkit-transform .15s ease}.plugin_ctrl_txp_bottom .txp_none{display:none!important}.plugin_ctrl_txp_mode_fullscreen .txp_controls .txp_btn_fullscreen .txp_tooltip{left:auto;right:0;-webkit-transform:translate(0);transform:translate(0)}.plugin_ctrl_txp_mode_fullscreen .txp_controls .txp_btn_fake .txp_tooltip{left:-26px;-webkit-transform:translate(0);transform:translate(0)}.plugin_ctrl--large .plugin_ctrl_txp_gradient_bottom{height:100px}.plugin_ctrl--large .plugin_ctrl_txp_bottom{height:88px}.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_popup{bottom:64px}.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_left_controls .txp_btn,.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_right_controls .txp_btn{margin-right:24px}.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_left_controls .txp_btn .txp_label,.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_right_controls .txp_btn .txp_label{height:26px;font-size:16px}.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_left_controls .txp_icon,.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_right_controls .txp_icon{width:40px;height:40px}.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_left_controls .txp_time_display{margin-left:0}.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_left_controls .txp_btn:first-child{margin-left:32px}.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_right_controls .txp_btn_definition,.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_right_controls .txp_btn_language,.plugin_ctrl--large .plugin_ctrl_txp_bottom .txp_right_controls .txp_btn_playrate{margin-right:32px}.txp_interact_dot{position:absolute;top:2px;width:4px;height:4px;margin-left:-2px;border-radius:100%;background-color:#fff;-webkit-transition:all .1s;transition:all .1s}.txp_interact_dot:after{position:absolute;top:-4px;right:-4px;bottom:-4px;left:-4px;content:""}.txp_interact_dot:hover{-webkit-transform:scale(2);transform:scale(2);-webkit-box-shadow:0 0 2px #ffb821;box-shadow:0 0 2px #ffb821}.txp_hotpoint_tip{color:#fff;position:relative;width:200px;bottom:60px;font-size:12px;line-height:24px;height:50px;padding:0 6px;background-color:rgba(0,0,0,.9);display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:2;word-wrap:break-word}.txp_hotpoint_tip .txp_hotpoint_tip_title{color:#bbb}.txp_hotpoint_tip .txp_hotpoint_tip_detail{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}',css_248z$5='.plugin_ctrl_txp_shadow{position:absolute;z-index:2;left:0;top:0;width:100%;height:100%}.plugin_ctrl_txp_shadow.txp_none{display:none}.plugin_ctrl_airplay_btn{-webkit-transform:scale(.9);transform:scale(.9)}.plugin_ctrl_center_btn{position:absolute;left:0;top:0;width:100%;height:100%;z-index:5;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;pointer-events:none}.plugin_ctrl_center_btn.txp_none{display:none}.plugin_ctrl_center_btn .txp_none{display:none!important}.plugin_ctrl_center_btn .btn_play{width:68px;height:68px;pointer-events:auto;cursor:pointer}.plugin_ctrl_center_btn .btn_play .icon_play{width:100%;height:100%}.plugin_ctrl_center_btn .btn_replay{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:0 22px;line-height:40px;border-radius:99em;color:#fff;font-size:14px;background-color:rgba(59,59,59,.95);pointer-events:auto;cursor:pointer}.plugin_ctrl_center_btn .btn_replay .icon_replay{margin-right:4px;width:15px;height:15px;fill:#fff}.plugin_ctrl_txp_gradient_bottom{position:absolute;z-index:3;left:0;bottom:0;width:100%;height:60px;background-image:-webkit-gradient(linear,left bottom, left top,color-stop(0, rgba(3,0,0,.3)),to(transparent));background-image:linear-gradient(0deg,rgba(3,0,0,.3) 0,transparent);opacity:1;-webkit-transition:opacity .15s ease-out;transition:opacity .15s ease-out;pointer-events:none}.plugin_ctrl_txp_gradient_bottom.txp_none{display:none}.plugin_ctrl_txp_mode_fullscreen{position:fixed!important;z-index:999999;width:100%!important;height:100%!important;padding-bottom:0!important;top:0;right:0;bottom:0;left:0}.plugin_ctrl_fake_fullscreen{overflow:hidden}._mod_thumbplayer_container_:-webkit-full-screen{width:100%!important;height:100%!important}.plugin_ctrl_mobile_txp_bottom{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:absolute;z-index:6;bottom:0;left:0;width:100%;height:40px;overflow:initial;line-height:1;max-width:100%;max-height:100%;color:#fff;font-size:14px;font-family:PingFangSC-Regular,Helvetica Neue,Helvetica,Roboto,sans-serif;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-touch-callout:none}.plugin_ctrl_mobile_txp_bottom.txp_none{display:none}.plugin_ctrl_mobile_txp_bottom .txp_disabled{opacity:.5;pointer-events:none}.plugin_ctrl_mobile_txp_bottom *,.plugin_ctrl_mobile_txp_bottom :after,.plugin_ctrl_mobile_txp_bottom :before{margin:0;padding:0;-webkit-box-sizing:border-box;box-sizing:border-box}.plugin_ctrl_mobile_txp_bottom a,.plugin_ctrl_mobile_txp_bottom a:hover,.plugin_ctrl_mobile_txp_bottom a:visited{color:#fff;text-decoration:none!important;pointer-events:auto}.plugin_ctrl_mobile_txp_bottom .txp_btn:active,.plugin_ctrl_mobile_txp_bottom .txp_btn:focus,.plugin_ctrl_mobile_txp_bottom a:focus{outline:0 none}.plugin_ctrl_mobile_txp_bottom .txp_icon{position:relative;display:inline-block;fill:#fff}.plugin_ctrl_mobile_txp_bottom .txp_icon:after,.plugin_ctrl_mobile_txp_bottom .txp_icon:before,.plugin_ctrl_mobile_txp_bottom .txp_icon_inner:after,.plugin_ctrl_mobile_txp_bottom .txp_icon_inner:before{content:"";position:absolute;-webkit-box-sizing:content-box;box-sizing:content-box}.plugin_ctrl_mobile_txp_bottom .txp_icon_inner{position:absolute;width:100%;height:100%}.plugin_ctrl_mobile_txp_bottom .txp_left_controls,.plugin_ctrl_mobile_txp_bottom .txp_right_controls{position:relative;float:left;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_mobile_txp_bottom .txp_btn{position:relative;cursor:pointer;background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-family:PingFangSC-Regular,Helvetica Neue,Helvetica,Roboto,Microsoft Yahei,Arial,sans-serif;border:none;text-align:center;-webkit-box-flex:0;-ms-flex:none;flex:none;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_mobile_txp_bottom .txp_btn_play{width:60px;height:100%}.plugin_ctrl_mobile_txp_bottom .txp_btn_play .txp_icon_play{display:block;width:30px;height:30px;margin:auto;fill:#fff}.plugin_ctrl_mobile_txp_bottom .txp_btn_play use{display:none}.plugin_ctrl_mobile_txp_bottom .txp_btn_play[data-status=pause] .txp_svg_pause,.plugin_ctrl_mobile_txp_bottom .txp_btn_play[data-status=play] .txp_svg_play,.plugin_ctrl_mobile_txp_bottom .txp_btn_play[data-status=replay] .txp_svg_replay,.plugin_ctrl_mobile_txp_bottom .txp_btn_play[data-status=stop] .txp_svg_stop{display:block}.plugin_ctrl_mobile_txp_bottom .txp_time_display{height:100%;padding:4px 8px 0 0;white-space:nowrap;font-size:0;-webkit-box-flex:0;-ms-flex:none;flex:none;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_mobile_txp_bottom .txp_time_display>div{display:inline;font-size:9px}.plugin_ctrl_mobile_txp_bottom .txp_time_display .txp_time_separator{margin:0 1px}.plugin_ctrl_mobile_txp_bottom .txp_btn_fullscreen{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:45px;height:100%;-webkit-box-flex:0;-ms-flex:none;flex:none}.plugin_ctrl_mobile_txp_bottom .txp_icon_fullscreen{display:block;width:30px;height:30px;margin:auto}.plugin_ctrl_mobile_txp_bottom .txp_icon_fullscreen use{display:none}.plugin_ctrl_mobile_txp_bottom .txp_btn_fullscreen[data-status=false] .txp_svg_fullscreen,.plugin_ctrl_mobile_txp_bottom .txp_btn_fullscreen[data-status=true] .txp_svg_fullscreen_true{display:block}.plugin_ctrl_mobile_txp_bottom .txp_unfullscreen .txp_btn_value{background-position:right 0}.plugin_ctrl_mobile_txp_bottom .txp_btn_fullsize{width:45px;height:100%;-webkit-box-flex:0;-ms-flex:none;flex:none;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_mobile_txp_bottom .txp_btn_fullsize[data-status=false] .txp_svg_fullscreen,.plugin_ctrl_mobile_txp_bottom .txp_btn_fullsize[data-status=true] .txp_svg_fullscreen_true{display:block}.plugin_ctrl_mobile_txp_bottom .txp_unfullsize .txp_btn_value{background-position:right 0}.plugin_ctrl_mobile_txp_bottom .txp_progress_bar_container{position:relative;height:100%;padding:0;vertical-align:top;-webkit-box-flex:1;-ms-flex:1;flex:1}.plugin_ctrl_mobile_txp_bottom .txp_progress_list{position:absolute;left:0;top:20px;width:100%;height:2px;background-color:rgba(31,31,31,.9);-webkit-transform:translateZ(0);transform:translateZ(0)}.plugin_ctrl_mobile_txp_bottom .txp_progress_play{position:absolute;left:0;top:0;height:100%;width:2px;background-color:#fd9000}.plugin_ctrl_mobile_txp_bottom .txp_btn_scrubber{position:absolute;width:30px;height:40px;margin-left:-10px}.plugin_ctrl_mobile_txp_bottom .txp_scrubber_indicator{position:absolute;top:16px;left:10px;width:10px;height:10px;border-radius:99em;background-color:#ff7000}.plugin_ctrl_mobile_txp_bottom .txp_scrubber_indicator:before{content:"";position:absolute;left:-4px;top:-4px;width:18px;height:18px;background-color:#ff7000;opacity:.4;border-radius:99em}.plugin_ctrl_mobile_txp_bottom .txp_btn_definition,.plugin_ctrl_mobile_txp_bottom .txp_btn_playrate{position:relative;padding:0 8px;height:44px;color:#fff;white-space:nowrap;text-align:center;-webkit-box-flex:0;-ms-flex:none;flex:none;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_mobile_txp_bottom .txp_btn_definition .txp_label,.plugin_ctrl_mobile_txp_bottom .txp_btn_playrate .txp_label{margin:auto}.plugin_ctrl_mobile_txp_bottom .txp_btn .txp_tooltip{display:none!important}.plugin_ctrl_mobile_txp_bottom .txp_right_controls{min-width:15px}.plugin_ctrl_mobile_txp_bottom .txp_none{display:none}.plugin_ctrl_mobile_txp_bottom~video::-webkit-media-controls,.plugin_ctrl_mobile_txp_bottom~video::-webkit-media-controls-start-playback-button{display:none!important}.plugin_ctrl_mod_overlay_wrapper{position:static}.plugin_ctrl_mod_overlay_wrapper ol,.plugin_ctrl_mod_overlay_wrapper ul{list-style:none}.plugin_ctrl_mod_overlay_wrapper li{vertical-align:top}.plugin_ctrl_mod_overlay_wrapper *{-webkit-box-sizing:border-box;box-sizing:border-box}.plugin_ctrl_mod_overlay_wrapper .mod_overlay{position:absolute;background:rgba(0,0,0,.75);left:0;top:0;right:0;bottom:0;z-index:998;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;color:#fff}.plugin_ctrl_mod_overlay_wrapper .mod_overlay.overlay_flex{display:-webkit-box;display:-ms-flexbox;display:flex}.plugin_ctrl_mod_overlay_wrapper .mod_overlay.txp_none{display:none}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select{width:100%;text-align:center}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select .title{font-size:16px}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select ul{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row wrap;flex-flow:row wrap;font-size:18px;font-weight:700;padding:0 12px}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select li{height:70px;margin-right:6px;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:0 12px}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select li div:last-child{margin-top:6px;font-size:14px;font-weight:500}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select li.current{color:#ff6022}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select li.current span{position:relative}.plugin_ctrl_mod_overlay_wrapper .mod_speed_select li.current span:after{content:"";width:100%;height:3px;background:#ff6022;position:absolute;bottom:-3px;left:0}.plugin_ctrl_mod_overlay_wrapper .txp_btn_playrate{position:relative;width:55px;height:44px;color:#fff;white-space:nowrap;text-align:center;-webkit-box-flex:0;-ms-flex:none;flex:none;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.plugin_ctrl_txp_mode_fullscreen .plugin_ctrl_mobile_txp_bottom{padding-bottom:env(safe-area-inset-bottom)}';function adaptMobileAdPlugin(e,t){uaTool.mobile&&(t.on(exports.H5_PLAY_EVENT.AD_PLAYING,(function(){return e.hide(!0)})),t.on(exports.H5_PLAY_EVENT.AD_END,(function(){return e.el.style.display=""})))}var Component=function(){function e(e,t,o){var i;this.player=e,this.config=o,this.CLICK_EVENT_NAME="click",this.eventMap={};var r=e.container;this.el=r.querySelector(t),this.isMobile=null==o?void 0:o.isMobile,this.isLive="live"===(null===(i=this.player.config)||void 0===i?void 0:i.type),this.showEl()}return e.prototype.destroy=function(){var e;(null===(e=this.el)||void 0===e?void 0:e.parentNode)&&this.el.remove(),this.setEvts(!0),this.el=null,this.player=null},e.prototype.setEvts=function(e){var t=this;void 0===e&&(e=!1);var o=e?this.player.off:this.player.on;Object.keys(this.eventMap).forEach((function(e){o.call(t.player,e,t.eventMap[e])}))},e.prototype.showEl=function(t){void 0===t&&(t=this.el),t&&t.classList.remove(e.hideClassName)},e.prototype.hideEl=function(t){void 0===t&&(t=this.el),t&&t.classList.add(e.hideClassName)},e.sel="",e.disabledClassName="txp_disabled",e.curClassName="txp_current",e.hideClassName="txp_none",e}(),hideCSS="txp_none",disableCSS="txp_disabled",shouldDisableState=[exports.VIDEO_STATE.END,exports.VIDEO_STATE.IDLE,exports.VIDEO_STATE.LOAD_START],AirPlayBtn=function(e){function t(o,i,r){var n=e.call(this,o,t.sel,i)||this;n.config=i,n.ctrlbar=r,n.handlePlayerCanPlay=function(){n.hideDependOnKernel(),n.setBtnState(!0)},n.handleSetLevelEnd=function(){n.hideDependOnKernel()},n.handlePlayerSessionEnd=function(){n.setBtnState(!1)},n.handleClick=function(){var e,t=null===(e=n.player.currentVideoElement)||void 0===e?void 0:e.webkitShowPlaybackTargetPicker;"function"==typeof t&&t()};var a=!shouldDisableState.includes(n.player.state);return n.setupDOMEvents(),n.setupPlayerEvents(!0),n.show(),n.setBtnState(a),n}return __extends(t,e),t.prototype.show=function(){this.el.classList.remove(hideCSS)},t.prototype.hide=function(){this.el.classList.add(hideCSS)},t.prototype.setBtnState=function(e){if(e)return this.el.classList.remove(disableCSS);this.el.classList.add(disableCSS)},t.prototype.destroy=function(){var e;this.setupPlayerEvents(!1),null===(e=this.el)||void 0===e||e.remove()},t.prototype.setupPlayerEvents=function(e){void 0===e&&(e=!0);var t=e?this.player.on.bind(this.player):this.player.off.bind(this.player);t(exports.H5_PLAY_EVENT.VIDEO_CANPLAY,this.handlePlayerCanPlay),t(exports.H5_PLAY_EVENT.PLAY_SESSION_END,this.handlePlayerSessionEnd),t(exports.H5_PLAY_EVENT.VIDEO_SETLEVEL_END,this.handleSetLevelEnd)},t.prototype.setupDOMEvents=function(){this.el=this.player.container.querySelector(t.sel),this.el.addEventListener("click",this.handleClick)},t.prototype.hideDependOnKernel=function(){this.player.kernelName===exports.KERNEL_NAME.WASM?this.hide():this.show()},t.sel=".plugin_ctrl_airplay_btn",t.compName="AirPlayBtn",t}(Component);function onBtnClickPlay(e,t){t.isInRequest?e.triggerAutoplay().then((function(){return e.play()})):e.play()}var CenterBtn=function(e){function t(o,i,r){var n=e.call(this,o,t.sel,i)||this;return n.config=i,n.ctrlbar=r,n.prepareDOM(),n.initDOMEvents(),n.initPlayerEvents(),n}return __extends(t,e),t.prototype.initDOMEvents=function(){var e=this;this.playBtn.addEventListener("click",(function(){e.hideEl(e.playBtn),onBtnClickPlay(e.player,e.ctrlbar)})),this.replayBtn.addEventListener("click",(function(){e.hideEl(e.replayBtn),e.player.replay()}))},t.prototype.initPlayerEvents=function(){var e=this,t=this.player,o=function(){e.config.showCenterPlayBtn&&e.showEl(e.playBtn)};o(),t.on(exports.H5_PLAY_EVENT.AD_AUTOPLAY_BLOCKED,(function(e){e.data.adType===exports.AD_TYPE.PRE&&o()})),t.on(exports.H5_PLAY_EVENT.VIDEO_AUTOPLAY_BLOCKED,o),t.on(exports.H5_PLAY_EVENT.AD_PLAYING,(function(){return e.hideEl(e.playBtn)})),t.on(exports.H5_PLAY_EVENT.VIDEO_PLAYING,(function(t){t.data.isFirst&&e.hideEl(e.playBtn)})),t.on(exports.H5_PLAY_EVENT.PLAY_SESSION_END,(function(t){var o=t.data;e.hideEl(e.playBtn),e.config.showCenterReplayBtn&&o.endState===exports.END_STATE.NORMAL&&e.showEl(e.replayBtn)})),t.on(exports.H5_PLAY_EVENT.PLAY_SESSION_START,(function(){e.hideEl(e.replayBtn)}))},t.prototype.prepareDOM=function(){var e='<div class="'+t.sel.slice(1)+'">\n      <div class="btn_play '+Component.hideClassName+'">\n        <svg class="icon_play" viewBox="0 0 100 100">\n          <circle cx="50" cy="50" r="50" style="fill:#222;fill-opacity:0.75"></circle>\n          <path\n            transform="translate(36, 33)"\n            d="M0.6,2C0.6,2,0,3.5,0,16.9C0,30.3,0.6,32,0.6,32c0,1.5,1.6,2.5,2.9,1.8c0,0,3-0.5,15.2-6.6c12.2-6.1,14.2-8.4,14.2-8.4c1.5-0.7,1.5-2.8,0-3.6c0,0-3.3-3.1-14.2-8.6C7.9,1.1,3.5,0.2,3.5,0.2C2.1-0.5,0.6,0.5,0.6,2z"\n            style="fill:#fff;"\n          />\n        </svg>\n      </div>\n\n      <div class="btn_replay '+Component.hideClassName+'">\n        <svg class="icon_replay" viewBox="0 0 30 30">\n          <use xlink:href="#txp_svg_replay"></use>\n        </svg>\n        <div>重新播放</div>\n      </div>\n    </div>';this.ctrlbar.el.insertAdjacentHTML("beforebegin",e),this.el=this.player.container.querySelector(t.sel),this.playBtn=this.el.querySelector(".btn_play"),this.replayBtn=this.el.querySelector(".btn_replay")},t.sel=".plugin_ctrl_center_btn",t.compName="CenterBtn",t}(Component),HOTPOINT_EVENTS$1;!function(e){e.HOT_MOUSE_OVER="ctrl:hotpoint-mouseover",e.HOT_MOUSE_MOVE="ctrl:hotpoint-mousemove",e.HOT_MOUSE_OUT="ctrl:hotpoint-mouseout"}(HOTPOINT_EVENTS$1||(HOTPOINT_EVENTS$1={}));var isMobile$1=/mobile/i.test(navigator.userAgent),CtrlbarPluginName$2="ctrlbar",CTRL_EVENTS$2=__assign$1(__assign$1({FULLSCREEN_CHANGE:"windowFullscreenChange",FULLSCREEN_ERROR:"fullscreenError",FAKE_FULLSCREEN_CHANGE:"browserFullscreenChange",CLICK_PIPBTN:"ctrl:click-pipbtn",CLICK_NEXTBTN:"ctrl:click-nextbtn",CLICK_PLAYBTN:"ctrl:click-playbtn",CLICK_REPLAY:"ctrl:click-replay",SET_LANGUAGE:"ctrl:set-language",SET_LEVEL:"ctrl:set-level",SET_AUDIO:"ctrl:set-audio",SET_PLAYRATE:"ctrl:set-playrate",SET_VOLUME:"ctrl:set-volume",TOGGLE_OVERLAY:"ctrl:toggle-overlay",MOUSE_DONW:"ctrl:progress-mousedown",MOUSE_DOWN:"ctrl:progress-mousedown",MOUSE_MOVE:"ctrl:progress-mousemove",MOUSE_UP:"ctrl:progress-mouseup",SHOW:"ctrl:show",HIDE:"ctrl:hide"},HOTPOINT_EVENTS$1),{TEST_EVENT:"ctrl:inner-test-event",RESIZE:"ctrl:resize",SHOW_LEVELS:"ctrl:show-levels",HOVER_PROGRESS:"ctrl:hover-progress"}),pcRootClassName$1=".plugin_ctrl_txp_bottom",mobileRootClassName$1=".plugin_ctrl_mobile_txp_bottom",getRootClassName$1=function(e){return e?mobileRootClassName$1:pcRootClassName$1},shadowClassName$1=".plugin_ctrl_txp_shadow",gradientClassName$1=".plugin_ctrl_txp_gradient_bottom",containerClassName$1="_mod_thumbplayer_container_",largeSizeClassName$1="plugin_ctrl--large",bodyOverflowClassName$1="plugin_ctrl_fake_fullscreen",CTRL_SIZE$1,PlayBtnStatus$1;!function(e){e.LARGE="large",e.NORMAL="normal"}(CTRL_SIZE$1||(CTRL_SIZE$1={})),function(e){e.PAUSE="pause",e.PLAY="play",e.REPLAY="replay",e.STOP="stop"}(PlayBtnStatus$1||(PlayBtnStatus$1={}));var FakeFullscreen=function(e){function t(o,i,r){var n=e.call(this,o,t.sel,i)||this;return n.ctrlbar=r,n.tip=n.el.querySelector(".txp_tooltip"),n.el.classList.remove(Component.hideClassName),n.setupDOMEvents(),n.ctrlbar.on(CTRL_EVENTS$2.FULLSCREEN_CHANGE,(function(e){e.data&&n.requestFullScreen("exit")})),n}return __extends(t,e),Object.defineProperty(t.prototype,"isFullScreen",{get:function(){return this.player.container.classList.contains(t.fullscreenClassName)},enumerable:!1,configurable:!0}),t.prototype.setTipStatus=function(e){this.el.dataset.status=String(e),this.isMobile||(this.tip.innerText=e?"退出网页全屏":"网页全屏")},t.prototype.requestFullScreen=function(e){void 0===e&&(e="enter");var o="enter"===e;this.player.container.classList.toggle(t.fullscreenClassName,o),this.setTipStatus(o),this.ctrlbar.emit(CTRL_EVENTS$2.FAKE_FULLSCREEN_CHANGE,o)},t.prototype.setupDOMEvents=function(){var e=this;this.el.addEventListener(this.CLICK_EVENT_NAME,(function(){e.player.setStateKv("ctrlbar:"+t.compName+":"+e.CLICK_EVENT_NAME,{type:exports.LOG_TYPE.USER_ACTION}),e.requestFullScreen(e.isFullScreen?"exit":"enter")})),this.isMobile||(this.el.addEventListener("mouseover",(function(){e.showEl(e.tip)})),this.el.addEventListener("mouseout",(function(){e.hideEl(e.tip)})))},t.sel=".txp_right_controls .txp_btn_fake",t.fullscreenClassName="plugin_ctrl_txp_mode_fullscreen",t.compName="FakeFullscreen",t}(Component),fullscreenEvents=["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"],Fullscreen=function(e){function t(o,i,r){var n=e.call(this,o,t.sel,i)||this;return n.ctrlbar=r,n.onFullscreenChange=function(){var e=n.isFullScreen;n.setDOMStatus(e?FullscreenStatus.Exit:FullscreenStatus.Enter),n.ctrlbar.emit(CTRL_EVENTS$2.FULLSCREEN_CHANGE,e)},n.tip=n.el.querySelector(".txp_tooltip"),n.setupDOMEvents(),n.isMobile||n.listenDblclick(),n.ctrlbar.on(CTRL_EVENTS$2.FAKE_FULLSCREEN_CHANGE,(function(e){e.data&&n.requestFullScreen("exit")})),n}return __extends(t,e),Object.defineProperty(t.prototype,"isFullScreen",{get:function(){var e=document;if(!(e.mozFullScreen||e.webkitIsFullScreen))return!1;var t=e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement;return t===this.player.container||t===document},enumerable:!1,configurable:!0}),t.prototype.setDOMStatus=function(e){this.el.dataset.status=e,this.isMobile||(this.tip.innerText=e===FullscreenStatus.Exit?"退出全屏":"全屏")},t.prototype.requestFullScreen=function(e){var t,o=this;void 0===e&&(e="enter");var i=function(e){var t;return null===(t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.webkitRequestFullscreen||e.msRequestFullscreen)||void 0===t?void 0:t.bind(e)},r=function(e){var t;return null===(t=e.cancelFullScreen||e.mozCancelFullScreen||e.webkitCancelFullScreen||e.exitFullscreen||e.webkitExitFullscreen||e.msExitFullscreen)||void 0===t?void 0:t.bind(e)},n=i(this.player.container)||i(document),a=r(this.player.container)||r(document),s="enter"===e,l=s?n:a;try{null===(t=l())||void 0===t||t.catch((function(e){console.log("fullscreen error:",e),o.ctrlbar.emit(CTRL_EVENTS$2.FULLSCREEN_ERROR,e)}))}catch(e){s?this.videoRequestFullScreen():this.videoExitFullScreen()}},t.prototype.videoRequestFullScreen=function(){var e=this.player.currentVideoElement;if(e)try{if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitEnterFullscreen)e.webkitEnterFullscreen();else if(e.webkitRequestFullScreen)e.webkitRequestFullScreen();else{var t=new Error("videoRequestFullScreen: not support");this.ctrlbar.emit(CTRL_EVENTS$2.FULLSCREEN_ERROR,t),console.error(t)}}catch(t){this.ctrlbar.emit(CTRL_EVENTS$2.FULLSCREEN_ERROR,t)}},t.prototype.videoExitFullScreen=function(){var e,t=this.player.currentVideoElement;t&&(null===(e=t.webkitExitFullscreen)||void 0===e||e.call(t))},t.prototype.destroy=function(){var t=this;fullscreenEvents.forEach((function(e){document.removeEventListener(e,t.onFullscreenChange)})),e.prototype.destroy.call(this)},t.prototype.listenDblclick=function(){var e=this;this.player.container.querySelector(shadowClassName$1).addEventListener("dblclick",(function(){var t;(null===(t=e.ctrlbar.instances.FakeFullscreen)||void 0===t?void 0:t.isFullScreen)?e.ctrlbar.instances.FakeFullscreen.requestFullScreen("exit"):e.requestFullScreen(e.isFullScreen?"exit":"enter")}))},t.prototype.setupDOMEvents=function(){var e=this;this.el.addEventListener("click",(function(){e.player.setStateKv("ctrlbar:"+t.compName+":click",{type:exports.LOG_TYPE.USER_ACTION,message:"fullscreen="+e.isFullScreen}),e.requestFullScreen(e.isFullScreen?"exit":"enter")})),this.isMobile||(this.el.addEventListener("mouseover",(function(){return e.showEl(e.tip)})),this.el.addEventListener("mouseout",(function(){return e.hideEl(e.tip)}))),fullscreenEvents.forEach((function(t){document.addEventListener(t,e.onFullscreenChange)}))},t.sel=".txp_right_controls .txp_btn_fullscreen",t.compName="Fullscreen",t}(Component),FullscreenStatus,HOTPOINT_TIP_TYPE;!function(e){e.Enter="false",e.Exit="true"}(FullscreenStatus||(FullscreenStatus={})),function(e){e.DEFAULT="default",e.WITH_PREVIEW="with-preview",e.NONE="none"}(HOTPOINT_TIP_TYPE||(HOTPOINT_TIP_TYPE={}));var THROTTLE_WAIT=16.6,mouseEvtMap={mouseover:HOTPOINT_EVENTS$1.HOT_MOUSE_OVER,mousemove:HOTPOINT_EVENTS$1.HOT_MOUSE_MOVE,mouseout:HOTPOINT_EVENTS$1.HOT_MOUSE_OUT},HotPoint=function(e){function t(o,i,r){var n,a=e.call(this,o,t.sel,i)||this;return a.ctrlbar=r,a.hotPointMap={},a.isReady=!1,a.onVideoCanPlay=function(){a.isReady||(a.isReady=!0,a.renderDom())},a.onPlaySessionEnd=function(){a.isReady=!1,a.tipEl.classList.add(t.hideClassName),a.clearHotPoints()},a.config.hotPointTipType||(a.config.hotPointTipType=HOTPOINT_TIP_TYPE.DEFAULT),a.mouseEvtHandler=a.mouseEvtHandler.bind(a),a.mouseEvtFuncMap={mouseover:a.onMouseOver.bind(a),mousemove:lodash_throttle(a.onMouseMove.bind(a),THROTTLE_WAIT,{trailing:!1}),mouseout:a.onMouseOut.bind(a)},a.eventMap=((n={})[exports.H5_PLAY_EVENT.VIDEO_CANPLAY]=a.onVideoCanPlay,n[exports.H5_PLAY_EVENT.PLAY_SESSION_END]=a.onPlaySessionEnd,n),a.config.hotPointTipType===HOTPOINT_TIP_TYPE.DEFAULT&&a.setupTip(),a.setEvts(!1),a.logger=new Logger(a.player.config.instanceId,"Ctrl:HotPoints"),a}return __extends(t,e),t.prototype.clearHotPoints=function(){Object.values(this.hotPointMap).forEach((function(e){var t=e.el;t instanceof HTMLElement&&t.remove()})),this.hotPointMap={}},t.prototype.addHotPoints=function(e){var t=this;if(null==e?void 0:e.length){var o=e.map((function(e){var o=__assign$1({},e);return o.uuid=comTool.createGUID(),t.hotPointMap[o.uuid]=o,o}));return this.isReady&&this.renderDom(),o}},t.prototype.deleteHotPoints=function(e){var t=this;e.forEach((function(e){var o,i=t.hotPointMap[e];i&&(null===(o=i.el)||void 0===o||o.remove(),delete t.hotPointMap[e])}))},t.prototype.setEvts=function(t){var o=this;void 0===t&&(t=!1);var i=t?this.el.removeEventListener:this.el.addEventListener;Object.keys(mouseEvtMap).forEach((function(e){i.call(o.el,e,o.mouseEvtHandler,!1)})),e.prototype.setEvts.call(this,t)},t.prototype.isValidHotPoint=function(e){return e.timing<=this.player.duration},t.prototype.renderDom=function(){var e=this;Object.entries(this.hotPointMap).forEach((function(t){var o=t[0],i=t[1];if(!(i.el instanceof HTMLElement)){var r=e.createPointElement(i);r&&(e.el.insertAdjacentElement("beforeend",r),e.hotPointMap[o]=__assign$1(__assign$1({},i),{el:r}))}}))},t.prototype.createPointElement=function(e){if(this.isValidHotPoint(e)){var o=document.createElement("div"),i=e.timing/this.player.duration*100;return o.classList.add(t.defaultPointClass),o.style.left=i+"%",o.dataset.info=JSON.stringify(e),o}this.logger.warn("ctrlbar: hotpoint 入值非法，已忽略",e)},t.prototype.setupTip=function(){var e;this.config.hotPointCustomTipEl?e=this.config.hotPointCustomTipEl:(e=document.createElement("div")).classList.add(t.defaultTipClass),e.classList.add(t.hideClassName),this.el.insertAdjacentElement("beforeend",e),this.tipEl=e},Object.defineProperty(t.prototype,"offsetLeft",{get:function(){return this.player.container.getBoundingClientRect().left},enumerable:!1,configurable:!0}),t.prototype.mouseEvtHandler=function(e){var t=e.target.dataset;if(t.info){var o=this.config.hotPointTipType,i=JSON.parse(t.info);o===HOTPOINT_TIP_TYPE.DEFAULT&&this.mouseEvtFuncMap[e.type]({point:i,mouseEvent:e}),this.ctrlbar.emit(mouseEvtMap[e.type],{point:i,mouseEvent:e,hotPointTipType:o})}},t.prototype.onMouseOver=function(e){var o=e.point;this.tipEl&&o.text&&(this.tipEl.textContent=o.text,this.tipEl.classList.remove(t.hideClassName))},t.prototype.onMouseMove=function(e){if(this.tipEl){var t=e.mouseEvent,o=this.player.container,i=this.tipEl.getBoundingClientRect().width,r=t.clientX-this.offsetLeft-i/2;r<0&&(r=0),r>o.clientWidth-i&&(r=o.clientWidth-i),this.tipEl.style.transform="translateX("+r+"px)"}},t.prototype.onMouseOut=function(){this.tipEl&&this.tipEl.classList.add(t.hideClassName)},t.sel=".txp_hotpoint",t.compName="HotPoint",t.defaultPointClass="txp_interact_dot",t.defaultTipClass="txp_hotpoint_tip",t}(Component),Progress=function(e){function t(o,i,r){var n,a=e.call(this,o,t.sel,i)||this;a.ctrlbar=r,a.isMouseDown=!1,a.maxPercent=1,a.isActive=!0,a.shouldHideHoverTime=!1,a.onMouseMove=function(e){if(a.isMouseDown){var t=Math.min(a.getPercentByClientX(e),a.maxPercent);a.updateProgress(t),a.ctrlbar.emit(CTRL_EVENTS$2.MOUSE_MOVE,t),e.preventDefault()}},a.onMouseUp=function(){if(a.isMouseDown){a.player.setStateKv("ctrlbar:"+t.compName+":"+(a.isMobile?"touchend":"mouseup"),{type:exports.LOG_TYPE.USER_ACTION,eventId:a.evtId}),a.isMouseDown=!1;var e=parseFloat(a.progressPlayed.style.width)/100;a.doSeek(e),a.ctrlbar.emit(CTRL_EVENTS$2.MOUSE_UP,e)}},a.onMouseDown=function(e){if(a.evtId=a.player.dataset.generateEvtId(),a.player.setStateKv("ctrlbar:"+t.compName+":"+(a.isMobile?"touchstart":"mousedown"),{type:exports.LOG_TYPE.USER_ACTION,eventId:a.evtId}),a.player.state!==exports.VIDEO_STATE.IDLE){a.beforeSeek(),a.isMouseDown=!0;var o=Math.min(a.getPercentByClientX(e),a.maxPercent);a.updateProgress(o),a.ctrlbar.emit(CTRL_EVENTS$2.MOUSE_DOWN,o)}},a.eventMap=((n={})[exports.PLAY_EVENT.TIME_UPDATE]=a.onTimeUpdate.bind(a),n[exports.PLAY_EVENT.STATE_CHANGE]=a.onStateChange.bind(a),n[exports.PLAY_EVENT.VIDEO_BUFFER_CHANGE]=function(){return a.updateBufferedBar()},n),a.setEvts(),a.progressLoaded=a.el.querySelector(".txp_progress_load"),a.progressPlayed=a.el.querySelector(".txp_progress_play"),a.scrubber=a.el.querySelector(".txp_btn_scrubber"),a.tooltip=a.el.querySelector(".txp_tooltip");return a.tooltipPosLimit=45/a.player.container.clientWidth/2*100+.5,a.isMobile&&a.el.appendChild(a.scrubber),a.el.addEventListener(a.isMobile?"touchstart":"mousedown",a.onMouseDown),document.addEventListener(a.isMobile?"touchmove":"mousemove",a.onMouseMove,{passive:!1}),document.addEventListener(a.isMobile?"touchend":"mouseup",a.onMouseUp),a.isMobile||(a.setTooltipOnHover(),a.el.addEventListener("mouseover",(function(){r.emit(CTRL_EVENTS$2.HOVER_PROGRESS)}))),a.listenReqInfoEnd(),a}return __extends(t,e),Object.defineProperty(t.prototype,"offsetLeft",{get:function(){return this.el.getBoundingClientRect().left},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferedTime",{get:function(){var e=this,t=this.player.videoBuffered,o=t.length;if(1===o)return t[0].end;var i=0;return t.forEach((function(r,n){var a=r.start,s=r.end,l=e.player.playtime;if(l>=a&&l<=s)if(o>n+1)for(var p=n+1;p<o;p++){var c=t[p].start-t[p-1].end;if(!(0<=c&&c<=.2)){i=t[p-1].end;break}i=t[p].end}else i=r.end})),i},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){document.removeEventListener(this.isMobile?"touchmove":"mousemove",this.onMouseMove),document.removeEventListener(this.isMobile?"touchend":"mouseup",this.onMouseUp),e.prototype.destroy.call(this)},t.prototype.setActive=function(e){this.isActive!==e&&(this.isActive=e,this.setEvts(!this.isActive),this.isActive?this.showEl():this.hideEl())},t.prototype.setTooltip=function(e){var t=this.tooltip,o=this.tooltipPosLimit;t.innerText=comTool.formatPlayTime(e*this.ctrlbar.duration);var i=Math.max(o,Math.min(100*e,100-o));t.style.left=i+"%"},t.prototype.updateBufferedBar=function(e){if(void 0===e&&(e=this.bufferedTime),0!==e){if(this.ctrlbar.duration&&"number"==typeof e){var t=Math.min(Math.round(100*e/this.ctrlbar.duration),100*this.maxPercent);t>=99&&(t=100),this.progressLoaded.style.width=t+"%"}}else this.progressLoaded.style.width="0"},t.prototype.updateProgress=function(e){if(!Number.isNaN(e)){var t=100*e;this.progressPlayed.style.width=t+"%",this.scrubber.style.left=t+"%"}},t.prototype.getPercentByClientX=function(e){var t=(this.isMobile?e.touches[0]:e).clientX-this.offsetLeft;Math.abs(t-this.el.clientWidth)<=1&&(t=this.el.clientWidth);var o=t/this.el.clientWidth;return o=Math.max(0,Math.min(1,o))},t.prototype.onTimeUpdate=function(){if(!this.isMouseDown){var e=this.player.playtime/this.ctrlbar.duration;this.updateProgress(e),this.updateBufferedBar()}},t.prototype.onStateChange=function(e){var t=e.data;-1!==[exports.VIDEO_STATE.IDLE,exports.VIDEO_STATE.END].indexOf(t.new)&&(this.updateProgress(0),this.updateBufferedBar(0))},t.prototype.setTooltipOnHover=function(){var e=this;this.el.addEventListener("mouseover",(function(t){if(!(e.config.hideHoverTime||void 0===e.config.hideHoverTime&&e.shouldHideHoverTime)){var o=e.getPercentByClientX(t);e.setTooltip(o),e.showEl(e.tooltip),e.tooltip.style.display="flex"}})),this.el.addEventListener("mouseout",(function(){return e.hideEl(e.tooltip)})),this.el.addEventListener("mousemove",(function(t){var o=e.getPercentByClientX(t);e.setTooltip(o)}))},t.prototype.beforeSeek=function(){var e=this;this.pauseTimer=window.setTimeout((function(){return e.player.pause()}),300)},t.prototype.doSeek=function(e){var t=e*this.ctrlbar.duration;this.player.seek(t),this.pauseTimer&&(window.clearTimeout(this.pauseTimer),this.pauseTimer=null),this.player.state!==exports.VIDEO_STATE.PAUSE||this.player.config.remainPauseStateAfterSeek||this.player.play()},t.prototype.listenReqInfoEnd=function(){var e=this;this.player.pluginMsg.on(exports.PLAY_EVENT_EXT.GETINFO_OVER,(function(t){var o,i,r,n=t.data,a=e.player.plugins,s=a["ui-preview"]||a["ui-preview-list"],l=(null===(o=n.parseData)||void 0===o?void 0:o.preview)>0;e.shouldHideHoverTime=!(!s||l||!(null===(r=null===(i=n.parseData)||void 0===i?void 0:i.previewList)||void 0===r?void 0:r.length))}))},t.sel=".txp_progress_bar_container",t.compName="Progress",t}(Component),TIME_UPDATE_GAP_MS=200,PLAY_BACK_STATE;!function(e){e.IDLE="idle",e.BACK_PLAYING="backPlaying",e.LIVE_PLAYING="livePlaying"}(PLAY_BACK_STATE||(PLAY_BACK_STATE={}));var LiveProgress=function(e){function t(t,o,i,r){var n=e.call(this,t,o,i)||this;return n.ctrlbar=i,n.timeupdateTimerID=0,n.playbackStateInner=PLAY_BACK_STATE.IDLE,n.maxBackDurationOverflow=!1,n.curBackDurationMS=0,n.liveStateTimeStr="",n.isSwitchBackOp=!1,n.seekIntervalId=0,n.playerApiForPlugins=null==r?void 0:r.api,n.addReturnLiveBtn(),n.addLiveTimeDisplay(),n.setActive(!1),n.addPlayerEvts(),n}return __extends(t,e),t.prototype.destroy=function(){var t,o;(null===(t=this.liveTimeDisplayDom)||void 0===t?void 0:t.parentNode)&&(this.liveTimeDisplayDom.remove(),this.liveTimeDisplayDom=null),(null===(o=this.returnLiveBtn)||void 0===o?void 0:o.parentNode)&&(this.returnLiveBtn.remove(),this.returnLiveBtn=null),this.playerApiForPlugins=null,this.setTimeupdateTimer(!1),e.prototype.destroy.call(this)},t.prototype.setActive=function(t){e.prototype.setActive.call(this,t),this.liveTimeDisplayDom.style.display=t?"flex":"none",this.hideEl(this.returnLiveBtn)},t.prototype.setTooltip=function(e){var t=this.tooltip,o=this.tooltipPosLimit,i=Math.max(o,Math.min(100*e,100-o)),r=this.getTimeTip(e);t.style.left=i+"%",t.innerText=r},t.prototype.updateBufferedBar=function(e){},t.prototype.onTimeUpdate=function(){},t.prototype.onStateChange=function(){},t.prototype.beforeSeek=function(){},t.prototype.doSeek=function(e){this.seek(e)},t.prototype.addLiveTimeDisplay=function(){var e=this.ctrlbar.el.querySelector(".txp_left_controls");this.liveTimeDisplayDom=domTool.creatDom('<txpdiv class="txp_time_display txp_time_display_live" style="display: none;">\n      <txpdiv class="txp_live_badge" style="display: block">直播中</txpdiv>\n    </txpdiv>'),this.liveBadgeDom=this.liveTimeDisplayDom.querySelector(".txp_live_badge"),e.append(this.liveTimeDisplayDom)},t.prototype.addReturnLiveBtn=function(){var e=this,t=this.ctrlbar.el.querySelector(".txp_left_controls");this.returnLiveBtn=domTool.creatDom('<txpdiv class="txp_btn txp_btn_return txp_none">\n      <txpdiv class="txp_label">返回直播</txpdiv>\n    </txpdiv>'),t.append(this.returnLiveBtn),this.returnLiveBtn.addEventListener("click",(function(){e.seek(1)}))},t.prototype.updateLiveTime=function(e,t){void 0===t&&(t=""),domTool.text(this.liveBadgeDom,e+" "+t)},t.prototype.setPlayBackState=function(e){e?(domTool.addClass(this.liveBadgeDom,"txp_live_badge_back"),this.showEl(this.returnLiveBtn)):(domTool.removeClass(this.liveBadgeDom,"txp_live_badge_back"),this.hideEl(this.returnLiveBtn))},t.prototype.addPlayerEvts=function(){var e=this;this.player.on(exports.H5_PLAY_EVENT.VIDEO_REQ_INFO_END,(function(t){var o,i=t.data.data;if(i&&!i.error){var r=(i||{}).resData;e.clientStartTimeMS=Date.now(),e.playbackData=null===(o=r)||void 0===o?void 0:o.playback,e.playbackData?e.playbackState===PLAY_BACK_STATE.IDLE&&(e.setPlayBackEnabled(!0),e.player.loadParam.videoReqInfoParam.playbacktime>0?e.enterState(PLAY_BACK_STATE.BACK_PLAYING):e.enterState(PLAY_BACK_STATE.LIVE_PLAYING)):e.setPlayBackEnabled(!1)}})),this.player.on(exports.H5_PLAY_EVENT.PLAY_SESSION_END,(function(){e.isSwitchBackOp?e.isSwitchBackOp=!1:e.enterState(PLAY_BACK_STATE.IDLE)})),this.player.on(exports.H5_PLAY_EVENT.VIDEO_PLAYING,(function(){e.isSwitchBackOp=!1}))},t.prototype.setPlayBackEnabled=function(e){this.setActive(e),this.setTimeupdateTimer(e)},t.prototype.enterState=function(e,t){var o=this;if(this.playbackData&&this.playbackState!==e){var i=this.playbackState;if(i===PLAY_BACK_STATE.IDLE&&e===PLAY_BACK_STATE.LIVE_PLAYING)this.playbackState=e;else if(i===PLAY_BACK_STATE.LIVE_PLAYING&&e===PLAY_BACK_STATE.BACK_PLAYING){var r=t.backDurationMS,n=this.calcBackAbsoluteTimeS(Date.now(),r);this.switchPlay(n,(function(){o.curBackDurationMS=r,o.playbackState=e}),(function(e){o.playbackState=PLAY_BACK_STATE.LIVE_PLAYING;var t=e.code,i=e.message,r=e.data;if(null==t?void 0:t.startsWith(exports.ErrorCode.GETINFO_LIVE_SERVER_CODE_PREFIX))o.emitPlayerEvts("playbackFailed",__assign$1({code:t,message:i},r));else{var n=o.player.plugins.tips;"function"==typeof(null==n?void 0:n.show)&&n.show("回看出错，请稍后再试试...")}}))}else i===PLAY_BACK_STATE.BACK_PLAYING&&e===PLAY_BACK_STATE.LIVE_PLAYING?this.switchPlay(0,(function(){o.playbackState=e})):e===PLAY_BACK_STATE.IDLE&&(this.playbackState=e)}},Object.defineProperty(t.prototype,"playbackState",{get:function(){return this.playbackStateInner},set:function(e){this.playbackStateInner=e,this.onPlaybackStateChange(e),this.emitPlayerEvts("playbackStateChange",{state:this.playbackState})},enumerable:!1,configurable:!0}),t.prototype.onPlaybackStateChange=function(e){switch(e){case PLAY_BACK_STATE.LIVE_PLAYING:this.exitBackPlaying();break;case PLAY_BACK_STATE.BACK_PLAYING:this.enterBackPlaying();break;case PLAY_BACK_STATE.IDLE:this.exitBackPlaying(),this.setPlayBackEnabled(!1)}},t.prototype.emitPlayerEvts=function(e){for(var t,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];(t=this.player).emit.apply(t,__spreadArray([e],o,!1))},t.prototype.switchPlay=function(e,t,o){var i;this.isSwitchBackOp=!0,(null===(i=this.playerApiForPlugins)||void 0===i?void 0:i.replayInCurFlowNode)&&this.playerApiForPlugins.replayInCurFlowNode(this.player.vid,{videoReqInfoParam:{playbacktime:e}}).then((function(){null==t||t()})).catch((function(e){null==o||o(e)}))},t.prototype.seekInBackState=function(e){var t,o=e.backDurationMS,i=this.calcBackAbsoluteTimeS(Date.now(),o),r=this.player.currentVideoInfo.loadingUrl,n=urlTool.updateUrlParam(r,"wsStreamTimeABS",""+i);this.curBackDurationMS=o,this.isSwitchBackOp=!0,(null===(t=this.playerApiForPlugins)||void 0===t?void 0:t.replayInCurFlowNode)&&this.playerApiForPlugins.replayInCurFlowNode({url:n})},t.prototype.enterBackPlaying=function(){this.setPlayBackState(!0),this.updateLiveTime("回看中")},t.prototype.exitBackPlaying=function(){this.updateProgress(1),this.setPlayBackState(!1),this.curBackDurationMS=0,this.player.loadParam.videoReqInfoParam.playbacktime=0,this.updateLiveTime("直播中")},t.prototype.setTimeupdateTimer=function(e){e?0===this.timeupdateTimerID&&(this.timeupdateTimerID=window.setInterval(this.onTimeupdate.bind(this),TIME_UPDATE_GAP_MS)):this.timeupdateTimerID>0&&(window.clearInterval(this.timeupdateTimerID),this.timeupdateTimerID=0)},t.prototype.calcMaxBackDurationS=function(e){var t=this.playbackData.playbacktime;if(this.maxBackDurationOverflow)return t;var o=this.calcStreamAbsoluteDurationMS(e)/1e3;return o<t?(this.maxBackDurationOverflow=!1,o):(this.maxBackDurationOverflow=!0,t)},t.prototype.calcAbsoluteTimeMS=function(e){return 1e3*this.playbackData.svrtick+(e-this.clientStartTimeMS)},t.prototype.calcStreamAbsoluteDurationMS=function(e){return this.calcAbsoluteTimeMS(e)-1e3*this.playbackData.playbackstart},t.prototype.calcBackAbsoluteTimeS=function(e,t){return Math.round((this.calcAbsoluteTimeMS(e)-t)/1e3)},t.prototype.onTimeupdate=function(){if(!this.isMouseDown&&this.player.state===exports.VIDEO_STATE.PLAYING){var e="",t="",o=Date.now(),i=this.calcStreamAbsoluteDurationMS(o);if(this.playbackState===PLAY_BACK_STATE.BACK_PLAYING){var r=this.calcMaxBackDurationS(o),n=(i-this.curBackDurationMS)/1e3,a=this.calcBackAbsoluteTimeS(o,this.curBackDurationMS);if(this.player.loadParam.videoReqInfoParam.playbacktime=a,t="回看中",e=""+comTool.formatPlayTime(n),!this.maxBackDurationOverflow){var s=(r-this.curBackDurationMS/1e3)/r;this.updateProgress(s)}}else t="直播中",e=""+comTool.formatPlayTime(i/1e3);this.liveStateTimeStr!==e&&(this.liveStateTimeStr=e,this.updateLiveTime(t,e))}},t.prototype.calcPercent2BackTimeS=function(e){return(1-e)*this.calcMaxBackDurationS(Date.now())},t.prototype.getTimeTip=function(e){var t=this.calcPercent2BackTimeS(e);return"回退"+comTool.formatPlayTime(t)},t.prototype.seek=function(e){var t=this;if(!(this.seekIntervalId>0)){if(this.seekIntervalId=window.setTimeout((function(){t.seekIntervalId=0}),500),1!==e){var o=1e3*this.calcPercent2BackTimeS(e);this.playbackState===PLAY_BACK_STATE.LIVE_PLAYING?this.enterState(PLAY_BACK_STATE.BACK_PLAYING,{backDurationMS:o}):this.playbackState===PLAY_BACK_STATE.BACK_PLAYING&&this.seekInBackState({backDurationMS:o})}else this.enterState(PLAY_BACK_STATE.LIVE_PLAYING)}},t}(Progress),LoopStatus;!function(e){e.Loop="true",e.NotLoop="false"}(LoopStatus||(LoopStatus={}));var LocalLoopConfigKey="thumbplayer-h5-loop",Loop=function(e){function t(o,i){var r=e.call(this,o,t.sel,i)||this;return r.tip=r.el.querySelector(".txp_tooltip"),r.setupDOMEvents(),r.initLoopConfig(),r}return __extends(t,e),Object.defineProperty(t.prototype,"isLoopMode",{get:function(){return this.el.dataset.status===LoopStatus.Loop},set:function(e){this.player.config.loop=e,this.el.dataset.status=String(e),this.tip.innerText=e?"关闭循环播放":"打开循环播放"},enumerable:!1,configurable:!0}),t.prototype.setupDOMEvents=function(){var e=this;this.el.addEventListener(this.CLICK_EVENT_NAME,(function(){e.isLoopMode=!e.isLoopMode,lsTool.setData(LocalLoopConfigKey,e.isLoopMode?LoopStatus.Loop:LoopStatus.NotLoop)}))},t.prototype.initLoopConfig=function(){var e=this.player.config.loop;if(void 0===e){var t=lsTool.getData(LocalLoopConfigKey);t&&(this.isLoopMode=t===LoopStatus.Loop)}else this.isLoopMode=!!e},t.compName="Loop",t.sel=".txp_left_controls .txp_btn_loop",t}(Component),NextBtn=function(e){function t(o,i,r){var n,a=e.call(this,o,t.sel,i)||this;a.ctrlbar=r;var s=i.showNextBtnUIOnly;return s?a.el.classList.remove(Component.disabledClassName):(a.onVideoNodeChange=a.onVideoNodeChange.bind(a),a.eventMap=((n={})[exports.PLAY_EVENT.VIDEONODE_CHANGE]=a.onVideoNodeChange,n[exports.PLAY_EVENT.LIST_CHANGE]=a.onVideoNodeChange,n),a.setEvts()),a.el.addEventListener(a.CLICK_EVENT_NAME,(function(){if(a.player.setStateKv("ctrlbar:"+t.compName+":"+a.CLICK_EVENT_NAME,{type:exports.LOG_TYPE.USER_ACTION}),a.ctrlbar.emit(CTRL_EVENTS$2.CLICK_NEXTBTN),!s){var e=a.player.currentVideoInfoIdx;-1===e||e>=a.player.totalVideoInfoCount-1||a.player.playNext()}})),a}return __extends(t,e),t.prototype.onVideoNodeChange=function(){var e=this.player.currentVideoInfoIdx;-1!==e&&e+1<this.player.totalVideoInfoCount?this.el.classList.remove(Component.disabledClassName):this.el.classList.add(Component.disabledClassName)},t.sel=".txp_left_controls .txp_btn_next",t.compName="NextBtn",t}(Component),PictureInPicture=function(e){function t(o,i,r){var n=e.call(this,o,t.sel,i)||this;return n.ctrlbar=r,n.isPiP=!1,n.onEnterPiP=function(){n.isPiP=!0,n.setDOMStatus(!1)},n.onLeavePiP=function(){n.isPiP=!1,n.setDOMStatus(!0)},void 0===HTMLVideoElement.prototype.requestPictureInPicture?(n.el.classList.add(Component.hideClassName),n):(n.setupDOMEvents(),n.setupPlayerEvents(),n.tooltip=n.el.querySelector(".txp_tooltip"),n)}return __extends(t,e),t.prototype.enterPicInPic=function(){var e=this.player.currentVideoElement;e&&(e.requestPictureInPicture(),this.setDOMStatus(!1))},t.prototype.leavePicInPic=function(){var e,t;null===(t=null===(e=document.exitPictureInPicture())||void 0===e?void 0:e.catch)||void 0===t||t.call(e,(function(){})),this.setDOMStatus(!0)},t.prototype.destroy=function(){this.setupVideoListener(!1),e.prototype.destroy.call(this)},t.prototype.setupDOMEvents=function(){var e=this;this.el.addEventListener("click",(function(){e.isPiP?(e.leavePicInPic(),e.isPiP=!1):(e.enterPicInPic(),e.isPiP=!0),e.ctrlbar.emit(CTRL_EVENTS$2.CLICK_PIPBTN,e.isPiP)}))},t.prototype.setupPlayerEvents=function(){var e=this;this.player.on(exports.H5_PLAY_EVENT.VIDEO_PLAYING,(function(t){if(t.data.isFirst){var o=e.player.currentVideoElement;o instanceof HTMLVideoElement&&o.requestPictureInPicture?(e.el.classList.remove(Component.hideClassName),e.setVideoPip()):e.el.classList.add(Component.hideClassName)}})),this.player.on(exports.H5_PLAY_EVENT.VIDEO_SETLEVEL_END,(function(t){t.data.code===exports.ErrorCode.SUC&&"smooth"!==e.player.config.setLevelMode&&e.setVideoPip()}))},t.prototype.setVideoPip=function(){this.isPiP&&this.enterPicInPic(),this.setupVideoListener(!1),this.setupVideoListener(!0)},t.prototype.setupVideoListener=function(e){void 0===e&&(e=!0);var t=this.player.currentVideoElement;if(t){var o=e?t.addEventListener:t.removeEventListener;o.call(t,"enterpictureinpicture",this.onEnterPiP),o.call(t,"leavepictureinpicture",this.onLeavePiP)}},t.prototype.setDOMStatus=function(e){this.tooltip.innerText=e?"画中画":"退出画中画",this.el.dataset.status=String(!e)},t.sel=".txp_right_controls .txp_btn_pip",t.compName="PictureInPicture",t}(Component);function showTips(e,t){var o=e.plugins.tips;"function"==typeof(null==o?void 0:o.show)&&o.show(t)}function getIsInAd(e){var t=e,o=t.flowManager,i=t.videoNode;return!(!getAdPlugin(e.config.instanceId)||!i||i===o.currentFlowNode)}var PlayBtn=function(e){function t(o,i,r){var n,a=e.call(this,o,t.sel,i)||this;return a.ctrlbar=r,a.onPlaySessionStart=function(){a.el.dataset.status=PlayBtnStatus$1.PLAY,a.tooltip.innerText="播放"},a.onPlaySessionEnd=function(){a.el.dataset.status=a.isLive?PlayBtnStatus$1.PLAY:PlayBtnStatus$1.REPLAY,a.tooltip.innerText="播放"},a.eventMap=((n={})[exports.PLAY_EVENT.STATE_CHANGE]=a.onPlayerStateChange.bind(a),n[exports.H5_PLAY_EVENT.PLAY_SESSION_START]=a.onPlaySessionStart,n[exports.H5_PLAY_EVENT.PLAY_SESSION_END]=a.onPlaySessionEnd,n),a.setEvts(),a.tooltip=a.el.querySelector(".txp_tooltip"),a.addEventListener(),a}return __extends(t,e),t.prototype.addEventListener=function(){var e=this,o=this.player;this.el.addEventListener("click",(function(){if(o.setStateKv("ctrlbar:"+t.compName+":"+e.CLICK_EVENT_NAME,{type:exports.LOG_TYPE.USER_ACTION}),!e.el.classList.contains(Component.disabledClassName))switch(e.ctrlbar.emit(CTRL_EVENTS$2.CLICK_PLAYBTN,e.el.dataset),e.el.dataset.status){case PlayBtnStatus$1.PAUSE:o.pause(exports.H5_PAUSE_TYPE.USER_CLICK);break;case PlayBtnStatus$1.STOP:o.stop();break;case PlayBtnStatus$1.PLAY:if(!e.isLive)return onBtnClickPlay(o,e.ctrlbar);e.replay();break;case PlayBtnStatus$1.REPLAY:e.ctrlbar.emit(CTRL_EVENTS$2.CLICK_REPLAY),e.replay()}}))},t.prototype.replay=function(){var e=this.player;e.vid&&e.videoReqInfoPlugin?e.triggerAutoplay().then((function(){return e.replay()})):e.replay()},t.prototype.onVodPlaying=function(){var e=this.el,t=this.tooltip;e.dataset.status=PlayBtnStatus$1.PAUSE,t.innerText="暂停"},t.prototype.onLivePlaying=function(){var e=this.el,t=this.tooltip,o=function(){e.dataset.status=PlayBtnStatus$1.STOP,t.innerText="停止"};getIsInAd(this.player)?this.player.once(exports.H5_PLAY_EVENT.AD_END,o):o()},t.prototype.onPlayerStateChange=function(e){var t=e.data.new,o=this.el,i=this.tooltip;switch(t){case exports.VIDEO_STATE.PLAYING:this.isLive?this.onLivePlaying():this.onVodPlaying();break;case exports.VIDEO_STATE.PAUSE:case exports.VIDEO_STATE.CANPLAY:o.dataset.status=PlayBtnStatus$1.PLAY,i.innerText="播放"}},t.sel=".txp_left_controls .txp_btn_play",t.compName="PlayBtn",t}(Component),_a$1$1,VALID_POPUP;!function(e){e.DEFINITION="definition",e.LANGUAGE="language",e.PLAYRATE="playrate",e.AUDIO_TRACK="audiotrack"}(VALID_POPUP||(VALID_POPUP={}));var POPUP_MOD_SEL=(_a$1$1={},_a$1$1[VALID_POPUP.DEFINITION]=".mod_overlay.definition",_a$1$1[VALID_POPUP.LANGUAGE]=".mod_overlay.language",_a$1$1[VALID_POPUP.PLAYRATE]=".mod_overlay.playrate",_a$1$1),Popup=function(e){function t(t,o,i,r){var n=e.call(this,t,o,i)||this;return n.ctrlbar=r,n.hideEl(),n.popupName=i.popupName,n.popup=n.isMobile?n.player.container.querySelector(POPUP_MOD_SEL[i.popupName]):n.el.querySelector(".txp_popup"),n.el?(n.label=n.el.querySelector(".txp_label"),n.isMobile?n.label.addEventListener(n.CLICK_EVENT_NAME,(function(){!n.popup.classList.contains(Component.hideClassName)?n.hideEl(n.popup):(n.showEl(n.popup),n.popup.classList.add("overlay_flex")),n.ctrlbar.emit(CTRL_EVENTS$2.TOGGLE_OVERLAY,!0),n.hideEl(n.ctrlbar.el)})):(n.label.addEventListener("mouseover",(function(){return n.showEl(n.popup)})),n.el.addEventListener("mouseleave",(function(){n.hideEl(n.popup)}))),n.initItemClick(),n):n}return __extends(t,e),Object.defineProperty(t.prototype,"curClass",{get:function(){return this.isMobile?"current":Component.curClassName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this.selectedValue},set:function(e){var t,o=null===(t=this.popupOptions)||void 0===t?void 0:t.find((function(t){return String(t.value)===String(e)}));if(this.selectedValue=e,!o)return this.label.textContent="",void this.hideEl();this.showEl(),this.setCurrent(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"popupOptions",{get:function(){return this.allValue},set:function(e){var t=this,o=e.find((function(e){return String(e.value)===String(t.selectedValue)}));o?(this.setCurrent(o),this.showEl()):this.label.textContent="",this.allValue=e;var i=this.isMobile?"li":"div",r=/(<([^>]+)>)/;this.popup.querySelector(this.isMobile?".select_list":".txp_popup_content").innerHTML=e.map((function(e){return"<"+i+' \n      class="txp_menuitem '+(e.value===t.selected?t.curClass:"")+'" \n      data-label="'+(r.test(e.label)?"":e.label)+'"\n      data-value="'+e.value+'" \n      data-payload="'+(e.payload||"")+'">'+e.label+"</"+i+">"})).join("")},enumerable:!1,configurable:!0}),t.prototype.setCurrent=function(e){var t,o=this;this.label.innerHTML=null!==(t=null==e?void 0:e.btnLabel)&&void 0!==t?t:null==e?void 0:e.label,this.popup.querySelectorAll(".txp_menuitem").forEach((function(t){t.getAttribute("data-value")===String(e.value)?t.classList.add(o.curClass):t.classList.remove(o.curClass)}))},t.prototype.hookPlaySessionEnd=function(){}