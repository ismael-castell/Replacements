function isLoggedIn(){var e=$("#o_account-links-content"),t=!1;return"true"===e.attr("logged_in")&&(t="active",$(".session_expired",e).is(":visible")&&(t="expired")),t}function update_post_data_special_context(e){var t=window.special_context||{};$.each(t,function(a){"special_context"==a?e[a]=t[a]:a.match(/\[\]/)?(e[a]=e[a]||[],$.each($('div.active input[name="'+a+'"]:checked'),function(t,n){e[a].push($(n).val())})):e[a]=$('div.active input[name="'+a+'"]').val()})}function createAccount(e,t){function a(){return!(!window.skipCaptchaFeedback&&!recaptcha_response)||(validate.feedback_err($(".o_captcha.feedback",r),"You must complete the captcha verification above"),!1)}function n(e){var t=$("#create_account_error");t.removeClass("disp-n").html(e),t[0].scrollIntoView()}t=ifUndef(t,!0);var o,r=$("#signup_form"),i=parseQuery(r.serialize().replaceAll("+"," "),"&"),s=$(".o_login.feedback",r),c=$(".o_email.feedback",r),l=$(".o_password.feedback",r),d=$(".o_birthdate.feedback",r);validate.login(i.login,s)&validate.email(i.email,c)&validate.pass(i.pass,l)&validate.age($(".o_birthdate_wrap",r),d)&a()&&(i.source=window.accountSource||"vizdotcom_web",Modals.context.signupContext&&(i.signup_context=Modals.context.signupContext),update_post_data_special_context(i),(o=$.ajax({type:"POST",url:"/account/try_create_account",data:i,dataType:"json"})).done(function(a){if(1==a.created){if(Tracking.sendEvent({category:"Account",action:"Completes Sign-up Process",label:"title"}),t){var o=$("#modal-thanks");Modals.toggle(o),$("h2",o).html("Your account was successfully created!"),$("#thanks-small-note",o).html("(We have also sent you a welcome email.)"),Modals.resizeModal()}refreshLoginLinks(!0),$(document).trigger("new_account_signup"),isFn(e)&&e(a)}else n("<b>There was an issue creating your account.<br>Please fix the following before resubmitting</b>:<ul class='mar-t-md mar-l-lg'>"+a.errors+"</ul>")}),o.fail(function(){n("<b>There was an error creating your account.</b><br>Please try again or contact <a href=\"javascript:Modals.toggle('#modal-feedback')\">customer service</a> for help.")}))}function tryLogin(e){function t(e){var t,a=" color-red",n=$("#sign_in_feedback");0==e?(t="Logging in...",a=""):t=403==e?"Please use the same account or refresh the page and try again.":"There was an error with your login/password; please try again.",n.html('<h3 class="type-md weight-bold line-solid'+a+'">'+t+"</h3>"),n.removeClass("disp-n")}var a,n;t(0),(a=parseQuery($("#login_form").serialize().replaceAll("+"," "),"&")).uid=getUserId(),update_post_data_special_context(a),(n=$.ajax({type:"POST",url:"/account/try_login",data:a,dataType:"json"})).done(function(a,n,o){1==a.ok?(Tracking.sendEvent({category:"Account",action:"Login",label:"title"}),refreshLoginLinks(!0),isFn(e)&&e(a)):t(o.status)}),n.fail(function(e){t(e.status)})}function showExpiredSessionLinks(e){var t=$(".session_expired");t.removeClass("disp-n"),$(".session_valid").addClass("disp-n"),!1!==e&&t.first().trigger("click",e)}function refreshLoginLinks(e){var t,a=$(".o_account-links");a.length&&((t=$.ajax({url:"/account/refresh_login_links",dataType:"html"})).done(function(t){applyAccountLinks(t,e)}),t.fail(function(e){var t;t="503"==e.status?"Site in Maintenance Mode":"Error finding account",a.html('<span class="color-red">'+t+"</span>")}))}function applyAccountLinks(e,t){$(".o_account-links").hide().html(e).css("display","");var a=$("#footer_account"),n=null,o=null,r=$(document);a.html($(".o_footer-account-links").first().html()),a.addClass("pad-t-md pad-b-xl"),a.prev().removeClass("pad-y-xl").addClass("pad-t-xl"),t&&isLoggedIn()&&("undefined"!=typeof ga&&ga("set","userId",getUserId()),r.trigger("post_login").off("post_login"),n=!0),n&&1===r[0].redirect||(n&&!Modals.isThanksOn()&&(o=Modals.context.confirmationMsg,Modals.close(),o&&(Modals.context={confirmationMsg:o})),Modals.reset(),r.trigger("post_account_links"))}function logout(){deleteCookie("remember_token");var e=$.ajax({type:"POST",url:"/account/logout",data:null,dataType:"json"});e.done(function(e){e.reload?window.location.reload():window.location.href="/"}),e.fail(function(e,t){showErr(t,e.responseText)})}function send_forgot_pass(){var e=$("#modal-resetpass #messages > *"),t=$("#msg_error"),a=$("#btn_forgot_pass"),n=$("#forgot_pass_email").val();e.addClass("disp-n"),0!=n.length?(a.prop("disabled",!0),$("#msg_loading").removeClass("disp-n"),$.post("/account/forgot_password",{email:n},function(n){e.addClass("disp-n"),a.prop("disabled",!1),1==n.ok?($("#msg_success").removeClass("disp-n"),$("#hide_on_success").hide()):0==n.ok&&t.removeClass("disp-n").html(n.msg)},"json")):t.removeClass("disp-n").html("Please enter your account's email address.")}function showLoginModal(e,t){e&&(Modals.context=e),t?Modals.toggle("#modal-signup"):(Modals.toggle("#modal-login"),$("#try_login").val(cookie_params.prev_login))}function getMembershipInfo(e){if(isLoggedIn()){var t=$.ajax({url:"/account/membership_info",data:null,dataType:"json"});t.done(function(t){1==t.ok?e(t.info):showInfo(t.error_title||"Problem fetching your membership info",t.error)}),t.fail(function(e,t){showErr(t,e.responseText)})}else showInfo("Not logged in","Please log in to your VIZ account to see your membership information.")}function init_username_feedback(e,t){function a(e){("Username available"==e?validate.feedback_ok:validate.feedback_err)(t,e)}e.on("input",$.debounce(333,function(){var n=e.val(),o=e.data("orig")||"";n.toLowerCase()==o.toLowerCase()?t.addClass("disp-n").html(""):validate.login(n,t)&&$.get("/account/check_login_availability",{login:n},a,"json")}))}function disable_window_ajax(){$.ajaxSetup({beforeSend:function(e,t){if("/account/logout"!==t.url)return!1}}),cl("AJAX Auth error, AJAX turned off")}function lazyLoadImages(e){cl("Init lazyload images for: "+(e||"window"));var t={failure_limit:Infinity,load:function(){$(this).removeData().removeAttr("data-original").removeClass("lazy")}};e&&(t.container=e),$("img.lazy").lazyload(t)}function lazyLoadInfo_common(e){lazyLoadInfo_common.count++,activityTimer&&clearTimeout(activityTimer),e||(e={}),lazyLoadInfo_common.count>1&&(target_comment_id=null);var t,a,n=target_comment_id;return a=[],$(".comment").each(function(){a.push($(this).attr("id"))}),a.length&&(e.comment_ids=a.join("_")),(t=$.ajax({url:"/g1/load_dynamic_info",data:e,dataType:"xml"})).done(function(e){var t=$(e);(a=$("comments_html",t))&&""!=$.trim(a.text())?($("#comments_panel").html(a.text()),$("#comment_content").keydown($.debounce(333,function(){valCommentForm($("#comment_form"))})),setNumComments(),setupToggleables(),n&&scrollComment(n)):(commentSubmitButtonText(),$("comment_updates",t).each(function(){var e=$(this),t=$("id",e).text();$("is_mine",e).length&&setEditLink(t),$("flagged",e).length&&setCommentFlags(t)})),activityTimer=setTimeout(getLatestActivity,activityInterval)}),t.fail(function(e,t){401==e.status?logout():"parsererror"!=t&&showErr(t,e.responseText)}),t}function getLatestActivity_common(e){var t,a=+$("#comment_latest_id").val();return a>0&&(e.latest_id=a),(t=$.ajax({url:"/g1/latest_activity",data:e,async:!0,dataType:"json"})).done(function(e){activityInterval=6e4,renderNewComments(e.new_comments)}),t.fail(function(){activityInterval=3e5}),t.always(function(){activityTimer&&clearTimeout(activityTimer),activityTimer=setTimeout(getLatestActivity,activityInterval)}),t}function gridClassUpdate(e,t){var a=$.map(t,function(e){return e}).join(" ");e.removeClass(a),e.each(function(e,a){$.each(t,function(t,n){0==(e+1)%t&&$(a).addClass(n)})})}function initProductSort(e){$(".o_sort-controls").removeClass("disp-n");var t,a=$("[data-sort]"),n=cookie_params.dflt_sort;if(t=function(t,a,n,o){var r,i,s,c,l,d=$(a,t).detach();return"recent"==n?(d=d.sort(function(e,t){return+$(e).data("sort-recent")-+$(t).data("sort-recent")}),l="other"):(l="az"==n?"ascending":"descending",d=d.sort(function(e,t){var a=$(e),o=$(t);return r=a.data("sort-alpha-label"),i=+a.data("sort-alpha-num"),s=o.data("sort-alpha-label"),c=+o.data("sort-alpha-num"),r==s?"az"==n?i-c:c-i:r>s?"az"==n?1:-1:"az"==n?-1:1})),e&&o&&gridClassUpdate(d,e),d.appendTo(t),"b"!=a.slice(-1)&&t.attr("aria-sort",l),d},a.each(function(){var e=$(this);e.on("click",function(n){if(n.preventDefault(),e.a_sel())return!1;var o,r=e.data("sort");setCookieSec("dflt_sort",r,0,document.location.pathname),a.removeClass("color-red").addClass("hover-dark-red").a_sel(!1),e.removeClass("hover-dark-red").addClass("color-red").a_sel(!0),t($(".o_sort_container"),".o_sortable",r,!0).each(function(){(o=$(".o_sort_container-b",$(this))).length&&t(o,".o_sortable-b",r)}),$(document).trigger("scroll")})}),n){var o=a.filter("[data-sort="+n+"]");o.length&&1!=o.a_sel()&&(cl("Restore Sort control to cookied state"),o.click())}}function initStickyElements(){var e,t,a,n,o,r,i,s,c,l=$(document),d=[];s=function(){l.off("scroll",c),$(".o_sticky").each(function(){e=$(this),t=e.height(),(a=e.closest(".o_sticky-container")).length&&(n=a.height(),d.push({stickyElem:e,stickyContainer:a,maxMargin:n-t,currentMargin:0}))}),l.on("scroll",c)},c=$.debounce(.005,function(){o=l.scrollTop(),$.each(d,function(e,t){i=0,(r=t.stickyContainer.offset().top-o)<0&&(i=25-r)>t.maxMargin&&(i=t.maxMargin),i!=t.currentMargin&&(t.stickyElem.stop().animate({marginTop:i+"px"},200),t.currentMargin=i)})}),l.on("resize",$.debounce(.1,s)),s()}function toggleWaitOverlay(){var e=$("#overlay_wait"),t="data-overlay-state",a="on"==e.attr(t);e.attr(t,a?"off":"on")}function resetChapterReadButtonsForLoggedIn(e,t){t&&$("a.o_chapter-container.o_chapter-archive").each(function(){var t,a,n=$(this),o="";n.removeClass("o_requires-login").removeData("login-msg signup-msg show-signup").removeAttr("clickfn onclick"),t=n.hasClass("o_m-rated"),(a=$(".o_read-link-label",n)).removeClass("o_read-link-label btn-primary-dark hover-bg-off-black btn-primary color-off-white bg-green hover-bg-green color-off-black bg-yellow hover-bg-orange"),t&&!e?(n.attr({href:"javascript:void('18+');",onclick:"return false;"}),a.addClass("o_read-link-label btn-primary-dark hover-bg-off-black"),o='<i class="icon-lock"    style="margin-right:5px;"></i>18+ only'):(n.attr({href:n.data("target-url")}),a.addClass("o_read-link-label btn-primary color-off-white bg-green  hover-bg-green"),o='<i class="icon-unlock"  style="margin-right:5px;"></i>Read'),a.html('<span style="white-space:nowrap;">'+o+"</span>")}),$("a.o_chapter-container.o_m-rated").not(".o_chapter-archive").each(function(){var t,a=$(this),n="";a.removeClass("o_requires-login").removeData("login-msg signup-msg show-signup").removeAttr("clickfn onclick"),(t=$(".o_read-link-label",a)).removeClass("o_read-link-label btn-primary-dark hover-bg-off-black btn-primary color-off-white bg-green hover-bg-green color-off-black bg-yellow hover-bg-orange"),e?(a.attr({href:a.data("target-url")}),t.addClass("o_read-link-label btn-primary color-off-white bg-green  hover-bg-green"),n='<i class="icon-eye"     style="margin-right:5px;"></i>FREE'):(a.attr({href:"javascript:void('18+');",onclick:"return false;"}),t.addClass("o_read-link-label btn-primary-dark hover-bg-off-black"),n='<i class="icon-lock"    style="margin-right:5px;"></i>18+ only'),t.html('<span style="white-space:nowrap;">'+n+"</span>")})}function mangaAuthWrapper(e,t){var a=$.ajax({url:"/manga/auth?device_id=3&manga_id="+e,dataType:"json"});return a.done(function(e){if(1==e.ok&&1==e.archive_info.ok)t(e);else{var a=!0;e.archive_info&&e.archive_info.err&&(4==e.archive_info.err.code?isLoggedIn()?(a=!1,showRefresh()):(a=!1,Modals.toggle("#modal-sj-join")):e.archive_info.err.msg&&(a=!1,showInfo("Sorry",e.archive_info.err.msg))),a&&showErr(null,"Sorry, something went wrong")}}),a.fail(function(){}),a}function tryReadChapter(e,t){mangaAuthWrapper(e,function(){window.location.href=t})}function announcement_ajax(e,t){e&&t&&$.ajax({url:"/q/get_pencil_announcement_cached",data:{announcementType:e,announcementID:t},dataType:"html"}).done(function(e){$(".pencil_announcement").html(e)})}function isJQuery(e){return window.jQuery&&e instanceof jQuery}function isFn(e){return"function"==typeof e}function isObj(e){return e instanceof Object}function isBool(e){return"boolean"==typeof e}function isArray(e){return Array.isArray(e)}function isStr(e){return"[object String]"===Object.prototype.toString.call(e)}function ifUndef(e,t){return e===undefined?t:e}function form_data_to_object(e){var t,a,n={};for(t of e.keys())n[t]||(a=e.getAll(t),n[t]=a.length>1?a:e.get(t));return n}function isCanvasSupported(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}function compactObj(e,t){for(var a in e)e[a]===t&&delete e[a]}function getUrlParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function parseQuery(e,t,a){var n,o,r,i,s={},c=decodeURIComponent;if(t=t||"&",a=a||!0,e)for("?"==e[0]&&(e=e.substr(1)),n=e.split(t),r=0;r<n.length;++r)(o=n[r].split("="))&&(i=c(o[0]),s.hasOwnProperty(i)||(a&&(s[i]=!0),o.length>=2&&(s[i]=c(o.slice(1).join("=")))));return s}function updateCookieParams(){window.cookie_params=parseQuery(document.cookie,/; */,!1)}function getHash(e){return document.location.hash.substr(1)||e}function removeURLParam(e,t){var a=e.split("?");if(a.length>=2){for(var n=encodeURIComponent(t)+"=",o=a[1].split(/[&;]/g),r=o.length;r-- >0;)0==o[r].indexOf(n,0)&&o.splice(r,1);return o.length>0?a[0]+"?"+o.join("&"):a[0]}return e}function addURLParam(e,t,a,n){var o=e.length,r="";e.indexOf("#")>0&&(o=e.indexOf("#"),r=e.substring(e.indexOf("#"),e.length));var i=!0,s=e.substring(0,o).split("?"),c="",l="";if(s.length>1)for(var d=s[1].split("&"),u=0;u<d.length;u++){var f=d[u].split("=");i&&f[0]==t||(""==c?c="?":c+="&",c+=f[0]+"="+(f[1]||""))}return""==c&&(c="?"),""!==c&&"?"!=c&&(c+="&"),c+=t+"="+(a||""),l=s[0]+c,n&&(l+=r),l}function setCookie(e,t,a){setCookieSec(e,t,24*a*60*60)}function setCookieForMinutes(e,t,a){setCookieSec(e,t,60*a)}function setCookieSec(e,t,a,n){n=n||"/";var o="";if(a){var r=new Date;r.setTime(r.getTime()+1e3*a),o=";expires="+r.toGMTString()}document.cookie=e+"="+encodeURIComponent(t)+";path="+n+o}function getCookie(e){var t,a,n=document.cookie;return n.length>0&&-1!=(t=n.indexOf(e+"="))?(t=t+e.length+1,-1==(a=n.indexOf(";",t))&&(a=n.length),decodeURIComponent(n.substring(t,a))):""}function deleteCookie(e){setCookie(e,"",-1)}function areCookiesEnabled(){var e=!1;return setCookie("_test_","Hello"),""!=getCookie("_test_")&&(e=!0,deleteCookie("_test_")),e}function setMetaTag(e,t){var a=$("meta[name='"+e+"']");0===a.length&&(a=$("<meta name='"+e+"' />").appendTo("head")),a.attr("content",t)}function removeDiacritics(e){return isFn(String.prototype.normalize)?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}function setIntervalX(e,t,a,n){var o=0,r=window.setInterval(function(){++o===n?(window.clearInterval(r),isFn(t)&&t()):isFn(e)&&e(o)},a)}function fitStringToWidth(e,t,a){var n=document.createElement("span");a&&$(n).css(a),n.style.display="inline",n.style.visibility="hidden",n.style.padding="0px",document.body.appendChild(n);var o=e.split("<br"),r=o.length>1,i=e;if(e=o[0].replace(/<\/?[^>]+(>|$)/g,""),n.innerHTML=e,n.offsetWidth>t){for(var s,c,l=0,d=e.length;c=d-l>>1;)s=l+c,n.innerHTML=e.substring(0,s)+"...",n.offsetWidth>t?d=s:l=s;i=e.substring(0,l)+"..."}else r&&(i=e+"...");return document.body.removeChild(n),i}function canonicalLocation(){var e,t=$("link[rel='canonical']").get(0);return t?(e=document.createElement("a")).href=t.href:e=window.location,e}function localFromUTC(e){var t=new Date(e),a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=t.getHours(),r=o<12?"AM":"PM";o>12&&(o-=12),0==o&&(o=12);var i=t.getMinutes();return i<10&&(i="0"+i),a[t.getDay()]+" "+n[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()+", "+o+":"+i+r}function createUUID(){for(var e=[],t="0123456789ABCDEF",a=0;a<32;a++)e[a]=t.substr(Math.floor(16*Math.random()),1);return e[12]="4",e[16]=t.substr(3&e[16]|8,1),e.join("")}function goToByScroll(e,t){var a=$(e);t=t||20,a.length&&$("html,body").animate({scrollTop:a.offset().top-t},"swing")}function getViewport(){var e=window;return{left:e.pageXOffset,top:e.pageYOffset,height:e.innerHeight,width:e.innerWidth}}function getElementPosition(e){if(e){for(var t=e.offsetLeft,a=e.offsetTop,n=e.offsetHeight,o=e.offsetWidth;e.offsetParent;)t+=(e=e.offsetParent).offsetLeft,a+=e.offsetTop;return{left:t,top:a,height:n,width:o}}}function elementInViewport(e){if(!e)return!1;var t=getViewport(),a=getElementPosition(e);a.leftHalf=a.left+a.width/2,a.topHalf=a.top+a.height/2;var n=a.leftHalf<t.left+t.width&&a.leftHalf>t.left,o=a.topHalf<t.top+t.height&&a.topHalf>t.top;return n&&o}function shuffle(e){var t,a,n=e.length;if(n)for(;--n;)t=e[a=Math.floor(Math.random()*(n+1))],e[a]=e[n],e[n]=t;return e}function shadeBlendConvert(e,t,a){if("number"!=typeof e||e<-1||e>1||"string"!=typeof t||"r"!=t[0]&&"#"!=t[0]||"string"!=typeof a&&void 0!==a)return null;this.sbcRip||(this.sbcRip=function(e){var t=e.length,a=new Object;if(t>9){if((e=e.split(",")).length<3||e.length>4)return null;a[0]=n(e[0].slice(4)),a[1]=n(e[1]),a[2]=n(e[2]),a[3]=e[3]?parseFloat(e[3]):-1}else{if(8==t||6==t||t<4)return null;t<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?e[4]+""+e[4]:"")),e=n(e.slice(1),16),a[0]=e>>16&255,a[1]=e>>8&255,a[2]=255&e,a[3]=9==t||5==t?o((e>>24&255)/255*1e4)/1e4:-1}return a});var n=parseInt,o=Math.round,r=t.length>9,i=(r="string"==typeof a?a.length>9||"c"==a&&!r:r,e<0),s=(e=i?-1*e:e,a=a&&"c"!=a?a:i?"#000000":"#FFFFFF",sbcRip(t)),c=sbcRip(a);return s&&c?r?"rgb("+o((c[0]-s[0])*e+s[0])+","+o((c[1]-s[1])*e+s[1])+","+o((c[2]-s[2])*e+s[2])+(s[3]<0&&c[3]<0?")":","+(s[3]>-1&&c[3]>-1?o(1e4*((c[3]-s[3])*e+s[3]))/1e4:c[3]<0?s[3]:c[3])+")"):"#"+(4294967296+16777216*(s[3]>-1&&c[3]>-1?o(255*((c[3]-s[3])*e+s[3])):c[3]>-1?o(255*c[3]):s[3]>-1?o(255*s[3]):255)+65536*o((c[0]-s[0])*e+s[0])+256*o((c[1]-s[1])*e+s[1])+o((c[2]-s[2])*e+s[2])).toString(16).slice(s[3]>-1||c[3]>-1?1:3):null}function imgError(e){cl("caught imgError"),e.onerror="",e.removeAttribute("onerror"),e.classList.remove("lazy");var t="https://dw9to29mmj727.cloudfront.net/products/coming_soon.jpg";return e.hasAttribute("data-original")?/^data:image/i.test(e.src)&&(e.src=t):(e.setAttribute("data-original",e.src),e.src=t),!0}function handleSmartBannerClick(e,t){if("undefined"!=typeof singularSdk&&singularSdk){var a="https://viz.sng.link/Dxeio/nii5?_smtype=3";e&&(a="https://viz.sng.link/Dfv2a/gkeu?_smtype=3");var n="",o=t.split("?")[1];o&&(n="_forward_params=1&"+o);var r="",i="";singularSdk.openApp(a,r,n,i)}else document.location.href=t}function showSmartBanner(e,t){var a,n,o,r,i,s=!1;(typeof t==undefined||t<100)&&(t=100),e?(a="Shonen Jump Manga",n="sj-app-icon-square-rounded-360x360-201812.png",o=594237344,r="com.viz.wsj.android"):(a="VIZ Manga",n="vizmanga-app-icon-square-rounded-360x360-201807.png",o=421486286,r="com.vizmanga.android"),setMetaTag("apple-itunes-app","app-id="+o+", affiliate-data=pt=432995&ct=VizSmartBanner"),setMetaTag("google-play-app","app-id="+r),!0===$.browser.mobile&&(i={title:"Read the Biggest Manga Series!",author:a,button:"INSTALL",price:"Free",altLayout:!0,icon:"https://dw9to29mmj727.cloudfront.net/apps/"+n,layer:!0,inAppStore:"Apple Store",inGooglePlay:"Google Store",onInstall:function(){$.smartbanner("trackingEvent","install")},onClose:function(){$.smartbanner("trackingEvent","close")}},$(document).on("open_manga_reader",function(){s=!0,$("#smartbanner.shown").length>0&&$.smartbanner("hide")}),$(document).ready(function(){setTimeout(function(){if(!s&&$.smartbanner(i)){$.smartbanner("trackingEvent","impression");var t=$("a.sb-button","#smartbanner"),a=t.attr("href");t&&a&&t.attr("href","javascript:handleSmartBannerClick("+e+', "'+a+'");')}},t)}))}function reloadReadButtons(e){var t,a,n,o,r,i,s,c,l=[],d=!1,u=$("#reader_button"),f=".read_button_div, .bundle_button_div, .subscribe_button_div";if("function"==typeof isLoggedIn&&isLoggedIn()||(f=".bundle_button_div"),$(e||"body").find(f).not(".static").each(function(){o=$(this),"m"==(n=o.attr("btn_item_type"))&&(n=""),c=o.attr("btn_type")+"-"+n+"-"+o.attr("btn_item_id"),l.push(c)}),r=l.length,u.length&&"function"==typeof getMangaId&&(d=!0),r>0||d)for(i=1,s=1,c="",r>0&&(i=75,s=Math.ceil(1*r/i)),d&&(c="rdr--"+getMangaId()+"_"),t=0;t<s;t++){var p,m;if(r>0)for((p=i*(t+1))>r&&(p=r),a=i*t;a<p;a++)c+=l[a],a<p-1&&(c+="_");m={info:c,current_url:window.location.href},$.ajax({url:"/cart/get_read_buttons",data:m,dataType:"xml"}).done(function(e){$(e).find("reader").each(function(){var e=$(this).find("html").text();$("#reader_button").replaceWith(e)}),$(e).find("buttons").each(function(){var e=$(this).find("replace_id").text(),t=$(this).find("html").text();$("#"+e).replaceWith(t)}),Modals.reset(),$(document).trigger("post_read_buttons"),"function"==typeof customInput&&$("input.custom").customInput()}),c=""}}function reloadSubscribeSection(e,t){var a,n=e||{},o=$("#subscribe_loading");t||o.attr("data-overlay-state","on"),n.current_url=window.location.href,(a=$.ajax({url:"/subscribe",data:n,dataType:"xml"})).done(function(e){$(e).find("section").each(function(){var e=$(this).find("html").text();$("#o_subscribe-content").html(e)}),$(document).trigger("post_subscribe_section")}),a.fail(function(){}),a.always(function(){void 0!==Cart&&Cart.setCheckoutInProgress(!1),o.attr("data-overlay-state","off"),Modals.reset()})}window.jsErrors=[],window.onerror=function(e,t,a,n){window.jsErrors.push(t+":"+a+" ~"+n+' => "'+e+'"')},function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|android|playbook|silk|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),$(document).ajaxError(function(e,t,a,n){var o=$(document),r=t.status,i=t.statusText,s=t.responseText||JSON.stringify(n),c=t.retry_error,l="post_login",d=function(){},u="";"abort"!=i&&c&&(c.ext_login_msg&&(u=c.ext_login_msg),c.callback&&(d=c.callback),o.one(l,d),$("#modal-login .modal-close").one("click",function(){o.off(l)}),440==r?showExpiredSessionLinks(u):401==r?showLoginModal({loginMsg:"Please log in"+u,nosignup:!0}):showErr(i,s))});var confirm_session_expired=function(){var e,t,a=!0,n=!a;return t=function(){$.get("/account/session_remaining_seconds",null,function(e){var o=e.seconds;0==o?(cl("Viz-Session expired..."),$(document).trigger("viz_session_expired"),n=!a):(cl("Session valid, re-check in "+o+" seconds"),setTimeout(t,1e3*o))},"json")},{start:function(o){return isNaN(parseInt(o))?(console.error("Requires integer seconds"),!a):n?!a:(n=a,e=1e3*o,setTimeout(t,e),cl("Watch session status started: "+e),a)}}}(),do_session_expired=function(){var e=window.session_type||"";isFn(window.showFlashWarning)&&showFlashWarning(e+" Session Expired. Please refresh the page and log in again.");var t=function(){showRefresh({title:e+" Session Expired",later:!0})};window.readerOpen&&(window.embedded?(fullScreenExit(),showExpiredSessionLinks(!1),$(".session_expired").off("click").on("click",t)):closeReader()),t(),disable_window_ajax()};!function(e,t){t(function(){refreshLoginLinks(!1);var e=t(document),a=t("#signup_form");init_username_feedback(t("input[name=login]",a),t(".o_login.feedback",a)),e.on("click",".o_requires-login",function(a){var n,o=t(this),r=o.attr("clickfn"),i=o.hasClass("heart-btn"),s=o.hasClass("o_follow-link"),c="1"==o.data("show-signup"),l={};if(a.preventDefault(),cookie_params.prev_login&&(c=!1),r&&(n=new Function(r).bind(this)),i)l={loginMsg:"Please log in to add your favorite",signupMsg:"To add your favorite, sign up for a VIZ account"};else if(s){var d=o.data("follow").msg;l={loginMsg:"Log in to add "+d+" to your favorites",signupMsg:"To add "+d+" to your favorites, sign up for a VIZ account"}}else Object.assign(l,o.data("modal-context"));return t.isEmptyObject(l)&&compactObj(l={loginMsg:o.data("login-msg"),signupMsg:o.data("signup-msg"),confirmationMsg:o.data("confirmation-msg"),signupContext:o.data("signup-context")}),Modals.context=l,isLoggedIn()?r?n():o.trigger("click_if_logged_in"):(showLoginModal(null,c),e.off("post_login"),r?e.on("post_login",n):e.on("post_login",function(){o.trigger("click_if_logged_in")})),!1})})}(0,jQuery),function(e,t,a){t.Following=function(){function n(e){return"on"==e.attr("data-follow-state")}function o(e,t){e.attr("data-follow-state",t?"on":"off")}function r(){t.followPage&&(isLoggedIn()?v||(c(b),FSW[b].ready.done(function(){v++;var e=FSW[b].get();e&&e.isFavorited&&o(g,!0),d(g),s()})):s())}function i(e,t){var a;isFn(e)?a=e():(c(y),a=FSW[y].ready.then(function(){return Object.keys(FSW[y].all())})),a.done(u),isFn(t)&&a.done(t)}function s(){g.removeClass("disp-n"),h.trigger("post_follow_links")}function c(e){if(!FSW[e]){var t={noRealtime:!0,colPath:"series"};e==b?t.docId=g.data("follow").fsId:t.filters=[["isFavorited","==",!0]],FSW[e]=new FirestoreWrap(t)}}function l(a){var r=e(a),i=r.data("follow"),s=!n(r),u=i.type,f="property"==u,p="chapter_series"==u,m={favoriteSource:"web",isFavorited:s};if(f)m.favoriteEntity="property",m.pbPropertyId=i.id;else{if(!p)return;m.favoriteEntity="series",m.mangaSeriesCommonId=i.id}c(b),FSW[b].ready.then(function(){return FSW[b].update(m)}).done(function(e){if(e){var a=VizFirebase.fsUserDoc();if(a.get().syncNeeded||a.update({syncNeeded:!0}),o(r,s),d(r),Tracking.sendEvent({category:(f?"Property":"Chapter Series")+" Follow",action:s?"Follow":"Unfollow",label:t.followLabel||"__undefined__"}),s){var n={action:"follow",dataFields:{type:f?"property":"chapterSeries",typeName:i.eventId,source:"web"}};Tracking.sendIterableEvent(n)}s&&h.trigger(u+"_followed")}else VizFirebase.onfail(" to modify your favorite",function(){l(r)})})}function d(e){e.find("span").addClass("disp-n"),n(e)?e.find(".follow_stop").removeClass("disp-n"):e.find(".follow_start").removeClass("disp-n")}function u(a){var n=[],o=[];t.latest_chapter_meta&&t.vanity_to_ids?(e.each(a,function(e,t){var a;if(!(a=vanity_to_ids[t]))return console.warn("vanity_to_ids does not exist for vanity: "+t),!0;n.push(a.pb_property_id),latest_chapter_meta[a.msc_id]&&o.push(a.msc_id)}),n=n.filter(Boolean),o=o.filter(Boolean),n.length&&(e("#series_followings").html(""),e.each(n,p),gridClassUpdate(e("#series_followings .p-cs-tile"),{2:"g-omega",4:"g-omega--md"})),o.length&&(e("#chapter_followings").html(""),o.sort(function(e,t){var a=latest_chapter_meta[e].ts,n=latest_chapter_meta[t].ts;return a<n?1:a>n?-1:0}),e.each(o,m),gridClassUpdate(e("#chapter_followings .p-cs-tile"),{2:"g-omega",4:"g-omega--md"}),initProductSort({2:"g-omega",4:"g-omega--md"})),lazyLoadImages()):console.error(_+"(tiles | latest_chapter)")}function f(t,a){var n,o,r;return(r=tile_meta[t][a])?(n=e("#template_"+t)[0].content.cloneNode(!0),(o=e(n).find(".p-cs-tile")).find("a:first-child").attr("href",r.href).attr("rel",r.name.replaceAll("&nbsp;"," ")),o.find("img").attr("data-original",r.img_url).attr("alt",""),o.find("div:last-child").html(r.name),o.meta_data=r,o):null}function p(t,a){var n=f("property",a);e("#series_followings").append(n)}function m(t,a){var n,o,r;if(n=latest_chapter_meta[a],o=f("series",a),!n||!o)return!0;(r=o.find(".o_inner-link")).attr("href",n.url+"?action=read"),r.find("span:first-child").html(n.text),r.find("span:last-child").html(n.date),o.attr("data-sort-recent",t+1),o.attr("data-sort-alpha-label",o.meta_data.label),e("#chapter_followings").append(o)}var g,h=e(a),_="Required MetaData is missing: meta/",v=0,y="user_all_fav_series",b="user_one_series";h.ready(function(){g=e(".o_follow-link").first()}),h.on("post_account_links",r),h.on("property_followed chapter_series_followed",function(){if(Modals.context.confirmationMsg){var t="#modal-thanks",a=e(t);if(Modals.isThanksOn()){var n=e("h2",a).html(),o=Modals.context.confirmationMsg;/[.!?]$/.test(o)||(o+="."),e("h2",a).html(n+"<br>"+o)}else Modals.toggle(t),e("h2",a).html(Modals.context.confirmationMsg);Modals.resizeModal()}});var w={init_multi:i,state:n,change:l};return Object.freeze(w),w}()}(jQuery,window,document),$.fn.showForGeo=function(e){e=e||"__";var t=this,a=!1;return"undefined"!=typeof user_main_geo&&["US","GB","IE","AU","NZ","ZA","IN","PH","SG","CA"].includes(user_main_geo)&&(e=user_main_geo),t.find(".o_geo-parent").each(function(t,n){var o=$(n),r=!1;o.find(".o_geo").each(function(t,n){var o,i,s=$(n);return!s.hasClass("c-"+e)||(s.show(),a=r=!0,!(o=s.siblings("img.o_imp.c-"+e)).length||(!(i=o.attr("rel"))||(o.attr("src",i),void o.removeAttr("rel"))))}),r?o.show():o.hide()}),a?t.show():t.hide(),t.attr("show",e),t},$(document).on("post_account_links",function(){$(".o_geo-block").showForGeo()});var showAppsForGeo=function(){var e="__",t={CA:".ca",GB:".co.uk"};if("undefined"!=typeof user_main_geo&&(e=user_main_geo),"CA"==e||"GB"==e){var a=$("#amazonbooklink").attr("href").replace("amazon.com","amazon"+t[e]);$("#amazonbooklink").attr("href",a)}$(".appcontainer").hide(),"__"!=e&&$(".appleLink").each(function(){var t=$(this).attr("href").replace("/us/","/"+e.toLowerCase()+"/");$(this).attr("href",t)}),$(".appcontainer.c-"+e).show()};lazyLoadInfo_common.count=0;var validate=function(){var e,t,a,n,o=0,r=1,i=2;return e=function(e,t){n(e,t,o)},t=function(e,t){n(e,t,i)},a=function(e,t){n(e,t,r)},n=function(e,t,a){var n,o=["color-green","color-orange","color-red"],r=["check","warn","close"];a>=o.length&&(console.warn("feedback type out of range. Defaulting to error."),a=i),isStr(t)&&(t=[t]),r=r.map(function(e){return'<i class="icon-'+e+' mar-r-rg"></i>'}),n=t.map(function(e){return r[a]+e}).join("<br>"),e.removeClass(o.join(" ")+" disp-n"),e.addClass(o[a]),e.html(n)},{login:function(e,a){var n;return e.indexOf(" ")>=0?n="Username must not include spaces":/[^a-zA-Z0-9_]/.test(e)?n="Your Username must only contain letters, numbers and _(underscores)":(e.length<5||e.length>25)&&(n="5 to 25 characters please"),n&&t(a,n),!n},email:function(e,a){var n,o=/^[^@,]+@[^@,]+\.[^@,]+$/;return e.length>64?n="64 characters max":o.test(e)&&"con"!=e.trim().slice(-3)||(n="You must enter a valid email address"),n?t(a,n):a.html(""),!n},max_length:function(e,a){var n=!0,o=e.data("max-length");return o&&e.val().length>o?(t(a,e.attr("name").replace("_"," ")+" limited to "+o+" characters max"),n=!1):a.html(""),n},phone:function(e,a){var n=!0;return/^[0-9()-]+$/.test(e)?a.html(""):(t(a,"You must enter a valid phone number. Allowed characters: 0-9,-,(,)"),n=!1),n},pass:function(e,a,n){n=n||!1;var o=!0,r=e.length;return n&&0==r||r>=6?a.html(""):(t(a,"Password must be at least 6 characters"),o=!1),o},age:function(e,a){var n,o,r,i,s,c,l=!0;return isJQuery(e)?(n=$(".month",e).val(),o=$(".day",e).val(),r=$(".year",e).val()):(n=e[0],o=e[1],r=e[2]),n=parseInt(n),o=parseInt(o),r=parseInt(r),isNaN(o)||isNaN(n)||isNaN(r)?(t(a,"Please enter a valid birthday"),
l=!1):(s=(i=new Date).getDate(),(c=i.getMonth()+1)>n||c==n&&s>=o||r++,i.getFullYear()-r<13?(t(a,"You must be at least 13 years old to continue"),l=!1):a.html("")),l},feedback_ok:e,feedback_err:t,feedback_warn:a}}();Object.freeze(validate),$(function(){$(document).on("post_account_links",function(){reloadReadButtons("")}),initStickyElements(),lazyLoadImages();var e=".btn-primary, .btn-primary-dark, .btn-util-light, .btn-util-dark, .curtain-arrow, #o_account-links-content a, .heart-btn, .o_primary-nav-link, .reader-icon, .o_share-btn-sm, a:not([href]), .o_property-link, .o_site-footer a, .section_chapters a, #comment_link_count, .o_fan-favorites a, .o_fan-favorites-small a",t=$("a").not(e);t.on("touchstart",function(){$(this).addClass("style_underline")}),t.on("touchcancel touchend",function(){$(this).removeClass("style_underline")})}),$(function(){$("body").on("click","a.o_open-reader",function(e){e.preventDefault();var t=$(this),a=+t.data("for-manga"),n=isFn(getMangaId)?getMangaId():-1;window.reader_require_login?showExpiredSessionLinks(" to Open the Reader"):1==window.redirectReader||n!=a?window.location=t.data("display-url")+"?action=read":isFn(openReaderWrapper)&&(isPreview&&dataLayer.push({event:"free-preview-button-clicked"}),openReaderWrapper())})});var VizAnnouncement={isHidden:function(e){var t=getCookie("announcements"),a="#"+e;return t&&t.indexOf(a)>=0},markHidden:function(e){var t=getCookie("announcements"),a="#"+e;t?-1==t.indexOf(a)&&(t+=a):t=a,setCookieDays("announcements",t,365)},runIfVisible:function(e,t){isFn(t)&&t(!VizAnnouncement.isHidden(e))}};$(function(){announcement_ajax(window.announcementType,window.announcementID)}),$.ajaxPrefilter(function(e,t,a){("/"==e.url[0]||e.url.indexOf(location.hostname)>0)&&(/^get$/i.test(e.type)||"undefined"==typeof AUTH_TOKEN||a.setRequestHeader("X-CSRF-Token",AUTH_TOKEN),a.setRequestHeader("X-client-login",String(isLoggedIn())))}),window.jQuery&&(jQuery.version=jQuery().jquery,jQuery.fn.extend({cshow:function(){return this.removeClass("disp-n")},chide:function(){return this.addClass("disp-n")},a_sel:function(e){var t="aria-selected";return e===undefined?"true"==this.attr(t):this.attr(t,!!e)}})),Object.rename_key=function(e,t,a){e[a]=e[t],delete e[t]},Object.size=function(e){return Object.keys(e).length},Array.prototype.unique=function(){var e,t={},a=this.length,n=[];for(e=0;e<a;e+=1)t[this[e]]=this[e];for(e in t)n.push(t[e]);return n},Array.prototype.nsort=function(){return this.sort(function(e,t){return e-t})},updateCookieParams(),window.url_params=parseQuery(document.location.search),setCookieDays=setCookie,String.prototype.wordWrap=function(e,t,a){var n,o,r,i=this.split("\n");if(e>0)for(n in i){for(r=i[n],i[n]="";r.length>e;o=a?e:(o=r.substr(0,e).match(/\S*$/)).input.length-o[0].length||e,i[n]+=r.substr(0,o)+((r=r.substr(o)).length?t:""));i[n]+=r}return i.join("\n")};var ccInfo,initialActions={follow:{evt:"post_follow_links",fn:function(){$(".o_follow-link[data-follow-state=off]").click()}},read:{evt:"post_read_buttons",fn:function(){isFn(doReadAction)&&doReadAction()}},gallery:{fn:function(){$(".btn-gallery").click()}},trailer:{fn:function(){$(".btn-trailer").click()}},newsletter:{fn:function(){0===user_id&&$("#newsletter_footer_signup").click()}},scroll:{fn:function(){var e=this.offset;setTimeout(function(){goToByScroll(url_params.scrollto,e)},1e3)}}};$(document).ready(function(){var e,t,a=url_params.action,n=initialActions;url_params.scrollto&&(a="scroll"),a&&n[a]&&isFn(n[a].fn)&&(e=n[a].evt||"post_account_links",isFn(t=n[a].fn)&&$(this).one(e,t.bind(n[a])))}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(t===undefined||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),Array.prototype.map||(Array.prototype.map=function(e){var t,a,n;if(null==this)throw new TypeError("this is null or not defined");var o=Object(this),r=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),a=new Array(r),n=0;n<r;){var i,s;n in o&&(i=o[n],s=e.call(t,i,n,o),a[n]=s),n++}return a}),function(e,t){t(function(){t(".cart-table").on("change",".o_gift-check",function(){var e=t(this).closest(".cart-table--item"),a=e.data("item-type"),n=e.data("item-id");a&&""!=a&&n&&""!=n&&Cart.markItemAsGift(a,n,this.checked)}).on("click",".cart-table--remove",function(){var e=t(this).closest(".cart-table--item"),a=e.data("item-type"),n=e.data("item-id"),o=t(".o_gift-check",e).get(0),r=o&&o.checked;a&&""!=a&&n&&""!=n&&Cart.removeCartItem(a,n,r)})})}(0,jQuery);var Cart={showFlashMsg:function(e,t){Cart.setCheckoutInProgress(!1),t&&""!=t&&(t=t.replace(/(?:\r\n|\r|\n)/g,"<br>"),showInfo(e,t))},showFlashMsgNoFreeTrial:function(e,t){Cart.setCheckoutInProgress(!1),showInfo("This "+e+" was used already for a free trial",t),$("#modal-err .o_err-msg-feedback").show()},showFlashSuccess:function(e){Cart.showFlashMsg("Success",e)},showFlashError:function(e){Cart.showFlashMsg("Error",e)},showFlashMsgDelay:function(e,t){setTimeout(function(){Cart.showFlashMsg(e,t)},200)},listifyFlashMsg:function(e,t){var a='<ul class="mar-l-lg mar-l-0--lg"><li>'+t.replace(/\n$/,"").replace(/\n/g,"</li><li>")+"</li></ul>";Cart.showFlashMsg(e,a)},modifyBuyButton_adding:function(e){var t,a=e.html();a.match(/read/i)||((t=e.attr("onclick"))&&e.data("action",t),e.removeProp("onclick").removeAttr("onclick").off("click"),e.data("html",a),e.html('<i class="icon-cart"></i>Adding...'))},modifyBuyButton_inCart:function(e){e.html().match(/read/i)||(e.removeProp("onclick").removeAttr("onclick").off("click"),e.addClass("bg-green hover-bg-green").attr("href","/cart").data("html",null),e.html('<i class="icon-cart"></i>In your cart!'))},modifyBuyButton_restore:function(e){e.html().match(/read/i)||(e.removeClass("bg-green").removeClass("hover-bg-green").html(e.data("html")).on("click",new Function(e.data("action"))),e.data("html",null))},modifyBuyButton_disable:function(e){e.html().match(/read/i)||(e.removeProp("onclick").removeAttr("onclick").off("click"),e.removeClass("bg-green").removeClass("hover-bg-green").removeClass("btn-primary").addClass("btn-primary-dark").attr("disabled","disabled").attr("href",null).data("html",null))},updateCardType:function(){var e=$.payment.cardType($("#cc_number").val());$("#ctype").val(e),$(".cc_type").hide(),$(".cc_"+e+"_img").show()},updateCC:function(e){e?($("#update_cc_info").val("true"),$("#cc_info").show(),$("#payment_method_viz").prop("checked","checked"),$("#code_info").show()):($("#update_cc_info").val("false"),$("#cc_info").hide(),$("#code_info").hide())},genericPaymentErrmsg:"Sorry, we're experiencing a problem accessing our payment processor. Please try again later. If you continue to experience this issue please let us know.",addToCart:function(e,t,a){var n,o=".cart_add_"+e+"_"+t;return Cart.modifyBuyButtons(o,Cart.modifyBuyButton_adding),Cart.showShoppingCartLoading(),Tracking.sendEvent(a),(n=$.ajax({method:"POST",url:"/cart/add",data:{product_type:e,id:t},context:document.body})).done(function(e){Cart.updateUiForCart(e)}),n.fail(function(e,t){Cart.showFlashError(e.responseText||t),Cart.modifyBuyButtons(o,Cart.modifyBuyButton_restore),Cart.showShoppingCartCount()}),!1},addGiftToCart:function(e,t,a){Cart.showShoppingCartLoading(),a||(a={category:"Add Gift to Cart",action:"Direct",label:e+" "+t}),Tracking.sendEvent(a);var n=$.ajax({method:"POST",url:"/cart/add",data:{product_type:e,id:t,is_gift:"gift"},context:document.body});return n.done(function(e){Cart.updateUiForCart(e)}),n.fail(function(e,t){Cart.showFlashError(e.responseText||t),Cart.showShoppingCartCount()}),!1},modifyBuyButtons:function(e,t,a,n){var o=!1;return $(e).each(function(){o=!0,void 0===a||void 0===n?t($(this)):t($(this),a,n)}),o},removeCartItem:function(e,t,a){Cart.isCheckoutInProgress()||Cart.setCheckoutInProgress(!0);var n="";n+='<form method="POST" action="/cart/remove">',n+='  <input type="hidden" name="authenticity_token" value="'+AUTH_TOKEN+'">',n+='  <input type="hidden" name="product_type" value="'+e+'">',n+='  <input type="hidden" name="id" value="'+t+'">',a&&(n+='  <input type="hidden" name="is_gift" value="1">'),n+="</form>",$(n).appendTo("body").submit()},markItemAsGift:function(e,t,a){$.ajax({method:"POST",url:"/cart/mark_gift",data:{product_type:e,id:t,is_gift:a?1:0}}).done(function(e){e&&e.do_reload&&window.location.reload(!0)})},updateUiForCart:function(e){cartSummary=e,$.each(cartSummary.mc_id_hash,function(e){Cart.updateUiForCartItem("manga",e)}),$.each(cartSummary.b_id_hash,function(e){Cart.updateUiForCartItem("bundle",e)}),Cart.showShoppingCartCount()},updateUiForCartItem:function(e,t){var a=".cart_add_"+e+"_"+t;return!!Cart.modifyBuyButtons(a,Cart.modifyBuyButton_inCart)&&a},showShoppingCartLoading:function(){var e=$("#cart-count");e.data("num",e.html()),e.prop("hidden","hidden")},showShoppingCartCount:function(){var e=$("#cart-count"),t=1*cartSummary.num_items;t>0?e.html(t).removeProp("hidden"):e.html(0).prop("hidden","hidden"),e.data("num","")},deletePaymentProfile:function(e,t){if(Cart.isCheckoutInProgress())return!1;var a,n,o;a=function(){"object"==typeof Modals&&Modals.close(),Cart.setCheckoutInProgress(!0),(o=$.ajax({url:"/cart/delete_card",type:"POST",dataType:"json"})).done(function(e){1==e.ok?window.location.reload():(n=e.err||"Error deleting payment profile. Please try again later.",Cart.showFlashError(n))}),o.fail(function(e,t,a){Cart.showFlashError(a)})},t?(Cart.setCheckoutInProgress(!1),showConfirmDialog("Delete Payment Method?","Please note that you have an auto-renewing Shonen Jump membership. If we cannot process your next automatic payment, your membership will be canceled. Do you want to continue?","Yes, delete payment info",a,"No, don't delete",null)):a()},validateShippingInfo:function(){var e="";return"true"==$("#shipping_address_entered").val()&&(""==$("#shipping_address_name").val()&&(e+="Please enter a name for shipping.\n"),""==$("#shipping_address").val()&&(e+="Please enter your shipping address.\n"),""==$("#shipping_address_city").val()&&(e+="Please enter your shipping city.\n"),""==$("#shipping_address_state").val()&&(e+="Please enter your shipping state.\n"),""==$("#shipping_address_zip").val()&&(e+="Please enter your shipping zip code.\n")),e},validateCC:function(){var e="",t={},a={};return a.numStr=$("#cc_number").val(),a.expiry={month:$("#cc_expiration_month").val(),year:$("#cc_expiration_year").val()},a.code=$("#card_code").val(),a.type=$("#ctype").val(),a.name=($("#cc_fname").val()+" "+$("#cc_lname").val()).trim(),a.address=$("#cc_address").val(),a.city=$("#cc_city").val(),a.zip=$("#cc_zip").val(),$.payment.validateCardNumber(a.numStr)?$.payment.validateCardCVC(a.code,a.type)||(e+="Please enter a valid card security code.\n"):e+="Please enter a valid credit card number.\n",$.payment.validateCardExpiry(a.expiry.month,a.expiry.year)||(e+="Please enter a valid credit card expiration date.\n"),""==a.name&&(e+="Please enter your name as it appears on the card.\n"),""==a.zip&&(e+="Please enter your billing zip or postal code.\n"),""==e&&(t.number=a.numStr,t.cvc=a.code,t.exp_month=a.expiry.month,t.exp_year=a.expiry.year,t.name=a.name,t.address_zip=a.zip),a.stripeData=t,a.errStr=e,a},sendUpdatedCC:function(e,t,a){var n,o;Cart.isCheckoutInProgress()||Cart.setCheckoutInProgress(!0),Stripe.card.createToken(e,function(e,r){r.error?(n=r.error.message||"There was a problem updating your payment info (e1). Please try again later.",Cart.showFlashError(n)):((o=$.ajax({url:"/cart/add_or_update_card",type:"POST",data:{token:r.id},dataType:"json"})).done(function(e){1==e.ok?t.call():"function"==typeof a?a.call():(n=e.err||"There was a problem updating your payment info (e2). Please try again later.",Cart.showFlashError(n))}),o.fail(function(e,t,n){"function"==typeof a?a.call():Cart.showFlashError(n)}))})},submitCCForm:function(e){var t=Cart.validateCC();if(""!=t.errStr)return Cart.showFlashMsg("Information Missing",t.errStr),!1;Cart.sendUpdatedCC(t.stripeData,function(){"undefined"!=typeof cc_referrer&&cc_referrer?window.location.href=cc_referrer:"function"==typeof e?e():(Tracking.sendEvent({category:"Add Payment Info",action:"Success",label:window.location.pathname}),Cart.showFlashSuccess("Your payment info has been updated."))})},submitCart:function(){var e="",t=$("#promo_code").val();return t&&""!=t&&(/^[A-Za-z0-9]+$/.test(t)||(e+="Promo code should consist of letters and digits.\n")),""==e?document.forms.cart_form.submit():Cart.showFlashError(e),!1},setCheckoutInProgress:function(e){e?($("#overlay_wait").attr("data-overlay-state","on"),checkoutInProgress=!0):($("#overlay_wait").attr("data-overlay-state","off"),checkoutInProgress=!1)},isCheckoutInProgress:function(){}