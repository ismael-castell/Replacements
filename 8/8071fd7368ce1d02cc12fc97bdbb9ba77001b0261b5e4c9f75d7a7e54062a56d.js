!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.zPlayer=t():e.zPlayer=t()}(window,function(){return function(e){function t(t){for(var n,i,o=t[0],a=t[1],s=0,l=[];s<o.length;s++)i=o[s],r[i]&&l.push(r[i][0]),r[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(u&&u(t);l.length;)l.shift()()}var n={},r={0:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise(function(t,i){n=r[e]=[t,i]});t.push(n[2]=o);var a,s=document.getElementsByTagName("head")[0],u=document.createElement("script");u.charset="utf-8",u.timeout=120,i.nc&&u.setAttribute("nonce",i.nc),u.src=function(e){return i.p+""+({}[e]||e)+".min.js"}(e),a=function(t){u.onerror=u.onload=null,clearTimeout(l);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,a=new Error("Loading chunk "+e+" failed.\n("+i+": "+o+")");a.type=i,a.request=o,n[1](a)}r[e]=void 0}};var l=setTimeout(function(){a({type:"timeout",target:u})},12e4);u.onerror=u.onload=a,s.appendChild(u)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://zjs.zadn.vn/zplayer/releases/v1.0.82/",i.oe=function(e){throw console.error(e),e};var o=window.webpackJsonpzPlayer=window.webpackJsonpzPlayer||[],a=o.push.bind(o);o.push=t,o=o.slice();for(var s=0;s<o.length;s++)t(o[s]);var u=a;return i(i.s=32)}([function(e,t,n){var r;"undefined"!=typeof window&&(r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,o),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function l(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},l.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,a),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var d,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,r);break;default:if(!u)for(d=1,u=new Array(f-1);d<f;d++)u[d-1]=arguments[d];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,l=[],c=a.length;s<c;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&l.push(a[s]);l.length?this._events[o]=1===l.length?l[0]:l:u(this,o)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&u(this,t)):(this._events=new o,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,e.exports=l},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,n){var r,i,o,a,s;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):t;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var u=i.exec(a.path);a.netLoc=u[1],a.path=u[2]}a.netLoc&&!a.path&&(a.path="/");var l={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(l.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var c=a.path,f=c.substring(0,c.lastIndexOf("/")+1)+o.path;l.path=s.normalizePath(f)}else l.path=a.path,o.params||(l.params=a.params,o.query||(l.query=a.query));return null===l.path&&(l.path=n.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(l)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},"./node_modules/webworkify-webpack/index.js":function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,r){var s={};s[r]=[];var u=t.toString(),l=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return s;for(var c,f=l[1],d=new RegExp("(\\\\n|\\W)"+a(f)+o,"g");c=d.exec(u);)"dll-reference"!==c[3]&&s[r].push(c[3]);for(d=new RegExp("\\("+a(f)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");c=d.exec(u);)e[c[2]]||(s[r].push(c[1]),e[c[2]]=n(c[1]).m),s[c[2]]=s[c[2]]||[],s[c[2]].push(c[4]);for(var h,p=Object.keys(s),y=0;y<p.length;y++)for(var g=0;g<s[p[y]].length;g++)h=s[p[y]][g],isNaN(1*h)||(s[p[y]][g]=1*s[p[y]][g]);return s}function u(e){return Object.keys(e).reduce(function(t,n){return t||e[n].length>0},!1)}e.exports=function(e,t){t=t||{};var i={main:n.m},o=t.all?{main:Object.keys(i.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};u(n);)for(var o=Object.keys(n),a=0;a<o.length;a++){var l=o[a],c=n[l].pop();if(i[l]=i[l]||{},!i[l][c]&&e[l][c]){i[l][c]=!0,r[l]=r[l]||[],r[l].push(c);for(var f=s(e,e[l][c],l),d=Object.keys(f),h=0;h<d.length;h++)n[d[h]]=n[d[h]]||[],n[d[h]]=n[d[h]].concat(f[d[h]])}}return r}(i,e),a="";Object.keys(o).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"}),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"}))(self);";var l=new window.Blob([a],{type:"text/javascript"});if(t.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),f=new window.Worker(c);return f.objectURL=c,f}},"./src/crypt/decrypter.js":function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),i=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();var o=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],o=n[2],a=n[3],s=this.invSubMix,u=s[0],l=s[1],c=s[2],f=s[3],d=new Uint32Array(256),h=0,p=0,y=0;for(y=0;y<256;y++)d[y]=y<128?y<<1:y<<1^283;for(y=0;y<256;y++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[h]=g,t[g]=h;var v=d[h],m=d[v],b=d[m],_=257*d[g]^16843008*g;r[h]=_<<24|_>>>8,i[h]=_<<16|_>>>16,o[h]=_<<8|_>>>24,a[h]=_,_=16843009*b^65537*m^257*v^16843008*h,u[g]=_<<24|_>>>8,l[g]=_<<16|_>>>16,c[g]=_<<8|_>>>24,f[g]=_,h?(h=v^d[d[d[b^v]]],p^=d[d[p]]):h=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o,a,s,u,l=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),d=this.sBox,h=this.rcon,p=this.invSubMix,y=p[0],g=p[1],v=p[2],m=p[3];for(o=0;o<l;o++)o<i?s=c[o]=t[o]:(u=s,o%i==0?(u=d[(u=u<<8|u>>>24)>>>24]<<24|d[u>>>16&255]<<16|d[u>>>8&255]<<8|d[255&u],u^=h[o/i|0]<<24):i>6&&o%i==4&&(u=d[u>>>24]<<24|d[u>>>16&255]<<16|d[u>>>8&255]<<8|d[255&u]),c[o]=s=(c[o-i]^u)>>>0);for(a=0;a<l;a++)o=l-a,u=3&a?c[o]:c[o-4],f[a]=a<4||o<=4?u:y[d[u>>>24]]^g[d[u>>>16&255]]^v[d[u>>>8&255]]^m[d[255&u]],f[a]=f[a]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n,r){for(var i,o,a,s,u,l,c,f,d,h,p,y,g,v,m,b,_,E=this.keySize+6,k=this.invKeySchedule,A=this.invSBox,w=this.invSubMix,T=w[0],S=w[1],P=w[2],O=w[3],L=this.uint8ArrayToUint32Array_(n),R=L[0],C=L[1],D=L[2],I=L[3],x=new Int32Array(e),M=new Int32Array(x.length),F=this.networkToHostOrderSwap;t<x.length;){for(d=F(x[t]),h=F(x[t+1]),p=F(x[t+2]),y=F(x[t+3]),u=d^k[0],l=y^k[1],c=p^k[2],f=h^k[3],g=4,v=1;v<E;v++)i=T[u>>>24]^S[l>>16&255]^P[c>>8&255]^O[255&f]^k[g],o=T[l>>>24]^S[c>>16&255]^P[f>>8&255]^O[255&u]^k[g+1],a=T[c>>>24]^S[f>>16&255]^P[u>>8&255]^O[255&l]^k[g+2],s=T[f>>>24]^S[u>>16&255]^P[l>>8&255]^O[255&c]^k[g+3],u=i,l=o,c=a,f=s,g+=4;i=A[u>>>24]<<24^A[l>>16&255]<<16^A[c>>8&255]<<8^A[255&f]^k[g],o=A[l>>>24]<<24^A[c>>16&255]<<16^A[f>>8&255]<<8^A[255&u]^k[g+1],a=A[c>>>24]<<24^A[f>>16&255]<<16^A[u>>8&255]<<8^A[255&l]^k[g+2],s=A[f>>>24]<<24^A[u>>16&255]<<16^A[l>>8&255]<<8^A[255&c]^k[g+3],g+=3,M[t]=F(i^R),M[t+1]=F(s^C),M[t+2]=F(a^D),M[t+3]=F(o^I),R=d,C=h,D=p,I=y,t+=4}return r?(m=M.buffer,b=m.byteLength,(_=b&&new DataView(m).getUint8(b-1))?m.slice(0,b-_):m):M.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),a=n("./src/errors.ts"),s=n("./src/utils/logger.js"),u=n("./src/events.js"),l=n("./src/utils/get-self-scope.js"),c=Object(l.getSelfScope)(),f=function(){function e(e,t,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=i,i)try{var o=c.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,n,a){var u=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(s.logger.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new o),l.expandKey(t),a(l.decrypt(e,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(s.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var c=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new i(c,t)),this.fastAesKey.expandKey().then(function(i){new r(c,n).decrypt(e,i).catch(function(r){u.onWebCryptoError(r,e,t,n,a)}).then(function(e){a(e)})}).catch(function(r){u.onWebCryptoError(r,e,t,n,a)})}},t.onWebCryptoError=function(e,t,n,r,i){this.config.enableSoftwareAES?(s.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,r,i)):(s.logger.error("decrypting error : "+e.message),this.observer.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=f},"./src/demux/demuxer-inline.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.js"),i=n("./src/errors.ts"),o=n("./src/crypt/decrypter.js"),a=n("./src/polyfills/number.js"),s=n("./src/utils/logger.js"),u=n("./src/utils/get-self-scope.js");function l(e,t){return 255===e[t]&&240==(246&e[t+1])}function c(e,t){return 1&e[t+1]?7:9}function f(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function d(e,t){return!!(t+1<e.length&&l(e,t))}function h(e,t){if(d(e,t)){var n=c(e,t);if(t+n>=e.length)return!1;var r=f(e,t);if(r<=n)return!1;var i=t+r;if(i===e.length||i+1<e.length&&l(e,i))return!0}return!1}function p(e,t,n,o,a){if(!e.samplerate){var u=function(e,t,n,o){var a,u,l,c,f,d=navigator.userAgent.toLowerCase(),h=o,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(a=1+((192&t[n+2])>>>6),!((u=(60&t[n+2])>>>2)>p.length-1))return c=(1&t[n+2])<<2,c|=(192&t[n+3])>>>6,s.logger.log("manifest codec:"+o+",ADTS data:type:"+a+",sampleingIndex:"+u+"["+p[u]+"Hz],channelConfig:"+c),/firefox/i.test(d)?u>=6?(a=5,f=new Array(4),l=u-3):(a=2,f=new Array(2),l=u):-1!==d.indexOf("android")?(a=2,f=new Array(2),l=u):(a=5,f=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&u>=6?l=u-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(u>=6&&1===c||/vivaldi/i.test(d))||!o&&1===c)&&(a=2,f=new Array(2)),l=u)),f[0]=a<<3,f[0]|=(14&u)>>1,f[1]|=(1&u)<<7,f[1]|=c<<3,5===a&&(f[1]|=(14&l)>>1,f[2]=(1&l)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:p[u],channelCount:c,codec:"mp4a.40."+a,manifestCodec:h};e.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u})}(t,n,o,a);e.config=u.config,e.samplerate=u.samplerate,e.channelCount=u.channelCount,e.codec=u.codec,e.manifestCodec=u.manifestCodec,s.logger.log("parsed codec:"+e.codec+",rate:"+u.samplerate+",nb channel:"+u.channelCount)}}function y(e){return 9216e4/e}function g(e,t,n,r,i){var o=function(e,t,n,r,i){var o,a,s=e.length;if(o=c(e,t),a=f(e,t),(a-=o)>0&&t+o+a<=s)return{headerLength:o,frameLength:a,stamp:n+r*i}}(t,n,r,i,y(e.samplerate));if(o){var a=o.stamp,s=o.headerLength,u=o.frameLength,l={unit:t.subarray(n+s,n+s+u),pts:a,dts:a};return e.samples.push(l),{sample:l,length:u+s}}}var v=n("./src/demux/id3.js"),m=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(v.default.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(h(e,t))return s.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=this._audioTrack,o=v.default.getID3Data(e,0)||[],u=v.default.getTimeStamp(o),l=Object(a.isFiniteNumber)(u)?90*u:9e4*t,c=0,f=l,h=e.length,y=o.length,m=[{pts:f,dts:f,data:o}];y<h-1;)if(d(e,y)&&y+5<h){p(i,this.observer,e,y,i.manifestCodec);var b=g(i,e,y,l,c);if(!b){s.logger.log("Unable to parse AAC frame");break}y+=b.length,f=b.sample.pts,c++}else v.default.isHeader(e,y)?(o=v.default.getID3Data(e,y),m.push({pts:f,dts:f,data:o}),y+=o.length):y++;this.remuxer.remux(i,{samples:[]},{samples:m,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),b=n("./src/demux/mp4demuxer.js"),_={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,r,i){if(!(n+24>t.length)){var o=this.parseHeader(t,n);if(o&&n+o.frameLength<=t.length){var a=r+i*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:t.subarray(n,n+o.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),{sample:s,length:o.frameLength}}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,o=e[t+2]>>2&3,a=e[t+2]>>1&1;if(1!==n&&0!==i&&15!==i&&3!==o){var s=3===n?3-r:3===r?3:4,u=1e3*_.BitratesMap[14*s+i-1],l=3===n?0:2===n?1:2,c=_.SamplingRateMap[3*l+o],f=e[t+3]>>6==3?1:2,d=_.SamplesCoefficients[n][r],h=_.BytesInSlot[r],p=8*d*h;return{sampleRate:c,channelCount:f,frameLength:parseInt(d*u/c+a,10)*h,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n=this.parseHeader(e,t),r=4;n&&n.frameLength&&(r=n.frameLength);var i=t+r;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}},E=_,k=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){var t,n=8,r=8;for(t=0;t<e;t++)0!==r&&(r=(n+this.readEG()+256)%256),n=0===r?n:r},t.readSPS=function(){var e,t,n,r,i,o,a,s=0,u=0,l=0,c=0,f=this.readUByte.bind(this),d=this.readBits.bind(this),h=this.readUEG.bind(this),p=this.readBoolean.bind(this),y=this.skipBits.bind(this),g=this.skipEG.bind(this),v=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(f(),e=f(),d(5),y(3),f(),v(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var b=h();if(3===b&&y(1),v(),v(),y(1),p())for(o=3!==b?8:12,a=0;a<o;a++)p()&&m(a<6?16:64)}v();var _=h();if(0===_)h();else if(1===_)for(y(1),g(),g(),t=h(),a=0;a<t;a++)g();v(),y(1),n=h(),r=h(),0===(i=d(1))&&y(1),y(1),p()&&(s=h(),u=h(),l=h(),c=h());var E=[1,1];if(p()&&p())switch(f()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[f()<<8|f(),f()<<8|f()]}return{width:Math.ceil(16*(n+1)-2*s-2*u),height:(2-i)*(r+1)*16-(i?2:4)*(l+c),pixelRatio:E}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),A=function(){function e(e,t,n,r){this.decryptdata=n,this.discardEPB=r,this.decrypter=new o.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,n,r){var i=e[t].unit,o=i.subarray(16,i.length-i.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),s=this;this.decryptBuffer(a,function(o){o=new Uint8Array(o),i.set(o,16),r||s.decryptAacSamples(e,t+1,n)})},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<=e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(t.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,n,r,i,o){var a=this.discardEPB(i.data),s=this.getAvcEncryptedData(a),u=this;this.decryptBuffer(s.buffer,function(s){i.data=u.getAvcDecryptedUnit(a,s),o||u.decryptAvcSamples(e,t,n+1,r)})},t.decryptAvcSamples=function(e,t,n,r){for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var o=i[n];if(!(o.data.length<=48||1!==o.type&&5!==o.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,o,a),!a)return}}}},e}(),w={video:1,audio:2,id3:3,text:4},T=function(){function e(e,t,n,r){this.observer=e,this.config=n,this.typeSupported=r,this.remuxer=t,this.sampleAes=null,this.pmtUnknownTypes={}}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new A(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var n=e._syncOffset(t);return!(n<0)&&(n&&s.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:w[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.append=function(t,n,o,a){var u,l,c,f,d,h=t.length,p=!1;this.pmtUnknownTypes={},this.contiguous=o;var y=this.pmtParsed,g=this._avcTrack,v=this._audioTrack,m=this._id3Track,b=g.pid,_=v.pid,E=m.pid,k=this._pmtId,A=g.pesData,w=v.pesData,T=m.pesData,S=this._parsePAT,P=this._parsePMT.bind(this),O=this._parsePES,L=this._parseAVCPES.bind(this),R=this._parseAACPES.bind(this),C=this._parseMPEGPES.bind(this),D=this._parseID3PES.bind(this),I=e._syncOffset(t);for(h-=(h+I)%188,u=I;u<h;u+=188)if(71===t[u]){if(l=!!(64&t[u+1]),c=((31&t[u+1])<<8)+t[u+2],(48&t[u+3])>>4>1){if((f=u+5+t[u+4])===u+188)continue}else f=u+4;switch(c){case b:l&&(A&&(d=O(A))&&L(d,!1),A={data:[],size:0}),A&&(A.data.push(t.subarray(f,u+188)),A.size+=u+188-f);break;case _:l&&(w&&(d=O(w))&&(v.isAAC?R(d):C(d)),w={data:[],size:0}),w&&(w.data.push(t.subarray(f,u+188)),w.size+=u+188-f);break;case E:l&&(T&&(d=O(T))&&D(d),T={data:[],size:0}),T&&(T.data.push(t.subarray(f,u+188)),T.size+=u+188-f);break;case 0:l&&(f+=t[f]+1),k=this._pmtId=S(t,f);break;case k:l&&(f+=t[f]+1);var x=P(t,f,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(b=x.avc)>0&&(g.pid=b),(_=x.audio)>0&&(v.pid=_,v.isAAC=x.isAAC),(E=x.id3)>0&&(m.pid=E),p&&!y&&(s.logger.log("reparse from beginning"),p=!1,u=I-188),y=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});A&&(d=O(A))?(L(d,!0),g.pesData=null):g.pesData=A,w&&(d=O(w))?(v.isAAC?R(d):C(d),v.pesData=null):(w&&w.size&&s.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=w),T&&(d=O(T))?(D(d),m.pesData=null):m.pesData=T,null==this.sampleAes?this.remuxer.remux(v,g,m,this._txtTrack,n,o,a):this.decryptAndRemux(v,g,m,this._txtTrack,n,o,a)},t.decryptAndRemux=function(e,t,n,r,i,o,a){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){s.decryptAndRemuxAvc(e,t,n,r,i,o,a)})}else this.decryptAndRemuxAvc(e,t,n,r,i,o,a)},t.decryptAndRemuxAvc=function(e,t,n,r,i,o,a){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){s.remuxer.remux(e,t,n,r,i,o,a)})}else this.remuxer.remux(e,t,n,r,i,o,a)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._trackUnknownPmt=function(e,t,n){var r=this.pmtUnknownTypes[e]||0;return 0===r&&(this.pmtUnknownTypes[e]=0,t.call(s.logger,n)),this.pmtUnknownTypes[e]++,r},t._parsePMT=function(e,t,n,r){var i,o,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){this._trackUnknownPmt(e[t],s.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===a.audio&&(a.audio=o);break;case 21:-1===a.id3&&(a.id3=o);break;case 219:if(!r){this._trackUnknownPmt(e[t],s.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===a.avc&&(a.avc=o);break;case 3:case 4:n?-1===a.audio&&(a.audio=o,a.isAAC=!1):this._trackUnknownPmt(e[t],s.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(e[t],s.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(e[t],s.logger.log,"Unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a},t._parsePES=function(e){var t,n,r,i,o,a,u,l,c=0,f=e.data;if(!e||0===e.size)return null;for(;f[0].length<19&&f.length>1;){var d=new Uint8Array(f[0].length+f[1].length);d.set(f[0]),d.set(f[1],f[0].length),f[0]=d,f.splice(1,1)}if(1===((t=f[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;if(192&(n=t[7])&&(a=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&n?a-(u=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(s.logger.warn(Math.round((a-u)/9e4)+"s delta between PTS and DTS, align them"),a=u):u=a),l=(i=t[8])+9,e.size<=l)return null;e.size-=l,o=new Uint8Array(e.size);for(var h=0,p=f.length;h<p;h++){var y=(t=f[h]).byteLength;if(l){if(l>y){l-=y;continue}t=t.subarray(l),y-=l,l=0}o.set(t,c),c+=y}return r&&(r-=i+3),{data:o,pts:a,dts:u,len:r}}return null},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var n=t.samples,r=n.length;if(isNaN(e.pts)){if(!r)return void t.dropped++;var i=n[r-1];e.pts=i.pts,e.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,n.push(e)):t.dropped++}e.debug.length&&s.logger.log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){var n,r,i,o=this,a=this._avcTrack,s=this._parseAVCNALu(e.data),u=this.avcSample,l=!1,c=this.pushAccesUnit.bind(this),f=function(e,t,n,r){return{key:e,pts:t,dts:n,units:[],debug:r}};e.data=null,u&&s.length&&!a.audFound&&(c(u,a),u=this.avcSample=f(!1,e.pts,e.dts,"")),s.forEach(function(t){switch(t.type){case 1:r=!0,u||(u=o.avcSample=f(!0,e.pts,e.dts,"")),u.frame=!0;var s=t.data;if(l&&s.length>4){var d=new k(s).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(u.key=!0)}break;case 5:r=!0,u||(u=o.avcSample=f(!0,e.pts,e.dts,"")),u.key=!0,u.frame=!0;break;case 6:r=!0,(n=new k(o.discardEPB(t.data))).readUByte();for(var h=0,p=0,y=!1,g=0;!y&&n.bytesAvailable>1;){h=0;do{h+=g=n.readUByte()}while(255===g);p=0;do{p+=g=n.readUByte()}while(255===g);if(4===h&&0!==n.bytesAvailable){if(y=!0,181===n.readUByte())if(49===n.readUShort())if(1195456820===n.readUInt())if(3===n.readUByte()){var m=n.readUByte(),b=31&m,_=[m,n.readUByte()];for(i=0;i<b;i++)_.push(n.readUByte()),_.push(n.readUByte()),_.push(n.readUByte());o._insertSampleInOrder(o._txtTrack.samples,{type:3,pts:e.pts,bytes:_})}}else if(5===h&&0!==n.bytesAvailable){if(y=!0,p>16){var E=[];for(i=0;i<16;i++)E.push(n.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||E.push("-");var A=p-16,w=new Uint8Array(A);for(i=0;i<A;i++)w[i]=n.readUByte();o._insertSampleInOrder(o._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:E.join(""),userDataBytes:w,userData:Object(v.utf8ArrayToStr)(w.buffer)})}}else if(p<n.bytesAvailable)for(i=0;i<p;i++)n.readUByte()}break;case 7:if(r=!0,l=!0,!a.sps){var T=(n=new k(t.data)).readSPS();a.width=T.width,a.height=T.height,a.pixelRatio=T.pixelRatio,a.sps=[t.data],a.duration=o._duration;var S=t.data.subarray(1,4),P="avc1.";for(i=0;i<3;i++){var O=S[i].toString(16);O.length<2&&(O="0"+O),P+=O}a.codec=P}break;case 8:r=!0,a.pps||(a.pps=[t.data]);break;case 9:r=!1,a.audFound=!0,u&&c(u,a),u=o.avcSample=f(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&r&&u.units.push(t)}),t&&u&&(c(u,a),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var n=this._avcTrack.samples;t=n[n.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},t._parseAVCNALu=function(e){var t,n,r,i,o=0,a=e.byteLength,s=this._avcTrack,u=s.naluState||0,l=u,c=[],f=-1;for(-1===u&&(f=0,i=31&e[0],u=0,o=1);o<a;)if(t=e[o++],u)if(1!==u)if(t)if(1===t){if(f>=0)r={data:e.subarray(f,o-u-1),type:i},c.push(r);else{var d=this._getLastNalUnit();if(d&&(l&&o<=4-l&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-l)),(n=o-u-1)>0)){var h=new Uint8Array(d.data.byteLength+n);h.set(d.data,0),h.set(e.subarray(0,n),d.data.byteLength),d.data=h}}o<a?(f=o,i=31&e[o],u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(f>=0&&u>=0&&(r={data:e.subarray(f,a),type:i,state:u},c.push(r)),0===c.length){var p=this._getLastNalUnit();if(p){var y=new Uint8Array(p.data.byteLength+e.byteLength);y.set(p.data,0),y.set(e,p.data.byteLength),p.data=y}}return s.naluState=u,c},t.discardEPB=function(e){for(var t,n,r=e.byteLength,i=[],o=1;o<r-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(i.push(o+2),o+=2):o++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===i[0]&&(a++,i.shift()),n[o]=e[a];return n},t._parseAACPES=function(e){var t,n,o,a,u,l,c,f=this._audioTrack,h=e.data,v=e.pts,m=this.aacOverFlow,b=this.aacLastPTS;if(m){var _=new Uint8Array(m.byteLength+h.byteLength);_.set(m,0),_.set(h,m.byteLength),h=_}for(o=0,u=h.length;o<u-1&&!d(h,o);o++);if(o&&(o<u-1?(l="AAC PES did not start with ADTS header,offset:"+o,c=!1):(l="no ADTS header found in AAC PES",c=!0),s.logger.warn("parsing error:"+l),this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:c,reason:l}),c))return;if(p(f,this.observer,h,o,this.audioCodec),n=0,t=y(f.samplerate),m&&b){var E=b+t;Math.abs(E-v)>1&&(s.logger.log("AAC: align PTS for overlapping frames by "+Math.round((E-v)/90)),v=E)}for(;o<u;){if(d(h,o)){if(o+5<u){var k=g(f,h,o,v,n);if(k){o+=k.length,a=k.sample.pts,n++;continue}}break}o++}m=o<u?h.subarray(o,u):null,this.aacOverFlow=m,this.aacLastPTS=a},t._parseMPEGPES=function(e){for(var t=e.data,n=t.length,r=0,i=0,o=e.pts;i<n;)if(E.isHeader(t,i)){var a=E.appendFrame(this._audioTrack,t,i,o,r);if(!a)break;i+=a.length,r++}else i++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),S=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,n,r=v.default.getID3Data(e,0);if(r&&void 0!==v.default.getTimeStamp(r))for(t=r.length,n=Math.min(e.length-1,t+100);t<n;t++)if(E.probe(e,t))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=v.default.getID3Data(e,0)||[],o=v.default.getTimeStamp(i),a=void 0!==o?90*o:9e4*t,s=i.length,u=e.length,l=0,c=0,f=this._audioTrack,d=[{pts:a,dts:a,data:i}];s<u;)if(E.isHeader(e,s)){var h=E.appendFrame(f,e,s,a,l);if(!h)break;s+=h.length,c=h.sample.pts,l++}else v.default.isHeader(e,s)?(i=v.default.getID3Data(e,s),d.push({pts:c,dts:c,data:i}),s+=i.length):s++;this.remuxer.remux(f,{samples:[]},{samples:d,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),P=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),O=Math.pow(2,32)-1,L=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,u,a,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,o=i;i--;)r+=n[i].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<o;i++)t.set(n[i],r),r+=n[i].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var r=Math.floor(n/(O+1)),i=Math.floor(n%(O+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var r=Math.floor(n/(O+1)),i=Math.floor(n%(O+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,o)},e.sdtp=function(t){var n,r,i=t.samples||[],o=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,o[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,o)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n,r,i,o=[],a=[];for(n=0;n<t.sps.length;n++)i=(r=t.sps[n]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)i=(r=t.pps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|t.sps.length].concat(o).concat([t.pps.length]).concat(a))),u=t.width,l=t.height,c=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,f>>24,f>>16&255,f>>8&255,255&f])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,o=t.height,a=Math.floor(r/(O+1)),s=Math.floor(r%(O+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))},e.traf=function(t,n){var r=e.sdtp(t),i=t.id,o=Math.floor(n/(O+1)),a=Math.floor(n%(O+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,o,a,s,u,l=t.samples||[],c=l.length,f=12+16*c,d=new Uint8Array(f);for(n+=8+f,d.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)o=(i=l[r]).duration,a=i.size,s=i.flags,u=i.cts,d.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,d)},e.initSegment=function(t){e.types||e.init();var n,r=e.moov(t);return(n=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}(),R=9e4;function C(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=e*t*n;return r?Math.round(i):i}function D(e,t){return void 0===t&&(t=!1),C(e,1e3,1/R,t)}function I(e,t){return void 0===t&&(t=1),C(e,R,1/t)}var x=I(10),M=I(.2),F=null;function N(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}var U,j=function(){function e(e,t,n,r){if(this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===F){var i=navigator.userAgent.match(/Chrome\/(\d+)/i);F=i?parseInt(i[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,n=e.reduce(function(e,n){var r=n.pts-e;return r<-4294967296?(t=!0,N(e,n.pts)):r>0?e:n.pts},e[0].pts);return t&&s.logger.debug("PTS rollover detected"),n},t.remux=function(e,t,n,i,o,a,u){if(this.ISGenerated||this.generateIS(e,t,o),this.ISGenerated){var l=e.samples.length,c=t.samples.length,f=o,d=o;if(l&&c){var h=this.getVideoStartPts(t.samples),p=(N(e.samples[0].pts,h)-h)/t.inputTimeScale;f+=Math.max(0,p),d+=Math.max(0,-p)}if(l){e.timescale||(s.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,o));var y,g=this.remuxAudio(e,f,a,u);if(c)g&&(y=g.endPTS-g.startPTS),t.timescale||(s.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,o)),this.remuxVideo(t,d,a,y)}else if(c){var v=this.remuxVideo(t,d,a,0,u);v&&e.codec&&this.remuxEmptyAudio(e,f,a,v)}}n.samples.length&&this.remuxID3(n,o),i.samples.length&&this.remuxText(i,o),this.observer.trigger(r.default.FRAG_PARSED)},t.generateIS=function(e,t,n){var o,a,u=this.observer,l=e.samples,c=t.samples,f=this.typeSupported,d="audio/mp4",h={},p={tracks:h},y=void 0===this._initPTS;if(y&&(o=a=1/0),e.config&&l.length&&(e.timescale=e.samplerate,s.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(f.mpeg?(d="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3")),h.audio={container:d,codec:e.codec,initSegment:!e.isAAC&&f.mpeg?new Uint8Array:L.initSegment([e]),metadata:{channelCount:e.channelCount}},y&&(o=a=l[0].pts-Math.round(e.inputTimeScale*n))),t.sps&&t.pps&&c.length){var g=t.inputTimeScale;if(t.timescale=g,h.video={container:"video/mp4",codec:t.codec,initSegment:L.initSegment([t]),metadata:{width:t.width,height:t.height}},y){var v=this.getVideoStartPts(c),m=Math.round(g*n);a=Math.min(a,N(c[0].dts,v)-m),o=Math.min(o,v-m),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:o})}}else y&&h.audio&&this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:o});Object.keys(h).length?(u.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,y&&(this._initPTS=o,this._initDTS=a)):u.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,n,o){var a,u,l,c,f,d=e.timescale,h=e.samples,p=[],y=h.length,g=this._initPTS,v=8,m=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,_=0,E=!1,k=this.nextAvcDts;if(0!==y){if(!n)k=t*d-(h[0].pts-N(h[0].dts,h[0].pts));for(var A=0;A<y;A++){var w=h[A];w.pts=N(w.pts-g,k),w.dts=N(w.dts-g,k),w.dts>w.pts&&(_=Math.max(Math.min(_,w.pts-w.dts),-1*M)),w.dts<h[A>0?A-1:A].dts&&(E=!0)}E&&h.sort(function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r||e.id-t.id}),c=h[0].dts,f=h[y-1].dts;var T=Math.round((f-c)/(y-1));if(_<0){if(_<-2*T){s.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+D(-T,!0)+" ms");for(var S=_,P=0;P<y;P++)h[P].dts=S=Math.max(S,h[P].pts-T),h[P].pts=Math.max(S,h[P].pts)}else{s.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+D(_,!0)+" ms to overcome this issue");for(var O=0;O<y;O++)h[O].dts=h[O].dts+_}c=h[0].dts,f=h[y-1].dts}if(n){var R=c-k,C=R>T;if(C||R<-1){C?s.logger.warn("AVC: "+D(R,!0)+" ms ("+R+"dts) hole between fragments detected, filling it"):s.logger.warn("AVC: "+D(-R,!0)+" ms ("+R+"dts) overlapping between fragments detected"),c=k;var I=h[0].pts-R;h[0].dts=c,h[0].pts=I,s.logger.log("Video: First PTS/DTS adjusted: "+D(I,!0)+"/"+D(c,!0)+", delta: "+D(R,!0)+" ms")}}F&&F<75&&(c=Math.max(0,c));for(var x=0,U=0,j=0;j<y;j++){for(var B=h[j],Y=B.units,G=Y.length,V=0,H=0;H<G;H++)V+=Y[H].data.length;U+=V,x+=G,B.length=V,B.dts=Math.max(B.dts,c),B.pts=Math.max(B.pts,B.dts,0),m=Math.min(B.pts,m),b=Math.max(B.pts,b)}f=h[y-1].dts;var K=U+4*x+8;try{u=new Uint8Array(K)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:K,reason:"fail allocating video mdat "+K})}var z=new DataView(u.buffer);z.setUint32(0,K),u.set(L.types.mdat,4);for(var W=0;W<y;W++){for(var q,X=h[W],$=X.units,Q=0,J=0,Z=$.length;J<Z;J++){var ee=$[J],te=ee.data,ne=ee.data.byteLength;z.setUint32(v,ne),v+=4,u.set(te,v),v+=ne,Q+=4+ne}if(W<y-1)a=h[W+1].dts-X.dts;else{var re=this.config,ie=X.dts-h[W>0?W-1:W].dts;if(re.stretchShortVideoTrack){var oe=re.maxBufferHole,ae=Math.floor(oe*d),se=(o?m+o*d:this.nextAudioPts)-X.pts;se>ae?((a=se-ie)<0&&(a=ie),s.logger.log("It is approximately "+D(se,!1)+" ms to the next segment; using duration "+D(a,!1)+" ms for the last video frame.")):a=ie}else a=ie}q=Math.round(X.pts-X.dts),p.push({size:Q,duration:a,cts:q,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:X.key?2:1,isNonSync:X.key?0:1}})}this.nextAvcDts=f+a;var ue=e.dropped;if(e.nbNalu=0,e.dropped=0,p.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var le=p[0].flags;le.dependsOn=2,le.isNonSync=0}e.samples=p,l=L.moof(e.sequenceNumber++,c,e),e.samples=[];var ce={data1:l,data2:u,startPTS:m/d,endPTS:(b+a)/d,startDTS:c/d,endDTS:this.nextAvcDts/d,type:"video",hasAudio:!1,hasVideo:!0,nb:p.length,dropped:ue};return this.observer.trigger(r.default.FRAG_PARSING_DATA,ce),ce}},t.remuxAudio=function(e,t,n,o){var a,u,l,c,f,d,h=e.inputTimeScale,p=e.timescale,y=h/p,g=(e.isAAC?1024:1152)*y,v=this._initPTS,m=!e.isAAC&&this.typeSupported.mpeg,b=m?0:8,_=e.samples,E=[],k=this.nextAudioPts;if(n|=_.length&&k&&(o&&Math.abs(t-k/h)<.1||Math.abs(_[0].pts-k-v)<20*g),_.forEach(function(e){e.pts=e.dts=N(e.pts-v,t*h)}),0!==(_=_.filter(function(e){return e.pts>=0})).length){if(n||(k=o?Math.max(0,t*h):_[0].pts),e.isAAC)for(var A=this.config.maxAudioFramesDrift,w=0,T=k;w<_.length;){var S=_[w],O=S.pts,R=O-T;if(R<=-A*g)n||w>0?(s.logger.warn("Dropping 1 audio frame @ "+D(T,!0)/1e3+"s due to "+D(R,!0)+" ms overlap."),_.splice(w,1)):(s.logger.warn("Audio frame @ "+D(O,!0)/1e3+"s overlaps nextAudioPts by "+D(R,!0)+" ms."),T=O+g,w++);else if(R>=A*g&&R<x&&T){var C=Math.round(R/g);s.logger.warn("Injecting "+C+" audio frames @ "+D(T,!0)/1e3+"s due to "+D(R,!0)+" ms gap.");for(var I=0;I<C;I++){var M=Math.max(T,0);(u=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),u=S.unit.subarray()),_.splice(w,0,{unit:u,pts:M,dts:M}),T+=g,w++}S.pts=S.dts=T,T+=g,w++}else Math.abs(R),S.pts=S.dts=T,T+=g,w++}for(var F=_.length,U=0;F--;)U+=_[F].unit.byteLength;for(var j=0,B=_.length;j<B;j++){var Y=_[j],G=Y.unit,V=Y.pts;if(void 0!==d&&a)a.duration=Math.round((V-d)/y);else{var H=V-k,K=0;if(n&&e.isAAC&&H){if(H>0&&H<x)K=Math.round((V-k)/g),s.logger.log(D(H,!0)+" ms hole between AAC samples detected,filling it"),K>0&&((u=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(u=G.subarray()),U+=K*u.length);else if(H<-12){s.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+D(k,!0)+" ms / "+D(V,!0)+" ms / "+D(-H,!0)+" ms"),U-=G.byteLength;continue}V=k}if(f=V,!(U>0))return;U+=b;try{l=new Uint8Array(U)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating audio mdat "+U})}m||(new DataView(l.buffer).setUint32(0,U),l.set(L.types.mdat,4));for(var z=0;z<K;z++)(u=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),u=G.subarray()),l.set(u,b),b+=u.byteLength,a={size:u.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(a)}l.set(G,b);var W=G.byteLength;b+=W,a={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(a),d=V}var q=0;if((F=E.length)>=2&&(q=E[F-2].duration,a.duration=q),F){this.nextAudioPts=k=d+y*q,e.samples=E,c=m?new Uint8Array:L.moof(e.sequenceNumber++,f/y,e),e.samples=[];var X=f/h,$=k/h,Q={data1:c,data2:l,startPTS:X,endPTS:$,startDTS:X,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:F};return this.observer.trigger(r.default.FRAG_PARSING_DATA,Q),Q}return null}},t.remuxEmptyAudio=function(e,t,n,r){var i=e.inputTimeScale,o=i/(e.samplerate?e.samplerate:i),a=this.nextAudioPts,u=(void 0!==a?a:r.startDTS*i)+this._initDTS,l=r.endDTS*i+this._initDTS,c=1024*o,f=Math.ceil((l-u)/c),d=P.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(s.logger.warn("remux empty Audio"),d){for(var h=[],p=0;p<f;p++){var y=u+p*c;h.push({unit:d,pts:y,dts:y})}e.samples=h,this.remuxAudio(e,t,n)}else s.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e,t){var n=e.samples.length;if(n){for(var i=e.inputTimeScale,o=this._initPTS,a=this._initDTS,s=0;s<n;s++){var u=e.samples[s];u.pts=N(u.pts-o,t*i)/i,u.dts=N(u.dts-a,t*i)/i}this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:e.samples}),e.samples=[]}},t.remuxText=function(e,t){var n=e.samples.length,i=e.inputTimeScale,o=this._initPTS;if(n){for(var a=0;a<n;a++){var s=e.samples[a];s.pts=N(s.pts-o,t*i)/i}e.samples.sort(function(e,t){return e.pts-t.pts}),this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e}(),B=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,n,i,o,a,s,u){var l=this.observer,c="";e&&(c+="audio"),t&&(c+="video"),l.trigger(r.default.FRAG_PARSING_DATA,{data1:u,startPTS:o,startDTS:o,type:c,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),l.trigger(r.default.FRAG_PARSED)},e}(),Y=Object(u.getSelfScope)();try{U=Y.performance.now.bind(Y.performance)}catch(e){s.logger.debug("Unable to use Performance API on this environment"),U=Y.Date.now}var G=function(){function e(e,t,n,r){this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,n,i,a,s,u,l,c,f,d,h){var p=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var y=this.decrypter;null==y&&(y=this.decrypter=new o.default(this.observer,this.config));var g=U();y.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var o=U();p.observer.trigger(r.default.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:o}}),p.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,a,s,u,l,c,f,d,h)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,a,s,u,l,c,f,d,h)},t.pushDecrypted=function(e,t,n,o,a,s,u,l,c,f,d,h){var p=this.demuxer,y=this.remuxer;if(!p||u||l){for(var g,v=this.observer,_=this.typeSupported,E=this.config,k=[{demux:T,remux:j},{demux:b.default,remux:B},{demux:m,remux:j},{demux:S,remux:j}],A=0,w=k.length;A<w&&!(g=k[A]).demux.probe(e);A++);if(!g)return void v.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});y&&y instanceof g.remux||(y=new g.remux(v,E,_,this.vendor)),p&&p instanceof g.demux||(p=new g.demux(v,y,E,_),this.probe=g.demux.probe),this.demuxer=p,this.remuxer=y}(u||l)&&(p.resetInitSegment(n,o,a,f),y.resetInitSegment()),u&&(p.resetTimeStamp(h),y.resetTimeStamp(h)),"function"==typeof p.setDecryptData&&p.setDecryptData(t),p.append(e,s,c,d)},e}();t.default=G},"./src/demux/demuxer-worker.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/demux/demuxer-inline.js"),i=n("./src/events.js"),o=n("./src/utils/logger.js"),a=n("./node_modules/eventemitter3/index.js");t.default=function(e){var t=new a.EventEmitter;t.trigger=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.demuxer=new r.default(t,a.typeSupported,s,a.vendor),Object(o.enableLogs)(s.debug),n("init",null);break;case"demux":e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(i.default.FRAG_DECRYPTED,n),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(i.default.FRAG_PARSED,n),t.on(i.default.ERROR,n),t.on(i.default.FRAG_PARSING_METADATA,n),t.on(i.default.FRAG_PARSING_USERDATA,n),t.on(i.default.INIT_PTS_FOUND,n),t.on(i.default.FRAG_PARSING_DATA,function(t,n){var r=[],i={event:t,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),e.postMessage(i,r)})}},"./src/demux/id3.js":function(e,t,n){"use strict";n.r(t),n.d(t,"utf8ArrayToStr",function(){return s});var r,i=n("./src/utils/get-self-scope.js"),o=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,n){for(var r=n,i=0;e.isHeader(t,n);){i+=10,i+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(i+=10),n+=i}if(i>0)return t.subarray(r,r+i)},e._readSize=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]},e.getTimeStamp=function(t){for(var n=e.getID3Frames(t),r=0;r<n.length;r++){var i=n[r];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:n,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var n=0,r=[];e.isHeader(t,n);){for(var i=e._readSize(t,n+6),o=(n+=10)+i;n+8<o;){var a=e._getFrameData(t.subarray(n)),s=e._decodeFrame(a);s&&r.push(s),n+=a.size+10}e.isFooter(t,n)&&(n+=10)}return r},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var n=a();if(n){var r=n.decode(e);if(t){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var o,s,u,l=e.length,c="",f=0;f<l;){if(0===(o=e[f++])&&t)return c;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(o);break;case 12:case 13:s=e[f++],c+=String.fromCharCode((31&o)<<6|63&s);break;case 14:s=e[f++],u=e[f++],c+=String.fromCharCode((15&o)<<12|(63&s)<<6|(63&u)<<0)}}return c},e}();function a(){var e=Object(i.getSelfScope)();return r||void 0===e.TextDecoder||(r=new e.TextDecoder("utf-8")),r}var s=o._utf8ArrayToStr;t.default=o},"./src/demux/mp4demuxer.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/logger.js"),i=n("./src/events.js"),o=Math.pow(2,32)-1,a=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,n,r,o){if(t&&t.byteLength){var a=this.initData=e.parseInitSegment(t);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var s={};a.audio&&a.video?s.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:o?t:null}:(a.audio&&(s.audio={container:"audio/mp4",codec:n,initSegment:o?t:null}),a.video&&(s.video={container:"video/mp4",codec:r,initSegment:o?t:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:s})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n},e.writeUint32=function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},e.findBox=function(t,n){var r,i,o,a,s,u,l=[];if(t.data?(s=t.start,o=t.end,t=t.data):(s=0,o=t.byteLength),!n.length)return null;for(r=s;r<o;)u=(i=e.readUint32(t,r))>1?r+i:o,e.bin2str(t.subarray(r+4,r+8))===n[0]&&(1===n.length?l.push({data:t,start:r+8,end:u}):(a=e.findBox({data:t,start:r+8,end:u},n.slice(1))).length&&(l=l.concat(a))),r=u;return l},e.parseSegmentIndex=function(t){var n,r=e.findBox(t,["moov"])[0],i=r?r.end:null,o=0,a=e.findBox(t,["sidx"]);if(!a||!a[0])return null;n=[];var s=(a=a[0]).data[0];o=0===s?8:16;var u=e.readUint32(a,o);o+=4;o+=0===s?8:16,o+=2;var l=a.end+0,c=e.readUint16(a,o);o+=2;for(var f=0;f<c;f++){var d=o,h=e.readUint32(a,d);d+=4;var p=2147483647&h;if(1===(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var y=e.readUint32(a,d);d+=4,n.push({referenceSize:p,subsegmentDuration:y,info:{duration:y/u,start:l,end:l+p-1}}),l+=p,o=d+=4}return{earliestPresentationTime:0,timescale:u,version:s,referencesCount:c,references:n,moovEndOffset:i}},e.parseInitSegment=function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var i=e.findBox(t,["tkhd"])[0];if(i){var o=i.data[i.start],a=0===o?12:20,s=e.readUint32(i,a),u=e.findBox(t,["mdia","mdhd"])[0];if(u){a=0===(o=u.data[u.start])?12:20;var l=e.readUint32(u,a),c=e.findBox(t,["mdia","hdlr"])[0];if(c){var f={soun:"audio",vide:"video"}[e.bin2str(c.data.subarray(c.start+8,c.start+12))];if(f){var d=e.findBox(t,["mdia","minf","stbl","stsd"]);if(d.length){d=d[0];var h=e.bin2str(d.data.subarray(d.start+12,d.start+16));r.logger.log("MP4Demuxer:"+f+":"+h+" found")}n[s]={timescale:l,type:f},n[f]={timescale:l,id:s}}}}}}),n},e.getStartDTS=function(t,n){var r,i,o;return r=e.findBox(n,["moof","traf"]),i=[].concat.apply([],r.map(function(n){return e.findBox(n,["tfhd"]).map(function(r){var i,o;return i=e.readUint32(r,4),o=t[i].timescale||9e4,e.findBox(n,["tfdt"]).map(function(t){var n,r;return n=t.data[t.start],r=e.readUint32(t,4),1===n&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r})[0]/o})})),o=Math.min.apply(null,i),isFinite(o)?o:0},e.offsetStartDTS=function(t,n,r){e.findBox(n,["moof","traf"]).map(function(n){return e.findBox(n,["tfhd"]).map(function(i){var a=e.readUint32(i,4),s=t[a].timescale||9e4;e.findBox(n,["tfdt"]).map(function(t){var n=t.data[t.start],i=e.readUint32(t,4);if(0===n)e.writeUint32(t,4,i-r*s);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=r*s,i=Math.max(i,0);var a=Math.floor(i/(o+1)),u=Math.floor(i%(o+1));e.writeUint32(t,4,a),e.writeUint32(t,8,u)}})})})},t.append=function(t,n,r,o){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),a=this.initData);var s,u=this.initPTS;if(void 0===u){var l=e.getStartDTS(a,t);this.initPTS=u=l-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(a,t,u),s=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,s,r,o,t)},t.destroy=function(){},e}();t.default=a},"./src/errors.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"ErrorTypes",function(){return r}),n.d(t,"ErrorDetails",function(){return i}),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(r||(r={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException"}(i||(i={}))},"./src/events.js":function(e,t,n){"use strict";n.r(t);t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return zt});var r={};n.r(r),n.d(r,"newCue",function(){return Je});var i,o,a=n("./node_modules/url-toolkit/src/url-toolkit.js"),s=n("./src/errors.ts"),u=n("./src/polyfills/number.js"),l=n("./src/events.js"),c=n("./src/utils/logger.js"),f={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},d=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(f[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){try{(function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)}).call(this,e,t).call()}catch(t){c.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(o||(o={}));var h=n("./src/demux/mp4demuxer.js");function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y,g=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}var t,n,r;return t=e,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(a.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&p(t.prototype,n),r&&p(t,r),e}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.AUDIO="audio",e.VIDEO="video"}(y||(y={}));var m=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[y.AUDIO]=!1,e[y.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t,n,r,i=e.prototype;return i.setByteRange=function(e,t){var n=e.split("@",2),r=[];1===n.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},i.addElementaryStream=function(e){this._elementaryStreams[e]=!0},i.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},i.createInitializationVector=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},i.setDecryptDataFromLevelKey=function(e,t){var n=e;return(null==e?void 0:e.method)&&e.uri&&!e.iv&&((n=new g(e.baseuri,e.reluri)).method=e.method,n.iv=this.createInitializationVector(t)),n},t=e,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(u.isFiniteNumber)(this.programDateTime))return null;var e=Object(u.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&v(t.prototype,n),r&&v(t,r),e}();function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}var t,n,r;return t=e,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(u.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&b(t.prototype,n),r&&b(t,r),e}(),E=/^(\d+)x(\d+)$/,k=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function e(t){for(var n in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){var t=E.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n={};for(k.lastIndex=0;null!==(t=k.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}(),w={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function T(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var S=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,P=/#EXT-X-MEDIA:(.*)/g,O=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),L=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,R=/\.(mp4|m4s|m4v|m4a)$/i,C=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i=[],o={},a=!1;function s(e,t){["video","audio"].forEach(function(n){var r=e.filter(function(e){return function(e,t){var n=w[t];return!!n&&!0===n[e.slice(0,4)]}(e,n)});if(r.length){var i=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter(function(e){return-1===r.indexOf(e)})}}),t.unknownCodecs=e}for(S.lastIndex=0;null!=(r=S.exec(t));)if(r[1]){var u={},l=u.attrs=new A(r[1]);u.url=e.resolve(r[2],n);var c=l.decimalResolution("RESOLUTION");c&&(u.width=c.width,u.height=c.height),u.bitrate=l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),u.name=l.NAME,s([].concat((l.CODECS||"").split(/[ ,]+/)),u),u.videoCodec&&-1!==u.videoCodec.indexOf("avc1")&&(u.videoCodec=e.convertAVC1ToAVCOTI(u.videoCodec)),i.push(u)}else if(r[3]){var f=new A(r[3]);f["DATA-ID"]&&(a=!0,o[f["DATA-ID"]]=f)}return{levels:i,sessionData:a?o:null}},e.parseMasterPlaylistMedia=function(t,n,r,i){var o;void 0===i&&(i=[]);var a=[],s=0;for(P.lastIndex=0;null!==(o=P.exec(t));){var u=new A(o[1]);if(u.TYPE===r){var l={attrs:u,id:s++,groupId:u["GROUP-ID"],instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE,type:r,default:"YES"===u.DEFAULT,autoselect:"YES"===u.AUTOSELECT,forced:"YES"===u.FORCED,lang:u.LANGUAGE};if(u.URI&&(l.url=e.resolve(u.URI,n)),i.length){var c=e.findGroup(i,l.groupId);l.audioCodec=c?c.codec:i[0].codec}a.push(l)}}return a},e.parseLevelPlaylist=function(e,t,n,r,i){var o,a,s,l=0,f=0,d=new _(t),h=0,p=null,y=new m,v=null;for(O.lastIndex=0;null!==(o=O.exec(e));){var b=o[1];if(b){y.duration=parseFloat(b);var E=(" "+o[2]).slice(1);y.title=E||null,y.tagList.push(E?["INF",b,E]:["INF",b])}else if(o[3]){if(Object(u.isFiniteNumber)(y.duration)){var k=l++;y.type=r,y.start=f,s&&(y.levelkey=s),y.sn=k,y.level=n,y.cc=h,y.urlId=i,y.baseurl=t,y.relurl=(" "+o[3]).slice(1),D(y,p),d.fragments.push(y),p=y,f+=y.duration,y=new m}}else if(o[4]){var w=(" "+o[4]).slice(1);p?y.setByteRange(w,p):y.setByteRange(w)}else if(o[5])y.rawProgramDateTime=(" "+o[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),null===v&&(v=d.fragments.length);else{if(!(o=o[0].match(L))){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(a=1;a<o.length&&void 0===o[a];a++);var T=(" "+o[a+1]).slice(1),S=(" "+o[a+2]).slice(1);switch(o[a]){case"#":y.tagList.push(S?[T,S]:[T]);break;case"PLAYLIST-TYPE":d.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":l=d.startSN=parseInt(T);break;case"TARGETDURATION":d.targetduration=parseFloat(T);break;case"VERSION":d.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"DIS":h++,y.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":h=parseInt(T);break;case"KEY":var P=new A(T),C=P.enumeratedString("METHOD"),I=P.URI,x=P.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(P.KEYFORMAT||"identity")){c.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}C&&(s=new g(t,I),I&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(C)>=0&&(s.method=C,s.key=null,s.iv=x));break;case"START":var M=new A(T).decimalFloatingPoint("TIME-OFFSET");Object(u.isFiniteNumber)(M)&&(d.startTimeOffset=M);break;case"MAP":var F=new A(T);y.relurl=F.URI,F.BYTERANGE&&y.setByteRange(F.BYTERANGE),y.baseurl=t,y.level=n,y.type=r,y.sn="initSegment",d.initSegment=y,(y=new m).rawProgramDateTime=d.initSegment.rawProgramDateTime;break;default:c.logger.warn("line parsed but not handled: "+o)}}}return(y=p)&&!y.relurl&&(d.fragments.pop(),f-=y.duration),d.totalduration=f,d.averagetargetduration=f/d.fragments.length,d.endSN=l-1,d.startCC=d.fragments[0]?d.fragments[0].cc:0,d.endCC=h,!d.initSegment&&d.fragments.length&&d.fragments.every(function(e){return R.test(e.relurl)})&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(y=new m).relurl=d.fragments[0].relurl,y.baseurl=t,y.level=n,y.type=r,y.sn="initSegment",d.initSegment=y,d.needSidxRanges=!0),v&&function(e,t){for(var n=e[t],r=t-1;r>=0;r--){var i=e[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(d.fragments,v),d},e}();function D(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):(null==t?void 0:t.programDateTime)&&(e.programDateTime=t.endProgramDateTime),Object(u.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var I=window.performance,x=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MANIFEST_LOADING,l.default.LEVEL_LOADING,l.default.AUDIO_TRACK_LOADING,l.default.SUBTITLE_TRACK_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.canHaveQualityLevels=function(e){return e!==i.AUDIO_TRACK&&e!==i.SUBTITLE_TRACK},r.mapContextToLevelType=function(e){switch(e.type){case i.AUDIO_TRACK:return o.AUDIO;case i.SUBTITLE_TRACK:return o.SUBTITLE;default:return o.MAIN}},r.getResponseUrl=function(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n};var a=r.prototype;return a.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i},a.getInternalLoader=function(e){return this.loaders[e.type]},a.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},a.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},a.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},a.onManifestLoading=function(e){this.load({url:e.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},a.onLevelLoading=function(e){this.load({url:e.url,type:i.LEVEL,level:e.level,id:e.id,responseType:"text"})},a.onAudioTrackLoading=function(e){this.load({url:e.url,type:i.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},a.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:i.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},a.load=function(e){var t=this.hls.config;c.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var n,r,o,a,s=this.getInternalLoader(e);if(s){var u=s.context;if(u&&u.url===e.url)return c.logger.trace("playlist request ongoing"),!1;c.logger.warn("aborting previous loader for type: "+e.type),s.abort()}switch(e.type){case i.MANIFEST:n=t.manifestLoadingMaxRetry,r=t.manifestLoadingTimeOut,o=t.manifestLoadingRetryDelay,a=t.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:n=0,a=0,o=0,r=t.levelLoadingTimeOut;break;default:n=t.levelLoadingMaxRetry,r=t.levelLoadingTimeOut,o=t.levelLoadingRetryDelay,a=t.levelLoadingMaxRetryTimeout}s=this.createInternalLoader(e);var l={timeout:r,maxRetry:n,retryDelay:o,maxRetryDelay:a},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return c.logger.debug("Calling internal loader delegate for URL: "+e.url),s.load(e,l,f),!0},a.loadsuccess=function(e,t,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,r);if(this.resetInternalLoader(n.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=e.data;t.tload=I.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,r):this._handleMasterPlaylist(e,t,n,r):this._handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},a.loaderror=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!1,e)},a.loadtimeout=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!0)},a._handleMasterPlaylist=function(e,t,n,i){var o=this.hls,a=e.data,s=r.getResponseUrl(e,n),u=C.parseMasterPlaylist(a,s),f=u.levels,d=u.sessionData;if(f.length){var h=f.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),p=C.parseMasterPlaylistMedia(a,s,"AUDIO",h),y=C.parseMasterPlaylistMedia(a,s,"SUBTITLES"),g=C.parseMasterPlaylistMedia(a,s,"CLOSED-CAPTIONS");if(p.length){var v=!1;p.forEach(function(e){e.url||(v=!0)}),!1===v&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(c.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}o.trigger(l.default.MANIFEST_LOADED,{levels:f,audioTracks:p,subtitles:y,captions:g,url:s,stats:t,networkDetails:i,sessionData:d})}else this._handleManifestParsingError(e,n,"no level found in manifest",i)},a._handleTrackOrLevelPlaylist=function(e,t,n,o){var a=this.hls,c=n.id,f=n.level,d=n.type,h=r.getResponseUrl(e,n),p=Object(u.isFiniteNumber)(c)?c:0,y=Object(u.isFiniteNumber)(f)?f:p,g=r.mapContextToLevelType(n),v=C.parseLevelPlaylist(e.data,h,y,g,p);if(v.tload=t.tload,v.fragments.length){if(d===i.MANIFEST){var m={url:h,details:v};a.trigger(l.default.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:t,networkDetails:o,sessionData:null})}if(t.tparsed=I.now(),v.needSidxRanges){var b=v.initSegment.url;this.load({url:b,isSidxRequest:!0,type:d,level:f,levelDetails:v,id:c,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=v,this._handlePlaylistLoaded(e,t,n,o)}else a.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},a._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var n=h.default.parseSegmentIndex(new Uint8Array(e.data));if(n){var r=n.references,i=t.levelDetails;r.forEach(function(e,t){var n=e.info;if(i){var r=i.fragments[t];0===r.byteRange.length&&r.setByteRange(String(1+n.end-n.start)+"@"+String(n.start))}}),i&&i.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},a._handleManifestParsingError=function(e,t,n,r){this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:r})},a._handleNetworkError=function(e,t,n,r){var o,a;void 0===n&&(n=!1),void 0===r&&(r=null),c.logger.info("A network error occured while loading a "+e.type+"-type playlist");var u=this.getInternalLoader(e);switch(e.type){case i.MANIFEST:o=n?s.ErrorDetails.MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case i.LEVEL:o=n?s.ErrorDetails.LEVEL_LOAD_TIMEOUT:s.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case i.AUDIO_TRACK:o=n?s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}u&&(u.abort(),this.resetInternalLoader(e.type));var f={type:s.ErrorTypes.NETWORK_ERROR,details:o,fatal:a,url:e.url,loader:u,context:e,networkDetails:t};r&&(f.response=r),this.hls.trigger(l.default.ERROR,f)},a._handlePlaylistLoaded=function(e,t,n,o){var a=n.type,s=n.level,u=n.id,c=n.levelDetails;if(c&&c.targetduration)if(r.canHaveQualityLevels(n.type))this.hls.trigger(l.default.LEVEL_LOADED,{details:c,level:s||0,id:u||0,stats:t,networkDetails:o});else switch(a){case i.AUDIO_TRACK:this.hls.trigger(l.default.AUDIO_TRACK_LOADED,{details:c,id:u,stats:t,networkDetails:o});break;case i.SUBTITLE_TRACK:this.hls.trigger(l.default.SUBTITLE_TRACK_LOADED,{details:c,id:u,stats:t,networkDetails:o})}else this._handleManifestParsingError(e,n,"invalid target duration",o)},r}(d);var M=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.FRAG_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){var t=this.loaders;for(var n in t){var r=t[n];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,n=t.type,r=this.loaders,i=this.hls.config,o=i.fLoader,a=i.loader;t.loaded=0;var s,l,f,d=r[n];d&&(c.logger.warn("abort previous fragment loader for type: "+n),d.abort()),d=r[n]=t.loader=i.fLoader?new o(i):new a(i),s={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var h=t.byteRangeStartOffset,p=t.byteRangeEndOffset;Object(u.isFiniteNumber)(h)&&Object(u.isFiniteNumber)(p)&&(s.rangeStart=h,s.rangeEnd=p),l={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(s,l,f)},i.loadsuccess=function(e,t,n,r){void 0===r&&(r=null);var i=e.data,o=n.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(l.default.FRAG_LOADED,{payload:i,frag:o,stats:t,networkDetails:r})},i.loaderror=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})},i.loadtimeout=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})},i.loadprogress=function(e,t,n,r){void 0===r&&(r=null);var i=t.frag;i.loaded=e.loaded,this.hls.trigger(l.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e,networkDetails:r})},r}(d);var F=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.KEY_LOADING)||this).loaders={},n.decryptkey=null,n.decrypturl=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){for(var t in this.loaders){var n=this.loaders[t];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,n=t.type,r=this.loaders[n];if(t.decryptdata){var i=t.decryptdata.uri;if(i!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;if(r&&(c.logger.warn("abort previous key loader for type:"+n),r.abort()),!i)return void c.logger.warn("key uri is falsy");t.loader=this.loaders[n]=new o.loader(o),this.decrypturl=i,this.decryptkey=null;var a={url:i,frag:t,responseType:"arraybuffer"},s={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(a,s,u)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(l.default.KEY_LOADED,{frag:t}))}else c.logger.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(e,t,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,delete this.loaders[r.type],this.hls.trigger(l.default.KEY_LOADED,{frag:r})):c.logger.error("after key load, decryptdata unset")},i.loaderror=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},i.loadtimeout=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},r}(d);var N="NOT_LOADED",U="APPENDING",j="PARTIAL",B="OK",Y=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.BUFFER_APPENDED,l.default.FRAG_BUFFERED,l.default.FRAG_LOADED)||this).bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,d.prototype.destroy.call(this),e.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var n=this.fragments,r=Object.keys(n).filter(function(r){var i=n[r];if(i.body.type!==t)return!1;if(!i.buffered)return!1;var o=i.body;return o.startPTS<=e&&e<=o.endPTS});if(0===r.length)return null;var i=r.pop();return n[i].body},i.detectEvictedFragments=function(e,t){var n=this;Object.keys(this.fragments).forEach(function(r){var i=n.fragments[r];if(i&&i.buffered){var o=i.range[e];if(o)for(var a=o.time,s=0;s<a.length;s++){var u=a[s];if(!n.isTimeBuffered(u.startPTS,u.endPTS,t)){n.removeFragment(i.body);break}}}})},i.detectPartialFragments=function(e){var t=this,n=this.getFragmentKey(e),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach(function(n){if(e.hasElementaryStream(n)){var i=t.timeRanges[n];r.range[n]=t.getBufferedTimes(e.startPTS,e.endPTS,i)}}))},i.getBufferedTimes=function(e,t,n){for(var r,i,o=[],a=!1,s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,e>=r&&t<=i){o.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))});break}if(e<i&&t>r)o.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))}),a=!0;else if(t<=r)break}return{time:o,partial:a}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t,n,r,i=this,o=null,a=0;return Object.keys(this.fragments).forEach(function(s){var u=i.fragments[s];i.isPartial(u)&&(n=u.body.startPTS-i.bufferPadding,r=u.body.endPTS+i.bufferPadding,e>=n&&e<=r&&(t=Math.min(e-n,r-e),a<=t&&(o=u.body,a=t)))}),o},i.getState=function(e){var t=this.getFragmentKey(e),n=this.fragments[t],r=N;return void 0!==n&&(r=n.buffered?!0===this.isPartial(n)?j:B:U),r},i.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},i.isTimeBuffered=function(e,t,n){for(var r,i,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;Object(u.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)})},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},r}(d),G={search:function(e,t){for(var n=0,r=e.length-1,i=null,o=null;n<=r;){var a=t(o=e[i=(n+r)/2|0]);if(a>0)n=i+1;else{if(!(a<0))return o;r=i-1}}return null}},V=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,n){try{if(e){var r,i=e.buffered,o=[];for(r=0;r<i.length;r++)o.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(o,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,n){e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end});var r=[];if(n)for(var i=0;i<e.length;i++){var o=r.length;if(o){var a=r[o-1].end;e[i].start-a<n?e[i].end>a&&(r[o-1].end=e[i].end):r.push(e[i])}else r.push(e[i])}else r=e;for(var s,u=0,l=t,c=t,f=0;f<r.length;f++){var d=r[f].start,h=r[f].end;if(t+n>=d&&t<h)l=d,u=(c=h)-t;else if(t+n<d){s=d;break}}return{len:u,start:l,end:c,nextStart:s}},e}(),H=n("./node_modules/eventemitter3/index.js"),K=n("./node_modules/webworkify-webpack/index.js"),z=n("./src/demux/demuxer-inline.js");function W(){return window.MediaSource||window.WebKitMediaSource}var q=n("./src/utils/get-self-scope.js");var X=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.prototype.trigger=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(n))},r}(H.EventEmitter),$=Object(q.getSelfScope)(),Q=W()||{isTypeSupported:function(){return!1}},J=function(){function e(e,t){var n=this;this.hls=e,this.id=t;var r=this.observer=new X,i=e.config,o=function(t,r){(r=r||{}).frag=n.frag,r.id=n.id,e.trigger(t,r)};r.on(l.default.FRAG_DECRYPTED,o),r.on(l.default.FRAG_PARSING_INIT_SEGMENT,o),r.on(l.default.FRAG_PARSING_DATA,o),r.on(l.default.FRAG_PARSED,o),r.on(l.default.ERROR,o),r.on(l.default.FRAG_PARSING_METADATA,o),r.on(l.default.FRAG_PARSING_USERDATA,o),r.on(l.default.INIT_PTS_FOUND,o);var a={mp4:Q.isTypeSupported("video/mp4"),mpeg:Q.isTypeSupported("audio/mpeg"),mp3:Q.isTypeSupported('audio/mp4; codecs="mp3"')},u=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var f;c.logger.log("demuxing in webworker");try{f=this.w=K("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),f.addEventListener("message",this.onwmsg),f.onerror=function(t){e.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},f.postMessage({cmd:"init",typeSupported:a,vendor:u,id:t,config:JSON.stringify(i)})}catch(e){c.logger.warn("Error in worker:",e),c.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),f&&$.URL.revokeObjectURL(f.objectURL),this.demuxer=new z.default(r,a,i,u),this.w=void 0}}else this.demuxer=new z.default(r,a,i,u)}var t=e.prototype;return t.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},t.push=function(e,t,n,r,i,o,a,s){var l=this.w,f=Object(u.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,d=i.decryptdata,h=this.frag,p=!(h&&i.cc===h.cc),y=!(h&&i.level===h.level),g=h&&i.sn===h.sn+1,v=!y&&g;if(p&&c.logger.log(this.id+":discontinuity detected"),y&&c.logger.log(this.id+":switch detected"),this.frag=i,l)l.postMessage({cmd:"demux",data:e,decryptdata:d,initSegment:t,audioCodec:n,videoCodec:r,timeOffset:f,discontinuity:p,trackSwitch:y,contiguous:v,duration:o,accurateTimeOffset:a,defaultInitPTS:s},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,d,t,n,r,f,p,y,v,o,a,s)}},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":$.URL.revokeObjectURL(this.w.objectURL);break;case l.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},e}();function Z(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function ee(e,t,n){var r=e[t],i=e[n],o=i.startPTS;if(Object(u.isFiniteNumber)(o))n>t?(r.duration=o-r.start,r.duration<0&&c.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&c.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"));else if(n>t){var a=r.cc===i.cc;i.start=r.start+(a&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else i.start=Math.max(r.start-i.duration,0)}function te(e,t,n,r,i,o){var a=n,s=r;if(Object(u.isFiniteNumber)(t.startPTS)){var l=Math.abs(t.startPTS-n);Object(u.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(l,t.deltaPTS):t.deltaPTS=l,a=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),s=Math.min(r,t.endPTS),r=Math.max(r,t.endPTS),i=Math.min(i,t.startDTS),o=Math.max(o,t.endDTS)}var c=n-t.start;t.start=t.startPTS=n,t.maxStartPTS=a,t.endPTS=r,t.minEndPTS=s,t.startDTS=i,t.endDTS=o,t.duration=r-n;var f,d,h,p=t.sn;if(!e||p<e.startSN||p>e.endSN)return 0;for(f=p-e.startSN,(d=e.fragments)[f]=t,h=f;h>0;h--)ee(d,h,h-1);for(h=f;h<d.length-1;h++)ee(d,h,h+1);return e.PTSKnown=!0,c}function ne(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var n,r=0;if(re(e,t,function(e,i){r=e.cc-i.cc,Object(u.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,n=i),t.PTSKnown=!0}),t.PTSKnown){if(r){c.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=t.fragments,o=0;o<i.length;o++)i[o].cc+=r}n?te(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(e,t){var n=t.startSN-e.startSN,r=e.fragments,i=t.fragments;if(n<0||n>r.length)return;for(var o=0;o<i.length;o++)i[o].start+=r[n].start}(e,t),t.PTSKnown=e.PTSKnown}}function re(e,t,n){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,a=r;a<=i;a++){var s=e.fragments[o+a],u=t.fragments[a];if(!s||!u)break;n(s,u,a)}}function ie(e,t,n){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),i=r/2;return e&&t.endSN===e.endSN&&(r=i),n&&(r=Math.max(i,r-(window.performance.now()-n))),Math.round(r)}var oe={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}};function ae(e,t){t.fragments.forEach(function(t){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}),t.PTSKnown=!0}function se(e,t,n){!function(e,t,n){if(function(e,t,n){var r=!1;return t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC)&&(r=!0),r}(e,n,t)){var r=function(e,t){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var i=function(e,t){for(var n=null,r=0;r<e.length;r+=1){var i=e[r];if(i&&i.cc===t){n=i;break}}return n}(n,r[0].cc);if(i&&(!i||i.startPTS))return i;c.logger.log("No frag in previous level to align on")}else c.logger.log("No fragments to align")}(n.details,t);r&&(c.logger.log("Adjusting PTS using last level due to CC increase within current level"),ae(r.start,t))}}(e,n,t),!n.PTSKnown&&t&&function(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var n=t.fragments[0].programDateTime,r=e.fragments[0].programDateTime,i=(r-n)/1e3+t.fragments[0].start;Object(u.isFiniteNumber)(i)&&(c.logger.log("adjusting PTS using programDateTime delta, sliding:"+i.toFixed(3)),ae(i,e))}}(n,t.details)}function ue(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Object(u.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<e.length;++r){var i=e[r];if(fe(t,n,i))return i}return null}function le(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null;if(e?i=t[e.sn-t[0].sn+1]:0===n&&0===t[0].start&&(i=t[0]),i&&0===ce(n,r,i))return i;var o=G.search(t,ce.bind(null,n,r));return o||i}function ce(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0);var r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function fe(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}var de=function(){function e(e,t,n,r){this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,n=this.media,r=this.stalled,i=n.currentTime,o=n.seeking,a=this.seeking&&!o,s=!this.seeking&&o;if(this.seeking=o,i===e){if((s||a)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var u=V.bufferInfo(n,i,0),l=u.len>0,f=u.nextStart||0;if(l||f){if(o){var d=u.len>2,h=!f||f-i>2&&!this.fragmentTracker.getPartialFragment(i);if(d||h)return;this.moved=!1}if(!this.moved&&this.stalled){var p=Math.max(f,u.start||0)-i;if(p>0&&p<=2)return void this._trySkipBufferHole(null)}var y=self.performance.now();if(null!==r){var g=y-r;!o&&g>=250&&this._reportStall(u.len);var v=V.bufferInfo(n,i,t.maxBufferHole);this._tryFixBufferStall(v,g)}else this.stalled=y}}}else if(this.moved=!0,null!==r){if(this.stallReported){var m=self.performance.now()-r;c.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(m)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,o=r.getPartialFragment(i);if(o&&this._trySkipBufferHole(o))return;e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(c.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,c.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,n=this.hls,r=this.media,i=r.currentTime,o=0,a=0;a<r.buffered.length;a++){var u=r.buffered.start(a);if(i+t.maxBufferHole>=o&&i<u){var f=Math.max(u+.05,r.currentTime+.1);return c.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+f),this.moved=!0,this.stalled=null,r.currentTime=f,e&&n.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+f,frag:e}),f}o=r.buffered.end(a)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<e.nudgeMaxRetry){var o=r+i*e.nudgeOffset;c.logger.warn("Nudging 'currentTime' from "+r+" to "+o),n.currentTime=o,t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();var he=function(e){var t,n;function r(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(n=e.call.apply(e,[this,t].concat(i))||this)._boundTick=void 0,n._tickTimer=null,n._tickInterval=null,n._tickCallCount=0,n._boundTick=n.tick.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},r}(d);var pe={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},ye=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=pe.STOPPED},i._streamEnded=function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;if(!t.live&&n&&!n.backtracked&&n.sn===t.endSN&&!e.nextStart){var i=r.getState(n);return i===j||i===B}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,n=this.mediaBuffer,r=this.state,i=t?t.currentTime:null,o=V.bufferInfo(n||t,i,this.config.maxBufferHole);if(c.logger.log("media seeking to "+(Object(u.isFiniteNumber)(i)?i.toFixed(3):i)),r===pe.FRAG_LOADING){var a=this.fragCurrent;if(0===o.len&&a){var s=e.maxFragLookUpTolerance,l=a.start-s,f=a.start+a.duration+s;i<l||i>f?(a.loader&&(c.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=pe.IDLE):c.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===pe.ENDED&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=pe.IDLE);t&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=pe.STOPPED,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},r}(he);function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve,me=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.LEVEL_LOADED,l.default.LEVELS_UPDATED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_LOAD_EMERGENCY_ABORTED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_SWITCHED,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=pe.STOPPED,r.stallReported=!1,r.gapController=null,r.altAudio=!1,r.audioOnly=!1,r.bitrateTest=!1,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,f,d=r.prototype;return d.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(c.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=pe.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=pe.STOPPED},d.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},d.doTick=function(){switch(this.state){case pe.BUFFER_FLUSHING:this.fragLoadError=0;break;case pe.IDLE:this._doTickIdle();break;case pe.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=pe.IDLE);break;case pe.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(c.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=pe.IDLE);break;case pe.ERROR:case pe.STOPPED:case pe.FRAG_LOADING:case pe.PARSING:case pe.PARSED:case pe.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},d._doTickIdle=function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&t.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var r;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,o=this.levels[i];if(o){var a,s=o.bitrate;a=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,a=Math.min(a,t.maxMaxBufferLength);var u=r<t.maxBufferHole?Math.max(2,t.maxBufferHole):t.maxBufferHole,f=V.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,u),d=f.len;if(!(d>=a)){c.logger.trace("buffer length of "+d.toFixed(3)+" is below max of "+a.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var h=o.details;if(!h||h.live&&this.levelLastLoaded!==i)this.state=pe.WAITING_LEVEL;else{if(this._streamEnded(f,h)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(l.default.BUFFER_EOS,p),void(this.state=pe.ENDED)}this._fetchPayloadOrEos(r,f,h)}}}}},d._fetchPayloadOrEos=function(e,t,n){var r=this.fragPrevious,i=(this.level,n.fragments),o=i.length;if(0!==o){var a,s=i[0].start,u=i[o-1].start+i[o-1].duration,l=t.end;if(n.initSegment&&!n.initSegment.data)a=n.initSegment;else if(n.live){var f=this.config.initialLiveManifestSize;if(o<f)return void c.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+f);if(null===(a=this._ensureFragmentAtLivePoint(n,l,s,u,r,i)))return}else l<s&&(a=i[0]);a||(a=this._findFragment(s,r,o,i,l,u,n)),a&&(a.encrypted?this._loadKey(a,n):this._loadFragment(a,n,e,l))}},d._ensureFragmentAtLivePoint=function(e,t,n,r,i,o){var a,s=this.hls.config,l=this.media,f=1/0;if(void 0!==s.liveMaxLatencyDuration?f=s.liveMaxLatencyDuration:Object(u.isFiniteNumber)(s.liveMaxLatencyDurationCount)&&(f=s.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(n-s.maxFragLookUpTolerance,r-f)){var d=this.liveSyncPosition=this.computeLivePosition(n,e);t=d,l&&!l.paused&&l.readyState&&l.duration>d&&d>l.currentTime&&(c.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),l.currentTime=d),this.nextLoadPosition=d}if(e.PTSKnown&&t>r&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&i)if(e.hasProgramDateTime)c.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=ue(o,i.endProgramDateTime,s.maxFragLookUpTolerance);else{var h=i.sn+1;if(h>=e.startSN&&h<=e.endSN){var p=o[h-e.startSN];i.cc===p.cc&&(a=p,c.logger.log("live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=G.search(o,function(e){return i.cc-e.cc}))&&c.logger.log("live playlist, switching playlist, load frag with same CC: "+a.sn)}return a},d._findFragment=function(e,t,n,r,i,o,a){var s,u=this.hls.config;i<o?s=le(t,r,i,i>o-u.maxFragLookUpTolerance?0:u.maxFragLookUpTolerance):s=r[n-1];if(s){var l=s.sn-a.startSN,f=t&&s.level===t.level,d=r[l-1],h=r[l+1];if(t&&s.sn===t.sn)if(f&&!s.backtracked)if(s.sn<a.endSN){var p=t.deltaPTS;p&&p>u.maxBufferHole&&t.dropped&&l?(s=d,c.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(s=h,this.fragmentTracker.getState(s)!==B&&c.logger.log("Re-loading fragment with SN: "+s.sn))}else s=null;else s.backtracked&&(h&&h.backtracked?(c.logger.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+s.sn+". Loading fragment "+h.sn),s=h):(c.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),s.dropped=0,d?(s=d).backtracked=!0:l&&(s=null)))}return s},d._loadKey=function(e,t){c.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=pe.KEY_LOADING,this.hls.trigger(l.default.KEY_LOADING,{frag:e})},d._loadFragment=function(e,t,n,r){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,"initSegment"!==e.sn&&(this.startFragRequested=!0),Object(u.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===N||i===j?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,c.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(r.toFixed(3))),this.hls.trigger(l.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new J(this.hls,"main")),this.state=pe.FRAG_LOADING):i===U&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},d.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,o.MAIN)},d.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},d._checkFragmentChanged=function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((t=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),V.isBuffered(n,t)?e=this.getBufferedFrag(t):V.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(l.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(l.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}},d.immediateLevelSwitch=function(){if(c.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media;t?(e=t.paused)||t.pause():e=!0,this.previouslyPaused=e}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},d.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&V.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},d.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,n=this.getBufferedFrag(e.currentTime);if(n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),e.paused)t=0;else{var r=this.hls.nextLoadLevel,i=this.levels[r],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*i.bitrate/(1e3*o)+1:0}var a=this.getBufferedFrag(e.currentTime+t);if(a){var s=this.followingBufferedFrag(a);if(s){var u=this.fragCurrent;u&&u.loader&&u.loader.abort(),this.fragCurrent=null;var l=Math.max(a.endPTS,s.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,s.duration));this.flushMainBuffer(l,Number.POSITIVE_INFINITY)}}}},d.flushMainBuffer=function(e,t){this.state=pe.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(l.default.BUFFER_FLUSHING,n)},d.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new de(n,t,this.fragmentTracker,this.hls)},d.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},d.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(u.isFiniteNumber)(t)&&c.logger.log("media seeked to "+t.toFixed(3)),this.tick()},d.onManifestLoading=function(){c.logger.log("trigger BUFFER_RESET"),this.hls.trigger(l.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},d.onManifestParsed=function(e){var t,n=!1,r=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&c.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},d.onLevelLoaded=function(e){var t=e.details,n=e.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],o=t.totalduration,a=0;if(c.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live||i.details&&i.details.live){var s=i.details;s&&t.fragments.length>0?(ne(s,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,s),t.PTSKnown&&Object(u.isFiniteNumber)(a)?c.logger.log("live playlist sliding:"+a.toFixed(3)):(c.logger.log("live playlist - outdated PTS, unknown sliding"),se(this.fragPrevious,r,t))):(c.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,se(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=n,this.hls.trigger(l.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var f=t.startTimeOffset;Object(u.isFiniteNumber)(f)?(f<0&&(c.logger.log("negative start time offset "+f+", count from end of last fragment"),f=a+o+f),c.logger.log("start time offset found in playlist, adjust startPosition to "+f),this.startPosition=f):t.live?(this.startPosition=this.computeLivePosition(a,t),c.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===pe.WAITING_LEVEL&&(this.state=pe.IDLE),this.tick()},d.onKeyLoaded=function(){this.state===pe.KEY_LOADING&&(this.state=pe.IDLE,this.tick())},d.onFragLoaded=function(e){var t=this.fragCurrent,n=this.hls,r=this.levels,i=this.media,o=e.frag;if(this.state===pe.FRAG_LOADING&&t&&"main"===o.type&&o.level===t.level&&o.sn===t.sn){var a=e.stats,s=r[t.level],u=s.details;if(this.bitrateTest=!1,this.stats=a,c.logger.log("Loaded "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level),o.bitrateTest&&n.nextLoadLevel)this.state=pe.IDLE,this.startFragRequested=!1,a.tparsed=a.tbuffered=window.performance.now(),n.trigger(l.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else if("initSegment"===o.sn)this.state=pe.IDLE,a.tparsed=a.tbuffered=window.performance.now(),u.initSegment.data=e.payload,n.trigger(l.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else{c.logger.log("Parsing "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level+", cc "+t.cc),this.state=pe.PARSING,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var f=!(i&&i.seeking)&&(u.PTSKnown||!u.live),d=u.initSegment?u.initSegment.data:[],h=this._getAudioCodec(s);(this.demuxer=this.demuxer||new J(this.hls,"main")).push(e.payload,d,h,s.videoCodec,t,u.totalduration,f)}}this.fragLoadError=0},d.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===pe.PARSING){var r,i,o=e.tracks;if(this.audioOnly=o.audio&&!o.video,this.altAudio&&!this.audioOnly&&delete o.audio,i=o.audio){var a=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===s.indexOf("firefox")&&(a="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==i.container&&(a="mp4a.40.2",c.logger.log("Android: force audio codec to "+a)),i.levelCodec=a,i.id=e.id}for(r in(i=o.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),this.hls.trigger(l.default.BUFFER_CODECS,o),o){i=o[r],c.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var u=i.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,{type:r,data:u,parent:"main",content:"initSegment"}))}this.tick()}},d.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"main"===e.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===pe.PARSING){var i=this.levels[this.level],o=n;if(Object(u.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&o.addElementaryStream(y.AUDIO),!0===e.hasVideo&&o.addElementaryStream(y.VIDEO),c.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)c.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var a=i.details;if(!a||o.sn!==a.startSN)return c.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=pe.IDLE,this.fragPrevious=o,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();c.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var s=te(i.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),f=this.hls;f.trigger(l.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:s,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(n){n&&n.length&&t.state===pe.PARSING&&(t.appended=!0,t.pendingBuffering=!0,f.trigger(l.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))}),this.tick()}},d.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===pe.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=pe.PARSED,this._checkAppendedParsed())},d.onAudioTrackSwitching=function(e){var t=this.altAudio,n=!!e.url,r=e.id;if(!n){if(this.mediaBuffer!==this.media){c.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(c.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=pe.IDLE}var o=this.hls;t&&o.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:r})}},d.onAudioTrackSwitched=function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(c.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},d.onBufferCreated=function(e){var t,n,r=e.tracks,i=!1;for(var o in r){var a=r[o];"main"===a.id?(n=o,t=a,"video"===o&&(this.videoBuffer=r[o].buffer)):i=!0}i&&t?(c.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},d.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==pe.PARSING&&t!==pe.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},d._checkAppendedParsed=function(){if(!(this.state!==pe.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;c.logger.log("main buffered : "+oe.toString(t.buffered)),this.fragPrevious=e;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.state=pe.IDLE}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},d.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=!!this.media&&V.isBuffered(this.media,this.media.currentTime)&&V.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);c.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=pe.FRAG_LOADING_WAITING_RETRY}else c.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=pe.ERROR;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==pe.ERROR&&(e.fatal?(this.state=pe.ERROR,c.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==pe.WAITING_LEVEL||(this.state=pe.IDLE));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==pe.PARSING&&this.state!==pe.PARSED||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=pe.IDLE):(c.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},d._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,c.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},d._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},d.onFragLoadEmergencyAborted=function(){this.state=pe.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},d.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?y.AUDIO:y.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=pe.IDLE,this.fragPrevious=null},d.onLevelsUpdated=function(e){this.levels=e.levels},d.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},d._seekToStartPos=function(){var e=this.media,t=e.currentTime,n=this.startPosition;if(t!==n&&n>=0){if(e.seeking)return void c.logger.log("could not seek to "+n+", already seeking at "+t);var r=(e.buffered.length?e.buffered.start(0):0)-n;r>0&&r<this.config.maxBufferHole&&(c.logger.log("adjusting start position by "+r+" to match buffer start"),n+=r,this.startPosition=n),c.logger.log("seek to target start position "+n+" from current time "+t+". ready state "+e.readyState),e.currentTime=n}},d._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},i=r,(a=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(l.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}])&&ge(i.prototype,a),f&&ge(i,f),r}(ye);function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _e=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MANIFEST_LOADED,l.default.LEVEL_LOADED,l.default.AUDIO_TRACK_SWITCHED,l.default.FRAG_LOADED,l.default.ERROR)||this).canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,ve=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,u=r.prototype;return u.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},u.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},u.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},u.stopLoad=function(){this.canload=!1},u.onManifestLoaded=function(e){var t,n=[],r=[],i={},o=null,a=!1,u=!1;if(e.levels.forEach(function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,a=a||!!e.videoCodec,u=u||!!e.audioCodec,ve&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(o=i[e.bitrate])?o.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,n.push(e)),t&&(t.AUDIO&&Z(o||e,"audio",t.AUDIO),t.SUBTITLES&&Z(o||e,"text",t.SUBTITLES))}),a&&u&&(n=n.filter(function(e){return!!e.videoCodec})),n=n.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||T(t,"audio"))&&(!n||T(n,"video"))}),e.audioTracks&&(r=e.audioTracks.filter(function(e){return!e.audioCodec||T(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),n.length>0){t=n[0].bitrate,n.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=n;for(var f=0;f<n.length;f++)if(n[f].bitrate===t){this._firstLevel=f,c.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+t);break}var d=u&&!a;this.hls.trigger(l.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:e.stats,audio:u,video:a,altAudio:!d&&r.some(function(e){return!!e.url})})}else this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},u.setLevelInternal=function(e){var t=this._levels,n=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){c.logger.log("switching to level "+e),this.currentLevelIndex=e;var r=t[e];r.level=e,n.trigger(l.default.LEVEL_SWITCHING,r)}var i=t[e],o=i.details;if(!o||o.live){var a=i.urlId;n.trigger(l.default.LEVEL_LOADING,{url:i.url[a],level:e,id:a})}}else n.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},u.onError=function(e){if(e.fatal)e.type===s.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,n=!1,r=!1;switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,r=!0;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,n=!0;break;case s.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,n=!0}void 0!==t&&this.recoverLevel(e,t,n,r)}},u.recoverLevel=function(e,t,n,r){var i,o,a,s=this,u=this.hls.config,l=e.details,f=this._levels[t];if(f.loadError++,f.fragmentError=r,n){if(!(this.levelRetryCount+1<=u.levelLoadingMaxRetry))return c.logger.error("level controller, cannot recover from "+l+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);o=Math.min(Math.pow(2,this.levelRetryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return s.loadLevel()},o),e.levelRetry=!0,this.levelRetryCount++,c.logger.warn("level controller, "+l+", retry in "+o+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&((i=f.url.length)>1&&f.loadError<i?(f.urlId=(f.urlId+1)%i,f.details=void 0,c.logger.warn("level controller, "+l+" for level "+t+": switching to redundant URL-id "+f.urlId)):-1===this.manualLevelIndex?(a=0===t?this._levels.length-1:t-1,c.logger.warn("level controller, "+l+": switch to "+a),this.hls.nextAutoLevel=this.currentLevelIndex=a):r&&(c.logger.warn("level controller, "+l+": reload a fragment"),this.currentLevelIndex=null))},u.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var n=this._levels[t.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},u.onLevelLoaded=function(e){var t=this,n=e.level,r=e.details;if(n===this.currentLevelIndex){var i=this._levels[n];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),r.live){var o=ie(i.details,r,e.stats.trequest);c.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},o)}else this.clearTimer()}},u.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===t){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},u.loadLevel=function(){if(c.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&e.url.length>0){var t=this.currentLevelIndex,n=e.urlId,r=e.url[n];c.logger.log("Attempt loading level index "+t+" with URL-id "+n),this.hls.trigger(l.default.LEVEL_LOADING,{url:r,level:t,id:n})}}},u.removeLevel=function(e,t){var n=this.levels.filter(function(n,r){return r!==e||n.url.length>1&&void 0!==t&&(n.url=n.url.filter(function(e,n){return n!==t}),n.urlId=0,!0)}).map(function(e,t){var n=e.details;return n&&n.fragments&&n.fragments.forEach(function(e){e.level=t}),e});this._levels=n,this.hls.trigger(l.default.LEVELS_UPDATED,{levels:n})},i=r,(o=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&be(i.prototype,o),a&&be(i,a),r}(d),Ee=n("./src/demux/id3.js");function ke(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function Ae(e){if(null==e?void 0:e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}var we=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_METADATA,l.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,n.media=void 0,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){d.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){Ae(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return ke(n,this.media),n}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var o=Ee.default.getID3Frames(n[i].data);if(o){var a=Math.max(n[i].pts,0),s=i<n.length-1?n[i+1].pts:t.endPTS;s||(s=t.start+t.duration),s-a<=0&&(s=a+.25);for(var u=0;u<o.length;u++){var l=o[u];if(!Ee.default.isTimeStampFrame(l)){var c=new r(a,s,"");c.value=l,this.id3Track.addCue(c)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,n=this.id3Track;if(n&&n.cues&&n.cues.length){var r=function(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var n=0,r=e.length-1;n<=r;){var i=Math.floor((r+n)/2);if(t<e[i].endTime)r=i-1;else{if(!(t>e[i].endTime))return e[i];n=i+1}}return e[n].endTime-t<t-e[r].endTime?e[n]:e[r]}(n.cues,t);if(r)for(;n.cues[0]!==r;)n.removeCue(n.cues[0])}},r}(d);var Te=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),Se=function(){function e(e,t,n,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Te(t),this.fast_=new Te(n)}var t=e.prototype;return t.sample=function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Oe=window.performance,Le=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.FRAG_LOADING,l.default.FRAG_LOADED,l.default.FRAG_BUFFERED,l.default.ERROR)||this).lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,f=r.prototype;return f.destroy=function(){this.clearTimer(),d.prototype.destroy.call(this)},f.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n,r,i=this.hls,o=i.config,a=t.level;i.levels[a].details.live?(n=o.abrEwmaFastLive,r=o.abrEwmaSlowLive):(n=o.abrEwmaFastVoD,r=o.abrEwmaSlowVoD),this._bwEstimator=new Se(i,r,n,o.abrEwmaDefaultEstimate)}},f._abandonRulesCheck=function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var r=n.loader;if(!r||r.stats&&r.stats.aborted)return c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var i=r.stats;if(t&&i&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var o=Oe.now()-i.trequest,a=Math.abs(t.playbackRate);if(o>500*n.duration/a){var s=e.levels,u=Math.max(1,i.bw?i.bw/8:1e3*i.loaded/o),f=s[n.level];if(!f)return;var d=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,h=i.total?i.total:Math.max(i.loaded,Math.round(n.duration*d/8)),p=t.currentTime,y=(h-i.loaded)/u,g=(V.bufferInfo(t,p,e.config.maxBufferHole).end-p)/a;if(g<2*n.duration/a&&y>g){var v,m=e.minAutoLevel;for(v=n.level-1;v>m;v--){var b=s[v].realBitrate?Math.max(s[v].realBitrate,s[v].bitrate):s[v].bitrate;if(n.duration*b/(6.4*u)<g)break}void 0<y&&(c.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+y.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=v,this._bwEstimator.sample(o,i.loaded),r.abort(),this.clearTimer(),e.trigger(l.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:i}))}}}}},f.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(u.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},f.onFragBuffered=function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&"main"===n.type&&Object(u.isFiniteNumber)(n.sn)&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;c.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},f.onError=function(e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},f.clearTimer=function(){clearInterval(this.timer),this.timer=null},f._findBestLevel=function(e,t,n,r,i,o,a,s,u){for(var l=i;l>=r;l--){var f=u[l];if(f){var d=f.details,h=d?d.totalduration/d.fragments.length:t,p=!!d&&d.live,y=void 0;y=l<=e?a*n:s*n;var g=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,v=g*h/y;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(y)+"/"+g+"/"+h+"/"+o+"/"+v),y>g&&(!v||p&&!this.bitrateTestDelay||v<o))return l}}return-1},i=r,(o=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var n=this._nextABRAutoLevel;return-1!==e&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,r=e.config,i=e.minAutoLevel,o=e.media,a=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,u=o?o.currentTime:0,l=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,f=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,d=(V.bufferInfo(o,u,r.maxBufferHole).end-u)/l,h=this._findBestLevel(a,s,f,i,t,d,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(h>=0)return h;c.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay,y=r.abrBandWidthFactor,g=r.abrBandWidthUpFactor;if(0===d){var v=this.bitrateTestDelay;if(v)p=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-v,c.logger.trace("bitrate test took "+Math.round(1e3*v)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),y=g=1}return h=this._findBestLevel(a,s,f,i,t,d+p,y,g,n),Math.max(h,0)}}])&&Pe(i.prototype,o),a&&Pe(i,a),r}(d);var Re=W(),Ce=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED)||this)._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){c.logger.log("media source opened"),n.hls.trigger(l.default.MEDIA_ATTACHED,{media:n.media});var e=n.mediaSource;e&&e.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){c.logger.log("media source closed")},n._onMediaSourceEnded=function(){c.logger.log("media source ended")},n._onSBUpdateEnd=function(){if(n.audioTimestampOffset&&n.sourceBuffer.audio){var e=n.sourceBuffer.audio;c.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+n.audioTimestampOffset),e.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset}n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var t=n.parent,r=n.segments.reduce(function(e,n){return n.parent===t?e+1:e},0),i={},o=n.sourceBuffer;for(var a in o){var s=o[a];if(!s)throw Error("handling source buffer update end error: source buffer for "+a+" uninitilized and unable to update buffered TimeRanges.");i[a]=s.buffered}n.hls.trigger(l.default.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:i}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===r&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(e){c.logger.error("sourceBuffer error:",e),n.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){d.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(!r)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){c.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(c.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}},i.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&Re){var n=this.mediaSource=new Re;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(n),this._objectUrl=t.src}},i.onMediaDetaching=function(){c.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){c.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):c.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(l.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||2===n)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach(function(n){t.pendingTracks[n]=e[n]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var r in e)if(!t[r]){var i=e[r];if(!i)throw Error("source buffer exists for track "+r+", however track does not");var o=i.levelCodec||i.codec,a=i.container+";codecs="+o;c.logger.log("creating sourceBuffer("+a+")");try{var u=t[r]=n.addSourceBuffer(a);u.addEventListener("updateend",this._onSBUpdateEnd),u.addEventListener("error",this._onSBUpdateError),this.tracks[r]={buffer:u,codec:o,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(e){c.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:a})}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var n=this.sourceBuffer[t];n&&!n.ended&&(n.ended=!0,c.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){var r=e[n];if(r){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}}c.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){c.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=t-Math.max(e,this._levelTargetDuration),o=r.length-1;o>=0;o--){var a=r[o],s=n[a];if(s){var u=s.buffered;u.length>0&&i>u.start(0)&&this.removeBufferRange(a,s,0,i)&&this.hls.trigger(l.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}}else c.logger.error("flushLiveBackBuffer called without attaching media")}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer){var r=this.sourceBuffer[n];if(r&&!0===r.updating)return}e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(c.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(u.isFiniteNumber)(e))&&(c.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n){var i=n[r];i&&(t+=i.buffered.length)}}catch(e){c.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(l.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,n=this.segments,r=this.sourceBuffer;if(Object.keys(r).length){if(!this.media||this.media.error)return this.segments=[],void c.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=n.shift();if(i)try{var o=r[i.type];if(!o)return void this._onSBUpdateEnd();if(o.updating)return void n.unshift(i);o.ended=!1,this.parent=i.parent,o.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(r){c.logger.error("error while trying to append buffer:"+r.message),n.unshift(i);var a={type:s.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1};22===r.code?(this.segments=[],a.details=s.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,a.details=s.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(c.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],a.fatal=!0)),t.trigger(l.default.ERROR,a)}}}},i.flushBuffer=function(e,t,n){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),c.logger.log("flushBuffer,pos/start/end: "+i+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return c.logger.warn("abort flushing too many retries"),!0;var o=r[n];if(o){if(o.ended=!1,o.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,o,e,t))return this.flushBufferCounter++,!1}return c.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,n,r){try{for(var i=0;i<t.buffered.length;i++){var o=t.buffered.start(i),a=t.buffered.end(i),s=Math.max(o,n),u=Math.min(a,r);if(Math.min(u,a)-s>.5){var l="null";return this.media&&(l=this.media.currentTime.toString()),c.logger.log("sb remove "+e+" ["+s+","+u+"], of ["+o+","+a+"], pos:"+l),t.remove(s,u),!0}}}catch(e){c.logger.warn("removeBufferRange failed",e)}return!1},r}(d);function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ie=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.FPS_DROP_LEVEL_CAPPING,l.default.MEDIA_ATTACHING,l.default.MANIFEST_PARSED,l.default.LEVELS_UPDATED,l.default.BUFFER_CODECS,l.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n.clientRect=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,s=r.prototype;return s.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},s.onFpsDropLevelCapping=function(e){r.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},s.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},s.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},s.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},s.onLevelsUpdated=function(e){this.levels=e.levels},s.onMediaDetaching=function(){this.stopCapping()},s.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},s.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var n=this.levels.filter(function(n,i){return r.isLevelAllowed(i,t.restrictedLevels)&&i<=e});return this.clientRect=null,r.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},s.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t},r.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},r.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var r,i,o=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=n)&&(r=s,!(i=e[a+1])||r.width!==i.width||r.height!==i.height)){o=a;break}}return o},i=r,a=[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}],(o=[{key:"mediaWidth",get:function(){return this.getDimensions().width*r.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*r.contentScaleFactor}}])&&De(i.prototype,o),a&&De(i,a),r}(d);var xe=window.performance,Me=function(e){var t,n;function r(t){return e.call(this,t,l.default.MEDIA_ATTACHING)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},i.checkFPS=function(e,t,n){var r=xe.now();if(t){if(this.lastTime){var i=r-this.lastTime,o=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,s=1e3*o/i,u=this.hls;if(u.trigger(l.default.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),s>0&&o>u.config.fpsDroppedMonitoringThreshold*a){var f=u.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=f)&&(f-=1,u.trigger(l.default.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:u.currentLevel}),u.autoLevelCapping=f,u.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},r}(d),Fe=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e,t=this.context;e=this.loader=new window.XMLHttpRequest;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(e,t.url)}catch(n){e.open("GET",t.url,!0),r(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(n){return void this.callbacks.onError({code:e.status,text:n.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},t.readystatechange=function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(window.performance.now(),r.trequest)),4===n){var a=t.status;if(a>=200&&a<300){var s,u;r.tload=Math.max(r.tfirst,window.performance.now()),u="arraybuffer"===i.responseType?(s=t.response).byteLength:(s=t.responseText).length,r.loaded=r.total=u;var l={url:t.responseURL,data:s};this.callbacks.onSuccess(l,r,i,t)}else r.retry>=o.maxRetry||a>=400&&a<499?(c.logger.error(a+" while loading "+i.url),this.callbacks.onError({code:a,text:t.statusText},i,t)):(c.logger.warn(a+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},t.loadtimeout=function(){c.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,t)},e}();function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ue=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.AUDIO_TRACK_LOADED,l.default.AUDIO_TRACK_SWITCHED,l.default.LEVEL_LOADED,l.default.ERROR)||this)._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,u=r.prototype;return u.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},u.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(l.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},u.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)c.logger.warn("Invalid audio track id:",e.id);else{if(c.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},u.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},u.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},u.onError=function(e){e.type===s.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(c.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},u._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)c.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)c.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];c.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var n=t.url,r=t.type,i=t.id;this.hls.trigger(l.default.AUDIO_TRACK_SWITCHING,{id:i,type:r,url:n}),this._loadTrackDetailsIfNeeded(t)}},u.doTick=function(){this._updateTrack(this._trackId)},u._selectAudioGroup=function(e){var t=this.hls.levels[e];if(t&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},u._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var i=t.filter(function(e){return e.default});i.length?t=i:c.logger.warn("No default audio tracks defined")}var o=!1,a=function(){t.forEach(function(t){o||e.audioGroupId&&t.groupId!==e.audioGroupId||r&&r!==t.name||(e._setAudioTrack(t.id),o=!0)})};a(),o||(r=null,a()),o||(c.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},u._needsTrackLoading=function(e){var t=e.details,n=e.url;return!(t&&!t.live)&&!!n},u._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,n=e.id;c.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(l.default.AUDIO_TRACK_LOADING,{url:t,id:n})}},u._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,c.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},u._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],n=t.name,r=t.language,i=t.groupId;c.logger.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var o=e,a=0;a<this.tracks.length;a++){if(!this.trackIdBlacklist[a])if(this.tracks[a].name===n){o=a;break}}o!==e?(c.logger.log("Attempting audio-track fallback id:",o,"group-id:",this.tracks[o].groupId),this._setAudioTrack(o)):c.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"')},i=r,(o=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}])&&Ne(i.prototype,o),a&&Ne(i,a),r}(he);function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Be=window.performance,Ye=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.AUDIO_TRACKS_UPDATED,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.BUFFER_RESET,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED,l.default.INIT_PTS_FOUND)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=pe.STOPPED,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r.waitingVideoCC=null,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,f=r.prototype;return f.onInitPtsFound=function(e){var t=e.id,n=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,this.videoTrackCC=n,c.logger.log("InitPTS for cc: "+n+" found from main: "+r),this.state===pe.WAITING_INIT_PTS&&this.tick())},f.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(c.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=pe.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=pe.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=pe.STOPPED},f.doTick=function(){var e,t,n,r=this.hls,i=r.config;switch(this.state){case pe.ERROR:case pe.PAUSED:case pe.BUFFER_FLUSHING:break;case pe.STARTING:this.state=pe.WAITING_TRACK,this.loadedmetadata=!1;break;case pe.IDLE:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var a=this.mediaBuffer?this.mediaBuffer:this.media,s=this.videoBuffer?this.videoBuffer:this.media,f=e<i.maxBufferHole?Math.max(2,i.maxBufferHole):i.maxBufferHole,d=V.bufferInfo(a,e,f),h=V.bufferInfo(s,e,f),p=d.len,y=d.end,g=this.fragPrevious,v=Math.min(i.maxBufferLength,i.maxMaxBufferLength),m=Math.max(v,h.len),b=this.audioSwitch,_=this.trackId;if((p<m||b)&&_<o.length){if(void 0===(n=o[_].details)){this.state=pe.WAITING_TRACK;break}if(!b&&this._streamEnded(d,n))return this.hls.trigger(l.default.BUFFER_EOS,{type:"audio"}),void(this.state=pe.ENDED);var E,k=n.fragments,A=k.length,w=k[0].start,T=k[A-1].start+k[A-1].duration;if(b)if(n.live&&!n.PTSKnown)c.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),y=0;else if(y=e,n.PTSKnown&&e<w){if(!(d.end>w||d.nextStart))return;c.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=w+.05}if(n.initSegment&&!n.initSegment.data)E=n.initSegment;else if(y<=w){if(E=k[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=function(e,t){return G.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}(k,this.videoTrackCC)),n.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var S=d.nextStart?d.nextStart:w;return c.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(S+.05)),void(this.media.currentTime=S+.05)}}else{var P,O=i.maxFragLookUpTolerance,L=g?k[g.sn-k[0].sn+1]:void 0;y<T?(y>T-O&&(O=0),P=L&&!ce(y,O,L)?L:G.search(k,function(e){return ce(y,O,e)})):P=k[A-1],P&&(E=P,w=P.start,g&&E.level===g.level&&E.sn===g.sn&&(E.sn<n.endSN?(E=k[E.sn+1-n.startSN],this.fragmentTracker.getState(E)!==B&&c.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}E&&(E.encrypted?(c.logger.log("Loading key for "+E.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+_),this.state=pe.KEY_LOADING,r.trigger(l.default.KEY_LOADING,{frag:E})):(this.fragCurrent=E,(b||this.fragmentTracker.getState(E)===N)&&(c.logger.log("Loading "+E.sn+", cc: "+E.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+_+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+y.toFixed(3)),"initSegment"!==E.sn&&(this.startFragRequested=!0),Object(u.isFiniteNumber)(E.sn)&&(this.nextLoadPosition=E.start+E.duration),r.trigger(l.default.FRAG_LOADING,{frag:E}),this.state=pe.FRAG_LOADING)))}break;case pe.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=pe.IDLE);break;case pe.FRAG_LOADING_WAITING_RETRY:var R=Be.now(),C=this.retryDate,D=(a=this.media)&&a.seeking;(!C||R>=C||D)&&(c.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=pe.IDLE);break;case pe.WAITING_INIT_PTS:var I=this.waitingFragment;if(I){var x=I.frag.cc;if(void 0!==this.initPTS[x])this.waitingFragment=null,this.state=pe.FRAG_LOADING,this.onFragLoaded(I);else if(this.videoTrackCC!==this.waitingVideoCC)c.logger.log("Waiting fragment cc ("+x+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var M=V.bufferInfo(this.mediaBuffer,this.media.currentTime,i.maxBufferHole);ce(M.end,i.maxFragLookUpTolerance,I.frag)<0&&(c.logger.log("Waiting fragment cc ("+x+") @ "+I.frag.start+" cancelled because another fragment at "+M.end+" is needed"),this.clearWaitingFragment())}}else this.state=pe.IDLE;break;case pe.STOPPED:case pe.FRAG_LOADING:case pe.PARSING:case pe.PARSED:case pe.ENDED:}},f.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=pe.IDLE)},f.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},f.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},f.onAudioTracksUpdated=function(e){c.logger.log("audio tracks updated"),this.tracks=e.audioTracks},f.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=pe.PAUSED,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=pe.IDLE),this.tick()},f.onAudioTrackLoaded=function(e){var t=e.details,n=e.id,r=this.tracks[n],i=r.details,o=t.totalduration,a=0;if(c.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live||i&&i.live?i&&t.fragments.length>0?(ne(i,t),a=t.fragments[0].start,t.PTSKnown?c.logger.log("live audio playlist sliding:"+a.toFixed(3)):c.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,c.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,r.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;Object(u.isFiniteNumber)(s)?(c.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s):t.live?(this.startPosition=this.computeLivePosition(a,t),c.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===pe.WAITING_TRACK&&(this.state=pe.IDLE),this.tick()},f.onKeyLoaded=function(){this.state===pe.KEY_LOADING&&(this.state=pe.IDLE,this.tick())},f.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag;if(this.state===pe.FRAG_LOADING&&t&&"audio"===n.type&&n.level===t.level&&n.sn===t.sn){var r=this.tracks[this.trackId],i=r.details,o=i.totalduration,a=t.level,s=t.sn,u=t.cc,f=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",d=this.stats=e.stats;if("initSegment"===s)this.state=pe.IDLE,d.tparsed=d.tbuffered=Be.now(),i.initSegment.data=e.payload,this.hls.trigger(l.default.FRAG_BUFFERED,{stats:d,frag:t,id:"audio"}),this.tick();else{this.state=pe.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new J(this.hls,"audio"));var h=this.initPTS[u],p=i.initSegment?i.initSegment.data:[];if(void 0!==h){this.pendingBuffering=!0,c.logger.log("Demuxing "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a);this.demuxer.push(e.payload,p,f,null,t,o,!1,h)}else c.logger.log("Unknown video PTS for cc "+u+", waiting for video PTS before demuxing audio frag "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=pe.WAITING_INIT_PTS}}this.fragLoadError=0},f.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===pe.PARSING){var r,i=e.tracks;if(i.video&&delete i.video,r=i.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(l.default.BUFFER_CODECS,i),c.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var o=r.initSegment;if(o){var a={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,a))}this.tick()}}},f.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"audio"===e.id&&"audio"===e.type&&r.sn===n.sn&&r.level===n.level&&this.state===pe.PARSING){var i=this.trackId,o=this.tracks[i],a=this.hls;Object(u.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(y.AUDIO),c.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),te(o.details,n,e.startPTS,e.endPTS);var f=this.media,d=!1;if(this.audioSwitch)if(f&&f.readyState){var h=f.currentTime;c.logger.log("switching audio track : currentTime:"+h),h>=e.startPTS&&(c.logger.log("switching audio track : flushing all audio"),this.state=pe.BUFFER_FLUSHING,a.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),d=!0,this.audioSwitch=!1,a.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,a.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:i});var p=this.pendingData;if(!p)return c.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void a.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&p.push({type:e.type,data:t,parent:"audio",content:"data"})}),!d&&p.length&&(p.forEach(function(e){t.state===pe.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(l.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},f.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===pe.PARSING&&(this.stats.tparsed=Be.now(),this.state=pe.PARSED,this._checkAppendedParsed())},f.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},f.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},f.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==pe.PARSING&&t!==pe.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},f._checkAppendedParsed=function(){if(!(this.state!==pe.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=Be.now(),n.trigger(l.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;r&&c.logger.log("audio buffered : "+oe.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=pe.IDLE}this.tick()}},f.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=e.frag;if(n&&"audio"!==n.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r;var o=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);c.logger.warn("AudioStreamController: frag loading failed, retry in "+o+" ms"),this.retryDate=Be.now()+o,this.state=pe.FRAG_LOADING_WAITING_RETRY}else c.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=pe.ERROR}break;case s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==pe.ERROR&&(this.state=e.fatal?pe.ERROR:pe.IDLE,c.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case s.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===pe.PARSING||this.state===pe.PARSED)){var a=this.mediaBuffer,u=this.media.currentTime;if(a&&V.isBuffered(a,u)&&V.isBuffered(a,u+.5)){var f=this.config;f.maxMaxBufferLength>=f.maxBufferLength&&(f.maxMaxBufferLength/=2,c.logger.warn("AudioStreamController: reduce max buffer length to "+f.maxMaxBufferLength+"s")),this.state=pe.IDLE}else c.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=pe.BUFFER_FLUSHING,this.hls.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},f.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(c.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(t){e.hls.trigger(l.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=pe.PARSED):(this.state=pe.IDLE,this.fragPrevious=null,this.tick())},i=r,(o=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}])&&je(i.prototype,o),a&&je(i,a),r}(ye),Ge=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",t={"":!0,lr:!0,rl:!0},n={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(e){return"string"==typeof e&&(!!n[e.toLowerCase()]&&e.toLowerCase())}function i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function o(n,o,a){var s=this,u={enumerable:!0};s.hasBeenReset=!1;var l="",c=!1,f=n,d=o,h=a,p=null,y="",g=!0,v="auto",m="start",b=50,_="middle",E=50,k="middle";Object.defineProperty(s,"id",i({},u,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(s,"pauseOnExit",i({},u,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(s,"startTime",i({},u,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},u,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},u,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},u,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},u,{get:function(){return y},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");y=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},u,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},u,{get:function(){return v},set:function(t){if("number"!=typeof t&&t!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},u,{get:function(){return m},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},u,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},u,{get:function(){return _},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},u,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},u,{get:function(){return k},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");k=t,this.hasBeenReset=!0}})),s.displayState=void 0}return o.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},o}(),Ve=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function He(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Ve,this.regionList=[]}function Ke(){this.values=Object.create(null)}function ze(e,t,n,r){var i=r?e.split(r):[e];for(var o in i)if("string"==typeof i[o]){var a=i[o].split(n);if(2===a.length)t(a[0],a[1])}}Ke.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var We=new Ge(0,0,0),qe="middle"===We.align?"middle":"center";function Xe(e,t,n){var r=e;function i(){var t=function(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=i(),o(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),o(),t.endTime=i(),o(),function(e,t){var r=new Ke;ze(e,function(e,t){switch(e){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),a=o[0];r.integer(e,a),r.percent(e,a)&&r.set("snapToLines",!1),r.alt(e,a,["auto"]),2===o.length&&r.alt("lineAlign",o[1],["start",qe,"end"]);break;case"position":o=t.split(","),r.percent(e,o[0]),2===o.length&&r.alt("positionAlign",o[1],["start",qe,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",qe,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===We.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",qe);var o=r.get("position","auto");"auto"===o&&50===We.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function $e(e){return e.replace(/<br(?: \/)?>/gi,"\n")}He.prototype={parse:function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=$e(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:r=n(),t.state){case"HEADER":/:/.test(r)?ze(r,function(e,t){},/:/):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new Ge(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{Xe(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=-1!==r.indexOf("--\x3e");if(!r||a&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var Qe=He;function Je(e,t,n,r){for(var i,o,a,s,u,l=[],c=window.VTTCue||TextTrackCue,f=0;f<r.rows.length;f++)if(a=!0,s=0,u="",!(i=r.rows[f]).isEmpty()){for(var d=0;d<i.chars.length;d++)i.chars[d].uchar.match(/\s/)&&a?s++:(u+=i.chars[d].uchar,a=!1);i.cueStartTime=t,t===n&&(n+=1e-4),o=new c(t,n,$e(u.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?o.line=f+1:o.line=f>7?f-2:f+1,o.align="left",o.position=Math.max(0,Math.min(100,s/32*100)),l.push(o),e&&e.addCue(o)}return l}var Ze,et={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},tt=function(e){var t=e;return et.hasOwnProperty(e)&&(t=et[e]),String.fromCharCode(t)},nt=15,rt=100,it={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ot={17:2,18:4,21:6,22:8,23:10,19:13,20:15},at={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},st={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ut=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(Ze||(Ze={}));var lt=function(){function e(){this.time=null,this.verboseLevel=Ze.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&c.logger.log(this.time+" ["+e+"] "+t)},e}(),ct=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},ft=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),dt=function(){function e(e,t,n,r,i,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new ft(t,n,r,i,o)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),ht=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<rt;t++)this.chars.push(new dt);this.logger=e,this.pos=0,this.currPenState=new ft}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<rt;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<rt;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<rt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(Ze.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>rt&&(this.logger.log(Ze.DEBUG,"Too large cursor position "+this.pos),this.pos=rt)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=tt(e);this.pos>=rt?this.logger.log(Ze.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<rt;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<rt;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),pt=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<nt;t++)this.rows.push(new ht(e));this.logger=e,this.currRow=nt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<nt;e++)this.rows[e].clear();this.currRow=nt-1},t.equals=function(e){for(var t=!0,n=0;n<nt;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<nt;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<nt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(Ze.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(Ze.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<nt;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[r].cueStartTime,a=this.logger.time;if(o&&null!==a&&o<a)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(i.rows[r+s])}}this.currRow=t;var u=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,c=Math.max(l-1,0);u.setCursor(e.indent),e.color=u.chars[c].penState.foreground}var f={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(f)},t.setBkgData=function(e){this.logger.log(Ze.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(Ze.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(Ze.INFO,"Rolling up")}else this.logger.log(Ze.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<nt;i++){var o=this.rows[i].getTextString();o&&(r=i+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},t.getTextAndFormat=function(){return this.rows},e}(),yt=function(){function e(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new pt(n),this.nonDisplayedMemory=new pt(n),this.lastOutputScreen=new pt(n),this.currRollUpRow=this.displayedMemory.rows[nt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[nt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(Ze.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Ze.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(Ze.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(Ze.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(Ze.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(Ze.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(Ze.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(Ze.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(Ze.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(Ze.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(Ze.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(Ze.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(Ze.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(Ze.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(this.logger.log(Ze.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Ze.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(Ze.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(Ze.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}();function gt(e,t,n){n.a=e,n.b=t}function vt(e,t,n){return n.a===e&&n.b===t}var mt=function(){function e(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new lt;this.channels=[null,new yt(e,t,r),new yt(e+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,r,i,o=!1;this.logger.time=e;for(var a=0;a<t.length;a+=2)if(r=127&t[a],i=127&t[a+1],0!==r||0!==i){if(this.logger.log(Ze.DATA,"["+ct([t[a],t[a+1]])+"] -> ("+ct([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(o=this.parseChars(r,i))){var s=this.currentChannel;if(s&&s>0)this.channels[s].insertChars(o);else this.logger.log(Ze.WARNING,"No channel found yet. TEXT-MODE?")}n||o||this.logger.log(Ze.WARNING,"Couldn't parse cleaned data "+ct([r,i])+" orig: "+ct([t[a],t[a+1]]))}},t.parseCmd=function(e,t){var n=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(vt(e,t,n))return gt(null,null,n),this.logger.log(Ze.DEBUG,"Repeated command ("+ct([e,t])+") is dropped"),!0;var r=20===e||21===e||23===e?1:2,i=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),gt(e,t,n),this.currentChannel=r,!0},t.parseMidrow=function(e,t){var n=0;if((17===e||25===e)&&t>=32&&t<=47){if((n=17===e?1:2)!==this.currentChannel)return this.logger.log(Ze.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(Ze.DEBUG,"MIDROW ("+ct([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var n,r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(vt(e,t,r))return gt(null,null,r),!0;var i=e<=23?1:2;n=t>=64&&t<=95?1===i?it[e]:at[e]:1===i?ot[e]:st[e];var o=this.channels[i];return!!o&&(o.setPAC(this.interpretPAC(n,t)),gt(e,t,r),this.currentChannel=i,!0)},t.interpretPAC=function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.parseChars=function(e,t){var n,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,this.logger.log(Ze.INFO,"Special char '"+tt(o)+"' in channel "+n),r=[o]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var a=ct(r);this.logger.log(Ze.DEBUG,"Char codes =  "+a.join(",")),gt(e,t,this.cmdHistory)}return r},t.parseBackgroundAttributes=function(e,t){var n;if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;var r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=ut[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(r),gt(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}},e}(),bt=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[]},e}(),_t=function(e,t,n){return e.substr(n||0,t.length)===t},Et=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},kt={parse:function(e,t,n,r,i,o){var a,s=Object(Ee.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",c=0,f=0,d=0,h=[],p=!0,y=!1,g=new Qe;g.oncue=function(e){var t=n[r],i=n.ccOffset;t&&t.new&&(void 0!==f?i=n.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC];e.presentationOffset=n}(n,r,d)),d&&(i=d-n.presentationOffset),y&&(e.startTime+=i-f,e.endTime+=i-f),e.id=Et(e.startTime.toString())+Et(e.endTime.toString())+Et(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&h.push(e)},g.onparsingerror=function(e){a=e},g.onflush=function(){a&&o?o(a):i(h)},s.forEach(function(e){if(p){if(_t(e,"X-TIMESTAMP-MAP=")){p=!1,y=!0,e.substr(16).split(",").forEach(function(e){_t(e,"LOCAL:")?l=e.substr(6):_t(e,"MPEGTS:")&&(c=parseInt(e.substr(7)))});try{t+(9e4*n[r].start||0)<0&&(t+=8589934592),c-=t,f=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),i=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(u.isFiniteNumber)(t)&&Object(u.isFiniteNumber)(n)&&Object(u.isFiniteNumber)(r)&&Object(u.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,t+=6e4*r,t+=36e5*i}(l)/1e3,d=c/9e4}catch(e){y=!1,a=e}return}""===e&&(p=!1)}g.parse(e+"\n")}),g.flush()}};function At(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var Tt=function(e){var t,n;function r(t){var n;if((n=e.call(this,t,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_USERDATA,l.default.FRAG_DECRYPTED,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.FRAG_LOADED,l.default.INIT_PTS_FOUND)||this).media=null,n.config=void 0,n.enabled=!0,n.Cues=void 0,n.textTracks=[],n.tracks=[],n.initPTS=[],n.unparsedVttFrags=[],n.captionsTracks={},n.nonNativeCaptionsTracks={},n.captionsProperties=void 0,n.cea608Parser1=void 0,n.cea608Parser2=void 0,n.lastSn=-1,n.prevCC=-1,n.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},n.hls=t,n.config=t.config,n.Cues=t.config.cueHandler,n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode},textTrack3:{label:n.config.captionsTextTrack3Label,languageCode:n.config.captionsTextTrack3LanguageCode},textTrack4:{label:n.config.captionsTextTrack4Label,languageCode:n.config.captionsTextTrack4LanguageCode}},n.config.enableCEA708Captions){var r=new bt(At(n),"textTrack1"),i=new bt(At(n),"textTrack2"),o=new bt(At(n),"textTrack3"),a=new bt(At(n),"textTrack4");n.cea608Parser1=new mt(1,r,i),n.cea608Parser2=new mt(3,o,a)}return n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.addCues=function(e,t,n,r,i){for(var o,a,s,u,c=!1,f=i.length;f--;){var d=i[f],h=(o=d[0],a=d[1],s=t,u=n,Math.min(a,u)-Math.max(o,s));if(h>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],n),c=!0,h/(n-t)>.5))return}if(c||i.push([t,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,n,r);else{var p=this.Cues.newCue(null,t,n,r);this.hls.trigger(l.default.CUES_PARSED,{type:"captions",cues:p,track:e})}},i.onInitPtsFound=function(e){var t=this,n=e.frag,r=e.id,i=e.initPTS,o=this.unparsedVttFrags;"main"===r&&(this.initPTS[n.cc]=i),o.length&&(this.unparsedVttFrags=[],o.forEach(function(e){t.onFragLoaded(e)}))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},i.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},i.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,r=this.media,i=t[e],o=i.label,a=i.languageCode,s=this.getExistingTrack(e);if(s)n[e]=s,Ae(n[e]),ke(n[e],r);else{var u=this.createTextTrack("captions",o,a);u&&(u[e]=!0,n[e]=u)}}},i.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(l.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},i.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},i.destroy=function(){e.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Ae(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Ae(t[n])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var n=e.subtitles||[],r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var i=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,n){var r;if(n<i.length){for(var o=null,a=0;a<i.length;a++)if(wt(i[a],e)){o=i[a];break}o&&(r=o)}r||(r=t.createTextTrack("subtitles",e.name,e.lang)),e.default?r.mode=t.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",t.textTracks.push(r)})}else if(!r&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}});this.hls.trigger(l.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(e){var n=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(n){var r="textTrack"+n[1],i=t.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}})},i.onFragLoaded=function(e){var t=e.frag,n=e.payload,r=this.cea608Parser1,i=this.cea608Parser2,o=this.initPTS,a=this.lastSn,s=this.unparsedVttFrags;if("main"===t.type){var c=t.sn;t.sn!==a+1&&r&&i&&(r.reset(),i.reset()),this.lastSn=c}else if("subtitle"===t.type)if(n.byteLength){if(!Object(u.isFiniteNumber)(o[t.cc]))return s.push(e),void(o.length&&this.hls.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var f=t.decryptdata;null!=f&&null!=f.key&&"AES-128"===f.method||this._parseVTTs(t,n)}else this.hls.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var n=this,r=this.hls,i=this.prevCC,o=this.textTracks,a=this.vttCCs;a[e.cc]||(a[e.cc]={start:e.start,prevCC:i,new:!0},this.prevCC=e.cc),kt.parse(t,this.initPTS[e.cc],a,e.cc,function(t){if(n.config.renderTextTracksNatively){var i=o[e.level];if("disabled"===i.mode)return void r.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach(function(e){if(!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(n){c.logger.debug("Failed occurred on adding cues: "+n);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}})}else{var a=n.tracks[e.level].default?"default":"subtitles"+e.level;r.trigger(l.default.CUES_PARSED,{type:"subtitles",cues:t,track:a})}r.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){c.logger.log("Failed to parse VTT cue: "+t),r.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},i.onFragDecrypted=function(e){var t=e.frag,n=e.payload;if("subtitle"===t.type){if(!Object(u.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(t,n)}},i.onFragParsingUserdata=function(e){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var r=0;r<e.samples.length;r++){var i=e.samples[r].bytes;if(i){var o=this.extractCea608Data(i);t.addData(e.samples[r].pts,o[0]),n.addData(e.samples[r].pts,o[1])}}},i.extractCea608Data=function(e){for(var t=31&e[0],n=2,r=[[],[]],i=0;i<t;i++){var o=e[n++],a=127&e[n++],s=127&e[n++],u=3&o;0===a&&0===s||0!=(4&o)&&(0!==u&&1!==u||(r[u].push(a),r[u].push(s)))}return r},r}(d);function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pt(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}var Ot=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADED,l.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n.queuedDefaultTrack=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,s=r.prototype;return s.destroy=function(){d.prototype.destroy.call(this)},s.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(u.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(u.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Pt(this.media.textTracks).forEach(function(e){Ae(e)}),this.subtitleTrack=-1,this.media=null)},s.onManifestLoaded=function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.hls.trigger(l.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},s.onSubtitleTrackLoaded=function(e){var t=this,n=e.id,r=e.details,i=this.trackId,o=this.tracks,a=o[i];if(n>=o.length||n!==i||!a||this.stopped)this._clearReloadTimer();else if(c.logger.log("subtitle track "+n+" loaded"),r.live){var s=ie(a.details,r,e.stats.trequest);c.logger.log("Reloading live subtitle playlist in "+s+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},s)}else this._clearReloadTimer()},s.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},s._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,n=this.hls,r=t[e];e<0||!r||r.details&&!r.details.live||(c.logger.log("Loading subtitle track "+e),n.trigger(l.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))},s._toggleTrackModes=function(e){var t=this.media,n=this.subtitleDisplay,r=this.trackId;if(t){var i=Pt(t.textTracks);if(-1===e)[].slice.call(i).forEach(function(e){e.mode="disabled"});else{var o=i[r];o&&(o.mode="disabled")}var a=i[e];a&&(a.mode=n?"showing":"hidden")}},s._setSubtitleTrackInternal=function(e){var t=this.hls,n=this.tracks;!Object(u.isFiniteNumber)(e)||e<-1||e>=n.length||(this.trackId=e,c.logger.log("Switching to subtitle track "+e),t.trigger(l.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},s._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=Pt(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack=e}},i=r,(o=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}])&&St(i.prototype,o),a&&St(i,a),r}(d),Lt=n("./src/crypt/decrypter.js");var Rt,Ct=window.performance,Dt=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.ERROR,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.SUBTITLE_TRACKS_UPDATED,l.default.SUBTITLE_TRACK_SWITCH,l.default.SUBTITLE_TRACK_LOADED,l.default.SUBTITLE_FRAG_PROCESSED,l.default.LEVEL_UPDATED)||this).fragmentTracker=n,r.config=t.config,r.state=pe.STOPPED,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new Lt.default(t,t.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.startLoad=function(){this.stopLoad(),this.state=pe.IDLE;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(500),this.tick())},i.onSubtitleFragProcessed=function(e){var t=e.frag,n=e.success;if(this.fragPrevious=t,this.state=pe.IDLE,n){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i,o=t.start,a=0;a<r.length;a++)if(o>=r[a].start&&o<=r[a].end){i=r[a];break}var s=t.start+t.duration;i?i.end=s:(i={start:o,end:s},r.push(i))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=pe.IDLE},i.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach(function(t){e.tracksBuffered[t.id]=[]}),this.media=null,this.state=pe.STOPPED)},i.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=pe.IDLE)},i.onSubtitleTracksUpdated=function(e){var t=this;c.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},i.onSubtitleTrackLoaded=function(e){var t=e.id,n=e.details,r=this.currentTrackId,i=this.tracks,o=i[r];t>=i.length||t!==r||!o||(n.live&&function(e,t,n){void 0===n&&(n=0);var r=-1;re(e,t,function(e,t,n){t.start=e.start,r=n});var i=t.fragments;if(r<0)i.forEach(function(e){e.start+=n});else for(var o=r+1;o<i.length;o++)i[o].start=i[o-1].start+i[o-1].duration}(o.details,n,this.lastAVStart),o.details=n,this.setInterval(500))},i.onKeyLoaded=function(){this.state===pe.KEY_LOADING&&(this.state=pe.IDLE)},i.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag.decryptdata,r=e.frag,i=this.hls;if(this.state===pe.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var o=Ct.now();this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,function(e){var t=Ct.now();i.trigger(l.default.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:o,tdecrypt:t}})})}},i.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},i.doTick=function(){if(this.media)switch(this.state){case pe.IDLE:var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,r=this.media,i=this.tracks;if(!i||!i[t]||!i[t].details)break;var o,a=e.maxBufferHole,s=e.maxFragLookUpTolerance,u=Math.min(e.maxBufferLength,e.maxMaxBufferLength),f=V.bufferedInfo(this._getBuffered(),r.currentTime,a),d=f.end,h=f.len,p=i[t].details,y=p.fragments,g=y.length,v=y[g-1].start+y[g-1].duration;if(h>u)return;var m=this.fragPrevious;d<v?(m&&p.hasProgramDateTime&&(o=ue(y,m.endProgramDateTime,s)),o||(o=le(m,y,d,s))):o=y[g-1],o&&o.encrypted?(c.logger.log("Loading key for "+o.sn),this.state=pe.KEY_LOADING,this.hls.trigger(l.default.KEY_LOADING,{frag:o})):o&&n.getState(o)===N&&(this.fragCurrent=o,this.state=pe.FRAG_LOADING,this.hls.trigger(l.default.FRAG_LOADING,{frag:o}))}else this.state=pe.IDLE},i.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,e.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){if(this.fragCurrent){var e=this.media?this.media.currentTime:0,t=this.config.maxFragLookUpTolerance,n=this.fragCurrent.start-t,r=this.fragCurrent.start+this.fragCurrent.duration+t;(e<n||e>r)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=pe.IDLE,this.tick())}},r}(ye);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(Rt||(Rt={}));var It="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Mt=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHED,l.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._drmSystemOptions=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n.mediaKeysPromise=null,n._onMediaEncrypted=function(e){if(c.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!n.mediaKeysPromise)return c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void n.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var t=function(t){n._media&&(n._attemptSetMediaKeys(t),n._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};n.mediaKeysPromise.then(t).catch(t)},n._config=t.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n._drmSystemOptions=t.config.drmSystemOptions,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,a,u=r.prototype;return u.getLicenseServerUrl=function(e){switch(e){case Rt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},u._attemptKeySystemAccess=function(e,t,n){var r=this,i=function(e,t,n,r){switch(e){case Rt.WIDEVINE:return function(e,t,n){var r={audioCapabilities:[],videoCapabilities:[]};return e.forEach(function(e){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:n.audioRobustness||""})}),t.forEach(function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:n.videoRobustness||""})}),[r]}(t,n,r);default:throw new Error("Unknown key-system: "+e)}}(e,t,n,this._drmSystemOptions);c.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(e,i);this.mediaKeysPromise=o.then(function(t){return r._onMediaKeySystemAccessObtained(e,t)}),o.catch(function(t){c.logger.error('Failed to obtain key-system "'+e+'" access:',t)})},u._onMediaKeySystemAccessObtained=function(e,t){var n=this;c.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r);var i=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(t){return r.mediaKeys=t,c.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated(),t});return i.catch(function(e){c.logger.error("Failed to create media-keys:",e)}),i},u._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})},u._onNewMediaKeySession=function(e){var t=this;c.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(n){t._onKeySessionMessage(e,n.message)},!1)},u._onKeySessionMessage=function(e,t){c.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){c.logger.log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)})},u._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});c.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},u._generateRequestWithPreferredKeySession=function(e,t){var n=this,r=this._mediaKeysList[0];if(!r)return c.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)c.logger.warn("Key-Session already initialized but requested again");else{var i=r.mediaKeysSession;if(!i)return c.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return c.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});c.logger.log('Generating key-session request for "'+e+'" init data type'),r.mediaKeysSessionInitialized=!0,i.generateRequest(e,t).then(function(){c.logger.debug("Key-session generation succeeded")}).catch(function(e){c.logger.error("Error generating key-session request:",e),n.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},u._createLicenseXhr=function(e,t,n){var r=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(r,e)}catch(t){r.open("POST",e,!0),i(r,e)}r.readyState||r.open("POST",e,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n),r},u._onLicenseRequestReadyStageChange=function(e,t,n,r){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,c.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&c.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(e.response);else{if(c.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var i=3-this._requestLicenseFailureCount+1;c.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(n,r)}}},u._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case Rt.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},u._requestLicense=function(e,t){c.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return c.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,e,t);c.logger.log("Sending license request to URL: "+r);var o=this._generateLicenseRequestChallenge(n,e);i.send(o)}catch(e){c.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},u.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},u.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch(function(){})})).then(function(){return e.setMediaKeys(null)}).catch(function(){}))},u.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),n=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(Rt.WIDEVINE,t,n)}},i=r,(o=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&xt(i.prototype,o),a&&xt(i,a),r}(d);function Ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ft(Object(n),!0).forEach(function(t){Ut(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ft(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jt=Nt(Nt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Fe,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Le,bufferController:Ce,capLevelController:Ie,fpsController:Me,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:It,testBandwidth:!0},{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Dt,subtitleTrackController:Ot,timelineController:Tt,audioStreamController:Ye,audioTrackController:Ue,emeController:Mt});function Bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(n),!0).forEach(function(t){Gt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kt(e,t,n){return t&&Ht(e.prototype,t),n&&Ht(e,n),e}var zt=function(e){var t,n;function r(t){var n;void 0===t&&(t={}),(n=e.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var i=r.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=Yt(Yt({},i),t);var o=Vt(n).config;if(void 0!==o.liveMaxLatencyDurationCount&&o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==o.liveMaxLatencyDuration&&(void 0===o.liveSyncDuration||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(c.enableLogs)(o.debug),n._autoLevelCapping=-1;var a=n.abrController=new o.abrController(Vt(n)),s=new o.bufferController(Vt(n)),u=n.capLevelController=new o.capLevelController(Vt(n)),l=new o.fpsController(Vt(n)),f=new x(Vt(n)),d=new M(Vt(n)),h=new F(Vt(n)),p=new we(Vt(n)),y=n.levelController=new _e(Vt(n)),g=new Y(Vt(n)),v=[y,n.streamController=new me(Vt(n),g)],m=o.audioStreamController;m&&v.push(new m(Vt(n),g)),n.networkControllers=v;var b=[f,d,h,a,s,u,l,p,g];if(m=o.audioTrackController){var _=new m(Vt(n));n.audioTrackController=_,b.push(_)}if(m=o.subtitleTrackController){var E=new m(Vt(n));n.subtitleTrackController=E,v.push(E)}if(m=o.emeController){var k=new m(Vt(n));n.emeController=k,b.push(k)}return(m=o.subtitleStreamController)&&v.push(new m(Vt(n),g)),(m=o.timelineController)&&b.push(new m(Vt(n))),n.coreComponents=b,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.isSupported=function(){return function(){var e=W();if(!e)return!1;var t=self.SourceBuffer||self.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!r}()},Kt(r,null,[{key:"version",get:function(){return"0.14.16"}},{key:"Events",get:function(){return l.default}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:jt},set:function(e){r.defaultConfig=e}}]);var i=r.prototype;return i.destroy=function(){c.logger.log("destroy"),this.trigger(l.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){c.logger.log("attachMedia"),this.media=e,this.trigger(l.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(l.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),c.logger.log("loadSource:"+e),this.url=e,this.trigger(l.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){void 0===e&&(e=-1),c.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},i.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},i.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){c.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},i.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},Kt(r,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){c.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){c.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){c.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){c.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){c.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){c.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,r=0;r<n;r++){if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>t)return r}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),r}(X);zt.defaultConfig=void 0},"./src/polyfills/number.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isFiniteNumber",function(){return r}),n.d(t,"MAX_SAFE_INTEGER",function(){return i});var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(e,t,n){"use strict";function r(){return"undefined"==typeof window?self:window}n.r(t),n.d(t,"getSelfScope",function(){return r})},"./src/utils/logger.js":function(e,t,n){"use strict";n.r(t),n.d(t,"enableLogs",function(){return l}),n.d(t,"logger",function(){return c});var r=n("./src/utils/get-self-scope.js");function i(){}var o={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=o;var s=Object(r.getSelfScope)();function u(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){a[t]=e[t]?e[t].bind(e):function(e){var t=s.console[e];return t?function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=function(e,t){return t="["+e+"] > "+t}(e,r[0])),t.apply(s.console,r)}:i}(t)})}var l=function(e){if(s.console&&!0===e||"object"==typeof e){u(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=o}}else a=o},c=a}}).default},e.exports=r())},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r,i=function(){function e(e){return null==e?String(e):K[z.call(e)]||"object"}function t(t){return"function"==e(t)}function r(e){return null!=e&&e==e.window}function i(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function o(t){return"object"==e(t)}function a(e){return o(e)&&!r(e)&&Object.getPrototypeOf(e)==Object.prototype}function s(e){return"number"==typeof e.length}function u(e){return e.length>0?k.fn.concat.apply([],e):e}function l(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function c(e){return e in D?D[e]:D[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function f(e,t){return"number"!=typeof t||I[l(e)]?t:t+"px"}function d(e){return"children"in e?L.call(e.children):k.map(e.childNodes,function(e){return 1==e.nodeType?e:void 0})}function h(e,t){var n,r=e?e.length:0;for(n=0;r>n;n++)this[n]=e[n];this.length=r,this.selector=t||""}function p(e,t,n){for(E in t)n&&(a(t[E])||$(t[E]))?(a(t[E])&&!a(e[E])&&(e[E]={}),$(t[E])&&!$(e[E])&&(e[E]=[]),p(e[E],t[E],n)):t[E]!==_&&(e[E]=t[E])}function y(e,t){return null==t?k(e):k(e).filter(t)}function g(e,n,r,i){return t(n)?n.call(e,r,i):n}function v(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function m(e,t){var n=e.className||"",r=n&&n.baseVal!==_;return t===_?r?n.baseVal:n:void(r?n.baseVal=t:e.className=t)}function b(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?k.parseJSON(e):e):e}catch(t){return e}}var _,E,k,A,w,T,S=[],P=S.concat,O=S.filter,L=S.slice,R=window.document,C={},D={},I={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},x=/^\s*<(\w+|!)[^>]*>/,M=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,F=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,N=/^(?:body|html)$/i,U=/([A-Z])/g,j=["val","css","html","text","data","width","height","offset"],B=R.createElement("table"),Y=R.createElement("tr"),G={tr:R.createElement("tbody"),tbody:B,thead:B,tfoot:B,td:Y,th:Y,"*":R.createElement("div")},V=/complete|loaded|interactive/,H=/^[\w-]*$/,K={},z=K.toString,W={},q=R.createElement("div"),X={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},$=Array.isArray||function(e){return e instanceof Array};return W.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,o=!i;return o&&(i=q).appendChild(e),r=~W.qsa(i,t).indexOf(e),o&&q.removeChild(e),r},w=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},T=function(e){return O.call(e,function(t,n){return e.indexOf(t)==n})},W.fragment=function(e,t,n){var r,i,o;return M.test(e)&&(r=k(R.createElement(RegExp.$1))),r||(e.replace&&(e=e.replace(F,"<$1></$2>")),t===_&&(t=x.test(e)&&RegExp.$1),t in G||(t="*"),(o=G[t]).innerHTML=""+e,r=k.each(L.call(o.childNodes),function(){o.removeChild(this)})),a(n)&&(i=k(r),k.each(n,function(e,t){j.indexOf(e)>-1?i[e](t):i.attr(e,t)})),r},W.Z=function(e,t){return new h(e,t)},W.isZ=function(e){return e instanceof W.Z},W.init=function(e,n){var r;if(!e)return W.Z();if("string"==typeof e)if("<"==(e=e.trim())[0]&&x.test(e))r=W.fragment(e,RegExp.$1,n),e=null;else{if(n!==_)return k(n).find(e);r=W.qsa(R,e)}else{if(t(e))return k(R).ready(e);if(W.isZ(e))return e;if($(e))r=function(e){return O.call(e,function(e){return null!=e})}(e);else if(o(e))r=[e],e=null;else if(x.test(e))r=W.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==_)return k(n).find(e);r=W.qsa(R,e)}}return W.Z(r,e)},(k=function(e,t){return W.init(e,t)}).extend=function(e){var t,n=L.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){p(e,n,t)}),e},W.qsa=function(e,t){var n,r="#"==t[0],i=!r&&"."==t[0],o=r||i?t.slice(1):t,a=H.test(o);return e.getElementById&&a&&r?(n=e.getElementById(o))?[n]:[]:1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType?[]:L.call(a&&!r&&e.getElementsByClassName?i?e.getElementsByClassName(o):e.getElementsByTagName(t):e.querySelectorAll(t))},k.contains=R.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},k.type=e,k.isFunction=t,k.isWindow=r,k.isArray=$,k.isPlainObject=a,k.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},k.inArray=function(e,t,n){return S.indexOf.call(t,e,n)},k.camelCase=w,k.trim=function(e){return null==e?"":String.prototype.trim.call(e)},k.uuid=0,k.support={},k.expr={},k.noop=function(){},k.map=function(e,t){var n,r,i,o=[];if(s(e))for(r=0;r<e.length;r++)null!=(n=t(e[r],r))&&o.push(n);else for(i in e)null!=(n=t(e[i],i))&&o.push(n);return u(o)},k.each=function(e,t){var n,r;if(s(e)){for(n=0;n<e.length;n++)if(!1===t.call(e[n],n,e[n]))return e}else for(r in e)if(!1===t.call(e[r],r,e[r]))return e;return e},k.grep=function(e,t){return O.call(e,t)},window.JSON&&(k.parseJSON=JSON.parse),k.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){K["[object "+t+"]"]=t.toLowerCase()}),k.fn={constructor:W.Z,length:0,forEach:S.forEach,reduce:S.reduce,push:S.push,sort:S.sort,splice:S.splice,indexOf:S.indexOf,concat:function(){var e,t,n=[];for(e=0;e<arguments.length;e++)t=arguments[e],n[e]=W.isZ(t)?t.toArray():t;return P.apply(W.isZ(this)?this.toArray():this,n)},map:function(e){return k(k.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return k(L.apply(this,arguments))},ready:function(e){return V.test(R.readyState)&&R.body?e(k):R.addEventListener("DOMContentLoaded",function(){e(k)},!1),this},get:function(e){return e===_?L.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return S.every.call(this,function(t,n){return!1!==e.call(t,n,t)}),this},filter:function(e){return t(e)?this.not(this.not(e)):k(O.call(this,function(t){return W.matches(t,e)}))},add:function(e,t){return k(T(this.concat(k(e,t))))},is:function(e){return this.length>0&&W.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==_)this.each(function(t){e.call(this,t)||n.push(this)});else{var r="string"==typeof e?this.filter(e):s(e)&&t(e.item)?L.call(e):k(e);this.forEach(function(e){r.indexOf(e)<0&&n.push(e)})}return k(n)},has:function(e){return this.filter(function(){return o(e)?k.contains(this,e):k(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!o(e)?e:k(e)},last:function(){var e=this[this.length-1];return e&&!o(e)?e:k(e)},find:function(e){var t=this;return e?"object"==n(e)?k(e).filter(function(){var e=this;return S.some.call(t,function(t){return k.contains(t,e)})}):1==this.length?k(W.qsa(this[0],e)):this.map(function(){return W.qsa(this,e)}):k()},closest:function(e,t){var r=this[0],o=!1;for("object"==n(e)&&(o=k(e));r&&!(o?o.indexOf(r)>=0:W.matches(r,e));)r=r!==t&&!i(r)&&r.parentNode;return k(r)},parents:function(e){for(var t=[],n=this;n.length>0;)n=k.map(n,function(e){return(e=e.parentNode)&&!i(e)&&t.indexOf(e)<0?(t.push(e),e):void 0});return y(t,e)},parent:function(e){return y(T(this.pluck("parentNode")),e)},children:function(e){return y(this.map(function(){return d(this)}),e)},contents:function(){return this.map(function(){return this.contentDocument||L.call(this.childNodes)})},siblings:function(e){return y(this.map(function(e,t){return O.call(d(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return k.map(this,function(t){return t[e]})},show:function(){return this.each(function(){var e,t,n;"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=(e=this.nodeName,C[e]||(t=R.createElement(e),R.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),C[e]=n),C[e]))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var r=k(e).get(0),i=r.parentNode||this.length>1;return this.each(function(t){k(this).wrapAll(n?e.call(this,t):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){k(this[0]).before(e=k(e));for(var t;(t=e.children()).length;)e=t.first();k(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var r=k(this),i=r.contents(),o=n?e.call(this,t):e;i.length?i.wrapAll(o):r.append(o)})},unwrap:function(){return this.parent().each(function(){k(this).replaceWith(k(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=k(this);(e===_?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return k(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return k(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;k(this).empty().append(g(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=g(this,e,t,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this[0].textContent:null},attr:function(e,t){var n;return"string"!=typeof e||1 in arguments?this.each(function(n){if(1===this.nodeType)if(o(e))for(E in e)v(this,E,e[E]);else v(this,e,g(this,t,n,this.getAttribute(e)))}):this.length&&1===this[0].nodeType?!(n=this[0].getAttribute(e))&&e in this[0]?this[0][e]:n:_},removeAttr:function(e){return this.each(function(){1===this.nodeType&&e.split(" ").forEach(function(e){v(this,e)},this)})},prop:function(e,t){return e=X[e]||e,1 in arguments?this.each(function(n){this[e]=g(this,t,n,this[e])}):this[0]&&this[0][e]},data:function(e,t){var n="data-"+e.replace(U,"-$1").toLowerCase(),r=1 in arguments?this.attr(n,t):this.attr(n);return null!==r?b(r):_},val:function(e){return 0 in arguments?this.each(function(t){this.value=g(this,e,t,this.value)}):this[0]&&(this[0].multiple?k(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=k(this),r=g(this,e,t,n.offset()),i=n.offsetParent().offset(),o={top:r.top-i.top,left:r.left-i.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(!this.length)return null;if(!k.contains(R.documentElement,this[0]))return{top:0,left:0};var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(arguments.length<2){var r,i=this[0];if(!i)return;if(r=getComputedStyle(i,""),"string"==typeof t)return i.style[w(t)]||r.getPropertyValue(t);if($(t)){var o={};return k.each(t,function(e,t){o[t]=i.style[w(t)]||r.getPropertyValue(t)}),o}}var a="";if("string"==e(t))n||0===n?a=l(t)+":"+f(t,n):this.each(function(){this.style.removeProperty(l(t))});else for(E in t)t[E]||0===t[E]?a+=l(E)+":"+f(E,t[E])+";":this.each(function(){this.style.removeProperty(l(E))});return this.each(function(){this.style.cssText+=";"+a})},index:function(e){return e?this.indexOf(k(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return!!e&&S.some.call(this,function(e){return this.test(m(e))},c(e))},addClass:function(e){return e?this.each(function(t){if("className"in this){A=[];var n=m(this);g(this,e,t,n).split(/\s+/g).forEach(function(e){k(this).hasClass(e)||A.push(e)},this),A.length&&m(this,n+(n?" ":"")+A.join(" "))}}):this},removeClass:function(e){return this.each(function(t){if("className"in this){if(e===_)return m(this,"");A=m(this),g(this,e,t,A).split(/\s+/g).forEach(function(e){A=A.replace(c(e)," ")}),m(this,A.trim())}})},toggleClass:function(e,t){return e?this.each(function(n){var r=k(this);g(this,e,n,m(this)).split(/\s+/g).forEach(function(e){(t===_?!r.hasClass(e):t)?r.addClass(e):r.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var t="scrollTop"in this[0];return e===_?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var t="scrollLeft"in this[0];return e===_?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),r=N.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(k(e).css("margin-top"))||0,n.left-=parseFloat(k(e).css("margin-left"))||0,r.top+=parseFloat(k(t[0]).css("border-top-width"))||0,r.left+=parseFloat(k(t[0]).css("border-left-width"))||0,{top:n.top-r.top,left:n.left-r.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||R.body;e&&!N.test(e.nodeName)&&"static"==k(e).css("position");)e=e.offsetParent;return e})}},k.fn.detach=k.fn.remove,["width","height"].forEach(function(e){var t=e.replace(/./,function(e){return e[0].toUpperCase()});k.fn[e]=function(n){var o,a=this[0];return n===_?r(a)?a["inner"+t]:i(a)?a.documentElement["scroll"+t]:(o=this.offset())&&o[e]:this.each(function(t){(a=k(this)).css(e,g(this,n,t,a[e]()))})}}),["after","prepend","before","append"].forEach(function(t,n){var r=n%2;k.fn[t]=function(){var t,i,o=k.map(arguments,function(n){return"object"==(t=e(n))||"array"==t||null==n?n:W.fragment(n)}),a=this.length>1;return o.length<1?this:this.each(function(e,t){i=r?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null;var s=k.contains(R.documentElement,i);o.forEach(function(e){if(a)e=e.cloneNode(!0);else if(!i)return k(e).remove();i.insertBefore(e,t),s&&function e(t,n){n(t);for(var r=0,i=t.childNodes.length;i>r;r++)e(t.childNodes[r],n)}(e,function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},k.fn[r?t+"To":"insert"+(n?"Before":"After")]=function(e){return k(e)[t](this),this}}),W.Z.prototype=h.prototype=k.fn,W.uniq=T,W.deserializeValue=b,k.zepto=W,k}();window.Zepto=i,void 0===window.$&&(window.$=i),function(e){function t(e){return e._zid||(e._zid=f++)}function n(e,n,i,o){if((n=r(n)).ns)var a=function(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}(n.ns);return(y[t(e)]||[]).filter(function(e){return!(!e||n.e&&e.e!=n.e||n.ns&&!a.test(e.ns)||i&&t(e.fn)!==t(i)||o&&e.sel!=o)})}function r(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function i(e,t){return e.del&&!v&&e.e in m||!!t}function o(e){return b[e]||v&&m[e]||e}function a(n,a,s,l,f,d,h){var p=t(n),g=y[p]||(y[p]=[]);a.split(/\s/).forEach(function(t){if("ready"==t)return e(document).ready(s);var a=r(t);a.fn=s,a.sel=f,a.e in b&&(s=function(t){var n=t.relatedTarget;return!n||n!==this&&!e.contains(this,n)?a.fn.apply(this,arguments):void 0}),a.del=d;var p=d||s;a.proxy=function(e){if(!(e=u(e)).isImmediatePropagationStopped()){e.data=l;var t=p.apply(n,e._args==c?[e]:[e].concat(e._args));return!1===t&&(e.preventDefault(),e.stopPropagation()),t}},a.i=g.length,g.push(a),"addEventListener"in n&&n.addEventListener(o(a.e),a.proxy,i(a,h))})}function s(e,r,a,s,u){var l=t(e);(r||"").split(/\s/).forEach(function(t){n(e,t,a,s).forEach(function(t){delete y[l][t.i],"removeEventListener"in e&&e.removeEventListener(o(t.e),t.proxy,i(t,u))})})}function u(t,n){return(n||!t.isDefaultPrevented)&&(n||(n=t),e.each(A,function(e,r){var i=n[e];t[e]=function(){return this[r]=_,i&&i.apply(n,arguments)},t[r]=E}),(n.defaultPrevented!==c?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=_)),t}function l(e){var t,n={originalEvent:e};for(t in e)k.test(t)||e[t]===c||(n[t]=e[t]);return u(n,e)}var c,f=1,d=Array.prototype.slice,h=e.isFunction,p=function(e){return"string"==typeof e},y={},g={},v="onfocusin"in window,m={focus:"focusin",blur:"focusout"},b={mouseenter:"mouseover",mouseleave:"mouseout"};g.click=g.mousedown=g.mouseup=g.mousemove="MouseEvents",e.event={add:a,remove:s},e.proxy=function(n,r){var i=2 in arguments&&d.call(arguments,2);if(h(n)){var o=function(){return n.apply(r,i?i.concat(d.call(arguments)):arguments)};return o._zid=t(n),o}if(p(r))return i?(i.unshift(n[r],n),e.proxy.apply(null,i)):e.proxy(n[r],n);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var _=function(){return!0},E=function(){return!1},k=/^([A-Z]|returnValue$|layer[XY]$)/,A={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r,i,o){var u,f,y=this;return t&&!p(t)?(e.each(t,function(e,t){y.on(e,n,r,t,o)}),y):(p(n)||h(i)||!1===i||(i=r,r=n,n=c),(i===c||!1===r)&&(i=r,r=c),!1===i&&(i=E),y.each(function(c,h){o&&(u=function(e){return s(h,e.type,i),i.apply(this,arguments)}),n&&(f=function(t){var r,o=e(t.target).closest(n,h).get(0);return o&&o!==h?(r=e.extend(l(t),{currentTarget:o,liveFired:h}),(u||i).apply(o,[r].concat(d.call(arguments,1)))):void 0}),a(h,t,i,r,n,f||u)}))},e.fn.off=function(t,n,r){var i=this;return t&&!p(t)?(e.each(t,function(e,t){i.off(e,n,t)}),i):(p(n)||h(r)||!1===r||(r=n,n=c),!1===r&&(r=E),i.each(function(){s(this,t,r,n)}))},e.fn.trigger=function(t,n){return(t=p(t)||e.isPlainObject(t)?e.Event(t):u(t))._args=n,this.each(function(){t.type in m&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,r){var i,o;return this.each(function(a,s){(i=l(p(t)?e.Event(t):t))._args=r,i.target=s,e.each(n(s,t.type||t),function(e,t){return o=t.proxy(i),!i.isImmediatePropagationStopped()&&void 0})}),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(e,t){p(e)||(e=(t=e).type);var n=document.createEvent(g[e]||"Events"),r=!0;if(t)for(var i in t)"bubbles"==i?r=!!t[i]:n[i]=t[i];return n.initEvent(e,r,!0),u(n)}}(i),function(e){function t(t,n,r){var i=e.Event(n);return e(t).trigger(i,r),!i.isDefaultPrevented()}function n(e,n,r,i){return e.global?t(n||g,r,i):void 0}function r(t){t.global&&0==e.active++&&n(t,null,"ajaxStart")}function i(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function o(e,t){var r=t.context;return!1!==t.beforeSend.call(r,e,t)&&!1!==n(t,r,"ajaxBeforeSend",[e,t])&&void n(t,r,"ajaxSend",[e,t])}function a(e,t,r,i){var o=r.context,a="success";r.success.call(o,e,a,t),i&&i.resolveWith(o,[e,a,t]),n(r,o,"ajaxSuccess",[t,r,e]),u(a,t,r)}function s(e,t,r,i,o){var a=i.context;i.error.call(a,r,t,e),o&&o.rejectWith(a,[r,t,e]),n(i,a,"ajaxError",[r,i,e||t]),u(t,r,i)}function u(e,t,r){var o=r.context;r.complete.call(o,t,e),n(r,o,"ajaxComplete",[t,r]),i(r)}function l(){}function c(e){return e&&(e=e.split(";",2)[0]),e&&(e==E?"html":e==_?"json":m.test(e)?"script":b.test(e)&&"xml")||"text"}function f(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function d(t,n,r,i){return e.isFunction(n)&&(i=r,r=n,n=void 0),e.isFunction(r)||(i=r,r=void 0),{url:t,data:n,success:r,dataType:i}}var h,p,y=0,g=window.document,v=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,m=/^(?:text|application)\/javascript/i,b=/^(?:text|application)\/xml/i,_="application/json",E="text/html",k=/^\s*$/,A=g.createElement("a");A.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var r,i,u=t.jsonpCallback,l=(e.isFunction(u)?u():u)||"jsonp"+ ++y,c=g.createElement("script"),f=window[l],d=function(t){e(c).triggerHandler("error",t||"abort")},h={abort:d};return n&&n.promise(h),e(c).on("load error",function(o,u){clearTimeout(i),e(c).off().remove(),"error"!=o.type&&r?a(r[0],h,t,n):s(null,u||"error",h,t,n),window[l]=f,r&&e.isFunction(f)&&f(r[0]),f=r=void 0}),!1===o(h,t)?(d("abort"),h):(window[l]=function(){r=arguments},c.src=t.url.replace(/\?(.+)=\?/,"?$1="+l),g.head.appendChild(c),t.timeout>0&&(i=setTimeout(function(){d("timeout")},t.timeout)),h)},e.ajaxSettings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:_,xml:"application/xml, text/xml",html:E,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(t){var n,i,u=e.extend({},t||{}),d=e.Deferred&&e.Deferred();for(h in e.ajaxSettings)void 0===u[h]&&(u[h]=e.ajaxSettings[h]);r(u),u.crossDomain||((n=g.createElement("a")).href=u.url,n.href=n.href,u.crossDomain=A.protocol+"//"+A.host!=n.protocol+"//"+n.host),u.url||(u.url=window.location.toString()),(i=u.url.indexOf("#"))>-1&&(u.url=u.url.slice(0,i)),function(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=f(t.url,t.data),t.data=void 0)}(u);var y=u.dataType,v=/\?.+=\?/.test(u.url);if(v&&(y="jsonp"),!1!==u.cache&&(t&&!0===t.cache||"script"!=y&&"jsonp"!=y)||(u.url=f(u.url,"_="+Date.now())),"jsonp"==y)return v||(u.url=f(u.url,u.jsonp?u.jsonp+"=?":!1===u.jsonp?"":"callback=?")),e.ajaxJSONP(u,d);var m,b=u.accepts[y],_={},E=function(e,t){_[e.toLowerCase()]=[e,t]},w=/^([\w-]+:)\/\//.test(u.url)?RegExp.$1:window.location.protocol,T=u.xhr(),S=T.setRequestHeader;if(d&&d.promise(T),u.crossDomain||E("X-Requested-With","XMLHttpRequest"),E("Accept",b||"*/*"),(b=u.mimeType||b)&&(b.indexOf(",")>-1&&(b=b.split(",",2)[0]),T.overrideMimeType&&T.overrideMimeType(b)),(u.contentType||!1!==u.contentType&&u.data&&"GET"!=u.type.toUpperCase())&&E("Content-Type",u.contentType||"application/x-www-form-urlencoded"),u.headers)for(p in u.headers)E(p,u.headers[p]);if(T.setRequestHeader=E,T.onreadystatechange=function(){if(4==T.readyState){T.onreadystatechange=l,clearTimeout(m);var t,n=!1;if(T.status>=200&&T.status<300||304==T.status||0==T.status&&"file:"==w){y=y||c(u.mimeType||T.getResponseHeader("content-type")),t=T.responseText;try{"script"==y?(0,eval)(t):"xml"==y?t=T.responseXML:"json"==y&&(t=k.test(t)?null:e.parseJSON(t))}catch(e){n=e}n?s(n,"parsererror",T,u,d):a(t,T,u,d)}else s(T.statusText||null,T.status?"error":"abort",T,u,d)}},!1===o(T,u))return T.abort(),s(null,"abort",T,u,d),T;if(u.xhrFields)for(p in u.xhrFields)T[p]=u.xhrFields[p];var P=!("async"in u)||u.async;for(p in T.open(u.type,u.url,P,u.username,u.password),_)S.apply(T,_[p]);return u.timeout>0&&(m=setTimeout(function(){T.onreadystatechange=l,T.abort(),s(null,"timeout",T,u,d)},u.timeout)),T.send(u.data?u.data:null),T},e.get=function(){return e.ajax(d.apply(null,arguments))},e.post=function(){var t=d.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=d.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,r){if(!this.length)return this;var i,o=this,a=t.split(/\s/),s=d(t,n,r),u=s.success;return a.length>1&&(s.url=a[0],i=a[1]),s.success=function(t){o.html(i?e("<div>").html(t.replace(v,"")).find(i):t),u&&u.apply(o,arguments)},e.ajax(s),this};var w=encodeURIComponent;e.param=function(t,n){var r=[];return r.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(w(t)+"="+w(n))},function t(n,r,i,o){var a,s=e.isArray(r),u=e.isPlainObject(r);e.each(r,function(r,l){a=e.type(l),o&&(r=i?o:o+"["+(u||"object"==a||"array"==a?r:"")+"]"),!o&&s?n.add(l.name,l.value):"array"==a||!i&&"object"==a?t(n,l,i,r):n.add(r,l)})}(r,t,n),r.join("&").replace(/%20/g,"+")}}(i),(r=i).Callbacks=function(e){e=r.extend({},e);var t,n,i,o,a,s,u=[],l=!e.once&&[],c=function r(c){for(t=e.memory&&c,n=!0,s=o||0,o=0,a=u.length,i=!0;u&&a>s;++s)if(!1===u[s].apply(c[0],c[1])&&e.stopOnFalse){t=!1;break}i=!1,u&&(l?l.length&&r(l.shift()):t?u.length=0:f.disable())},f={add:function(){if(u){var n=u.length;(function t(n){r.each(n,function(n,r){"function"==typeof r?e.unique&&f.has(r)||u.push(r):r&&r.length&&"string"!=typeof r&&t(r)})})(arguments),i?a=u.length:t&&(o=n,c(t))}return this},remove:function(){return u&&r.each(arguments,function(e,t){for(var n;(n=r.inArray(t,u,n))>-1;)u.splice(n,1),i&&(a>=n&&--a,s>=n&&--s)}),this},has:function(e){return!(!u||!(e?r.inArray(e,u)>-1:u.length))},empty:function(){return a=u.length=0,this},disable:function(){return u=l=t=void 0,this},disabled:function(){return!u},lock:function(){return l=void 0,t||f.disable(),this},locked:function(){return!l},fireWith:function(e,t){return!u||n&&!l||(t=[e,(t=t||[]).slice?t.slice():t],i?l.push(t):c(t)),this},fire:function(){return f.fireWith(this,arguments)},fired:function(){return!!n}};return f},function(e){function t(n){var r=[["resolve","done",e.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",e.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",e.Callbacks({memory:1})]],i="pending",o={state:function(){return i},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var n=arguments;return t(function(t){e.each(r,function(r,i){var s=e.isFunction(n[r])&&n[r];a[i[1]](function(){var n=s&&s.apply(this,arguments);if(n&&e.isFunction(n.promise))n.promise().done(t.resolve).fail(t.reject).progress(t.notify);else{var r=this===o?t.promise():this,a=s?[n]:arguments;t[i[0]+"With"](r,a)}})}),n=null}).promise()},promise:function(t){return null!=t?e.extend(t,o):o}},a={};return e.each(r,function(e,t){var n=t[2],s=t[3];o[t[1]]=n.add,s&&n.add(function(){i=s},r[1^e][2].disable,r[2][2].lock),a[t[0]]=function(){return a[t[0]+"With"](this===a?o:this,arguments),this},a[t[0]+"With"]=n.fireWith}),o.promise(a),n&&n.call(a,a),a}var n=Array.prototype.slice;e.when=function(r){var i,o,a,s=n.call(arguments),u=s.length,l=0,c=1!==u||r&&e.isFunction(r.promise)?u:0,f=1===c?r:t(),d=function(e,t,r){return function(o){t[e]=this,r[e]=arguments.length>1?n.call(arguments):o,r===i?f.notifyWith(t,r):--c||f.resolveWith(t,r)}};if(u>1)for(i=new Array(u),o=new Array(u),a=new Array(u);u>l;++l)s[l]&&e.isFunction(s[l].promise)?s[l].promise().done(d(l,a,s)).fail(f.reject).progress(d(l,o,i)):--c;return c||f.resolveWith(a,s),f.promise()},e.Deferred=t}(i),function(e){function t(){l=null,f.last&&(f.el.trigger("longTap"),f={})}function n(){l&&clearTimeout(l),l=null}function r(){a&&clearTimeout(a),s&&clearTimeout(s),u&&clearTimeout(u),l&&clearTimeout(l),a=s=u=l=null,f={}}function i(e){return("touch"==e.pointerType||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary}function o(e,t){return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t}var a,s,u,l,c,f={};e(document).ready(function(){var d,h,p,y,g=0,v=0;"MSGesture"in window&&((c=new MSGesture).target=document.body),e(document).bind("MSGestureEnd",function(e){var t=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;t&&(f&&f.el&&f.el.trigger("swipe"),f&&f.el&&f.el.trigger("swipe"+t))}).on("touchstart MSPointerDown pointerdown",function(n){(!(y=o(n,"down"))||i(n))&&(p=y?n:n.touches[0],n.touches&&1===n.touches.length&&f.x2&&(f.x2=void 0,f.y2=void 0),d=Date.now(),h=d-(f.last||d),f.el=e("tagName"in p.target?p.target:p.target.parentNode),a&&clearTimeout(a),f.x1=p.pageX,f.y1=p.pageY,h>0&&250>=h&&(f.isDoubleTap=!0),f.last=d,l=setTimeout(t,750),c&&y&&c.addPointer(n.pointerId))}).on("touchmove MSPointerMove pointermove",function(e){(!(y=o(e,"move"))||i(e))&&(p=y?e:e.touches[0],n(),f.x2=p.pageX,f.y2=p.pageY,g+=Math.abs(f.x1-f.x2),v+=Math.abs(f.y1-f.y2))}).on("touchend MSPointerUp pointerup",function(t){(!(y=o(t,"up"))||i(t))&&(n(),f.x2&&Math.abs(f.x1-f.x2)>30||f.y2&&Math.abs(f.y1-f.y2)>30?u=setTimeout(function(){f&&f.el&&f.el.trigger("swipe"),f&&f.el&&f.el.trigger("swipe"+function(e,t,n,r){return Math.abs(e-t)>=Math.abs(n-r)?e-t>0?"Left":"Right":n-r>0?"Up":"Down"}(f.x1,f.x2,f.y1,f.y2)),f={}},0):"last"in f&&(30>g&&30>v?s=setTimeout(function(){var t=e.Event("tap");t.cancelTouch=r,f.el&&f.el.trigger(t),f.isDoubleTap?(f.el&&f.el.trigger("doubleTap"),f={}):a=setTimeout(function(){a=null,f.el&&f.el.trigger("singleTap"),f={}},250)},0):f={}),g=v=0)}).on("touchcancel MSPointerCancel pointercancel",r),e(window).on("scroll",r)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.on(t,e)}})}(i),function(e){function t(t){return!(!(t=e(t)).width()&&!t.height())&&"none"!==t.css("display")}function n(e,t){e=e.replace(/=#\]/g,'="#"]');var n,r,i=s.exec(e);if(i&&i[2]in a&&(n=a[i[2]],r=i[3],e=i[1],r)){var o=Number(r);r=isNaN(o)?r.replace(/^["']|["']$/g,""):o}return t(e,n,r)}var r=e.zepto,i=r.qsa,o=r.matches,a=e.expr[":"]={visible:function(){return t(this)?this:void 0},hidden:function(){return t(this)?void 0:this},selected:function(){return this.selected?this:void 0},checked:function(){return this.checked?this:void 0},parent:function(){return this.parentNode},first:function(e){return 0===e?this:void 0},last:function(e,t){return e===t.length-1?this:void 0},eq:function(e,t,n){return e===n?this:void 0},contains:function(t,n,r){return e(this).text().indexOf(r)>-1?this:void 0},has:function(e,t,n){return r.qsa(this,n).length?this:void 0}},s=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),u=/^\s*>/,l="Zepto"+ +new Date;r.qsa=function(t,o){return n(o,function(n,a,s){try{var c;!n&&a?n="*":u.test(n)&&(c=e(t).addClass(l),n="."+l+" "+n);var f=i(t,n)}catch(e){throw console.error("error performing selector: %o",o),e}finally{c&&c.removeClass(l)}return a?r.uniq(e.map(f,function(e,t){return a.call(e,t,f,s)})):f})},r.matches=function(e,t){return n(t,function(t,n,r){return!(t&&!o(e,t)||n&&n.call(e,null,r)!==e)})}}(i),function(){try{getComputedStyle(void 0)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t){try{return e(t)}catch(e){return null}}}}(),e.exports=i},function(e,t,n){"use strict";var r=n(6);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&h(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function f(e,t,n){r(function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)})}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}var a=p(function(){t(i,r)});"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=l,l.prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(i);this.state!==u?f(n,this.state===s?e:t,this.outcome):this.queue.push(new c(n,e,t));return n},c.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){o.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)h(e,r);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){if(e instanceof this)return e;return o.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var a=new Array(n),s=0,u=-1,l=new this(i);for(;++u<n;)c(e[u],u);return l;function c(e,i){t.resolve(e).then(function(e){a[i]=e,++s!==n||r||(r=!0,o.resolve(l,a))},function(e){r||(r=!0,o.reject(l,e))})}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var a=-1,s=new this(i);for(;++a<n;)u=e[a],t.resolve(u).then(function(e){r||(r=!0,o.resolve(s,e))},function(e){r||(r=!0,o.reject(s,e))});var u;return s}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),o=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(o).concat([i]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var r={},i=function(e){var t;return function(){return void 0===t&&(t=function(){return window&&document&&document.all&&!window.atob}.apply(this,arguments)),t}}(),o=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),a=null,s=0,u=[],l=n(58);function c(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=r[i.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](i.parts[a]);for(;a<i.parts.length;a++)o.parts.push(g(i.parts[a],t))}else{var s=[];for(a=0;a<i.parts.length;a++)s.push(g(i.parts[a],t));r[i.id]={id:i.id,refs:1,parts:s}}}}function f(e,t){for(var n=[],r={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function d(e,t){var n=o(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=u[u.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=o(e.insertAt.before,n);n.insertBefore(t,i)}}function h(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function p(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=n.nc;r&&(e.attrs.nonce=r)}return y(t,e.attrs),d(e,t),t}function y(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function g(e,t){var n,r,i,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var u=s++;n=a||(a=p(t)),r=m.bind(null,n,u,!1),i=m.bind(null,n,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",y(t,e.attrs),d(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(r=l(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){h(n),n.href&&URL.revokeObjectURL(n.href)}):(n=p(t),r=function(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){h(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=i()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=f(e,t);return c(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var a=n[o];(s=r[a.id]).refs--,i.push(s)}for(e&&c(f(e,t),t),o=0;o<i.length;o++){var s;if(0===(s=i[o]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete r[s.id]}}}};var v=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}();function m(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=v(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{}}return r(e,[{key:"name",get:function(){return this.constructor.name}},{key:"tagName",get:function(){return this.options.tagName||"div"}},{key:"attributes",get:function(){return{class:this.options.className}}}]),r(e,[{key:"attr",value:function(e,t){if(void 0===t)return this.element.getAttribute(e);this.element.setAttribute(e,t)}},{key:"show",value:function(){this.removeClass("ad_runner_ui_hide")}},{key:"hide",value:function(){this.addClass("ad_runner_ui_hide")}},{key:"on",value:function(e,t){this.element.addEventListener(e,t)}},{key:"off",value:function(e,t){this.element.removeEventListener(e,t)}},{key:"html",value:function(e){this.element.innerHTML=e}},{key:"style",value:function(e,t){this.element.style[e]=t}},{key:"appendChild",value:function(e){this.element.appendChild(e.element||e)}},{key:"hasClass",value:function(e){return this.element.classList?this.element.classList.contains(e):new RegExp("(^|\\s)"+e+"($|\\s)").test(this.element.className)}},{key:"addClass",value:function(e){this.element.classList?this.element.classList.add(e):this.hasClass(this.element,e)||(this.element.className=(this.element.className+" "+e).trim())}},{key:"removeClass",value:function(e){this.element.classList?this.element.classList.remove(e):this.element.className=this.element.className.split(/\s+/).filter(function(t){return t!==e}).join(" ")}},{key:"render",value:function(){var e=this;this.element=this.options.element||document.createElement(this.tagName),Object.keys(this.attributes).forEach(function(t){var n=e.attributes[t];void 0!==n&&e.element.setAttribute(t,n)})}},{key:"remove",value:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null}}]),e}()},function(e,t,n){var r=n(5).DEFAULT_MAX_VOLUME;function i(e,t){return String(e).toUpperCase().indexOf(String(t).toUpperCase())>-1}function o(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}e.exports={contentVolumeToAdVolume:function(e){return e?e/100*r:0},convertToSecond:function(e){var t=isNaN(e)?e.split(":"):e;return 60*+t[0]*60+60*+t[1]+ +t[2]},isImaAd:function(e){return!i(e.system.name,"celtra")&&(i(e.system.name,"google")||i(e.system.version,"google"))},isFacebookAd:function(e){return i(e.system.name,"facebook")||i(e.system.version,"facebook")},isAsiaSmartAd:function(e){return e.vastAdTagURI&&i(e.vastAdTagURI,"adnetwork.adasiaholdings.com")||i(e.system.name,"smart")||i(e.system.name,"wootag")},formatTime:function(e,t){if(!isFinite(e))return"--:--";e*=1e3;var n=(e=parseInt(e/1e3))%60,r=(e=parseInt(e/60))%60,i=(e=parseInt(e/60))%24,o=parseInt(e/24),a="";return o&&o>0&&(a+=o+":",i<1&&(a+="00:")),(i&&i>0||t)&&(a+=("0"+i).slice(-2)+":"),a+=("0"+r).slice(-2)+":",(a+=("0"+n).slice(-2)).trim()},createPromiseDefer:o,createTimeoutPromise:function(e){var t=o(),n=setTimeout(t.resolve,e);return t.promise.cancel=function(){return clearTimeout(n)},t.promise},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|IEMobile|Opera Mini/i.test(navigator.userAgent)}}},function(e,t,n){"use strict";var r=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdViewableImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoProgress","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError","AdClickBackground","AdClickThruVpaid"];r.forEach(function(e){r[e]=e}),Object.freeze(r),e.exports=r},function(e,t){e.exports={AD_POSITION:{preroll:"pre-roll",midroll:"mid-roll",postroll:"post-roll"},AD_DONE_REASON:{timeout:"timeout",error:"error",ended:"ended",skipped:"skipped"},COUNT_DOWN_DURATION:5,PRELOAD_DURATION:7,DEFAULT_MIDROLL_START_TIME:10,DEFAULT_SKIP_TIMEOUT:3,DEFAULT_AD_START_TIMEOUT:10,DEFAULT_NON_LINEAR_DURATION:15,DEFAULT_MAX_VOLUME:.75}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"===n(e)&&null!==e}function a(e){return void 0===e}r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),r=(l=n.slice()).length,u=0;u<r;u++)l[u].apply(this,s);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(n=this._events[e]).length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.exports=r},function(e,t,n){e.exports={VastPlayer:n(21),VAST:n(12),EventEmitter:n(6)}},function(e,t,n){"use strict";var r=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"];r.forEach(function(e){this[e.toUpperCase()]=e},r),Object.freeze(r),e.exports=r},function(e,t,n){"use strict";var r=n(15),i=document.createElement("video");n(14),t.isDesktop=!/Android|Silk|Mobile|PlayBook/.test(r.navigator.userAgent),t.canPlay=function(e){switch(i.canPlayType(e)){case"probably":return 2;case"maybe":return 1;default:return 0}},Object.freeze(t)},function(e,t,n){"use strict";function r(e,t,n){t.on(e,function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];n.emit.apply(n,[e].concat(t))})}function i(e,t,n){n.forEach(function(n){t.listeners(n).length>0&&r(n,e,t)}),t.on("newListener",function(i){n.indexOf(i)>-1&&t.listeners(i).length<1&&r(i,e,t)})}function o(e){this.events=e.slice(),this.__private__={target:null,source:null}}o.prototype.from=function(e){return this.__private__.source=e,this.__private__.target&&i(e,this.__private__.target,this.events),this},o.prototype.to=function(e){return this.__private__.target=e,this.__private__.source&&i(this.__private__.source,e,this.events),this},e.exports=o},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}e.exports=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adContainerElement=t,this.videoContent=n,this.logger=r.logger,this.onAdStarted=r.onAdStarted,this.onAdStopped=r.onAdStopped,this.onAdLoaded=r.onAdLoaded,this.options=i,this.logger.debug(this.name,"initializing")}return r(e,[{key:"selfControl",get:function(){return!1}},{key:"canClickThrough",get:function(){return!1}},{key:"viewDetailLink",get:function(){return""}}]),r(e,[{key:"loadAd",value:function(e){throw new Error("this must be overridden")}},{key:"initUserAction",value:function(){throw new Error("this must be overridden")}},{key:"canRun",value:function(e){throw new Error("this must be overridden")}},{key:"start",value:function(){throw new Error("this must be overridden")}},{key:"stop",value:function(){throw new Error("this must be overridden")}},{key:"pause",value:function(){throw new Error("this must be overridden")}},{key:"resume",value:function(){throw new Error("this must be overridden")}},{key:"cancel",value:function(){throw new Error("this must be overridden")}},{key:"viewDetail",value:function(){throw new Error("this must be overridden")}},{key:"setVolume",value:function(e){throw new Error("this must be overridden")}},{key:"setAdData",value:function(e){this.adData=e}},{key:"getVolume",value:function(){throw new Error("this must be overridden")}},{key:"isPaused",value:function(){throw new Error("this must be overridden")}},{key:"getRemainingTime",value:function(){throw new Error("this must be overridden")}},{key:"getDuration",value:function(){throw new Error("this must be overridden")}},{key:"getSkipOffset",value:function(){throw new Error("this must be overridden")}},{key:"resize",value:function(e,t,n){}},{key:"destroy",value:function(){throw new Error("this must be overridden")}}]),e}()},function(e,t,n){e.exports=n(22)},function(e,t,n){"use strict";e.exports=function(){return Array.prototype.slice.call(arguments).reduce(function(e,t){return Object.keys(t||{}).reduce(function(e,n){return e[n]=t[n],e},e)},{})}},function(e,t){var n={JAVASCRIPT:"application/javascript",FLASH:"application/x-shockwave-flash"};Object.freeze(n),e.exports=n},function(e,t){e.exports=window},function(e,t,n){"use strict";var r=n(39),i=n(8);function o(e,t){var n=this;r.call(this,Math.floor(e.duration||0),t),this.video=e,[i.PLAYING,i.PAUSE,i.TIMEUPDATE].forEach(function(t){return e.addEventListener(t,function(){return n.tick()},!1)})}o.prototype=Object.create(r.prototype),o.prototype._getState=function(){return{playing:!this.video.paused,currentTime:this.video.currentTime}},e.exports=o},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=n(46),a=n(52),s=n(53),u=(n(3).createPromiseDefer,[o,a,s]),l=function(){},c=function(){function e(t){var n=this,r=t.linearAdContainer,i=t.nonLinearAdContainer,o=t.contentPlayer,a=t.logger,c=t.onAdStarted,f=t.onAdStopped,d=t.onAdSkipped,h=t.onAdLoaded,p=t.onResetState,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logger=a,this.props={onAdStarted:c,onAdStopped:f,onAdSkipped:d,onAdLoaded:h||l,onResetState:p||l},this.loadPromise=null,this.currentPlayer=null,this.adData=null,this.adStarted=!1,this.adCancelled=!1,this.adVolume=1,this.lastError=null,this.players=u.map(function(e){return new e(e===s?i:r,o,{logger:a,onAdStarted:n._onAdStarted.bind(n),onAdStopped:n._onAdStopped.bind(n),onAdSkipped:n._onAdSkipped.bind(n),onAdLoaded:n._onAdLoaded.bind(n)},y)})}return i(e,[{key:"name",get:function(){return"Player"}}]),i(e,[{key:"initUserAction",value:function(){this.players.forEach(function(e){return e.initUserAction()})}},{key:"load",value:function(e){return this.adData=e,this.adCancelled=!1,this.adStarted=!1,this.lastError=null,this.loadPromise=this._loadAd(),this.loadPromise}},{key:"start",value:function(){this._playAd()}},{key:"stop",value:function(){this.currentPlayer.stop()}},{key:"skip",value:function(){this.currentPlayer.skip()}},{key:"cancel",value:function(){this.adCancelled=!0,this.currentPlayer&&this.currentPlayer.cancel()}},{key:"pause",value:function(){this.currentPlayer.pause()}},{key:"resume",value:function(){this.currentPlayer.resume()}},{key:"destroy",value:function(){this.players.forEach(function(e){return e.destroy()})}},{key:"resize",value:function(e,t,n){this.players.forEach(function(r){return r.resize(e,t,n)})}},{key:"setVolume",value:function(e){this.adVolume=e,this.currentPlayer&&this.currentPlayer.setVolume(e)}},{key:"getCurrentPlayer",value:function(){return this.currentPlayer}},{key:"isPlayingLinearAd",value:function(){return this.currentPlayer instanceof o?this.currentPlayer.currentAd&&this.currentPlayer.currentAd.isLinear():!(this.currentPlayer instanceof s)}},{key:"isGoogleNonLinearAd",value:function(){return this.currentPlayer instanceof o&&this.currentPlayer.currentAd&&!this.currentPlayer.currentAd.isLinear()}},{key:"_onAdStarted",value:function(){this.adStarted=!0,this.props.onAdStarted()}},{key:"_onAdStopped",value:function(e,t,n,r){var i=r||this.adData;this.adStarted||n?this.props.onAdStopped(e,t,i):(this.lastError=e,this._playAd(this.adIndex+1))}},{key:"_onAdSkipped",value:function(){this.props.onAdSkipped()}},{key:"_onAdLoaded",value:function(){this.props.onAdLoaded()}},{key:"_loadAd",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.logger.debug(this.name,"_loadAd | adIndex",t," | adData",this.adData.ads),this.adCancelled)return Promise.resolve();var n=this.adData.ads[t];if(this.currentPlayer=null,!n)return t>0&&this.logger.debug(this.name,"no ad left to load"),Promise.resolve();this.logger.debug(this.name,"loading ad item ".concat(t+1,"/").concat(this.adData.ads.length),n);var r=this._getPlayerForAd(n);return r?r.loadAd(n,this.adData).then(function(){return e.logger.debug(e.name,"ad loaded"),{player:r,adIndex:t}}).catch(function(n){return e.logger.error(e.name,"error while loading ad, falling back to next item:",n),e._loadAd(t+1)}):(this.logger.debug(this.name,"no player to play this ad, trying next item",n),this._loadAd(t+1))}},{key:"_playAd",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.adCancelled||(this.loadPromise?(e=this.loadPromise,delete this.loadPromise):e=this._loadAd(n),e.then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.player,r=e.adIndex;t.adCancelled||(n?(t.adIndex=r,t.currentPlayer=n,n.setAdData(t.adData),n.setVolume(t.adVolume),n.start()):t._onAdStopped(t.lastError||new Error("Cannot run ad"),null,!0))}))}},{key:"_getPlayerForAd",value:function(e){return this.players.filter(function(t){return t.canRun(e)})[0]}}]),e}();e.exports=c},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=n(2),l=n(3).formatTime;n(62),e.exports=function(e){function t(e){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,i(t).call(this,e))).render(),"string"!=typeof n.options.template)throw new Error("options.template is required");return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,u),a(t,[{key:"attributes",get:function(){return{class:this.options.className||"ad_runner_ui_countdown"}}}]),a(t,[{key:"update",value:function(e){this._setRemainingTime(e)}},{key:"_setRemainingTime",value:function(e){var t;t=this.options.formatTime?l(e):Math.round(e),this.element.textContent=this.options.template.replace("%s",t)}}]),t}()},function(e,t,n){e.exports={Runner:n(20),Player:n(17),VAST:n(7).VAST}},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=n(7).VAST,a=n(17),s=n(60),u=n(61),l=n(87),c=n(3),f=c.contentVolumeToAdVolume,d=c.convertToSecond,h=c.createPromiseDefer,p=c.createTimeoutPromise,y=n(5),g=y.AD_POSITION,v=y.AD_DONE_REASON,m=y.DEFAULT_AD_START_TIMEOUT,b=y.DEFAULT_MIDROLL_START_TIME,_={free:1,loading:2,starting:3,playing:4},E={startTimeout:m,skipTimeout:y.DEFAULT_SKIP_TIMEOUT,countdownPlay:!0,defaultMidrollStartTime:b,getPoster:function(){},showSlideBlack:!1,removeAdmarkOnError:!0,autoPlayAdBreaks:!0,autoPlay:!1,mute:!1},k=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.plugin=t,this.options=this._normalizeOption(n);var r=t.getAdContainers(),i=t.getContentPlayer();this.player=new a({linearAdContainer:r.linear,nonLinearAdContainer:r.nonLinear,contentPlayer:i,logger:this.logger,onAdStarted:this._onAdStarted.bind(this),onAdStopped:this._onAdStopped.bind(this),onAdSkipped:this._onAdSkipped.bind(this),onAdLoaded:this._onAdLoaded.bind(this),onResetState:this._onResetState.bind(this)},this.options),this.scheduler=new s({logger:this.logger,prepareAd:this._prepareAd.bind(this),beforePlayAd:this._beforePlayAd.bind(this),preloadAd:this._preloadAd.bind(this),loadAd:this._loadAd.bind(this),playAd:this._playAd.bind(this)}),this.adUi=new u(this.options,r),this.adMark=new l(r.adMark),this.state=_.free,this.adsLoaded=!1,this.adDeferred=null}return i(e,[{key:"name",get:function(){return"Runner"}},{key:"logger",get:function(){return this.plugin.getLogger()}},{key:"viewDetailLink",get:function(){var e=this.player.getCurrentPlayer();return e&&e.viewDetailLink}}]),i(e,[{key:"onContentProgress",value:function(e){this.scheduler.onContentProgress(e)}},{key:"onContentEnded",value:function(){this.scheduler.onContentEnded(),this.adMark.removeMarkItems()}},{key:"onUserAction",value:function(){this.player.initUserAction()}},{key:"onAdsDataLoaded",value:function(e){var t=this;this.logger.debug(this.name,"onAdsDataLoaded",e),this._normalizeAdsData(e),this.scheduler.populateAdsData(e),this.plugin.getContentMetadata().then(function(e){t.scheduler&&t.scheduler.dataLoadingDeferred.promise.then(function(){t.adMark.render(e.duration,t.scheduler.midrollAds)})})}},{key:"destroy",value:function(){this.player.destroy(),this.player=null,this.scheduler=null,this.adUi.remove(),this.adMark.remove()}},{key:"resize",value:function(e,t,n){this.player.resize(e,t,n)}},{key:"pauseAd",value:function(){this.player.pause()}},{key:"resumeAd",value:function(){this.player.resume()}},{key:"stopAd",value:function(){this.player.stop()}},{key:"showPosterAndPlayIcon",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.adUi.skipButton,n=t.poster,r=t.playIcon;e?(t.loadPoster(),n.show(),r.show()):(n.hide(),r.hide())}},{key:"_onResetState",value:function(){this.state=_.free,this.adsLoaded=!1}},{key:"_preloadAd",value:function(e){this.adsLoaded||this._loadAd(e)}},{key:"_prepareAd",value:function(e,t){this.options.countdownPlay&&this.adsLoaded&&(this.adUi.countdownToPlay.show(),this.adUi.countdownToPlay.update(t))}},{key:"_beforePlayAd",value:function(e,t){var n=this;this.adUi.countdownToPlay.hide(),e||!this.adsLoaded?setTimeout(function(){n.adsLoaded&&(n.options.showSlideBlack?(n.plugin.pauseForAd(),n.logger.debug(n.name,"Showing black screen"),n.adUi.slideBlack.show(),n.adUi.slideBlack.fadeIn(),setTimeout(function(){t()},2e3)):t())},1e3):t()}},{key:"_loadAd",value:function(e){this.state===_.free&&(this.adsLoaded=!1,this.state=_.loading,this.adDeferred=h(),this.logger.debug(this.name,"loading ad",e),this.player.load(e))}},{key:"_playAd",value:function(e,t){var n=this;return this._loadAd(e),this.logger.debug(this.name,"play ad",e),this.state=_.starting,this.adMetadata=t,this.adUi.onAdWillStart(),this.plugin.onAdWillStart&&this.plugin.onAdWillStart(),this.adTimeoutPromise=p(1e3*this.options.startTimeout),this.adTimeoutPromise.then(function(){n.logger.debug(n.name,"cannot start ad within ".concat(n.options.startTimeout,"s, cancelling...")),n.player&&n.player.cancel(),n._onAdStopped(null,v.timeout,e)}),this.player.setVolume(f(this.plugin.getContentVolume())),this.player.start(),this.adDeferred.promise}},{key:"_onAdStarted",value:function(){var e=this;this._mayPauseContent();var t=this.player.getCurrentPlayer();this.state=_.playing,this.adTimeoutPromise.cancel(),this.adUi.slideBlack.fadeOut(),setTimeout(function(){e.adUi.slideBlack.hide()},400),this.adUi.setPlayer(t),this.adUi.onAdStarted(this.adMetadata),this.plugin.onAdStarted&&this.plugin.onAdStarted(),this.logger.debug(this.name,"ad started by player:",t.name),this.player.isPlayingLinearAd()||(this.state=_.free,this.adDeferred.resolve(),this._mayResumeContent())}},{key:"_onAdStopped",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.ended,r=arguments.length>2?arguments[2]:void 0;switch(e&&(n=v.error),this.player.isGoogleNonLinearAd()&&this.plugin.hideLinearAdContainer&&this.plugin.hideLinearAdContainer(),(!e||e&&this.options.removeAdmarkOnError)&&r._completeAd&&r._completeAd(),this.state){case _.loading:break;case _.starting:case _.playing:}t.adTimeoutPromise.cancel(),t.adUi.onAdStopped(),t.plugin.onAdStopped&&t.plugin.onAdStopped(n),t._mayResumeContent(),t.logger.debug(t.name,"ad stopped:",n,e||""),t.adUi.slideBlack.hide(),this.state=_.free,this.adsLoaded=!1,this.adDeferred.resolve()}},{key:"_onAdSkipped",value:function(){this.plugin.onAdSkipped&&this.plugin.onAdSkipped()}},{key:"_onAdLoaded",value:function(){this.adsLoaded=!0}},{key:"_mayPauseContent",value:function(){this.player.isPlayingLinearAd()?this.plugin.pauseForAd():this.player.isGoogleNonLinearAd()&&(this.plugin.showLinearAdContainer&&this.plugin.showLinearAdContainer(),this.adUi.onAdStopped())}},{key:"_mayResumeContent",value:function(){this.adMetadata.order===this.adMetadata.total&&this.plugin.resumeAfterAd()}},{key:"_normalizeAdsData",value:function(e){var t=this;e.forEach(function(e){e.ads=o.pojoFromXML(e.server.tag).ads,delete e.server,Object.assign(e,t._buildAdOption(e))})}},{key:"_buildAdOption",value:function(e){var t={position:e.position,skipoffset:e.skipoffset?d(e.skipoffset):-1,startTime:e.startTime?d(e.startTime):0};return t.position!==g.midroll||t.startTime||(this.logger.warn(this.name,"no startTime specified on mid-roll ad, will use default startTime:",this.options.defaultMidrollStartTime),t.startTime=this.options.defaultMidrollStartTime),t}},{key:"_normalizeOption",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},E,e,{getPoster:this.plugin.getPoster&&this.plugin.getPoster.bind(this.plugin)})}}]),e}();e.exports=k},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(6),o=n(12),a=n(36),s=n(40),u=n(4),l=n(10),c=n(43),f=n(44),d=n(9),h=n(45);function p(e){return e}function y(){return new Error("VASTPlayer not ready.")}function g(e){return function(){var t=this,n=this.__private__.player;return this.ready?n[e]?n[e].apply(n,arguments).then(function(){return t}):Promise.resolve().then(function(){return t}):Promise.reject(y())}}function v(e){return{get:function(){if(!this.ready)throw y();return this.__private__.player[e]},set:function(t){if(!this.ready)throw y();return this.__private__.player[e]=t}}}function m(e,t){return String(e).toUpperCase().indexOf(String(t).toUpperCase())>-1}function b(e,t){var n=this;i.call(this),this.__private__={container:e,config:function e(){var t,n,i,o,a={},s=arguments.length;for(t=0;t<s;t++)for(i in n=arguments[t]||{})o=n[i],void 0===a[i]&&(a[i]=o),"object"===r(o)&&(a[i]=e(a[i],o));return a}(t,{vast:{resolveWrappers:!0,maxRedirects:5},tracking:{mapper:p},width:480,height:270}),vast:null,ready:!1,player:null,isVPAID:!1,vpaidVendor:null,video:f()};var o=this;this.on(u.AdClickThru,function(e,t,n){var r=e||o.viewDetailLink;n&&r&&(this.__private__.player.alreadyEmitViewable||(this.__private__.player.alreadyEmitViewable=!0,this.__private__.player.emit(u.AdViewableImpression)),window.open(r));var i=o.vast.get("ads[0].creatives[0].videoClicks.clickTrackings");i&&i.length>0&&i.map(function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.send(null)})}),this.on(u.AdClickBackground,function(){var e=o.__private__.player;e.video&&d.isDesktop&&(e.video.paused?n.resumeAd():n.pauseAd())})}n(15).console,b.prototype=Object.create(i.prototype),Object.defineProperties(b.prototype,{container:{get:function(){return this.__private__.container}},config:{get:function(){return this.__private__.config}},vast:{get:function(){return this.__private__.vast}},ready:{get:function(){return this.__private__.ready}},paused:{get:function(){return this.__private__.video.paused}},video:{set:function(e){return this.__private__.video=e}},isVPAID:{get:function(){return this.__private__.isVPAID}},isAsiaSmartAd:{get:function(){return(e=this.vast.ads[0]).vastAdTagURI&&m(e.vastAdTagURI,"adnetwork.adasiaholdings.com")||m(e.system.name,"smart")||m(e.system.name,"wootag");var e}},vpaidVendor:{get:function(){return this.__private__.vpaidVendor}},viewDetailLink:{get:function(){return this.vast&&this.vast.get("ads[0].creatives[0].videoClicks.clickThrough")}},adRemainingTime:v("adRemainingTime"),adDuration:v("adDuration"),adVolume:v("adVolume")}),b.prototype.load=function(e){var t=this,n=this.config.vast;return("string"==typeof e?o.fetch(e,n):new o(e).resolveWrappers()).then(function(e){var n=function(){var n=e.filter("ads[0].creatives[0].mediaFiles",a.canPlayMediaFile),r=e.filter("ads[0].creatives[0].mediaFiles",s.canPlayMediaFile);if(r.length>0)return t.__private__.isVPAID=!1,t.__private__.vpaidVendor=null,{player:new s(t.container,t.__private__.video,t.config),mediaFiles:r};if(n.length>0)return t.__private__.isVPAID=!0,t.__private__.vpaidVendor=h.getVpaidVendor(n),{player:new a(t.container,t.__private__.video,t.config,t),mediaFiles:n};throw new Error("There are no playable <MediaFile>s.")}(),r=n.player,i=n.mediaFiles,o={adParameters:e.get("ads[0].creatives[0].parameters"),progressEvents:e.get("ads[0].creatives[0].trackingEvents").filter(function(e){return"progress"==e.event})},f=[].concat(e.map("ads[0].impressions",function(e){return{event:"impression",uri:e.uri}}),e.map("ads[0].viewableImpressions",function(e){return{event:"viewableImpression",uri:e.uri}}),e.map("ads[0].errors",function(e){return{event:"error",uri:e}}),e.get("ads[0].creatives[0].trackingEvents"),e.map("ads[0].creatives[0].videoClicks.clickTrackings",function(e){return{event:"clickThrough",uri:e}})),d=new l(u),p=new c(f,t.config.tracking.mapper);if(d.from(r).to(t),t.__private__.vast=e,t.__private__.player=r,t.isAsiaSmartAd){var y=e.get("ads[0].creatives[0].duration");y&&(r.adDuration=y)}return r.load(i,o).then(function(){p.track(r)})}).then(function(){return t.__private__.ready=!0,t.emit("ready"),t}).catch(function(e){throw t.emit("error",e),e})},b.prototype.startAd=g("startAd"),b.prototype.stopAd=g("stopAd"),b.prototype.skipAd=g("skipAd"),b.prototype.pauseAd=g("pauseAd"),b.prototype.resumeAd=g("resumeAd"),b.prototype.init=function(){var e=this.__private__.video,t=this.__private__.container;return e.init(t)},b.vpaidSWFLocation="https://ajax.cdnjs.com/ajax/libs/videojs-vast-vpaid/2.0.2/VPAIDFlash.swf",e.exports=b},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(23),o=n(24),a=n(25),s=n(13),u=n(26),l=Array.prototype.push,c=n(27),f={inline:function(e){a({description:null,survey:null},e)},wrapper:function(){}},d={linear:function(e){a({trackingEvents:[],parameters:null,videoClicks:null},e),(e.mediaFiles||[]).forEach(function(e){a({id:null,bitrate:null,scalable:null,maintainAspectRatio:null,apiFramework:null},e)})},companions:function(e){e.companions.forEach(function(e){a({expandedWidth:null,expandedHeight:null,apiFramework:null,trackingEvents:[],clickThrough:null,altText:null,parameters:null},e)})},nonLinear:function(e){a({trackingEvents:[]},e),e.ads.forEach(function(e){a({id:null,expandedWidth:null,expandedHeight:null,scalable:null,maintainAspectRatio:null,minSuggestedDuration:null,apiFramework:null,clickThrough:null,parameters:null},e)})}},h=["ads.celtra.com"];function p(){}function y(e,t){var n=e.indexOf("redirectUrl=");if(n>-1&&h.some(function(t){return e.indexOf(t)>-1})){var r=e.slice(n+"redirectUrl=".length);return e=e.slice(0,n),i.get(e,t).catch(p).then(function(){return i.get(r,t)})}return i.get(e,t)}function g(e){o(e,this,!0),this.ads.forEach(function(e){a({system:{version:null},errors:[]},e),e.creatives.forEach(function(e){a({id:null,sequence:null,adID:null},e),d[e.type](e)}),f[e.type](e)}),this.__private__={wrappers:[],inlines:[]}}Object.defineProperties(g.prototype,{wrappers:{get:function(){var e=this.__private__.wrappers;return e.length=0,l.apply(e,this.filter("ads",function(e){return"wrapper"===e.type})),e}},inlines:{get:function(){var e=this.__private__.inlines;return e.length=0,l.apply(e,this.filter("ads",function(e){return"inline"===e.type})),e}}}),g.prototype.get=function(e){return((e||"").match(/[^\[\]\.]+/g)||[]).reduce(function(e,t){return e?e[t]:void 0},this)},g.prototype.set=function(e,t){var n=function(){for(var t,n=/[^\[\]\.]+/g,r=[];t=n.exec(e);)r.push({token:t[0],type:o(t,t.index+t[0].length)});return r}(),r=n.pop(),i=n.reduce(function(e,t){return e[t.token]||(e[t.token]=new t.type)},this);function o(e,t){switch(e.input.charAt(t)){case".":return Object;case"[":return Array;case"]":return o(e,t+1);default:return null}}if(!e)throw new Error("prop must be specified.");return i[r.token]=t},g.prototype.map=function(e,t){var n=this.get(e)||[],r=n.length,i=[];if(!(n instanceof Array))return i;for(var o=0;o<r;o++)i.push(t.call(this,n[o],o,n));return i},g.prototype.filter=function(e,t){var n=this.get(e)||[],r=n.length,i=[];if(!(n instanceof Array))return i;for(var o=0;o<r;o++)t.call(this,n[o],o,n)&&i.push(n[o]);return i},g.prototype.find=function(e,t){var n=this.get(e)||[],r=n.length;if(n instanceof Array)for(var i=0;i<r;i++)if(t.call(this,n[i],i,n))return n[i]},g.prototype.toPOJO=function(){var e=JSON.parse(JSON.stringify(this));return delete e.__private__,e},g.prototype.copy=function(){return new this.constructor(this.toPOJO())},g.prototype.resolveWrappers=function(){var e=isNaN(arguments[0])?1/0:arguments[0],t="function"==typeof arguments[0]?arguments[0]:arguments[1],n=this.constructor,r=this;return 0===e?Promise.reject(new Error("Too many redirects were made.")):u(Promise.all(this.map("wrappers",function(e){return Promise.resolve(y(e.vastAdTagURI,{withCredentials:!0})).then(function(t){return{wrapper:e,response:n.pojoFromXML(t.data).ads}})})).then(function(e){var t=e.map(function(e){return e.wrapper}),i=e.map(function(e){return e.response});return new n(s(r.toPOJO(),{ads:r.map("ads",function(e){var n=t.indexOf(e),r=t[n],o=i[n];return o?o.map(function(e,t){var n=function(e){return{linear:e.filter(r("linear")),companions:e.filter(r("companions")),nonLinear:e.filter(r("nonLinear"))}}(e.creatives);function r(e){return function(t){return t.type===e}}return a(e.impressions,t.impressions),a(e.viewableImpressions,t.viewableImpressions),a(e.errors,t.errors),t.creatives.forEach(function(e){a(n[e.type].shift()||{},e)}),l.apply(t.creatives,"wrapper"!==t.type?[]:["linear","companions","nonLinear"].reduce(function(e,t){return e.concat(n[t])},[])),t}.bind(null,r)):[e]}).reduce(function(e,t){return e.concat(t)})}))}).then(function(t){return t.get("wrappers.length")>0?t.resolveWrappers(e-1):t}),t)},g.prototype.toXML=function(){var e=this.validate();if(!e.valid)throw new Error("VAST is invalid: "+e.reasons.join(", "));return c(this)},g.prototype.validate=function(){var e=this,t=[],n={inline:function(t){var n={linear:function(e){a(e,{exists:["duration"],atLeastOne:["mediaFiles"]})},companions:function(t){e.get(t("companions")).forEach(function(e,n){a(function(e){return t("companions["+n+"]."+e)},{exists:[],atLeastOne:["resources"]})})},nonLinear:function(t){e.get(t("ads")).forEach(function(e,n){a(function(e){return t("ads["+n+"]."+e)},{exists:[],atLeastOne:["resources"]})})}};a(t,{exists:["title"],atLeastOne:["creatives"]}),e.get(t("creatives")).forEach(function(e,r){function i(e){return t("creatives["+r+"]."+e)}a(i,{exists:["type"],atLeastOne:[]}),(n[e.type]||p)(i)})},wrapper:function(e){a(e,{exists:["vastAdTagURI"],atLeastOne:[]})}};function r(e,n){e||t.push(n)}function i(t){r(e.get(t),t+" is required")}function o(t){r(e.get(t+".length")>0,t+" must contain at least one value")}function a(e,t){t.exists.map(e).forEach(i),t.atLeastOne.map(e).forEach(o)}return a(function(e){return e},{exists:[],atLeastOne:["ads"]}),this.get("ads").forEach(function(e,t){function r(e){return"ads["+t+"]."+e}a(r,{exists:["type","system.name"],atLeastOne:["impressions"]}),(n[e.type]||p)(r)}),{valid:0===t.length,reasons:0===t.length?null:t}},g.pojoFromXML=n(30),g.fetch=function(e){var t="object"===r(arguments[1])&&arguments[1]||{},n="function"==typeof arguments[2]?arguments[2]:arguments[1],i=this;return u(Promise.resolve(y(e,{headers:t.headers||{}})).then(function(e){var n=new i(i.pojoFromXML(e.data));return t.resolveWrappers?n.resolveWrappers(t.maxRedirects):n}),n)},e.exports=g},function(e,t){e.exports={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.withCredentials,r=t.headers;return new Promise(function(t,i){var o=new XMLHttpRequest;o.open("GET",e),o.withCredentials=Boolean(n),o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200===o.status?t({data:o.responseText}):i(new Error("Unexpected status code:",o.status)))},r&&Object.keys(r).forEach(function(e){o.setRequestHeader(e,r[e])}),o.send()})}}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=Array.prototype.push;e.exports=function e(t){var n="object"===r(arguments[1])?arguments[1]:null,o="boolean"==typeof arguments[1]?arguments[1]:arguments[2];return Object(t)!==t?t:t instanceof Array?function(t,n,r){var o=n||[];return i.apply(o,r?t.map(function(t){return e(t,null,!0)}):t),o}(t,n,o):function(t,n,r){return Object.keys(t).reduce(function(n,i){return n[i]=r?e(t[i],null,!0):t[i],n},n||{})}(t,n,o)}},function(e,t,n){"use strict";var r=Array.prototype.push;function i(e){return Object(e)===e}function o(e){return e instanceof Array}e.exports=function e(t,n){return[t,n].every(o)?(r.apply(n,t.filter(function(e){return n.indexOf(e)<0})),n):Object.keys(t).reduce(function(n,r){return[t[r],n[r]].every(i)&&e(t[r],n[r]),r in n||(n[r]=t[r]),n},n)}},function(e,t,n){"use strict";e.exports=function(e,t){return"function"!=typeof t?e:(e.then(function(e){t(null,e)},function(e){t(e)}),e)}},function(e,t,n){"use strict";var r=n(28),i=n(29),o={linear:function(e){return{tag:"Linear",children:[{tag:"Duration",value:r(e.duration)},a(e.trackingEvents),u(e)].concat(e.videoClicks?[{tag:"VideoClicks",children:[{tag:"ClickThrough",value:e.videoClicks.clickThrough,cdata:!0}].concat(e.videoClicks.clickTrackings.map(function(e){return{tag:"ClickTracking",value:e,cdata:!0}}),e.videoClicks.customClicks.map(function(e){return{tag:"CustomClick",attributes:{id:e.id},value:e.uri,cdata:!0}}))}]:[],[{tag:"MediaFiles",children:e.mediaFiles.map(function(e){return{tag:"MediaFile",attributes:{id:e.id,width:e.width,height:e.height,bitrate:e.bitrate,type:e.type,delivery:e.delivery,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,apiFramework:e.apiFramework},value:e.uri,cdata:!0}})}])}},companions:function(e){return{tag:"CompanionAds",children:e.companions.map(function(e){return{tag:"Companion",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,apiFramework:e.apiFramework},children:s(e.resources).concat([a(e.trackingEvents),{tag:"CompanionClickThrough",value:e.clickThrough,cdata:!0},{tag:"AltText",value:e.altText},u(e)])}})}},nonLinear:function(e){return{tag:"NonLinearAds",children:e.ads.map(function(e){return{tag:"NonLinear",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,minSuggestedDuration:r(e.minSuggestedDuration),apiFramework:e.apiFramework},children:s(e.resources).concat([{tag:"NonLinearClickThrough",value:e.clickThrough,cdata:!0},u(e)])}}).concat([a(e.trackingEvents)])}}};function a(e){return{tag:"TrackingEvents",children:e.map(function(e){return{tag:"Tracking",attributes:{event:e.event},value:e.uri,cdata:!0}})}}function s(e){return e.map(function(e){return{tag:function(t){switch(e.type){case"static":return"StaticResource";case"iframe":return"IFrameResource";case"html":return"HTMLResource"}}(),attributes:{creativeType:e.creativeType},value:e.data,cdata:!0}})}function u(e){return{tag:"AdParameters",value:e.parameters}}e.exports=function(e){return i({tag:"VAST",attributes:{version:e.get("version")},children:e.map("ads",function(e){return{tag:"Ad",attributes:{id:e.id},children:[{tag:function(){switch(e.type){case"inline":return"InLine";case"wrapper":return"Wrapper"}}(),children:[{tag:"AdSystem",attributes:{version:e.system.version},value:e.system.name},{tag:"AdTitle",value:e.title},{tag:"Description",value:e.description},{tag:"Survey",value:e.survey,cdata:!0},{tag:"VASTAdTagURI",value:e.vastAdTagURI,cdata:!0}].concat(e.errors.map(function(e){return{tag:"Error",value:e,cdata:!0}}),e.impressions.map(function(e){return{tag:"Impression",value:e.uri,cdata:!0,attributes:{id:e.id}}}),[{tag:"ViewableImpression",children:e.viewableImpressions.map(function(e){return{tag:"Viewable",value:e.uri,cdata:!0,attributes:{id:e.id}}})}],[{tag:"Creatives",children:e.creatives.map(function(e){return{tag:"Creative",attributes:{id:e.id,sequence:e.sequence,AdID:e.adID},children:[(t=e.type,o[t](e))]};var t}),required:!0}])}]}})},!0)}},function(e,t,n){"use strict";function r(e){return(e>9?"":"0")+e.toString()}e.exports=function(e){return Number(e)!==e?null:[Math.floor(e/60/60),Math.floor(e/60%60),Math.floor(e%60%60)].map(r).join(":")}},function(e,t,n){"use strict";function r(e){return null!=e}function i(e){return void 0!==e?String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function o(e){return e.cdata?function(e){return(void 0!==e?function(e){for(var t,n,r=[],i=/]]>/g,o=0;t=i.exec(e);)n=t.index+2,r.push(t.input.substring(o,n)),o=n;return r.push(e.substring(o,e.length)),r}(String(e)):[""]).reduce(function(e,t){return e+"<![CDATA["+t+"]]>"},"")}(e.value):i(e.value)}e.exports=function(e,t){return['<?xml version="1.0" encoding="UTF-8"?>'].concat(function e(t,n,a){var s=t.tag,u=t.attributes||{},l=Object.keys(u),c=t.children||[],f=t.value,d=c.length>0,h=l.every(function(e){return r(u[e])})&&l.length>0,p=r(f)||d||h,y=function(e){for(var t="";e--;)t+=" ";return t}(n),g="<"+s+Object.keys(u).reduce(function(e,t){return a&&!r(u[t])?e:e+" "+t+'="'+i(u[t])+'"'},"")+">",v="</"+s+">";return!a||p||t.required?d?[y+g].concat(t.children.reduce(function(t,r){return t.concat(e(r,n+4,a))},[]),[y+v]):[y+g+o(t)+v]:[]}(e,0,t)).join("\n")}},function(e,t,n){"use strict";var r=n(31),i=n(32),o=n(33),a=n(13),s=n(34),u=n(35),l={linear:function(e){var t=f(e.find("Duration")),n=f(e.find("Linear")),r=e.find("Tracking"),a=f(e.find("AdParameters")),s=e.find("VideoClicks")[0],l=e.find("MediaFile");return{type:"linear",skipOffset:n.attributes.skipoffset,duration:i(t.value)||void 0,trackingEvents:r.map(function(e){var t={event:e.attributes.event,uri:e.value};return"progress"===e.attributes.event&&(t.offset=i(e.attributes.offset)),t}),parameters:a.value,videoClicks:s&&function(){var e=f(s.find("ClickThrough")),t=s.find("ClickTracking"),n=s.find("CustomClick");return{clickThrough:e.value,clickTrackings:t.map(function(e){return e.value}),customClicks:n.map(function(e){return{id:e.attributes.id,uri:e.value}})}}(),mediaFiles:l.map(function(e){var t=e.attributes;return{id:t.id,delivery:t.delivery,type:t.type,uri:e.value,bitrate:u(t.bitrate),width:u(t.width),height:u(t.height),scalable:o(t.scalable),maintainAspectRatio:o(t.maintainAspectRatio),apiFramework:t.apiFramework}})}},companions:function(e){return{type:"companions",companions:e.find("Companion").map(function(e){var t=e.find("Tracking"),n=f(e.find("CompanionClickThrough")),r=f(e.find("StaticResource")),i=f(e.find("AltText")),o=f(e.find("AdParameters"));return{id:e.attributes.id,width:u(e.attributes.width),height:u(e.attributes.height),expandedWidth:u(e.attributes.expandedWidth),expandedHeight:u(e.attributes.expandedHeight),apiFramework:e.attributes.apiFramework,resources:function(e){return e.find("URL").map(function(e){return{data:e.value}})}(e),staticResource:r.value,trackingEvents:t.map(function(e){return{event:e.attributes.event,uri:e.value}}),clickThrough:n.value,altText:i.value,parameters:o.value}})}},nonLinear:function(e){var t=e.find("NonLinear"),n=e.find("Tracking");return{type:"nonLinear",ads:t.map(function(e){var t=f(e.find("NonLinearClickThrough")),n=f(e.find("StaticResource")),r=f(e.find("AdParameters"));return{id:e.attributes.id,width:e.attributes.width,height:e.attributes.height,expandedWidth:u(e.attributes.expandedWidth),expandedHeight:u(e.attributes.expandedHeight),scalable:o(e.attributes.scalable),maintainAspectRatio:o(e.attributes.maintainAspectRatio),minSuggestedDuration:i(e.attributes.minSuggestedDuration)||void 0,apiFramework:e.attributes.apiFramework,resources:n.value,clickThrough:t.value,parameters:r.value}}),trackingEvents:n.map(function(e){return{event:e.attributes.event,uri:e.value}})}}},c={inline:function(e){var t=f(e.find("AdTitle")),n=f(e.find("Description")),r=f(e.find("Survey"));return{type:"inline",title:t.value,description:n.value,survey:r.value}},wrapper:function(e){return{type:"wrapper",vastAdTagURI:f(e.find("VASTAdTagURI")).value}}};function f(e){return e[0]||{attributes:{}}}e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"VAST",n=r(e);if(!n(t)[0])throw new Error("["+e+"] is not a valid VAST document.");return s({version:f(n(t)).attributes.version,ads:n("Ad").map(function(e){var t=f(e.find("Wrapper,InLine")).tag.toLowerCase(),n=f(e.find("AdSystem")),r=f(e.find("AdTitle")),i=f(e.find("Description")),o=e.find("Error"),s=e.find("Impression"),d=e.find("ViewableImpression Viewable"),h=e.find("Creative").filter(function(e){return e.children().length});return a({id:e.attributes.id,system:{name:n.value,version:n.attributes.version},advertiser:{title:r.value,description:i.value},errors:o.map(function(e){return e.value}),impressions:s.map(function(e){return{uri:e.value,id:e.attributes.id}}),viewableImpressions:d.map(function(e){return{uri:e.value,id:e.attributes.id}}),creatives:h.map(function(e){var t=function(){switch(f(e.find("Linear,CompanionAds,NonLinearAds")).tag){case"Linear":return"linear";case"CompanionAds":return"companions";case"NonLinearAds":return"nonLinear"}}();return a({id:e.attributes.id,sequence:u(e.attributes.sequence),adID:e.attributes.AdID},l[t](e))})},c[t](e))})},!0)}},function(e,t,n){"use strict";var r=Array.prototype.map,i=Array.prototype.filter,o=Array.prototype.reduce,a=new DOMParser;function s(e){var t=e.childElementCount>0;return{tag:e.tagName,value:t?null:e.textContent,attributes:o.call(e.attributes,function(e,t){return e[t.name]=t.value,e},{}),find:function(t){return u(e.querySelectorAll(t))},children:function(){return i.call(e.childNodes,function(e){return e instanceof Element}).map(s)}}}function u(e){return r.call(e,s)}e.exports=function(e){var t=a.parseFromString(e,"application/xml");return function(e){return u(t.querySelectorAll(e))}}},function(e,t,n){"use strict";e.exports=function(e){var t=(e||"").match(/^(\d\d):(\d\d):(\d\d)$/);return t&&t.slice(1,4).map(parseFloat).reduce(function(e,t,n){return e+t*Math.pow(60,Math.abs(n-2))},0)}},function(e,t,n){"use strict";e.exports=function(e){switch((e||"").toLowerCase()){case"true":return!0;case"false":return!1}}},function(e,t,n){"use strict";e.exports=function e(t,n){return Object(t)!==t?t:Object.keys(t).reduce(function(r,i){return n&&t[i]instanceof Array?r[i]=t[i].filter(function(e){return void 0!==e}).map(function(t){return e(t,!0)}):n&&t[i]instanceof Object?r[i]=e(t[i],!0):void 0!==t[i]&&(r[i]=t[i]),r},{})}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){if(/string|number|boolean/.test(r(e)))return isNaN(e)?void 0:Number(e)}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t,n,r){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,r){var i,o=c(e,t);if(o){if((i=Object.getOwnPropertyDescriptor(o,t)).set)return i.set.call(r,n),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(r,t)){if(!i.writable)return!1;i.value=n,Object.defineProperty(r,t,i)}else!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(r,t,n);return!0})(e,t,n,r)}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=c(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=n(37),h=n(4),p=n(14),y=n(8),g=n(9).isDesktop,v=n(38),m=n(16),b=n(10);function _(e,t,n){return e.addEventListener(t,n,!1)}var E=function(e){function t(e,n,r,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=i(this,f(t).call(this,e))).frame=null,a.video=n,a.config=r,a.parent=o,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,d),a(t,[{key:"adVolume",get:function(){return l(f(t.prototype),"adVolume",this)},set:function(e){(function(e,t,n,r,i){if(!u(e,t,n,r||e)&&i)throw new Error("failed to set property")})(f(t.prototype),"adVolume",e,this,!0),this.video.muted=0===e}}],[{key:"canPlayMediaFile",value:function(e){return(e.type===p.JAVASCRIPT||"application/x-javascript"===e.type)&&"VPAID"===e.apiFramework}}]),a(t,[{key:"load",value:function(e,t){var n=this,r=e[0].uri,i=e[0].bitrate;return new Promise(function(e,o){var a=document.createElement("iframe"),s=document.createElement("script"),u=n.video,l=null;function c(e){n.container.removeChild(a),n.adVolume=0,n.video.clean&&n.video.clean(),n.video=null,n.frame=null,n.api=null,e&&o(e)}a.src="about:blank",a.setAttribute("scrolling","no"),a.style.width="100%",a.style.height="100%",a.style.display="block",a.style.opacity="0",a.style.border="none",n.container.appendChild(a),a.contentWindow.document.open(),a.contentWindow.document.close(),a.contentWindow.document.body.style.margin="0",n.frame=a,s.src=r,s.onload=function(){var r=a.contentWindow.getVPAIDAd(),s=a.contentWindow.document.body,l=n.vpaidVersion=new v(r.handshakeVersion("2.0"));if(l.major>2)return o(new Error("VPAID version "+l+" is not supported."));a.contentWindow.addEventListener("resize",function(){var e=a.getBoundingClientRect();n.resizeAd(e.width,e.height,"normal")},!1),h.forEach(function(e){if(n.parent.isAsiaSmartAd||e!==h.AdStarted)return r.subscribe(function(){for(var t=new Array(arguments.length),r=arguments.length;r--;)t[r]=arguments[r];return n.emit.apply(n,[e].concat(t))},e)}),n.once(h.AdLoaded,function(){a.style.opacity="1",n.api=r,e(n)}),n.once(h.AdError,function(e){c(new Error(e))}),n.once(h.AdStopped,c),n.parent.isAsiaSmartAd&&(n.once(h.AdStopped,function(e){n.emit(h.AdSkipped)}),n.once(h.AdVideoStart,function(e){var t=a.contentWindow.document.querySelector(".sas-container").querySelector("iframe").contentWindow.document.querySelector("video");n.video=t,n.parent.video=t})),r.initAd(n.config.width,n.config.height,"normal",i,{AdParameters:t.adParameters},{slot:s,videoSlot:u,videoSlotCanAutoPlay:g})},s.onerror=function(){c(new Error("Failed to load MediaFile ["+r+"]."))},function(e,t,n){_(e,t,function r(){return function(e,t,n){e.removeEventListener(t,n,!1)}(e,t,r),n.apply(this,arguments)})}(u,y.PLAYING,function(){n.emit(h.AdStarted)}),_(u,y.TIMEUPDATE,function(){var e,t;e=n.container,!((t=e.getBoundingClientRect()).top||t.height/2<=window.innerHeight-t.top&&t.bottom>=t.height/2)||n.alreadyEmitViewable?l=null:(l||(l=u.currentTime),u.currentTime-l>=2&&(n.alreadyEmitViewable=!0,n.emit(h.AdViewableImpression)))}),_(u,y.LOADEDMETADATA,function(){var e=new m(u,t.progressEvents);new b([h.AdVideoProgress]).from(e).to(n)}),a.contentWindow.document.body.appendChild(u),a.contentWindow.document.body.appendChild(s)})}}]),t}();e.exports=E},function(e,t,n){"use strict";var r=n(6),i=n(4);function o(e,t){return function(){var n=arguments,r=this.api,i=this;function o(){return new Error("Ad has not been loaded.")}function a(){return r[e].apply(r,n)}if(!t){if(!r)throw o();return a()}return new Promise(function(e,n){return r?(i.once(t,function(){e(i)}),a()):n(o())})}}function a(e){r.call(this),this.container=e,this.api=null,this.vpaidVersion=null}a.prototype=Object.create(r.prototype),Object.defineProperties(a.prototype,{adLinear:{get:o("getAdLinear")},adWidth:{get:o("getAdWidth")},adHeight:{get:o("getAdHeight")},adExpanded:{get:o("getAdExpanded")},adSkippableState:{get:o("getAdSkippableState")},adRemainingTime:{get:o("getAdRemainingTime")},adDuration:{get:o("getAdDuration"),set:function(e){}},adVolume:{get:o("getAdVolume"),set:o("setAdVolume")},adCompanions:{get:o("getAdCompanions")},adIcons:{get:o("getAdIcons")}}),a.prototype.load=function(){throw new Error("VPAID subclass must implement load() method.")},a.prototype.resizeAd=o("resizeAd",i.AdSizeChange),a.prototype.startAd=o("startAd",i.AdStarted),a.prototype.stopAd=o("stopAd",i.AdStopped),a.prototype.pauseAd=o("pauseAd",i.AdPaused),a.prototype.resumeAd=o("resumeAd",i.AdPlaying),a.prototype.expandAd=o("expandAd",i.AdExpandedChange),a.prototype.collapseAd=o("collapseAd",i.AdExpandedChange),a.prototype.skipAd=function(){o("skipAd",i.AdSkipped).call(this),this.stopAd()},e.exports=a},function(e,t,n){"use strict";function r(e){var t=e.split(".").map(parseFloat);this.string=e,this.major=t[0],this.minor=t[1],this.patch=t[2],Object.freeze(this)}r.prototype.toString=function(){return this.string},e.exports=r},function(e,t,n){"use strict";var r=n(6),i=n(4);function o(e,t,n){e!==i.AdVideoProgress?t.fired[e]||(t.emit(e),t.fired[e]=!0):t.emit(e,n)}function a(e,t){r.apply(this,arguments),this.duration=e,this.progressEvents=t.sort(function(e,t){return e.offset<t.offset}),this.seconds=Array.apply([],new Array(e)).map(function(){return!1}),this.fired=[i.AdVideoStart,i.AdVideoFirstQuartile,i.AdVideoMidpoint,i.AdVideoThirdQuartile,i.AdVideoComplete].reduce(function(e,t){return e[t]=!1,e},{})}a.prototype=Object.create(r.prototype),a.prototype.tick=function(){var e=this,t=this.seconds,n=this._getState(),r=Math.round(n.currentTime)-1,a=[1,2,3,4].map(function(e){return Math.floor(this.duration/4*e)},this);function s(e){var n=a[e-1];return!(!n||0==n)&&t.slice(0,n).every(function(e){return!0===e})}n.playing&&(o(i.AdVideoStart,this),r>-1&&(this.seconds[r]=!0)),s(1)&&o(i.AdVideoFirstQuartile,this),s(2)&&o(i.AdVideoMidpoint,this),s(3)&&o(i.AdVideoThirdQuartile,this),s(4)&&o(i.AdVideoComplete,this),this.progressEvents.length&&this._popMatchProgressEvents(n.currentTime).forEach(function(t){return o(i.AdVideoProgress,e,t)})},a.prototype._popMatchProgressEvents=function(e){for(var t=this.progressEvents,n=t.length-1;n>-1&&e>t[n].offset;)n-=1;return t.splice(n+1)},a.prototype._getState=function(){throw Error("this method must be overridden")},e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(9).canPlay,o=n(41),a=n(4),s=n(8),u=n(16),l=n(10);function c(e,t,n){return e.addEventListener(t,n,!1)}function f(e,t,n){return c(e,t,function r(){return function(e,t,n){e.removeEventListener(t,n,!1)}(e,t,r),n.apply(this,arguments)})}function d(e,t){function n(){return new Error("The <video> has not been loaded.")}return function(){if(!this.video){if(t)return Promise.reject(n());throw n()}return e.apply(this,arguments)}}function h(){return this.container.removeChild(this.video),this.video.clean(),this.video=null,this.alreadyEmitViewable=!1,Promise.resolve(this)}function p(e,t,n){r.call(this),this.container=e,this.video=t,this.config=n,this.__private__={hasPlayed:!1}}p.prototype=Object.create(r.prototype),Object.defineProperties(p.prototype,{adRemainingTime:{get:d(function(){return this.video.duration-this.video.currentTime})},adDuration:{get:d(function(){return this.video.duration})},adVolume:{get:d(function(){return this.video.volume}),set:d(function(e){this.video.muted=0===e,this.video.volume=e})}}),p.prototype.load=function(e,t){var n=this;return new Promise(function(r,d){var h=n.video,p=function(e,t){var n=t.width,r=e.map(function(e){return{mediaFile:e,playability:"video/3gpp"!==e.type&&i(e.type)}}).filter(function(e){return e.playability>0}).sort(o("-playability","-mediaFile.bitrate")),a=r.map(function(e){return Math.abs(n-e.mediaFile.width)}),s=r[a.indexOf(Math.min.apply(Math,a))];return!s||s.playability<1?null:s.mediaFile}(e,{width:n.config.width,height:n.config.height}),y=null;if(!p)return d(new Error("There are no playable <MediaFile>s."));h.src=p.uri,f(h,s.LOADEDMETADATA,function(){var e=new u(h,t.progressEvents);new l(a).from(e).to(n),r(n),n.emit(a.AdLoaded),c(h,s.DURATIONCHANGE,function(){n.emit(a.AdDurationChange)}),c(h,s.VOLUMECHANGE,function(){n.emit(a.AdVolumeChange)})}),f(h,s.ERROR,function(){var e=h.error;n.emit(a.AdError,e.message),d(e)}),f(h,s.PLAYING,function(){n.__private__.hasPlayed=!0,n.emit(a.AdImpression)}),f(h,s.ENDED,function(){n.stopAd()}),c(h,s.TIMEUPDATE,function(){var e,t;e=n.container,!((t=e.getBoundingClientRect()).top||t.height/2<=window.innerHeight-t.top&&t.bottom>=t.height/2)||n.alreadyEmitViewable?y=null:(y||(y=h.currentTime),h.currentTime-y>=2&&(n.alreadyEmitViewable=!0,n.emit(a.AdViewableImpression)))}),c(h,"click",function(){n.emit(a.AdClickBackground,null,null,!0)}),n.container.appendChild(h)})},p.prototype.startAd=d(function(){var e=this,t=this.video;return this.__private__.hasPlayed?Promise.reject(new Error("The advertisement has already been started.")):new Promise(function(n,r){return f(t,s.PLAYING,function(){n(e),e.alreadyPlayAd=!0,e.emit(a.AdStarted)}),t.play().catch(r)})},!0),p.prototype.stopAd=d(function(){return this.emit(a.AdStopped),h.call(this)},!0),p.prototype.skipAd=d(function(){return this.emit(a.AdSkipped),h.call(this)},!0),p.prototype.pauseAd=d(function(){var e=this,t=this.video;return this.video.paused?Promise.resolve(this):new Promise(function(n){return f(t,s.PAUSE,function(){n(e),e.emit(a.AdPaused)}),t.pause()})},!0),p.prototype.resumeAd=d(function(){var e=this,t=this.video;return this.__private__.hasPlayed?this.video.paused?new Promise(function(n){return f(t,s.PLAY,function(){n(e),e.emit(a.AdPlaying)}),t.play()}):Promise.resolve(this):Promise.reject(new Error("The ad has not been started yet."))},!0),p.canPlayMediaFile=function(e){return Boolean(document.createElement("video").canPlayType(e.type))},e.exports=p},function(e,t,n){var r,i,o,a=n(42);o=function(e){return function(t){return typeof t===e}},i=function(e,t){var n=1,r=t||function(e,t){return t};return"-"===e[0]&&(n=-1,e=e.substr(1)),function(t,i){var o,s=r(e,a.get(t,e)),u=r(e,a.get(i,e));return s<u&&(o=-1),s>u&&(o=1),s===u&&(o=0),o*n}},r=function(){var e=Array.prototype.slice.call(arguments),t=e.filter(o("string")),n=e.filter(o("function"))[0];return function(e,r){for(var o=t.length,a=0,s=0;0===a&&s<o;)a=i(t[s],n)(e,r),s++;return a}},e.exports=r},function(e,t,n){var r,i,o;!function(n,a){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=a():(i=[],void 0===(o="function"==typeof(r=a)?r.apply(t,i):r)||(e.exports=o))}(0,function(){"use strict";var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty;function n(e){if(!e)return!0;if(a(e)&&0===e.length)return!0;for(var n in e)if(t.call(e,n))return!1;return!0}function r(t){return e.call(t)}function i(e){return"number"==typeof e||"[object Number]"===r(e)}function o(e){return"string"==typeof e||"[object String]"===r(e)}function a(e){return"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===r(e)}function s(e){var t=parseInt(e);return t.toString()===e?t:e}function u(e,t,r,a){if(i(t)&&(t=[t]),n(t))return e;if(o(t))return u(e,t.split("."),r,a);var l=s(t[0]);if(1===t.length){var c=e[l];return void 0!==c&&a||(e[l]=r),c}return void 0===e[l]&&(i(l)?e[l]=[]:e[l]={}),u(e[l],t.slice(1),r,a)}var l={ensureExists:function(e,t,n){return u(e,t,n,!0)},set:function(e,t,n,r){return u(e,t,n,r)},insert:function(e,t,n,r){var i=l.get(e,t);r=~~r,a(i)||(i=[],l.set(e,t,i)),i.splice(r,0,n)},empty:function(e,t){if(n(t))return e;if(!n(e)){var s;if(!(s=l.get(e,t)))return e;if(o(s))return l.set(e,t,"");if(function(e){return"[object Boolean]"===r(e)}(s))return l.set(e,t,!1);if(i(s))return l.set(e,t,0);if(!a(s))return l.set(e,t,null);s.length=0}},push:function(e,t){var n=l.get(e,t);a(n)||(n=[],l.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},coalesce:function(e,t,n){for(var r,i=0,o=t.length;i<o;i++)if(void 0!==(r=l.get(e,t[i])))return r;return n},get:function(e,t,r){if(i(t)&&(t=[t]),n(t))return e;if(n(e))return r;if(o(t))return l.get(e,t.split("."),r);var a=s(t[0]);return 1===t.length?void 0===e[a]?r:e[a]:l.get(e[a],t.slice(1),r)},del:function(e,t){return function e(t,r){if(i(r)&&(r=[r]),!n(t)){if(n(r))return t;if(o(r))return e(t,r.split("."));var u=s(r[0]),l=t[u];if(1===r.length)void 0!==l&&(a(t)?t.splice(u,1):delete t[u]);else if(void 0!==t[u])return e(t[u],r.slice(1));return t}}(e,t)}};return l})},function(e,t,n){"use strict";var r=n(4);function i(e){return e}function o(e,t){(e||[]).forEach(function(e){(new Image).src=t(e)})}function a(e,t){this.pixels=e.reduce(function(e,t){return t&&(e[t.event]||(e[t.event]=[])).push(t.uri),e},{}),this.__private__={mapper:t||i}}a.prototype.track=function(e){var t=this.pixels,n=this.__private__.mapper,a=e.adVolume;function s(e,r,a){function s(e){return n((r||i)(e))}return function(){a&&!a()||o(t[e],s)}}e.on(r.AdSkipped,s("skip")),e.on(r.AdStarted,s("creativeView")),e.on(r.AdVolumeChange,s("unmute",null,function(){return 0===a&&e.adVolume>0})),e.on(r.AdVolumeChange,s("mute",null,function(){return a>0&&0===e.adVolume})),e.on(r.AdImpression,s("impression")),e.on(r.AdViewableImpression,function(){s("viewableImpression"),s("impression")}),e.on(r.AdVideoStart,s("start")),e.on(r.AdVideoFirstQuartile,s("firstQuartile")),e.on(r.AdVideoMidpoint,s("midpoint")),e.on(r.AdVideoThirdQuartile,s("thirdQuartile")),e.on(r.AdVideoProgress,function(e){o([e.uri],n||i)}),e.on(r.AdVideoComplete,s("complete")),e.on(r.AdUserAcceptInvitation,s("acceptInvitationLinear")),e.on(r.AdUserMinimize,s("collapse")),e.on(r.AdUserClose,s("closeLinear")),e.on(r.AdPaused,s("pause")),e.on(r.AdResumed,s("resume")),e.on(r.AdPlaying,s("resume")),e.on(r.AdError,s("error",function(e){return e.replace(/\[ERRORCODE\]/g,901)})),e.on(r.AdVolumeChange,function(){a=e.adVolume})},e.exports=a},function(e,t){e.exports=function(){var e=document.createElement("video"),t=[],n=!1,r=e.addEventListener,i=e.removeEventListener,o=e.play,a=Array.prototype.map.call(e.attributes,function(e){return e.name});return e.init=function(t){return n?Promise.resolve():(n=!0,e.parentNode||t.appendChild(e),Promise.resolve().then(function(){return e.load()}).catch(function(e){return console.log("Error while initializing video",e)}))},e.clean=function(){t.forEach(function(t){i.call(e,t.type,t.listener,t.options)}),t=[],e.load(),s()},e.addEventListener=function(n,i,o){return t.push({type:n,listener:i,options:o}),r.call(e,n,i,o)},e.removeEventListener=function(t,n,r){return i.call(e,t,n,r)},e.play=function(){return n=!0,o.call(e)},s(),e;function s(){Array.prototype.forEach.call(e.attributes,function(t){-1===a.indexOf(t.name)&&e.removeAttribute(t.name)}),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),e.setAttribute("preload","auto"),e.style.display="block",e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.backgroundColor="#000",e.style.objectFit="contain"}}},function(e,t){e.exports={getVpaidVendor:function(e){return/moatads\.com/.test(e[0].uri)?"MOAT":null}}},function(e,t,n){e.exports=n(47)},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l=n(48),c=n(50),f=n(11),d=n(3),h=d.isImaAd,p=d.createPromiseDefer,y=n(51),g=n(5).DEFAULT_MAX_VOLUME;e.exports=function(e){function t(e,n,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}(this,i(t).call(this,e,n,o,a)))._onAdsManagerLoaded=s._onAdsManagerLoaded.bind(u(u(s))),s._onAdEvent=s._onAdEvent.bind(u(u(s))),s._onAdErrorEvent=s._onAdErrorEvent.bind(u(u(s))),s.adDisplayContainer=null,s.adsLoader=null,s.adsManager=null,s.adOption=null,s.currentAd=null,s.volume=s.videoContent.muted?0:s.videoContent.volume*g,s.paused=!1,s.destroyed=!1,s.loadDeferred=null,s.startAdRequested=!1,s.cancelledAdRequested=!1,s.initUserActionHappened=!1,l.load().then(function(){return s._init()}).catch(function(e){s.destroyed||s.logger.error(s.name,"cannot load SDK",e)}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,f),a(t,[{key:"name",get:function(){return"GoogleImaPlayer"}},{key:"videoContentWidth",get:function(){return this.videoContent.offsetWidth}},{key:"videoContentHeight",get:function(){return this.videoContent.offsetHeight}},{key:"videoContentVolume",get:function(){return this.videoContent.muted?0:this.videoContent.volume}},{key:"selfControl",get:function(){return!1}},{key:"canClickThrough",get:function(){return!0}},{key:"isGoogleImaAd",get:function(){return!0}}]),a(t,[{key:"initUserAction",value:function(){!this.initUserActionHappened&&this.adDisplayContainer&&(this.initUserActionHappened=!0,this.adDisplayContainer.initialize(),this.adDisplayContainer.initialized=!0,this.logger.debug(this.name,"init user action done"))}},{key:"loadAd",value:function(e,t){var n=this;this.logger.debug(this.name,"loadAd ad ",e),this.adOption=t,this.tracker=new c(e),this.tracker._trackEvent("requestVast"),this.loadDeferred=p();var r=e.vastAdTagURI;return l.isReady().then(function(){return n._requestAds(r)}).then(function(){return n.loadDeferred.promise})}},{key:"canRun",value:function(e){return h(e)}},{key:"start",value:function(){return this.startAdRequested=!1,this.cancelledAdRequested=!1,this.paused=!1,this.destroyed?this._onAdStopped(new Error("cannot play ad since adsManager was destroyed")):this.adsManager?(this.initUserAction(),void this.adsManager.start()):(this.startAdRequested=!0,void this.logger.debug(this.name,"cannot play ad since adsManager is not loaded yet, try to play on load event"))}},{key:"stop",value:function(){this.adsManager&&this.adsManager.stop()}},{key:"skip",value:function(){this.stop()}},{key:"pause",value:function(){this.adsManager&&this.adsManager.pause()}},{key:"resume",value:function(){this.adsManager&&this.adsManager.resume()}},{key:"cancel",value:function(){this.adsManager?this.adsManager.stop():this.cancelledAdRequested=!0}},{key:"setVolume",value:function(e){this.logger.debug(this.name,"setVolume | volume ",e),this.volume=e,this.adsManager&&this.adsManager.setVolume(e)}},{key:"getVolume",value:function(){return this.volume}},{key:"isPaused",value:function(){return this.paused}},{key:"getRemainingTime",value:function(){return this.adsManager.getRemainingTime()}},{key:"getDuration",value:function(){return this.currentAd?this.currentAd.getDuration():0}},{key:"getSkipOffset",value:function(){return this.logger.debug(this.name,"skipTimeOffset",this.currentAd&&this.currentAd.getSkipTimeOffset()),this.adOption?this.adOption.skipoffset:-1}},{key:"resize",value:function(){this.adsManager&&this.adsManager.resize(this.videoContentWidth,this.videoContentHeight,google.ima.ViewMode.NORMAL)}},{key:"destroy",value:function(){this.destroyed=!0,this._destroyAdsManager(),this._destroyAdDisplayContainer(),this.element&&(this.adContainerElement.removeChild(this.element),this.element=null),this.logger.debug(this.name,"destroyed")}},{key:"_init",value:function(){this.destroyed||(this.element=document.createElement("div"),this.element.style.width="100%",this.element.style.height="100%",this.element.style.position="absolute",this.element.style.zIndex=1,this.element.style.backgroundColor="rgba(0, 0, 0, 0.8)",this.element.setAttribute("data-player",this.name),this.adContainerElement.appendChild(this.element),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),google.ima.settings.setDisableFlashAds(!0),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.element,this.videoContent),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setPlayerType("zplayer-ima"),this.adsLoader.getSettings().setPlayerVersion(y.version),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.options.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this._onAdsManagerLoaded,!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._onAdErrorEvent,!1),this._hide())}},{key:"_show",value:function(){this.element.style.display="block"}},{key:"_hide",value:function(){this.element.style.display="none"}},{key:"_requestAds",value:function(e){this.logger.debug(this.name,"_requestAds | adTagUrl",e);var t=new google.ima.AdsRequest;t.adTagUrl=e,t.linearAdSlotWidth=this.videoContentWidth,t.linearAdSlotHeight=this.videoContentHeight,t.nonLinearAdSlotWidth=this.videoContentWidth,t.nonLinearAdSlotHeight=this.videoContentHeight,t.forceNonLinearFullSlot=!0,t.setAdWillAutoPlay(this.options.autoPlay),t.setAdWillPlayMuted(this.options.mute),this.adsLoader.requestAds(t)}},{key:"_onAdsManagerLoaded",value:function(e){var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.enablePreloading=!0,this.adsManager=e.getAdsManager(this.videoContent,t),this.setVolume(this.volume),this.adsManager.init(this.videoContentWidth,this.videoContentHeight,google.ima.ViewMode.NORMAL),this._startAdsManager(this.adsManager)}},{key:"_startAdsManager",value:function(e){e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._onAdErrorEvent,!1,this);var t=[google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.IMPRESSION,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,google.ima.AdEvent.Type.ALL_ADS_COMPLETED];for(var n in t)e.addEventListener(t[n],this._onAdEvent,!1,this);this.cancelledAdRequested?this.cancel():this.startAdRequested&&this.start()}},{key:"_onAdEvent",value:function(e){var t=this;this.logger.debug(this.name,"Ad event:",e.type),this.tracker.onAdEvent(e);var n=e.getAd();switch(e.type){case google.ima.AdEvent.Type.LOADED:this.onAdLoaded(),this.loadDeferred.resolve(),this.loadDeferred=null,n.isLinear()||(this.element.style.backgroundColor="transparent");break;case google.ima.AdEvent.Type.STARTED:if(this.currentAd=n,this._onAdStarted(),!n.isLinear()){var r=-1===n.g.duration?15:n.g.duration;setTimeout(function(){t.adsManager&&t.adsManager.stop(),t._onAdStopped()},1e3*r)}break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this._onAdStopped();break;case google.ima.AdEvent.Type.PAUSED:this._onAdPausedEvent();break;case google.ima.AdEvent.Type.RESUMED:this._onAdResumedEvent()}}},{key:"_onAdErrorEvent",value:function(e){var t=e.getError();this.loadDeferred?this.loadDeferred.reject(t):(this.logger.error(this.name,"Ad error:",t.toString()),this._onAdStopped(t))}},{key:"_onAdPausedEvent",value:function(){this.paused=!0}},{key:"_onAdResumedEvent",value:function(){this.paused=!1}},{key:"_onAdStarted",value:function(){this._show(),this.onAdStarted()}},{key:"_onAdStopped",value:function(e){this._hide(),this._destroyAdsManager(),this.onAdStopped(e)}},{key:"_destroyAdsManager",value:function(){this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)}},{key:"_destroyAdDisplayContainer",value:function(){this.adDisplayContainer&&(this.adDisplayContainer.destroy(),this.adDisplayContainer=null)}}]),t}()},function(e,t,n){var r,i=n(49);e.exports={load:function(){return r||(r=new Promise(function(e,t){i(function(n){n?e():t(new Error("failed to load IMA SDK"))},!0,6e3)})),r},isReady:function(){return r}}},function(e,t){e.exports=function(e,t,n){var r=window,i=document,o=null,a=function(t){r.clearTimeout(o),"function"==typeof e&&e(t)};if(r.google&&r.google.ima)a(!0);else{var s=!0===t?"https:":"",u=i.getElementsByTagName("script")[0],l=i.createElement("script");l.src=s+"//imasdk.googleapis.com/js/sdkloader/ima3.js",l.async=!0,"function"==typeof e&&(l.onload=function(){a(!0)}),u.parentNode.insertBefore(l,u),n&&(o=r.setTimeout(function(){a(!1)},n))}}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.impressionEvents=[].concat(t.impressions||[],t.viewableImpressions||[]),this.trackingEvents=t.creatives[0].trackingEvents,t.creatives[0].videoClicks&&(this.clickTrackingUri=t.creatives[0].videoClicks.clickTrackings[0])}return function(e,t,r){t&&n(e.prototype,t)}(e,[{key:"onAdEvent",value:function(e){var t=this;switch(console.log("adEvent ",e.type),e.type){case google.ima.AdEvent.Type.IMPRESSION:this.impressionEvents.forEach(function(e){return t._fireEvent(e.uri)});break;case google.ima.AdEvent.Type.STARTED:this._trackEvent("start"),this._trackEvent("creativeView");break;case google.ima.AdEvent.Type.FIRST_QUARTILE:this._trackEvent("firstQuartile");break;case google.ima.AdEvent.Type.MIDPOINT:this._trackEvent("midpoint");break;case google.ima.AdEvent.Type.THIRD_QUARTILE:this._trackEvent("thirdQuartile");break;case google.ima.AdEvent.Type.COMPLETE:this._trackEvent("complete");break;case google.ima.AdEvent.Type.PAUSED:this._trackEvent("pause");break;case google.ima.AdEvent.Type.RESUMED:this._trackEvent("resume");break;case google.ima.AdEvent.Type.SKIPPED:this._trackEvent("skip");break;case google.ima.AdEvent.Type.USER_CLOSE:this._trackEvent("close");break;case google.ima.AdEvent.Type.CLICK:this.clickTrackingUri&&this._fireEvent(this.clickTrackingUri)}}},{key:"_trackEvent",value:function(e){var t=this;this.trackingEvents.filter(function(t){return t.event===e}).forEach(function(e){return t._fireEvent(e.uri)})}},{key:"_fireEvent",value:function(e){e&&((new Image).src=e)}}]),e}()},function(e){e.exports={name:"@zplayer/ad-runner",version:"1.0.28",description:"Generic ad runner library for media player",main:"dist/ad-runner.min.js",author:"ZTE folks",publishConfig:{registry:"https://nexus-repo.zapps.vn/repository/zjs-repo/"},scripts:{dev:"webpack-dev-server --progress --mode development --config webpack.config.js",watch:"webpack --progress --watch --mode development --output-filename=[name].min.js --config webpack.config.js",build:"webpack -p --progress --mode production --config webpack.config.js","build-demo":"webpack --progress --mode development --config webpack.config.js",lint:"eslint *.js src/"},devDependencies:{"@babel/core":"^7.1.2","@babel/preset-env":"^7.1.0","@zjs/vast-player":"1.3.65","babel-loader":"^8.0.4","clean-webpack-plugin":"0.1.19","css-loader":"1.0.0",eslint:"^5.4.0","eslint-plugin-import":"^2.15.0","generate-changelog":"^1.7.1","html-webpack-plugin":"3.2.0","node-sass":"4.13.0","sass-loader":"7.1.0","style-loader":"0.23.0",webpack:"4.17.2","webpack-cli":"3.1.0","webpack-dev-server":"3.1.8","webpack-merge":"4.1.4"}}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l=n(7).VastPlayer,c=n(11),f=n(3),d=f.isImaAd,h=f.isFacebookAd,p=f.isAsiaSmartAd,y=n(5).AD_DONE_REASON;e.exports=function(e){function t(e,n,o,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}(this,i(t).call(this,e,n,o,a))).adOption=null,s.loadPromise=null,s.initUserActionHappened=!1,s.onAdSkipped=o.onAdSkipped,s._onAdError=s._onAdError.bind(u(u(s))),s._init(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,c),a(t,[{key:"name",get:function(){return"VastLinearPlayer"}},{key:"canClickThrough",get:function(){return this.player.isVPAID&&"MOAT"!==this.player.vpaidVendor}},{key:"isFacebookAd",get:function(){return h(this.ad)}},{key:"isAsiaSmartAd",get:function(){return p(this.ad)}},{key:"viewDetailLink",get:function(){return this.player&&this.player.viewDetailLink}}]),a(t,[{key:"canRun",value:function(e){return!d(e)&&"linear"===e.creatives[0].type}},{key:"initUserAction",value:function(){this.initUserActionHappened||(this.initUserActionHappened=!0,this.player.init(),this.logger.debug(this.name,"init user action done"))}},{key:"loadAd",value:function(e,t){return this.ad=e,this.adOption=t,this.loadPromise=this.player.load({ads:[e]}),this.loadPromise}},{key:"start",value:function(){var e=this;this.loadPromise.then(function(){return e.player.startAd()}).catch(this._onAdError)}},{key:"stop",value:function(){var e=this;this.loadPromise.then(function(){return e.player.stopAd()}).catch(this._onAdError)}},{key:"skip",value:function(){var e=this;this.loadPromise.then(function(){return e.player.skipAd()}).catch(this._onAdError)}},{key:"pause",value:function(){var e=this;return this.loadPromise.then(function(){return e.player.pauseAd()}).catch(this._onAdError)}},{key:"resume",value:function(){var e=this;return this.loadPromise.then(function(){return e.player.resumeAd()}).catch(this._onAdError)}},{key:"cancel",value:function(){this.stop()}},{key:"viewDetail",value:function(){var e=this;this.loadPromise.then(function(){if(e.player.isVPAID)try{e.player.__private__.video.click(),e.resume()}catch(t){e.logger.error(e.name,"error while simulate click on VPAID ad",t)}else e.player.emit("AdClickThru",null,null,!0)}).catch(this._onAdError)}},{key:"setVolume",value:function(e){var t=this;this.loadPromise.then(function(){t.player.adVolume=e})}},{key:"getVolume",value:function(){return this.loadPromise?this.player.adVolume:0}},{key:"isPaused",value:function(){return this.player.paused}},{key:"getRemainingTime",value:function(){if(this.isAsiaSmartAd){var e=this.getDuration();return e>0?e-this.getAdCurrentTime():e}return this.player&&this.player.adRemainingTime}},{key:"getDuration",value:function(){return this.player&&this.player.adDuration}},{key:"getAdCurrentTime",value:function(){return Math.floor(this.player.__private__.video.currentTime)}},{key:"getSkipOffset",value:function(){return this.logger.debug(this.name,"skipTimeOffset",this.adOption.skipoffset),this.adOption?this.adOption.skipoffset:-1}},{key:"destroy",value:function(){this.loadPromise&&this.ad&&this.stop(),this.player=null,this.element&&(this.adContainerElement.removeChild(this.element),this.element=null),this.logger.debug(this.name,"destroyed")}},{key:"_init",value:function(){var e=this,t=document.createElement("div"),n=new l(t,{width:e.videoContent.offsetWidth,height:e.videoContent.offsetHeight});t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.zIndex=1,t.setAttribute("data-player",this.name),n.on("AdStarted",function(){return e._onAdStartedEvent()}),n.on("AdStopped",function(){return e._onAdStoppedEvent()}),n.on("AdSkipped",function(){return e._onAdSkippedEvent()}),n.on("AdLoaded",function(){return e._onAdLoadedEvent()}),e.adContainerElement.appendChild(t),e.element=t,e.player=n,e._hide()}},{key:"_show",value:function(){this.element.style.display="block"}},{key:"_hide",value:function(){this.element.style.display="none"}},{key:"_onAdLoadedEvent",value:function(){this.onAdLoaded()}},{key:"_onAdStartedEvent",value:function(){if(this._show(),this.onAdStarted(),this.isFacebookAd)try{this.player.__private__.player.frame.contentDocument.querySelector("#an_skip_button").style.display="none"}catch(e){this.logger.warn(this.name,"failed to remove FB skip button",e)}}},{key:"_onAdStoppedEvent",value:function(e,t){this.loadPromise=null,this._hide(),this.onAdStopped(e,t)}},{key:"_onAdSkippedEvent",value:function(){this.onAdSkipped(),this._onAdStoppedEvent(null,y.skipped)}},{key:"_onAdError",value:function(e){this._onAdStoppedEvent(e)}}]),t}()},function(e,t,n){e.exports=n(54)},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(11),c=n(3).isImaAd,f=n(55),d=n(59),h=n(5).DEFAULT_NON_LINEAR_DURATION;e.exports=function(e){function t(e,n,r,a){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=i(this,o(t).call(this,e,n,r,a))).ad=null,s.adOption=null,s.imgUrl=null,s.adTimer=null,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"VastNonLinearPlayer"}},{key:"selfControl",get:function(){return!0}},{key:"viewDetailLink",get:function(){return this.ad.creatives[0].ads[0].clickThrough}}]),s(t,[{key:"canRun",value:function(e){return!c(e)&&"nonLinear"===e.creatives[0].type}},{key:"initUserAction",value:function(){}},{key:"loadAd",value:function(e,t){this.ad=e,this.adOption=t,this.imgUrl=null;var n=e.creatives[0].ads[0].resources;return n&&this._isValidImageAd(n)?(this.imgUrl=n,this.onAdLoaded(),Promise.resolve()):Promise.reject(new Error("no playable non-linear file"))}},{key:"start",value:function(){this.adTimer&&this.stop();var e=this.ad.creatives[0],t=parseInt(e.ads[0].width),n=parseInt(e.ads[0].height);return this.tracker=new d(this.ad),this.adUi=new f(this,this.videoContent.offsetWidth,this.videoContent.offsetHeight),this.adUi.setImage(this.imgUrl,t,n),this.adContainerElement.appendChild(this.adUi.element),this._onAdStartedEvent(),Promise.resolve()}},{key:"stop",value:function(){this._onAdStoppedEvent()}},{key:"cancel",value:function(){this.stop()}},{key:"viewDetail",value:function(){try{var e=this.viewDetailLink;e&&window.open(e,"_blank")}catch(e){this.logger.error(this.name,"error while showing detail of ad",e)}}},{key:"setVolume",value:function(){}},{key:"getRemainingTime",value:function(){}},{key:"getDuration",value:function(){}},{key:"destroy",value:function(){this._stopAdTimer(),this.adUi&&this.adUi.remove(),this.logger.debug(this.name,"destroyed")}},{key:"_isValidImageAd",value:function(e){return!/\.swf/.test(e)}},{key:"_startAdTimer",value:function(){var e=this;this.adTimer=setTimeout(function(){return e.stop()},1e3*(this.adOption.duration||h))}},{key:"_stopAdTimer",value:function(){clearTimeout(this.adTimer),delete this.adTimer}},{key:"_onAdStartedEvent",value:function(){this._startAdTimer(),this.adUi.show(),this.tracker.onAdStarted(),this.onAdStarted()}},{key:"_onAdStoppedEvent",value:function(){this._stopAdTimer(),this.adUi.remove(),this.tracker.onAdStopped(),this.onAdStopped(null,null,!0,this.adData)}}]),t}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n(56);var l=n(2);e.exports=function(e){function t(e,n,i){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?u(e):t}(this,a(t).call(this,{className:"ad_runner_non_linear_ad_ui"}))).player=e,o.maxWidth=n,o.maxHeight=i,o._onCloseButtonClickEvent=o._onCloseButtonClickEvent.bind(u(u(o))),o._onImageClickEvent=o._onImageClickEvent.bind(u(u(o))),o.render(),o._registerEvents(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),function(e,t,n){t&&i(e.prototype,t)}(t,[{key:"render",value:function(){o(a(t.prototype),"render",this).call(this),this.closeButton=new l({tagName:"span"}),this.closeButton.render(),this.closeButton.html("[x]"),this.closeButton.attr("title","Đóng quảng cáo"),this.appendChild(this.closeButton),this.image=new l({tagName:"img"}),this.image.render(),this.appendChild(this.image)}},{key:"remove",value:function(){this._unregisterEvents(),o(a(t.prototype),"remove",this).call(this)}},{key:"setImage",value:function(e,t,n){(t>this.maxWidth||n>this.maxHeight)&&(this.image.attr("width","auto"),this.image.attr("height","auto"),t>n?this.image.style("max-width","".concat(this.maxWidth-40,"px")):this.image.style("max-height","".concat(this.maxHeight-40,"px"))),this.image.attr("src",e)}},{key:"_registerEvents",value:function(){this.closeButton.on("click",this._onCloseButtonClickEvent),this.image.on("click",this._onImageClickEvent)}},{key:"_unregisterEvents",value:function(){this.closeButton.off("click",this._onCloseButtonClickEvent),this.image.off("click",this._onImageClickEvent)}},{key:"_onCloseButtonClickEvent",value:function(e){e.stopPropagation(),this.player.stop()}},{key:"_onImageClickEvent",value:function(e){e.stopPropagation(),this.player.viewDetail()}}]),t}()},function(e,t,n){var r=n(57);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_non_linear_ad_ui span{position:absolute;top:0;right:0;color:#f9754d;cursor:pointer;padding:2px;font-weight:bold;background-color:white}.ad_runner_non_linear_ad_ui img{cursor:pointer}\n",""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=["start","creativeView"],i=["close"];e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.impressionEvents=[].concat(t.impressions||[],t.viewableImpressions||[]),this.trackingEvents=t.creatives[0].trackingEvents}return function(e,t,r){t&&n(e.prototype,t)}(e,[{key:"onAdStarted",value:function(){var e=this;this.impressionEvents.forEach(function(t){return e._fireEvent(t.uri)}),this._trackEvents(r)}},{key:"onAdStopped",value:function(){this._trackEvents(i)}},{key:"_trackEvents",value:function(e){var t=this;this.trackingEvents.filter(function(t){return e.indexOf(t.event)>-1}).forEach(function(e){return t._fireEvent(e.uri)})}},{key:"_fireEvent",value:function(e){e&&((new Image).src=e)}}]),e}()},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o=n(5),a=o.AD_POSITION,s=o.PRELOAD_DURATION,u=o.COUNT_DOWN_DURATION,l=n(3).createPromiseDefer,c="midroll";function f(e){return e.ads[0]&&"nonLinear"!==e.ads[0].creatives[0].type}e.exports=function(){function e(t){var n=t.prepareAd,r=t.beforePlayAd,i=t.preloadAd,o=t.loadAd,a=t.playAd,s=t.logger;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props={prepareAd:n,beforePlayAd:r,preloadAd:i,loadAd:o,playAd:a,logger:s},this._reset(),this.dataLoadingDeferred=l()}return i(e,[{key:"name",get:function(){return"Scheduler"}},{key:"logger",get:function(){return this.props.logger}}]),i(e,[{key:"populateAdsData",value:function(e){var t=this;e.forEach(function(e){return e.position===a.preroll?t.prerollAds.push(e):e.position===a.postroll?t.postrollAds.push(e):void t.midrollAds.push(e)}),this.midrollAds.sort(function(e,t){return t.startTime>e.startTime?1:-1}),this.prerollAds.length&&this.props.loadAd(this.prerollAds[0]),this.dataLoadingDeferred.resolve()}},{key:"onContentProgress",value:function(e){var t=this;if(this.ignoredFirstFrame){if(!this.state)return this._setState("preroll"),void this.dataLoadingDeferred.promise.then(function(){t._playAds(t.prerollAds).then(function(){t._setState(c)})});if(this.state===c){if(!this.midrollAds.length)return this._setState("postroll");var n=e.current<0?e.total:e.current,r=this._getAdsPriorTime(this.midrollAds,n),i=this._getAdsPriorTime(this.midrollAds,n+s);if(i.length&&this.props.preloadAd(i[0]),r.length)this.midrollAds.splice(this.midrollAds.length-r.length,r.length),this.props.beforePlayAd(f(r[0]),function(){t._playAds(r)});else{var o=this._getAdsPriorTime(this.midrollAds,n+u);if(o.length){var a=o[0].startTime-n;this.props.prepareAd(o[0],a)}}}}else this.ignoredFirstFrame=!0}},{key:"onContentEnded",value:function(){this.midrollAds.length&&this.logger.warn(this.name,"cannot play these mid-roll ads because start time is too late",this.midrollAds),this._playAds(this.postrollAds),this._reset()}},{key:"_reset",value:function(){this.ignoredFirstFrame=!1,this._setState(null),this.prerollAds=[],this.midrollAds=[],this.postrollAds=[]}},{key:"_setState",value:function(e){this.logger.info(this.name,"state changed from ".concat(this.state," to ").concat(e)),this.state=e}},{key:"_playAds",value:function(e){var t=this,n=[],r=[];return e.forEach(function(e){f(e)?n.push(e):r.push(e)}),this._playAd(n).then(function(){return t._playAd(r)})}},{key:"_playAd",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e[n];if(r){var i={order:n+1,total:e.length};return this.props.playAd(r,i).catch(function(){}).then(function(){return t._playAd(e,n+1)})}return Promise.resolve()}},{key:"_getAdsPriorTime",value:function(e,t){for(var n=e.length-1;n>-1&&t>e[n].startTime;)--n;return e.slice(n+1).reverse()}}]),e}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2),f=n(18),d=n(64),h=n(3),p=n(79),y=n(82);n(85);var g="is_mobile";e.exports=function(e){function t(e,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this))).options=e,i.adContainers=n,i.$adContainer=new c({element:n.linear}),i.$adContainer.render(),i.adPlayer=null,i.adPaused=!1,i.adVolume=0,i.adVolumeCached=1,i.mouseEntered=!1,i._onClick=i._onClick.bind(l(l(i))),i._onMouseEnter=i._onMouseEnter.bind(l(l(i))),i._onMouseLeave=i._onMouseLeave.bind(l(l(i))),i._onSkipBtnClick=i._onSkipBtnClick.bind(l(l(i))),i._onViewDetailBtnClick=i._onViewDetailBtnClick.bind(l(l(i))),i.render(),i._registerEvents(),i.control.hide(),h.isMobile()&&(i.addClass(g),i.$adContainer.off("mouseenter",i._onMouseEnter),i.$adContainer.off("mouseleave",i._onMouseLeave)),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"name",get:function(){return"ad_runner_ui"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){return i(o(t.prototype),"render",this).call(this),this.hide(),this.$uiLoading=new c({className:"ad_runner_ui_loading"}),this.$uiLoading.render(),this.$uiLoading.element.textContent="Đang tải quảng cáo...",this.$uiLoading.hide(),this.$uiViewDetail=new c({className:"ad_runner_ui_viewdetail"}),this.$uiViewDetail.render(),this.$uiViewDetail.element.textContent="Xem chi tiết quảng cáo",this.$uiAdIndex=new c({className:"ad_runner_ui_adindex"}),this.$uiAdIndex.render(),this.$uiAdIndex.hide(),this.countdownToPlay=new f({template:"Quảng cáo hiển thị sau %ss",className:"ad_runner_ui_countdown_to_play"}),this.countdownToPlay.hide(),this.skipButton=new p({getPoster:this.options.getPoster}),this.control=new d(this),this.slideBlack=new y(this),this.appendChild(this.$uiViewDetail),this.appendChild(this.$uiAdIndex),this.appendChild(this.skipButton),this.appendChild(this.control),this.$adContainer.appendChild(this),this.adContainers.notification.appendChild(this.countdownToPlay.element),this.adContainers.notification.appendChild(this.$uiLoading.element),this.adContainers.notification.appendChild(this.slideBlack.element),this}},{key:"remove",value:function(){this._unregisterEvents(),this._stopSkipTimer(),this._stopProgressTimer(),this.skipButton.remove(),this.countdownToPlay.remove(),this.control.remove(),this.$uiLoading.remove(),this.slideBlack.remove(),i(o(t.prototype),"remove",this).call(this)}},{key:"setPlayer",value:function(e){this.adPlayer=e}},{key:"togglePlayPause",value:function(){this.adPlayer.isPaused()?(this.adPlayer.resume(),this._onPauseStateChanged(!1)):(this.adPlayer.pause(),this._onPauseStateChanged(!0))}},{key:"toggleMute",value:function(){var e=this.adPlayer.getVolume(),t=e?0:this.adVolumeCached;this.adPlayer.setVolume(t),this._onVolumeChanged(t),this.adVolumeCached=e}},{key:"onAdWillStart",value:function(){this.show(),this.$uiLoading.show(),this.$uiViewDetail.hide(),this.$uiAdIndex.hide(),this.skipButton.hide(),this.skipButton.loadPoster(),this.countdownToPlay.hide()}},{key:"onAdStarted",value:function(e){if(this.adPlayer.selfControl)return this.$uiLoading.hide(),void this.hide();this.adPlayer.canClickThrough?this.addClass("click-through"):this.removeClass("click-through"),this.adPlayer.isFacebookAd?this.addClass("facebook-ad"):this.removeClass("facebook-ad"),this.adPlayer.isGoogleImaAd?this.addClass("google-ima-ad"):this.removeClass("google-ima-ad"),this.$uiLoading.hide(),this.$uiViewDetail.show(),e&&e.total>1&&(this.$uiAdIndex.show(),this.$uiAdIndex.html("Quảng cáo ".concat(e.order," / ").concat(e.total))),this._startProgressTimer(),this.adPlayer.getSkipOffset()>-1&&(this.skipButton.show(),this.skipButton.update(this._getTimeToSkip()||5),this._startSkipTimer()),this._onVolumeChanged(this.adPlayer.getVolume())}},{key:"onAdStopped",value:function(){this._stopSkipTimer(),this._stopProgressTimer(),this.$uiLoading.hide(),this.hide()}},{key:"_registerEvents",value:function(){this.on("click",this._onClick),this.$adContainer.on("mouseenter",this._onMouseEnter),this.$adContainer.on("mouseleave",this._onMouseLeave),this.skipButton.on("click",this._onSkipBtnClick),this.$uiViewDetail.on("click",this._onViewDetailBtnClick)}},{key:"_unregisterEvents",value:function(){this.off("click",this._onClick),this.$adContainer.off("mouseenter",this._onMouseEnter),this.$adContainer.off("mouseleave",this._onMouseLeave),this.skipButton.off("click",this._onSkipBtnClick),this.$uiViewDetail.off("click",this._onViewDetailBtnClick)}},{key:"_startProgressTimer",value:function(){var e=this;this.progressTimer=setInterval(function(){var t={duration:e.adPlayer.getDuration(),remaining:e.adPlayer.getRemainingTime(),paused:e.adPlayer.isPaused()};e.control.onProgress(t);var n=e.adPlayer.getVolume();t.paused!==e.adPaused&&e._onPauseStateChanged(t.paused),n!==e.adVolume&&e._onVolumeChanged(n)},1e3)}},{key:"_stopProgressTimer",value:function(){clearInterval(this.progressTimer),this.progressTimer=null}},{key:"_startSkipTimer",value:function(){var e=this;this._stopSkipTimer();var t=this._getTimeToSkip();this.skipTimer=setInterval(function(){var n=e._getTimeToSkip();e.adPlayer.isPaused()||(t-=1),n<=0||n-t>e.options.skipTimeout?(e.skipButton.skipOn(),e._stopSkipTimer()):e.skipButton.update(n)},1e3)}},{key:"_stopSkipTimer",value:function(){this.skipTimer&&(clearInterval(this.skipTimer),this.skipTimer=null)}},{key:"_getTimeToSkip",value:function(){var e=this.adPlayer.getSkipOffset()+this.adPlayer.getRemainingTime()-this.adPlayer.getDuration();return e<0?5:e}},{key:"_onSkipBtnClick",value:function(e){var t=this;e.stopPropagation(),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=arguments.length>2?arguments[2]:void 0;e.style.opacity||(e.style.opacity=1);var r=null;window.requestAnimationFrame(function i(o){var a=o-(r=r||o),s=parseFloat(1-a/t,2);e.style.opacity=s<0?0:s,a>t?"function"==typeof n&&n():window.requestAnimationFrame(i)})}(this.adPlayer.element,300,function(){t.adPlayer.skip(),t.adPlayer.element.style.opacity=null})}},{key:"_onViewDetailBtnClick",value:function(e){e.stopPropagation(),this.adPlayer.viewDetail()}},{key:"_onClick",value:function(){this.togglePlayPause()}},{key:"_onMouseEnter",value:function(){this.mouseEntered=!0,!this.adPaused&&this.control.show()}},{key:"_onMouseLeave",value:function(){this.mouseEntered=!1,!this.adPaused&&this.control.hide()}},{key:"_onPauseStateChanged",value:function(e){this.adPaused=e,this.control.onPauseStateChanged(e,this.mouseEntered)}},{key:"_onVolumeChanged",value:function(e){this.adVolume=e,this.control.onMuteStateChanged(0===e)}}]),t}()},function(e,t,n){var r=n(63);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_countdown{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;top:10px;left:10px}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(2),c=n(65),f=n(68),d=n(71),h=n(74);n(77),e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,o(t).call(this))).adUi=e,n.render(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"ad_runner_ui_control"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"show",value:function(){this.playpause.show(),this.volume.show(),this.timer.show(),this.removeClass("minimized"),this.adUi.addClass("has_control")}},{key:"hide",value:function(){this.playpause.hide(),this.volume.hide(),this.timer.hide(),this.addClass("minimized"),this.adUi.removeClass("has_control")}},{key:"remove",value:function(){this.timeline.remove(),this.playpause.remove(),this.volume.remove(),this.timer.remove(),i(o(t.prototype),"remove",this).call(this)}},{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.timeline=new c,this.playpause=new f(this.adUi),this.timer=new h,this.volume=new d(this.adUi),this.appendChild(this.timeline),this.appendChild(this.playpause),this.appendChild(this.timer),this.appendChild(this.volume)}},{key:"onProgress",value:function(e){e.paused||(this.timeline.setPosition((e.duration-e.remaining)/e.duration*100),this.timer.update(e))}},{key:"onPauseStateChanged",value:function(e,t){e?this.show():t||this.hide(),this.playpause.onPauseStateChanged(e)}},{key:"onMuteStateChanged",value:function(e){this.volume.onMuteStateChanged(e)}}]),t}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(2);n(66),e.exports=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,o(t).call(this))).render(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"ad_runner_ui_timeline"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.$uiProgress=new l,this.$uiProgress.render(),this.appendChild(this.$uiProgress)}},{key:"setPosition",value:function(e){e<=100&&this.$uiProgress.style("width","".concat(e,"%"))}}]),t}()},function(e,t,n){var r=n(67);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_timeline{bottom:0;height:4px;left:0;position:absolute;width:100%}.ad_runner_ui_timeline>div{-webkit-transition:width 1s linear;-moz-transition:width 1s linear;-o-transition:width 1s linear;transition:width 1s linear;background-color:#ffff00;height:100%;width:0%}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2);n(69);var f='<svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%"><path d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z"></path></svg>';e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this))).adUi=e,n._onClickEvent=n._onClickEvent.bind(l(l(n))),n.render(),n._registerEvents(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"name",get:function(){return"ad_runner_ui_playpause"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.html(f)}},{key:"remove",value:function(){this._unregisterEvents(),i(o(t.prototype),"remove",this).call(this)}},{key:"onPauseStateChanged",value:function(e){e?this.html('<svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%"><path d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z"></path></svg>'):this.html(f)}},{key:"_registerEvents",value:function(){this.on("click",this._onClickEvent)}},{key:"_unregisterEvents",value:function(){this.off("click",this._onClickEvent)}},{key:"_onClickEvent",value:function(e){e.stopPropagation(),this.adUi.togglePlayPause()}}]),t}()},function(e,t,n){var r=n(70);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_playpause{width:35px;height:35px;float:left;margin-left:5px}.ad_runner_ui_playpause:hover{cursor:pointer}.ad_runner_ui_playpause>svg{fill:#f5f5f5}.ad_runner_ui_playpause:hover>svg,.ad_runner_ui_playpause:active>svg{fill:#ffffff}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2);n(72);var f='<svg height="100%" viewBox="0 0 36 36" width="100%"><path d="M8,21 L12,21 L17,26 L17,10 L12,15 L8,15 L8,21 Z M19,14 L19,22 C20.48,21.32 21.5,19.77 21.5,18 C21.5,16.26 20.48,14.74 19,14 Z M19,11.29 C21.89,12.15 24,14.83 24,18 C24,21.17 21.89,23.85 19,24.71 L19,26.77 C23.01,25.86 26,22.28 26,18 C26,13.72 23.01,10.14 19,9.23 L19,11.29 Z"></path></svg>';e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this)))._onClickEvent=n._onClickEvent.bind(l(l(n))),n.adUi=e,n.render(),n._registerEvents(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"name",get:function(){return"ad_runner_ui_volume"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.html(f)}},{key:"remove",value:function(){this._unregisterEvents(),i(o(t.prototype),"remove",this).call(this)}},{key:"onMuteStateChanged",value:function(e){e?this.html('<svg height="100%" viewBox="0 0 36 36" width="100%"><path d="m16.98686,9.984l0,4.219l-2.109,-2.109l2.109,-2.11zm-7.734,-0.984l16.734,16.734l-1.266,1.266l-2.063,-2.063c-1.078,0.844 -2.297,1.5 -3.656,1.828l0,-2.063c0.844,-0.234 1.594,-0.656 2.25,-1.172l-4.266,-4.266l0,6.75l-5.016,-5.016l-3.984,0l0,-6l4.734,0l-4.734,-4.734l1.267,-1.264zm14.718,9c0,-3.188 -2.063,-5.859 -4.969,-6.703l0,-2.063c4.031,0.891 6.984,4.5 6.984,8.766c0,1.5 -0.375,2.953 -1.031,4.172l-1.5,-1.547c0.328,-0.797 0.516,-1.688 0.516,-2.625zm-2.484,0c0,0.234 0,0.422 -0.047,0.609l-2.438,-2.438l0,-2.203c1.5,0.75 2.484,2.25 2.484,4.031l0.001,0.001z"></path></svg>'):this.html(f)}},{key:"_registerEvents",value:function(){this.on("click",this._onClickEvent)}},{key:"_unregisterEvents",value:function(){this.off("click",this._onClickEvent)}},{key:"_onClickEvent",value:function(e){e.stopPropagation(),this.adUi.toggleMute()}}]),t}()},function(e,t,n){var r=n(73);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_volume{width:35px;height:35px;float:right;margin-right:5px}.ad_runner_ui_volume:hover{cursor:pointer}.ad_runner_ui_volume>svg{fill:#f5f5f5}.ad_runner_ui_volume:hover>svg,.ad_runner_ui_volume:active>svg{fill:#ffffff}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=n(2),c=n(3).formatTime;n(75),e.exports=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,o(t).call(this))).render(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,l),s(t,[{key:"name",get:function(){return"ad_runner_ui_timer"}},{key:"attributes",get:function(){return{class:this.name}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.html("00:00 / 00:00")}},{key:"update",value:function(e){var t=c(e.duration-e.remaining),n=c(e.duration);this.html("".concat(t," / ").concat(n))}}]),t}()},function(e,t,n){var r=n(76);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_timer{color:#f5f5f5;float:left;margin-left:5px;height:35px;line-height:35px;font-size:12px}\n",""])},function(e,t,n){var r=n(78);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_control{-webkit-transition:height 100ms ease;-moz-transition:height 100ms ease;-o-transition:height 100ms ease;transition:height 100ms ease;background:linear-gradient(transparent, #000);bottom:0;height:40px;left:0;position:absolute;width:100%;pointer-events:none}.ad_runner_ui_control.minimized{background:none;height:5px}.ad_runner_ui_control>*{pointer-events:auto}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=n(2),f=n(18);n(80),e.exports=function(e){function t(e){var n,i=e.getPoster;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}(this,o(t).call(this)))._onPosterLoad=n._onPosterLoad.bind(l(l(n))),n.render(),n._registerEvents(),n.getPoster=i,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,c),s(t,[{key:"attributes",get:function(){return{class:"ad_runner_ui_skip_button"}}}]),s(t,[{key:"render",value:function(){i(o(t.prototype),"render",this).call(this),this.countdown=new f({template:"Bỏ qua quảng cáo sau %ss",className:"countdown"}),this.countdown.render(),this.update=this.countdown.update.bind(this.countdown),this.skipText=new c({className:"skip_text"}),this.skipText.render(),this.skipText.element.textContent="Bỏ qua",this.poster=new c({tagName:"img"}),this.poster.render(),this.poster.hide(),this.playIcon=new c({className:"play_icon"}),this.playIcon.render(),this.playIcon.html('<svg viewBox="12 12 24 24"><style type="text/css"> .st1{fill:none;stroke:#f1f1f1;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;} </style><g><g><path class="st1" d="M21.88173,28.00095l6.30217-3.67922c0.24333-0.14206,0.24348-0.49362,0.00028-0.63589l-6.30217-3.68663 c-0.2455-0.14361-0.5542,0.03345-0.5542,0.31786v7.36585C21.32781,27.9672,21.63623,28.14428,21.88173,28.00095z"/><circle class="st1" cx="24" cy="24" r="11.1667"/></g></g></svg>'),this.appendChild(this.skipText),this.appendChild(this.countdown),this.appendChild(this.poster),this.appendChild(this.playIcon)}},{key:"show",value:function(){i(o(t.prototype),"show",this).call(this),this.skipText.hide(),this.countdown.show(),this.removeClass("skippable")}},{key:"hide",value:function(){i(o(t.prototype),"hide",this).call(this),this.poster.hide(),this.removeClass("has_poster")}},{key:"remove",value:function(){this._unregisterEvents(),this.countdown.remove(),this.poster.remove(),this.skipText.remove(),this.playIcon.remove(),i(o(t.prototype),"remove",this).call(this)}},{key:"loadPoster",value:function(){var e=this;this.getPoster&&this.getPoster().then(function(t){e.poster.attr("src",t)})}},{key:"skipOn",value:function(){this.skipText.show(),this.countdown.hide(),this.addClass("skippable")}},{key:"_onPosterLoad",value:function(){this.poster.show(),this.addClass("has_poster")}},{key:"_registerEvents",value:function(){this.poster.on("load",this._onPosterLoad)}},{key:"_unregisterEvents",value:function(){this.poster.off("load",this._onPosterLoad)}}]),t}()},function(e,t,n){var r=n(81);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runner_ui_skip_button{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;-webkit-transition:bottom 100ms ease;-moz-transition:bottom 100ms ease;-o-transition:bottom 100ms ease;transition:bottom 100ms ease;background-color:#2b2a2a;align-items:center;border:1px solid rgba(72,72,72,0.4);bottom:35px;display:flex;height:42px;padding:0;pointer-events:none !important;right:0px;text-align:center}.ad_runner_ui_skip_button.skippable{pointer-events:auto !important;cursor:pointer}.ad_runner_ui_skip_button .countdown{padding:5px;max-width:100px}.ad_runner_ui_skip_button .skip_text{font-size:13px;width:100px}.ad_runner_ui_skip_button .play_icon{position:absolute;width:65px;height:30px;right:0;display:none}.ad_runner_ui_skip_button .play_icon svg{width:30px;height:30px}.ad_runner_ui_skip_button.skippable.has_poster .play_icon{display:block}.ad_runner_ui_skip_button img{height:38px;object-fit:cover;width:65px}.is_mobile .ad_runner_ui_skip_button{width:170px;justify-content:center}.is_mobile .ad_runner_ui_skip_button .countdown{max-width:120px}.ad_runner_ui.facebook-ad .ad_runner_ui_skip_button{background-color:#000}.ad_runner_ui.has_control .ad_runner_ui_skip_button{bottom:35px}\n",""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n(83);var u=n(2);e.exports=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a(t).call(this,{className:"ad_runners_ui_slide_black"}))).render(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,u),function(e,t,n){t&&i(e.prototype,t)}(t,[{key:"fadeIn",value:function(){this.addClass("ad_ui_slide_black_fade_in")}},{key:"fadeOut",value:function(){this.removeClass("ad_ui_slide_black_fade_in")}},{key:"render",value:function(){o(a(t.prototype),"render",this).call(this),this.html('<span class="ad_message_text">Video nội dung sẽ tiếp tục sau đoạn quảng cáo</span>'),this.hide()}}]),t}()},function(e,t,n){var r=n(84);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runners_ui_slide_black{position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;background-color:#000;opacity:0;-webkit-transition:opacity .3s linear;-moz-transition:opacity .3s linear;-o-transition:opacity .3s linear;transition:opacity .3s linear}.ad_runners_ui_slide_black.ad_ui_slide_black_fade_in{opacity:1}.ad_runners_ui_slide_black .ad_message_text{color:#eee;font-size:13px;position:absolute;left:10px;bottom:10px}\n",""])},function(e,t,n){var r=n(86);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,'.ad_runner_ui{left:0px;position:absolute;top:0px;width:100%;height:100%;z-index:2}.ad_runner_ui.click-through{pointer-events:none}.ad_runner_ui.click-through>*{pointer-events:auto}.ad_runner_ui.click-through .ad_runner_ui_viewdetail{display:none}.ad_runner_ui .ad_runner_ui_viewdetail{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAA2ElEQVQ4ja2U0U3DMBRFz0MM0BkyQleo2CAVm7ACYoaOUDagjJBs0G6A6AaHjzhSVcXGDtw/289H9z1fGbVXv83rCKBuCzWqwwPwBmz4D92Qt433+iVnawz0wDEtr/N+Myx1cEjLE/C6CpZAn0wzPkXE0+15New3UDXsDjQC+1xh8TVTvuYcDmo+RiVYEwh4bGhtFxHXTN0z8LXoTO3Uc40j9SUb2gT9ALqSo6o2I2JUR6ZkV4MWYQm4V7sWEBRyFhGXFlARtkahnpmG/Ve9z/9S6aet0aB2P+baSzgLyi9XAAAAAElFTkSuQmCC");background-position-x:calc(100% - 5px);background-position-y:center;background-repeat:no-repeat;background-size:12px;cursor:pointer;padding-right:20px;right:10px;top:10px}.ad_runner_ui .ad_runner_ui_adindex{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;background-color:transparent;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAjVJREFUOBHlVEFrU0EQ/mb35TVtqqRKq0LaXhRbxbMggh5UKioePQserEcP4smjoHjoTUERvAi9eCmC9A+UCqJQJIJ6KAhNqlBLNE3y8nb89iV5SbB66bEDYb/9ZufLzOy8BXadia84Wi/MOCezgE6rYoTkEEQy3Bu6hZxfScFxUSIH1YigSm6D+6Ix+jgz9u2NROWJ87Fziz5gp2aNuWCcczd3KtSJ91oGghMdorPa4bsIR5eQ2b8IM3itQ8OEZ8ktIBwrIsg/B8xo6ksAtdgb6WNt7hZsbhZxdR4arSDY+xASngbsOEWesIMNxL/mKH6Svvv9gtQKyOR6WZO9TKFlxL/nSFuE2Yuw2Stw0QeIySHavAONv/JOfkLsZG+oxzkKqhdNTYKjcLWF9j6GuhI8J1pJOHXfk9VtzacxXaCBHwc/Cl2Ly+zCnnQvxOrWeWqzxclga7UF/tF0eq4NnOFU1XtZx3JNeIqHp2AGZljWQbZtmSW/S47Z7FV2YgLhyEv28EFvqJ/QutRK4yU25EDqkTxv8hVMcCShtLmKxo8zxDEFHsEOtW5dXQXRxvWk391YKUt9rVDkxE+lZBtIcJwZnoMdvo1m5R5c9UXiEXuY47IP2lxhRlt9YfzCPgX8nj4zw78EtfkRMX8uesuS36eBGn/xyW5v1DIKebq9t8VqY4mg9r8jqc9rJY9DbW3ykoi7wUyPqSCfPA6QAdb078cBWk8eB+XjIFJUNc+yh1Zfp+q7B/wBa0XJ8tc9BKoAAAAASUVORK5CYII=");background-position-y:center;background-repeat:no-repeat;bottom:50px;left:15px;padding-left:25px;text-shadow:0 0 4px #000}.ad_runner_ui_countdown_to_play{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;top:10px;left:10px;z-index:1}.ad_runner_ui_loading{background-color:rgba(0,0,0,0.4);color:#eee;font-size:12px;height:auto;line-height:18px;padding:5px;position:absolute;width:auto;top:10px;left:10px}.ad_runner_ui_hide{display:none !important}\n',""])},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n(88);var l=n(2);e.exports=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}(this,u(t).call(this,{className:"ad_runners_ui_ad_mark_container"})),s(u(t.prototype),"render",o(n)).call(o(n)),n.containerElement=e,e&&e.appendChild(n.element),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,l),function(e,t,n){t&&i(e.prototype,t)}(t,[{key:"render",value:function(e,t){var n=this;this.containerElement&&t.forEach(function(t){var r=100*t.startTime/e;if(0<=r&&r<=100){var i=n._createAdMarkItem(r);n.appendChild(i),t.adMarkItem=i,t._completeAd=function(){i.remove()}}})}},{key:"removeMarkItems",value:function(){this.html("")}},{key:"setContainer",value:function(e){e.appendChild(this.element)}},{key:"_createAdMarkItem",value:function(e){var t=document.createElement("span");return t.setAttribute("class","ad_runners_ui_ad_mark_container_item"),t.style.left="".concat(e,"%"),t}}]),t}()},function(e,t,n){var r=n(89);"string"==typeof r&&(r=[[e.i,r,""]]),n(1)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(0)(!1)).push([e.i,".ad_runners_ui_ad_mark_container{display:flex !important;width:100%;height:100%}.ad_runners_ui_ad_mark_container .ad_runners_ui_ad_mark_container_item{height:100%;width:5px;background-color:yellow;display:block;position:relative}\n",""])}])},function(e,t,n){"use strict";(function(e){"function"!=typeof e.Promise&&(e.Promise=n(2))}).call(this,n(3))},function(e,t,n){"use strict";(function(t){var n,r,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,a=new i(c),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var u=new t.MessageChannel;u.port1.onmessage=c,n=function(){u.port2.postMessage(0)}}var l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}e.exports=function(e){1!==l.push(e)||r||n()}}).call(this,n(3))},function(e,t,n){var r=n(8);Object.getOwnPropertySymbols||(Object.getOwnPropertySymbols=r)},function(e,t,n){(function(t){!function(e,n){"use strict";if(!(n in e)){var r,i=typeof t==typeof i?window:t,o=0,a=""+Math.random(),s="__symbol:",u=s.length,l="__symbol@@"+a,c="defineProperty",f="defineProperties",d="getOwnPropertyNames",h="getOwnPropertyDescriptor",p="propertyIsEnumerable",y=e[d],g=e[h],v=e.create,m=e.keys,b=e.freeze||e,_=e[c],E=e[f],k=g(e,d),A=e.prototype,w=A.hasOwnProperty,T=A[p],S=A.toString,P=function(e,t,n){w.call(e,l)||_(e,l,{enumerable:!1,configurable:!1,writable:!1,value:{}}),e[l]["@@"+t]=n},O=function(){},L=function(e){return e!=l&&!w.call(x,e)},R=function(e){return e!=l&&w.call(x,e)},C=function(e){var t=""+e;return R(t)?w.call(this,t)&&this[l]["@@"+t]:T.call(this,e)},D=function(t){return _(A,t,{enumerable:!1,configurable:!0,get:O,set:function(e){r(this,t,{enumerable:!1,configurable:!0,writable:!0,value:e}),P(this,t,!0)}}),b(x[t]=_(e(t),"constructor",M))},I=function e(t){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return D(s.concat(t||"",a,++o))},x=v(null),M={value:I},F=function(e){return x[e]},N=function(e,t,n){var i=""+t;return R(i)?(r(e,i,n.enumerable?function(e){var t=v(e);return t.enumerable=!1,t}(n):n),P(e,i,!!n.enumerable)):_(e,t,n),e},U=function(e){return y(e).filter(R).map(F)};k.value=N,_(e,c,k),k.value=U,_(e,n,k),k.value=function(e){return y(e).filter(L)},_(e,d,k),k.value=function(e,t){var n=U(t);return n.length?m(t).concat(n).forEach(function(n){C.call(t,n)&&N(e,n,t[n])}):E(e,t),e},_(e,f,k),k.value=C,_(A,p,k),k.value=I,_(i,"Symbol",k),k.value=function(e){var t=s.concat(s,e,a);return t in A?x[t]:D(t)},_(I,"for",k),k.value=function(e){if(L(e))throw new TypeError(e+" is not a symbol");if(w.call(x,e)){var t=e.slice(u);if(t.slice(0,u)===s&&(t=t.slice(u))!==a)return(t=t.slice(0,t.length-a.length)).length>0?t:void 0}},_(I,"keyFor",k),k.value=function(e,t){var n=g(e,t);return n&&R(t)&&(n.enumerable=C.call(e,t)),n},_(e,h,k),k.value=function(e,t){return 1===arguments.length||void 0===t?v(e):function(e,t){var n=v(e);return y(t).forEach(function(e){C.call(t,e)&&N(n,e,t[e])}),n}(e,t)},_(e,"create",k),k.value=function(){var e=S.call(this);return"[object String]"===e&&R(this)?"[object Symbol]":e},_(A,"toString",k);try{if(!0!==v(_({},s,{get:function(){return _(this,s,{value:!0})[s]}}))[s])throw"IE11";r=_}catch(e){r=function(e,t,n){var r=g(A,t);delete A[t],_(e,t,n),_(A,t,r)}}}}(Object,"getOwnPropertySymbols"),function(e,t){"use strict";var n,r=e.defineProperty,i=e.prototype,o=i.toString,a="toStringTag";["iterator","match","replace","search","split","hasInstance","isConcatSpreadable","unscopables","species","toPrimitive",a].forEach(function(s){if(!(s in t))switch(r(t,s,{value:t(s)}),s){case a:(n=e.getOwnPropertyDescriptor(i,"toString")).value=function(){var e=o.call(this),n=null!=this?this[t.toStringTag]:this;return null==n?e:"[object "+n+"]"},r(i,"toString",n)}})}(Object,Symbol),function(e,t,n){function r(){return this}t[e]||(t[e]=function(){var t=0,n=this,i={next:function(){var e=n.length<=t;return e?{done:e}:{done:e,value:n[t++]}}};return i[e]=r,i}),n[e]||(n[e]=function(){var t=String.fromCodePoint,n=this,i=0,o=n.length,a={next:function(){var e=o<=i,r=e?"":t(n.codePointAt(i));return i+=r.length,e?{done:e}:{done:e,value:r}}};return a[e]=r,a})}(Symbol.iterator,Array.prototype,String.prototype),e.exports=Object.getOwnPropertySymbols}).call(this,n(3))},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){var r={"./blue.scss":[33,1],"./green.scss":[34,2],"./light_blue.scss":[35,3],"./purple.scss":[36,4],"./red.scss":[37,5]};function i(e){var t=r[e];return t?n.e(t[1]).then(function(){var e=t[0];return n.t(e,7)}):Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}i.keys=function(){return Object.keys(r)},i.id=23,e.exports=i},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"cloneDeep",function(){return W}),n.d(r,"getDeep",function(){return q}),n.d(r,"each",function(){return $}),n.d(r,"extend",function(){return Q}),n.d(r,"objValuesToArray",function(){return J});var i={};n.r(i),n.d(i,"hasClass",function(){return le}),n.d(i,"addClass",function(){return ce}),n.d(i,"removeClass",function(){return fe}),n.d(i,"toggleClass",function(){return de}),n.d(i,"setClass",function(){return he}),n.d(i,"setStyles",function(){return pe}),n.d(i,"isEl",function(){return ye}),n.d(i,"isTextNode",function(){return ge}),n.d(i,"emptyEl",function(){return ve}),n.d(i,"normalizeContent",function(){return me}),n.d(i,"appendContent",function(){return be}),n.d(i,"insertContent",function(){return _e}),n.d(i,"textContent",function(){return Ee}),n.d(i,"createEl",function(){return ke}),n.d(i,"createElFromHTML",function(){return Ae}),n.d(i,"getAttribute",function(){return we}),n.d(i,"setAttribute",function(){return Te}),n.d(i,"removeAttribute",function(){return Se}),n.d(i,"findPosition",function(){return Pe}),n.d(i,"isOnViewport",function(){return Oe}),n.d(i,"getPointerPosition",function(){return Le}),n.d(i,"isSingleLeftClick",function(){return Re}),n.d(i,"removeFromDom",function(){return Ce});var o={};n.r(o),n.d(o,"IS_IPAD",function(){return at}),n.d(o,"IS_IPHONE",function(){return st}),n.d(o,"IS_IPOD",function(){return ut}),n.d(o,"IS_IOS",function(){return lt}),n.d(o,"IOS_VERSION",function(){return ct}),n.d(o,"IS_ANDROID",function(){return ft}),n.d(o,"ANDROID_VERSION",function(){return dt}),n.d(o,"IS_NATIVE_ANDROID",function(){return ht}),n.d(o,"IS_FIREFOX",function(){return pt}),n.d(o,"IS_EDGE",function(){return yt}),n.d(o,"IS_CHROME",function(){return gt}),n.d(o,"CHROME_VERSION",function(){return vt}),n.d(o,"IE_VERSION",function(){return mt}),n.d(o,"IS_SAFARI",function(){return bt}),n.d(o,"IS_ANY_SAFARI",function(){return _t}),n.d(o,"IS_MOBILE",function(){return Et});var a={};n.r(a),n.d(a,"createPromiseDefer",function(){return kt});var s={};n.r(s),n.d(s,"orderBy",function(){return Bt}),n.d(s,"whereBy",function(){return Yt}),n.d(s,"average",function(){return Gt}),n.d(s,"findWithAttr",function(){return Vt});var u={};n.r(u),n.d(u,"getHours",function(){return Br}),n.d(u,"getMinutes",function(){return Yr}),n.d(u,"getSeconds",function(){return Gr}),n.d(u,"getCurrentTimeSeconds",function(){return Vr}),n.d(u,"formatTime",function(){return Hr});var l={};n.r(l),n.d(l,"format",function(){return Jo}),n.d(l,"escapeHtml",function(){return Zo}),n.d(l,"trimHtml",function(){return ea}),n.d(l,"trimAccents",function(){return ta}),n.d(l,"startsWith",function(){return na}),n.d(l,"endsWith",function(){return ra}),n.d(l,"generateId",function(){return ia}),n.d(l,"getPercentage",function(){return oa}),n.d(l,"replaceAll",function(){return aa}),n.d(l,"toTitleCase",function(){return sa}),n.d(l,"toPascalCase",function(){return ua}),n.d(l,"toCamelCase",function(){return la}),n.d(l,"stripHTML",function(){return ca}),n.d(l,"getHTML",function(){return fa});var c={};n.r(c),n.d(c,"checkAdBlocker",function(){return rs});var f={};n.r(f),n.d(f,"fetchUrl",function(){return is});var d={};n.r(d),n.d(d,"fadeOut",function(){return Iu}),n.d(d,"fadeIn",function(){return xu});n(5),n(7);var h={};function p(e){return h[e]||(h[e]=0),e+ ++h[e]}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g="font-weight: bold; font-size: 13px;",v="color: #ff8000;"+g,m="color: #ff0000;"+g,b=1,_=4,E=["color: #0000ff;font-weight: bold; font-size: 13px;","color: #006600;font-weight: bold; font-size: 13px;",v,m,m],k=["debug","info","warn","error","disabled"],A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.offLevel=n}var t,n;return t=e,(n=[{key:"debug",value:function(e){this.log(e,0,Array.prototype.slice.call(arguments,1))}},{key:"info",value:function(e){this.log(e,b,Array.prototype.slice.call(arguments,1))}},{key:"warn",value:function(e){this.log(e,2,Array.prototype.slice.call(arguments,1))}},{key:"error",value:function(e){this.log(e,3,Array.prototype.slice.call(arguments,1))}},{key:"onOff",value:function(){this.level===this.offLevel?this.level=this.previousLevel:(this.previousLevel=this.level,this.level=this.offLevel),window.console&&window.console.log&&window.console.log("%c[Zplayer.Log] set log level to "+k[this.level],v)}},{key:"level",value:function(e){this.level=e}},{key:"log",value:function(e,t,n){if(!(t<this.level)){n||(n=e,e=null);var r=E[t],i="";e&&(i="["+e+"]"),window.console&&window.console.log&&window.console.log.apply(console,["%c["+k[t]+"]"+i,r].concat(n))}}}])&&y(t.prototype,n),e}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}A.LEVEL_DEBUG=0,A.LEVEL_INFO=b,A.LEVEL_WARN=2,A.LEVEL_ERROR=3,A.LEVEL_DISABLED=_,A.getInstance=function(){return void 0===this._instance&&(this._instance=new this,this._instance.previousLevel=this._instance.level,this._instance.level=this._instance.offLevel),this._instance},A.setLevel=function(e){this.getInstance().level=e},A.debug=function(){this.getInstance().debug.apply(this.getInstance(),arguments)},A.info=function(){this.getInstance().info.apply(this.getInstance(),arguments)},A.warn=function(){this.getInstance().warn.apply(this.getInstance(),arguments)},A.error=function(){this.getInstance().error.apply(this.getInstance(),arguments)};var S=Array.prototype.slice,P=/\s+/,O=function(e,t,n,r){if(!n)return!0;if("object"===T(n)){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(P.test(n)){for(var o=n.split(P),a=0,s=o.length;a<s;a++)e[t].apply(e,[o[a]].concat(r));return!1}return!0},L=function(e,t,n,r){var i,o=-1,a=e.length,s=t[0],u=t[1],l=t[2];!function c(){try{switch(t.length){case 0:for(;++o<a;)(i=e[o]).callback.call(i.ctx);return;case 1:for(;++o<a;)(i=e[o]).callback.call(i.ctx,s);return;case 2:for(;++o<a;)(i=e[o]).callback.call(i.ctx,s,u);return;case 3:for(;++o<a;)(i=e[o]).callback.call(i.ctx,s,u,l);return;default:for(;++o<a;)(i=e[o]).callback.apply(i.ctx,t);return}}catch(e){A.error.apply(A,[n,"error on event",r,"trigger","-",e]),c()}}()},R=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"register",value:function(t){e.Custom||(e.Custom={});var n="string"==typeof t&&t.toUpperCase().trim();n&&!e.Custom[n]?e.Custom[n]=n.toLowerCase().split("_").map(function(e,t){return 0===t?e:e=e[0].toUpperCase()+e.slice(1)}).join(""):A.error("Events","Error when register event: "+t)}}],(n=[{key:"on",value:function(e,t,n){if(!O(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r?(r.push({callback:t,context:n,ctx:n||this}),this):this}},{key:"once",value:function(e,t,n){var r,i=this;if(!O(this,"once",e,[t,n])||!t)return this;return r=function(){i.off(e,r),t.apply(this,arguments)},this.on(e,r,n)}},{key:"off",value:function(e,t,n){var r,i,o,a,s,u,l,c;if(!this._events||!O(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(s=0,u=(a=e?[e]:Object.keys(this._events)).length;s<u&&(e=a[s],o=this._events[e])&&(this._events[e]=r=[],t||n);s++){for(l=0,c=o.length;l<c;l++)i=o[l],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this}},{key:"trigger",value:function(e){var t=this.name||this.constructor.name;if(!e)return A.warn.apply(A,[t,"trying to trigger undefined event, ignored"]),this;if(!this._events)return this;var n=S.call(arguments,1);if(!O(this,"trigger",e,n))return this;var r=this._events[e],i=this._events.all;return r&&L(r,n,t,e),i&&L(i,arguments,t,e),this}},{key:"stopListening",value:function(e,t,n){var r=this._listeningTo;if(!r)return this;var i=!t&&!n;for(var o in n||"object"!==T(t)||(n=this),e&&((r={})[e._listenId]=e),r)(e=r[o]).off(t,n,this),(i||0===Object.keys(e._events).length)&&delete this._listeningTo[o];return this}}])&&w(t.prototype,n),r&&w(t,r),e}(),C={listenTo:"on",listenToOnce:"once"};Object.keys(C).forEach(function(e){R.prototype[e]=function(t,n,r){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=p("l"))]=t,r||"object"!==T(n)||(r=this),t[C[e]](n,r,this),this}});function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}["PLAYER_PLAY","PLAYER_PLAY_INTENT","PLAYER_PAUSE","PLAYER_STOP","PLAYER_ENDED","PLAYER_SEEK","PLAYER_SEEKED","PLAYER_SEEKING","PLAYER_ERROR","PLAYER_TIMEUPDATE","PLAYER_PROGRESS","PLAYER_FULLSCREEN","PLAYER_READY","PLAYER_BUFFERING","PLAYER_BUFFERING_CHANGE","PLAYER_BUFFERFULL","PLAYER_PRESS_PLAY","PLAYER_VOLUMEUPDATE","PLAYER_LOADEDMETADATA","PLAYER_CLICK","PLAYER_DBLCLICK","PLAYER_KEYDOWN","PLAYER_MOUSE_ENTER","PLAYER_MOUSE_LEAVE","PLAYER_MOUSE_MOVE","PLAYER_CONTEXTMENU","PLAYER_LEVELS_AVAILABEL","PLAYER_LEVEL_SWITCHED","PLAYER_SETTINGS_MENU_HIDE","PLAYER_QUALITY_LEVELS_SELECTED","PLAYER_UPDATE_SIZE","PLAYER_CANPLAYTHROUGH","PLAYER_WAITING","PLAYER_ORIENTATION_CHANGE","PLAYER_AD_PAUSE_REQUEST","PLAYER_AD_RESUME_REQUEST","PLAYER_AD_WILL_START","PLAYER_AD_STARTED","PLAYER_AD_STOPPED","PLAYER_AD_SKIPPED","PLAYER_AD_LOAD_TIMEOUT","PLAYER_MEDIACONTROL_DISABLE","PLAYER_MEDIACONTROL_ENABLE","PLAYER_MEDIACONTROL_SHOW","PLAYER_MEDIACONTROL_HIDE","PLAYER_MEDIACONTROL_READY","PLAYER_MEDIACONTROL_CLICK","PLAYER_MEDIACONTROL_DBLCLICK","PLAYER_DVRSTATECHANGED","PLAYER_THEATER_MODE_CHANGE","PLAYBACK_PROGRESS","PLAYBACK_TIMEUPDATE","PLAYBACK_BUFFERING","PLAYBACK_BUFFERING_CHANGE","PLAYBACK_BUFFERFULL","PLAYBACK_SETTINGSUPDATE","PLAYBACK_LOADEDMETADATA","PLAYBACK_VOLUMEUPDATE","PLAYBACK_HIGHDEFINITIONUPDATE","PLAYBACK_BITRATE","PLAYBACK_LEVELS_AVAILABLE","PLAYBACK_LEVEL_SWITCH_START","PLAYBACK_LEVEL_SWITCH_END","PLAYBACK_PLAYBACKSTATE","PLAYBACK_DVR","PLAYBACK_DVRSTATECHANGED","PLAYBACK_MEDIACONTROL_DISABLE","PLAYBACK_MEDIACONTROL_ENABLE","PLAYBACK_ENDED","PLAYBACK_PLAY_INTENT","PLAYBACK_PLAY","PLAYBACK_PAUSE","PLAYBACK_SEEKING","PLAYBACK_WAITING","PLAYBACK_SEEKED","PLAYBACK_STOP","PLAYBACK_ERROR","PLAYBACK_STATS_ADD","PLAYBACK_FRAGMENT_LOADED","PLAYBACK_LEVEL_SWITCHED","PLAYBACK_SUBTITLE_AVAILABLE","PLAYBACK_SUBTITLE_CHANGED","PLAYBACK_FULLSCREEN_IOS","PLAYBACK_CANPLAYTHROUGH","MEDIACONTROL_HIDE","MEDIACONTROL_SHOW","LOADING_SPINNER_HIDE","LOADING_SPINNER_SHOW","MEDIACONTROL_MOUSEMOVE_SEEKBAR","MEDIACONTROL_MOUSELEAVE_SEEKBAR"].forEach(function(e){R[e]=e});var N=function(e){var t,n,r;function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),e&&(t=e.options),(n=I(this,x(i).call(this))).player=e,n._options=t,n.uniqueId=p("o"),n._nameEvents={},n.constructor.NAME_EVENTS.forEach(function(e){R[e]=e,n._nameEvents[e]=e}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(i,R),t=i,r=[{key:"NAME_EVENTS",get:function(){return[]}}],(n=[{key:"bindEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;this.listenEvents.forEach(function(n){n.once?e.listenToOnce(n.target||t||e,n.name,n.handler):e.listenTo(n.target||t||e,n.name,n.handler)})}},{key:"unbindEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player;this.listenEvents.forEach(function(n){n.once?e.stopListening(n.target||t||e,n.name):e.stopListening(n.target||t||e,n.name,n.handler)})}},{key:"options",get:function(){return this._options}},{key:"listenEvents",get:function(){return[]}}])&&M(t.prototype,n),r&&M(t,r),i}(),U=function(e){return null!=e?e.constructor:null},j=function(e,t){return Boolean(e&&t&&e instanceof t)},B=function(e){return null==e},Y=function(e){return U(e)===Object},G=function(e){return U(e)===String},V=function(e){return Array.isArray(e)},H=function(e){return j(e,NodeList)},K=function(e){return B(e)||(G(e)||V(e)||H(e))&&!e.length||Y(e)&&!Object.keys(e).length},z={nullOrUndefined:B,object:Y,number:function(e){return U(e)===Number&&!Number.isNaN(e)},string:G,boolean:function(e){return U(e)===Boolean},function:function(e){return U(e)===Function},array:V,weakMap:function(e){return j(e,WeakMap)},nodeList:H,element:function(e){return j(e,Element)},textNode:function(e){return U(e)===Text},event:function(e){return j(e,Event)},cue:function(e){return j(e,window.TextTrackCue)||j(e,window.VTTCue)},track:function(e){return j(e,TextTrack)||!B(e)&&G(e.kind)},url:function(e){if(j(e,window.URL))return!0;var t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!K(new URL(t).hostname)}catch(e){return!1}},empty:K};function W(e){return JSON.parse(JSON.stringify(e))}function q(e,t){return t.split(".").reduce(function(e,t){return e&&e[t]},e)}var X=function(e){return z.object(e)?Object.keys(e):[]};function $(e,t){X(e).forEach(function(n){return t(e[n],n)})}function Q(e){e=e||{};for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(r)for(var i in r)r.hasOwnProperty(i)&&("[object Object]"!==Object.prototype.toString.call(r[i])?e[i]=r[i]:e[i]=Q(e[i],r[i]))}return e}function J(e){return Object.values&&Object.values(e)||Object.keys(e).map(function(t){return e[t]})}function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t,n){return t&&ne(e.prototype,t),n&&ne(e,n),e}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oe=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ee(this,te(t).call(this,e))).pluginOptions=n.getPluginOptions(),n.enabled=!0,n.pluginOptions.disabled&&n.disable(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,N),re(t,[{key:"defaultOptions",get:function(){return{}}}]),re(t,[{key:"initialize",value:function(){var e=this;return Promise.resolve().then(function(){return e.setUp()}).then(function(){return e.enabled&&e.bindEvents()})}},{key:"getPluginOptions",value:function(){return Q(this.defaultOptions,q(this._options,"pluginsOptions.".concat(this.name))||this.defaultOptions)}},{key:"setUp",value:function(){}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.enabled=!0,A.debug(this.name,"enabled"))}},{key:"disable",value:function(){this.enabled&&(this.unbindEvents(),this.enabled=!1,A.debug(this.name,"disabled"))}},{key:"destroy",value:function(){this.disable(),this.player.removePlugin(this.name)}}]),t}(),ae=n(1),se=n.n(ae);function ue(e){if(/\s/.test(e))throw new Error("class has illegal whitespace characters")}function le(e,t){return ue(t),e.classList?e.classList.contains(t):(n=t,new RegExp("(^|\\s)"+n+"($|\\s)")).test(e.className);var n}function ce(e,t){return e.classList?e.classList.add(t):le(e,t)||(e.className=(e.className+" "+t).trim()),e}function fe(e,t){return e.classList?e.classList.remove(t):(ue(t),e.className=e.className.split(/\s+/).filter(function(e){return e!==t}).join(" ")),e}function de(e,t,n){if(e.classList)return void 0===n?e.classList.toggle(t):e.classList.toggle(t,n);var r=le(e,t);return"function"==typeof n&&(n=n(e,t)),"boolean"!=typeof n&&(n=!r),n!==r?(n?ce(e,t):fe(e,t),e):void 0}function he(e,t){return e.className=t,e}function pe(e,t){for(var n in t)if(null===t[n]){var r=n.split(/(?=[A-Z])/).map(function(e){return e.toLowerCase()}).join("-");e.style.removeProperty(r)}else e.style[n]=t[n];return e}function ye(e){return z.object(e)&&1===e.nodeType}function ge(e){return z.object(e)&&3===e.nodeType}function ve(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function me(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(function(e){return"function"==typeof e&&(e=e()),ye(e)||ge(e)?e:"string"==typeof e&&/\S/.test(e)?document.createTextNode(e):void 0}).filter(function(e){return e})}function be(e,t){return me(t).forEach(function(t){return e.appendChild(t)}),e}function _e(e,t){return be(ve(e),t)}function Ee(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function ke(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=document.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){var n=t[e];-1!==e.indexOf("aria-")||"role"===e||"type"===e?i.setAttribute(e,n):i[e]=n}),Object.getOwnPropertyNames(n).forEach(function(e){i.setAttribute(e,n[e])}),r&&be(i,r),i}function Ae(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}function we(e,t){return e.getAttribute(t)}function Te(e,t,n){e.setAttribute(t,n)}function Se(e,t){e.removeAttribute(t)}function Pe(e){var t;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{left:0,top:0};var n=document.documentElement,r=document.body,i=n.clientLeft||r.clientLeft||0,o=window.pageXOffset||r.scrollLeft,a=t.left+o-i,s=n.clientTop||r.clientTop||0,u=window.pageYOffset||r.scrollTop,l=t.top+u-s;return{left:Math.round(a),top:Math.round(l)}}function Oe(e){if(e){var t=e.getBoundingClientRect();return t.height/2<=window.innerHeight-t.top&&t.bottom>=t.height/2}}function Le(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={},i=Pe(e),o=n?e.offsetHeight:e.offsetWidth,a=n?e.offsetWidth:e.offsetHeight,s=i.top,u=i.left,l=t.pageY,c=t.pageX;return t.changedTouches&&(c=t.changedTouches[0].pageX,l=t.changedTouches[0].pageY),r.y=Math.max(0,Math.min(1,(s-l+a)/a)),r.x=Math.max(0,Math.min(1,(c-u)/o)),r}function Re(e){return void 0===e.button&&void 0===e.buttons||0===e.button&&void 0===e.buttons||0===e.button&&1===e.buttons}function Ce(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=/^(\S+)\s*(.*)$/,Ue=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=xe(this,Me(t).call(this,e,n))).cid=p("c"),r.buildElement(),r.delegateEvents(),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(t,N),n=t,i=[{key:"tagName",get:function(){return"div"}},{key:"events",get:function(){return{}}},{key:"attributes",get:function(){return{}}}],(r=[{key:"$",value:function(e){return this.$el.find(e)}},{key:"setElement",value:function(e){return this.$el=se.a.zepto.isZ(e)?e:se()(e),this.el=this.$el[0],this}},{key:"buildElement",value:function(){if(this.el)this.setElement(this.el,!1);else{var e=Q({},this.attributes);this.id&&(e.id=this.id);var t=Q({},this.properties),n=ke(this.tagName,t,e);this.setElement(n,!1)}}},{key:"delegateEvents",value:function(e){if(!e&&!(e=this.events))return this;for(var t in e){var n=e[t];if(n&&n.constructor!==Function&&(n=this[e[t]]),n){var r=t.match(Ne),i=r[1],o=r[2];i+=".delegateEvents"+this.cid,""===o?this.$el.on(i,n.bind(this)):this.$el.on(i,o,n.bind(this))}}}},{key:"undelegateEvents",value:function(){return this.$el.off(".delegateEvents"+this.cid),this}},{key:"render",value:function(){return this}},{key:"remove",value:function(){return this.$el.remove(),this.unbindEvents(),this.undelegateEvents(),this}},{key:"getAttribute",value:function(e){return we(this.el,e)}},{key:"setAttribute",value:function(e,t){Te(this.el,e,t)}},{key:"removeAttribute",value:function(e){Se(this.el,e)}},{key:"setStyles",value:function(e){pe(this.el,e)}},{key:"hasClass",value:function(e){return le(this.el,e)}},{key:"addClass",value:function(e){ce(this.el,e)}},{key:"removeClass",value:function(e){fe(this.el,e)}},{key:"toggleClass",value:function(e,t){de(this.el,e,t)}},{key:"show",value:function(){this.removeClass("--z--hide")}},{key:"hide",value:function(){this.addClass("--z--hide")}},{key:"properties",get:function(){return{}}}])&&Ie(n.prototype,r),i&&Ie(n,i),t}();function je(e){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){return!t||"object"!==je(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ve(e,t,n){return t&&Ge(e.prototype,t),n&&Ge(e,n),e}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ke=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Be(this,Ye(t).call(this,e))).pluginOptions=n.getPluginOptions(),n.enabled=!0,n.pluginOptions.disabled&&n.disable(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(t,Ue),Ve(t,[{key:"defaultOptions",get:function(){return{}}}]),Ve(t,[{key:"initialize",value:function(){var e=this;return Promise.resolve().then(function(){return e.setUp()}).then(function(){return e.render()}).then(function(){return e.enabled&&e.bindEvents()})}},{key:"getPluginOptions",value:function(){return Q(this.defaultOptions,q(this._options,"pluginsOptions.".concat(this.name))||this.defaultOptions)}},{key:"setUp",value:function(){}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.show(),this.enabled=!0,A.debug(this.name,"enabled"))}},{key:"disable",value:function(){this.enabled&&(this.unbindEvents(),this.hide(),this.enabled=!1,A.debug(this.name,"disabled"))}},{key:"destroy",value:function(){this.disable(),this.remove(),this.player.removePlugin(this.name)}}]),t}();n(9);function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qe(e,t){return!t||"object"!==ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e,t){return($e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qe=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),qe(this,Xe(t).call(this,null,e))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}(t,Ue),n=t,(r=[{key:"play",value:function(){throw new Error("this must be implemented")}},{key:"pause",value:function(){throw new Error("this must be implemented")}},{key:"stop",value:function(){}},{key:"seek",value:function(){}},{key:"seekPercentage",value:function(){}},{key:"getDuration",value:function(){return 0}},{key:"isPlaying",value:function(){return!1}},{key:"isReady",value:function(){throw new Error("this must be implemented")}},{key:"getPlaybackType",value:function(){return t.NO_OP}},{key:"isHighDefinitionInUse",value:function(){return!1}},{key:"volume",value:function(){}},{key:"getVolume",value:function(){return 0}},{key:"isHlsPlayback",value:function(){return!1}},{key:"isMp4Playback",value:function(){return!1}},{key:"destroy",value:function(){this.remove()}}])&&We(n.prototype,r),i&&We(n,i),t}();Qe.canPlay=function(){return!1},Qe.VOD="vod",Qe.AOD="aod",Qe.LIVE="live",Qe.LIVE_END="live_end",Qe.NO_OP="no_op",Qe.type="playback";var Je,Ze,et,tt,nt=Qe,rt=window.navigator&&window.navigator.userAgent||"",it=/AppleWebKit\/([\d.]+)/i.exec(rt),ot=it?parseFloat(it.pop()):null,at=/iPad/i.test(rt),st=/iPhone/i.test(rt)&&!at,ut=/iPod/i.test(rt),lt=st||at||ut,ct=(Je=rt.match(/OS (\d+)_/i))&&Je[1]?Je[1]:null,ft=/Android/i.test(rt),dt=function(){var e=rt.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),ht=ft&&dt<5&&ot<537,pt=/Firefox/i.test(rt),yt=/Edge/i.test(rt),gt=!yt&&(/Chrome/i.test(rt)||/CriOS/i.test(rt)),vt=(tt=rt.match(/(Chrome|CriOS)\/(\d+)/))&&tt[2]?parseFloat(tt[2]):null,mt=(!(et=(Ze=/MSIE\s(\d+)\.\d/.exec(rt))&&parseFloat(Ze[1]))&&/Trident\/7.0/i.test(rt)&&/rv:11.0/.test(rt)&&(et=11),et),bt=/Safari/i.test(rt)&&!gt&&!ft&&!yt,_t=(bt||lt)&&!gt,Et=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|IEMobile|Mobile Safari|Opera Mini/i.test(rt);function kt(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function At(e){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wt(e,t){return!t||"object"!==At(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e,t,n){return(Tt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=St(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ot(e,t,n){return t&&Pt(e.prototype,t),n&&Pt(e,n),e}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Ct={wav:["audio/wav"],mp3:["audio/mp3",'audio/mpeg;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.5"'],oga:["audio/ogg"]},Dt=Object.keys(Ct).reduce(function(e,t){return[].concat(Rt(e),Rt(Ct[t]))},[]),It=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];(n=wt(this,(e=St(t)).call.apply(e,[this].concat(i))))._readyDeferred=kt(),n._destroyed=!1,n._loadStarted=!1,n._playheadMoving=!1,n._playheadMovingTimer=null,n._stopped=!1,n.isHlsPlayback()||n.setupSource(n.options.src),n.options.playback||(n.options.playback=n.options||{});var a=n.options.playback.preload||(bt?"auto":n.options.preload);return Q(n.el,{muted:n.options.mute,loop:n.options.loop,preload:a,autoPlay:n.options.autoPlay||!1}),n.options.playInline&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(t,nt),Ot(t,[{key:"isAudioOnly",get:function(){var e=this.options.src,n=t._mimeTypesForUrl(e,Ct,this.options.mimeType);return this.options.playback&&this.options.playback.audioOnly||this.options.audioOnly||Dt.indexOf(n[0])>=0}},{key:"events",get:function(){return{canplay:"_onCanPlay",canplaythrough:"_onCanplaythrough",error:"_onError",loadeddata:"_onLoadedData",loadedmetadata:"_onLoadedMetadata",stalled:"_onStalled",timeupdate:"_onTimeUpdate",waiting:"_onWaiting",pause:"_onPause",playing:"_onPlaying",progress:"_onProgress",seeking:"_onSeeking",seeked:"_onSeeked",ended:"_onEnded",webkitbeginfullscreen:"_onBeginFullScreen",webkitendfullscreen:"_onEndFullScreen"}}},{key:"ended",get:function(){return this.el.ended}},{key:"buffering",get:function(){return this._isBuffering}}]),Ot(t,[{key:"setupSource",value:function(e){z.empty(e)||(this._src=e,this.el.src=e)}},{key:"getSource",value:function(){return this._src}},{key:"render",value:function(){return this._readyDeferred.resolve(),this}},{key:"isPlaying",value:function(){return!this.el.paused&&!this.el.ended}},{key:"isReady",value:function(){return this._readyDeferred.promise}},{key:"play",value:function(){return this._stopped=!1,this._handleBufferingEvents(),this.playPromise=this.el.play(),A.debug(this.name,"PLAY_PROMISE",this.playPromise),this.playPromise}},{key:"pause",value:function(){var e=this;this.playPromise?this.playPromise.then(function(){return e.el.pause()}):this.el.pause()}},{key:"stop",value:function(){this.pause(),this._stopped=!0,this._stopPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(R.PLAYBACK_STOP)}},{key:"volume",value:function(e){e<0||e>100||(0===e?this.mute():this.unmute(),this.el.volume=e/100,this.trigger(R.PLAYBACK_VOLUMEUPDATE,e))}},{key:"getVolume",value:function(){return this.el.volume}},{key:"mute",value:function(){this.$el.attr({muted:"true"}),this.el.muted=!0}},{key:"unmute",value:function(){}