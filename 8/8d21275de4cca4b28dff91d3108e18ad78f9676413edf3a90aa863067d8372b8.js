tagged.namespace("jst.util.countrySelect");
tagged.jst.util.countrySelect.render=function(a){a=a||{};var b=[],c=TAGGED.jst.xssFilter;try{with(a)a=function(a){for(var d in a)b.push(' <option value="'),b.push(c(d)),b.push('" '),d==countryCode&&b.push('selected="selected"'),b.push(' title="'),b.push(c(a[d])),b.push('">'),b.push(c(a[d])),b.push("</option> ")},b.push('<span class="controls"> <select id="'),b.push(c(selectID)),b.push('" class="'),b.push(c(className)),b.push('" name="'),b.push(c(name)),b.push('" onchange="'),b.push(onchange),b.push('"> '),
showSingle?(b.push(' <option value="'),b.push(c(countryCC)),b.push('" selected="selected" title="'),b.push(c(countryName)),b.push('">'),b.push(c(countryName)),b.push("</option> ")):(b.push(" "),showTitle&&(b.push(' <option id="country_title" value="-" disabled '),countryCode||b.push(' selected="selected" '),b.push(" >"),b.push("Country"),b.push("</option> ")),skipAll?showTitle||b.push(' <option value="-"></option> '):(b.push(' <option value="-1">'),b.push(c(tagged.util.countries.allCountries)),b.push("</option> ")),
b.push(" <optgroup>"),a(englishCountries),b.push('</optgroup> <optgroup label="---">'),a(otherCountries),b.push("</optgroup> ")),b.push(" </select></span>");return b.join("")}catch(d){if("undefined"!==typeof window&&window._jstFailuresRaise)throw d;alert('template error in "util/countrySelect.jst":\n\n'+d)}return""};tagged.namespace("util.countries");
tagged.util.countries={getCountries:function(a,b,c,d,e,f,g,h){var k=!1,m=null,n=null;tagged.data.isHighRisk&&(k=!0,m=tagged.data.regCCIso,n=tagged.util.countries.otherCountries[tagged.data.regCCIso]);"string"===typeof a&&(a=document.getElementById(a));a.innerHTML=tagged.jst.util.countrySelect.render({selectID:b,name:c,className:d,countryCode:e,onchange:f,skipAll:g,englishCountries:tagged.util.countries.englishCountries,otherCountries:tagged.util.countries.otherCountries,showTitle:h,showSingle:k,countryCC:m,
countryName:n})},forceCountry:function(a,b,c,d,e){var f;e in this.englishCountries?f=this.englishCountries[e]:e in this.otherCountries&&(f=this.otherCountries[e]);b='<input type="hidden" id="'+b+'" name="'+c+'" value="'+e+'"/><span class="'+d+'">'+f+"</span>";"string"==typeof a&&(a=document.getElementById(a));a.innerHTML=b}};$(function(){var a=function(){$("#email").tooltip({html:!1,trigger:"focus",placement:"top",template:'<div class="tooltip bootstrap_tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},b=$("#email").attr("prefill-value");if("string"==typeof b&&0<b.length){var c=!1;$("#email").on("keyup",function(){var d=b!=$(this).val();d!=c&&(d?(a(),$(this).tooltip("show")):$(this).tooltip("destroy"),c=d)})}else a()});var E,D;!tagged.exists("D")&&tagged.exists("YAHOO.util.Dom")&&(D=YAHOO.util.Dom);!tagged.exists("E")&&tagged.exists("YAHOO.util.Event")&&(E=YAHOO.util.Event);if(!tagged.exists("H")&&tagged.exists("YAHOO.util.History"))var H=YAHOO.util.History;(function(a){a("head").append("<link href='//fonts.googleapis.com/css?family=Signika' rel='stylesheet' type='text/css'>")})(jQuery);tagged.namespace("security.password");
tagged.security.password={cancel_response:{stat:"cancel"},trigger:function(a,b){"password"==a.stat&&a.result&&(this.callObj=b,this.origCallObj=JSON.stringify(a.result.origCallObj),this.panel=tagged.modules.lightbox.init({body:a.result.passwordPromptHtml,width:"338px",closeOnEscape:!0,className:"password_panel",position:"center",zIndex:1E4,title:this.strings.header}),$("#password_cancel").click($.proxy(this.cancel,this)),$(".ui-dialog-titlebar-close").click($.proxy(this.cancel,this)))},submit:function(a){a=
TAGGED.api.call({method:"tagged.security.verifyPassword",password:a,origCallObj:this.origCallObj});if(this.callObj&&this.callObj._deferredObj){var b=this.callObj._deferredObj;a.then(b.resolve,b.reject)}this.panel.destroy()},cancel:function(a){a.preventDefault();a=this.callObj;a._deferredObj?this.callObj._deferredObj.reject(this.cancel_response):"string"==typeof a&&eval(a+"("+JSON.stringify(this.cancel_response)+");");this.panel.destroy()}};tagged.namespace("jst.account.verification.dialog");
tagged.jst.account.verification.dialog.render=function(a){a=a||{};var b=[],c=TAGGED.jst.xssFilter;try{with(a){b.push('<div id="account_verification_dialog" class="hide_me" title="');b.push(c(tagged.account.verification.get_verified));b.push('"> ');var d=tagged.account.verification.header.replace(/\%s/,tagged.data.brand);b.push(' <div id="account_verification_dialog_header" class="account_verification_dialog_header">');b.push(c(d));b.push('</div> <div id="account_verification_dialog_content"> ');if(verification_methods.sms){b.push(' \x3c!-- SMS Verification --\x3e <div class="row_fluid"> ');
var e=verification_methods.sms;b.push(' <div class="verification_method_row sms"> ');"verified"===e.status?b.push(' <div class="verified_icon"></div> '):(b.push(' <button id="sms_verify" class="ui-button">'),b.push(c(tagged.account.verification.connect)),b.push("</button> "));b.push(' <span class="method_name">');b.push(c(tagged.account.verification.mobile_sms_number));b.push('</span> <span class="method_status"> ');"verified"===e.status?(b.push(" "),b.push(c(tagged.account.verification.verified))):
(b.push(" "),b.push(c(tagged.account.verification.not_verified)));b.push(" ");b.push(" </span> ");if(!e.is_verified){b.push(' <div id="sms_request_code" class="hide_me request_code_row"> <div class="arrow-line" /> <form> <div class="form_row"> <label for="sms_country">');b.push(c(tagged.account.verification.your_country));b.push('</label> <span class="dropdownarrow">\u25bc</span> <select id="sms_country"> ');for(var f in countries)b.push(' <option value="'),b.push(c(countries[f].code)),b.push('"'),
f==default_country_code&&b.push(" selected "),b.push(">"),b.push(c(countries[f].name)),b.push("</option> ");b.push(' </select> </div> <div class="form_row"> <label for="sms_phone_number">');b.push(c(tagged.account.verification.mobile_phone));b.push('</label> <span id="country_code_display" class="country_code_display" >+');b.push(c(countries[default_country_code].code));b.push('</span> <input id="sms_phone_number" type="text" value="" /> <span class="input_status"></span> </div> <div class="form_row"> <label for="sms_account_password">');
b.push(c(tagged.data.brand));b.push(" ");b.push(c(tagged.account.verification.password));b.push('</label> <input id="sms_account_password" type="password" class="');b.push(c(tagged.data.brand));b.push('" value="" /> <span class="input_status"></span> </div> <div class="form_row"> <span class="sms_notice">');b.push(c(tagged.account.verification.message_rates_notice));b.push('</span> <input id="sms_send_code" type="submit" class="ui-button" value="');b.push(c(tagged.account.verification.request_code));
b.push('" /> </div> </form> </div> <div id="sms_verify_code" class="hide_me verify_code_row"> <form> <div class="form_row instructions"> ');b.push(c(tagged.account.verification.enter_code));b.push(' <span id="sms_entered_phone" class="entered_phone"></span> </div> <div class="form_row"> <input id="sms_verification_code" type="text" value="" /> <span class="input_status"></span> </div> <span class="resend_code_outer"> ><a class="resend_code" href="#">');b.push(c(tagged.account.verification.resend_code));
b.push('</a> </span> <input id="sms_send_code" type="submit" class="ui-button" value="');b.push(c(tagged.account.verification.validate_code));b.push('" /> </form> </div> ')}b.push(" </div> \x3c!-- End SMS --\x3e </div> ")}b.push(" ");if(verification_methods.social_facebook){b.push(' \x3c!-- Facebook Verification --\x3e <div class="row_fluid"> ');e=verification_methods.social_facebook;b.push(' <div class="verification_method_row social_facebook"> ');"verified"===e.status?b.push(' <div class="verified_icon"></div> '):
"blocked"===e.status?b.push(' <div class="blocked_icon">!</div> '):(b.push(' <button id="facebook_verify" class="ui-button">'),b.push(c(tagged.account.verification.connect)),b.push("</button> "));b.push(' <span class="method_name">Facebook</span> <span class="method_status"> ');"verified"===e.status?(b.push(" "),b.push(c(tagged.account.verification.connected))):"blocked"===e.status?(b.push(" "),b.push(c(tagged.account.verification.facebook_unavailable))):(b.push(" "),b.push(c(tagged.account.verification.not_connected)));
b.push(" ");b.push(" </span> ");var g=tagged.account.verification.facebook_post_notice.replace(/\%s/,tagged.data.brand);b.push(' <span class="post_notice">');b.push(c(g));b.push("</span> </div> \x3c!-- End Facebook --\x3e </div> ")}b.push(" ");verification_methods.google_plus&&(b.push(' \x3c!-- Google Plus Verification --\x3e <div class="row_fluid"> '),e=verification_methods.google_plus,b.push(' <div class="verification_method_row google_plus"> '),"verified"===e.status?b.push(' <div class="verified_icon"></div> '):
(b.push(' <button id="google_plus_verify" class="ui-button">'),b.push(c(tagged.account.verification.connect)),b.push("</button> ")),b.push(' <span class="method_name">Google Plus</span> <span class="method_status"> '),"verified"===e.status?(b.push(" "),b.push(c(tagged.account.verification.verified))):(b.push(" "),b.push(c(tagged.account.verification.not_verified))),b.push(" "),b.push(" </span> </div> \x3c!-- End Google Plus --\x3e </div> "));b.push(" </div></div>")}return b.join("")}catch(h){if("undefined"!==
typeof window&&window._jstFailuresRaise)throw h;alert('template error in "account/verification/dialog.jst":\n\n'+h)}return""};tagged.namespace("json.verification");tagged.json.verification={baseMobileURL:{Tagged:"http://m.tagged.com/home.html?showVerificationStatus=true",Hi5:"http://m.hi5.com/home.html?showVerificationStatus=true"},domainTagged:"tagged.com"};tagged.namespace("account");
tagged.account.verification=function(){return{_options:{user_is_verified:!1,verification_required:!1,container:document.body,redirect_url:null,phoneflow_subtype:"verification",close_dialog_delay:3E3},_data:{default_country_code:null,verification_methods:{}},_ui:{container:null,dialog:null,is_parent:!1,is_child:!1},callbacks:{init:null,complete:null},actions:{DIALOG_VIEW:"view",SMS_BUTTON_CLICK:"sms_button_click",SMS_CODE_REQUEST:"sms_code_request",SMS_DUPLICATE_NUMBER:"sms_duplicate_number",SMS_CODE_SENT:"sms_code_sent",
SMS_REJECT:"sms_reject",SMS_INVALID:"sms_invalid",SMS_VALIDATE_ATTEMPT:"sms_validate_attempt",SMS_VALIDATE_SUCCESS:"sms_validate_success",SMS_VALIDATE_ERROR:"sms_validate_error",FACEBOOK_BUTTON_CLICK:"facebook_button_click",FACEBOOK_CONNECT_SUCCESS:"facebook_connect_success",FACEBOOK_ACCOUNT_USED:"facebook_connect_already_connected",FACEBOOK_MINIMUM_FRIENDS:"facebook_connect_not_enough_friends"},init:function(a,b){this._options=$.extend(this._options,a);this._data=$.extend(this._data,b);if(!0===this._options.user_is_verified||
!1===this._options.verification_required)return!1;this._ui.container=$(this._options.container);a=tagged.jst.account.verification.dialog.render($.extend(this._data,this._options));a=$(a).detach("#account_verification_dialog").html();b=.96*$(document).width();if(724>b)var c=280;else b=724,c=400;this._ui.dialog=tagged.modules.lightbox.init({body:a,className:"account_verification_dialog",closeOnEscape:!1,autoOpen:!1,position:"center",title:tagged.account.verification.get_verified,minHeight:c,width:b,
notshow:!0});window.self!==window.top&&(this._ui.parent=parent);for(var d in this._data.verification_methods)this._data.verification_methods.hasOwnProperty(d)&&(a=this._data.verification_methods[d],"undefined"!=typeof this[d]&&"function"===typeof this[d].initialize&&this[d].initialize.call(this,a));return this},social_facebook:{initialize:function(a){this._ui.hasOwnProperty("facebook")||(this._ui.facebook={});this._ui.facebook.status_row=this._ui.container.find(".verification_method_row.social_facebook");
this._ui.facebook.status_text=this._ui.facebook.status_row.find(".method_status");"verified"===a.status?(this._ui.facebook.status_text.addClass("verified"),this._ui.facebook.status_text.html(tagged.account.verification.connected)):"blocked"===a.status?this._ui.facebook.status_text.html(tagged.account.verification.facebook_unavailable):(this._ui.facebook.connect_button=$("#facebook_verify"),this._ui.facebook.connect_button.on("click",$.proxy(function(a){this.logAction.call(this,{action:this.actions.FACEBOOK_BUTTON_CLICK});
tagged.apps.facebook.verification.beginFacebookVerification($.proxy(this.social_facebook.success,this),$.proxy(this.social_facebook.error,this))},this)))},success:function(){this._ui.facebook.connect_button.replaceWith('<div class="verified_icon"></div>');this._ui.facebook.status_text.addClass("verified");this._ui.facebook.status_text.html(tagged.account.verification.connected);this.logAction.call(this,{action:this.actions.FACEBOOK_CONNECT_SUCCESS});this.finishVerification.call(this)},error:function(a){if(a.code)switch(a.code){case 4:case 722:this._ui.facebook.status_text.html(tagged.account.verification.facebook_acct_used);
this.logAction.call(this,{action:this.actions.FACEBOOK_ACCOUNT_USED});break;case 719:this._ui.facebook.status_text.html(tagged.account.verification.facebook_unavailable);this._ui.facebook.connect_button.replaceWith('<div class="blocked_icon">!</div>');this.logAction.call(this,{action:this.actions.FACEBOOK_MINIMUM_FRIENDS});break;case 3:case 720:case 721:this._ui.facebook.status_text.html(tagged.account.verification.facebook_unavailable)}}},sms:{initialize:function(a){this._ui.hasOwnProperty("sms")||
(this._ui.sms={});this._ui.sms.status_row=this._ui.container.find(".verification_method_row.sms");this._ui.sms.status_text=this._ui.sms.status_row.find(".method_status");"verified"==a.status?this._ui.sms.status_text.addClass("verified"):(this._ui.sms.connect_button=$("#sms_verify"),this._ui.sms.request_code_div=$("#sms_request_code"),this._ui.sms.request_code_form=this._ui.sms.request_code_div.find("form"),this._ui.sms.country_select=$("#sms_country"),this._ui.sms.country_code_display=$("#country_code_display"),
this._ui.sms.enter_phone_input=$("#sms_phone_number"),this._ui.sms.phone_message_div=this._ui.sms.enter_phone_input.next(),this._ui.sms.password_input=$("#sms_account_password"),this._ui.sms.password_message_div=this._ui.sms.password_input.next(),this._ui.sms.verify_code_div=$("#sms_verify_code"),this._ui.sms.verify_code_form=this._ui.sms.verify_code_div.find("form"),this._ui.sms.entered_phone_text=$("#sms_entered_phone"),this._ui.sms.response_code_input=$("#sms_verification_code"),this._ui.sms.response_code_status=
this._ui.sms.response_code_input.next(),this._ui.sms.resend_code_link=this._ui.sms.verify_code_div.find("a.resend_code"),this._ui.sms.code_message_div=this._ui.sms.response_code_input.next(),this._ui.sms.country_select.on("change",$.proxy(function(a){a=this._ui.sms.country_select.val();this._ui.sms.country_code_display.html("+"+a);this._ui.sms.enter_phone_input.focus()},this)),this._ui.sms.enter_phone_input.on("keypress",$.proxy(function(a){a=a.which;if(48>a||57<a)return!1},this)),this._ui.sms.connect_button.on("click",
$.proxy(function(a){a=!this._ui.sms.request_code_div.is(":visible")&&!this._ui.sms.verify_code_div.is(":visible");var b=this._ui.sms.request_code_div.is(":visible"),d=this._ui.sms.verify_code_div.is(":visible");switch(!0){case a:this._ui.sms.request_code_div.removeClass("hide_me");this._ui.sms.enter_phone_input.focus();this._ui.facebook&&this._ui.facebook.status_row&&this._ui.facebook.status_row.addClass("hide_me");this._ui.sms.connect_button.html(tagged.account.verification.cancel);this.logAction.call(this,
{action:this.actions.SMS_BUTTON_CLICK});break;case b:this._ui.sms.request_code_div.addClass("hide_me");this._ui.facebook&&this._ui.facebook.status_row&&this._ui.facebook.status_row.removeClass("hide_me");this._ui.sms.connect_button.html(tagged.account.verification.connect);break;case d:this._ui.sms.verify_code_div.addClass("hide_me"),this._ui.sms.request_code_div.removeClass("hide_me"),this._ui.sms.enter_phone_input.focus()}},this)),this._ui.sms.request_code_form.on("submit",$.proxy(this.sms.check_verification_status,
this)))},reenter_phone:function(){this._ui.sms.verify_code_form.off("submit",$.proxy(this.sms.submit_verification_code,this));this._ui.sms.resend_code_link.off("click",$.proxy(this.sms.reenter_phone,this));this._ui.sms.entered_phone_text.html("");this._ui.sms.verify_code_div.toggleClass("hide_me");this._ui.sms.request_code_div.toggleClass("hide_me");this._ui.sms.enter_phone_input.focus();return!1},resend_code:function(){this.sms.send_code.call(this).fail($.proxy(this.sms.request_code_error_response,
this));return!1},check_verification_status:function(){this.sms.reset_errors.call(this);this.logAction.call(this,{action:this.actions.SMS_CODE_REQUEST});if(!this.sms.validate_phone.call(this))return!1;var a={method:"tagged.user.canUsePhoneNumForVerification",phoneNumber:this.sms.get_prefixed_phone_number.call(this)};tagged.api.call(a).done($.proxy(this.sms.request_code,this)).fail($.proxy(this.sms.request_code_error_response,this));return!1},request_code:function(a){if(!1===a.result)return this._ui.sms.phone_message_div.html(tagged.account.verification.number_used),
this._ui.sms.phone_message_div.addClass("error"),this._ui.sms.enter_phone_input.addClass("error"),this.logAction.call(this,{action:this.actions.SMS_DUPLICATE_NUMBER}),!1;a=this.sms.validate_phone.call(this);var b=this.sms.validate_password.call(this);if(!a||!b)return!1;this.tmpSecurityPasswordHandler=tagged.security.password.trigger||null;tagged.security.password={trigger:this.request_code_error_response};this.sms.send_code.call(this).done($.proxy(this.sms.request_code_success_response,this)).fail($.proxy(this.sms.request_code_error_response,
this));return!1},get_unformatted_phone_number:function(){var a=this._ui.sms.enter_phone_input.val();return(a=a.match(/\d+/g))&&0<a.length?a.join(""):""},get_prefixed_phone_number:function(){var a=this._ui.sms.country_select.val(),b=this.sms.get_unformatted_phone_number.call(this);return a+b},send_code:function(){var a={method:"tagged.security.verifyPassword",password:this._ui.sms.password_input.val(),origCallObj:JSON.stringify({method:"tagged.account.auth.addUnverifiedPhoneNumberAndSendText",countryCode:this._ui.sms.country_select.val(),
phoneNumber:this._ui.sms.enter_phone_input.val(),subtype:this._options.phoneflow_subtype,application_id:"user"})};return tagged.api.call(a)},request_code_success_response:function(a){this._ui.sms.request_code_div.toggleClass("hide_me");this._ui.sms.verify_code_div.toggleClass("hide_me");if("US"==this._data.default_country_code&&"1"==this._ui.sms.country_select.val()){a=this.sms.get_unformatted_phone_number.call(this);var b=this.sms.format_phone_US.call(this,a);b?this._ui.sms.entered_phone_text.html(b):
this._ui.sms.entered_phone_text.html(a)}this._ui.sms.response_code_input.focus();this._ui.sms.resend_code_link.on("click",$.proxy(this.sms.reenter_phone,this));this._ui.sms.verify_code_form.on("submit",$.proxy(this.sms.submit_verification_code,this));this.logAction.call(this,{action:this.actions.SMS_CODE_SENT})},request_code_error_response:function(a,b){if("string"===typeof a)try{(a=JSON.parse(a))&&a.result&&a.result.code&&(a.error={code:a.result.code})}catch(c){a={}}if(a.error&&a.error.code)switch(a.error.code){case 1:case 3:this._ui.sms.request_code_div.html(tagged.account.verification.message_sms_limit);
break;case 2:this._ui.sms.password_message_div.html(tagged.account.verification.invalid_password);this._ui.sms.password_message_div.addClass("error");this._ui.sms.password_input.addClass("error");break;case 712:case 4:this._ui.sms.phone_message_div.html(tagged.account.verification.invalid_phone),this._ui.sms.phone_message_div.addClass("error"),this._ui.sms.enter_phone_input.addClass("error"),this.logAction.call(this,{action:this.actions.SMS_INVALID})}},submit_verification_code:function(){this.sms.reset_errors.call(this);
var a={method:"tagged.account.auth.confirmCode",confirmationCode:this._ui.sms.response_code_input.val(),subtype:this._options.phoneflow_subtype,phoneNumber:this._ui.sms.enter_phone_input.val()};tagged.api.call(a).done($.proxy(this.sms.finish_verification,this)).fail($.proxy(this.sms.submit_verification_code_error,this));this.logAction.call(this,{action:this.actions.SMS_VALIDATE_ATTEMPT});return!1},submit_verification_code_error:function(a){a.error&&a.error.code&&(this._ui.sms.response_code_status.html(a.error.message),
this._ui.sms.response_code_status.addClass("error"),this._ui.sms.response_code_input.addClass("error"),this.logAction.call(this,{action:this.actions.SMS_VALIDATE_ERROR}))},finish_verification:function(){var a={method:"tagged.user.verify",verification_method:"sms",phoneNum:this.sms.get_prefixed_phone_number.call(this)};tagged.api.call(a).done($.proxy(this.sms.verification_complete,this)).fail($.proxy(this.sms.finish_verification_error_response,this));this.logAction.call(this,{action:this.actions.SMS_VALIDATE_SUCCESS});
return!1},finish_verification_error_response:function(a){this._ui.sms.response_code_input.html("error goes here");this._ui.sms.response_code_input.addClass("error");this._ui.sms.response_code_input.addClass("error")},verification_complete:function(a){this._ui.sms.status_text.addClass("verified");this._ui.sms.status_text.html(tagged.account.verification.verified);this._ui.sms.connect_button.replaceWith('<div class="verified_icon"></div>');this._ui.sms.request_code_div.remove();this._ui.sms.verify_code_div.remove();
this.finishVerification.call(this);return!1},reset_errors:function(){this._ui.sms.phone_message_div.html("");this._ui.sms.phone_message_div.removeClass("error");this._ui.sms.enter_phone_input.removeClass("error");this._ui.sms.password_message_div.html("");this._ui.sms.password_message_div.removeClass("error");this._ui.sms.password_input.removeClass("error");this._ui.sms.response_code_status.html("");this._ui.sms.response_code_status.removeClass("error");this._ui.sms.response_code_input.removeClass("error")},
validate_phone:function(){return 0==this._ui.sms.enter_phone_input.val().length?(this._ui.sms.phone_message_div.html(tagged.account.verification.invalid_phone),this._ui.sms.phone_message_div.addClass("error"),this._ui.sms.enter_phone_input.addClass("error"),!1):!0},validate_password:function(){return 0==this._ui.sms.enter_phone_input.val().length?(this._ui.sms.password_message_div.html(tagged.account.verification.invalid_password),this._ui.sms.password_message_div.addClass("error"),this._ui.sms.password_input.addClass("error"),
!1):!0},format_phone_US:function(a){switch(a.length){case 10:a="("+a.substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6,4);break;default:return!1}return a},put_cursor_at_end_of_input:function(a){if(a.setSelectionRange){var b=$(a).val().length;a.setSelectionRange(b,b)}else $(a).val($(this).val())}},finishVerification:function(){var a=this._options.redirect_url;window.setTimeout(function(){document.location.href=a},this._options.close_dialog_delay||0)},setDocumentDomain:function(){document.domain=document.location.host.match(/[a-zA-Z0-9\-]*\.com/)[0]},
showSecureLightbox:function(a,b){this._ui.iframe=$("<iframe id='user_verification' />").attr({src:a,frameborder:"0",allowTransparency:!0}).css({border:0,margin:0,padding:0,position:"fixed",top:0,width:"100%",height:"100%",zIndex:1E4});$(document.body).append(this._ui.iframe);"object"===typeof b&&(this.callbacks=$.extend(this.callbacks,b));if("function"===typeof this.callbacks.init)$(this._ui.iframe).on("load",$.proxy(function(){this.callbacks.init()},this));$(window).on("message",$.proxy(this.handleIframeMessage,
this))},closeLightbox:function(){window===window.top?window.location.href=document.location.host.match(/[^\.]+.com$/)==tagged.json.verification.domainTagged?tagged.json.verification.baseMobileURL.Tagged:tagged.json.verification.baseMobileURL.Hi5:this.postMessage(JSON.stringify({status:"close_iframe"}))},handleIframeMessage:function(a){a=a.originalEvent.data;if("string"===typeof a)try{a=JSON.parse(a)}catch(b){return!1}if(a.hasOwnProperty("status"))switch(a.status){case "close_iframe":this._ui.iframe.remove(),
"function"===typeof this.callbacks.complete?this.callbacks.complete():document.location.reload()}},postMessage:function(a){var b=this._ui.iframe||parent;if(!b)return!1;$(b)[0].postMessage(a,b.location.href)},showDialog:function(){this._ui.dialog.show();this.logAction.call(this,{action:this.actions.DIALOG_VIEW})},hideDialog:function(){this._ui.dialog.hide()},logAction:function(a,b){a=$.extend({method:"tagged.verification.logAction",app:"meetme"},a);tagged.api.call(a);"function"===typeof b&&b.apply(this)}}}();tagged.namespace("util.cookie");tagged.util.cookie={set:function(a,b,c,d){var e="";d=d?"; domain="+d:"";c&&(e=new Date,e.setTime(e.getTime()+864E5*c),e="; expires="+e.toGMTString());document.cookie=a+"="+b+e+d+"; path=/"},get:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return null},clear:function(a){tagged.util.cookie.set(a,"",-1)}};tagged=tagged||{};
tagged.newapi=function(a,b){a=a||{};if(!b)throw Error("Missing logs");this._logger=b;this.preloadedCalls=[];this._queue=[];this.autoBundleCalls=a.autoBundleCalls||3;this.autoBundle=a.autoBundle||0;this.autoBundleWaitTime=a.autoBundleWaitTime||0;this.mocker={add:$.proxy(this.mocker.add,this)};this.callQueue=$.proxy(this.callQueue,this);var c=this;a=function(a){return c.call(a,null,{defer:!0})};$.extend(c,{nullResponseHandle:$.noop,nullResponseHandler:$.noop,queue:a,dequeue:$.noop,startDefer:$.noop,
handleDefer:$.noop,stopDefer:$.noop,post:function(a,b){return c.call(a).always(b)},defer:{push:function(a){$(function(){c.call(a,null,{defer:!0})})}},_trackedRequests:{},recall:function(a,b){if(null==b||""===b)b="default";null!=c._trackedRequests[b]&&("pending"==c._trackedRequests[b].state()&&c._trackedRequests[b].reject(),c._trackedRequests[b]=null);c._trackedRequests[b]=c.call(a)},getQueryStringParameter:function(a,b){b=b||window.location.search;var c=b.indexOf("?");b=0<=c?b.substr(c+1):b;c=b.lastIndexOf("#");
b=0<=c?b.substr(0,c):b;var d=b.split("&");c=0;for(b=d.length;c<b;c++){var e=d[c].split("=");if(2<=e.length&&e[0]===a)return unescape(e[1])}return null}});c.queue.push=a};
$.extend(tagged.newapi,{_login_regex_match:/^login status: -1000$/,redirectOnNotLoggedIn:!0,createQueryString:function(a,b){var c={};return b&&(c.method=a.method,c.api_signature="",tagged.guid&&(c.track=tagged.guid),!a.method)?tagged.util&&tagged.util.log?tagged.util.log.toConsole("method is missing",a):"":$.param($.extend(c,a))},getQueryStringParameter:function(a,b){b=b||window.location.search;var c=b.indexOf("?");b=0<=c?b.substr(c+1):b;c=b.lastIndexOf("#");b=0<=c?b.substr(0,c):b;var d=b.split("&");
c=0;for(b=d.length;c<b;c++){var e=d[c].split("=");if(2<=e.length&&e[0]===a)return unescape(e[1])}return null},handleFlowException:function(a,b){var c={security:"captcha",password:"password",phone:"phone"};if(a&&c.hasOwnProperty(a.stat))return tagged.require("security").done(function(){b._post._deferredObj=b;tagged.security[c[a.stat]].trigger(a,b._post)}),!0;if(a&&"verification"==a.stat&&a.result&&a.result.hasOwnProperty("verify_url")){var d=a.result.origCallObj;tagged.account.verification.showSecureLightbox(a.result.verify_url,
{init:$.proxy(function(){},this),complete:$.proxy(function(){this.call(d)},this)})}return!1},handleNotLoggedIn:function(a){tagged.api&&!1===tagged.api.redirectOnNotLoggedIn||!tagged.newapi.redirectOnNotLoggedIn||(tagged.data.hasOwnProperty("isTool")&&tagged.data.isTool?window.location="/logout?r="+encodeURIComponent(window.location):window.location="/index.html?r="+encodeURIComponent(window.location))},callback:{success:function(a,b,c,d){try{b.error&&11===b.error.code&&(window.location=window.location.href),
b.length!=a.length&&this.failure.apply(this,arguments)}catch(h){this.failure.apply(this,arguments);return}for(var e=0,f=a.length;e<f;e++)try{var g=b[e];if("string"===typeof g)try{g=$.parseJSON(g),g.error&&11===g.error.code&&(window.location=window.location.href)}catch(h){}tagged.newapi.handleFlowException(g,a[e])||("ok"==g.stat?a[e].resolve(g):a[e].reject(g))}catch(h){a[e].reject(b[e])}},failure:function(a,b,c,d){c=0;for(d=a.length;c<d;c++)a[c].reject(b)},xhrFailure:function(a,b){0<=b.responseText.search(tagged.newapi._login_regex_match)&&
tagged.newapi.handleNotLoggedIn();b=0;for(var c=a.length;b<c;b++)a[b].reject({stat:"fail",error:{message:"Failure sending request.  Please try again later"}})}},_pluckMap:function(a,b,c){var d=[];$.each(a,function(a,f){d.push(c?$.proxy(f[b],f):f[b])});return d}});
tagged.newapi.prototype=function(){var a=function(a){for(var b=0;b<this.preloadedCalls.length;b++){var d=this.preloadedCalls[b];if(a.method==d.req.method){for(var e in d.req)if(d.req.hasOwnProperty(e)&&d.req[e]!=a[e])return;"ok"==d.resp.stat?a._deferredObj.resolve(d.resp):a._deferredObj.reject(d.resp);d.isPerm||this.preloadedCalls.splice(b--,1)}}};return{format:"JSON",mocker:{add:function(a,c,d){this.preloadedCalls.push({req:a,resp:c,isPerm:!!d})}},log:function(a,c){if(!a)throw Error("missing name");
this.call($.extend({data:c||[]},{method:"tagged.log.generic",name:a}))},call:function(b,c,d){var e=this;d=d||{};var f=$.isArray(b)?b:[b];if(0!==f.length){$.each(f,$.proxy(function(b,c){f[b]=$.extend({},c);c=f[b];c._deferredObj=c._deferredObj||jQuery.Deferred();c._deferredObj._post=c;if(c.callback){if(this.noBackwardCompat)throw Error("Illegal callback");var d=c.callback;c._deferredObj.always(function(a){if("string"==typeof d)try{var b=eval(d.substring(0,d.lastIndexOf(".")));var c=eval(d);c.call(b,
a)}catch(l){e._logger.toConsole(d,"threw error",l,"data=",a),c&&"function"===typeof c&&c({stat:"fail",error:{code:-1}})}else if(d.fn)try{d.fn.apply(d.scope,[a,d.args])}catch(l){e._logger.toConsole(d,"threw error",l,"data=",a),d.fn.apply(d.scope,[{stat:"fail",error:{code:-1}},d.args])}else try{d(a)}catch(l){throw e._logger.toConsole(d,"threw error",l,"data=",a),l;}});delete c.callback}a.call(this,c)},this));b=tagged.newapi._pluckMap(f,"_deferredObj");!1!==d.autoQueue&&(this.autoBundle||d.defer)?(this._queue=
this._queue.concat(f),this.autoBundleWaitId||(this.autoBundleWaitId=window.setTimeout(this.callQueue,this.autoBundleWaitTime))):this._call(f);if(1===f.length&&!c)return b[0];d=$.whenAll.call($,b);if(c){if(this.noBackwardCompat)throw Error("postCall not allowed");d.always(c)}return d}},callQueue:function(){for(;this._queue.length;)this._call(this._queue.splice(0,this.autoBundleCalls));this.autoBundleWaitId=null},_call:function(a,c){c=c||{};var b=tagged.newapi.getQueryStringParameter,e="\n";c={application_id:"user",
format:c.format||this.format};if(b("no_cache")||b("clear_cache"))c.no_cache="1";(b=b("loc")||b("locale"))&&(c.locale=b);b=[];for(var f=0,g=a.length;f<g;f++){var h=a[f]._deferredObj;"pending"==h.state()&&(b.push(h),delete a[f]._deferredObj,e+=tagged.newapi.createQueryString(a[f],!0)+"\n")}b.length&&this._post("/api/?"+$.param(c),b,e)},_post:function(a,c,d){$.ajax(a,{type:"post",processData:!1,data:d,dataType:"json",success:$.proxy(tagged.newapi.callback.success,tagged.newapi.callback,c),error:$.proxy(tagged.newapi.callback.xhrFailure,
tagged.newapi.callback,c)})},createQueryString:$.param}}();TAGGED.namespace("api");tagged.api=TAGGED.api=new tagged.newapi({},tagged.util.log);TAGGED.namespace("util.hintinput");
TAGGED.util.hintinput={attach:function(a,b,c){a="string"==typeof a?document.getElementById(a):a;b="string"==typeof b?document.getElementById(b):b;null!=a&&($.extend(a,TAGGED.util.hintinput.methods),$(a).blur(a._insertDefaultText),$(a).focus(a._removeDefaultText),$(b).submit($.proxy(a._onFormSubmit,a)),$(a).attr("defaultText",c),$(a).attr("prevColor",$(a).css("color")),"object"==typeof document.activeElement?document.activeElement!=a&&a._insertDefaultText():a._insertDefaultText())},methods:function(){return{getValue:function(){this._removeDefaultText();
var a=this.value;this._insertDefaultText();return a},setValue:function(a){this._removeDefaultText();this.value=a;this._insertDefaultText()},hasValue:function(){return!$(this).hasClass("showdefault")&&""!=this.value},clearValue:function(){this.setValue("")},_insertDefaultText:function(){var a=$(this);this.disabled||a.hasClass("showdefault")||""!=a.val()||(a.addClass("showdefault"),a.css("color","#333"),this.value=this.getAttribute("defaultText"))},_removeDefaultText:function(){$(this).hasClass("showdefault")&&
($(this).removeClass("showdefault"),$(this).css("color","#000"),this.value="")},_onFormSubmit:function(a){this._removeDefaultText()}}}()};tagged.namespace("jst.util.locationSelector");
tagged.jst.util.locationSelector.render=function(a){a=a||{};var b=[];try{with(a)b.push('<div id="location_search_ac" class="location_row control-group row-fluid"> '),showSpacer&&b.push(' <div class="span3">&nbsp;</div> '),b.push(' <div class="span9"> <input id="location" type="text" name="location" class="input-large" /> <span id="location_span"></span> <div id="location_results" class="location_container"></div> </div> <input id="location_nd" name="location_nd" type="hidden" value="" /> <input id="newlocation" name="newlocation" type="hidden" value="" /> <input id="newlocation_id" name="newlocation_id" type="hidden" value="" /></div><div class="clearBoth"/>');return b.join("")}catch(c){if("undefined"!==
typeof window&&window._jstFailuresRaise)throw c;alert('template error in "util/locationSelector.jst":\n\n'+c)}return""};tagged.namespace("util.autocomplete");tagged.util.autocomplete.dupeMark=function(a){var b={},c;for(c in a)b[a[c]]||(b[a[c]]=[]),b[a[c]].push(c);a=[];for(var d in b)1<b[d].length&&(a=a.concat(b[d]));return a};tagged.namespace("util.locationselector");
(function(){tagged.util.locationselector={stateAbbrevs:{Alabama:"AL",Alaska:"AK","American Samoa":"AS",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE","District of Columbia":"DC",Florida:"FL",Georgia:"GA",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH",
"New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Palau:"PW",Pennsylvania:"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT",Virginia:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY",Alberta:"AB","British Columbia":"BC",Manitoba:"MB","New Brunswick":"NB",Newfoundland:"NL","Northwest Territories":"NT","Nova Scotia":"NS",Ontario:"ON","Prince Edward Island":"PE",
Quebec:"QC",Saskatchewan:"SK",Yukon:"YT"},create:function(a,b,c,d,e,f,g,h,k){k="undefined"!==typeof k?k:!0;f=f||"country";g=g||"country_span";a&&(a=document.getElementById(a),a.innerHTML=sprintf('<div class="location_row control-group row-fluid"><label class="control-label span3 %1$s" for="%2$s">%3$s</label><div class="controls span9"><span id="%4$s"></span></div></div>',"fwb",f,this.strings.country,g),h||(a.innerHTML+=sprintf('<div class="location_row control-group row-fluid"><label class="control-label span3 %1$s" for="location">%2$s</label><div class="controls span9"><span id="distance_span"></span></div></div>',
"fwb",this.strings.distance),a.innerHTML+=tagged.jst.util.locationSelector.render({showSpacer:k})));k=tagged.util.locationselector.strings.allCountries;""!=b&&(k=b);e?tagged.util.countries.forceCountry(g,f,"country","select_wide",k):(tagged.util.countries.getCountries(g,f,"country","fields-wide",k),h||(document.getElementById(f).onchange=function(){tagged.util.locationselector.countryChange(this.options[this.selectedIndex].value)}));h||(document.getElementById("location").value=c,document.getElementById("location").maxLength=
"140",TAGGED.util.hintinput.attach("location",d,tagged.util.locationselector.getDefaultLocation(k)),this.AC=tagged.util.locationselector.createCityAutocomplete("location","location_results"),this.AC.generateRequest=function(a){var b=d.country.value,c=-1!=b?b:"";b=tagged.util.locationselector.shouldShowAdmin(b);return sprintf(this.requestString,a,c,b)})},countryChange:function(a){var b=tagged.util.locationselector.strings.distanceMiles;"US"!=a&&"GB"!=a&&(b=tagged.util.locationselector.strings.distanceKilometers);
for(var c=tagged.data.selector_distances?tagged.data.selector_distances:[0,5,10,20,50,100],d='<select class="fields-wide" id="distance" name="distance">',e=0;e<c.length;++e)d=0===c[e]?d+('<option value="0">'+tagged.util.locationselector.strings.distanceMatches+"</option>"):d+('<option value="'+c[e]+'">'+sprintf(b,c[e])+"</option>");d+="</select>";document.getElementById("distance_span").innerHTML=d;document.getElementById("location_nd").value="";document.getElementById("location").setAttribute("defaultText",
tagged.util.locationselector.getDefaultLocation(a));document.getElementById("location").clearValue();var f=tagged.util.locationselector.shouldShowAdmin(a);this.AC.formatResult=function(a,b,c){return tagged.util.locationselector._highlightString(tagged.util.locationselector._formatPlace(a.cityAccented,a.region,a.regionAbbrev,f,a.isDupe),b)};this.AC.itemSelectEvent.unsubscribeAll();this.AC.itemSelectEvent.subscribe(function(a,b){document.getElementById("location").value=tagged.util.locationselector._formatPlace(b[2].cityAccented,
b[2].region,b[2].regionAbbrev,f,b[2].isDupe);document.getElementById("location_nd").value=tagged.util.locationselector._formatPlace(b[2].city,b[2].region,b[2].regionAbbrev,f,b[2].isDupe)})},getDefaultLocation:function(a){var b=tagged.util.locationselector.strings.defaultDefaultCity;"CA"==a?b=tagged.util.locationselector.strings.defaultCanadaCity:"US"==a&&(b=tagged.util.locationselector.strings.defaultUSCity);return b},_highlightString:function(a,b){b=b.replace(/,/ig,"").replace(/\s+/," ").split(" ");
a=a.replace(/\s+/," ").split(" ");b.sort(function(a,b){return b.length-a.length});for(var c in a)for(var d in b){var e=new RegExp("(^"+b[d]+")","i");if(a[c].match(e)){a[c]=a[c].replace(e,"<strong>$1</strong>");break}}return a.join(" ")},_abbrevState:function(a){return 0===a.length?"":"undefined"==typeof this.stateAbbrevs[a]?", "+a:", "+this.stateAbbrevs[a]},shouldShowAdmin:function(){}