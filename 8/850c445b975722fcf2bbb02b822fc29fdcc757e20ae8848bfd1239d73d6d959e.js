var lang=new Array();var userAgent=navigator.userAgent.toLowerCase();var is_opera=userAgent.indexOf('opera')!=-1&&opera.version();var is_moz=(navigator.product=='Gecko')&&userAgent.substr(userAgent.indexOf('firefox')+8,3);var is_ie=document.documentMode&&document.documentMode<11?document.documentMode:false;var is_chrome=(userAgent.indexOf('chrome')!=-1);function isIE8(){var rv=-1;var ua=navigator.userAgent;var re=new RegExp("Trident\/([0-9]{1,}[\.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1);}
return(rv==4);}
var is_ie8=is_ie&&isIE8();var is_webkit=0;if(_i=userAgent.indexOf('applewebkit')!=-1){if(_j=userAgent.indexOf('version')>_i){is_webkit=parseFloat(userAgent.substr(userAgent.indexOf('version')+8,3));}}
function $(id){return document.getElementById(id);}
if(typeof Array.prototype.push==='undefined'){Array.prototype.push=function(value){this[this.length]=value;return this.length;}}
if(!('remove'in Element.prototype)){Element.prototype.remove=function(){if(this.parentNode){this.parentNode.removeChild(this);}};}
function checkall(form,prefix,checkall){var checkall=checkall?checkall:'chkall';for(var i=0;i<form.elements.length;i++){var e=form.elements[i];if(e.name&&e.name!=checkall&&(!prefix||(prefix&&e.name.match(prefix)))){e.checked=form.elements[checkall].checked;}}}
function checkallNotPin(form,prefix,checkall,notPinned){var checkall=checkall?checkall:'chkall';if(!!notPinned){for(var i=0;i<form.elements.length;i++){var e=form.elements[i];let parentId=''
if(e.getAttribute('data-id')){const parentId=e.getAttribute('data-id').toString()
if(!String.prototype.startsWith){Object.defineProperty(String.prototype,'startsWith',{value:function(search,rawPos){var pos=rawPos>0?rawPos|0:0;return this.substring(pos,pos+search.length)===search;}});}
if(!parentId.startsWith('stickthread')){if(e.name&&e.name!=checkall&&(!prefix||(prefix&&e.name.match(prefix)))){e.checked=form.elements[checkall].checked;}}}}}else{for(var i=0;i<form.elements.length;i++){var e=form.elements[i];if(e.name&&e.name!=checkall&&(!prefix||(prefix&&e.name.match(prefix)))){e.checked=form.elements[checkall].checked;}}}}
function doane(event){e=event?event:window.event;if(is_ie){e.returnValue=false;e.cancelBubble=true;}else if(e){e.stopPropagation();e.preventDefault();}}
function fetchCheckbox(cbn){return $(cbn)&&$(cbn).checked==true?1:0;}
function getcookie(name){var cookie_start=document.cookie.indexOf(name+'=');var cookie_end=document.cookie.indexOf(";",cookie_start);return cookie_start==-1?'':unescape(document.cookie.substring(cookie_start+name.length+1,(cookie_end>cookie_start?cookie_end:document.cookie.length)));}
function thumbImg(obj){var zw=obj.width;var zh=obj.height;if(is_ie&&zw==0&&zh==0){var matches
re=/width=(["']?)(\d+)(\1)/i
matches=re.exec(obj.outerHTML);zw=matches[2];re=/height=(["']?)(\d+)(\1)/i
matches=re.exec(obj.outerHTML);zh=matches[2];}
obj.resized=true;obj.style.width=zw+'px';obj.style.height='auto';if(obj.offsetHeight>zh){obj.style.height=zh+'px';obj.style.width='auto';}
if(is_ie){var imgid='img_'+Math.random();obj.id=imgid;setTimeout('try {if ($(\''+imgid+'\').offsetHeight > '+zh+') {$(\''+imgid+'\').style.height = \''+zh+'px\';$(\''+imgid+'\').style.width = \'auto\';}} catch(e){}',1000);}
obj.onload=null;}
function imgzoom(obj){}
function in_array(needle,haystack){if(typeof needle=='string'||typeof needle=='number'){for(var i in haystack){if(haystack[i]==needle){return true;}}}
return false;}
function setcopy(text,alertmsg){if(is_ie){clipboardData.setData('Text',text);alert(alertmsg);}else if(prompt('Press Ctrl+C Copy to Clipboard',text)){alert(alertmsg);}}
function isUndefined(variable){return typeof variable=='undefined'?true:false;}
function mb_strlen(str){return str.length;}
function setcookie(cookieName,cookieValue,seconds,path,domain,secure){var expires=new Date();expires.setTime(expires.getTime()+seconds*1000);document.cookie=escape(cookieName)+'='+escape(cookieValue)
+(expires?'; expires='+expires.toGMTString():'')
+(path?'; path='+path:'/')
+(domain?'; domain='+domain:'')
+(secure?'; secure':'');}
function strlen(str){return(is_ie&&str.indexOf('\n')!=-1)?str.replace(/\r?\n/g,'_').length:str.length;}
function updatestring(str1,str2,clear){str2='_'+str2+'_';return clear?str1.replace(str2,''):(str1.indexOf(str2)==-1?str1+str2:str1);}
function toggle_collapse(objname,noimg){var obj=$(objname);obj.style.display=obj.style.display==''?'none':'';if(!noimg){var img=$(objname+'_img');img.src=img.src.indexOf('_yes.gif')==-1?img.src.replace(/_no\.gif/,'_yes\.gif'):img.src.replace(/_yes\.gif/,'_no\.gif')}
var collapsed=getcookie('discuz_collapse');collapsed=updatestring(collapsed,objname,!obj.style.display);setcookie('discuz_collapse',collapsed,(collapsed?86400*30:-(86400*30)));}
function toggle_collapse_set_cookie(objname,isCollapsed){var collapsed=getcookie('discuz_collapse');collapsed=updatestring(collapsed,objname,isCollapsed);setcookie('discuz_collapse',collapsed,(collapsed?86400*30:-(86400*30)));}
function toggle_collapse_forumrules(objname){var obj=$(objname);obj.style.display=obj.style.display==''?'none':'';var collapsed=getcookie('discuz_collapse_forumrules');if(collapsed==""){collapsed="_"+objname+"_on_";}else if(collapsed=="_"+objname+"_off_"){collapsed="_"+objname+"_on_";}else{collapsed="_"+objname+"_off_";}
setcookie('discuz_collapse_forumrules',collapsed,2500);}
function trim(str){return(str+'').replace(/(\s+)$/g,'').replace(/^\s+/g,'');}
function updateseccode(){type=seccodedata[2];var rand=Math.random();if(type==2){$('seccodeimage').innerHTML='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="'+seccodedata[0]+'" height="'+seccodedata[1]+'" align="middle">'
+'<param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="seccode.php?update='+rand+'" /><param name="quality" value="high" /><param name="wmode" value="transparent" /><param name="bgcolor" value="#ffffff" />'
+'<embed src="seccode.php?update='+rand+'" quality="high" wmode="transparent" bgcolor="#ffffff" width="'+seccodedata[0]+'" height="'+seccodedata[1]+'" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object>';}else{$('seccodeimage').innerHTML='<img id="seccode" onclick="updateseccode()" width="'+seccodedata[0]+'" height="'+seccodedata[1]+'" src="seccode.php?update='+rand+'" class="absmiddle" alt="" />';}}
function updatesecqaa(){var x=new Ajax();x.get('ajax.php?action=updatesecqaa&inajax=1',function(s){$('secquestion').innerHTML=s;});}
function _attachEvent(obj,evt,func){if(obj.addEventListener&&(!is_ie||is_ie>=11)){obj.addEventListener(evt,func,false);}else if(obj.attachEvent){obj.attachEvent("on"+evt,func);}}
function hasClass(ele,cls){return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));}
function addClass(ele,cls){if(!this.hasClass(ele,cls))ele.className+=" "+cls;}
function removeClass(ele,cls){if(hasClass(ele,cls)){var reg=new RegExp('(\\s|^)'+cls+'(\\s|$)');ele.className=ele.className.replace(reg,' ');}}
shortcut={'all_shortcuts':{},'add':function(shortcut_combination,callback,opt){var default_options={'type':'keydown','propagate':false,'disable_in_input':true,'target':document,'keycode':false}
if(!opt)opt=default_options;else{for(var dfo in default_options){if(typeof opt[dfo]=='undefined')opt[dfo]=default_options[dfo];}}
var ele=opt.target;if(typeof opt.target=='string')ele=document.getElementById(opt.target);var ths=this;shortcut_combination=shortcut_combination.toLowerCase();var func=function(e){e=e||window.event;if(opt['disable_in_input']){var element;if(e.target)element=e.target;else if(e.srcElement)element=e.srcElement;if(element.nodeType==3)element=element.parentNode;if(element.tagName=='INPUT'||element.tagName=='TEXTAREA')return;}
if(e.keyCode)code=e.keyCode;else if(e.which)code=e.which;var character=String.fromCharCode(code).toLowerCase();if(code==188)character=",";if(code==190)character=".";var keys=shortcut_combination.split("+");var kp=0;var shift_nums={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":"\"",",":"<",".":">","/":"?","\\":"|"}
var special_keys={'esc':27,'escape':27,'tab':9,'space':32,'return':13,'enter':13,'backspace':8,'scrolllock':145,'scroll_lock':145,'scroll':145,'capslock':20,'caps_lock':20,'caps':20,'numlock':144,'num_lock':144,'num':144,'pause':19,'break':19,'insert':45,'home':36,'delete':46,'end':35,'pageup':33,'page_up':33,'pu':33,'pagedown':34,'page_down':34,'pd':34,'left':37,'up':38,'right':39,'down':40,'f1':112,'f2':113,'f3':114,'f4':115,'f5':116,'f6':117,'f7':118,'f8':119,'f9':120,'f10':121,'f11':122,'f12':123}
var modifiers={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(e.ctrlKey)modifiers.ctrl.pressed=true;if(e.shiftKey)modifiers.shift.pressed=true;if(e.altKey)modifiers.alt.pressed=true;if(e.metaKey)modifiers.meta.pressed=true;for(var i=0;k=keys[i],i<keys.length;i++){if(k=='ctrl'||k=='control'){kp++;modifiers.ctrl.wanted=true;}else if(k=='shift'){kp++;modifiers.shift.wanted=true;}else if(k=='alt'){kp++;modifiers.alt.wanted=true;}else if(k=='meta'){kp++;modifiers.meta.wanted=true;}else if(k.length>1){if(special_keys[k]==code)kp++;}else if(opt['keycode']){if(opt['keycode']==code)kp++;}else{if(character==k)kp++;else{if(shift_nums[character]&&e.shiftKey){character=shift_nums[character];if(character==k)kp++;}}}}
if(kp==keys.length&&modifiers.ctrl.pressed==modifiers.ctrl.wanted&&modifiers.shift.pressed==modifiers.shift.wanted&&modifiers.alt.pressed==modifiers.alt.wanted&&modifiers.meta.pressed==modifiers.meta.wanted){callback(e);if(!opt['propagate']){e.cancelBubble=true;e.returnValue=false;if(e.stopPropagation){e.stopPropagation();e.preventDefault();}
return false;}}}
this.all_shortcuts[shortcut_combination]={'callback':func,'target':ele,'event':opt['type']};if(ele.addEventListener)ele.addEventListener(opt['type'],func,false);else if(ele.attachEvent)ele.attachEvent('on'+opt['type'],func);else ele['on'+opt['type']]=func;},'remove':function(shortcut_combination){shortcut_combination=shortcut_combination.toLowerCase();var binding=this.all_shortcuts[shortcut_combination];delete(this.all_shortcuts[shortcut_combination])
if(!binding)return;var type=binding['event'];var ele=binding['target'];var callback=binding['callback'];if(ele.detachEvent)ele.detachEvent('on'+type,callback);else if(ele.removeEventListener)ele.removeEventListener(type,callback,false);else ele['on'+type]=false;}}
function shareToFb(link,label){var link=link==null?location.href:link.href;ga_trackEvent(null,'Share','Facebook Share',label);var w=window.open('https://www.facebook.com/dialog/share?app_id=1123050414379686&display=popup&href='+encodeURIComponent(link),'fbshare','width=626,height=436,toolbar=0,status=0');w.focus();return false;}
function getInnerText(obj){var txt='';if(obj)txt=obj.innerText?obj.innerText:obj.textContent;return txt?txt:'';}
function replaceUrlParam(url,paramName,paramValue){if(paramValue==null){paramValue='';}
var pattern=new RegExp('\\b('+paramName+'=).*?(&|#|$)');if(url.search(pattern)>=0){return url.replace(pattern,'$1'+paramValue+'$2');}
url=url.replace(/[?#]$/,'');return url+(url.indexOf('?')>0?'&':'?')+paramName+'='+paramValue;}
function ga_trackEvent(obj,category,action,label){var rtn=true;try{if(label){if(typeof gtag!="undefined"){gtag('event',action,{'event_category':category,'event_label':label});}else if(typeof dataLayer!="undefined"){dataLayer.push({'event':'GAEvent','eventCategory':category,'eventAction':action,'eventLabel':label});}
if(typeof pageTracker!="undefined"){pageTracker._trackEvent(category,action,label);}}else{if(typeof gtag!="undefined"){gtag('event',action,{'event_category':category});}else if(typeof dataLayer!="undefined"){dataLayer.push({'event':'GAEvent','eventCategory':category,'eventAction':action});}
if(typeof pageTracker!="undefined"){pageTracker._trackEvent(category,action);}}}catch(err){console.error('GA tracking error');}
return rtn;}
function tr_track(url){if(url!=''){var icon=new Image();icon.src=url;icon.referrerPolicy='unsafe-url';}}
function genTrackingHash(){var text="";var possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<11;i++)
text+=possible.charAt(Math.floor(Math.random()*possible.length));return text;}
function escapeHtml(unsafe){return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");}
function clearViewThreadHistory(){if(typeof(Storage)==='undefined'){alert("清空瀏覽記錄發生問題");return;}
if(confirm("確定清除所有瀏覽記錄？")){$$.ajax({url:"ajax.php",data:{action:"clearViewThreadHistory"},type:"GET",async:true,success:function(data,textStatus,xhr){$$("#popup-history").empty().append(data.meta.html);}});}}
function showNotiNum(obj){$$.ajax({url:"ajax.php",data:{action:"nc_count"},type:"POST",async:true,success:function(data,textStatus,xhr){return setNotiNum(obj,parseInt(data));},error:function(xhr,textStatus,errorThrown){return setNotiNum(obj,NaN);}});}
function setNotiNum(obj,nc_count){var noti_num_obj=obj;if(nc_count>0){if(nc_count>99){nc_count="99+";}
noti_num_obj.text(nc_count).show();}else{if(nc_count==-1){noti_num_obj.text(nc_count).show();}else{noti_num_obj.text("").hide();}}}
function showNoti(obj){var noti_wrapper=obj;var nc_open=$$.ajax({url:"ajax.php",data:{action:"nc_open"},type:"POST",async:false}).responseText;noti_wrapper.append(nc_open).show();}
function showPersonalNoti(personal){if($$(personal).hasClass('new')){$$.ajax({url:"ajax.php",data:{action:"nc_personal_open"},type:"POST",});}}
function hideNotiOdj(obj){var noti_num_obj=obj;noti_num_obj.hide().text("");}
function readnoti(obj,id,type){var rtn=true;var result=$$.ajax({url:"ajax.php",data:{action:"nc_read",id:id},type:"POST",async:false});ga_trackEvent(this,'notification - '+type,'click');if(obj&&obj.href){if(obj.target=='none'){}else if(obj.target!='_blank'){if(type=="gift"){openUrlFancybox(obj.href);rtn=false;}else{}}}
return rtn;}
var timeout="";function cleantimer(){clearTimeout(timeout);timeout="";}
function follow(obj,uid,fid,tid){var act=$$(obj).hasClass('following')?"unfollow":"follow";fid=fid||"";tid=tid||"";if(!timeout){if(obj.className.match(/(?:^|\s)following(?!\S)/g)){obj.className=obj.className.replace(/(?:^|\s)following(?!\S)/g,' following loading ');}else{obj.className=obj.className.replace(/(?:^|\s)follow(?!\S)/g,' follow loading ');}
timeout=setTimeout(function(){if(act=="unfollow"){unFollow(obj,uid);}else{addFollow(obj,uid,fid,tid);}
if($$(".follow-bubble").is(':visible')){$$(".follow-bubble").click();}},2000);}}
function addFollow(obj,uid,fid,tid){const innerSpan=$$(obj).children('span')
$$.ajax({url:"ajax.php",data:{action:"addfollow",uid:uid,fid:fid,tid:tid},type:"GET",async:false,success:function(response){cleantimer();obj.className=obj.className.replace(/(?:^|\s)loading(?!\S)/g,'');if($$.trim(response)=="success"){innerSpan.text('已追蹤');obj.className=obj.className.replace(/(?:^|\s)follow(?!\S)/g,' following ');changeFolloweeCount(0);changeFollowerCount(uid);}else{alert($$.trim(response));}}});}
function unFollow(obj,uid){const innerSpan=$$(obj).children('span')
$$.ajax({url:"ajax.php",data:{action:"unfollow",uid:uid},type:"GET",async:false,success:function(response){if($$.trim(response)=="success"){cleantimer();innerSpan.text('追蹤');obj.className=obj.className.replace(/(?:^|\s)loading(?!\S)/g,'');obj.className=obj.className.replace(/(?:^|\s)following(?!\S)/g,' follow ');changeFolloweeCount(0);changeFollowerCount(uid);}}});}
function changeFolloweeCount(uid){if($$('.followee_count').length>0){$$.ajax({url:"ajax.php",data:{action:"countfollowee",uid:uid},type:"GET",async:false,success:function(response){$$('.followee_count').text($$.trim(response));}});}}
function changeFollowerCount(uid){if($$('.follow-number, .follower-num').length>0){$$.ajax({url:"ajax.php",data:{action:"countfollower",uid:uid},type:"GET",async:false,success:function(response){if(parseInt($$.trim(response))>0){$$('.follow-number').text($$.trim(response)).show();}else{$$('.follow-number').text($$.trim(response)).hide();}
if(parseInt($$.trim(response))>=0){$$('#'+uid+" .follower-num").text($$.trim(response)).show();}}});}}
function blockFollower(obj,uid){var act=$$(obj).hasClass('blocking')?"unblock":"block";if(!timeout){if(obj.className.match(/(?:^|\s)blocking(?!\S)/g)){obj.innerHTML="";obj.className=obj.className.replace(/(?:^|\s)blocking(?!\S)/g,' blocking loading');}else{obj.innerHTML="";obj.className=obj.className.replace(/(?:^|\s)block(?!\S)/g,' block loading');}
timeout=setTimeout(function(){if(act=="unblock"){unBlockFollower(obj,uid);}else{addBlockFollower(obj,uid);}
clearTimeout(timeout);},1000);}}
function addBlockFollower(obj,uid){$$.ajax({url:"ajax.php",data:{action:"blockfollower",uid:uid},type:"GET",async:false,success:function(response){if($$.trim(response)=="success"){cleantimer();obj.innerHTML="已封鎖";obj.className=obj.className.replace(/(?:^|\s)loading(?!\S)/g,'');obj.className=obj.className.replace(/(?:^|\s)block(?!\S)/g,' blocking ');}}});}
function unBlockFollower(obj,uid){$$.ajax({url:"ajax.php",data:{action:"unblockfollower",uid:uid},type:"GET",async:false,success:function(response){if($$.trim(response)=="success"){cleantimer();obj.innerHTML="封鎖";obj.className=obj.className.replace(/(?:^|\s)loading(?!\S)/g,'');obj.className=obj.className.replace(/(?:^|\s)blocking(?!\S)/g,' block ');}}});}
function toggle_tips(objname,name){var obj=objname;obj.style.display=(obj.style.display==''||obj.style.display=='none')?'none':'';var collapsed=getcookie('discuz_tips');collapsed=updatestring(collapsed,name,!obj.style.display);setcookie('discuz_tips',collapsed,(collapsed?86400*365:-(86400*365)),'/','discuss.com.hk');}
function updateReaction(obj,pid,tid){var reaction;var like_obj=$$(obj).parent().find('.like');var dislike_obj=$$(obj).parent().find('.dislike');var like_number=parseInt(like_obj.attr("data-value"));var dislike_number=parseInt(dislike_obj.attr("data-value"));var like_number_display,dislike_number_display;if($$(obj).hasClass("like")){if($$(obj).hasClass("on")){reaction="reset";obj.className="like";if(like_number>0){like_number=like_number-1;}}else{reaction="like";obj.className="like on";like_number=like_number+1;if(dislike_obj.hasClass('on')){dislike_obj.removeClass('on');if(dislike_number>0){dislike_number=dislike_number-1;}}}}else if($$(obj).hasClass("dislike")){if($$(obj).hasClass("on")){reaction="reset";obj.className="dislike";if(dislike_number>0){dislike_number=dislike_number-1;}}else{reaction="dislike";obj.className="dislike on";dislike_number=dislike_number+1;if(like_obj.hasClass('on')){like_obj.removeClass('on');if(like_number>0){like_number=like_number-1;}}}}
if(dislike_number>0){dislike_obj.addClass('have');dislike_number_display=number_format(dislike_number);}
if(like_number>0){like_obj.addClass('have');like_number_display=number_format(like_number);}
if(dislike_number<1){dislike_obj.removeClass('have');dislike_number_display="&nbsp;";}
if(like_number<1){like_obj.removeClass('have');like_number_display="&nbsp;";}
dislike_obj.attr("data-value",dislike_number);dislike_obj.find('.dislike-number').html(dislike_number_display);like_obj.attr("data-value",like_number);like_obj.find('.like-number').html(like_number_display);if(timeout){clearTimeout(timeout);}
timeout=setTimeout(function(){if(reaction){$$.ajax({url:"ajax.php",data:{action:"updatereaction",pid:pid,reaction:reaction,tid:tid},type:"GET",async:false,dataType:'json',timeout:3000,success:function(response){if(response.status=="success"){}}});}},1500);}
function num2range(num){if(num>=1000){num=parseFloat((num/1000).toFixed(1))+"k";}else if(num>=1000000){num=parseFloat((num/1000000).toFixed(1))+"M";}
return num;}
function number_format(num){var parts=num.toString().split(".");parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return parts.join(".");}
function storeViewThreadHistory(tid,replies,pid){if(typeof(Storage)!=="undefined"){if(localStorage.getItem("discuss_thread_history")!=null){var historyObj=JSON.parse(localStorage.getItem("discuss_thread_history"));var historyTmp=[];for(var i=0;i<historyObj.length;i++){if(historyTmp.indexOf(historyObj[i]['tid'])==-1){historyTmp.push(historyObj[i]['tid']);}}
if(historyTmp.indexOf(tid)==-1){var historyNew={tid:tid,replies:replies,pid:String(pid),time:Date.now()};historyObj.push(historyNew);}else{historyObj[historyTmp.indexOf(tid)]['pid']=String(pid);historyObj[historyTmp.indexOf(tid)]['replies']=replies;historyObj[historyTmp.indexOf(tid)]['time']=Date.now();}
if(historyObj.length>100){historyObj.shift();}
localStorage.setItem("discuss_thread_history",JSON.stringify(historyObj));}else{var historyObj=[{tid:tid,replies:replies,pid:String(pid),time:Date.now()}];localStorage.setItem("discuss_thread_history",JSON.stringify(historyObj));}}}
function post_favorite_callback(id){var id_arr=id.split("_");var pid=id_arr[2];if($$("#"+id).text()=='收藏'){$$("#"+id).text('取消收藏');$$("#"+id+"_icon").show();$$("#"+id).attr('href','my.php?item=favorites&type=post&tid='+tid+'&delete='+pid);}else{$$("#"+id).text('收藏');$$("#"+id+"_icon").hide();$$("#"+id).attr('href','my.php?item=favorites&type=post&tid='+tid+'&pid='+pid);}}
if(typeof TimeMe!='undefined'){TimeMe.initialize();TimeMe.startTimer("screenTime");TimeMe.callWhenUserLeaves(function(){pushTimeSpendLog();});TimeMe.callWhenUserReturns(function(){TimeMe.startTimer("screenTime");});function pushTimeSpendLog(){TimeMe.stopTimer("screenTime");var timeSpend=TimeMe.getTimeOnPageInSeconds("screenTime");if(timeSpend){dataLayer.push({'event':'screenTime','spendTime':timeSpend.toFixed(0),'startTime':Math.floor(new Date().getTime()/1000)});}
TimeMe.resetAllRecordedPageTimes();}
window.addEventListener("popstate",function(e){pushTimeSpendLog();});}
function buddy(obj,uid){var act=$$(obj).hasClass('buddying')?"unbuddy":"buddy";var buffer=$$(obj).hasClass('loading')?true:false;if(!buffer){if(!timeout){if(obj.className.match(/(?:^|\s)buddying(?!\S)/g)){obj.className=obj.className.replace(/(?:^|\s)buddying(?!\S)/g,'buddy loading');}else{obj.className=obj.className.replace(/(?:^|\s)buddy(?!\S)/g,'buddying loading');}}
timeout=setTimeout(function(){if(act=="unbuddy"){unBuddy(obj,uid);}else{addBuddy(obj,uid);}},1000);}}
function addBuddy(obj,uid){$$.ajax({url:"ajax.php",data:{action:"addbuddy",uid:uid},type:"GET",async:false,success:function(response){if($$.trim(response)=="success"){obj.innerHTML=obj.innerHTML.replace(">加為好友<",">已加好友<");obj.className=obj.className.replace(/(?:^|\s)loading(?!\S)/g,'');obj.className=obj.className.replace(/(?:^|\s)buddy(?!\S)/g,'buddying');cleantimer();}else{response=$$.trim(response);var split=response.split(':'),errorMessage=split.length===2?split[1]:undefined;if(errorMessage)
alert(errorMessage);$$(obj).removeClass('loading buddying');$$(obj).addClass('buddy');}}});}
function unBuddy(obj,uid){$$.ajax({url:"ajax.php",data:{action:"unbuddy",uid:uid},type:"GET",async:false,success:function(response){if($$.trim(response)=="success"){obj.innerHTML=obj.innerHTML.replace(">已加好友<",">加為好友<");obj.className=obj.className.replace(/(?:^|\s)loading(?!\S)/g,'');obj.className=obj.className.replace(/(?:^|\s)buddying(?!\S)/g,'buddy');cleantimer();}}});}
function blockuser(obj,uid){var act=$$(obj).hasClass('blocking')?"unblock":"block";var msgbar=$$('.user-profile-blacklist-bar');var _page=$$('.vt_userinfopanel').length?'viewthread':'viewpro';ga_trackEvent(null,'Blacklist user',act,_page);if(timeout){clearTimeout(timeout);}
timeout=setTimeout(function(){$$.ajax({url:"ajax.php",data:{action:"block",uid:uid},type:"GET",async:false,success:function(response){if($$.trim(response)=="success"){if(_page=='viewthread'){if(obj.className.match(/(?:^|\s)blocking(?!\S)/g)){$$('.vt_userinfopanel .blacklist[data-authorid="'+uid+'"]').each(function(){$$(this).html($$(this).html().replace(">移出黑名單<",">加入黑名單<"));$$(this).toggleClass('blocking block');});}else{$$('.vt_userinfopanel .blacklist[data-authorid="'+uid+'"]').each(function(){$$(this).html($$(this).html().replace(">加入黑名單<",">移出黑名單<"));$$(this).toggleClass('block blocking');});}}else{if(obj.className.match(/(?:^|\s)blocking(?!\S)/g)){msgbar.removeClass('blocking');obj.innerHTML=obj.innerHTML.replace(">移出黑名單<",">加入黑名單<");obj.className=obj.className.replace(/(?:^|\s)blocking(?!\S)/g,' block ');}else{msgbar.addClass('blocking');obj.innerHTML=obj.innerHTML.replace(">加入黑名單<",">移出黑名單<");obj.className=obj.className.replace(/(?:^|\s)block(?!\S)/g,' blocking ');}
changeBlockCount();}}}});clearTimeout(timeout);},1000);}
function changeBlockCount(){if($$('.block_count').length>0){$$.ajax({url:"ajax.php",data:{action:"countBlock"},type:"GET",async:false,success:function(response){$$('.block_count').text($$.trim(response)).show();}});}}
function changeEditorTemplate(obj,target){if(window.AtUser&&window.AtUser.EditorInputDetector&&window.AtUser.EditorInputDetector.saveEditorText)
window.AtUser.EditorInputDetector.saveEditorText();var target_editor=document.getElementById(target);var target_editor_content="";if(typeof wysiwyg!='undefined'){target_editor_content=getEditorContents();}else{target_editor_content=target_editor.value;}
$$.ajax({url:"ajax.php",data:{action:"gettemplate",typeid:parseInt(obj.value)},type:"GET",async:false,success:function(response){var fouce_change=false;var fouce_ask=false;if(target_editor_content.length>0&&target_editor_content!="<br>"&&response.length>1){if(typeof wysiwyg!='undefined'){if(target_editor_content!=getSnapshot()){fouce_ask=true;}}else{if(target_editor_content.length!=target_editor.getAttribute("data-templatelength")){fouce_ask=true;}}
if(fouce_ask){var cf=confirm("使用預設的內容範本嗎?");if(cf==true){fouce_change=true;}else{fouce_change=false;}}else{target_editor_content="";fouce_change=true;}}else{fouce_change=true;}
if(fouce_change){if(typeof wysiwyg!='undefined'){content_str=response+"<br>"+target_editor_content;writeEditorContents(content_str);addSnapshot(content_str);}else{content_str=(response+target_editor_content).trim().replace(/<br>/gi,"\n");target_editor.value=content_str;target_editor.setAttribute("data-templatelength",response.length);target_editor.focus();if(window.AtUser&&window.AtUser.EditorInputDetector&&window.AtUser.EditorInputDetector.loadEditorText)
window.AtUser.EditorInputDetector.loadEditorText();}}}});}
function openUrlFancybox(url){$$.fancybox.open({src:url,type:'iframe',closeBtn:false,scrolling:'no',padding:0,helpers:{overlay:{closeClick:false}},beforeShow:function(){$$(".fancybox-skin").css("backgroundColor","transparent");$$(".fancybox-skin").css("box-shadow","none");},iframe:{css:{padding:0,borderRadius:12,overflow:'hidden'}}});}
function syncThreadPosition(tid,pid,floor){if(!floor)floor=1;$$.ajax({url:"ajax.php",data:{action:"syncthreadprogress",pid:pid,tid:tid,floor:floor},type:"GET",async:true});}
function threadtypesSelectUpdate(){var selectedOption=$$("#threadtypesSelectHidden option:selected");if(selectedOption.length){if(selectedOption.length==1){$("threadtypesSelect").selectedIndex=$$("#threadtypesSelect option[value="+selectedOption.get(0).value+"]").get(0).index;}else{$("threadtypesSelect").selectedIndex=$("threadtypesSelect").options.length-1;}}else{$("threadtypesSelect").selectedIndex=0;}}
function triggerTypeSelectOnchange(triggeredValue){$("threadtypesSelect").selectedIndex=$$("#threadtypesSelect option[value="+triggeredValue+"]").get(0).index;if($("threadtypesSelect").onchange)$("threadtypesSelect").onchange();}
function threadtypesChange(id,checked){if(checked){var limit=$$("#threadtypesSelectHidden").data("limit");limit=limit?limit:0;var selectedOption=$$("#threadtypesSelectHidden option:selected");if(selectedOption.length){if(selectedOption.length+1>limit){checked=false;var checkedBox=$$("#threadtypesSelect_menu input[data-typeid="+id+"]");if(checkedBox.length)checkedBox.get(0).checked=checked;setTimeout(function(){alert("對不起，此版區的帖子只能選取 "+limit+" 個分類。");},100);}}}
var hiddenOption=$$("#threadtypesSelectHidden option[value="+id+"]");if(hiddenOption=hiddenOption?hiddenOption.get(0):undefined){hiddenOption.selected=checked;}
try{if(checked)triggerTypeSelectOnchange(id);}catch(ex){}
threadtypesSelectUpdate();}
function threadtypesSelectBox(elem){threadtypesSelectUpdate();var timeout=0;var divclass='popupmenu_popup';var optionclass='popupmenu_option';var duration=timeout>0?0:3;var ctrlid=elem.id;var div=$(ctrlid+'_menu');if(!div){div=document.createElement('div');div.ctrlid=ctrlid;div.id=ctrlid+'_menu';div.style.display='none';div.className=divclass;var threadtypesOptions='';threadtypesOptions+='<ul>';$$('#threadtypesSelectHidden option').each(function(){}